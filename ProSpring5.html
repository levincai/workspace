<!--if IE]><![endif]--><!DOCTYPE html><!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"            itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"data-offline-url="/"data-url="/library/view/pro-spring-5/9781484228081/ACoverHTML.html"data-csrf-cookie="csrfsafari"data-highlight-privacy=""  data-user-id="3866890"  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"  data-username="levinxccai"  data-account-type="B2B"    data-activated-trial-date="11/06/2017"  data-archive="9781484228081"  data-publishers="Apress"  data-htmlfile-name="ACoverHTML.html"  data-epub-title="Pro Spring 5: An In-Depth Guide to the Spring Framework and Its Tools" data-debug=0 data-testing=0><![endif]--><!--if gt IE 8]><!--><html class="js flexbox flexboxlegacy no-touch websqldatabase indexeddb history csscolumns csstransforms localstorage sessionstorage applicationcache svg inlinesvg zoom fa-events-icons-ready" data-account-type="B2B" data-activated-trial-date="11/06/2017" data-archive="9781484228081" data-csrf-cookie="csrfsafari" data-debug="0" data-epub-title="Pro Spring 5: An In-Depth Guide to the Spring Framework and Its Tools" data-highlight-privacy="" data-htmlfile-name="ACoverHTML.html" data-login-url="/accounts/login/" data-offline-url="/" data-publishers="Apress" data-testing="0" data-url="/library/view/pro-spring-5/9781484228081/ACoverHTML.html" data-user-id="3866890" data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca" data-username="levinxccai" itemscope="" itemtype="http://schema.org/Book http://schema.org/ItemPage" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#" style=""><!--![endif]--><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><link href="cid:css-7e9dbbd9-9aa5-463a-b2cf-17e0f43c9fc9@mhtml.blink" rel="stylesheet" type="text/css"/><link href="cid:css-9c6c48c8-e3d3-4e4c-b5b6-c50b23604d36@mhtml.blink" rel="stylesheet" type="text/css"/><link href="cid:css-1703631d-f0e3-4665-9357-d4ecc6f8a27c@mhtml.blink" rel="stylesheet" type="text/css"/><link href="cid:css-802388d3-85c2-4dce-89b9-cba381196492@mhtml.blink" rel="stylesheet" type="text/css"/><link href="cid:css-2cbf04cf-6140-4c35-b08a-78e1c83adf26@mhtml.blink" rel="stylesheet" type="text/css"/><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"/><meta content="Safari Books Online" name="author"/><meta content="telephone=no" name="format-detection"/><meta content="on" http-equiv="cleartype"/><meta content="True" name="HandheldFriendly"/><meta content="320" name="MobileOptimized"/><meta content="app-id=881697395, app-argument=safaridetail://9781484228081" name="apple-itunes-app"/><meta content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0" name="viewport"/><meta content="4503599627559754" property="twitter:account_id"/><link href="https://learning.oreilly.com/static/images/apple-touch-icon.0c29511d2d72.png" rel="apple-touch-icon"/><link href="https://learning.oreilly.com/favicon.ico" rel="shortcut icon" type="image/x-icon"/><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900,200italic,300italic,400italic,600italic,700italic,900italic" rel="stylesheet" type="text/css"/><title>A315511_5_En_0_Chapter</title><link href="https://learning.oreilly.com/static/CACHE/css/output.8054605313ed.css" rel="stylesheet" type="text/css"/><link href="https://learning.oreilly.com/static/css/annotator.e3b0c44298fc.css" rel="stylesheet" type="text/css"/><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet"/><link href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/ACoverHTML.html" rel="canonical"/><meta content=" " name="description"/><meta content="Cover" property="og:title"/><meta content="/library/view/pro-spring-5/9781484228081/" itemprop="isPartOf"/><meta content="Cover" itemprop="name"/><meta content="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/ACoverHTML.html" itemprop="url" property="og:url"/><meta content="Safari" property="og:site_name"/><meta content="https://learning.oreilly.com/library/cover/9781484228081/" itemprop="thumbnailUrl" property="og:image"/><meta content=" " itemprop="description" property="og:description"/><meta content="en" itemprop="inLanguage"/><meta content="Apress" itemprop="publisher"/><meta content="book" property="og:type"/><meta content="9781484228081" itemprop="isbn" property="og:book:isbn"/><meta content="Clarence Ho" itemprop="author" property="og:book:author"/><meta content="Chris Schaefer" itemprop="author" property="og:book:author"/><meta content="Rob Harrop" itemprop="author" property="og:book:author"/><meta content="Iuliana Cosmina" itemprop="author" property="og:book:author"/><meta content="summary" name="twitter:card"/><meta content="@safari" name="twitter:site"/><link href="https://use.fontawesome.com/840a321d95.css" media="all" rel="stylesheet"/></head><body class="reading sidenav nav-collapsed  scalefonts library">
<a name="1_"></a>
<div class="application" id="container" style="height: auto;"><div class="js-toc"><section role="document"><div id="sbo-rt-content" style="max-width:72.5em; transform: none;"><div class="annotator-wrapper"><div class="CoverFigure"><img alt="A978-1-4842-2808-1_CoverFigure.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A978-1-4842-2808-1_CoverFigure.jpg" height="1181" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A978-1-4842-2808-1_CoverFigure.jpg" width="827"/></div><div class="annotator-outer annotator-viewer viewer annotator-hide"> </div></div></div></section></div></div>
<hr/>
<!--if IE]><![endif]-->

<!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"            itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"data-offline-url="/"data-url="/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Chapter.html"data-csrf-cookie="csrfsafari"data-highlight-privacy=""  data-user-id="3866890"  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"  data-username="levinxccai"  data-account-type="B2B"    data-activated-trial-date="11/06/2017"  data-archive="9781484228081"  data-publishers="Apress"  data-htmlfile-name="A315511_5_En_1_Chapter.html"  data-epub-title="Pro Spring 5: An In-Depth Guide to the Spring Framework and Its Tools" data-debug=0 data-testing=0><![endif]-->
<!--if gt IE 8]><!-->

<!--![endif]-->




<a name="2_"></a>

    <div class="application" id="container" style="height: auto;">
        <div class="js-toc">
            <section role="document">
                <div id="sbo-rt-content" style="max-width:72.5em; transform: none;">
                    <div class="annotator-wrapper">
                        <!--egin Abstract-->
                        <div class="MainTitleSection">
                            <h1 class="ChapterTitle" xml:lang="en">1. Introducing Spring</h1>
                        </div>
                        <div class="AuthorGroup">
                            <div class="AuthorNames"><span class="Author"><span class="AuthorName">Iuliana Cosmina</span><sup>1 <span class="ContactIcon"></span></sup>, </span><span class="Author"><span class="AuthorName">Rob Harrop</span><sup>2</sup>, </span>
                                <span class="Author"><span class="AuthorName">Chris Schaefer</span><sup>3</sup> and </span><span class="Author"><span class="AuthorName">Clarence Ho</span><sup>4</sup></span>
                            </div>
                            <div class="Affiliations">
                                <div class="Affiliation" id="Aff5"><span class="AffiliationNumber">(1)</span>
                                    <div class="AffiliationText">Sibiu, Sibiu, Romania</div>
                                </div>
                                <div class="Affiliation" id="Aff6"><span class="AffiliationNumber">(2)</span>
                                    <div class="AffiliationText">Reddish, UK</div>
                                </div>
                                <div class="Affiliation" id="Aff7"><span class="AffiliationNumber">(3)</span>
                                    <div class="AffiliationText">Venice, Florida, USA</div>
                                </div>
                                <div class="Affiliation" id="Aff8"><span class="AffiliationNumber">(4)</span>
                                    <div class="AffiliationText">Hong Kong, China</div>
                                </div>
                                <div class="ClearBoth"> </div>
                            </div>
                        </div>
                        <!--nd Abstract-->
                        <div class="Fulltext">
                            <div class="Para" id="Par1">When we think of the community of <span id="ITerm1">Java developers              </span>, we are reminded of the hordes of gold rush prospectors of the late 1840s, frantically panning the rivers of North America, looking for
                                fragments of gold. As Java developers, our rivers run rife with open source projects, but, like the prospectors, finding a useful project can be time-consuming and arduous.</div>
                            <div class="Para" id="Par2">A common gripe with many open source Java projects is that they are conceived merely out of the need to fill the gap in the implementation of the latest buzzword-heavy technology or pattern. Having said that, many high-quality,
                                usable projects meet and address a real need for real applications, and in the course of this book, you will meet a subset of these projects. You will get to know one in particular rather well—Spring. The first version
                                of Spring was released in October 2002 and consisted of a small core with an <span id="ITerm2">inversion of control (IoC)      </span> <span id="ITerm3">                                  </span> container that was easy
                                to configure and use. Over the years Spring has become the main replacement of <span id="ITerm4">Java Enterprise Edition (JEE)      </span> servers and has grown into a full-blown technology made up of many distinct projects,
                                each with its own purpose, so whether you want to build microservices, applications, or classical ERPs, Spring has a project for that.</div>
                            <div class="Para" id="Par3">Throughout this book, you will see many applications of different open source technologies, all of which are unified under the Spring Framework. When working with Spring, an application developer can use a large variety of
                                open source tools, without needing to write reams of code and without coupling an application too closely to any particular tool.</div>
                            <div class="Para" id="Par4">In this chapter, as its title indicates, we introduce you to the Spring Framework, rather than presenting any solid examples or explanations. If you are already familiar with Spring, you might want to skip this chapter and
                                proceed straight to Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Chapter.html"><span class="RefSource">2</span></a>
                                </span>.</div>
                            <div class="Section1 RenderAsSection1" id="Sec1">
                                <h2 class="Heading">What Is Spring?</h2>
                                <div class="Para" id="Par5">Perhaps one the hardest parts of explaining Spring is classifying exactly what it is. Typically, Spring is <span id="ITerm5">described                  </span> as a lightweight framework for building Java applications,
                                    but that statement brings up two interesting points.</div>
                                <div class="Para" id="Par6">First, you can use Spring to build any application in Java (for example, stand-alone, web, or JEE applications), unlike many other frameworks (such as Apache Struts, which is limited to web applications).</div>
                                <div class="Para ParaOneEmphasisChild" id="Par7">Second, the <span class="EmphasisTypeItalic">lightweight</span> part of the description doesn’t really refer to the number of classes or the size of the distribution but rather defines the principle of the Spring philosophy
                                    as a whole—that is, minimal impact. Spring is lightweight in the sense that you have to make few, if any, changes to your application code to gain the benefits of Spring Core, and should you choose to stop using Spring
                                    at any point, you will find doing so quite simple.</div>
                                <div class="Para" id="Par8">Notice that we qualified that last statement to refer to Spring Core only—many of the extra Spring components, such as data access, require a much closer coupling to the Spring Framework. However, the benefits of this coupling
                                    are quite clear, and throughout the book we present techniques for minimizing the impact this has on your application.</div>
                                <div class="Section2 RenderAsSection2" id="Sec2">
                                    <h3 class="Heading">Evolution of the Spring Framework</h3>
                                    <div class="Para" id="Par9">The Spring Framework originated from the book <span class="EmphasisTypeItalic">Expert One-on-One: J2EE Design and Development</span> by Rod Johnson (Wrox, 2002). Over the last decade, the Spring Framework has grown
                                        dramatically in core functionality, associated projects, and community support. With the new major release of the Spring Framework, it’s worthwhile to take a quick look back at important features that have come
                                        along with each milestone release of Spring, leading up to Spring Framework 5.0.
                                        <div class="UnorderedList">
                                            <ul class="UnorderedListMarkBullet">
                                                <li>
                                                    <div class="Para" id="Par10"> <span id="ITerm6">                      <span class="EmphasisTypeItalic">Spring 0.9</span> </span>: This is the first public release of the framework, based on the book <span class="EmphasisTypeItalic">Expert One-on-One: J2EE Design and Development</span>,
                                                        that offered a bean configuration foundation, AOP support, a JDBC abstraction framework, abstract transaction support, and so on. This version does not have official reference documentation, but
                                                        you can find the existing sources and documentation on SourceForge.<a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Chapter.html#Fn1" id="Fn1_source"><sup>1</sup></a>                                                        </div>
                                                </li>
                                                <li>
                                                    <div class="Para" id="Par12"> <span id="ITerm7">                      <span class="EmphasisTypeItalic">Spring 1.x</span> </span>: This is the first version released with official reference documentation. It is composed of the seven
                                                        modules shown in Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Chapter.html#Fig1">1-1</a></span>.
                                                        <div class="Figure" id="Fig1">
                                                            <div class="MediaObject" id="MO1"><img alt="A315511_5_En_1_Fig1_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Fig1_HTML.jpg" height="187" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Fig1_HTML.jpg" width="440"/></div>
                                                            <div class="Caption" xml:lang="en">
                                                                <div class="CaptionContent"><span class="CaptionNumber">Figure 1-1.</span>
                                                                    <div class="SimplePara">Overview of the Spring Framework, version 1.x</div>
                                                                </div>
                                                        </div>
                                                    </div>
                                                    <div class="UnorderedList">
                                                        <ul class="UnorderedListMarkDash">
                                                            <li>
                                                                <div class="Para" id="Par13"> <span id="ITerm8">                            <span class="EmphasisTypeItalic">Spring Core</span> </span>: Bean container and supporting utilities</div>
                                                            </li>
                                                            <li>
                                                                <div class="Para" id="Par14"> <span class="EmphasisTypeItalic">Spring</span> <span id="ITerm9">                            <span class="EmphasisTypeItalic">Context</span> </span>: <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>,
                                                                    UI, validation, JNDI, <span id="ITerm10">Enterprise JavaBeans (EJB)                      </span>, remoting, and mail support</div>
                                                            </li>
                                                            <li>
                                                                <div class="Para" id="Par15"> <span class="EmphasisTypeItalic">Spring DAO</span>: Transaction infrastructure, <span id="ITerm11">Java Database Connectivity (JDBC)                      </span>, and <span id="ITerm12">data access object (DAO)                      </span>                                                                    support</div>
                                                            </li>
                                                            <li>
                                                                <div class="Para" id="Par16"> <span class="EmphasisTypeItalic">Spring ORM</span>: Hibernate, iBATIS, and <span id="ITerm13">Java Data Objects (JDO)                      </span> support</div>
                                                            </li>
                                                            <li>
                                                                <div class="Para" id="Par17"> <span class="EmphasisTypeItalic">Spring AOP</span>: An AOP Alliance–compliant <span id="ITerm14">aspect-oriented programming (AOP)                      </span> implementation</div>
                                                            </li>
                                                            <li>
                                                                <div class="Para ParaOneEmphasisChild" id="Par18"> <span class="EmphasisTypeItalic">Spring Web</span>: Basic integration features such as multipart functionality, context initialization through servlet listeners, and a web-oriented application
                                                                    context</div>
                                                            </li>
                                                            <li>
                                                                <div class="Para" id="Par19"> <span class="EmphasisTypeItalic">Spring Web MVC</span>: Web-based <span id="ITerm15">Model-View-Controller (MVC)                      </span> framework</div>
                                                            </li>
                                                        </ul>
                                                    </div>
                                        </div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par20"> <span id="ITerm16">                      <span class="EmphasisTypeItalic">Spring 2.x</span> </span>: This is composed of the six modules shown in Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Chapter.html#Fig2">1-2</a></span>.
                                                The Spring Context module is now included in Spring Core, and all Spring web components have been represented here by a single item.
                                                <div class="Figure" id="Fig2">
                                                    <div class="MediaObject" id="MO2"><img alt="A315511_5_En_1_Fig2_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Fig2_HTML.jpg" height="190" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Fig2_HTML.jpg" width="440"/></div>
                                                    <div class="Caption" xml:lang="en">
                                                        <div class="CaptionContent"><span class="CaptionNumber">Figure 1-2.</span>
                                                            <div class="SimplePara">Overview of the Spring Framework, version 2.x</div>
                                                        </div>
                                                </div>
                                            </div>
                                            <div class="UnorderedList">
                                                <ul class="UnorderedListMarkDash">
                                                    <li>
                                                        <div class="Para" id="Par21">Easier XML configuration through the use of the new XML Schema–based configuration rather than the DTD format. Notable areas of improvement include bean definitions, AOP, and declarative transactions.</div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par22">New bean scopes for web and portal usage (request, session, and global sessions).</div>
                                                    </li>
                                                    <li>
                                                        <div class="Para ParaOneEmphasisChild" id="Par23"> <span class="EmphasisFontCategoryNonProportional">@AspectJ</span> annotation support for AOP development.</div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par24">Java Persistence API (JPA) abstraction layer.</div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par25">Full support for asynchronous JMS message-driven POJOs (for plain old Java objects).</div>
                                                    </li>
                                                    <li>
                                                        <div class="Para ParaOneEmphasisChild" id="Par26">JDBC simplifications including <span class="EmphasisFontCategoryNonProportional">SimpleJdbcTemplate</span> when using Java 5+.</div>
                                                    </li>
                                                    <li>
                                                        <div class="Para ParaOneEmphasisChild" id="Par27">JDBC named parameter support (<span class="EmphasisFontCategoryNonProportional">NamedParameterJdbcTemplate</span>).</div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par28">Form tag library for Spring MVC.</div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par29">Introduction of the Portlet MVC framework.</div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par30">Dynamic language support. Beans can be written in JRuby, Groovy, and BeanShell.</div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par31">Notification support and controllable MBean registration in JMX.</div>
                                                    </li>
                                                    <li>
                                                        <div class="Para ParaOneEmphasisChild" id="Par32"> <span class="EmphasisFontCategoryNonProportional">TaskExecutor</span> abstraction introduced for scheduling tasks.</div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par33">Java 5 annotation support, specifically for <span class="EmphasisFontCategoryNonProportional">@Transactional</span>, <span class="EmphasisFontCategoryNonProportional">@Required</span>, and
                                                            <span class="EmphasisFontCategoryNonProportional">@AspectJ</span>.</div>
                                                    </li>
                                                </ul>
                                            </div>
                                    </div>
                                    </li>
                                    <li>
                                        <div class="Para" id="Par34"> <span id="ITerm17">                      <span class="EmphasisTypeItalic">Spring 2.5.x</span> </span>: This version has the following features:
                                            <div class="UnorderedList">
                                                <ul class="UnorderedListMarkDash">
                                                    <li>
                                                        <div class="Para" id="Par35">A new configuration annotation called <span class="EmphasisFontCategoryNonProportional">@Autowired</span> and support for JSR-250 annotations (<span class="EmphasisFontCategoryNonProportional">@Resource</span>,
                                                            <span class="EmphasisFontCategoryNonProportional">@PostConstruct</span>, <span class="EmphasisFontCategoryNonProportional">@PreDestroy</span>)</div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par36">New stereotype annotations: <span class="EmphasisFontCategoryNonProportional">@Component</span>, <span class="EmphasisFontCategoryNonProportional">@Repository</span>, <span class="EmphasisFontCategoryNonProportional">@Service</span>,
                                                            <span class="EmphasisFontCategoryNonProportional">@Controller</span> </div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par37">Automatic classpath-scanning support to detect and wire classes annotated with stereotype annotations</div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par38">AOP updates, including a new bean pointcut element and AspectJ load-time weaving</div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par39">Full WebSphere transaction management support</div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par40">In addition to the Spring MVC <span class="EmphasisFontCategoryNonProportional">@Controller</span> annotation, <span class="EmphasisFontCategoryNonProportional">@RequestMapping</span>, <span class="EmphasisFontCategoryNonProportional">@RequestParam</span>,
                                                            and <span class="EmphasisFontCategoryNonProportional">@ModelAttribute</span> annotations added to support request handling through annotation configuration</div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par41">Tiles 2 support</div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par42">JSF 1.2 support</div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par43">JAX-WS 2.0/2.1 support</div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par44">Introduction of the Spring TestContext Framework, providing annotation-driven and integration testing support, agnostic of the testing framework being used</div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par45"> <span id="ITerm18">Ability                                              </span> to deploy a Spring application context as a JCA adapter</div>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="Para" id="Par46"> <span id="ITerm19">                      <span class="EmphasisTypeItalic">Spring 3.0.x</span> </span>: This is the first version of Spring based on Java 5 and is designed to take full advantage of Java 5 features
                                            such as generics, varargs, and other language improvements. This version introduces the Java-based <span class="EmphasisFontCategoryNonProportional">@Configuration</span> model. The framework modules have been
                                            revised to be managed separately with one source tree per module JAR. This is abstractly depicted in Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Chapter.html#Fig3">1-3</a></span>.
                                            <div class="Figure" id="Fig3">
                                                <div class="MediaObject" id="MO3"><img alt="A315511_5_En_1_Fig3_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Fig3_HTML.jpg" height="259" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Fig3_HTML.jpg" width="440"/></div>
                                                <div class="Caption" xml:lang="en">
                                                    <div class="CaptionContent"><span class="CaptionNumber">Figure 1-3.</span>
                                                        <div class="SimplePara">Overview of the Spring Framework, version 3.0.x</div>
                                                    </div>
                                        </div>
                                </div>
                                <div class="UnorderedList">
                                    <ul class="UnorderedListMarkDash">
                                        <li>
                                            <div class="Para" id="Par47">Support for Java 5 features such as generics, varargs, and other improvements</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par48">First-class support for Callables, Futures, <span class="EmphasisFontCategoryNonProportional">ExecutorService</span> adapters, and <span class="EmphasisFontCategoryNonProportional">ThreadFactory</span> integration</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par49">Framework modules now managed separately with one source tree per module JAR</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par50">Introduction of the <span id="ITerm20">Spring Expression Language (SpEL)                      </span> </div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par51">Integration of core Java Config features and annotations</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par52">General-purpose type conversion system and field-formatting system</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par53">Comprehensive REST support</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par54">New MVC <span id="ITerm21">XML                                              </span> namespace and additional annotations such as <span class="EmphasisFontCategoryNonProportional">@CookieValue</span> and
                                                <span class="EmphasisFontCategoryNonProportional">@RequestHeaders</span> for Spring MVC</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par55">Validation enhancements and JSR-303 (Bean Validation) support</div>
                                        </li>
                                        <li>
                                            <div class="Para ParaOneEmphasisChild" id="Par56">Early support for Java EE 6, including <span class="EmphasisFontCategoryNonProportional">@Async/@Asynchronous</span> annotation, JSR-303, JSF 2.0, JPA 2.0, and so on</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par57">Support for embedded databases such as HSQL, H2, and Derby</div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            </li>
                            <li>
                                <div class="Para" id="Par58"> <span id="ITerm22">                      <span class="EmphasisTypeItalic">Spring 3.1.x</span> </span>: This version has the following features:
                                    <div class="UnorderedList">
                                        <ul class="UnorderedListMarkDash">
                                            <li>
                                                <div class="Para" id="Par59">New cache abstraction</div>
                                            </li>
                                            <li>
                                                <div class="Para ParaOneEmphasisChild" id="Par60">Bean definition profiles can be defined in XML as well as support for the <span class="EmphasisFontCategoryNonProportional">@Profile</span> annotation</div>
                                            </li>
                                            <li>
                                                <div class="Para" id="Par61">Environment abstraction for unified property management</div>
                                            </li>
                                            <li>
                                                <div class="Para" id="Par62">Annotation equivalents for common Spring XML namespace elements such as <span class="EmphasisFontCategoryNonProportional">@ComponentScan</span>, <span class="EmphasisFontCategoryNonProportional">@EnableTransactionManagement</span>,
                                                    <span class="EmphasisFontCategoryNonProportional">@EnableCaching</span>, <span class="EmphasisFontCategoryNonProportional">@EnableWebMvc</span>, <span class="EmphasisFontCategoryNonProportional">@EnableScheduling</span>,
                                                    <span class="EmphasisFontCategoryNonProportional">@EnableAsync</span>, <span class="EmphasisFontCategoryNonProportional">@EnableAspectJAutoProxy</span>, <span class="EmphasisFontCategoryNonProportional">@EnableLoadTimeWeaving</span>,
                                                    and <span class="EmphasisFontCategoryNonProportional">@EnableSpringConfigured</span> </div>
                                            </li>
                                            <li>
                                                <div class="Para" id="Par63">Support for Hibernate 4</div>
                                            </li>
                                            <li>
                                                <div class="Para ParaOneEmphasisChild" id="Par64">Spring TestContext Framework support for <span class="EmphasisFontCategoryNonProportional">@Configuration</span> classes and bean definition profiles</div>
                                            </li>
                                            <li>
                                                <div class="Para" id="Par65">c: namespace for simplified constructor injection</div>
                                            </li>
                                            <li>
                                                <div class="Para" id="Par66">Support for Servlet 3 code-based configuration of the Servlet container</div>
                                            </li>
                                            <li>
                                                <div class="Para" id="Par67">Ability to bootstrap the JPA <span class="EmphasisFontCategoryNonProportional">EntityManagerFactory</span> without <span class="EmphasisFontCategoryNonProportional">persistence.xml</span> </div>
                                            </li>
                                            <li>
                                                <div class="Para" id="Par68"> <span class="EmphasisFontCategoryNonProportional">Flash</span> and <span class="EmphasisFontCategoryNonProportional">RedirectAttributes</span> added to Spring MVC, allowing attributes to survive a redirect
                                                    by using the HTTP session</div>
                                            </li>
                                            <li>
                                                <div class="Para" id="Par69">URI template variable enhancements</div>
                                            </li>
                                            <li>
                                                <div class="Para" id="Par70">Ability to annotate Spring MVC <span class="EmphasisFontCategoryNonProportional">@RequestBody</span> controller method arguments with <span class="EmphasisFontCategoryNonProportional">@Valid</span> </div>
                                            </li>
                                            <li>
                                                <div class="Para" id="Par71"> <span id="ITerm23">Ability                                              </span> to annotate Spring MVC controller method arguments with the <span class="EmphasisFontCategoryNonProportional">@RequestPart</span>                                                    annotation</div>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <div class="Para" id="Par72"> <span id="ITerm24">                      <span class="EmphasisTypeItalic">Spring 3.2.x</span> </span>: This version has the following features:
                                    <div class="UnorderedList">
                                        <ul class="UnorderedListMarkDash">
                                            <li>
                                                <div class="Para" id="Par73">Support for Servlet 3–based asynchronous request processing.</div>
                                            </li>
                                            <li>
                                                <div class="Para" id="Par74">New Spring MVC test framework.</div>
                                            </li>
                                            <li>
                                                <div class="Para" id="Par75">New Spring MVC annotations <span class="EmphasisFontCategoryNonProportional">@ControllerAdvice</span> and <span class="EmphasisFontCategoryNonProportional">@MatrixVariable</span>.</div>
                                            </li>
                                            <li>
                                                <div class="Para" id="Par76">Support for generic types in <span class="EmphasisFontCategoryNonProportional">RestTemplate</span> and in <span class="EmphasisFontCategoryNonProportional">@RequestBody</span> arguments.</div>
                                            </li>
                                            <li>
                                                <div class="Para" id="Par77">Jackson JSON 2 support.</div>
                                            </li>
                                            <li>
                                                <div class="Para" id="Par78">Support for Tiles 3.</div>
                                            </li>
                                            <li>
                                                <div class="Para" id="Par79"> <span class="EmphasisFontCategoryNonProportional">@RequestBody</span> or an <span class="EmphasisFontCategoryNonProportional">@RequestPart</span> argument can now be followed by an <span class="EmphasisFontCategoryNonProportional">Errors</span>                                                    argument, making it possible to handle validation errors.</div>
                                            </li>
                                            <li>
                                                <div class="Para" id="Par80">Ability to exclude URL patterns by using the MVC namespace and Java Config configuration options.</div>
                                            </li>
                                            <li>
                                                <div class="Para ParaOneEmphasisChild" id="Par81">Support for <span class="EmphasisFontCategoryNonProportional">@DateTimeFormat</span> without Joda Time.</div>
                                            </li>
                                            <li>
                                                <div class="Para" id="Par82">Global date and time formatting.</div>
                                            </li>
                                            <li>
                                                <div class="Para" id="Par83">Concurrency refinements across the framework, minimizing locks and generally improving concurrent creation of scoped/prototyped beans</div>
                                            </li>
                                            <li>
                                                <div class="Para" id="Par84">New Gradle-based build system.</div>
                                            </li>
                                            <li>
                                                <div class="Para" id="Par85">Migration to GitHub (<span class="ExternalRef"><a href="https://github.com/SpringSource/spring-framework"><span class="RefSource">                              <span class="EmphasisFontCategoryNonProportional">https://github.com/SpringSource/spring-framework</span>                                                    </span>
                                                    </a>
                                                    </span>).</div>
                                            </li>
                                            <li>
                                                <div class="Para" id="Par86">Refined Java SE 7/OpenJDK 7 support in the framework and third-party dependencies. CGLIB and ASM are now included as part of Spring. AspectJ 1.7 is supported in addition to 1.6.</div>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <div class="Para" id="Par87"> <span id="ITerm25">                      <span class="EmphasisTypeItalic">Spring 4.0.x</span> </span>: This is a major Spring release and the first to fully support Java 8. Older versions of Java can be used, but the minimum
                                    requirement has been raised to Java SE6. Deprecated classes and methods were removed, and the module organization is pretty much the same, as depicted in Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Chapter.html#Fig4">1-4</a></span>.
                                    <div class="Figure" id="Fig4">
                                        <div class="MediaObject" id="MO4"><img alt="A315511_5_En_1_Fig4_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Fig4_HTML.jpg" height="256" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Fig4_HTML.jpg" width="440"/></div>
                                        <div class="Caption" xml:lang="en">
                                            <div class="CaptionContent"><span class="CaptionNumber">Figure 1-4.</span>
                                                <div class="SimplePara">Overview of the Spring Framework, version 4.0.x</div>
                                            </div>
                                </div>
                        </div>
                        <div class="UnorderedList">
                            <ul class="UnorderedListMarkDash">
                                <li>
                                    <div class="Para" id="Par88">Improved getting-started experience via a series of Getting Started guides on the new <span class="ExternalRef"><a href="http://www.spring.io/guides"><span class="RefSource">                              <span class="EmphasisFontCategoryNonProportional">www.spring.io/guides</span>                                        </span>
                                        </a>
                                        </span> web site</div>
                                </li>
                                <li>
                                    <div class="Para" id="Par89">Removal of deprecated packages and methods from the prior Spring 3 version</div>
                                </li>
                                <li>
                                    <div class="Para" id="Par90">Java 8 support, raising the minimum Java version to 6 update 18</div>
                                </li>
                                <li>
                                    <div class="Para" id="Par91">Java EE 6 and above is now considered the baseline for Spring Framework 4.0</div>
                                </li>
                                <li>
                                    <div class="Para" id="Par92">Groovy bean definition DSL, allowing bean definitions to be configured via Groovy syntax</div>
                                </li>
                                <li>
                                    <div class="Para" id="Par93">Core container, testing, and general web improvements</div>
                                </li>
                                <li>
                                    <div class="Para" id="Par94">WebSocket, SockJS, and STOMP messaging</div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    </li>
                    <li>
                        <div class="Para" id="Par95"> <span id="ITerm26">                      <span class="EmphasisTypeItalic">Spring 4.2.x</span> </span>: This version has the following features:
                            <div class="UnorderedList">
                                <ul class="UnorderedListMarkDash">
                                    <li>
                                        <div class="Para ParaOneEmphasisChild" id="Par96">Core improvements (eg., introduction of <span class="EmphasisFontCategoryNonProportional">@AliasFor</span> and modification of existing annotation to make use of it)</div>
                                    </li>
                                    <li>
                                        <div class="Para" id="Par97">Full support for Hibernate ORM 5.0</div>
                                    </li>
                                    <li>
                                        <div class="Para" id="Par98">JMS and web <span id="ITerm27">improvements                                              </span> </div>
                                    </li>
                                    <li>
                                        <div class="Para" id="Par99">WebSocket messaging improvements</div>
                                    </li>
                                    <li>
                                        <div class="Para" id="Par100">Testing improvements, most notably the introduction of <span class="EmphasisFontCategoryNonProportional">@Commit</span> to replace <span class="EmphasisFontCategoryNonProportional">@Rollback(false)</span> and the
                                            introduction of the <span class="EmphasisFontCategoryNonProportional">AopTestUtils</span> utility class that allows access to the underlying object hidden behind a Spring proxy</div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="Para" id="Par101"> <span id="ITerm28">                      <span class="EmphasisTypeItalic">Spring 4.3.x</span> </span>: This version has the following features:
                            <div class="UnorderedList">
                                <ul class="UnorderedListMarkDash">
                                    <li>
                                        <div class="Para" id="Par102">The programming model has been refined.</div>
                                    </li>
                                    <li>
                                        <div class="Para ParaOneEmphasisChild" id="Par103">Considerable improvements in the core container (inclusions of ASM 5.1, CGLIB 3.2.4, and Objenesis 2.4 in <span class="EmphasisFontCategoryNonProportional">spring-core.jar</span>) and MVC.</div>
                                    </li>
                                    <li>
                                        <div class="Para" id="Par104">Composed annotations were added.</div>
                                    </li>
                                    <li>
                                        <div class="Para" id="Par105">Spring TestContext Framework requires JUnit 4.12 or higher.</div>
                                    </li>
                                    <li>
                                        <div class="Para" id="Par106">Support for new libraries, including Hibernate ORM 5.2, Hibernate Validator 5.3, Tomcat 8.5 and 9.0, Jackson 2.8, and so on</div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="Para" id="Par107"> <span id="ITerm29">                      <span class="EmphasisTypeItalic">Spring 5.0.x</span> </span>: This is a major release. The entire framework codebase is based on Java 8 and is fully compatible with Java 9 as of July 2016.
                            <a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Chapter.html#Fn2" id="Fn2_source"><sup>2</sup></a>
                                <div class="UnorderedList">
                                    <ul class="UnorderedListMarkDash">
                                        <li>
                                            <div class="Para" id="Par109">Support was dropped for Portlet, Velocity, JasperReports, XMLBeans, JDO, Guava, Tiles2, and Hibernate3.</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par110">XML configuration namespaces are now streamed to unversioned schemas; version-specific declarations are still supported but validated against the latest XSD schema.</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par111">Overall improvements were introduced by harnessing the full power of Java 8 features.</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par112">The <span class="EmphasisFontCategoryNonProportional">Resource</span> abstraction provides <span class="EmphasisFontCategoryNonProportional">isFile</span> indicator for defensive <span class="EmphasisFontCategoryNonProportional">getFile</span>                                                access.</div>
                                        </li>
                                        <li>
                                            <div class="Para ParaOneEmphasisChild" id="Par113">Full Servlet 3.1 signature support in Spring-provided <span class="EmphasisFontCategoryNonProportional">Filter</span> implementations.</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par114">Support for Protobuf 3.0.</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par115">Support for JMS 2.0+, JPA 2.1+.<span id="ITerm30">                                                                                  </span> </div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par116">Introduction of Spring Web Flow, a project that is an alternative to <span class="EmphasisFontCategoryNonProportional">Spring MVC</span> built on a reactive foundation, which means that it is fully asynchronous
                                                and non-blocking, intended for use in an event-loop execution model vs. traditional large thread pool with a thread-per-request execution model (built upon Project Reactor<a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Chapter.html#Fn3" id="Fn3_source"><sup>3</sup></a>).</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par118">The web and core modules were adapted to the reactive programming model.<a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Chapter.html#Fn4" id="Fn4_source"><sup>4</sup></a>                                                </div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par120">There are a lot of improvements in the Spring test module. JUnit 5 is now supported, and new annotations were introduced to support the Jupiter programming and extension model such as <span class="EmphasisFontCategoryNonProportional">@SpringJUnitConfig</span>,
                                                <span class="EmphasisFontCategoryNonProportional">@SpringJUnitWebConfig</span>, <span class="EmphasisFontCategoryNonProportional">@EnabledIf</span>, <span class="EmphasisFontCategoryNonProportional">@DisabledIf</span>.</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par121">Support for parallel test execution in the Spring TestContext Framework.</div>
                                        </li>
                                    </ul>
                                </div>
                        </div>
                    </li>
                    </ul>
                </div>
        </div>
    </div>
    <div class="Section2 RenderAsSection2" id="Sec3">
        <h3 class="Heading">Inverting Control or Injecting Dependencies?</h3>
        <div class="Para" id="Par122">The core of the Spring Framework is based on the principle of inversion of control. IoC is a technique that externalizes the creation and management of component dependencies. Consider an example in which class <span class="EmphasisFontCategoryNonProportional">Foo</span>            depends on an instance of class <span class="EmphasisFontCategoryNonProportional">Bar</span> to perform some kind of processing. Traditionally, <span class="EmphasisFontCategoryNonProportional">Foo</span> creates an instance of <span class="EmphasisFontCategoryNonProportional">Bar</span>            by using the <span class="EmphasisFontCategoryNonProportional">new</span> operator or obtains one from some kind of factory class. Using the IoC approach, an instance of <span class="EmphasisFontCategoryNonProportional">Bar</span> (or a subclass)
            is provided to <span class="EmphasisFontCategoryNonProportional">Foo</span> at runtime by some external process. This behavior, the injection of dependencies at runtime, led to IoC being renamed by Martin Fowler as the much more descriptive
            <span class="EmphasisTypeItalic">dependency injection</span> (DI). Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Chapter.html"><span class="RefSource">3</span></a>
            </span>
            discusses the precise nature of the dependencies managed by DI.</div>
        <div class="Para ParaTypeImportant" id="Par123"><img alt="A315511_5_En_1_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Figa_HTML.jpg" width="30"/>            As you will see in Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Chapter.html"><span class="RefSource">3</span></a>
            </span>, using the term <span class="EmphasisTypeItalic">dependency injection</span> when referring to inversion of control is always correct. In the context of Spring, you can use the terms interchangeably, without any loss of meaning.</div>
        <div class="Para" id="Par124">Spring’s DI implementation is based on two core Java concepts: JavaBeans and interfaces. When you use Spring as the DI provider, you gain the flexibility of defining dependency configuration within your applications in different ways (for example,
            XML files, Java configuration classes, annotations within your code, or the new Groovy bean definition method). <span id="ITerm31">JavaBeans (POJOs)                      </span> provide a standard mechanism for creating Java resources that
            are configurable in a number of ways, such as constructors and setter methods. In Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Chapter.html"><span class="RefSource">3</span></a>
            </span>, you will see how Spring uses the JavaBean specification to form the core of its DI configuration model; in fact, any Spring-managed resource is referred to as a <span class="EmphasisTypeItalic">bean</span>. If you are unfamiliar with JavaBeans,
            refer to the quick primer we present at the beginning of Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Chapter.html"><span class="RefSource">3</span></a>
            </span>.</div>
    <div class="Para" id="Par125"> <span id="ITerm32">Interfaces                      </span> and DI are technologies that are mutually beneficial. Clearly designing and coding an application to interfaces makes for a flexible application, but the complexity of wiring together an application
        designed using interfaces is quite high and places an additional coding burden on developers. By using DI, you reduce the amount of code you need to use an interface-based design in your application to almost zero. Likewise, by using interfaces,
        you can get the most out of DI because your beans can utilize any interface implementation to satisfy their dependency. The use of interfaces also allows Spring to utilize JDK dynamic proxies (the Proxy pattern) to provide powerful concepts such
        as AOP for crosscutting concerns.</div>
    <div class="Para" id="Par126">In the context of DI, Spring acts more like a container than a framework—providing instances of your application classes with all the dependencies they need—but it does so in a much less intrusive way. Using Spring for DI relies on nothing more than
        following the JavaBeans naming conventions within your classes—there are no special classes from which to inherit or proprietary naming schemes to follow. If anything, the only change you make in an application that uses DI is to expose more properties
        on your JavaBeans, thus allowing more dependencies to be injected at runtime.</div>
    </div>
    <div class="Section2 RenderAsSection2" id="Sec4">
        <h3 class="Heading"> <span id="ITerm33">Evolution          </span> of Dependency Injection</h3>
        <div class="Para" id="Par127">In the past few years, thanks to the popularity gained by Spring and other DI frameworks, DI has gained wide acceptance among Java developer communities. At the same time, developers were convinced that using DI was a best practice in application
            development, and the benefits of using DI were also well understood.</div>
        <div class="Para" id="Par128">The popularity of DI was acknowledged when the <span id="ITerm34">Java Community Process (JCP)          </span> adopted JSR-330 (Dependency Injection for Java) in 2009. JSR-330 had become a formal Java specification request, and as you might expect,
            one of the specification leads was Rod Johnson—the founder of the Spring Framework. In JEE 6, JSR-330 became one of the included specifications of the entire technology stack. In the meantime, the EJB architecture (starting from version 3.0)
            was also revamped dramatically; it adopted the DI model in order to ease the development of various Enterprise JavaBeans apps.</div>
        <div class="Para" id="Par129">Although we leave the full discussion of DI until Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Chapter.html"><span class="RefSource">3</span></a>
            </span>, it is worth taking a look at the benefits of using DI rather than a more traditional approach.
            <div class="UnorderedList">
                <ul class="UnorderedListMarkBullet">
                    <li>
                        <div class="Para ParaOneEmphasisChild" id="Par130"> <span class="EmphasisTypeItalic">Reduced glue code</span>: One of the biggest plus points of DI is its ability to dramatically reduce the amount of code you have to write to glue the components of your application together. Often
                            this code is trivial, so creating a dependency involves simply creating a new instance of an object. However, the glue code can get quite complex when you need to look up dependencies in a JNDI repository or when the dependencies
                            cannot be invoked directly, as is the case with remote resources. In these cases, DI can really simplify the glue code by providing automatic JNDI lookup and automatic proxying of remote resources.</div>
                    </li>
                    <li>
                        <div class="Para ParaOneEmphasisChild" id="Par131"> <span class="EmphasisTypeItalic">Simplified application configuration</span>: By adopting DI, you can greatly simplify the process of configuring an application. You can use a variety of options to configure those classes that
                            were injectable to other classes. You can use the same technique to express the dependency requirements to the “injector” for injecting the appropriate bean instance or property. In addition, DI makes it much simpler to swap
                            one implementation of a dependency for another. Consider the case where you have a DAO component that performs data operations against a PostgreSQL database and you want to upgrade to Oracle. Using DI, you can simply reconfigure
                            the appropriate dependency on your business objects to use the Oracle implementation rather than the PostgreSQL one.</div>
                    </li>
                    <li>
                        <div class="Para ParaOneEmphasisChild" id="Par132"> <span class="EmphasisTypeItalic">Ability to manage common dependencies in a single repository</span>: Using a traditional approach to dependency management of common services—for example, data source connection, transaction, and
                            remote services—you create instances (or lookup from some factory classes) of your dependencies where they are needed (within the dependent class). This will cause the dependencies to spread across the classes in your application,
                            and changing them can prove problematic. When you use DI, all the information about those common dependencies is contained in a single repository, making the management of dependencies much simpler and less error prone.</div>
                    </li>
                    <li>
                        <div class="Para" id="Par133"> <span class="EmphasisTypeItalic">Improved</span> <span id="ITerm35">                      <span class="EmphasisTypeItalic">testability</span> </span>: When you design your classes for DI, you make it possible to replace dependencies
                            easily. This is especially handy when you are testing your application. Consider a business object that performs some complex processing; for part of this, it uses a DAO to access data stored in a relational database. For your
                            test, you are not interested in testing the DAO; you simply want to test the business object with various sets of data. In a traditional approach, whereby the business object is responsible for obtaining an instance of the
                            DAO itself, you have a hard time testing this, because you are unable to easily replace the DAO implementation with a mock implementation that returns your test data sets. Instead, you need to make sure your test database contains
                            the correct data and uses the full DAO implementation for your tests. Using DI, you can create a mock implementation of the DAO object that returns the test data sets, and then you can pass this to your business object for
                            testing. This mechanism can be extended for testing any tier of your application and is especially useful for testing web components where you can create mock implementations of <span class="EmphasisFontCategoryNonProportional">HttpServletRequest</span>                            and <span class="EmphasisFontCategoryNonProportional">HttpServletResponse</span>.</div>
                    </li>
                    <li>
                        <div class="Para ParaOneEmphasisChild" id="Par134"> <span class="EmphasisTypeItalic">Fostering of good application design</span>: Designing for DI means, in general, designing against interfaces. A typical injection-oriented application is designed so that all major components are
                            defined as interfaces, and then concrete implementations of these interfaces are created and hooked together using the DI container. This kind of design was possible in Java before the advent of DI and DI-based containers such
                            as Spring, but by using Spring, you get a whole host of DI features for free, and you are able to concentrate on building your application logic, not a framework to support it.</div>
                    </li>
                </ul>
            </div>
        </div>
        <div class="Para" id="Par135">As you can see from this list, DI provides a lot of benefits for your application, but it is not without its drawbacks. In particular, DI can make it difficult for someone not intimately familiar with the code to see just what implementation of
            a particular dependency is being hooked into which objects. Typically, this is a problem only when developers are inexperienced with DI; after becoming more experienced and following good DI coding practice (for example, putting all injectable
            classes within each application layer into the same package), developers will be able to discover the whole picture easily. For the most part, the massive benefits far outweigh this small drawback, but you should consider this when planning
            your application.</div>
    </div>
    <div class="Section2 RenderAsSection2" id="Sec5">
        <h3 class="Heading">Beyond Dependency Injection</h3>
        <div class="Para" id="Par136">Spring Core alone, with its advanced DI capabilities, is a worthy tool, but where Spring really excels is in its myriad of additional features, all elegantly designed and built using the principles of DI. Spring provides features for all layers
            of an application, from helper <span id="ITerm36">application programming interfaces (APIs)          </span> for data access right through to advanced MVC capabilities. What is great about these features in Spring is that, although Spring
            often provides its own approach, you can easily integrate them with other tools in Spring, making these tools first-class members of the Spring family.</div>
        <div class="Section3 RenderAsSection3" id="Sec6">
            <h4 class="Heading">Support for <span id="ITerm37">Java 9            </span> <span id="ITerm38">                                                    </span> </h4>
            <div class="Para" id="Par137">Java 8 brings many exciting features that Spring Framework 5 supports, most notably lambda expressions and method references with Spring’s callback interfaces. The Spring 5 release plan was aligned with the initial release plan for JDK 9,
                and although the release deadline for JDK 9 has been postponed, Spring 5 was released according to plan. It is estimated that Spring 5.1 will fully embrace JDK 9. Spring 5 will make use of JDK 9 features such as compact strings, the ALPN
                stack, and the new HTTP Client implementation. While Spring Framework 4.0 supports Java 8, compatibility is still maintained back to JDK 6 update 18. The use of a more recent version of Java such as 7 or 8 is recommended for new development
                projects. Spring 5.0 requires Java 8+ because the Spring development team has applied the Java 8 language level to the entire framework codebase, but Spring 5 was built on JDK 9 too, even from the start, to provide comprehensive support
                for advertised features of JDK 9.</div>
        </div>
        <div class="Section3 RenderAsSection3" id="Sec7">
            <h4 class="Heading">Aspect-Oriented <span id="ITerm39">Programming            </span> with Spring</h4>
            <div class="Para" id="Par138"> <span id="ITerm40">AOP                          </span> provides the ability to implement crosscutting logic—that is, logic that applies to many parts of your application—in a single place and to have that logic applied across your application
                automatically. Spring’s approach to AOP is to create dynamic proxies to the target objects and weave the objects with the configured advice to execute the crosscutting logic. By the nature of JDK dynamic proxies, target objects must implement
                an interface declaring the method in which the AOP advice will be applied. Another popular AOP library is the Eclipse AspectJ project,<a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Chapter.html#Fn5" id="Fn5_source"><sup>5</sup></a> which provides more-powerful features including object construction, class loading, and stronger crosscutting capability. However, the good news for Spring and AOP developers is that
                starting from version 2.0, Spring offers much tighter integration with AspectJ. The following are some highlights:
                <div class="UnorderedList">
                    <ul class="UnorderedListMarkBullet">
                        <li>
                            <div class="Para" id="Par140">Support for AspectJ-style pointcut expressions</div>
                        </li>
                        <li>
                            <div class="Para ParaOneEmphasisChild" id="Par141">Support for <span class="EmphasisFontCategoryNonProportional">@AspectJ</span> annotation style, while still using Spring AOP for weaving</div>
                        </li>
                        <li>
                            <div class="Para" id="Par142">Support for aspects implemented in AspectJ for DI</div>
                        </li>
                        <li>
                            <div class="Para ParaOneEmphasisChild" id="Par143">Support for load-time weaving within the Spring <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> </div>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="Para ParaTypeImportant" id="Par144"> <img alt="A315511_5_En_1_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Figa_HTML.jpg" width="30"/>                Starting with Spring Framework version 3.2, <span class="EmphasisFontCategoryNonProportional">@AspectJ</span> annotation support can be enabled with Java configuration.</div>
            <div class="Para" id="Par145">Both kinds of AOP have their place, and in most cases, Spring AOP is sufficient for addressing an application’s crosscutting requirements. However, for more complicated requirements, AspectJ can be used, and both Spring AOP and AspectJ can
                be mixed in the same Spring-powered application.</div>
            <div class="Para" id="Par146">AOP has many applications. A typical one given in many of the traditional AOP examples involves performing some kind of logging, but AOP has found uses well beyond the trivial logging applications. Indeed, within the Spring Framework itself,
                AOP is used for many purposes, particularly in transaction management. Spring AOP is covered in full detail in Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Chapter.html"><span class="RefSource">5</span></a>
                </span>, where we show you typical uses of AOP within the Spring Framework and your own applications, as well as AOP performance and areas where traditional technologies are better suited than AOP.</div>
        </div>
        <div class="Section3 RenderAsSection3" id="Sec8">
            <h4 class="Heading">Spring Expression Language</h4>
            <div class="Para" id="Par147"> <span id="ITerm41">              <span class="EmphasisTypeItalic">Expression Language</span> (EL) </span> <span id="ITerm42">                                                    </span> is a technology to allow an application to manipulate
                Java objects at runtime. However, the problem with EL is that different technologies provide their own EL implementations and syntaxes. For example, Java Server Pages (JSP) and Java Server Faces (JSF) both have their own EL, and their
                syntaxes are different. To solve the problem, the Unified Expression Language (EL) was created.</div>
            <div class="Para ParaOneEmphasisChild" id="Par148">Because the Spring Framework is evolving so quickly, there is a need for a standard expression language that can be shared among all the Spring Framework modules as well as other Spring projects. Consequently, starting in version 3.0, Spring
                introduced the <span class="EmphasisTypeItalic">Spring Expression Language</span>. SpEL provides powerful features for evaluating expressions and for accessing Java objects and Spring beans at runtime. The result can be used in the application
                or injected into other JavaBeans.</div>
        </div>
        <div class="Section3 RenderAsSection3" id="Sec9">
            <h4 class="Heading">Validation in Spring</h4>
            <div class="Para" id="Par149"> <span id="ITerm43">Validation                          </span> is another large topic in any kind of application. The ideal scenario is that the validation rules of the attributes within JavaBeans containing business data can be applied in
                a consistent way, regardless of whether the data manipulation request is initiated from the front end, a batch job, or remotely (for example, via web services, RESTful web services, or remote procedure calls [RPCs]).</div>
            <div class="Para" id="Par150">To address these concerns, Spring provides a built-in validation API by way of the <span class="EmphasisFontCategoryNonProportional">Validator</span> interface. This interface provides a simple yet concise mechanism allowing you to encapsulate
                your validation logic into a class responsible for validating the target object. In addition to the target object, the validate method takes an <span class="EmphasisFontCategoryNonProportional">Errors</span> object, which is used to collect
                any validation errors that may occur.</div>
            <div class="Para" id="Par151">Spring also provides a handy utility class, <span class="EmphasisFontCategoryNonProportional">ValidationUtils</span>, which provides convenience methods for invoking other validators, checking for common problems such as empty strings, and
                reporting errors back to the provided <span class="EmphasisFontCategoryNonProportional">Errors</span> object.</div>
            <div class="Para" id="Par152">Driven by need, the JCP also developed JSR-303 (Bean Validation), which provides a standard way of defining bean validation rules. For example, when applying the <span class="EmphasisFontCategoryNonProportional">@NotNull</span> annotation
                to a bean’s property, it mandates that the attribute shouldn’t contain a <span class="EmphasisFontCategoryNonProportional">null</span> value before being able to persist into the database.</div>
            <div class="Para" id="Par153">Starting in version 3.0, Spring provides out-of-the-box support for JSR-303. To use the API, just declare a <span class="EmphasisFontCategoryNonProportional">LocalValidatorFactoryBean</span> and inject the <span class="EmphasisFontCategoryNonProportional">Validator</span>                interface into any Spring-managed beans. Spring will resolve the underlying implementation for you. By default, Spring will first look for the Hibernate Validator (<span class="EmphasisFontCategoryNonProportional">hibernate.org/subprojects/validator</span>),
                which is a popular JSR-303 implementation. Many front-end technologies (for example, JSF 2 and Google Web Toolkit), including Spring MVC, also support the application of JSR-303 validation in the user interface. The time when developers
                needed to program the same validation logic in both the user interface and the back-end layer is gone. Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_10_Chapter.html"><span class="RefSource">10</span></a>
                </span>
                discusses the details.</div>
            <div class="Para ParaTypeImportant" id="Par154"> <img alt="A315511_5_En_1_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Figa_HTML.jpg" width="30"/>                Starting with Spring Framework version 4.0, the 1.1 version of JSR-349 (Bean Validation) is supported.</div>
        </div>
        <div class="Section3 RenderAsSection3" id="Sec10">
            <h4 class="Heading">Accessing Data in Spring</h4>
            <div class="Para" id="Par155"> <span id="ITerm44">Data access                          </span> and persistence seem to be the most discussed topics in the Java world. Spring provides excellent integration with a choice selection of these data access tools. In addition,
                Spring makes plain-vanilla JDBC a viable option for many projects, with its simplified wrapper APIs around the standard API. Spring’s data access module provides out-of-the-box support for JDBC, Hibernate, JDO, and the JPA.</div>
            <div class="Para ParaTypeImportant" id="Par156"> <img alt="A315511_5_En_1_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Figa_HTML.jpg" width="30"/>                Starting with Spring Framework version 4.0, iBATIS support has been removed. The MyBatis-Spring project provides integration with Spring, and you can find more information at <span class="ExternalRef"><a href="http://mybatis.github.io/spring/"><span class="RefSource">                    <span class="EmphasisFontCategoryNonProportional">http://mybatis.github.io/spring/</span>                </span>
                </a>
                </span>.</div>
            <div class="Para" id="Par157">However, in the past few years, because of the explosive growth of the Internet and cloud computing, besides relational databases, a lot of other “special-purpose” databases were developed. Examples include databases based on key-value pairs
                to handle extremely large volumes of data (generally referred to as NoSQL), graph databases, and document databases. To help developers support those databases and to not complicate the Spring data access module, a separate project called
                Spring Data<a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Chapter.html#Fn6" id="Fn6_source"><sup>6</sup></a> was created. The project was further split into different
                categories to support more specific database access requirements.</div>
            <div class="Para ParaTypeImportant" id="Par159"> <img alt="A315511_5_En_1_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Figa_HTML.jpg" width="30"/>                Spring’s support of nonrelational databases is not covered in this book. If you are interested in this topic, the Spring Data project mentioned earlier is a good place to look. The project page details the nonrelational databases that
                it supports, with links to those databases’ home pages.</div>
            <div class="Para" id="Par160">The JDBC support in Spring makes building an application on top of JDBC a realistic undertaking, even for more complex applications. The support for Hibernate, JDO, and JPA makes already simple APIs even simpler, thus easing the burden on
                developers. When using the Spring APIs to access data via any tool, you are able to take advantage of Spring’s excellent transaction support. You’ll find a full discussion of this in Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html"><span class="RefSource">9</span></a>
                </span>.</div>
            <div class="Para" id="Par161">One of the nicest features in Spring is the ability to easily mix and match data access technologies within an application. For instance, you may be running an application with Oracle, using Hibernate for much of your data access logic. However,
                if you want to take advantage of some Oracle-specific features, it is simple to implement that part of your data access tier by using Spring’s JDBC APIs.</div>
        </div>
        <div class="Section3 RenderAsSection3" id="Sec11">
            <h4 class="Heading"> <span id="ITerm45">Object/XML Mapping                          </span> in Spring</h4>
            <div class="Para" id="Par162">Most applications need to integrate or provide services to other applications. One common requirement is to exchange data with other systems, either on a regular basis or in real time. In terms of data format, XML is the most commonly used.
                As a result, you will often need to transform a JavaBean into XML format, and vice versa. Spring supports many common Java-to-XML mapping frameworks and, as usual, eliminates the need for directly coupling to any specific implementation.
                Spring provides common interfaces for marshalling (transforming JavaBeans into XML) and unmarshalling (transforming XML into Java objects) for DI into any Spring beans. Common libraries such as Java Architecture for XML Binding (JAXB)
                <span id="ITerm46">                                                    </span>, Castor, XStream, JiBX, and XMLBeans are supported. In Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_12_Chapter.html"><span class="RefSource">12</span></a>
                </span>, when we discuss remotely accessing a Spring application for business data in XML format, you will see how to use Spring’s <span id="ITerm47">Object/XML Mapping (OXM)            </span> support in your application.</div>
        </div>
        <div class="Section3 RenderAsSection3" id="Sec12">
            <h4 class="Heading">Managing Transactions</h4>
            <div class="Para" id="Par163">Spring provides an excellent abstraction layer for <span id="ITerm48">transaction management                          </span>, allowing for programmatic and declarative transaction control. By using the Spring abstraction layer for transactions,
                you can make it simple to change the underlying transaction protocol and resource managers. You can start with simple, local, resource-specific transactions and move to global, multiresource transactions without having to change your code.
                Transactions are covered in full detail in Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html"><span class="RefSource">9</span></a>
                </span>.</div>
        </div>
        <div class="Section3 RenderAsSection3" id="Sec13">
            <h4 class="Heading">Simplifying and Integrating with <span id="ITerm49">JEE                          </span> </h4>
            <div class="Para" id="Par164">With the growing acceptance of DI frameworks such as Spring, a lot of developers have chosen to construct applications by using DI frameworks in favor of JEE’s EJB approach. As a result, the JCP communities also realize the complexity of EJB.
                Starting in version 3.0 of the EJB specification, the API was simplified, so it now embraces many of the concepts from DI.</div>
            <div class="Para" id="Par165">However, for those applications that were built on EJB or need to deploy the Spring-based applications in a JEE container and utilize the application server’s enterprise services (for example, Java Transaction API’s Transaction Manager, data
                source connection pooling, and JMS connection factories), Spring also provides simplified support for those technologies. For EJB, Spring provides a simple declaration to perform the JNDI lookup and inject into Spring beans. On the reverse
                side, Spring also provides simple annotation for injecting Spring beans into EJBs.</div>
            <div class="Para" id="Par166">For any resources stored in a JNDI-accessible location, Spring allows you to do away with the complex lookup code and have JNDI-managed resources injected as dependencies into other objects at runtime. As a side effect of this, your application
                becomes decoupled from JNDI, allowing you more scope for code reuse in the future.</div>
        </div>
        <div class="Section3 RenderAsSection3" id="Sec14">
            <h4 class="Heading">MVC in the Web <span id="ITerm50">Tier                          </span> </h4>
            <div class="Para" id="Par167">Although Spring can be used in almost any setting, from the desktop to the Web, it provides a rich array of classes to support the creation of web-based applications. Using Spring, you have maximum flexibility when you are choosing how to
                implement your web front end. For developing web applications, the MVC pattern is the most popular practice. In recent versions, Spring has gradually evolved from a simple web framework into a full-blown MVC implementation. First, view
                support in Spring MVC is extensive. In addition to standard support for JSP and <span id="ITerm51">Java Standard Tag Library (JSTL)            </span>, which is greatly bolstered by the Spring tag libraries, you can take advantage of fully
                integrated support for Apache Velocity, FreeMarker, Apache Tiles, Thymeleaf, and XSLT. In addition, you will find a set of base view classes that make it simple to add Microsoft Excel, PDF, and JasperReports output to your applications.</div>
            <div class="Para" id="Par168">In many cases, you will find Spring MVC sufficient for your web application development needs. However, Spring can also integrate with other popular web frameworks such as Struts, JSF, Atmosphere, <span id="ITerm52">Google Web Toolkit (GWT)            </span>,
                and so on.</div>
        <div class="Para" id="Par169">In the past few years, the technology of web frameworks has evolved quickly. Users have required more responsive and interactive experiences, and that has resulted in the rise of Ajax as a widely adopted technology in developing <span id="ITerm53">rich Internet applications (RIAs)            </span>.
            On the other hand, users also want to be able to access their applications from any device, including smartphones and tablets. This creates a need for web frameworks that support HTML5, JavaScript, and CSS3. In Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_16_Chapter.html"><span class="RefSource">16</span></a>
            </span>, we discuss developing web applications by using Spring MVC.</div>
    </div>
    <div class="Section3 RenderAsSection3" id="Sec15">
        <h4 class="Heading"> <span id="ITerm54">WebSocket Support                          </span> </h4>
        <div class="Para" id="Par170">Starting with Spring Framework 4.0, support for JSR-356 (Java API for WebSocket) is available. WebSocket defines an API for creating a persistent connection between a client and server, typically implemented in web browsers and servers. WebSocket-style
            development opens the door for efficient, full-duplex communication enabling real-time message exchanges for highly responsive applications. Use of WebSocket support is detailed further in Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_17_Chapter.html"><span class="RefSource">17</span></a>
            </span>.</div>
    </div>
    <div class="Section3 RenderAsSection3" id="Sec16">
        <h4 class="Heading"> <span id="ITerm55">Remoting Support                          </span> </h4>
        <div class="Para" id="Par171">Accessing or exposing remote components in Java has never been the simplest of jobs. Using Spring, you can take advantage of extensive support for a wide range of remoting techniques to quickly expose and access remote services. Spring provides
            support for a variety of remote access mechanisms, including Java Remote Method Invocation (RMI), JAX-WS, Caucho Hessian and Burlap, JMS, Advanced Message Queuing Protocol (AMQP), and REST. In addition to these remoting protocols, Spring provides
            its own HTTP-based invoker that is based on standard Java serialization. By applying Spring’s dynamic proxying capabilities, you can have a proxy to a remote resource injected as a dependency into one of your classes, thus removing the need
            to couple your application to a specific remoting implementation and also reducing the amount of code you need to write for your application. We discuss remote support in Spring in Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_12_Chapter.html"><span class="RefSource">12</span></a>
            </span>.</div>
    </div>
    <div class="Section3 RenderAsSection3" id="Sec17">
        <h4 class="Heading"> <span id="ITerm56">Mail Support                          </span> </h4>
        <div class="Para" id="Par172">Sending e-mail is a typical requirement for many kinds of applications and is given first-class treatment within the Spring Framework. Spring provides a simplified API for sending e-mail messages that fits nicely with the Spring DI capabilities.
            Spring supports the standard JavaMail API. Spring provides the ability to create a prototype message in the DI container and uses this as the base for all messages sent from your application. This allows for easy customization of mail parameters
            such as the subject and sender address. In addition, for customizing the message body, Spring integrates with template engines, such as Apache Velocity; this allows the mail content to be externalized from the Java code.</div>
    </div>
    <div class="Section3 RenderAsSection3" id="Sec18">
        <h4 class="Heading"> <span id="ITerm57">Job Scheduling Support                          </span> </h4>
        <div class="Para" id="Par173">Most nontrivial applications require some kind of scheduling capability. Whether this is for sending updates to customers or performing housekeeping tasks, the ability to schedule code to run at a predefined time is an invaluable tool for developers.
            Spring provides scheduling support that can fulfill most common scenarios. A task can be scheduled either for a fixed interval or by using a Unix cron expression. On the other hand, for task execution and scheduling, Spring integrates with
            other scheduling libraries as well. For example, in the application server environment, Spring can delegate execution to the CommonJ library that is used by many application servers. For job scheduling, Spring also supports libraries including
            the JDK Timer API and Quartz, a commonly used open source scheduling library. The scheduling support in Spring is covered in full in Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_11_Chapter.html"><span class="RefSource">11</span></a>
            </span>.</div>
    </div>
    <div class="Section3 RenderAsSection3" id="Sec19">
        <h4 class="Heading"> <span id="ITerm58">Dynamic Scripting Support                          </span> </h4>
        <div class="Para" id="Par174">Starting with JDK 6, Java introduced dynamic language support, in which you can execute scripts written in other languages in a JVM environment. Examples include Groovy, JRuby, and JavaScript. Spring also supports the execution of dynamic scripts
            in a Spring-powered application, or you can define a Spring bean that was written in a dynamic scripting language and injected into other JavaBeans. Spring-supported dynamic scripting languages include Groovy, JRuby, and BeanShell. In Chapter
            <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_14_Chapter.html"><span class="RefSource">14</span></a>
            </span>, we discuss the support of dynamic scripting in Spring in detail.</div>
    </div>
    <div class="Section3 RenderAsSection3" id="Sec20">
        <h4 class="Heading"> <span id="ITerm59">Simplified Exception Handling                          </span> </h4>
        <div class="Para" id="Par175">One area where Spring really helps reduce the amount of repetitive, boilerplate code you need to write is in exception handling. The core of the Spring philosophy in this respect is that checked exceptions are overused in Java and that a framework
            should not force you to catch any exception from which you are unlikely to be able to recover—a point of view that we agree with wholeheartedly. In reality, many frameworks are designed to reduce the impact of having to write code to handle
            checked exceptions. However, many of these frameworks take the approach of sticking with checked exceptions but artificially reducing the granularity of the exception class hierarchy. One thing you will notice with Spring is that because of
            the convenience afforded to the developer from using unchecked exceptions, the exception hierarchy is remarkably granular. Throughout the book, you will see examples in which the Spring exception-handling mechanisms can reduce the amount of
            code you have to write and, at the same time, improve your ability to identify, classify, and diagnose errors within your application.</div>
    </div>
    </div>
    </div>
    <div class="Section1 RenderAsSection1" id="Sec21">
        <h2 class="Heading">The Spring Project</h2>
        <div class="Para" id="Par176">One of the most endearing things about the Spring project is the level of activity present in the community and the amount of cross-pollination between Spring and other projects such as CGLIB, Apache Geronimo, and AspectJ. One of the most touted
            benefits of open source is that if the project folded tomorrow, you would be left with the code; but let’s face it—you do not want to be left with a codebase the size of Spring to support and improve. For this reason, it is comforting to know
            how well established and active the Spring community is.</div>
        <div class="Section2 RenderAsSection2" id="Sec22">
            <h3 class="Heading"> <span id="ITerm60">Origins of Spring                      </span> </h3>
            <div class="Para ParaOneEmphasisChild" id="Par177">As noted earlier in this chapter, the origins of Spring can be traced back to <span class="EmphasisTypeItalic">Expert One-to-One: J2EE Design and Development</span>. In this book, Rod Johnson presented his own framework, called the Interface
                21 Framework, which he developed to use in his own applications. Released into the open source world, this framework formed the foundation of the Spring Framework as we know it today. Spring proceeded quickly through the early beta and
                release candidate stages, and the first official 1.0 release was made available in March 2004. Since then, Spring has undergone dramatic growth, and at the time of this writing, the latest major version of Spring Framework is 5.0.</div>
        </div>
        <div class="Section2 RenderAsSection2" id="Sec23">
            <h3 class="Heading">The Spring Community</h3>
            <div class="Para" id="Par178">The Spring <span id="ITerm61">community                      </span> is one of the best in any open source project we have encountered. The mailing lists and forums are always active, and progress on new features is usually rapid. The development
                team is truly dedicated to making Spring the most successful of all the Java application frameworks, and this shows in the quality of the code that is reproduced. As we mentioned already, Spring also benefits from excellent relationships
                with other open source projects, a fact that is extremely beneficial when you consider the large amount of dependency the full Spring distribution has. From a user’s perspective, perhaps one of the best features of Spring is the excellent
                documentation and test suite that accompany the distribution. Documentation is provided for almost all the features of Spring, making it easy for new users to pick up the framework. The test suite Spring provides is impressively comprehensive—the
                development team writes tests for everything. If they discover a bug, they fix that bug by first writing a test that highlights the bug and then getting the test to pass. Fixing bugs and creating new features is not limited just to the
                development team! You can contribute code through pull requests against any portfolio of Spring projects through the official GitHub repositories (<span class="ExternalRef"><a href="http://github.com/spring-projects"><span class="RefSource">                  <span class="EmphasisFontCategoryNonProportional">http://github.com/spring-projects</span>                </span>
                </a>
                </span>). Additionally, issues can be created and tracked by way of the official Spring JIRA (<span class="ExternalRef"><a href="https://jira.spring.io/secure/Dashboard.jspa"><span class="RefSource">                  <span class="EmphasisFontCategoryNonProportional">https://jira.spring.io/secure/Dashboard.jspa</span>                </span>
                </a>
                </span>). What does all this mean to you? Well, put simply, it means you can be confident in the quality of the Spring Framework and confident that, for the foreseeable future, the Spring development team will continue to improve what is already
                an excellent framework.</div>
        </div>
        <div class="Section2 RenderAsSection2" id="Sec24">
            <h3 class="Heading">The Spring Tool Suite</h3>
            <div class="Para" id="Par179">To ease the development of Spring-based applications in Eclipse, Spring created the Spring IDE project. Soon after that, SpringSource, the company behind Spring founded by Rod Johnson, created an integrated tool called the <span id="ITerm62">Spring Tool Suite (STS)          </span>                <span id="ITerm63">                                              </span>, which can be downloaded from <span class="ExternalRef"><a href="https://spring.io/tools"><span class="RefSource">                  <span class="EmphasisFontCategoryNonProportional">https://spring.io/tools</span>                </span>
                </a>
                </span>. Although it used to be a paid-for product, the tool is now freely available. The tool integrates the Eclipse IDE, Spring IDE, Mylyn (a task-based development environment in Eclipse), Maven for Eclipse, AspectJ Development Tools, and
                many other useful Eclipse plug-ins into a single package. In each new version, more features are being added, such as Groovy scripting language support, a graphical Spring configuration editor, visual development tools for projects such
                as Spring Batch and Spring Integration, and support for the Pivotal tc Server application server.</div>
            <div class="Para ParaTypeImportant" id="Par180"> <img alt="A315511_5_En_1_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Figa_HTML.jpg" width="30"/>                SpringSource was bought by VMware and incorporated into Pivotal Software.</div>
            <div class="Para" id="Par181">In addition to the Java-based suite, a Groovy/Grails Tool Suite is available with similar capabilities but targeted at Groovy and Grails development (<span class="ExternalRef"><a href="http://spring.io/tools"><span class="RefSource">                  <span class="EmphasisFontCategoryNonProportional">http://spring.io/tools</span>                </span>
                </a>
                </span>).</div>
        </div>
        <div class="Section2 RenderAsSection2" id="Sec25">
            <h3 class="Heading">The Spring Security Project</h3>
            <div class="Para" id="Par182">The <span id="ITerm64">Spring Security project          </span> <span id="ITerm65">                                              </span> (<span class="ExternalRef"><a href="http://projects.spring.io/spring-security"><span class="RefSource">                  <span class="EmphasisFontCategoryNonProportional">http://projects.spring.io/spring-security</span>                </span>
                </a>
                </span>), formerly known as the Acegi Security System for Spring, is another important project within the Spring portfolio. Spring Security provides comprehensive support for both web application and method-level security. It tightly integrates
                with the Spring Framework and other commonly used authentication mechanisms, such as HTTP basic authentication, form-based login, X.509 certificate, and single sign-on (SSO) products (for example, CA SiteMinder). It provides role-based
                access control to application resources, and in applications with more-complicated security requirements (for example, data segregations), use of an access control list (ACL) is supported. However, Spring Security is mostly used in securing
                web applications, which we discuss in detail in Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_16_Chapter.html"><span class="RefSource">16</span></a>
                </span>.</div>
        </div>
        <div class="Section2 RenderAsSection2" id="Sec26">
            <h3 class="Heading"> <span id="ITerm66">Spring Boot          </span> <span id="ITerm67">                                              </span> </h3>
            <div class="Para" id="Par183">Setting up the basis of an application is a cumbersome job. Configuration files for the project must be created, and additional tools (like an application server) must be installed and configured. Spring Boot (<span class="ExternalRef"><a href="http://projects.spring.io/spring-boot/"><span class="RefSource">                  <span class="EmphasisFontCategoryNonProportional">http://projects.spring.io/spring-boot/</span>                </span>
                </a>
                </span>) is a Spring project that makes it easy to create stand-alone, production-grade Spring-based applications that you can just run. Spring Boot comes with out-of-the-box configurations for different types of Spring applications that are
                packed in <span class="EmphasisTypeItalic">starter</span> packages. The <span class="EmphasisFontCategoryNonProportional">web-starter</span> package, for example, contains a preconfigured and easily customizable web application context
                and supports Tomcat 7+, Jetty 8+, and Undertow 1.3 embedded servlet containers out of the box.</div>
            <div class="Para" id="Par184">Spring Boot also wraps up all dependencies a Spring application needs, taking into account compatibility between versions. At the time of writing, the current version of Spring Boot is 2.0.0.RELEASE.</div>
            <div class="Para" id="Par185">Spring Boot is covered in Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Chapter.html"><span class="RefSource">4</span></a>
                </span>, as an alternative Spring project configuration, and most of the projects assigned to later chapters will be run using Spring Boot because it makes development and testing more practical and faster.</div>
        </div>
        <div class="Section2 RenderAsSection2" id="Sec27">
            <h3 class="Heading"> <span id="ITerm68">Spring Batch and Integration                      </span> </h3>
            <div class="Para" id="Par186">Needless to say, batch job execution and integration are common use cases in applications. To cope with this need and to make it easy for developers in these areas, Spring created the Spring Batch and Spring Integration projects. Spring Batch
                provides a common framework and various policies for batch job implementation, reducing a lot of boilerplate code. By implementing the <span id="ITerm69">Enterprise Integration Patterns (EIP)          </span>, Spring Integration can make
                integrating Spring applications with external systems easy. We discuss the details in Chapter <span class="ExternalRef"><a href="https://doi.org/10.1007/978-1-4842-2808-1_20"><span class="RefSource">20</span></a>
                </span>.</div>
        </div>
        <div class="Section2 RenderAsSection2" id="Sec28">
            <h3 class="Heading">Many Other Projects</h3>
            <div class="Para" id="Par187">We’ve covered the core modules of Spring and some of the major projects within the Spring portfolio, but there are many other projects that have been driven by the need of the community for different requirements. Some examples include Spring
                Boot, Spring XD, Spring for Android, Spring Mobile, Spring Social, and Spring AMQP. Some of these projects are discussed further in Chapter <span class="ExternalRef"><a href="https://doi.org/10.1007/978-1-4842-2808-1_20"><span class="RefSource">20</span></a>
                </span>. For additional details, you can refer to the Spring by Pivotal web site (<span class="ExternalRef"><a href="http://www.spring.io/projects"><span class="RefSource">                  <span class="EmphasisFontCategoryNonProportional">www.spring.io/projects</span>                </span>
                </a>
                </span>).</div>
        </div>
    </div>
    <div class="Section1 RenderAsSection1" id="Sec29">
        <h2 class="Heading">Alternatives to Spring</h2>
        <div class="Para" id="Par188">Going back to our previous comments on the number of open source projects, you should not be surprised to learn that Spring is not the only framework offering dependency injection features or full end-to-end solutions for building applications.
            In fact, there are almost too many projects to mention. In the spirit of being open, we include a brief discussion of several of these frameworks here, but it is our belief that none of these platforms offers quite as comprehensive a solution
            as that available in Spring.</div>
        <div class="Section2 RenderAsSection2" id="Sec30">
            <h3 class="Heading"> <span id="ITerm70">JBoss Seam Framework                      </span> </h3>
            <div class="Para" id="Par189">Founded by Gavin King (the creator of the Hibernate ORM library), the Seam Framework (<span class="ExternalRef"><a href="http://seamframework.org/"><span class="RefSource">                  <span class="EmphasisFontCategoryNonProportional">http://seamframework.org</span>                </span>
                </a>
                </span>) is another full-blown DI-based framework. It supports web application front-end development (JSF), business logic layer (EJB 3), and JPA for persistence. As you can see, the main difference between Seam and Spring is that the Seam Framework
                is built entirely on JEE standards. JBoss also contributes the ideas in the Seam Framework back to the JCP and has become JSR-299 (Contexts and Dependency Injection for the Java EE Platform).</div>
        </div>
        <div class="Section2 RenderAsSection2" id="Sec31">
            <h3 class="Heading">Google Guice</h3>
            <div class="Para" id="Par190">Another popular DI framework is <span id="ITerm71">Google Guice                      </span> (<span class="ExternalRef"><a href="http://code.google.com/p/google-guice"><span class="RefSource">                  <span class="EmphasisFontCategoryNonProportional">http://code.google.com/p/google-guice</span>                </span>
                </a>
                </span>). Led by the search engine giant Google, Guice is a lightweight framework that focuses on providing DI for application configuration management. It was also the reference implementation of JSR-330 (Dependency Injection for Java).</div>
        </div>
        <div class="Section2 RenderAsSection2" id="Sec32">
            <h3 class="Heading">PicoContainer</h3>
            <div class="Para" id="Par191"> <span id="ITerm72">PicoContainer          </span> <span id="ITerm73">                                              </span> (<span class="ExternalRef"><a href="http://picocontainer.com/"><span class="RefSource">                  <span class="EmphasisFontCategoryNonProportional">http://picocontainer.com</span>                </span>
                </a>
                </span>) is an exceptionally small DI container that allows you to use DI for your application without introducing any dependencies other than PicoContainer. Because PicoContainer is nothing more than a DI container, you may find that as your
                application grows, you need to introduce another <span id="ITerm74">framework          </span> <span id="ITerm75">                                              </span>, such as Spring, in which case you would have been better off using
                Spring from the start. However, if all you need is a tiny DI container, then PicoContainer is a good choice, but since Spring packages the DI container separately from the rest of the framework, you can just as easily use that and keep
                the flexibility for the future.</div>
        </div>
        <div class="Section2 RenderAsSection2" id="Sec33">
            <h3 class="Heading"> <span id="ITerm76">JEE 7 Container          </span> <span id="ITerm77">                                              </span> <a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Chapter.html#Fn7" id="Fn7_source"><sup>7</sup></a> </h3>
            <div class="Para" id="Par193">As discussed previously, the concept of DI was widely adopted and also realized by JCP. When you are developing an application for application servers compliant with JEE 7 (JSR-342), you can use standard DI techniques across all layers.</div>
        </div>
    </div>
    <div class="Section1 RenderAsSection1" id="Sec34">
        <h2 class="Heading">Summary</h2>
        <div class="Para" id="Par194">In this chapter, we gave you a high-level view of the Spring Framework, complete with discussions of all the major features, and we guided you to the relevant sections of the book where these features are discussed in detail. After reading this
            chapter, you should understand what Spring can do for you; all that remains is to see <span class="EmphasisTypeItalic">how</span> it can do it. In the next chapter, we discuss all the information you need to know to get up and running with
            a basic Spring application. We show you how to obtain the Spring Framework and discuss the packaging options, the test suite, and the documentation. Also, Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Chapter.html"><span class="RefSource">2</span></a>
            </span>
            introduces some basic Spring code, including a time-honored Hello World example in all its DI-based glory.</div>
    </div>
    <div class="FootnoteSection">
        <div class="Heading">Footnotes</div>
        <div class="Footnote" id="Fn1"><span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Chapter.html#Fn1_source">1</a></span>
            <div class="FootnoteParas">
                <div class="Para" id="Par11">You can download older versions of Spring including 0.9 from the SourceForge site: <span class="ExternalRef"><a href="https://sourceforge.net/projects/springframework/files/springframework/"><span class="RefSource">                            <span class="EmphasisFontCategoryNonProportional">https://sourceforge.net/projects/springframework/files/springframework/</span>                    </span>
                    </a>
                    </span>.</div>
            </div>
            <div class="ClearBoth"> </div>
        </div>
        <div class="Footnote" id="Fn2"><span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Chapter.html#Fn2_source">2</a></span>
            <div class="FootnoteParas">
                <div class="Para" id="Par108">Keep in mind that Java 9 will be released officially to the public in September 2017, according to the Oracle schedule available at <span class="ExternalRef"><a href="http://openjdk.java.net/projects/jdk9/"><span class="RefSource">                            <span class="EmphasisFontCategoryNonProportional">http://openjdk.java.net/projects/jdk9/</span>                    </span>
                    </a>
                    </span>.</div>
            </div>
            <div class="ClearBoth"> </div>
        </div>
        <div class="Footnote" id="Fn3"><span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Chapter.html#Fn3_source">3</a></span>
            <div class="FootnoteParas">
                <div class="Para" id="Par117">Project Reactor implements the Reactive Streams API specification; see <span class="ExternalRef"><a href="https://projectreactor.io/"><span class="RefSource">                                  <span class="EmphasisFontCategoryNonProportional">https://projectreactor.io/</span>                    </span>
                    </a>
                    </span>.</div>
            </div>
            <div class="ClearBoth"> </div>
        </div>
        <div class="Footnote" id="Fn4"><span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Chapter.html#Fn4_source">4</a></span>
            <div class="FootnoteParas">
                <div class="Para" id="Par119">Reactive programming is a style of micro-architecture involving intelligent routing and consumption of events. This should lead to nonblocking applications that are asynchronous and event-driven and require a small number of threads to
                    scale vertically within the JVM, rather than horizontally through clustering.</div>
            </div>
            <div class="ClearBoth"> </div>
        </div>
    </div>
    </div>
    </div>
    </div>
    </section>
    </div>
    </div>
    <div class="font-flyout" style="top: 201.028px; left: 1280px;"></div>



<hr/>
<!--if IE]><![endif]-->

<!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"            itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"data-offline-url="/"data-url="/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Chapter.html"data-csrf-cookie="csrfsafari"data-highlight-privacy=""  data-user-id="3866890"  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"  data-username="levinxccai"  data-account-type="B2B"    data-activated-trial-date="11/06/2017"  data-archive="9781484228081"  data-publishers="Apress"  data-htmlfile-name="A315511_5_En_2_Chapter.html"  data-epub-title="Pro Spring 5: An In-Depth Guide to the Spring Framework and Its Tools" data-debug=0 data-testing=0><![endif]-->
<!--if gt IE 8]><!-->

<!--![endif]-->




<a name="3_"></a>

    <div class="application" id="container" style="height: auto;">
        <div class="js-toc">
            <section role="document">
                <div id="sbo-rt-content" style="max-width:72.5em; transform: none;">
                    <div class="annotator-wrapper">
                        <!--egin Abstract-->
                        <div class="MainTitleSection">
                            <h1 class="ChapterTitle" xml:lang="en">2. Getting Started</h1>
                        </div>
                        <div class="AuthorGroup">
                            <div class="AuthorNames"><span class="Author"><span class="AuthorName">Iuliana Cosmina</span><sup>1 <span class="ContactIcon"></span></sup>, </span><span class="Author"><span class="AuthorName">Rob Harrop</span><sup>2</sup>, </span>
                                <span class="Author"><span class="AuthorName">Chris Schaefer</span><sup>3</sup> and </span><span class="Author"><span class="AuthorName">Clarence Ho</span><sup>4</sup></span>
                            </div>
                            <div class="Affiliations">
                                <div class="Affiliation" id="Aff5"><span class="AffiliationNumber">(1)</span>
                                    <div class="AffiliationText">Sibiu, Sibiu, Romania</div>
                                </div>
                                <div class="Affiliation" id="Aff6"><span class="AffiliationNumber">(2)</span>
                                    <div class="AffiliationText">Reddish, UK</div>
                                </div>
                                <div class="Affiliation" id="Aff7"><span class="AffiliationNumber">(3)</span>
                                    <div class="AffiliationText">Venice, Florida, USA</div>
                                </div>
                                <div class="Affiliation" id="Aff8"><span class="AffiliationNumber">(4)</span>
                                    <div class="AffiliationText">Hong Kong, China</div>
                                </div>
                                <div class="ClearBoth"> </div>
                            </div>
                        </div>
                        <!--nd Abstract-->
                        <div class="Fulltext">
                            <div class="Para" id="Par1">Often the hardest part of learning to use any new development tool is figuring out where to begin. Typically, this problem is worse when the tool offers as many choices as Spring. Fortunately, getting started with Spring isn’t
                                that hard if you know where to look first. In this chapter, we present you with all the basic knowledge you need to get off to a flying start. Specifically, you will look at the following:
                                <div class="UnorderedList">
                                    <ul class="UnorderedListMarkBullet">
                                        <li>
                                            <div class="Para" id="Par2"> <span class="EmphasisTypeItalic">Obtaining Spring</span>: The first logical step is to obtain or build the Spring <span id="ITerm1">JAR files                          </span>. If you want to get up and running
                                                quickly, simply use the dependency management snippets in your build system with the examples provided at <span class="ExternalRef"><a href="http://projects.spring.io/spring-framework"><span class="RefSource">                    <span class="EmphasisFontCategoryNonProportional">http://projects.spring.io/spring-framework</span>                                                </span>
                                                </a>
                                                </span>. However, if you want to be on the cutting edge of Spring development, check out the latest version of the source code from Spring’s GitHub repository.<a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Chapter.html#Fn1" id="Fn1_source"><sup>1</sup></a> </div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par4"> <span class="EmphasisTypeItalic">Spring</span> <span id="ITerm2">                  <span class="EmphasisTypeItalic">packaging options</span> </span>: Spring packaging is modular; it allows you to pick and choose
                                                which components you want to use in your application and to include only those components when you are distributing your application. Spring has many modules, but you need only a subset of these modules
                                                depending on your application’s needs. Each module has its compiled binary code in a JAR file along with corresponding Javadoc and source JARs.</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par5"> <span class="EmphasisTypeItalic">Spring</span> <span id="ITerm3">                  <span class="EmphasisTypeItalic">guides</span> </span>: The new Spring web site includes a Guides section located at <span class="ExternalRef"><a href="http://spring.io/guides"><span class="RefSource">                    <span class="EmphasisFontCategoryNonProportional">http://spring.io/guides</span>                                                </span>
                                                </a>
                                                </span>. The guides are meant to be quick, hands-on instructions for building the Hello World version of any development task with Spring. These guides also reflect the latest Spring project releases and techniques,
                                                providing you with the most up-to-date samples available.</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par6"> <span id="ITerm4">                  <span class="EmphasisTypeItalic">Test suite and documentation</span> </span>: One of the things members of the Spring community are most proud of is their comprehensive test
                                                suite and documentation set. Testing is a big part of what the team does. The documentation set provided with the standard distribution is also excellent.</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par7"> <span class="EmphasisTypeItalic">Putting some Spring into Hello World</span>: All bad punning aside, we think the best way to get started with any new programming tool is to dive right in and write some code.
                                                We present a simple example, which is a full DI-based implementation of everyone’s favorite <span id="ITerm5">Hello World application                          </span>. Don’t be alarmed if you don’t understand
                                                all the code right away; full discussions follow later in the book.</div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="Para" id="Par8">If you are already familiar with the basics of the Spring Framework, feel free to proceed straight to Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Chapter.html"><span class="RefSource">3</span></a>
                                </span>
                                to dive into IoC and DI in Spring. However, even if you are familiar with the basics of Spring, you may find some of the discussions in this chapter interesting, especially those on packaging and dependencies.</div>
                            <div class="Section1 RenderAsSection1" id="Sec1">
                                <h2 class="Heading">Obtaining the Spring Framework</h2>
                                <div class="Para" id="Par9">Before you can get started with any Spring development, you need to obtain the Spring libraries. You have a couple of options for retrieving the libraries: you can use your build system to bring in the modules you want
                                    to use, or you can check out and build the code from the <span id="ITerm6">Spring GitHub repository                  </span>. Using a dependency management tool such as Maven or Gradle is often the most straightforward
                                    approach; all you need to do is declare the dependency in the configuration file and let the tool obtain the required libraries for you.</div>
                                <div class="Para ParaTypeImportant" id="Par10"><img alt="A315511_5_En_2_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Figa_HTML.jpg" width="30"/>                                    If you have an Internet connection and use a build tool such as Maven or Gradle in combination with a smart IDE like Eclipse or IntelliJ IDEA, you can download the Javadoc and libraries automatically so you can access
                                    them during development. When you upgrade the versions in the build configuration files when building the project, the libraries and Javadoc will be updated too.</div>
                                <div class="Section2 RenderAsSection2" id="Sec2">
                                    <h3 class="Heading">Getting Started Quickly</h3>
                                    <div class="Para" id="Par11">Visit the Spring Framework project page<a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Chapter.html#Fn2" id="Fn2_source"><sup>2</sup></a> to obtain
                                        a dependency management snippet for your build system to include the latest-release RELEASE version of Spring in your project. You can also use milestones/nightly snapshots for upcoming releases or previous versions.</div>
                                    <div class="Para" id="Par13">When using Spring Boot, there is no need to specify the Spring version you want to use, as Spring Boot provides opinionated “starter” <span id="ITerm7">project object model (POM) files          </span> to simplify your
                                        Maven configuration and default Gradle starter configuration. Just keep in mind that Spring Boot versions that precede version 2.0.0.RELEASE use Spring 4.<span class="EmphasisTypeItalic">x</span> versions.</div>
                        </div>
                        <div class="Section2 RenderAsSection2" id="Sec3">
                            <h3 class="Heading">Checking Spring Out of <span id="ITerm8">GitHub                      </span> </h3>
                            <div class="Para" id="Par14">If you want to learn about new features before they make their way even into the snapshots, you can check out the source code directly from Pivotal’s GitHub repository. To check out the latest version of the Spring code, first
                                install Git, which you can download from <span class="ExternalRef"><a href="http://git-scm.com/"><span class="RefSource">                  <span class="EmphasisFontCategoryNonProportional">http://git-scm.com</span> </span>
                                </a>
                                </span>. Then open a terminal shell and run the following command:</div>
                            <div class="Para" id="Par15">
                                <div class="ProgramCode" id="PC1">
                                    <div class="FixedLine">git clone git://github.com/spring-projects/spring-framework.git</div>
                                </div>
                            </div>
                            <div class="Para ParaOneEmphasisChild" id="Par16">See the <span class="EmphasisFontCategoryNonProportional">README.md</span> file in the project root for full details and requirements on how to build from source.</div>
                        </div>
                        <div class="Section2 RenderAsSection2" id="Sec4">
                            <h3 class="Heading">Using the Right <span id="ITerm9">JDK                      </span> </h3>
                            <div class="Para" id="Par17">The Spring Framework is built in Java, which means you need to be able to execute Java applications on your computer to use it. For this you need to install Java. There are three widely used Java acronyms when people talk about
                                Java applications development.
                                <div class="UnorderedList">
                                    <ul class="UnorderedListMarkBullet">
                                        <li>
                                            <div class="Para" id="Par18">A <span id="ITerm10">Java virtual machine (JVM)                </span> is an abstract machine. It is a specification that provides a runtime environment in which Java bytecode can be executed.</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par19">The <span id="ITerm11">Java Runtime Environment (JRE)                </span> is used to provide a runtime environment. It is the implementation of the JVM that physically exists. It contains a set of libraries
                                                and other files that the JVM uses at runtime. Oracle bought Sun Microsystems in 2010; since then, new versions and patches have been actively provided. Other companies, such as IBM, provide their own implementations
                                                of the JVM.</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par20">The <span id="ITerm12">Java Development Kit (JDK)                </span> <span id="ITerm13">                                                                </span> contains the JRE, documentation, and Java tools.
                                                This is what Java developers install on their machines. A smart editor like IntelliJ IDEA or Eclipse will require you to provide the location of the JDK so classes and documentation can be loaded and used
                                                during development.</div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="Para" id="Par21">If you are using a build tool like Maven or Gradle (the source code accompanying the book is organized in a Gradle multimodule project), it will require a JVM as well; Maven and Gradle are both Java-based projects themselves.</div>
                            <div class="Para" id="Par22">The latest stable Java version is Java 8, and Java 9 is scheduled to be released on 21 September 2017. You can download the JDK from <span class="ExternalRef"><a href="https://www.oracle.com/"><span class="RefSource">                  <span class="EmphasisFontCategoryNonProportional">https://www.oracle.com/</span>                                </span>
                                </a>
                                </span>. By default it will be installed in some default location on your computer, depending on your operating system. If you want to use Maven or Gradle from the command line, you need to define environment variables for the
                                JDK and Maven/Gradle and to add the path to their executables to the system path. You can find instructions on how to do this on the official site for each product and in the appendix of this book.</div>
                        <div class="Para" id="Par23">Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Chapter.html"><span class="RefSource">1</span></a>
                            </span> presented a list with Spring versions and the required JDK version. The Spring version covered in the book is 5.0.<span class="EmphasisTypeItalic">x</span>. The source code presented in the book is written using Java 8 syntax,
                            so you need at least JDK version 8 to be able to compile and run the examples.</div>
                    </div>
                </div>
                <div class="Section1 RenderAsSection1" id="Sec5">
                    <h2 class="Heading">Understanding Spring Packaging</h2>
                    <div class="Para" id="Par24"> <span class="EmphasisTypeItalic">Spring modules</span> are simply <span id="ITerm14">JAR files                  </span> that package the required code for that module. After you understand the purpose of each module, you can select
                        the modules required in your project and include them in your code. As of Spring version 5.0.0.RELEASE, Spring comes with 21 modules, packaged into 21 JAR files. Table <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Chapter.html#Tab1">2-1</a></span>                        describes these JAR files and their corresponding modules. The actual JAR file name is, for example, <span class="EmphasisFontCategoryNonProportional">spring-aop-5.0.0.RELEASE.jar</span>, though we have included only the specific
                        module portion for simplicity (as in <span class="EmphasisFontCategoryNonProportional">aop</span>, for example).
                        <div class="Table" id="Tab1">
                            <div class="Caption" xml:lang="en">
                                <div class="CaptionContent"><span class="CaptionNumber">Table 2-1.</span>
                                    <div class="SimplePara">Spring modules</div>
                                </div>
                            </div>
                            <table border="1">
                                <colgroup>
                                    <col>
                                    <col>
                                </colgroup>
                                <thead>
                                    <tr class="header">
                                        <th>
                                            <div class="SimplePara">Module</div>
                                        </th>
                                        <th>
                                            <div class="SimplePara">Description</div>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="noclass">
                                        <td>
                                            <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">aop</span> </div>
                                        </td>
                                        <td>
                                            <div class="SimplePara">This module contains all the classes you need to use Spring’s AOP features within your application. You also need to include this JAR in your application if you plan to use other features in Spring that use
                                                AOP, such as declarative transaction management. Moreover, classes that support integration with AspectJ are packed in this module.</div>
                                        </td>
                                    </tr>
                                    <tr class="noclass">
                                        <td>
                                            <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">aspects</span> </div>
                                        </td>
                                        <td>
                                            <div class="SimplePara">This module contains all the classes for advanced integration with the AspectJ AOP library. For example, if you are using Java classes for your Spring configuration and need AspectJ-style annotation-driven transaction
                                                management, you will need this module.</div>
                                        </td>
                                    </tr>
                                    <tr class="noclass">
                                        <td>
                                            <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">beans</span> </div>
                                        </td>
                                        <td>
                                            <div class="SimplePara">This module contains all the classes for supporting Spring’s manipulation of Spring beans. Most of the classes here support Spring’s bean factory implementation. For example, the classes required for processing
                                                the Spring XML configuration file and Java annotations are packed into this module.</div>
                                        </td>
                                    </tr>
                                    <tr class="noclass">
                                        <td>
                                            <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">beans-groovy</span> </div>
                                        </td>
                                        <td>
                                            <div class="SimplePara">This module contains Groovy classes for supporting Spring’s manipulation of Spring beans.</div>
                                        </td>
                                    </tr>
                                    <tr class="noclass">
                                        <td>
                                            <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">context</span> </div>
                                        </td>
                                        <td>
                                            <div class="SimplePara">This module contains classes that provide many extensions to Spring Core. You will find that all classes need to use Spring’s <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> feature
                                                (covered in Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Chapter.html"><span class="RefSource">5</span></a>
                                                </span>), along with classes for Enterprise JavaBeans (EJB), Java Naming and Directory Interface (JNDI), and Java Management Extensions (JMX) integration. Also contained in this module are the Spring remoting classes,
                                                classes for integration with dynamic scripting languages (for example, JRuby, Groovy, and BeanShell), JSR-303 (Bean Validation), scheduling and task execution, and so on.</div>
                                        </td>
                                    </tr>
                                    <tr class="noclass">
                                        <td>
                                            <div class="SimplePara"> <span id="ITerm15">                          <span class="EmphasisFontCategoryNonProportional">context</span> </span> <span class="EmphasisFontCategoryNonProportional">-indexer</span> </div>
                                        </td>
                                        <td>
                                            <div class="SimplePara">This module contains an indexer implementation that provides access to the candidates that are defined in <span class="EmphasisFontCategoryNonProportional">META-INF/spring.components</span>. The core class
                                                <span class="EmphasisFontCategoryNonProportional">CandidateComponentsIndex</span> is not meant to be used externally.</div>
                                        </td>
                                    </tr>
                                    <tr class="noclass">
                                        <td>
                                            <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">context-support</span> </div>
                                        </td>
                                        <td>
                                            <div class="SimplePara">This module contains further extensions to the <span class="EmphasisFontCategoryNonProportional">spring-context</span> module. On the user-interface side, there are classes for mail support and integration with
                                                templating engines such as Velocity, FreeMarker, and JasperReports. Also, integration with various task execution and scheduling libraries including CommonJ and Quartz are packaged here.</div>
                                        </td>
                                    </tr>
                                    <tr class="noclass">
                                        <td>
                                            <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">core</span> </div>
                                        </td>
                                        <td>
                                            <div class="SimplePara">This is the main module that you will need for every Spring application. In this JAR file, you will find all the classes that are shared among all other Spring modules (for example, classes for accessing configuration
                                                files). Also, in this JAR, you will find selections of extremely useful utility classes that are used throughout the Spring codebase and that you can use in your own application.</div>
                                        </td>
                                    </tr>
                                    <tr class="noclass">
                                        <td>
                                            <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">expression</span> </div>
                                        </td>
                                        <td>
                                            <div class="SimplePara">This module contains all support classes for Spring Expression Language (SpEL).</div>
                                        </td>
                                    </tr>
                                    <tr class="noclass">
                                        <td>
                                            <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">instrument</span> </div>
                                        </td>
                                        <td>
                                            <div class="SimplePara">This module includes Spring’s instrumentation agent for JVM bootstrapping. This JAR file is required for using load-time weaving with AspectJ in a Spring application.</div>
                                        </td>
                                    </tr>
                                    <tr class="noclass">
                                        <td>
                                            <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">dbc</span> </div>
                                        </td>
                                        <td>
                                            <div class="SimplePara">This module includes all classes for JDBC support. You will need this module for all applications that require database access. Classes for supporting data sources, JDBC data types, JDBC templates, native JDBC
                                                connections, and so on, are packed in this module.</div>
                                        </td>
                                    </tr>
                                    <tr class="noclass">
                                        <td>
                                            <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">jms</span> </div>
                                        </td>
                                        <td>
                                            <div class="SimplePara">This module includes all classes for JMS support.</div>
                                        </td>
                                    </tr>
                                    <tr class="noclass">
                                        <td>
                                            <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">messaging</span> </div>
                                        </td>
                                        <td>
                                            <div class="SimplePara">This module contains key abstractions taken from the Spring Integration project to serve as a foundation for message-based applications and adds support for STOMP messages.</div>
                                        </td>
                                    </tr>
                                    <tr class="noclass">
                                        <td>
                                            <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">orm</span> </div>
                                        </td>
                                        <td>
                                            <div class="SimplePara">This module extends Spring’s standard JDBC feature set with support for popular ORM tools including Hibernate, JDO, JPA, and the data mapper iBATIS. Many of the classes in this JAR depend on classes contained
                                                in the <span class="EmphasisFontCategoryNonProportional">spring-jdbc</span> JAR file, so you definitely need to include that in your application as well.</div>
                                        </td>
                                    </tr>
                                    <tr class="noclass">
                                        <td>
                                            <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">oxm</span> </div>
                                        </td>
                                        <td>
                                            <div class="SimplePara">This module provides support for <span id="ITerm16">Object/XML Mapping (OXM)                    </span>. Classes for the abstraction of XML marshalling and unmarshalling and support for popular tools such as
                                                Castor, JAXB, XMLBeans, and XStream are packed into this module.</div>
                                        </td>
                                    </tr>
                                    <tr class="noclass">
                                        <td>
                                            <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">test</span> </div>
                                        </td>
                                        <td>
                                            <div class="SimplePara">Spring provides a set of mock classes to aid in testing your applications, and many of these mock classes are used within the Spring test suite, so they are well tested and make testing your applications much
                                                simpler. Certainly we have found great use for the mock <span class="EmphasisFontCategoryNonProportional">HttpServletRequest</span> and <span class="EmphasisFontCategoryNonProportional">HttpServletResponse</span>                                                classes in unit tests for our web applications. On the other hand, Spring provides a tight integration with the JUnit unit-testing framework, and many classes that support the development of JUnit test cases
                                                are provided in this module; for example, <span class="EmphasisFontCategoryNonProportional">SpringJUnit4ClassRunner</span> provides a simple way to bootstrap the Spring <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>                                                in a unit test environment.</div>
                                        </td>
                                    </tr>
                                    <tr class="noclass">
                                        <td>
                                            <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">tx</span> </div>
                                        </td>
                                        <td>
                                            <div class="SimplePara">This module provides all classes for supporting Spring’s transaction infrastructure. You will find classes from the transaction abstraction layer to support the Java Transaction API (JTA) and integration with
                                                application servers from major vendors.</div>
                                        </td>
                                    </tr>
                                    <tr class="noclass">
                                        <td>
                                            <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">web</span> </div>
                                        </td>
                                        <td>
                                            <div class="SimplePara">This module contains the core classes for using Spring in your web applications, including classes for loading an <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> feature automatically,
                                                file upload support classes, and a bunch of useful classes for performing repetitive tasks such as parsing integer values from the query string.</div>
                                        </td>
                                    </tr>
                                    <tr class="noclass">
                                        <td>
                                            <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">web-reactive</span> </div>
                                        </td>
                                        <td>
                                            <div class="SimplePara">This module contains core interfaces and classes for Spring Web Reactive model.</div>
                                        </td>
                                    </tr>
                                    <tr class="noclass">
                                        <td>
                                            <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">web-</span> <span id="ITerm17">                          <span class="EmphasisFontCategoryNonProportional">mvc</span> </span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="SimplePara">This module contains all the classes for Spring’s own MVC framework. If you are using a separate MVC framework for your application, you won’t need any of the classes from this JAR file. Spring MVC is covered
                                                in more detail in Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_16_Chapter.html"><span class="RefSource">16</span></a>
                                                </span>.</div>
                                        </td>
                                    </tr>
                                    <tr class="noclass">
                                        <td>
                                            <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">websocket</span> </div>
                                        </td>
                                        <td>
                                            <div class="SimplePara">This module provides support for JSR-356 (Java API for WebSocket).</div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="Section2 RenderAsSection2" id="Sec6">
                        <h3 class="Heading">Choosing Modules for Your <span id="ITerm18">Application                      </span> </h3>
                        <div class="Para" id="Par25">Without a dependency management tool such as Maven or Gradle, choosing which modules to use in your application may be a bit tricky. For example, if you require Spring’s bean factory and DI support only, you still need several
                            modules including <span class="EmphasisFontCategoryNonProportional">spring-core</span>, <span class="EmphasisFontCategoryNonProportional">spring-beans</span>, <span class="EmphasisFontCategoryNonProportional">spring-context</span>,
                            and <span class="EmphasisFontCategoryNonProportional">spring-aop</span>. If you need Spring’s web application support, you then need to further add <span class="EmphasisFontCategoryNonProportional">spring-web</span> and so
                            on. Thanks to build tool features such as Maven’s transitive dependencies support, all required third-party libraries would be included automatically.</div>
                    </div>
                    <div class="Section2 RenderAsSection2" id="Sec7">
                        <h3 class="Heading">Accessing Spring Modules on the <span id="ITerm19">Maven Repository                      </span> </h3>
                        <div class="Para" id="Par26">Founded by Apache Software Foundation, Maven<a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Chapter.html#Fn3" id="Fn3_source"><sup>3</sup></a> has become one of
                            the most popular tools in managing the dependencies for Java applications, from open source to enterprise environments. Maven is a powerful application building, packaging, and dependency management tool. It manages the entire
                            build cycle of an application, from resource processing and compiling to testing and packaging. There also exists a large number of Maven plug-ins for various tasks, such as updating databases and deploying a packaged application
                            to a specific server (for example, Tomcat, JBoss, or WebSphere). As of this writing, the current Maven version is 3.3.9.</div>
                        <div class="Para" id="Par97">Almost all open source projects support distribution of libraries via the Maven repository. The most popular one is the Maven Central repository hosted on Apache, and you can access and search for the existence and related information
                            of an artifact on the Maven Central web site.<a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Chapter.html#Fn4" id="Fn4_source"><sup>4</sup></a> If you download
                            and install Maven into your development machine, you automatically gain access to the Maven Central repository. Some other open source communities (for example, JBoss and Spring by Pivotal) also provide their own Maven repository
                            for their users. However, to be able to access those repositories, you need to add the repository into your Maven’s setting file or in your project’s POM file.</div>
                        <div class="Para" id="Par30">A detailed discussion of <span id="ITerm20">Maven                      </span> is not in the scope of this book, and you can always refer to the online documentation or books that give you a detailed reference to Maven. However,
                            since Maven is widely adopted, it’s worth mentioning the typical structure of the project packaging on the Maven repository.</div>
                        <div class="Para" id="Par31">A group ID, artifact ID, packaging type, and version identify each Maven artifact. For example, for log4j, the group ID is <span class="EmphasisFontCategoryNonProportional">log4j</span>, the artifact ID is <span class="EmphasisFontCategoryNonProportional">log4j</span>,
                            and the packaging type is <span class="EmphasisFontCategoryNonProportional">jar</span>. Under that, different versions are defined. For example, for version 1.2.12, the artifact’s file name becomes <span class="EmphasisFontCategoryNonProportional">log4j-1.2.17.jar</span>                            under the group ID, artifact ID, and version folder. Maven configuration files are written in XML and must respect the Maven standard syntax defined by the <span class="ExternalRef"><a href="http://maven.apache.org/maven-v4_0_0.xsd"><span class="RefSource">                  <span class="EmphasisFontCategoryNonProportional">http://maven.apache.org/maven-v4_0_0.xsd</span>                            </span>
                            </a>
                            </span> schema. The default name of a Maven configuration file for a project is <span class="EmphasisFontCategoryNonProportional">om.xml</span>, and a sample file is shown here:</div>
                        <div class="Para" id="Par32">
                            <div class="ProgramCode" id="PC2">
                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">project</span>
    <span style="font-style:italic">xmlns</span>=<span style="color:#036a07">http://maven.apache.org/POM/4.0.0</span>
    <span style="font-style:italic">xmlns</span>:xsi=<span style="color:#036a07">http://www.w3.org/2001/XMLSchema-instance</span>
    <span style="font-style:italic">xsi</span>:schemaLocation=<span style="color:#036a07">http://maven.apache.org/POM/4.0.0
    http://maven.apache.org/maven-v4_0_0.xsd</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">modelVersion</span>&gt;</span>4.0.0<span style="color:#1c02ff">&lt;/<span style="font-weight:700">modelVersion</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">groupId</span>&gt;</span>com.apress.prospring5.ch02<span style="color:#1c02ff">&lt;/<span style="font-weight:700">groupId</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">artifactId</span>&gt;</span>hello-world<span style="color:#1c02ff">&lt;/<span style="font-weight:700">artifactId</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">packaging</span>&gt;</span>jar<span style="color:#1c02ff">&lt;/<span style="font-weight:700">packaging</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">version</span>&gt;</span>5.0-SNAPSHOT<span style="color:#1c02ff">&lt;/<span style="font-weight:700">version</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">name</span>&gt;</span>hello-world<span style="color:#1c02ff">&lt;/<span style="font-weight:700">name</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">properties</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">project</span>.build.sourceEncoding&gt;</span>UTF-8<span style="color:#1c02ff">&lt;/<span style="font-weight:700">project</span>.build.sourceEncoding&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">spring</span>.version&gt;</span>5.0.0.RELEASE<span style="color:#1c02ff">&lt;/<span style="font-weight:700">spring</span>.version&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">properties</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">dependencies</span>&gt;</span>
        <span style="color:#06f;font-style:italic">&lt;!-- https://mvnrepository.com/artifact/log4j/log4j --&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">dependency</span>&gt;</span>
            <span style="color:#1c02ff">&lt;<span style="font-weight:700">groupId</span>&gt;</span>log4j<span style="color:#1c02ff">&lt;/<span style="font-weight:700">groupId</span>&gt;</span>
            <span style="color:#1c02ff">&lt;<span style="font-weight:700">artifactId</span>&gt;</span>log4j<span style="color:#1c02ff">&lt;/<span style="font-weight:700">artifactId</span>&gt;</span>
            <span style="color:#1c02ff">&lt;<span style="font-weight:700">version</span>&gt;</span>1.2.17<span style="color:#1c02ff">&lt;/<span style="font-weight:700">version</span>&gt;</span>
        <span style="color:#1c02ff">&lt;/<span style="font-weight:700">dependency</span>&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">dependencies</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">build</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">plugins</span>&gt;</span>
            <span style="color:#1c02ff">&lt;<span style="font-weight:700">plugin</span>&gt;</span>

//...

<span style="color:#1c02ff">&lt;/<span style="font-weight:700">plugin</span>&gt;</span>
        <span style="color:#1c02ff">&lt;/<span style="font-weight:700">plugins</span>&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">build</span>&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">project</span>&gt;</span>
</pre></div>
                            </div>
                        </div>
                        <div class="Para" id="Par33">Maven also defines a typical standard project structure, as depicted in Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Chapter.html#Fig1">2-1</a></span>.
                            <div class="Figure" id="Fig1">
                                <div class="MediaObject" id="MO1"><img alt="A315511_5_En_2_Fig1_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Fig1_HTML.jpg" height="193" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Fig1_HTML.jpg" width="240"/></div>
                                <div class="Caption" xml:lang="en">
                                    <div class="CaptionContent"><span class="CaptionNumber">Figure 2-1.</span>
                                        <div class="SimplePara">Typical Maven project <span id="ITerm21">structure                                      </span> </div>
                                    </div>
                        </div>
                    </div>
                </div>
                <div class="Para" id="Par34">The <span class="EmphasisFontCategoryNonProportional">main</span> directory contains the classes (the <span class="EmphasisFontCategoryNonProportional">java</span> directory) and configuration files (the <span class="EmphasisFontCategoryNonProportional">resources</span>                    directory) for the application.</div>
                <div class="Para" id="Par35">The <span class="EmphasisFontCategoryNonProportional">test</span> directory contains the classes (the <span class="EmphasisFontCategoryNonProportional">java</span> directory) and configuration files (the <span class="EmphasisFontCategoryNonProportional">resources</span>                    directory) that are used to test the application from the <span class="EmphasisFontCategoryNonProportional">main</span> directory.</div>
        </div>
        <div class="Section2 RenderAsSection2" id="Sec8">
            <h3 class="Heading">Accessing Spring Modules Using <span id="ITerm22">Gradle                      </span> </h3>
            <div class="Para" id="Par36">The Maven project standard structure and artifact categorization and organization is important because Gradle respects the same rules and even uses the Maven central repository to retrieve artifacts. Gradle is a powerful build tool that has
                given up the bloated XML for configuration and switched to the simplicity and flexibility of Groovy. At the time of writing, the current version of Gradle is 4.0.<a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Chapter.html#Fn5" id="Fn5_source"><sup>5</sup></a> Starting with version 4.<span class="EmphasisTypeItalic">x</span>, the Spring team has switched to using Gradle for the configuration of every Spring product. That is why the source
                code for this book can be built and executed using Gradle too. The default name of a Gradle configuration file for a project is <span class="EmphasisFontCategoryNonProportional">build.gradle</span>. The equivalent of the <span class="EmphasisFontCategoryNonProportional">pom.xml</span>                file depicted earlier (well, one version of it) is shown here:</div>
            <div class="Para" id="Par38">
                <div class="ProgramCode" id="PC3">
                    <div class="LineGroup">
                        <div class="FixedLine"><pre style="background:#fff;color:#000">group <span style="color:#036a07">com.apress.prospring5.ch02</span>
version <span style="color:#036a07">5.0-SNAPSHOT</span>
apply <span style="color:#c5060b;font-weight:700">plugin</span>: <span style="color:#036a07">java</span>
repositories {
    mavenCentral()
}
ext {
    springVersion <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">5.0.0.RELEASE</span>
}
tasks<span style="color:#00f;font-weight:700">.</span>withType(<span style="color:#00f;font-weight:700">JavaCompile</span>) {
    options<span style="color:#00f;font-weight:700">.</span>encoding <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">UTF-8</span>
}
dependencies {
    compile <span style="color:#c5060b;font-weight:700">group</span>: <span style="color:#036a07">log4j</span>,
    <span style="color:#c5060b;font-weight:700">name</span>: <span style="color:#036a07">log4j</span>,
    <span style="color:#c5060b;font-weight:700">version</span>: <span style="color:#036a07">1.2.17</span><span style="color:#00f;font-weight:700">..</span>.
}
</pre></div>
                    </div>
                </div>
            </div>
            <div class="Para" id="Par39">That’s way more readable, right? As you can observe, the artifacts are identified using the group, artifact, and version as previously introduced with Maven, but the property names differ. And since Gradle is not in the scope of this book
                either, the coverage for it must end here.</div>
        </div>
        <div class="Section2 RenderAsSection2" id="Sec9">
            <h3 class="Heading">Using <span id="ITerm24">Spring Documentation                      </span> </h3>
            <div class="Para" id="Par40">One of the aspects of Spring that makes it such a useful framework for developers who are building real applications is its wealth of well-written, accurate documentation. In every release, the Spring Framework’s documentation team works hard
                to ensure that all the documentation is finished and polished by the development team. This means that every feature of Spring is not only fully documented in the Javadoc but is also covered in the Spring reference manual included in every
                distribution. If you haven’t yet familiarized yourself with the Spring Javadoc and the reference manual, do so now. This book is not a replacement for either of these resources; rather, it is a complementary reference, demonstrating how
                to build a Spring-based application from the ground up.</div>
        </div>
        <div class="Section2 RenderAsSection2" id="Sec10">
            <h3 class="Heading">Putting a Spring into Hello World</h3>
            <div class="Para" id="Par41">We hope by this point in the book you appreciate that Spring is a solid, well-supported project that has all the makings of a great tool for application development. However, one thing is missing—we haven’t shown you any code yet. We are sure
                you are dying to see Spring in action, and because we cannot go any longer without getting into the code, let’s do just that. Do not worry if you do not fully understand all the code in this section; we go into much more detail on all
                the topics as we proceed through the book.</div>
        </div>
        <div class="Section2 RenderAsSection2" id="Sec11">
            <h3 class="Heading">Building the Sample <span id="ITerm25">Hello World Application                      </span> </h3>
            <div class="Para" id="Par42">Now, we are sure you are familiar with the traditional Hello World example, but just in case you have been living on the moon for the past 30 years, the following code snippet shows the Java version in all its glory:</div>
            <div class="Para" id="Par43">
                <div class="ProgramCode" id="PC4">
                    <div class="LineGroup">
                        <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2</span>;
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">HelloWorld</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>...<span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Hello World!</span>);
    }
}
</pre></div>
                    </div>
                </div>
            </div>
            <div class="Para" id="Par44">As <span id="ITerm26">examples                      </span> go, this one is pretty simple—it does the job, but it is not very extensible. What if we want to change the message? What if we want to output the message differently, maybe to standard
                error instead of standard output or enclosed in HTML tags rather than as plain text? We are going to redefine the requirements for the sample application and say that it must support a simple, flexible mechanism for changing the message,
                and it must be easy to change the rendering behavior. In the basic Hello World example, you can make both of these changes quickly and easily by just changing the code as appropriate. However, in a bigger application, recompiling takes
                time, and it requires the application to be fully tested again. A better solution is to externalize the message content and read it in at runtime, perhaps from the command-line arguments shown in the following code snippet:</div>
            <div class="Para" id="Par45">
                <div class="ProgramCode" id="PC5">
                    <div class="LineGroup">
                        <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2</span>;
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">HelloWorldWithCommandLine</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>...<span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">if</span> (args<span style="color:#00f;font-weight:700">.</span>length <span style="color:#00f;font-weight:700">&gt;</span> <span style="color:#0000cd">0</span>) {
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(args[<span style="color:#0000cd">0</span>]);
        } <span style="color:#00f;font-weight:700">else</span> {
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Hello World!</span>);
        }
    }
}
</pre></div>
                    </div>
                </div>
            </div>
            <div class="Para" id="Par46">This example accomplishes what we wanted—we can now change the message without changing the code. However, there is still a problem with this application: the component responsible for rendering the message is also responsible for obtaining
                the message. Changing how the message is obtained means changing the code in the renderer. Add to this the fact that we still cannot change the renderer easily; doing so means changing the class that launches the application.</div>
            <div class="Para" id="Par47">If we take this application a step further (away from the basics of Hello World), a better solution is to refactor the rendering and message retrieval logic into separate components. Plus, if we really want to make your application flexible,
                we should have these components implement interfaces and define the interdependencies between the components and the launcher using these interfaces. By refactoring the message retrieval logic, we can define a simple <span class="EmphasisFontCategoryNonProportional">MessageProvider</span>                interface with a single method, <span class="EmphasisFontCategoryNonProportional">getMessage()</span>, as shown in the following code snippet:</div>
        <div class="Para" id="Par48">
            <div class="ProgramCode" id="PC6">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled</span>;
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">MessageProvider</span> {
    <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getMessage</span>();
}
</pre></div>
                </div>
            </div>
        </div>
        <div class="Para" id="Par49">The <span id="ITerm27">            <span class="EmphasisFontCategoryNonProportional">MessageRenderer</span> interface </span> is implemented by all components that can render messages, and such a component is depicted in the following code snippet:</div>
        <div class="Para" id="Par50">
            <div class="ProgramCode" id="PC7">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">MessageRenderer</span> {
    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">render</span>();
    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setMessageProvider</span>(<span style="color:#00f;font-weight:700">MessageProvider</span> <span style="font-style:italic">provider</span>);
    <span style="color:#00f;font-weight:700">MessageProvider</span> <span style="color:#0000a2;font-weight:700">getMessageProvider</span>();
}
</pre></div>
                </div>
            </div>
    </div>
    <div class="Para" id="Par51">As you can see, the <span class="EmphasisFontCategoryNonProportional">MessageRenderer</span> interface declares a method, <span class="EmphasisFontCategoryNonProportional">render()</span>, and also a JavaBean-style method, <span class="EmphasisFontCategoryNonProportional">setMessageProvider()</span>.
        Any <span class="EmphasisFontCategoryNonProportional">MessageRenderer</span> implementations are decoupled from message retrieval and delegate that responsibility to the <span class="EmphasisFontCategoryNonProportional">MessageProvider</span>        instance with which they are supplied. Here, <span class="EmphasisFontCategoryNonProportional">MessageProvider</span> is a dependency of <span class="EmphasisFontCategoryNonProportional">MessageRenderer</span>. Creating simple implementations
        of these interfaces is easy, as shown in the following code snippet:</div>
    <div class="Para" id="Par52">
        <div class="ProgramCode" id="PC8">
            <div class="LineGroup">
                <div class="FixedLine">
                  <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled</span>;
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">HelloWorldMessageProvider</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">MessageProvider</span> {
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getMessage</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">Hello World!</span>;
    }
}</pre></div>
            </div>
        </div>
    </div>
    <div class="Para" id="Par53">You can see that we have created a simple <span class="EmphasisFontCategoryNonProportional">MessageProvider</span> that always returns “Hello World!” as the message. The <span id="ITerm29">            <span class="EmphasisFontCategoryNonProportional">StandardOutMessageRenderer</span>        class </span> shown next is just as simple:</div>
    <div class="Para" id="Par54">
        <div class="ProgramCode" id="PC9">
            <div class="LineGroup">
                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">StandardOutMessageRenderer</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">MessageRenderer</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">MessageProvider</span> messageProvider;

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">render</span>() {
        <span style="color:#00f;font-weight:700">if</span> (messageProvider <span style="color:#00f;font-weight:700">==</span> <span style="color:#585cf6;font-weight:700">null</span>) {
            <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">RuntimeException</span>(<span style="color:#036a07">You must set the property messageProvider of class:</span> <span style="color:#00f;font-weight:700">+</span> <span style="color:#00f;font-weight:700">StandardOutMessageRenderer</span><span style="color:#00f;font-weight:700">.</span>class<span style="color:#00f;font-weight:700">.</span>getName());
        }
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(messageProvider<span style="color:#00f;font-weight:700">.</span>getMessage());
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setMessageProvider</span>(<span style="color:#00f;font-weight:700">MessageProvider</span> <span style="font-style:italic">provider</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>messageProvider <span style="color:#00f;font-weight:700">=</span> provider;
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">MessageProvider</span> <span style="color:#0000a2;font-weight:700">getMessageProvider</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>messageProvider;
    }
}
</pre></div>
            </div>
        </div>
    </div>
    <div class="Para ParaOneEmphasisChild" id="Par55">Now all that remains is to rewrite the <span class="EmphasisFontCategoryNonProportional">main()</span> method of the entry class.</div>
    <div class="Para" id="Par56">
        <div class="ProgramCode" id="PC10">
            <div class="LineGroup">
                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled</span>;
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">HelloWorldDecoupled</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>...<span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">MessageRenderer</span> mr <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">StandardOutMessageRenderer</span>();
        <span style="color:#00f;font-weight:700">MessageProvider</span> mp <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HelloWorldMessageProvider</span>();
        mr<span style="color:#00f;font-weight:700">.</span>setMessageProvider(mp);
        mr<span style="color:#00f;font-weight:700">.</span>render();
    }
}
</pre></div>
            </div>
        </div>
    </div>
    <div class="Para" id="Par57">Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Chapter.html#Fig2">2-2</a></span> depicts the abstract schema of the application built so far.
        <div class="Figure" id="Fig2">
            <div class="MediaObject" id="MO2"><img alt="A315511_5_En_2_Fig2_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Fig2_HTML.jpg" height="295" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Fig2_HTML.jpg" width="570"/></div>
            <div class="Caption" xml:lang="en">
                <div class="CaptionContent"><span class="CaptionNumber">Figure 2-2.</span>
                    <div class="SimplePara">A little more decoupled <span id="ITerm31">Hello World application                                      </span> </div>
                </div>
        </div>
    </div>
    </div>
    <div class="Para" id="Par58">The code here is fairly simple. We instantiate instances of <span id="ITerm32">                <span class="EmphasisFontCategoryNonProportional">HelloWorldMessageProvider</span> </span> and <span id="ITerm33">                <span class="EmphasisFontCategoryNonProportional">StandardOutMessageRenderer</span>        </span>, although the declared types are <span class="EmphasisFontCategoryNonProportional">MessageProvider</span> and <span class="EmphasisFontCategoryNonProportional">MessageRenderer</span>, respectively. This is because we need to interact only
        with the methods provided by the interface in the programming logic, and <span class="EmphasisFontCategoryNonProportional">HelloWorldMessageProvider</span> and <span class="EmphasisFontCategoryNonProportional">StandardOutMessageRenderer</span>        already implemented those interfaces, respectively. Then, we pass <span class="EmphasisFontCategoryNonProportional">MessageProvider</span> to <span class="EmphasisFontCategoryNonProportional">MessageRenderer</span> and invoke <span class="EmphasisFontCategoryNonProportional">MessageRenderer.render()</span>.
        If we compile and run this program, we get the expected “Hello World!” output. Now, this example is more like what we are looking for, but there is one small problem. Changing the implementation of either the <span class="EmphasisFontCategoryNonProportional">MessageRenderer</span>        or <span class="EmphasisFontCategoryNonProportional">MessageProvider</span> interface means a change to the code. To get around this, we can create a simple factory class that reads the implementation class names from a properties file and instantiates
        them on behalf of the application, as shown here:</div>
    <div class="Para" id="Par59">
        <div class="ProgramCode" id="PC11">
            <div class="LineGroup">
                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Properties</span>;
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">MessageSupportFactory</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">MessageSupportFactory</span> instance;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Properties</span> props;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">MessageRenderer</span> renderer;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">MessageProvider</span> provider;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#0000a2;font-weight:700">MessageSupportFactory</span>() {
        props <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Properties</span>();
        <span style="color:#00f;font-weight:700">try</span> {
            props<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>getClass()<span style="color:#00f;font-weight:700">.</span>getResourceAsStream(<span style="color:#036a07">/msf.properties</span>));
            <span style="color:#00f;font-weight:700">String</span> rendererClass <span style="color:#00f;font-weight:700">=</span> props<span style="color:#00f;font-weight:700">.</span>getProperty(<span style="color:#036a07">renderer.class</span>);
            <span style="color:#00f;font-weight:700">String</span> providerClass <span style="color:#00f;font-weight:700">=</span> props<span style="color:#00f;font-weight:700">.</span>getProperty(<span style="color:#036a07">provider.class</span>);
            renderer <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">MessageRenderer</span>) <span style="color:#00f;font-weight:700">Class</span><span style="color:#00f;font-weight:700">.</span>forName(rendererClass)<span style="color:#00f;font-weight:700">.</span>newInstance();
            provider <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">MessageProvider</span>) <span style="color:#00f;font-weight:700">Class</span><span style="color:#00f;font-weight:700">.</span>forName(providerClass)<span style="color:#00f;font-weight:700">.</span>newInstance();
        } <span style="color:#00f;font-weight:700">catch</span>(<span style="color:#00f;font-weight:700">Exception</span> ex) {
            ex<span style="color:#00f;font-weight:700">.</span>printStackTrace();
        }
    }
    <span style="color:#00f;font-weight:700">static</span> {
        instance <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">MessageSupportFactory</span>();
    }
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">MessageSupportFactory</span> <span style="color:#0000a2;font-weight:700">getInstance</span>() {
        <span style="color:#00f;font-weight:700">return</span> instance;
    }
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">MessageRenderer</span> <span style="color:#0000a2;font-weight:700">getMessageRenderer</span>() {
        <span style="color:#00f;font-weight:700">return</span> renderer;
    }
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">MessageProvider</span> <span style="color:#0000a2;font-weight:700">getMessageProvider</span>() {
        <span style="color:#00f;font-weight:700">return</span> provider;
    }
}
</pre></div>
            </div>
        </div>
    </div>
    <div class="Para" id="Par60">The implementation here is trivial and naive, the error handling is simplistic, and the name of the configuration file is hard-coded, but we already have a substantial amount of code. The <span id="ITerm34">configuration file                      </span>        for this class is quite simple.</div>
    <div class="Para" id="Par61">
        <div class="ProgramCode" id="PC12">
            <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled</span>;
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">HelloWorldDecoupledWithFactory</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>...<span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">MessageRenderer</span> mr <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">MessageSupportFactory</span><span style="color:#00f;font-weight:700">.</span>getInstance()<span style="color:#00f;font-weight:700">.</span>getMessageRenderer();
        <span style="color:#00f;font-weight:700">MessageProvider</span> mp <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">MessageSupportFactory</span><span style="color:#00f;font-weight:700">.</span>getInstance()<span style="color:#00f;font-weight:700">.</span>getMessageProvider();
        mr<span style="color:#00f;font-weight:700">.</span>setMessageProvider(mp);
        mr<span style="color:#00f;font-weight:700">.</span>render();
    }
}
</pre></div>
            </div>
        </div>
    </div>
    <div class="Para" id="Par64">Before we move on to see how we can introduce Spring into this application, let’s quickly recap what we have done. Starting with the simple Hello World application, we defined two additional requirements that the application must fulfill. The first
        was that changing the message should be simple, and the second was that changing the rendering mechanism should also be simple. To meet these requirements, we used two interfaces: <span class="EmphasisFontCategoryNonProportional">MessageProvider</span>        and <span class="EmphasisFontCategoryNonProportional">MessageRenderer</span>. The <span id="ITerm35">            <span class="EmphasisFontCategoryNonProportional">MessageRenderer</span> interface </span> depends on an implementation of the
        <span class="EmphasisFontCategoryNonProportional">MessageProvider</span> interface to be able to retrieve a message to render. Finally, we added a simple factory class to retrieve the names of the implementation classes and instantiate them as applicable.</div>
    </div>
    <div class="Section2 RenderAsSection2" id="Sec12">
        <h3 class="Heading">Refactoring with Spring</h3>
        <div class="Para" id="Par65">The final example shown earlier met the goals laid out for the sample application, but there are still problems with it. The first problem is that we had to write a lot of glue code to piece the application together, while at the same time keeping
            the components loosely coupled. The second problem is that we still had to provide the implementation of <span class="EmphasisFontCategoryNonProportional">MessageRenderer</span> with an instance of <span class="EmphasisFontCategoryNonProportional">MessageProvider</span>            manually. We can solve both of these problems by using Spring. To solve the problem of too much glue code, we can completely remove the <span class="EmphasisFontCategoryNonProportional">MessageSupportFactory</span> class from the application
            and replace it with a Spring interface, <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>. Don’t worry too much about this interface; for now, it is enough to know that this interface is used by Spring for storing
            all the environmental information with regard to an application being managed by Spring. This interface extends another interface, <span id="ITerm36">                <span class="EmphasisFontCategoryNonProportional">ListableBeanFactory</span>            </span>, which acts as the provider for any Spring-managed bean instance.</div>
        <div class="Para" id="Par66">
            <div class="ProgramCode" id="PC14">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.ApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.ClassPathXmlApplicationContext</span>;
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">HelloWorldSpringDI</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">ApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ClassPathXmlApplicationContext</span>(<span style="color:#036a07">spring/app-context.xml</span>);
        <span style="color:#00f;font-weight:700">MessageRenderer</span> mr <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">renderer</span>, <span style="color:#00f;font-weight:700">MessageRenderer</span><span style="color:#00f;font-weight:700">.</span>class);
        mr<span style="color:#00f;font-weight:700">.</span>render();
    }
}
</pre></div>
                </div>
            </div>
        </div>
        <div class="Para" id="Par67">In the previous code snippet, you can see that the <span class="EmphasisFontCategoryNonProportional">main()</span> method obtains an instance of <span class="EmphasisFontCategoryNonProportional">ClassPathXmlApplicationContext</span> (the application
            configuration information is loaded from the file <span class="EmphasisFontCategoryNonProportional">spring/app-context.xml</span> in the project’s classpath), typed as <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>,
            and from this, it obtains the <span class="EmphasisFontCategoryNonProportional">MessageRenderer</span> instances by using the <span class="EmphasisFontCategoryNonProportional">ApplicationContext.getBean()</span> method. Don’t worry too much
            about the <span class="EmphasisFontCategoryNonProportional">getBean()</span> method for now; just know that this method reads the application configuration (in this case, an XML file), initializes Spring’s <span id="ITerm37">            <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>            environment </span>, and then returns the configured bean<a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Chapter.html#Fn6" id="Fn6_source"><sup>6</sup></a> instance. This
            XML file (<span class="EmphasisFontCategoryNonProportional">app-context.xml</span>) serves the same purpose as the one used for <span class="EmphasisFontCategoryNonProportional">MessageSupportFactory</span>.</div>
        <div class="Para" id="Par69">
            <div class="ProgramCode" id="PC15">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#68685b">&lt;?<span style="color:#888">xml</span><span style="color:#888"> version</span>=<span style="color:#888">1.0</span><span style="color:#888"> encoding</span>=<span style="color:#888">UTF-8</span>?&gt;</span>
<span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> <span style="font-style:italic">xmlns</span>=<span style="color:#036a07">http://www.springframework.org/schema/beans</span>
    <span style="font-style:italic">xmlns</span>:xsi=<span style="color:#036a07">http://www.w3.org/2001/XMLSchema-instance</span>
    <span style="font-style:italic">xmlns</span>:p=<span style="color:#036a07">http://www.springframework.org/schema/p</span>
    <span style="font-style:italic">xsi</span>:schemaLocation=<span style="color:#036a07">http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd</span>&gt;</span>
  <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">provider</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch2.decoupled.HelloWorldMessageProvider</span>/&gt;</span>
  <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">renderer</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch2.decoupled.StandardOutMessageRenderer</span>
        <span style="font-style:italic">p</span>:messageProvider-ref=<span style="color:#036a07">provider</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
                </div>
            </div>
        </div>
        <div class="Para" id="Par70">The previous file shows a typical Spring <span id="ITerm38">            <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> configuration </span>. First, Spring’s namespaces are declared, and the default namespace is
            <span class="EmphasisFontCategoryNonProportional">beans</span>. The <span class="EmphasisFontCategoryNonProportional">beans</span> namespace is used to declare the beans that need to be managed by Spring and to declare their dependency requirements (for the preceding example, the renderer
                bean’s <span class="EmphasisFontCategoryNonProportional">messageProvider</span> property is referencing the provider bean). Spring will resolve and inject those dependencies.</div>
        <div class="Para" id="Par71">Afterward, we declare the bean with the ID <span class="EmphasisFontCategoryNonProportional">provider</span> and the corresponding implementation class. When Spring sees this bean definition during the <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>            initialization, it will instantiate the class and store it with the specified ID.</div>
        <div class="Para" id="Par72">Then the <span class="EmphasisFontCategoryNonProportional">renderer</span> bean is declared, with the corresponding implementation class. Remember that this bean depends on the <span id="ITerm39">            <span class="EmphasisFontCategoryNonProportional">MessageProvider</span>            interface </span> for getting the message to render. To inform Spring about the DI requirement, we use the <span class="EmphasisFontCategoryNonProportional">p</span> namespace attribute. The tag attribute <span class="EmphasisFontCategoryNonProportional">p:messageProvider-ref=&quot;provider&quot;</span>            tells Spring that the bean’s property, <span class="EmphasisFontCategoryNonProportional">messageProvider</span>, should be injected with another bean. The bean to be injected into the property should reference a bean with the ID <span class="EmphasisFontCategoryNonProportional">provider</span>.
            When Spring sees this definition, it will instantiate the class, look up the bean’s property named <span class="EmphasisFontCategoryNonProportional">messageProvider</span>, and inject it with the bean instance with the ID <span class="EmphasisFontCategoryNonProportional">provider</span>.</div>
        <div class="Para" id="Par73">As you can see, upon the initialization of Spring’s <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>, the <span class="EmphasisFontCategoryNonProportional">main()</span> method now just obtains the <span class="EmphasisFontCategoryNonProportional">MessageRenderer</span>            bean by using its type-safe <span id="ITerm40">            <span class="EmphasisFontCategoryNonProportional">getBean()</span> method </span> (passing in the ID and the expected return type, which is the <span class="EmphasisFontCategoryNonProportional">MessageRenderer</span>            interface) and calls <span class="EmphasisFontCategoryNonProportional">render()</span>; Spring has created the <span class="EmphasisFontCategoryNonProportional">MessageProvider</span> implementation and injected it into the <span class="EmphasisFontCategoryNonProportional">MessageRenderer</span>            implementation. Notice that we didn’t have to make any changes to the classes that are being wired together using Spring. In fact, these classes have no reference to Spring and are completely oblivious to its existence. However, this isn’t
            always the case. Your classes can implement Spring-specified interfaces to interact in a variety of ways with the DI container.</div>
    <div class="Para ParaOneEmphasisChild" id="Par74">With your new Spring configuration and modified <span class="EmphasisFontCategoryNonProportional">main()</span> method, let’s see it in action. Using Gradle, enter the following commands into your terminal to build the project and the root of your
        source code:</div>
    <div class="Para" id="Par75">
        <div class="ProgramCode" id="PC16">
            <div class="FixedLine">gradle clean build copyDependencies</div>
        </div>
    </div>
    <div class="Para" id="Par76">The only required Spring module to be declared in your configuration file is <span class="EmphasisFontCategoryNonProportional">spring-context</span>. Gradle will automatically bring in any transitive dependencies required for this module. In Figure
        <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Chapter.html#Fig3">2-3</a></span> you can see the transitive dependencies of <span id="ITerm41">                <span class="EmphasisFontCategoryNonProportional">spring-context.jar</span>        </span>.
        <div class="Figure" id="Fig3">
            <div class="MediaObject" id="MO3"><img alt="A315511_5_En_2_Fig3_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Fig3_HTML.jpg" height="173" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Fig3_HTML.jpg" width="440"/></div>
            <div class="Caption" xml:lang="en">
                <div class="CaptionContent"><span class="CaptionNumber">Figure 2-3.</span>
                    <div class="SimplePara">spring-context and its transitive dependencies depicted in IntelliJ IDEA</div>
                </div>
        </div>
    </div>
    </div>
    <div class="Para" id="Par77">The previous command will build the project from scratch, deleting previously generated files, and copy all required dependencies in the same location where the resulting artifact is placed, under <span class="EmphasisFontCategoryNonProportional">build/libs</span>.
        This path value will also be used as an appending prefix to the library files added to <span class="EmphasisFontCategoryNonProportional">MANIFEST.MF</span> when building the JAR. See the Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Chapter.html"><span class="RefSource">2</span></a>
        </span>
        source code (available on the Apress web site), specifically the Gradle <span class="EmphasisFontCategoryNonProportional">hellor-world/build.properties</span> file, for more information if you are unfamiliar with the Gradle JAR building configuration
        and process. Finally, to run the Spring DI sample, enter the following commands:</div>
    <div class="Para" id="Par78">
        <div class="ProgramCode" id="PC17">
            <div class="FixedLine">cd build/libs; java -jar hello-world-5.0-SNAPSHOT.jar</div>
        </div>
    </div>
    <div class="Para" id="Par79">At this point, you should see some log statements generated by the Spring container’s startup process followed by the expected Hello World output.</div>
    <div class="Section3 RenderAsSection3" id="Sec13">
        <h4 class="Heading">Spring Configuration Using Annotations</h4>
        <div class="Para" id="Par80">Starting with Spring 3.0, XML configuration files are no longer necessary when developing a Spring application. They can be replaced with annotations and configuration classes. <span id="ITerm42">Configuration classes                          </span>            are Java classes annotated with <span class="EmphasisFontCategoryNonProportional">@Configuration</span> that contain bean definitions (methods annotated with <span class="EmphasisFontCategoryNonProportional">@Bean</span>) or are configured
            themselves to identify bean definitions in the application by annotating them with <span class="EmphasisFontCategoryNonProportional">@ComponentScanning</span>. The <span id="ITerm43">equivalent                           </span>of the
            <span class="EmphasisFontCategoryNonProportional">app-context.xml</span> file presented earlier is shown here:</div>
        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.annotated</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.HelloWorldMessageProvider</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageProvider</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageRenderer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.StandardOutMessageRenderer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Bean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Configuration</span>;

@<span style="color:#00f;font-weight:700">Configuration</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">HelloWorldConfiguration</span> {
    <span style="color:#06f;font-style:italic">// equivalent to &lt;bean id=&quot;provider&quot; class=&quot;..&quot;/&gt;</span>
    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">MessageProvider</span> <span style="color:#0000a2;font-weight:700">provider</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HelloWorldMessageProvider</span>();
    }

    <span style="color:#06f;font-style:italic">// equivalent to  &lt;bean id=&quot;renderer&quot; class=&quot;..&quot;/&gt;</span>
    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">MessageRenderer</span> <span style="color:#0000a2;font-weight:700">renderer</span>() {
        <span style="color:#00f;font-weight:700">MessageRenderer</span> renderer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">StandardOutMessageRenderer</span>();
        renderer<span style="color:#00f;font-weight:700">.</span>setMessageProvider(provider());
        <span style="color:#00f;font-weight:700">return</span> renderer;
    }
}
</pre>
        <div class="Para" id="Par82">The <span class="EmphasisFontCategoryNonProportional">main()</span> method has to be modified to replace <span id="ITerm44">                  <span class="EmphasisFontCategoryNonProportional">ClassPathXmlApplicationContext</span> </span> with
            another <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> implementation that knows how to read bean definitions from configuration classes. That class is <span class="EmphasisFontCategoryNonProportional">AnnotationConfigApplicationContext</span>.</div>
        <div class="Para" id="Par83">
            <div class="ProgramCode" id="PC19">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.annotated</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageRenderer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.ApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.AnnotationConfigApplicationContext</span>;
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">HelloWorldSpringAnnotated</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>...<span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">ApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">HelloWorldConfiguration</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">MessageRenderer</span> mr <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">renderer</span>, <span style="color:#00f;font-weight:700">MessageRenderer</span><span style="color:#00f;font-weight:700">.</span>class);
        mr<span style="color:#00f;font-weight:700">.</span>render();
    }
}
</pre></div>
            </div>
    </div>
    </div>
    <div class="Para" id="Par84">This is just one version of <span id="ITerm45">configuration                          </span> using annotations and configuration classes. Without XML, things get pretty flexible when it comes to Spring configuration. You’ll learn more about that
        later in this book, but the focus when it comes to configuration is on Java configuration and annotations.</div>
    <div class="Para ParaTypeImportant" id="Par85"> <img alt="A315511_5_En_2_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Figa_HTML.jpg" width="30"/>        Some of the interfaces and classes defined in the Hello World sample may be used in later chapters. Although we showed the full source code in this sample, future chapters may show condensed versions of code to be less verbose, especially in the
        case of incremental code modifications. The code has been organized a little, and all classes that can be used in Spring future examples were placed under the <span class="EmphasisFontCategoryNonProportional">com.apress.prospring5.ch2.decoupled</span>        and <span class="EmphasisFontCategoryNonProportional">com.apress.prospring5.ch2.annotated</span> packages, but keep in mind in a real application you would want to layer your code appropriately.</div>
    </div>
    </div>
    </div>
    <div class="Section1 RenderAsSection1" id="Sec14">
        <h2 class="Heading">Summary</h2>
        <div class="Para" id="Par86">In this chapter, we presented you with all the background information you need to get up and running with Spring. We showed you how to get started with Spring through dependency management systems and the current development version directly from
            GitHub. We described how Spring is packaged and the dependencies you need for each of Spring’s features. Using this information, you can make informed decisions about which of the Spring JAR files your application needs and which dependencies
            you need to distribute with your application. Spring’s documentation, guides, and test suite provide Spring users with an ideal base from which to start their Spring development, so we took some time to investigate what is made available by
            Spring. Finally, we presented an example of how, using Spring DI, it is possible to make the traditional Hello World a loosely coupled, extendable message-rendering application. The important thing to realize is that we only scratched the
            surface of Spring DI in this chapter, and we barely made a dent in Spring as a whole. In the next chapter, we take look at IoC and DI in Spring.</div>
    </div>
    <div class="FootnoteSection">
        <div class="Heading">Footnotes</div>
        <div class="Footnote" id="Fn1"><span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Chapter.html#Fn1_source">1</a></span>
            <div class="FootnoteParas">
                <div class="Para" id="Par3">Find Spring’s GitHub repository at <span class="ExternalRef"><a href="http://github.com/spring-projects/spring-framework"><span class="RefSource">                        <span class="EmphasisFontCategoryNonProportional">http://github.com/spring-projects/spring-framework</span>                    </span>
                    </a>
                    </span>.</div>
            </div>
            <div class="ClearBoth"> </div>
        </div>
        <div class="Footnote" id="Fn2"><span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Chapter.html#Fn2_source">2</a></span>
            <div class="FootnoteParas">
                <div class="Para" id="Par12"> <span class="ExternalRef"><a href="http://projects.spring.io/spring-framework"><span class="RefSource">                      <span class="EmphasisFontCategoryNonProportional">http://projects.spring.io/spring-framework</span> </span>
                    </a>
                    </span>
                </div>
            </div>
            <div class="ClearBoth"> </div>
        </div>
        <div class="Footnote" id="Fn3"><span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Chapter.html#Fn3_source">3</a></span>
            <div class="FootnoteParas">
                <div class="Para" id="Par27"> <span class="ExternalRef"><a href="http://maven.apache.org/"><span class="RefSource">                      <span class="EmphasisFontCategoryNonProportional">http://maven.apache.org</span> </span>
                    </a>
                    </span>
                </div>
            </div>
            <div class="ClearBoth"> </div>
        </div>
        <div class="Footnote" id="Fn4"><span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Chapter.html#Fn4_source">4</a></span>
            <div class="FootnoteParas">
                <div class="Para" id="Par28"> <span class="ExternalRef"><a href="http://search.maven.org/"><span class="RefSource">                      <span class="EmphasisFontCategoryNonProportional">http://search.maven.org</span> </span>
                    </a>
                    </span>
                </div>
            </div>
            <div class="ClearBoth"> </div>
        </div>
        <div class="Footnote" id="Fn5"><span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Chapter.html#Fn5_source">5</a></span>
            <div class="FootnoteParas">
                <div class="Para" id="Par37">On the official project site you can find detailed instructions on how to download, install, and configure Gradle for development: <span class="ExternalRef"><a href="https://gradle.org/install"><span class="RefSource">                      <span class="EmphasisFontCategoryNonProportional">https://gradle.org/install</span>                    </span>
                    </a>
                    </span>.</div>
            </div>
            <div class="ClearBoth"> </div>
        </div>
        <div class="Footnote" id="Fn6"><span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Chapter.html#Fn6_source">6</a></span>
            <div class="FootnoteParas">
                <div class="Para ParaOneEmphasisChild" id="Par68">A <span class="EmphasisTypeItalic">bean</span> is what an instance of a class is called in Spring.</div>
            </div>
            <div class="ClearBoth"> </div>
        </div>
    </div>
    </div>
    <div class="annotator-outer annotator-viewer viewer annotator-hide"> </div>
    </div>
    </div>
    </section>
    </div>
    </div>



<hr/>
<!--if IE]><![endif]-->

<!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"            itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"data-offline-url="/"data-url="/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Chapter.html"data-csrf-cookie="csrfsafari"data-highlight-privacy=""  data-user-id="3866890"  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"  data-username="levinxccai"  data-account-type="B2B"    data-activated-trial-date="11/06/2017"  data-archive="9781484228081"  data-publishers="Apress"  data-htmlfile-name="A315511_5_En_3_Chapter.html"  data-epub-title="Pro Spring 5: An In-Depth Guide to the Spring Framework and Its Tools" data-debug=0 data-testing=0><![endif]-->
<!--if gt IE 8]><!-->

<!--![endif]-->




<a name="4_"></a>

    <div class="application" id="container" style="height: auto;">
      <div class="js-toc">
        <section role="document">
          <div id="sbo-rt-content" style="max-width:72.5em; transform: none;">
            <div class="annotator-wrapper"><!--egin Abstract-->
                    <div class="MainTitleSection">
                        <h1 class="ChapterTitle" xml:lang="en">3. Introducing IoC and DI in Spring</h1>
                    </div>
                    <div class="AuthorGroup">
                        <div class="AuthorNames"><span class="Author"><span class="AuthorName">Iuliana Cosmina</span><sup>1 <span class="ContactIcon"></span></sup>, </span><span class="Author"><span class="AuthorName">Rob Harrop</span><sup>2</sup>, </span>
                            <span class="Author"><span class="AuthorName">Chris Schaefer</span><sup>3</sup> and </span><span class="Author"><span class="AuthorName">Clarence Ho</span><sup>4</sup></span>
                        </div>
                        <div class="Affiliations">
                            <div class="Affiliation" id="Aff5"><span class="AffiliationNumber">(1)</span>
                                <div class="AffiliationText">Sibiu, Sibiu, Romania</div>
                            </div>
                            <div class="Affiliation" id="Aff6"><span class="AffiliationNumber">(2)</span>
                                <div class="AffiliationText">Reddish, UK</div>
                            </div>
                            <div class="Affiliation" id="Aff7"><span class="AffiliationNumber">(3)</span>
                                <div class="AffiliationText">Venice, Florida, USA</div>
                            </div>
                            <div class="Affiliation" id="Aff8"><span class="AffiliationNumber">(4)</span>
                                <div class="AffiliationText">Hong Kong, China</div>
                            </div>
                            <div class="ClearBoth"> </div>
                        </div>
                    </div>
                    <!--nd Abstract-->
                    <div class="Fulltext">
                        <div class="Para" id="Par1">In Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Chapter.html"><span class="RefSource">2</span></a>
                            </span>, we covered the basic principles of inversion of control. Practically, dependency injection is a specialized form of IoC, although you will often find that the two terms are used interchangeably. In this chapter, we give you
                            a much more detailed look at IoC and DI, formalizing the relationship between the two concepts and looking in great detail at how Spring fits into the picture.</div>
                        <div class="Para" id="Par2">After defining both and looking at Spring’s relationship with them, we explore the concepts that are essential to Spring’s implementation of DI. This chapter covers only the basics of Spring’s DI implementation; we discuss more
                            advanced DI features in Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Chapter.html"><span class="RefSource">4</span></a>
                            </span>. More specifically, this chapter covers the following topics:
                            <div class="UnorderedList">
                                <ul class="UnorderedListMarkBullet">
                                    <li>
                                        <div class="Para ParaOneEmphasisChild" id="Par3"> <span class="EmphasisTypeItalic">Inversion of control concepts</span>: In this section, we discuss the various kinds of IoC, including dependency injection and dependency lookup. This section presents the differences
                                            between the various IoC approaches as well as the pros and cons of each.</div>
                                    </li>
                                    <li>
                                        <div class="Para ParaOneEmphasisChild" id="Par4"> <span class="EmphasisTypeItalic">Inversion of control in Spring</span>: This section looks at IoC capabilities available in Spring and how they are implemented. In particular, you’ll see the dependency injection
                                            services that Spring offers, including setter, constructor, and Method Injection.</div>
                                    </li>
                                    <li>
                                        <div class="Para" id="Par5"> <span class="EmphasisTypeItalic">Dependency injection in Spring</span>: This section covers Spring’s implementation of the IoC container. For bean definition and DI requirements, <span class="EmphasisFontCategoryNonProportional">BeanFactory</span>                                            is the main interface an application interacts with. However, other than the first few, the remainder of the sample code provided in this chapter focuses on using Spring’s <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>                                            interface, which is an extension of <span class="EmphasisFontCategoryNonProportional">BeanFactory</span> and provides much more powerful features. We cover the difference between <span class="EmphasisFontCategoryNonProportional">BeanFactory</span>                                            and <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> in later sections.</div>
                                    </li>
                                    <li>
                                        <div class="Para" id="Par6"> <span class="EmphasisTypeItalic">Configuring the Spring application context</span>: The final part of this chapter focuses on using the XML and annotation approaches for <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>                                            configuration. Groovy and Java configuration are further discussed in Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Chapter.html"><span class="RefSource">4</span></a>
                                            </span>. This section starts with a discussion of DI configuration and moves on to present additional services provided by <span class="EmphasisFontCategoryNonProportional">BeanFactory</span> such as bean inheritance,
                                            life-cycle management, and autowiring.</div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="Section1 RenderAsSection1" id="Sec1">
                            <h2 class="Heading">Inversion of Control and Dependency Injection</h2>
                            <div class="Para" id="Par7">At its core, IoC, and therefore DI, aims to offer a simpler mechanism for provisioning component dependencies (often referred to as an object’s <span class="EmphasisTypeItalic">collaborators</span>) and managing these dependencies
                                throughout their life cycles. A component that requires certain dependencies is often referred to as the <span class="EmphasisTypeItalic">dependent object</span> or, in the case of IoC, the <span class="EmphasisTypeItalic">target</span>.
                                In general, IoC can be decomposed into two subtypes: dependency injection and dependency lookup. These subtypes are further decomposed into concrete implementations of the IoC services. From this definition, you can clearly
                                see that when we are talking about DI, we are always talking about IoC, but when we are talking about IoC, we are not always talking about DI (for example, dependency lookup is also a form of IoC).</div>
                        </div>
                        <div class="Section1 RenderAsSection1" id="Sec2">
                            <h2 class="Heading">Types of Inversion of Control</h2>
                            <div class="Para" id="Par8">You may be wondering why there are two types of IoC and why these types are split further into different implementations. There seems to be no clear answer to this question; certainly the different types provide a level of
                                flexibility, but to us, it seems that IoC is more of a mixture of old and new ideas. The two types of IoC represent this. Dependency lookup is a much more traditional approach, and at first glance, it seems more familiar
                                to Java programmers. Dependency injection, although it appears counterintuitive at first, is actually much more flexible and usable than dependency lookup. With dependency lookup–style IoC, a component must acquire a reference
                                to a dependency, whereas with dependency injection, the dependencies are injected into the component by the IoC container. Dependency lookup comes in two types: dependency pull and <span id="ITerm1">contextualized dependency lookup (CDL)        </span>.
                                Dependency injection also has two common flavors: constructor and setter dependency injection.</div>
                            <div class="Para ParaTypeImportant" id="Par9"><img alt="A315511_5_En_3_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" width="30"/>                                For the discussions in this section, we are not concerned with how the fictional IoC container comes to know about all the different dependencies, just that at some point, it performs the actions described for each mechanism.</div>
                            <div class="Section2 RenderAsSection2" id="Sec3">
                                <h3 class="Heading">Dependency Pull</h3>
                                <div class="Para" id="Par10">To a Java developer, dependency pull is the most familiar types of IoC. In <span id="ITerm2">dependency pull                      </span>, dependencies are pulled from a registry as required. Anyone who has ever written
                                    code to access an EJB (2.1 or prior versions) has used dependency pull (that is, via the JNDI API to look up an EJB component). Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Chapter.html#Fig1">3-1</a></span>                                    shows the scenario of dependency pull via the lookup mechanism.
                                    <div class="Figure" id="Fig1">
                                        <div class="MediaObject" id="MO1"><img alt="A315511_5_En_3_Fig1_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Fig1_HTML.jpg" height="137" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Fig1_HTML.jpg" width="320"/></div>
                                        <div class="Caption" xml:lang="en">
                                            <div class="CaptionContent"><span class="CaptionNumber">Figure 3-1.</span>
                                                <div class="SimplePara">Dependency pull via JNDI <span id="ITerm3">lookup                                      </span> </div>
                                            </div>
                                    </div>
                                </div>
                        </div>
                        <div class="Para" id="Par11">Spring also offers dependency pull as a mechanism for retrieving the components that the framework manages; you saw this in action in Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Chapter.html"><span class="RefSource">2</span></a>
                            </span>. The following code sample shows a typical dependency pull lookup in a Spring-based application:</div>
                        <div class="Para" id="Par12">
                            <div class="ProgramCode" id="PC1">
                                <div class="LineGroup">
                                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.ApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.ClassPathXmlApplicationContext</span>;
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">DependencyPull</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>...<span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">ApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ClassPathXmlApplicationContext</span>(<span style="color:#036a07">spring/app-context.xml</span>);
        <span style="color:#00f;font-weight:700">MessageRenderer</span> mr <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">renderer</span>, <span style="color:#00f;font-weight:700">MessageRenderer</span><span style="color:#00f;font-weight:700">.</span>class);
        mr<span style="color:#00f;font-weight:700">.</span>render();
    }
}
</pre></div>
                                </div>
                            </div>
                        </div>
                        <div class="Para" id="Par13">This kind of IoC is not only prevalent in JEE-based applications (using EJB 2.1 or prior versions), which make extensive use of JNDI lookups to obtain dependencies from a registry, but also pivotal to working with Spring in many
                            environments.</div>
                    </div>
                    <div class="Section2 RenderAsSection2" id="Sec4">
                        <h3 class="Heading">Contextualized Dependency Lookup</h3>
                        <div class="Para" id="Par14"> <span id="ITerm4">            <span class="EmphasisTypeItalic">Contextualized dependency lookup</span> (CDL) </span> is similar, in some respects, to dependency pull, but in CDL, lookup is performed against the container that is
                            managing the resource, not from some central registry, and it is usually performed at some set point. Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Chapter.html#Fig2">3-2</a></span>                            shows the <span id="ITerm5">CDL                      </span> mechanism.
                            <div class="Figure" id="Fig2">
                                <div class="MediaObject" id="MO2"><img alt="A315511_5_En_3_Fig2_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Fig2_HTML.jpg" height="188" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Fig2_HTML.jpg" width="240"/></div>
                                <div class="Caption" xml:lang="en">
                                    <div class="CaptionContent"><span class="CaptionNumber">Figure 3-2.</span>
                                        <div class="SimplePara">Contextualized dependency lookup</div>
                                    </div>
                            </div>
                        </div>
                    </div>
                    <div class="Para" id="Par15">CDL works by having the component implement an interface similar to that in the following code snippet:</div>
                    <div class="Para" id="Par16">
                        <div class="ProgramCode" id="PC2">
                            <div class="LineGroup">
                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3</span>;
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">ManagedComponent</span> {
    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">performLookup</span>(<span style="color:#00f;font-weight:700">Container</span> <span style="font-style:italic">container</span>);
}
</pre></div>
                            </div>
                        </div>
                    </div>
                    <div class="Para" id="Par17">By <span id="ITerm6">implementing          </span> <span id="ITerm7">                                              </span> this interface, a component is signaling to the container that it wants to obtain a dependency. The container
                        is usually provided by the underlying application server or framework (for example, Tomcat or JBoss) or framework (for example, Spring). The following code snippet shows a simple <span class="EmphasisFontCategoryNonProportional">Container</span>                        interface that provides a dependency lookup service:</div>
                    <div class="Para" id="Par18">
                        <div class="ProgramCode" id="PC3">
                            <div class="LineGroup">
                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3</span>;
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">Container</span> {
    <span style="color:#00f;font-weight:700">Object</span> <span style="color:#0000a2;font-weight:700">getDependency</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">key</span>);
}
</pre></div>
                            </div>
                        </div>
                    </div>
                    <div class="Para" id="Par19">When the container is ready to pass dependencies to a component, it calls <span id="ITerm8">                <span class="EmphasisFontCategoryNonProportional">performLookup()</span> </span> on each component in turn. The component can
                        then look up its dependencies by using the <span class="EmphasisFontCategoryNonProportional">Container</span> interface, as shown in the following code snippet:</div>
                    <div class="Para" id="Par20">
                        <div class="ProgramCode" id="PC4">
                            <div class="LineGroup">
                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3</span>;
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">ContextualizedDependencyLookup</span>
<span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">ManagedComponent</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Dependency</span> dependency;<span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">performLookup</span>(<span style="color:#00f;font-weight:700">Container</span> <span style="font-style:italic">container</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>dependency <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">Dependency</span>) container<span style="color:#00f;font-weight:700">.</span>getDependency(<span style="color:#036a07">myDependency</span>);
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">toString</span>() {
        <span style="color:#00f;font-weight:700">return</span> dependency<span style="color:#00f;font-weight:700">.</span>toString();
    }
}
</pre></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="Section2 RenderAsSection2" id="Sec5">
                    <h3 class="Heading"> <span id="ITerm11">Constructor                      </span> Dependency Injection</h3>
                    <div class="Para ParaOneEmphasisChild" id="Par21"> <span class="EmphasisTypeItalic">Constructor dependency injection</span> occurs when a component’s dependencies are provided to it in its constructor (or constructors). The component declares a constructor or a set of constructors,
                        taking as arguments its dependencies, and the IoC container passes the dependencies to the component when instantiation occurs, as shown in the following code snippet:</div>
                    <div class="Para" id="Par22">
                        <div class="ProgramCode" id="PC5">
                            <div class="LineGroup">
                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3</span>;
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">ConstructorInjection</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Dependency</span> dependency;
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">ConstructorInjection</span>(<span style="color:#00f;font-weight:700">Dependency</span> <span style="font-style:italic">dependency</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>dependency <span style="color:#00f;font-weight:700">=</span> dependency;
    }
    
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">toString</span>() {
        <span style="color:#00f;font-weight:700">return</span> dependency<span style="color:#00f;font-weight:700">.</span>toString();
    }
}
</pre></div>
                            </div>
                        </div>
                    </div>
                    <div class="Para" id="Par23">An obvious consequence of using constructor injection is that an object cannot be created without its dependencies; thus, they are mandatory.</div>
                </div>
                <div class="Section2 RenderAsSection2" id="Sec6">
                    <h3 class="Heading">Setter Dependency Injection</h3>
                    <div class="Para" id="Par24">In <span id="ITerm12">                <span class="EmphasisTypeItalic">setter</span> </span> <span class="EmphasisTypeItalic">dependency injection</span>, the IoC container injects a component’s dependencies via JavaBean-style setter
                        methods. A component’s setters expose the dependencies the IoC container can manage. The following code sample shows a typical setter dependency injection–based component:</div>
                    <div class="Para" id="Par25">
                        <div class="ProgramCode" id="PC6">
                            <div class="LineGroup">
                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3</span>;
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SetterInjection</span> {
        <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Dependency</span> dependency;
        <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setDependency</span>(<span style="color:#00f;font-weight:700">Dependency</span> <span style="font-style:italic">dependency</span>) {
            <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>dependency <span style="color:#00f;font-weight:700">=</span> dependency;
        }
        <span style="color:#00f;font-weight:700">@Override</span>
        <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">toString</span>() {
            <span style="color:#00f;font-weight:700">return</span> dependency<span style="color:#00f;font-weight:700">.</span>toString();
        }
}
</pre></div>
                            </div>
                        </div>
                    </div>
                    <div class="Para" id="Par26">An obvious <span id="ITerm13">consequence                      </span> of using setter injection is that an object can be created without its dependencies, and they can be provided later by calling the setter.</div>
                    <div class="Para" id="Par27">Within the container, the dependency requirement exposed by the <span id="ITerm14">            <span class="EmphasisFontCategoryNonProportional">setDependency()</span> method </span> is referred to by the JavaBeans-style name,
                        <span class="EmphasisFontCategoryNonProportional">dependency</span>. In practice, setter injection is the most widely used injection mechanism, and it is one of the simplest IoC mechanisms to implement.</div>
                    <div class="Para ParaTypeImportant" id="Par28"> <img alt="A315511_5_En_3_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" width="30"/>                        There is a another type of injection supported in Spring called <span id="ITerm15">                <span class="EmphasisTypeItalic">field injection</span> </span>, but this will be covered later in the chapter, when you learn about
                        autowiring using the <span class="EmphasisFontCategoryNonProportional">@Autowire</span> annotation.</div>
                </div>
                <div class="Section2 RenderAsSection2" id="Sec7">
                    <h3 class="Heading"> <span id="ITerm16">Injection vs. Lookup                      </span> </h3>
                    <div class="Para" id="Par29">Choosing which style of IoC to use—injection or lookup—is not usually a difficult decision. In many cases, the type of IoC you use is mandated by the container you are using. For instance, if you are using EJB 2.1 or prior versions,
                        you must use lookup-style IoC (via JNDI) to obtain an EJB from the JEE container. In Spring, aside from initial bean lookups, your components and their dependencies are always wired together using injection-style IoC.</div>
                    <div class="Para ParaTypeImportant" id="Par30"> <img alt="A315511_5_En_3_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" width="30"/>                        When you are using Spring, you can access EJB resources without needing to perform an explicit lookup. Spring can act as an adapter between lookup and injection-style IoC systems, thus allowing you to manage all resources by using
                        injection.</div>
                <div class="Para" id="Par31">The real question is this: given the choice, which method should you use, injection or lookup? The answer is most definitely injection. If you look at the code in the previous code samples, you can clearly see that using injection has
                    zero impact on your components’ code. The dependency pull code, on the other hand, must actively obtain a reference to the registry and interact with it to obtain the dependencies, and using CDL requires your classes to implement a
                    specific interface and look up all dependencies manually. When you are using injection, the most your classes have to do is allow dependencies to be injected by using either constructors or setters.</div>
                <div class="Para" id="Par32">Using injection, you are free to use your classes completely decoupled from the IoC container that is supplying dependent objects with their collaborators manually, whereas with lookup, your classes are always dependent on the classes
                    and interfaces defined by the container. Another drawback with lookup is that it becomes difficult to test your classes in isolation from the container. Using injection, testing your components is trivial because you can simply provide
                    the dependencies yourself by using the appropriate constructor or setter.</div>
                <div class="Para ParaTypeImportant" id="Par33"> <img alt="A315511_5_En_3_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" width="30"/>                    For a more complete discussion of testing by using dependency injection and Spring, refer to Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_13_Chapter.html"><span class="RefSource">13</span></a>
                    </span>.</div>
                <div class="Para" id="Par34">Lookup-based solutions are, by necessity, more complex than injection-based ones. Although complexity is nothing to be afraid of, we question the validity of adding unneeded complexity to a process as central to your application as dependency
                    management.</div>
                <div class="Para" id="Par35">All of these reasons aside, the biggest reason to choose injection over lookup is that it makes your life easier. You write substantially less code when you are using injection, and the code that you do write is simple and can, in general,
                    be automated by a good <span id="ITerm17">IDE                      </span>. You will notice that all the code in the injection samples is passive, in that it doesn’t actively try to accomplish a task. The most exciting thing you see
                    in injection code is that objects get stored in a field only; no other code is involved in pulling the dependency from any registry or container. Therefore, the code is much simpler and less error prone. Passive code is much simpler
                    to maintain than active code because there is very little that can go wrong. Consider the following code taken from the CDL example:</div>
                <div class="Para" id="Par36">
                    <div class="ProgramCode" id="PC7">
                        <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> performLookup(<span style="color:#00f;font-weight:700">Container</span> container) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>dependency <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">Dependency</span>) container<span style="color:#00f;font-weight:700">.</span>getDependency(<span style="color:#036a07">myDependency</span>);
}
</pre></div>
                    </div>
                </div>
                <div class="Para ParaOneEmphasisChild" id="Par37">In this code, plenty could go wrong: the dependency key could change, the container instance could be <span class="EmphasisFontCategoryNonProportional">null</span>, or the returned dependency might be the incorrect type. We refer to this
                    code as having a lot of moving parts, because plenty of things can break. Using dependency lookup might decouple the components of your application, but it adds complexity in the additional code required to couple these components
                    back together in order to perform any useful tasks.</div>
            </div>
            <div class="Section2 RenderAsSection2" id="Sec8">
                <h3 class="Heading"> <span id="ITerm18">Setter Injection vs. Constructor Injection                      </span> </h3>
                <div class="Para ParaOneEmphasisChild" id="Par38">Now that we have established which method of IoC is preferable, you still need to choose whether to use setter injection or constructor injection. <span class="EmphasisTypeItalic">Constructor injection</span> is particularly useful when
                    you absolutely must have an instance of the dependency class before your component is used. Many containers, Spring included, provide a mechanism for ensuring that all dependencies are defined when you use setter injection, but by
                    using constructor injection, you assert the requirement for the dependency in a container-agnostic manner. Constructor injection also helps achieve the use of immutable objects.</div>
                <div class="Para" id="Par39"> <span class="EmphasisTypeItalic">Setter injection</span> is useful in a variety of cases. If the component is exposing its dependencies to the container but is happy to provide its own defaults, setter injection is usually the best way
                    to accomplish this. Another benefit of setter injection is that it allows dependencies to be declared on an interface, although this is not as useful as you might first think. Consider a typical business interface with one business
                    method, <span class="EmphasisFontCategoryNonProportional">defineMeaningOfLife()</span>. If, in addition to this method, you define a setter for injection such as <span class="EmphasisFontCategoryNonProportional">setEncylopedia()</span>,
                    you are mandating that all implementations must use or at least be aware of the encyclopedia dependency. However, you don’t need to define <span class="EmphasisFontCategoryNonProportional">setEncylopedia()</span> in the business interface.
                    Instead, you can define the method in the classes implementing the business interface. While programming in this way, all recent IoC containers, Spring included, can work with the component in terms of the business interface but still
                    provide the dependencies of the implementing class. An example of this may clarify this <span id="ITerm19">matter                       </span>slightly. Consider the business interface in the following code snippet:</div>
                <div class="Para" id="Par40">
                    <div class="ProgramCode" id="PC8">
                        <div class="LineGroup">
                            <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3</span>;
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">Oracle</span> {
    <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">defineMeaningOfLife</span>();
}
</pre></div>
                        </div>
                    </div>
                </div>
                <div class="Para" id="Par41">Notice that the business interface does not define any setters for dependency injection. This interface could be implemented as shown in the following code snippet:</div>
                <div class="Para" id="Par42">
                    <div class="ProgramCode" id="PC9">
                        <div class="LineGroup">
                            <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3</span>;
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">BookwormOracle</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Oracle</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Encyclopedia</span> encyclopedia;
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setEncyclopedia</span>(<span style="color:#00f;font-weight:700">Encyclopedia</span> <span style="font-style:italic">encyclopedia</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>encyclopedia <span style="color:#00f;font-weight:700">=</span> encyclopedia;
    }
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">defineMeaningOfLife</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">Encyclopedias are a waste of money - go see the world instead</span>;
    }
}
</pre></div>
                        </div>
                    </div>
                </div>
                <div class="Para" id="Par43">As you can see, the <span id="ITerm20">            <span class="EmphasisFontCategoryNonProportional">BookwormOracle</span> class </span> not only implements the Oracle interface but also defines the setter for dependency injection. Spring
                    is more than comfortable dealing with a structure like this. There is absolutely no need to define the dependencies on the business interface. The ability to use interfaces to define dependencies is an often-touted benefit of setter
                    injection, but in actuality, you should strive to keep setters used solely for injection out of your interfaces. Unless you are absolutely sure that all implementations of a particular business interface require a particular dependency,
                    let each implementation class define its own dependencies and keep the business interface for business methods.</div>
                <div class="Para" id="Par44">Although you shouldn’t always place setters for dependencies in a business interface, placing setters and getters for configuration parameters in the business interface is a good idea and makes setter injection a valuable tool. We consider
                    configuration parameters to be a special case for dependencies. Certainly your components depend on the configuration data, but configuration data is significantly different from the types of dependency you have seen so far. We will
                    discuss the differences shortly, but for now, consider the business interface shown in the following code snippet:</div>
                <div class="Para" id="Par45">
                    <div class="ProgramCode" id="PC10">
                        <div class="LineGroup">
                            <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3</span>;
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">NewsletterSender</span> {
    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setSmtpServer</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">smtpServer</span>);
    <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getSmtpServer</span>();
    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setFromAddress</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">fromAddress</span>);
    <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getFromAddress</span>();
    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">send</span>();
}
</pre></div>
                        </div>
                    </div>
                </div>
                <div class="Para" id="Par46">Classes that send a set of newsletters via e-mail implement the <span id="ITerm21">            <span class="EmphasisFontCategoryNonProportional">NewsletterSender</span> interface </span> <span id="ITerm22">                                              </span>.
                    The <span class="EmphasisFontCategoryNonProportional">send()</span> method is the only business method, but notice that we have defined two JavaBean properties on the interface. Why are we doing this when we just said that you shouldn’t
                    define dependencies in the business interface? The reason is that these values, the SMTP server address and the address the e-mails are sent from, are not dependencies in the practical sense; rather, they are configuration details
                    that affect how all implementations of the <span class="EmphasisFontCategoryNonProportional">NewsletterSender</span> interface function. The question here then is this: what is the difference between a configuration parameter and any
                    other kind of dependency? In most cases, you can clearly see whether a dependency should be classified as a configuration parameter, but if you are not sure, look for the following three characteristics that point to a configuration
                    parameter:
                    <div class="UnorderedList">
                        <ul class="UnorderedListMarkBullet">
                            <li>
                                <div class="Para" id="Par47">Configuration parameters are passive. In the <span class="EmphasisFontCategoryNonProportional">NewsletterSender</span> example depicted in the previous code snippet, the SMTP server parameter is an example of a passive
                                    dependency. Passive dependencies are not used directly to perform an action; instead, they are used internally or by another dependency to perform their actions. In the <span class="EmphasisFontCategoryNonProportional">MessageRenderer</span>                                    example from Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Chapter.html"><span class="RefSource">2</span></a>
                                    </span>, the <span class="EmphasisFontCategoryNonProportional">MessageProvider</span> dependency was not passive; it performed a function that was necessary for the <span class="EmphasisFontCategoryNonProportional">MessageRenderer</span>                                    to complete its task.</div>
                            </li>
                            <li>
                                <div class="Para" id="Par48">Configuration parameters are usually information, not other components. By this we mean that a configuration parameter is usually some piece of information that a component needs to complete its work. Clearly, the SMTP
                                    server is a piece of information required by the <span class="EmphasisFontCategoryNonProportional">NewsletterSender</span>, but the <span class="EmphasisFontCategoryNonProportional">MessageProvider</span> is really
                                    another component that the <span class="EmphasisFontCategoryNonProportional">MessageRenderer</span> needs to function correctly.</div>
                            </li>
                            <li>
                                <div class="Para" id="Par49">Configuration parameters are usually simple values or collections of simple values. This is really a by-product of the previous two points, but configuration parameters are usually simple values. In Java this means they
                                    are a primitive (or the corresponding wrapper class) or a <span class="EmphasisFontCategoryNonProportional">String</span> or collections of these values. Simple values are generally passive. This means you can’t do
                                    much with a <span class="EmphasisFontCategoryNonProportional">String</span> other than manipulate the data it represents; and you almost always use these values for information purposes, for example, an <span class="EmphasisFontCategoryNonProportional">int</span>                                    value that represents the port number that a network socket should listen on or a <span class="EmphasisFontCategoryNonProportional">String</span> that represents the SMTP server through which an e-mail program should
                                    send messages.</div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="Para" id="Par50">When considering whether to define <span id="ITerm23">configuration                      </span> options in the business interface, also consider whether the configuration parameter is applicable to all implementations of the business
                    interface or just one. For instance, in the case of implementations of <span class="EmphasisFontCategoryNonProportional">NewsletterSender</span>, it is obvious that all implementations need to know which SMTP server to use when sending
                    e-mails. However, we would probably choose to leave the configuration option that flags whether to send secure e-mail off the business interface because not all e-mail APIs are capable of this, and it is correct to assume that many
                    implementations will not take security into consideration at all.</div>
                <div class="Para ParaTypeImportant" id="Par51"> <img alt="A315511_5_En_3_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" width="30"/>                    Recall that in Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Chapter.html"><span class="RefSource">2</span></a>
                    </span> it was chosen to define the dependencies in the business purposes. This was for illustration purposes and should not be treated in any way as a best practice.</div>
                <div class="Para" id="Par52">Setter injection also allows you to swap dependencies for a different implementation on the fly without creating a new instance of the parent component. Spring’s JMX support makes this possible. Perhaps the biggest benefit of setter injection
                    is that it is the least intrusive of the injection mechanisms.</div>
                <div class="Para" id="Par53">In general, you should choose an injection type based on your use case. Setter-based injection allows dependencies to be swapped out without creating new objects and also lets your class choose appropriate defaults without the need to
                    explicitly inject an object. Constructor injection is a good choice when you want to ensure that dependencies are being passed to a component and when designing for immutable objects. Do keep in mind that while constructor injection
                    ensures that all dependencies are provided to a component, most containers provide a mechanism to ensure this as well but may incur a cost of coupling your code to the framework.</div>
            </div>
    </div>
    <div class="Section1 RenderAsSection1" id="Sec9">
        <h2 class="Heading">Inversion of Control in Spring</h2>
        <div class="Para" id="Par54">As mentioned earlier, inversion of control is a big part of what Spring does. The core of Spring’s implementation is based on dependency injection, although dependency lookup features are provided as well. When Spring provides collaborators to
            a dependent object automatically, it does so using dependency injection. In a Spring-based application, it is always preferable to use dependency injection to pass collaborators to dependent objects rather than have the dependent objects obtain
            the collaborators via lookup. Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Chapter.html#Fig3">3-3</a></span> shows Spring’s dependency injection mechanism. Although
            <span id="ITerm24">dependency injection                  </span> is the preferred mechanism for wiring together collaborators and dependent objects, you need dependency lookup to access the dependent objects. In many environments, Spring cannot
            automatically wire up all of your application components by using dependency injection, and you must use dependency lookup to access the initial set of components. For example, in stand-alone Java applications, you need to bootstrap Spring’s
            container in the <span class="EmphasisFontCategoryNonProportional">main()</span> method and obtain the dependencies (via the <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> interface) for processing programmatically.
            However, when you are building web applications by using Spring’s MVC support, Spring can avoid this by gluing your entire application together automatically. Wherever it is possible to use <span id="ITerm25">dependency injection                  </span>            with Spring, you should do so; otherwise, you can fall back on the dependency lookup capabilities. You will see examples of both in action during the course of this chapter, and we will point them out when they first arise.
            <div class="Figure" id="Fig3">
                <div class="MediaObject" id="MO3"><img alt="A315511_5_En_3_Fig3_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Fig3_HTML.jpg" height="53" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Fig3_HTML.jpg" width="360"/></div>
                <div class="Caption" xml:lang="en">
                    <div class="CaptionContent"><span class="CaptionNumber">Figure 3-3.</span>
                        <div class="SimplePara">Spring’s dependency injection mechanism</div>
                    </div>
            </div>
        </div>
    </div>
    <div class="Para" id="Par55">An interesting feature of Spring’s IoC container is that it has the ability to act as an adapter between its own dependency injection container and external dependency lookup containers. We discuss this feature later in this chapter.</div>
    <div class="Para" id="Par56">Spring supports both constructor and setter injection and bolsters the standard IoC feature set with a whole host of useful additions to make your life easier.</div>
    <div class="Para" id="Par57">The rest of this chapter introduces the basics of Spring’s DI container, complete with plenty of examples.</div>
    </div>
    <div class="Section1 RenderAsSection1" id="Sec10">
        <h2 class="Heading">Dependency Injection in Spring</h2>
        <div class="Para" id="Par58">Spring’s support for dependency injection is comprehensive and, as you will see in Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Chapter.html"><span class="RefSource">4</span></a>
            </span>, goes beyond the standard IoC feature set we have discussed so far. The rest of this chapter addresses the basics of Spring’s dependency injection container, looking at setter, constructor, and Method Injection, along with a detailed look
            at how dependency injection is configured in Spring.</div>
        <div class="Section2 RenderAsSection2" id="Sec11">
            <h3 class="Heading"> <span id="ITerm26">Beans and BeanFactory                      </span> </h3>
            <div class="Para" id="Par59">The core of Spring’s dependency injection container is the <span class="EmphasisFontCategoryNonProportional">BeanFactory</span> interface. <span class="EmphasisFontCategoryNonProportional">BeanFactory</span> is responsible for managing components,
                including their dependencies as well as their life cycles. In Spring, the term <span class="EmphasisTypeItalic">bean</span> is used to refer to any component managed by the container. Typically, your beans adhere, at some level, to the
                JavaBeans specification, but this is not required, especially if you plan to use constructor injection to wire your beans together.</div>
            <div class="Para" id="Par60">If your application needs only DI support, you can interact with the Spring DI container via the <span class="EmphasisFontCategoryNonProportional">BeanFactory</span> interface. In this case, your application must create an instance of a class
                that implements the <span class="EmphasisFontCategoryNonProportional">BeanFactory</span> interface and configures it with bean and dependency information. After this is complete, your application can access the beans via <span class="EmphasisFontCategoryNonProportional">BeanFactory</span>                and get on with its processing.</div>
            <div class="Para" id="Par61">In some cases, all of this setup is handled automatically (for example, in a web application, Spring’s <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> will be bootstrapped by the web container during application
                startup via a Spring-provided <span class="EmphasisFontCategoryNonProportional">ContextLoaderListener</span> class declared in the <span class="EmphasisFontCategoryNonProportional">web.xml</span> descriptor file). But in many cases, you
                need to code the setup yourself. All of the examples in this chapter require manual setup of the <span class="EmphasisFontCategoryNonProportional">BeanFactory</span> implementation.</div>
            <div class="Para" id="Par62">Although the <span class="EmphasisFontCategoryNonProportional">BeanFactory</span> can be configured programmatically, it is more common to see it configured externally using some kind of configuration file. Internally, bean configuration is
                represented by instances of classes that implement the <span class="EmphasisFontCategoryNonProportional">BeanDefinition</span> interface. The bean configuration stores information not only about a bean itself but also about the beans that
                it depends on. For any <span class="EmphasisFontCategoryNonProportional">BeanFactory</span> implementation classes that also implement the <span class="EmphasisFontCategoryNonProportional">BeanDefinitionReader</span> interface, you can
                read the <span class="EmphasisFontCategoryNonProportional">BeanDefinition</span> data from a configuration file, using either <span class="EmphasisFontCategoryNonProportional">PropertiesBeanDefinitionReader</span> or <span class="EmphasisFontCategoryNonProportional">XmlBeanDefinitionReader. PropertiesBeanDefinitionReader</span>                reads the bean definition from properties files, while <span class="EmphasisFontCategoryNonProportional">XmlBeanDefinitionReader</span> reads from XML <span id="ITerm27">files                      </span>.</div>
            <div class="Para" id="Par63">So, you can identify your beans within <span class="EmphasisFontCategoryNonProportional">BeanFactory</span>; each bean can be assigned an ID, a name, or both. A bean can also be instantiated without any ID or name (known as an <span class="EmphasisTypeItalic">anonymous bean</span>)
                or as an inner bean within another bean. Each bean has at least one name but can have any number of names (additional names are separated by commas). Any names after the first are considered aliases for the same bean. You use bean IDs
                or names to retrieve a bean from <span class="EmphasisFontCategoryNonProportional">BeanFactory</span> and also to establish dependency relationships (that is, bean X depends on bean Y).</div>
        </div>
        <div class="Section2 RenderAsSection2" id="Sec12">
            <h3 class="Heading"> <span id="ITerm28">BeanFactory Implementations                      </span> </h3>
            <div class="Para ParaOneEmphasisChild" id="Par64">The description of the <span class="EmphasisFontCategoryNonProportional">BeanFactory</span> interface may appear overly complex, but in practice, this is not the case. Take a look at a simple example. Let’s say you have an implementation that
                mimics an oracle that can tell you the meaning of life.</div>
            <div class="Para" id="Par65">
                <div class="ProgramCode" id="PC11">
                    <div class="LineGroup">
                        <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#06f;font-style:italic">//interface</span>
<span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3</span>;
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">Oracle</span> {
    <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">defineMeaningOfLife</span>();
}
<span style="color:#06f;font-style:italic">//implementation</span>
<span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3</span>;
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">BookwormOracle</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Oracle</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Encyclopedia</span> encyclopedia;
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setEncyclopedia</span>(<span style="color:#00f;font-weight:700">Encyclopedia</span> <span style="font-style:italic">encyclopedia</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>encyclopedia <span style="color:#00f;font-weight:700">=</span> encyclopedia;
    }
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">defineMeaningOfLife</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">Encyclopedias are a waste of money - go see the world instead</span>;
    }
}
</pre></div>
                    </div>
                </div>
            </div>
            <div class="Para" id="Par66">Now let’s see, in a stand-alone Java <span id="ITerm29">program                      </span>, how Spring’s <span class="EmphasisFontCategoryNonProportional">BeanFactory</span> can be initialized and obtain the <span class="EmphasisFontCategoryNonProportional">oracle</span>                bean for processing. Here’s the code:</div>
            <div class="Para" id="Par67">
                <div class="ProgramCode" id="PC12">
                    <div class="LineGroup">
                        <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.support.DefaultListableBeanFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.xml.XmlBeanDefinitionReader</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.core.io.ClassPathResource</span>;
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">XmlConfigWithBeanFactory</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>...<span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">DefaultListableBeanFactory</span> factory <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">DefaultListableBeanFactory</span>();
        <span style="color:#00f;font-weight:700">XmlBeanDefinitionReader</span> rdr <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">XmlBeanDefinitionReader</span>(factory);
        rdr<span style="color:#00f;font-weight:700">.</span>loadBeanDefinitions(<span style="color:#00f;font-weight:700">new</span>
        <span style="color:#00f;font-weight:700">ClassPathResource</span>(<span style="color:#036a07">spring/xml-bean-factory-config.xml</span>));
        <span style="color:#00f;font-weight:700">Oracle</span> oracle <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">Oracle</span>) factory<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">oracle</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(oracle<span style="color:#00f;font-weight:700">.</span>defineMeaningOfLife());
    }
}
</pre></div>
                    </div>
                </div>
            </div>
            <div class="Para" id="Par68">In the previous code sample, you can see that we are using <span class="EmphasisFontCategoryNonProportional">DefaultListableBeanFactory</span>, which is one of the two main <span class="EmphasisFontCategoryNonProportional">BeanFactory</span>                implementations supplied with Spring, and that we are reading in the <span class="EmphasisFontCategoryNonProportional">BeanDefinition</span> information from an XML file by using <span class="EmphasisFontCategoryNonProportional">XmlBeanDefinitionReader</span>.
                Once the <span class="EmphasisFontCategoryNonProportional">BeanFactory</span> implementation is created and configured, we retrieve the <span class="EmphasisFontCategoryNonProportional">oracle</span> bean by using its name, <span class="EmphasisFontCategoryNonProportional">oracle</span>,
                which is configured in the XML configuration file.</div>
            <div class="Para" id="Par69">
                <div class="ProgramCode" id="PC13">
                    <div class="LineGroup">
                        <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#68685b">&lt;?<span style="color:#888">xml</span><span style="color:#888"> version</span>=<span style="color:#888">1.0</span><span style="color:#888"> encoding</span>=<span style="color:#888">UTF-8</span>?&gt;</span>
<span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> <span style="font-style:italic">xmlns</span>=<span style="color:#036a07">http://www.springframework.org/schema/beans</span>
    <span style="font-style:italic">xmlns</span>:xsi=<span style="color:#036a07">http://www.w3.org/2001/XMLSchema-instance</span>
    <span style="font-style:italic">xsi</span>:schemaLocation=<span style="color:#036a07">http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">oracle</span>
        <span style="font-style:italic">name</span>=<span style="color:#036a07">wiseworm</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.BookwormOracle</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
                    </div>
                </div>
            </div>
            <div class="Para ParaTypeImportant" id="Par70"> <img alt="A315511_5_En_3_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" width="30"/>                When declaring a Spring XSD location, it’s a best practice to not include the version number. This resolution is already handled for you by Spring as the versioned XSD file is configured through a pointer in the <span class="EmphasisFontCategoryNonProportional">spring.schemas</span>                file. This file resides in the <span class="EmphasisFontCategoryNonProportional">spring-beans</span> module defined as a dependency in your project. This also prevents you from having to modify all of your bean files when upgrading to
                a new version of Spring.</div>
            <div class="Para" id="Par71">The previous file declares a Spring bean, gives it an ID of <span class="EmphasisFontCategoryNonProportional">oracle</span> and a name of <span class="EmphasisFontCategoryNonProportional">wiseworm</span>, and tells Spring that the underlying
                implementation class is <span class="EmphasisFontCategoryNonProportional">com.apress.prospring4.ch3.BookwormOracle</span>. Don’t worry too much about the configuration at the moment; we discuss the details in later sections.</div>
            <div class="Para ParaOneEmphasisChild" id="Par72">Having the configuration defined, run the program shown in the previous code sample; you will see the phrase returned by the <span class="EmphasisFontCategoryNonProportional">defineMeaningOfLife()</span> method in the console output.</div>
        <div class="Para" id="Par73">In addition to <span class="EmphasisFontCategoryNonProportional">XmlBeanDefinitionReader</span>, Spring also provides <span class="EmphasisFontCategoryNonProportional">PropertiesBeanDefinitionReader</span>, which allows you to manage your bean
            configuration by using properties rather than XML. Although properties are ideal for small, simple applications, they can quickly become cumbersome when you are dealing with a large number of beans. For this reason, it is preferable to use
            the XML configuration format for all but the most trivial of applications.</div>
    <div class="Para" id="Par74">Of course, you are free to define your own <span class="EmphasisFontCategoryNonProportional">BeanFactory</span> implementations, although be aware that doing so is quite involved; you need to implement a lot more interfaces than just <span class="EmphasisFontCategoryNonProportional">BeanFactory</span>        to get the same level of functionality you have with the supplied <span class="EmphasisFontCategoryNonProportional">BeanFactory</span> implementations. If all you want to do is define a new configuration mechanism, create your definition reader
        by developing a class that extends the <span class="EmphasisFontCategoryNonProportional">DefaultListableBeanFactory</span> class, which has the <span class="EmphasisFontCategoryNonProportional">BeanFactory</span> interface implemented.</div>
    </div>
    <div class="Section2 RenderAsSection2" id="Sec13">
        <h3 class="Heading"> <span id="ITerm31">ApplicationContext                      </span> </h3>
        <div class="Para" id="Par75">In Spring, the <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> interface is an extension to <span class="EmphasisFontCategoryNonProportional">BeanFactory</span>. In addition to DI services, <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>            provides other services, such as transaction and AOP service, message source for internationalization (i18n), and application event handling, to name a few. In developing Spring-based applications, it’s recommended that you interact with Spring
            via the <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> interface. Spring supports the bootstrapping of <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> by manual coding (instantiate it
            manually and load the appropriate configuration) or in a web container environment via <span class="EmphasisFontCategoryNonProportional">ContextLoaderListener</span>. From this point onward, all the sample code in this book uses <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>            and its implementations.</div>
    </div>
    </div>
    <div class="Section1 RenderAsSection1" id="Sec14">
        <h2 class="Heading">Configuring ApplicationContext</h2>
        <div class="Para" id="Par76">Having discussed the basic concepts of IoC and DI and gone through a simple example of using Spring’s <span class="EmphasisFontCategoryNonProportional">BeanFactory</span> interface, let’s dive into the details of how to configure a Spring application.
            In the following sections, we go through various aspects of configuring Spring applications. Specifically, we should focus our attention on the <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> interface, which provides
            many more configuration options than the traditional <span class="EmphasisFontCategoryNonProportional">BeanFactory</span> interface.</div>
        <div class="Section2 RenderAsSection2" id="Sec15">
            <h3 class="Heading">Setting Spring <span id="ITerm32">Configuration Options                      </span> </h3>
            <div class="Para" id="Par77">Before we dive into the details of configuring Spring’s <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>, let’s take a look at the options that are available for defining an application’s configuration within Spring.
                Originally, Spring supported defining beans through either properties or an XML file. Since the release of JDK 5 and Spring’s support of Java annotations, Spring (starting from Spring 2.5) also supports using Java annotations when configuring
                <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>. So, which one is better, XML or annotations? There have been lots of debates on this topic, and you can find numerous discussions on the Internet.<a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Chapter.html#Fn1" id="Fn1_source"><sup>1</sup></a> There is no definite answer, and each approach has its pros and cons. Using an XML file can externalize all configuration from Java code, while annotations allow the developer to
                define and view the DI setup from within the code. Spring also supports a mix of the two approaches in a single <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>. One common approach is to define the application
                infrastructure (for example, data source, transaction manager, JMS connection factory, or JMX) in an XML file, while defining the DI configuration (injectable beans and beans’ dependencies) in annotations. However, no matter which option
                you choose, stick to it and deliver the message clearly across the entire development team. Agreeing on the style to use and keeping it consistent across the application will make ongoing development and maintenance activities much easier.</div>
            <div class="Para" id="Par79">To facilitate your understanding of both the XML and annotation configuration, we provide sample code for XML and annotations side by side whenever appropriate, but the focus of this book will be on annotations and Java configuration, as XML
                was already covered in the previous editions of this book.</div>
    </div>
    <div class="Section2 RenderAsSection2" id="Sec16">
        <h3 class="Heading">Basic Configuration Overview</h3>
        <div class="Para" id="Par80">For <span id="ITerm33">XML configuration                      </span>, you need to declare the required namespace base provided by Spring that your application requires. The following configuration sample shows the most basic sample, which declares
            only the bean’s namespace for you to define the Spring beans. We refer to this configuration file as <span class="EmphasisFontCategoryNonProportional">app-context-xml.xml</span> for XML-style configuration throughout the samples.</div>
        <div class="Para" id="Par81">
            <div class="ProgramCode" id="PC14">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#68685b">&lt;?<span style="color:#888">xml</span><span style="color:#888"> version</span>=<span style="color:#888">1.0</span><span style="color:#888"> encoding</span>=<span style="color:#888">UTF-8</span>?&gt;</span>
<span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> <span style="font-style:italic">xmlns</span>=<span style="color:#036a07">http://www.springframework.org/schema/beans</span>
    <span style="font-style:italic">xmlns</span>:xsi=<span style="color:#036a07">http://www.w3.org/2001/XMLSchema-instance</span>
    <span style="font-style:italic">xmlns</span>:c=<span style="color:#036a07">http://www.springframework.org/schema/c</span>
    <span style="font-style:italic">xsi</span>:schemaLocation=<span style="color:#036a07">http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans.xsd</span>&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
                </div>
            </div>
    </div>
    <div class="Para" id="Par82">Besides beans, Spring provides a large number of other namespaces for different purposes. Some examples include context for <span id="ITerm34">            <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> configuration </span>,
        <span class="EmphasisFontCategoryNonProportional">aop</span> for AOP support, and <span class="EmphasisFontCategoryNonProportional">tx</span> for transactional support. Namespaces are covered in the appropriate chapters.</div>
    <div class="Para ParaOneEmphasisChild" id="Par83">To use Spring’s annotation support in your application, you need to declare the tags shown in the next configuration sample in your XML configuration. We refer to this configuration file as <span class="EmphasisFontCategoryNonProportional">app-context-annotation.xml</span>        for XML configuration with annotation support throughout the samples.</div>
    <div class="Para" id="Par84">
        <div class="ProgramCode" id="PC15">
            <div class="LineGroup">
                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#68685b">&lt;?<span style="color:#888">xml</span><span style="color:#888"> version</span>=<span style="color:#888">1.0</span><span style="color:#888"> encoding</span>=<span style="color:#888">UTF-8</span>?&gt;</span>
<span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span>
    <span style="font-style:italic">xmlns</span>=<span style="color:#036a07">http://www.springframework.org/schema/beans</span>
    <span style="font-style:italic">xmlns</span>:xsi=<span style="color:#036a07">http://www.w3.org/2001/XMLSchema-instance</span>
    <span style="font-style:italic">xmlns</span>:context=<span style="color:#036a07">http://www.springframework.org/schema/context</span>
    <span style="font-style:italic">xmlns</span>:c=<span style="color:#036a07">http://www.springframework.org/schema/c</span>
       <span style="font-style:italic">xsi</span>:schemaLocation=<span style="color:#036a07">http://www.springframework.org/schema/beans
          http://www.springframework.org/schema/beans/spring-beans.xsd
          http://www.springframework.org/schema/context
          http://www.springframework.org/schema/context/spring-context.xsd</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">context</span><span style="font-weight:700">:</span><span style="font-weight:700">component-scan</span>
          <span style="font-style:italic">base-package</span>=<span style="color:#036a07">com.apress.prospring5.ch3.annotation</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
            </div>
        </div>
    </div>
    <div class="Para" id="Par85">The <span class="EmphasisFontCategoryNonProportional">&lt;context:component-scan&gt;</span> tag tells Spring to scan the code for injectable beans annotated with <span class="EmphasisFontCategoryNonProportional">@Component</span>, <span class="EmphasisFontCategoryNonProportional">@Controller</span>,
        <span class="EmphasisFontCategoryNonProportional">@Repository</span>, and <span class="EmphasisFontCategoryNonProportional">@Service</span> as well as supporting the <span class="EmphasisFontCategoryNonProportional">@Autowired</span>, <span class="EmphasisFontCategoryNonProportional">@Inject</span>,
        and <span class="EmphasisFontCategoryNonProportional">@Resource</span> annotations under the package (and all its subpackages) specified. In the <span class="EmphasisFontCategoryNonProportional">&lt;context:component-scan&gt;</span> tag, multiple
        packages can be defined by using either a comma, a semicolon, or a space as the delimiter. Moreover, the tag supports inclusion and exclusion of a component scan for more fine-grained control. For example, consider the following configuration
        sample:</div>
    <div class="Para" id="Par86">
        <div class="ProgramCode" id="PC16">
            <div class="LineGroup">
                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#68685b">&lt;?<span style="color:#888">xml</span><span style="color:#888"> version</span>=<span style="color:#888">1.0</span><span style="color:#888"> encoding</span>=<span style="color:#888">UTF-8</span>?&gt;</span>
<span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span>
    <span style="font-style:italic">xmlns</span>=<span style="color:#036a07">http://www.springframework.org/schema/beans</span>
    <span style="font-style:italic">xmlns</span>:xsi=<span style="color:#036a07">http://www.w3.org/2001/XMLSchema-instance</span>
    <span style="font-style:italic">xmlns</span>:context=<span style="color:#036a07">http://www.springframework.org/schema/context</span>
    <span style="font-style:italic">xmlns</span>:c=<span style="color:#036a07">http://www.springframework.org/schema/c</span>
       <span style="font-style:italic">xsi</span>:schemaLocation=<span style="color:#036a07">http://www.springframework.org/schema/beans
          http://www.springframework.org/schema/beans/spring-beans.xsd
          http://www.springframework.org/schema/context
          http://www.springframework.org/schema/context/spring-context.xsd</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">context</span><span style="font-weight:700">:</span><span style="font-weight:700">component-scan</span>
          <span style="font-style:italic">base-package</span>=<span style="color:#036a07">com.apress.prospring5.ch3.annotation</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">context</span><span style="font-weight:700">:</span><span style="font-weight:700">exclude-filter</span> <span style="font-style:italic">type</span>=<span style="color:#036a07">assignable</span>
            <span style="font-style:italic">expression</span>=<span style="color:#036a07">com.example.NotAService</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">context</span><span style="font-weight:700">:</span><span style="font-weight:700">component-scan</span>&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
            </div>
        </div>
    </div>
    <div class="Para ParaOneEmphasisChild" id="Par87">The previous tag tells Spring to scan the package as specified but omit the classes that were assignable to the type as specified in the expression (can be either a class or an interface). Besides the exclude filter, you can also use an include filter.
        And for the type, you can use annotation, regex, assignable, AspectJ, or custom (with your own filter class that implements <span class="EmphasisFontCategoryNonProportional">org.springframework.core.type.filter.TypeFilter</span>) as the filter
        criteria. The expression format depends on the type you specified.</div>
    </div>
    <div class="Section2 RenderAsSection2" id="Sec17">
        <h3 class="Heading">Declaring Spring <span id="ITerm35">Components                      </span> </h3>
        <div class="Para" id="Par88">After you develop some kind of service class and want to use it in a Spring-based application, you need to tell Spring that those beans are eligible for injection to other beans and have Spring manage them for you. Consider the sample in Chapter
            <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Chapter.html"><span class="RefSource">2</span></a>
            </span>, where <span class="EmphasisFontCategoryNonProportional">MessageRender</span> outputs the message and depends on <span class="EmphasisFontCategoryNonProportional">MessageProvider</span> to provide the message to render. The following code
            sample depicts the interfaces and the implementation of the two services:</div>
        <div class="Para" id="Par89">
            <div class="ProgramCode" id="PC17">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled</span>;
<span style="color:#06f;font-style:italic">//renderer interface</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">MessageRenderer</span> {
    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">render</span>();
    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setMessageProvider</span>(<span style="color:#00f;font-weight:700">MessageProvider</span> <span style="font-style:italic">provider</span>);
    <span style="color:#00f;font-weight:700">MessageProvider</span> <span style="color:#0000a2;font-weight:700">getMessageProvider</span>();
}
<span style="color:#06f;font-style:italic">// rendered implementation</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">StandardOutMessageRenderer</span>
<span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">MessageRenderer</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">MessageProvider</span> messageProvider;<span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">render</span>() {
        <span style="color:#00f;font-weight:700">if</span> (messageProvider <span style="color:#00f;font-weight:700">==</span> <span style="color:#585cf6;font-weight:700">null</span>) {
            <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">RuntimeException</span>(<span style="color:#036a07">You must set the property messageProvider of class:</span> <span style="color:#00f;font-weight:700">+</span> <span style="color:#00f;font-weight:700">StandardOutMessageRenderer</span><span style="color:#00f;font-weight:700">.</span>class<span style="color:#00f;font-weight:700">.</span>getName());
        }
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(messageProvider<span style="color:#00f;font-weight:700">.</span>getMessage());
    }
    
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setMessageProvider</span>(<span style="color:#00f;font-weight:700">MessageProvider</span> <span style="font-style:italic">provider</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>messageProvider <span style="color:#00f;font-weight:700">=</span> provider;
    }
    
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">MessageProvider</span> <span style="color:#0000a2;font-weight:700">getMessageProvider</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>messageProvider;
    }
}
<span style="color:#06f;font-style:italic">//provider interface</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">MessageProvider</span> {
    <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getMessage</span>();
}
<span style="color:#06f;font-style:italic">//provider implementation</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">HelloWorldMessageProvider</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">MessageProvider</span> {<span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getMessage</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">Hello World!</span>;
    }
}
</pre></div>
                </div>
            </div>
        </div>
        <div class="Para ParaTypeImportant" id="Par90"> <img alt="A315511_5_En_3_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" width="30"/>            The classes shown previously are part of the <span class="EmphasisFontCategoryNonProportional">com.apress.prospring5.ch2.decoupled</span> package. They are used in the project specific to this chapter as well, because in a real production
            application, developers try to reuse code instead of duplicating it. That is why, as you will see when you will get the sources, the project for Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Chapter.html"><span class="RefSource">2</span></a>
            </span>
            is defined as a dependency for some of the projects for Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Chapter.html"><span class="RefSource">3</span></a>
            </span>.</div>
        <div class="Para" id="Par91">To declare bean definitions in an <span id="ITerm37">XML                       </span>file, the <span class="EmphasisFontCategoryNonProportional">&lt;bean ../&gt;</span> tag is used, and the resulting <span class="EmphasisFontCategoryNonProportional">app-context-xml.xml</span>            file now looks like this:</div>
        <div class="Para" id="Par92">
            <div class="ProgramCode" id="PC18">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#68685b">&lt;?<span style="color:#888">xml</span><span style="color:#888"> version</span>=<span style="color:#888">1.0</span><span style="color:#888"> encoding</span>=<span style="color:#888">UTF-8</span>?&gt;</span>
<span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span>
    <span style="font-style:italic">xmlns</span>=<span style="color:#036a07">http://www.springframework.org/schema/beans</span>
    <span style="font-style:italic">xmlns</span>:xsi=<span style="color:#036a07">http://www.w3.org/2001/XMLSchema-instance</span>
    <span style="font-style:italic">xmlns</span>:p=<span style="color:#036a07">http://www.springframework.org/schema/p</span>
    <span style="font-style:italic">xsi</span>:schemaLocation=<span style="color:#036a07">http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">provider</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch2.decoupled.HelloWorldMessageProvider</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">renderer</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch2.decoupled.StandardOutMessageRenderer</span>
         <span style="font-style:italic">p</span>:messageProvider-ref=<span style="color:#036a07">provider</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
                </div>
            </div>
        </div>
        <div class="Para" id="Par93">The previous tags declare two beans, one with an ID of <span class="EmphasisFontCategoryNonProportional">provider</span> with the <span class="EmphasisFontCategoryNonProportional">HelloWorldMessageProvider</span> implementation, and the other
            with an ID of <span class="EmphasisFontCategoryNonProportional">renderer</span> with the <span class="EmphasisFontCategoryNonProportional">StandardOutMessageRenderer</span> implementation.</div>
        <div class="Para" id="Par94">Starting with this example, namespaces will no longer be added to configuration samples, unless new namespaces will be introduced, as this will make the bean definitions more visible.</div>
        <div class="Para" id="Par95">To create bean definitions using <span id="ITerm38">annotations                      </span>, the bean classes must be annotated with the appropriate stereotype annotation,<a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Chapter.html#Fn2" id="Fn2_source"><sup>2</sup></a> and the methods or constructors must be annotated with <span class="EmphasisFontCategoryNonProportional">@Autowired</span> to tell the Spring IoC container to look for a bean of that
            type and use it as an argument when calling that method. In the following code snippet, the annotations used to create the bean definition are underlined. The stereotype annotations can have as a parameter the name of the resulting bean.</div>
        <div class="Para" id="Par97">
            <div class="ProgramCode" id="PC19">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.annotation</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageProvider</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Component</span>;
<span style="color:#06f;font-style:italic">//simple bean</span>
@Component(<span style="color:#036a07">provider</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">HelloWorldMessageProvider</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">MessageProvider</span> {

<span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getMessage</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">Hello World!</span>;
    }
}

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageProvider</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageRenderer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Service</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Autowired</span>;
<span style="color:#06f;font-style:italic">//complex, service bean</span>
@Service(<span style="color:#036a07">renderer</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">StandardOutMessageRenderer</span>
<span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">MessageRenderer</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">MessageProvider</span> messageProvider;

<span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">render</span>() {
        <span style="color:#00f;font-weight:700">if</span> (messageProvider <span style="color:#00f;font-weight:700">==</span> <span style="color:#585cf6;font-weight:700">null</span>) {
            <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">RuntimeException</span>(<span style="color:#036a07">You must set the property messageProvider of class:</span> <span style="color:#00f;font-weight:700">+</span> <span style="color:#00f;font-weight:700">StandardOutMessageRenderer</span><span style="color:#00f;font-weight:700">.</span>class<span style="color:#00f;font-weight:700">.</span>getName());
        }
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(messageProvider<span style="color:#00f;font-weight:700">.</span>getMessage());
    }
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setMessageProvider</span>(<span style="color:#00f;font-weight:700">MessageProvider</span> <span style="font-style:italic">provider</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>messageProvider <span style="color:#00f;font-weight:700">=</span> provider;
    }
    
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">MessageProvider</span> <span style="color:#0000a2;font-weight:700">getMessageProvider</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>messageProvider;
    }
}
</pre></div>
                </div>
            </div>
    </div>
    <div class="Para" id="Par98">When bootstrapping Spring’s <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> with the XML configuration depicted here, in file <span class="EmphasisFontCategoryNonProportional">app-context-annotation.xml</span>, Spring will
        seek out those components and instantiate the beans with the specified names:</div>
    <div class="Para" id="Par99">
        <div class="ProgramCode" id="PC20">
            <div class="LineGroup">
                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#68685b">&lt;?<span style="color:#888">xml</span><span style="color:#888"> version</span>=<span style="color:#888">1.0</span><span style="color:#888"> encoding</span>=<span style="color:#888">UTF-8</span>?&gt;</span>
<span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span>
    <span style="font-style:italic">xmlns</span>=<span style="color:#036a07">http://www.springframework.org/schema/beans</span>
    <span style="font-style:italic">xmlns</span>:xsi=<span style="color:#036a07">http://www.w3.org/2001/XMLSchema-instance</span>
    <span style="font-style:italic">xmlns</span>:context=<span style="color:#036a07">http://www.springframework.org/schema/context</span>
       <span style="font-style:italic">xsi</span>:schemaLocation=<span style="color:#036a07">http://www.springframework.org/schema/beans
          http://www.springframework.org/schema/beans/spring-beans.xsd
          http://www.springframework.org/schema/context
          http://www.springframework.org/schema/context/spring-context.xsd</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">context</span><span style="font-weight:700">:</span><span style="font-weight:700">component-scan</span>
          <span style="font-style:italic">base-package</span>=<span style="color:#036a07">com.apress.prospring5.ch3.annotation</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
            </div>
        </div>
    </div>
    <div class="Para ParaOneEmphasisChild" id="Par100">Using either approach doesn’t affect the way you obtain the beans from <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>.</div>
    <div class="Para" id="Par101">
        <div class="ProgramCode" id="PC21">
            <div class="LineGroup">
                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageRenderer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">DeclareSpringComponents</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>...<span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-xml.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">MessageRenderer</span> messageRenderer <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">renderer</span>, <span style="color:#00f;font-weight:700">MessageRenderer</span><span style="color:#00f;font-weight:700">.</span>class);
        messageRenderer<span style="color:#00f;font-weight:700">.</span>render();
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre></div>
            </div>
        </div>
    </div>
    <div class="Para" id="Par102">Instead of <span class="EmphasisFontCategoryNonProportional">DefaultListableBeanFactory</span>, an instance of <span id="ITerm41">                <span class="EmphasisFontCategoryNonProportional">GenericXmlApplicationContext</span> </span> is instantiated.
        The <span class="EmphasisFontCategoryNonProportional">GenericXmlApplicationContext</span> class implements the <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> interface and is able to bootstrap Spring’s <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>        from the configurations defined in XML files.</div>
    <div class="Para" id="Par103">You can swap the <span class="EmphasisFontCategoryNonProportional">app-context-xml.xml</span> file with <span class="EmphasisFontCategoryNonProportional">app-context-annotation.xml</span> in the provided source code for this chapter, and you will
        find that both cases produce the same result: “Hello World!” is printed. The only difference is that after the swap the beans providing the functionality are the ones defined with annotations in the <span class="EmphasisFontCategoryNonProportional">com.apress.prospring5.ch3.annotation</span>        package.</div>
    <div class="Section3 RenderAsSection3" id="Sec18">
        <h4 class="Heading">Using <span id="ITerm42">Java Configuration                          </span> </h4>
        <div class="Para" id="Par104">In Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Chapter.html"><span class="RefSource">1</span></a>
            </span> we mentioned that <span class="EmphasisFontCategoryNonProportional">app-context-xml.xml</span> can be replaced with a configuration class, without modifying the classes representing the bean types being created. This is useful when the bean
            types that the application needs are part of third-party libraries that cannot be modified. Such a configuration class is annotated with <span class="EmphasisFontCategoryNonProportional">@Configuration</span> and contains methods annotated
            with <span class="EmphasisFontCategoryNonProportional">@Bean</span> that are called directly by the Spring IoC container to instantiate the beans. The bean name will be the same as the name of the method used to create it. The class is shown
            in the following code sample, and the method names are underlined to make obvious how the resulting beans will be named:</div>
        <div class="Para" id="Par105">
            <div class="ProgramCode" id="PC22">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.annotated</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.HelloWorldMessageProvider</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageProvider</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageRenderer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.StandardOutMessageRenderer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Bean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Configuration</span>;@<span style="color:#00f;font-weight:700">Configuration</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">HelloWorldConfiguration</span> {
    
    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">MessageProvider</span> <span style="color:#0000a2;font-weight:700">provider</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HelloWorldMessageProvider</span>();
    }
    
    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">MessageRenderer</span> <span style="color:#0000a2;font-weight:700">renderer</span>() {
        <span style="color:#00f;font-weight:700">MessageRenderer</span> renderer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">StandardOutMessageRenderer</span>();
        renderer<span style="color:#00f;font-weight:700">.</span>setMessageProvider(provider());
        <span style="color:#00f;font-weight:700">return</span> renderer;
    }
}
</pre></div>
                </div>
            </div>
        </div>
        <div class="Para ParaOneEmphasisChild" id="Par106">To read the configuration from this class, a different implementation of <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> is needed.</div>
        <div class="Para" id="Par107">
            <div class="ProgramCode" id="PC23">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.annotated</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageRenderer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.ApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.AnnotationConfigApplicationContext</span>;
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">HelloWorldSpringAnnotated</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>...<span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">ApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">HelloWorldConfiguration</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">MessageRenderer</span> mr <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">renderer</span>, <span style="color:#00f;font-weight:700">MessageRenderer</span><span style="color:#00f;font-weight:700">.</span>class);
        mr<span style="color:#00f;font-weight:700">.</span>render();
    }
}
</pre></div>
            </div>
        </div>
    </div>
    <div class="Para" id="Par108">Instead of <span class="EmphasisFontCategoryNonProportional">DefaultListableBeanFactory</span>, an instance of <span class="EmphasisFontCategoryNonProportional">AnnotationConfigApplicationContext</span> is instantiated. The <span class="EmphasisFontCategoryNonProportional">AnnotationConfigApplicationContext</span>        class implements the <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> interface and is able to bootstrap Spring’s <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> from the configurations defined
        by the <span class="EmphasisFontCategoryNonProportional">HelloWorldConfiguration</span> class. <span id="ITerm44">                                                    </span> </div>
    <div class="Para" id="Par109">A configuration class can be used to read the annotated beans definitions as well. In this case, because the bean’s definition configuration is part of the bean class, the class will no longer need any <span class="EmphasisFontCategoryNonProportional">@Bean</span>        annotated methods. But, to be able to look for bean definitions inside Java classes, component scanning has to be enabled. This is done by annotating the configuration class with an annotation that is the equivalent of the <span class="EmphasisFontCategoryNonProportional">&lt;context:component-scanning ../&gt;</span>        element. This annotation is <span class="EmphasisFontCategoryNonProportional">@ComponentScanning</span> and has the same parameters as the XML analogous element.</div>
    <div class="Para" id="Par110">
        <div class="ProgramCode" id="PC24">
            <div class="LineGroup">
                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.annotation</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.ComponentScan</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Configuration</span>;

@ComponentScan(basePackages <span style="color:#00f;font-weight:700">=</span> {
    <span style="color:#036a07">com.apress.prospring5.ch3.annotation</span>
})
@<span style="color:#00f;font-weight:700">Configuration</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">HelloWorldConfiguration</span> {}
</pre></div>
            </div>
        </div>
    </div>
    <div class="Para ParaOneEmphasisChild" id="Par111">The code to bootstrap a Spring environment using <span class="EmphasisFontCategoryNonProportional">AnnotationConfigApplicationContext</span> will work with this class too, with no additional changes.</div>
    <div class="Para" id="Par112">In real-life production applications, there might be legacy code, developed with older versions of Spring, or requirements might be of such a nature that require XML and configuration classes. Fortunately, XML and Java configuration can be mixed in
        more than one way. For example, a configuration class can import bean definitions from an XML file (or more) using <span class="EmphasisFontCategoryNonProportional">@ImportResource</span>, and the same bootstrapping using <span class="EmphasisFontCategoryNonProportional">AnnotationConfigApplicationContext</span>        will work in this case as well.</div>
    <div class="Para" id="Par113">
        <div class="ProgramCode" id="PC25">
            <div class="LineGroup">
                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.mixed</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.ComponentScan</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Configuration</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.ImportResource</span>;
@ImportResource(locations <span style="color:#00f;font-weight:700">=</span> {
    <span style="color:#036a07">classpath:spring/app-context-xml.xml</span>
})
@<span style="color:#00f;font-weight:700">Configuration</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">HelloWorldConfiguration</span> {}
</pre></div>
            </div>
        </div>
    </div>
    <div class="Para" id="Par114">So, Spring allows you to be really creative when defining your beans; you’ll learn more about this in Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Chapter.html"><span class="RefSource">4</span></a>
        </span>, which is focused solely on Spring application <span id="ITerm45">configuration                          </span>.</div>
    </div>
    <div class="Section3 RenderAsSection3" id="Sec19">
        <h4 class="Heading">Using Setter Injection</h4>
        <div class="Para" id="Par115">To configure <span id="ITerm46">setter injection                          </span> by using XML configuration, you need to specify <span class="EmphasisFontCategoryNonProportional">&lt;property&gt;</span> tags under the <span class="EmphasisFontCategoryNonProportional">&lt;bean&gt;</span>            tag for each <span class="EmphasisFontCategoryNonProportional">&lt;property&gt;</span> into which you want to inject a dependency. For example, to assign the message provider bean to the <span class="EmphasisFontCategoryNonProportional">messageProvider</span>            property of the <span class="EmphasisFontCategoryNonProportional">messageRenderer</span> bean, you simply change the <span class="EmphasisFontCategoryNonProportional">&lt;bean&gt;</span> tag for the <span class="EmphasisFontCategoryNonProportional">renderer</span>            bean, as shown in the following code snippet:</div>
        <div class="Para" id="Par116">
            <div class="ProgramCode" id="PC26">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">renderer</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch2.decoupled.StandardOutMessageRenderer</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">property</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">messageProvider</span> <span style="font-style:italic">ref</span>=<span style="color:#036a07">provider</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">bean</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">provider</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch2.decoupled.HelloWorldMessageProvider</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
                </div>
            </div>
        </div>
        <div class="Para" id="Par117">From this code, we can see that the <span class="EmphasisFontCategoryNonProportional">provider</span> bean is assigned to the <span class="EmphasisFontCategoryNonProportional">messageProvider</span> property. You can use the <span class="EmphasisFontCategoryNonProportional">ref</span>            attribute to assign a bean reference to a property (discussed in more detail shortly).</div>
        <div class="Para ParaOneEmphasisChild" id="Par118">If you are using Spring 2.5 or newer and have the <span class="EmphasisFontCategoryNonProportional">p namespace</span> declared in your XML configuration file, you can declare the injection as shown in the following code snippet:</div>
        <div class="Para" id="Par119">
            <div class="ProgramCode" id="PC27">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#68685b">&lt;?<span style="color:#888">xml</span><span style="color:#888"> version</span>=<span style="color:#888">1.0</span><span style="color:#888"> encoding</span>=<span style="color:#888">UTF-8</span>?&gt;</span>
<span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span>
    <span style="font-style:italic">xmlns</span>=<span style="color:#036a07">http://www.springframework.org/schema/beans</span>
    <span style="font-style:italic">xmlns</span>:xsi=<span style="color:#036a07">http://www.w3.org/2001/XMLSchema-instance</span>
    <span style="font-style:italic">xmlns</span>:p=<span style="color:#036a07">http://www.springframework.org/schema/p</span>
       <span style="font-style:italic">xsi</span>:schemaLocation=<span style="color:#036a07">http://www.springframework.org/schema/beans
          http://www.springframework.org/schema/beans/spring-beans.xsd</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">renderer</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch2.decoupled.StandardOutMessageRenderer</span>
        <span style="font-style:italic">p</span>:messageProvider-ref=<span style="color:#036a07">provider</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">provider</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch2.decoupled.HelloWorldMessageProvider</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
                </div>
            </div>
        </div>
        <div class="Para ParaTypeImportant" id="Par120"> <img alt="A315511_5_En_3_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" width="30"/>            The <span class="EmphasisFontCategoryNonProportional">p namespace</span> is not defined in an XSD file and exists only in Spring core; therefore, no XSD is declared in the <span class="EmphasisFontCategoryNonProportional">schemaLocation</span>            attribute.</div>
        <div class="Para ParaOneEmphasisChild" id="Par121">With annotations, it’s even simpler. You just need to add an <span class="EmphasisFontCategoryNonProportional">@Autowired</span> annotation to the setter method, as shown in the following code snippet:</div>
        <div class="Para" id="Par122">
            <div class="ProgramCode" id="PC28">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.annotation</span>;
.<span style="color:#00f;font-weight:700">.</span>.
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Autowired</span>;
@Service(<span style="color:#036a07">renderer</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">StandardOutMessageRenderer</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">MessageRenderer</span> {
    .<span style="color:#00f;font-weight:700">.</span>.
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setMessageProvider</span>(<span style="color:#00f;font-weight:700">MessageProvider</span> <span style="font-style:italic">provider</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>messageProvider <span style="color:#00f;font-weight:700">=</span> provider;
    }
}
</pre></div>
                </div>
            </div>
        </div>
        <div class="Para" id="Par123">Since we declared the <span class="EmphasisFontCategoryNonProportional">&lt;context:component-scan&gt;</span> tag in the XML configuration file, during the initialization of Spring’s <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>,
            Spring will discover those <span class="EmphasisFontCategoryNonProportional">@Autowired</span> annotations and inject the dependency as required.</div>
        <div class="Para ParaTypeImportant" id="Par124"> <img alt="A315511_5_En_3_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" width="30"/>            Instead of <span class="EmphasisFontCategoryNonProportional">@Autowired</span>, you can use <span class="EmphasisFontCategoryNonProportional">@Resource(name=&quot;messageProvider&quot;)</span> to achieve the same result. <span class="EmphasisFontCategoryNonProportional">@Resource</span>            is one of the annotations in the JSR-250 standard that defines a common set of Java annotations for use on both JSE and JEE platforms. Different from <span class="EmphasisFontCategoryNonProportional">@Autowired</span>, the <span class="EmphasisFontCategoryNonProportional">@Resource</span>            annotation supports the <span class="EmphasisFontCategoryNonProportional">name</span> parameter for more fine-grained DI requirements. Additionally, Spring supports use of the <span class="EmphasisFontCategoryNonProportional">@Inject</span>            annotation introduced as part of JSR-299 (Contexts and Dependency Injection for the Java EE Platform). <span class="EmphasisFontCategoryNonProportional">@Inject</span> is equivalent in behavior to Spring’s <span class="EmphasisFontCategoryNonProportional">@Autowired</span>            annotation.</div>
        <div class="Para" id="Par125">To verify the result, you can use <span class="EmphasisFontCategoryNonProportional">DeclareSpringComponents</span> that was presented earlier. As in the previous section, you can swap the <span class="EmphasisFontCategoryNonProportional">app-context-xml.xml</span>            file with <span class="EmphasisFontCategoryNonProportional">app-context-annotation.xml</span> in the provided source code for this <span id="ITerm48">chapter                          </span>, and you will find that both cases produce the same
            result: “Hello World!” is printed.</div>
    </div>
    <div class="Section3 RenderAsSection3" id="Sec20">
        <h4 class="Heading">Using <span id="ITerm49">Constructor Injection                          </span> </h4>
        <div class="Para" id="Par126">In the previous example, the <span class="EmphasisFontCategoryNonProportional">MessageProvider</span> implementation, <span class="EmphasisFontCategoryNonProportional">HelloWorldMessageProvider</span>, returned the same hard-coded message for
            each call of the <span class="EmphasisFontCategoryNonProportional">getMessage()</span> method. In the Spring configuration file, you can easily create a configurable <span class="EmphasisFontCategoryNonProportional">MessageProvider</span>            that allows the message to be defined externally, as shown in the following code snippet:</div>
        <div class="Para" id="Par127">
            <div class="ProgramCode" id="PC29">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.xml</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageProvider</span>;
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">ConfigurableMessageProvider</span>
<span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">MessageProvider</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> message;
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">ConfigurableMessageProvider</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">message</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>message <span style="color:#00f;font-weight:700">=</span> message;
    }
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getMessage</span>() {
        <span style="color:#00f;font-weight:700">return</span> message;
    }
}
</pre></div>
                </div>
            </div>
        </div>
        <div class="Para" id="Par128">As you can see, it is impossible to create an instance of <span class="EmphasisFontCategoryNonProportional">ConfigurableMessageProvider</span> without providing a value for the message (unless you supply <span class="EmphasisFontCategoryNonProportional">null</span>).
            This is exactly what we want, and this class is ideally suited for use with <span class="EmphasisTypeItalic">constructor injection</span>. The following code snippet shows how you can redefine the <span class="EmphasisFontCategoryNonProportional">provider</span>            bean definition to create an instance of <span class="EmphasisFontCategoryNonProportional">ConfigurableMessageProvider</span> <span class="EmphasisTypeItalic">,</span> injecting the message by using constructor injection:</div>
        <div class="Para" id="Par129">
            <div class="ProgramCode" id="PC30">
                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span>
    <span style="font-style:italic">xmlns</span>=<span style="color:#036a07">http://www.springframework.org/schema/beans</span>
    <span style="font-style:italic">xmlns</span>:xsi=<span style="color:#036a07">http://www.w3.org/2001/XMLSchema-instance</span>
       <span style="font-style:italic">xsi</span>:schemaLocation=<span style="color:#036a07">http://www.springframework.org/schema/beans
          http://www.springframework.org/schema/beans/spring-beans.xsd</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">messageProvider</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.xml.ConfigurableMessageProvider</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">constructor-arg</span> <span style="font-style:italic">value</span>=<span style="color:#036a07">I hope that someone gets my message in a bottle</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">bean</span>&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
            </div>
        </div>
        <div class="Para" id="Par130">In this code, instead of using a <span class="EmphasisFontCategoryNonProportional">&lt;property&gt;</span> tag, we used a <span class="EmphasisFontCategoryNonProportional">&lt;constructor-arg&gt;</span> tag. Because we are not passing in another
            bean this time, just a <span class="EmphasisFontCategoryNonProportional">String</span> literal, we use the <span class="EmphasisFontCategoryNonProportional">value</span> attribute instead of <span class="EmphasisFontCategoryNonProportional">ref</span>            to specify the value for the constructor argument. When you have more than one constructor argument or your class has more than one constructor, you need to give each <span class="EmphasisFontCategoryNonProportional">&lt;constructor-arg&gt;</span>            tag an index attribute to specify the index of the argument, starting at 0, in the constructor signature. It is always best to use the index attribute whenever you are dealing with constructors that have multiple arguments, to avoid confusion
            between the parameters and ensure that Spring picks the correct constructor.</div>
        <div class="Para" id="Par131">In addition to the <span class="EmphasisFontCategoryNonProportional">p</span> namespace, as of Spring 3.1, you can also use the <span class="EmphasisFontCategoryNonProportional">c</span> namespace, as shown here:</div>
        <div class="Para" id="Par132">
            <div class="ProgramCode" id="PC31">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span>
    <span style="font-style:italic">xmlns</span>=<span style="color:#036a07">http://www.springframework.org/schema/beans</span>
    <span style="font-style:italic">xmlns</span>:xsi=<span style="color:#036a07">http://www.w3.org/2001/XMLSchema-instance</span>
    <span style="font-style:italic">xmlns</span>:c=<span style="color:#036a07">http://www.springframework.org/schema/c</span>
    <span style="font-style:italic">xsi</span>:schemaLocation=<span style="color:#036a07">http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans.xsd</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">provider</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.xml.ConfigurableMessageProvider</span>
        <span style="font-style:italic">c</span>:message=<span style="color:#036a07">I hope that someone gets my message in a bottle</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
                </div>
            </div>
        </div>
        <div class="Para ParaTypeImportant" id="Par133"> <img alt="A315511_5_En_3_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" width="30"/>            The <span class="EmphasisFontCategoryNonProportional">c</span> namespace is not defined in an XSD file either and exists only in Spring Core; therefore, no XSD is declared in the <span class="EmphasisFontCategoryNonProportional">schemaLocation</span>            attribute.</div>
        <div class="Para" id="Par134">To use an <span id="ITerm51">annotation                           </span>for constructor injection, we also use the <span class="EmphasisFontCategoryNonProportional">@Autowired</span> annotation in the target bean’s constructor method, which is
            an alternative option to the one using setter injection, as shown in the following code snippet:</div>
        <div class="Para" id="Par135">
            <div class="ProgramCode" id="PC32">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.annotated</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageProvider</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Autowired</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Service</span>;
@Service(<span style="color:#036a07">provider</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">ConfigurableMessageProvider</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">MessageProvider</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> message;
    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">ConfigurableMessageProvider</span>(
        (@<span style="color:#00f;font-weight:700">Value</span>(&quot;<span style="color:#00f;font-weight:700">Configurable</span> <span style="font-style:italic">message</span>&quot;) String message) {
            <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>message <span style="color:#00f;font-weight:700">=</span> message;
        }
        <span style="color:#00f;font-weight:700">@Override</span> <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getMessage</span>() {
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>message;
        }
    }
</pre></div>
                </div>
            </div>
        </div>
        <div class="Para ParaOneEmphasisChild" id="Par136">From the previous code, we can see that we use another annotation, <span class="EmphasisFontCategoryNonProportional">@Value</span>, to define the value to be injected into the constructor. This is the way in Spring we inject values into a bean.
            Besides simple strings, we can use the powerful SpEL for dynamic value injection (more on this later in this chapter).</div>
        <div class="Para" id="Par137">However, hard-coding the value in the code is not a good idea; to change it, we would need to recompile the program. Even if you choose annotation-style DI, a good practice is to externalize those values for injection. To externalize the message,
            let’s define the message as a Spring bean in the annotation configuration file, as shown in the following code snippet:</div>
        <div class="Para" id="Par138">
            <div class="ProgramCode" id="PC33">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">context</span><span style="font-weight:700">:</span><span style="font-weight:700">component-scan</span>
          <span style="font-style:italic">base-package</span>=<span style="color:#036a07">com.apress.prospring5.ch3.annotated</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">message</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">java.lang.String</span>
          <span style="font-style:italic">c</span>:_0=<span style="color:#036a07">I hope that someone gets my message in a bottle</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
                </div>
            </div>
        </div>
        <div class="Para" id="Par139">Here we define a bean with an <span id="ITerm52">ID                          </span> of <span class="EmphasisFontCategoryNonProportional">message</span> and type of <span class="EmphasisFontCategoryNonProportional">java.lang.String</span>. Notice
            that we also use the <span class="EmphasisFontCategoryNonProportional">c</span> namespace for constructor injection to set the string value, and <span class="EmphasisFontCategoryNonProportional">_0</span> indicates the index for the constructor
            argument. Having the bean declared, we can take away the <span class="EmphasisFontCategoryNonProportional">@Value</span> annotation from the target bean, as shown in the following code snippet:</div>
        <div class="Para" id="Par140">
            <div class="ProgramCode" id="PC34">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.annotated</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageProvider</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Autowired</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Service</span>;
@Service(<span style="color:#036a07">provider</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">ConfigurableMessageProvider</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">MessageProvider</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> message;
    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">ConfigurableMessageProvider</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">message</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>message <span style="color:#00f;font-weight:700">=</span> message;
    }
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getMessage</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>message;
    }
}
</pre></div>
                </div>
            </div>
        </div>
        <div class="Para" id="Par141">Since we declare that the message bean and its ID are the same as the name of the argument specified in the constructor, Spring will detect the annotation and inject the value into the constructor method. Now run the test by using the following
            code against both the XML (<span class="EmphasisFontCategoryNonProportional">app-context.xml.xml</span>) and annotation configurations (<span class="EmphasisFontCategoryNonProportional">app-context-annotation.xml</span>), and the configured
            message will be displayed in both cases:</div>
        <div class="Para" id="Par142">
            <div class="ProgramCode" id="PC35">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageProvider</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">DeclareSpringComponents</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>...<span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-annotation.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">MessageProvider</span> messageProvider <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">provider</span>, <span style="color:#00f;font-weight:700">MessageProvider</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(messageProvider<span style="color:#00f;font-weight:700">.</span>getMessage());
    }
}
</pre></div>
                </div>
            </div>
        </div>
        <div class="Para" id="Par143">In some cases, Spring finds it impossible to tell which constructor we want it to use for constructor injection. This usually arises when we have two constructors with the same number of arguments and the types used in the arguments are represented
            in the same way. Consider the following code:</div>
        <div class="Para" id="Par144">
            <div class="ProgramCode" id="PC36">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.xml</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">ConstructorConfusion</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> someValue;
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">ConstructorConfusion</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">someValue</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">ConstructorConfusion(String) called</span>);
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>someValue <span style="color:#00f;font-weight:700">=</span> someValue;
    }
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">ConstructorConfusion</span>(<span style="color:#00f;font-weight:700">int</span> <span style="font-style:italic">someValue</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">ConstructorConfusion(int) called</span>);
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>someValue <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">Number: </span> <span style="color:#00f;font-weight:700">+</span> <span style="color:#00f;font-weight:700">Integer</span><span style="color:#00f;font-weight:700">.</span>toString(someValue);
    }
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">toString</span>() {
        <span style="color:#00f;font-weight:700">return</span> someValue;
    }
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>...<span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-xml.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">ConstructorConfusion</span> cc <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">ConstructorConfusion</span>)
        ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">constructorConfusion</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(cc);
        ctx<span style="color:#00f;font-weight:700">.</span>close
    }
}
</pre></div>
                </div>
            </div>
        </div>
        <div class="Para" id="Par145">This simply retrieves a bean of type <span class="EmphasisFontCategoryNonProportional">ConstructorConfusion</span> from <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> and <span id="ITerm54">writes                           </span>the
            value to console output. Now look at the following configuration code:</div>
        <div class="Para" id="Par146">
            <div class="ProgramCode" id="PC37">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">provider</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.xml.ConfigurableMessageProvider</span>
        <span style="font-style:italic">c</span>:message=<span style="color:#036a07">I hope that someone gets my message in a bottle</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">constructorConfusion</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.xml.ConstructorConfusion</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">constructor-arg</span>&gt;</span>
            <span style="color:#1c02ff">&lt;<span style="font-weight:700">value</span>&gt;</span>90<span style="color:#1c02ff">&lt;/<span style="font-weight:700">value</span>&gt;</span>
        <span style="color:#1c02ff">&lt;/<span style="font-weight:700">constructor-arg</span>&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">bean</span>&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
                </div>
            </div>
        </div>
        <div class="Para" id="Par147">Which of the constructors is called in this case? Running the example yields the following output:</div>
        <div class="Para" id="Par148">
            <div class="ProgramCode" id="PC38">
                <div class="FixedLine">ConstructorConfusion(String) called</div>
            </div>
        </div>
        <div class="Para" id="Par149">This shows that the constructor with the <span class="EmphasisFontCategoryNonProportional">String</span> argument is called. This is not the desired effect, since we want to prefix any integer values passed in by using constructor injection with
            <span class="EmphasisFontCategoryNonProportional">Number:</span>, as shown in the <span class="EmphasisFontCategoryNonProportional">int</span> constructor. To get around this, we need to make a small modification to the configuration, as shown
            in the following code snippet:</div>
        <div class="Para" id="Par150">
            <div class="ProgramCode" id="PC39">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">provider</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.xml.ConfigurableMessageProvider</span>
        <span style="font-style:italic">c</span>:message=<span style="color:#036a07">I hope that someone gets my message in a bottle</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">constructorConfusion</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.xml.ConstructorConfusion</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">constructor-arg</span> <span style="font-style:italic">type</span>=<span style="color:#036a07">int</span>&gt;</span>
            <span style="color:#1c02ff">&lt;<span style="font-weight:700">value</span>&gt;</span>90<span style="color:#1c02ff">&lt;/<span style="font-weight:700">value</span>&gt;</span>
        <span style="color:#1c02ff">&lt;/<span style="font-weight:700">constructor-arg</span>&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">bean</span>&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
                </div>
            </div>
        </div>
        <div class="Para" id="Par151">Notice now that the <span class="EmphasisFontCategoryNonProportional">&lt;constructor-arg&gt;</span> tag has an additional attribute, <span class="EmphasisFontCategoryNonProportional">type</span>, that specifies the type of argument Spring should
            look for. Running the example again with the corrected configuration yields the correct output.</div>
        <div class="Para" id="Par152">
            <div class="ProgramCode" id="PC40">
                <div class="FixedLine">ConstructorConfusion(int) called</div>
                <div class="FixedLine">Number: 90</div>
            </div>
        </div>
        <div class="Para" id="Par153">For annotation-style construction injection, the confusion can be avoided by applying the annotation directly to the target constructor method, as shown in the following code snippet:</div>
        <div class="Para" id="Par154">
            <div class="ProgramCode" id="PC41">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.annotated</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Autowired</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Value</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Service</span>;

@Service(<span style="color:#036a07">constructorConfusion</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">ConstructorConfusion</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> someValue;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">ConstructorConfusion</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">someValue</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">ConstructorConfusion(String) called</span>);
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>someValue <span style="color:#00f;font-weight:700">=</span> someValue;
    }

    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">ConstructorConfusion</span>(@<span style="color:#00f;font-weight:700">Value</span>(&quot;<span style="font-style:italic">90</span>&quot;) int someValue) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">ConstructorConfusion(int) called</span>);
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>someValue <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">Number: </span> <span style="color:#00f;font-weight:700">+</span> <span style="color:#00f;font-weight:700">Integer</span><span style="color:#00f;font-weight:700">.</span>toString(someValue);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">toString</span>() {
        <span style="color:#00f;font-weight:700">return</span> someValue;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-annotation.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">ConstructorConfusion</span> cc <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">ConstructorConfusion</span>)
                ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">constructorConfusion</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(cc);
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre></div>
                </div>
            </div>
        </div>
        <div class="Para ParaOneEmphasisChild" id="Par155">By applying the <span class="EmphasisFontCategoryNonProportional">@Autowired</span> annotation to the desired constructor method, Spring will use that method to instantiate the bean and inject the value as specified. As before, we should externalize
            the value from the configuration.</div>
        <div class="Para ParaTypeImportant" id="Par156"> <img alt="A315511_5_En_3_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" width="30"/>            The <span class="EmphasisFontCategoryNonProportional">@Autowired</span> annotation can be applied to only one of the constructor methods. If we apply the annotation to more than one constructor method, Spring will complain while bootstrapping
            <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>.</div>
    </div>
    <div class="Section3 RenderAsSection3" id="Sec21">
        <h4 class="Heading">Using <span id="ITerm57">Field Injection            </span> <span id="ITerm58">                                                    </span> </h4>
        <div class="Para" id="Par157">There is a third type of dependency injection supported in Spring called <span class="EmphasisTypeItalic">field injection</span>. As the name says, the dependency is injected directly in the field, with no constructor or setter needed. This is
            done by annotating the class member with the <span class="EmphasisFontCategoryNonProportional">Autowired</span> annotation. This might seem practical, because when the dependency is not needed outside of the object it is part of, it relieves
            the developer of <span id="ITerm59">writing            </span> <span id="ITerm60">                                                    </span> some code that is no longer used after the initial creation of the bean. In the following code snippet,
            the bean of type <span class="EmphasisFontCategoryNonProportional">Singer</span> has a field of type <span class="EmphasisFontCategoryNonProportional">Inspiration</span>:</div>
        <div class="Para" id="Par158">
            <div class="ProgramCode" id="PC42">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.annotated</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Autowired</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Service</span>;

@Service(<span style="color:#036a07">singer</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Singer</span> {
    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Inspiration</span> inspirationBean;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">sing</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">... </span> <span style="color:#00f;font-weight:700">+</span> inspirationBean<span style="color:#00f;font-weight:700">.</span>getLyric());
    }
}
</pre></div>
                </div>
            </div>
        </div>
        <div class="Para" id="Par159">The field is private, but the Spring IoC container does not really care about that; it uses reflection to populate the required dependency. The <span class="EmphasisFontCategoryNonProportional">Inspiration</span> class code is shown here; it is
            a simple bean with a <span class="EmphasisFontCategoryNonProportional">String</span> member:</div>
        <div class="Para" id="Par160">
            <div class="ProgramCode" id="PC43">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.annotated</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Value</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Component</span>;

@<span style="color:#00f;font-weight:700">Component</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Inspiration</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> lyric <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#036a07">I can keep the door cracked open, to let light through</span>;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">Inspiration</span>(
            @<span style="color:#00f;font-weight:700">Value</span>(&quot;<span style="color:#00f;font-weight:700">For</span> <span style="font-style:italic">all</span> <span style="font-style:italic">my</span> <span style="font-style:italic">running</span>, <span style="color:#00f;font-weight:700">I</span> <span style="font-style:italic">can</span> <span style="font-style:italic">understand</span>&quot;) String lyric) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>lyric <span style="color:#00f;font-weight:700">=</span> lyric;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getLyric</span>() {
        <span style="color:#00f;font-weight:700">return</span> lyric;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setLyric</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">lyric</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>lyric <span style="color:#00f;font-weight:700">=</span> lyric;
    }
}
</pre></div>
                </div>
            </div>
        </div>
        <div class="Para" id="Par161">The following <span id="ITerm61">configuration            </span> <span id="ITerm62">                                                    </span> uses component scanning to discover the bean definitions that will be created by the Spring IoC container:</div>
        <div class="Para" id="Par162">
            <div class="ProgramCode" id="PC44">
                <div class="FixedLine">&lt;beans ...&gt;</div>
                <div class="FixedLine">    &lt;context:component-scan</div>
                <div class="FixedLine">            base-package=&quot;com.apress.prospring5.ch3.annotated&quot;/&gt;</div>
                <div class="FixedLine">&lt;/beans&gt;</div>
            </div>
    </div>
    <div class="Para" id="Par163">Finding one bean of type <span class="EmphasisFontCategoryNonProportional">Inspiration</span>, the Spring IoC container will inject that bean in the <span class="EmphasisFontCategoryNonProportional">inspirationBean</span> member of the <span class="EmphasisFontCategoryNonProportional">singer</span>        bean. That is why when running the example depicted in the next code snippet, “For all my running, I can understand” will be printed in the console.</div>
    <div class="Para" id="Par164">
        <div class="ProgramCode" id="PC45">
            <div class="LineGroup">
                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.annotated</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">FieldInjection</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">Singer</span> singerBean <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">Singer</span><span style="color:#00f;font-weight:700">.</span>class);
        singerBean<span style="color:#00f;font-weight:700">.</span>sing();
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre></div>
            </div>
        </div>
    </div>
    <div class="Para" id="Par165">But there are drawbacks, and this is why using field injection is usually avoided.
        <div class="UnorderedList">
            <ul class="UnorderedListMarkBullet">
                <li>
                    <div class="Para" id="Par166">Although it is easy to add dependencies this way, we must be careful not to violate the single responsibility principle. Having more dependencies means more responsibilities for a class, which might lead to a difficulty of separating
                        concerns at refactoring time. The situation when a class becomes bloated is easier to see when dependencies are set using constructors or setters but is quite well hidden when using field injection.</div>
                </li>
                <li>
                    <div class="Para" id="Par167">The responsibility of <span id="ITerm63">injecting                  </span> <span id="ITerm64">                                                                      </span> dependencies is passed to the container in Spring, but the
                        class should clearly communicate the type of dependencies needed using a public interface, through methods or constructors. Using field injections, it can become unclear what type of dependency is really needed and if the dependency
                        is mandatory or not.</div>
                </li>
                <li>
                    <div class="Para ParaOneEmphasisChild" id="Par168">Field injection introduces a dependency of the Spring container, as the <span class="EmphasisFontCategoryNonProportional">@Autowired</span> annotation is a Spring component; thus, the bean is no longer a POJO and cannot be instantiated
                        independently.</div>
                </li>
                <li>
                    <div class="Para" id="Par169">Field injection cannot be used for final fields. This type of fields can only be initialized using constructor injection.</div>
                </li>
                <li>
                    <div class="Para" id="Par170">Field injection introduces difficulties when writing tests as the dependencies have to be injected manually.</div>
                </li>
            </ul>
        </div>
    </div>
    </div>
    <div class="Section3 RenderAsSection3" id="Sec22">
        <h4 class="Heading">Using <span id="ITerm65">Injection Parameters                          </span> </h4>
        <div class="Para" id="Par171">In the three previous examples, you saw how to inject other components and values into a bean by using both setter injection and constructor injection. Spring supports a myriad of options for injection parameters, allowing you to inject not only
            other components and simple values but also Java collections, externally defined properties, and even beans in another factory. You can use all of these injection parameter types for both setter injection and constructor injection by using
            the corresponding tag under the <span class="EmphasisFontCategoryNonProportional">&lt;property&gt;</span> and <span class="EmphasisFontCategoryNonProportional">&lt;constructor-args&gt;</span> tags, respectively.</div>
    </div>
    <div class="Section3 RenderAsSection3" id="Sec23">
        <h4 class="Heading">Injecting Simple Values</h4>
        <div class="Para" id="Par172"> <span id="ITerm66">Injecting simple values                          </span> into your beans is easy. To do so, simply specify the value in the configuration tag, wrapped inside a <span class="EmphasisFontCategoryNonProportional">&lt;value&gt;</span>            tag. By default, not only can the <span class="EmphasisFontCategoryNonProportional">&lt;value&gt;</span> tag read <span class="EmphasisFontCategoryNonProportional">String</span> values, but it can also convert these values to any primitive
            or primitive wrapper class. The following code snippet shows a simple bean that has a variety of properties exposed for injection:</div>
        <div class="Para" id="Par173">
            <div class="ProgramCode" id="PC46">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.xml</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">InjectSimple</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> name;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">int</span> age;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">float</span> height;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">boolean</span> programmer;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Long</span> ageInSeconds;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-xml.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">InjectSimple</span> simple <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">InjectSimple</span>) ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">injectSimple</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(simple);
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setAgeInSeconds</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">ageInSeconds</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>ageInSeconds <span style="color:#00f;font-weight:700">=</span> ageInSeconds;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setProgrammer</span>(<span style="color:#00f;font-weight:700">boolean</span> <span style="font-style:italic">programmer</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>programmer <span style="color:#00f;font-weight:700">=</span> programmer;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setAge</span>(<span style="color:#00f;font-weight:700">int</span> <span style="font-style:italic">age</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>age <span style="color:#00f;font-weight:700">=</span> age;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setHeight</span>(<span style="color:#00f;font-weight:700">float</span> <span style="font-style:italic">height</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>height <span style="color:#00f;font-weight:700">=</span> height;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setName</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">name</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>name <span style="color:#00f;font-weight:700">=</span> name;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">toString</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">Name: </span> <span style="color:#00f;font-weight:700">+</span> name <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span>&quot;</span>
                <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">Age: </span> <span style="color:#00f;font-weight:700">+</span> age <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span>&quot;</span>
                <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">Age in Seconds: </span> <span style="color:#00f;font-weight:700">+</span> ageInSeconds <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span>&quot;</span>
                <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">Height: </span> <span style="color:#00f;font-weight:700">+</span> height <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span>&quot;</span>
                <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">Is Programmer?: </span> <span style="color:#00f;font-weight:700">+</span> programmer;
    }
}
</pre></div>
    </div>
    </div>
    </div>
    <div class="Para" id="Par174">In addition to the properties, the <span class="EmphasisFontCategoryNonProportional">InjectSimple</span> class also defines the <span class="EmphasisFontCategoryNonProportional">main()</span> method that creates an <span class="EmphasisFontCategoryNonProportional">Application Context</span>        and then retrieves an <span class="EmphasisFontCategoryNonProportional">InjectSimple</span> bean from Spring. The property values of this bean are then written to the console output. The configuration contained in <span class="EmphasisFontCategoryNonProportional">app-context-xml.xml</span>        for this bean is depicted in the following snippet:</div>
    <div class="Para" id="Par175">
        <div class="ProgramCode" id="PC47">
            <div class="LineGroup">
                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">injectSimpleConfig</span>
         <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.xml.InjectSimpleConfig</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">injectSimpleSpel</span>
         <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.xml.InjectSimpleSpel</span>
        <span style="font-style:italic">p</span>:name=<span style="color:#036a07">John Mayer</span>
        <span style="font-style:italic">p</span>:age=<span style="color:#036a07">39</span>
        <span style="font-style:italic">p</span>:height=<span style="color:#036a07">1.92</span>
        <span style="font-style:italic">p</span>:programmer=<span style="color:#036a07">false</span>
        <span style="font-style:italic">p</span>:ageInSeconds=<span style="color:#036a07">1241401112</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
            </div>
        </div>
    </div>
    <div class="Para" id="Par176">You can see from the two previous code snippets that it is possible to define properties on your bean that accept <span class="EmphasisFontCategoryNonProportional">String</span> values, primitive values, or primitive wrapper values and then inject
        values for these properties by using the <span class="EmphasisFontCategoryNonProportional">&lt;value&gt;</span> tag. Here is the output created by running this example as expected:</div>
    <div class="Para" id="Par177">
        <div class="ProgramCode" id="PC48">
            <div class="FixedLine">Name: John Mayer</div>
            <div class="FixedLine">Age: 39</div>
            <div class="FixedLine">Age in Seconds: 1241401112</div>
            <div class="FixedLine">Height: 1.92</div>
            <div class="FixedLine">Is Programmer?: false</div>
        </div>
    </div>
    <div class="Para" id="Par178">For annotation-style simple value injection, we can apply the <span class="EmphasisFontCategoryNonProportional">@Value</span> annotation to the bean properties. This time, instead of the setter method, we apply the annotation to the property declaration
        statement, as we can see in the following code snippet (Spring supports the annotation either at the setter method or in the properties): <span id="ITerm69">                                                    </span> </div>
    <div class="Para" id="Par179">
        <div class="ProgramCode" id="PC49">
            <div class="LineGroup">
                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.annotated</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Value</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Service</span>;

@Service(<span style="color:#036a07">injectSimple</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">InjectSimple</span> {
    <span style="color:#00f;font-weight:700">@Value</span>(<span style="color:#036a07">John Mayer</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> name;
    <span style="color:#00f;font-weight:700">@Value</span>(<span style="color:#036a07">39</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">int</span> age;
    <span style="color:#00f;font-weight:700">@Value</span>(<span style="color:#036a07">1.92</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">float</span> height;
    <span style="color:#00f;font-weight:700">@Value</span>(<span style="color:#036a07">false</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">boolean</span> programmer;
    <span style="color:#00f;font-weight:700">@Value</span>(<span style="color:#036a07">1241401112</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Long</span> ageInSeconds;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-annotation.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">InjectSimple</span> simple <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">InjectSimple</span>) ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">injectSimple</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(simple);
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">toString</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">Name: </span> <span style="color:#00f;font-weight:700">+</span> name <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span>&quot;</span>
                <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">Age: </span> <span style="color:#00f;font-weight:700">+</span> age <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span>&quot;</span>
                <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">Age in Seconds: </span> <span style="color:#00f;font-weight:700">+</span> ageInSeconds <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span>&quot;</span>
                <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">Height: </span> <span style="color:#00f;font-weight:700">+</span> height <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span>&quot;</span>
                <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">Is Programmer?: </span> <span style="color:#00f;font-weight:700">+</span> programmer;
    }
}
</pre></div>
        </div>
    </div>
    </div>
    <div class="Para" id="Par180">This achieves the same result as the XML configuration. <span id="ITerm70">                                                    </span> </div>
    </div>
    <div class="Section3 RenderAsSection3" id="Sec24">
        <h4 class="Heading">Injecting Values by Using SpEL</h4>
        <div class="Para" id="Par181">One powerful feature introduced in Spring 3 is the <span id="ITerm71">Spring Expression Language (SpEL)            </span>. <span id="ITerm72">SpEL                          </span> enables you to evaluate an expression dynamically and then use
            it in Spring’s <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>. You can use the result for injection into Spring beans. In this section, we take a look at how to use SpEL to inject properties from other beans, by
            using the example in the preceding section.</div>
        <div class="Para" id="Par182">Suppose now we want to externalize the values to be injected into a Spring bean in a configuration class, as shown in the following code snippet:</div>
        <div class="Para" id="Par183">
            <div class="ProgramCode" id="PC50">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.annotated</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Component</span>;

@Component(<span style="color:#036a07">injectSimpleConfig</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">InjectSimpleConfig</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">John Mayer</span>;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">int</span> age <span style="color:#00f;font-weight:700">=</span> <span style="color:#0000cd">39</span>;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">float</span> height <span style="color:#00f;font-weight:700">=</span> <span style="color:#0000cd">1.92f</span>;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">boolean</span> programmer <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">false</span>;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Long</span> ageInSeconds <span style="color:#00f;font-weight:700">=</span> 1_241_401_112L;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getName</span>() {
        <span style="color:#00f;font-weight:700">return</span> name;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">int</span> <span style="color:#0000a2;font-weight:700">getAge</span>() {
        <span style="color:#00f;font-weight:700">return</span> age;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">float</span> <span style="color:#0000a2;font-weight:700">getHeight</span>() {
        <span style="color:#00f;font-weight:700">return</span> height;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">boolean</span> <span style="color:#0000a2;font-weight:700">isProgrammer</span>() {
        <span style="color:#00f;font-weight:700">return</span> programmer;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Long</span> <span style="color:#0000a2;font-weight:700">getAgeInSeconds</span>() {
        <span style="color:#00f;font-weight:700">return</span> ageInSeconds;
    }
}
</pre></div>
                </div>
            </div>
        </div>
        <div class="Para" id="Par184">We can then define the bean in the XML configuration and use SpEL to inject the bean’s properties into the dependent bean, as shown in the following configuration snippet:</div>
        <div class="Para" id="Par185">
            <div class="ProgramCode" id="PC51">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">injectSimpleConfig</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.xml.InjectSimpleConfig</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">injectSimpleSpel</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.xml.InjectSimpleSpel</span>
        <span style="font-style:italic">p</span>:name=<span style="color:#036a07">#{injectSimpleConfig.name}</span>
        <span style="font-style:italic">p</span>:age=<span style="color:#036a07">#{injectSimpleConfig.age + 1}</span>
        <span style="font-style:italic">p</span>:height=<span style="color:#036a07">#{injectSimpleConfig.height}</span>
        <span style="font-style:italic">p</span>:programmer=<span style="color:#036a07">#{injectSimpleConfig.programmer}</span>
        <span style="font-style:italic">p</span>:ageInSeconds=<span style="color:#036a07">#{injectSimpleConfig.ageInSeconds}</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
                </div>
            </div>
        </div>
        <div class="Para ParaOneEmphasisChild" id="Par186">Notice that we use the SpEL <span class="EmphasisFontCategoryNonProportional">#{injectSimpleConfig.name}</span> in referencing the property of the other bean. For the age, we add 1 to the value of the bean to indicate that we can use SpEL to manipulate
            the property as we see fit and inject it into the dependent bean. Now we can test the configuration with the program shown in the following code snippet:</div>
        <div class="Para" id="Par187">
            <div class="ProgramCode" id="PC52">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.xml</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">InjectSimpleSpel</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> name;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">int</span> age;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">float</span> height;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">boolean</span> programmer;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Long</span> ageInSeconds;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getName</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>name;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setName</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">name</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>name <span style="color:#00f;font-weight:700">=</span> name;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">int</span> <span style="color:#0000a2;font-weight:700">getAge</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>age;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setAge</span>(<span style="color:#00f;font-weight:700">int</span> <span style="font-style:italic">age</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>age <span style="color:#00f;font-weight:700">=</span> age;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">float</span> <span style="color:#0000a2;font-weight:700">getHeight</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>height;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setHeight</span>(<span style="color:#00f;font-weight:700">float</span> <span style="font-style:italic">height</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>height <span style="color:#00f;font-weight:700">=</span> height;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">boolean</span> <span style="color:#0000a2;font-weight:700">isProgrammer</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>programmer;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setProgrammer</span>(<span style="color:#00f;font-weight:700">boolean</span> <span style="font-style:italic">programmer</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>programmer <span style="color:#00f;font-weight:700">=</span> programmer;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Long</span> <span style="color:#0000a2;font-weight:700">getAgeInSeconds</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>ageInSeconds;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setAgeInSeconds</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">ageInSeconds</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>ageInSeconds <span style="color:#00f;font-weight:700">=</span> ageInSeconds;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">toString</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">Name: </span> <span style="color:#00f;font-weight:700">+</span> name <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span>&quot;</span>
                <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">Age: </span> <span style="color:#00f;font-weight:700">+</span> age <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span>&quot;</span>
                <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">Age in Seconds: </span> <span style="color:#00f;font-weight:700">+</span> ageInSeconds <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span>&quot;</span>
                <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">Height: </span> <span style="color:#00f;font-weight:700">+</span> height <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span>&quot;</span>
                <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">Is Programmer?: </span> <span style="color:#00f;font-weight:700">+</span> programmer;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-xml.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">InjectSimpleSpel</span> simple <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">InjectSimpleSpel</span>) ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">injectSimpleSpel</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(simple);
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre></div>
                </div>
            </div>
        </div>
        <div class="Para" id="Par188">The following is the output of the program:</div>
        <div class="Para" id="Par189">
            <div class="ProgramCode" id="PC53">
                <div class="FixedLine">Name: John Mayer</div>
                <div class="FixedLine">Age: 40</div>
                <div class="FixedLine">Age in Seconds: 1241401112</div>
                <div class="FixedLine">Height: 1.92</div>
                <div class="FixedLine">Is Programmer?: false</div>
            </div>
        </div>
        <div class="Para" id="Par190">When using annotation-style value injection, we just need to substitute the value annotations with the SpEL expressions (see the following code snippet):</div>
        <div class="Para" id="Par191">
            <div class="ProgramCode" id="PC54">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.annotated</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Value</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Service</span>;

@Service(<span style="color:#036a07">injectSimpleSpel</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">InjectSimpleSpel</span> {
    <span style="color:#00f;font-weight:700">@Value</span>(<span style="color:#036a07">#{injectSimpleConfig.name}</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> name;
    <span style="color:#00f;font-weight:700">@Value</span>(<span style="color:#036a07">#{injectSimpleConfig.age + 1}</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">int</span> age;
    <span style="color:#00f;font-weight:700">@Value</span>(<span style="color:#036a07">#{injectSimpleConfig.height}</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">float</span> height;
    <span style="color:#00f;font-weight:700">@Value</span>(<span style="color:#036a07">#{injectSimpleConfig.programmer}</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">boolean</span> programmer;
    <span style="color:#00f;font-weight:700">@Value</span>(<span style="color:#036a07">#{injectSimpleConfig.ageInSeconds}</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Long</span> ageInSeconds;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">toString</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">Name: </span> <span style="color:#00f;font-weight:700">+</span> name <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span>&quot;</span>
                <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">Age: </span> <span style="color:#00f;font-weight:700">+</span> age <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span>&quot;</span>
                <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">Age in Seconds: </span> <span style="color:#00f;font-weight:700">+</span> ageInSeconds <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span>&quot;</span>
                <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">Height: </span> <span style="color:#00f;font-weight:700">+</span> height <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span>&quot;</span>
                <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">Is Programmer?: </span> <span style="color:#00f;font-weight:700">+</span> programmer;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-annotation.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">InjectSimpleSpel</span> simple <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">InjectSimpleSpel</span>) ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">injectSimpleSpel</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(simple);
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre></div>
                </div>
            </div>
        </div>
        <div class="Para ParaOneEmphasisChild" id="Par192">The version of <span class="EmphasisFontCategoryNonProportional">InjectSimpleConfig</span> is shown here:</div>
        <div class="Para" id="Par193">
            <div class="ProgramCode" id="PC55">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.annotated</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Component</span>;

@Component(<span style="color:#036a07">injectSimpleConfig</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">InjectSimpleConfig</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">John Mayer</span>;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">int</span> age <span style="color:#00f;font-weight:700">=</span> <span style="color:#0000cd">39</span>;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">float</span> height <span style="color:#00f;font-weight:700">=</span> <span style="color:#0000cd">1.92f</span>;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">boolean</span> programmer <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">false</span>;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Long</span> ageInSeconds <span style="color:#00f;font-weight:700">=</span> 1_241_401_112L;
    <span style="color:#06f;font-style:italic">// getters here ...</span>
}
</pre></div>
                </div>
            </div>
        </div>
        <div class="Para" id="Par194">In the previous snippet, instead of the <span class="EmphasisFontCategoryNonProportional">@Service annotation</span>, <span class="EmphasisFontCategoryNonProportional">@Component</span> was used. Basically, using <span class="EmphasisFontCategoryNonProportional">@Component</span>            has the same effect as <span class="EmphasisFontCategoryNonProportional">@Service</span>. Both annotations are instructing Spring that the annotated class is a candidate for autodetection using annotation-based configuration and classpath
            scanning. However, since the <span class="EmphasisFontCategoryNonProportional">InjectSimpleConfig</span> class is storing the application configuration, rather than providing a business service, using <span class="EmphasisFontCategoryNonProportional">@Component</span>            makes more sense. Practically, <span class="EmphasisFontCategoryNonProportional">@Service</span> is a specialization of <span class="EmphasisFontCategoryNonProportional">@Component</span>, which indicates that the annotated class is providing
            a business service to other layers within the application.</div>
        <div class="Para" id="Par195">Testing the program will produce the same result. Using SpEL, you can access any Spring-managed beans and properties and manipulate them for application use by Spring’s support of sophisticated language features and syntax.</div>
    </div>
    <div class="Section3 RenderAsSection3" id="Sec25">
        <h4 class="Heading"> <span id="ITerm83">Injecting Beans                          </span> in the Same XML Unit</h4>
        <div class="Para ParaOneEmphasisChild" id="Par196">As you have already seen, it is possible to inject one bean into another by using the <span class="EmphasisFontCategoryNonProportional">ref</span> tag. The next code snippet shows a class that exposes a setter to allow a bean to be injected:</div>
        <div class="Para" id="Par197">
            <div class="ProgramCode" id="PC56">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.xml</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.Oracle</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">InjectRef</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Oracle</span> oracle;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setOracle</span>(<span style="color:#00f;font-weight:700">Oracle</span> <span style="font-style:italic">oracle</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>oracle <span style="color:#00f;font-weight:700">=</span> oracle;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-xml.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">InjectRef</span> injectRef <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">InjectRef</span>) ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">injectRef</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(injectRef);
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">toString</span>() {
        <span style="color:#00f;font-weight:700">return</span> oracle<span style="color:#00f;font-weight:700">.</span>defineMeaningOfLife();
    }
}
</pre></div>
                </div>
            </div>
    </div>
    <div class="Para" id="Par198">To configure Spring to inject one bean into another, you first need to configure two beans: one to be injected and one to be the target of the injection. Once this is done, you simply configure the injection by using the <span class="EmphasisFontCategoryNonProportional">&lt;ref&gt;</span>        tag on the target bean. The following code snippet shows an example of this configuration (file <span class="EmphasisFontCategoryNonProportional">app-context-xml.xml</span>):</div>
    <div class="Para" id="Par199">
        <div class="ProgramCode" id="PC57">
            <div class="LineGroup">
                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">oracle</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">wiseworm</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.BookwormOracle</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">injectRef</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.xml.InjectRef</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">property</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">oracle</span>&gt;</span>
            <span style="color:#1c02ff">&lt;<span style="font-weight:700">ref</span> <span style="font-style:italic">bean</span>=<span style="color:#036a07">oracle</span>/&gt;</span>
        <span style="color:#1c02ff">&lt;/<span style="font-weight:700">property</span>&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">bean</span>&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
            </div>
        </div>
    </div>
    <div class="Para ParaOneEmphasisChild" id="Par200">Running the <span class="EmphasisFontCategoryNonProportional">InjectRef</span> class produces the following output:</div>
    <div class="Para" id="Par201">
        <div class="ProgramCode" id="PC58">
            <div class="FixedLine">Encyclopedias are a waste of money - go see the world instead</div>
        </div>
    </div>
    <div class="Para" id="Par202">An important point to note is that the type being injected does not have to be the exact type defined on the target; the types just need to be compatible. Compatible means that if the declared type on the target is an interface, the injected type
        must implement this interface. If the declared type is a class, the injected type must be either the same type or a subtype. In this example, the <span class="EmphasisFontCategoryNonProportional">InjectRef</span> class defines the <span id="ITerm85">              <span class="EmphasisFontCategoryNonProportional">setOracle()</span>        method </span> to receive an instance of <span class="EmphasisFontCategoryNonProportional">Oracle</span>, which is an interface, and the injected type is <span class="EmphasisFontCategoryNonProportional">BookwormOracle</span>, a class that implements
        <span class="EmphasisFontCategoryNonProportional">Oracle</span>. This is a point that causes confusion for some developers, but it is really quite simple. Injection is subject to the same typing rules as any Java code, so as long as you are familiar
        with how Java typing works, understanding typing in injection is easy.</div>
    <div class="Para" id="Par203">In the previous example, the ID of the bean to inject is specified by using the local attribute of the <span class="EmphasisFontCategoryNonProportional">&lt;ref&gt;</span> tag. As you will see later, in the section “Understanding Bean Naming,” you
        can give a bean more than one name so that you can refer to it using a variety of aliases. When you use the local attribute, it means that the <span class="EmphasisFontCategoryNonProportional">&lt;ref&gt;</span> tag only looks at the bean’s ID
        and never at any of its aliases. Moreover, the bean definition should exist in the same XML configuration file. To inject a bean by any name or import one from other XML configuration files, use the bean attribute of the <span class="EmphasisFontCategoryNonProportional">&lt;ref&gt;</span>        tag instead of the local attribute. The following code snippet shows an alternative configuration for the previous example, using an alternative <span id="ITerm86">name                          </span> for the injected bean:</div>
    <div class="Para" id="Par204">
        <div class="ProgramCode" id="PC59">
            <div class="LineGroup">
                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">oracle</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">wiseworm</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.BookwormOracle</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">injectRef</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.xml.InjectRef</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">property</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">oracle</span>&gt;</span>
            <span style="color:#1c02ff">&lt;<span style="font-weight:700">ref</span> <span style="font-style:italic">bean</span>=<span style="color:#036a07">wiseworm</span>/&gt;</span>
        <span style="color:#1c02ff">&lt;/<span style="font-weight:700">property</span>&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">bean</span>&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
            </div>
        </div>
    </div>
    <div class="Para" id="Par205">In this example, the <span class="EmphasisFontCategoryNonProportional">oracle</span> bean is given an alias by using the <span class="EmphasisFontCategoryNonProportional">name</span> attribute, and then it is injected into the <span class="EmphasisFontCategoryNonProportional">injectRef</span>        bean by using this alias in conjunction with the bean attribute of the <span class="EmphasisFontCategoryNonProportional">&lt;ref&gt;</span> tag. Don’t worry too much about the naming semantics at this point. We discuss this in much more detail
        later in the chapter. Running the <span class="EmphasisFontCategoryNonProportional">InjectRef</span> class again produces the same result as the previous example.</div>
    </div>
    <div class="Section3 RenderAsSection3" id="Sec26">
        <h4 class="Heading"> <span id="ITerm87">Injection and ApplicationContext Nesting                          </span> </h4>
        <div class="Para" id="Par206">So far, the beans we have been injecting have been located in the same <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> (and hence the same <span class="EmphasisFontCategoryNonProportional">BeanFactory</span>) as the
            beans they are injected into. However, Spring supports a hierarchical structure for <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> so that one context (and hence the associating <span class="EmphasisFontCategoryNonProportional">BeanFactory</span>)
            is considered the parent of another. By allowing <span class="EmphasisFontCategoryNonProportional">ApplicationContexts</span> to be nested, Spring allows you to split your configuration into different files, which is a godsend on larger projects
            with lots of beans.</div>
        <div class="Para" id="Par207">When nesting <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> instances, Spring allows beans in what is considered the child context to reference beans in the parent context. <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>            nesting using <span class="EmphasisFontCategoryNonProportional">GenericXmlApplicationContext</span> is simple to understand. To nest one <span class="EmphasisFontCategoryNonProportional">GenericXmlApplicationContext</span> inside another,
            simply call the <span class="EmphasisFontCategoryNonProportional">setParent()</span> method in the child <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>, as shown in the following code sample:</div>
        <div class="Para" id="Par208">
            <div class="ProgramCode" id="PC60">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">HierarchicalAppContextUsage</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> parent <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        parent<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/parent-context.xml</span>);
        parent<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> child <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        child<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/child-context.xml</span>);
        child<span style="color:#00f;font-weight:700">.</span>setParent(parent);
        child<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">Song</span> song1 <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">Song</span>) child<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">song1</span>);
        <span style="color:#00f;font-weight:700">Song</span> song2 <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">Song</span>) child<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">song2</span>);
        <span style="color:#00f;font-weight:700">Song</span> song3 <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">Song</span>) child<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">song3</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">from parent ctx: </span> <span style="color:#00f;font-weight:700">+</span> song1<span style="color:#00f;font-weight:700">.</span>getTitle());
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">from child ctx: </span> <span style="color:#00f;font-weight:700">+</span> song2<span style="color:#00f;font-weight:700">.</span>getTitle());
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">from parent ctx: </span> <span style="color:#00f;font-weight:700">+</span> song3<span style="color:#00f;font-weight:700">.</span>getTitle());
        child<span style="color:#00f;font-weight:700">.</span>close();
        parent<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre></div>
                </div>
            </div>
        </div>
        <div class="Para" id="Par211">Inside the configuration file for the child <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>, referencing a bean in the parent <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> works exactly
            like referencing a bean in the child <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>, unless you have a bean in the child <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> that shares the
            same name. In that case, you simply replace the bean attribute of the <span class="EmphasisFontCategoryNonProportional">ref</span> element with <span class="EmphasisFontCategoryNonProportional">parent</span>, and you are on your way. The following
            configuration snippet depicts the contents of the configuration file for the parent <span class="EmphasisFontCategoryNonProportional">BeanFactory</span>, named <span class="EmphasisFontCategoryNonProportional">parent-context.xml</span>:</div>
        <div class="Para" id="Par212">
            <div class="ProgramCode" id="PC62">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">childTitle</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">java.lang.String</span> <span style="font-style:italic">c</span>:_0=<span style="color:#036a07">Daughters</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">parentTitle</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">java.lang.String</span> <span style="font-style:italic">c</span>:_0=<span style="color:#036a07">Gravity</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
                </div>
            </div>
    </div>
    <div class="Para" id="Par213">As you can see, this configuration simply defines two beans: <span class="EmphasisFontCategoryNonProportional">childTitle</span> and <span class="EmphasisFontCategoryNonProportional">parentTitle</span>. Both are <span class="EmphasisFontCategoryNonProportional">String</span>        objects with the values <span class="EmphasisFontCategoryNonProportional">Daughters</span> and <span class="EmphasisFontCategoryNonProportional">Gravity</span>. The following configuration snippet depicts the configuration for the child
        <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> that is contained in <span class="EmphasisFontCategoryNonProportional">child-context.xml</span>:</div>
    <div class="Para" id="Par214">
        <div class="ProgramCode" id="PC63">
            <div class="LineGroup">
                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">song1</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.Song</span>
          <span style="font-style:italic">p</span>:title-ref=<span style="color:#036a07">parentTitle</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">song2</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.Song</span>
          <span style="font-style:italic">p</span>:title-ref=<span style="color:#036a07">childTitle</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">song3</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.Song</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">property</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">title</span>&gt;</span>
            <span style="color:#1c02ff">&lt;<span style="font-weight:700">ref</span> <span style="font-style:italic">parent</span>=<span style="color:#036a07">childTitle</span>/&gt;</span>
        <span style="color:#1c02ff">&lt;/<span style="font-weight:700">property</span>&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">bean</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">childTitle</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">java.lang.String</span> <span style="font-style:italic">c</span>:_0=<span style="color:#036a07">No Such Thing</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
            </div>
        </div>
    </div>
    <div class="Para" id="Par215">Notice that we have defined four beans here. <span class="EmphasisFontCategoryNonProportional">childTitle</span> in this code is similar to <span class="EmphasisFontCategoryNonProportional">childTitle</span> in the parent except that the <span class="EmphasisFontCategoryNonProportional">String</span>        it represents has a different value, indicating that it is located in the child <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>.</div>
    <div class="Para" id="Par216">The <span class="EmphasisFontCategoryNonProportional">song1</span> bean is using the bean <span class="EmphasisFontCategoryNonProportional">ref</span> attribute to reference the bean named <span class="EmphasisFontCategoryNonProportional">parentTitle</span>.
        Because this bean exists only in the parent <span class="EmphasisFontCategoryNonProportional">BeanFactory</span>, <span class="EmphasisFontCategoryNonProportional">song1</span> receives a reference to that bean. There are two points of interest
        here. First, you can use the bean attribute to reference beans in both the child and the parent <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>s. This makes it easy to reference the beans transparently, allowing you
        to move beans between configuration files as your application grows. The second point of interest is that you can’t use the local attribute to refer to beans in the parent <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>.
        The XML parser checks to see that the value of the local attribute exists as a valid element in the same file, preventing it from being used to reference beans in the parent context.</div>
    <div class="Para" id="Par217">The <span class="EmphasisFontCategoryNonProportional">song2</span> bean is using the bean <span class="EmphasisFontCategoryNonProportional">ref</span> attribute to reference <span class="EmphasisFontCategoryNonProportional">childTitle</span>. Because
        that bean is defined in both <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>s, the <span class="EmphasisFontCategoryNonProportional">song2</span> bean receives a reference to <span class="EmphasisFontCategoryNonProportional">childTitle</span>        in its own <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>. <span id="ITerm90">                                                    </span> </div>
    <div class="Para" id="Par218">The <span class="EmphasisFontCategoryNonProportional">song3</span> bean is using the <span class="EmphasisFontCategoryNonProportional">&lt;ref&gt;</span> tag to reference <span class="EmphasisFontCategoryNonProportional">childTitle</span> directly
        in the parent <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>. Because <span class="EmphasisFontCategoryNonProportional">song3</span> is using the parent attribute of the <span class="EmphasisFontCategoryNonProportional">&lt;ref&gt;</span>        tag, the <span class="EmphasisFontCategoryNonProportional">childTitle</span> instance declared in the child <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> is ignored completely.</div>
    <div class="Para ParaTypeImportant" id="Par219">
    <img alt="A315511_5_En_3_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" width="30"/>        You may have noticed that, unlike <span class="EmphasisFontCategoryNonProportional">song1</span> and <span class="EmphasisFontCategoryNonProportional">song2</span>, the <span class="EmphasisFontCategoryNonProportional">song3</span> bean is not
        using the <span class="EmphasisFontCategoryNonProportional">p</span> namespace. While the <span class="EmphasisFontCategoryNonProportional">p</span> namespace provides handy shortcuts, it does not provide all the capabilities as when using property
        tags, such as referencing a parent bean. While we show it as an example, it’s best to pick either the <span class="EmphasisFontCategoryNonProportional">p</span> namespace or property tags to define your beans, rather than mixing styles (unless
        absolutely necessary).</div>
    <div class="Para ParaOneEmphasisChild" id="Par220">Here is the output from running the <span class="EmphasisFontCategoryNonProportional">HierarchicalAppContextUsage</span> class:</div>
    <div class="Para" id="Par221">
        <div class="ProgramCode" id="PC64">
            <div class="FixedLine">from parent ctx: Gravity</div>
            <div class="FixedLine">from child ctx: No Such Thing</div>
            <div class="FixedLine">from parent ctx: Daughters</div>
        </div>
    </div>
    <div class="Para" id="Par222">As expected, the <span class="EmphasisFontCategoryNonProportional">song1</span> and <span class="EmphasisFontCategoryNonProportional">song3</span> beans both get a reference to beans in the parent <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>,
        whereas the <span class="EmphasisFontCategoryNonProportional">song2</span> bean gets a reference to a bean in the child <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>.</div>
    </div>
    <div class="Section3 RenderAsSection3" id="Sec27">
        <h4 class="Heading">Injecting <span id="ITerm91">Collections                          </span> </h4>
        <div class="Para" id="Par223">Often your beans need access to collections of objects rather than just individual beans or values. Therefore, it should come as no surprise that Spring allows you to inject a collection of objects into one of your beans. Using the collection
            is simple: you choose either <span class="EmphasisFontCategoryNonProportional">&lt;list&gt;</span>, <span class="EmphasisFontCategoryNonProportional">&lt;map&gt;</span>, <span class="EmphasisFontCategoryNonProportional">&lt;set&gt;</span>,
            or <span class="EmphasisFontCategoryNonProportional">&lt;props&gt;</span> to represent a <span class="EmphasisFontCategoryNonProportional">List</span>, <span class="EmphasisFontCategoryNonProportional">Map</span>, <span class="EmphasisFontCategoryNonProportional">Set</span>,
            or <span class="EmphasisFontCategoryNonProportional">Properties</span> instance, and then you pass in the individual items just as you would with any other injection. The <span class="EmphasisFontCategoryNonProportional">&lt;props&gt;</span>            tag allows for only <span class="EmphasisFontCategoryNonProportional">String</span>s to be passed in as the value, because the <span class="EmphasisFontCategoryNonProportional">Properties</span> class allows only for property values to be
            <span class="EmphasisFontCategoryNonProportional">String</span>s. When using <span class="EmphasisFontCategoryNonProportional">&lt;list&gt;</span>, <span class="EmphasisFontCategoryNonProportional">&lt;map&gt;</span>, or <span class="EmphasisFontCategoryNonProportional">&lt;set&gt;</span>,
            you can use any tag you want when injecting into a property, even another collection tag. This allows you to pass in a <span class="EmphasisFontCategoryNonProportional">List</span> of <span class="EmphasisFontCategoryNonProportional">Map</span>s,
            a <span class="EmphasisFontCategoryNonProportional">Map</span> of <span class="EmphasisFontCategoryNonProportional">Set</span>s, or even a <span class="EmphasisFontCategoryNonProportional">List</span> of <span class="EmphasisFontCategoryNonProportional">Map</span>s
            of <span class="EmphasisFontCategoryNonProportional">Set</span>s of <span class="EmphasisFontCategoryNonProportional">List</span>s! The following code snippet shows a class that can have all four of the collection types injected into it:</div>
        <div class="Para" id="Par224">
            <div class="ProgramCode" id="PC65">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.xml</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Map</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Properties</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Set</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">CollectionInjection</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Map</span> <span style="color:#00f;font-weight:700">&lt;</span> <span style="color:#00f;font-weight:700">String</span>,
    <span style="color:#00f;font-weight:700">Object</span> <span style="color:#00f;font-weight:700">&gt;</span> map;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Properties</span> props;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Set</span> set;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">List</span> list;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>...<span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-xml.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">CollectionInjection</span> instance <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">CollectionInjection</span>) ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">injectCollection</span>);
        instance<span style="color:#00f;font-weight:700">.</span>displayInfo();
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">displayInfo</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">&quot;Map contents:<span style="color:#26b31a">\n</span>&quot;</span>);
        map<span style="color:#00f;font-weight:700">.</span>entrySet()<span style="color:#00f;font-weight:700">.</span>stream()<span style="color:#00f;font-weight:700">.</span>forEach(e <span style="color:#00f;font-weight:700">-</span> <span style="color:#00f;font-weight:700">&gt;</span><span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Key: </span> <span style="color:#00f;font-weight:700">+</span> e<span style="color:#00f;font-weight:700">.</span>getKey() <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07"> - Value: </span> <span style="color:#00f;font-weight:700">+</span> e<span style="color:#00f;font-weight:700">.</span>getValue()));
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span>Properties contents:<span style="color:#26b31a">\n</span>&quot;</span>);
        props<span style="color:#00f;font-weight:700">.</span>entrySet()<span style="color:#00f;font-weight:700">.</span>stream()<span style="color:#00f;font-weight:700">.</span>forEach(e <span style="color:#00f;font-weight:700">-</span> <span style="color:#00f;font-weight:700">&gt;</span><span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Key: </span> <span style="color:#00f;font-weight:700">+</span> e<span style="color:#00f;font-weight:700">.</span>getKey() <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07"> - Value: </span> <span style="color:#00f;font-weight:700">+</span> e<span style="color:#00f;font-weight:700">.</span>getValue()));
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span>Set contents:<span style="color:#26b31a">\n</span>&quot;</span>);
        set<span style="color:#00f;font-weight:700">.</span>forEach(obj <span style="color:#00f;font-weight:700">-</span> <span style="color:#00f;font-weight:700">&gt;</span><span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Value: </span> <span style="color:#00f;font-weight:700">+</span> obj));
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span>List contents:<span style="color:#26b31a">\n</span>&quot;</span>);
        list<span style="color:#00f;font-weight:700">.</span>forEach(obj <span style="color:#00f;font-weight:700">-</span> <span style="color:#00f;font-weight:700">&gt;</span><span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Value: </span> <span style="color:#00f;font-weight:700">+</span> obj));
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setList</span>(<span style="color:#00f;font-weight:700">List</span> <span style="font-style:italic">list</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>list <span style="color:#00f;font-weight:700">=</span> list;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setSet</span>(<span style="color:#00f;font-weight:700">Set</span> <span style="font-style:italic">set</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>set <span style="color:#00f;font-weight:700">=</span> set;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setMap</span>(<span style="color:#00f;font-weight:700">Map</span> &lt; <span style="color:#00f;font-weight:700">String</span>, <span style="color:#00f;font-weight:700">Object</span> &gt; <span style="font-style:italic">map</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>map <span style="color:#00f;font-weight:700">=</span> map;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setProps</span>(<span style="color:#00f;font-weight:700">Properties</span> <span style="font-style:italic">props</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>props <span style="color:#00f;font-weight:700">=</span> props;
    }
}
</pre></div>
                </div>
            </div>
    </div>
    <div class="Para" id="Par225">That is quite a lot of code, but it actually does very little. The <span class="EmphasisFontCategoryNonProportional">main()</span> method retrieves a <span class="EmphasisFontCategoryNonProportional">CollectionInjection</span> bean from Spring and
        then calls the <span id="ITerm94">              <span class="EmphasisFontCategoryNonProportional">displayInfo()</span> method </span>. This method just outputs the contents of the <span class="EmphasisFontCategoryNonProportional">Map</span>,
        <span class="EmphasisFontCategoryNonProportional">Properties</span>, <span class="EmphasisFontCategoryNonProportional">Set</span>, and <span class="EmphasisFontCategoryNonProportional">List</span> instances that will be injected from Spring. The configuration required to inject values for each
            of the properties in the <span class="EmphasisFontCategoryNonProportional">CollectionInjection</span> class is depicted next, and the configuration file is named <span class="EmphasisFontCategoryNonProportional">app-context-xml.xml</span>            <span class="EmphasisTypeItalic">.</span> </div>
    <div class="Para" id="Par226">Also, notice the declaration of the <span class="EmphasisFontCategoryNonProportional">Map&lt;String,Object&gt;</span> property. For JDK versions newer than 5, Spring also supports the strongly typed <span class="EmphasisFontCategoryNonProportional">Collection</span>        declaration and will perform the conversion from the XML configuration to the corresponding type specified accordingly.</div>
    <div class="Para" id="Par227">
        <div class="ProgramCode" id="PC66">
            <div class="LineGroup">
                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">lyricHolder</span>
        <span style="font-style:italic">lass</span>=<span style="color:#036a07">com.apress.prospring5.ch3.xml.LyricHolder</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">injectCollection</span>
         <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.xml.CollectionInjection</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">property</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">map</span>&gt;</span>
            <span style="color:#1c02ff">&lt;<span style="font-weight:700">map</span>&gt;</span>
                <span style="color:#1c02ff">&lt;<span style="font-weight:700">entry</span> <span style="font-style:italic">key</span>=<span style="color:#036a07">someValue</span>&gt;</span>
                    <span style="color:#1c02ff">&lt;<span style="font-weight:700">value</span>&gt;</span>It&apos;s a Friday, we finally made it<span style="color:#1c02ff">&lt;/<span style="font-weight:700">value</span>&gt;</span>
                <span style="color:#1c02ff">&lt;/<span style="font-weight:700">entry</span>&gt;</span>
                <span style="color:#1c02ff">&lt;<span style="font-weight:700">entry</span> <span style="font-style:italic">key</span>=<span style="color:#036a07">someBean</span>&gt;</span>
                    <span style="color:#1c02ff">&lt;<span style="font-weight:700">ref</span> <span style="font-style:italic">bean</span>=<span style="color:#036a07">lyricHolder</span>/&gt;</span>
                <span style="color:#1c02ff">&lt;/<span style="font-weight:700">entry</span>&gt;</span>
            <span style="color:#1c02ff">&lt;/<span style="font-weight:700">map</span>&gt;</span>
        <span style="color:#1c02ff">&lt;/<span style="font-weight:700">property</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">property</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">props</span>&gt;</span>
            <span style="color:#1c02ff">&lt;<span style="font-weight:700">props</span>&gt;</span>
                <span style="color:#1c02ff">&lt;<span style="font-weight:700">prop</span> <span style="font-style:italic">key</span>=<span style="color:#036a07">firstName</span>&gt;</span>John<span style="color:#1c02ff">&lt;/<span style="font-weight:700">prop</span>&gt;</span>
                <span style="color:#1c02ff">&lt;<span style="font-weight:700">prop</span> <span style="font-style:italic">key</span>=<span style="color:#036a07">secondName</span>&gt;</span>Mayer<span style="color:#1c02ff">&lt;/<span style="font-weight:700">prop</span>&gt;</span>
            <span style="color:#1c02ff">&lt;/<span style="font-weight:700">props</span>&gt;</span>
        <span style="color:#1c02ff">&lt;/<span style="font-weight:700">property</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">property</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">set</span>&gt;</span>
            <span style="color:#1c02ff">&lt;<span style="font-weight:700">set</span>&gt;</span>
                <span style="color:#1c02ff">&lt;<span style="font-weight:700">value</span>&gt;</span>I can&apos;t believe I get to see your face<span style="color:#1c02ff">&lt;/<span style="font-weight:700">value</span>&gt;</span>
                <span style="color:#1c02ff">&lt;<span style="font-weight:700">ref</span> <span style="font-style:italic">bean</span>=<span style="color:#036a07">lyricHolder</span>/&gt;</span>
            <span style="color:#1c02ff">&lt;/<span style="font-weight:700">set</span>&gt;</span>
        <span style="color:#1c02ff">&lt;/<span style="font-weight:700">property</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">property</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">list</span>&gt;</span>
            <span style="color:#1c02ff">&lt;<span style="font-weight:700">list</span>&gt;</span>
                <span style="color:#1c02ff">&lt;<span style="font-weight:700">value</span>&gt;</span>You&apos;ve been working and I&apos;ve been waiting<span style="color:#1c02ff">&lt;/<span style="font-weight:700">value</span>&gt;</span>
                <span style="color:#1c02ff">&lt;<span style="font-weight:700">ref</span> <span style="font-style:italic">bean</span>=<span style="color:#036a07">lyricHolder</span>/&gt;</span>
            <span style="color:#1c02ff">&lt;/<span style="font-weight:700">list</span>&gt;</span>
        <span style="color:#1c02ff">&lt;/<span style="font-weight:700">property</span>&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">bean</span>&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
        </div>
    </div>
    </div>
    <div class="Para" id="Par228">In this code, you can see that we have injected values into all four setters exposed on the <span class="EmphasisFontCategoryNonProportional">CollectionInjection</span> class. For the <span class="EmphasisFontCategoryNonProportional">map</span> property,
        we have injected a <span class="EmphasisFontCategoryNonProportional">Map</span> instance by using the <span class="EmphasisFontCategoryNonProportional">&lt;map&gt;</span> tag. Notice that each entry is specified using an <span class="EmphasisFontCategoryNonProportional">&lt;entry&gt;</span>        tag, and each has a <span class="EmphasisFontCategoryNonProportional">String</span> key and then an entry value. This entry value can be any value you can inject into a property separately; this example shows the use of the <span class="EmphasisFontCategoryNonProportional">&lt;value&gt;</span>        and <span class="EmphasisFontCategoryNonProportional">&lt;ref&gt;</span> tags to add a <span class="EmphasisFontCategoryNonProportional">String</span> value and a bean reference to the <span class="EmphasisFontCategoryNonProportional">Map</span>.
        The <span class="EmphasisFontCategoryNonProportional">LyricHolder</span> class, which is the type of the <span class="EmphasisFontCategoryNonProportional">lyricHolder</span> bean injected in the map in the previous configuration, is depicted here:</div>
    <div class="Para" id="Par229">
        <div class="ProgramCode" id="PC67">
            <div class="LineGroup">
                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.xml</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.ContentHolder</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">LyricHolder</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">ContentHolder</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> value <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">&apos;You be the DJ, I&apos;ll be the driver&apos;</span>;

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">toString</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">LyricHolder: { </span> <span style="color:#00f;font-weight:700">+</span> value <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">}</span>;
    }
}
</pre></div>
            </div>
        </div>
        </div>
        <div class="Para" id="Par230">For the <span class="EmphasisFontCategoryNonProportional">props</span> property, we use the <span class="EmphasisFontCategoryNonProportional">&lt;props&gt;</span> tag to create an instance of <span class="EmphasisFontCategoryNonProportional">java.util.Properties</span>            and populate it using &lt;prop&gt; tags. Notice that although the <span class="EmphasisFontCategoryNonProportional">&lt;prop&gt;</span> tag is keyed in a similar manner to the <span class="EmphasisFontCategoryNonProportional">&lt;entry&gt;</span>            tag, we can specify only <span class="EmphasisFontCategoryNonProportional">String</span> values for each property that goes in the <span class="EmphasisFontCategoryNonProportional">Properties</span> instance.</div>
        <div class="Para" id="Par231">Also, for the <span class="EmphasisFontCategoryNonProportional">&lt;map&gt;</span> element there is an alternative, more compact configuration using the <span class="EmphasisFontCategoryNonProportional">value</span> and <span class="EmphasisFontCategoryNonProportional">value-ref</span>            attributes, instead of the <span class="EmphasisFontCategoryNonProportional">&lt;value&gt;</span> and <span class="EmphasisFontCategoryNonProportional">&lt;ref&gt;</span> elements. The <span class="EmphasisFontCategoryNonProportional">map</span>            declared here is equivalent with the one in the previous configuration:</div>
        <div class="Para" id="Par232">
            <div class="ProgramCode" id="PC68">
                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">property</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">map</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">map</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">entry</span> <span style="font-style:italic">key</span>=<span style="color:#036a07">someValue</span> <span style="font-style:italic">value</span>=<span style="color:#036a07">It&apos;s a Friday, we finally made it</span>/&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">entry</span> <span style="font-style:italic">key</span>=<span style="color:#036a07">someBean</span> <span style="font-style:italic">value-ref</span>=<span style="color:#036a07">lyricHolder</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">map</span>&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">property</span>&gt;</span>
</pre></div>
            </div>
        </div>
        <div class="Para" id="Par233">Both the <span class="EmphasisFontCategoryNonProportional">&lt;list&gt;</span> and <span class="EmphasisFontCategoryNonProportional">&lt;set&gt;</span> tags work in the same way: you specify each element by using any of the individual value tags
            such as <span class="EmphasisFontCategoryNonProportional">&lt;value&gt;</span> and <span class="EmphasisFontCategoryNonProportional">&lt;ref&gt;</span> that are used to inject a single value into a property. In the previous configuration,
            you can see that we have added a <span class="EmphasisFontCategoryNonProportional">String</span> value and a bean reference to both the <span class="EmphasisFontCategoryNonProportional">List</span> and <span class="EmphasisFontCategoryNonProportional">Set</span>            instances.</div>
        <div class="Para" id="Par234">Here is the output generated by the <span class="EmphasisFontCategoryNonProportional">main()</span> method in the class <span class="EmphasisFontCategoryNonProportional">CollectionInjection</span>. As expected, it simply lists the elements added
            to the collections in the configuration file.</div>
        <div class="Para" id="Par235">
            <div class="ProgramCode" id="PC69">
                <div class="LineGroup">
                    <div class="FixedLine">Map contents:</div>
                </div>
                <div class="LineGroup">
                    <div class="FixedLine">Key: someValue - Value: It&apos;s a Friday, we finally made it</div>
                    <div class="FixedLine">Key: someBean - Value: LyricHolder: { &apos;You be the DJ, I&apos;ll be the driver&apos;}</div>
                </div>
                <div class="LineGroup">
                    <div class="FixedLine">Properties contents:</div>
                </div>
                <div class="LineGroup">
                    <div class="FixedLine">Key: secondName - Value: Mayer</div>
                    <div class="FixedLine">Key: firstName - Value: John</div>
                </div>
                <div class="LineGroup">
                    <div class="FixedLine">Set contents:</div>
                </div>
                <div class="LineGroup">
                    <div class="FixedLine">Value: I can&apos;t believe I get to see your face</div>
                    <div class="FixedLine">Value: LyricHolder: { &apos;You be the DJ, I&apos;ll be the driver&apos;}</div>
                </div>
                <div class="LineGroup">
                    <div class="FixedLine">List contents:</div>
                </div>
                <div class="LineGroup">
                    <div class="FixedLine">Value: You&apos;ve been working and I&apos;ve been waiting</div>
                    <div class="FixedLine">Value: LyricHolder: { &apos;You be the DJ, I&apos;ll be the driver&apos;}</div>
                </div>
            </div>
        </div>
        <div class="Para" id="Par236">Remember, with the <span class="EmphasisFontCategoryNonProportional">&lt;list&gt;</span>, <span class="EmphasisFontCategoryNonProportional">&lt;map&gt;</span>, and <span class="EmphasisFontCategoryNonProportional">&lt;set&gt;</span> elements,
            you can employ any of the tags used to set the value of noncollection properties to specify the value of one of the entries in the collection. This is quite a powerful concept because you are not limited just to injecting collections of primitive
            values; you can also inject collections of beans or other collections.</div>
        <div class="Para" id="Par237">Using this functionality,<span id="ITerm97">                                                    </span> it is much easier to modularize your application and provide different, user-selectable implementations of key pieces of application logic.
            Consider a system that allows corporate staff to create, proofread, and order their personalized business stationery online. In this system, the finished artwork for each order is sent to the appropriate printer when it is ready for production.
            The only complication is that some printers want to receive the artwork via e-mail, some via FTP, and others using Secure Copy Protocol (SCP). Using Spring’s collection injection, you can create a standard interface for this functionality,
            as shown in the following code snippet:</div>
        <div class="Para" id="Par238">
            <div class="ProgramCode" id="PC70">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">ArtworkSender</span> {
    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">sendArtwork</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">artworkPath</span>, <span style="color:#00f;font-weight:700">Recipient</span> <span style="font-style:italic">recipient</span>);

    <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getFriendlyName</span>();

    <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getShortName</span>();
}
</pre></div>
                </div>
            </div>
        </div>
        <div class="Para ParaOneEmphasisChild" id="Par239">In the previous example, the <span class="EmphasisFontCategoryNonProportional">Recipient</span> class is an empty class. From this interface, you can create multiple implementations, each of which is capable of describing itself to a human, such
            as the one shown here:</div>
        <div class="Para" id="Par240">
            <div class="ProgramCode" id="PC71">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">FtpArtworkSender</span>
        <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">ArtworkSender</span> {
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">sendArtwork</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">artworkPath</span>, <span style="color:#00f;font-weight:700">Recipient</span> <span style="font-style:italic">recipient</span>) {
        <span style="color:#06f;font-style:italic">// ftp logic here...</span>
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getFriendlyName</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">File Transfer Protocol</span>;
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getShortName</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">ftp</span>;
    }
}
</pre></div>
                </div>
            </div>
        </div>
        <div class="Para" id="Par241">Imagine that you then develop an <span class="EmphasisFontCategoryNonProportional">ArtworkManager</span> class that supports all available implementations of the <span class="EmphasisFontCategoryNonProportional">Artwork-Sender</span> interface.
            With the implementations in place, you simply pass a <span class="EmphasisFontCategoryNonProportional">List</span> to your <span class="EmphasisFontCategoryNonProportional">ArtworkManager</span> class, and you are on your way. Using the
            <span id="ITerm98"> <span class="EmphasisFontCategoryNonProportional">getFriendlyName()</span> method </span>, you can display a list of delivery options for the system administrator to choose from when you are configuring each stationery template. In addition,
                your application can remain fully decoupled from the individual implementations if you just code to the <span class="EmphasisFontCategoryNonProportional">ArtworkSender</span> interface. We will leave the implementation of the <span class="EmphasisFontCategoryNonProportional">ArtworkManager</span>                class as an exercise for you.</div>
        <div class="Para" id="Par242">Besides the XML configuration, you can use annotations for <span id="ITerm99">collection injection                          </span>. However, you would also like to externalize the values of the collections into the configuration file for easy
            maintenance. The following snippet is the configuration of four different Spring beans that mimic the same collection properties of the previous sample (configuration file <span class="EmphasisFontCategoryNonProportional">app-context-annotation.xml</span>):</div>
        <div class="Para" id="Par243">
            <div class="ProgramCode" id="PC72">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#68685b">&lt;?<span style="color:#888">xml</span><span style="color:#888"> version</span>=<span style="color:#888">1.0</span><span style="color:#888"> encoding</span>=<span style="color:#888">UTF-8</span>?&gt;</span>

<span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> <span style="font-style:italic">xmlns</span>=<span style="color:#036a07">http://www.springframework.org/schema/beans</span>
       <span style="font-style:italic">xmlns</span>:xsi=<span style="color:#036a07">http://www.w3.org/2001/XMLSchema-instance</span>
       <span style="font-style:italic">xmlns</span>:context=<span style="color:#036a07">http://www.springframework.org/schema/context</span>
       <span style="font-style:italic">xmlns</span>:util=<span style="color:#036a07">http://www.springframework.org/schema/util</span>
       <span style="font-style:italic">xsi</span>:schemaLocation=<span style="color:#036a07">http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans.xsd
http://www.springframework.org/schema/context
http://www.springframework.org/schema/context/spring-context.xsd
http://www.springframework.org/schema/util 
http://www.springframework.org/schema/util/spring-util.xsd</span>&gt;</span>


    <span style="color:#1c02ff">&lt;<span style="font-weight:700">context</span><span style="font-weight:700">:</span><span style="font-weight:700">component-scan</span>
            <span style="font-style:italic">base-package</span>=<span style="color:#036a07">com.apress.prospring5.ch3.annotated</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">util</span><span style="font-weight:700">:</span><span style="font-weight:700">map</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">map</span> <span style="font-style:italic">map-class</span>=<span style="color:#036a07">java.util.HashMap</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">entry</span> <span style="font-style:italic">key</span>=<span style="color:#036a07">someValue</span> <span style="font-style:italic">value</span>=<span style="color:#036a07">It&apos;s a Friday, we finally made it</span>/&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">entry</span> <span style="font-style:italic">key</span>=<span style="color:#036a07">someBean</span> <span style="font-style:italic">value-ref</span>=<span style="color:#036a07">lyricHolder</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">util</span><span style="font-weight:700">:</span><span style="font-weight:700">map</span>&gt;</span>


    <span style="color:#1c02ff">&lt;<span style="font-weight:700">util</span><span style="font-weight:700">:</span><span style="font-weight:700">properties</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">props</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">prop</span> <span style="font-style:italic">key</span>=<span style="color:#036a07">firstName</span>&gt;</span>John<span style="color:#1c02ff">&lt;/<span style="font-weight:700">prop</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">prop</span> <span style="font-style:italic">key</span>=<span style="color:#036a07">secondName</span>&gt;</span>Mayer<span style="color:#1c02ff">&lt;/<span style="font-weight:700">prop</span>&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">util</span><span style="font-weight:700">:</span><span style="font-weight:700">properties</span>&gt;</span>


    <span style="color:#1c02ff">&lt;<span style="font-weight:700">util</span><span style="font-weight:700">:</span><span style="font-weight:700">set</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">set</span> <span style="font-style:italic">set-class</span>=<span style="color:#036a07">java.util.HashSet</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">value</span>&gt;</span>I can&apos;t believe I get to see your face<span style="color:#1c02ff">&lt;/<span style="font-weight:700">value</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">ref</span> <span style="font-style:italic">bean</span>=<span style="color:#036a07">lyricHolder</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">util</span><span style="font-weight:700">:</span><span style="font-weight:700">set</span>&gt;</span>


    <span style="color:#1c02ff">&lt;<span style="font-weight:700">util</span><span style="font-weight:700">:</span><span style="font-weight:700">list</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">list</span> <span style="font-style:italic">list-class</span>=<span style="color:#036a07">java.util.ArrayList</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">value</span>&gt;</span>You&apos;ve been working and I&apos;ve been waiting<span style="color:#1c02ff">&lt;/<span style="font-weight:700">value</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">ref</span> <span style="font-style:italic">bean</span>=<span style="color:#036a07">lyricHolder</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">util</span><span style="font-weight:700">:</span><span style="font-weight:700">list</span>&gt;</span>

<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
                </div>
            </div>
            </div>
            <div class="Para ParaOneEmphasisChild" id="Par244">Let’s also develop an annotation version of the <span class="EmphasisFontCategoryNonProportional">LyricHolder</span> class. The class content is depicted here:</div>
            <div class="Para" id="Par245">
                <div class="ProgramCode" id="PC73">
                    <div class="LineGroup">
                        <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.annotated</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.ContentHolder</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Service</span>;

@Service(<span style="color:#036a07">lyricHolder</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">LyricHolder</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">ContentHolder</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> value <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">&apos;You be the DJ, I&apos;ll be the driver&apos;</span>;

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">toString</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">LyricHolder: { </span> <span style="color:#00f;font-weight:700">+</span> value <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">}</span>;
    }
}
</pre></div>
                    </div>
                </div>
            </div>
            <div class="Para" id="Par246">In the configuration depicted previously, we make use of the <span class="EmphasisFontCategoryNonProportional">util</span> namespace provided by Spring to declare your beans for storing collection properties: the <span class="EmphasisFontCategoryNonProportional">util</span>                namespace. It greatly simplifies the configuration, as compared to previous versions of Spring. In the class we use to test your configuration, we inject the previous beans and use the JSR-250 <span class="EmphasisFontCategoryNonProportional">@Resource</span>                annotation with the name specified as an argument to properly identify the beans. The <span class="EmphasisFontCategoryNonProportional">displayInfo()</span> method is the same as before so is no longer shown here.</div>
            <div class="Para" id="Par247">
                <div class="ProgramCode" id="PC74">
                    <div class="LineGroup">
                        <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.annotation.Resource</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Set</span>;

@Service(<span style="color:#036a07">injectCollection</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">CollectionInjection</span> {
    <span style="color:#00f;font-weight:700">@Resource</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">map</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Map&lt;<span style="color:#00f;font-weight:700">String</span>, <span style="color:#00f;font-weight:700">Object</span>&gt;</span> map;
    <span style="color:#00f;font-weight:700">@Resource</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">props</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Properties</span> props;
    <span style="color:#00f;font-weight:700">@Resource</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">set</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Set</span> set;
    <span style="color:#00f;font-weight:700">@Resource</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">list</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">List</span> list;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-annotation.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">CollectionInjection</span> instance <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">CollectionInjection</span>)
                ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">injectCollection</span>);
        instance<span style="color:#00f;font-weight:700">.</span>displayInfo();
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
    .<span style="color:#00f;font-weight:700">.</span>.
}
</pre></div>
                    </div>
                </div>
            </div>
            <div class="Para" id="Par248">Run the test program, and you will get the same result as the sample using XML configuration.</div>
            <div class="Para ParaTypeImportant" id="Par249"> <img alt="A315511_5_En_3_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" width="30"/>                You may wonder why the annotation <span class="EmphasisFontCategoryNonProportional">@Resource</span> is used instead of <span class="EmphasisFontCategoryNonProportional">@Autowired</span>. It’s because the <span class="EmphasisFontCategoryNonProportional">@Autowired</span>                annotation is semantically defined in a way that it always treats arrays, collections, and maps as sets of corresponding beans, with the target bean type derived from the declared collection value type. So, for example, if a class has
                an attribute of type <span class="EmphasisFontCategoryNonProportional">List&lt;ContentHolder&gt;</span> and has the <span class="EmphasisFontCategoryNonProportional">@Autowired</span> annotation defined, Spring will try to inject all beans
                of type <span class="EmphasisFontCategoryNonProportional">ContentHolder</span> within the current <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> into that attribute (instead of the <span class="EmphasisFontCategoryNonProportional">&lt;util:list&gt;</span>                declared in the configuration file), which will result in either the unexpected dependencies being injected or Spring throwing an exception if no bean of type <span class="EmphasisFontCategoryNonProportional">ContentHolder</span> was defined.
                So, for collection type injection, we have to explicitly instruct Spring to perform injection by specifying the bean name, which the <span class="EmphasisFontCategoryNonProportional">@Resource</span> annotation supports.</div>
            <div class="Para ParaTypeImportant" id="Par250"> <img alt="A315511_5_En_3_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" width="30"/>                A combination of <span class="EmphasisFontCategoryNonProportional">@Autowired</span> and <span class="EmphasisFontCategoryNonProportional">@Qualifier</span> can be used to fulfill the same purpose, but it is always preferable to use one
                annotation and not two. In the following code snippet, you can see the equivalent configuration to inject a collection using its bean name by using <span class="EmphasisFontCategoryNonProportional">@Autowired</span> and <span class="EmphasisFontCategoryNonProportional">@Qualifier</span>.
                <span id="ITerm102">                                                    </span> </div>
            <div class="Para" id="Par251">
                <div class="ProgramCode" id="PC75">
                    <div class="LineGroup">
                        <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.annotated</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Autowired</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Qualifier</span>;

@Service(<span style="color:#036a07">injectCollection</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">CollectionInjection</span> {
    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">@Qualifier</span>(<span style="color:#036a07">map</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Map&lt;<span style="color:#00f;font-weight:700">String</span>, <span style="color:#00f;font-weight:700">Object</span>&gt;</span> map;
.<span style="color:#00f;font-weight:700">.</span>.
}
</pre></div>
                    </div>
                </div>
            </div>
            </div>
            </div>
            <div class="Section2 RenderAsSection2" id="Sec28">
                <h3 class="Heading">Using <span id="ITerm103">Method Injection                      </span> </h3>
                <div class="Para" id="Par252">Besides constructor and setter injection, another less frequently used DI feature that Spring provides is <span class="EmphasisTypeItalic">Method Injection</span>. Spring’s Method Injection capabilities come in two loosely related forms,
                    lookup Method Injection and Method Replacement. Lookup Method Injection provides another mechanism by which a bean can obtain one of its dependencies. Method replacement allows you to replace the implementation of any method on a bean
                    arbitrarily, without having to change the original source code. To provide these two features, Spring uses the dynamic bytecode enhancement capabilities of CGLIB.<a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Chapter.html#Fn3" id="Fn3_source"><sup>3</sup></a> </div>
                <div class="Section3 RenderAsSection3" id="Sec29">
                    <h4 class="Heading">Lookup Method Injection</h4>
                    <div class="Para" id="Par254"> <span id="ITerm104">                  <span class="EmphasisTypeItalic">Lookup Method Injection</span> </span> was added to Spring in version 1.1 to overcome the problems encountered when a bean depends on another bean with a different
                        life cycle, specifically, when a singleton depends on a nonsingleton. In this situation, both setter and constructor injection result in the singleton maintaining a single instance of what should be a nonsingleton bean. In some
                        cases, you will want to have the singleton bean obtain a new instance of the nonsingleton every time it requires the bean in question.</div>
                    <div class="Para" id="Par255">Consider a scenario in which a <span class="EmphasisFontCategoryNonProportional">LockOpener</span> <span id="ITerm105">class                          </span> provides the service of opening any locker. The <span class="EmphasisFontCategoryNonProportional">LockOpener</span>                        class relies on a <span class="EmphasisFontCategoryNonProportional">KeyHelper</span> class for opening the locker, which was injected into <span class="EmphasisFontCategoryNonProportional">LockOpener</span>. However, the design
                        of the <span class="EmphasisFontCategoryNonProportional">KeyHelper</span> class involves some internal states that make it not suitable for reuse. Every time the <span class="EmphasisFontCategoryNonProportional">openLock()</span>                        method is called, a new <span id="ITerm106">              <span class="EmphasisFontCategoryNonProportional">KeyHelper</span> instance </span> is required. In this case, <span class="EmphasisFontCategoryNonProportional">LockOpener</span>                        will be a singleton. However, if we inject the <span class="EmphasisFontCategoryNonProportional">KeyHelper</span> class by using the normal mechanism, the same instance of the <span class="EmphasisFontCategoryNonProportional">KeyHelper</span>                        class (which was instantiated when Spring performed the injection the first time) will be reused. To make sure that a new instance of the <span class="EmphasisFontCategoryNonProportional">KeyHelper</span> instance is passed into
                        the <span class="EmphasisFontCategoryNonProportional">openLock()</span> method every time it is invoked, we need to use Lookup Method Injection.</div>
                    <div class="Para" id="Par256">Typically, you can achieve this by having the singleton bean implement the <span class="EmphasisFontCategoryNonProportional">ApplicationContextAware</span> interface (we discuss this interface in the next chapter). Then, using the
                        <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> instance, the singleton bean can look up a new instance of the nonsingleton dependency every time it needs it. Lookup Method Injection allows the singleton
                        bean to declare that it requires a nonsingleton dependency and that it will receive a new instance of the nonsingleton bean each time it needs to interact with it, without needing to implement any Spring-specific interfaces.</div>
                    <div class="Para" id="Par257">Lookup Method Injection works by having your singleton declare a method, the lookup method, which returns an instance of the nonsingleton bean. When you obtain a reference to the singleton in your application, you are actually receiving
                        a reference to a dynamically created subclass on which Spring has implemented the lookup method. A typical implementation involves defining the lookup method, and thus the bean class, as abstract. This prevents any strange errors
                        from creeping in when you forget to configure the Method Injection and you are working directly against the bean class with the empty method implementation instead of the Spring-enhanced subclass. This topic is quite complex and
                        is best shown by example.</div>
                <div class="Para ParaOneEmphasisChild" id="Par258">In this example, we create one nonsingleton bean and two singleton beans that both implement the same interface. One of the singletons obtains an instance of the nonsingleton bean by using “traditional” setter injection; the other uses
                    Method Injection. The following code sample depicts the <span class="EmphasisFontCategoryNonProportional">Singer</span> class, which in this example is the type of the nonsingleton bean:</div>
                <div class="Para" id="Par259">
                    <div class="ProgramCode" id="PC76">
                        <div class="LineGroup">
                            <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Singer</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> lyric <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">I played a quick game of chess with the salt
    and pepper
    shaker</span>;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">sing</span>() {
        <span style="color:#06f;font-style:italic">//commented because it pollutes the output</span>
        <span style="color:#06f;font-style:italic">//System.out.println(lyric);</span>
    }
}
</pre></div>
                        </div>
                    </div>
                </div>
                <div class="Para ParaOneEmphasisChild" id="Par260">This class is decidedly unexciting, but it serves the purposes of this example perfectly. Next, you can see the <span class="EmphasisFontCategoryNonProportional">DemoBean</span> interface, which is implemented by both of the singleton
                    bean classes.</div>
                <div class="Para" id="Par261">
                    <div class="ProgramCode" id="PC77">
                        <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">DemoBean</span> {
    <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">getMySinger</span>();

    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">doSomething</span>();
}
</pre></div>
                    </div>
                </div>
                <div class="Para" id="Par262">This bean has two methods: <span class="EmphasisFontCategoryNonProportional">getMySinger()</span> and <span class="EmphasisFontCategoryNonProportional">doSomething()</span> <span id="ITerm107">                                                    </span>.
                    The sample application uses the <span class="EmphasisFontCategoryNonProportional">getMySinger()</span> method to get a reference to the <span class="EmphasisFontCategoryNonProportional">Singer</span> instance and, in the case of the
                    method lookup bean, to perform the actual method lookup. The <span class="EmphasisFontCategoryNonProportional">doSomething()</span>method is a simple method that depends on the <span class="EmphasisFontCategoryNonProportional">Singer</span>                    class to do its processing. The following code snippet shows the <span class="EmphasisFontCategoryNonProportional">StandardLookupDemoBean</span> class, which uses setter injection to obtain an instance of the <span class="EmphasisFontCategoryNonProportional">Singer</span>                    class:</div>
                <div class="Para" id="Par263">
                    <div class="ProgramCode" id="PC78">
                        <div class="LineGroup">
                            <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">StandardLookupDemoBean</span>
        <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">DemoBean</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Singer</span> mySinger;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setMySinger</span>(<span style="color:#00f;font-weight:700">Singer</span> <span style="font-style:italic">mySinger</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>mySinger <span style="color:#00f;font-weight:700">=</span> mySinger;
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">getMySinger</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>mySinger;
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">doSomething</span>() {
        mySinger<span style="color:#00f;font-weight:700">.</span>sing();
    }
}
</pre></div>
                        </div>
                    </div>
                </div>
                <div class="Para" id="Par264">This code should all look familiar, but notice that the <span id="ITerm108">              <span class="EmphasisFontCategoryNonProportional">doSomething()</span> method </span> uses the stored instance of <span class="EmphasisFontCategoryNonProportional">Singer</span>                    to complete its processing. In the following code snippet, you can see the <span class="EmphasisFontCategoryNonProportional">AbstractLookupDemoBean</span> class, which uses Method Injection to obtain an instance of the <span class="EmphasisFontCategoryNonProportional">Singer</span>                    class.</div>
                <div class="Para" id="Par265">
                    <div class="ProgramCode" id="PC79">
                        <div class="LineGroup">
                            <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">abstract</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AbstractLookupDemoBean</span>
        <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">DemoBean</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">abstract</span> <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">getMySinger</span>();

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">doSomething</span>() {
        getMySinger()<span style="color:#00f;font-weight:700">.</span>sing();
    }
}
</pre></div>
                        </div>
                    </div>
                </div>
                <div class="Para" id="Par266">Notice that the <span id="ITerm109">              <span class="EmphasisFontCategoryNonProportional">getMySinger()</span> method </span> <span id="ITerm110">                                                    </span> is declared as abstract
                    and that this method is called by the <span class="EmphasisFontCategoryNonProportional">doSomething()</span> method to obtain a <span class="EmphasisFontCategoryNonProportional">Singer</span> instance. The Spring XML configuration
                    for this example is contained in a file named <span class="EmphasisFontCategoryNonProportional">app-context-xml.xml</span> and is shown here:</div>
                <div class="Para" id="Par267">
                    <div class="ProgramCode" id="PC80">
                        <div class="LineGroup">
                            <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">singer</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.Singer</span>
          <span style="font-style:italic">scope</span>=<span style="color:#036a07">prototype</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">abstractLookupBean</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.AbstractLookupDemoBean</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">lookup-method</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">getMySinger</span> <span style="font-style:italic">bean</span>=<span style="color:#036a07">singer</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">bean</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">standardLookupBean</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.StandardLookupDemoBean</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">property</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">mySinger</span> <span style="font-style:italic">ref</span>=<span style="color:#036a07">singer</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">bean</span>&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
                        </div>
                    </div>
                </div>
                <div class="Para" id="Par268">The configuration for the <span class="EmphasisFontCategoryNonProportional">singer</span> and <span class="EmphasisFontCategoryNonProportional">standardLookupBean</span> beans should look familiar to you by now. For <span class="EmphasisFontCategoryNonProportional">abstract-LookupBean</span>,
                    you need to configure the lookup method by using the <span class="EmphasisFontCategoryNonProportional">&lt;lookup-method&gt;</span> tag. The <span class="EmphasisFontCategoryNonProportional">name</span> attribute of the <span class="EmphasisFontCategoryNonProportional">&lt;lookup-method&gt;</span>                    tag tells Spring the name of the method on the bean that it should override. This method must not accept any arguments, and the return type should be that of the bean you want to return from the method. In this case, the method should
                    return a class of type <span class="EmphasisFontCategoryNonProportional">Singer</span>, or its subclasses. The bean attribute tells Spring which bean the lookup method should return. The following code snippet shows the final piece
                    of code for this example, which is the class containing the <span class="EmphasisFontCategoryNonProportional">main()</span> method used to run the example:</div>
                <div class="Para" id="Par269">
                    <div class="ProgramCode" id="PC81">
                        <div class="LineGroup">
                            <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.util.StopWatch</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">LookupDemo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-xml.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">DemoBean</span> abstractBean <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">abstractLookupBean</span>,
                <span style="color:#00f;font-weight:700">DemoBean</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">DemoBean</span> standardBean <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">standardLookupBean</span>,
                <span style="color:#00f;font-weight:700">DemoBean</span><span style="color:#00f;font-weight:700">.</span>class);
        displayInfo(<span style="color:#036a07">abstractLookupBean</span>, abstractBean);
        displayInfo(<span style="color:#036a07">standardLookupBean</span>, standardBean);
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">displayInfo</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">beanName</span>, <span style="color:#00f;font-weight:700">DemoBean</span> <span style="font-style:italic">bean</span>) {
        <span style="color:#00f;font-weight:700">Singer</span> singer1 <span style="color:#00f;font-weight:700">=</span> bean<span style="color:#00f;font-weight:700">.</span>getMySinger();
        <span style="color:#00f;font-weight:700">Singer</span> singer2 <span style="color:#00f;font-weight:700">=</span> bean<span style="color:#00f;font-weight:700">.</span>getMySinger();
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07"></span> <span style="color:#00f;font-weight:700">+</span> beanName <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">: Singer Instances the Same? </span>
                <span style="color:#00f;font-weight:700">+</span> (singer1 <span style="color:#00f;font-weight:700">==</span> singer2));
        <span style="color:#00f;font-weight:700">StopWatch</span> stopWatch <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">StopWatch</span>();
        stopWatch<span style="color:#00f;font-weight:700">.</span>start(<span style="color:#036a07">lookupDemo</span>);
        <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">int</span> x <span style="color:#00f;font-weight:700">=</span> <span style="color:#0000cd">0</span>; x <span style="color:#00f;font-weight:700">&lt;</span> <span style="color:#0000cd">100000</span>; x<span style="color:#00f;font-weight:700">++</span>) {
            <span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">=</span> bean<span style="color:#00f;font-weight:700">.</span>getMySinger();
            singer<span style="color:#00f;font-weight:700">.</span>sing();
        }
        stopWatch<span style="color:#00f;font-weight:700">.</span>stop();
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">100000 gets took </span>
                <span style="color:#00f;font-weight:700">+</span> stopWatch<span style="color:#00f;font-weight:700">.</span>getTotalTimeMillis() <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07"> ms</span>);
    }
}
</pre></div>
                        </div>
                    </div>
                </div>
                <div class="Para" id="Par270">In this code, you can see that the <span class="EmphasisFontCategoryNonProportional">abstractLookupBean</span> and the <span class="EmphasisFontCategoryNonProportional">standardLookupBean</span> from the <span id="ITerm112">                  <span class="EmphasisFontCategoryNonProportional">GenericXmlApplicationContext</span>                    </span> are retrieved and each reference is passed to the <span class="EmphasisFontCategoryNonProportional">displayInfo()</span> method. The instantiation of the abstract class is supported only when using Lookup Method Injection,
                    in which Spring will use CGLIB to generate a subclass of the AbstractLookupDemoBean class that overrides the method dynamically. The first part of the <span id="ITerm113">              <span class="EmphasisFontCategoryNonProportional">displayInfo()</span>                    method </span> creates two local variables of <span class="EmphasisFontCategoryNonProportional">Singer</span> type and assigns them each a value by calling <span class="EmphasisFontCategoryNonProportional">getMySinger()</span> on the
                    bean passed to it. Using these two variables, it writes a message to the console indicating whether the two references point to the same object.</div>
                <div class="Para" id="Par271">For the <span class="EmphasisFontCategoryNonProportional">abstractLookupBean</span> bean, a new instance of <span class="EmphasisFontCategoryNonProportional">Singer</span> should be retrieved for each call to <span class="EmphasisFontCategoryNonProportional">getMySinger()</span>,
                    so the references should not be the same.</div>
                <div class="Para" id="Par272">For <span class="EmphasisFontCategoryNonProportional">standardLookupBean</span>, a single <span id="ITerm114">instance                          </span> of <span class="EmphasisFontCategoryNonProportional">Singer</span> is passed to the
                    bean by setter injection, and this instance is stored and returned for every call to <span class="EmphasisFontCategoryNonProportional">getMySinger()</span>, so the two references should be the same.</div>
                <div class="Para ParaTypeImportant" id="Par273">
                <img alt="A315511_5_En_3_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" width="30"/>                    The <span class="EmphasisFontCategoryNonProportional">StopWatch</span> class used in the previous example is a utility class available with Spring. You’ll find <span class="EmphasisFontCategoryNonProportional">StopWatch</span> very
                    useful when you need to perform simple performance tests and when you are testing your applications.</div>
                <div class="Para" id="Par274">The final part of the <span id="ITerm115">              <span class="EmphasisFontCategoryNonProportional">displayInfo()</span> method </span> runs a simple performance test to see which bean is faster. Clearly, <span class="EmphasisFontCategoryNonProportional">standardLookupBean</span>                    should be faster because it returns the same instance each time, but it is interesting to see the difference. We can now run the <span class="EmphasisFontCategoryNonProportional">LookupDemo</span> class for testing. Here is the output
                    we received from this example:</div>
                <div class="Para" id="Par275">
                    <div class="ProgramCode" id="PC82">
                        <div class="LineGroup">
                            <div class="FixedLine">[abstractLookupBean]: Singer Instances the Same? false</div>
                            <div class="FixedLine">100000 gets took 431 ms</div>
                        </div>
                        <div class="LineGroup">
                            <div class="FixedLine">[standardLookupBean]: Singer Instances the Same? true</div>
                            <div class="FixedLine">100000 gets took 1 ms</div>
                        </div>
                    </div>
                </div>
                <div class="Para" id="Par276">As you can see, the <span class="EmphasisFontCategoryNonProportional">Singer</span> instances are, as expected, the same when we use <span class="EmphasisFontCategoryNonProportional">standardLookupBean</span> and different when we use
                    <span class="EmphasisFontCategoryNonProportional">abstractLookupBean</span>. There is a noticeable performance difference when you use <span class="EmphasisFontCategoryNonProportional">standardLookupBean</span>, but that is to be expected.</div>
                <div class="Para" id="Par277">Of course, there is an equivalent way to configure the beans presented earlier using annotations. The <span class="EmphasisFontCategoryNonProportional">singer</span> bean must have an extra annotation to specify the <span class="EmphasisFontCategoryNonProportional">prototype</span>                    scope.</div>
            <div class="Para" id="Par278">
                <div class="ProgramCode" id="PC83">
                    <div class="LineGroup">
                        <div class="FixedLine">package com.apress.prospring5.ch3.annotated;</div>
                    </div>
                    <div class="LineGroup">
                        <div class="FixedLine">import org.springframework.context.annotation.Scope;</div>
                        <div class="FixedLine">import org.springframework.stereotype.Component;</div>
                    </div>
                    <div class="LineGroup">
                        <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.annotated</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Scope</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Component</span>;

@Component(<span style="color:#036a07">singer)
        @Scope(</span>prototype<span style="color:#036a07">)
        public class Singer{
        private String lyric=</span><span style="color:#00f;font-weight:700">I</span> played a quick game of chess with the salt and pepper shaker<span style="color:#036a07">&quot;;
        public void sing(){
        // commented to avoid console pollution
        //System.out.println(lyric);
        }
        }
</span></pre></div>
                    </div>
                </div>
            </div>
            <div class="Para" id="Par279">The <span class="EmphasisFontCategoryNonProportional">AbstractLookupDemoBean</span> class is no longer an abstract class, and the method <span class="EmphasisFontCategoryNonProportional">getMySinger()</span> has an empty body and is annotated
                with <span class="EmphasisFontCategoryNonProportional">@Lookup</span> that receives as an <span id="ITerm116">argument                           </span>the name of the <span class="EmphasisFontCategoryNonProportional">Singer</span> bean.
                The method body will be overridden, in the dynamically generated subclass.</div>
            <div class="Para" id="Par280">
                <div class="ProgramCode" id="PC84">
                    <div class="LineGroup">
                        <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.annotated</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Lookup</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Component</span>;

@Component(<span style="color:#036a07">abstractLookupBean</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AbstractLookupDemoBean</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">DemoBean</span> {
    <span style="color:#00f;font-weight:700">@Lookup</span>(<span style="color:#036a07">singer</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">getMySinger</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#585cf6;font-weight:700">null</span>; <span style="color:#06f;font-style:italic">// overriden dynamically</span>
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">doSomething</span>() {
        getMySinger()<span style="color:#00f;font-weight:700">.</span>sing();
    }
}
</pre></div>
                    </div>
                </div>
            </div>
            <div class="Para" id="Par281">The <span id="ITerm117">              <span class="EmphasisFontCategoryNonProportional">StandardLookupDemoBean</span> class </span> only must be annotated with <span class="EmphasisFontCategoryNonProportional">@Component</span>, and
                <span class="EmphasisFontCategoryNonProportional">setMySinger</span> must be annotated with <span class="EmphasisFontCategoryNonProportional">@Autowired</span> and <span class="EmphasisFontCategoryNonProportional">@Qualifier</span> to inject the <span class="EmphasisFontCategoryNonProportional">singer</span>                    bean.</div>
            <div class="Para" id="Par282">
                <div class="ProgramCode" id="PC85">
                    <div class="LineGroup">
                        <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.annotated</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Autowired</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Qualifier</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Component</span>;

@Component(<span style="color:#036a07">standardLookupBean</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">StandardLookupDemoBean</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">DemoBean</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Singer</span> mySinger;

    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">@Qualifier</span>(<span style="color:#036a07">singer</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setMySinger</span>(<span style="color:#00f;font-weight:700">Singer</span> <span style="font-style:italic">mySinger</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>mySinger <span style="color:#00f;font-weight:700">=</span> mySinger;
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">getMySinger</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>mySinger;
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">doSomething</span>() {
        mySinger<span style="color:#00f;font-weight:700">.</span>sing();
    }
}
</pre></div>
                    </div>
                </div>
            </div>
            <div class="Para" id="Par283">The configuration file, named <span class="EmphasisFontCategoryNonProportional">app-context-annotated.</span> <span id="ITerm118">                  <span class="EmphasisFontCategoryNonProportional">xml</span> </span>, only must enable component
                scanning for the package containing the annotated classes.</div>
            <div class="Para" id="Par284">
                <div class="ProgramCode" id="PC86">
                    <div class="LineGroup">
                        <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">context</span><span style="font-weight:700">:</span><span style="font-weight:700">component-scan</span>
            <span style="font-style:italic">base-package</span>=<span style="color:#036a07">com.apress.prospring5.ch3.annotated</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
                    </div>
                </div>
            </div>
            <div class="Para" id="Par285">The class used to execute the code is identical to class <span class="EmphasisFontCategoryNonProportional">LookupDemo</span>; the only difference is the XML file used as an argument to create the <span class="EmphasisFontCategoryNonProportional">GenericXmlApplicationContext</span>                object.</div>
            <div class="Para ParaOneEmphasisChild" id="Par286">If we want to get rid of XML files totally, this can be done using a configuration class to enable component scanning on the <span class="EmphasisFontCategoryNonProportional">com.apress.prospring5.ch3.annotated</span> package. And this class
                can be declared right where you need it, meaning in this case inside the class being run to test the beans, as shown here:</div>
            <div class="Para" id="Par287">
                <div class="ProgramCode" id="PC87">
                    <div class="LineGroup">
                        <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.config</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.annotated.DemoBean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.annotated.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.AnnotationConfigApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.ComponentScan</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Configuration</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.util.StopWatch</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Arrays</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">LookupConfigDemo</span> {
    <span style="color:#00f;font-weight:700">@Configuration</span>
    <span style="color:#00f;font-weight:700">@ComponentScan</span>(<span style="color:#c5060b;font-weight:700">basePackages</span> <span style="color:#00f;font-weight:700">=</span> {<span style="color:#036a07">com.apress.prospring5.ch3.annotated</span>})
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">LookupConfig</span> {
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">LookupConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">DemoBean</span> abstractBean <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">abstractLookupBean</span>,
                <span style="color:#00f;font-weight:700">DemoBean</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">DemoBean</span> standardBean <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">standardLookupBean</span>,
                <span style="color:#00f;font-weight:700">DemoBean</span><span style="color:#00f;font-weight:700">.</span>class);
        displayInfo(<span style="color:#036a07">abstractLookupBean</span>, abstractBean);
        displayInfo(<span style="color:#036a07">standardLookupBean</span>, standardBean);
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">displayInfo</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">beanName</span>, <span style="color:#00f;font-weight:700">DemoBean</span> <span style="font-style:italic">bean</span>) {
        <span style="color:#06f;font-style:italic">// same implementation as before</span>
                .<span style="color:#00f;font-weight:700">.</span>.
    }
}
</pre></div>
                    </div>
                </div>
            </div>
            <div class="Para" id="Par288">Alternative configurations using <span id="ITerm120">annotations                          </span> and Java configuration are covered in more detail in Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Chapter.html"><span class="RefSource">4</span></a>
                </span>.</div>
            </div>
            <div class="Section3 RenderAsSection3" id="Sec30">
                <h4 class="Heading">Considerations for Lookup Method Injection</h4>
                <div class="Para" id="Par289">Lookup Method Injection is intended for use when you want to work with two beans of different life cycles. Avoid the temptation to use Lookup Method Injection when the beans share the same life cycle, especially if they are singletons.
                    The output of running the previous example shows a noticeable difference in performance between using Method Injection to obtain new instances of a dependency and using standard DI to obtain a single instance of a dependency. Also,
                    make sure you don’t use Lookup Method Injection needlessly, even when you have beans of different life cycles.</div>
                <div class="Para" id="Par290">Consider a situation in which you have three singletons that share a dependency in common. You want each singleton to have its own instance of the dependency, so you create the dependency as a nonsingleton, but you are happy with each
                    singleton using the same instance of the collaborator throughout its life. In this case, setter injection is the ideal solution; Lookup Method Injection just adds unnecessary overhead.</div>
                <div class="Para" id="Par291">When you are using <span id="ITerm121">Lookup Method Injection,                          </span> there are a few design guidelines that you should keep in mind when building your classes. In the earlier examples, we declared the lookup
                    method in an interface. The only reason we did this was we did not have to duplicate the <span class="EmphasisFontCategoryNonProportional">displayInfo()</span> method twice for two different bean types. As mentioned earlier, generally
                    you do not need to pollute a business interface with unnecessary definitions that are used solely for IoC purposes. Another point is that although you don’t have to make your lookup method abstract, doing so prevents you from forgetting
                    to configure the lookup method and then using a blank implementation by accident. Of course, this works only with XML configuration. Annotation-based configuration forces an empty implementation of the method; otherwise, your bean
                    won’t be created.</div>
            </div>
            <div class="Section3 RenderAsSection3" id="Sec31">
                <h4 class="Heading">Method Replacement</h4>
                <div class="Para" id="Par292">Although the Spring documentation classifies <span id="ITerm122">method replacement                          </span> as a form of injection, it is different from what you have seen so far. So far, we have used injection purely to supply
                    beans with their collaborators. Using method replacement, you can replace the implementation of any method on any beans arbitrarily without having to change the source of the bean you are modifying. For example, you have a third-party
                    library that you use in your Spring application, and you need to change the logic of a certain method. However, you are not able to change the source code because it was provided by a third party, so one solution is to use method replacement
                    to just replace the logic for that method with your own implementation.</div>
                <div class="Para" id="Par293">Internally, you achieve this by creating a subclass of the bean class dynamically. You use CGLIB and redirect calls to the method you want to replace to another bean that implements the <span class="EmphasisFontCategoryNonProportional">MethodReplacer</span>                    interface. In the following code sample, you can see a simple bean that declares two overloads of the <span id="ITerm123">              <span class="EmphasisFontCategoryNonProportional">formatMessage()</span> method </span>:</div>
                <div class="Para" id="Par294">
                    <div class="ProgramCode" id="PC88">
                        <div class="LineGroup">
                            <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">ReplacementTarget</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">formatMessage</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">msg</span>) {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">&lt;h1&gt;</span> <span style="color:#00f;font-weight:700">+</span> msg <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">&lt;/h1&gt;</span>;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">formatMessage</span>(<span style="color:#00f;font-weight:700">Object</span> <span style="font-style:italic">msg</span>) {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">&lt;h1&gt;</span> <span style="color:#00f;font-weight:700">+</span> msg <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">&lt;/h1&gt;</span>;
    }
}
</pre></div>
                        </div>
                    </div>
            </div>
            <div class="Para" id="Par295">You can replace any of the methods on the <span class="EmphasisFontCategoryNonProportional">ReplacementTarget</span> class by using Spring’s method replacement functionality. In this example, we show you how to replace the <span class="EmphasisFontCategoryNonProportional">formatMessage(String)</span>                method, and we also compare the performance of the replaced method with that of the original.</div>
            <div class="Para ParaOneEmphasisChild" id="Par296">To replace a method, you first need to create an implementation of the <span class="EmphasisFontCategoryNonProportional">MethodReplacer</span> interface; this is shown in the following code sample:</div>
            <div class="Para" id="Par297">
                <div class="ProgramCode" id="PC89">
                    <div class="LineGroup">
                        <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.support.MethodReplacer</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.lang.reflect.Method</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">FormatMessageReplacer</span>
        <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">MethodReplacer</span> {
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Object</span> <span style="color:#0000a2;font-weight:700">reimplement</span>(<span style="color:#00f;font-weight:700">Object</span> <span style="font-style:italic">arg0</span>, <span style="color:#00f;font-weight:700">Method</span> <span style="font-style:italic">method</span>, <span style="color:#00f;font-weight:700">Object</span>... <span style="font-style:italic">args</span>)
            <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Throwable</span> {
        <span style="color:#00f;font-weight:700">if</span> (isFormatMessageMethod(method)) {
            <span style="color:#00f;font-weight:700">String</span> msg <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">String</span>) args0;
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">&lt;h2&gt;</span> <span style="color:#00f;font-weight:700">+</span> msg <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">&lt;/h2&gt;</span>;
        } <span style="color:#00f;font-weight:700">else</span> {
            <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">IllegalArgumentException</span>(<span style="color:#036a07">Unable to reimplement method </span>
                    <span style="color:#00f;font-weight:700">+</span> method<span style="color:#00f;font-weight:700">.</span>getName());
        }
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">boolean</span> <span style="color:#0000a2;font-weight:700">isFormatMessageMethod</span>(<span style="color:#00f;font-weight:700">Method</span> <span style="font-style:italic">method</span>) {
        <span style="color:#00f;font-weight:700">if</span> (method<span style="color:#00f;font-weight:700">.</span>getParameterTypes()<span style="color:#00f;font-weight:700">.</span>length <span style="color:#00f;font-weight:700">!=</span> <span style="color:#0000cd">1</span>) {
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#585cf6;font-weight:700">false</span>;
        }
        <span style="color:#00f;font-weight:700">if</span> (<span style="color:#00f;font-weight:700">!</span>(<span style="color:#036a07">formatMessage</span><span style="color:#00f;font-weight:700">.</span>equals(method<span style="color:#00f;font-weight:700">.</span>getName()))) {
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#585cf6;font-weight:700">false</span>;
        }
        <span style="color:#00f;font-weight:700">if</span> (method<span style="color:#00f;font-weight:700">.</span>getReturnType() <span style="color:#00f;font-weight:700">!=</span> <span style="color:#00f;font-weight:700">String</span><span style="color:#00f;font-weight:700">.</span>class) {
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#585cf6;font-weight:700">false</span>;
        }
        <span style="color:#00f;font-weight:700">if</span> (method<span style="color:#00f;font-weight:700">.</span>getParameterTypes()[<span style="color:#0000cd">0</span>] <span style="color:#00f;font-weight:700">!=</span> <span style="color:#00f;font-weight:700">String</span><span style="color:#00f;font-weight:700">.</span>class) {
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#585cf6;font-weight:700">false</span>;
        }
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#585cf6;font-weight:700">true</span>;
    }
}
</pre></div>
                </div>
            </div>
            </div>
            <div class="Para" id="Par298">The <span class="EmphasisFontCategoryNonProportional">MethodReplacer</span> interface has a single method, <span class="EmphasisFontCategoryNonProportional">reimplement()</span>, that you must implement. Three arguments are passed to
                <span class="EmphasisFontCategoryNonProportional">reimplement()</span>: the bean on which the original method was invoked, a <span class="EmphasisFontCategoryNonProportional">Method</span> instance that represents the method that is being overridden, and the array of arguments passed
                    to the method. The <span class="EmphasisFontCategoryNonProportional">reimplement()</span> method should return the result of your reimplemented logic, and, obviously, the type of the return value should be compatible with the return
                    type of the method you are replacing. In the previous code sample, <span class="EmphasisFontCategoryNonProportional">FormatMessageReplacer</span> first checks to see whether the method that is being overridden is the <span class="EmphasisFontCategoryNonProportional">formatMessage(String)</span>                    method; if so, it executes the replacement logic (in this case, surrounding the message with <span class="EmphasisFontCategoryNonProportional">&lt;h2&gt;</span> and <span class="EmphasisFontCategoryNonProportional">&lt;/h2&gt;</span>)
                    and returns the formatted message to the caller. It is not necessary to check whether the message is correct, but this can be useful if you are using a few <span class="EmphasisFontCategoryNonProportional">MethodReplacer</span>s with
                    similar arguments. Using a check helps prevent a situation in which a different <span id="ITerm125">                  <span class="EmphasisFontCategoryNonProportional">MethodReplacer</span> </span> with compatible arguments and return
                    types is used accidentally.</div>
            <div class="Para" id="Par299">In the configuration sample listed next, you can see an <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> instance that defines two beans of type <span class="EmphasisFontCategoryNonProportional">ReplacementTarget</span>;
                one has the <span class="EmphasisFontCategoryNonProportional">formatMessage(String)</span> method replaced, and the other does not (the file is named <span class="EmphasisFontCategoryNonProportional">app-context-xml.xml</span>):</div>
            <div class="Para" id="Par300">
                <div class="ProgramCode" id="PC90">
                    <div class="LineGroup">
                        <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">methodReplacer</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.FormatMessageReplacer</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">replacementTarget</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.ReplacementTarget</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">replaced-method</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">formatMessage</span> <span style="font-style:italic">replacer</span>=<span style="color:#036a07">methodReplacer</span>&gt;</span>
            <span style="color:#1c02ff">&lt;<span style="font-weight:700">arg-type</span>&gt;</span>String<span style="color:#1c02ff">&lt;/<span style="font-weight:700">arg-type</span>&gt;</span>
        <span style="color:#1c02ff">&lt;/<span style="font-weight:700">replaced-method</span>&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">bean</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">standardTarget</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.ReplacementTarget</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
                    </div>
                </div>
                </div>
                <div class="Para" id="Par301">As you can see, the <span class="EmphasisFontCategoryNonProportional">MethodReplacer</span> implementation is declared as a bean in <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>. You then use the <span class="EmphasisFontCategoryNonProportional">&lt;replaced-method&gt;</span>                    tag to replace the <span class="EmphasisFontCategoryNonProportional">formatMessage(String)</span> method on <span class="EmphasisFontCategoryNonProportional">replacementTargetBean</span>. The name attribute of the <span class="EmphasisFontCategoryNonProportional">&lt;replaced-method&gt;</span>                    tag specifies the name of the method to replace, and the replacer attribute is used to specify the name of the <span class="EmphasisFontCategoryNonProportional">MethodReplacer</span> bean that we want to replace the method implementation.
                    In cases where there are overloaded methods such as in the <span class="EmphasisFontCategoryNonProportional">ReplacementTarget</span> class, you can use the <span class="EmphasisFontCategoryNonProportional">&lt;arg-type&gt;</span>                    tag to specify the method signature to match. The <span class="EmphasisFontCategoryNonProportional">&lt;arg-type&gt;</span> tag supports pattern matching, so <span class="EmphasisFontCategoryNonProportional">String</span> is matched
                    to <span class="EmphasisFontCategoryNonProportional">java.lang.String</span> and also to <span class="EmphasisFontCategoryNonProportional">java.lang.StringBuffer</span>.</div>
                <div class="Para" id="Par302">The following code snippet shows a simple demo application that retrieves both the <span class="EmphasisFontCategoryNonProportional">standardTarget</span> and <span class="EmphasisFontCategoryNonProportional">replacement-Target</span>                    beans from <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>, executes their <span class="EmphasisFontCategoryNonProportional">formatMessage(String)</span> methods, and then runs a simple performance test
                    to see which is faster.</div>
                <div class="Para" id="Par303">
                    <div class="ProgramCode" id="PC91">
                        <div class="LineGroup">
                            <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.util.StopWatch</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">MethodReplacementDemo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-xml.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">ReplacementTarget</span> replacementTarget <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">ReplacementTarget</span>) ctx
                .getBean(<span style="color:#036a07">replacementTarget</span>);
        <span style="color:#00f;font-weight:700">ReplacementTarget</span> standardTarget <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">ReplacementTarget</span>) ctx
                .getBean(<span style="color:#036a07">standardTarget</span>);
        displayInfo(replacementTarget);
        displayInfo(standardTarget);
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">displayInfo</span>(<span style="color:#00f;font-weight:700">ReplacementTarget</span> <span style="font-style:italic">target</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(target<span style="color:#00f;font-weight:700">.</span>formatMessage(<span style="color:#036a07">Thanks for playing, try again!</span>));
        <span style="color:#00f;font-weight:700">StopWatch</span> stopWatch <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">StopWatch</span>();
        stopWatch<span style="color:#00f;font-weight:700">.</span>start(<span style="color:#036a07">perfTest</span>);
        <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">int</span> x <span style="color:#00f;font-weight:700">=</span> <span style="color:#0000cd">0</span>; x <span style="color:#00f;font-weight:700">&lt;</span> <span style="color:#0000cd">1000000</span>; x<span style="color:#00f;font-weight:700">++</span>) {
            <span style="color:#00f;font-weight:700">String</span> out <span style="color:#00f;font-weight:700">=</span> target<span style="color:#00f;font-weight:700">.</span>formatMessage(<span style="color:#036a07">No filter in my head</span>);
            <span style="color:#06f;font-style:italic">//commented to not pollute the console</span>
            <span style="color:#06f;font-style:italic">//System.out.println(out);</span>
        }
        stopWatch<span style="color:#00f;font-weight:700">.</span>stop();
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">1000000 invocations took: </span>
                <span style="color:#00f;font-weight:700">+</span> stopWatch<span style="color:#00f;font-weight:700">.</span>getTotalTimeMillis() <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07"> ms</span>);
    }
}
</pre></div>
                        </div>
                    </div>
                </div>
                <div class="Para" id="Par304">You should be familiar with this code by now, so we won’t go into detail. On our machine, running this example yields the following output: <span id="ITerm127">                                                    </span> </div>
                <div class="Para" id="Par305">
                    <div class="ProgramCode" id="PC92">
                        <div class="LineGroup">
                            <div class="FixedLine">&lt;h2&gt;Thanks for playing, try again!&lt;/h2&gt;</div>
                            <div class="FixedLine">1000000 invocations took: 188 ms</div>
                        </div>
                        <div class="LineGroup">
                            <div class="FixedLine">&lt;h1&gt;Thanks for playing, try again!&lt;/h1&gt;</div>
                            <div class="FixedLine">1000000 invocations took: 24 ms</div>
                        </div>
                    </div>
                </div>
                <div class="Para" id="Par306">As expected, the output from the <span class="EmphasisFontCategoryNonProportional">replacementTarget</span> bean reflects the overridden implementation that the <span class="EmphasisFontCategoryNonProportional">Method-Replacer</span> provides.
                    Interestingly, though, the dynamically replaced method is many times slower than the statically defined method. Removing the check for a valid method in <span class="EmphasisFontCategoryNonProportional">MethodReplacer</span> made a
                    negligible difference across a number of executions, so we can conclude that most of the overhead is in the CGLIB subclass.</div>
                </div>
                <div class="Section3 RenderAsSection3" id="Sec32">
                    <h4 class="Heading">When to Use Method Replacement</h4>
                    <div class="Para" id="Par307">Method replacement can prove quite useful in a variety of circumstances, especially when you want to override only a particular method for a single bean rather than all beans of the same type. With that said, we still prefer using
                        standard Java mechanisms for overriding methods rather than depending on runtime bytecode enhancement.</div>
                    <div class="Para" id="Par308">If you are going to use method replacement as part of your application, we recommend you use one <span class="EmphasisFontCategoryNonProportional">Method-Replacer</span> per method or group of overloaded methods. Avoid the temptation
                        to use a single <span class="EmphasisFontCategoryNonProportional">MethodReplacer</span> for lots of unrelated methods; this results in extra unnecessary String comparisons while your code works out which method it should reimplement.
                        We have found that performing simple checks to ensure that <span class="EmphasisFontCategoryNonProportional">MethodReplacer</span> is working with the correct method is useful and doesn’t add too much overhead to your code. If
                        you are really concerned about performance, you can simply add a Boolean property to your <span class="EmphasisFontCategoryNonProportional">MethodReplacer</span>, which allows you to turn the check on and off using dependency injection.</div>
                </div>
                </div>
                <div class="Section2 RenderAsSection2" id="Sec33">
                    <h3 class="Heading">Understanding Bean Naming</h3>
                    <div class="Para" id="Par309">Spring supports quite a complex <span id="ITerm128">bean-naming structure                      </span> that allows you the flexibility to handle many situations. Every bean must have at least one name that is unique within the containing
                        <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>. Spring follows a simple resolution process to determine what name is used for the bean. If you give the <span class="EmphasisFontCategoryNonProportional">&lt;bean&gt;</span>                        tag an <span class="EmphasisFontCategoryNonProportional">id</span> attribute, the value of that attribute is used as the name. If no <span class="EmphasisFontCategoryNonProportional">id</span> attribute is specified, Spring looks
                        for a <span class="EmphasisFontCategoryNonProportional">name</span> attribute, and if one is defined, it uses the first name defined in the <span class="EmphasisFontCategoryNonProportional">name</span> attribute. (We say the first
                        name because it is possible to define multiple names within the <span class="EmphasisFontCategoryNonProportional">name</span> attribute; this is covered in more detail shortly.) If neither the <span class="EmphasisFontCategoryNonProportional">id</span>                        nor the <span class="EmphasisFontCategoryNonProportional">name</span> attribute is specified, Spring uses the bean’s class name as the name, provided, of course, that no other bean is using the same class name. If multiple beans
                        of the same type without an ID or name are declared, Spring will throw an exception (of type <span class="EmphasisFontCategoryNonProportional">org.springframework.beans.factory.NoSuchBeanDefinitionException</span>) on injection
                        during <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> initialization. The following configuration sample configuration depicts all three naming schemes (<span class="EmphasisFontCategoryNonProportional">app-context-01.xml</span>):</div>
                    <div class="Para" id="Par310">
                        <div class="ProgramCode" id="PC93">
                            <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">string1</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">java.lang.String</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">string2</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">java.lang.String</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">java.lang.String</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
                        </div>
                </div>
                <div class="Para" id="Par311">Each of these approaches is equally valid from a technical point of view, but which is the best choice for your application? To start with, avoid using the automatic name by class behavior. This doesn’t allow you much flexibility to define
                    multiple beans of the same type, and it is much better to define your own names. That way, if Spring changes the default behavior in the future, your application continues to work. If you want to see how Spring is naming the beans,
                    using the previous configuration,<span id="ITerm129">                                              </span> run the following example:</div>
                <div class="Para" id="Par312">
                    <div class="ProgramCode" id="PC94">
                        <div class="LineGroup">
                            <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.xml</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">BeanNamingTest</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-01.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">Map&lt;<span style="color:#00f;font-weight:700">String</span>, <span style="color:#00f;font-weight:700">String</span>&gt;</span> beans <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBeansOfType(<span style="color:#00f;font-weight:700">String</span><span style="color:#00f;font-weight:700">.</span>class);
        beans<span style="color:#00f;font-weight:700">.</span>entrySet()<span style="color:#00f;font-weight:700">.</span>stream()<span style="color:#00f;font-weight:700">.</span>forEach(b <span style="color:#00f;font-weight:700">-</span><span style="color:#00f;font-weight:700">&gt;</span> <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(b<span style="color:#00f;font-weight:700">.</span>getKey()));
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
</pre></div>
                            <div class="FixedLine">}</div>
                        </div>
                    </div>
                </div>
                <div class="Para" id="Par313"> <span class="EmphasisFontCategoryNonProportional">ctx.getBeansOfType(String.class)</span> is used to obtain a map with all beans of type <span class="EmphasisFontCategoryNonProportional">String</span> and their IDs that exist within
                    <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>. The keys of the map are the bean IDs that are printed using the lambda expression in the previous code. With the mentioned configuration, this is the output:</div>
                <div class="Para" id="Par314">
                    <div class="ProgramCode" id="PC95">
                        <div class="FixedLine">string1</div>
                        <div class="FixedLine">string2</div>
                        <div class="FixedLine">java.lang.String#0</div>
                    </div>
                </div>
                <div class="Para" id="Par315">The last line in the previous output sample is the ID that Spring gave to the bean of type <span class="EmphasisFontCategoryNonProportional">String</span> that was not named explicitly in the configuration. If the configuration were modified
                    to add another <span class="EmphasisFontCategoryNonProportional">String</span> unnamed bean, it would look like this:</div>
                <div class="Para" id="Par316">
                    <div class="ProgramCode" id="PC96">
                        <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">string1</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">java.lang.String</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">string2</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">java.lang.String</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">java.lang.String</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">java.lang.String</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
                    </div>
                </div>
                <div class="Para" id="Par317">The output would change to the following: <span id="ITerm130">                                              </span> </div>
                <div class="Para" id="Par318">
                    <div class="ProgramCode" id="PC97">
                        <div class="FixedLine">string1</div>
                        <div class="FixedLine">string2</div>
                        <div class="FixedLine">java.lang.String#0</div>
                        <div class="FixedLine">java.lang.String#1</div>
                    </div>
                </div>
                <div class="Para" id="Par319">Prior to Spring 3.1, the <span class="EmphasisFontCategoryNonProportional">id</span> attribute is the same as the XML identity (that is, <span class="EmphasisFontCategoryNonProportional">xsd:ID</span>), which places a restriction in the
                    characters you can use. As of Spring 3.1, Spring uses <span class="EmphasisFontCategoryNonProportional">xsd:String</span> for the <span class="EmphasisFontCategoryNonProportional">id</span> attribute, so the previous restriction on
                    the characters that you can use is gone. However, Spring will continue to ensure that the <span class="EmphasisFontCategoryNonProportional">id</span> is unique across the entire <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>.
                    As a general practice, you should give your bean a name by using the <span class="EmphasisFontCategoryNonProportional">id</span> attribute and then associate the bean with other names by using name aliasing, as discussed in the next
                    section.</div>
                <div class="Section3 RenderAsSection3" id="Sec34">
                    <h4 class="Heading">Bean Name Aliasing</h4>
                    <div class="Para" id="Par320">Spring allows a bean to have more than one name. You can achieve this by specifying a space-, comma-, or semicolon-separated list of names in the <span class="EmphasisFontCategoryNonProportional">name</span> attribute of the bean’s
                        <span class="EmphasisFontCategoryNonProportional">&lt;bean&gt;</span> tag. You can do this in place of, or in conjunction with, the <span class="EmphasisFontCategoryNonProportional">id</span> attribute. Besides using the
                        <span class="EmphasisFontCategoryNonProportional">name</span> attribute, you can use the <span class="EmphasisFontCategoryNonProportional">&lt;alias&gt;</span> tag for defining aliases for Spring bean names. The following configuration sample shows a simple <span class="EmphasisFontCategoryNonProportional"><pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">john</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">john johnny,jonathan;jim</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">java.lang.String</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">alias</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">john</span> <span style="font-style:italic">alias</span>=<span style="color:#036a07">ion</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
                        </div>
                    </div>
                    <div class="Para" id="Par322">As you can see, we have defined six names: one using the <span class="EmphasisFontCategoryNonProportional">id</span> attribute and the other four as a list using all allowed bean name delimiters in the <span class="EmphasisFontCategoryNonProportional">name</span>                        attribute (this is just for demonstration purposes and is not recommended for real-life development). In real-life development, it’s recommended you standardize on the delimiter to use for separating bean names’ declarations within
                        your application. One more alias was defined using the <span class="EmphasisFontCategoryNonProportional">&lt;alias&gt;</span> tag. The following code sample depicts a Java routine that grabs the same bean from the <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>                        instance six times using different names and verifies that they are the same bean. Also, it makes use of the previously introduced <span class="EmphasisFontCategoryNonProportional">ctx.getBeansOfType(..)</span> method to make sure
                        there is only one <span class="EmphasisFontCategoryNonProportional">String</span> bean in the context.</div>
                    <div class="Para" id="Par323">
                        <div class="ProgramCode" id="PC99">
                            <div class="LineGroup">
                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.xml</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Map</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">BeanNameAliasing</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-02.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">String</span> s1 <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">String</span>) ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">john</span>);
        <span style="color:#00f;font-weight:700">String</span> s2 <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">String</span>) ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">jon</span>);
        <span style="color:#00f;font-weight:700">String</span> s3 <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">String</span>) ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">johnny</span>);
        <span style="color:#00f;font-weight:700">String</span> s4 <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">String</span>) ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">jonathan</span>);
        <span style="color:#00f;font-weight:700">String</span> s5 <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">String</span>) ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">jim</span>);
        <span style="color:#00f;font-weight:700">String</span> s6 <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">String</span>) ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">ion</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println((s1 <span style="color:#00f;font-weight:700">==</span> s2));
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println((s2 <span style="color:#00f;font-weight:700">==</span> s3));
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println((s3 <span style="color:#00f;font-weight:700">==</span> s4));
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println((s4 <span style="color:#00f;font-weight:700">==</span> s5));
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println((s5 <span style="color:#00f;font-weight:700">==</span> s6));
        <span style="color:#00f;font-weight:700">Map&lt;<span style="color:#00f;font-weight:700">String</span>, <span style="color:#00f;font-weight:700">String</span>&gt;</span> beans <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBeansOfType(<span style="color:#00f;font-weight:700">String</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">if</span> (beans<span style="color:#00f;font-weight:700">.</span>size() <span style="color:#00f;font-weight:700">==</span> <span style="color:#0000cd">1</span>) {
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">There is only one String bean.</span>);
        }
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre></div>
                            </div>
                        </div>
                    </div>
                    <div class="Para ParaOneEmphasisChild" id="Par324">Executing the previous code will print <span class="EmphasisFontCategoryNonProportional">true</span> five times and the “There is only one String bean” text, verifying that the beans accessed using different names are, in fact, the
                        same bean.</div>
                    <div class="Para" id="Par325">You can retrieve a list of the bean aliases by calling <span class="EmphasisFontCategoryNonProportional">ApplicationContext.getAliases(String)</span> and passing in any of the beans’ names or IDs. The list of aliases, other than the
                        one you specified, will then be returned as a <span class="EmphasisFontCategoryNonProportional">String</span> array.</div>
                    <div class="Para" id="Par326">It was mentioned before that prior to Spring 3.1 the <span class="EmphasisFontCategoryNonProportional">id</span> attribute is the same as the XML identity (that is, <span class="EmphasisFontCategoryNonProportional">xsd:ID</span>),
                        which means bean IDs could not contain special characters like space-, comma-, or semicolon. Starting with Spring 3.1, <span class="EmphasisFontCategoryNonProportional">xsd:String</span> is used for the <span class="EmphasisFontCategoryNonProportional">id</span>                        attribute, so the previous restriction on the characters that you can use is gone. However, this does not mean you can use the following:</div>
                    <div class="Para" id="Par327">
                        <div class="ProgramCode" id="PC100">
                            <div class="FixedLine">&lt;bean name=&quot;jon johnny,jonathan;jim&quot; class=&quot;java.lang.String&quot;/&gt;</div>
                        </div>
                    </div>
                    <div class="Para" id="Par328">instead of this:</div>
                    <div class="Para" id="Par329">
                        <div class="ProgramCode" id="PC101">
                            <div class="FixedLine">&lt;bean id=&quot;jon johnny,jonathan;jim&quot; class=&quot;java.lang.String&quot;/&gt;</div>
                        </div>
                    </div>
                    <div class="Para" id="Par330">The <span class="EmphasisFontCategoryNonProportional">name</span> and <span class="EmphasisFontCategoryNonProportional">id</span> attribute values are treated differently by the Spring IoC. You can retrieve a list of the bean aliases
                        by calling <span class="EmphasisFontCategoryNonProportional">ApplicationContext.getAliases(String)</span> and passing in any one of the beans’ names or IDs. The list of aliases, other than the one you specified, will then be returned
                        as a <span class="EmphasisFontCategoryNonProportional">String</span> array. This means, in the first case, <span class="EmphasisFontCategoryNonProportional">jon</span> will become the id, and the rest of values will become
                        <span id="ITerm132">aliases </span>.</div>
                    <div class="Para" id="Par331">In the second case, when the same string is used as a value for the <span class="EmphasisFontCategoryNonProportional">id</span> attribute, the full string becomes a unique identifier for the bean. This can be easily tested with a configuration
                        like the one shown here (found in file <span class="EmphasisFontCategoryNonProportional">app-context-03.xml</span>):</div>
                    <div class="Para" id="Par332">
                        <div class="ProgramCode" id="PC102">
                            <div class="LineGroup">
                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">jon johnny,jonathan;jim</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">java.lang.String</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">jon johnny,jonathan;jim</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">java.lang.String</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
                            </div>
                        </div>
                    </div>
                    <div class="Para" id="Par333">and a main class like the one shown in the following code sample:</div>
                    <div class="Para" id="Par334">
                        <div class="ProgramCode" id="PC103">
                            <div class="LineGroup">
                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.xml</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Arrays</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Map</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">BeanCrazyNaming</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-03.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">Map&lt;<span style="color:#00f;font-weight:700">String</span>, <span style="color:#00f;font-weight:700">String</span>&gt;</span> beans <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBeansOfType(<span style="color:#00f;font-weight:700">String</span><span style="color:#00f;font-weight:700">.</span>class);
        beans<span style="color:#00f;font-weight:700">.</span>entrySet()<span style="color:#00f;font-weight:700">.</span>stream()<span style="color:#00f;font-weight:700">.</span>forEach(b <span style="color:#00f;font-weight:700">-</span><span style="color:#00f;font-weight:700">&gt;</span>
        {
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">id: </span> <span style="color:#00f;font-weight:700">+</span> b<span style="color:#00f;font-weight:700">.</span>getKey() <span style="color:#00f;font-weight:700">+</span>
                    <span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span> aliases: &quot;</span> <span style="color:#00f;font-weight:700">+</span> <span style="color:#00f;font-weight:700">Arrays</span><span style="color:#00f;font-weight:700">.</span>toString(ctx<span style="color:#00f;font-weight:700">.</span>getAliases(b<span style="color:#00f;font-weight:700">.</span>getKey())) <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span>&quot;</span>);
        });
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre></div>
                            </div>
                        </div>
                    </div>
                    <div class="Para" id="Par335">When run, this will produce the following output:</div>
                    <div class="Para" id="Par336">
                        <div class="ProgramCode" id="PC104">
                            <div class="LineGroup">
                                <div class="FixedLine">id: jon</div>
                                <div class="FixedLine"> aliases: jonathan, jim, johnny</div>
                            </div>
                            <div class="LineGroup">
                                <div class="FixedLine">id: jon johnny,jonathan;jim</div>
                                <div class="FixedLine"> aliases:</div>
                            </div>
                        </div>
                    </div>
                    <div class="Para" id="Par337">As you can see, the map with <span class="EmphasisFontCategoryNonProportional">String</span> beans contains two beans, one with the <span class="EmphasisFontCategoryNonProportional">jon</span> unique identifier and three aliases and
                        one with the <span class="EmphasisFontCategoryNonProportional">jon johnny,jonathan;jim</span> unique identifier and no aliases.</div>
                    <div class="Para" id="Par338">Bean name aliasing is a strange beast because it is not something you tend to use when you are building a new application. If you are going to have many other beans inject another bean, they may as well use the same name to access
                        that bean. However, as your application goes into production and maintenance work gets carried out, modifications are made, and so on, bean name aliasing becomes more useful.</div>
                    <div class="Para" id="Par339">Consider the following scenario: you have an application in which 50 beans, configured using Spring, all require an implementation of the <span class="EmphasisFontCategoryNonProportional">Foo</span> interface. Twenty-five of the beans
                        use the <span class="EmphasisFontCategoryNonProportional">StandardFoo</span> implementation with the bean name <span class="EmphasisFontCategoryNonProportional">standardFoo</span>, and the other 25 use the <span class="EmphasisFontCategoryNonProportional">SuperFoo</span>                        implementation with the <span class="EmphasisFontCategoryNonProportional">superFoo</span> bean name. Six months after you put the application into production, you decide to move the first 25 beans to the <span class="EmphasisFontCategoryNonProportional">SuperFoo</span>                        implementation. To do this, you have three options.
                        <div class="UnorderedList">
                            <ul class="UnorderedListMarkBullet">
                                <li>
                                    <div class="Para" id="Par340">The first is to change the implementation class of the <span class="EmphasisFontCategoryNonProportional">standardFoo</span> bean to <span class="EmphasisFontCategoryNonProportional">SuperFoo</span>. The drawback of
                                        this approach is that you have two instances of the <span class="EmphasisFontCategoryNonProportional">SuperFoo</span> class lying around when you really need only one. In addition, you now have two beans to make
                                        changes to when the configuration changes.</div>
                                </li>
                                <li>
                                    <div class="Para" id="Par341">The second option is to update the injection configuration for the 25 beans that are changing, which changes the beans’ names from <span class="EmphasisFontCategoryNonProportional">standardFoo</span> to <span class="EmphasisFontCategoryNonProportional">superFoo</span>.
                                        This approach is not the most elegant way to proceed. You could perform a find and replace, but then rolling back your changes when management isn’t happy means retrieving an old version of your configuration from
                                        your version control system.</div>
                                </li>
                                <li>
                                    <div class="Para" id="Par342">The third, and most ideal, approach is to remove (or comment out) the definition for the <span class="EmphasisFontCategoryNonProportional">standardFoo</span> bean and make <span class="EmphasisFontCategoryNonProportional">standardFoo</span>                                        an alias to <span class="EmphasisFontCategoryNonProportional">superFoo</span>. This change requires minimal effort, and restoring the system to its previous configuration is just as <span id="ITerm134">simple                                      </span>.</div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="Section3 RenderAsSection3" id="Sec35">
                    <h4 class="Heading">Bean Naming with Annotation Configurations</h4>
                    <div class="Para" id="Par343">When bean definitions are declared using <span id="ITerm135">annotations, bean naming                          </span> is a little different than XML, and there are more interesting things you can do. Let’s start with the basics, though:
                        declaring bean definitions using stereotype annotations (<span class="EmphasisFontCategoryNonProportional">@Component</span> and all its specializations such as <span class="EmphasisFontCategoryNonProportional">Service</span>,
                        <span class="EmphasisFontCategoryNonProportional">Repository</span>, and <span class="EmphasisFontCategoryNonProportional">Controller</span>).</div>
                    <div class="Para ParaOneEmphasisChild" id="Par344">Consider the following <span class="EmphasisFontCategoryNonProportional">Singer</span> class:</div>
                    <div class="Para" id="Par345">
                        <div class="ProgramCode" id="PC105">
                            <div class="LineGroup">
                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.annotated</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Component</span>;

@<span style="color:#00f;font-weight:700">Component</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Singer</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> lyric <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">We found a message in a bottle we were drinking</span>;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">sing</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(lyric);
    }
}
</pre></div>
                            </div>
                        </div>
                    </div>
                    <div class="Para" id="Par346">This class contains the declaration of a singleton bean of type <span class="EmphasisFontCategoryNonProportional">Singer</span> written using the <span class="EmphasisFontCategoryNonProportional">@Component</span> annotation. The
                        <span class="EmphasisFontCategoryNonProportional">@Component</span> annotation does not have any arguments, so the Spring IoC container decides a unique identifier for the bean. The convention followed in this case is to name the bean, as the class itself, but downcasing the first
                            letter. This means that the bean will be named <span class="EmphasisFontCategoryNonProportional">singer</span>. This convention is respected by other stereotype annotations as well. To test this, the following class can be
                            used:</div>
                    <div class="Para" id="Par347">
                        <div class="ProgramCode" id="PC106">
                            <div class="LineGroup">
                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.annotated</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Arrays</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Map</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AnnotatedBeanNaming</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-annotated.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">Map&lt;<span style="color:#00f;font-weight:700">String</span>, <span style="color:#00f;font-weight:700">Singer</span>&gt;</span> beans <span style="color:#00f;font-weight:700">=</span>
                ctx<span style="color:#00f;font-weight:700">.</span>getBeansOfType(<span style="color:#00f;font-weight:700">Singer</span><span style="color:#00f;font-weight:700">.</span>class);
        beans<span style="color:#00f;font-weight:700">.</span>entrySet()<span style="color:#00f;font-weight:700">.</span>stream()<span style="color:#00f;font-weight:700">.</span>forEach(b <span style="color:#00f;font-weight:700">-</span><span style="color:#00f;font-weight:700">&gt;</span>
                <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">id: </span> <span style="color:#00f;font-weight:700">+</span> b<span style="color:#00f;font-weight:700">.</span>getKey()));
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre></div>
                            </div>
                        </div>
                    </div>
                    <div class="Para" id="Par348">The <span class="EmphasisFontCategoryNonProportional">app-context-annotated.xml</span> configuration file contains only a component scanning declaration for <span class="EmphasisFontCategoryNonProportional">com.apress.prospring5.ch3.annotated</span>                        so it won’t be shown again. When the previous class is run, the following output is printed in the console:</div>
                    <div class="Para" id="Par349">
                        <div class="ProgramCode" id="PC107">
                            <div class="FixedLine">id: singer</div>
                        </div>
                    </div>
                    <div class="Para" id="Par350">Thus, using <span class="EmphasisFontCategoryNonProportional">@Component(&quot;singer&quot;)</span> is equivalent to annotating the <span class="EmphasisFontCategoryNonProportional">Singer</span> class with <span class="EmphasisFontCategoryNonProportional">@Component</span>.
                        If you want to name the bean differently, the <span class="EmphasisFontCategoryNonProportional">@Component</span> annotation must receive the bean name as an argument.</div>
                    <div class="Para" id="Par351">
                        <div class="ProgramCode" id="PC108">
                            <div class="LineGroup">
                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.annotated</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Component</span>;

@Component(<span style="color:#036a07">johnMayer</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Singer</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> lyric <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">Down there below us, under the clouds</span>;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">sing</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(lyric);
    }
}
</pre></div>
                            </div>
                        </div>
                    </div>
                    <div class="Para ParaOneEmphasisChild" id="Par352">As expected, if <span class="EmphasisFontCategoryNonProportional">AnnotatedBeanNaming</span> is run, the following output is produced:</div>
                    <div class="Para" id="Par353">
                        <div class="ProgramCode" id="PC109">
                            <div class="FixedLine">id: johnMayer</div>
                        </div>
                    </div>
                    <div class="Para" id="Par354">But, what about aliases? <span id="ITerm137">                                                    </span>As the argument for the <span class="EmphasisFontCategoryNonProportional">@Component</span> annotation becomes the unique identifier
                        for the bean, bean aliasing is not possible when declaring the bean in this way. This is where Java configuration comes to the rescue. Let’s consider the following class, which contains a static configuration class defined within
                        it (yes, Spring allows this, and we are being practical here, keeping all the logic in the same file):</div>
                    <div class="Para" id="Par355">
                        <div class="ProgramCode" id="PC110">
                            <div class="LineGroup">
                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.config</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.annotated.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.AnnotationConfigApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Bean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Configuration</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Arrays</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Map</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AliasConfigDemo</span> {
    <span style="color:#00f;font-weight:700">@Configuration</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AliasBeanConfig</span> {
        <span style="color:#00f;font-weight:700">@Bean</span>
        <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">singer</span>() {
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Singer</span>();
        }
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">AliasBeanConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">Map&lt;<span style="color:#00f;font-weight:700">String</span>, <span style="color:#00f;font-weight:700">Singer</span>&gt;</span> beans <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBeansOfType(<span style="color:#00f;font-weight:700">Singer</span><span style="color:#00f;font-weight:700">.</span>class);
        beans<span style="color:#00f;font-weight:700">.</span>entrySet()<span style="color:#00f;font-weight:700">.</span>stream()<span style="color:#00f;font-weight:700">.</span>forEach(b <span style="color:#00f;font-weight:700">-</span><span style="color:#00f;font-weight:700">&gt;</span>
                <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">id: </span> <span style="color:#00f;font-weight:700">+</span> b<span style="color:#00f;font-weight:700">.</span>getKey()
                        <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span> aliases: &quot;</span>
                        <span style="color:#00f;font-weight:700">+</span> <span style="color:#00f;font-weight:700">Arrays</span><span style="color:#00f;font-weight:700">.</span>toString(ctx<span style="color:#00f;font-weight:700">.</span>getAliases(b<span style="color:#00f;font-weight:700">.</span>getKey())) <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span>&quot;</span>)
        );
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre></div>
                        </div>
                    </div>
                </div>
                <div class="Para" id="Par356">This class contains a bean <span id="ITerm138">definition                           </span>for a bean of type <span class="EmphasisFontCategoryNonProportional">Singer</span> declared by annotating the <span class="EmphasisFontCategoryNonProportional">singer()</span>                    method with the <span class="EmphasisFontCategoryNonProportional">@Bean</span> annotation. When no argument is provided for this annotation, the bean unique identifier, its <span class="EmphasisFontCategoryNonProportional">id</span>,
                    becomes the method name. Thus, when the previous class is run, we get the following output:</div>
                <div class="Para" id="Par357">
                    <div class="ProgramCode" id="PC111">
                        <div class="FixedLine">id: singer</div>
                        <div class="FixedLine"> aliases:</div>
                    </div>
                </div>
                <div class="Para" id="Par358">To declare aliases, we make use of the <span class="EmphasisFontCategoryNonProportional">name</span> attribute of the <span class="EmphasisFontCategoryNonProportional">@Bean</span> annotation. This attribute is the default one for this
                    annotation, which means in this case declaring the bean by annotating the <span class="EmphasisFontCategoryNonProportional">singer()</span> method with <span class="EmphasisFontCategoryNonProportional">@Bean</span>, <span class="EmphasisFontCategoryNonProportional">@Bean(&quot;singer&quot;)</span>,
                    or <span class="EmphasisFontCategoryNonProportional">@Bean(name=&quot;singer&quot;)</span> will lead to the same result. The Spring IoC container will create a bean of type <span class="EmphasisFontCategoryNonProportional">Singer</span> and
                    with the <span class="EmphasisFontCategoryNonProportional">singer</span> ID.</div>
                <div class="Para ParaOneEmphasisChild" id="Par359">If the value for this attribute is a string containing an alias-specific separator (space, comma, semicolon), the string will become the ID of the bean. But, if the value for it is an array of strings, the first one becomes the <span class="EmphasisFontCategoryNonProportional">id</span>                    and the others become aliases. Modify the bean configuration as shown here:</div>
                <div class="Para" id="Par360">
                    <div class="ProgramCode" id="PC112">
                        <div class="FixedLine"> <span class="EmphasisTypeUnderline"><pre style="background:#fff;color:#000">@<span style="color:#00f;font-weight:700">Configuration</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AliasBeanConfig</span> {
    <span style="color:#00f;font-weight:700">@Bean</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> {<span style="color:#036a07">johnMayer</span>, <span style="color:#036a07">john</span>, <span style="color:#036a07">jonathan</span>, <span style="color:#036a07">johnny</span>})
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">singer</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Singer</span>();
    }
}
</pre></div>
                    </div>
                </div>
                <div class="Para ParaOneEmphasisChild" id="Par361">When running the <span class="EmphasisFontCategoryNonProportional">AliasConfigDemo</span> class, the output will change to the following:</div>
                <div class="Para" id="Par362">
                    <div class="ProgramCode" id="PC113">
                        <div class="FixedLine">id: johnMayer</div>
                        <div class="FixedLine"> aliases: jonathan, johnny, john</div>
                    </div>
                </div>
                <div class="Para" id="Par363">When it comes to aliases, in Spring 4.2 the <span class="EmphasisFontCategoryNonProportional">@AliasFor</span> annotation was introduced. This annotation is used to declare aliases for annotation attributes, and most Spring annotations
                    make use of it. For example, the <span class="EmphasisFontCategoryNonProportional">@Bean</span> annotation has two attributes, <span class="EmphasisFontCategoryNonProportional">name</span> and <span class="EmphasisFontCategoryNonProportional">value</span>,
                    which are declared as aliases for each other. Using this annotation, they are explicit aliases. The following code snippet is a snapshot of the <span class="EmphasisFontCategoryNonProportional">@Bean</span> annotation code and is taken
                    from the official Spring GitHub repository. The code and documentation that are not relevant at the moment were skipped:<a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Chapter.html#Fn4" id="Fn4_source"><sup>4</sup></a> </div>
                <div class="Para" id="Par365">
                    <div class="ProgramCode" id="PC114">
                        <div class="LineGroup">
                            <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.lang.annotation.Documented</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.lang.annotation.ElementType</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.lang.annotation.Retention</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.lang.annotation.RetentionPolicy</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.lang.annotation.Target</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.core.annotation.AliasFor</span>;
.<span style="color:#00f;font-weight:700">.</span>.

@Target({<span style="color:#00f;font-weight:700">ElementType</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>METHOD</span>, <span style="color:#00f;font-weight:700">ElementType</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>ANNOTATION_TYPE</span>})
@Retention(<span style="color:#00f;font-weight:700">RetentionPolicy</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>RUNTIME</span>)
@<span style="color:#00f;font-weight:700">Documented</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">@interface</span> <span style="text-decoration:underline">Bean</span> {
    <span style="color:#00f;font-weight:700">@AliasFor</span>(<span style="color:#036a07">name</span>)
    <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">value</span>() default {};

    <span style="color:#00f;font-weight:700">@AliasFor</span>(<span style="color:#036a07">value</span>)
    <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">name</span>() default {};
        .<span style="color:#00f;font-weight:700">.</span>.
}
</pre></div>
                        </div>
                    </div>
                </div>
                <div class="Para" id="Par366">Here’s an example. Declare an annotation called <span class="EmphasisFontCategoryNonProportional">@Award</span> that can be used on <span class="EmphasisFontCategoryNonProportional">Singer</span> instances, of course.</div>
                <div class="Para" id="Par367">
                    <div class="ProgramCode" id="PC115">
                        <div class="LineGroup">
                            <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.annotated</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.core.annotation.AliasFor</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">@interface</span> <span style="text-decoration:underline">Award</span> {
    <span style="color:#00f;font-weight:700">@AliasFor</span>(<span style="color:#036a07">prize</span>)
    <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">value</span>() default {};

    <span style="color:#00f;font-weight:700">@AliasFor</span>(<span style="color:#036a07">value</span>)
    <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">prize</span>() default {};
}
</pre></div>
                        </div>
                    </div>
                </div>
                <div class="Para" id="Par368">Using this annotation, you can modify the <span class="EmphasisFontCategoryNonProportional">Singer</span> class like <span id="ITerm140">this                          </span>:</div>
                <div class="Para" id="Par369">
                    <div class="ProgramCode" id="PC116">
                        <div class="LineGroup">
                            <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.annotated</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Qualifier</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Component</span>;

@Component(<span style="color:#036a07">johnMayer</span>)
@Award(prize <span style="color:#00f;font-weight:700">=</span> {<span style="color:#036a07">grammy</span>, <span style="color:#036a07">platinum disk</span>})
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Singer</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> lyric <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">We found a message in a bottle we were drinking</span>;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">sing</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(lyric);
    }
}
</pre></div>
                        </div>
                    </div>
                </div>
                <div class="Para" id="Par370">The previous annotation is equivalent to <span class="EmphasisFontCategoryNonProportional">@Award(value={&quot;grammy&quot;, &quot;platinum disk&quot;})</span> and to <span class="EmphasisFontCategoryNonProportional">@Award({&quot;grammy&quot;, &quot;platinum disk&quot;})</span>.</div>
                <div class="Para" id="Par371">But something more interesting can be done with the <span class="EmphasisFontCategoryNonProportional">@AliasFor</span> annotation: aliases for meta-annotation attributes can be declared. In the following code snippet, we declare a specialization
                    for the <span class="EmphasisFontCategoryNonProportional">@Award</span> annotation that declares an attribute named <span class="EmphasisFontCategoryNonProportional">name</span>, which is an alias for the <span class="EmphasisFontCategoryNonProportional">value</span>                    attribute of the <span class="EmphasisFontCategoryNonProportional">@Award</span> annotation. And we do this because we want to make it obvious that the argument is a unique bean identifier.</div>
                    <div class="Para" id="Par372">
                        <div class="ProgramCode" id="PC117">
                            <div class="LineGroup">
                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.annotated</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.core.annotation.AliasFor</span>;

@<span style="color:#00f;font-weight:700">Award</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">@interface</span> <span style="text-decoration:underline">Trophy</span> {
    <span style="color:#00f;font-weight:700">@AliasFor</span>(<span style="color:#c5060b;font-weight:700">annotation</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">Award</span><span style="color:#00f;font-weight:700">.</span>class, <span style="color:#c5060b;font-weight:700">attribute</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">value</span>)
    <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">name</span>() default {};
}
</pre></div>
                            </div>
                        </div>
                    </div>
                    <div class="Para ParaOneEmphasisChild" id="Par373">Thus, instead of writing the <span class="EmphasisFontCategoryNonProportional">Singer</span> class like this:</div>
                    <div class="Para" id="Par374">
                        <div class="ProgramCode" id="PC118">
                            <div class="LineGroup">
                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.annotated</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Component</span>;

@Component(<span style="color:#036a07">johnMayer</span>)
@Award(value <span style="color:#00f;font-weight:700">=</span> {<span style="color:#036a07">grammy</span>, <span style="color:#036a07">platinum disk</span>})
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Singer</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> lyric <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">We found a message in a bottle we were drinking</span>;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">sing</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(lyric);
    }
}
</pre></div>
                            </div>
                        </div>
                    </div>
                    <div class="Para" id="Par375">we can write it like this: <span id="ITerm141">                                                    </span> </div>
                    <div class="Para" id="Par376">
                        <div class="ProgramCode" id="PC119">
                            <div class="LineGroup">
                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.annotated</span>;

@Component(<span style="color:#036a07">johnMayer</span>)
@Trophy(name <span style="color:#00f;font-weight:700">=</span> {<span style="color:#036a07">grammy</span>, <span style="color:#036a07">platinum disk</span>})
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Singer</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> lyric <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">We found a message in a bottle we were drinking</span>;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">sing</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(lyric);
    }
}
</pre></div>
                            </div>
                        </div>
                    </div>
                    <div class="Para ParaTypeImportant" id="Par377"> <img alt="A315511_5_En_3_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" width="30"/>                        Creating aliases for attributes of annotations using yet another annotation <span class="EmphasisFontCategoryNonProportional">@AliasFor</span> does have limitations. <span class="EmphasisFontCategoryNonProportional">@AliasFor</span>                        cannot be used on any stereotype annotations (<span class="EmphasisFontCategoryNonProportional">@Component</span> and its specializations). The reason is that the special handling of these <span class="EmphasisFontCategoryNonProportional">value</span>                        attributes was in place years before <span class="EmphasisFontCategoryNonProportional">@AliasFor</span> was invented. Consequently, because of backward compatibility issues, it is simply not possible to use <span class="EmphasisFontCategoryNonProportional">@AliasFor</span>                        with such value attributes. When writing code to do just so (aliasing <span class="EmphasisFontCategoryNonProportional">value</span> attributes in stereotype annotations), no compile errors will be shown to you, and the code might
                        even run, but any argument provided for the alias will be ignored. The same goes for the <span class="EmphasisFontCategoryNonProportional">@Qualifier</span> annotation as well.</div>
                    </div>
                    </div>
                    <div class="Section2 RenderAsSection2" id="Sec36">
                        <h3 class="Heading">Understanding <span id="ITerm142">Bean Instantiation Mode                      </span> </h3>
                        <div class="Para" id="Par378">By default, all beans in Spring are singletons. This means Spring maintains a single instance of the bean, all dependent objects use the same instance, and all calls to <span class="EmphasisFontCategoryNonProportional">ApplicationContext.getBean()</span>                            return the same instance. We demonstrated this in the previous section, where we were able to use identity comparison <span class="EmphasisFontCategoryNonProportional">(==)</span> rather than the <span class="EmphasisFontCategoryNonProportional">equals()</span>                            comparison to check whether the beans were the same.</div>
                        <div class="Para" id="Par379">The term <span class="EmphasisTypeItalic">singleton</span> is used interchangeably in Java to refer to two distinct concepts: an object that has a single instance within the application and the Singleton design pattern. We refer
                            to the first concept as a <span class="EmphasisTypeItalic">singleton</span> and to the Singleton pattern as Singleton. The Singleton design pattern was popularized in the seminal <span class="EmphasisTypeItalic">Design Patterns: Elements of Reusable Object-Oriented</span>                            <span id="ITerm143">                <span class="EmphasisTypeItalic">Software</span> </span> by Erich Gamma et al. (Addison-Wesley, 1994). The problem arises when people confuse the need for singleton instances with the need
                            to apply the Singleton pattern. The following code snippet shows a typical implementation of the Singleton pattern in Java:</div>
                        <div class="Para" id="Par380">
                            <div class="ProgramCode" id="PC120">
                                <div class="LineGroup">
                                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Singleton</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Singleton</span> instance;

    <span style="color:#00f;font-weight:700">static</span> {
        instance <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Singleton</span>();
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Singleton</span> <span style="color:#0000a2;font-weight:700">getInstance</span>() {
        <span style="color:#00f;font-weight:700">return</span> instance;
    }
}
</pre></div>
                                </div>
                            </div>
                        </div>
                        <div class="Para" id="Par381">This pattern achieves its goal of allowing you to maintain and access a single instance of a class throughout your application, but it does so at the expense of increased coupling. Your application code must always have explicit
                            knowledge of the Singleton class in order to obtain the instance—completely removing the ability to code to interfaces.</div>
                        <div class="Para" id="Par382">In reality, the Singleton pattern is actually two patterns in one. The first, and desired, pattern involves maintenance of a single instance of an object. The second, and less desirable, is a pattern for object lookup that completely
                            removes the possibility of using interfaces. Using the Singleton pattern also makes it difficult to swap out implementations arbitrarily because most objects that require the Singleton instance access the Singleton object directly.
                            This can cause all kinds of headaches when you are trying to unit test your application because you are unable to replace the Singleton with a mock for testing purposes.</div>
                        <div class="Para ParaOneEmphasisChild" id="Par383">Fortunately, with Spring you can take advantage of the singleton instantiation model without having to work around the Singleton design pattern. All beans in Spring are, by default, created as Singleton instances, and Spring uses
                            the same instances to fulfill all requests for that bean. Of course, Spring is not just limited to the use of the Singleton instance; it can still create a new instance of the bean to satisfy every dependency and every call
                            to <span class="EmphasisFontCategoryNonProportional">getBean()</span>. It does all of this without any impact on your application code, and for this reason, we like to refer to Spring as being instantiation mode agnostic. This
                            is a powerful concept. If you start off with an object that is a singleton but then discover it is not really suited to multithread access, you can change it to a nonsingleton (prototype) without affecting any of your application
                            code.</div>
                        <div class="Para ParaTypeImportant" id="Par384"> <img alt="A315511_5_En_3_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Figa_HTML.jpg" width="30"/>                            Although changing the instantiation mode of your bean won’t affect your application code, it does cause some problems if you rely on Spring’s life-cycle interfaces. We cover this in more detail in Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Chapter.html"><span class="RefSource">4</span></a>
                            </span>.</div>
                        <div class="Para" id="Par385">Changing the instantiation <span id="ITerm144">mode                      </span> from singleton to nonsingleton is simple. The following configuration snippets present how this is done in XML and using annotations:</div>
                        <div class="Para" id="Par386">
                            <div class="ProgramCode" id="PC121">
                                <div class="LineGroup">
                                    <div class="FixedLine">&lt;!-- app-context-xml.xml --&gt;</div>
                                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">nonSingleton</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.annotated.Singer</span>
scope=<span style="color:#036a07">prototype</span> <span style="font-style:italic">c</span>:_0=<span style="color:#036a07">John Mayer</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
                                </div>
                                <div class="LineGroup">
                                    <div class="FixedLine">\\Singer.java</div>
                                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.annotated</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Value</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Scope</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Component</span>;

@Component(<span style="color:#036a07">nonSingleton</span>)
@Scope(<span style="color:#036a07">prototype</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Singer</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">unknown</span>;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">Singer</span>(@<span style="color:#00f;font-weight:700">Value</span>(&quot;<span style="color:#00f;font-weight:700">John</span> <span style="color:#00f;font-weight:700">Mayer</span>&quot;) String name) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>name <span style="color:#00f;font-weight:700">=</span> name;
    }
}
</pre></div>
                                </div>
                            </div>
                        </div>
                        <div class="Para ParaOneEmphasisChild" id="Par387">In the XML configuration, the <span class="EmphasisFontCategoryNonProportional">Singer</span> class can be used as a type for a bean declared in XML. If component scanning is not enabled, the annotations in the class will simply
                            be ignored.</div>
                        <div class="Para" id="Par388">As you can see, the only difference between this bean declaration and any of the declarations you have seen so far is that we add the <span class="EmphasisFontCategoryNonProportional">scope</span> attribute and set the value to
                            <span class="EmphasisFontCategoryNonProportional">prototype</span>. Spring defaults the scope to the value <span class="EmphasisFontCategoryNonProportional">singleton</span>. The prototype scope instructs Spring to instantiate
                            a new instance of the bean every time a bean instance is requested by the application. The following code snippet shows the effect this setting has on your application:</div>
                        <div class="Para" id="Par389">
                            <div class="ProgramCode" id="PC122">
                                <div class="LineGroup">
                                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.annotated.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">NonSingletonDemo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-xml.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">Singer</span> singer1 <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">nonSingleton</span>, <span style="color:#00f;font-weight:700">Singer</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">Singer</span> singer2 <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">nonSingleton</span>, <span style="color:#00f;font-weight:700">Singer</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Identity Equal?: </span> <span style="color:#00f;font-weight:700">+</span> (singer1 <span style="color:#00f;font-weight:700">==</span> singer2));
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Value Equal:? </span> <span style="color:#00f;font-weight:700">+</span> singer1<span style="color:#00f;font-weight:700">.</span>equals(singer2));
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(singer1);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(singer2);
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre></div>
                                </div>
                            </div>
                        </div>
                        <div class="Para" id="Par390">Running this example gives you the following output:</div>
                        <div class="Para" id="Par391">
                            <div class="ProgramCode" id="PC123">
                                <div class="FixedLine">Identity Equal?: false</div>
                                <div class="FixedLine">Value Equal:? false</div>
                                <div class="FixedLine">John Mayer</div>
                                <div class="FixedLine">John Mayer</div>
                            </div>
                        </div>
                        <div class="Para ParaOneEmphasisChild" id="Par392">You can see from this that although the values of the two <span class="EmphasisFontCategoryNonProportional">String</span> objects are clearly equal, the identities are not, even though both instances were retrieved using the same
                            bean name.</div>
                        <div class="Section3 RenderAsSection3" id="Sec37">
                            <h4 class="Heading">Choosing an Instantiation Mode</h4>
                            <div class="Para" id="Par393">In most scenarios, it is quite easy to see which instantiation mode is suitable. Typically, you will find that singleton is the default mode for your beans. In general, singletons should be used in the following scenarios:
                                <div class="UnorderedList">
                                    <ul class="UnorderedListMarkBullet">
                                        <li>
                                            <div class="Para ParaOneEmphasisChild" id="Par394"> <span class="EmphasisTypeItalic">Shared object with no state</span>: You have an object that maintains no state and has many dependent objects. Because you do not need synchronization if there is no state, you
                                                do not need to create a new instance of the bean each time a dependent object needs to use it for some processing.</div>
                                        </li>
                                        <li>
                                            <div class="Para ParaOneEmphasisChild" id="Par395"> <span class="EmphasisTypeItalic">Shared object with read-only state</span>: This is similar to the previous point, but you have some read-only state. In this case, you still do not need synchronization, so creating
                                                an instance to satisfy each request for the bean is just adding overhead.</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par396"> <span class="EmphasisTypeItalic">Shared object with shared</span> <span id="ITerm146">                        <span class="EmphasisTypeItalic">state</span> </span>: If you have a bean that has state that must
                                                be shared, singleton is the ideal choice. In this case, ensure that your synchronization for state writes is as granular as possible.</div>
                                        </li>
                                        <li>
                                            <div class="Para ParaOneEmphasisChild" id="Par397"> <span class="EmphasisTypeItalic">High-throughput objects with writable state</span>: If you have a bean that is used a great deal in your application, you may find that keeping a singleton and synchronizing
                                                all write access to the bean state allows for better performance than constantly creating hundreds of instances of the bean. When using this approach, try to keep the synchronization as granular as possible
                                                without sacrificing consistency. You will find that this approach is particularly useful when your application creates a large number of instances over a long period of time, when your shared object has
                                                only a small amount of writable state, or when the instantiation of a new instance is expensive.</div>
                                        </li>
                                    </ul>
                            </div>
                        </div>
                        <div class="Para" id="Par398">You should consider using nonsingletons in the following scenarios:
                            <div class="UnorderedList">
                                <ul class="UnorderedListMarkBullet">
                                    <li>
                                        <div class="Para ParaOneEmphasisChild" id="Par399"> <span class="EmphasisTypeItalic">Objects with writable state</span>: If you have a bean that has a lot of writable state, you may find that the cost of synchronization is greater than the cost of creating a new
                                            instance to handle each request from a dependent object.</div>
                                    </li>
                                    <li>
                                        <div class="Para ParaOneEmphasisChild" id="Par400"> <span class="EmphasisTypeItalic">Objects with private state</span>: Some dependent objects need a bean that has private state so that they can conduct their processing separately from other objects that depend on
                                            that bean. In this case, singleton is clearly not suitable, and you should use nonsingleton.</div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="Para" id="Par401">The main positive you gain from Spring’s instantiation management is that your applications can immediately benefit from the lower memory usage associated with singletons, with very little effort on your part. Then, if you find
                            that singleton mode does not meet the needs of your application, it is a trivial task to modify your configuration to use non-singleton <span id="ITerm147">mode                          </span>.</div>
                    </div>
                    <div class="Section3 RenderAsSection3" id="Sec38">
                        <h4 class="Heading">Implementing Bean <span id="ITerm148">Scopes                          </span> </h4>
                        <div class="Para" id="Par402">In addition to the singleton and prototype scopes, other scopes exist when defining a Spring bean for more specific purposes. You can also implement your own custom scope and register it in Spring’s <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>.
                            The following bean scopes are supported as of version 4:
                            <div class="UnorderedList">
                                <ul class="UnorderedListMarkBullet">
                                    <li>
                                        <div class="Para ParaOneEmphasisChild" id="Par403"> <span class="EmphasisTypeItalic">Singleton</span>: The default singleton scope. Only one object will be created per Spring IoC container.</div>
                                    </li>
                                    <li>
                                        <div class="Para ParaOneEmphasisChild" id="Par404"> <span class="EmphasisTypeItalic">Prototype</span>: A new instance will be created by Spring when requested by the application.</div>
                                    </li>
                                    <li>
                                        <div class="Para ParaOneEmphasisChild" id="Par405"> <span class="EmphasisTypeItalic">Request</span>: For web application use. When using Spring MVC for web applications, beans with request scope will be instantiated for every HTTP request and then destroyed when
                                            the request is completed.</div>
                                    </li>
                                    <li>
                                        <div class="Para ParaOneEmphasisChild" id="Par406"> <span class="EmphasisTypeItalic">Session</span>: For web application use. When using Spring MVC for web applications, beans with session scope will be instantiated for every HTTP session and then destroyed when
                                            the session is over.</div>
                                    </li>
                                    <li>
                                        <div class="Para ParaOneEmphasisChild" id="Par407"> <span class="EmphasisTypeItalic">Global session</span>: For portlet-based web applications. The global session scope beans can be shared among all portlets within the same Spring MVC–powered portal application.</div>
                                    </li>
                                    <li>
                                        <div class="Para ParaOneEmphasisChild" id="Par408"> <span class="EmphasisTypeItalic">Thread</span>: A new bean instance will be created by Spring when requested by a new thread, while for the same thread, the same bean instance will be returned. Note that this scope
                                            is not registered by default.</div>
                                    </li>
                                    <li>
                                        <div class="Para" id="Par409"> <span class="EmphasisTypeItalic">Custom</span>: Custom bean scope that can be created by implementing the interface <span class="EmphasisFontCategoryNonProportional">org.springframework.beans.factory.config.Scope</span>                                            and registering the custom scope in Spring’s configuration (for XML, use the class <span class="EmphasisFontCategoryNonProportional">org.springframework.beans.factory.config.CustomScopeConfigurer</span>).</div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    </div>
                    </div>
                    <div class="Section1 RenderAsSection1" id="Sec39">
                        <h2 class="Heading">Resolving Dependencies</h2>
                        <div class="Para" id="Par410">During normal operation, Spring is able to <span id="ITerm149">resolve dependencies                  </span> by simply looking at your configuration file or annotations in your classes. In this way, Spring can ensure that each
                            bean is configured in the correct order so that each bean has its dependencies correctly configured. If Spring did not perform this and just created the beans and configured them in any order, a bean could be created and configured
                            before its dependencies. This is obviously not what you want and would cause all sorts of problems within your application.</div>
                        <div class="Para" id="Par411">Unfortunately, Spring is not aware of any dependencies that exist between beans in your code that are not specified in the configuration. For instance, take one bean, called <span id="ITerm150">              <span class="EmphasisFontCategoryNonProportional">johnMayer</span>                            </span>, of type <span class="EmphasisFontCategoryNonProportional">Singer</span>, which obtains an instance of another bean, called <span class="EmphasisFontCategoryNonProportional">gopher</span>, of type <span class="EmphasisFontCategoryNonProportional">Guitar</span>                            using <span class="EmphasisFontCategoryNonProportional">ctx.getBean()</span> and uses it when the <span class="EmphasisFontCategoryNonProportional">johnMayer.sing()</span> method is called. In this method, you get an instance
                            of type <span class="EmphasisFontCategoryNonProportional">Guitar</span> by calling <span class="EmphasisFontCategoryNonProportional">ctx.getBean(&quot;gopher&quot;)</span>, without asking Spring to inject the dependency for you. In this
                            case, Spring is unaware that <span class="EmphasisFontCategoryNonProportional">johnMayer</span> depends on <span class="EmphasisFontCategoryNonProportional">gopher</span>, and, as a result, it may instantiate <span class="EmphasisFontCategoryNonProportional">johnMayer</span>                            before <span class="EmphasisFontCategoryNonProportional">gopher</span>. You can provide Spring with additional information about your bean dependencies using the <span class="EmphasisFontCategoryNonProportional">depends-on</span>                            attribute of the <span class="EmphasisFontCategoryNonProportional">&lt;bean&gt;</span> tag. The following configuration snippet (contained in a file named <span class="EmphasisFontCategoryNonProportional">app-context-01.xml</span>)
                            shows how the scenario for <span class="EmphasisFontCategoryNonProportional">johnMayer</span> and <span class="EmphasisFontCategoryNonProportional">gopher</span> would be configured:</div>
                        <div class="Para" id="Par412">
                            <div class="ProgramCode" id="PC124">
                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...<span style="color:#036a07">&gt;

&lt;bean id=</span>johnMayer<span style="color:#036a07"> class=</span>com.apress.prospring5.ch3.xml.Singer<span style="color:#036a07">

depends-on=</span>gopher<span style="color:#036a07">/&gt;

&lt;bean id=</span>gopher<span style="color:#036a07"> class=</span>com.apress.prospring5.ch3.xml.Guitar<span style="color:#036a07">&quot;/&gt;

&lt;/beans&gt;
</span></span></pre></div>
                            </div>
                        </div>
                        <div class="Para" id="Par413">In this configuration, we are asserting that bean <span class="EmphasisFontCategoryNonProportional">johnMayer</span> depends on bean <span class="EmphasisFontCategoryNonProportional">gopher</span>. Spring should take this into
                            consideration when instantiating the beans and ensure that <span class="EmphasisFontCategoryNonProportional">gopher</span> is created before <span class="EmphasisFontCategoryNonProportional">johnMayer</span>. To do this, though,
                            <span class="EmphasisFontCategoryNonProportional">johnMayer</span> needs to access <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>. Thus, we also have to tell Spring to inject this reference, so
                            when the <span class="EmphasisFontCategoryNonProportional">johnMayer.sing()</span> method will be called, it can be used to procure the <span class="EmphasisFontCategoryNonProportional">gopher</span> bean. This is done by making
                            the <span class="EmphasisFontCategoryNonProportional">Singer</span> bean implement the <span class="EmphasisFontCategoryNonProportional">ApplicationContextAware</span> interface. This is a Spring-specific interface that forces
                            an implementation of a setter for an <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> object. It is automatically detected by the Spring IoC container, and the <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>                            that the bean is created in is injected into it. This is done after the constructor of the bean is called, so obviously using <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> in the constructor will
                            lead to a <span id="ITerm151">              <span class="EmphasisFontCategoryNonProportional">NullPointerException</span> </span>. You can see the code of the <span class="EmphasisFontCategoryNonProportional">Singer</span>                            class here:</div>
                        <div class="Para" id="Par414">
                            <div class="ProgramCode" id="PC125">
                                <div class="LineGroup">
                                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.xml</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.BeansException</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.ApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.ApplicationContextAware</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Singer</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">ApplicationContextAware</span> {
    <span style="color:#00f;font-weight:700">ApplicationContext</span> ctx;

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setApplicationContext</span>(
            <span style="color:#00f;font-weight:700">ApplicationContext</span> <span style="font-style:italic">applicationContext</span>) <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">BeansException</span> {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>ctx <span style="color:#00f;font-weight:700">=</span> applicationContext;
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Guitar</span> guitar;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">Singer</span>() {
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">sing</span>() {
        guitar <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">gopher</span>, <span style="color:#00f;font-weight:700">Guitar</span><span style="color:#00f;font-weight:700">.</span>class);
        guitar<span style="color:#00f;font-weight:700">.</span>sing();
    }
}
</pre></div>
                                </div>
                            </div>
                        </div>
                        <div class="Para" id="Par415">The <span class="EmphasisFontCategoryNonProportional">Guitar</span> class is quite simple; it contains only the <span class="EmphasisFontCategoryNonProportional">sing</span> method and is shown here:</div>
                        <div class="Para" id="Par416">
                            <div class="ProgramCode" id="PC126">
                                <div class="LineGroup">
                                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.xml</span>;
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Guitar</span> {
        <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">sing</span>(){
                <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Cm Eb Fm Ab Bb</span>);
        }
}
</pre></div>
                                </div>
                            </div>
                        </div>
                        <div class="Para" id="Par417">To test this example, you can use the following class:</div>
                        <div class="Para" id="Par418">
                            <div class="ProgramCode" id="PC127">
                                <div class="LineGroup">
                                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.xml</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">DependsOnDemo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>
                ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-01.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">Singer</span> johnMayer <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">johnMayer</span>, <span style="color:#00f;font-weight:700">Singer</span><span style="color:#00f;font-weight:700">.</span>class);
        johnMayer<span style="color:#00f;font-weight:700">.</span>sing();
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre></div>
                                </div>
                            </div>
                        </div>
                        <div class="Para" id="Par419">Of course, there is an annotation <span id="ITerm153">configuration                  </span> equivalent to the previous XML configuration. <span class="EmphasisFontCategoryNonProportional">Singer</span> and <span class="EmphasisFontCategoryNonProportional">Guitar</span>                            must be declared as beans using one of the stereotype annotations (in this case <span class="EmphasisFontCategoryNonProportional">@Component</span> will be used). The novelty here is the <span class="EmphasisFontCategoryNonProportional">@DependsOn</span>                            annotation, which is placed on the <span class="EmphasisFontCategoryNonProportional">Singer</span> class. This is the equivalent of the <span class="EmphasisFontCategoryNonProportional">depends-on</span> attribute from the
                            XML configuration.</div>
                        <div class="Para" id="Par420">
                            <div class="ProgramCode" id="PC128">
                                <div class="LineGroup">
                                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.annotated</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.BeansException</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.ApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.ApplicationContextAware</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.DependsOn</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Component</span>;

@Component(<span style="color:#036a07">johnMayer</span>)
@DependsOn(<span style="color:#036a07">gopher</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Singer</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">ApplicationContextAware</span> {
    <span style="color:#00f;font-weight:700">ApplicationContext</span> applicationContext;

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setApplicationContext</span>(<span style="color:#00f;font-weight:700">ApplicationContext</span>
                                              <span style="font-style:italic">applicationContext</span>) <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">BeansException</span> {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>applicationContext <span style="color:#00f;font-weight:700">=</span> applicationContext;
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Guitar</span> guitar;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">Singer</span>() {
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">sing</span>() {
        guitar <span style="color:#00f;font-weight:700">=</span> applicationContext<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">gopher</span>, <span style="color:#00f;font-weight:700">Guitar</span><span style="color:#00f;font-weight:700">.</span>class);
        guitar<span style="color:#00f;font-weight:700">.</span>sing();
    }
}
</pre></div>
                                </div>
                            </div>
                        </div>
                        <div class="Para" id="Par421">All you have to do now is enable component <span id="ITerm154">scanning                   </span>and then use, in the <span class="EmphasisFontCategoryNonProportional">DependsOnDemo</span> class, <span class="EmphasisFontCategoryNonProportional">application- context-02.xml</span>,
                            to create <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>.</div>
                        <div class="Para" id="Par422">
                            <div class="ProgramCode" id="PC129">
                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#06f;font-style:italic">&lt;!-- application-context-02.xml --&gt;</span>
<span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span>...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">context</span><span style="font-weight:700">:</span><span style="font-weight:700">component-scan</span>
            <span style="font-style:italic">base-package</span>=<span style="color:#036a07">com.apress.prospring5.ch3.annotated</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
                            </div>
                        </div>
                        <div class="Para" id="Par423">The example will run, and the output will be “Cm Eb Fm Ab Bb.”</div>
                        <div class="Para" id="Par424">When developing your applications, avoid designing them to use this feature; instead, define your dependencies by means of setter and constructor injection contracts. However, if you are integrating Spring with legacy code, you
                            may find that the dependencies defined in the code require you to provide extra information to the Spring Framework.</div>
                    </div>
                    <div class="Section1 RenderAsSection1" id="Sec40">
                        <h2 class="Heading">Autowiring Your Bean</h2>
                        <div class="Para" id="Par425">Spring supports five modes for <span id="ITerm155">autowiring                  </span>.
                            <div class="UnorderedList">
                                <ul class="UnorderedListMarkBullet">
                                    <li>
                                        <div class="Para" id="Par426"> <span class="EmphasisFontCategoryNonProportional">byName</span>: When using <span class="EmphasisFontCategoryNonProportional">byName</span> autowiring, Spring attempts to wire each property to a bean of the same
                                            name. So, if the target bean has a property named <span class="EmphasisFontCategoryNonProportional">foo</span> and a <span class="EmphasisFontCategoryNonProportional">foo</span> bean is defined in <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>,
                                            the <span class="EmphasisFontCategoryNonProportional">foo</span> bean is assigned to the <span class="EmphasisFontCategoryNonProportional">foo</span> property of the target.</div>
                                    </li>
                                    <li>
                                        <div class="Para" id="Par427"> <span class="EmphasisFontCategoryNonProportional">byType</span>: When using <span class="EmphasisFontCategoryNonProportional">byType</span> autowiring, Spring attempts to wire each of the properties on the target
                                            bean by automatically using a bean of the same type in <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>.</div>
                                    </li>
                                    <li>
                                        <div class="Para" id="Par428"> <span class="EmphasisFontCategoryNonProportional">constructor</span>: This functions just like <span class="EmphasisFontCategoryNonProportional">byType</span> wiring, except that it uses constructors rather than
                                            setters to perform the injection. Spring attempts to match the greatest numbers of arguments it can in the constructor. So, if your bean has two constructors, one that accepts a <span class="EmphasisFontCategoryNonProportional">String</span>                                            and one that accepts <span class="EmphasisFontCategoryNonProportional">String</span> and an <span class="EmphasisFontCategoryNonProportional">Integer</span>, and you have both a <span class="EmphasisFontCategoryNonProportional">String</span>                                            and an <span class="EmphasisFontCategoryNonProportional">Integer</span> bean in your <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>, Spring uses the two-argument constructor.</div>
                                    </li>
                                    <li>
                                        <div class="Para" id="Par429"> <span class="EmphasisFontCategoryNonProportional">default</span>: Spring will choose between the <span class="EmphasisFontCategoryNonProportional">constructor</span> and <span class="EmphasisFontCategoryNonProportional">byType</span>                                            modes automatically. If your bean has a default (no-arguments) constructor, Spring uses <span class="EmphasisFontCategoryNonProportional">byType</span>; otherwise, it uses <span class="EmphasisFontCategoryNonProportional">constructor</span>.</div>
                                    </li>
                                    <li>
                                        <div class="Para ParaOneEmphasisChild" id="Par430"> <span class="EmphasisFontCategoryNonProportional">no</span>: This is the default.</div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="Para" id="Par431">So, if you have a <span id="ITerm156">property                  </span> of type <span class="EmphasisFontCategoryNonProportional">String</span> on the target bean and a bean of type <span class="EmphasisFontCategoryNonProportional">String</span>                            in <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>, then Spring wires the <span class="EmphasisFontCategoryNonProportional">String</span> bean to the target bean’s <span class="EmphasisFontCategoryNonProportional">String</span>                            property. If you have more than one bean of the same type, in this case <span class="EmphasisFontCategoryNonProportional">String</span>, in the same <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>                            instance, then Spring is unable to decide which one to use for the autowiring and throws an exception (of type <span class="EmphasisFontCategoryNonProportional">org.springframework.beans.factory.NoSuchBeanDefinitionException</span>).</div>
                        <div class="Para ParaOneEmphasisChild" id="Par432">The following configuration snippet shows a simple configuration that autowires three beans of the same type by using each of the modes (<span class="EmphasisFontCategoryNonProportional">app-context-03.xml</span>):</div>
                    <div class="Para" id="Par433">
                        <div class="ProgramCode" id="PC130">
                            <div class="LineGroup">
                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">fooOne</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.xml.Foo</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">barOne</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.xml.Bar</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">targetByName</span> <span style="font-style:italic">autowire</span>=<span style="color:#036a07">byName</span>
            <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.xml.Target</span> <span style="font-style:italic">lazy-init</span>=<span style="color:#036a07">true</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">targetByType</span> <span style="font-style:italic">autowire</span>=<span style="color:#036a07">byType</span>
            <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.xml.Target</span> <span style="font-style:italic">lazy-init</span>=<span style="color:#036a07">true</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">targetConstructor</span> <span style="font-style:italic">autowire</span>=<span style="color:#036a07">constructor</span>
            <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.xml.Target</span> <span style="font-style:italic">lazy-init</span>=<span style="color:#036a07">true</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
                            </div>
                        </div>
                    </div>
                    <div class="Para" id="Par434">This configuration should look familiar to you now. <span class="EmphasisFontCategoryNonProportional">Foo</span> and <span class="EmphasisFontCategoryNonProportional">Bar</span> are empty classes. Notice that each of the <span class="EmphasisFontCategoryNonProportional">Target</span>                        beans has a different value for the <span class="EmphasisFontCategoryNonProportional">autowire</span> attribute. Moreover, the <span class="EmphasisFontCategoryNonProportional">lazy-init</span> attribute is set to <span class="EmphasisFontCategoryNonProportional">true</span>                        to inform Spring to instantiate the bean only when it is first requested, rather than at startup, so that we can output the result in the correct place in the testing program. The following code sample shows a simple Java application
                        that retrieves each of the <span class="EmphasisFontCategoryNonProportional">Target</span> beans from <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>:</div>
                    <div class="Para" id="Par435">
                        <div class="ProgramCode" id="PC131">
                            <div class="LineGroup">
                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.xml</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Target</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Foo</span> fooOne;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Foo</span> fooTwo;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Bar</span> bar;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">Target</span>() {
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">Target</span>(<span style="color:#00f;font-weight:700">Foo</span> <span style="font-style:italic">foo</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Target(Foo) called</span>);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">Target</span>(<span style="color:#00f;font-weight:700">Foo</span> <span style="font-style:italic">foo</span>, <span style="color:#00f;font-weight:700">Bar</span> <span style="font-style:italic">bar</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Target(Foo, Bar) called</span>);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setFooOne</span>(<span style="color:#00f;font-weight:700">Foo</span> <span style="font-style:italic">fooOne</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>fooOne <span style="color:#00f;font-weight:700">=</span> fooOne;
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Property fooOne set</span>);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setFooTwo</span>(<span style="color:#00f;font-weight:700">Foo</span> <span style="font-style:italic">foo</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>fooTwo <span style="color:#00f;font-weight:700">=</span> foo;
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Property fooTwo set</span>);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setBar</span>(<span style="color:#00f;font-weight:700">Bar</span> <span style="font-style:italic">bar</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>bar <span style="color:#00f;font-weight:700">=</span> bar;
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Property bar set</span>);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-03.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">Target</span> t <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">null</span>;
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">&quot;Using byName:<span style="color:#26b31a">\n</span>&quot;</span>);
        t <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">Target</span>) ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">targetByName</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span>Using byType:<span style="color:#26b31a">\n</span>&quot;</span>);
        t <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">Target</span>) ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">targetByType</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span>Using constructor:<span style="color:#26b31a">\n</span>&quot;</span>);
        t <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">Target</span>) ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">targetConstructor</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre></div>
                            </div>
                        </div>
                    </div>
                    <div class="Para" id="Par436">In this code, you can see that the <span class="EmphasisFontCategoryNonProportional">Target</span> class has three constructors: a no-argument constructor, a constructor that accepts a <span class="EmphasisFontCategoryNonProportional">Foo</span>                        instance, and a constructor that accepts a <span class="EmphasisFontCategoryNonProportional">Foo</span> and a <span class="EmphasisFontCategoryNonProportional">Bar</span> instance. In addition to these constructors, the <span class="EmphasisFontCategoryNonProportional">Target</span>                        bean has three properties: two of type <span class="EmphasisFontCategoryNonProportional">Foo</span> and one of type <span class="EmphasisFontCategoryNonProportional">Bar</span>. Each of these properties and constructors writes
                        a message to console output when it is called. The <span class="EmphasisFontCategoryNonProportional">main()</span> method simply retrieves each of the <span class="EmphasisFontCategoryNonProportional">Target</span> beans declared
                        in <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>, triggering the autowire process. Here is the output from running this example:</div>
                    <div class="Para" id="Par437">
                        <div class="ProgramCode" id="PC132">
                            <div class="LineGroup">
                                <div class="FixedLine">Using byName:</div>
                            </div>
                            <div class="LineGroup">
                                <div class="FixedLine">Property fooOne set</div>
                            </div>
                            <div class="LineGroup">
                                <div class="FixedLine">Using byType:</div>
                            </div>
                            <div class="LineGroup">
                                <div class="FixedLine">Property bar set</div>
                                <div class="FixedLine">Property fooOne set</div>
                                <div class="FixedLine">Property fooTwo set</div>
                            </div>
                            <div class="LineGroup">
                                <div class="FixedLine">Using constructor:</div>
                            </div>
                            <div class="LineGroup">
                                <div class="FixedLine">Target(Foo, Bar) called</div>
                            </div>
                        </div>
                    </div>
                    <div class="Para" id="Par438">From the output, you can see that when Spring uses <span class="EmphasisFontCategoryNonProportional">byName</span>, the only property that is set is <span class="EmphasisFontCategoryNonProportional">foo</span> because this is the only
                        property with a corresponding bean entry in the configuration file. When using <span class="EmphasisFontCategoryNonProportional">byType</span>, Spring sets the value of all three properties. The <span class="EmphasisFontCategoryNonProportional">fooOne</span>                        and <span class="EmphasisFontCategoryNonProportional">fooTwo</span> properties are set by the <span class="EmphasisFontCategoryNonProportional">fooOne</span> bean, and the <span class="EmphasisFontCategoryNonProportional">bar</span>                        property is set by the <span class="EmphasisFontCategoryNonProportional">barOne</span> bean. When using a constructor, Spring uses the two-argument constructor, because Spring can provide beans for both arguments and does not need
                        to fall back to another constructor.</div>
                    <div class="Para ParaOneEmphasisChild" id="Par439">When autowiring by type, things gets complicated when bean types are related, and exceptions are thrown when you have more classes that implement the same interface and the property requiring to be autowired specifies the interface
                        as the type, because Spring does not know which bean to inject. To create such a scenario, we’ll transform <span class="EmphasisFontCategoryNonProportional">Foo</span> into an interface and declare two bean type implementing it,
                        each with its bean declaration. Let’s keep the default configuration as well, no extra naming.</div>
                    <div class="Para" id="Par440">
                        <div class="ProgramCode" id="PC133">
                            <div class="LineGroup">
                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.xml.complicated</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">Foo</span> {
    <span style="color:#06f;font-style:italic">// empty interface, used as a marker interface</span>
}

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">FooImplOne</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Foo</span> {
}

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">FooImplOne</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Foo</span> {
}
</pre></div>
                            </div>
                        </div>
                    </div>
                    <div class="Para ParaOneEmphasisChild" id="Par441">If we were to add a new configuration file, named <span class="EmphasisFontCategoryNonProportional">app-context-04.xml</span>, it would contain the following configuration:</div>
                    <div class="Para" id="Par442">
                        <div class="ProgramCode" id="PC134">
                            <div class="LineGroup">
                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">fooOne</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.xml.complicated.FooImplOne</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">fooTwo</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.xml.complicated.FooImplOne</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">bar</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.xml.Bar</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">targetByType</span> <span style="font-style:italic">autowire</span>=<span style="color:#036a07">byType</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.xml.complicated.CTarget</span>
        <span style="font-style:italic">lazy-init</span>=<span style="color:#036a07">true</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
                            </div>
                        </div>
                    </div>
                    <div class="Para" id="Par443">For this more simple example, we also introduce the <span class="EmphasisFontCategoryNonProportional">CTarget</span> class. This is identical with the recently introduced <span class="EmphasisFontCategoryNonProportional">Target</span>                        class; only the <span class="EmphasisFontCategoryNonProportional">main()</span> method differs. The code snippet is depicted here:</div>
                    <div class="Para" id="Par444">
                        <div class="ProgramCode" id="PC135">
                            <div class="LineGroup">
                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.xml.complicated</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.xml.*</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">CTarget</span> {
        .<span style="color:#00f;font-weight:700">.</span>.

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>
                ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-04.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span>Using byType:<span style="color:#26b31a">\n</span>&quot;</span>);
        <span style="color:#00f;font-weight:700">CTarget</span> t <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">CTarget</span>) ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">targetByType</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
</pre></div>
                            </div>
                        </div>
                    </div>
                    <div class="Para" id="Par445">Running the previous class produces the following output:</div>
                    <div class="Para" id="Par446">
                        <div class="ProgramCode" id="PC136">
                            <div class="LineGroup">
                                <div class="FixedLine">Using byType: <span id="ITerm160">                                                          </span> </div>
                            </div>
                            <div class="LineGroup">
                                <div class="FixedLine">Exception in thread &quot;main&quot;</div>
                                <div class="FixedLine">   org.springframework.beans.factory.UnsatisfiedDependencyException:</div>
                                <div class="FixedLine">   Error creating bean with name &apos;targetByType&apos; defined in class path</div>
                                <div class="FixedLine">      resource spring/app-context-04.xml:</div>
                                <div class="FixedLine">      Unsatisfied dependency expressed through bean property &apos;foo&apos;;</div>
                                <div class="FixedLine">      nested exception is</div>
                                <div class="FixedLine">      org.springframework.beans.factory.NoUniqueBeanDefinitionException:</div>
                                <div class="FixedLine">   No qualifying bean of type</div>
                                <div class="FixedLine">      &apos;com.apress.prospring5.ch3.xml.complicated.Foo&apos; available:</div>
                                <div class="FixedLine">       <span class="EmphasisTypeUnderline">expected single matching bean but found 2: fooOne,fooTwo</span> </div>
                                <div class="FixedLine">       ...</div>
                            </div>
                        </div>
                    </div>
                    <div class="Para" id="Par447">The console output is way bigger, but the first lines in the previous output reveal the problem in quite a readable manner. When Spring does not know what bean to autowire, it throws an <span id="ITerm161">              <span class="EmphasisFontCategoryNonProportional">UnsatisfiedDependencyException</span>                        </span> with an explicit message. It tells you what beans were found but that it cannot choose which to use where. There are two ways to fix this problem. The first way is to use the <span class="EmphasisFontCategoryNonProportional">primary</span>                        attribute in the bean definition that you want Spring to consider first for autowiring and set <span class="EmphasisFontCategoryNonProportional">true</span> as its value.</div>
                    <div class="Para" id="Par448">
                        <div class="ProgramCode" id="PC137">
                            <div class="LineGroup">
                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">fooOne</span>
       <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.xml.complicated.FooImpl1</span>
       <span style="font-style:italic">primary</span>=<span style="color:#036a07">true</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">fooTwo</span>
       <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.xml.complicated.FooImpl2</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">bar</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.xml.Bar</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">targetByType</span> <span style="font-style:italic">autowire</span>=<span style="color:#036a07">byType</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.xml.complicated.CTarget</span>
        <span style="font-style:italic">lazy-init</span>=<span style="color:#036a07">true</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
                            </div>
                        </div>
                    </div>
                    <div class="Para" id="Par449">So, if the configuration is modified as presented before, when running the example, the following output will be printed:</div>
                    <div class="Para" id="Par450">
                        <div class="ProgramCode" id="PC138">
                            <div class="LineGroup">
                                <div class="FixedLine">Using byType:</div>
                            </div>
                            <div class="LineGroup">
                                <div class="FixedLine">Property bar set</div>
                                <div class="FixedLine">Property fooOne set</div>
                                <div class="FixedLine">Property fooTwo set</div>
                            </div>
                        </div>
                    </div>
                    <div class="Para" id="Par451">So, it’s all back to normal. But still, the <span class="EmphasisFontCategoryNonProportional">primary</span> attribute is a solution only when there are just two bean-related types. If there are more, using it will not get rid of the
                        <span class="EmphasisFontCategoryNonProportional">UnsatisfiedDependencyException</span>. What will do the job is the second way, which will give you full control over which bean gets injected where, and this is to name your beans
                        and configure them where to be injected via XML. The previous example is quite a complex and dirty implementation and was conceived just to prove how each of the autowiring types can be configured in XML. When switching to annotation,
                        things change a bit. There is an annotation equivalent to the <span class="EmphasisFontCategoryNonProportional">lazy-init</span> attribute; the <span class="EmphasisFontCategoryNonProportional">@Lazy</span> annotation is used at
                        the class level to declare beans that will be instantiated the first time they are accessed. Using stereotype annotations, we can create only one configuration for a bean, so it seems pretty logical that the name of the beans does
                        not really matter, as there will be only one bean of each type. Thus, the default autowiring when using configuration via annotation is <span class="EmphasisFontCategoryNonProportional">byType</span>. When there are bean-related
                        types, it is useful to be able to specify that autowiring should be done by name. This is done using the <span class="EmphasisFontCategoryNonProportional">@Qualifier</span> annotation, together with the <span class="EmphasisFontCategoryNonProportional">@Autowired</span>                        annotation, and providing the name of the bean being injected as an argument for it.</div>
                    <div class="Para" id="Par452">Consider the following code:</div>
                    <div class="Para" id="Par453">
                        <div class="ProgramCode" id="PC139">
                            <div class="LineGroup">
                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.sandbox</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Autowired</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Qualifier</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Lazy</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Component</span>;

@<span style="color:#00f;font-weight:700">Component</span>
@<span style="color:#00f;font-weight:700">Lazy</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">TrickyTarget</span> {
    <span style="color:#00f;font-weight:700">Foo</span> fooOne;
    <span style="color:#00f;font-weight:700">Foo</span> fooTwo;
    <span style="color:#00f;font-weight:700">Bar</span> bar;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">TrickyTarget</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Target.constructor()</span>);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">TrickyTarget</span>(<span style="color:#00f;font-weight:700">Foo</span> <span style="font-style:italic">fooOne</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Target(Foo) called</span>);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">TrickyTarget</span>(<span style="color:#00f;font-weight:700">Foo</span> <span style="font-style:italic">fooOne</span>, <span style="color:#00f;font-weight:700">Bar</span> <span style="font-style:italic">bar</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Target(Foo, Bar) called</span>);
    }

    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setFooOne</span>(<span style="color:#00f;font-weight:700">Foo</span> <span style="font-style:italic">fooOne</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>fooOne <span style="color:#00f;font-weight:700">=</span> fooOne;
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Property fooOne set</span>);
    }

    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setFooTwo</span>(<span style="color:#00f;font-weight:700">Foo</span> <span style="font-style:italic">foo</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>fooTwo <span style="color:#00f;font-weight:700">=</span> foo;
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Property fooTwo set</span>);
    }

    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setBar</span>(<span style="color:#00f;font-weight:700">Bar</span> <span style="font-style:italic">bar</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>bar <span style="color:#00f;font-weight:700">=</span> bar;
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Property bar set</span>);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-04.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">TrickyTarget</span> t <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">TrickyTarget</span><span style="color:#00f;font-weight:700">.</span>class);
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre></div>
                            </div>
                        </div>
                    </div>
                    <div class="Para ParaOneEmphasisChild" id="Par454">If <span class="EmphasisFontCategoryNonProportional">Foo</span> is a class as depicted here:</div>
                    <div class="Para" id="Par455">
                        <div class="ProgramCode" id="PC140">
                            <div class="LineGroup">
                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.sandbox</span>;
@<span style="color:#00f;font-weight:700">Component</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Foo</span> {
}
</pre></div>
                            </div>
                        </div>
                    </div>
                    <div class="Para ParaOneEmphasisChild" id="Par456">then when the <span class="EmphasisFontCategoryNonProportional">TrickyTarget</span> class is run, the following output is produced:</div>
                    <div class="Para" id="Par457">
                        <div class="ProgramCode" id="PC141">
                            <div class="FixedLine">Property fooOne set</div>
                            <div class="FixedLine">Property fooTwo set</div>
                            <div class="FixedLine">Property bar set</div>
                        </div>
                    </div>
                    <div class="Para ParaOneEmphasisChild" id="Par458">The <span class="EmphasisFontCategoryNonProportional">Bar</span> class is just as simple.</div>
                    <div class="Para" id="Par459">
                        <div class="ProgramCode" id="PC142">
                            <div class="LineGroup">
                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.sandbox</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Component</span>;
@<span style="color:#00f;font-weight:700">Component</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Bar</span> {
}
</pre></div>
                            </div>
                        </div>
                    </div>
                    <div class="Para ParaOneEmphasisChild" id="Par460">If we were to modify the <span class="EmphasisFontCategoryNonProportional">TrickyTarget</span> class and give a name to the bean, as shown here:</div>
                    <div class="Para" id="Par461">
                        <div class="ProgramCode" id="PC143">
                            <div class="FixedLine"><pre style="background:#fff;color:#000">@Component(<span style="color:#036a07">gigi</span>)
@<span style="color:#00f;font-weight:700">Lazy</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">TrickyTarget</span> {
.<span style="color:#00f;font-weight:700">.</span>.
}
</pre></div>
                        </div>
                    </div>
                    <div class="Para" id="Par462">then when running the class, the same output will be produced, as there is only one bean of type <span class="EmphasisFontCategoryNonProportional">Target</span>, and when requested from the context using <span class="EmphasisFontCategoryNonProportional">ctx.getBean(TrickyTarget.class)</span>,
                        the context returns the only bean of this type, regardless of its name. Also, if we were to provide a name for the bean of type <span class="EmphasisFontCategoryNonProportional">Bar</span>:</div>
                    <div class="Para" id="Par463">
                        <div class="ProgramCode" id="PC144">
                            <div class="LineGroup">
                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.sandbox</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Component</span>;
@Component(<span style="color:#036a07">kitchen</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Bar</span> {
}
</pre></div>
                            </div>
                        </div>
                    </div>
                    <div class="Para ParaOneEmphasisChild" id="Par464">then when running the example again, we would see the same output. This means that the default autowiring type is <span class="EmphasisFontCategoryNonProportional">byType</span>.</div>
                    <div class="Para ParaOneEmphasisChild" id="Par465">As mentioned, things get complicated when bean types are related. Let’s transform <span class="EmphasisFontCategoryNonProportional">Foo</span> into an interface and declare two bean types implementing it, each one with its bean declaration.
                        Let’s keep the default configuration as well, with no extra naming.</div>
                    <div class="Para" id="Par466">
                        <div class="ProgramCode" id="PC145">
                            <div class="LineGroup">
                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.sandbox</span>;

<span style="color:#06f;font-style:italic">//Foo.java</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">Foo</span> {
    <span style="color:#06f;font-style:italic">// empty interface, used as a marker interface</span>
}

<span style="color:#06f;font-style:italic">//FooImplOne.java</span>
@<span style="color:#00f;font-weight:700">Component</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">FooImplOne</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Foo</span> {
}

<span style="color:#06f;font-style:italic">//FooImplTwo.java</span>
@<span style="color:#00f;font-weight:700">Component</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">FooImplTwo</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Foo</span> {
}
</pre></div>
                            </div>
                        </div>
                    </div>
                    <div class="Para ParaOneEmphasisChild" id="Par467">The <span class="EmphasisFontCategoryNonProportional">TrickyTarget</span> class remains unchanged, and when it’s run, we’ll see that the output changes to something that looks probably a lot like this:</div>
                    <div class="Para" id="Par468">
                        <div class="ProgramCode" id="PC146">
                            <div class="FixedLine">Property bar set</div>
                            <div class="FixedLine">Exception in thread &quot;main&quot;</div>
                            <div class="FixedLine">     org.springframework.beans.factory.<span class="EmphasisTypeUnderline">UnsatisfiedDependencyException</span>:</div>
                            <div class="FixedLine"> Error creating bean with name &apos;gigi&apos;:</div>
                            <div class="FixedLine">     Unsatisfied dependency expressed through method &apos;setFoo&apos; parameter 0;</div>
                            <div class="FixedLine"> nested exception is</div>
                            <div class="FixedLine">     org.springframework.beans.factory.NoUniqueBeanDefinitionException:</div>
                            <div class="FixedLine"> No qualifying bean of type &apos;com.apress.prospring5.ch3.sandbox.Foo&apos; available:</div>
                            <div class="FixedLine">       <span class="EmphasisTypeUnderline">expected single matching bean but found 2: fooImplOne,</span> <span id="ITerm166">                  <span class="EmphasisTypeUnderline">fooImplTwo</span>                                </span>
                            </div>
                            <div class="FixedLine">...</div>
                        </div>
                    </div>
                    <div class="Para" id="Par469">There is a lot more output, but those are the first lines, and as you can see, Spring is really explicit. It tells you that it does not know which bean to autowire through the method <span class="EmphasisFontCategoryNonProportional">setFoo</span>,
                        and it also tells you which selection of beans it has. The names of the beans are decided by Spring based on the class name, by downcasing the first letter of the class name. Using this information, <span class="EmphasisFontCategoryNonProportional">TrickyTarget</span>                        can be fixed. There are two ways to do this. The first way is to use the <span class="EmphasisFontCategoryNonProportional">@Primary</span> annotation (which is the equivalent of the <span class="EmphasisFontCategoryNonProportional">primary</span>                        attribute introduced before) on the class defining a bean, which will tell Spring to prioritize this bean when autowiring by type. We will annotate <span class="EmphasisFontCategoryNonProportional">FooImplOne</span>.</div>
                    <div class="Para" id="Par470">
                        <div class="ProgramCode" id="PC147">
                            <div class="LineGroup">
                                <div class="FixedLine">package com.apress.prospring5.ch3.sandbox;</div>
                            </div>
                            <div class="LineGroup">
                                <div class="FixedLine">import org.springframework.context.annotation.Primary;</div>
                                <div class="FixedLine">import org.springframework.stereotype.Component;</div>
                            </div>
                            <div class="LineGroup">
                                <div class="FixedLine">@Component</div>
                                <div class="FixedLine">@Primary</div>
                                <div class="FixedLine">public class FooImplOne implements Foo {</div>
                                <div class="FixedLine">}</div>
                            </div>
                        </div>
                        </div>
                        <div class="Para" id="Par471">The <span class="EmphasisFontCategoryNonProportional">@Primary</span> annotation is a marker interface; it has no attributes. Its presence on a bean configuration marks the bean as having priority when a bean of this type is needed
                            to be autowired using <span class="EmphasisFontCategoryNonProportional">byType</span>. If you run the <span class="EmphasisFontCategoryNonProportional">TrickyTarget</span> class, the expected output will be printed again.</div>
                        <div class="Para" id="Par472">
                            <div class="ProgramCode" id="PC148">
                                <div class="FixedLine">Property fooOne set</div>
                                <div class="FixedLine">Property fooTwo set</div>
                                <div class="FixedLine">Property bar set</div>
                            </div>
                            </div>
                            <div class="Para" id="Par473">As in the case of the <span class="EmphasisFontCategoryNonProportional">primary</span> attribute, the <span class="EmphasisFontCategoryNonProportional">@Primary</span> annotation is useful only when you have exactly two related
                                bean types. For handling more related bean types, the <span class="EmphasisFontCategoryNonProportional">Qualifier</span> annotation is more suitable. This is placed next to the <span class="EmphasisFontCategoryNonProportional">@Autowired</span>                                on the setters that are ambiguous: <span class="EmphasisFontCategoryNonProportional">setFooOne()</span> and <span class="EmphasisFontCategoryNonProportional">setFooTwo()</span>. (The code left unchanged is not shown anymore.)</div>
                            <div class="Para" id="Par474">
                                <div class="ProgramCode" id="PC149">
                                    <div class="LineGroup">
                                        <div class="FixedLine"><pre style="background:#fff;color:#000">@Component(<span style="color:#036a07">gigi</span>)
@<span style="color:#00f;font-weight:700">Lazy</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">TrickyTarget</span> {
        .<span style="color:#00f;font-weight:700">.</span>.
        <span style="color:#00f;font-weight:700">@Autowired</span>
        <span style="color:#00f;font-weight:700">@Qualifier</span>(<span style="color:#036a07">fooImplOne</span>)
        <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setFoo</span>(<span style="color:#00f;font-weight:700">Foo</span> <span style="font-style:italic">foo</span>) {
                <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>foo <span style="color:#00f;font-weight:700">=</span> foo;
                <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Property fooOne set</span>);
        }
        <span style="color:#00f;font-weight:700">@Autowired</span>
        <span style="color:#00f;font-weight:700">@Qualifier</span>(<span style="color:#036a07">fooImplTwo</span>)
        <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setFooTwo</span>(<span style="color:#00f;font-weight:700">Foo</span> <span style="font-style:italic">fooTwo</span>) {
                <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>fooTwo <span style="color:#00f;font-weight:700">=</span> fooTwo;
                <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Property fooTeo set</span>);
        }
        .<span style="color:#00f;font-weight:700">.</span>.
}
</pre></div>
                                    </div>
                                </div>
                                </div>
                                <div class="Para" id="Par475">Now, if you run the example, the expected output will be printed again.</div>
                                <div class="Para" id="Par476">
                                    <div class="ProgramCode" id="PC150">
                                        <div class="FixedLine">Property fooOne set</div>
                                        <div class="FixedLine">Property fooTwo set</div>
                                        <div class="FixedLine">Property bar set</div>
                                    </div>
                                </div>
                                <div class="Para" id="Par477">When using Java configuration, the only thing that changes is the way the beans are defined. Because instead of <span class="EmphasisFontCategoryNonProportional">@Component</span> on bean classes, <span class="EmphasisFontCategoryNonProportional">@Bean</span>                                    annotations will be used on bean declaration methods in the configuration class. Such an example is shown here:</div>
                                <div class="Para" id="Par478">
                                    <div class="ProgramCode" id="PC151">
                                        <div class="LineGroup">
                                            <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.config</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.sandbox.*</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.AnnotationConfigApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Bean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Configuration</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">TargetDemo</span> {
    <span style="color:#00f;font-weight:700">@Configuration</span>
    <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">TargetConfig</span> {
        <span style="color:#00f;font-weight:700">@Bean</span>
        <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Foo</span> <span style="color:#0000a2;font-weight:700">fooImplOne</span>() {
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">FooImplOne</span>();
        }

        <span style="color:#00f;font-weight:700">@Bean</span>
        <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Foo</span> <span style="color:#0000a2;font-weight:700">fooImplTwo</span>() {
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">FooImplTwo</span>();
        }

        <span style="color:#00f;font-weight:700">@Bean</span>
        <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Bar</span> <span style="color:#0000a2;font-weight:700">bar</span>() {
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Bar</span>();
        }

        <span style="color:#00f;font-weight:700">@Bean</span>
        <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">TrickyTarget</span> <span style="color:#0000a2;font-weight:700">trickyTarget</span>() {
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">TrickyTarget</span>();
        }
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">TargetConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">TrickyTarget</span> t <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">TrickyTarget</span><span style="color:#00f;font-weight:700">.</span>class);
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="Para" id="Par479">The existing classes from the <span class="EmphasisFontCategoryNonProportional">com.apress.prospring5.ch3.sandbox</span> package were reused here too, to avoid code duplication, because as component scanning is not enabled,
                                    any bean declaration using stereotype annotation will be ignored. If you run the previous class, you will notice that the same output from the previous example is printed. If you remember, as mentioned earlier, the
                                    convention when using bean declarations with <span class="EmphasisFontCategoryNonProportional">@Bean</span> is that the name of the method becomes the name of the bean, so <span class="EmphasisFontCategoryNonProportional">TrickyTarget</span>                                    configured with the <span class="EmphasisFontCategoryNonProportional">@Qualifier</span> annotation will still work as expected.</div>
                                <div class="Section2 RenderAsSection2" id="Sec41">
                                    <h3 class="Heading">When to Use Autowiring</h3>
                                    <div class="Para" id="Par480">In most cases, the answer to the question of whether you should use autowiring is definitely no! Autowiring can save you time in small applications, but in many cases, it leads to bad practices and is inflexible in
                                        large applications. Using <span class="EmphasisFontCategoryNonProportional">byName</span> seems like a good idea, but it may lead you to give your classes artificial property names so that you can take advantage
                                        of the autowiring functionality. The whole idea behind Spring is that you can create your classes as you like and have Spring work for you, not the other way around. You may be tempted to use <span class="EmphasisFontCategoryNonProportional">byType</span>                                        until you realize that you can have only one bean for each type in your <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>—a restriction that is problematic when you need to maintain beans
                                        with different configurations of the same type. The same argument applies to the use of constructor autowiring.</div>
                                    <div class="Para" id="Par481">In some cases, autowiring can save you time, but it does not really take that much extra effort to define your wiring explicitly, and you benefit from explicit semantics and full flexibility on property naming and on
                                        how many instances of the same type you <span id="ITerm169">manage                      </span>. For any nontrivial application, steer clear of autowiring at all costs.</div>
                                </div>
                                </div>
                                <div class="Section1 RenderAsSection1" id="Sec42">
                                    <h2 class="Heading">Setting <span id="ITerm170">Bean Inheritance                  </span> </h2>
                                    <div class="Para" id="Par482">In some cases, you many need multiple definitions of beans that are the same type or implement a shared interface. This can become problematic if you want these beans to share some configuration settings but not others.
                                        The process of keeping the shared configuration settings in sync is quite error-prone, and on large projects, doing so can be quite time-consuming. To get around this, Spring allows you to provide a <span class="EmphasisFontCategoryNonProportional">&lt;bean&gt;</span>                                        definition that inherits its property settings from another bean in the same <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> instance. You can override the values of any properties on
                                        the child bean as required, which allows you to have full control, but the parent bean can provide each of your beans with a base configuration. The following code sample shows a simple configuration with two beans,
                                        one of which is the child of the other (<span class="EmphasisFontCategoryNonProportional">app-context-xml.xml</span>):</div>
                                    <div class="Para" id="Par483">
                                        <div class="ProgramCode" id="PC152">
                                            <div class="LineGroup">
                                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">parent</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.xml.Singer</span>
        <span style="font-style:italic">p</span>:name=<span style="color:#036a07">John Mayer</span> <span style="font-style:italic">p</span>:age=<span style="color:#036a07">39</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">child</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.xml.Singer</span>
        <span style="font-style:italic">parent</span>=<span style="color:#036a07">parent</span> <span style="font-style:italic">p</span>:age=<span style="color:#036a07">0</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="Para" id="Par484">In this code, you can see that the <span class="EmphasisFontCategoryNonProportional">&lt;bean&gt;</span> tag for the <span class="EmphasisFontCategoryNonProportional">child</span> bean has an extra attribute,
                                        <span class="EmphasisFontCategoryNonProportional">parent</span>, which indicates that Spring should consider the <span class="EmphasisFontCategoryNonProportional">parent</span> bean the parent of the bean and inherit its configuration. In case you don’t want a
                                            parent bean definition to become available for lookup from <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>, you can add the attribute <span class="EmphasisFontCategoryNonProportional">abstract=&quot;true&quot;</span>                                            in the <span class="EmphasisFontCategoryNonProportional">&lt;bean&gt;</span> tag when declaring the parent bean. Because the <span class="EmphasisFontCategoryNonProportional">child</span> bean has its own value
                                            for the <span class="EmphasisFontCategoryNonProportional">age</span> property, Spring passes this value to the bean. However, <span class="EmphasisFontCategoryNonProportional">child</span> has no value for the
                                            <span class="EmphasisFontCategoryNonProportional">name</span> property, so Spring uses the value given to the <span class="EmphasisFontCategoryNonProportional">inheritParent</span> bean.</div>
                                    <div class="Para ParaOneEmphasisChild" id="Par485">The <span class="EmphasisFontCategoryNonProportional">Singer</span> bean is quite simple.</div>
                                    <div class="Para" id="Par486">
                                        <div class="ProgramCode" id="PC153">
                                            <div class="LineGroup">
                                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.xml</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Singer</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> name;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">int</span> age;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setName</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">name</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>name <span style="color:#00f;font-weight:700">=</span> name;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setAge</span>(<span style="color:#00f;font-weight:700">int</span> <span style="font-style:italic">age</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>age <span style="color:#00f;font-weight:700">=</span> age;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">toString</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">&quot;<span style="color:#26b31a">\t</span>Name: &quot;</span> <span style="color:#00f;font-weight:700">+</span> name <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span><span style="color:#26b31a">\t</span>&quot;</span> <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">Age: </span> <span style="color:#00f;font-weight:700">+</span> age;
    }
}
</pre></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="Para" id="Par487">To test it, you could write a simple class like this:</div>
                                    <div class="Para" id="Par488">
                                        <div class="ProgramCode" id="PC154">
                                            <div class="LineGroup">
                                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.xml</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">InheritanceDemo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-xml.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">Singer</span> parent <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">Singer</span>) ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">parent</span>);
        <span style="color:#00f;font-weight:700">Singer</span> child <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">Singer</span>) ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">child</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">&quot;Parent:<span style="color:#26b31a">\n</span>&quot;</span> <span style="color:#00f;font-weight:700">+</span> parent);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">&quot;Child:<span style="color:#26b31a">\n</span>&quot;</span> <span style="color:#00f;font-weight:700">+</span> child);
    }
}
</pre></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="Para" id="Par489">As you can see, the <span class="EmphasisFontCategoryNonProportional">main()</span> method of the <span class="EmphasisFontCategoryNonProportional">Singer</span> class grabs both the <span class="EmphasisFontCategoryNonProportional">child</span>                                        and <span class="EmphasisFontCategoryNonProportional">parent</span> beans from <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> and writes the contents of their properties to <span class="EmphasisFontCategoryNonProportional">stdout</span>.
                                        Here is the output from this example:</div>
                                    <div class="Para" id="Par490">
                                        <div class="ProgramCode" id="PC155">
                                            <div class="FixedLine">Parent:</div>
                                            <div class="FixedLine">        Name: John Mayer</div>
                                            <div class="FixedLine">        Age: 39</div>
                                            <div class="FixedLine">Child:</div>
                                            <div class="FixedLine">        Name: John Mayer</div>
                                            <div class="FixedLine">        Age: 0</div>
                                        </div>
                                    </div>
                                    <div class="Para" id="Par491">As expected, the <span class="EmphasisFontCategoryNonProportional">inheritChild</span> bean inherited the value for its <span class="EmphasisFontCategoryNonProportional">name</span> property from the <span class="EmphasisFontCategoryNonProportional">inheritParent</span>                                        bean but was able to provide its own value for the <span class="EmphasisFontCategoryNonProportional">age</span> property.</div>
                                    <div class="Para" id="Par492">Child beans inherit both constructor arguments and property values from the parent beans, so you can use both styles of injection with bean inheritance. This level of flexibility makes bean inheritance a powerful tool
                                        for building applications with more than a handful of bean definitions. If you are declaring a lot of beans of the same value with shared property values, avoid the temptation to use copy and paste to share the
                                        values; instead, set up an inheritance hierarchy in your configuration.</div>
                                    <div class="Para" id="Par493">When you are using <span id="ITerm172">inheritance                  </span>, remember that bean inheritance does not have to match a Java inheritance hierarchy. It is perfectly acceptable to use bean inheritance on
                                        five beans of the same type. Think of bean inheritance as more like a templating feature than an inheritance feature. Be aware, however, that if you are changing the type of the child bean, that type must extend
                                        the parent bean type.</div>
                                </div>
                                <div class="Section1 RenderAsSection1" id="Sec43">
                                    <h2 class="Heading">Summary</h2>
                                    <div class="Para" id="Par494">In this chapter, we covered a lot of ground with both Spring Core and IoC in general. We showed you examples of the types of IoC and presented the pros and cons of using each mechanism in your applications. We looked
                                        at which IoC mechanisms Spring provides and when (and when not) to use each within your applications. While exploring IoC, we introduced the Spring <span class="EmphasisFontCategoryNonProportional">BeanFactory</span>,
                                        which is the core component for Spring’s IoC capabilities, and then <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>, which extends <span class="EmphasisFontCategoryNonProportional">BeanFactory</span>                                        and provides additional functionalities. For <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>, we focused on <span class="EmphasisFontCategoryNonProportional">GenericXmlApplicationContext</span>,
                                        which allows external configuration of Spring by using XML. Another method to declare DI requirements for <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>, that is, using Java annotations,
                                        was also discussed. Some examples with <span class="EmphasisFontCategoryNonProportional">AnnotationConfigApplicationContext</span> and Java configuration were also included, just to slowly introduce this way of
                                        configuring beans.</div>
                                    <div class="Para ParaOneEmphasisChild" id="Par495">This chapter also introduced you to the basics of Spring’s IoC feature set including setter injection, constructor injection, Method Injection, autowiring, and bean inheritance. In the discussion of configuration, we
                                        demonstrated how you can configure your bean properties with a wide variety of values, including other beans, using both XML and annotation type configurations and <span class="EmphasisFontCategoryNonProportional">GenericXmlApplicationContext</span>.</div>
                                    <div class="Para" id="Par496">This chapter only scratched the surface of Spring and Spring’s IoC container. In the next chapter, you’ll look at some IoC-related features specific to Spring, and you’ll take a more detailed look at other functionality
                                        available in Spring Core.</div>
                                </div>
                                <div class="FootnoteSection">
                                    <div class="Heading">Footnotes</div>
                                    <div class="Footnote" id="Fn1"><span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Chapter.html#Fn1_source">1</a></span>
                                        <div class="FootnoteParas">
                                            <div class="Para" id="Par78">For example, try the Spring community forums at <span class="ExternalRef"><a href="http://forum.spring.io/"><span class="RefSource">                      <span class="EmphasisFontCategoryNonProportional">http://forum.spring.io</span>                                                </span>
                                                </a>
                                                </span>.</div>
                                        </div>
                                        <div class="ClearBoth"> </div>
                                    </div>
                                    <div class="Footnote" id="Fn2"><span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Chapter.html#Fn2_source">2</a></span>
                                        <div class="FootnoteParas">
                                            <div class="Para" id="Par96">These annotations are called <span class="EmphasisTypeItalic">stereotype</span> because they are part of a package named <span class="EmphasisFontCategoryNonProportional">org.springframework.stereotype</span>.
                                                This package groups together all annotations used to define beans. These annotations are also relevant to the role of a bean. For example, <span class="EmphasisFontCategoryNonProportional">@Service</span>                                                is used to define a service bean, which is a more complex functional bean that provides services that other beans may require, and <span class="EmphasisFontCategoryNonProportional">@Repository</span> is
                                                used to define a bean that is used to retrieve/save data from/to a database, etc.</div>
                                        </div>
                                        <div class="ClearBoth"> </div>
                                    </div>
                                    <div class="Footnote" id="Fn3"><span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Chapter.html#Fn3_source">3</a></span>
                                        <div class="FootnoteParas">
                                            <div class="Para" id="Par253"> <span class="EmphasisFontCategoryNonProportional">cglib</span> is a powerful, high-performance, and high-quality code generation library. It can extend Java classes and implement interfaces at runtime. It is
                                                open source, and you can find the official repository at <span class="ExternalRef"><a href="https://github.com/cglib"><span class="RefSource">                      <span class="EmphasisFontCategoryNonProportional">https://github.com/cglib</span>                                                </span>
                                                </a>
                                                </span>.</div>
                                        </div>
                                        <div class="ClearBoth"> </div>
                                    </div>
                                    <div class="Footnote" id="Fn4"><span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Chapter.html#Fn4_source">4</a></span>
                                        <div class="FootnoteParas">
                                            <div class="Para" id="Par364">You can look at the full implementation here: <span class="ExternalRef"><a href="https://github.com/spring-projects/spring-framework/blob/master/spring-core/src/main/java/org/springframework/core/annotation/AliasFor.java"><span class="RefSource">                        <span class="EmphasisFontCategoryNonProportional">https://github.com/spring-projects/spring-framework/blob/master/spring-core/src/main/java/org/springframework/core/annotation/AliasFor.java</span>                                                </span>
                                                </a>
                                                </span>.</div>
                                        </div>
                                        <div class="ClearBoth"> </div>
                                    </div>
                                </div>
                    </div>
            </div>
          </div>
        </section>
      </div>
    </div>
    <div class="font-flyout" style="top: 200.531px; left: 1280px;"> </div>



<hr/>
<!--if IE]><![endif]-->

<!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"            itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"data-offline-url="/"data-url="/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Chapter.html"data-csrf-cookie="csrfsafari"data-highlight-privacy=""  data-user-id="3866890"  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"  data-username="levinxccai"  data-account-type="B2B"    data-activated-trial-date="11/06/2017"  data-archive="9781484228081"  data-publishers="Apress"  data-htmlfile-name="A315511_5_En_4_Chapter.html"  data-epub-title="Pro Spring 5: An In-Depth Guide to the Spring Framework and Its Tools" data-debug=0 data-testing=0><![endif]-->
<!--if gt IE 8]><!-->

<!--![endif]-->




<a name="5_"></a>

    <div class="application" id="container" style="height: auto;">
        <div class="js-toc">
            <section role="document">
                <div id="sbo-rt-content" style="max-width:72.5em; transform: none;">
                    <div class="annotator-wrapper">
                        <!--egin Abstract-->
                        <div class="MainTitleSection">
                            <h1 class="ChapterTitle" xml:lang="en">4. Spring Configuration in Detail and Spring Boot</h1>
                        </div>
                        <div class="AuthorGroup">
                            <div class="AuthorNames"><span class="Author"><span class="AuthorName">Iuliana Cosmina</span><sup>1 <span class="ContactIcon"></span></sup>, </span><span class="Author"><span class="AuthorName">Rob Harrop</span><sup>2</sup>, </span>
                                <span class="Author"><span class="AuthorName">Chris Schaefer</span><sup>3</sup> and </span><span class="Author"><span class="AuthorName">Clarence Ho</span><sup>4</sup></span>
                            </div>
                            <div class="Affiliations">
                                <div class="Affiliation" id="Aff5"><span class="AffiliationNumber">(1)</span>
                                    <div class="AffiliationText">Sibiu, Sibiu, Romania</div>
                                </div>
                                <div class="Affiliation" id="Aff6"><span class="AffiliationNumber">(2)</span>
                                    <div class="AffiliationText">Reddish, UK</div>
                                </div>
                                <div class="Affiliation" id="Aff7"><span class="AffiliationNumber">(3)</span>
                                    <div class="AffiliationText">Venice, Florida, USA</div>
                                </div>
                                <div class="Affiliation" id="Aff8"><span class="AffiliationNumber">(4)</span>
                                    <div class="AffiliationText">Hong Kong, China</div>
                                </div>
                                <div class="ClearBoth"> </div>
                            </div>
                        </div>
                        <!--nd Abstract-->
                        <div class="Fulltext">
                            <div class="Para" id="Par1">In the previous chapter, we presented a detailed look at the concept of inversion of control (IoC) and how it fits into the Spring Framework. However, we have really only scratched the surface of what Spring Core can do. Spring
                                provides a wide array of services that supplement and extend its basic IoC capabilities. In this chapter, you are going to explore these in detail. Specifically, you will be looking at the following:
                                <div class="UnorderedList">
                                    <ul class="UnorderedListMarkBullet">
                                        <li>
                                            <div class="Para" id="Par2"> <span class="EmphasisTypeItalic">Managing the</span> <span id="ITerm1">                  <span class="EmphasisTypeItalic">bean life cycle</span> </span>: So far, all the beans you have seen have been fairly
                                                simple and completely decoupled from the Spring container. In this chapter, we present some strategies you can employ to enable your beans to receive notifications from the Spring container at various points
                                                throughout their life cycles. You can do this either by implementing specific interfaces laid out by Spring, by specifying methods that Spring can call via reflection, or by using JSR-250 JavaBeans life-cycle
                                                annotations.</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par3"> <span class="EmphasisTypeItalic">Making your beans “</span> <span id="ITerm2">                  <span class="EmphasisTypeItalic">Spring aware</span> </span> <span class="EmphasisTypeItalic">”</span>: In some
                                                cases, you want a bean to be able to interact with the <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> instance that configured it. For this reason, Spring offers two interfaces,
                                                <span class="EmphasisFontCategoryNonProportional">BeanNameAware</span> and <span class="EmphasisFontCategoryNonProportional">ApplicationContextAware</span> (introduced at the end of Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Chapter.html"><span class="RefSource">3</span></a>
                                                </span>), that allow your bean to obtain its assigned name and reference its <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>, respectively. This section of the chapter covers implementing
                                                these interfaces and gives some practical considerations for using them in your application.</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par4"> <span class="EmphasisTypeItalic">Using</span> <span id="ITerm3">                  <span class="EmphasisTypeItalic">FactoryBeans</span> </span>: As its name implies, the <span class="EmphasisFontCategoryNonProportional">FactoryBean</span>                                                interface is meant to be implemented by any bean that acts as a factory for other beans. The <span class="EmphasisFontCategoryNonProportional">FactoryBean</span> interface provides a mechanism by which you
                                                can easily integrate your own factories with the Spring <span class="EmphasisFontCategoryNonProportional">BeanFactory</span> interface.</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par5"> <span class="EmphasisTypeItalic">Working with</span> <span id="ITerm4">                  <span class="EmphasisTypeItalic">JavaBeans PropertyEditors</span> </span>: The <span class="EmphasisFontCategoryNonProportional">PropertyEditor</span>                                                interface is a standard interface provided in the <span class="EmphasisFontCategoryNonProportional">java.beans</span> package. <span class="EmphasisFontCategoryNonProportional">PropertyEditor</span>s are
                                                used to convert property values to and from <span class="EmphasisFontCategoryNonProportional">String</span> representations. Spring uses <span class="EmphasisFontCategoryNonProportional">PropertyEditor</span>s
                                                extensively, mainly to read values specified in the <span class="EmphasisFontCategoryNonProportional">BeanFactory</span> configuration and convert them into the correct types. In this chapter, we discuss
                                                the set of <span class="EmphasisFontCategoryNonProportional">PropertyEditor</span>s supplied with Spring and how you can use them within your application. We also take a look at implementing custom
                                                <span class="EmphasisFontCategoryNonProportional">PropertyEditor</span>s.</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par6"> <span class="EmphasisTypeItalic">Learning more about the</span> <span id="ITerm5">                  <span class="EmphasisTypeItalic">Spring ApplicationContext</span> </span>: As we know, <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>                                                is an extension of <span class="EmphasisFontCategoryNonProportional">BeanFactory</span> intended for use in full applications. The <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>                                                interface provides a useful set of additional functionality, including internationalized message support, resource loading, and event publishing. In this chapter, we present a detailed look at the features
                                                in addition to IoC that <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> offers. We also jump ahead of ourselves a little to show you how <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>                                                simplifies the use of Spring when you are building web applications.</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par7"> <span class="EmphasisTypeItalic">Using</span> <span id="ITerm6">                  <span class="EmphasisTypeItalic">Java classes</span> </span> <span class="EmphasisTypeItalic">for configuration</span>: Prior
                                                to 3.0, Spring supported only the XML base configuration with annotations for beans and dependency configuration. Starting with 3.0, Spring offers another option for developers to configure the Spring
                                                <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> interface using Java classes. We take a look at this new option in Spring application configuration.</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par8"> <span class="EmphasisTypeItalic">Using</span> <span id="ITerm7">                  <span class="EmphasisTypeItalic">Spring Boot</span> </span> <span class="EmphasisTypeBold">:</span> Spring application configuration
                                                is made even more practical by using Spring Boot. This Spring project makes it easy to create stand-alone, production-grade, Spring-based applications that you can “just run.”</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par9"> <span class="EmphasisTypeItalic">Using</span> <span id="ITerm8">                  <span class="EmphasisTypeItalic">configuration enhancements</span> </span>: We present features that make application configuration
                                                easier, such as profile management, environment and property source abstraction, and so on. In this section, we cover those features and show how to use them to address specific configuration needs.</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par10"> <span class="EmphasisTypeItalic">Using</span> <span id="ITerm9">                  <span class="EmphasisTypeItalic">Groovy</span> </span> <span class="EmphasisTypeItalic">for configuration</span>: New to Spring
                                                4.0 is the ability to configure bean definitions in the Groovy language, which can be used as an alternative or supplement to the existing XML and Java configuration methods.</div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="Section1 RenderAsSection1" id="Sec1">
                                <h2 class="Heading">Spring’s Impact on Application Portability</h2>
                                <div class="Para" id="Par11">Most of the features discussed in this chapter are specific to Spring and, in many cases, are not available in other IoC containers. Although many IoC containers offer life-cycle management functionality, they probably
                                    do so through a different set of interfaces than Spring. If the portability of your application between different IoC containers is truly important, you might want to avoid using some of the features that couple your
                                    application to Spring.</div>
                                <div class="Para" id="Par12">Remember, however, that by setting a constraint—meaning that your application is portable between IoC containers—you are losing out on the wealth of functionality Spring offers. Because you are likely to be making a strategic
                                    choice to use Spring, it makes sense that you use it to the best of its ability.</div>
                                <div class="Para" id="Par13">Be careful not to create a requirement for <span id="ITerm10">portability                  </span> out of thin air. In many cases, the end users of your application do not care whether the application can run on three different
                                    IoC containers; they just want it to run. In our experience, it is often a mistake to try to build an application on the lowest common denominator of features available in your chosen technology. Doing so often sets
                                    your application at a disadvantage right from the get-go. However, if your application requires IoC container portability, do not see this as a drawback—it is a true requirement and, therefore, one your application
                                    should fulfill. In <span class="EmphasisTypeItalic">Expert One-on-One: J2EE Development without EJB</span> (Wrox, 2004), Rod Johnson and Jürgen Höller describe these types of requirements as phantom requirements and
                                    provide a much more detailed discussion of them and how they can affect your project.</div>
                                <div class="Para" id="Par14">Although using these features may couple your application to the Spring Framework, in reality you are increasing the portability of your application in the wider scope. Consider that you are using a freely available, open
                                    source framework that has no particular vendor affiliation. An application built using Spring’s IoC container runs anywhere Java runs. For Java enterprise applications, Spring opens up new possibilities for portability.
                                    Spring provides many of the same capabilities as JEE and also provides classes to abstract and simplify many other aspects of JEE. In many cases, it is possible to build a web application using Spring that runs in a
                                    simple servlet container but with the same level of sophistication as an application targeted at a full-blown JEE application server. By coupling to Spring, you can increase your application’s portability by replacing
                                    many features that either are vendor-specific or rely on vendor-specific configuration with equivalent features in <span id="ITerm11">Spring                  </span>.</div>
                            </div>
                            <div class="Section1 RenderAsSection1" id="Sec2">
                                <h2 class="Heading">Bean Life-Cycle Management</h2>
                                <div class="Para" id="Par15">An important part of any IoC container, Spring included, is that beans can be constructed in such a way that they receive notifications at certain points in their life cycle. This enables your beans to perform relevant
                                    processing at certain points throughout their life. In general, two life-cycle events are particularly relevant to a bean: <span id="ITerm12">post-initialization and pre-destruction                  </span>.</div>
                                <div class="Para" id="Par16">In the context of Spring, the post-initialization event is raised as soon as Spring finishes setting all the property values on the bean and finishes any dependency checks that you configured it to perform. The pre-destruction
                                    event is fired just before Spring destroys the bean instance. However, for beans with prototype scope, the pre-destruction event will not be fired by Spring. The design of Spring is that the initialization life-cycle
                                    callback methods will be called on objects regardless of bean scope, while for beans with prototype scope, the destruction life-cycle callback methods will not be called. Spring provides three mechanisms a bean can
                                    use to hook into each of these events and perform some additional processing: interface-based, method-based, and annotation-based mechanisms.</div>
                            <div class="Para ParaOneEmphasisChild" id="Par17">Using the interface-based mechanism, your bean implements an interface specific to the type of notification it wants to receive, and Spring notifies the bean via a callback method defined in the interface. For the method-based
                                mechanism, Spring allows you to specify, in your <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> configuration, the name of a method to call when the bean is initialized and the name of a method
                                to call when the bean is destroyed. For the annotation mechanism, you can use JSR-250 annotations to specify the method that Spring should call after construction or before destruction.</div>
                            <div class="Para" id="Par18">In the case of both events, the mechanisms achieve exactly the same goal. The <span id="ITerm13">interface mechanism                  </span> is used extensively throughout Spring so that you don’t have to remember to specify
                                the initialization or destruction each time you use one of Spring’s components. However, in your own beans, you may be better served using the method-based or annotation mechanism because your beans do not need to implement
                                any Spring-specific interfaces. Although we stated that portability often isn’t as important a requirement as many books lead you to believe, this does not mean you should sacrifice portability when a perfectly good alternative
                                exists. That said, if you are coupling your application to Spring in other ways, using the interface method allows you to specify the callback once and then forget about it. If you are defining a lot of beans of the same
                                type that need to take advantage of the life-cycle notifications, then using the interface mechanism can avoid the need for specifying the life-cycle callback methods for every bean in the XML configuration file. Using
                                JSR-250 annotations is also another viable option, since it’s a standard defined by the JCP and you are also not coupled to Spring’s specific annotations. Just make sure that the IoC container you are running your application
                                on supports the JSR-250 standard.</div>
                            <div class="Para" id="Par19">Overall, the choice of which mechanism you use for receiving life-cycle notifications depends on your application requirements. If you are concerned about portability or you are just defining one or two beans of a particular
                                type that need the callbacks, use the method-based mechanism. If you use annotation-type configuration and are certain that you are using an IoC container that supports JSR-250, use the annotation mechanism. If you are
                                not too concerned about portability or you are defining many beans of the same type that need the life-cycle notifications, using the interface-based mechanism is the best way to ensure that your beans always receive the
                                notifications they are expecting. If you plan to use a bean across many different Spring projects, you almost certainly want the functionality of that bean to be as self-contained as possible, so you should definitely use
                                the interface-based mechanism.</div>
                            <div class="Para" id="Par20">Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Chapter.html#Fig1">4-1</a></span> shows a high-level overview of how Spring manages the life cycle
                                of the beans within its container.
                                <div class="Figure" id="Fig1">
                                    <div class="MediaObject" id="MO1"><img alt="A315511_5_En_4_Fig1_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Fig1_HTML.jpg" height="259" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Fig1_HTML.jpg" width="690"/></div>
                                    <div class="Caption" xml:lang="en">
                                        <div class="CaptionContent"><span class="CaptionNumber">Figure 4-1.</span>
                                            <div class="SimplePara">Spring beans life cycle</div>
                                        </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="Section1 RenderAsSection1" id="Sec3">
                        <h2 class="Heading">Hooking into Bean Creation</h2>
                        <div class="Para" id="Par21">By being aware of when it is initialized, a bean can check whether all its required dependencies are satisfied. Although Spring can check dependencies for you, it is pretty much an all-or-nothing approach, and it doesn’t offer
                            any opportunities for applying additional logic to the dependency resolution procedure. Consider a bean that has four dependencies declared as setters, two of which are required and one of which has a suitable default in the
                            event that no dependency is provided. Using an initialization callback, your bean can check for the dependencies it requires, throwing an exception or providing a default as needed.</div>
                        <div class="Para" id="Par22">A bean cannot perform these checks in its constructor because at this point, Spring has not had an opportunity to provide values for the dependencies it can satisfy. The initialization callback in Spring is called after Spring
                            finishes providing the dependencies that it can and performs any dependency checks that you ask of it.</div>
                        <div class="Para" id="Par23">You are not limited to using the <span id="ITerm14">initialization callback                  </span> just to check dependencies; you can do anything you want in the callback, but it is most useful for the purpose we have described.
                            In many cases, the initialization callback is also the place to trigger any actions that your bean must take automatically in response to its configuration. For instance, if you build a bean to run scheduled tasks, the initialization
                            callback provides the ideal place to start the scheduler—after all, the configuration data is set on the bean.</div>
                        <div class="Para ParaTypeImportant" id="Par24"><img alt="A315511_5_En_4_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Figa_HTML.jpg" width="30"/>                            You will not have to write a bean to run scheduled tasks because this is something Spring can do automatically through its built-in scheduling feature or via integration with the Quartz scheduler. We cover this in more detail
                            in Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_11_Chapter.html"><span class="RefSource">11</span></a>
                            </span>.</div>
                        <div class="Section2 RenderAsSection2" id="Sec4">
                            <h3 class="Heading">Executing a Method When a Bean Is Created</h3>
                            <div class="Para" id="Par25">As we mentioned previously, one way to receive the initialization callback is to designate a method on your bean as an initialization method and tell Spring to use this method as an initialization method. As discussed, this
                                callback mechanism is useful when you have only a few beans of the same type or when you want to keep your application decoupled from Spring. Another reason for using this mechanism is to enable your Spring application
                                to work with beans that were built previously or were provided by third-party vendors. Specifying a callback method is simply a case of specifying the name in the <span id="ITerm15">                <span class="EmphasisFontCategoryNonProportional">init-method</span>                                </span> attribute of a bean’s <span class="EmphasisFontCategoryNonProportional">&lt;bean&gt;</span> tag. The following code sample shows a basic bean with two dependencies:</div>
                            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.BeanCreationException</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.ApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Singer</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#c5060b;font-weight:700">DEFAULT_NAME</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">Eric Clapton</span>;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> name;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">int</span> age <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">Integer</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>MIN_VALUE</span>;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setName</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">name</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>name <span style="color:#00f;font-weight:700">=</span> name;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setAge</span>(<span style="color:#00f;font-weight:700">int</span> <span style="font-style:italic">age</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>age <span style="color:#00f;font-weight:700">=</span> age;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">init</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Initializing bean</span>);
        <span style="color:#00f;font-weight:700">if</span> (name <span style="color:#00f;font-weight:700">==</span> <span style="color:#585cf6;font-weight:700">null</span>) {
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Using default name</span>);
            name <span style="color:#00f;font-weight:700">=</span> <span style="color:#c5060b;font-weight:700">DEFAULT_NAME</span>;
        }
        <span style="color:#00f;font-weight:700">if</span> (age <span style="color:#00f;font-weight:700">==</span> <span style="color:#00f;font-weight:700">Integer</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>MIN_VALUE</span>) {
            <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">IllegalArgumentException</span>(
                    <span style="color:#036a07">You must set the age property of any beans of type </span> <span style="color:#00f;font-weight:700">+</span> <span style="color:#00f;font-weight:700">Singer</span><span style="color:#00f;font-weight:700">.</span>class);
        }
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">toString</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">&quot;<span style="color:#26b31a">\t</span>Name: &quot;</span> <span style="color:#00f;font-weight:700">+</span> name <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span><span style="color:#26b31a">\t</span>Age: &quot;</span> <span style="color:#00f;font-weight:700">+</span> age;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-xml.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        getBean(<span style="color:#036a07">singerOne</span>, ctx);
        getBean(<span style="color:#036a07">singerTwo</span>, ctx);
        getBean(<span style="color:#036a07">singerThree</span>, ctx);
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">getBean</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">beanName</span>,
                                 <span style="color:#00f;font-weight:700">ApplicationContext</span> <span style="font-style:italic">ctx</span>) {
        <span style="color:#00f;font-weight:700">try</span> {
            <span style="color:#00f;font-weight:700">Singer</span> bean <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">Singer</span>) ctx<span style="color:#00f;font-weight:700">.</span>getBean(beanName);
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(bean);
            <span style="color:#00f;font-weight:700">return</span> bean;
        } <span style="color:#00f;font-weight:700">catch</span> (<span style="color:#00f;font-weight:700">BeanCreationException</span> ex) {
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">An error occured in bean configuration: </span>
                    <span style="color:#00f;font-weight:700">+</span> ex<span style="color:#00f;font-weight:700">.</span>getMessage());
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#585cf6;font-weight:700">null</span>;
        }
    }
}
</pre>
                            <div class="Para" id="Par27">Notice that we have defined a method, <span class="EmphasisFontCategoryNonProportional">init()</span>, to act as the initialization callback. The <span class="EmphasisFontCategoryNonProportional">init()</span> method checks
                                whether the name property has been set, and if it has not, it uses the default value stored in the <span class="EmphasisFontCategoryNonProportional">DEFAULT_NAME</span> constant. <span class="EmphasisFontCategoryNonProportional">The init()</span>                                method also checks whether the <span class="EmphasisFontCategoryNonProportional">age</span> property is set and throws <span class="EmphasisFontCategoryNonProportional">IllegalArgumentException</span> if it is not.</div>
                            <div class="Para" id="Par28">The <span class="EmphasisFontCategoryNonProportional">main()</span> method of the <span class="EmphasisFontCategoryNonProportional">SimpleBean</span> class attempts to obtain three beans from <span class="EmphasisFontCategoryNonProportional">GenericXmlApplicationContext</span>,
                                all of type <span class="EmphasisFontCategoryNonProportional">Singer</span>, using its own <span class="EmphasisFontCategoryNonProportional">getBean()</span> method. Notice that in the <span class="EmphasisFontCategoryNonProportional">getBean()</span>                                method, if the bean is obtained successfully, its details are written to console output. If an exception is thrown in the <span class="EmphasisFontCategoryNonProportional">init()</span> method, as will occur in this case
                                if the <span class="EmphasisFontCategoryNonProportional">age</span> property is not set, then Spring wraps that exception in <span class="EmphasisFontCategoryNonProportional">BeanCreationException. The getBean()</span>                                method catches these exceptions and writes a message to the console output informing us of the error, as well as returns a <span class="EmphasisFontCategoryNonProportional">null</span> value.</div>
                        <div class="Para" id="Par29">The following configuration snippet shows an <span id="ITerm17">                <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> </span> configuration that defines the beans used in the previous code
                            snippet (<span class="EmphasisFontCategoryNonProportional">app-context-xml.xml</span>):</div>
                        <pre style="background:#fff;color:#000"><span style="color:#68685b">&lt;?<span style="color:#888">xml</span><span style="color:#888"> version</span>=<span style="color:#888">1.0</span><span style="color:#888"> encoding</span>=<span style="color:#888">UTF-8</span>?&gt;</span>
<span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> <span style="font-style:italic">xmlns</span>=<span style="color:#036a07">http://www.springframework.org/schema/beans</span>
    <span style="font-style:italic">xmlns</span>:xsi=<span style="color:#036a07">http://www.w3.org/2001/XMLSchema-instance</span>
    <span style="font-style:italic">xmlns</span>:p=<span style="color:#036a07">http://www.springframework.org/schema/p</span>
    <span style="font-style:italic">xsi</span>:schemaLocation=<span style="color:#036a07">http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd</span>
    <span style="font-style:italic">default-lazy-init</span>=<span style="color:#036a07">true</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">singerOne</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch4.Singer</span>
        <span style="font-style:italic">init-method</span>=<span style="color:#036a07">init</span> <span style="font-style:italic">p</span>:name=<span style="color:#036a07">John Mayer</span>  <span style="font-style:italic">p</span>:age=<span style="color:#036a07">39</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">singerTwo</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch4.Singer</span>
        <span style="font-style:italic">init-method</span>=<span style="color:#036a07">init</span> <span style="font-style:italic">p</span>:age=<span style="color:#036a07">72</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">singerThree</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch4.Singer</span>
        <span style="font-style:italic">init-method</span>=<span style="color:#036a07">init</span> <span style="font-style:italic">p</span>:name=<span style="color:#036a07">John Butler</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
                        <div class="Para" id="Par31">As you can see, the <span class="EmphasisFontCategoryNonProportional">&lt;bean&gt;</span> tag for each of the three beans has an <span class="EmphasisFontCategoryNonProportional">init-method</span> attribute that tells Spring that
                            it should invoke the <span class="EmphasisFontCategoryNonProportional">init()</span> method as soon as it finishes configuring the bean. The <span class="EmphasisFontCategoryNonProportional">singerOne</span> bean has values
                            for both the <span class="EmphasisFontCategoryNonProportional">name</span> and <span class="EmphasisFontCategoryNonProportional">age</span> properties, so it passes through the <span class="EmphasisFontCategoryNonProportional">init()</span>                            method with absolutely no changes. The <span class="EmphasisFontCategoryNonProportional">singerTwo</span> bean has no value for the <span class="EmphasisFontCategoryNonProportional">name</span> property, meaning that in the
                            <span class="EmphasisFontCategoryNonProportional">init()</span> method, the <span class="EmphasisFontCategoryNonProportional">name</span> property is given the default value. Finally, the <span class="EmphasisFontCategoryNonProportional">singerThree</span>                            bean has no value for the <span class="EmphasisFontCategoryNonProportional">age</span> property. The logic defined in the <span class="EmphasisFontCategoryNonProportional">init()</span> method treats this as an error, so
                            <span class="EmphasisFontCategoryNonProportional">IllegalArgumentException</span> is thrown. Also note that in the <span class="EmphasisFontCategoryNonProportional">&lt;beans&gt;</span> tag, we added the attribute <span class="EmphasisFontCategoryNonProportional">default-lazy-init=&quot;true&quot;</span>                                to instruct Spring to instantiate the beans defined in the configuration file only when the bean was requested from the application. If we do not specify it, Spring will try to initialize all the beans during the bootstrapping
                                of <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>, and it will fail during the initialization of <span class="EmphasisFontCategoryNonProportional">singerThree</span>.</div>
                        <div class="Para" id="Par32">When all the beans in a configuration file have the same <span class="EmphasisFontCategoryNonProportional">init-method</span> configuration, the file can be simplified, by setting the <span id="ITerm19">                <span class="EmphasisFontCategoryNonProportional">default-init-method</span>                            </span> attribute on the <span class="EmphasisFontCategoryNonProportional">&lt;beans&gt;</span> element. The beans can be of different types; the only condition for them is to have a method named as the <span class="EmphasisFontCategoryNonProportional">default-init-method</span>                            attribute value. So, the previous configuration can be written like this as well:</div>
                        <pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...
    <span style="font-style:italic">default-lazy-init</span>=<span style="color:#036a07">true</span> <span style="font-style:italic">default-init-method</span>=<span style="color:#036a07">init</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">singerOne</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch4.Singer</span>
          <span style="font-style:italic">p</span>:name=<span style="color:#036a07">John Mayer</span> <span style="font-style:italic">p</span>:age=<span style="color:#036a07">39</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">singerTwo</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch4.Singer</span>
         <span style="font-style:italic">p</span>:age=<span style="color:#036a07">72</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">singerThree</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch4.Singer</span>
         <span style="font-style:italic">p</span>:name=<span style="color:#036a07">John Butler</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
                        <div class="Para" id="Par34">Running the previous example yields the following output:</div>
                        <div class="Para" id="Par35">
                            <div class="ProgramCode" id="PC4">
                                <div class="FixedLine">Initializing bean</div>
                                <div class="FixedLine">        Name: John Mayer</div>
                                <div class="FixedLine">        Age: 39</div>
                                <div class="FixedLine">Initializing bean</div>
                                <div class="FixedLine">Using default name</div>
                                <div class="FixedLine">        Name: Eric Clapton</div>
                                <div class="FixedLine">        Age: 72</div>
                                <div class="FixedLine">Initializing bean</div>
                                <div class="FixedLine">An error occured in bean configuration: Error creating bean</div>
                                <div class="FixedLine">with name <span class="EmphasisTypeUnderline">singerThree</span> defined in class path</div>
                                <div class="FixedLine">resource spring/app-context-xml.xml: Invocation of init method failed;</div>
                                <div class="FixedLine">nested exception is java.lang.IllegalArgumentException:</div>
                                <div class="FixedLine">You must set the age property of any beans of type class</div>
                                <div class="FixedLine"> com.apress.prospring5.ch4.Singer</div>
                            </div>
                        </div>
                        <div class="Para" id="Par36">From this output, you can see that <span class="EmphasisFontCategoryNonProportional">singerOne</span> was configured correctly with the values that we specified in the configuration file. For <span class="EmphasisFontCategoryNonProportional">singerTwo</span>,
                            the default value for the <span class="EmphasisFontCategoryNonProportional">name</span> property was used because no value was specified in the configuration. Finally, for <span class="EmphasisFontCategoryNonProportional">singerThree</span>,
                            no bean instance was created because the <span class="EmphasisFontCategoryNonProportional">init()</span> method raised an error because of the lack of a value for the <span class="EmphasisFontCategoryNonProportional">age</span>                            property.</div>
                        <div class="Para" id="Par37">As you can see, using the initialization method is an ideal way to ensure that your beans are configured correctly. By using this mechanism, you can take full advantage of the benefits of IoC without losing any of the control you
                            get from manually defining dependencies. The only constraint on your initialization method is that it cannot accept any arguments. You can define any return type, although it is ignored by Spring, and you can even use a static
                            method, but the method must accept no arguments.</div>
                        <div class="Para" id="Par38">The benefits of this mechanism are negated when using a static initialization method, because you cannot access any of the bean’s state to validate it. If your bean is using static state as a mechanism for saving memory and you
                            are using a static initialization method to validate this state, then you should consider moving the static state to instance state and using a nonstatic initialization method. If you use Spring’s singleton management capabilities,
                            the end effect is the same, but you have a bean that is much simpler to test, and you also have the increased effect of being able to create multiple instances of the bean with their own state when necessary. Of course, in
                            some instances, you need to use static state shared across multiple instances of a bean, in which case you can always use a static initialization method.</div>
                    </div>
                    <div class="Section2 RenderAsSection2" id="Sec5">
                        <h3 class="Heading">Implementing the InitializingBean Interface</h3>
                        <div class="Para" id="Par39">The <span id="ITerm20">                <span class="EmphasisFontCategoryNonProportional">InitializingBean</span> </span> interface defined in Spring allows you to define inside your bean code that you want the bean to receive notification
                            that Spring has finished configuring it. In the same way as when you are using an initialization method, this gives you the opportunity to check the bean configuration to ensure that it is valid, providing any default values
                            along the way. The <span class="EmphasisFontCategoryNonProportional">InitializingBean</span> interface defines a single method, <span class="EmphasisFontCategoryNonProportional">afterPropertiesSet()</span>, that serves the
                            same purpose as the <span class="EmphasisFontCategoryNonProportional">init()</span> method introduced in the previous section. The following code snippet shows a reimplementation of the previous example using the <span class="EmphasisFontCategoryNonProportional">InitializingBean</span>                            interface in place of the initialization method:</div>
                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.BeanCreationException</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.InitializingBean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.ApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerWithInterface</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">InitializingBean</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#c5060b;font-weight:700">DEFAULT_NAME</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">Eric Clapton</span>;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> name;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">int</span> age <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">Integer</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>MIN_VALUE</span>;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setName</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">name</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>name <span style="color:#00f;font-weight:700">=</span> name;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setAge</span>(<span style="color:#00f;font-weight:700">int</span> <span style="font-style:italic">age</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>age <span style="color:#00f;font-weight:700">=</span> age;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">afterPropertiesSet</span>() <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Exception</span> {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Initializing bean</span>);
        <span style="color:#00f;font-weight:700">if</span> (name <span style="color:#00f;font-weight:700">==</span> <span style="color:#585cf6;font-weight:700">null</span>) {
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Using  default  name</span>);
            name <span style="color:#00f;font-weight:700">=</span> <span style="color:#c5060b;font-weight:700">DEFAULT_NAME</span>;
        }
        <span style="color:#00f;font-weight:700">if</span> (age <span style="color:#00f;font-weight:700">==</span> <span style="color:#00f;font-weight:700">Integer</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>MIN_VALUE</span>) {
            <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">IllegalArgumentException</span>(
                    <span style="color:#036a07">You must set the age property of any beans of type </span>
                            <span style="color:#00f;font-weight:700">+</span> <span style="color:#00f;font-weight:700">SingerWithInterface</span><span style="color:#00f;font-weight:700">.</span>class);
        }
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">toString</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">&quot;<span style="color:#26b31a">\t</span>Name: &quot;</span> <span style="color:#00f;font-weight:700">+</span> name <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span><span style="color:#26b31a">\t</span>Age: &quot;</span> <span style="color:#00f;font-weight:700">+</span> age;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-xml.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        getBean(<span style="color:#036a07">singerOne</span>, ctx);
        getBean(<span style="color:#036a07">singerTwo</span>, ctx);
        getBean(<span style="color:#036a07">singerThree</span>, ctx);
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">SingerWithInterface</span> <span style="color:#0000a2;font-weight:700">getBean</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">beanName</span>,
                                               <span style="color:#00f;font-weight:700">ApplicationContext</span> <span style="font-style:italic">ctx</span>) {
        <span style="color:#00f;font-weight:700">try</span> {
            <span style="color:#00f;font-weight:700">SingerWithInterface</span> bean <span style="color:#00f;font-weight:700">=</span>
                    (<span style="color:#00f;font-weight:700">SingerWithInterface</span>) ctx<span style="color:#00f;font-weight:700">.</span>getBean(beanName);
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(bean);
            <span style="color:#00f;font-weight:700">return</span> bean;
        } <span style="color:#00f;font-weight:700">catch</span> (<span style="color:#00f;font-weight:700">BeanCreationException</span> ex) {
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">An error occured in bean configuration: </span>
                    <span style="color:#00f;font-weight:700">+</span> ex<span style="color:#00f;font-weight:700">.</span>getMessage());
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#585cf6;font-weight:700">null</span>;
        }
    }
}
</pre>
                        <div class="Para" id="Par41">As you can see, not much in this example has changed. Aside from the obvious class name change, the only differences are that this class implements <span class="EmphasisFontCategoryNonProportional">InitializingBean</span> and that
                            the initialization logic has moved into the <span class="EmphasisFontCategoryNonProportional">afterPropertiesSet()</span> method. In the following snippet, you can see the configuration for this example (<span class="EmphasisFontCategoryNonProportional">app-context- xml.xml</span>):</div>
                        <pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ... <span style="font-style:italic">default-lazy-init</span>=<span style="color:#036a07">true</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">singerOne</span>
          <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch4.SingerWithInterface</span>
          <span style="font-style:italic">p</span>:name=<span style="color:#036a07">John Mayer</span> <span style="font-style:italic">p</span>:age=<span style="color:#036a07">39</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">singerTwo</span>
          <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch4.SingerWithInterface</span>
          <span style="font-style:italic">p</span>:age=<span style="color:#036a07">72</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">singerThree</span>
          <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch4.SingerWithInterface</span>
          <span style="font-style:italic">p</span>:name=<span style="color:#036a07">John Butler</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
                    <div class="Para" id="Par43">Again, there’s not much difference between the configuration code introduced here and the configuration code in the previous section. The noticeable difference is the omission of the <span class="EmphasisFontCategoryNonProportional">init-method</span>                        attribute. Because the <span class="EmphasisFontCategoryNonProportional">SimpleBeanWithInterface</span> class implements the <span class="EmphasisFontCategoryNonProportional">InitializingBean</span> interface, Spring knows which
                        method to call as the initialization callback, thus removing the need for any additional configuration. The output from this example is shown here:</div>
                    <div class="Para" id="Par44">
                        <div class="ProgramCode" id="PC7">
                            <div class="FixedLine">Initializing bean</div>
                            <div class="FixedLine">        Name: John Mayer</div>
                            <div class="FixedLine">        Age: 39</div>
                            <div class="FixedLine">Initializing bean</div>
                            <div class="FixedLine">Using default  name</div>
                            <div class="FixedLine">        Name: Eric Clapton</div>
                            <div class="FixedLine">        Age: 72</div>
                            <div class="FixedLine">Initializing bean</div>
                            <div class="FixedLine">An error occured in bean configuration: Error creating bean with name &apos;singerThree&apos;<span id="ITerm22">                                                          </span> </div>
                            <div class="FixedLine"> defined in  class path resource spring/app-context-xml.xml: Invocation of</div>
                            <div class="FixedLine"> init method failed; nested exception is java.lang.IllegalArgumentException:</div>
                            <div class="FixedLine"> You must set the age property of any beans of type class</div>
                            <div class="FixedLine"> com.apress.prospring5.ch4.SingerWithInterface</div>
                        </div>
                    </div>
                </div>
                <div class="Section2 RenderAsSection2" id="Sec6">
                    <h3 class="Heading">Using the JSR-250 @PostConstruct Annotation</h3>
                    <div class="Para" id="Par45">Another method that can achieve the same purpose is to use the <span id="ITerm23">JSR-250                      </span> life-cycle annotation, <span class="EmphasisFontCategoryNonProportional">@PostConstruct</span>. Starting from Spring
                        2.5, JSR-250 annotations are also supported to specify the method that Spring should call if the corresponding annotation relating to the bean’s life cycle exists in the class. The following code sample shows the program with the
                        <span class="EmphasisFontCategoryNonProportional">@PostConstruct</span> annotation applied:</div>
                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.annotation.PostConstruct</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.BeanCreationException</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.ApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerWithJSR250</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#c5060b;font-weight:700">DEFAULT_NAME</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">Eric Clapton</span>;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> name;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">int</span> age <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">Integer</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>MIN_VALUE</span>;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setName</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">name</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>name <span style="color:#00f;font-weight:700">=</span> name;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setAge</span>(<span style="color:#00f;font-weight:700">int</span> <span style="font-style:italic">age</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>age <span style="color:#00f;font-weight:700">=</span> age;
    }

    <span style="color:#00f;font-weight:700">@PostConstruct</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">init</span>() <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Exception</span> {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Initializing bean</span>);
        <span style="color:#00f;font-weight:700">if</span> (name <span style="color:#00f;font-weight:700">==</span> <span style="color:#585cf6;font-weight:700">null</span>) {
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Using default name</span>);
            name <span style="color:#00f;font-weight:700">=</span> <span style="color:#c5060b;font-weight:700">DEFAULT_NAME</span>;
        }
        <span style="color:#00f;font-weight:700">if</span> (age <span style="color:#00f;font-weight:700">==</span> <span style="color:#00f;font-weight:700">Integer</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>MIN_VALUE</span>) {
            <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">IllegalArgumentException</span>(
                    <span style="color:#036a07">You must set the age property of any beans of type </span> <span style="color:#00f;font-weight:700">+</span>
                            <span style="color:#00f;font-weight:700">SingerWithJSR250</span><span style="color:#00f;font-weight:700">.</span>class);
        }
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">toString</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">&quot;<span style="color:#26b31a">\t</span>Name: &quot;</span> <span style="color:#00f;font-weight:700">+</span> name <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span><span style="color:#26b31a">\t</span>Age: &quot;</span> <span style="color:#00f;font-weight:700">+</span> age;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-annotation.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        getBean(<span style="color:#036a07">singerOne</span>, ctx);
        getBean(<span style="color:#036a07">singerTwo</span>, ctx);
        getBean(<span style="color:#036a07">singerThree</span>, ctx);
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">SingerWithJSR250</span> <span style="color:#0000a2;font-weight:700">getBean</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">beanName</span>,
                                           <span style="color:#00f;font-weight:700">ApplicationContext</span> <span style="font-style:italic">ctx</span>) {
        <span style="color:#00f;font-weight:700">try</span> {
            <span style="color:#00f;font-weight:700">SingerWithJSR250</span> bean <span style="color:#00f;font-weight:700">=</span>
                    (<span style="color:#00f;font-weight:700">SingerWithJSR250</span>) ctx<span style="color:#00f;font-weight:700">.</span>getBean(beanName);
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(bean);
            <span style="color:#00f;font-weight:700">return</span> bean;
        } <span style="color:#00f;font-weight:700">catch</span> (<span style="color:#00f;font-weight:700">BeanCreationException</span> ex) {
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">An error occured in bean configuration: </span>
                    <span style="color:#00f;font-weight:700">+</span> ex<span style="color:#00f;font-weight:700">.</span>getMessage());
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#585cf6;font-weight:700">null</span>;
        }
    }
}
</pre>
                    <div class="Para" id="Par47">The program is the same as using the <span class="EmphasisFontCategoryNonProportional">init-method</span> approach; just apply the <span class="EmphasisFontCategoryNonProportional">@PostConstruct</span> annotation before the
                        <span class="EmphasisFontCategoryNonProportional">init()</span> method. Note that you can assign any name to the method. In terms of configuration, since we are using annotations, we need to add the <span class="EmphasisFontCategoryNonProportional">&lt;context:annotation-driven&gt;</span>                            tag from the context namespace into the configuration file.</div>
                    <pre style="background:#fff;color:#000"><span style="color:#68685b">&lt;?<span style="color:#888">xml</span><span style="color:#888"> version</span>=<span style="color:#888">1.0</span><span style="color:#888"> encoding</span>=<span style="color:#888">UTF-8</span>?&gt;</span>
<span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> <span style="font-style:italic">xmlns</span>=<span style="color:#036a07">http://www.springframework.org/schema/beans</span>
       <span style="font-style:italic">xmlns</span>:xsi=<span style="color:#036a07">http://www.w3.org/2001/XMLSchema-instance</span>
       <span style="font-style:italic">xmlns</span>:context=<span style="color:#036a07">http://www.springframework.org/schema/context</span>
       <span style="font-style:italic">xmlns</span>:p=<span style="color:#036a07">http://www.springframework.org/schema/p</span>
       <span style="font-style:italic">xsi</span>:schemaLocation=<span style="color:#036a07">http://www.springframework.org/schema/beans
          http://www.springframework.org/schema/beans/spring-beans.xsd
          http://www.springframework.org/schema/context
          http://www.springframework.org/schema/context/spring-context.xsd</span>
       <span style="font-style:italic">default-lazy-init</span>=<span style="color:#036a07">true</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">context</span><span style="font-weight:700">:</span><span style="font-weight:700">annotation-config</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">singerOne</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch4.SingerWithJSR250</span>
        <span style="font-style:italic">p</span>:name=<span style="color:#036a07">John Mayer</span>  <span style="font-style:italic">p</span>:age=<span style="color:#036a07">39</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">singerTwo</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch4.SingerWithJSR250</span>
        <span style="font-style:italic">p</span>:age=<span style="color:#036a07">72</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">singerThree</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch4.SingerWithJSR250</span>
            <span style="font-style:italic">p</span>:name=<span style="color:#036a07">John Butler</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
                    <div class="Para" id="Par49">Run the program and you will see the same output as other mechanisms.</div>
                    <div class="Para" id="Par50">
                        <div class="ProgramCode" id="PC10">
                            <div class="FixedLine">Initializing bean</div>
                            <div class="FixedLine">        Name: John Mayer</div>
                            <div class="FixedLine">        Age: 39</div>
                            <div class="FixedLine">Initializing bean</div>
                            <div class="FixedLine">Using default name</div>
                            <div class="FixedLine">        Name: Eric Clapton</div>
                            <div class="FixedLine">        Age: 72</div>
                            <div class="FixedLine">Initializing bean</div>
                            <div class="FixedLine">An error occurred in bean configuration: Error creating bean with name &apos;singerThree&apos;:</div>
                            <div class="FixedLine"> Invocation of init method failed; nested exception is</div>
                            <div class="FixedLine"> java.lang.IllegalArgumentException: You must set the age property of any beans</div>
                            <div class="FixedLine"> of type class com.apress.prospring5.ch4.SingerWithJSR250</div>
                        </div>
                    </div>
                    <div class="Para" id="Par51">All three approaches have their benefits and drawbacks. Using an initialization method, you have the benefit of keeping your application decoupled from Spring, but you have to remember to configure the initialization method for every
                        bean that needs it. Using the <span class="EmphasisFontCategoryNonProportional">InitializingBean</span> interface, you have the benefit of being able to specify the initialization callback once for all instances of your bean class,
                        but you have to couple your application to do so. Using annotations, you need to apply the annotation to the method and make sure that the IoC container supports JSR-250. In the end, you should let the requirements of your application
                        drive the decision about which approach to use. If portability is an issue, use the initialization or annotation method; otherwise, use the <span class="EmphasisFontCategoryNonProportional">InitializingBean</span> interface to
                        reduce the amount of configuration your application needs and the chance of errors creeping into your application because of <span id="ITerm26">misconfiguration                      </span>.</div>
                    <div class="Para ParaTypeImportant" id="Par52">
                    <img alt="A315511_5_En_4_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Figa_HTML.jpg" width="30"/>                        When configuring initialization with <span class="EmphasisFontCategoryNonProportional">init-method</span> or <span class="EmphasisFontCategoryNonProportional">@PostConstruct</span>, there is the advantage of declaring the initialization
                        method with a different access right. Initialization methods should be called only once by the Spring IoC, at bean creation time. Subsequent calls will lead to unexpected results or even failures. External additional calls can
                        be prohibited by making the initialization method <span class="EmphasisFontCategoryNonProportional">private</span>. The Spring IoC will be able to call it via reflection, but any additional calls in the code won’t be permitted.</div>
                </div>
        </div>
        <div class="Section1 RenderAsSection1" id="Sec7">
            <h2 class="Heading">Declaring an Initialization Method Using @Bean</h2>
            <div class="Para" id="Par53">Another way to declare the initialization method for a bean is to specify the <span class="EmphasisFontCategoryNonProportional">initMethod</span> attribute for the <span class="EmphasisFontCategoryNonProportional">@Bean</span> annotation and
                set the initialization method name as its value. This annotation is used to declare beans in Java configuration classes. Although Java configuration is covered a bit later in this chapter, the bean initialization part belongs here. For
                this example, the initial <span class="EmphasisFontCategoryNonProportional">Singer</span> class is used because the configuration is external, just like using the <span id="ITerm27">              <span class="EmphasisFontCategoryNonProportional">init-method</span>                </span> attribute. We’ll just write a configuration class and a new <span class="EmphasisFontCategoryNonProportional">main()</span> method to test it. Also, <span class="EmphasisFontCategoryNonProportional">default-lazy-init=&quot;true&quot;</span>                will be replaced by the <span class="EmphasisFontCategoryNonProportional">@Lazy</span> annotation on each bean declaration.</div>
            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.config</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.AnnotationConfigApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Bean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Configuration</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Lazy</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericApplicationContext</span>;

<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.Singer.getBean</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerConfigDemo</span> {
    <span style="color:#00f;font-weight:700">@Configuration</span>
    <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerConfig</span> {
        <span style="color:#00f;font-weight:700">@Lazy</span>
        <span style="color:#00f;font-weight:700">@Bean</span>(<span style="color:#c5060b;font-weight:700">initMethod</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">init</span>)
        <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">singerOne</span>() {
            <span style="color:#00f;font-weight:700">Singer</span> singerOne <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Singer</span>();
            singerOne<span style="color:#00f;font-weight:700">.</span>setName(<span style="color:#036a07">John Mayer</span>);
            singerOne<span style="color:#00f;font-weight:700">.</span>setAge(<span style="color:#0000cd">39</span>);
            <span style="color:#00f;font-weight:700">return</span> singerOne;
        }

        <span style="color:#00f;font-weight:700">@Lazy</span>
        <span style="color:#00f;font-weight:700">@Bean</span>(<span style="color:#c5060b;font-weight:700">initMethod</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">init</span>)
        <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">singerTwo</span>() {
            <span style="color:#00f;font-weight:700">Singer</span> singerTwo <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Singer</span>();
            singerTwo<span style="color:#00f;font-weight:700">.</span>setAge(<span style="color:#0000cd">72</span>);
            <span style="color:#00f;font-weight:700">return</span> singerTwo;
        }

        <span style="color:#00f;font-weight:700">@Lazy</span>
        <span style="color:#00f;font-weight:700">@Bean</span>(<span style="color:#c5060b;font-weight:700">initMethod</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">init</span>)
        <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">singerThree</span>() {
            <span style="color:#00f;font-weight:700">Singer</span> singerThree <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Singer</span>();
            singerThree<span style="color:#00f;font-weight:700">.</span>setName(<span style="color:#036a07">John Butler</span>);
            <span style="color:#00f;font-weight:700">return</span> singerThree;
        }
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">SingerConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        getBean(<span style="color:#036a07">singerOne</span>, ctx);
        getBean(<span style="color:#036a07">singerTwo</span>, ctx);
        getBean(<span style="color:#036a07">singerThree</span>, ctx);
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
            <div class="Para" id="Par55">Running this code will produce the same result observed so far, shown here:</div>
            <div class="Para" id="Par56">
                <div class="ProgramCode" id="PC12">
                    <div class="FixedLine">Initializing bean</div>
                    <div class="FixedLine">        Name: John Mayer</div>
                    <div class="FixedLine">        Age: 39</div>
                    <div class="FixedLine">Initializing bean</div>
                    <div class="FixedLine">Using default name</div>
                    <div class="FixedLine">        Name: Eric Clapton</div>
                    <div class="FixedLine">        Age: 72</div>
                    <div class="FixedLine">Initializing bean</div>
                    <div class="FixedLine">An error occurred in bean configuration: Error creating bean with name <span class="EmphasisTypeUnderline">singerThree</span> </div>
                    <div class="FixedLine"> defined in com.apress.prospring5.ch4.config.SingerConfigDemo$SingerConfig:</div>
                    <div class="FixedLine"> Invocation of init method failed; nested exception is</div>
                    <div class="FixedLine"> java.lang.IllegalArgumentException: You must set the age  property of any beans</div>
                    <div class="FixedLine">  of type class com.apress.prospring5.ch4.Singer</div>
                </div>
            </div>
            <div class="Section2 RenderAsSection2" id="Sec8">
                <h3 class="Heading">Understanding Order of Resolution</h3>
                <div class="Para" id="Par57">All initialization mechanisms can be used on the same bean instance. In this case, Spring invokes the method annotated with <span id="ITerm29">                <span class="EmphasisFontCategoryNonProportional">@PostConstruct</span> </span>
                    first and then <span id="ITerm30">                <span class="EmphasisFontCategoryNonProportional">afterPropertiesSet()</span> </span>, followed by the initialization method specified in the configuration file. There is a technical
                    reason for this order, and by following the path in Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Chapter.html#Fig1">4-1</a></span>, we can notice the
                    following steps in the bean creation process:
                    <div class="OrderedList">
                        <ol>
                            <li class="ListItem"><span class="ItemNumber">1.</span>
                                <div class="ItemContent">
                                    <div>
                                        <div class="Para" id="Par58">The constructor is called first to create the bean.</div>
                                    </div>
                                </div>
                                <div class="ClearBoth"> </div>
                            </li>
                            <li class="ListItem"><span class="ItemNumber">2.</span>
                                <div class="ItemContent">
                                    <div>
                                        <div class="Para" id="Par59">The dependencies are injected (setters are called).</div>
                                    </div>
                                </div>
                                <div class="ClearBoth"> </div>
                            </li>
                            <li class="ListItem"><span class="ItemNumber">3.</span>
                                <div class="ItemContent">
                                    <div>
                                        <div class="Para" id="Par60">Now that the beans exist and the dependencies were provided, the pre-initialization <span class="EmphasisFontCategoryNonProportional">BeanPostProcessor</span> infrastructure beans are consulted to see whether they
                                            want to call anything from this bean. These are Spring-specific infrastructure beans that perform bean modifications after they are created. The <span class="EmphasisFontCategoryNonProportional">@PostConstruct</span>                                            annotation is registered by <span class="EmphasisFontCategoryNonProportional">CommonAnnotationBeanPostProcessor</span>, so this bean will call the method found annotated with <span class="EmphasisFontCategoryNonProportional">@PostConstruct</span>.
                                            This method is executed right after the bean has been constructed and before the class is put into service,<a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Chapter.html#Fn1" id="Fn1_source"><sup>1</sup></a> before the actual initialization of the bean (before <span class="EmphasisFontCategoryNonProportional">afterPropertiesSet</span> and <span class="EmphasisFontCategoryNonProportional">init-method</span>).</div>
                                    </div>
                                </div>
                                <div class="ClearBoth"> </div>
                            </li>
                            <li class="ListItem"><span class="ItemNumber">4.</span>
                                <div class="ItemContent">
                                    <div>
                                        <div class="Para" id="Par62">The <span class="EmphasisFontCategoryNonProportional">InitializingBean</span>’s <span class="EmphasisFontCategoryNonProportional">afterPropertiesSet</span> is executed right after the dependencies are injected.
                                            The <span class="EmphasisFontCategoryNonProportional">afterPropertiesSet()</span> method is invoked by a <span class="EmphasisFontCategoryNonProportional">BeanFactory</span> after it has set all the bean properties
                                            supplied and has satisfied <span class="EmphasisFontCategoryNonProportional">BeanFactoryAware</span> and <span class="EmphasisFontCategoryNonProportional">ApplicationContextAware</span>.</div>
                                    </div>
                                </div>
                                <div class="ClearBoth"> </div>
                            </li>
                            <li class="ListItem"><span class="ItemNumber">5.</span>
                                <div class="ItemContent">
                                    <div>
                                        <div class="Para ParaOneEmphasisChild" id="Par63">The <span class="EmphasisFontCategoryNonProportional">init-method</span> attribute is executed last because this is the actual initialization method of the bean.</div>
                                    </div>
                                </div>
                                <div class="ClearBoth"> </div>
                            </li>
                        </ol>
                    </div>
                </div>
                <div class="Para" id="Par64">Understanding the order of different types of bean initialization can be useful if you have an existing bean that performs some initialization in a specific method but you need to add some more initialization code when you use Spring.</div>
            </div>
        </div>
        <div class="Section1 RenderAsSection1" id="Sec9">
            <h2 class="Heading">Hooking into Bean <span id="ITerm31">Destruction                  </span> </h2>
            <div class="Para" id="Par65">When using an <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> implementation that wraps the <span class="EmphasisFontCategoryNonProportional">DefaultListableBeanFactory</span> interface (such as <span class="EmphasisFontCategoryNonProportional">GenericXmlApplicationContext</span>,
                via the <span class="EmphasisFontCategoryNonProportional">getDefaultListableBeanFactory()</span> method), you can signal to <span class="EmphasisFontCategoryNonProportional">BeanFactory</span> that you want to destroy all singleton instances
                with a call to <span class="EmphasisFontCategoryNonProportional">ConfigurableBeanFactory.destroySingletons()</span>. Typically, you do this when your application shuts down, and it allows you to clean up any resources that your beans might
                be holding open, thus allowing your application to shut down gracefully. This callback also provides the perfect place to flush any data you are storing in memory to persistent storage and to allow your beans to end any long-running processes
                they may have started.</div>
            <div class="Para" id="Par66">To allow your beans to receive notification that <span class="EmphasisFontCategoryNonProportional">destroySingletons()</span> has been called, you have three options, all similar to the mechanisms available for receiving an initialization
                callback. The destruction callback is often used in conjunction with the initialization callback. In many cases, you create and configure a resource in the initialization callback and then release the resource in the <span id="ITerm32">destruction callback                  </span>.</div>
            <div class="Section2 RenderAsSection2" id="Sec10">
                <h3 class="Heading">Executing a Method When a Bean Is Destroyed</h3>
                <div class="Para" id="Par67">To designate a method to be called when a bean is destroyed, you simply specify the name of the method in the <span class="EmphasisFontCategoryNonProportional">destroy-method</span> attribute of the bean’s <span class="EmphasisFontCategoryNonProportional">&lt;bean&gt;</span>                    tag. Spring calls it just before it destroys the singleton instance of the bean (Spring will not call this method for those beans with prototype scope). The following code snippet provides an example of using a <span class="EmphasisFontCategoryNonProportional">destroy-method</span>                    callback:</div>
                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.io.File</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.InitializingBean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">DestructiveBean</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">InitializingBean</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">File</span> file;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> filePath;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">afterPropertiesSet</span>() <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Exception</span> {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Initializing  Bean</span>);
        <span style="color:#00f;font-weight:700">if</span> (filePath <span style="color:#00f;font-weight:700">==</span> <span style="color:#585cf6;font-weight:700">null</span>) {
            <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">IllegalArgumentException</span>(
                    <span style="color:#036a07">You must specify the filePath property of</span>
                            <span style="color:#00f;font-weight:700">+</span> <span style="color:#00f;font-weight:700">DestructiveBean</span><span style="color:#00f;font-weight:700">.</span>class);
        }
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>file <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">File</span>(filePath);
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>file<span style="color:#00f;font-weight:700">.</span>createNewFile();
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">File exists: </span> <span style="color:#00f;font-weight:700">+</span> file<span style="color:#00f;font-weight:700">.</span>exists());
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">destroy</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Destroying  Bean</span>);
        <span style="color:#00f;font-weight:700">if</span> (<span style="color:#00f;font-weight:700">!</span>file<span style="color:#00f;font-weight:700">.</span>delete()) {
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>err<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">ERROR: failed  to delete file.</span>);
        }
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">File exists: </span> <span style="color:#00f;font-weight:700">+</span> file<span style="color:#00f;font-weight:700">.</span>exists());
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setFilePath</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">filePath</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>filePath <span style="color:#00f;font-weight:700">=</span> filePath;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Exception</span> {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-xml.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">DestructiveBean</span> bean <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">DestructiveBean</span>) ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">destructiveBean</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Calling destroy()</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>destroy();
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Called destroy()</span>);
    }
}
</pre>
                <div class="Para" id="Par69">This code defines a <span class="EmphasisFontCategoryNonProportional">destroy()</span> method, in which the file that was created gets deleted. The <span class="EmphasisFontCategoryNonProportional">main()</span> method retrieves a bean
                    of type <span class="EmphasisFontCategoryNonProportional">DestructiveBean</span> from <span id="ITerm35">                <span class="EmphasisFontCategoryNonProportional">GenericXmlApplicationContext</span> </span> and then invokes
                    its <span class="EmphasisFontCategoryNonProportional">destroy()</span> method (which will, in turn, invoke the <span class="EmphasisFontCategoryNonProportional">ConfigurableBeanFactory.destroySingletons()</span> that was wrapped by
                    the <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>), instructing Spring to destroy all the singletons managed by it. Both the initialization and destruction callbacks write a message to console output informing
                    us that they have been called. In the following snippet, you can see the configuration for the <span id="ITerm36">                <span class="EmphasisFontCategoryNonProportional">destructiveBean</span> </span> bean (<span class="EmphasisFontCategoryNonProportional">app-context-xml.xml</span>):</div>
                <pre style="background:#fff;color:#000"><span style="color:#68685b">&lt;?<span style="color:#888">xml</span><span style="color:#888"> version</span>=<span style="color:#888">1.0</span><span style="color:#888"> encoding</span>=<span style="color:#888">UTF-8</span>?&gt;</span>
<span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> <span style="font-style:italic">xmlns</span>=<span style="color:#036a07">http://www.springframework.org/schema/beans</span>
    <span style="font-style:italic">xmlns</span>:xsi=<span style="color:#036a07">http://www.w3.org/2001/XMLSchema-instance</span>
    <span style="font-style:italic">xmlns</span>:p=<span style="color:#036a07">http://www.springframework.org/schema/p</span>
    <span style="font-style:italic">xsi</span>:schemaLocation=<span style="color:#036a07">http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">destructiveBean</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch4.DestructiveBean</span>
        <span style="font-style:italic">destroy-method</span>=<span style="color:#036a07">destroy</span>
        <span style="font-style:italic">p</span>:filePath=
   <span style="color:#036a07">#{systemProperties&apos;java.io.tmpdir&apos;}#{systemProperties&apos;file.separator&apos;}test.txt</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
        <div class="Para" id="Par71">Notice that we have specified the <span class="EmphasisFontCategoryNonProportional">destroy()</span> method as the destruction callback by using the <span class="EmphasisFontCategoryNonProportional">destroy-method</span> attribute. The filePath
            attribute value is built by using an SpEL expression, concatenating the system properties <span class="EmphasisFontCategoryNonProportional">java.io.tmpdir</span> and <span class="EmphasisFontCategoryNonProportional">file.separator</span> before
            the file name <span class="EmphasisFontCategoryNonProportional">test.txt</span> to ensure cross-platform compatibility. Running this example yields the following output:</div>
        <div class="Para" id="Par72">
            <div class="ProgramCode" id="PC15">
                <div class="FixedLine">Initializing Bean</div>
                <div class="FixedLine">File exists: true</div>
                <div class="FixedLine">Calling destroy()</div>
                <div class="FixedLine">Destroying Bean</div>
                <div class="FixedLine">File exists: false</div>
                <div class="FixedLine">Called destroy()</div>
            </div>
        </div>
        <div class="Para" id="Par73">As you can see, Spring first invokes the initialization callback, and the <span class="EmphasisFontCategoryNonProportional">DestructiveBean</span> instance creates the <span class="EmphasisFontCategoryNonProportional">File</span> instance and
            stores it. Next, during the call to <span class="EmphasisFontCategoryNonProportional">destroy()</span>, Spring iterates over the set of singletons it is managing, in this case just one, and invokes any destruction callbacks that are specified.
            This is where the <span class="EmphasisFontCategoryNonProportional">DestructiveBean</span> instance deletes the created file and logs messages to the screen indicating it no longer exists.</div>
    </div>
    <div class="Section2 RenderAsSection2" id="Sec11">
        <h3 class="Heading">Implementing the DisposableBean Interface</h3>
        <div class="Para" id="Par74">As with initialization callbacks, Spring provides an interface, in this case <span id="ITerm37">                <span class="EmphasisFontCategoryNonProportional">DisposableBean</span> </span>, that can be implemented by your beans as a mechanism
            for receiving destruction callbacks. The <span class="EmphasisFontCategoryNonProportional">DisposableBean</span> interface defines a single method, <span class="EmphasisFontCategoryNonProportional">destroy()</span>, which is called just before
            the bean is destroyed. Using this mechanism is orthogonal to using the <span class="EmphasisFontCategoryNonProportional">InitializingBean</span> interface to receive initialization callbacks. The following code snippet shows a modified implementation
            of the <span class="EmphasisFontCategoryNonProportional">DestructiveBean</span> class that implements the <span class="EmphasisFontCategoryNonProportional">DisposableBean</span> interface:</div>
        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.io.File</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.DisposableBean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.InitializingBean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">DestructiveBeanWithInterface</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">InitializingBean</span>, <span style="font-style:italic">DisposableBean</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">File</span> file;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> filePath;

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">afterPropertiesSet</span>() <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Exception</span> {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Initializing  Bean</span>);
        <span style="color:#00f;font-weight:700">if</span> (filePath <span style="color:#00f;font-weight:700">==</span> <span style="color:#585cf6;font-weight:700">null</span>) {
            <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">IllegalArgumentException</span>(
                    <span style="color:#036a07">You must  specify the filePath property of </span> <span style="color:#00f;font-weight:700">+</span>
                            <span style="color:#00f;font-weight:700">DestructiveBeanWithInterface</span><span style="color:#00f;font-weight:700">.</span>class);
        }
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>file <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">File</span>(filePath);
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>file<span style="color:#00f;font-weight:700">.</span>createNewFile();
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">File exists: </span> <span style="color:#00f;font-weight:700">+</span> file<span style="color:#00f;font-weight:700">.</span>exists());
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">destroy</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Destroying  Bean</span>);
        <span style="color:#00f;font-weight:700">if</span> (<span style="color:#00f;font-weight:700">!</span>file<span style="color:#00f;font-weight:700">.</span>delete()) {
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>err<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">ERROR: failed  to delete file.</span>);
        }
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">File exists: </span> <span style="color:#00f;font-weight:700">+</span> file<span style="color:#00f;font-weight:700">.</span>exists());
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setFilePath</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">filePath</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>filePath <span style="color:#00f;font-weight:700">=</span> filePath;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Exception</span> {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-xml.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">DestructiveBeanWithInterface</span> bean <span style="color:#00f;font-weight:700">=</span>
                (<span style="color:#00f;font-weight:700">DestructiveBeanWithInterface</span>) ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">destructiveBean</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Calling destroy()</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>destroy();
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Called destroy()</span>);
    }
}
</pre>
        <div class="Para ParaOneEmphasisChild" id="Par76">There is not much difference between the code that uses the callback method mechanism and the code that uses the callback interface mechanism. In this case, we even used the same method names. The configuration for this example is depicted here
            (<span class="EmphasisFontCategoryNonProportional">app-context-xml.xml</span>):</div>
        <pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">destructiveBean</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch4.DestructiveBeanWithInterface</span>
        <span style="font-style:italic">p</span>:filePath=
   <span style="color:#036a07">#{systemProperties&apos;java.io.tmpdir&apos;}#{systemProperties&apos;file.separator&apos;}test.txt</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
        <div class="Para ParaOneEmphasisChild" id="Par78">Aside from the different class name, the only difference is the omission of the <span class="EmphasisFontCategoryNonProportional">destroy-method</span> attribute. Running this example yields the following output:</div>
        <div class="Para" id="Par79">
            <div class="ProgramCode" id="PC18">
                <div class="FixedLine">Initializing Bean</div>
                <div class="FixedLine">File exists: true</div>
                <div class="FixedLine">Calling destroy()</div>
                <div class="FixedLine">Destroying Bean</div>
                <div class="FixedLine">File exists: false</div>
                <div class="FixedLine">Called destroy()</div>
            </div>
        </div>
    </div>
    <div class="Section2 RenderAsSection2" id="Sec12">
        <h3 class="Heading">Using the JSR-250 @PreDestroy Annotation</h3>
        <div class="Para" id="Par80">The third way to define a method to be called before a bean is destroyed is to use the JSR-250 life-cycle <span class="EmphasisFontCategoryNonProportional">@PreDestroy</span> annotation, which is the inverse of the <span class="EmphasisFontCategoryNonProportional">@PostConstruct</span>            annotation. The following code snippet is a version of <span class="EmphasisFontCategoryNonProportional">DestructiveBean</span> that uses both <span id="ITerm39">                <span class="EmphasisFontCategoryNonProportional">@PostConstruct</span>            </span> <span id="ITerm40">                                              </span> and <span class="EmphasisFontCategoryNonProportional">@PreDestroy</span> in the same class to perform program initialization and destroy actions:</div>
        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.io.File</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.annotation.PostConstruct</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.annotation.PreDestroy</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">DestructiveBeanWithJSR250</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">File</span> file;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> filePath;

    <span style="color:#00f;font-weight:700">@PostConstruct</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">afterPropertiesSet</span>() <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Exception</span> {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Initializing  Bean</span>);
        <span style="color:#00f;font-weight:700">if</span> (filePath <span style="color:#00f;font-weight:700">==</span> <span style="color:#585cf6;font-weight:700">null</span>) {
            <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">IllegalArgumentException</span>(
                    <span style="color:#036a07">You must specify the filePath property of </span> <span style="color:#00f;font-weight:700">+</span>
                            <span style="color:#00f;font-weight:700">DestructiveBeanWithJSR250</span><span style="color:#00f;font-weight:700">.</span>class);
        }
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>file <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">File</span>(filePath);
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>file<span style="color:#00f;font-weight:700">.</span>createNewFile();
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">File exists: </span> <span style="color:#00f;font-weight:700">+</span> file<span style="color:#00f;font-weight:700">.</span>exists());
    }

    <span style="color:#00f;font-weight:700">@PreDestroy</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">destroy</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Destroying  Bean</span>);
        <span style="color:#00f;font-weight:700">if</span> (<span style="color:#00f;font-weight:700">!</span>file<span style="color:#00f;font-weight:700">.</span>delete()) {
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>err<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">ERROR: failed  to delete file.</span>);
        }
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">File exists: </span> <span style="color:#00f;font-weight:700">+</span> file<span style="color:#00f;font-weight:700">.</span>exists());
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setFilePath</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">filePath</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>filePath <span style="color:#00f;font-weight:700">=</span> filePath;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Exception</span> {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-annotation.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">DestructiveBeanWithJSR250</span> bean <span style="color:#00f;font-weight:700">=</span>
                (<span style="color:#00f;font-weight:700">DestructiveBeanWithJSR250</span>) ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">destructiveBean</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Calling destroy()</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>destroy();
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Called destroy()</span>);
    }
}
</pre>
        <div class="Para" id="Par82">In the following snippet, you can see the configuration file for this bean, which makes use of the <span class="EmphasisFontCategoryNonProportional">&lt;context:annotation-config&gt;</span> tag (<span class="EmphasisFontCategoryNonProportional">app-context-annotation.xml</span>).</div>
        <div class="Para" id="Par83">
            <div class="ProgramCode" id="PC20">
                <div class="LineGroup">
                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">context</span><span style="font-weight:700">:</span><span style="font-weight:700">annotation-config</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">destructiveBean</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch4.DestructiveBeanWithJSR250</span>
        <span style="font-style:italic">p</span>:filePath=
    <span style="color:#036a07">#{systemProperties&apos;java.io.tmpdir&apos;}#{systemProperties&apos;file.separator&apos;}test.txt</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre></div>
                </div>
            </div>
    </div>
    </div>
    </div>
    <div class="Section1 RenderAsSection1" id="Sec13">
        <h2 class="Heading">Declaring a Destroy Method Using @Bean</h2>
        <div class="Para" id="Par84">Another way to declare the destroy method for a bean is to specify the <span class="EmphasisFontCategoryNonProportional">destroyMethod</span> attribute for the <span class="EmphasisFontCategoryNonProportional">@Bean</span> annotation and set the
            destroy method name as its value. This annotation is used to declare beans in Java configuration classes. Although Java configuration is covered a bit later in this chapter, the bean destruction part belongs here. For this example, the initial
            <span class="EmphasisFontCategoryNonProportional">DestructiveBeanWithJSR250</span> class is used, as the configuration is external, just like using the <span class="EmphasisFontCategoryNonProportional">destroy-method</span> attribute. We’ll
            just write a configuration class and a new <span class="EmphasisFontCategoryNonProportional">main()</span> method to test it. Also, <span class="EmphasisFontCategoryNonProportional">default-lazy-init=&quot;true&quot;</span> will be replaced by the
            <span class="EmphasisFontCategoryNonProportional">@Lazy</span> annotation on each bean declaration.</div>
        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.config</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.DestructiveBeanWithJSR250</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.AnnotationConfigApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Bean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Configuration</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Lazy</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericApplicationContext</span>;

<span style="color:#06f;font-style:italic">/**
 * Created by  iuliana.cosmina on  2/27/17.
 */</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">DestructiveBeanConfigDemo</span> {
    <span style="color:#00f;font-weight:700">@Configuration</span>
    <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">DestructiveBeanConfig</span> {
        <span style="color:#00f;font-weight:700">@Lazy</span>
        <span style="color:#00f;font-weight:700">@Bean</span>(<span style="color:#c5060b;font-weight:700">initMethod</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">afterPropertiesSet</span>, <span style="color:#c5060b;font-weight:700">destroyMethod</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">destroy</span>)
        <span style="color:#00f;font-weight:700">DestructiveBeanWithJSR250</span> <span style="color:#0000a2;font-weight:700">destructiveBean</span>() {
            <span style="color:#00f;font-weight:700">DestructiveBeanWithJSR250</span> destructiveBean <span style="color:#00f;font-weight:700">=</span>
                    <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">DestructiveBeanWithJSR250</span>();
            destructiveBean<span style="color:#00f;font-weight:700">.</span>setFilePath(<span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>getProperty(<span style="color:#036a07">java.io.tmpdir</span>) <span style="color:#00f;font-weight:700">+</span>
                    <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>getProperty(<span style="color:#036a07">file.separator</span>) <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">test.txt</span>);
            <span style="color:#00f;font-weight:700">return</span> destructiveBean;
        }
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">DestructiveBeanConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">DestructiveBeanWithJSR250</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Calling destroy()</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>destroy();
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Called destroy()</span>);
    }
}
</pre>
        <div class="Para" id="Par86">The <span id="ITerm45">              <span class="EmphasisFontCategoryNonProportional">@PostConstruct</span> </span> annotation is used as well in the bean configuration; thus, running this code will produce the same result observed so far.</div>
        <div class="Para" id="Par87">
            <div class="ProgramCode" id="PC22">
                <div class="FixedLine">Initializing Bean</div>
                <div class="FixedLine">File exists: true</div>
                <div class="FixedLine">Calling destroy()</div>
                <div class="FixedLine">Destroying Bean</div>
                <div class="FixedLine">File exists: false</div>
                <div class="FixedLine">Called destroy()</div>
            </div>
    </div>
    <div class="Para" id="Par88">The destruction callback is an ideal mechanism for ensuring that your applications shut down gracefully and do not leave resources open or in an inconsistent state. However, you still have to decide whether to use the destruction method callback,
        the <span class="EmphasisFontCategoryNonProportional">DisposableBean</span> interface, the <span class="EmphasisFontCategoryNonProportional">@PreDestroy</span> annotation, the XML <span class="EmphasisFontCategoryNonProportional">destroy-attribute</span>        attribute, or the <span class="EmphasisFontCategoryNonProportional">destroyMethod</span>. Again, let the requirements of your application drive your decision in this respect; use the method callback where portability is an issue, and use the
        <span class="EmphasisFontCategoryNonProportional">DisposableBean</span> interface or a JSR-250 annotation to reduce the amount of configuration required.</div>
    </div>
    <div class="Section1 RenderAsSection1" id="Sec14">
        <h2 class="Heading">Understanding Order of Resolution</h2>
        <div class="Para" id="Par89">As with the case of bean creation, you can use all mechanisms on the same bean instance for bean destruction. In this case, Spring invokes the method annotated with <span class="EmphasisFontCategoryNonProportional">@PreDestroy</span> first and
            then <span class="EmphasisFontCategoryNonProportional">DisposableBean.destroy()</span>, followed by your destroy method configured in your XML definition.</div>
        <div class="Section2 RenderAsSection2" id="Sec15">
            <h3 class="Heading">Using a Shutdown Hook</h3>
            <div class="Para" id="Par90">The only drawback of the destruction callbacks in Spring is that they are not fired automatically; you need to remember to call <span class="EmphasisFontCategoryNonProportional">AbstractApplicationContext.destroy()</span> before your application
                is closed. When your application runs as a servlet, you can simply call <span class="EmphasisFontCategoryNonProportional">destroy()</span> in the servlet’s <span class="EmphasisFontCategoryNonProportional">destroy()</span> method. However,
                in a stand-alone application, things are not quite so simple, especially if you have multiple exit points out of your application. Fortunately, there is a solution. Java allows you to create a <span id="ITerm46">                <span class="EmphasisTypeItalic">shutdown hook</span>                </span>, which is a thread that is executed just before the application shuts down. This is the perfect way to invoke the <span class="EmphasisFontCategoryNonProportional">destroy()</span> method of your <span class="EmphasisFontCategoryNonProportional">AbstractApplicationContext</span>                (which was being extended by all concrete <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> implementations). The easiest way to take advantage of this mechanism is to use <span class="EmphasisFontCategoryNonProportional">AbstractApplicationContext</span>’s
                <span class="EmphasisFontCategoryNonProportional">registerShutdownHook()</span> method. The method automatically instructs Spring to register a shutdown hook of the underlying JVM runtime. The bean declaration and configuration stay the
                same as before; the only thing that changes is the main method: the call of <span class="EmphasisFontCategoryNonProportional">ctx.registerShutdownHook</span> is added, and calls to <span class="EmphasisFontCategoryNonProportional">ctx.destroy()</span>                or <span class="EmphasisFontCategoryNonProportional">close()</span> will be removed.</div>
            <div class="Para" id="Par91">
                <div class="ProgramCode" id="PC23">
                    <div class="LineGroup">
                        <div class="FixedLine"><pre style="background:#fff;color:#000">.<span style="color:#00f;font-weight:700">.</span>.
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">DestructiveBeanWithHook</span> {
   <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
           <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(
               <span style="color:#00f;font-weight:700">DestructiveBeanConfig</span><span style="color:#00f;font-weight:700">.</span>class);
           ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">DestructiveBeanWithJSR250</span><span style="color:#00f;font-weight:700">.</span>class);
           ctx<span style="color:#00f;font-weight:700">.</span>registerShutdownHook();
   }
}
</pre></div>
                    </div>
                </div>
            </div>
            <div class="Para" id="Par92">Running this code will produce the same result observed so far.</div>
            <div class="Para" id="Par93">
                <div class="ProgramCode" id="PC24">
                    <div class="FixedLine">Initializing Bean</div>
                    <div class="FixedLine">File exists: true</div>
                    <div class="FixedLine">Destroying Bean</div>
                    <div class="FixedLine">File exists: false</div>
                </div>
            </div>
            <div class="Para ParaOneEmphasisChild" id="Par94">As you can see, the <span class="EmphasisFontCategoryNonProportional">destroy()</span> method is invoked, even though we didn’t write any code to invoke it explicitly as the application was shutting down.</div>
        </div>
    </div>
    <div class="Section1 RenderAsSection1" id="Sec16">
        <h2 class="Heading">Making Your Beans “Spring Aware”</h2>
        <div class="Para" id="Par95">One of the biggest selling points of dependency injection over dependency lookup as a mechanism for achieving inversion of control is that your beans do not need to be aware of the implementation of the container that is managing them. To a bean
            that uses constructor or setter injection, the Spring container is the same as the container provided by Google Guice or PicoContainer. However, in certain circumstances, you may need a bean that is using dependency injection to obtain its
            dependencies so it can interact with the container for some other reason. An example of this may be a bean that automatically configures a shutdown hook for you, and thus it needs access to <span id="ITerm48">              <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>            </span>. In other cases, a bean may want to know what its name is (that is, the bean name that was assigned within the current <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>) so it can perform some additional processing
            based on this name.</div>
        <div class="Para" id="Par96">That said, this feature is really intended for internal Spring use. Giving the bean name some kind of business meaning is generally a bad idea and can lead to configuration problems as bean names have to be artificially manipulated to support
            their business meaning. However, we have found that being able to have a bean find out its name at runtime is really useful for logging. Say you have many beans of the same type running under different configurations. The bean name can be
            included in log messages to help you differentiate between the one that is generating errors and the ones that are working fine when something goes wrong.</div>
        <div class="Section2 RenderAsSection2" id="Sec17">
            <h3 class="Heading">Using the <span id="ITerm49">BeanNameAware                      </span> Interface</h3>
            <div class="Para" id="Par97">The <span class="EmphasisFontCategoryNonProportional">BeanNameAware</span> interface, which can be implemented by a bean that wants to obtain its own name, has a single method: <span class="EmphasisFontCategoryNonProportional">setBeanName(String)</span>.
                Spring calls the <span class="EmphasisFontCategoryNonProportional">setBeanName()</span> method after it has finished configuring your bean but before any life-cycle callbacks (initialization or destroy) are called (refer to Figure
                <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Chapter.html#Fig1">4-1</a></span>). In most cases, the implementation of the <span class="EmphasisFontCategoryNonProportional">setBeanName()</span>                    interface is just a single line that stores the value passed in by the container in a field for use later. The following code snippet shows a simple bean that obtains its name by using <span class="EmphasisFontCategoryNonProportional">BeanNameAware</span>                    and then later uses this bean name to print to the console:</div>
            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.BeanNameAware</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">NamedSinger</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">BeanNameAware</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> name;

    <span style="color:#06f;font-style:italic">/**
     * <span style="color:#00f;font-weight:700">@Implements</span> <span style="color:#1c02ff">{@link BeanNameAware#setBeanName(String)}</span>
     */</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setBeanName</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">beanName</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>name <span style="color:#00f;font-weight:700">=</span> beanName;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">sing</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Singer </span> <span style="color:#00f;font-weight:700">+</span> name <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07"> - sing()</span>);
    }
}
</pre>
            <div class="Para" id="Par99">This implementation is fairly trivial. Remember that <span class="EmphasisFontCategoryNonProportional">BeanNameAware.setBeanName()</span> is called before the first instance of the bean is returned to your application via a call to <span class="EmphasisFontCategoryNonProportional">ApplicationContext.getBean()</span>,
                so there is no need to check whether the bean name is available in the <span class="EmphasisFontCategoryNonProportional">sing()</span> method. Here you can see the configuration contained in the <span class="EmphasisFontCategoryNonProportional">app-context-xml.xml</span>                file used in this example:</div>
            <pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">johnMayer</span>
           <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch4.NamedSinger</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
            <div class="Para" id="Par101">As you can see, no special configuration is required to take advantage of the <span class="EmphasisFontCategoryNonProportional">BeanNameAware</span> interface. In the following code snippet, you can see a simple example application that retrieves
                the <span class="EmphasisFontCategoryNonProportional">Singer</span> instance from <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> and then calls the <span class="EmphasisFontCategoryNonProportional">sing()</span>                method:</div>
            <div class="Para" id="Par102">
                <div class="ProgramCode" id="PC27">
                    <div class="LineGroup">
                        <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">NamedSingerDemo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-xml.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">NamedSinger</span> bean <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">NamedSinger</span>) ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">johnMayer</span>);
        bean<span style="color:#00f;font-weight:700">.</span>sing();
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre></div>
                    </div>
                </div>
            </div>
            <div class="Para ParaOneEmphasisChild" id="Par103">This example generates the following log output; notice the inclusion of the bean name in the log message for the call to <span class="EmphasisFontCategoryNonProportional">sing()</span>:</div>
            <div class="Para" id="Par104">
                <div class="ProgramCode" id="PC28">
                    <div class="FixedLine">Singer johnMayer - sing()</div>
                </div>
            </div>
            <div class="Para" id="Par105">Using the <span class="EmphasisFontCategoryNonProportional">BeanNameAware</span> interface is really quite simple, and it is put to good use when you are improving the quality of your log messages. Avoid being tempted to give your bean names
                business meaning just because you can access them; by doing so, you are coupling your classes to Spring for a feature that brings negligible benefit. If your beans need some kind of name internally, have them implement an interface such
                as <span class="EmphasisFontCategoryNonProportional">Nameable</span> (which is specific to your application) with a method <span class="EmphasisFontCategoryNonProportional">setName()</span> and then give each bean a name by using dependency
                injection. This way, you can keep the names you use for configuration concise, and you won’t need to manipulate your configuration unnecessarily to give your beans names with business <span id="ITerm50">meaning                      </span>.</div>
        </div>
        <div class="Section2 RenderAsSection2" id="Sec18">
            <h3 class="Heading">Using the <span id="ITerm51">ApplicationContextAware          </span> Interface</h3>
            <div class="Para" id="Par106"> <span class="EmphasisFontCategoryNonProportional">ApplicationContextAware</span> was introduced at the end of Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Chapter.html"><span class="RefSource">3</span></a>
                </span>
                to show how Spring can be used to deal with beans that require other beans to function that are not injected using constructors or setters in the configuration (the <span class="EmphasisFontCategoryNonProportional">depends-on</span> example).</div>
            <div class="Para" id="Par107">Using the <span class="EmphasisFontCategoryNonProportional">ApplicationContextAware</span> interface, it is possible for your beans to get a reference to the <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> instance
                that configured them. The main reason this interface was created is to allow a bean to access Spring’s <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> in your application, for example, to acquire other Spring
                beans programmatically, using <span class="EmphasisFontCategoryNonProportional">getBean()</span>. You should, however, avoid this practice and use dependency injection to provide your beans with their collaborators. If you use the lookup-based
                <span class="EmphasisFontCategoryNonProportional">getBean()</span> approach to obtain dependencies when you can use dependency injection, you are adding unnecessary complexity to your beans and coupling them to the Spring Framework without
                good reason.</div>
        <div class="Para" id="Par108">Of course, <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> isn’t used just to look up beans; it performs a great many other tasks. As you saw previously, one of these tasks is to destroy all singletons, notifying each
            of them in turn before doing so. In the previous section, you saw how to create a shutdown hook to ensure that <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> is instructed to destroy all singletons before the application
            shuts down. By using the <span class="EmphasisFontCategoryNonProportional">ApplicationContextAware</span> interface, you can build a bean that can be configured in <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>            to create and configure a shutdown hook bean automatically. The following configuration shows the code for this bean:</div>
        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.BeansException</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.ApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.ApplicationContextAware</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">ShutdownHookBean</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">ApplicationContextAware</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">ApplicationContext</span> ctx;

    <span style="color:#06f;font-style:italic">/**
     * <span style="color:#00f;font-weight:700">@Implements</span> <span style="background:rgba(0,0,0,0.05)">{@link ApplicationContextAware#s
     * etApplicationContext(ApplicationContext)}</span>    }
     */</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setApplicationContext</span>(<span style="color:#00f;font-weight:700">ApplicationContext</span> <span style="font-style:italic">ctx</span>)
            <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">BeansException</span> {
        <span style="color:#00f;font-weight:700">if</span> (ctx <span style="color:#00f;font-weight:700">instanceof</span> <span style="color:#00f;font-weight:700">GenericApplicationContext</span>) {
            ((<span style="color:#00f;font-weight:700">GenericApplicationContext</span>) ctx)<span style="color:#00f;font-weight:700">.</span>registerShutdownHook();
        }
    }
}
</pre>
        <div class="Para" id="Par110">Most of this code should seem familiar to you by now. The <span class="EmphasisFontCategoryNonProportional">ApplicationContextAware</span> interface defines a single method, <span class="EmphasisFontCategoryNonProportional">setApplicationContext(ApplicationContext)</span>,
            that Spring calls to pass your bean a reference to its <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>. In the previous code snippet, the <span class="EmphasisFontCategoryNonProportional">ShutdownHookBean</span>            class checks whether <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> is of type <span class="EmphasisFontCategoryNonProportional">GenericApplicationContext</span>, meaning it supports the <span class="EmphasisFontCategoryNonProportional">registerShutdownHook()</span>            method; if it does, it will register a shutdown hook to <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>. The following configuration snippet shows how to configure this bean to work with the <span class="EmphasisFontCategoryNonProportional">DestructiveBeanWithInterface</span>            bean (<span class="EmphasisFontCategoryNonProportional">app-context-annotation.xml</span>):</div>
        <pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...<span style="color:#036a07">&gt;
    &lt;context:annotation-config/&gt;
    &lt;bean id=</span>destructiveBean<span style="color:#036a07">
        class=</span>com.apress.prospring5.ch4.DestructiveBeanWithInterface<span style="color:#036a07">
        p:filePath=
 </span>#{systemProperties<span style="color:#036a07">java.io.tmpdir</span>}#{systemProperties<span style="color:#036a07">file.separator</span>}test.txt<span style="color:#036a07">/&gt;
    &lt;bean id=</span>shutdownHook<span style="color:#036a07">
        class=</span>com.apress.prospring5.ch4.ShutdownHookBean<span style="color:#036a07">&quot;/&gt;
&lt;/beans&gt;
</span></span></pre>
        <div class="Para ParaOneEmphasisChild" id="Par112">Notice that no special configuration is required. The following code snippet shows a simple example application that uses <span class="EmphasisFontCategoryNonProportional">ShutdownHookBean</span> to manage the destruction of singleton beans:</div>
        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.annotation.PostConstruct</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.annotation.PreDestroy</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.io.File</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">DestructiveBeanWithInterface</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">File</span> file;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> filePath;

    <span style="color:#00f;font-weight:700">@PostConstruct</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">afterPropertiesSet</span>() <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Exception</span> {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Initializing  Bean</span>);
        <span style="color:#00f;font-weight:700">if</span> (filePath <span style="color:#00f;font-weight:700">==</span> <span style="color:#585cf6;font-weight:700">null</span>) {
            <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">IllegalArgumentException</span>(
                    <span style="color:#036a07">You must specify the filePath property of </span> <span style="color:#00f;font-weight:700">+</span>
                            <span style="color:#00f;font-weight:700">DestructiveBeanWithInterface</span><span style="color:#00f;font-weight:700">.</span>class);
        }
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>file <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">File</span>(filePath);
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>file<span style="color:#00f;font-weight:700">.</span>createNewFile();
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">File exists: </span> <span style="color:#00f;font-weight:700">+</span> file<span style="color:#00f;font-weight:700">.</span>exists());
    }

    <span style="color:#00f;font-weight:700">@PreDestroy</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">destroy</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Destroying Bean</span>);
        <span style="color:#00f;font-weight:700">if</span> (<span style="color:#00f;font-weight:700">!</span>file<span style="color:#00f;font-weight:700">.</span>delete()) {
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>err<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">ERROR: failed to delete file.</span>);
        }
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">File exists: </span> <span style="color:#00f;font-weight:700">+</span> file<span style="color:#00f;font-weight:700">.</span>exists());
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setFilePath</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">filePath</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>filePath <span style="color:#00f;font-weight:700">=</span> filePath;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Exception</span> {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-annotation.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>registerShutdownHook();
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">destructiveBean</span>,
                <span style="color:#00f;font-weight:700">DestructiveBeanWithInterface</span><span style="color:#00f;font-weight:700">.</span>class);
    }
}
</pre>
    <div class="Para" id="Par114">This code should seem quite familiar to you. When Spring bootstraps <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> and <span class="EmphasisFontCategoryNonProportional">destructiveBean</span> is defined in the configuration,
        Spring passes the reference of <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> to the <span class="EmphasisFontCategoryNonProportional">shutdownHook</span> bean for registering the shutdown hook. Running this example
        yields the following output, as expected:</div>
    <div class="Para" id="Par115">
        <div class="ProgramCode" id="PC32">
            <div class="FixedLine">Initializing Bean</div>
            <div class="FixedLine">File exists: true</div>
            <div class="FixedLine">Destroying Bean</div>
            <div class="FixedLine">File exists: false</div>
        </div>
    </div>
    <div class="Para" id="Par116">As you can see, even though no calls to <span class="EmphasisFontCategoryNonProportional">destroy()</span> are in the main application, <span class="EmphasisFontCategoryNonProportional">ShutdownHookBean</span> is registered as a shutdown hook, and
        it calls <span class="EmphasisFontCategoryNonProportional">destroy()</span> just before the application shuts down.</div>
    </div>
    </div>
    <div class="Section1 RenderAsSection1" id="Sec19">
        <h2 class="Heading">Use of FactoryBeans</h2>
        <div class="Para" id="Par117">One of the problems that you will face when using Spring is how to create and then inject dependencies that cannot be created simply by using the <span class="EmphasisFontCategoryNonProportional">new</span> operator. To overcome this problem,
            Spring provides the <span class="EmphasisFontCategoryNonProportional">FactoryBean</span> interface that acts as an adapter for objects that cannot be created and managed using the standard Spring semantics. Typically, you use <span class="EmphasisFontCategoryNonProportional">FactoryBean</span>s
            to create beans that you cannot create by using the <span class="EmphasisFontCategoryNonProportional">new</span> operator, such as those you access through static factory methods, although this is not always the case. Simply put, a <span class="EmphasisFontCategoryNonProportional">FactoryBean</span>            is a bean that acts as a factory for other beans. <span class="EmphasisFontCategoryNonProportional">FactoryBean</span>s are configured within your <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> like any normal
            bean, but when Spring uses the <span class="EmphasisFontCategoryNonProportional">FactoryBean</span> interface to satisfy a dependency or lookup request, it does not return <span class="EmphasisFontCategoryNonProportional">FactoryBean</span>;
            instead, it invokes the <span class="EmphasisFontCategoryNonProportional">FactoryBean.getObject()</span> method and returns the result of that invocation.</div>
        <div class="Para" id="Par118"> <span class="EmphasisFontCategoryNonProportional">FactoryBean</span>s are used to great effect in Spring; the most noticeable uses are the creation of transactional proxies, which we cover in Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html"><span class="RefSource">9</span></a>
            </span>, and the automatic retrieval of resources from a JNDI context. However, <span class="EmphasisFontCategoryNonProportional">FactoryBean</span>s are useful not just for building the internals of Spring; you’ll find them really useful when you
            build your own applications because they allow you to manage many more resources by using IoC than would otherwise be available.</div>
        <div class="Section2 RenderAsSection2" id="Sec20">
            <h3 class="Heading">FactoryBean Example: The MessageDigestFactoryBean</h3>
            <div class="Para" id="Par119">Often the projects that we work on require some kind of cryptographic processing; typically, this involves generating a message digest or hash of a user’s password to be stored in a database. In Java, the <span class="EmphasisFontCategoryNonProportional">MessageDigest</span>                class provides functionality for creating a digest of any arbitrary data. <span class="EmphasisFontCategoryNonProportional">MessageDigest</span> itself is abstract, and you obtain concrete implementations by calling <span class="EmphasisFontCategoryNonProportional">MessageDigest.getInstance()</span>                and passing in the name of the digest algorithm you want to use. For instance, if we want to use the MD5 algorithm to create a digest, we use the following code to create the <span class="EmphasisFontCategoryNonProportional">MessageDigest</span>                instance:</div>
            <div class="Para" id="Par120">
                <div class="ProgramCode" id="PC33">
                    <div class="FixedLine">MessageDigest md5 = MessageDigest.getInstance(&quot;MD5&quot;);</div>
                </div>
            </div>
            <div class="Para" id="Par121">If we want to use Spring to manage the creation of the <span class="EmphasisFontCategoryNonProportional">MessageDigest</span> object, the best we can do without a <span class="EmphasisFontCategoryNonProportional">FactoryBean</span> is have
                a property, <span class="EmphasisFontCategoryNonProportional">algorithmName</span>, on your bean and then use an initialization callback to call <span class="EmphasisFontCategoryNonProportional">MessageDigest.getInstance()</span>. Using
                a <span class="EmphasisFontCategoryNonProportional">FactoryBean</span>, we can encapsulate this logic inside a bean. Then any beans that require a <span class="EmphasisFontCategoryNonProportional">MessageDigest</span> instance can simply
                declare a property, <span class="EmphasisFontCategoryNonProportional">messageDigest</span>, and use the <span class="EmphasisFontCategoryNonProportional">FactoryBean</span> to obtain the instance. The following code snippet shows an
                <span id="ITerm54">implementation </span> of <span class="EmphasisFontCategoryNonProportional">FactoryBean</span> that does just this:</div>
            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.security.MessageDigest</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.FactoryBean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.InitializingBean</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">MessageDigestFactoryBean</span> implements
        FactoryBean&lt;MessageDigest&gt;, InitializingBean {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> algorithmName <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">MD5</span>;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">MessageDigest</span> messageDigest <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">null</span>;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">MessageDigest</span> <span style="color:#0000a2;font-weight:700">getObject</span>() <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Exception</span> {
        <span style="color:#00f;font-weight:700">return</span> messageDigest;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Class&lt;<span style="color:#00f;font-weight:700">MessageDigest</span>&gt;</span> <span style="color:#0000a2;font-weight:700">getObjectType</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">MessageDigest</span><span style="color:#00f;font-weight:700">.</span>class;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">boolean</span> <span style="color:#0000a2;font-weight:700">isSingleton</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#585cf6;font-weight:700">true</span>;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">afterPropertiesSet</span>() <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Exception</span> {
        messageDigest <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">MessageDigest</span><span style="color:#00f;font-weight:700">.</span>getInstance(algorithmName);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setAlgorithmName</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">algorithmName</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>algorithmName <span style="color:#00f;font-weight:700">=</span> algorithmName;
    }
}
</pre>
            <div class="Para" id="Par123">Spring calls the <span class="EmphasisFontCategoryNonProportional">getObject</span>() method to retrieve the object created by the <span class="EmphasisFontCategoryNonProportional">FactoryBean</span>. This is the actual object that is passed
                to other beans that use the <span class="EmphasisFontCategoryNonProportional">FactoryBean</span> as a collaborator. In the code snippet, you can see that <span class="EmphasisFontCategoryNonProportional">MessageDigestFactoryBean</span>                passes a clone of the stored <span class="EmphasisFontCategoryNonProportional">MessageDigest</span> instance that is created in the <span class="EmphasisFontCategoryNonProportional">InitializingBean.afterPropertiesSet()</span> callback.</div>
            <div class="Para" id="Par124">The <span class="EmphasisFontCategoryNonProportional">getObjectType()</span> method allows you to tell Spring what type of object your <span class="EmphasisFontCategoryNonProportional">FactoryBean</span> will return. This can be <span class="EmphasisFontCategoryNonProportional">null</span>                if the return type is unknown in advance (for example, the <span class="EmphasisFontCategoryNonProportional">FactoryBean</span> creates different types of objects depending on the configuration, which will be determined only after the
                <span class="EmphasisFontCategoryNonProportional">FactoryBean</span> is initialized), but if you specify a type, Spring can use it for autowiring purposes. We return <span class="EmphasisFontCategoryNonProportional">MessageDigest</span>                as our type (in this case, a class, but try to return an interface type and have the <span class="EmphasisFontCategoryNonProportional">FactoryBean</span> instantiate the concrete implementation class, unless necessary). The reason is that
                we do not know what concrete type will be returned (not that it matters, because all beans will define their dependencies by using <span class="EmphasisFontCategoryNonProportional">MessageDigest</span> anyway).</div>
        <div class="Para" id="Par125">The <span id="ITerm56">            <span class="EmphasisFontCategoryNonProportional">isSingleton</span>() property </span> allows you to inform Spring whether the <span class="EmphasisFontCategoryNonProportional">FactoryBean</span> is managing
            a singleton instance. Remember that by setting the singleton attribute of the <span class="EmphasisFontCategoryNonProportional">FactoryBean</span>’s <span class="EmphasisFontCategoryNonProportional">&lt;bean&gt;</span> tag, you tell Spring
            about the singleton status of the <span class="EmphasisFontCategoryNonProportional">FactoryBean</span> itself, not the objects it is returning. Now let’s see how the <span class="EmphasisFontCategoryNonProportional">FactoryBean</span> is employed
            in an application. In the following code snippet, you can see a simple bean that maintains two <span class="EmphasisFontCategoryNonProportional">MessageDigest</span> instances and then displays the digests of a message passed to its
            <span class="EmphasisFontCategoryNonProportional">digest()</span> method:</div>
        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.security.MessageDigest</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">MessageDigester</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">MessageDigest</span> digest1;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">MessageDigest</span> digest2;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setDigest1</span>(<span style="color:#00f;font-weight:700">MessageDigest</span> <span style="font-style:italic">digest1</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>digest1 <span style="color:#00f;font-weight:700">=</span> digest1;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setDigest2</span>(<span style="color:#00f;font-weight:700">MessageDigest</span> <span style="font-style:italic">digest2</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>digest2 <span style="color:#00f;font-weight:700">=</span> digest2;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">digest</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">msg</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Using digest1</span>);
        digest(msg, digest1);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Using digest2</span>);
        digest(msg, digest2);
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">digest</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">msg</span>, <span style="color:#00f;font-weight:700">MessageDigest</span> <span style="font-style:italic">digest</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Using alogrithm: </span> <span style="color:#00f;font-weight:700">+</span> digest<span style="color:#00f;font-weight:700">.</span>getAlgorithm());
        digest<span style="color:#00f;font-weight:700">.</span>reset();
        <span style="color:#00f;font-weight:700">byte</span>[] bytes <span style="color:#00f;font-weight:700">=</span> msg<span style="color:#00f;font-weight:700">.</span>getBytes();
        <span style="color:#00f;font-weight:700">byte</span>[] out <span style="color:#00f;font-weight:700">=</span> digest<span style="color:#00f;font-weight:700">.</span>digest(bytes);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(out);
    }
}
</pre>
        <div class="Para" id="Par127">The following configuration snippet shows an example <span id="ITerm58">configuration                                  </span> for two <span class="EmphasisFontCategoryNonProportional">MessageDigestFactoryBean</span> classes, one for the SHA1
            algorithm and the other using the default (MD5) algorithm (<span class="EmphasisFontCategoryNonProportional">app-context-xml.xml</span>):</div>
        <pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">shaDigest</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch4.MessageDigestFactoryBean</span>
        <span style="font-style:italic">p</span>:algorithmName=<span style="color:#036a07">SHA1</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">defaultDigest</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch4.MessageDigestFactoryBean</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">digester</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch4.MessageDigester</span>
        <span style="font-style:italic">p</span>:digest1-ref=<span style="color:#036a07">shaDigest</span>
        <span style="font-style:italic">p</span>:digest2-ref=<span style="color:#036a07">defaultDigest</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
        <div class="Para" id="Par129">As you can see, not only we have configured the two <span class="EmphasisFontCategoryNonProportional">MessageDigestFactoryBean</span> classes, but we have also configured a <span class="EmphasisFontCategoryNonProportional">MessageDigester</span>,
            using the two <span class="EmphasisFontCategoryNonProportional">MessageDigestFactoryBean</span> classes, to provide values for the <span class="EmphasisFontCategoryNonProportional">digest1</span> and <span class="EmphasisFontCategoryNonProportional">digest2</span>            properties. For the <span class="EmphasisFontCategoryNonProportional">defaultDigest</span> bean, since the <span class="EmphasisFontCategoryNonProportional">algorithmName</span> property was not specified, no injection will happen, and the
            default algorithm (MD5) that was coded in the class will be used. In the following code sample, you see a basic example class that retrieves the <span class="EmphasisFontCategoryNonProportional">MessageDigester</span> bean from the <span class="EmphasisFontCategoryNonProportional">BeanFactory</span>            and creates the digest of a simple message:</div>
        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">MessageDigestDemo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-xml.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">MessageDigester</span> digester <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">digester</span>,
                <span style="color:#00f;font-weight:700">MessageDigester</span><span style="color:#00f;font-weight:700">.</span>class);
        digester<span style="color:#00f;font-weight:700">.</span>digest(<span style="color:#036a07">Hello World!</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
        <div class="Para" id="Par131">Running this example gives the following output:</div>
        <div class="Para" id="Par132">
            <div class="ProgramCode" id="PC38">
                <div class="FixedLine">Using digest1</div>
                <div class="FixedLine">Using alogrithm: SHA1</div>
                <div class="FixedLine">[B@<span id="ITerm59">130f889                                              </span> </div>
                <div class="FixedLine">Using digest2</div>
                <div class="FixedLine">Using alogrithm: MD5</div>
                <div class="FixedLine">[B@1188e820</div>
            </div>
        </div>
        <div class="Para" id="Par133">As you can see, the <span class="EmphasisFontCategoryNonProportional">MessageDigest</span> bean is provided with two <span class="EmphasisFontCategoryNonProportional">MessageDigest</span> implementations, <span class="EmphasisFontCategoryNonProportional">SHA1</span>            and <span class="EmphasisFontCategoryNonProportional">MD5</span>, even though no <span class="EmphasisFontCategoryNonProportional">MessageDigest</span> beans are configured in the <span class="EmphasisFontCategoryNonProportional">BeanFactory</span>.
            This is the <span class="EmphasisFontCategoryNonProportional">FactoryBean</span> at work.</div>
        <div class="Para" id="Par134"> <span class="EmphasisFontCategoryNonProportional">FactoryBean</span>s are the perfect solution when you are working with classes that cannot be created by using the <span class="EmphasisFontCategoryNonProportional">new</span> operator. If you
            work with objects that are created by using a factory method and you want to use these classes in a Spring application, create a <span class="EmphasisFontCategoryNonProportional">FactoryBean</span> to act as an adapter, allowing your classes
            to take full advantage of Spring’s IoC capabilities.</div>
        <div class="Para" id="Par135">Using <span class="EmphasisFontCategoryNonProportional">FactoryBean</span>s is different when configuration via Java configuration is used, because in this case there is a restriction from the compiler to set the property with the proper type;
            thus, the <span class="EmphasisFontCategoryNonProportional">getObject()</span> method must be called explicitly. In the following code snippet, you can see an example of configuring the same beans as in the previous example, but using
            <span id="ITerm60">Java configuration </span>:</div>
        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.config</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.MessageDigestFactoryBean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.MessageDigester</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.AnnotationConfigApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Bean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Configuration</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">MessageDigesterConfigDemo</span> {
    <span style="color:#00f;font-weight:700">@Configuration</span>
    <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">MessageDigesterConfig</span> {
        <span style="color:#00f;font-weight:700">@Bean</span>
        <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">MessageDigestFactoryBean</span> <span style="color:#0000a2;font-weight:700">shaDigest</span>() {
            <span style="color:#00f;font-weight:700">MessageDigestFactoryBean</span> factoryOne <span style="color:#00f;font-weight:700">=</span>
                    <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">MessageDigestFactoryBean</span>();
            factoryOne<span style="color:#00f;font-weight:700">.</span>setAlgorithmName(<span style="color:#036a07">SHA1</span>);
            <span style="color:#00f;font-weight:700">return</span> factoryOne;
        }

        <span style="color:#00f;font-weight:700">@Bean</span>
        <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">MessageDigestFactoryBean</span> <span style="color:#0000a2;font-weight:700">defaultDigest</span>() {
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">MessageDigestFactoryBean</span>();
        }

        <span style="color:#00f;font-weight:700">@Bean</span>
        <span style="color:#00f;font-weight:700">MessageDigester</span> <span style="color:#0000a2;font-weight:700">digester</span>() <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Exception</span> {
            <span style="color:#00f;font-weight:700">MessageDigester</span> messageDigester <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">MessageDigester</span>();
            messageDigester<span style="color:#00f;font-weight:700">.</span>setDigest1(shaDigest()<span style="color:#00f;font-weight:700">.</span>getObject());
            messageDigester<span style="color:#00f;font-weight:700">.</span>setDigest2(defaultDigest()<span style="color:#00f;font-weight:700">.</span>getObject());
            <span style="color:#00f;font-weight:700">return</span> messageDigester;
        }
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">MessageDigesterConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">MessageDigester</span> digester <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">MessageDigester</span>) ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">digester</span>);
        digester<span style="color:#00f;font-weight:700">.</span>digest(<span style="color:#036a07">Hello World!</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
        <div class="Para" id="Par137">If you run this class, the same output as before is printed.</div>
    </div>
    </div>
    <div class="Section1 RenderAsSection1" id="Sec21">
        <h2 class="Heading"> <span id="ITerm62">Accessing                  </span> a FactoryBean Directly</h2>
        <div class="Para" id="Par138">Given that Spring automatically satisfies any references to a <span class="EmphasisFontCategoryNonProportional">FactoryBean</span> by the objects produced by that <span class="EmphasisFontCategoryNonProportional">FactoryBean</span>, you may be
            wondering whether you can actually access the <span class="EmphasisFontCategoryNonProportional">FactoryBean</span> directly. The answer is yes.</div>
        <div class="Para" id="Par139">Accessing <span class="EmphasisFontCategoryNonProportional">FactoryBean</span> is simple: you prefix the bean name with an ampersand in the call to <span class="EmphasisFontCategoryNonProportional">getBean()</span>, as shown in the following code
            sample:</div>
        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.security.MessageDigest</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AccessingFactoryBeans</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-xml.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">shaDigest</span>, <span style="color:#00f;font-weight:700">MessageDigest</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">MessageDigestFactoryBean</span> factoryBean <span style="color:#00f;font-weight:700">=</span>
                (<span style="color:#00f;font-weight:700">MessageDigestFactoryBean</span>) ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">&amp;shaDigest</span>);
        <span style="color:#00f;font-weight:700">try</span> {
            <span style="color:#00f;font-weight:700">MessageDigest</span> shaDigest <span style="color:#00f;font-weight:700">=</span> factoryBean<span style="color:#00f;font-weight:700">.</span>getObject();
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(shaDigest<span style="color:#00f;font-weight:700">.</span>digest(<span style="color:#036a07">Hello world</span><span style="color:#00f;font-weight:700">.</span>getBytes()));
        } <span style="color:#00f;font-weight:700">catch</span> (<span style="color:#00f;font-weight:700">Exception</span> ex) {
            ex<span style="color:#00f;font-weight:700">.</span>printStackTrace();
        }
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
    <div class="Para" id="Par141">Running this program generates the following output:</div>
    <div class="Para" id="Par142">
        <div class="ProgramCode" id="PC41">
            <div class="FixedLine">[B@130f889</div>
        </div>
    </div>
    <div class="Para" id="Par143">This feature is used in a few places in the Spring code, but your application should really have no reason to use it. The intention of <span class="EmphasisFontCategoryNonProportional">FactoryBean</span> is to be used as a piece of supporting infrastructure
        to allow you to use more of your application’s classes in an IoC setting. Avoid accessing <span class="EmphasisFontCategoryNonProportional">FactoryBean</span> directly and invoking its <span class="EmphasisFontCategoryNonProportional">getObject()</span>        manually, and let Spring do it for you; if you do this manually, you are making extra work for yourself and are unnecessarily coupling your application to a specific implementation detail that could quite easily change in the <span id="ITerm63">future                  </span>.</div>
    </div>
    <div class="Section1 RenderAsSection1 SectionTypeMaterialsAndMethods" id="Sec22">
        <h2 class="Heading">Using the factory-bean and factory-method Attributes</h2>
        <div class="Para" id="Par144">Sometimes you need to instantiate JavaBeans that were provided by a non-Spring-powered third-party application. You don’t know how to instantiate that class, but you know that the third-party application provides a class that can be used to get
            an instance of the JavaBean that your Spring application needs. In this case, Spring bean’s <span class="EmphasisFontCategoryNonProportional">factory-bean</span> and <span id="ITerm64">          <span class="EmphasisFontCategoryNonProportional">factory-method</span>            attributes </span> <span id="ITerm65">                                        </span> in the <span class="EmphasisFontCategoryNonProportional">&lt;bean&gt;</span> tag can be used.</div>
        <div class="Para" id="Par145">To take a look at how it works, the following code snippet shows another version of the <span class="EmphasisFontCategoryNonProportional">MessageDigestFactory</span> that provides a method to return a <span class="EmphasisFontCategoryNonProportional">MessageDigest</span>            bean:</div>
        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.security.MessageDigest</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">MessageDigestFactory</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> algorithmName <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">MD5</span>;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">MessageDigest</span> <span style="color:#0000a2;font-weight:700">createInstance</span>() <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Exception</span> {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">MessageDigest</span><span style="color:#00f;font-weight:700">.</span>getInstance(algorithmName);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setAlgorithmName</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">algorithmName</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>algorithmName <span style="color:#00f;font-weight:700">=</span> algorithmName;
    }
}
</pre>
        <div class="Para" id="Par147">The following configuration snippet shows how to configure the factory method for getting the corresponding <span class="EmphasisFontCategoryNonProportional">MessageDigest</span> bean instance (<span class="EmphasisFontCategoryNonProportional">app-context-xml.xml</span>):</div>
        <pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span>...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">shaDigestFactory</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch4.MessageDigestFactory</span>
        <span style="font-style:italic">p</span>:algorithmName=<span style="color:#036a07">SHA1</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">defaultDigestFactory</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch4.MessageDigestFactory</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">shaDigest</span>
          <span style="font-style:italic">factory-bean</span>=<span style="color:#036a07">shaDigestFactory</span>
          <span style="font-style:italic">factory-method</span>=<span style="color:#036a07">createInstance</span>&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">bean</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">defaultDigest</span>
          <span style="font-style:italic">factory-bean</span>=<span style="color:#036a07">defaultDigestFactory</span>
          <span style="font-style:italic">factory-method</span>=<span style="color:#036a07">createInstance</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">digester</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch4.MessageDigester</span>
        <span style="font-style:italic">p</span>:digest1-ref=<span style="color:#036a07">shaDigest</span>
        <span style="font-style:italic">p</span>:digest2-ref=<span style="color:#036a07">defaultDigest</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
    <div class="Para" id="Par149">Notice that two digest factory beans were defined, one using SHA1 and the other using the default algorithm. Then for the beans <span class="EmphasisFontCategoryNonProportional">shaDigest</span> and <span class="EmphasisFontCategoryNonProportional">defaultDigest</span>,
        we instructed Spring to instantiate the beans by using the corresponding message digest factory bean via the <span class="EmphasisFontCategoryNonProportional">factory-bean</span> attribute, and we specified the method to use to obtain the bean
        instance via the <span class="EmphasisFontCategoryNonProportional">factory-method</span> attribute. The following code snippet depicts the testing class:</div>
    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">MessageDigestFactoryDemo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-xml.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">MessageDigester</span> digester <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">digester</span>,
                <span style="color:#00f;font-weight:700">MessageDigester</span><span style="color:#00f;font-weight:700">.</span>class);
        digester<span style="color:#00f;font-weight:700">.</span>digest(<span style="color:#036a07">Hello World!</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
    <div class="Para" id="Par151">Running the program generates the following output:</div>
    <div class="Para" id="Par152">
        <div class="ProgramCode" id="PC45">
            <div class="FixedLine">Using digest1</div>
            <div class="FixedLine">Using alogrithm: SHA1 [B@77a57272</div>
            <div class="FixedLine">Using digest2</div>
            <div class="FixedLine">Using alogrithm: MD5 [B@<span id="ITerm68">7181ae3f            </span> <span id="ITerm69">                                                    </span> </div>
        </div>
    </div>
    </div>
    <div class="Section1 RenderAsSection1" id="Sec23">
        <h2 class="Heading">JavaBeans PropertyEditors</h2>
        <div class="Para" id="Par153">If you are not entirely familiar with JavaBeans concepts, a <span class="EmphasisFontCategoryNonProportional">PropertyEditor</span> is an interface that converts a property’s value to and from its native type representation into a <span class="EmphasisFontCategoryNonProportional">String</span>.
            Originally, this was conceived as a way to allow property values to be entered, as <span class="EmphasisFontCategoryNonProportional">String</span> values, into an editor and have them transformed into the correct type. However, because
            <span class="EmphasisFontCategoryNonProportional">PropertyEditor</span>s are inherently lightweight classes, they have found uses in many settings, including Spring.</div>
        <div class="Para" id="Par154">Because a good portion of property values in a Spring-based application start life in the <span class="EmphasisFontCategoryNonProportional">BeanFactory</span> configuration file, they are essentially <span class="EmphasisFontCategoryNonProportional">String</span>s.
            However, the property that these values are set on may not be <span class="EmphasisFontCategoryNonProportional">String</span>-typed. So, to save you from having to create a load of <span class="EmphasisFontCategoryNonProportional">String</span>-typed
            properties artificially, Spring allows you to define <span class="EmphasisFontCategoryNonProportional">PropertyEditor</span>s to manage the conversion of <span class="EmphasisFontCategoryNonProportional">String</span>-based property values
            into the correct types. Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Chapter.html#Fig2">4-2</a></span> shows the full list of <span class="EmphasisFontCategoryNonProportional">PropertyEditor</span>s
            that are part of the <span id="ITerm70">              <span class="EmphasisFontCategoryNonProportional">spring-beans</span> </span> package; you can see this list with any smart Java editor.
            <div class="Figure" id="Fig2">
                <div class="MediaObject" id="MO2"><img alt="A315511_5_En_4_Fig2_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Fig2_HTML.jpg" height="550" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Fig2_HTML.jpg" width="360"/></div>
                <div class="Caption" xml:lang="en">
                    <div class="CaptionContent"><span class="CaptionNumber">Figure 4-2.</span>
                        <div class="SimplePara">Spring <span id="ITerm71">PropertyEditors                                  </span> </div>
                    </div>
            </div>
        </div>
    </div>
    <div class="Para" id="Par155">They all extend <span class="EmphasisFontCategoryNonProportional">java.beans.PropertyEditorSupport</span> and can be used for implicit conversion of <span class="EmphasisFontCategoryNonProportional">String</span> literals into property values to be
        injected in beans; thus, they are preregistered with <span class="EmphasisFontCategoryNonProportional">BeanFactory</span>.</div>
    <div class="Section2 RenderAsSection2" id="Sec24">
        <h3 class="Heading">Using the Built-in PropertyEditors</h3>
        <div class="Para" id="Par156">The following code snippet shows a simple bean that declares 14 properties, one for each of the types supported by the built-in <span class="EmphasisFontCategoryNonProportional">PropertyEditor</span> <span id="ITerm72">implementations                      </span>:</div>
        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.io.File</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.io.InputStream</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.net.URL</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.*</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.regex.Pattern</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.text.SimpleDateFormat</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.PropertyEditorRegistrar</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.PropertyEditorRegistry</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.propertyeditors.CustomDateEditor</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.propertyeditors.StringTrimmerEditor</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">PropertyEditorBean</span> {
)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">byte</span>[] bytes;                <span style="color:#06f;font-style:italic">// ByteArrayPropertyEditor</span>
)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Character</span> character;         <span style="color:#06f;font-style:italic">//CharacterEditor</span>
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Class</span> cls;                   <span style="color:#06f;font-style:italic">// ClassEditor</span>
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Boolean</span> trueOrFalse;         <span style="color:#06f;font-style:italic">// CustomBooleanEditor</span>
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">String</span>&gt;</span> stringList;     <span style="color:#06f;font-style:italic">// CustomCollectionEditor</span>
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Date</span> date;                   <span style="color:#06f;font-style:italic">// CustomDateEditor</span>
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Float</span> floatValue;            <span style="color:#06f;font-style:italic">// CustomNumberEditor</span>
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">File</span> file;                   <span style="color:#06f;font-style:italic">// FileEditor</span>
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">InputStream</span> stream;          <span style="color:#06f;font-style:italic">// InputStreamEditor</span>
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Locale</span> locale;               <span style="color:#06f;font-style:italic">// LocaleEditor</span>
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Pattern</span> pattern;             <span style="color:#06f;font-style:italic">// PatternEditor</span>
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Properties</span> properties;       <span style="color:#06f;font-style:italic">// PropertiesEditor</span>
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> trimString;           <span style="color:#06f;font-style:italic">// StringTrimmerEditor</span>
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#c5060b;font-weight:700">URL</span> url;                     <span style="color:#06f;font-style:italic">// URLEditor</span>

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setCharacter</span>(<span style="color:#00f;font-weight:700">Character</span> <span style="font-style:italic">character</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Setting character: </span> <span style="color:#00f;font-weight:700">+</span> character);
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>character <span style="color:#00f;font-weight:700">=</span> character;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setCls</span>(<span style="color:#00f;font-weight:700">Class</span> <span style="font-style:italic">cls</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Setting class: </span> <span style="color:#00f;font-weight:700">+</span> cls<span style="color:#00f;font-weight:700">.</span>getName());
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>cls <span style="color:#00f;font-weight:700">=</span> cls;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setFile</span>(<span style="color:#00f;font-weight:700">File</span> <span style="font-style:italic">file</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Setting file: </span> <span style="color:#00f;font-weight:700">+</span> file<span style="color:#00f;font-weight:700">.</span>getName());
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>file <span style="color:#00f;font-weight:700">=</span> file;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setLocale</span>(<span style="color:#00f;font-weight:700">Locale</span> <span style="font-style:italic">locale</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Setting locale: </span> <span style="color:#00f;font-weight:700">+</span> locale<span style="color:#00f;font-weight:700">.</span>getDisplayName());
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>locale <span style="color:#00f;font-weight:700">=</span> locale;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setProperties</span>(<span style="color:#00f;font-weight:700">Properties</span> <span style="font-style:italic">properties</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Loaded </span> <span style="color:#00f;font-weight:700">+</span> properties<span style="color:#00f;font-weight:700">.</span>size() <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07"> properties</span>);
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>properties <span style="color:#00f;font-weight:700">=</span> properties;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setUrl</span>(<span style="color:#00f;font-weight:700">URL</span> <span style="font-style:italic">url</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Setting URL: </span> <span style="color:#00f;font-weight:700">+</span> url<span style="color:#00f;font-weight:700">.</span>toExternalForm());
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>url <span style="color:#00f;font-weight:700">=</span> url;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setBytes</span>(<span style="color:#00f;font-weight:700">byte</span>... <span style="font-style:italic">bytes</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Setting bytes: </span> <span style="color:#00f;font-weight:700">+</span> <span style="color:#00f;font-weight:700">Arrays</span><span style="color:#00f;font-weight:700">.</span>toString(bytes));
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>bytes <span style="color:#00f;font-weight:700">=</span> bytes;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setTrueOrFalse</span>(<span style="color:#00f;font-weight:700">Boolean</span> <span style="font-style:italic">trueOrFalse</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Setting Boolean: </span> <span style="color:#00f;font-weight:700">+</span> trueOrFalse);
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>trueOrFalse <span style="color:#00f;font-weight:700">=</span> trueOrFalse;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setStringList</span>(<span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">String</span>&gt;</span> <span style="font-style:italic">stringList</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Setting string list with size: </span>
                <span style="color:#00f;font-weight:700">+</span> stringList<span style="color:#00f;font-weight:700">.</span>size());
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>stringList <span style="color:#00f;font-weight:700">=</span> stringList;
        <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">String</span> string <span style="color:#00f;font-weight:700">:</span> stringList) {
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">String member: </span> <span style="color:#00f;font-weight:700">+</span> string);
        }
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setDate</span>(<span style="color:#00f;font-weight:700">Date</span> <span style="font-style:italic">date</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Setting date: </span> <span style="color:#00f;font-weight:700">+</span> date);
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>date <span style="color:#00f;font-weight:700">=</span> date;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setFloatValue</span>(<span style="color:#00f;font-weight:700">Float</span> <span style="font-style:italic">floatValue</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Setting float value: </span> <span style="color:#00f;font-weight:700">+</span> floatValue);
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>floatValue <span style="color:#00f;font-weight:700">=</span> floatValue;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setStream</span>(<span style="color:#00f;font-weight:700">InputStream</span> <span style="font-style:italic">stream</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Setting stream: </span> <span style="color:#00f;font-weight:700">+</span> stream);
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>stream <span style="color:#00f;font-weight:700">=</span> stream;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setPattern</span>(<span style="color:#00f;font-weight:700">Pattern</span> <span style="font-style:italic">pattern</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Setting pattern: </span> <span style="color:#00f;font-weight:700">+</span> pattern);
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>pattern <span style="color:#00f;font-weight:700">=</span> pattern;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setTrimString</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">trimString</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Setting trim string: </span> <span style="color:#00f;font-weight:700">+</span> trimString);
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>trimString <span style="color:#00f;font-weight:700">=</span> trimString;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">CustomPropertyEditorRegistrar</span>
            <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">PropertyEditorRegistrar</span> {
        <span style="color:#00f;font-weight:700">@Override</span>
        <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">registerCustomEditors</span>(<span style="color:#00f;font-weight:700">PropertyEditorRegistry</span> <span style="font-style:italic">registry</span>) {
            <span style="color:#00f;font-weight:700">SimpleDateFormat</span> dateFormatter <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SimpleDateFormat</span>(<span style="color:#036a07">MM/dd/yyyy</span>);
            registry<span style="color:#00f;font-weight:700">.</span>registerCustomEditor(<span style="color:#00f;font-weight:700">Date</span><span style="color:#00f;font-weight:700">.</span>class,
                    <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">CustomDateEditor</span>(dateFormatter, <span style="color:#585cf6;font-weight:700">true</span>));
            registry<span style="color:#00f;font-weight:700">.</span>registerCustomEditor(<span style="color:#00f;font-weight:700">String</span><span style="color:#00f;font-weight:700">.</span>class, <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">StringTrimmerEditor</span>(<span style="color:#585cf6;font-weight:700">true</span>));
        }
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Exception</span> {
        <span style="color:#00f;font-weight:700">File</span> file <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">File</span><span style="color:#00f;font-weight:700">.</span>createTempFile(<span style="color:#036a07">test</span>, <span style="color:#036a07">txt</span>);
        file<span style="color:#00f;font-weight:700">.</span>deleteOnExit();
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-01.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">PropertyEditorBean</span> bean <span style="color:#00f;font-weight:700">=</span>
                (<span style="color:#00f;font-weight:700">PropertyEditorBean</span>) ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">builtInSample</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
    <div class="Para" id="Par158">In the following <span id="ITerm76">configuration                      </span> sample, you can see the configuration used to declare a bean of type <span class="EmphasisFontCategoryNonProportional">PropertyEditorBean</span> with values being specified
        for all the previous properties (<span class="EmphasisFontCategoryNonProportional">app-config-01.xml</span>):</div>
    <pre style="background:#fff;color:#000"><span style="color:#68685b">&lt;?<span style="color:#888">xml</span><span style="color:#888"> version</span>=<span style="color:#888">1.0</span><span style="color:#888"> encoding</span>=<span style="color:#888">UTF-8</span>?&gt;</span>
<span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> <span style="font-style:italic">xmlns</span>=<span style="color:#036a07">http://www.springframework.org/schema/beans</span>
    <span style="font-style:italic">xmlns</span>:xsi=<span style="color:#036a07">http://www.w3.org/2001/XMLSchema-instance</span>
    <span style="font-style:italic">xmlns</span>:util=<span style="color:#036a07">http://www.springframework.org/schema/util</span>
    <span style="font-style:italic">xmlns</span>:p=<span style="color:#036a07">http://www.springframework.org/schema/p</span>
    <span style="font-style:italic">xsi</span>:schemaLocation=<span style="color:#036a07">http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/util
        http://www.springframework.org/schema/util/spring-util.xsd</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">customEditorConfigurer</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">org.springframework.beans.factory.config.CustomEditorConfigurer</span>
        <span style="font-style:italic">p</span>:propertyEditorRegistrars-ref=<span style="color:#036a07">propertyEditorRegistrarsList</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">util</span><span style="font-weight:700">:</span><span style="font-weight:700">list</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">propertyEditorRegistrarsList</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch4.PropertyEditorBean$
              CustomPropertyEditorRegistrar</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">util</span><span style="font-weight:700">:</span><span style="font-weight:700">list</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">builtInSample</span>
          <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch4.PropertyEditorBean</span>
        <span style="font-style:italic">p</span>:character=<span style="color:#036a07">A</span>
        <span style="font-style:italic">p</span>:bytes=<span style="color:#036a07">John Mayer</span>
        <span style="font-style:italic">p</span>:cls=<span style="color:#036a07">java.lang.String</span>
        <span style="font-style:italic">p</span>:trueOrFalse=<span style="color:#036a07">true</span>
        <span style="font-style:italic">p</span>:stringList-ref=<span style="color:#036a07">stringList</span>
        <span style="font-style:italic">p</span>:stream=<span style="color:#036a07">test.txt</span>
        <span style="font-style:italic">p</span>:floatValue=<span style="color:#036a07">123.45678</span>
        <span style="font-style:italic">p</span>:date=<span style="color:#036a07">05/03/13</span>
          <span style="font-style:italic">p</span>:file=<span style="color:#036a07">#{systemProperties&apos;java.io.tmpdir&apos;}
                      #{systemProperties&apos;file.separator&apos;}test.txt</span>
        <span style="font-style:italic">p</span>:locale=<span style="color:#036a07">en_US</span>
        <span style="font-style:italic">p</span>:pattern=<span style="color:#036a07">a*b</span>
        <span style="font-style:italic">p</span>:properties=<span style="color:#036a07">name=Chris age=32</span>
        <span style="font-style:italic">p</span>:trimString=<span style="color:#036a07">   String need trimming   </span>
        <span style="font-style:italic">p</span>:url=<span style="color:#036a07">https://spring.io/</span>
    /&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">util</span><span style="font-weight:700">:</span><span style="font-weight:700">list</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">stringList</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">value</span>&gt;</span>String member 1<span style="color:#1c02ff">&lt;/<span style="font-weight:700">value</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">value</span>&gt;</span>String member 2<span style="color:#1c02ff">&lt;/<span style="font-weight:700">value</span>&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">util</span><span style="font-weight:700">:</span><span style="font-weight:700">list</span>&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
    <div class="Para" id="Par160">As you can see, although all the properties on the <span class="EmphasisFontCategoryNonProportional">PropertyEditorBean</span> are not <span class="EmphasisFontCategoryNonProportional">String</span>s, the values for the properties are specified as
        simple <span class="EmphasisFontCategoryNonProportional">String</span>s. Also note that we registered the <span class="EmphasisFontCategoryNonProportional">CustomDateEditor</span> and <span class="EmphasisFontCategoryNonProportional">StringTrimmerEditor</span>,
        since those two editors were not registered by default in Spring. Running this example yields the following output:</div>
    <div class="Para" id="Par161">
        <div class="ProgramCode" id="PC48">
            <div class="FixedLine">Setting bytes: [74, 111, 104, 110, 32, 77, 97, 121, 101, 114]</div>
            <div class="FixedLine">Setting character: A</div>
            <div class="FixedLine">Setting class: java.lang.String</div>
            <div class="FixedLine">Setting date: Wed May 03  00:00:00 EET 13</div>
            <div class="FixedLine">Setting file: test.txt</div>
            <div class="FixedLine">Setting float value: 123.45678</div>
            <div class="FixedLine">Setting locale: English (United States)</div>
            <div class="FixedLine">Setting pattern: a*b</div>
            <div class="FixedLine">Loaded 1 properties</div>
            <div class="FixedLine">Setting stream: java.io.BufferedInputStream@42e25b0b</div>
            <div class="FixedLine">Setting string list with size: 2</div>
            <div class="FixedLine">String member: String member 1</div>
            <div class="FixedLine">String member: String member 2</div>
            <div class="FixedLine">Setting trim string: String need trimming</div>
            <div class="FixedLine">Setting Boolean: true</div>
            <div class="FixedLine">Setting URL: https://spring.io/</div>
        </div>
    </div>
    <div class="Para" id="Par162">As you can see, Spring has, using the built-in <span class="EmphasisFontCategoryNonProportional">PropertyEditor</span>s, converted the <span id="ITerm78">                <span class="EmphasisFontCategoryNonProportional">String</span> </span> representations
        of the various properties to the correct types. Table <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Chapter.html#Tab1">4-1</a></span> lists the most important built-in
        <span class="EmphasisFontCategoryNonProportional">PropertyEditor</span>s available in Spring.
            <div class="Table" id="Tab1">
                <div class="Caption" xml:lang="en">
                    <div class="CaptionContent"><span class="CaptionNumber">Table 4-1.</span>
                        <div class="SimplePara">Spring PropertyEditors</div>
                    </div>
                </div>
                <table border="1">
                    <colgroup>
                        <col>
                        <col>
                    </colgroup>
                    <thead>
                        <tr class="header">
                            <th>
                                <div class="SimplePara">PropertyEditor</div>
                            </th>
                            <th>
                                <div class="SimplePara">Description</div>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="noclass">
                            <td>
                                <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">ByteArrayPropertyEditor</span> </div>
                            </td>
                            <td>
                                <div class="SimplePara">Converts <span class="EmphasisFontCategoryNonProportional">String</span> values to their corresponding byte representations.</div>
                            </td>
                        </tr>
                        <tr class="noclass">
                            <td>
                                <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">CharacterEditor</span> </div>
                            </td>
                            <td>
                                <div class="SimplePara">Populates a property of type <span class="EmphasisFontCategoryNonProportional">Character</span> or <span class="EmphasisFontCategoryNonProportional">char</span> from a <span class="EmphasisFontCategoryNonProportional">String</span>                                    value.</div>
                            </td>
                        </tr>
                        <tr class="noclass">
                            <td>
                                <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">ClassEditor</span> </div>
                            </td>
                            <td>
                                <div class="SimplePara">Converts from a fully qualified class name into a <span class="EmphasisFontCategoryNonProportional">Class</span> instance. When using this <span class="EmphasisFontCategoryNonProportional">PropertyEditor</span>, be careful
                                    not to include any extraneous spaces on either side of the class name when using <span class="EmphasisFontCategoryNonProportional">GenericXmlApplicationContext</span> because this results in a <span class="EmphasisFontCategoryNonProportional">ClassNotFoundException</span>.</div>
                            </td>
                        </tr>
                        <tr class="noclass">
                            <td>
                                <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">CustomBooleanEditor</span> </div>
                            </td>
                            <td>
                                <div class="SimplePara">Converts a string into a Java Boolean type.</div>
                            </td>
                        </tr>
                        <tr class="noclass">
                            <td>
                                <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">CustomCollectionEditor</span> </div>
                            </td>
                            <td>
                                <div class="SimplePara">Converts a source collection (e.g., represented by the <span class="EmphasisFontCategoryNonProportional">util</span> namespace in <span class="EmphasisFontCategoryNonProportional">Spring</span>) into the target <span class="EmphasisFontCategoryNonProportional">Collection</span>                                    type.</div>
                            </td>
                        </tr>
                        <tr class="noclass">
                            <td>
                                <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">CustomDateEditor</span> </div>
                            </td>
                            <td>
                                <div class="SimplePara">Converts a string representation of a date into a <span class="EmphasisFontCategoryNonProportional">java.util.Date</span> value. You need to register the <span class="EmphasisFontCategoryNonProportional">CustomDateEditor</span>                                    implementation in Spring’s <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> with the desired date format.</div>
                            </td>
                        </tr>
                        <tr class="noclass">
                            <td>
                                <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">FileEditor</span> </div>
                            </td>
                            <td>
                                <div class="SimplePara">Converts a <span class="EmphasisFontCategoryNonProportional">String</span> file path into a <span class="EmphasisFontCategoryNonProportional">File</span> instance. Spring does not check whether the file exists.</div>
                            </td>
                        </tr>
                        <tr class="noclass">
                            <td>
                                <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">InputStreamEditor</span> </div>
                            </td>
                            <td>
                                <div class="SimplePara">Converts a string representation of a resource (e.g., file resource using <span class="EmphasisFontCategoryNonProportional">file:D:/temp/test.txt or classpath:test.txt</span>) into an input stream property.</div>
                            </td>
                        </tr>
                        <tr class="noclass">
                            <td>
                                <div class="SimplePara"> <span id="ITerm79">                            <span class="EmphasisFontCategoryNonProportional">LocaleEditor</span> </span>
                                </div>
                            </td>
                            <td>
                                <div class="SimplePara">Converts the <span class="EmphasisFontCategoryNonProportional">String</span> representation of a locale, such as <span class="EmphasisFontCategoryNonProportional">en-GB</span>, into a <span class="EmphasisFontCategoryNonProportional">java.util.Locale</span>                                    instance.</div>
                            </td>
                        </tr>
                        <tr class="noclass">
                            <td>
                                <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">PatternEditor</span> </div>
                            </td>
                            <td>
                                <div class="SimplePara">Converts a string into the JDK <span class="EmphasisFontCategoryNonProportional">Pattern</span> object or the other way around.</div>
                            </td>
                        </tr>
                        <tr class="noclass">
                            <td>
                                <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">PropertiesEditor</span> </div>
                            </td>
                            <td>
                                <div class="SimplePara">Converts a <span class="EmphasisFontCategoryNonProportional">String</span> in the format <span class="EmphasisFontCategoryNonProportional">key1=value1 key2=value2 keyn=valuen</span> into an instance of <span class="EmphasisFontCategoryNonProportional">java.util.Properties</span>                                    with the corresponding properties configured.</div>
                            </td>
                        </tr>
                        <tr class="noclass">
                            <td>
                                <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">StringTrimmerEditor</span> </div>
                            </td>
                            <td>
                                <div class="SimplePara">Performs trimming on the string values before injection. You need to explicitly register this editor.</div>
                            </td>
                        </tr>
                        <tr class="noclass">
                            <td>
                                <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">URLEditor</span> </div>
                            </td>
                            <td>
                                <div class="SimplePara">Converts a <span class="EmphasisFontCategoryNonProportional">String</span> representation of a URL into an instance of <span class="EmphasisFontCategoryNonProportional">java.net.URL</span>.</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
    </div>
    <div class="Para ParaOneEmphasisChild" id="Par163">This set of <span class="EmphasisFontCategoryNonProportional">PropertyEditor</span>s provides a good base for working with Spring and makes configuring your application with common components such as files and URLs much simpler.</div>
    </div>
    <div class="Section2 RenderAsSection2" id="Sec25">
        <h3 class="Heading">Creating a <span id="ITerm80">Custom PropertyEditor                      </span> </h3>
        <div class="Para" id="Par164">Although the built-in <span class="EmphasisFontCategoryNonProportional">PropertyEditor</span>s cover some of the standard cases of property type conversion, there may come a time when you need to create your own <span class="EmphasisFontCategoryNonProportional">PropertyEditor</span>            to support a class or a set of classes you are using in your application. Spring has full support for registering custom <span class="EmphasisFontCategoryNonProportional">PropertyEditor</span>s; the only downside is that the <span class="EmphasisFontCategoryNonProportional">java.beans.PropertyEditor</span>            interface has a lot of methods, many of which are irrelevant to the task at hand, which is converting property types. Thankfully, JDK 5 or newer provides the <span class="EmphasisFontCategoryNonProportional">PropertyEditorSupport</span> class,
            which your own <span class="EmphasisFontCategoryNonProportional">PropertyEditor</span>s can extend, leaving you to implement only a single method: <span class="EmphasisFontCategoryNonProportional">setAsText()</span>. Let’s consider a simple
            example to see implementing a custom property editor in action. Suppose we have a <span class="EmphasisFontCategoryNonProportional">FullName</span> class with just two properties, <span class="EmphasisFontCategoryNonProportional">firstName</span>            and <span class="EmphasisFontCategoryNonProportional">lastName</span>, defined as shown here:</div>
        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.custom</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">FullName</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> firstName;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> lastName;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">FullName</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">firstName</span>, <span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">lastName</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>firstName <span style="color:#00f;font-weight:700">=</span> firstName;
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>lastName <span style="color:#00f;font-weight:700">=</span> lastName;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getFirstName</span>() {
        <span style="color:#00f;font-weight:700">return</span> firstName;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setFirstName</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">firstName</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>firstName <span style="color:#00f;font-weight:700">=</span> firstName;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getLastName</span>() {
        <span style="color:#00f;font-weight:700">return</span> lastName;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setLastName</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">lastName</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>lastName <span style="color:#00f;font-weight:700">=</span> lastName;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">toString</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">First name: </span> <span style="color:#00f;font-weight:700">+</span> firstName <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07"> - Last name: </span> <span style="color:#00f;font-weight:700">+</span> lastName;
    }
}
</pre>
        <div class="Para ParaOneEmphasisChild" id="Par166">To simplify the application configuration, let’s develop a custom editor that converts a string with a space separator into the <span class="EmphasisFontCategoryNonProportional">FullName</span> class’s first name and last name, respectively. The
            following code snippet depicts the custom property editor implementation:</div>
        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.custom</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.beans.PropertyEditorSupport</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">NamePropertyEditor</span> <span style="color:#00f;font-weight:700">extends</span> <span style="font-style:italic">PropertyEditorSupport</span> {
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setAsText</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">text</span>) <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">IllegalArgumentException</span> {
        <span style="color:#00f;font-weight:700">String</span>[] name <span style="color:#00f;font-weight:700">=</span> text<span style="color:#00f;font-weight:700">.</span>split(<span style="color:#036a07">&quot;<span style="color:#26b31a">\\</span>s&quot;</span>);
        setValue(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">FullName</span>(name[<span style="color:#0000cd">0</span>], name[<span style="color:#0000cd">1</span>]));
    }
}
</pre>
        <div class="Para" id="Par168">The editor is simple. It extends JDK’s <span class="EmphasisFontCategoryNonProportional">PropertyEditorSupport</span> class and implements the <span class="EmphasisFontCategoryNonProportional">setAsText()</span> method. In the method, we simply
            split the <span class="EmphasisFontCategoryNonProportional">String</span> into a string array with a space as the delimiter. Afterward, an instance of the <span class="EmphasisFontCategoryNonProportional">FullName</span> class is instantiated,
            passing in the <span class="EmphasisFontCategoryNonProportional">String</span> before the space character as the first name and passing the <span class="EmphasisFontCategoryNonProportional">String</span> after the space character as the last
            name. Finally, the converted value is returned by calling the <span class="EmphasisFontCategoryNonProportional">setValue()</span> method with the result. To use <span class="EmphasisFontCategoryNonProportional">NamePropertyEditor</span> in
            your application, we need to register the editor in Spring’s <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>. The following configuration sample shows an <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>            configuration of a <span class="EmphasisFontCategoryNonProportional">CustomEditorConfigurer</span> and the <span class="EmphasisFontCategoryNonProportional">NamePropertyEditor</span> (<span class="EmphasisFontCategoryNonProportional">app-context-02.xml</span>)
            <span id="ITerm81"> </span>:</div>
        <pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">customEditorConfigurer</span>
  <span style="font-style:italic">class</span>=<span style="color:#036a07">org.springframework.beans.factory.config.CustomEditorConfigurer</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">property</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">customEditors</span>&gt;</span>
            <span style="color:#1c02ff">&lt;<span style="font-weight:700">map</span>&gt;</span>
                <span style="color:#1c02ff">&lt;<span style="font-weight:700">entry</span> <span style="font-style:italic">key</span>=<span style="color:#036a07">com.apress.prospring5.ch4.custom.FullName</span>
                  <span style="font-style:italic">value</span>=<span style="color:#036a07">com.apress.prospring5.ch4.custom.NamePropertyEditor</span>/&gt;</span>
            <span style="color:#1c02ff">&lt;/<span style="font-weight:700">map</span>&gt;</span>
        <span style="color:#1c02ff">&lt;/<span style="font-weight:700">property</span>&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">bean</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">exampleBean</span>
      <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch4.custom.CustomEditorExample</span>
      <span style="font-style:italic">p</span>:name=<span style="color:#036a07">John Mayer</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
        <div class="Para" id="Par170">You should notice two things in this configuration. First, custom <span class="EmphasisFontCategoryNonProportional">PropertyEditor</span>s get injected into the <span class="EmphasisFontCategoryNonProportional">CustomEditorConfigurer</span> class
            by using the <span class="EmphasisFontCategoryNonProportional">Map</span>-typed <span class="EmphasisFontCategoryNonProportional">customEditors</span> property. Second, each entry in the <span class="EmphasisFontCategoryNonProportional">Map</span>            represents a single <span class="EmphasisFontCategoryNonProportional">PropertyEditor</span>, with the key of the entry being the name of the class for which the <span class="EmphasisFontCategoryNonProportional">PropertyEditor</span> is used.
            As you can see, the key for <span class="EmphasisFontCategoryNonProportional">NamePropertyEditor</span> is <span class="EmphasisFontCategoryNonProportional">com.apress.prospring4.ch4.FullName</span>, which signifies that this is the class
            for which the editor should be used. The following code snippet shows the code for the <span class="EmphasisFontCategoryNonProportional">CustomEditorExample</span> class that is registered as a bean in the previous configuration:</div>
        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.custom</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">CustomEditorExample</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">FullName</span> name;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">FullName</span> <span style="color:#0000a2;font-weight:700">getName</span>() {
        <span style="color:#00f;font-weight:700">return</span> name;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setName</span>(<span style="color:#00f;font-weight:700">FullName</span> <span style="font-style:italic">name</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>name <span style="color:#00f;font-weight:700">=</span> name;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-02.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">CustomEditorExample</span> bean <span style="color:#00f;font-weight:700">=</span>
                (<span style="color:#00f;font-weight:700">CustomEditorExample</span>) ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">exampleBean</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(bean<span style="color:#00f;font-weight:700">.</span>getName());
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
    <div class="Para" id="Par172">The previous code is nothing special. Run the example, and you will see the following output:</div>
    <div class="Para" id="Par173">
        <div class="ProgramCode" id="PC53">
            <div class="FixedLine">First name: John - Last name: Mayer</div>
        </div>
    </div>
    <div class="Para" id="Par174">This is the output from the <span class="EmphasisFontCategoryNonProportional">toString()</span> method we implemented in the <span class="EmphasisFontCategoryNonProportional">FullName</span> class, and you can see that the first name and last name
        of the <span class="EmphasisFontCategoryNonProportional">FullName</span> object were correctly populated by Spring by using the configured <span class="EmphasisFontCategoryNonProportional">NamePropertyEditor</span>. Starting from version 3, Spring
        introduced the Type Conversion API and the Field Formatting Service Provider Interface (SPI), which provide a simpler and well-structured API to perform type conversion and field formatting. It’s especially useful for web application development.
        Both the Type Conversion API and the Field Formatting SPI are discussed in detail in Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_10_Chapter.html"><span class="RefSource">10</span></a>
        </span>.</div>
    </div>
    </div>
    <div class="Section1 RenderAsSection1" id="Sec26">
        <h2 class="Heading">More Spring ApplicationContext Configuration</h2>
        <div class="Para" id="Par175">So far, although we are discussing Spring’s <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>, most of the <span id="ITerm83">features                  </span> that we have covered mainly surround the <span class="EmphasisFontCategoryNonProportional">BeanFactory</span>            interface wrapped by <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>. In Spring, various implementations of the <span class="EmphasisFontCategoryNonProportional">BeanFactory</span> interface are responsible for
            bean instantiation, providing dependency injection and life-cycle support for beans managed by Spring. However, as stated earlier, being an extension of the <span class="EmphasisFontCategoryNonProportional">BeanFactory</span> interface,
            <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> provides other useful functionalities as well. The main function of <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> is to provide a much richer framework on which to build your applications.
                <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> is much more aware of the beans (compared to <span class="EmphasisFontCategoryNonProportional">BeanFactory</span>) that you configure within it, and in the case
                of many of the Spring infrastructure classes and interfaces, such as <span class="EmphasisFontCategoryNonProportional">BeanFactoryPostProcessor</span>, it interacts with them on your behalf, reducing the amount of code you need to write
                in order to use Spring.</div>
        <div class="Para" id="Par176">The biggest benefit of using <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> is that it allows you to configure and manage Spring and Spring-managed resources in a completely declarative way. This means that wherever
            possible, Spring provides support classes to load <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> into your application automatically, thus removing the need for you to write any code to access <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>.
            In practice, this feature is currently available only when you are building web applications with Spring, which allows you to initialize Spring’s <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> in the web application
            deployment descriptor. When using a stand-alone application, you can also initialize Spring’s <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> by simple coding.</div>
        <div class="Para" id="Par177">In addition to providing a model that is focused more on declarative configuration, <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> supports the following <span id="ITerm84">features                  </span>:
            <div class="UnorderedList">
                <ul class="UnorderedListMarkBullet">
                    <li>
                        <div class="Para" id="Par178">Internationalization</div>
                    </li>
                    <li>
                        <div class="Para" id="Par179">Event publication</div>
                    </li>
                    <li>
                        <div class="Para" id="Par180">Resource management and access</div>
                    </li>
                    <li>
                        <div class="Para" id="Par181">Additional life-cycle interfaces</div>
                    </li>
                    <li>
                        <div class="Para" id="Par182">Improved automatic configuration of infrastructure components</div>
                    </li>
                </ul>
            </div>
        </div>
        <div class="Para ParaOneEmphasisChild" id="Par183">In the following sections, we discuss some of the most important features in <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> besides DI.</div>
        <div class="Section2 RenderAsSection2" id="Sec27">
            <h3 class="Heading">Internationalization with the <span id="ITerm85">MessageSource                      </span> </h3>
            <div class="Para" id="Par184">One area where Spring really excels is in support for internationalization (i18n). Using the <span class="EmphasisFontCategoryNonProportional">MessageSource</span> interface, your application can access <span class="EmphasisFontCategoryNonProportional">String</span>                resources, called <span class="EmphasisTypeItalic">messages</span>, stored in a variety of languages. For each language you want to support in your application, you maintain a list of messages that are keyed to correspond to messages in
                other languages. For instance, if you wanted to display “The quick brown fox jumped over the lazy dog” in English and in Czech, you would create two messages, both keyed as <span class="EmphasisFontCategoryNonProportional">msg</span>;
                the one for English would read “The quick brown fox jumped over the lazy dog,” and the one for German would read “Der schnelle braune Fuchs sprang über den faulen Hund.”</div>
            <div class="Para" id="Par185">Although you don’t need to use <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> to use <span class="EmphasisFontCategoryNonProportional">MessageSource</span>, the <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>                interface extends <span class="EmphasisFontCategoryNonProportional">MessageSource</span> and provides special support for loading messages and for making them available in your environment. The automatic loading of messages is available
                in any environment, but automatic access is provided only in certain Spring-managed scenarios, such as when you are using Spring’s MVC framework to build a web application. Although any class can implement <span class="EmphasisFontCategoryNonProportional">ApplicationContextAware</span>                and thus access the automatically loaded messages, we suggest a better solution later in this chapter, in the section “Using MessageSource in Stand-Alone Applications.”</div>
            <div class="Para" id="Par186">Before continuing, if you are unfamiliar with i18n support in Java, we suggest you at least check out the Javadocs (<span class="ExternalRef"><a href="http://download.java.net/jdk8/docs/api/index.html"><span class="RefSource">                  <span class="EmphasisFontCategoryNonProportional">http://download.java.net/jdk8/docs/api/index.html</span>                </span>
                </a>
                </span>).</div>
            <div class="Section3 RenderAsSection3" id="Sec28">
                <h4 class="Heading">Internationalization with the MessageSource</h4>
                <div class="Para" id="Par187">Aside from <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>, Spring provides three <span class="EmphasisFontCategoryNonProportional">MessageSource</span> implementations.
                    <div class="UnorderedList">
                        <ul class="UnorderedListMarkBullet">
                            <li>
                                <div class="Para ParaOneEmphasisChild" id="Par188"> <span class="EmphasisFontCategoryNonProportional">ResourceBundleMessageSource</span> </div>
                            </li>
                            <li>
                                <div class="Para ParaOneEmphasisChild" id="Par189"> <span class="EmphasisFontCategoryNonProportional">ReloadableResourceBundleMessageSource</span> </div>
                            </li>
                            <li>
                                <div class="Para ParaOneEmphasisChild" id="Par190"> <span class="EmphasisFontCategoryNonProportional">StaticMessageSource</span> </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="Para ParaOneEmphasisChild" id="Par191">The <span class="EmphasisFontCategoryNonProportional">StaticMessageSource</span> implementation should not be used in a production application because you can’t configure it externally, and this is generally one of the main requirements
                    when you are adding i18n capabilities to your application.</div>
                <div class="Para" id="Par192"> <span class="EmphasisFontCategoryNonProportional">ResourceBundleMessageSource</span> loads messages by using a Java <span class="EmphasisFontCategoryNonProportional">ResourceBundle</span>. <span class="EmphasisFontCategoryNonProportional">ReloadableResourceBundleMessageSource</span>                    is essentially the same, except it supports scheduled reloading of the underlying source files.</div>
                <div class="Para" id="Par194">All three MessageSource implementations also implement another interface called <span class="EmphasisFontCategoryNonProportional">HierarchicalMessageSource</span>, which allows for many <span class="EmphasisFontCategoryNonProportional">MessageSource</span>                    instances to be nested. This is key to the way <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> works with <span class="EmphasisFontCategoryNonProportional">MessageSource</span> instances.</div>
                <div class="Para" id="Par195">To take advantage of <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>’s support for <span class="EmphasisFontCategoryNonProportional">MessageSource</span>, you must define a bean in your configuration of type
                    <span class="EmphasisFontCategoryNonProportional">MessageSource</span> and with the name <span class="EmphasisFontCategoryNonProportional">messageSource. ApplicationContext</span> takes this <span class="EmphasisFontCategoryNonProportional">MessageSource</span>                    and nests it within itself, allowing you to access the messages by using <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>. This can be hard to visualize, so take a look at the following example. The following
                    code sample shows a simple application that accesses a set of messages for both the English and German <span id="ITerm86">locales                          </span>:</div>
                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Locale</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">MessageSourceDemo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-xml.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">Locale</span> english <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">Locale</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>ENGLISH</span>;
        <span style="color:#00f;font-weight:700">Locale</span> german <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Locale</span>(<span style="color:#036a07">de</span>, <span style="color:#036a07">DE</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(ctx<span style="color:#00f;font-weight:700">.</span>getMessage(<span style="color:#036a07">msg</span>, <span style="color:#585cf6;font-weight:700">null</span>, english));
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(ctx<span style="color:#00f;font-weight:700">.</span>getMessage(<span style="color:#036a07">msg</span>, <span style="color:#585cf6;font-weight:700">null</span>, german));
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(ctx<span style="color:#00f;font-weight:700">.</span>getMessage(<span style="color:#036a07">nameMsg</span>, <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Object</span>[]
                {<span style="color:#036a07">John</span>, <span style="color:#036a07">Mayer</span>}, english));
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(ctx<span style="color:#00f;font-weight:700">.</span>getMessage(<span style="color:#036a07">nameMsg</span>, <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Object</span>[]
                {<span style="color:#036a07">John</span>, <span style="color:#036a07">Mayer</span>}, german));
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                <div class="Para" id="Par197">Don’t worry about the calls to <span class="EmphasisFontCategoryNonProportional">getMessage()</span> just yet; we will return to those shortly. For now, just know that they retrieve a keyed message for the locale specified. In the following
                    configuration snippet, you can see the configuration used by this application (<span class="EmphasisFontCategoryNonProportional">app-context-xml.xml</span>):</div>
                <pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">messageSource</span>
   <span style="font-style:italic">class</span>=<span style="color:#036a07">org.springframework.context.support.ResourceBundleMessageSource</span>
      <span style="font-style:italic">p</span>:basenames-ref=<span style="color:#036a07">basenames</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">util</span><span style="font-weight:700">:</span><span style="font-weight:700">list</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">basenames</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">value</span>&gt;</span>buttons<span style="color:#1c02ff">&lt;/<span style="font-weight:700">value</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">value</span>&gt;</span>labels<span style="color:#1c02ff">&lt;/<span style="font-weight:700">value</span>&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">util</span><span style="font-weight:700">:</span><span style="font-weight:700">list</span>&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
                <div class="Para" id="Par199">Here we define a <span class="EmphasisFontCategoryNonProportional">ResourceBundleMessageSource</span> bean with the name <span class="EmphasisFontCategoryNonProportional">messageSource</span> as required and configure it with a set of
                    names to form the base of its file set. A Java <span class="EmphasisFontCategoryNonProportional">ResourceBundle</span>, which is used by <span class="EmphasisFontCategoryNonProportional">ResourceBundleMessageSource</span>, works on
                    a set of properties files that are identified by base names. When looking for a message for a particular <span class="EmphasisFontCategoryNonProportional">Locale</span>, the <span class="EmphasisFontCategoryNonProportional">ResourceBundle</span>                    looks for a file that is named as a combination of the base name and the locale name. For instance, if the base name is <span class="EmphasisFontCategoryNonProportional">foo</span> and we are looking for a message in the <span class="EmphasisFontCategoryNonProportional">en-GB</span>                    (British English) locale, <span class="EmphasisFontCategoryNonProportional">ResourceBundle</span> looks for a file called <span class="EmphasisFontCategoryNonProportional">foo_en_GB.properties</span>.</div>
                <div class="Para" id="Par200">For the previous example, the content of the properties files for English (<span class="EmphasisFontCategoryNonProportional">labels_en.properties</span>) and German (<span class="EmphasisFontCategoryNonProportional">labels_de_DE.properties</span>)
                    is shown here:</div>
                <div class="Para" id="Par201">
                    <div class="ProgramCode" id="PC56">
                        <div class="FixedLine">#labels_en.properties</div>
                        <div class="FixedLine">msg=My stupid mouth has got me in trouble</div>
                        <div class="FixedLine">nameMsg=My name is {0} {1}</div>
                        <div class="FixedLine">#labels_de_DE.properties</div>
                        <div class="FixedLine">msg=Mein dummer Mund hat mich in Schwierigkeiten gebracht</div>
                        <div class="FixedLine">nameMsg=Mein Name ist {0} {1}</div>
                    </div>
                </div>
                <div class="Para" id="Par202">Now this example just raises even more questions. What do those calls to <span class="EmphasisFontCategoryNonProportional">getMessage()</span> mean? Why did we use <span class="EmphasisFontCategoryNonProportional">ApplicationContext.getMessage()</span>                    rather than access the <span class="EmphasisFontCategoryNonProportional">ResourceBundleMessageSource</span> bean directly? We’ll answer each of these questions in <span id="ITerm87">turn                          </span>.</div>
            </div>
            <div class="Section3 RenderAsSection3" id="Sec29">
                <h4 class="Heading">Using the <span id="ITerm88">getMessage()                          </span> Method</h4>
                <div class="Para" id="Par203">The <span class="EmphasisFontCategoryNonProportional">MessageSource</span> interface defines three overloads for the <span class="EmphasisFontCategoryNonProportional">getMessage()</span> method. These are described in Table <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Chapter.html#Tab2">4-2</a></span>.
                    <div class="Table" id="Tab2">
                        <div class="Caption" xml:lang="en">
                            <div class="CaptionContent"><span class="CaptionNumber">Table 4-2.</span>
                                <div class="SimplePara">Overloads for MessageSource.getMessage()</div>
                            </div>
                        </div>
                        <table border="1">
                            <colgroup>
                                <col>
                                <col>
                            </colgroup>
                            <thead>
                                <tr class="header">
                                    <th>
                                        <div class="SimplePara">Method signature</div>
                                    </th>
                                    <th>
                                        <div class="SimplePara">Description</div>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="noclass">
                                    <td>
                                        <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">getMessage (String,  Object[], Locale)</span> </div>
                                    </td>
                                    <td>
                                        <div class="SimplePara">This is the standard <span class="EmphasisFontCategoryNonProportional">getMessage()</span> method. The <span class="EmphasisFontCategoryNonProportional">String</span> argument is the key of the message corresponding
                                            to the key in the properties file. In the previous code sample, the first call to <span class="EmphasisFontCategoryNonProportional">getMessage()</span> used <span class="EmphasisFontCategoryNonProportional">msg</span>                                            as the key, and this corresponded to the following entry in the properties file for the <span class="EmphasisFontCategoryNonProportional">en</span> locale: <span class="EmphasisFontCategoryNonProportional">msg=The quick brown fox jumped over the lazy dog</span>.
                                            The <span class="EmphasisFontCategoryNonProportional">Object[]</span> array argument is used for replacements in the message. In the third call to <span class="EmphasisFontCategoryNonProportional">getMessage()</span>,
                                            we passed in an array of two <span class="EmphasisFontCategoryNonProportional">String</span>s. The message keyed as <span class="EmphasisFontCategoryNonProportional">nameMsg</span> was <span class="EmphasisFontCategoryNonProportional">My name is {0} {1}</span>.
                                            The numbers in braces are placeholders, and each one is replaced with the corresponding entry in the argument array. The final argument, <span class="EmphasisFontCategoryNonProportional">Locale</span>, tells
                                            <span class="EmphasisFontCategoryNonProportional">ResourceBundleMessageSource</span> which properties file to look in. Even though the first and second calls to <span class="EmphasisFontCategoryNonProportional">getMessage()</span>                                            in the example used the same key, they returned different messages that correspond to the <span class="EmphasisFontCategoryNonProportional">Locale</span> setting that was passed in to <span class="EmphasisFontCategoryNonProportional">getMessage()</span>.</div>
                                    </td>
                                </tr>
                                <tr class="noclass">
                                    <td>
                                        <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">getMessage (String, Object[], String, Locale)</span> </div>
                                    </td>
                                    <td>
                                        <div class="SimplePara">This overload works in the same way as <span class="EmphasisFontCategoryNonProportional">getMessage(String, Object[], Locale)</span>, other than the second <span class="EmphasisFontCategoryNonProportional">String</span>                                            argument, which allows we to pass in a default value in case a message for the supplied key is not available for the supplied <span id="ITerm89">                              <span class="EmphasisFontCategoryNonProportional">Locale</span>                                            </span>.</div>
                                    </td>
                                </tr>
                                <tr class="noclass">
                                    <td>
                                        <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">getMessage (MessageSourceResolvable, Locale)</span> </div>
                                    </td>
                                    <td>
                                        <div class="SimplePara">This overload is a special case. We discuss it in further detail in the section “The MessageSourceResolvable Interface.”</div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                </div>
            </div>
        </div>
        <div class="Section3 RenderAsSection3" id="Sec30">
            <h4 class="Heading">Why Use ApplicationContext As a MessageSource?</h4>
            <div class="Para" id="Par204">To answer this question, we need to jump a little ahead of ourselves and look at the web application support in Spring. The answer, in general, is that you shouldn’t use <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>                as a <span class="EmphasisFontCategoryNonProportional">MessageSource</span> because doing so couples your bean to <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> unnecessarily (this is discussed in more detail
                in the next section). You should use <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> when you are building a web application by using Spring’s MVC framework.</div>
            <div class="Para" id="Par205">The core interface in Spring MVC is <span class="EmphasisFontCategoryNonProportional">Controller</span>. Unlike frameworks such as Struts that require you to implement your controllers by inheriting from a concrete class, Spring simply requires
                that you implement the <span class="EmphasisFontCategoryNonProportional">Controller</span> interface (or annotate your controller class with the <span class="EmphasisFontCategoryNonProportional">@Controller</span> annotation). Having said
                that, Spring provides a collection of useful base classes that you will use to implement your own controllers. Each of these base classes is a subclass (directly or indirectly) of the <span class="EmphasisFontCategoryNonProportional">ApplicationObjectSupport</span>                class, which is a convenient superclass for any application objects that want to be aware of <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>. Remember that in a web application setting, <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>                is loaded automatically.</div>
            <div class="Para" id="Par206"> <span class="EmphasisFontCategoryNonProportional">ApplicationObjectSupport</span> accesses this <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>, wraps it in a <span class="EmphasisFontCategoryNonProportional">MessageSourceAccessor</span>                object, and makes that available to your controller via the protected <span class="EmphasisFontCategoryNonProportional">getMessageSourceAccessor()</span> method. MessageSourceAccessor provides a wide array of convenient methods for working
                with <span class="EmphasisFontCategoryNonProportional">MessageSource</span> instances. Provides a wide array of convenient methods for working with <span class="EmphasisFontCategoryNonProportional">MessageSource</span> instances. This
                form of auto-injection is quite beneficial; it removes the need for all of your controllers to expose a <span class="EmphasisFontCategoryNonProportional">MessageSource</span> property.</div>
            <div class="Para" id="Par207">However, this is not the best reason for using <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> as a <span class="EmphasisFontCategoryNonProportional">MessageSource</span> in your web application. The main reason
                to use <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> rather than a manually defined <span class="EmphasisFontCategoryNonProportional">MessageSource</span> bean is that Spring does, where possible, expose
                <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>, as a <span class="EmphasisFontCategoryNonProportional">MessageSource</span>, to the view tier. This means when you are using Spring’s JSP tag library, the <span class="EmphasisFontCategoryNonProportional">&lt;spring:message&gt;</span>                    tag automatically reads messages from <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>, and when you are using JSTL, the <span class="EmphasisFontCategoryNonProportional">&lt;fmt:message&gt;</span> tag does
                    the same.</div>
            <div class="Para" id="Par208">All of these benefits mean that it is better to use the <span class="EmphasisFontCategoryNonProportional">MessageSource</span> support in <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> when you are building a web
                application, rather than manage an instance of <span class="EmphasisFontCategoryNonProportional">MessageSource</span> separately. This is especially true when you consider that all you need to do to take advantage of this feature is to
                configure a <span class="EmphasisFontCategoryNonProportional">MessageSource</span> bean with the name <span class="EmphasisFontCategoryNonProportional">messageSource</span>.</div>
        </div>
    </div>
    <div class="Section2 RenderAsSection2" id="Sec31">
        <h3 class="Heading">Using MessageSource in Stand-Alone Applications</h3>
        <div class="Para" id="Par209">When you are using <span class="EmphasisFontCategoryNonProportional">MessageSource</span> in stand-alone applications, where Spring offers no additional support other than to nest the <span class="EmphasisFontCategoryNonProportional">MessageSource</span>            bean automatically in <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>, it is best to make the <span class="EmphasisFontCategoryNonProportional">MessageSource</span> available by using dependency injection. You can
            opt to make your bean <span class="EmphasisFontCategoryNonProportional">ApplicationContextAware</span>, but doing so precludes its use in a <span class="EmphasisFontCategoryNonProportional">BeanFactory</span> context. Add to this that you
            complicate testing without any discernible benefit, and it is clear that you should stick to using dependency injection to access <span class="EmphasisFontCategoryNonProportional">MessageSource</span> objects in a stand-alone setting.</div>
        <div class="Section3 RenderAsSection3" id="Sec32">
            <h4 class="Heading">The <span id="ITerm90">MessageSourceResolvable            </span> Interface</h4>
            <div class="Para" id="Par210">You can use an object that implements <span class="EmphasisFontCategoryNonProportional">MessageSourceResolvable</span> in place of a key and a set of arguments when you are looking up a message from a <span class="EmphasisFontCategoryNonProportional">MessageSource</span>.
                This interface is most widely used in the Spring validation libraries to link <span class="EmphasisFontCategoryNonProportional">Error</span> objects to their internationalized error messages.</div>
    </div>
    </div>
    <div class="Section2 RenderAsSection2" id="Sec33">
        <h3 class="Heading">Application Events</h3>
        <div class="Para" id="Par211">Another feature of <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> not present in <span class="EmphasisFontCategoryNonProportional">BeanFactory</span> is the ability to publish and receive events by using <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>            as a broker. In this section, you will take a look at its usage.</div>
        <div class="Section3 RenderAsSection3" id="Sec34">
            <h4 class="Heading">Using Application Events</h4>
            <div class="Para" id="Par212">An event is a class derived from <span id="ITerm91">                  <span class="EmphasisFontCategoryNonProportional">ApplicationEvent</span> </span>, which itself derives from <span class="EmphasisFontCategoryNonProportional">java.util.EventObject</span>.
                Any bean can listen for events by implementing the <span class="EmphasisFontCategoryNonProportional">ApplicationListener&lt;T&gt;</span> interface; <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> automatically
                registers any bean that implements this interface as a listener when it is configured. Events are published using the <span class="EmphasisFontCategoryNonProportional">ApplicationEventPublisher.publishEvent()</span> method, so the publishing
                class must have knowledge of <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> (which extends the <span class="EmphasisFontCategoryNonProportional">ApplicationEventPublisher</span> interface). In a web application,
                this is simple because many of your classes are derived from Spring Framework classes that allow access to <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> through a protected method. In a stand-alone application,
                you can have your publishing bean implement <span class="EmphasisFontCategoryNonProportional">ApplicationContextAware</span> to enable it to publish events.</div>
            <div class="Para" id="Par213">The following code sample shows an example of a basic event class:</div>
            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.ApplicationEvent</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">MessageEvent</span> <span style="color:#00f;font-weight:700">extends</span> <span style="font-style:italic">ApplicationEvent</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> msg;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">MessageEvent</span>(<span style="color:#00f;font-weight:700">Object</span> <span style="font-style:italic">source</span>, <span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">msg</span>) {
        <span style="color:#318495">super</span>(source);
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>msg <span style="color:#00f;font-weight:700">=</span> msg;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getMessage</span>() {
        <span style="color:#00f;font-weight:700">return</span> msg;
    }
}
</pre>
            <div class="Para" id="Par215">This code is quite basic; the only point of note is that <span class="EmphasisFontCategoryNonProportional">ApplicationEvent</span> has a single constructor that accepts a reference to the source of the event. This is reflected in the constructor
                for <span class="EmphasisFontCategoryNonProportional">MessageEvent</span>. Here, you can see the code for the listener:</div>
            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.ApplicationListener</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">MessageEventListener</span>
        <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">ApplicationListener&lt;<span style="color:#00f;font-weight:700">MessageEvent</span>&gt;</span> {
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">onApplicationEvent</span>(<span style="color:#00f;font-weight:700">MessageEvent</span> <span style="font-style:italic">event</span>) {
        <span style="color:#00f;font-weight:700">MessageEvent</span> msgEvt <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">MessageEvent</span>) event;
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Received: </span> <span style="color:#00f;font-weight:700">+</span> msgEvt<span style="color:#00f;font-weight:700">.</span>getMessage());
    }
}
</pre>
            <div class="Para" id="Par217">The <span class="EmphasisFontCategoryNonProportional">ApplicationListener</span> interface defines a single method, <span class="EmphasisFontCategoryNonProportional">onApplicationEvent</span>, that is called by Spring when an event is raised.
                <span class="EmphasisFontCategoryNonProportional">MessageEventListener</span> shows its interest only in events of type <span class="EmphasisFontCategoryNonProportional">MessageEvent</span> (or its subclasses) by implementing the strongly
                typed <span class="EmphasisFontCategoryNonProportional">ApplicationListener</span> interface. If a <span class="EmphasisFontCategoryNonProportional">MessageEvent</span> was received, it writes the message to <span class="EmphasisFontCategoryNonProportional">stdout</span>.
                Publishing events is simple; it is just a matter of creating an instance of the event class and passing it to the <span class="EmphasisFontCategoryNonProportional">ApplicationEventPublisher.publishEvent()</span> method, as shown here:</div>
            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.BeansException</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.ApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.ApplicationContextAware</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.ClassPathXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Publisher</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">ApplicationContextAware</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">ApplicationContext</span> ctx;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setApplicationContext</span>(<span style="color:#00f;font-weight:700">ApplicationContext</span> <span style="font-style:italic">applicationContext</span>)
            <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">BeansException</span> {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>ctx <span style="color:#00f;font-weight:700">=</span> applicationContext;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">publish</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">message</span>) {
        ctx<span style="color:#00f;font-weight:700">.</span>publishEvent(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">MessageEvent</span>(<span style="color:#318495">this</span>, message));
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">ApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ClassPathXmlApplicationContext</span>(
                <span style="color:#036a07">classpath:spring/app-context-xml.xml</span>);
        <span style="color:#00f;font-weight:700">Publisher</span> pub <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">Publisher</span>) ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">publisher</span>);
        pub<span style="color:#00f;font-weight:700">.</span>publish(<span style="color:#036a07">I send an SOS to the world... </span>);
        pub<span style="color:#00f;font-weight:700">.</span>publish(<span style="color:#036a07">... I hope that someone gets my...</span>);
        pub<span style="color:#00f;font-weight:700">.</span>publish(<span style="color:#036a07">... Message in a bottle</span>);
    }
}
</pre>
        <div class="Para" id="Par219">Here you can see that the <span class="EmphasisFontCategoryNonProportional">Publisher</span> class retrieves an instance of itself from <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> and then, using the <span class="EmphasisFontCategoryNonProportional">publish()</span>            method, publishes two <span class="EmphasisFontCategoryNonProportional">MessageEvent</span> instances to <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>. The <span class="EmphasisFontCategoryNonProportional">Publisher</span>            bean instance accesses the <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> instance by implementing <span class="EmphasisFontCategoryNonProportional">ApplicationContextAware</span>. Here is the configuration for
            this example (<span class="EmphasisFontCategoryNonProportional">app-context-xml.xml</span>):</div>
        <pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">publisher</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch4.Publisher</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">messageEventListener</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch4.MessageEventListener</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
        <div class="Para" id="Par221">Notice that you do not need special configuration to register <span class="EmphasisFontCategoryNonProportional">MessageEventListener</span> with <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>; it is picked up automatically
            by Spring. Running this example results in the following output:</div>
        <div class="Para" id="Par222">
            <div class="ProgramCode" id="PC61">
                <div class="FixedLine">Received: I send an SOS to the world...</div>
                <div class="FixedLine">Received: ... I hope that someone gets my...</div>
                <div class="FixedLine">Received: ... Message in a bottle</div>
            </div>
        </div>
    </div>
    <div class="Section3 RenderAsSection3" id="Sec35">
        <h4 class="Heading">Considerations for <span id="ITerm94">Event Usage                          </span> </h4>
        <div class="Para" id="Par223">In many cases in an application, certain components need to be notified of certain events. Often you do this by writing code to notify each component explicitly or by using a messaging technology such as JMS. The drawback of writing code to notify
            each component in turn is that you are coupling those components to the publisher, in many cases unnecessarily.</div>
        <div class="Para" id="Par224">Consider a situation whereby you cache product details in your application to avoid trips to the database. Another component allows product details to be modified and persisted to the database. To avoid making the cache invalid, the update component
            explicitly notifies the cache that the user details have changed. In this example, the update component is coupled to a component that, really, has nothing to do with its business responsibility. A better solution would be to have the update
            component publish an event every time a product’s details are modified and then have interested components, such as the cache, listen for that event. This has the benefit of keeping the components decoupled, which makes it simple to remove
            the cache if needed or to add another listener that is interested in knowing when a product’s details change.</div>
        <div class="Para" id="Par225">Using JMS in this case would be overkill because the process of invalidating the product’s entry in the cache is quick and is not business critical. The use of the Spring event infrastructure adds very little overhead to your application.</div>
        <div class="Para" id="Par226">Typically, we use events for reactionary logic that executes quickly and is not part of the main application logic. In the previous example, the invalidation of a product in cache happens in reaction to the updating of product details, it executes
            quickly (or it should), and it is not part of the main function of the application. For processes that are long running and form part of the main business logic, it is recommended to use JMS or similar messaging systems such as RabbitMQ. The
            main benefits of using JMS are that it is more suited to long-running processes, and as the system grows, you can, if necessary, factor the JMS-driven processing of messages containing business information onto a separate <span id="ITerm95">machine                          </span>.</div>
    </div>
    </div>
    </div>
    <div class="Section1 RenderAsSection1" id="Sec36">
        <h2 class="Heading">Accessing Resources</h2>
        <div class="Para" id="Par227">Often an application needs to access a variety of resources in different forms. You might need to access some configuration data stored in a file in the file system, some image data stored in a JAR file on the classpath, or maybe some data on
            a server elsewhere. Spring provides a unified mechanism for accessing resources in a protocol-independent way. This means your application can access a file resource in the same way, whether it is stored in the file system, in the classpath,
            or on a remote server.</div>
        <div class="Para" id="Par228">At the core of Spring’s resource support is the <span class="EmphasisFontCategoryNonProportional">org.springframework.core.io.Resource</span> interface. The <span id="ITerm96">              <span class="EmphasisFontCategoryNonProportional">Resource</span>            </span> interface defines ten self-explanatory methods: <span class="EmphasisFontCategoryNonProportional">contentLength()</span>, <span class="EmphasisFontCategoryNonProportional">exists()</span>, <span class="EmphasisFontCategoryNonProportional">getDescription()</span>,
            <span class="EmphasisFontCategoryNonProportional">getFile()</span>, <span class="EmphasisFontCategoryNonProportional">getFileName()</span>, <span class="EmphasisFontCategoryNonProportional">getURI()</span>, <span class="EmphasisFontCategoryNonProportional">getURL()</span>,
            <span class="EmphasisFontCategoryNonProportional">isOpen()</span>, <span class="EmphasisFontCategoryNonProportional">isReadable()</span>, and <span class="EmphasisFontCategoryNonProportional">lastModified()</span>. In addition to these ten
            methods, there is one that is not quite so self-explanatory: <span class="EmphasisFontCategoryNonProportional">createRelative()</span>. The <span class="EmphasisFontCategoryNonProportional">createRelative()</span> method creates a new
            <span class="EmphasisFontCategoryNonProportional">Resource</span> instance by using a path that is relative to the instance on which it is invoked. You can provide your own <span class="EmphasisFontCategoryNonProportional">Resource</span> implementations, although that is outside the scope
                of this chapter, but in most cases, you use one of the built-in implementations for accessing a file (the <span class="EmphasisFontCategoryNonProportional">FileSystemResource</span> class), a classpath (the <span class="EmphasisFontCategoryNonProportional">ClassPathResource</span>                class), or URL resources (the <span class="EmphasisFontCategoryNonProportional">UrlResource</span> class). Internally, Spring uses another interface, <span class="EmphasisFontCategoryNonProportional">ResourceLoader</span>, and the default
                implementation, <span class="EmphasisFontCategoryNonProportional">DefaultResourceLoader</span>, to locate and create <span class="EmphasisFontCategoryNonProportional">Resource</span> instances. However, you generally won’t interact with
                <span class="EmphasisFontCategoryNonProportional">DefaultResourceLoader</span>, instead using another <span class="EmphasisFontCategoryNonProportional">ResourceLoader</span> implementation, called <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>.
                Here is a sample application that accesses three resources by using <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>:</div>
        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.io.File</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.ApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.ClassPathXmlApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.core.io.Resource</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">ResourceDemo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Exception</span> {
        <span style="color:#00f;font-weight:700">ApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ClassPathXmlApplicationContext</span>();
        <span style="color:#00f;font-weight:700">File</span> file <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">File</span><span style="color:#00f;font-weight:700">.</span>createTempFile(<span style="color:#036a07">test</span>, <span style="color:#036a07">txt</span>);
        file<span style="color:#00f;font-weight:700">.</span>deleteOnExit();
        <span style="color:#00f;font-weight:700">Resource</span> res1 <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getResource(<span style="color:#036a07">file://</span> <span style="color:#00f;font-weight:700">+</span> file<span style="color:#00f;font-weight:700">.</span>getPath());
        displayInfo(res1);
        <span style="color:#00f;font-weight:700">Resource</span> res2 <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getResource(<span style="color:#036a07">classpath:test.txt</span>);
        displayInfo(res2);
        <span style="color:#00f;font-weight:700">Resource</span> res3 <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getResource(<span style="color:#036a07">http://www.google.com</span>);
        displayInfo(res3);
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">displayInfo</span>(<span style="color:#00f;font-weight:700">Resource</span> <span style="font-style:italic">res</span>) <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Exception</span> {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(res<span style="color:#00f;font-weight:700">.</span>getClass());
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(res<span style="color:#00f;font-weight:700">.</span>getURL()<span style="color:#00f;font-weight:700">.</span>getContent());
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07"></span>);
    }
}
</pre>
        <div class="Para" id="Par230">Notice that in each call to <span class="EmphasisFontCategoryNonProportional">getResource()</span>, we pass in a URI for each resource. You will recognize the common <span class="EmphasisFontCategoryNonProportional">file:</span> and <span class="EmphasisFontCategoryNonProportional">http:</span>            protocols that we pass in for <span class="EmphasisFontCategoryNonProportional">res1</span> and <span class="EmphasisFontCategoryNonProportional">res3</span>. The <span class="EmphasisFontCategoryNonProportional">classpath:</span> protocol
            we use for <span class="EmphasisFontCategoryNonProportional">res2</span> is Spring-specific and indicates that <span class="EmphasisFontCategoryNonProportional">ResourceLoader</span> should look in the classpath for the resource. Running this
            example results in the following output:</div>
        <div class="Para" id="Par231">
            <div class="ProgramCode" id="PC63">
                <div class="LineGroup">
                    <div class="FixedLine">class org.springframework.core.io.UrlResource</div>
                    <div class="FixedLine">java.io.BufferedInputStream@3567135c</div>
                </div>
                <div class="LineGroup">
                    <div class="FixedLine">class org.springframework.core.io.ClassPathResource</div>
                    <div class="FixedLine">sun.net.www.content.text.PlainTextInputStream@90f6bfd</div>
                </div>
                <div class="LineGroup">
                    <div class="FixedLine">class org.springframework.core.io.UrlResource</div>
                    <div class="FixedLine">sun.net.www.protocol.http.HttpURLConnection$HttpInputStream@735b5592</div>
                </div>
            </div>
        </div>
        <div class="Para" id="Par232">Notice that for both <span id="ITerm97">the        </span> <span class="EmphasisFontCategoryNonProportional">file:</span> and <span class="EmphasisFontCategoryNonProportional">http:</span> protocols, Spring returns a <span class="EmphasisFontCategoryNonProportional">UrlResource</span>            instance. Spring does include a <span class="EmphasisFontCategoryNonProportional">FileSystemResource</span> class, but the <span class="EmphasisFontCategoryNonProportional">DefaultResourceLoader</span> does not use this class at all. It’s
            because Spring’s default resource-loading strategy treats the URL and file as the same type of resource with difference protocols (<span class="EmphasisFontCategoryNonProportional">file:</span> and <span class="EmphasisFontCategoryNonProportional">http:</span>).
            If an instance of <span class="EmphasisFontCategoryNonProportional">FileSystemResource</span> is required, use <span class="EmphasisFontCategoryNonProportional">FileSystemResourceLoader</span>. Once a <span class="EmphasisFontCategoryNonProportional">Resource</span>            instance is obtained, you are free to access the contents as you see fit, using <span class="EmphasisFontCategoryNonProportional">getFile()</span>, <span class="EmphasisFontCategoryNonProportional">getInputStream()</span>, or <span class="EmphasisFontCategoryNonProportional">getURL()</span>.
            In some cases, such as when you are using the <span class="EmphasisFontCategoryNonProportional">http:</span> protocol, the call to <span class="EmphasisFontCategoryNonProportional">getFile()</span> results in a <span class="EmphasisFontCategoryNonProportional">FileNotFoundException</span>.
            For this reason, we recommend that you use <span class="EmphasisFontCategoryNonProportional">getInputStream()</span> to access resource contents because it is likely to function for all possible resource types.</div>
    </div>
    <div class="Section1 RenderAsSection1" id="Sec37">
        <h2 class="Heading">Configuration Using Java Classes</h2>
        <div class="Para" id="Par233">Besides XML and property file configuration, you can use Java classes to configure Spring’s <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>. Code samples were introduced here and there, until now, to make you comfortable
            with the annotations-style configuration. Spring JavaConfig used to be a separate project, but starting with Spring 3.0, its major features for configuration using Java classes was merged into the core Spring Framework. In this section, we
            show how to use Java classes to configure Spring’s <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> and its equivalent when using XML configuration.</div>
        <div class="Section2 RenderAsSection2" id="Sec38">
            <h3 class="Heading">ApplicationContext Configuration in Java</h3>
            <div class="Para" id="Par234">Let’s see how Spring’s <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> can be configured by using Java classes; we’ll reference the same example for message provider and renderer that we presented in Chapter
                <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_2_Chapter.html"><span class="RefSource">2</span></a></span> and Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Chapter.html"><span class="RefSource">3</span></a>
                    </span>. The following code recaps the message provider interface and a configurable message provider:<a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Chapter.html#Fn2" id="Fn2_source"><sup>2</sup></a>                    </div>
            <pre style="background:#fff;color:#000"><span style="color:#06f;font-style:italic">//chapter02/hello-world/src/main/java/com/apress/prospring5/</span>
<span style="color:#06f;font-style:italic">//    ch2/decoupled/MessageProvider.java</span>
<span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">MessageProvider</span> {
    <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getMessage</span>();
}
<span style="color:#06f;font-style:italic">//chapter03/constructor-injection/src/main/java/com/apress/prospring5/</span>
<span style="color:#06f;font-style:italic">//    ch3/xml/ConfigurableMessageProvider.java</span>
<span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.xml</span>;
        <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageProvider</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">ConfigurableMessageProvider</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">MessageProvider</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> message <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">Default  message</span>;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">ConfigurableMessageProvider</span>() {
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">ConfigurableMessageProvider</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">message</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>message <span style="color:#00f;font-weight:700">=</span> message;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setMessage</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">message</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>message <span style="color:#00f;font-weight:700">=</span> message;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getMessage</span>() {
        <span style="color:#00f;font-weight:700">return</span> message;
    }
}
</pre>
            <div class="Para" id="Par237">The following code snippet shows the <span id="ITerm98">                <span class="EmphasisFontCategoryNonProportional">MessageRenderer</span> </span> interface and the <span id="ITerm99">                <span class="EmphasisFontCategoryNonProportional">StandardOutMessageRenderer</span>                </span> implementation:</div>
            <pre style="background:#fff;color:#000"><span style="color:#06f;font-style:italic">//chapter02/hello-world/src/main/java/com/apress/prospring5/</span>
<span style="color:#06f;font-style:italic">//     ch2/decoupled/MessageRenderer.java</span>
<span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">MessageRenderer</span> {
    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">render</span>();

    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setMessageProvider</span>(<span style="color:#00f;font-weight:700">MessageProvider</span> <span style="font-style:italic">provider</span>);

    <span style="color:#00f;font-weight:700">MessageProvider</span> <span style="color:#0000a2;font-weight:700">getMessageProvider</span>();
}
<span style="color:#06f;font-style:italic">//chapter02/hello-world/src/main/java/com/apress/prospring5/</span>
<span style="color:#06f;font-style:italic">//     ch2/decoupled/StandardOutMessageRenderer.java</span>
<span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">StandardOutMessageRenderer</span>
        <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">MessageRenderer</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">MessageProvider</span> messageProvider;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">StandardOutMessageRenderer</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07"> --&gt;
                StandardOutMessageRenderer:constructor called </span>);
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">render</span>() {
        <span style="color:#00f;font-weight:700">if</span> (messageProvider <span style="color:#00f;font-weight:700">==</span> <span style="color:#585cf6;font-weight:700">null</span>) {
            <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">RuntimeException</span>(
                    <span style="color:#036a07">You must set the property messageProvider of class:</span>
                            <span style="color:#00f;font-weight:700">+</span> <span style="color:#00f;font-weight:700">StandardOutMessageRenderer</span><span style="color:#00f;font-weight:700">.</span>class<span style="color:#00f;font-weight:700">.</span>getName());
        }
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(messageProvider<span style="color:#00f;font-weight:700">.</span>getMessage());
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setMessageProvider</span>(<span style="color:#00f;font-weight:700">MessageProvider</span> <span style="font-style:italic">provider</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07"> --&gt;
                StandardOutMessageRenderer:setting the provider </span>);
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>messageProvider <span style="color:#00f;font-weight:700">=</span> provider;
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">MessageProvider</span> <span style="color:#0000a2;font-weight:700">getMessageProvider</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>messageProvider;
    }
}
</pre>
        <div class="Para" id="Par239">The following configuration snippet depicts the <span id="ITerm102">XML configuration                                  </span> (<span class="EmphasisFontCategoryNonProportional">app-context-xml.xml</span>):</div>
        <pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">messageRenderer</span>
      <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch2.decoupled.StandardOutMessageRenderer</span>
      <span style="font-style:italic">p</span>:messageProvider-ref=<span style="color:#036a07">messageProvider</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">messageProvider</span>
      <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch3.xml.ConfigurableMessageProvider</span>
      <span style="font-style:italic">c</span>:message=<span style="color:#036a07">This is a configurable message</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
        <div class="Para" id="Par241">The class to test this might look pretty familliar as well, as shown here:</div>
        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageRenderer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.ApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.ClassPathXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">JavaConfigXMLExample</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">ApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ClassPathXmlApplicationContext</span>(<span style="color:#036a07">
                classpath:spring / app - context - xml.xml </span>);
        <span style="color:#00f;font-weight:700">MessageRenderer</span> renderer <span style="color:#00f;font-weight:700">=</span>
                ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">messageRenderer</span>, <span style="color:#00f;font-weight:700">MessageRenderer</span><span style="color:#00f;font-weight:700">.</span>class);
        renderer<span style="color:#00f;font-weight:700">.</span>render();
    }
}
</pre>
        <div class="Para" id="Par243">Running this program produces the following <span id="ITerm103">output                                  </span>:</div>
        <div class="Para" id="Par244">
            <div class="ProgramCode" id="PC68">
                <div class="FixedLine">--&gt; StandardOutMessageRenderer: constructor called</div>
                <div class="FixedLine">--&gt; StandardOutMessageRenderer: setting the provider</div>
                <div class="FixedLine">This is a  configurable message</div>
            </div>
        </div>
        <div class="Para" id="Par245">To get rid of the XML configuration, the <span class="EmphasisFontCategoryNonProportional">app-context-xml.xml</span> file must be replaced by a special class, called a <span class="EmphasisTypeItalic">configuration class</span>, that will be
            annotated with <span class="EmphasisFontCategoryNonProportional">@Configuration</span>. The <span class="EmphasisFontCategoryNonProportional">@Configuration</span> annotation is used to inform Spring that this is a Java-based configuration
            file. This class will contain methods annotated with <span class="EmphasisFontCategoryNonProportional">@Bean</span> definitions that represent the bean declarations. The <span class="EmphasisFontCategoryNonProportional">@Bean</span> annotation
            is used to declare a Spring bean and the DI requirements. The <span class="EmphasisFontCategoryNonProportional">@Bean</span> annotation is equivalent to the <span class="EmphasisFontCategoryNonProportional">&lt;bean&gt;</span> tag, the method
            name is equivalent to the <span class="EmphasisFontCategoryNonProportional">id</span> attribute within the <span class="EmphasisFontCategoryNonProportional">&lt;bean&gt;</span> tag, and when instantiating the <span class="EmphasisFontCategoryNonProportional">MessageRender</span>            bean, setter injection is achieved by calling the corresponding method to get the message provider, which is the same as using the <span class="EmphasisFontCategoryNonProportional">&lt;ref&gt;</span> attribute in the XML configuration. These
            annotations and this type of configuration were introduced in previous chapters to make you familiar with them, but they were not covered in detail until now. The following code snippet depicts the <span class="EmphasisFontCategoryNonProportional">AppConfig</span>            contents that are equivalent to the XML configuration previously introduced:</div>
        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageProvider</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageRenderer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.StandardOutMessageRenderer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.xml.ConfigurableMessageProvider</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Bean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Configuration</span>;

@<span style="color:#00f;font-weight:700">Configuration</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AppConfig</span> {
    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">MessageProvider</span> <span style="color:#0000a2;font-weight:700">messageProvider</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ConfigurableMessageProvider</span>();
    }

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">MessageRenderer</span> <span style="color:#0000a2;font-weight:700">messageRenderer</span>() {
        <span style="color:#00f;font-weight:700">MessageRenderer</span> renderer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">StandardOutMessageRenderer</span>();
        renderer<span style="color:#00f;font-weight:700">.</span>setMessageProvider(messageProvider());
        <span style="color:#00f;font-weight:700">return</span> renderer;
    }
}
</pre>
        <div class="Para" id="Par247">The following code snippet shows how to initialize the <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> instance from the Java configuration <span id="ITerm104">file                                  </span>:</div>
        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageRenderer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.ApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.AnnotationConfigApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">JavaConfigExampleOne</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">ApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span>
                <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">AppConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">MessageRenderer</span> renderer <span style="color:#00f;font-weight:700">=</span>
                ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">messageRenderer</span>, <span style="color:#00f;font-weight:700">MessageRenderer</span><span style="color:#00f;font-weight:700">.</span>class);
        renderer<span style="color:#00f;font-weight:700">.</span>render();
    }
}
</pre>
    <div class="Para" id="Par249">From the previous listing, we use the <span class="EmphasisFontCategoryNonProportional">AnnotationConfigApplicationContext</span> class, passing in the configuration class as the constructor argument (you can pass multiple configuration classes to
        it via the JDK varargs feature). Afterward, you can use <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> returned as usual. Sometimes for testing purposes, the configuration class can be declared as a <span id="ITerm105">static internal class                                  </span>,
        as depicted here:</div>
    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageProvider</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageRenderer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.StandardOutMessageRenderer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.xml.ConfigurableMessageProvider</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.ApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.AnnotationConfigApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Bean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Configuration</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">JavaConfigSimpleExample</span> {
    <span style="color:#00f;font-weight:700">@Configuration</span>
    <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AppConfigOne</span> {
        <span style="color:#00f;font-weight:700">@Bean</span>
        <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">MessageProvider</span> <span style="color:#0000a2;font-weight:700">messageProvider</span>() {
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ConfigurableMessageProvider</span>();
        }

        <span style="color:#00f;font-weight:700">@Bean</span>
        <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">MessageRenderer</span> <span style="color:#0000a2;font-weight:700">messageRenderer</span>() {
            <span style="color:#00f;font-weight:700">MessageRenderer</span> renderer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">StandardOutMessageRenderer</span>();
            renderer<span style="color:#00f;font-weight:700">.</span>setMessageProvider(messageProvider());
            <span style="color:#00f;font-weight:700">return</span> renderer;
        }
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">ApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span>
                <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">AppConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">MessageRenderer</span> renderer <span style="color:#00f;font-weight:700">=</span>
                ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">messageRenderer</span>, <span style="color:#00f;font-weight:700">MessageRenderer</span><span style="color:#00f;font-weight:700">.</span>class);
        renderer<span style="color:#00f;font-weight:700">.</span>render();
    }
}
</pre>
    <div class="Para ParaOneEmphasisChild" id="Par251">The <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> instance returned can be used as usual, and the output will be the same as in the case of the XML configured application.</div>
    <div class="Para" id="Par252">
        <div class="ProgramCode" id="PC72">
            <div class="FixedLine"> --&gt; StandardOutMessageRenderer: constructor called</div>
            <div class="FixedLine"> --&gt; StandardOutMessageRenderer: setting the provider</div>
            <div class="FixedLine">Default  message</div>
        </div>
    </div>
    <div class="Para" id="Par253">Having seen the basic usage of a Java configuration class, let’s proceed to more configuration options. For the message provider, let’s say we want to externalize the message into a properties file (<span class="EmphasisFontCategoryNonProportional">message.properties</span>)
        and then inject it into <span class="EmphasisFontCategoryNonProportional">ConfigurableMessageProvider</span> by using constructor injection. The content of <span class="EmphasisFontCategoryNonProportional">message.properties</span> is as follows:</div>
    <div class="Para" id="Par254">
        <div class="ProgramCode" id="PC73">
            <div class="FixedLine">message=Only hope can keep me together</div>
        </div>
        </div>
        <div class="Para" id="Par255">Let’s see the revised testing program, which loads the properties files by using the <span id="ITerm107">                <span class="EmphasisFontCategoryNonProportional">@PropertySource</span> </span> annotation and then injects them into the
            message provider implementation.</div>
        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageProvider</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageRenderer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.StandardOutMessageRenderer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Autowired</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Bean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Configuration</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.PropertySource</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.core.env.Environment</span>;

@<span style="color:#00f;font-weight:700">Configuration</span>
@PropertySource(value <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">classpath:message.properties</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AppConfigOne</span> {
    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">Environment</span> env;

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">MessageProvider</span> <span style="color:#0000a2;font-weight:700">messageProvider</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ConfigurableMessageProvider</span>(env<span style="color:#00f;font-weight:700">.</span>getProperty(<span style="color:#036a07">message</span>));
    }

    <span style="color:#00f;font-weight:700">@Bean</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">messageRenderer</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">MessageRenderer</span> <span style="color:#0000a2;font-weight:700">messageRenderer</span>() {
        <span style="color:#00f;font-weight:700">MessageRenderer</span> renderer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">StandardOutMessageRenderer</span>();
        renderer<span style="color:#00f;font-weight:700">.</span>setMessageProvider(messageProvider());
        <span style="color:#00f;font-weight:700">return</span> renderer;
    }
}
</pre>
        <div class="Para" id="Par257">Configuration classes were introduced in Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Chapter.html"><span class="RefSource">3</span></a>
            </span>
            to show equivalents for XML elements and attributes. Bean declarations can be annotated with other annotations related to bean scopes, loading type, and dependencies. In the following code snippet, the <span id="ITerm109">                <span class="EmphasisFontCategoryNonProportional">AppConfigOne</span>            </span> configuration class is enriched with annotations on bean declarations:</div>
        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageProvider</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageRenderer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.StandardOutMessageRenderer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Autowired</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.*</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.core.env.Environment</span>;

@<span style="color:#00f;font-weight:700">Configuration</span>
@PropertySource(value <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">classpath:message.properties</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AppConfig</span> {
    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">Environment</span> env;

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">@Lazy</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">MessageProvider</span> <span style="color:#0000a2;font-weight:700">messageProvider</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ConfigurableMessageProvider</span>(env<span style="color:#00f;font-weight:700">.</span>getProperty(<span style="color:#036a07">message</span>));
    }

    <span style="color:#00f;font-weight:700">@Bean</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">messageRenderer</span>)
    <span style="color:#00f;font-weight:700">@Scope</span>(<span style="color:#c5060b;font-weight:700">value</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">prototype</span>)
    <span style="color:#00f;font-weight:700">@DependsOn</span>(<span style="color:#c5060b;font-weight:700">value</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">messageProvider</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">MessageRenderer</span> <span style="color:#0000a2;font-weight:700">messageRenderer</span>() {
        <span style="color:#00f;font-weight:700">MessageRenderer</span> renderer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">StandardOutMessageRenderer</span>();
        renderer<span style="color:#00f;font-weight:700">.</span>setMessageProvider(messageProvider());
        <span style="color:#00f;font-weight:700">return</span> renderer;
    }
}
</pre>
        <div class="Para" id="Par259">In the previous code sample, a few annotations were introduced that are explained in Table <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Chapter.html#Tab3">4-3</a></span>.
            Beans that are defined using a stereotype annotation like <span class="EmphasisFontCategoryNonProportional">@</span> <span id="ITerm111">                <span class="EmphasisFontCategoryNonProportional">Component</span> </span>, <span id="ITerm112">                <span class="EmphasisFontCategoryNonProportional">@Service</span>            </span>, and others can be used in a Java configuration class, by enabling component scanning and autowiring them where needed. In the following example, we declare <span class="EmphasisFontCategoryNonProportional">ConfigurableMessageProvider</span>            as a service bean.
            <div class="Table" id="Tab3">
                <div class="Caption" xml:lang="en">
                    <div class="CaptionContent"><span class="CaptionNumber">Table 4-3.</span>
                        <div class="SimplePara">Java Configuration Annotations Table</div>
                    </div>
                </div>
                <table border="1">
                    <colgroup>
                        <col>
                        <col>
                    </colgroup>
                    <thead>
                        <tr class="header">
                            <th>
                                <div class="SimplePara">Annotation</div>
                            </th>
                            <th>
                                <div class="SimplePara">Description</div>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="noclass">
                            <td>
                                <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">@PropertySource</span> </div>
                            </td>
                            <td>
                                <div class="SimplePara">This annotation is used to load properties files into Spring’s <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>, which accepts the location as the argument (more than one location can be provided).
                                    For XML, <span class="EmphasisFontCategoryNonProportional">&lt;context:property-placeholder&gt;</span> serves the same purpose.</div>
                            </td>
                        </tr>
                        <tr class="noclass">
                            <td>
                                <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">@Lazy</span> </div>
                            </td>
                            <td>
                                <div class="SimplePara">This annotation instructs Spring to instantiate the bean only when requested (same as <span class="EmphasisFontCategoryNonProportional">lazy-init=&quot;true&quot;</span> in XML). This annotation has a default <span class="EmphasisFontCategoryNonProportional">value</span>                                    attribute that is <span class="EmphasisFontCategoryNonProportional">true</span> by default; thus, using <span class="EmphasisFontCategoryNonProportional">@Lazy(value=true)</span> is equivalent to using <span class="EmphasisFontCategoryNonProportional">@Lazy</span>.</div>
                            </td>
                        </tr>
                        <tr class="noclass">
                            <td>
                                <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">@Scope</span> </div>
                            </td>
                            <td>
                                <div class="SimplePara">This is used to define the bean scope, when the desired scope is other than singleton.</div>
                            </td>
                        </tr>
                        <tr class="noclass">
                            <td>
                                <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">@DependsOn</span> </div>
                            </td>
                            <td>
                                <div class="SimplePara">This annotation tells Spring that a certain bean depends on some other beans, so Spring will make sure that those beans are instantiated first.</div>
                            </td>
                        </tr>
                        <tr class="noclass">
                            <td>
                                <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">@Autowired</span> </div>
                            </td>
                            <td>
                                <div class="SimplePara">This annotation is used here on the <span class="EmphasisFontCategoryNonProportional">env</span> variable, which is of <span class="EmphasisFontCategoryNonProportional">Environment</span> type. This is the <span class="EmphasisFontCategoryNonProportional">Environment</span>                                    abstraction feature that Spring provides. We discuss it later in this chapter.</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.annotated</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageProvider</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Autowired</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Value</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Service</span>;

@Service(<span style="color:#036a07">provider</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">ConfigurableMessageProvider</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">MessageProvider</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> message;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">ConfigurableMessageProvider</span>(
            @<span style="color:#00f;font-weight:700">Value</span>(&quot;<span style="color:#00f;font-weight:700">Love</span> <span style="font-style:italic">on</span> <span style="font-style:italic">the</span> <span style="font-style:italic">weekend</span>&quot;) String message) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>message <span style="color:#00f;font-weight:700">=</span> message;
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getMessage</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>message;
    }
}
</pre>
        <div class="Para" id="Par261">Here you can see the configuration class</div>
        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageProvider</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageRenderer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.StandardOutMessageRenderer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Autowired</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.*</span>;

@<span style="color:#00f;font-weight:700">Configuration</span>
@ComponentScan(basePackages <span style="color:#00f;font-weight:700">=</span> {<span style="color:#036a07">com.apress.prospring5.ch4.annotated</span>})
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AppConfigTwo</span> {
    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">MessageProvider</span> provider;

    <span style="color:#00f;font-weight:700">@Bean</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">messageRenderer</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">MessageRenderer</span> <span style="color:#0000a2;font-weight:700">messageRenderer</span>() {
        <span style="color:#00f;font-weight:700">MessageRenderer</span> renderer <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">StandardOutMessageRenderer</span>();
        renderer<span style="color:#00f;font-weight:700">.</span>setMessageProvider(provider);
        <span style="color:#00f;font-weight:700">return</span> renderer;
    }
}
</pre>
        <div class="Para" id="Par263"> <span id="ITerm113">                <span class="EmphasisFontCategoryNonProportional">@ComponentScan</span> </span> defines the packages that Spring should scan for annotations for bean definitions. It’s the same as the <span class="EmphasisFontCategoryNonProportional">&lt;context:component-scan&gt;</span>            tag in the XML configuration. Execute the code in the following example:</div>
        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageRenderer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.ApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.AnnotationConfigApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">JavaConfigExampleTwo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">ApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span>
                <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">AppConfigTwo</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">MessageRenderer</span> renderer <span style="color:#00f;font-weight:700">=</span>
                ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">messageRenderer</span>, <span style="color:#00f;font-weight:700">MessageRenderer</span><span style="color:#00f;font-weight:700">.</span>class);
        renderer<span style="color:#00f;font-weight:700">.</span>render();
    }
}
</pre>
        <div class="Para" id="Par265">You will get the following result:</div>
        <div class="Para" id="Par266">
            <div class="ProgramCode" id="PC79">
                <div class="FixedLine"> --&gt; StandardOutMessageRenderer: constructor called</div>
                <div class="FixedLine"> --&gt; StandardOutMessageRenderer: setting the provider</div>
                <div class="FixedLine">Love on the <span id="ITerm114">weekend                                              </span> </div>
            </div>
        </div>
        <div class="Para" id="Par267">An application can also have multiple configuration classes, which can be used decouple configuration and organize beans by purpose (for example, one class can be dedicated to DAO beans declaration, one for the Service beans declaration, and so
            forth). Let’s define the <span class="EmphasisFontCategoryNonProportional">provider</span> bean using another configuration class named <span class="EmphasisFontCategoryNonProportional">AppConfigFour</span>. The bean can be accessed from another
            configuration class by importing the beans defined by this class. This is achieved by annotating the target configuration class <span class="EmphasisFontCategoryNonProportional">AppConfigThree</span> with <span class="EmphasisFontCategoryNonProportional">@Import</span>.</div>
        <pre style="background:#fff;color:#000"><span style="color:#06f;font-style:italic">//AppConfigFour.java</span>
<span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.multiple</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.ComponentScan</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Configuration</span>;

@<span style="color:#00f;font-weight:700">Configuration</span>
@ComponentScan(basePackages <span style="color:#00f;font-weight:700">=</span> {<span style="color:#036a07">com.apress.prospring5.ch4.annotated</span>})
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AppConfigFour</span> {
}
<span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.multiple</span>;
        <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageProvider</span>;
        <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageRenderer</span>;
        <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.StandardOutMessageRenderer</span>;
        <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Autowired</span>;
        <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Bean</span>;
        <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Configuration</span>;
        <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Import</span>;

@<span style="color:#00f;font-weight:700">Configuration</span>
@Import(<span style="color:#00f;font-weight:700">AppConfigFour</span><span style="color:#00f;font-weight:700">.</span>class)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AppConfigThree</span> {
    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">MessageProvider</span> provider;

    <span style="color:#00f;font-weight:700">@Bean</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">messageRenderer</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">MessageRenderer</span> <span style="color:#0000a2;font-weight:700">messageRenderer</span>() {
        <span style="color:#00f;font-weight:700">MessageRenderer</span> renderer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">StandardOutMessageRenderer</span>();
        renderer<span style="color:#00f;font-weight:700">.</span>setMessageProvider(provider);
        <span style="color:#00f;font-weight:700">return</span> renderer;
    }
}
</pre>
            <div class="Para" id="Par269">If in the main method in class <span class="EmphasisFontCategoryNonProportional">JavaConfigExampleTwo</span> you replace the class <span class="EmphasisFontCategoryNonProportional">AppConfigTwo</span> with <span class="EmphasisFontCategoryNonProportional">AppConfigThree</span>,
                then when the example is run, the same output is printed.</div>
            </div>
            <div class="Section2 RenderAsSection2" id="Sec39">
                <h3 class="Heading"> <span id="ITerm115">Spring Mixed Configuration                      </span> </h3>
                <div class="Para" id="Par270">But Spring can do so much more than that. Spring allows mixing XML and Java configuration classes. This is useful when applications come with legacy code that cannot be changed for some reason. To import bean declarations from an XML file,
                    the <span class="EmphasisFontCategoryNonProportional">@ImportResource</span> annotation can be used. In the following configuration snippet, you can see the <span class="EmphasisFontCategoryNonProportional">provider</span> bean declared
                    in an XML file named <span class="EmphasisFontCategoryNonProportional">app-context-xml-01.xml</span>:</div>
                <pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
   <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">provider</span>
            <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch4.ConfigurableMessageProvider</span>
         <span style="font-style:italic">p</span>:message=<span style="color:#036a07">Love on the weekend</span> /&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
                <div class="Para" id="Par272">The next code sample depicts class <span class="EmphasisFontCategoryNonProportional">AppConfigFive</span> where the beans declared in the XML file are imported. If in the main method in <span class="EmphasisFontCategoryNonProportional">classJavaConfigExampleTwo</span>                    we replace class <span class="EmphasisFontCategoryNonProportional">AppConfigTwo</span> with <span class="EmphasisFontCategoryNonProportional">AppConfigFive</span>, then when the example is run, the same output is printed.</div>
                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.mixed</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageProvider</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageRenderer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.StandardOutMessageRenderer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Autowired</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Bean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Configuration</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.ImportResource</span>;

@<span style="color:#00f;font-weight:700">Configuration</span>
@ImportResource(value <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">classpath:spring/app-context-xml-01.xml</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AppConfigFive</span> {
    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">MessageProvider</span> provider;

    <span style="color:#00f;font-weight:700">@Bean</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">messageRenderer</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">MessageRenderer</span> <span style="color:#0000a2;font-weight:700">messageRenderer</span>() {
        <span style="color:#00f;font-weight:700">MessageRenderer</span> renderer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">StandardOutMessageRenderer</span>();
        renderer<span style="color:#00f;font-weight:700">.</span>setMessageProvider(provider);
        <span style="color:#00f;font-weight:700">return</span> renderer;
    }
}
</pre>
            <div class="Para" id="Par274">Also, the reverse can be done as well: beans defined in Java configuration classes can be imported into XML configuration files. In the next example, the <span class="EmphasisFontCategoryNonProportional">messageRenderer</span> bean is defined
                in the XML file, and its dependency, the <span class="EmphasisFontCategoryNonProportional">provider</span> bean, is defined in configuration class <span class="EmphasisFontCategoryNonProportional">AppConfigSix</span>. The contents of the
                XML configuration file, <span class="EmphasisFontCategoryNonProportional">app-context-xml-02.xml</span>, are depicted here:</div>
            <pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">context</span><span style="font-weight:700">:</span><span style="font-weight:700">annotation-config</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch4.mixed.AppConfigSix</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">messageRenderer</span>
            <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch2.decoupled.StandardOutMessageRenderer</span>
          <span style="font-style:italic">p</span>:messageProvider-ref=<span style="color:#036a07">provider</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
            <div class="Para" id="Par276">A bean of the configuration class type must be declared, and support for annotated methods must be enabled using <span class="EmphasisFontCategoryNonProportional">&lt;context:annotation-config/&gt;</span>. This enables for beans declared in
                the class to be configured as dependencies for beans declared in the XML file. The configuration class <span class="EmphasisFontCategoryNonProportional">AppConfigSix</span> is pretty simple.</div>
            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.mixed</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageProvider</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.annotated.ConfigurableMessageProvider</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Bean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Configuration</span>;

@<span style="color:#00f;font-weight:700">Configuration</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AppConfigSix</span> {
    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">MessageProvider</span> <span style="color:#0000a2;font-weight:700">provider</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ConfigurableMessageProvider</span>(<span style="color:#036a07">Love on the weekend</span>);
    }
}
</pre>
            <div class="Para" id="Par278">Creating an <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> instance is done using <span class="EmphasisFontCategoryNonProportional">ClassPathXmlApplicationContext</span>, which has been used a lot until now.</div>
            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.decoupled.MessageRenderer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.mixed.AppConfigFive</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.ApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.AnnotationConfigApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.ClassPathXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">JavaConfigExampleThree</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">ApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> ClassPathXmlApplicationContext
                        (&quot;classpath:spring/app-context-xml-02.xml&quot;);
        <span style="color:#00f;font-weight:700">MessageRenderer</span> renderer <span style="color:#00f;font-weight:700">=</span>
                ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">messageRenderer</span>, <span style="color:#00f;font-weight:700">MessageRenderer</span><span style="color:#00f;font-weight:700">.</span>class);
        renderer<span style="color:#00f;font-weight:700">.</span>render();
    }
}
</pre>
                <div class="Para" id="Par280">Running the previous code yields the same output that was depicted <span id="ITerm117">previously                      </span>.</div>
                <div class="Para ParaTypeImportant" id="Par281"> <img alt="A315511_5_En_4_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Figa_HTML.jpg" width="30"/>                    Application infrastructure services can also be defined in Java configuration classes. For example, <span class="EmphasisFontCategoryNonProportional">@EnableTransactionManagement</span> defines that we will use Spring’s transaction
                    management feature, which is discussed further in Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html"><span class="RefSource">9</span></a>
                    </span>, and <span class="EmphasisFontCategoryNonProportional">@EnableWebSecurity</span> and <span class="EmphasisFontCategoryNonProportional">@EnableGlobalMethodSecurity</span> are used to enable a Spring Security context, which will be
                    discussed more in Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_16_Chapter.html"><span class="RefSource">16</span></a>
                    </span>.</div>
                </div>
                <div class="Section2 RenderAsSection2" id="Sec40">
                    <h3 class="Heading">Java or XML Configuration?</h3>
                    <div class="Para ParaOneEmphasisChild" id="Par282">As you already saw, using Java classes can achieve the same level of <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> configuration as XML. So, which one should you use? The consideration is quite like the
                        one of whether to use XML or Java annotations for DI configuration. Each approach has its own pros and cons. However, the recommendation is the same; that is, when you and your team decide on the approach to use, stick to it and
                        keep the configuration style persistent, instead of scattered around between Java classes and XML files. Using one approach will make the maintenance work much easier.</div>
                </div>
                </div>
                <div class="Section1 RenderAsSection1" id="Sec41">
                    <h2 class="Heading">Profiles</h2>
                    <div class="Para ParaOneEmphasisChild" id="Par283">Another interesting feature that Spring provides is the concept of configuration profiles. Basically, a profile instructs Spring to configure only the <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> instance
                        that was defined when the specified profile was active. In this section, we demonstrate how to use profiles in a simple program.</div>
                    <div class="Section2 RenderAsSection2" id="Sec42">
                        <h3 class="Heading">An Example of Using the Spring Profiles Feature</h3>
                        <div class="Para" id="Par284">Let’s say there is a service called <span id="ITerm118">                <span class="EmphasisFontCategoryNonProportional">FoodProviderService</span> </span> that is responsible for providing food to schools, including kindergarten
                            and high school. The <span class="EmphasisFontCategoryNonProportional">FoodProviderService</span> interface has only one method called <span class="EmphasisFontCategoryNonProportional">provideLunchSet()</span>, which produces
                            the lunch set to each student for the calling school. A lunch set is a list of <span class="EmphasisFontCategoryNonProportional">Food</span> objects, which is a simple class that has only a <span class="EmphasisFontCategoryNonProportional">name</span>                            attribute. The following code snippet shows the <span class="EmphasisFontCategoryNonProportional">Food</span> class:</div>
                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Food</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> name;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">Food</span>() {
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">Food</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">name</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>name <span style="color:#00f;font-weight:700">=</span> name;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getName</span>() {
        <span style="color:#00f;font-weight:700">return</span> name;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setName</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">name</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>name <span style="color:#00f;font-weight:700">=</span> name;
    }
}
</pre>
                        <div class="Para ParaOneEmphasisChild" id="Par286">And here is the <span class="EmphasisFontCategoryNonProportional">FoodProviderService</span> interface:</div>
                        <div class="Para" id="Par287">
                            <div class="ProgramCode" id="PC87">
                                <div class="LineGroup">
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">FoodProviderService</span> {
    <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Food</span>&gt;</span> <span style="color:#0000a2;font-weight:700">provideLunchSet</span>();
}
</pre>
                                </div>
                            </div>
                        </div>
                        <div class="Para ParaOneEmphasisChild" id="Par288">Now suppose that there are two providers for the lunch set, one for kindergarten and one for high school. The lunch set produced by them is different, although the service they provide is the same, that is, to provide lunch to
                            students. So, now let’s create two implementations of <span class="EmphasisFontCategoryNonProportional">FoodProviderService</span>, using the same name but putting them into different packages to identify their target school.
                            The two classes are shown here:</div>
                        <pre style="background:#fff;color:#000"><span style="color:#06f;font-style:italic">//chapter04/profiles/src/main/java/com/apress/prospring5/ch4/</span>

highschool<span style="color:#00f;font-weight:700">/</span><span style="color:#00f;font-weight:700">FoodProviderServiceImpl</span><span style="color:#00f;font-weight:700">.</span>java
        <span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.highschool</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.ArrayList</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.Food</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.FoodProviderService</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">FoodProviderServiceImpl</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">FoodProviderService</span> {
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Food</span>&gt;</span> <span style="color:#0000a2;font-weight:700">provideLunchSet</span>() {
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Food</span>&gt;</span> lunchSet <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ArrayList&lt;&gt;</span>();
        lunchSet<span style="color:#00f;font-weight:700">.</span>add(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Food</span>(<span style="color:#036a07">Coke</span>));
        lunchSet<span style="color:#00f;font-weight:700">.</span>add(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Food</span>(<span style="color:#036a07">Hamburger</span>));
        lunchSet<span style="color:#00f;font-weight:700">.</span>add(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Food</span>(<span style="color:#036a07">French Fries</span>));
        <span style="color:#00f;font-weight:700">return</span> lunchSet;
    }
}
<span style="color:#06f;font-style:italic">//chapter04/profiles/src/main/java/com/apress/prospring5/ch4/</span>
        kindergarten<span style="color:#00f;font-weight:700">/</span><span style="color:#00f;font-weight:700">FoodProviderServiceImpl</span><span style="color:#00f;font-weight:700">.</span>java
                <span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.kindergarten</span>;
                <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.ArrayList</span>;
                <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;
                <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.Food</span>;
                <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.FoodProviderService</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">FoodProviderServiceImpl</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">FoodProviderService</span> {
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Food</span>&gt;</span> <span style="color:#0000a2;font-weight:700">provideLunchSet</span>() {
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Food</span>&gt;</span> lunchSet <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ArrayList&lt;&gt;</span>();
        lunchSet<span style="color:#00f;font-weight:700">.</span>add(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Food</span>(<span style="color:#036a07">Milk</span>));
        lunchSet<span style="color:#00f;font-weight:700">.</span>add(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Food</span>(<span style="color:#036a07">Biscuits</span>));
        <span style="color:#00f;font-weight:700">return</span> lunchSet;
    }
}
</pre>
                        <div class="Para ParaOneEmphasisChild" id="Par290">From the previous listings, you can see that the two implementations provide the same <span class="EmphasisFontCategoryNonProportional">FoodProviderService</span> interface but produce different combinations of food in the lunch
                            set. So, now suppose a kindergarten wants the provider to deliver the lunch set for their students; let’s see how we can use Spring’s profile configuration to achieve this. We will run through the XML configuration first. We
                            will create two XML configuration files, one for the kindergarten profile and the other for the high-school profile. The following configuration snippet depicts the two profile configurations:</div>
                        <pre style="background:#fff;color:#000"><span style="color:#06f;font-style:italic">&lt;!-- highschool-config.xml --&gt;</span>
<span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> <span style="font-style:italic">xmlns</span>=<span style="color:#036a07">http://www.springframework.org/schema/beans</span>
    <span style="font-style:italic">xmlns</span>:xsi=<span style="color:#036a07">http://www.w3.org/2001/XMLSchema-instance</span>
    <span style="font-style:italic">xsi</span>:schemaLocation=<span style="color:#036a07">http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span style="font-style:italic">profile</span>=<span style="color:#036a07">highschool</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">foodProviderService</span>
      <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch4.highschool.FoodProviderServiceImpl</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
<span style="color:#06f;font-style:italic">&lt;!-- kindergarten-config.xml --&gt;</span>
<span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> <span style="font-style:italic">xmlns</span>=<span style="color:#036a07">http://www.springframework.org/schema/beans</span>
    <span style="font-style:italic">xmlns</span>:xsi=<span style="color:#036a07">http://www.w3.org/2001/XMLSchema-instance</span>
    <span style="font-style:italic">xsi</span>:schemaLocation=<span style="color:#036a07">http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span style="font-style:italic">profile</span>=<span style="color:#036a07">kindergarten</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">foodProviderService</span>
      <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch4.kindergarten.FoodProviderServiceImpl</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
                        <div class="Para" id="Par292">In the previous two configurations, notice the usage of <span class="EmphasisFontCategoryNonProportional">profile=&quot;kindergarten&quot;</span> and <span class="EmphasisFontCategoryNonProportional">profile=&quot;highschool&quot;</span>, respectively,
                            within the <span class="EmphasisFontCategoryNonProportional">&lt;beans&gt;</span> tag. It actually tells Spring that those beans in the file should be instantiated only when the specified profile is active. Now let’s see how
                            to activate the correct profile when using Spring’s <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> in a stand-alone application. The following code snippet shows the testing program:</div>
                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">ProfileXmlConfigExample</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/*-config.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">FoodProviderService</span> foodProviderService <span style="color:#00f;font-weight:700">=</span>
                ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">foodProviderService</span>, <span style="color:#00f;font-weight:700">FoodProviderService</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Food</span>&gt;</span> lunchSet <span style="color:#00f;font-weight:700">=</span> foodProviderService<span style="color:#00f;font-weight:700">.</span>provideLunchSet();
        <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">Food</span> food <span style="color:#00f;font-weight:700">:</span> lunchSet) {
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Food: </span> <span style="color:#00f;font-weight:700">+</span> food<span style="color:#00f;font-weight:700">.</span>getName());
        }
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                        <div class="Para" id="Par294">The <span class="EmphasisFontCategoryNonProportional">ctx.load()</span> method will load both <span class="EmphasisFontCategoryNonProportional">kindergarten-config.xml</span> and <span class="EmphasisFontCategoryNonProportional">highschool-config.xml</span>,
                            since we pass the method the wildcard as the prefix. In this example, only the beans in the file <span class="EmphasisFontCategoryNonProportional">kindergarten-config.xml</span> will be instantiated by the Spring based on the
                            <span class="EmphasisFontCategoryNonProportional">profile</span> attribute, which is activated by passing the JVM argument <span class="EmphasisFontCategoryNonProportional">-Dspring.profiles.active=&quot;kindergarten&quot;</span>. Running
                            the program with this JVM argument produces the following output:</div>
                        <div class="Para" id="Par295">
                            <div class="ProgramCode" id="PC91">
                                <div class="FixedLine">Food: Milk</div>
                                <div class="FixedLine">Food: Biscuits</div>
                            </div>
                        </div>
                        <div class="Para ParaOneEmphasisChild" id="Par296">This is exactly what the implementation of the kindergarten provider will produce for the lunch set. Now change the profile argument from the previous listing to high school (<span class="EmphasisFontCategoryNonProportional">-Dspring.profiles.active=&quot;highschool&quot;</span>),
                            and the output will change to the following:</div>
                        <div class="Para" id="Par297">
                            <div class="ProgramCode" id="PC92">
                                <div class="FixedLine">Food: Coke</div>
                                <div class="FixedLine">Food: Hamburger</div>
                                <div class="FixedLine">Food: French Fries</div>
                            </div>
                        </div>
                        <div class="Para" id="Par298">You can also programmatically set the profile to use in your code by calling <span class="EmphasisFontCategoryNonProportional">ctx.getEnvironment().setActiveProfiles(&quot;kindergarten&quot;)</span>. Additionally, you can register classes
                            to be enabled by profiles using Java Config by simply adding the <span class="EmphasisFontCategoryNonProportional">@Profile</span> annotation to your class.</div>
                    </div>
                </div>
                <div class="Section1 RenderAsSection1" id="Sec43">
                    <h2 class="Heading">Spring Profiles Using <span id="ITerm122">Java Configuration                  </span> </h2>
                    <div class="Para ParaOneEmphasisChild" id="Par299">Of course, there is a way to configure Spring profiles using Java configuration because developers who do not like XML configuration should get satisfaction as well. The XML files declared in the previous section have to be replaced
                        with the equivalent Java configuration classes. This is how the configuration class for a <span class="EmphasisFontCategoryNonProportional">kindergarten</span> profile looks:</div>
                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.config</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.FoodProviderService</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.kindergarten.FoodProviderServiceImpl</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Bean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Configuration</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Profile</span>;

@<span style="color:#00f;font-weight:700">Configuration</span>
@Profile(<span style="color:#036a07">kindergarten</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">KindergartenConfig</span> {
    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">FoodProviderService</span> <span style="color:#0000a2;font-weight:700">foodProviderService</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">FoodProviderServiceImpl</span>();
    }
}
</pre>
                    <div class="Para" id="Par301">As you can see, a <span class="EmphasisFontCategoryNonProportional">foodProviderService</span> bean is defined using the <span class="EmphasisFontCategoryNonProportional">@Bean</span> annotation. The class is marked as specific to
                        the <span class="EmphasisFontCategoryNonProportional">kindergarten</span> profile using the <span class="EmphasisFontCategoryNonProportional">@Profile</span> annotation. The class specific to the <span class="EmphasisFontCategoryNonProportional">highschool</span>                        profile is identical, except for the bean type, the profile name, and the class name, <span id="ITerm123">obviously                  </span>.</div>
                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.config</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.FoodProviderService</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.highschool.FoodProviderServiceImpl</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Bean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Configuration</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Profile</span>;

@<span style="color:#00f;font-weight:700">Configuration</span>
@Profile(<span style="color:#036a07">highschool</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">HighschoolConfig</span> {
    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">FoodProviderService</span> <span style="color:#0000a2;font-weight:700">foodProviderService</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">FoodProviderServiceImpl</span>();
    }
}
</pre>
                    <div class="Para" id="Par303">These classes are used in the same way the XML files are. A context is declared to use both of them, and only one of them will actually be used to create the <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>                        instance depending on the value of the <span class="EmphasisFontCategoryNonProportional">-Dspring.profiles.active</span> JVM option.</div>
                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.config</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.Food</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.FoodProviderService</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.AnnotationConfigApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericApplicationContext</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">ProfileJavaConfigExample</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(
                        <span style="color:#00f;font-weight:700">KindergartenConfig</span><span style="color:#00f;font-weight:700">.</span>class,
                        <span style="color:#00f;font-weight:700">HighschoolConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">FoodProviderService</span> foodProviderService <span style="color:#00f;font-weight:700">=</span>
                ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">foodProviderService</span>,
                        <span style="color:#00f;font-weight:700">FoodProviderService</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Food</span>&gt;</span> lunchSet <span style="color:#00f;font-weight:700">=</span> foodProviderService<span style="color:#00f;font-weight:700">.</span>provideLunchSet();
        <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">Food</span> food <span style="color:#00f;font-weight:700">:</span> lunchSet) {
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Food: </span> <span style="color:#00f;font-weight:700">+</span> food<span style="color:#00f;font-weight:700">.</span>getName());
        }
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                    <div class="Para" id="Par305">By running the previous example with <span class="EmphasisFontCategoryNonProportional">kindergarten</span> as the value for the <span class="EmphasisFontCategoryNonProportional">-Dspring.profiles.active</span> JVM option, the expected
                        output is <span id="ITerm124">printed                  </span>.</div>
                    <div class="Para" id="Par306">
                        <div class="ProgramCode" id="PC96">
                            <div class="FixedLine">Food: Milk</div>
                            <div class="FixedLine">Food: Biscuits</div>
                        </div>
                    </div>
                    <div class="Para" id="Par307">There is also an annotation for configuring used profiles that replaces the <span class="EmphasisFontCategoryNonProportional">-Dspring.profiles.active</span> JVM option, but this can be used only on test classes. As testing Spring
                        applications is covered in Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_13_Chapter.html"><span class="RefSource">13</span></a>
                        </span>, it won’t be covered in detail here. But some sample code is included.</div>
                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.config</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.FoodProviderService</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Test</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.runner.RunWith</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Autowired</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.test.context.ActiveProfiles</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.test.context.ContextConfiguration</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.test.context.junit4.SpringJUnit4ClassRunner</span>;

<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">org.junit.Assert.assertEquals</span>;
<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">org.junit.Assert.assertFalse</span>;
<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">org.junit.Assert.assertTrue</span>;

@RunWith(<span style="color:#00f;font-weight:700">SpringJUnit4ClassRunner</span><span style="color:#00f;font-weight:700">.</span>class)
@ContextConfiguration(classes <span style="color:#00f;font-weight:700">=</span> {<span style="color:#00f;font-weight:700">KindergartenConfig</span><span style="color:#00f;font-weight:700">.</span>class,
        <span style="color:#00f;font-weight:700">HighschoolConfig</span><span style="color:#00f;font-weight:700">.</span>class})
@ActiveProfiles(<span style="color:#036a07">kindergarten</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">ProfilesJavaConfigTest</span> {
    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">FoodProviderService</span> foodProviderService;

    <span style="color:#00f;font-weight:700">@Test</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">testProvider</span>() {
        assertTrue(foodProviderService<span style="color:#00f;font-weight:700">.</span>provideLunchSet() <span style="color:#00f;font-weight:700">!=</span> <span style="color:#585cf6;font-weight:700">null</span>);
        assertFalse(foodProviderService<span style="color:#00f;font-weight:700">.</span>provideLunchSet()<span style="color:#00f;font-weight:700">.</span>isEmpty());
        assertEquals(<span style="color:#0000cd">2</span>, foodProviderService<span style="color:#00f;font-weight:700">.</span>provideLunchSet()<span style="color:#00f;font-weight:700">.</span>size());
    }
}
</pre>
                    <div class="Para" id="Par309">As you have probably figured out <span id="ITerm125">yourself                  </span>, the annotation that specifies which profile is used to run this test is <span class="EmphasisFontCategoryNonProportional">@ActiveProfiles(&quot;kindergarten&quot;)</span>.
                        In complex applications, usually there is more than one profile, and more of them can be used to compose the context configuration for a test. This class can be run in any Java smart editor and is automatically run when executing
                        <span class="EmphasisFontCategoryNonProportional">gradle clean build</span>.</div>
                    <div class="Section2 RenderAsSection2" id="Sec44">
                        <h3 class="Heading">Considerations for Using Profiles</h3>
                        <div class="Para" id="Par310">The profiles feature in Spring creates another way for developers to manage the application’s running configuration, which used to be done in build tools (for example, Maven’s profile support). Build tools rely on the arguments
                            passed into the tool to pack the correct configuration/property files into the Java archive (JAR or WAR, depending on the application type) and then deploy to the target environment. Spring’s profile feature lets us as an application
                            developer define the profiles by yourself and activate them either programmatically or by passing in the JVM argument. By using Spring’s profile support, you can now use the same application archive and deploy to all environments
                            by passing in the correct profiles as an argument during JVM startup. For example, you can have applications with different profiles such as <span class="EmphasisFontCategoryNonProportional">(dev, hibernate)</span>, <span class="EmphasisFontCategoryNonProportional">(prd, jdbc)</span>,
                            and so on, with each combination representing the running environment (development or production) and the data access library to use (Hibernate or JDBC). It brings application profile management into the programming side.</div>
                        <div class="Para" id="Par311">But this approach also has its drawbacks. For example, some may argue that putting all the configurations for different environments into application configuration files or Java classes and bundling them together will be error
                            prone if not handled carefully (for example, the administrator may forget to set the correct JVM argument in the application server environment). Packing files for all profiles together will also make the package a bit larger
                            than usual. Again, let the application and configuration requirements drive you to select the approach that best fits your project.</div>
                </div>
                </div>
                <div class="Section1 RenderAsSection1" id="Sec45">
                    <h2 class="Heading">Environment and PropertySource <span id="ITerm126">Abstraction                  </span> </h2>
                    <div class="Para" id="Par312">To set the active profile, we need to access the <span class="EmphasisFontCategoryNonProportional">Environment</span> interface. The <span class="EmphasisFontCategoryNonProportional">Environment</span> interface is an abstraction layer
                        that serves to encapsulate the environment of the running Spring application.</div>
                    <div class="Para ParaOneEmphasisChild" id="Par313">Besides the profile, other key pieces of information encapsulated by the <span class="EmphasisFontCategoryNonProportional">Environment</span> interface are properties. Properties are used to store the application’s underlying environment
                        configuration, such as the location of the application folder, database connection information, and so on.</div>
                    <div class="Para" id="Par314">The <span class="EmphasisFontCategoryNonProportional">Environment</span> and <span class="EmphasisFontCategoryNonProportional">PropertySource</span> abstraction features in Spring assist developers in accessing various configuration
                        information from the running platform. Under the abstraction, all system properties, environment variables, and application properties are served by the <span class="EmphasisFontCategoryNonProportional">Environment</span> interface,
                        which Spring populates when bootstrapping <span id="ITerm127">              <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> </span>. The following code snippet shows a simple example:</div>
                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.HashMap</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Map</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.core.env.ConfigurableEnvironment</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.core.env.MapPropertySource</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.core.env.MutablePropertySources</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">EnvironmentSample</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">ConfigurableEnvironment</span> env <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getEnvironment();
        <span style="color:#00f;font-weight:700">MutablePropertySources</span> propertySources <span style="color:#00f;font-weight:700">=</span> env<span style="color:#00f;font-weight:700">.</span>getPropertySources();
        <span style="color:#00f;font-weight:700">Map&lt;<span style="color:#00f;font-weight:700">String</span>, <span style="color:#00f;font-weight:700">Object</span>&gt;</span> appMap <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HashMap&lt;&gt;</span>();
        appMap<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">user.home</span>, <span style="color:#036a07">application_home</span>);
        propertySources<span style="color:#00f;font-weight:700">.</span>addLast(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">MapPropertySource</span>(<span style="color:#036a07">prospring5_MAP</span>, appMap));
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">user.home: </span> <span style="color:#00f;font-weight:700">+</span> <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>getProperty(<span style="color:#036a07">user.home</span>));
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">JAVA_HOME: </span> <span style="color:#00f;font-weight:700">+</span> <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>getenv(<span style="color:#036a07">JAVA_HOME</span>));
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">user.home: </span> <span style="color:#00f;font-weight:700">+</span> env<span style="color:#00f;font-weight:700">.</span>getProperty(<span style="color:#036a07">user.home</span>));
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">JAVA_HOME: </span> <span style="color:#00f;font-weight:700">+</span> env<span style="color:#00f;font-weight:700">.</span>getProperty(<span style="color:#036a07">JAVA_HOME</span>));
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                    <div class="Para" id="Par316">In the previous code snippet, after the <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> initialization, we get a reference to the <span class="EmphasisFontCategoryNonProportional">ConfigurableEnvironment</span>                        interface. Via the interface, a handle to <span class="EmphasisFontCategoryNonProportional">MutablePropertySources</span> (a default implementation of the <span class="EmphasisFontCategoryNonProportional">PropertySources</span>                        interface, which allows manipulation of the contained property sources) is obtained. Afterward, we construct a map, put the application properties into the map, and then construct a <span class="EmphasisFontCategoryNonProportional">MapPropertySource</span>                        class (a <span class="EmphasisFontCategoryNonProportional">PropertySource</span> subclass that reads keys and values from a <span class="EmphasisFontCategoryNonProportional">Map</span> instance) with the map. Finally, the
                        <span class="EmphasisFontCategoryNonProportional">MapPropertySource</span> class is added to <span class="EmphasisFontCategoryNonProportional">MutablePropertySources</span> via the <span class="EmphasisFontCategoryNonProportional">addLast()</span> method. Run the program, and
                            the following prints:</div>
                    <div class="Para" id="Par317">
                        <div class="ProgramCode" id="PC99">
                            <div class="FixedLine">user.home: /home/jules</div>
                            <div class="FixedLine">JAVA_HOME: /home/jules/bin/java</div>
                            <div class="FixedLine">user.home: /home/jules</div>
                            <div class="FixedLine">JAVA_HOME: /home/jules/bin/java</div>
                            <div class="FixedLine">application.home:  application_home</div>
                        </div>
                    </div>
                    <div class="Para" id="Par318">For the first two lines, the JVM system property <span class="EmphasisFontCategoryNonProportional">user.home</span> and the environment variable <span class="EmphasisFontCategoryNonProportional">JAVA_HOME</span> are retrieved, as before
                        (by using the JVM’s <span class="EmphasisFontCategoryNonProportional">System</span> class). However, for the last three lines, you can see that all the system properties, environment variables, and application properties can be
                        accessed via the <span class="EmphasisFontCategoryNonProportional">Environment</span> interface. You can see how the <span class="EmphasisFontCategoryNonProportional">Environment</span> abstraction can help us manage and access
                        all the various properties within the application’s running environment.</div>
                    <div class="Para" id="Par319">For the <span class="EmphasisFontCategoryNonProportional">PropertySource</span> abstraction, Spring will access the properties in the following default order:
                        <div class="UnorderedList">
                            <ul class="UnorderedListMarkBullet">
                                <li>
                                    <div class="Para" id="Par320">System properties for the running JVM</div>
                                </li>
                                <li>
                                    <div class="Para" id="Par321">Environment variables</div>
                                </li>
                                <li>
                                    <div class="Para" id="Par322">Application-defined properties</div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="Para" id="Par323">So, for example, suppose we define the same application property, <span class="EmphasisFontCategoryNonProportional">user.home</span>, and add it to the <span class="EmphasisFontCategoryNonProportional">Environment</span> interface
                        via the <span id="ITerm128">              <span class="EmphasisFontCategoryNonProportional">MutablePropertySources</span> </span> class. If you run the program, you will still see that <span class="EmphasisFontCategoryNonProportional">user.home</span>                        is retrieved from the JVM properties, not yours. However, Spring allows you to control the order in which <span class="EmphasisFontCategoryNonProportional">Environment</span> retrieves the properties. The following code snippet
                        shows the revised version:</div>
                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.HashMap</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Map</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.core.env.ConfigurableEnvironment</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.core.env.MapPropertySource</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.core.env.MutablePropertySources</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">EnvironmentSample</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">ConfigurableEnvironment</span> env <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getEnvironment();
        <span style="color:#00f;font-weight:700">MutablePropertySources</span> propertySources <span style="color:#00f;font-weight:700">=</span> env<span style="color:#00f;font-weight:700">.</span>getPropertySources();
        <span style="color:#00f;font-weight:700">Map&lt;<span style="color:#00f;font-weight:700">String</span>, <span style="color:#00f;font-weight:700">Object</span>&gt;</span> appMap <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HashMap&lt;&gt;</span>();
        appMap<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">application.home</span>, <span style="color:#036a07">application_home</span>);
        propertySources<span style="color:#00f;font-weight:700">.</span>addFirst(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">MapPropertySource</span>(<span style="color:#036a07">prospring5_MAP</span>, appMap));
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">user.home: </span> <span style="color:#00f;font-weight:700">+</span> <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>getProperty(<span style="color:#036a07">user.home</span>));
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">JAVA_HOME: </span> <span style="color:#00f;font-weight:700">+</span> <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>getenv(<span style="color:#036a07">JAVA_HOME</span>));
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">user.home: </span> <span style="color:#00f;font-weight:700">+</span> env<span style="color:#00f;font-weight:700">.</span>getProperty(<span style="color:#036a07">user.home</span>));
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">JAVA_HOME: </span> <span style="color:#00f;font-weight:700">+</span> env<span style="color:#00f;font-weight:700">.</span>getProperty(<span style="color:#036a07">JAVA_HOME</span>));
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                    <div class="Para" id="Par325">In the previous code sample, we have defined an application property also called <span class="EmphasisFontCategoryNonProportional">user.home</span> and added it as the first one to search for via the <span class="EmphasisFontCategoryNonProportional">addFirst()</span>                        method of the <span id="ITerm129">              <span class="EmphasisFontCategoryNonProportional">MutablePropertySources</span> </span> class. When you run the program, you will see the following output:</div>
                    <div class="Para" id="Par326">
                        <div class="ProgramCode" id="PC101">
                            <div class="FixedLine">user.home: /home/jules</div>
                            <div class="FixedLine">JAVA_HOME: /home/jules/bin/java</div>
                            <div class="FixedLine">user.home: application_home</div>
                            <div class="FixedLine">JAVA_HOME: /home/jules/bin/java</div>
                        </div>
                    </div>
                    <div class="Para" id="Par327">The first two lines remain the same because we still use the <span class="EmphasisFontCategoryNonProportional">getProperty()</span> and <span class="EmphasisFontCategoryNonProportional">getenv()</span> methods of the JVM <span class="EmphasisFontCategoryNonProportional">System</span>                        class to retrieve them. However, when using the <span class="EmphasisFontCategoryNonProportional">Environment</span> interface, you will see that the <span class="EmphasisFontCategoryNonProportional">user.home</span> property we
                        defined takes precedence since we defined it as the first one to search for property values.</div>
                    <div class="Para" id="Par328">In real life, you seldom need to interact directly with the <span class="EmphasisFontCategoryNonProportional">Environment</span> interface but will use a property placeholder in the form of <span class="EmphasisFontCategoryNonProportional">${}</span>                        (for example, <span class="EmphasisFontCategoryNonProportional">${application.home}</span>) and inject the resolved value into Spring beans. Let’s see this in action. Suppose we had a class to store all the application properties
                        loaded from a property file. The following shows the <span id="ITerm130">              <span class="EmphasisFontCategoryNonProportional">AppProperty</span> </span> class:</div>
                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AppProperty</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> applicationHome;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> userHome;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getApplicationHome</span>() {
        <span style="color:#00f;font-weight:700">return</span> applicationHome;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setApplicationHome</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">applicationHome</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>applicationHome <span style="color:#00f;font-weight:700">=</span> applicationHome;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getUserHome</span>() {
        <span style="color:#00f;font-weight:700">return</span> userHome;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setUserHome</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">userHome</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>userHome <span style="color:#00f;font-weight:700">=</span> userHome;
    }
}
</pre>
                    <div class="Para ParaOneEmphasisChild" id="Par330">Here you can see the contents of the <span class="EmphasisFontCategoryNonProportional">application.properties</span> file:</div>
                    <div class="Para" id="Par331">
                        <div class="ProgramCode" id="PC103">
                            <div class="FixedLine">application.home=application_home</div>
                            <div class="FixedLine">user.home=/home/jules-new</div>
                        </div>
                    </div>
                    <div class="Para" id="Par332">Note that the property file also declares the <span class="EmphasisFontCategoryNonProportional">user.home property</span>. Let’s take a look at the Spring XML configuration; see the following code (<span class="EmphasisFontCategoryNonProportional">app-context-xml.xml</span>):</div>
                    <pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> <span style="font-style:italic">xmlns</span>=<span style="color:#036a07">http://www.springframework.org/schema/beans</span>
       <span style="font-style:italic">xmlns</span>:xsi=<span style="color:#036a07">http://www.w3.org/2001/XMLSchema-instance</span>
       <span style="font-style:italic">xmlns</span>:context=<span style="color:#036a07">http://www.springframework.org/schema/context</span>
       <span style="font-style:italic">xmlns</span>:p=<span style="color:#036a07">http://www.springframework.org/schema/p</span>
       <span style="font-style:italic">xsi</span>:schemaLocation=<span style="color:#036a07">http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">context</span><span style="font-weight:700">:</span><span style="font-weight:700">property-placeholder</span>
         <span style="font-style:italic">location</span>=<span style="color:#036a07">classpath:application.properties</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">appProperty</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch4.AppProperty</span>
          <span style="font-style:italic">p</span>:applicationHome=<span style="color:#036a07">${application.home}</span>
          <span style="font-style:italic">p</span>:userHome=<span style="color:#036a07">${user.home}</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
                <div class="Para" id="Par334">We use the <span class="EmphasisFontCategoryNonProportional">&lt;context:property-placeholder&gt;</span> tag to load the properties into Spring’s <span class="EmphasisFontCategoryNonProportional">Environment</span>, which is wrapped into
                    the <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> interface. We also use the SpEL placeholders to inject the values into the <span class="EmphasisFontCategoryNonProportional">AppProperty</span> bean. The
                    following code snippet shows the testing program:</div>
                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">PlaceHolderDemo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-xml.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">AppProperty</span> appProperty <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">appProperty</span>,
                <span style="color:#00f;font-weight:700">AppProperty</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">application.home: </span> <span style="color:#00f;font-weight:700">+</span>
                appProperty<span style="color:#00f;font-weight:700">.</span>getApplicationHome());
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">user.home: </span> <span style="color:#00f;font-weight:700">+</span>
                appProperty<span style="color:#00f;font-weight:700">.</span>getUserHome());
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                <div class="Para" id="Par336">Let’s run the program, and you will see the following output:</div>
                <div class="Para" id="Par337">
                    <div class="ProgramCode" id="PC106">
                        <div class="FixedLine">application.home: application_home</div>
                        <div class="FixedLine">user.home: /Users/jules</div>
                    </div>
                </div>
                <div class="Para" id="Par338">You will see the <span class="EmphasisFontCategoryNonProportional">application.home</span> placeholder is properly resolved, while the <span class="EmphasisFontCategoryNonProportional">user.home</span> property is still retrieved from
                    the JVM properties, which is correct because it’s the default behavior for the <span class="EmphasisFontCategoryNonProportional">PropertySource</span> abstraction. To instruct Spring to give precedence for the values in the <span class="EmphasisFontCategoryNonProportional">application.properties</span>                    file, we add the attribute <span class="EmphasisFontCategoryNonProportional">local-override=&quot;true&quot;</span> to the <span class="EmphasisFontCategoryNonProportional">&lt;context:property-placeholder&gt;</span> tag.</div>
                <div class="Para" id="Par339">
                    <div class="ProgramCode" id="PC107">
                        <div class="FixedLine">&lt;context:property-placeholder local-override=&quot;true&quot;</div>
                        <div class="FixedLine">    location=&quot;classpath:env/application.properties&quot;/&gt;</div>
                    </div>
                </div>
                <div class="Para" id="Par340">The <span class="EmphasisFontCategoryNonProportional">local-override</span> attribute instructs Spring to override the existing properties with the properties defined in this placeholder. Run the program, and you will see that now the
                    <span class="EmphasisFontCategoryNonProportional">user.home</span> property from the <span class="EmphasisFontCategoryNonProportional">application.properties</span> file is retrieved.</div>
                <div class="Para" id="Par341">
                    <div class="ProgramCode" id="PC108">
                        <div class="FixedLine">application.home: application_home</div>
                        <div class="FixedLine">user.home: /home/jules-new</div>
                    </div>
                </div>
                </div>
                <div class="Section1 RenderAsSection1" id="Sec46">
                    <h2 class="Heading">Configuration Using JSR-330 Annotations</h2>
                    <div class="Para" id="Par342">As we discussed in Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_1_Chapter.html"><span class="RefSource">1</span></a>
                        </span>, JEE 6 provides support for JSR-330 (Dependency Injection for Java), which is a collection of annotations for expressing an application’s DI configuration within a JEE container or other compatible IoC framework. Spring also supports
                        and recognizes those annotations, so although you may not be running your application in a JEE 6 container, you can still use JSR-330 annotations within Spring. Using JSR-330 annotations can help you ease the migration to the JEE
                        6 container or other compatible IoC container (for example, Google Guice) away from Spring.</div>
                    <div class="Para" id="Par343">Again, let’s take the message renderer and message provider as an example and implement it using JSR-330 annotations. To support JSR-330 annotations, you need to add the <span class="EmphasisFontCategoryNonProportional">javax.inject</span>                        <a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Chapter.html#Fn3" id="Fn3_source"><sup>3</sup></a> dependency to the project.</div>
                    <div class="Para" id="Par345">The following code snippet shows the <span id="ITerm132">          <span class="EmphasisFontCategoryNonProportional">MessageProvider</span> and <span class="EmphasisFontCategoryNonProportional">ConfigurableMessageProvider</span> </span>
                        implementation:</div>
                    <pre style="background:#fff;color:#000"><span style="color:#06f;font-style:italic">//chapter04/jsr330/src/main/java/com/apress/prospring5/</span>
     ch4<span style="color:#00f;font-weight:700">/</span><span style="color:#00f;font-weight:700">MessageProvider</span><span style="color:#00f;font-weight:700">.</span>java
             <span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">MessageProvider</span> {
    <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getMessage</span>();
}
<span style="color:#06f;font-style:italic">//chapter04/jsr330/src/main/java/com/apress/prospring5/</span>
   ch4<span style="color:#00f;font-weight:700">/</span><span style="color:#00f;font-weight:700">ConfigurableMessageProvider</span><span style="color:#00f;font-weight:700">.</span>java
           <span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;
           <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.inject.Inject</span>;
           <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.inject.Named</span>;

@Named(<span style="color:#036a07">messageProvider</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">ConfigurableMessageProvider</span>
        <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">MessageProvider</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> message <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">Default  message</span>;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">ConfigurableMessageProvider</span>() {
    }

    <span style="color:#00f;font-weight:700">@Inject</span>
    <span style="color:#00f;font-weight:700">@Named</span>(<span style="color:#036a07">message</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">ConfigurableMessageProvider</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">message</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>message <span style="color:#00f;font-weight:700">=</span> message;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setMessage</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">message</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>message <span style="color:#00f;font-weight:700">=</span> message;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getMessage</span>() {
        <span style="color:#00f;font-weight:700">return</span> message;
    }
}
</pre>
                    <div class="Para" id="Par347">You will notice that all annotations belong to the <span class="EmphasisFontCategoryNonProportional">javax.inject package</span>, which is the JSR-330 standard. This class used <span class="EmphasisFontCategoryNonProportional">@Named</span>                        in two places. First, it can be used to declare an injectable bean (the same as the <span class="EmphasisFontCategoryNonProportional">@Component</span> annotation or other stereotype annotations in Spring). In the listing, the
                        <span class="EmphasisFontCategoryNonProportional">@Named(&quot;messageProvider&quot;)</span> annotation specifies that <span class="EmphasisFontCategoryNonProportional">ConfigurableMessageProvider</span> is an injectable bean and gives it
                        the name <span class="EmphasisFontCategoryNonProportional">messageProvider</span>, which is the same as the <span class="EmphasisFontCategoryNonProportional">name</span> attribute in Spring’s <span class="EmphasisFontCategoryNonProportional">&lt;bean&gt;</span>                        tag. Second, we use constructor injection by using the <span class="EmphasisFontCategoryNonProportional">@Inject</span> annotation before the constructor that accepts a string value. Then, we use <span class="EmphasisFontCategoryNonProportional">@Named</span>                        to specify that we want to inject the value that had the name <span class="EmphasisFontCategoryNonProportional">message</span> assigned. Let’s move on to see the <span class="EmphasisFontCategoryNonProportional">MessageRenderer</span>                        interface and <span id="ITerm134">              <span class="EmphasisFontCategoryNonProportional">StandardOutMessageRenderer</span> </span> implementation.</div>
                    <pre style="background:#fff;color:#000"><span style="color:#06f;font-style:italic">//chapter04/jsr330/src/main/java/com/apress/prospring5/</span>
    ch4<span style="color:#00f;font-weight:700">/</span><span style="color:#00f;font-weight:700">MessageRenderer</span><span style="color:#00f;font-weight:700">.</span>java
            <span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">MessageRenderer</span> {
    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">render</span>();

    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setMessageProvider</span>(<span style="color:#00f;font-weight:700">MessageProvider</span> <span style="font-style:italic">provider</span>);

    <span style="color:#00f;font-weight:700">MessageProvider</span> <span style="color:#0000a2;font-weight:700">getMessageProvider</span>();
}
<span style="color:#06f;font-style:italic">//chapter04/jsr330/src/main/java/com/apress/prospring5/</span>
    ch4<span style="color:#00f;font-weight:700">/</span><span style="color:#00f;font-weight:700">StandardOutMessageRenderer</span><span style="color:#00f;font-weight:700">.</span>java
            <span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;
            <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.inject.Inject</span>;
            <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.inject.Named</span>;
            <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.inject.Singleton</span>;

@Named(<span style="color:#036a07">messageRenderer</span>)
@<span style="color:#00f;font-weight:700">Singleton</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">StandardOutMessageRenderer</span>
        <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">MessageRenderer</span> {
    <span style="color:#00f;font-weight:700">@Inject</span>
    <span style="color:#00f;font-weight:700">@Named</span>(<span style="color:#036a07">messageProvider</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">MessageProvider</span> messageProvider <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">null</span>;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">render</span>() {
        <span style="color:#00f;font-weight:700">if</span> (messageProvider <span style="color:#00f;font-weight:700">==</span> <span style="color:#585cf6;font-weight:700">null</span>) {
            <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">RuntimeException</span>(
                    <span style="color:#036a07">You must set the property messageProvider of class:</span>
                            <span style="color:#00f;font-weight:700">+</span> <span style="color:#00f;font-weight:700">StandardOutMessageRenderer</span><span style="color:#00f;font-weight:700">.</span>class<span style="color:#00f;font-weight:700">.</span>getName());
        }
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(messageProvider<span style="color:#00f;font-weight:700">.</span>getMessage());
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setMessageProvider</span>(<span style="color:#00f;font-weight:700">MessageProvider</span> <span style="font-style:italic">provider</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>messageProvider <span style="color:#00f;font-weight:700">=</span> provider;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">MessageProvider</span> <span style="color:#0000a2;font-weight:700">getMessageProvider</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>messageProvider;
    }
}
</pre>
                    <div class="Para" id="Par349">In the previous code snippet, we used <span class="EmphasisFontCategoryNonProportional">@Named</span> to define that it’s an injectable bean. Notice the <span class="EmphasisFontCategoryNonProportional">@Singleton</span> annotation.
                        It’s worth noting that in the JSR-330 standard, a bean’s default scope is nonsingleton, which is like Spring’s <span class="EmphasisFontCategoryNonProportional">prototype</span> scope. So, in a JSR-330 environment, if you want
                        your bean to be a singleton, you need to use the <span class="EmphasisFontCategoryNonProportional">@Singleton</span> annotation. However, using this annotation in Spring actually doesn’t have any effect because Spring’s default
                        scope for bean instantiation is already singleton. We just put it here for a demonstration, and it’s worth noting the difference between Spring and other JSR-330–compatible containers.</div>
                    <div class="Para" id="Par350">For the <span class="EmphasisFontCategoryNonProportional">messageProvider</span> property, we use <span class="EmphasisFontCategoryNonProportional">@Inject</span> for setter injection this time and specify that a bean with the name
                        <span class="EmphasisFontCategoryNonProportional">messageProvider</span> should be used for injection. The following configuration snippet defines a simple Spring XML configuration for the application (<span class="EmphasisFontCategoryNonProportional">app-context-annotation.xml</span>):</div>
                    <pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">context</span><span style="font-weight:700">:</span><span style="font-weight:700">component-scan</span>
         <span style="font-style:italic">base-package</span>=<span style="color:#036a07">com.apress.prospring5.ch4</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">message</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">java.lang.String</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">constructor-arg</span> <span style="font-style:italic">value</span>=<span style="color:#036a07">Gravity is  working against me</span>/&gt;</span>
   <span style="color:#1c02ff">&lt;/<span style="font-weight:700">bean</span>&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
                <div class="Para" id="Par352">You don’t need any special tags to use JSR-330; just configure your application like a normal Spring application. We use <span class="EmphasisFontCategoryNonProportional">&lt;context:component-scan&gt;</span> to instruct Spring to scan
                    for the DI-related annotations, and Spring will recognize those JSR-330 annotations. We also declare a Spring bean called <span class="EmphasisFontCategoryNonProportional">message</span> for constructor injection into the <span class="EmphasisFontCategoryNonProportional">ConfigurableMessageProvider</span>                    class. The following code snippet shows the testing program:</div>
                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Jsr330Demo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-annotation.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">MessageRenderer</span> renderer <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">messageRenderer</span>,
                <span style="color:#00f;font-weight:700">MessageRenderer</span><span style="color:#00f;font-weight:700">.</span>class);
        renderer<span style="color:#00f;font-weight:700">.</span>render();
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                <div class="Para" id="Par354">Running the program yields the following output:</div>
                <div class="Para" id="Par355">
                    <div class="ProgramCode" id="PC113">
                        <div class="FixedLine">Gravity is working against me</div>
                    </div>
                </div>
                <div class="Para" id="Par356">By using JSR-330, you can ease the migration into other JSR-330–compatible IoC containers (for example, JEE 6–compatible application servers or other DI containers such as Google Guice). However, Spring’s annotations are much more feature
                    rich and flexible than JSR-330 annotations. Some main differences are highlighted here:
                    <div class="UnorderedList">
                        <ul class="UnorderedListMarkBullet">
                            <li>
                                <div class="Para" id="Par357">When using Spring’s <span class="EmphasisFontCategoryNonProportional">@Autowired</span> annotation, you can specify a <span class="EmphasisFontCategoryNonProportional">required</span> attribute to indicate that the DI must
                                    be fulfilled (you can also use Spring’s <span class="EmphasisFontCategoryNonProportional">@Required</span> annotation to declare this requirement), while for JSR-330’s <span class="EmphasisFontCategoryNonProportional">@Inject</span>                                    annotation, there is no such equivalent. Moreover, Spring provides the <span class="EmphasisFontCategoryNonProportional">@Qualifier</span> annotation, which allows more fine-grained control for Spring to perform autowiring
                                    of dependencies based on qualifier name.</div>
                            </li>
                            <li>
                                <div class="Para" id="Par358">JSR-330 supports only singleton and nonsingleton bean scopes, while Spring supports more scopes, which is useful for web applications.</div>
                            </li>
                            <li>
                                <div class="Para ParaOneEmphasisChild" id="Par359">In Spring, you can use the <span class="EmphasisFontCategoryNonProportional">@Lazy</span> annotation to instruct Spring to instantiate the bean only when requested by the application. There’s no such equivalent in JSR-330.</div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="Para" id="Par360">You can also mix and match Spring and JSR-330 annotations in the same application. However, it is recommended that you settle on either one to maintain a consistent style for your application. One possible way is to use JSR-330 <span id="ITerm136">annotations                  </span>                    as much as possible and use Spring annotations when required. However, this brings you fewer benefits, because you still need to do quite a bit of work in migrating to another DI container. In conclusion, Spring’s annotations approach
                    is recommended over JSR-330 annotations, because Spring’s annotations are much more powerful, unless there is a requirement that your application should be IoC container independent.</div>
                </div>
                <div class="Section1 RenderAsSection1" id="Sec47">
                    <h2 class="Heading">Configuration Using <span id="ITerm137">Groovy        </span> </h2>
                    <div class="Para" id="Par361">New to Spring Framework 4.0 is the ability to configure your bean definitions and <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> by using the Groovy language. This provides developers with another choice
                        in configuration to either replace or supplement XML and/or annotation-based bean configuration. A Spring <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> can be created directly in a Groovy script or
                        loaded from Java, both by way of the <span class="EmphasisFontCategoryNonProportional">GenericGroovyApplicationContext</span> class. First let’s dive into the details by showing how to create bean definitions from an external Groovy
                        script and loading them from Java. In previous sections and chapters, we introduced various bean classes, and to promote some code reusability, we will use in this example the <span class="EmphasisFontCategoryNonProportional">Singer</span>                        class introduced in Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Chapter.html"><span class="RefSource">3</span></a>
                        </span>. The following code snippet shows the content of this class:</div>
                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.xml</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Singer</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> name;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">int</span> age;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setName</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">name</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>name <span style="color:#00f;font-weight:700">=</span> name;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setAge</span>(<span style="color:#00f;font-weight:700">int</span> <span style="font-style:italic">age</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>age <span style="color:#00f;font-weight:700">=</span> age;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">toString</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">&quot;<span style="color:#26b31a">\t</span>Name: &quot;</span> <span style="color:#00f;font-weight:700">+</span> name <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span><span style="color:#26b31a">\t</span>&quot;</span> <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">Age: </span> <span style="color:#00f;font-weight:700">+</span> age;
    }
}
</pre>
                    <div class="Para ParaOneEmphasisChild" id="Par363">As you can see, this is just a Java class with a couple of properties describing a singer. We use this simple Java class here to show that just because you configure your beans in Groovy doesn’t mean your entire code base needs to
                        be rewritten in Groovy. Not only that, but Java classes can be imported from dependencies and used within Groovy scripts. Now, let’s create the Groovy script (<span class="EmphasisFontCategoryNonProportional">beans.groovy</span>)
                        that will be used to create the bean definition, as shown in the previous code snippet:</div>
                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.xml.Singer</span>
beans{
        singer(<span style="color:#00f;font-weight:700">Singer</span>,name<span style="color:#00f;font-weight:700">:</span><span style="color:#036a07">John Mayer</span>,age<span style="color:#00f;font-weight:700">:</span><span style="color:#0000cd">39</span>)
        }
</pre>
                    <div class="Para" id="Par365">This Groovy script starts with a top-level closure called <span class="EmphasisFontCategoryNonProportional">beans</span>, which provides bean definitions to Spring. First, we specify the bean name (<span class="EmphasisFontCategoryNonProportional">singer</span>),
                        and then as arguments we provide the class type (<span class="EmphasisFontCategoryNonProportional">Singer</span>) followed by the property names and values that we would like to set. Next, let’s create a simple test driver in Java,
                        loading bean definitions from the Groovy script, as shown <span id="ITerm138">here        </span>:</div>
                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.xml.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.ApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericGroovyApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">GroovyBeansFromJava</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">ApplicationContext</span> context <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericGroovyApplicationContext</span>(<span style="color:#036a07">classpath:beans.groovy</span>);
        <span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">=</span> context<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">singer</span>, <span style="color:#00f;font-weight:700">Singer</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(singer);
    }
}
</pre>
                    <div class="Para" id="Par367">As you can see, the creation of <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> is carried out in typical fashion, but it’s done by using the <span class="EmphasisFontCategoryNonProportional">GenericGroovyApplicationContext</span>                        class and providing your Groovy script that builds the bean definitions.</div>
                    <div class="Para" id="Par368">Before you can run the samples in this section, you need to add a dependency to this project: the <span class="EmphasisFontCategoryNonProportional">groovy-all</span> library. The <span class="EmphasisFontCategoryNonProportional">build.gradle</span>                        configuration file content for the project <span class="EmphasisFontCategoryNonProportional">groovy-config-java</span> is shown here:</div>
                    <pre style="background:#fff;color:#000">apply plugin<span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">groovy</span>
dependencies {
        compile misc<span style="color:#00f;font-weight:700">.</span>groovy
        compile project(<span style="color:#036a07">:chapter03:bean-inheritance</span>)
}
</pre>
                    <div class="Para" id="Par370">The <span class="EmphasisFontCategoryNonProportional">compile project(&apos;:chapter03:bean-inheritance&apos;)</span> line specifies that the Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_3_Chapter.html"><span class="RefSource">3</span></a>
                        </span>
                        <span class="EmphasisFontCategoryNonProportional">bean-inheritance</span> project must be compiled and used as a dependency for this project. This is the project containing the <span class="EmphasisFontCategoryNonProportional">Singer</span>                        class.</div>
                    <div class="Para" id="Par371">Gradle configuration files use Groovy syntax, and <span class="EmphasisFontCategoryNonProportional">misc.groovy</span> references the <span class="EmphasisFontCategoryNonProportional">groovy</span> property of the <span class="EmphasisFontCategoryNonProportional">misc</span>                        array defined in the <span class="EmphasisFontCategoryNonProportional">build.gradle</span> file of the parent project. A snippet of the content of this file (configurations related to Groovy) is shown <span id="ITerm139">here        </span>:</div>
                    <pre style="background:#fff;color:#000">ext {
        springVersion <span style="color:#00f;font-weight:700">=</span>  <span style="color:#036a07">5.0.0.M4</span>
        groovyVersion <span style="color:#00f;font-weight:700">=</span>  <span style="color:#036a07">2.4.5</span>
.<span style="color:#00f;font-weight:700">.</span>.
        misc <span style="color:#00f;font-weight:700">=</span> [
                .<span style="color:#00f;font-weight:700">.</span>.
                    groovy<span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">org.codehaus.groovy:groovy-all:$groovyVersion</span>
        ]
.<span style="color:#00f;font-weight:700">.</span>.
}
</pre>
                <div class="Para ParaOneEmphasisChild" id="Par373">Running the <span class="EmphasisFontCategoryNonProportional">GroovyBeansFromJava</span> class yields the following output:</div>
                <div class="Para" id="Par374">
                    <div class="ProgramCode" id="PC119">
                        <div class="FixedLine">Name: John Mayer</div>
                        <div class="FixedLine">Age: 39</div>
                    </div>
                </div>
                <div class="Para" id="Par375">Now that you have seen how to load bean definitions from Java via an external Groovy script, how can we go about creating the <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> and bean definitions from a Groovy
                    script alone? Let’s take a look at the Groovy code (<span class="EmphasisFontCategoryNonProportional">GroovyConfig.groovy</span>) listed here:</div>
                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch3.xml.Singer</span>
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericApplicationContext</span>
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.groovy.GroovyBeanDefinitionReader</span>
def ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericApplicationContext</span>()
def reader <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GroovyBeanDefinitionReader</span>(ctx)
reader<span style="color:#00f;font-weight:700">.</span>beans {
    singer(<span style="color:#00f;font-weight:700">Singer</span>, name<span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">John Mayer</span>, age<span style="color:#00f;font-weight:700">:</span> <span style="color:#0000cd">39</span>)
}
ctx<span style="color:#00f;font-weight:700">.</span>refresh()
println ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">singer</span>)
</pre>
                <div class="Para" id="Par377">When we run this sample, we get same output as before. This time we create an instance of a typical <span class="EmphasisFontCategoryNonProportional">GenericApplicationContext</span> but use <span class="EmphasisFontCategoryNonProportional">GroovyBeanDefinitionReader</span>,
                    which will be used to pass bean definitions to. Then, as in the previous sample, we create a bean from your simple POJO, refresh <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>, and print the string representation
                    of the <span class="EmphasisFontCategoryNonProportional">Singer</span> bean. It doesn’t get any easier than that!</div>
                <div class="Para" id="Par378">As you probably can tell, we are only scratching the surface of what can be done with the Groovy support in Spring. Since you have the full power of the Groovy language, you can do all sorts of interesting things when creating bean definitions.
                    As you have full access to <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>, not only can you configure beans, but you can also work with profile support, property files, and so on. Just keep in mind, with
                    great power comes great <span id="ITerm140">responsibility        </span>.</div>
                </div>
                <div class="Section1 RenderAsSection1" id="Sec48">
                    <h2 class="Heading">Spring Boot</h2>
                    <div class="Para" id="Par379">Until now you’ve learned more than one way to configure a Spring application. Whether it is XML, annotations, Java configuration classes, Groovy scripts, or a mix of all these, now you should have a basic idea of how it’s done. But
                        what if we tell you there is something even cooler than all that?</div>
                    <div class="Para" id="Par380">The Spring Boot project aims to simplify the getting-started experience of building an application by using Spring. Spring Boot takes the guesswork out of manually gathering dependencies and provides some of the most common features
                        needed by most applications, such as metrics and health checks.</div>
                    <div class="Para" id="Par381">Spring Boot takes an <span id="ITerm141">“opinionated” approach                  </span> to achieve the goal of developer simplification by way of providing starter projects for various types of applications that already contain the
                        proper dependencies and versions, which means less time spent to get started. For those who may be looking to get away from XML completely, Spring Boot does not require any configuration to be written in XML.</div>
                    <div class="Para" id="Par382">In this example, we will create the traditional Hello World web application with a twist. You may be surprised to see the minimal amount of code required to do so as compared to your typical Java web application setup. Typically, we
                        have started off samples by defining the dependencies we need to add to your project. Part of Spring Boot’s simplification model is to prepare all the dependencies for you, and when using Maven, for example, you as the developer
                        utilize a parent POM to obtain this functionality. When using Gradle, things become even simpler. There is no parent needed, except a Gradle plug-in and a starter dependency. In the following example, we will create a Spring application
                        that lists all the beans in the context, and then the <span class="EmphasisFontCategoryNonProportional">helloWorld</span> bean is accessed. The Gradle configuration of the <span class="EmphasisFontCategoryNonProportional">boot-simple</span>                        project is depicted here:</div>
                    <pre style="background:#fff;color:#000">buildscript {
    repositories {
        mavenLocal()
        mavenCentral()
        maven { url <span style="color:#036a07">http://repo.spring.io/release</span> }
        maven { url <span style="color:#036a07">http://repo.spring.io/milestone</span> }
        maven { url  <span style="color:#036a07">http://repo.spring.io/snapshot</span> }
        maven { url <span style="color:#036a07">https://repo.spring.io/libs-snapshot</span> }
    }
    dependencies {
        classpath boot<span style="color:#00f;font-weight:700">.</span>springBootPlugin
    }
}
apply plugin<span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">org.springframework.boot</span>
dependencies {
    compile boot<span style="color:#00f;font-weight:700">.</span>starter
}
</pre>
                    <div class="Para" id="Par384">The <span class="EmphasisFontCategoryNonProportional">boot.springBootPlugin</span> line references the <span class="EmphasisFontCategoryNonProportional">springBootPlugin</span> property of the <span class="EmphasisFontCategoryNonProportional">boot</span>                        array defined in the <span class="EmphasisFontCategoryNonProportional">build.gradle</span> file of the parent project. A snippet of the content of this file (<span id="ITerm142">configurations                  </span> related to
                        Spring Boot only) is depicted here:</div>
                    <pre style="background:#fff;color:#000">ext {
    bootVersion <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">2.0.0.BUILD-SNAPSHOT</span>
    .<span style="color:#00f;font-weight:700">.</span>.
    boot <span style="color:#00f;font-weight:700">=</span> [
      springBootPlugin<span style="color:#00f;font-weight:700">:</span>
            <span style="color:#036a07">org.springframework.boot:spring-boot-gradle-plugin:$bootVersion</span>, starter    <span style="color:#00f;font-weight:700">:</span>
            <span style="color:#036a07">org.springframework.boot:spring-boot-starter:$bootVersion</span>, starterWeb    <span style="color:#00f;font-weight:700">:</span>
            <span style="color:#036a07">org.springframework.boot:spring-boot-starter-web:$bootVersion</span>
    ]
    .<span style="color:#00f;font-weight:700">.</span>.
}
</pre>
                    <div class="Para" id="Par386">At the time of this writing, Spring Boot version 2.0.0 has not been released yet. That is why the version is <span class="EmphasisFontCategoryNonProportional">2.0.0.BUILD-SNAPSHOT</span> and we need to add the Spring Snapshot repository,
                        <span class="ExternalRef"><a href="https://repo.spring.io/libs-snapshot"><span class="RefSource">                <span class="EmphasisFontCategoryNonProportional">https://repo.spring.io/libs-snapshot</span> </span>
                        </a>
                        </span>, in the configuration. It is quite possible that after this book, an official version will be released.</div>
                    <div class="Para" id="Par387">Each release of Spring Boot provides a curated list of dependencies it supports. The versions of the necessary libraries are selected so the API matches perfectly, and this is handled by Spring Boot. Therefore, the manual configuration
                        of dependencies versions is not necessary. Upgrading Spring Boot will ensure that those dependencies are upgraded as well. With the previous configuration, a set of dependencies will be added to the project, each with the proper
                        versions so that their API will be compatible. In a smart editor like IntelliJ IDEA, there is a <span id="ITerm143">Gradle Projects                  </span> view, where you can expand each module and inspect the available tasks
                        and dependencies, as shown in Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Chapter.html#Fig3">4-3</a></span>.
                        <div class="Figure" id="Fig3">
                            <div class="MediaObject" id="MO3"><img alt="A315511_5_En_4_Fig3_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Fig3_HTML.jpg" height="289" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Fig3_HTML.jpg" width="520"/></div>
                            <div class="Caption" xml:lang="en">
                                <div class="CaptionContent"><span class="CaptionNumber">Figure 4-3.</span>
                                    <div class="SimplePara">Gradle Projects view of the boot-simple <span id="ITerm144">project                                  </span> </div>
                                </div>
                        </div>
                    </div>
                </div>
                <div class="Para ParaOneEmphasisChild" id="Par388">Now that the setup is in place, let’s create the classes. The <span class="EmphasisFontCategoryNonProportional">HelloWorld</span> class is shown here:</div>
                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.Logger</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.LoggerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Component</span>;

@<span style="color:#00f;font-weight:700">Component</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">HelloWorld</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">HelloWorld</span><span style="color:#00f;font-weight:700">.</span>class);

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">sayHi</span>() {
        logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">Hello World!</span>);
    }
}
</pre>
                <div class="Para" id="Par390">There is nothing special or complicated about this; it’s just a class with a method and a bean declaration annotation on it. Let’s see how to build a Spring application using Spring Boot and create an <span id="ITerm145">              <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>                    </span> that contains this bean:</div>
                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.Logger</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.LoggerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.boot.SpringApplication</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.boot.autoconfigure.SpringBootApplication</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.ConfigurableApplicationContext</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Arrays</span>;

@<span style="color:#00f;font-weight:700">SpringBootApplication</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Application</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">Application</span><span style="color:#00f;font-weight:700">.</span>class);

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">args</span>) <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Exception</span> {
        <span style="color:#00f;font-weight:700">ConfigurableApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">SpringApplication</span><span style="color:#00f;font-weight:700">.</span>run(<span style="color:#00f;font-weight:700">Application</span><span style="color:#00f;font-weight:700">.</span>class, args);
        <span style="color:#00f;font-weight:700">assert</span> (ctx <span style="color:#00f;font-weight:700">!=</span> <span style="color:#585cf6;font-weight:700">null</span>);
        logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">The beans you were looking for:</span>);
        <span style="color:#06f;font-style:italic">// listing all bean definition    names</span>
        <span style="color:#00f;font-weight:700">Arrays</span><span style="color:#00f;font-weight:700">.</span>stream(ctx<span style="color:#00f;font-weight:700">.</span>getBeanDefinitionNames())<span style="color:#00f;font-weight:700">.</span>forEach(logger<span style="color:#00f;font-weight:700">:</span><span style="color:#00f;font-weight:700">:</span>info);
        <span style="color:#00f;font-weight:700">HelloWorld</span> hw <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">HelloWorld</span><span style="color:#00f;font-weight:700">.</span>class);
        hw<span style="color:#00f;font-weight:700">.</span>sayHi();
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>in<span style="color:#00f;font-weight:700">.</span>read();
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                <div class="Para" id="Par392">That is all. Really. And this class could have been smaller, but we wanted to show you how to do some extra things. Let’s cover them all.
                    <div class="UnorderedList">
                        <ul class="UnorderedListMarkBullet">
                            <li>
                                <div class="Para" id="Par393"> <span class="EmphasisTypeItalic">Check that we have a context</span>: The <span class="EmphasisFontCategoryNonProportional">assert</span> statement is used to test your assumption that <span class="EmphasisFontCategoryNonProportional">ctx</span>                                    is not <span class="EmphasisFontCategoryNonProportional">null</span>.</div>
                            </li>
                            <li>
                                <div class="Para" id="Par394"> <span class="EmphasisTypeItalic">Set up logging</span>: Spring Boot comes with a set of logging libraries, so we only have to put under the <span class="EmphasisFontCategoryNonProportional">resources</span> directory the
                                    configuration for the one we want to use. In our case, we chose <span class="EmphasisFontCategoryNonProportional">logback</span>.</div>
                            </li>
                            <li>
                                <div class="Para" id="Par395"> <span class="EmphasisTypeItalic">List all bean definitions in the context</span>: Using Java 8 lambda expressions, you can list all bean definitions in the context in one line. So, we added that line so you can see what
                                    beans are autoconfigured for you out of the box by Spring Boot. In the list you will find the <span class="EmphasisFontCategoryNonProportional">helloWorld</span> bean too.</div>
                            </li>
                            <li>
                                <div class="Para" id="Par396"> <span class="EmphasisTypeItalic">Confirm exit</span>: Without the <span class="EmphasisFontCategoryNonProportional">System.in.read();</span> method, the application prints the beans names, prints <span class="EmphasisFontCategoryNonProportional">HelloWorld</span>,
                                    and then exits. We added that call so the application will wait for the developer to press a key and then exit.</div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="Para" id="Par397">The novelty here is the <span class="EmphasisFontCategoryNonProportional">@SpringBootApplication</span> annotation. This annotation is a top-level annotation designed to be used only at the class level. It a convenience annotation that
                    is equivalent to declaring the following three:
                    <div class="UnorderedList">
                        <ul class="UnorderedListMarkBullet">
                            <li>
                                <div class="Para" id="Par398"> <span class="EmphasisFontCategoryNonProportional">@Configuration</span>: Marks this class as a configuration class that can declare beans with <span class="EmphasisFontCategoryNonProportional">@Bean</span>.</div>
                            </li>
                            <li>
                                <div class="Para" id="Par399"> <span class="EmphasisFontCategoryNonProportional">@EnableAutoConfiguration</span>: This is a specific Spring Boot annotation from the package <span class="EmphasisFontCategoryNonProportional">org.springframework.boot.autoconfigure</span>                                    that can enable Spring <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>, attempting to guess and configure beans that you are likely to need based on the specified dependencies.</div>
                                <div class="Para" id="Par400"> <span class="EmphasisFontCategoryNonProportional">@EnableAutoConfiguration</span> works well with Spring-provided starter dependencies, but it is not directly tied to them, so other dependencies outside the starters can
                                    be used. For example, if there is a specific embedded server on the classpath, it will be used, unless there is another <span class="EmphasisFontCategoryNonProportional">EmbeddedServletContainerFactory</span> configuration
                                    in the project.</div>
                    </li>
                    <li>
                        <div class="Para" id="Par401"> <span class="EmphasisFontCategoryNonProportional">@ComponentScan</span>: We can declare classes annotated with stereotype annotations that will become beans of some kind. The attribute used to list the packages to scan used with
                            <span class="EmphasisFontCategoryNonProportional">@SpringBootApplication</span> is <span class="EmphasisFontCategoryNonProportional">basePackages</span>. In version 1.3.0, another attribute was added for component scanning:
                            <span class="EmphasisFontCategoryNonProportional">basePackageClasses</span>. This attribute provides a type-safe alternative to <span class="EmphasisFontCategoryNonProportional">basePackages</span> for specifying the packages
                            to scan for annotated components. The package of each class specified will be scanned.</div>
                    </li>
                    </ul>
                </div>
                </div>
                <div class="Para" id="Par402">If the <span class="EmphasisFontCategoryNonProportional">@SpringBootApplication</span> annotation has no component scanning attribute defined, it will scan only the package in which the class annotated with it is located. That is why in
                    the example presented here, the <span class="EmphasisFontCategoryNonProportional">helloWorld</span> bean definition is found, and the bean is created.</div>
                <div class="Para" id="Par403">The previous Spring Boot application was a simple console application with one developer-defined bean and a full-blown out-of-the-box environment. But Spring Boot provides starter dependencies for web applications as well. The dependency
                    to use is <span class="EmphasisFontCategoryNonProportional">spring-boot-starter-web</span>, and in Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Chapter.html#Fig4">4-4</a></span>                    you can see the transitive dependencies of this Boot starter library. In the <span class="EmphasisFontCategoryNonProportional">boot-web</span> project, the <span class="EmphasisFontCategoryNonProportional">HelloWorld</span> class is
                    a Spring controller, which is a special type of class that is used to create a Spring web bean. This is a typical Spring MVC controller class that you will learn about in Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_16_Chapter.html"><span class="RefSource">16</span></a>
                    </span>.
                    <div class="Figure" id="Fig4">
                        <div class="MediaObject" id="MO4"><img alt="A315511_5_En_4_Fig4_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Fig4_HTML.jpg" height="368" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Fig4_HTML.jpg" width="520"/></div>
                        <div class="Caption" xml:lang="en">
                            <div class="CaptionContent"><span class="CaptionNumber">Figure 4-4.</span>
                                <div class="SimplePara">Gradle Projects view of the boot-web <span id="ITerm147">project                                  </span> </div>
                            </div>
                    </div>
                </div>
                </div>
                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.ctrl</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.web.bind.annotation.RequestMapping</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.web.bind.annotation.RestController</span>;

@<span style="color:#00f;font-weight:700">RestController</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">HelloWorld</span> {
    <span style="color:#00f;font-weight:700">@RequestMapping</span>(<span style="color:#036a07">/</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">sayHi</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">Hello World!</span>;
    }
}
</pre>
                <div class="Para" id="Par405">The annotation used to declare Spring web beans is a specialization of <span class="EmphasisFontCategoryNonProportional">@Component</span>: the <span class="EmphasisFontCategoryNonProportional">@Controller</span> annotation. These types
                    of classes contain methods annotated with <span class="EmphasisFontCategoryNonProportional">@RequestMapping</span>, which are mapped to a certain request URL. The annotation you see in the example <span class="EmphasisFontCategoryNonProportional">@RestController</span>                    is used for practical reasons. It is the <span class="EmphasisFontCategoryNonProportional">@Controller</span> annotation used for REST services. And exposing the <span class="EmphasisFontCategoryNonProportional">helloWorld</span> bean
                    as a REST service is useful here because you do not have to create a full-blown web application with an user interface and other web components that will pollute the basic idea in this section. All the web components introduced here
                    are covered in Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_16_Chapter.html"><span class="RefSource">16</span></a>
                    </span>.</div>
                <div class="Para ParaOneEmphasisChild" id="Par406">Next we create your bootstrap class by using a simple <span class="EmphasisFontCategoryNonProportional">main()</span> method, as shown here:</div>
                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch4.ctrl.HelloWorld</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.Logger</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.LoggerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.boot.SpringApplication</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.boot.autoconfigure.SpringBootApplication</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.ConfigurableApplicationContext</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Arrays</span>;

@SpringBootApplication(scanBasePackageClasses <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">HelloWorld</span><span style="color:#00f;font-weight:700">.</span>class)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">WebApplication</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">WebApplication</span><span style="color:#00f;font-weight:700">.</span>class);

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">args</span>) <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Exception</span> {
        <span style="color:#00f;font-weight:700">ConfigurableApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">SpringApplication</span><span style="color:#00f;font-weight:700">.</span>run(<span style="color:#00f;font-weight:700">WebApplication</span><span style="color:#00f;font-weight:700">.</span>class, args);
        <span style="color:#00f;font-weight:700">assert</span> (ctx <span style="color:#00f;font-weight:700">!=</span> <span style="color:#585cf6;font-weight:700">null</span>);
        logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">Application started...</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>in<span style="color:#00f;font-weight:700">.</span>read();
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                <div class="Para" id="Par408">Because the <span class="EmphasisFontCategoryNonProportional">HelloWorld</span> controller was declared in a different package than the <span class="EmphasisFontCategoryNonProportional">WebApplication</span> class, we created an opportunity
                    to depict how the <span class="EmphasisFontCategoryNonProportional">scanBasePackageClasses</span> attribute is used.</div>
                <div class="Para" id="Par409">At this point, you may be asking yourself: where is the <span class="EmphasisFontCategoryNonProportional">web.xml</span> configuration file and all the other components I must create for a basic web application? You already defined everything
                    needed in the previous listings! Don’t believe it? Compile the project and run the <span class="EmphasisFontCategoryNonProportional">Application</span> class until you see the log message indicating that the application has been started.
                    If you look at the generated log files, you will see a lot going on with such little code. Most notably, it looks like Tomcat is running, and various endpoints such as health checks, environment output information, and metrics are
                    already defined for you. First navigate to <span class="EmphasisFontCategoryNonProportional">http://localhost:8080</span> and you will see the Hello World web page displayed as expected. Next take a look at some of the preconfigured
                    endpoints (for example, <span class="EmphasisFontCategoryNonProportional">http://localhost:8080/health</span>, which returns a JSON representation of the application status). Going further, load <span class="EmphasisFontCategoryNonProportional">http://localhost:8080/metrics</span>                    to get a better understanding of various metrics that are being collected such as heap size, garbage collection, and so on.</div>
                <div class="Para" id="Par410">As you may be able to tell already from this one sample alone, Spring Boot radically simplifies the way you go about creating any type of application. Gone are the days of having to configure numerous files to get a simple web application
                    going, and with an embedded servlet container ready to serve your web application, everything “just works.”</div>
                <div class="Para" id="Par411">While we have shown you a simple example, keep in mind that Spring Boot does not lock you into using what it chooses; it simply takes the “opinionated” approach and chooses defaults for you. If you don’t want to use embedded Tomcat but
                    Jetty instead, simply modify the configuration file to exclude the Tomcat starter module from the <span class="EmphasisFontCategoryNonProportional">spring-boot-starter-web dependency</span>. Utilizing the <span id="ITerm149">Gradle Projects                  </span>                    view is one way to help you visualize what dependencies are being brought into your project. Spring Boot also provides many other starter dependencies for other types of applications, and you are encouraged to read through the documentation
                    for more details.</div>
                <div class="Para" id="Par412">For more information on Spring Boot, please see its project page at <span class="ExternalRef"><a href="http://projects.spring.io/spring-boot/"><span class="RefSource">                <span class="EmphasisFontCategoryNonProportional">http://projects.spring.io/spring-boot/</span>                    </span>
                    </a>
                    </span>.</div>
                </div>
                <div class="Section1 RenderAsSection1" id="Sec49">
                    <h2 class="Heading">Summary</h2>
                    <div class="Para" id="Par413">In this chapter, you saw a wide range of Spring-specific features that complement the core IoC capabilities. You saw how to hook into the life cycle of a bean and to make it aware of the Spring environment. We introduced <span class="EmphasisFontCategoryNonProportional">FactoryBean</span>s
                        as a solution for IoC, enabling a wider set of classes. We also showed how you can use <span class="EmphasisFontCategoryNonProportional">PropertyEditor</span>s to simplify application configuration and to remove the need for artificial
                        <span class="EmphasisFontCategoryNonProportional">String</span>-typed properties. We showed you more than one way to define beans using XML, annotations, and Java configuration. Moreover, we finished with an in-depth look at some
                        additional features offered by <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>, including i18n, event publication, and resource access.</div>
                    <div class="Para" id="Par414">We also covered features such as using Java classes and the new Groovy syntax instead of XML configuration, profiles support, and the environment and property source abstraction layer. Finally, we discussed using JSR-330 standard annotations
                        in Spring.</div>
                    <div class="Para" id="Par415">The icing on the cake was how to use Spring Boot to configure beans and boot up your application as soon as possible and with little effort.</div>
                    <div class="Para" id="Par416">So far, we have covered the main concepts of the Spring Framework and its features as a DI container as well as other services that the core Spring Framework provides. In the next chapter and onward, we discuss using Spring in specific
                        areas such as AOP, data access, transaction support, and web application support.</div>
                </div>
                <div class="FootnoteSection">
                    <div class="Heading">Footnotes</div>
                    <div class="Footnote" id="Fn1"><span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Chapter.html#Fn1_source">1</a></span>
                        <div class="FootnoteParas">
                            <div class="Para" id="Par61">Check out this snippet from JEE official Javadoc: <span class="ExternalRef"><a href="http://docs.oracle.com/javaee/7/api/javax/annotation/PostConstruct.html"><span class="RefSource">                              <span class="EmphasisFontCategoryNonProportional">http://docs.oracle.com/javaee/7/api/javax/annotation/PostConstruct.html</span>                                </span>
                                </a>
                                </span>.</div>
                        </div>
                        <div class="ClearBoth"> </div>
                    </div>
                    <div class="Footnote" id="Fn2"><span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Chapter.html#Fn2_source">2</a></span>
                        <div class="FootnoteParas">
                            <div class="Para" id="Par235">The classes are not created again in the <span class="EmphasisFontCategoryNonProportional">com.apress.prospring5.ch4</span> package, but projects where they are defined are used as dependencies for the <span class="EmphasisFontCategoryNonProportional">java-config</span>                                project.</div>
                        </div>
                        <div class="ClearBoth"> </div>
                    </div>
                    <div class="Footnote" id="Fn3"><span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Chapter.html#Fn3_source">3</a></span>
                        <div class="FootnoteParas">
                            <div class="Para" id="Par344">You can find dependency characteristics, like group IDs and latest versions, on the Maven public repository. For example, this is the dedicated page for <span class="EmphasisFontCategoryNonProportional">java.inject</span>:
                                <span class="ExternalRef"><a href="https://mvnrepository.com/artifact/javax.inject/javax.inject"><span class="RefSource">                    <span class="EmphasisFontCategoryNonProportional">https://mvnrepository.com/artifact/javax.inject/javax.inject</span>                                </span>
                                </a>
                                </span>.</div>
                        </div>
                        <div class="ClearBoth"> </div>
                    </div>
                </div>
                </div>
                </div>
                </div>
                </section>
                </div>
                </div>



<hr/>
<!--if IE]><![endif]-->

<!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"            itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"data-offline-url="/"data-url="/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Chapter.html"data-csrf-cookie="csrfsafari"data-highlight-privacy=""  data-user-id="3866890"  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"  data-username="levinxccai"  data-account-type="B2B"    data-activated-trial-date="11/06/2017"  data-archive="9781484228081"  data-publishers="Apress"  data-htmlfile-name="A315511_5_En_5_Chapter.html"  data-epub-title="Pro Spring 5: An In-Depth Guide to the Spring Framework and Its Tools" data-debug=0 data-testing=0><![endif]-->
<!--if gt IE 8]><!-->

<!--![endif]-->




<a name="6_"></a>

    <div class="application" id="container" style="height: auto;">
        <div class="js-toc">
            <section role="document">
                <div id="sbo-rt-content" style="max-width:72.5em; transform: none;">
                    <div class="annotator-wrapper">
                        <!--egin Abstract-->
                        <div class="MainTitleSection">
                            <h1 class="ChapterTitle" xml:lang="en">5. Introducing Spring AOP</h1>
                        </div>
                        <div class="AuthorGroup">
                            <div class="AuthorNames"><span class="Author"><span class="AuthorName">Iuliana Cosmina</span><sup>1 <span class="ContactIcon"></span></sup>, </span><span class="Author"><span class="AuthorName">Rob Harrop</span><sup>2</sup>, </span>
                                <span class="Author"><span class="AuthorName">Chris Schaefer</span><sup>3</sup> and </span><span class="Author"><span class="AuthorName">Clarence Ho</span><sup>4</sup></span>
                            </div>
                            <div class="Affiliations">
                                <div class="Affiliation" id="Aff5"><span class="AffiliationNumber">(1)</span>
                                    <div class="AffiliationText">Sibiu, Sibiu, Romania</div>
                                </div>
                                <div class="Affiliation" id="Aff6"><span class="AffiliationNumber">(2)</span>
                                    <div class="AffiliationText">Reddish, UK</div>
                                </div>
                                <div class="Affiliation" id="Aff7"><span class="AffiliationNumber">(3)</span>
                                    <div class="AffiliationText">Venice, Florida, USA</div>
                                </div>
                                <div class="Affiliation" id="Aff8"><span class="AffiliationNumber">(4)</span>
                                    <div class="AffiliationText">Hong Kong, China</div>
                                </div>
                                <div class="ClearBoth"> </div>
                            </div>
                        </div>
                        <!--nd Abstract-->
                        <div class="Fulltext">
                            <div class="Para" id="Par1">Besides dependency injection (DI), another core feature that the Spring Framework offers is support for aspect-oriented programming (AOP). AOP is often referred to as a tool for implementing crosscutting concerns. The term
                                <span class="EmphasisTypeItalic">crosscutting concerns</span> refers to logic in an application that cannot be decomposed from the rest of the application and may result in code duplication and tight coupling. By using
                                AOP for modularizing individual pieces of logic, known as <span class="EmphasisTypeItalic">concerns</span>, you can apply them to many parts of an application without duplicating the code or creating hard dependencies.
                                Logging and security are typical examples of crosscutting concerns that are present in many applications. Consider an application that logs the start and end of every method for debugging purposes. You will probably refactor
                                the logging code into a special class, but you still have to call methods on that class twice per method in your application in order to perform the logging. Using AOP, you can simply specify that you want the methods on
                                your logging class to be invoked before and after each method call in your application.</div>
                            <div class="Para" id="Par2">It is important to understand that AOP complements object-oriented programming (OOP), rather than competing with it. OOP is very good at solving a wide variety of problems that we, as programmers, encounter. However, if you
                                look at the logging example again, it is obvious to see where OOP is lacking when it comes to implementing crosscutting logic on a large scale. Using AOP on its own to develop an entire application is practically impossible,
                                given that AOP functions on top of <span id="ITerm1">OOP              </span>. Likewise, although it is certainly possible to develop entire applications by using OOP, you can work smarter by employing AOP to solve certain
                                problems that involve crosscutting logic.</div>
                            <div class="Para" id="Par3">This chapter covers the following topics:
                                <div class="UnorderedList">
                                    <ul class="UnorderedListMarkBullet">
                                        <li>
                                            <div class="Para ParaOneEmphasisChild" id="Par4"> <span class="EmphasisTypeItalic">AOP basics</span>: Before discussing Spring’s AOP implementation, we cover the basics of AOP as a technology. Most of the concepts covered in the “AOP Concepts” section are not
                                                specific to Spring and can be found in any AOP implementation. If you are already familiar with another AOP implementation, feel free to skip the “AOP Concepts” section.</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par5"> <span class="EmphasisTypeItalic">Types of AOP</span>: There are two distinct types of AOP: static and dynamic. In static AOP, like that provided by AspectJ’s<a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Chapter.html#Fn1" id="Fn1_source"><sup>1</sup></a> compile-time weaving mechanisms, the crosscutting logic is applied to your code at compile time, and you cannot change it without modifying the code
                                                and recompiling. With dynamic AOP, such as Spring AOP, crosscutting logic is applied dynamically at runtime. This allows you to make changes to the AOP configuration without having to recompile the application.
                                                These types of AOP are complementary, and, when used together, they form a powerful combination that you can use in your applications.</div>
                                        </li>
                                        <li>
                                            <div class="Para ParaOneEmphasisChild" id="Par7"> <span class="EmphasisTypeItalic">Spring AOP architecture</span>: Spring AOP is only a subset of the full AOP feature set found in other implementations such as AspectJ. In this chapter, we take a high-level
                                                look at which features are present in Spring, how they are implemented, and why some features are excluded from the Spring implementation.</div>
                                        </li>
                                        <li>
                                            <div class="Para ParaOneEmphasisChild" id="Par8"> <span class="EmphasisTypeItalic">Proxies in Spring AOP</span>: Proxies are a huge part of how Spring AOP works, and you must understand them to get the most out of Spring AOP. In this chapter, we look at the
                                                two kinds of proxy: the JDK dynamic proxy and the CGLIB proxy. In particular, we look at the different scenarios in which Spring uses each proxy, the performance of the two proxy types, and some simple guidelines
                                                to follow in your application to get the most from Spring AOP.</div>
                                        </li>
                                        <li>
                                            <div class="Para ParaOneEmphasisChild" id="Par9"> <span class="EmphasisTypeItalic">Using Spring AOP</span>: In this chapter, we present some practical examples of AOP usage. We start off with a simple Hello World example to ease you into Spring’s AOP code,
                                                and we continue with a detailed description of the AOP features that are available in Spring, complete with examples.</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par10"> <span class="EmphasisTypeItalic">Advanced use of pointcuts</span>: We explore the <span class="EmphasisFontCategoryNonProportional">ComposablePointcut</span> and <span class="EmphasisFontCategoryNonProportional">ControlFlowPointcut</span>                                                classes, introductions, and appropriate techniques you should employ when using pointcuts in your application.</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par11"> <span class="EmphasisTypeItalic">AOP framework services</span>: The Spring Framework fully supports configuring AOP transparently and declaratively. We look at three ways (the <span class="EmphasisFontCategoryNonProportional">ProxyFactoryBean</span>                                                class, the <span class="EmphasisFontCategoryNonProportional">aop</span> namespace, and <span class="EmphasisFontCategoryNonProportional">@AspectJ-</span>style annotations) to inject declaratively defined
                                                AOP proxies into your application objects as collaborators, thus making your application completely unaware that it is working with advised objects.</div>
                                        </li>
                                        <li>
                                            <div class="Para ParaOneEmphasisChild" id="Par12"> <span class="EmphasisTypeItalic">Integrating AspectJ</span>: AspectJ is a fully featured AOP implementation. The main difference between AspectJ and Spring AOP is that AspectJ applies advice to target objects
                                                via weaving (either compile-time or load-time weaving), while Spring AOP is based on proxies. The feature set of AspectJ is much greater than that of Spring AOP, but it is much more complicated to use than
                                                Spring. AspectJ is a good solution when you find that Spring AOP lacks a feature you need.</div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="Section1 RenderAsSection1" id="Sec1">
                                <h2 class="Heading">AOP <span id="ITerm2">Concepts                  </span> </h2>
                                <div class="Para" id="Par13">As with most technologies, AOP comes with its own specific set of concepts and terms, and it’s important to understand what they mean. The following are the core concepts of AOP:
                                    <div class="UnorderedList">
                                        <ul class="UnorderedListMarkBullet">
                                            <li>
                                                <div class="Para ParaOneEmphasisChild" id="Par14"> <span class="EmphasisTypeItalic">Joinpoints</span>: A joinpoint is a well-defined point during the execution of your application. Typical examples of joinpoints include a call to a method, the method invocation
                                                    itself, class initialization, and object instantiation. Joinpoints are a core concept of AOP and define the points in your application at which you can insert additional logic using AOP.</div>
                                            </li>
                                            <li>
                                                <div class="Para ParaOneEmphasisChild" id="Par15"> <span class="EmphasisTypeItalic">Advice</span>: The code that is executed at a particular joinpoint is the advice, defined by a method in your class. There are many types of advice, such as before, which
                                                    executes before the joinpoint, and after, which executes after it.</div>
                                            </li>
                                            <li>
                                                <div class="Para ParaOneEmphasisChild" id="Par16"> <span class="EmphasisTypeItalic">Pointcuts</span>: A pointcut is a collection of joinpoints that you use to define when advice should be executed. By creating pointcuts, you gain fine-grained control over
                                                    how you apply advice to the components in your application. As mentioned previously, a typical joinpoint is a method invocation, or the collection of all method invocations in a particular class. Often
                                                    you can compose pointcuts in complex relationships to further constrain when advice is executed.</div>
                                            </li>
                                            <li>
                                                <div class="Para ParaOneEmphasisChild" id="Par17"> <span class="EmphasisTypeItalic">Aspects</span>: An aspect is the combination of advice and pointcuts encapsulated in a class. This combination results in a definition of the logic that should be included
                                                    in the application and where it should execute.</div>
                                            </li>
                                            <li>
                                                <div class="Para" id="Par18"> <span class="EmphasisTypeItalic">Weaving</span>: This is the process of inserting aspects into the application code at the appropriate point. For compile-time AOP solutions, this weaving is generally done
                                                    at build time. Likewise, for runtime AOP solutions, the weaving process is executed dynamically at runtime. AspectJ supports another weaving mechanism called <span class="EmphasisTypeItalic">load-time weaving</span>                                                    (LTW), in which it intercepts the underlying JVM class loader and provides weaving to the bytecode when it is being loaded by the class loader.</div>
                                            </li>
                                            <li>
                                                <div class="Para" id="Par19"> <span class="EmphasisTypeItalic">Target</span>: An object whose execution flow is modified by an AOP process is referred to as the target object. Often you see the target object referred to as the
                                                    <span class="EmphasisTypeItalic">advised</span> <span id="ITerm3">object                              </span>.</div>
                                            </li>
                                            <li>
                                                <div class="Para ParaOneEmphasisChild" id="Par20"> <span class="EmphasisTypeItalic">Introduction</span>: This is the process by which you can modify the structure of an object by introducing additional methods or fields to it. You can use introduction AOP
                                                    to make any object implement a specific interface without needing the object’s class to implement that interface explicitly.</div>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="Para" id="Par21">Don’t worry if you find these concepts confusing; this will all become clear when you see some examples. Also, be aware that you are shielded from many of these concepts in Spring AOP, and some are not relevant because
                                    of Spring’s choice of implementation. We will discuss each of these features in the context of Spring as we progress through the chapter.</div>
                            </div>
                            <div class="Section1 RenderAsSection1" id="Sec2">
                                <h2 class="Heading">Types of AOP</h2>
                                <div class="Para" id="Par22">As we mentioned earlier, there are two distinct types of AOP: static and dynamic. The difference between them is really the point at which the weaving process occurs and how this process is achieved.</div>
                                <div class="Section2 RenderAsSection2" id="Sec3">
                                    <h3 class="Heading">Using <span id="ITerm4">Static                      </span> AOP</h3>
                                    <div class="Para" id="Par23">In static AOP, the weaving process forms another step in the build process for an application. In Java terms, you achieve the weaving process in a static AOP implementation by modifying the actual bytecode of your application,
                                        changing and extending the application code as necessary. This is a well-performing way of achieving the weaving process because the end result is just Java bytecode, and you do not perform any special tricks at
                                        runtime to determine when advice should be executed. The drawback of this mechanism is that any modifications you make to the aspects, even if you simply want to add another joinpoint, require you to recompile the
                                        entire application. AspectJ’s compile-time weaving is an excellent example of a static AOP implementation.</div>
                                </div>
                                <div class="Section2 RenderAsSection2" id="Sec4">
                                    <h3 class="Heading">Using <span id="ITerm5">Dynamic                      </span> AOP</h3>
                                    <div class="Para" id="Par24">Dynamic AOP implementations, such as Spring AOP, differ from static AOP implementations in that the weaving process is performed dynamically at runtime. How this is achieved is implementation-dependent, but as you will
                                        see, Spring’s approach is to create proxies for all advised objects, allowing for advice to be invoked as required. The drawback of dynamic AOP is that, typically, it does not perform as well as static AOP, but
                                        the performance is steadily increasing. The major benefit of dynamic AOP implementations is the ease with which you can modify the entire aspect set of an application without needing to recompile the main application
                                        code.</div>
                                </div>
                                <div class="Section2 RenderAsSection2" id="Sec5">
                                    <h3 class="Heading">Choosing an AOP Type</h3>
                                    <div class="Para" id="Par25">Choosing whether to use static or dynamic AOP is quite a hard decision. Both have their own benefits, and you are not restricted to using only one type. In general, static AOP implementations have been around longer
                                        and tend to have more feature-rich implementations, with a greater number of available joinpoints. Typically, if performance is absolutely critical or you need an AOP feature that is not implemented in Spring, you
                                        will want to use AspectJ. In most other cases, Spring AOP is ideal. Keep in mind that many AOP-based solutions such as transaction management are already provided for you by Spring, so check the framework capabilities
                                        before rolling your own! As always, let the requirements of your application drive your choice of AOP implementation, and don’t restrict yourself to a single implementation if a combination of technologies would
                                        better suit your application. In general, Spring AOP is less complex than AspectJ, so it tends to be an ideal first choice.</div>
                                </div>
                            </div>
                            <div class="Section1 RenderAsSection1" id="Sec6">
                                <h2 class="Heading">AOP in Spring</h2>
                                <div class="Para" id="Par26">Spring’s AOP implementation can be viewed as two logical parts. The first part is the AOP core, which provides fully decoupled, purely programmatic AOP functionality (also known as the Spring AOP API). The second part of
                                    the AOP implementation is the set of framework services that make AOP easier to use in your applications. On top of this, other components of Spring, such as the transaction manager and EJB helper classes, provide AOP-based
                                    services to simplify the development of your application.</div>
                                <div class="Section2 RenderAsSection2" id="Sec7">
                                    <h3 class="Heading">The AOP Alliance</h3>
                                    <div class="Para" id="Par27">The AOP <span id="ITerm6">Alliance                      </span> (<span class="ExternalRef"><a href="http://aopalliance.sourceforge.net/"><span class="RefSource">                  <span class="EmphasisFontCategoryNonProportional">http://aopalliance.sourceforge.net/</span>                                        </span>
                                        </a>
                                        </span> <span class="EmphasisFontCategoryNonProportional">)</span> is a joint effort among representatives of many open source AOP projects to define a standard set of interfaces for AOP implementations. Wherever applicable,
                                        Spring uses the AOP Alliance interfaces rather than defining its own. This allows you to reuse certain advice across multiple AOP implementations that support the AOP Alliance interfaces.</div>
                                </div>
                                <div class="Section2 RenderAsSection2" id="Sec8">
                                    <h3 class="Heading">Hello World in AOP</h3>
                                    <div class="Para" id="Par28">Before we dive into discussing the Spring AOP implementation in detail, let’s take a look at an example. We’ll see how to change the typical Hello World example, and we’ll turn to movies for inspiration. We’ll write
                                        a class named <span class="EmphasisFontCategoryNonProportional">Agent</span>, and we’ll implement it to print <span class="EmphasisFontCategoryNonProportional">Bond</span>. When using AOP, the instance of this class
                                        will be transformed at runtime to print <span class="EmphasisFontCategoryNonProportional">James Bond!</span>. The following code depicts the <span class="EmphasisFontCategoryNonProportional">Agent</span> class:</div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Agent</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">speak</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>print(<span style="color:#036a07">Bond</span>);
    }
}
</pre>
                                <div class="Para" id="Par30">With the name-printing method implemented, let’s <span class="EmphasisTypeItalic">advise</span>—which in AOP terms means add advice to—this method so that <span class="EmphasisFontCategoryNonProportional">speak()</span>                                    prints <span class="EmphasisFontCategoryNonProportional">James Bond!</span> instead.</div>
                                <div class="Para" id="Par31">To do this, we need to execute code prior to the existing body executing (to write <span class="EmphasisFontCategoryNonProportional">James</span>), and we need to execute code after that method body executes (to write
                                    <span class="EmphasisFontCategoryNonProportional">!</span>). In AOP terms, what we need is around advice, which executes around a joinpoint. In this case, the joinpoint is the invocation of the <span class="EmphasisFontCategoryNonProportional">speak()</span> method.
                                        The following code snippet shows the code of the <span id="ITerm7">                <span class="EmphasisFontCategoryNonProportional">AgentDecorator</span> </span> class, which acts as the around-advice implementation:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.aopalliance.intercept.MethodInterceptor</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.aopalliance.intercept.MethodInvocation</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AgentDecorator</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">MethodInterceptor</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Object</span> <span style="color:#0000a2;font-weight:700">invoke</span>(<span style="color:#00f;font-weight:700">MethodInvocation</span> <span style="font-style:italic">invocation</span>) <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Throwable</span> {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>print(<span style="color:#036a07">James </span>);
        <span style="color:#00f;font-weight:700">Object</span> retVal <span style="color:#00f;font-weight:700">=</span> invocation<span style="color:#00f;font-weight:700">.</span>proceed();
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">!</span>);
        <span style="color:#00f;font-weight:700">return</span> retVal;
    }
}
</pre>
                            <div class="Para" id="Par33">The <span class="EmphasisFontCategoryNonProportional">MethodInterceptor</span> interface is a standard AOP Alliance interface for implementing around advice for method invocation joinpoints. The <span class="EmphasisFontCategoryNonProportional">MethodInvocation</span>                                object represents the method invocation that is being advised, and using this object, we control when the method invocation is allowed to proceed. Because this is around advice, we are capable of performing actions before
                                the method is invoked as well as after it is invoked but before it returns. So in the previous code snippet, we simply write <span class="EmphasisFontCategoryNonProportional">James</span> to console output, invoke the method
                                with a call to <span class="EmphasisFontCategoryNonProportional">invocation.proceed()</span>, and then write <span class="EmphasisFontCategoryNonProportional">!</span> to console output.</div>
                            <div class="Para" id="Par34">The final step in this sample is to weave the <span class="EmphasisFontCategoryNonProportional">AgentDecorator</span> advice (more specifically, the <span class="EmphasisFontCategoryNonProportional">invoke()</span> method)
                                into the code. To do this, we create an instance of <span class="EmphasisFontCategoryNonProportional">Agent</span>, the target, and then create a proxy of this instance, instructing the proxy factory to weave in the
                                <span class="EmphasisFontCategoryNonProportional">AgentDecorator</span> advice. This is shown here:</div>
                            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.framework.ProxyFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">sun.management.Agent</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AgentAOPDemo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">Agent</span> target <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Agent</span>();
        <span style="color:#00f;font-weight:700">ProxyFactory</span> pf <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ProxyFactory</span>();
        pf<span style="color:#00f;font-weight:700">.</span>addAdvice(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AgentDecorator</span>());
        pf<span style="color:#00f;font-weight:700">.</span>setTarget(target);
        <span style="color:#00f;font-weight:700">Agent</span> proxy <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">Agent</span>) pf<span style="color:#00f;font-weight:700">.</span>getProxy();
        target<span style="color:#00f;font-weight:700">.</span>speak();
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07"></span>);
        proxy<span style="color:#00f;font-weight:700">.</span>speak();
    }
}
</pre>
                            <div class="Para" id="Par36">The important part here is that we use the <span class="EmphasisFontCategoryNonProportional">ProxyFactory</span> class to create the proxy of the target object, weaving in the advice at the same time. We pass the <span class="EmphasisFontCategoryNonProportional">AgentDecorator</span>                                advice to the <span class="EmphasisFontCategoryNonProportional">ProxyFactory</span> with a call to <span class="EmphasisFontCategoryNonProportional">addAdvice()</span> and specify the target for weaving with a call to
                                <span class="EmphasisFontCategoryNonProportional">setTarget()</span>. Once the target is set and some advice is added to the <span class="EmphasisFontCategoryNonProportional">ProxyFactory</span>, we generate the proxy with a call to <span class="EmphasisFontCategoryNonProportional">getProxy()</span>.
                                    Finally, we call <span class="EmphasisFontCategoryNonProportional">speak()</span> on both the original target object and the proxy object. Running the previous code results in the following output:</div>
                            <div class="Para" id="Par37">
                                <div class="ProgramCode" id="PC4">
                                    <div class="FixedLine">Bond</div>
                                    <div class="FixedLine">James Bond!</div>
                                </div>
                            </div>
                            <div class="Para" id="Par38">As you can see, calling <span class="EmphasisFontCategoryNonProportional">speak()</span> on the untouched target object results in a standard method invocation, and no extra content is written to console output. However, the
                                invocation of the proxy causes the code in <span class="EmphasisFontCategoryNonProportional">AgentDecorator</span> to execute, creating the desired <span class="EmphasisFontCategoryNonProportional">James Bond!</span> output.
                                From this example, you can see that the advised class had no dependencies on Spring or the AOP Alliance interfaces; the beauty of Spring AOP, and indeed AOP in general, is that you can advise almost any class, even if that
                                class was created without AOP in mind. The only restriction, in Spring AOP at least, is that you can’t advise final classes because they cannot be overridden and therefore cannot be proxied.</div>
                        </div>
                    </div>
                    <div class="Section1 RenderAsSection1" id="Sec9">
                        <h2 class="Heading">Spring AOP Architecture</h2>
                        <div class="Para" id="Par39">The core architecture of Spring AOP is based on proxies. When you want to create an advised instance of a class, you must use <span class="EmphasisFontCategoryNonProportional">ProxyFactory</span> to create a proxy instance of that
                            class, first providing <span class="EmphasisFontCategoryNonProportional">ProxyFactory</span> with all the aspects that you want to be woven into the proxy. Using <span class="EmphasisFontCategoryNonProportional">ProxyFactory</span>                            is a purely programmatic approach to creating AOP proxies. For the most part, you don’t need to use this in your application; instead, you can rely on the declarative AOP configuration mechanisms provided by Spring (the
                            <span class="EmphasisFontCategoryNonProportional">ProxyFactoryBean</span> class, the <span class="EmphasisFontCategoryNonProportional">aop</span> namespace, and <span class="EmphasisFontCategoryNonProportional">@AspectJ-</span>style annotations) to take advantage of declarative
                                proxy creation. However, it is important to understand how proxy creation works, so we will first show the programmatic approach to proxy creation and then dive into Spring’s declarative AOP configurations.</div>
                        <div class="Para" id="Par40">At runtime, Spring analyzes the crosscutting concerns defined for the beans in <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> and generates proxy beans (which wrap the underlying target bean) dynamically.
                            Instead of calling the target bean directly, callers are injected with the proxied bean. The proxy bean then analyzes the running condition (that is, joinpoint, pointcut, or advice) and weaves in the appropriate advice accordingly.
                            Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Chapter.html#Fig1">5-1</a></span> shows a high-level view of a Spring AOP proxy in action. Internally,
                            Spring has two proxy implementations: JDK dynamic proxies and CGLIB proxies. By default, when the target object to be advised implements an interface, Spring will use a JDK dynamic proxy to create proxy instances of the target.
                            However, when the advised target object doesn’t implement an interface (for example, it’s a concrete class), CGLIB will be used for proxy instance creation. One major reason is that the JDK dynamic proxy supports only the proxying
                            of interfaces. We discuss proxies in detail in the section “Understanding Proxies.”
                            <div class="Figure" id="Fig1">
                                <div class="MediaObject" id="MO1"><img alt="A315511_5_En_5_Fig1_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Fig1_HTML.jpg" height="126" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Fig1_HTML.jpg" width="360"/></div>
                                <div class="Caption" xml:lang="en">
                                    <div class="CaptionContent"><span class="CaptionNumber">Figure 5-1.</span>
                                        <div class="SimplePara">Spring AOP proxy in action</div>
                                    </div>
                            </div>
                        </div>
                    </div>
                    <div class="Section2 RenderAsSection2" id="Sec10">
                        <h3 class="Heading"> <span id="ITerm9">Joinpoints                      </span> in Spring</h3>
                        <div class="Para" id="Par41">One of the more noticeable simplifications in Spring AOP is that it supports only one joinpoint type: method invocation. At first glance, this might seem like a severe limitation if you are familiar with other AOP implementations
                            such as AspectJ, which supports many more joinpoints, but in fact this makes Spring more accessible.</div>
                        <div class="Para" id="Par42">The method invocation joinpoint is by far the most useful joinpoint available, and using it, you can achieve many of the tasks that make AOP useful in day-to-day programming. Remember that if you need to advise some code at a joinpoint
                            other than a method invocation, you can always use Spring and AspectJ together.</div>
                    </div>
                    <div class="Section2 RenderAsSection2" id="Sec11">
                        <h3 class="Heading">Aspects in Spring</h3>
                        <div class="Para" id="Par43">In Spring AOP, an aspect is represented by an instance of a class that implements the <span class="EmphasisFontCategoryNonProportional">Advisor</span> interface. Spring provides convenience <span class="EmphasisFontCategoryNonProportional">Advisor</span>                            implementations that you can reuse in your applications, thus removing the need for you to create custom <span class="EmphasisFontCategoryNonProportional">Advisor</span> implementations. There are two subinterfaces of
                            <span class="EmphasisFontCategoryNonProportional">Advisor</span>: <span class="EmphasisFontCategoryNonProportional">PointcutAdvisor</span> and <span class="EmphasisFontCategoryNonProportional">IntroductionAdvisor</span>.</div>
                        <div class="Para" id="Par44">The <span class="EmphasisFontCategoryNonProportional">PointcutAdvisor</span> interface is implemented by all <span class="EmphasisFontCategoryNonProportional">Advisor</span> implementations that use pointcuts to control the advice
                            applied to joinpoints. In Spring, introductions are treated as special kinds of advice, and by using the <span class="EmphasisFontCategoryNonProportional">IntroductionAdvisor</span> interface, you can control those classes
                            to which an introduction applies.</div>
                        <div class="Para ParaOneEmphasisChild" id="Par45">We discuss <span class="EmphasisFontCategoryNonProportional">PointcutAdvisor</span> implementations in detail in the upcoming section “Advisors and Pointcuts in Spring.”</div>
                    </div>
                    <div class="Section2 RenderAsSection2" id="Sec12">
                        <h3 class="Heading">About the ProxyFactory Class</h3>
                        <div class="Para" id="Par46">The <span id="ITerm10">            <span class="EmphasisFontCategoryNonProportional">ProxyFactory</span> class </span> controls the weaving and proxy creation process in Spring AOP. Before you can create a proxy, you must specify
                            the advised or target object. You can do this, as you saw earlier, by using the <span class="EmphasisFontCategoryNonProportional">setTarget()</span> method. Internally, <span class="EmphasisFontCategoryNonProportional">ProxyFactory</span>                            delegates the proxy creation process to an instance of <span class="EmphasisFontCategoryNonProportional">DefaultAopProxyFactory</span>, which in turn delegates to either <span class="EmphasisFontCategoryNonProportional">Cglib2AopProxy</span>                            or <span class="EmphasisFontCategoryNonProportional">JdkDynamicAopProxy</span>, depending on the settings of your application. We discuss proxy creation in more detail later in this chapter.</div>
                        <div class="Para" id="Par47">The <span class="EmphasisFontCategoryNonProportional">ProxyFactory</span> class provides the <span class="EmphasisFontCategoryNonProportional">addAdvice()</span> method that you saw in the previous code sample for cases where you
                            want advice to apply to the invocation of all methods in a class, not just a selection. Internally, <span class="EmphasisFontCategoryNonProportional">addAdvice()</span> wraps the advice you pass it in an instance of <span class="EmphasisFontCategoryNonProportional">DefaultPointcutAdvisor</span>,
                            which is the standard implementation of <span class="EmphasisFontCategoryNonProportional">PointcutAdvisor</span>, and configures it with a pointcut that includes all methods by default. When you want more control over the
                            <span class="EmphasisFontCategoryNonProportional">Advisor</span> that is created or when you want to add an introduction to the proxy, create the <span class="EmphasisFontCategoryNonProportional">Advisor</span> yourself and use the <span class="EmphasisFontCategoryNonProportional">addAdvisor()</span>                                method of the <span class="EmphasisFontCategoryNonProportional">ProxyFactory</span>.</div>
                        <div class="Para" id="Par48">You can use the same <span class="EmphasisFontCategoryNonProportional">ProxyFactory</span> instance to create many proxies, each with different aspects. To help with this, <span class="EmphasisFontCategoryNonProportional">ProxyFactory</span>                            has <span class="EmphasisFontCategoryNonProportional">removeAdvice()</span> and <span class="EmphasisFontCategoryNonProportional">removeAdvisor()</span> methods, which allow you to remove any advice or advisors from the
                            <span class="EmphasisFontCategoryNonProportional">ProxyFactory</span> that you previously passed to it. To check whether a <span class="EmphasisFontCategoryNonProportional">ProxyFactory</span> has particular advice attached to it, call <span class="EmphasisFontCategoryNonProportional">adviceIncluded()</span>,
                                passing in the advice object for which you want to check.</div>
                    </div>
                    <div class="Section2 RenderAsSection2" id="Sec13">
                        <h3 class="Heading">Creating Advice in Spring</h3>
                        <div class="Para" id="Par49">Spring supports six flavors of advice, described in Table <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Chapter.html#Tab1">5-1</a></span>.
                            <div class="Table" id="Tab1">
                                <div class="Caption" xml:lang="en">
                                    <div class="CaptionContent"><span class="CaptionNumber">Table 5-1.</span>
                                        <div class="SimplePara"> <span id="ITerm11">Advice Types                                      </span> in Spring</div>
                                    </div>
                                </div>
                                <table border="1">
                                    <colgroup>
                                        <col>
                                        <col>
                                        <col>
                                    </colgroup>
                                    <thead>
                                        <tr class="header">
                                            <th>
                                                <div class="SimplePara">Advice Name</div>
                                            </th>
                                            <th>
                                                <div class="SimplePara">Interface</div>
                                            </th>
                                            <th>
                                                <div class="SimplePara">Description</div>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="noclass">
                                            <td>
                                                <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">Before</span> </div>
                                            </td>
                                            <td>
                                                <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">org.springframework.aop.MethodBeforeAdvice</span> </div>
                                            </td>
                                            <td>
                                                <div class="SimplePara">Using before advice, you can perform custom processing before a joinpoint executes. Because a joinpoint in Spring is always a method invocation, this essentially allows you to perform preprocessing before
                                                    the method executes. Before advice has full access to the target of the method invocation as well as the arguments passed to the method, but it has no control over the execution of the method itself.
                                                    If the before advice throws an exception, further execution of the interceptor chain (as well as the target method) will be aborted, and the exception will propagate back up the interceptor chain.</div>
                                            </td>
                                        </tr>
                                        <tr class="noclass">
                                            <td>
                                                <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">After-Returning</span> </div>
                                            </td>
                                            <td>
                                                <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">org.springframework.aop.AfterReturningAdvice</span> </div>
                                            </td>
                                            <td>
                                                <div class="SimplePara">After-returning advice is executed after the method invocation at the joinpoint has finished executing and has returned a value. The after- returning advice has access to the target of the method invocation,
                                                    the arguments passed to the method, and the return value. Because the method has already executed when the after-returning advice is invoked, it has no control over the method invocation at all. If the
                                                    target method throws an exception, the after-returning advice will not be run, and the exception will be propagated up to the call stack as usual.</div>
                                            </td>
                                        </tr>
                                        <tr class="noclass">
                                            <td>
                                                <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">After(finally)</span> </div>
                                            </td>
                                            <td>
                                                <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">org.springframework.aop.AfterAdvice</span> </div>
                                            </td>
                                            <td>
                                                <div class="SimplePara">After-returning advice is executed only when the advised method completes normally. However, the after (finally) advice will be executed no matter the result of the advised method. The advice is executed
                                                    even when the advised method fails and an exception is thrown.</div>
                                            </td>
                                        </tr>
                                        <tr class="noclass">
                                            <td>
                                                <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">Around</span> </div>
                                            </td>
                                            <td>
                                                <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">org.aopalliance.intercep</span>t<span class="EmphasisFontCategoryNonProportional">.MethodInterceptor</span> </div>
                                            </td>
                                            <td>
                                                <div class="SimplePara">In Spring, around advice is modeled using the AOP Alliance standard of a method interceptor. Your advice is allowed to execute before and after the method invocation, and you can control the point at which
                                                    the method invocation is allowed to proceed. You can choose to bypass the method altogether if you want, providing your own implementation of the logic.</div>
                                            </td>
                                        </tr>
                                        <tr class="noclass">
                                            <td>
                                                <div class="SimplePara"> <span id="ITerm12">                            <span class="EmphasisFontCategoryNonProportional">Throws</span> </span>
                                                </div>
                                            </td>
                                            <td>
                                                <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">org.springframework.aop.ThrowsAdvice</span> </div>
                                            </td>
                                            <td>
                                                <div class="SimplePara">Throws advice is executed after a method invocation returns, but only if that invocation threw an exception. It is possible for throws advice to catch only specific exceptions, and if you choose to do so,
                                                    you can access the method that threw the exception, the arguments passed into the invocation, and the target of the invocation.</div>
                                            </td>
                                        </tr>
                                        <tr class="noclass">
                                            <td>
                                                <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">Introduction</span> </div>
                                            </td>
                                            <td>
                                                <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">org.springframework.aop.IntroductionInterceptor</span> </div>
                                            </td>
                                            <td>
                                                <div class="SimplePara">Spring models introductions as special types of interceptors. Using an introduction interceptor, you can specify the implementation for methods that are being introduced by the advice.</div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="Section2 RenderAsSection2" id="Sec14">
                        <h3 class="Heading">Interfaces for Advice</h3>
                        <div class="Para" id="Par50">From our previous discussion of the <span class="EmphasisFontCategoryNonProportional">ProxyFactory</span> class, recall that advice is added to a proxy either directly, by using the <span class="EmphasisFontCategoryNonProportional">addAdvice()</span>                            method, or indirectly, by using an Advisor implementation with the <span class="EmphasisFontCategoryNonProportional">addAdvisor()</span> method. The main difference between advice and an advisor is that an advisor carries advice
                            with the associated pointcut, which provides more fine-grained control on which joinpoints the advice will intercept. With regard to advice, Spring has created a well-defined hierarchy for Advice interfaces. This hierarchy
                            is based on the AOP Alliance interfaces and is shown in detail in Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Chapter.html#Fig2">5-2</a></span>.
                            <div class="Figure" id="Fig2">
                                <div class="MediaObject" id="MO2"><img alt="A315511_5_En_5_Fig2_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Fig2_HTML.jpg" height="217" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Fig2_HTML.jpg" width="690"/></div>
                                <div class="Caption" xml:lang="en">
                                    <div class="CaptionContent"><span class="CaptionNumber">Figure 5-2.</span>
                                        <div class="SimplePara">Interfaces for Spring advice types as depicted in IntelliJ IDEA</div>
                                    </div>
                        </div>
                    </div>
                </div>
                <div class="Para" id="Par51">This kind of hierarchy has the benefit of not only being sound OO design but also enabling you to deal with advice types generically, such as by using a single <span class="EmphasisFontCategoryNonProportional">addAdvice()</span> method
                    on the <span class="EmphasisFontCategoryNonProportional">ProxyFactory</span>, and you can add new advice types easily without having to modify the <span class="EmphasisFontCategoryNonProportional">ProxyFactory</span> class.</div>
        </div>
        <div class="Section2 RenderAsSection2" id="Sec15">
            <h3 class="Heading">Creating Before Advice</h3>
            <div class="Para" id="Par52"> <span id="ITerm13">                <span class="EmphasisTypeItalic">Before</span> </span> <span class="EmphasisTypeItalic">advice</span> is one of the most useful advice types available in Spring. This advice can modify the arguments passed
                to a method and can prevent the method from executing by raising an exception. In this section, we show you two simple examples of using before advice: one that writes a message to console output containing the name of the method before
                the method executes and another that you can use to restrict access to methods on an object. In the following code snippet, you can see the code for the <span id="ITerm14">                <span class="EmphasisFontCategoryNonProportional">SimpleBeforeAdvice</span>                </span> class:</div>
            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.lang.reflect.Method</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.MethodBeforeAdvice</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.framework.ProxyFactory</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SimpleBeforeAdvice</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">MethodBeforeAdvice</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">Guitarist</span> johnMayer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Guitarist</span>();
        <span style="color:#00f;font-weight:700">ProxyFactory</span> pf <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ProxyFactory</span>();
        pf<span style="color:#00f;font-weight:700">.</span>addAdvice(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SimpleBeforeAdvice</span>());
        pf<span style="color:#00f;font-weight:700">.</span>setTarget(johnMayer);
        <span style="color:#00f;font-weight:700">Guitarist</span> proxy <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">Guitarist</span>) pf<span style="color:#00f;font-weight:700">.</span>getProxy();
        proxy<span style="color:#00f;font-weight:700">.</span>sing();
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">before</span>(<span style="color:#00f;font-weight:700">Method</span> <span style="font-style:italic">method</span>, <span style="color:#00f;font-weight:700">Object</span>[] <span style="font-style:italic">args</span>, <span style="color:#00f;font-weight:700">Object</span> <span style="font-style:italic">target</span>)
            <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Throwable</span> {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Before &apos;</span> <span style="color:#00f;font-weight:700">+</span> method<span style="color:#00f;font-weight:700">.</span>getName() <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">&apos;, tune guitar.</span>);
    }
}
</pre>
            <div class="Para" id="Par54">Class <span class="EmphasisFontCategoryNonProportional">Guitarist</span> is simple and has just one method, <span id="ITerm16">                <span class="EmphasisFontCategoryNonProportional">sing()</span> </span>, that prints out a lyric
                in the console. It extends the <span class="EmphasisFontCategoryNonProportional">Singer</span> interface, which will be used all throughout the book.</div>
            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.common.Singer</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Guitarist</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Singer</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> lyric <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">You&apos;re gonna live forever in me</span>;

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">sing</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(lyric);
    }
}
</pre>
            <div class="Para" id="Par56">Basically, the advice makes sure the <span class="EmphasisFontCategoryNonProportional">johnMayer</span> bean tunes his guitar before singing. In this code, you can see that we have advised an instance of the <span class="EmphasisFontCategoryNonProportional">Guitarist</span>                class that we created earlier with an instance of the <span class="EmphasisFontCategoryNonProportional">SimpleBeforeAdvice</span> class. The <span class="EmphasisFontCategoryNonProportional">MethodBeforeAdvice</span> interface, which is
                implemented by <span class="EmphasisFontCategoryNonProportional">SimpleBeforeAdvice</span>, defines a single method, <span class="EmphasisFontCategoryNonProportional">before()</span>, which the AOP framework calls before the method at
                the joinpoint is invoked. Remember that, for now, we are using the default pointcut provided by the <span class="EmphasisFontCategoryNonProportional">addAdvice()</span> method, which matches all methods in a class. The <span class="EmphasisFontCategoryNonProportional">before()</span>                method is passed three arguments: the method that is to be invoked, the arguments that will be passed to that method, and the <span class="EmphasisFontCategoryNonProportional">Object</span> that is the target of the invocation. The
                <span class="EmphasisFontCategoryNonProportional">SimpleBeforeAdvice</span> class uses the <span class="EmphasisFontCategoryNonProportional">Method</span> argument of the <span class="EmphasisFontCategoryNonProportional">before()</span> method to write a message to console output containing
                    the name of the method to be invoked. Running this example gives we the following output:</div>
            <div class="Para" id="Par57">
                <div class="ProgramCode" id="PC7">
                    <div class="FixedLine">Before &apos;<span class="EmphasisTypeUnderline">sing</span>&apos;, tune guitar.</div>
                    <div class="FixedLine">You&apos;re gonna live forever in me</div>
                </div>
            </div>
            <div class="Para" id="Par58">As you can see, the output from the <span id="ITerm17">call                      </span> to <span class="EmphasisFontCategoryNonProportional">sing()</span> is shown, but just before it, you can see the output generated by <span class="EmphasisFontCategoryNonProportional">SimpleBeforeAdvice</span>.</div>
        </div>
        <div class="Section2 RenderAsSection2" id="Sec16">
            <h3 class="Heading">Securing Method Access by Using <span id="ITerm18">Before Advice                                  </span> </h3>
            <div class="Para" id="Par59">In this section, we are going to implement before advice that checks user credentials before allowing the method invocation to proceed. If the user credentials are invalid, an exception is thrown by the advice, thus preventing the method from
                executing. The example in this section is simplistic. It allows users to authenticate with any password, and it also allows only a single, hard-coded user access to the secured methods. However, it does illustrate how easy it is to use
                AOP to implement a crosscutting concern such as security.</div>
            <div class="Para ParaTypeImportant" id="Par60"><img alt="A315511_5_En_5_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Figa_HTML.jpg" width="30"/>                This is just an example demonstrating the use of before advice. For securing the method execution of Spring beans, the Spring Security project already provides comprehensive support; you don’t need to implement the features by yourself.</div>
            <div class="Para" id="Par61">The following code snippet shows the <span id="ITerm19">                <span class="EmphasisFontCategoryNonProportional">SecureBean</span> </span> class. This is the class that we will be securing using AOP.</div>
        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SecureBean</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">writeSecureMessage</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Every time I learn something new, </span>
            <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">it pushes some old stuff out of my brain</span>);
    }
}
</pre>
        <div class="Para" id="Par63">The <span class="EmphasisFontCategoryNonProportional">SecureBean</span> class imparts a small pearl of wisdom from Homer Simpson, and it’s wisdom that we don’t want everyone to see. Because this example requires users to authenticate, we are somehow
            going to need to store their details. The following code snippet shows the <span class="EmphasisFontCategoryNonProportional">UserInfo</span> class we can use to store a user’s credentials:</div>
        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">UserInfo</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> userName;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> password;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">UserInfo</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">userName</span>, <span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">password</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>userName <span style="color:#00f;font-weight:700">=</span> userName;
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>password <span style="color:#00f;font-weight:700">=</span> password;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getPassword</span>() {
        <span style="color:#00f;font-weight:700">return</span> password;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getUserName</span>() {
        <span style="color:#00f;font-weight:700">return</span> userName;
    }
}
</pre>
        <div class="Para" id="Par65">This class simply holds data about the user so that we can do something useful with it. The following code snippet shows the <span id="ITerm21">                <span class="EmphasisFontCategoryNonProportional">SecurityManager</span> </span> class,
            which is responsible for authenticating users and storing their credentials for later <span id="ITerm22">retrieval                                  </span>:</div>
        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SecurityManager</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">ThreadLocal&lt;<span style="color:#00f;font-weight:700">UserInfo</span>&gt;</span>
            threadLocal <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ThreadLocal&lt;&gt;</span>();

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">login</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">userName</span>, <span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">password</span>) {
        threadLocal<span style="color:#00f;font-weight:700">.</span>set(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">UserInfo</span>(userName, password));
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">logout</span>() {
        threadLocal<span style="color:#00f;font-weight:700">.</span>set(<span style="color:#585cf6;font-weight:700">null</span>);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">UserInfo</span> <span style="color:#0000a2;font-weight:700">getLoggedOnUser</span>() {
        <span style="color:#00f;font-weight:700">return</span> threadLocal<span style="color:#00f;font-weight:700">.</span>get();
    }
}
</pre>
        <div class="Para" id="Par67">The application uses the <span id="ITerm23">                <span class="EmphasisFontCategoryNonProportional">SecurityManager</span> </span> class to authenticate a user and, later, to retrieve the details of the currently authenticated user.
            The application authenticates a user by using the <span class="EmphasisFontCategoryNonProportional">login()</span> method. This is only a mock implementation. In a real application, the <span class="EmphasisFontCategoryNonProportional">login()</span>            method would probably check the supplied credentials against a database or LDAP directory, but here we can assume that all users are allowed to authenticate. The <span class="EmphasisFontCategoryNonProportional">login()</span> method creates
            a <span class="EmphasisFontCategoryNonProportional">UserInfo</span> object for the user and stores it on the current thread by using <span class="EmphasisFontCategoryNonProportional">ThreadLocal</span>. The <span class="EmphasisFontCategoryNonProportional">logout()</span>            method sets any value that might be stored in <span class="EmphasisFontCategoryNonProportional">ThreadLocal</span> to <span class="EmphasisFontCategoryNonProportional">null</span>. Finally, the <span class="EmphasisFontCategoryNonProportional">getLoggedOnUser()</span>            method returns the <span class="EmphasisFontCategoryNonProportional">UserInfo</span> object for the currently authenticated user. This method returns <span class="EmphasisFontCategoryNonProportional">null</span> if no user is authenticated.</div>
        <div class="Para" id="Par68">To check whether a user is authenticated and, if so, whether the user is permitted to access the methods on <span class="EmphasisFontCategoryNonProportional">Secure-Bean</span>, we need to create advice that executes before the method and checks
            the <span class="EmphasisFontCategoryNonProportional">UserInfo</span> object returned by <span class="EmphasisFontCategoryNonProportional">Security-Manager.getLoggedOnUser()</span> against the set of credentials for allowed users. The code
            for this advice, <span id="ITerm24">                <span class="EmphasisFontCategoryNonProportional">SecurityAdvice</span> </span> <span id="ITerm25">                                                              </span>, is shown here:</div>
    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.lang.reflect.Method</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.MethodBeforeAdvice</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SecurityAdvice</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">MethodBeforeAdvice</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SecurityManager</span> securityManager;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">SecurityAdvice</span>() {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>securityManager <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SecurityManager</span>();
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">before</span>(<span style="color:#00f;font-weight:700">Method</span> <span style="font-style:italic">method</span>, <span style="color:#00f;font-weight:700">Object</span>[] <span style="font-style:italic">args</span>, <span style="color:#00f;font-weight:700">Object</span> <span style="font-style:italic">target</span>)
            <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Throwable</span> {
        <span style="color:#00f;font-weight:700">UserInfo</span> user <span style="color:#00f;font-weight:700">=</span> securityManager<span style="color:#00f;font-weight:700">.</span>getLoggedOnUser();
        <span style="color:#00f;font-weight:700">if</span> (user <span style="color:#00f;font-weight:700">==</span> <span style="color:#585cf6;font-weight:700">null</span>) {
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">No user authenticated</span>);
            <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SecurityException</span>(
                    <span style="color:#036a07">You must login before attempting to invoke the method: </span>
                            <span style="color:#00f;font-weight:700">+</span> method<span style="color:#00f;font-weight:700">.</span>getName());
        } <span style="color:#00f;font-weight:700">else</span> <span style="color:#00f;font-weight:700">if</span> (<span style="color:#036a07">John</span><span style="color:#00f;font-weight:700">.</span>equals(user<span style="color:#00f;font-weight:700">.</span>getUserName())) {
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Logged in user is John - OKAY!</span>);
        } <span style="color:#00f;font-weight:700">else</span> {
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Logged in user is </span> <span style="color:#00f;font-weight:700">+</span> user<span style="color:#00f;font-weight:700">.</span>getUserName()
                    <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07"> NOT GOOD :(</span>);
            <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SecurityException</span>(<span style="color:#036a07">User </span> <span style="color:#00f;font-weight:700">+</span> user<span style="color:#00f;font-weight:700">.</span>getUserName()
                    <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07"> is not allowed access to method </span> <span style="color:#00f;font-weight:700">+</span> method<span style="color:#00f;font-weight:700">.</span>getName());
        }
    }
}
</pre>
        <div class="Para" id="Par70">The <span class="EmphasisFontCategoryNonProportional">SecurityAdvice</span> class creates an instance of <span class="EmphasisFontCategoryNonProportional">SecurityManager</span> in its constructor and then stores this instance in a field. You
            should note that the application and <span class="EmphasisFontCategoryNonProportional">SecurityAdvice</span> don’t need to share the same <span class="EmphasisFontCategoryNonProportional">SecurityManager</span> instance because all data is
            stored with the current thread by using <span class="EmphasisFontCategoryNonProportional">ThreadLocal</span>. In the <span class="EmphasisFontCategoryNonProportional">before()</span> method, we perform a simple check to see whether the username
            of the authenticated user is <span class="EmphasisFontCategoryNonProportional">John</span>. If so, we allow the user access; otherwise, an exception is raised. Also notice that we check for a <span class="EmphasisFontCategoryNonProportional">null UserInfo</span>            object, which indicates that the current user is not <span id="ITerm26">authenticated                      </span> <span id="ITerm27">                                              </span>.</div>
        <div class="Para" id="Par71">In the following code snippet, you can see a sample application that uses the <span class="EmphasisFontCategoryNonProportional">SecurityAdvice</span> class to secure the <span class="EmphasisFontCategoryNonProportional">SecureBean</span>
            <span id="ITerm28">class </span>:</div>
        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.framework.ProxyFactory</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SecurityDemo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">SecurityManager</span> mgr <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SecurityManager</span>();
        <span style="color:#00f;font-weight:700">SecureBean</span> bean <span style="color:#00f;font-weight:700">=</span> getSecureBean();
        mgr<span style="color:#00f;font-weight:700">.</span>login(<span style="color:#036a07">John</span>, <span style="color:#036a07">pwd</span>);
        bean<span style="color:#00f;font-weight:700">.</span>writeSecureMessage();
        mgr<span style="color:#00f;font-weight:700">.</span>logout();
        <span style="color:#00f;font-weight:700">try</span> {
            mgr<span style="color:#00f;font-weight:700">.</span>login(<span style="color:#036a07">invalid user</span>, <span style="color:#036a07">pwd</span>);
            bean<span style="color:#00f;font-weight:700">.</span>writeSecureMessage();
        } <span style="color:#00f;font-weight:700">catch</span> (<span style="color:#00f;font-weight:700">SecurityException</span> ex) {
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Exception Caught: </span> <span style="color:#00f;font-weight:700">+</span> ex<span style="color:#00f;font-weight:700">.</span>getMessage());
        } <span style="color:#00f;font-weight:700">finally</span> {
            mgr<span style="color:#00f;font-weight:700">.</span>logout();
        }
        <span style="color:#00f;font-weight:700">try</span> {
            bean<span style="color:#00f;font-weight:700">.</span>writeSecureMessage();
        } <span style="color:#00f;font-weight:700">catch</span> (<span style="color:#00f;font-weight:700">SecurityException</span> ex) {
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Exception Caught: </span> <span style="color:#00f;font-weight:700">+</span> ex<span style="color:#00f;font-weight:700">.</span>getMessage());
        }
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">SecureBean</span> <span style="color:#0000a2;font-weight:700">getSecureBean</span>() {
        <span style="color:#00f;font-weight:700">SecureBean</span> target <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SecureBean</span>();
        <span style="color:#00f;font-weight:700">SecurityAdvice</span> advice <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SecurityAdvice</span>();
        <span style="color:#00f;font-weight:700">ProxyFactory</span> factory <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ProxyFactory</span>();
        factory<span style="color:#00f;font-weight:700">.</span>setTarget(target);
        factory<span style="color:#00f;font-weight:700">.</span>addAdvice(advice);
        <span style="color:#00f;font-weight:700">SecureBean</span> proxy <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">SecureBean</span>) factory<span style="color:#00f;font-weight:700">.</span>getProxy();
        <span style="color:#00f;font-weight:700">return</span> proxy;
    }
}
</pre>
        <div class="Para" id="Par73">In the <span class="EmphasisFontCategoryNonProportional">getSecureBean()</span> method, we create a proxy of the <span class="EmphasisFontCategoryNonProportional">SecureBean</span> class that is advised using an instance of <span class="EmphasisFontCategoryNonProportional">SecurityAdvice</span>.
            This proxy is returned to the caller. When the caller invokes any method on this proxy, the call is first routed to the instance of <span class="EmphasisFontCategoryNonProportional">SecurityAdvice</span> for a security check. In the
            <span class="EmphasisFontCategoryNonProportional">main()</span> method, we test three scenarios, invoking the <span class="EmphasisFontCategoryNonProportional">SecureBean.writeSecureMessage()</span> method with two sets of user credentials and then no user credentials at all. Because
                <span class="EmphasisFontCategoryNonProportional">SecurityAdvice</span> allows method calls to proceed only if the currently authenticated user is <span class="EmphasisFontCategoryNonProportional">John</span>, we can expect that the only successful scenario in the previous code is the
                    first. Running this example gives the following <span id="ITerm30">output                      </span> <span id="ITerm31">                                              </span>:</div>
        <div class="Para" id="Par74">
            <div class="ProgramCode" id="PC13">
                <div class="FixedLine">Logged in user is John - OKAY!</div>
                <div class="FixedLine">Every time I learn something new,  it pushes some old stuff out of my brain</div>
                <div class="FixedLine">Logged in user is invalid user NOT GOOD :(</div>
                <div class="FixedLine">Exception Caught: User  invalid user is not allowed access to method</div>
                <div class="FixedLine">              writeSecureMessage</div>
                <div class="FixedLine">No user authenticated</div>
                <div class="FixedLine">Exception Caught: You must login before attempting to invoke the method:</div>
                <div class="FixedLine">              writeSecureMessage</div>
            </div>
        </div>
        <div class="Para" id="Par75">As you can see, only the first invocation of <span class="EmphasisFontCategoryNonProportional">SecureBean.writeSecureMessage()</span> was allowed to proceed. The remaining invocations were prevented by the <span class="EmphasisFontCategoryNonProportional">SecurityException</span>            exception thrown by <span class="EmphasisFontCategoryNonProportional">SecurityAdvice</span>. This example is simple, but it does highlight the usefulness of before advice. Security is a typical example of before advice, but we also find it
            useful when a scenario demands the modification of arguments passed to the <span id="ITerm32">method                                  </span>.</div>
        </div>
        <div class="Section2 RenderAsSection2" id="Sec17">
            <h3 class="Heading">Creating <span id="ITerm33">After-Returning Advice                                  </span> </h3>
            <div class="Para" id="Par76">After-returning advice is executed after the method invocation at the joinpoint returns. Given that the method has already executed, you can’t change the arguments that are passed to it. Although you can read these arguments, you can’t change
                the execution path, and you can’t prevent the method from executing. These restrictions are expected; what is not expected, however, is that you cannot modify the return value in the after-returning advice. When using after-returning advice,
                you are limited to adding processing. Although after-returning advice cannot modify the return value of a method invocation, it can throw an exception that can be sent up the stack instead of the return value.</div>
            <div class="Para" id="Par77">In this section, we look at two examples of using after-returning advice in an application. The first example simply writes a message to console output after the method has been invoked. The second example shows how you can use after-returning
                advice to add error checking to a method. Consider a class, <span class="EmphasisFontCategoryNonProportional">KeyGenerator</span>, which generates keys for cryptographic purposes. Many cryptographic algorithms suffer from the problem that
                a small number of keys are considered weak. A weak key is any key whose characteristics make it significantly easier to derive the original message without knowing the key. For the DES algorithm, there are a total of 256 possible keys.
                From this key space, 4 keys are considered weak, and another 12 are considered semiweak. Although the chance of one of these keys being generated randomly is small (1 in 252), testing for the keys is so simple that it’s worthwhile to do
                so. In the second example of this section, we build after-returning advice that checks for weak keys generated by <span id="ITerm34">                <span class="EmphasisFontCategoryNonProportional">KeyGenerator</span> </span>, raising
                an exception if one is found.</div>
            <div class="Para ParaTypeImportant" id="Par78"> <img alt="A315511_5_En_5_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Figa_HTML.jpg" width="30"/>                For more information on weak keys and cryptography at large, we recommend a visit to William Stallings’ site at <span class="ExternalRef"><a href="http://williamstallings.com/Cryptography/"><span class="RefSource">                  <span class="EmphasisFontCategoryNonProportional">http://williamstallings.com/Cryptography/</span>                </span>
                </a>
                </span>.</div>
            <div class="Para" id="Par79">In the following code snippet, you can see the <span id="ITerm35">                <span class="EmphasisFontCategoryNonProportional">SimpleAfterReturningAdvice</span> </span> class, which demonstrates the use of after-returning advice by writing
                a message to console output after a method has returned. The previously introduced class <span class="EmphasisFontCategoryNonProportional">Guitarist</span> is reused here.</div>
            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.lang.reflect.Method</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.AfterReturningAdvice</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.framework.ProxyFactory</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SimpleAfterReturningAdvice</span> implements
        AfterReturningAdvice {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">Guitarist</span> target <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Guitarist</span>();
        <span style="color:#00f;font-weight:700">ProxyFactory</span> pf <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ProxyFactory</span>();
        pf<span style="color:#00f;font-weight:700">.</span>addAdvice(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SimpleAfterReturningAdvice</span>());
        pf<span style="color:#00f;font-weight:700">.</span>setTarget(target);
        <span style="color:#00f;font-weight:700">Guitarist</span> proxy <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">Guitarist</span>) pf<span style="color:#00f;font-weight:700">.</span>getProxy();
        proxy<span style="color:#00f;font-weight:700">.</span>sing();
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">afterReturning</span>(<span style="color:#00f;font-weight:700">Object</span> <span style="font-style:italic">returnValue</span>, <span style="color:#00f;font-weight:700">Method</span> <span style="font-style:italic">method</span>,
                               <span style="color:#00f;font-weight:700">Object</span>[] <span style="font-style:italic">args</span>, <span style="color:#00f;font-weight:700">Object</span> <span style="font-style:italic">target</span>) <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Throwable</span> {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">After &apos;</span> <span style="color:#00f;font-weight:700">+</span> method<span style="color:#00f;font-weight:700">.</span>getName() <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">&apos; put down guitar.</span>);
    }
}
</pre>
            <div class="Para" id="Par81">Notice that the <span class="EmphasisFontCategoryNonProportional">AfterReturningAdvice</span> interface declares a single method, <span class="EmphasisFontCategoryNonProportional">afterReturning()</span>, which is passed the return value of
                method invocation, a reference to the method that was invoked, the arguments that were passed to the method, and the target of the invocation. Running this example results in the following <span id="ITerm37">output                                  </span>:</div>
            <div class="Para" id="Par82">
                <div class="ProgramCode" id="PC15">
                    <div class="FixedLine">You&apos;re gonna live forever in me</div>
                    <div class="FixedLine">After &apos;<span class="EmphasisTypeUnderline">sing</span>&apos; put down guitar.</div>
                </div>
        </div>
        <div class="Para ParaOneEmphasisChild" id="Par83">The output is similar to that of the before-advice example except that, as expected, the message written by the advice appears after the message written by the <span class="EmphasisFontCategoryNonProportional">writeMessage()</span> method. A good
            use of after-returning advice is to perform some additional error checking when it is possible for a method to return an invalid value.</div>
        <div class="Para" id="Par84">In the scenario we described earlier, it is possible for a cryptographic key generator to generate a key that is considered weak for a particular algorithm. Ideally, the key generator would check for these weak keys, but since the chance of these
            keys arising is often very small, many generators do not check. By using after-returning advice, we can advise the method that generates the key and performs this additional check. The following is an extremely primitive <span id="ITerm38">key generator                      </span>:</div>
        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Random</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">KeyGenerator</span> {
    <span style="color:#00f;font-weight:700">protected</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">long</span> <span style="color:#c5060b;font-weight:700">WEAK_KEY</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#0000cd">0xFFFFFFF0000000L</span>;
    <span style="color:#00f;font-weight:700">protected</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">long</span> <span style="color:#c5060b;font-weight:700">STRONG_KEY</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#0000cd">0xACDF03F590AE56L</span>;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Random</span> rand <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Random</span>();

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">long</span> <span style="color:#0000a2;font-weight:700">getKey</span>() {
        <span style="color:#00f;font-weight:700">int</span> x <span style="color:#00f;font-weight:700">=</span> rand<span style="color:#00f;font-weight:700">.</span>nextInt(<span style="color:#0000cd">3</span>);
        <span style="color:#00f;font-weight:700">if</span> (x <span style="color:#00f;font-weight:700">==</span> <span style="color:#0000cd">1</span>) {
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#c5060b;font-weight:700">WEAK_KEY</span>;
        }
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#c5060b;font-weight:700">STRONG_KEY</span>;
    }
}
</pre>
            <div class="Para" id="Par86">This key generator should not be considered secure. It’s purposely simple for this example and has a one-in-three chance of producing a weak key. In the following snippet, you can see <span class="EmphasisFontCategoryNonProportional">WeakKeyCheckAdvice</span>,
                which checks to see whether the result of the <span class="EmphasisFontCategoryNonProportional">getKey()</span> <span id="ITerm39">method                      </span> is a weak <span id="ITerm40">key                                  </span>:</div>
            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.lang.reflect.Method</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.AfterReturningAdvice</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.crypto.KeyGenerator</span>;

<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5.KeyGenerator.WEAK_KEY</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">WeakKeyCheckAdvice</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">AfterReturningAdvice</span> {
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">afterReturning</span>(<span style="color:#00f;font-weight:700">Object</span> <span style="font-style:italic">returnValue</span>, <span style="color:#00f;font-weight:700">Method</span> <span style="font-style:italic">method</span>,
                               <span style="color:#00f;font-weight:700">Object</span> <span style="font-style:italic">args</span>, <span style="color:#00f;font-weight:700">Object</span> <span style="font-style:italic">target</span>) <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Throwable</span> {
        <span style="color:#00f;font-weight:700">if</span> ((target <span style="color:#00f;font-weight:700">instanceof</span> <span style="color:#00f;font-weight:700">KeyGenerator</span>)
                <span style="color:#00f;font-weight:700">&amp;&amp;</span> (<span style="color:#036a07">getKey</span><span style="color:#00f;font-weight:700">.</span>equals(method<span style="color:#00f;font-weight:700">.</span>getName()))) {
            <span style="color:#00f;font-weight:700">long</span> key <span style="color:#00f;font-weight:700">=</span> ((<span style="color:#00f;font-weight:700">Long</span>) returnValue)<span style="color:#00f;font-weight:700">.</span>longValue();
            <span style="color:#00f;font-weight:700">if</span> (key <span style="color:#00f;font-weight:700">==</span> <span style="color:#c5060b;font-weight:700">WEAK_KEY</span>) {
                <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SecurityException</span>(
                        <span style="color:#036a07">Key Generator generated a weak key. Try again</span>);
            }
        }
    }
}
</pre>
                <div class="Para" id="Par88">In the <span class="EmphasisFontCategoryNonProportional">afterReturning()</span> method, we check first to see whether the method that was executed at the joinpoint was the <span class="EmphasisFontCategoryNonProportional">getKey()</span>                    method. If so, we then check the result value to see whether it was the weak key. If we find that the result of the <span class="EmphasisFontCategoryNonProportional">getKey()</span> <span id="ITerm41">method                       </span>was
                    a weak key, then we throw a <span class="EmphasisFontCategoryNonProportional">SecurityException</span> to inform the calling code of this. The following code <span id="ITerm42">snippet                                  </span> shows
                    a simple application that demonstrates the use of this advice:</div>
                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.framework.ProxyFactory</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.crypto.KeyGenerator</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AfterAdviceDemo</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">KeyGenerator</span> <span style="color:#0000a2;font-weight:700">getKeyGenerator</span>() {
        <span style="color:#00f;font-weight:700">KeyGenerator</span> target <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">KeyGenerator</span>();
        <span style="color:#00f;font-weight:700">ProxyFactory</span> factory <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ProxyFactory</span>();
        factory<span style="color:#00f;font-weight:700">.</span>setTarget(target);
        factory<span style="color:#00f;font-weight:700">.</span>addAdvice(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">WeakKeyCheckAdvice</span>());
        <span style="color:#00f;font-weight:700">return</span> (<span style="color:#00f;font-weight:700">KeyGenerator</span>) factory<span style="color:#00f;font-weight:700">.</span>getProxy();
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">KeyGenerator</span> keyGen <span style="color:#00f;font-weight:700">=</span> getKeyGenerator();
        <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">int</span> x <span style="color:#00f;font-weight:700">=</span> <span style="color:#0000cd">0</span>; x <span style="color:#00f;font-weight:700">&lt;</span> <span style="color:#0000cd">10</span>; x<span style="color:#00f;font-weight:700">++</span>) {
            <span style="color:#00f;font-weight:700">try</span> {
                <span style="color:#00f;font-weight:700">long</span> key <span style="color:#00f;font-weight:700">=</span> keyGen<span style="color:#00f;font-weight:700">.</span>getKey();
                <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Key: </span> <span style="color:#00f;font-weight:700">+</span> key);
            } <span style="color:#00f;font-weight:700">catch</span> (<span style="color:#00f;font-weight:700">SecurityException</span> ex) {
                <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Weak Key Generated!</span>);
            }
        }
    }
}</pre>
                <div class="Para" id="Par90">After creating an advised proxy of the <span class="EmphasisFontCategoryNonProportional">KeyGenerator</span> target, the <span class="EmphasisFontCategoryNonProportional">AfterAdviceDemo</span> class attempts to generate ten keys. If a
                    <span class="EmphasisFontCategoryNonProportional">SecurityException</span> is thrown during a single generation, a message is written to the console, informing the user that a weak key was generated; otherwise, the generated key is
                    displayed. A single run of this on our machine generated the following output:</div>
                <div class="Para" id="Par91">
                    <div class="ProgramCode" id="PC19">
                        <div class="FixedLine">Key: 48658904092028502</div>
                        <div class="FixedLine">Weak Key Generated!</div>
                        <div class="FixedLine">Key: 48658904092028502</div>
                        <div class="FixedLine">Weak Key Generated!</div>
                        <div class="FixedLine">Weak Key Generated!</div>
                        <div class="FixedLine">Weak Key Generated!</div>
                        <div class="FixedLine">Key: 48658904092028502</div>
                        <div class="FixedLine">Key: 48658904092028502</div>
                        <div class="FixedLine">Key: 48658904092028502</div>
                        <div class="FixedLine">Key: <span id="ITerm43">48658904092028502                                              </span> </div>
                    </div>
                </div>
                <div class="Para" id="Par92">As you can see, the <span id="ITerm44">                <span class="EmphasisFontCategoryNonProportional">KeyGenerator</span> </span> class sometimes generates weak keys, as expected, and <span class="EmphasisFontCategoryNonProportional">WeakKeyCheckAdvice</span>                    ensures that <span class="EmphasisFontCategoryNonProportional">SecurityException</span> is raised whenever a weak key is encountered.</div>
                </div>
                <div class="Section2 RenderAsSection2" id="Sec18">
                    <h3 class="Heading">Creating <span id="ITerm45">Around Advice                                  </span> </h3>
                    <div class="Para" id="Par93"> <span class="EmphasisTypeItalic">Around advice</span> functions like a combination of before and after advice, with one big difference: you can modify the return value. Not only that, but you can prevent the method from executing.
                        This means that by using around advice, you can essentially replace the entire implementation of a method with new code. Around advice in Spring is modeled as an interceptor using the <span id="ITerm46">                <span class="EmphasisFontCategoryNonProportional">MethodInterceptor</span>                        </span> interface. There are many uses for around advice, and you will find that many features of Spring are created by using method interceptors, such as the remote proxy support and the transaction management features. Method
                        interception is also a good mechanism for profiling the execution of your application, and it forms the basis of the example in this section.</div>
                    <div class="Para" id="Par94">We are not going to see how to build a simple example for method interception; instead, we refer to the first example using the <span class="EmphasisFontCategoryNonProportional">Agent</span> class, which shows how to use a basic method
                        interceptor to write a message on either side of a method invocation. Notice from this earlier example that the <span class="EmphasisFontCategoryNonProportional">invoke()</span> method of the <span class="EmphasisFontCategoryNonProportional">MethodInterceptor</span>                        interface does not provide the same set of arguments as <span class="EmphasisFontCategoryNonProportional">MethodBeforeAdvice</span> and <span class="EmphasisFontCategoryNonProportional">AfterReturningAdvice</span>. The method is
                        not passed the target of the invocation, the method that was invoked, or the arguments used. However, you can access this data by using the <span class="EmphasisFontCategoryNonProportional">MethodInvocation</span> object that is
                        passed to <span class="EmphasisFontCategoryNonProportional">invoke()</span>. You will see a demonstration of this in the following example.</div>
                    <div class="Para" id="Par95">For this example, we want to achieve some way to advise a class so we get basic information about the runtime performance of its methods. Specifically, we want to know how long the method took to execute. To achieve this, we can use
                        the <span class="EmphasisFontCategoryNonProportional">StopWatch</span> class included in Spring, and we clearly need a <span class="EmphasisFontCategoryNonProportional">MethodInterceptor</span>, because we need to start <span class="EmphasisFontCategoryNonProportional">StopWatch</span>                        before the method invocation and stop it right afterward.</div>
                    <div class="Para" id="Par96">The following code snippet shows the <span class="EmphasisFontCategoryNonProportional">WorkerBean</span> class that we are going to profile by using the <span class="EmphasisFontCategoryNonProportional">StopWatch</span> class and around
                        advice:</div>
                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">WorkerBean</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">doSomeWork</span>(<span style="color:#00f;font-weight:700">int</span> <span style="font-style:italic">noOfTimes</span>) {
        <span style="color:#00f;font-weight:700">for</span>(<span style="color:#00f;font-weight:700">int</span> x <span style="color:#00f;font-weight:700">=</span> <span style="color:#0000cd">0</span>; x <span style="color:#00f;font-weight:700">&lt;</span> noOfTimes; x<span style="color:#00f;font-weight:700">++</span>) {
            work();
        }
    }
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">work</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>print(<span style="color:#036a07"></span>);
    }
}
</pre>
                    <div class="Para" id="Par98">This is a simple class. The <span class="EmphasisFontCategoryNonProportional">doSomeWork()</span> method accepts a single argument, <span class="EmphasisFontCategoryNonProportional">noOfTimes</span>, and calls the <span class="EmphasisFontCategoryNonProportional">work()</span>                        method exactly the number of times specified by this method. The <span class="EmphasisFontCategoryNonProportional">work()</span> method simply has a dummy call to <span class="EmphasisFontCategoryNonProportional">System.out.print()</span>,
                        which passes in an empty <span class="EmphasisFontCategoryNonProportional">String</span>. This prevents the compiler from optimizing the <span class="EmphasisFontCategoryNonProportional">work()</span> method and thus the call to
                        <span class="EmphasisFontCategoryNonProportional">work()</span>.</div>
                    <div class="Para" id="Par99">In the following snippet, you can see the <span id="ITerm47">                <span class="EmphasisFontCategoryNonProportional">ProfilingInterceptor</span> </span> class that uses the <span class="EmphasisFontCategoryNonProportional">StopWatch</span>                        class to profile method invocation times. We use this interceptor to profile the <span class="EmphasisFontCategoryNonProportional">WorkerBean</span> class shown previously.</div>
                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.lang.reflect.Method</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.aopalliance.intercept.MethodInterceptor</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.aopalliance.intercept.MethodInvocation</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.util.StopWatch</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">ProfilingInterceptor</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">MethodInterceptor</span> {
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Object</span> <span style="color:#0000a2;font-weight:700">invoke</span>(<span style="color:#00f;font-weight:700">MethodInvocation</span> <span style="font-style:italic">invocation</span>) <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Throwable</span> {
        <span style="color:#00f;font-weight:700">StopWatch</span> sw <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">StopWatch</span>();
        sw<span style="color:#00f;font-weight:700">.</span>start(invocation<span style="color:#00f;font-weight:700">.</span>getMethod()<span style="color:#00f;font-weight:700">.</span>getName());
        <span style="color:#00f;font-weight:700">Object</span> returnValue <span style="color:#00f;font-weight:700">=</span> invocation<span style="color:#00f;font-weight:700">.</span>proceed();
        sw<span style="color:#00f;font-weight:700">.</span>stop();
        dumpInfo(invocation, sw<span style="color:#00f;font-weight:700">.</span>getTotalTimeMillis());
        <span style="color:#00f;font-weight:700">return</span> returnValue;
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">dumpInfo</span>(<span style="color:#00f;font-weight:700">MethodInvocation</span> <span style="font-style:italic">invocation</span>, <span style="color:#00f;font-weight:700">long</span> <span style="font-style:italic">ms</span>) {
        <span style="color:#00f;font-weight:700">Method</span> m <span style="color:#00f;font-weight:700">=</span> invocation<span style="color:#00f;font-weight:700">.</span>getMethod();
        <span style="color:#00f;font-weight:700">Object</span> target <span style="color:#00f;font-weight:700">=</span> invocation<span style="color:#00f;font-weight:700">.</span>getThis();
        <span style="color:#00f;font-weight:700">Object</span> args <span style="color:#00f;font-weight:700">=</span> invocation<span style="color:#00f;font-weight:700">.</span>getArguments();
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Executed method: </span> <span style="color:#00f;font-weight:700">+</span> m<span style="color:#00f;font-weight:700">.</span>getName());
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">On object of type: </span> <span style="color:#00f;font-weight:700">+</span>
                target<span style="color:#00f;font-weight:700">.</span>getClass()<span style="color:#00f;font-weight:700">.</span>getName());
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">With arguments:</span>);
        <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">int</span> x <span style="color:#00f;font-weight:700">=</span> <span style="color:#0000cd">0</span>; x <span style="color:#00f;font-weight:700">&lt;</span> args<span style="color:#00f;font-weight:700">.</span>length; x<span style="color:#00f;font-weight:700">++</span>) {
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>print(<span style="color:#036a07"> &gt; </span> <span style="color:#00f;font-weight:700">+</span> argsx);
        }
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>print(<span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span>&quot;</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Took: </span> <span style="color:#00f;font-weight:700">+</span> ms <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07"> ms</span>);
    }
}</pre>
                    <div class="Para" id="Par101">In the <span class="EmphasisFontCategoryNonProportional">invoke()</span> method, which is the only method in the <span class="EmphasisFontCategoryNonProportional">MethodInterceptor</span> interface, we create an instance of <span class="EmphasisFontCategoryNonProportional">StopWatch</span>                        and then start it running immediately, allowing the method invocation to proceed with a call to <span class="EmphasisFontCategoryNonProportional">MethodInvocation.proceed()</span>. As soon as the method invocation has ended and
                        the return value has been captured, we stop <span class="EmphasisFontCategoryNonProportional">StopWatch</span> and pass the total number of milliseconds taken, along with the <span class="EmphasisFontCategoryNonProportional">MethodInvocation</span>                        object, to the <span class="EmphasisFontCategoryNonProportional">dumpInfo()</span> method. Finally, we return the <span class="EmphasisFontCategoryNonProportional">Object</span> returned by <span class="EmphasisFontCategoryNonProportional">MethodInvocation.proceed()</span>                        so that the caller obtains the correct return value. In this case, we did not want to disrupt the call stack in any way; we were simply acting as an eavesdropper on the method invocation. If we had wanted, we could have changed
                        the call stack completely, redirecting the method call to another object or a remote service, or we could simply have reimplemented the method logic inside the interceptor and returned a different return <span id="ITerm50">value                                  </span>.</div>
                    <div class="Para" id="Par102">The <span class="EmphasisFontCategoryNonProportional">dumpInfo()</span> method simply writes some information about the method call to console output, along with the time taken for the method to execute. In the first three lines of
                        <span class="EmphasisFontCategoryNonProportional">dumpInfo()</span>, you can see how you can use the <span class="EmphasisFontCategoryNonProportional">MethodInvocation</span> object to determine the method that was invoked, the
                        original target of the invocation, and the arguments used.</div>
                <div class="Para" id="Par103">The following code sample shows the <span id="ITerm51">                <span class="EmphasisFontCategoryNonProportional">ProfilingDemo</span> </span> class that first advises an instance of <span class="EmphasisFontCategoryNonProportional">WorkerBean</span>                    with a <span class="EmphasisFontCategoryNonProportional">ProfilingInterceptor</span> and then profiles the <span class="EmphasisFontCategoryNonProportional">doSomeWork()</span> method.</div>
                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.framework.ProxyFactory</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">ProfilingDemo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">WorkerBean</span> bean <span style="color:#00f;font-weight:700">=</span> getWorkerBean();
        bean<span style="color:#00f;font-weight:700">.</span>doSomeWork(<span style="color:#0000cd">10000000</span>);
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">WorkerBean</span> <span style="color:#0000a2;font-weight:700">getWorkerBean</span>() {
        <span style="color:#00f;font-weight:700">WorkerBean</span> target <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">WorkerBean</span>();
        <span style="color:#00f;font-weight:700">ProxyFactory</span> factory <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ProxyFactory</span>();
        factory<span style="color:#00f;font-weight:700">.</span>setTarget(target);
        factory<span style="color:#00f;font-weight:700">.</span>addAdvice(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ProfilingInterceptor</span>());
        <span style="color:#00f;font-weight:700">return</span> (<span style="color:#00f;font-weight:700">WorkerBean</span>) factory<span style="color:#00f;font-weight:700">.</span>getProxy();
    }
}
</pre>
                <div class="Para" id="Par105">Running this example on our machine produces the following output:</div>
                <div class="Para" id="Par106">
                    <div class="ProgramCode" id="PC23">
                        <div class="FixedLine">Executed method: doSomeWork</div>
                        <div class="FixedLine">On object of type: com.apress.prospring5.ch5.WorkerBean</div>
                        <div class="FixedLine">With arguments:</div>
                        <div class="FixedLine">       &gt; 10000000</div>
                        <div class="FixedLine">Took: 1139 <span id="ITerm53">ms                                              </span> </div>
                    </div>
                </div>
                <div class="Para" id="Par107">From this output, you can see which method was executed, what the class of the target was, what arguments were passed in, and how long the invocation took.</div>
                </div>
                <div class="Section2 RenderAsSection2" id="Sec19">
                    <h3 class="Heading">Creating <span id="ITerm54">Throws Advice                                  </span> </h3>
                    <div class="Para" id="Par108"> <span id="ITerm55">                <span class="EmphasisTypeItalic">Throws advice</span> </span> is similar to after-returning advice in that it executes after the joinpoint, which is always a method invocation, but throws advice executes
                        only if the method throws an exception. Throws advice is also similar to after-returning advice in that it has little control over program execution. If you are using throws advice, you can’t choose to ignore the exception that
                        was raised and return a value for the method instead. The only modification you can make to the program flow is to change the type of exception that is thrown. This is quite a powerful concept and can make application development
                        much simpler. Consider a situation where you have an API that throws an array of poorly defined exceptions. Using throws advice, you can advise all classes in that API and reclassify the exception hierarchy into something more
                        manageable and descriptive. Of course, you can also use throws advice to provide centralized error logging across your application, thus reducing the amount of error-logging code that is spread across your application.</div>
                    <div class="Para" id="Par109">As you saw from the diagram in Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Chapter.html#Fig2">5-2</a></span>, throws advice is implemented by the
                        <span class="EmphasisFontCategoryNonProportional">ThrowsAdvice</span> interface. Unlike the interfaces you have seen so far, <span class="EmphasisFontCategoryNonProportional">ThrowsAdvice</span> does not define any methods; instead, it is simply a marker interface used by Spring.
                            The reason for this is that Spring allows typed throws advice, which allows you to define exactly which <span class="EmphasisFontCategoryNonProportional">Exception</span> types your throws advice should catch. Spring achieves
                            this by detecting methods with certain signatures using reflection. Spring looks for two distinct method signatures. This is best demonstrated with a simple example. The following code snippet shows a simple bean with two methods
                            that both simply throw exceptions of different types:</div>
                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">ErrorBean</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">errorProneMethod</span>() <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Exception</span> {
        <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Exception</span>(<span style="color:#036a07">Generic Exception</span>);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">otherErrorProneMethod</span>() <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">IllegalArgumentException</span> {
        <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">IllegalArgumentException</span>(<span style="color:#036a07">IllegalArgument Exception</span>);
    }
}
</pre>
                <div class="Para ParaOneEmphasisChild" id="Par111">Here you can see the <span class="EmphasisFontCategoryNonProportional">SimpleThrowsAdvice</span> class that demonstrates both of the method signatures that Spring looks for on throws advice:</div>
                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.lang.reflect.Method</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.ThrowsAdvice</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.framework.ProxyFactory</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SimpleThrowsAdvice</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">ThrowsAdvice</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Exception</span> {
        <span style="color:#00f;font-weight:700">ErrorBean</span> errorBean <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ErrorBean</span>();
        <span style="color:#00f;font-weight:700">ProxyFactory</span> pf <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ProxyFactory</span>();
        pf<span style="color:#00f;font-weight:700">.</span>setTarget(errorBean);
        pf<span style="color:#00f;font-weight:700">.</span>addAdvice(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SimpleThrowsAdvice</span>());
        <span style="color:#00f;font-weight:700">ErrorBean</span> proxy <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">ErrorBean</span>) pf<span style="color:#00f;font-weight:700">.</span>getProxy();
        <span style="color:#00f;font-weight:700">try</span> {
            proxy<span style="color:#00f;font-weight:700">.</span>errorProneMethod();
        } <span style="color:#00f;font-weight:700">catch</span> (<span style="color:#00f;font-weight:700">Exception</span> ignored) {
        }
        <span style="color:#00f;font-weight:700">try</span> {
            proxy<span style="color:#00f;font-weight:700">.</span>otherErrorProneMethod();
        } <span style="color:#00f;font-weight:700">catch</span> (<span style="color:#00f;font-weight:700">Exception</span> ignored) {
        }
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">afterThrowing</span>(<span style="color:#00f;font-weight:700">Exception</span> <span style="font-style:italic">ex</span>) <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Throwable</span> {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">***</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Generic Exception Capture</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Caught: </span> <span style="color:#00f;font-weight:700">+</span> ex<span style="color:#00f;font-weight:700">.</span>getClass()<span style="color:#00f;font-weight:700">.</span>getName());
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">&quot;***<span style="color:#26b31a">\n</span>&quot;</span>);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">afterThrowing</span>(<span style="color:#00f;font-weight:700">Method</span> <span style="font-style:italic">method</span>, <span style="color:#00f;font-weight:700">Object</span> <span style="font-style:italic">args</span>, <span style="color:#00f;font-weight:700">Object</span> <span style="font-style:italic">target</span>,
                              <span style="color:#00f;font-weight:700">IllegalArgumentException</span> <span style="font-style:italic">ex</span>) <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Throwable</span> {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">***</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">IllegalArgumentException Capture</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Caught: </span> <span style="color:#00f;font-weight:700">+</span> ex<span style="color:#00f;font-weight:700">.</span>getClass()<span style="color:#00f;font-weight:700">.</span>getName());
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Method: </span> <span style="color:#00f;font-weight:700">+</span> method<span style="color:#00f;font-weight:700">.</span>getName());
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">&quot;***<span style="color:#26b31a">\n</span>&quot;</span>);
    }
}
</pre>
                <div class="Para" id="Par113">The first thing Spring looks for in throws advice is one or more public methods called <span class="EmphasisFontCategoryNonProportional">afterThrowing()</span>. The return type of the methods is unimportant, although we find it best to
                    stick with <span class="EmphasisFontCategoryNonProportional">void</span> because this method can’t return any meaningful value. The first <span class="EmphasisFontCategoryNonProportional">afterThrowing()</span> method in the
                    <span class="EmphasisFontCategoryNonProportional">SimpleThrowsAdvice</span> class has a single argument of type <span class="EmphasisFontCategoryNonProportional">Exception</span>. You can specify any type of <span class="EmphasisFontCategoryNonProportional">Exception</span> as the
                        argument, and this method is ideal when you are not concerned about the method that threw the exception or the arguments that were passed to it. Note that this method catches <span class="EmphasisFontCategoryNonProportional">Exception</span>                        and any subtypes of <span class="EmphasisFontCategoryNonProportional">Exception</span> unless the type in question has its own <span class="EmphasisFontCategoryNonProportional">afterThrowing()</span> <span id="ITerm58">method          </span>.</div>
                <div class="Para" id="Par114">In the second <span class="EmphasisFontCategoryNonProportional">afterThrowing()</span> method, we declared four arguments to catch the method that threw the exception, the arguments that were passed to the method, and the target of the
                    method invocation. The order of the arguments in this method is important, and you must specify all four. Notice that the second <span class="EmphasisFontCategoryNonProportional">afterThrowing()</span> method catches exceptions of
                    type <span class="EmphasisFontCategoryNonProportional">IllegalArgumentException</span> (or its subtype). Running this example produces the following <span id="ITerm59">output                                  </span>:</div>
                    <div class="Para" id="Par115">
                        <div class="ProgramCode" id="PC26">
                            <div class="LineGroup">
                                <div class="FixedLine">***</div>
                                <div class="FixedLine">Generic Exception Capture</div>
                                <div class="FixedLine">Caught: java.lang.Exception</div>
                                <div class="FixedLine">***</div>
                            </div>
                            <div class="LineGroup">
                                <div class="FixedLine">***</div>
                                <div class="FixedLine">IllegalArgumentException Capture</div>
                                <div class="FixedLine">Caught: java.lang.IllegalArgumentException</div>
                                <div class="FixedLine">Method: otherErrorProneMethod</div>
                                <div class="FixedLine">***</div>
                            </div>
                        </div>
                    </div>
                    <div class="Para" id="Par116">As you can see, when a plain old <span class="EmphasisFontCategoryNonProportional">Exception</span> is thrown, the first <span class="EmphasisFontCategoryNonProportional">afterThrowing()</span> method is invoked, but when an
                        <span class="EmphasisFontCategoryNonProportional">IllegalArgumentException</span> is thrown, the second <span class="EmphasisFontCategoryNonProportional">afterThrowing()</span> method is invoked. Spring invokes a <span class="EmphasisFontCategoryNonProportional">afterThrowing()</span>                            method only for each <span class="EmphasisFontCategoryNonProportional">Exception</span>, and as you saw from the example in class <span class="EmphasisFontCategoryNonProportional">SimpleThrowsAdvice</span>, Spring uses the
                            method whose signature contains the best match for the <span class="EmphasisFontCategoryNonProportional">Exception</span> type. In the situation where your after-throwing advice has two <span class="EmphasisFontCategoryNonProportional">afterThrowing()</span>                            methods, both declared with the same <span class="EmphasisFontCategoryNonProportional">Exception</span> type but one with a single argument and the other with four arguments, Spring invokes the four-argument <span class="EmphasisFontCategoryNonProportional">afterThrowing()</span>                            <span id="ITerm60">method          </span>.</div>
                    <div class="Para" id="Par117">After-throwing advice is useful in a variety of situations; it allows you to reclassify entire <span class="EmphasisFontCategoryNonProportional">Exception</span> hierarchies as well as build centralized <span class="EmphasisFontCategoryNonProportional">Exception</span>                        logging for your application. We have found that after-throwing advice is particularly useful when we are debugging a live application because it allows us to add extra logging code without needing to modify the application’s
                        <span id="ITerm61">code </span>.</div>
                    </div>
                    <div class="Section2 RenderAsSection2" id="Sec20">
                        <h3 class="Heading">Choosing an Advice Type</h3>
                        <div class="Para" id="Par118">In general, choosing an advice type is driven by the requirements of your application, but you should choose the most specific advice type for your need. That is to say, don’t use around advice when before advice will do. In most
                            cases, around advice can accomplish everything that the other three advice types can, but it may be overkill for what you are trying to achieve. By using the most specific type of advice, you are making the intention of your
                            code clearer, and you are also reducing the possibility of errors. Consider advice that counts method calls. When you are using before advice, all you need to code is the counter, but with around advice, you need to remember
                            to invoke the method and return the value to the caller. These small things can allow spurious errors to creep into your application. By keeping the advice type as focused as possible, you reduce the scope for errors.</div>
                    </div>
                    </div>
                    <div class="Section1 RenderAsSection1" id="Sec21">
                        <h2 class="Heading">Advisors and <span id="ITerm62">Pointcuts                  </span> in Spring</h2>
                        <div class="Para" id="Par119">Thus far, all the examples you have seen have used the <span id="ITerm63">              <span class="EmphasisFontCategoryNonProportional">ProxyFactory</span> </span> class. This class provides a simple way of obtaining and configuring
                            AOP proxy instances in custom user code. The <span class="EmphasisFontCategoryNonProportional">ProxyFactory.addAdvice()</span> method is to configure advice for a proxy. This method delegates to <span class="EmphasisFontCategoryNonProportional">addAdvisor()</span>                            behind the scenes, creating an instance of <span class="EmphasisFontCategoryNonProportional">DefaultPointcutAdvisor</span> and configuring it with a pointcut that points to all methods. In this way, the advice is deemed to
                            apply to all methods on the target. In some cases, such as when you are using AOP for logging purposes, this may be desirable, but in other cases you may want to limit the methods to which the advice applies.</div>
                        <div class="Para" id="Par120">Of course, you could simply perform the checking in the advice itself that the method being advised is the correct one, but this approach has several drawbacks. First, hard-coding the list of acceptable methods into the advice
                            reduces the advice’s reusability. By using pointcuts, you can configure the methods to which an advice applies, without needing to put this code inside the advice; this clearly increases the reuse value of the advice. Other
                            drawbacks with hard-coding the list of methods into the advice are performance related. To inspect the method being advised in the advice, you need to perform the check each time any method on the target is invoked. This clearly
                            reduces the performance of your application. When you use pointcuts, the check is performed once for each method, and the results are cached for later use. The other performance-related drawback of not using pointcuts to restrict
                            the list-advised methods is that Spring can make optimizations for nonadvised methods when creating a proxy, which results in faster invocations on nonadvised methods. These optimizations are covered in greater detail when
                            we discuss proxies later in the chapter.</div>
                        <div class="Para" id="Par121">We strongly recommend that you avoid the temptation to hard-code method checks into your advice and instead use pointcuts wherever possible to govern the applicability of advice to methods on the target. That said, in some cases
                            it is necessary to hard-code the checks into your advice. Consider the earlier example of the after-returning advice designed to catch weak keys generated by the <span class="EmphasisFontCategoryNonProportional">KeyGenerator</span>                            class. This kind of advice is closely coupled to the class it is advising, and it is wise to check inside the advice to ensure that it is applied to the correct type. We refer to this coupling between advice and target as
                            <span class="EmphasisTypeItalic">target affinity</span>. In general, you should use pointcuts when your advice has little or no target affinity. That is, it can apply to any type or a wide range of types. When your advice has strong target affinity, try to
                                check that the advice is being used correctly in the advice itself; this helps reduce head-scratching errors when advice is misused. We also recommend you avoid advising methods needlessly. As you will see, this results
                                in a noticeable drop in invocation speed that can have a large impact on the overall performance of your application.</div>
                        <div class="Section2 RenderAsSection2" id="Sec22">
                            <h3 class="Heading">The Pointcut Interface</h3>
                            <div class="Para ParaOneEmphasisChild" id="Par122">Pointcuts in Spring are created by implementing the <span class="EmphasisFontCategoryNonProportional">Pointcut</span> interface, which is shown here:</div>
                            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">org.springframework.aop</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">jdk.nashorn.api.scripting.ClassFilter</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">Pointcut</span> {
    <span style="color:#00f;font-weight:700">ClassFilter</span> <span style="color:#0000a2;font-weight:700">getClassFilter</span>();

    <span style="color:#00f;font-weight:700">MethodMatcher</span> <span style="color:#0000a2;font-weight:700">getMethodMatcher</span>();
}
</pre>
                            <div class="Para" id="Par124">As you can see from this code, the <span class="EmphasisFontCategoryNonProportional">Pointcut</span> interface defines two methods, <span class="EmphasisFontCategoryNonProportional">getClassFilter()</span> and <span class="EmphasisFontCategoryNonProportional">getMethodMatcher()</span>,
                                which return instances of <span class="EmphasisFontCategoryNonProportional">ClassFilter</span> and <span class="EmphasisFontCategoryNonProportional">MethodMatcher</span>, respectively. Obviously, if you choose to implement
                                the <span class="EmphasisFontCategoryNonProportional">Pointcut</span> interface, you will need to implement these methods. Thankfully, as you will see in the next section, this is usually unnecessary because Spring provides
                                a selection of <span class="EmphasisFontCategoryNonProportional">Pointcut</span> implementations that cover most, if not all, of your use cases.</div>
                            <div class="Para" id="Par125">When determining whether a <span class="EmphasisFontCategoryNonProportional">Pointcut</span> applies to a particular method, Spring first checks to see whether the <span class="EmphasisFontCategoryNonProportional">Pointcut</span>                                interface applies to the method’s class by using the <span class="EmphasisFontCategoryNonProportional">ClassFilter</span> instance returned by <span class="EmphasisFontCategoryNonProportional">Pointcut.getClassFilter()</span>.
                                Here is the <span id="ITerm64">                <span class="EmphasisFontCategoryNonProportional">ClassFilter</span> </span> interface:</div>
                            <pre style="background:#fff;color:#000">org<span style="color:#00f;font-weight:700">.</span>springframework<span style="color:#00f;font-weight:700">.</span>aop;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">ClassFilter</span> {
    <span style="color:#00f;font-weight:700">boolean</span> <span style="color:#0000a2;font-weight:700">matches</span>(<span style="color:#00f;font-weight:700">Class&lt;?&gt;</span> <span style="font-style:italic">clazz</span>);
}
</pre>
                            <div class="Para" id="Par127">As you can see, the <span class="EmphasisFontCategoryNonProportional">ClassFilter</span> interface defines a single method, <span class="EmphasisFontCategoryNonProportional">matches()</span>, that is passed an instance of
                                <span class="EmphasisFontCategoryNonProportional">Class</span> that represents the class to be checked. As you have no doubt determined, the <span class="EmphasisFontCategoryNonProportional">matches()</span> method returns <span class="EmphasisFontCategoryNonProportional">true</span>                                    if the pointcut applies to the class and <span class="EmphasisFontCategoryNonProportional">false</span> otherwise.</div>
                            <div class="Para" id="Par128">The <span class="EmphasisFontCategoryNonProportional">MethodMatcher</span> interface is more complex than the <span class="EmphasisFontCategoryNonProportional">ClassFilter</span> interface, as shown here:</div>
                            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">org.springframework.aop</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">MethodMatcher</span> {
    <span style="color:#00f;font-weight:700">boolean</span> <span style="color:#0000a2;font-weight:700">matches</span>(<span style="color:#00f;font-weight:700">Method</span> <span style="font-style:italic">m</span>, <span style="color:#00f;font-weight:700">Class&lt;?&gt;</span> <span style="font-style:italic">targetClass</span>);

    <span style="color:#00f;font-weight:700">boolean</span> <span style="color:#0000a2;font-weight:700">isRuntime</span>();

    <span style="color:#00f;font-weight:700">boolean</span> <span style="color:#0000a2;font-weight:700">matches</span>(<span style="color:#00f;font-weight:700">Method</span> <span style="font-style:italic">m</span>, <span style="color:#00f;font-weight:700">Class&lt;?&gt;</span> <span style="font-style:italic">targetClass</span>, <span style="color:#00f;font-weight:700">Object</span>[] <span style="font-style:italic">args</span>);
}</pre>
                            <div class="Para" id="Par130">Spring supports two types of <span class="EmphasisFontCategoryNonProportional">MethodMatcher</span>, static and dynamic, which are determined by the return value of <span class="EmphasisFontCategoryNonProportional">isRuntime()</span>.
                                Before using <span class="EmphasisFontCategoryNonProportional">MethodMatcher</span>, Spring calls <span class="EmphasisFontCategoryNonProportional">isRuntime()</span> to determine whether <span class="EmphasisFontCategoryNonProportional">MethodMatcher</span>                                is static, indicated by a return value of <span class="EmphasisFontCategoryNonProportional">false</span>, or dynamic, indicated by a return value of <span class="EmphasisFontCategoryNonProportional">true</span>.</div>
                            <div class="Para" id="Par131">For a static pointcut, Spring calls the <span class="EmphasisFontCategoryNonProportional">matches(Method, Class&lt;T&gt;)</span> method of the <span class="EmphasisFontCategoryNonProportional">MethodMatcher</span> once for
                                every method on the target, caching the return value for subsequent invocations of those methods. In this way, the check for method applicability is performed only once for each method, and subsequent invocations of a method
                                do not result in an invocation of <span class="EmphasisFontCategoryNonProportional">matches()</span>.</div>
                        <div class="Para" id="Par132">With dynamic pointcuts, Spring still performs a static check by using <span class="EmphasisFontCategoryNonProportional">matches(Method, Class&lt;T&gt;)</span> the first time a method is invoked to determine the overall applicability
                            of a method. However, in addition to this and provided that the static check returned <span class="EmphasisFontCategoryNonProportional">true</span>, Spring performs a further check for each invocation of a method by using the
                            <span class="EmphasisFontCategoryNonProportional">matches(Method, Class&lt;T&gt;, Object[])</span> method. In this way, a dynamic <span class="EmphasisFontCategoryNonProportional">MethodMatcher</span> can determine whether
                            a pointcut should apply based on a particular invocation of a method, not just on the method itself. For example, a pointcut needs to be applied only when the argument is an <span class="EmphasisFontCategoryNonProportional">Integer</span>                            with a value larger than 100. In this case, the <span class="EmphasisFontCategoryNonProportional">matches(Method, Class&lt;T&gt;, Object[])</span> method can be coded to perform further checking on the argument for each invocation.</div>
                        <div class="Para" id="Par133">Clearly, static pointcuts perform much better than dynamic pointcuts because they avoid the need for an additional check per invocation. Dynamic pointcuts provide a greater level of flexibility for deciding whether to apply advice.
                            In general, we recommend you use static pointcuts wherever you can. However, in cases where your advice adds substantial overhead, it may be wise to avoid any unnecessary invocations of your advice by using a dynamic pointcut.</div>
                    <div class="Para" id="Par134">In general, you rarely create your own <span class="EmphasisFontCategoryNonProportional">Pointcut</span> implementations from scratch because Spring provides abstract base classes for both static and dynamic pointcuts. We will look
                        at these base classes, along with other <span class="EmphasisFontCategoryNonProportional">Pointcut</span> implementations, over the next few sections.</div>
                        </div>
                        <div class="Section2 RenderAsSection2" id="Sec23">
                            <h3 class="Heading">Available Pointcut <span id="ITerm65">Implementations                      </span> </h3>
                            <div class="Para" id="Par135">As of version 4.0, Spring provides eight implementations of the <span class="EmphasisFontCategoryNonProportional">Pointcut</span> interface: two abstract classes intended as convenience classes for creating static and dynamic
                                pointcuts, and six concrete classes, one for each of the following:
                                <div class="UnorderedList">
                                    <ul class="UnorderedListMarkBullet">
                                        <li>
                                            <div class="Para" id="Par136">Composing multiple pointcuts together</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par137">Handling control flow pointcuts</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par138">Performing simple name-based matching</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par139">Defining pointcuts using regular expressions</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par140">Defining pointcuts using AspectJ expressions</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par141">Defining pointcuts that look for specific annotations at the class or method level</div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="Para" id="Par142">Table <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Chapter.html#Tab2">5-2</a></span> summarizes the eight <span class="EmphasisFontCategoryNonProportional">Pointcut</span>                                interface implementations.
                                <div class="Table" id="Tab2">
                                    <div class="Caption" xml:lang="en">
                                        <div class="CaptionContent"><span class="CaptionNumber">Table 5-2.</span>
                                            <div class="SimplePara">Summary of Spring Pointcut <span id="ITerm66">Implementations                                      </span> </div>
                                        </div>
                                    </div>
                                    <table border="1">
                                        <colgroup>
                                            <col>
                                            <col>
                                        </colgroup>
                                        <thead>
                                            <tr class="header">
                                                <th>
                                                    <div class="SimplePara">Implementation Class</div>
                                                </th>
                                                <th>
                                                    <div class="SimplePara">Description</div>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="noclass">
                                                <td>
                                                    <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">org.springframework.aop.support.annotation.AnnotationMatchingPointcut</span> </div>
                                                </td>
                                                <td>
                                                    <div class="SimplePara">This implementation looks for a specific Java annotation on a class or method. This class requires JDK 5 or higher.</div>
                                                </td>
                                            </tr>
                                            <tr class="noclass">
                                                <td>
                                                    <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">org.springframework.aop.aspectj.AspectJExpressionPointcut</span> </div>
                                                </td>
                                                <td>
                                                    <div class="SimplePara">This implementation uses an AspectJ weaver to evaluate a pointcut expression in AspectJ syntax.</div>
                                                </td>
                                            </tr>
                                            <tr class="noclass">
                                                <td>
                                                    <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">org.springframework.aop.support.ComposablePointcut</span> </div>
                                                </td>
                                                <td>
                                                    <div class="SimplePara">The <span class="EmphasisFontCategoryNonProportional">ComposablePointcut</span> class is used to compose two or more pointcuts together with operations such as <span class="EmphasisFontCategoryNonProportional">union()</span>                                                        and <span class="EmphasisFontCategoryNonProportional">intersection()</span>.</div>
                                                </td>
                                            </tr>
                                            <tr class="noclass">
                                                <td>
                                                    <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">org.springframework.aop.support.ControlFlowPointcut</span> </div>
                                                </td>
                                                <td>
                                                    <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">ControlFlowPointcut</span> is a special case pointcut that matches all methods within the control flow of another method, that is, any method that is
                                                        invoked either directly or indirectly as the result of another method being invoked.</div>
                                                </td>
                                            </tr>
                                            <tr class="noclass">
                                                <td>
                                                    <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">org.springframework.aop.support.DynamicMethodMatcherPointcut</span> </div>
                                                </td>
                                                <td>
                                                    <div class="SimplePara">This implementation is intended as a base class for building dynamic pointcuts.</div>
                                                </td>
                                            </tr>
                                            <tr class="noclass">
                                                <td>
                                                    <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">org.springframework.aop.support.JdkRegexpMethodPointcut</span> </div>
                                                </td>
                                                <td>
                                                    <div class="SimplePara">This implementation allows you to define pointcuts using JDK 1.4 regular expression support. This class requires JDK 1.4 or newer.</div>
                                                </td>
                                            </tr>
                                            <tr class="noclass">
                                                <td>
                                                    <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">org.springframework.aop.support.NameMatchMethodPointcut</span> </div>
                                                </td>
                                                <td>
                                                    <div class="SimplePara">Using <span class="EmphasisFontCategoryNonProportional">NameMatchMethodPointcut</span>, you can create a pointcut that performs simple matching against a list of method names.</div>
                                                </td>
                                            </tr>
                                            <tr class="noclass">
                                                <td>
                                                    <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">org.springframework.aop.support.StaticMethodMatcherPointcut</span> </div>
                                                </td>
                                                <td>
                                                    <div class="SimplePara">The <span class="EmphasisFontCategoryNonProportional">StaticMethodMatcherPointcut</span> class is intended as a base for building static pointcuts.</div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="Para" id="Par143">Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Chapter.html#Fig3">5-3</a></span> shows the Unified Modeling Language (UML)<a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Chapter.html#Fn2" id="Fn2_source"><sup>2</sup></a> diagram for the <span class="EmphasisFontCategoryNonProportional">Pointcut</span> implementation classes.
                                <div class="Figure" id="Fig3">
                                    <div class="MediaObject" id="MO3"><img alt="A315511_5_En_5_Fig3_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Fig3_HTML.jpg" height="430" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Fig3_HTML.jpg" width="690"/></div>
                                    <div class="Caption" xml:lang="en">
                                        <div class="CaptionContent"><span class="CaptionNumber">Figure 5-3.</span>
                                            <div class="SimplePara">Pointcut implementation classes represented as an UML diagram in Intellij <span id="ITerm67">IDEA                                      </span> </div>
                                        </div>
                                </div>
                            </div>
                        </div>
                        </div>
                        <div class="Section2 RenderAsSection2" id="Sec24">
                            <h3 class="Heading">Using <span id="ITerm68">DefaultPointcutAdvisor          </span> <span id="ITerm69">                                              </span> </h3>
                            <div class="Para" id="Par145">Before you can use any <span class="EmphasisFontCategoryNonProportional">Pointcut</span> implementation, you must first create an instance of the <span class="EmphasisFontCategoryNonProportional">Advisor</span> interface, or
                                more specifically a <span class="EmphasisFontCategoryNonProportional">PointcutAdvisor</span> interface. Remember from our earlier discussions that <span class="EmphasisFontCategoryNonProportional">Advisor</span> is Spring’s
                                representation of an aspect (see the previous section called “Aspects in Spring”), which is a coupling of advice and pointcuts that governs which methods should be advised and how they should be advised. Spring provides
                                a number of implementations of <span class="EmphasisFontCategoryNonProportional">PointcutAdvisor</span>, but for now we will concern yourself with just one, <span id="ITerm70">                <span class="EmphasisFontCategoryNonProportional">DefaultPointcutAdvisor</span>                                </span> <span id="ITerm71">                                              </span>. This is a simple <span class="EmphasisFontCategoryNonProportional">PointcutAdvisor</span> for associating a single <span class="EmphasisFontCategoryNonProportional">Pointcut</span>                                with a single <span class="EmphasisFontCategoryNonProportional">Advice</span>.</div>
                        </div>
                        <div class="Section2 RenderAsSection2" id="Sec25">
                            <h3 class="Heading">Creating a Static Pointcut by Using <span id="ITerm72">StaticMethodMatcherPointcut          </span> <span id="ITerm73">                                              </span> </h3>
                            <div class="Para" id="Par146">In this section, we will create a simple static pointcut by extending the abstract <span class="EmphasisFontCategoryNonProportional">StaticMethodMatcherPointcut</span> class. Since the <span class="EmphasisFontCategoryNonProportional">StaticMethodMatcherPointcut</span>                                class extends the <span class="EmphasisFontCategoryNonProportional">StaticMethodMatcher</span> class (an abstract class too), which implements the <span class="EmphasisFontCategoryNonProportional">MethodMatcher</span> interface,
                                you are required to implement the method <span class="EmphasisFontCategoryNonProportional">matches(Method, Class&lt;?&gt;)</span>. The rest of the <span class="EmphasisFontCategoryNonProportional">Pointcut</span> implementation
                                is handled automatically. Although this is the only method you are required to implement (when extending the <span class="EmphasisFontCategoryNonProportional">StaticMethodMatcherPointcut</span> class), you may want to override
                                the <span class="EmphasisFontCategoryNonProportional">getClassFilter()</span> method as shown in this example to ensure that only methods of the correct type get advised.</div>
                            <div class="Para" id="Par147">For this example, we have two classes, <span class="EmphasisFontCategoryNonProportional">GoodGuitarist</span> and <span class="EmphasisFontCategoryNonProportional">GreatGuitarist</span>, with identical methods defined in both,
                                which are implementations of the <span class="EmphasisFontCategoryNonProportional">method</span> in interface <span class="EmphasisFontCategoryNonProportional">Singer</span>.</div>
                            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.common.Singer</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">GoodGuitarist</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Singer</span> {
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">sing</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">&quot;Who says  I can&apos;t be free <span style="color:#26b31a">\n</span>&quot;</span> <span style="color:#00f;font-weight:700">+</span>
                <span style="color:#036a07">From  all of the things that I used to be</span>);
    }
}

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">GreatGuitarist</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Singer</span> {
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">sing</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">&quot;I shot the sheriff, <span style="color:#26b31a">\n</span>&quot;</span> <span style="color:#00f;font-weight:700">+</span>
                <span style="color:#036a07">But I did not shoot the deputy</span>);
    }
}
</pre>
                            <div class="Para" id="Par149">With this example, we want to be able to create a proxy of both classes by using the same <span class="EmphasisFontCategoryNonProportional">DefaultPointcutAdvisor</span> but have the advice apply only to the <span class="EmphasisFontCategoryNonProportional">sing()</span>                                method of the <span class="EmphasisFontCategoryNonProportional">GoodGuitarist</span> class. To do this, we created the <span class="EmphasisFontCategoryNonProportional">SimpleStaticPointcut</span> class as shown here:</div>
                            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.lang.reflect.Method</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.ClassFilter</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.support.StaticMethodMatcherPointcut</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SimpleStaticPointcut</span> <span style="color:#00f;font-weight:700">extends</span> <span style="font-style:italic">StaticMethodMatcherPointcut</span> {
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">boolean</span> <span style="color:#0000a2;font-weight:700">matches</span>(<span style="color:#00f;font-weight:700">Method</span> <span style="font-style:italic">method</span>, <span style="color:#00f;font-weight:700">Class&lt;?&gt;</span> <span style="font-style:italic">cls</span>) {
        <span style="color:#00f;font-weight:700">return</span> (<span style="color:#036a07">sing</span><span style="color:#00f;font-weight:700">.</span>equals(method<span style="color:#00f;font-weight:700">.</span>getName()));
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">ClassFilter</span> <span style="color:#0000a2;font-weight:700">getClassFilter</span>() {
        <span style="color:#00f;font-weight:700">return</span> cls <span style="color:#00f;font-weight:700">-</span><span style="color:#00f;font-weight:700">&gt;</span> (cls <span style="color:#00f;font-weight:700">==</span> <span style="color:#00f;font-weight:700">GoodGuitarist</span><span style="color:#00f;font-weight:700">.</span>class);
    }
}
</pre>
                        <div class="Para" id="Par151">Here you can see that we implement the <span class="EmphasisFontCategoryNonProportional">matches(Method, Class&lt;?&gt;)</span> method as required by the <span class="EmphasisFontCategoryNonProportional">StaticMethodMatcher</span>                            abstract class. The implementation simply returns <span class="EmphasisFontCategoryNonProportional">true</span> if the name of the method is <span class="EmphasisFontCategoryNonProportional">sing</span>; otherwise, it returns
                            <span class="EmphasisFontCategoryNonProportional">false</span>. Using lambda expressions, the creation of an anonymous class implementing <span class="EmphasisFontCategoryNonProportional">ClassFilter</span> in the <span class="EmphasisFontCategoryNonProportional">getClassFilter()</span>                            method is hidden in the previous code sample. The expanded lambda expression looks like this:</div>
                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">ClassFilter</span> getClassFilter() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ClassFilter</span>() {
            <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">boolean</span> <span style="color:#0000a2;font-weight:700">matches</span>(<span style="color:#00f;font-weight:700">Class&lt;?&gt;</span> <span style="font-style:italic">cls</span>) {
                <span style="color:#00f;font-weight:700">return</span> (cls <span style="color:#00f;font-weight:700">==</span> <span style="color:#00f;font-weight:700">GoodGuitarist</span><span style="color:#00f;font-weight:700">.</span>class);
            }
        };
    }
</pre>
                        <div class="Para" id="Par153">Notice that we have also overridden the <span class="EmphasisFontCategoryNonProportional">getClassFilter()</span> method to return a <span class="EmphasisFontCategoryNonProportional">ClassFilter</span> instance whose <span class="EmphasisFontCategoryNonProportional">matches()</span>                            method returns <span class="EmphasisFontCategoryNonProportional">true</span> only for the <span class="EmphasisFontCategoryNonProportional">GoodGuitarist</span> class. With this static pointcut, we are saying that only methods
                            of the <span class="EmphasisFontCategoryNonProportional">GoodGuitarist</span> class will be matched, and furthermore, only the <span class="EmphasisFontCategoryNonProportional">sing()</span> method of that class will be matched.</div>
                        <div class="Para ParaOneEmphasisChild" id="Par154">The following code snippet shows the <span class="EmphasisFontCategoryNonProportional">SimpleAdvice</span> class that simply writes out a message on either side of the method invocation:</div>
                            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.aopalliance.intercept.MethodInterceptor</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.aopalliance.intercept.MethodInvocation</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SimpleAdvice</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">MethodInterceptor</span> {
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Object</span> <span style="color:#0000a2;font-weight:700">invoke</span>(<span style="color:#00f;font-weight:700">MethodInvocation</span> <span style="font-style:italic">invocation</span>) <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Throwable</span> {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">&gt;&gt; Invoking </span> <span style="color:#00f;font-weight:700">+</span> invocation<span style="color:#00f;font-weight:700">.</span>getMethod()<span style="color:#00f;font-weight:700">.</span>getName());
        <span style="color:#00f;font-weight:700">Object</span> retVal <span style="color:#00f;font-weight:700">=</span> invocation<span style="color:#00f;font-weight:700">.</span>proceed();
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">&quot;&gt;&gt; Done<span style="color:#26b31a">\n</span>&quot;</span>);
        <span style="color:#00f;font-weight:700">return</span> retVal;
    }
}
</pre>
                            <div class="Para" id="Par156">In the following code snippet, you can see a simple driver application for this example that creates an instance of <span class="EmphasisFontCategoryNonProportional">DefaultPointcutAdvisor</span> by using the <span class="EmphasisFontCategoryNonProportional">SimpleAdvice</span>                                and <span class="EmphasisFontCategoryNonProportional">SimpleStaticPointcut</span> classes. Also, because both classes implement the same interface, you can see that the proxies can be created based on the interface, not
                                on the concrete <span id="ITerm77">classes          </span>.</div>
                            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.common.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.aopalliance.aop.Advice</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.Advisor</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.Pointcut</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.framework.ProxyFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.support.DefaultPointcutAdvisor</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">StaticPointcutDemo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GoodGuitarist</span> johnMayer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GoodGuitarist</span>();
        <span style="color:#00f;font-weight:700">GreatGuitarist</span> ericClapton <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GreatGuitarist</span>();
        <span style="color:#00f;font-weight:700">Singer</span> proxyOne;
        <span style="color:#00f;font-weight:700">Singer</span> proxyTwo;
        <span style="color:#00f;font-weight:700">Pointcut</span> pc <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SimpleStaticPointcut</span>();
        <span style="color:#00f;font-weight:700">Advice</span> advice <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SimpleAdvice</span>();
        <span style="color:#00f;font-weight:700">Advisor</span> advisor <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">DefaultPointcutAdvisor</span>(pc, advice);
        <span style="color:#00f;font-weight:700">ProxyFactory</span> pf <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ProxyFactory</span>();
        pf<span style="color:#00f;font-weight:700">.</span>addAdvisor(advisor);
        pf<span style="color:#00f;font-weight:700">.</span>setTarget(johnMayer);
        proxyOne <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">Singer</span>) pf<span style="color:#00f;font-weight:700">.</span>getProxy();
        pf <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ProxyFactory</span>();
        pf<span style="color:#00f;font-weight:700">.</span>addAdvisor(advisor);
        pf<span style="color:#00f;font-weight:700">.</span>setTarget(ericClapton);
        proxyTwo <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">Singer</span>) pf<span style="color:#00f;font-weight:700">.</span>getProxy();
        proxyOne<span style="color:#00f;font-weight:700">.</span>sing();
        proxyTwo<span style="color:#00f;font-weight:700">.</span>sing();
    }
}
</pre>
                            <div class="Para" id="Par158">Notice that the <span class="EmphasisFontCategoryNonProportional">DefaultPointcutAdvisor</span> instance is then used to create two proxies: one for an instance of <span class="EmphasisFontCategoryNonProportional">GoodGuitarist</span>                                and one for an instance of <span class="EmphasisFontCategoryNonProportional">EricClapton</span>. Finally, the <span class="EmphasisFontCategoryNonProportional">sing()</span> method is invoked on the two proxies. Running
                                this example results in the following output:</div>
                            <div class="Para" id="Par159">
                                <div class="ProgramCode" id="PC35">
                                    <div class="LineGroup">
                                        <div class="FixedLine">&gt;&gt; Invoking sing</div>
                                        <div class="FixedLine">Who says I can&apos;t be free</div>
                                        <div class="FixedLine">From all of the things that I used to be</div>
                                        <div class="FixedLine">&gt;&gt; Done</div>
                                    </div>
                                    <div class="LineGroup">
                                        <div class="FixedLine">I shot the sheriff,</div>
                                        <div class="FixedLine">But I did not shoot the <span id="ITerm78">deputy                </span> <span id="ITerm79">                                                                </span> </div>
                                    </div>
                                </div>
                            </div>
                            <div class="Para" id="Par160">As you can see, the only method for which <span class="EmphasisFontCategoryNonProportional">SimpleAdvice</span> was actually invoked was the <span class="EmphasisFontCategoryNonProportional">sing()</span> method for the
                                <span class="EmphasisFontCategoryNonProportional">GoodGuitarist</span> class, exactly as expected. Restricting the methods to which advice applies is quite simple and, as you will see when we discuss proxy options, is key to getting the best performance out of your application.</div>
                            </div>
                            <div class="Section2 RenderAsSection2" id="Sec26">
                                <h3 class="Heading">Creating a Dynamic Pointcut by Using <span id="ITerm80">DyanmicMethodMatcherPointcut          </span> <span id="ITerm81">                                              </span> </h3>
                                <div class="Para" id="Par162">Creating a dynamic pointcut is not much different from creating a static one, so for this example, we will create a dynamic pointcut for the class shown here:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SampleBean</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">foo</span>(<span style="color:#00f;font-weight:700">int</span> <span style="font-style:italic">x</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Invoked foo() with: </span> <span style="color:#00f;font-weight:700">+</span> x);
    }
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">bar</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Invoked bar()</span>);
    }
}
</pre>
                                <div class="Para" id="Par164">For this example, we want to advise only the <span class="EmphasisFontCategoryNonProportional">foo()</span> method, but unlike the previous example, we want to advise this method only if the <span class="EmphasisFontCategoryNonProportional">int</span>                                    argument passed to it is greater or less than <span id="ITerm82">100                      </span>.</div>
                                <div class="Para" id="Par165">As with static pointcuts, Spring provides a convenient base class for creating dynamic pointcuts: <span class="EmphasisFontCategoryNonProportional">DynamicMethodMatcherPointcut</span>. The <span class="EmphasisFontCategoryNonProportional">DynamicMethodMatcherPointcut</span>                                    class has a single abstract method, <span class="EmphasisFontCategoryNonProportional">matches(Method, Class&lt;?&gt;, Object[])</span> (via the <span class="EmphasisFontCategoryNonProportional">MethodMatcher</span>                                    interface that it implements), that you must implement, but as you will see, it is also prudent to implement the <span class="EmphasisFontCategoryNonProportional">matches(Method, Class&lt;?&gt;)</span> method to control
                                    the behavior of the static checks. The following code snippet shows the <span class="EmphasisFontCategoryNonProportional">SimpleDynamicPointcut</span> class:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.lang.reflect.Method</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.ClassFilter</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.support.DynamicMethodMatcherPointcut</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SimpleDynamicPointcut</span>
        <span style="color:#00f;font-weight:700">extends</span> <span style="font-style:italic">DynamicMethodMatcherPointcut</span> {
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">boolean</span> <span style="color:#0000a2;font-weight:700">matches</span>(<span style="color:#00f;font-weight:700">Method</span> <span style="font-style:italic">method</span>, <span style="color:#00f;font-weight:700">Class&lt;?&gt;</span> <span style="font-style:italic">cls</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Static check for </span> <span style="color:#00f;font-weight:700">+</span> method<span style="color:#00f;font-weight:700">.</span>getName());
        <span style="color:#00f;font-weight:700">return</span> (<span style="color:#036a07">foo</span><span style="color:#00f;font-weight:700">.</span>equals(method<span style="color:#00f;font-weight:700">.</span>getName()));
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">boolean</span> <span style="color:#0000a2;font-weight:700">matches</span>(<span style="color:#00f;font-weight:700">Method</span> <span style="font-style:italic">method</span>, <span style="color:#00f;font-weight:700">Class&lt;?&gt;</span> <span style="font-style:italic">cls</span>, <span style="color:#00f;font-weight:700">Object</span> <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Dynamic check for </span> <span style="color:#00f;font-weight:700">+</span> method<span style="color:#00f;font-weight:700">.</span>getName());
        <span style="color:#00f;font-weight:700">int</span> x <span style="color:#00f;font-weight:700">=</span> ((<span style="color:#00f;font-weight:700">Integer</span>) args0)<span style="color:#00f;font-weight:700">.</span>intValue();
        <span style="color:#00f;font-weight:700">return</span> (x <span style="color:#00f;font-weight:700">!=</span> <span style="color:#0000cd">100</span>);
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">ClassFilter</span> <span style="color:#0000a2;font-weight:700">getClassFilter</span>() {
        <span style="color:#00f;font-weight:700">return</span> cls <span style="color:#00f;font-weight:700">-</span><span style="color:#00f;font-weight:700">&gt;</span> (cls <span style="color:#00f;font-weight:700">==</span> <span style="color:#00f;font-weight:700">SampleBean</span><span style="color:#00f;font-weight:700">.</span>class);
    }
}
</pre>
                                <div class="Para" id="Par167">As you can see from the previous code sample, we override <span id="ITerm83">the           </span> <span class="EmphasisFontCategoryNonProportional">getClassFilter()</span> method in a similar manner as in the previous
                                    section. This removes the need to check the class in the method-matching methods, which is something that is especially important for the dynamic check. Although you are required to implement only the dynamic check,
                                    we implement the static check as well. The reason for this is that you know the <span class="EmphasisFontCategoryNonProportional">bar()</span> method will never be advised. By indicating this by using the static check,
                                    Spring never has to perform a dynamic check for this method. This is because when the static check method is implemented, Spring will first check against it, and if the checking result is not a match, Spring will stop
                                    doing any further dynamic checking. Moreover, the result of the static check will be cached for better performance. But if we neglect the static check, Spring performs a dynamic check each time the <span class="EmphasisFontCategoryNonProportional">bar()</span>                                    method is invoked. As a recommended practice, perform the class checking in the <span class="EmphasisFontCategoryNonProportional">getClassFilter()</span> method, the method checking in the <span class="EmphasisFontCategoryNonProportional">matches(Method, Class&lt;?&gt;)</span>                                    method, and the argument checking in the <span class="EmphasisFontCategoryNonProportional">matches(Method, Class&lt;?&gt;, Object[])</span> method. This will make your pointcut much easier to understand and maintain,
                                    and performance will be better <span id="ITerm84">too                      </span>.</div>
                                <div class="Para" id="Par168">In the <span class="EmphasisFontCategoryNonProportional">matches(Method, Class&lt;?&gt;, Object[])</span> method, you can see that we return <span class="EmphasisFontCategoryNonProportional">false</span> if the value of
                                    the <span class="EmphasisFontCategoryNonProportional">int</span> argument passed to the <span class="EmphasisFontCategoryNonProportional">foo()</span> method is not equal to 100; otherwise, we return <span class="EmphasisFontCategoryNonProportional">true</span>.
                                    Note that in the dynamic check, we know that we are dealing with the <span class="EmphasisFontCategoryNonProportional">foo()</span> method because no other method makes it past the static check. In the following code
                                    snippet, you can see an example of this pointcut in action:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.Advisor</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.framework.ProxyFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.support.DefaultPointcutAdvisor</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">DynamicPointcutDemo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">SampleBean</span> target <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SampleBean</span>();
        <span style="color:#00f;font-weight:700">Advisor</span> advisor <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">DefaultPointcutAdvisor</span>(
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SimpleDynamicPointcut</span>(), <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SimpleAdvice</span>());
        <span style="color:#00f;font-weight:700">ProxyFactory</span> pf <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ProxyFactory</span>();
        pf<span style="color:#00f;font-weight:700">.</span>setTarget(target);
        pf<span style="color:#00f;font-weight:700">.</span>addAdvisor(advisor);
        <span style="color:#00f;font-weight:700">SampleBean</span> proxy <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">SampleBean</span>) pf<span style="color:#00f;font-weight:700">.</span>getProxy();
        proxy<span style="color:#00f;font-weight:700">.</span>foo(<span style="color:#0000cd">1</span>);
        proxy<span style="color:#00f;font-weight:700">.</span>foo(<span style="color:#0000cd">10</span>);
        proxy<span style="color:#00f;font-weight:700">.</span>foo(<span style="color:#0000cd">100</span>);
        proxy<span style="color:#00f;font-weight:700">.</span>bar();
        proxy<span style="color:#00f;font-weight:700">.</span>bar();
        proxy<span style="color:#00f;font-weight:700">.</span>bar();
    }
}
</pre>
                                <div class="Para" id="Par170">Notice that we have used the same advice class as in the static pointcut example. However, in this example, only the first two calls to <span class="EmphasisFontCategoryNonProportional">foo()</span> should be advised. The
                                    dynamic check prevents the third call to <span class="EmphasisFontCategoryNonProportional">foo()</span> from being advised, and the static check prevents the <span class="EmphasisFontCategoryNonProportional">bar()</span>                                    method from being advised. Running this example yields the following output:</div>
                                <div class="Para" id="Par171">
                                    <div class="ProgramCode" id="PC39">
                                        <div class="LineGroup">
                                            <div class="FixedLine">Static check for <span id="ITerm86">bar                                  </span> </div>
                                            <div class="FixedLine">Static check for foo</div>
                                            <div class="FixedLine">Static check for toString</div>
                                            <div class="FixedLine">Static check for clone</div>
                                            <div class="FixedLine">Static check for foo</div>
                                            <div class="FixedLine">Dynamic check for foo</div>
                                            <div class="FixedLine">&gt;&gt; Invoking foo</div>
                                            <div class="FixedLine">Invoked foo() with: 1</div>
                                            <div class="FixedLine">&gt;&gt; Done</div>
                                        </div>
                                        <div class="LineGroup">
                                            <div class="FixedLine">Dynamic check for foo</div>
                                            <div class="FixedLine">&gt;&gt; Invoking foo</div>
                                            <div class="FixedLine">Invoked foo() with: 10</div>
                                            <div class="FixedLine">&gt;&gt; Done</div>
                                        </div>
                                        <div class="LineGroup">
                                            <div class="FixedLine">Dynamic check for foo</div>
                                            <div class="FixedLine">Invoked foo() with: 100</div>
                                            <div class="FixedLine">Static check for bar</div>
                                            <div class="FixedLine">Invoked bar()</div>
                                            <div class="FixedLine">Invoked bar()</div>
                                            <div class="FixedLine">Invoked bar()</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="Para" id="Par172">As we expected, only the first two invocations of the <span class="EmphasisFontCategoryNonProportional">foo()</span> method were advised. Notice that none of the <span class="EmphasisFontCategoryNonProportional">bar()</span>                                    invocations is subject to a dynamic check, thanks to the static check on <span class="EmphasisFontCategoryNonProportional">bar()</span>. An interesting point to note here is that the <span class="EmphasisFontCategoryNonProportional">foo()</span>                                    method is subject to two static checks: one during the initial phase when all methods are checked and another when it is first <span id="ITerm87">invoked          </span>.</div>
                                <div class="Para" id="Par173">As you can see, dynamic pointcuts offer a greater degree of flexibility than static pointcuts, but because of the additional runtime overhead they require, you should use a dynamic pointcut only when absolutely necessary.</div>
                            </div>
                            <div class="Section2 RenderAsSection2" id="Sec27">
                                <h3 class="Heading">Using Simple <span id="ITerm88">Name Matching                      </span> </h3>
                                <div class="Para" id="Par174">Often when creating a pointcut, we want to match want to match based on just the name of the method, ignoring method signature and return type. In this case, you can avoid needing to create a subclass of <span class="EmphasisFontCategoryNonProportional">StaticMethodMatcherPointcut</span>                                    and use <span class="EmphasisFontCategoryNonProportional">NameMatchMethodPointcut</span> (which is a subclass of <span class="EmphasisFontCategoryNonProportional">StaticMethodMatcherPointcut</span>) to match against
                                    a list of method names instead. When you are using <span class="EmphasisFontCategoryNonProportional">NameMatchMethodPointcut</span>, no consideration is given to the signature of the method, so if you have methods
                                    <span class="EmphasisFontCategoryNonProportional">sing()</span> and <span class="EmphasisFontCategoryNonProportional">sing(guitar)</span>, they are both matched for the name <span class="EmphasisFontCategoryNonProportional">foo</span>.</div>
                                <div class="Para" id="Par175">In the following code snippet, you can see the <span class="EmphasisFontCategoryNonProportional">GrammyGuitarist</span> class, which is yet another implementation of <span class="EmphasisFontCategoryNonProportional">Singer</span>,
                                    because this Grammy award singer sings using his voice, uses a guitar, and, being human, occasionally talks and rests.</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.common.Guitar</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.common.Singer</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">GrammyGuitarist</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Singer</span> {
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">sing</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">&quot;sing: Gravity is working against me<span style="color:#26b31a">\n</span>&quot;</span> <span style="color:#00f;font-weight:700">+</span>
                <span style="color:#036a07">And gravity wants to bring me down</span>);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">sing</span>(<span style="color:#00f;font-weight:700">Guitar</span> <span style="font-style:italic">guitar</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">play: </span> <span style="color:#00f;font-weight:700">+</span> guitar<span style="color:#00f;font-weight:700">.</span>play());
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">rest</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">zzz</span>);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">talk</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">talk</span>);
    }
}
<span style="color:#06f;font-style:italic">//chapter02/hello-world/src/main/java/com/apress/prospring5/ch2/common/Guitar.java</span>
<span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.common</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Guitar</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">play</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">G C G C Am D7</span>;
    }
}
</pre>
                                <div class="Para" id="Par177">For this example, we want to match the <span class="EmphasisFontCategoryNonProportional">sing()</span>, <span class="EmphasisFontCategoryNonProportional">sing(Guitar)</span>, and <span class="EmphasisFontCategoryNonProportional">rest()</span>                                    methods by using <span class="EmphasisFontCategoryNonProportional">NameMatchMethodPointcut;</span>. This translates to matching the names <span class="EmphasisFontCategoryNonProportional">foo</span> and <span class="EmphasisFontCategoryNonProportional">bar</span>.
                                    This is shown in the following code snippet:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.common.Guitar</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.Advisor</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.framework.ProxyFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.support.DefaultPointcutAdvisor</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.support.NameMatchMethodPointcut</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">NamePointcutDemo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GrammyGuitarist</span> johnMayer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GrammyGuitarist</span>();
        <span style="color:#00f;font-weight:700">NameMatchMethodPointcut</span> pc <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">NameMatchMethodPointcut</span>();
        pc<span style="color:#00f;font-weight:700">.</span>addMethodName(<span style="color:#036a07">sing</span>);
        pc<span style="color:#00f;font-weight:700">.</span>addMethodName(<span style="color:#036a07">rest</span>);
        <span style="color:#00f;font-weight:700">Advisor</span> advisor <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">DefaultPointcutAdvisor</span>(pc, <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SimpleAdvice</span>());
        <span style="color:#00f;font-weight:700">ProxyFactory</span> pf <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ProxyFactory</span>();
        pf<span style="color:#00f;font-weight:700">.</span>setTarget(johnMayer);
        pf<span style="color:#00f;font-weight:700">.</span>addAdvisor(advisor);
        <span style="color:#00f;font-weight:700">GrammyGuitarist</span> proxy <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">GrammyGuitarist</span>) pf<span style="color:#00f;font-weight:700">.</span>getProxy();
        proxy<span style="color:#00f;font-weight:700">.</span>sing();
        proxy<span style="color:#00f;font-weight:700">.</span>sing(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Guitar</span>());
        proxy<span style="color:#00f;font-weight:700">.</span>rest();
        proxy<span style="color:#00f;font-weight:700">.</span>talk();
    }
}
</pre>
                                <div class="Para" id="Par179">There is no need to create a class for the pointcut; you can simply create an instance of <span class="EmphasisFontCategoryNonProportional">NameMatchMethodPointcut</span>, and you are on your way. Notice that we have added
                                    two method names to the pointcut, <span class="EmphasisFontCategoryNonProportional">sing</span> and <span class="EmphasisFontCategoryNonProportional">rest</span>, using the <span class="EmphasisFontCategoryNonProportional">addMethodName()</span>                                    <span id="ITerm90">                                              </span>method. Running this example results in the following output:</div>
                                <div class="Para" id="Par180">
                                    <div class="ProgramCode" id="PC42">
                                        <div class="LineGroup">
                                            <div class="FixedLine">&gt;&gt; Invoking sing</div>
                                            <div class="FixedLine">sing: Gravity is working against me</div>
                                            <div class="FixedLine">And gravity wants to bring me down</div>
                                            <div class="FixedLine">&gt;&gt; Done</div>
                                        </div>
                                        <div class="LineGroup">
                                            <div class="FixedLine">&gt;&gt; Invoking sing</div>
                                            <div class="FixedLine">play: G C G C Am D7</div>
                                            <div class="FixedLine">&gt;&gt; Done</div>
                                        </div>
                                        <div class="LineGroup">
                                            <div class="FixedLine">&gt;&gt; Invoking rest</div>
                                            <div class="FixedLine">zzz</div>
                                            <div class="FixedLine">&gt;&gt; Done</div>
                                        </div>
                                        <div class="LineGroup">
                                            <div class="FixedLine">talk</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="Para" id="Par181">As expected, the <span class="EmphasisFontCategoryNonProportional">sing</span>, <span class="EmphasisFontCategoryNonProportional">sing(Guitar)</span>, and <span class="EmphasisFontCategoryNonProportional">rest</span> methods
                                    are advised, thanks to the pointcut, but the <span class="EmphasisFontCategoryNonProportional">talk()</span> method is left unadvised.</div>
                            </div>
                            <div class="Section2 RenderAsSection2" id="Sec28">
                                <h3 class="Heading">Creating Pointcuts with <span id="ITerm91">Regular Expressions                      </span> </h3>
                                <div class="Para" id="Par182">In the previous section, we discussed how to perform simple matching against a predefined list of methods. But what if you don’t know all of the methods’ names in advance, and instead you know the pattern that the names
                                    follow? For instance, what if you want to match all methods whose names start with <span class="EmphasisFontCategoryNonProportional">get</span>? In this case, you can use the regular expression pointcut <span class="EmphasisFontCategoryNonProportional">JdkRegexpMethodPointcut</span>                                    to match a method name based on a regular expression. Here you can see yet another <span class="EmphasisFontCategoryNonProportional">Guitarist</span> class, which contains three methods:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.common.Singer</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Guitarist</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Singer</span> {
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">sing</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Just keep me where  the light is</span>);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">sing2</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Just keep me where  the light is</span>);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">rest</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">zzz</span>);
    }
}
</pre>
                                <div class="Para" id="Par184">Using a regular expression-based pointcut, we can match all methods in this class whose name starts with <span class="EmphasisFontCategoryNonProportional">string</span>. This is shown <span id="ITerm92">here                      </span>:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.Advisor</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.framework.ProxyFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.support.DefaultPointcutAdvisor</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.support.JdkRegexpMethodPointcut</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">RegexpPointcutDemo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">Guitarist</span> johnMayer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Guitarist</span>();
        <span style="color:#00f;font-weight:700">JdkRegexpMethodPointcut</span> pc <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">JdkRegexpMethodPointcut</span>();
        pc<span style="color:#00f;font-weight:700">.</span>setPattern(<span style="color:#036a07">.*sing.*</span>);
        <span style="color:#00f;font-weight:700">Advisor</span> advisor <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">DefaultPointcutAdvisor</span>(pc, <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SimpleAdvice</span>());
        <span style="color:#00f;font-weight:700">ProxyFactory</span> pf <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ProxyFactory</span>();
        pf<span style="color:#00f;font-weight:700">.</span>setTarget(johnMayer);
        pf<span style="color:#00f;font-weight:700">.</span>addAdvisor(advisor);
        <span style="color:#00f;font-weight:700">Guitarist</span> proxy <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">Guitarist</span>) pf<span style="color:#00f;font-weight:700">.</span>getProxy();
        proxy<span style="color:#00f;font-weight:700">.</span>sing();
        proxy<span style="color:#00f;font-weight:700">.</span>sing2();
        proxy<span style="color:#00f;font-weight:700">.</span>rest();
    }
}
</pre>
                            <div class="Para" id="Par186">Notice we do not need to create a class for the pointcut; instead, we just create an instance of <span class="EmphasisFontCategoryNonProportional">JdkRegexpMethodPointcut</span> and specify the pattern to match, and we are
                                finished. The interesting thing to note is the pattern. When matching method names, Spring matches the fully qualified name of the method, so for <span class="EmphasisFontCategoryNonProportional">sing1()</span>, Spring
                                is matching against <span class="EmphasisFontCategoryNonProportional">com.apress.prospring5.ch5.Guitarist.sing1</span>, which is why there’s the leading <span class="EmphasisFontCategoryNonProportional">.*</span> in the
                                pattern. This is a powerful concept because it allows you to match all methods within a given package, without needing to know exactly which classes are in that package and what the names of the methods are. Running this
                                example yields the following <span id="ITerm93">output                      </span>:</div>
                            <div class="Para" id="Par187">
                                <div class="ProgramCode" id="PC45">
                                    <div class="LineGroup">
                                        <div class="FixedLine">&gt;&gt; Invoking sing</div>
                                        <div class="FixedLine">Just keep me where the light is</div>
                                        <div class="FixedLine">&gt;&gt; Done</div>
                                    </div>
                                    <div class="LineGroup">
                                        <div class="FixedLine">&gt;&gt; Invoking sing2</div>
                                        <div class="FixedLine">Oh gravity, stay the hell away from me</div>
                                        <div class="FixedLine">&gt;&gt; Done</div>
                                    </div>
                                    <div class="LineGroup">
                                        <div class="FixedLine">zzz</div>
                                    </div>
                                </div>
                            </div>
                            <div class="Para" id="Par188">As you would expect, only the <span class="EmphasisFontCategoryNonProportional">sing()</span> and <span class="EmphasisFontCategoryNonProportional">sing2()</span> methods have been advised because the <span class="EmphasisFontCategoryNonProportional">rest()</span>                                method does not match the regular expression pattern.</div>
                            </div>
                            <div class="Section2 RenderAsSection2" id="Sec29">
                                <h3 class="Heading">Creating Pointcuts with AspectJ Pointcut Expression</h3>
                                <div class="Para" id="Par189">Besides JDK regular expressions, you can use <span id="ITerm94">AspectJ’s pointcut expression          </span> <span id="ITerm95">                                              </span> language for pointcut declaration.
                                    Later in this chapter, you will see that when we declare the pointcut in XML configuration by using the <span class="EmphasisFontCategoryNonProportional">aop</span> namespace, Spring defaults to using AspectJ’s pointcut
                                    language. Moreover, when using Spring’s <span class="EmphasisFontCategoryNonProportional">@AspectJ</span> annotation-style AOP support, you need to use AspectJ’s pointcut language. So when declaring pointcuts by using
                                    expression language, using an AspectJ pointcut expression is the best way to go. Spring provides the class <span class="EmphasisFontCategoryNonProportional">AspectJExpressionPointcut</span> for defining pointcuts via
                                    AspectJ’s expression language. To use AspectJ pointcut expressions with Spring, you need to include two AspectJ library files, <span class="EmphasisFontCategoryNonProportional">aspectjrt.jar</span> and <span class="EmphasisFontCategoryNonProportional">aspectjweaver.jar</span>,
                                    in your project’s classpath. The dependencies and their versions are configured in the main <span class="EmphasisFontCategoryNonProportional">build.gradle</span> configuration file (and configured as dependencies for
                                    all the modules of the <span class="EmphasisFontCategoryNonProportional">chapter05</span> project).</div>
                                <pre style="background:#fff;color:#000">ext {
    aspectjVersion <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">1.9.0.BETA-5</span>
.<span style="color:#00f;font-weight:700">.</span>.
    misc <span style="color:#00f;font-weight:700">=</span> [
        .<span style="color:#00f;font-weight:700">.</span>.
        <span style="color:#00f;font-weight:700">Aspectjweaver</span>     <span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">org.aspectj:aspectjweaver:$aspectjVersion</span>,
        <span style="color:#00f;font-weight:700">Aspectjrt</span>         <span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">org.aspectj:aspectjrt:$aspectjVersion</span>
    ]
.<span style="color:#00f;font-weight:700">.</span>.
</pre>
                                <div class="Para ParaOneEmphasisChild" id="Par191">Considering the previous implementation of the <span class="EmphasisFontCategoryNonProportional">Guitarist</span> class, the same functionality implemented with JDK regular expressions can be implemented using an AspectJ
                                    expression. Here’s the code for that:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.Advisor</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.aspectj.AspectJExpressionPointcut</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.framework.ProxyFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.support.DefaultPointcutAdvisor</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AspectjexpPointcutDemo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">Guitarist</span> johnMayer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Guitarist</span>();
        <span style="color:#00f;font-weight:700">AspectJExpressionPointcut</span> pc <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AspectJExpressionPointcut</span>();
        pc<span style="color:#00f;font-weight:700">.</span>setExpression(<span style="color:#036a07">execution(* sing*(..))</span>);
        <span style="color:#00f;font-weight:700">Advisor</span> advisor <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">DefaultPointcutAdvisor</span>(pc, <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SimpleAdvice</span>());
        <span style="color:#00f;font-weight:700">ProxyFactory</span> pf <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ProxyFactory</span>();
        pf<span style="color:#00f;font-weight:700">.</span>setTarget(johnMayer);
        pf<span style="color:#00f;font-weight:700">.</span>addAdvisor(advisor);
        <span style="color:#00f;font-weight:700">Guitarist</span> proxy <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">Guitarist</span>) pf<span style="color:#00f;font-weight:700">.</span>getProxy();
        proxy<span style="color:#00f;font-weight:700">.</span>sing();
        proxy<span style="color:#00f;font-weight:700">.</span>sing2();
        proxy<span style="color:#00f;font-weight:700">.</span>rest();
    }
}
</pre>
                            <div class="Para" id="Par193">Note that we use the <span class="EmphasisFontCategoryNonProportional">AspectJExpressionPointcut</span>’s <span class="EmphasisFontCategoryNonProportional">setExpression()</span> method to set the matching criteria. The expression
                                <span class="EmphasisFontCategoryNonProportional">execution(* sing*(..))</span> means that the advice should apply to the execution of any methods that start with <span class="EmphasisFontCategoryNonProportional">sing</span>,
                                have any arguments, and return any types. Running the program will get the same result as the previous example using JDK regular expressions.</div>
                            </div>
                            <div class="Section2 RenderAsSection2" id="Sec30">
                                <h3 class="Heading">Creating Annotation Matching Pointcuts</h3>
                                <div class="Para" id="Par194">If your application is annotation-based, you may want to use your own specified annotations for defining pointcuts, that is, apply the advice logic to all methods or types with specific annotations. Spring provides the
                                    class <span id="ITerm98">                <span class="EmphasisFontCategoryNonProportional">AnnotationMatchingPointcut</span> </span> for defining pointcuts using annotations. Again, let’s reuse the previous example
                                    and see how to do it when using an annotation as a pointcut.</div>
                                <div class="Para" id="Par195">First we define an annotation called <span class="EmphasisFontCategoryNonProportional">AdviceRequired</span>, which is an annotation that we will use for declaring a pointcut. The following code snippet shows the annotation
                                    <span id="ITerm99">class                      </span>:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.lang.annotation.ElementType</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.lang.annotation.Retention</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.lang.annotation.RetentionPolicy</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.lang.annotation.Target</span>;

@Retention(<span style="color:#00f;font-weight:700">RetentionPolicy</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>RUNTIME</span>)
@Target({<span style="color:#00f;font-weight:700">ElementType</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>TYPE</span>, <span style="color:#00f;font-weight:700">ElementType</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>METHOD</span>})
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">@interface</span> <span style="text-decoration:underline">AdviceRequired</span> {
}
</pre>
                                <div class="Para" id="Par197">In the previous code sample, you can see that we declare the interface as an annotation by using <span class="EmphasisFontCategoryNonProportional">@interface</span> as the type, and the <span class="EmphasisFontCategoryNonProportional">@Target</span>                                    annotation defines that the annotation can apply at either the type or method level. The following code snippet shows yet another <span class="EmphasisFontCategoryNonProportional">Guitarist</span> class implementation
                                    with your annotation on one of its methods:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.common.Guitar</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.common.Singer</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Guitarist</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Singer</span> {
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">sing</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Dream of ways to throw it all away</span>);
    }

    <span style="color:#00f;font-weight:700">@AdviceRequired</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">sing</span>(<span style="color:#00f;font-weight:700">Guitar</span> <span style="font-style:italic">guitar</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">play: </span> <span style="color:#00f;font-weight:700">+</span> guitar<span style="color:#00f;font-weight:700">.</span>play());
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">rest</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">zzz</span>);
    }
}
</pre>
                                <div class="Para" id="Par199">The following code snippet shows the testing program:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.common.Guitar</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.Advisor</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.framework.ProxyFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.support.DefaultPointcutAdvisor</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.support.annotation.AnnotationMatchingPointcut</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AnnotationPointcutDemo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">Guitarist</span> johnMayer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Guitarist</span>();
        <span style="color:#00f;font-weight:700">AnnotationMatchingPointcut</span> pc <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">AnnotationMatchingPointcut</span>
                .forMethodAnnotation(<span style="color:#00f;font-weight:700">AdviceRequired</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">Advisor</span> advisor <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">DefaultPointcutAdvisor</span>(pc, <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SimpleAdvice</span>());
        <span style="color:#00f;font-weight:700">ProxyFactory</span> pf <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ProxyFactory</span>();
        pf<span style="color:#00f;font-weight:700">.</span>setTarget(johnMayer);
        pf<span style="color:#00f;font-weight:700">.</span>addAdvisor(advisor);
        <span style="color:#00f;font-weight:700">Guitarist</span> proxy <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">Guitarist</span>) pf<span style="color:#00f;font-weight:700">.</span>getProxy();
        proxy<span style="color:#00f;font-weight:700">.</span>sing(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Guitar</span>());
        proxy<span style="color:#00f;font-weight:700">.</span>rest();
    }
}
</pre>
                                <div class="Para" id="Par201">In the previous listing, an instance of <span class="EmphasisFontCategoryNonProportional">AnnotationMatchingPointcut</span> is acquired by calling its static method <span class="EmphasisFontCategoryNonProportional">forMethodAnnotation()</span>                                    and passing in the annotation type. This indicates that we want to apply the advice to all the methods annotated with the given annotation. It’s also possible to specify annotations applied at the type level by calling
                                    the <span class="EmphasisFontCategoryNonProportional">forClassAnnotation()</span> method. The following shows the output when the program runs:</div>
                                <div class="Para" id="Par202">
                                    <div class="ProgramCode" id="PC51">
                                        <div class="LineGroup">
                                            <div class="FixedLine">&gt;&gt; Invoking sing</div>
                                            <div class="FixedLine">play: G C G C Am D7</div>
                                            <div class="FixedLine">&gt;&gt; Done</div>
                                        </div>
                                        <div class="LineGroup">
                                            <div class="FixedLine">zzz</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="Para ParaOneEmphasisChild" id="Par203">As you can see, since we annotated the <span class="EmphasisFontCategoryNonProportional">sing()</span> method, only that method was advised.</div>
                            </div>
                            <div class="Section2 RenderAsSection2" id="Sec31">
                                <h3 class="Heading">Convenience Advisor Implementations</h3>
                                <div class="Para" id="Par204">For many of the <span class="EmphasisFontCategoryNonProportional">Pointcut</span> implementations, Spring also provides a convenience <span class="EmphasisFontCategoryNonProportional">Advisor</span> implementation that
                                    acts as the pointcut. For instance, instead of using <span class="EmphasisFontCategoryNonProportional">NameMatchMethodPointcut</span> coupled with <span class="EmphasisFontCategoryNonProportional">DefaultPointcutAdvisor</span>                                    in the previous example, we could simply have used <span class="EmphasisFontCategoryNonProportional">NameMatchMethodPointcutAdvisor</span>, as shown in the following code snippet:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

.<span style="color:#00f;font-weight:700">.</span>.
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.support.NameMatchMethodPointcutAdvisor</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">NamePointcutUsingAdvisor</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GrammyGuitarist</span> johnMayer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GrammyGuitarist</span>();
        <span style="color:#00f;font-weight:700">NameMatchMethodPointcut</span> pc <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">NameMatchMethodPointcut</span>();
        pc<span style="color:#00f;font-weight:700">.</span>addMethodName(<span style="color:#036a07">sing</span>);
        pc<span style="color:#00f;font-weight:700">.</span>addMethodName(<span style="color:#036a07">rest</span>);
        <span style="color:#00f;font-weight:700">Advisor</span> advisor <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">NameMatchMethodPointcutAdvisor</span>(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SimpleAdvice</span>());
        <span style="color:#00f;font-weight:700">ProxyFactory</span> pf <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ProxyFactory</span>();
        pf<span style="color:#00f;font-weight:700">.</span>setTarget(johnMayer);
        pf<span style="color:#00f;font-weight:700">.</span>addAdvisor(advisor);
        <span style="color:#00f;font-weight:700">GrammyGuitarist</span> proxy <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">GrammyGuitarist</span>) pf<span style="color:#00f;font-weight:700">.</span>getProxy();
        proxy<span style="color:#00f;font-weight:700">.</span>sing();
        proxy<span style="color:#00f;font-weight:700">.</span>sing(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Guitar</span>());
        proxy<span style="color:#00f;font-weight:700">.</span>rest();
        proxy<span style="color:#00f;font-weight:700">.</span>talk();
    }
}
</pre>
                            <div class="Para" id="Par206">Notice that rather than creating an instance of <span class="EmphasisFontCategoryNonProportional">NameMatchMethodPointcut</span>, we configure the pointcut details on the instance of <span class="EmphasisFontCategoryNonProportional">NameMatchMethodPointcutAdvisor</span>.
                                In this way, <span class="EmphasisFontCategoryNonProportional">NameMatchMethodPointcutAdvisor</span> is acting as both the advisor and the pointcut.</div>
                            <div class="Para" id="Par207">You can find full details of the different <span class="EmphasisFontCategoryNonProportional">Advisor</span> implementations by exploring the Javadoc for the <span class="EmphasisFontCategoryNonProportional">org.springframework.aop.support</span>                                package. There is no noticeable performance difference between the two approaches, and aside from there being slightly less code in the second example, there is very little difference in the actual coding approach. We prefer
                                to stick with the first approach because we feel the intent is slightly clearer in the code. At the end of the day, the style you choose comes down to personal <span id="ITerm102">preference                      </span>.</div>
                            </div>
                            </div>
                            <div class="Section1 RenderAsSection1" id="Sec32">
                                <h2 class="Heading">Understanding Proxies</h2>
                                <div class="Para" id="Par208">So far, we have taken only a cursory look at the proxies generated by <span class="EmphasisFontCategoryNonProportional">ProxyFactory</span>. We mentioned that two types of proxy are available in Spring: JDK proxies created
                                    by using the JDK <span class="EmphasisFontCategoryNonProportional">Proxy</span> class and <span id="ITerm103">CGLIB                  </span>-based proxies created by using the <span id="ITerm104">CGLIB <span class="EmphasisFontCategoryNonProportional">Enhancer</span>                                    </span> class. You may be wondering exactly what the difference between the two proxies is and why Spring needs two types of proxy. In this section, we take a detailed look at the differences between the proxies.</div>
                                <div class="Para" id="Par209">The core goal of a proxy is to intercept method invocations and, where necessary, execute chains of advice that apply to a particular method. The management and invocation of advice is largely proxy independent and is managed
                                    by the Spring AOP framework. However, the proxy is responsible for intercepting calls to all methods and passing them as necessary to the AOP framework for the advice to be applied.</div>
                            <div class="Para" id="Par210">In addition to this core functionality, the proxy must support a set of additional features. It is possible to configure the proxy to expose itself via the <span class="EmphasisFontCategoryNonProportional">AopContext</span>                                class (which is an abstract class) so that you can retrieve the proxy and invoke advised methods on the proxy from the target object. The proxy is responsible for ensuring that when this option is enabled via <span class="EmphasisFontCategoryNonProportional">ProxyFactory.setExposeProxy()</span>,
                                the proxy class is appropriately exposed. In addition, all proxy classes implement the <span class="EmphasisFontCategoryNonProportional">Advised</span> interface by default, which allows for, among other things, the advice
                                chain to be changed after the proxy has been created. A proxy must also ensure that any methods that return this (that is, return the proxied target) do in fact return the proxy and not the target.</div>
                            <div class="Para" id="Par211">As you can see, a typical proxy has quite a lot of work to perform, and all of this logic is implemented in both the JDK and CGLIB proxies.</div>
                            <div class="Section2 RenderAsSection2" id="Sec33">
                                <h3 class="Heading">Using JDK Dynamic Proxies</h3>
                                <div class="Para" id="Par212"> <span id="ITerm105">                <span class="EmphasisTypeItalic">JDK</span> </span> <span id="ITerm106">                <span class="EmphasisTypeItalic">proxies</span> </span> are the most basic type of proxy available
                                    in Spring. Unlike the CGLIB proxy, the JDK proxy can generate proxies only of interfaces, not classes. In this way, any object you want to proxy must implement at least one interface, and the resulting proxy will be
                                    an object that implements that interface. Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Chapter.html#Fig4">5-4</a></span> shows an abstract
                                    schema of such a proxy.
                                    <div class="Figure" id="Fig4">
                                        <div class="MediaObject" id="MO4"><img alt="A315511_5_En_5_Fig4_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Fig4_HTML.jpg" height="255" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Fig4_HTML.jpg" width="320"/></div>
                                        <div class="Caption" xml:lang="en">
                                            <div class="CaptionContent"><span class="CaptionNumber">Figure 5-4.</span>
                                                <div class="SimplePara">JDK proxy abstract schema<span id="ITerm107">                                              </span> <span id="ITerm108">                                                                      </span> </div>
                                            </div>
                                    </div>
                                </div>
                            </div>
                            <div class="Para" id="Par213">In general, it is good design to use interfaces for your classes, but it is not always possible, especially when you are working with third-party or legacy code. In this case, you must use the CGLIB proxy. When you are using
                                the JDK proxy, all method calls are intercepted by the JVM and routed to the <span class="EmphasisFontCategoryNonProportional">invoke()</span> method of the proxy. This method then determines whether the method in question
                                is advised (by the rules defined by the pointcut), and if so, it invokes the advice chain and then the method itself by using reflection. In addition to this, the <span class="EmphasisFontCategoryNonProportional">invoke()</span>                                method performs all the logic discussed in the previous section.</div>
                            <div class="Para" id="Par214">The JDK proxy makes no determination between methods that are advised and unadvised until it is in the <span class="EmphasisFontCategoryNonProportional">invoke()</span> method. This means that for unadvised methods on the proxy,
                                the <span class="EmphasisFontCategoryNonProportional">invoke()</span> method is still called, all the checks are still performed, and the method is still invoked by using reflection. Obviously, this incurs runtime overhead
                                each time the method is invoked, even though the proxy often performs no additional processing other than to invoke the unadvised method via reflection.</div>
                            <div class="Para" id="Par215">You can instruct <span class="EmphasisFontCategoryNonProportional">ProxyFactory</span> to use a JDK proxy by specifying the list of interfaces to proxy by using <span class="EmphasisFontCategoryNonProportional">setInterfaces()</span>                                (in the <span class="EmphasisFontCategoryNonProportional">AdvisedSupport</span> class that the <span class="EmphasisFontCategoryNonProportional">ProxyFactory</span> class extends indirectly).</div>
                            </div>
                            <div class="Section2 RenderAsSection2" id="Sec34">
                                <h3 class="Heading">Using <span id="ITerm109">CGLIB          </span> <span id="ITerm110">                                              </span> Proxies</h3>
                                <div class="Para" id="Par216">With the JDK proxy, all decisions about how to handle a particular method invocation are handled at runtime each time the method is invoked. When you use CGLIB, CGLIB dynamically generates the bytecode for a new class on
                                    the fly for each proxy, reusing already generated classes wherever possible. The resulting proxy type in this case will be a subclass of the target object class. Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Chapter.html#Fig5">5-5</a></span>                                    shows an abstract schema of such a proxy.
                                    <div class="Figure" id="Fig5">
                                        <div class="MediaObject" id="MO5"><img alt="A315511_5_En_5_Fig5_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Fig5_HTML.jpg" height="272" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Fig5_HTML.jpg" width="280"/></div>
                                        <div class="Caption" xml:lang="en">
                                            <div class="CaptionContent"><span class="CaptionNumber">Figure 5-5.</span>
                                                <div class="SimplePara">CGLIB proxy abstract schema<span id="ITerm111">                                              </span> <span id="ITerm112">                                                                      </span> </div>
                                            </div>
                                    </div>
                                </div>
                            </div>
                            <div class="Para ParaOneEmphasisChild" id="Par217">When a CGLIB proxy is first created, CGLIB asks Spring how it wants to handle each method. This means that many of the decisions that are performed in each call to <span class="EmphasisFontCategoryNonProportional">invoke()</span>                                on the JDK proxy are performed just once for the CGLIB proxy. Because CGLIB generates actual bytecode, there is also a lot more flexibility in the way you can handle methods. For instance, the CGLIB proxy generates the
                                appropriate bytecode to invoke any unadvised methods directly, reducing the overhead introduced by the proxy. In addition, the CGLIB proxy determines whether it is possible for a method to return this; if not, it allows
                                the method call to be invoked directly, again reducing the runtime overhead.</div>
                            <div class="Para" id="Par218">The CGLIB proxy also handles fixed-advice chains differently than the JDK proxy. A fixed-advice chain is one that you guarantee will not change after the proxy has been generated. By default, you are able to change the advisors
                                and advice on a proxy even after it is created, although this is rarely a requirement. The CGLIB proxy handles fixed-advice chains in a particular way, reducing the runtime overhead for executing an advice chain.</div>
                            </div>
                            <div class="Section2 RenderAsSection2" id="Sec35">
                                <h3 class="Heading">Comparing Proxy <span id="ITerm113">Performance                      </span> </h3>
                                <div class="Para" id="Par219">So far, all we have done is discuss in loose terms the differences in implementation between the proxy types. In this section, we are going to run a simple test to compare the performance of the CGLIB proxy with the JDK
                                    proxy.</div>
                                <div class="Para" id="Par220">Let’s create a class named <span class="EmphasisFontCategoryNonProportional">DefaultSimpleBean</span>, which we will use as the target object for proxying. Here are the <span class="EmphasisFontCategoryNonProportional">SimpleBean</span>                                    interface and the <span class="EmphasisFontCategoryNonProportional">DefaultSimpleBean</span> class:</div>
                                <pre style="background:#fff;color:#000">ppackage com<span style="color:#00f;font-weight:700">.</span>apress<span style="color:#00f;font-weight:700">.</span>prospring5<span style="color:#00f;font-weight:700">.</span>ch5;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">SimpleBean</span> {
    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">advised</span>();

    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">unadvised</span>();
}

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">DefaultSimpleBean</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SimpleBean</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">long</span> dummy <span style="color:#00f;font-weight:700">=</span> <span style="color:#0000cd">0</span>;

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">advised</span>() {
        dummy <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>currentTimeMillis();
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">unadvised</span>() {
        dummy <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>currentTimeMillis();
    }
}
</pre>
                                <div class="Para ParaOneEmphasisChild" id="Par222">In the following example, the <span class="EmphasisFontCategoryNonProportional">TestPointcut</span> class is shown that provides static checking on the method to advise:</div>
                               <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.lang.reflect.Method</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.support.StaticMethodMatcherPointcut</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">TestPointcut</span> <span style="color:#00f;font-weight:700">extends</span> <span style="font-style:italic">StaticMethodMatcherPointcut</span> {
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">boolean</span> <span style="color:#0000a2;font-weight:700">matches</span>(<span style="color:#00f;font-weight:700">Method</span> <span style="font-style:italic">method</span>, <span style="color:#00f;font-weight:700">Class</span> <span style="font-style:italic">cls</span>) {
        <span style="color:#00f;font-weight:700">return</span> (<span style="color:#036a07">advise</span><span style="color:#00f;font-weight:700">.</span>equals(method<span style="color:#00f;font-weight:700">.</span>getName()));
    }
}</pre> <div class="Para ParaOneEmphasisChild" id="Par224">The next code snippet depicts the <span class="EmphasisFontCategoryNonProportional">NoOpBeforeAdvice</span> class, which is just simple before advice without any operation:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.lang.reflect.Method</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.MethodBeforeAdvice</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">NoOpBeforeAdvice</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">MethodBeforeAdvice</span> {
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">before</span>(<span style="color:#00f;font-weight:700">Method</span> <span style="font-style:italic">method</span>, <span style="color:#00f;font-weight:700">Object</span> <span style="font-style:italic">args</span>, <span style="color:#00f;font-weight:700">Object</span> <span style="font-style:italic">target</span>)
            <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Throwable</span> {
        <span style="color:#06f;font-style:italic">// no-op</span>
    }
}</pre>
                                <div class="Para" id="Par226">In the following code snippet, you can see the code used to test the different types of proxies:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.Advisor</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.framework.Advised</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.framework.ProxyFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.support.DefaultPointcutAdvisor</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">ProxyPerfTest</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">SimpleBean</span> target <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">DefaultSimpleBean</span>();
        <span style="color:#00f;font-weight:700">Advisor</span> advisor <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">DefaultPointcutAdvisor</span>(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">TestPointcut</span>(),
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">NoOpBeforeAdvice</span>());
        runCglibTests(advisor, target);
        runCglibFrozenTests(advisor, target);
        runJdkTests(advisor, target);
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">runCglibTests</span>(<span style="color:#00f;font-weight:700">Advisor</span> <span style="font-style:italic">advisor</span>, <span style="color:#00f;font-weight:700">SimpleBean</span> <span style="font-style:italic">target</span>) {
        <span style="color:#00f;font-weight:700">ProxyFactory</span> pf <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ProxyFactory</span>();
        pf<span style="color:#00f;font-weight:700">.</span>setProxyTargetClass(<span style="color:#585cf6;font-weight:700">true</span>);
        pf<span style="color:#00f;font-weight:700">.</span>setTarget(target);
        pf<span style="color:#00f;font-weight:700">.</span>addAdvisor(advisor);
        <span style="color:#00f;font-weight:700">SimpleBean</span> proxy <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">SimpleBean</span>) pf<span style="color:#00f;font-weight:700">.</span>getProxy();
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Running CGLIB (Standard) Tests</span>);
        test(proxy);
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">runCglibFrozenTests</span>(<span style="color:#00f;font-weight:700">Advisor</span> <span style="font-style:italic">advisor</span>, <span style="color:#00f;font-weight:700">SimpleBean</span> <span style="font-style:italic">target</span>) {
        <span style="color:#00f;font-weight:700">ProxyFactory</span> pf <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ProxyFactory</span>();
        pf<span style="color:#00f;font-weight:700">.</span>setProxyTargetClass(<span style="color:#585cf6;font-weight:700">true</span>);
        pf<span style="color:#00f;font-weight:700">.</span>setTarget(target);
        pf<span style="color:#00f;font-weight:700">.</span>addAdvisor(advisor);
        pf<span style="color:#00f;font-weight:700">.</span>setFrozen(<span style="color:#585cf6;font-weight:700">true</span>);
        <span style="color:#00f;font-weight:700">SimpleBean</span> proxy <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">SimpleBean</span>) pf<span style="color:#00f;font-weight:700">.</span>getProxy();
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Running CGLIB (Frozen) Tests</span>);
        test(proxy);
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">runJdkTests</span>(<span style="color:#00f;font-weight:700">Advisor</span> <span style="font-style:italic">advisor</span>, <span style="color:#00f;font-weight:700">SimpleBean</span> <span style="font-style:italic">target</span>) {
        <span style="color:#00f;font-weight:700">ProxyFactory</span> pf <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ProxyFactory</span>();
        pf<span style="color:#00f;font-weight:700">.</span>setTarget(target);
        pf<span style="color:#00f;font-weight:700">.</span>addAdvisor(advisor);
        pf<span style="color:#00f;font-weight:700">.</span>setInterfaces(<span style="color:#00f;font-weight:700">new</span> Class {
            <span style="color:#00f;font-weight:700">SimpleBean</span><span style="color:#00f;font-weight:700">.</span>class
        });
        <span style="color:#00f;font-weight:700">SimpleBean</span> proxy <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">SimpleBean</span>) pf<span style="color:#00f;font-weight:700">.</span>getProxy();
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Running JDK Tests</span>);
        test(proxy);
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">test</span>(<span style="color:#00f;font-weight:700">SimpleBean</span> <span style="font-style:italic">bean</span>) {
        <span style="color:#00f;font-weight:700">long</span> before <span style="color:#00f;font-weight:700">=</span> <span style="color:#0000cd">0</span>;
        <span style="color:#00f;font-weight:700">long</span> after <span style="color:#00f;font-weight:700">=</span> <span style="color:#0000cd">0</span>;
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Testing Advised Method</span>);
        before <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>currentTimeMillis();
        <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">int</span> x <span style="color:#00f;font-weight:700">=</span> <span style="color:#0000cd">0</span>; x <span style="color:#00f;font-weight:700">&lt;</span> <span style="color:#0000cd">500000</span>; x<span style="color:#00f;font-weight:700">++</span>) {
            bean<span style="color:#00f;font-weight:700">.</span>advised();
        }
        after <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>currentTimeMillis();
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Took </span> <span style="color:#00f;font-weight:700">+</span> (after <span style="color:#00f;font-weight:700">-</span> before) <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07"> ms</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Testing Unadvised Method</span>);
        before <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>currentTimeMillis();
        <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">int</span> x <span style="color:#00f;font-weight:700">=</span> <span style="color:#0000cd">0</span>; x <span style="color:#00f;font-weight:700">&lt;</span> <span style="color:#0000cd">500000</span>; x<span style="color:#00f;font-weight:700">++</span>) {
            bean<span style="color:#00f;font-weight:700">.</span>unadvised();
        }
        after <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>currentTimeMillis();
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Took </span> <span style="color:#00f;font-weight:700">+</span> (after <span style="color:#00f;font-weight:700">-</span> before) <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07"> ms</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Testing equals() Method</span>);
        before <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>currentTimeMillis();
        <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">int</span> x <span style="color:#00f;font-weight:700">=</span> <span style="color:#0000cd">0</span>; x <span style="color:#00f;font-weight:700">&lt;</span> <span style="color:#0000cd">500000</span>; x<span style="color:#00f;font-weight:700">++</span>) {
            bean<span style="color:#00f;font-weight:700">.</span>equals(bean);
        }
        after <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>currentTimeMillis();
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Took </span> <span style="color:#00f;font-weight:700">+</span> (after <span style="color:#00f;font-weight:700">-</span> before) <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07"> ms</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Testing hashCode() Method</span>);
        before <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>currentTimeMillis();
        <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">int</span> x <span style="color:#00f;font-weight:700">=</span> <span style="color:#0000cd">0</span>; x <span style="color:#00f;font-weight:700">&lt;</span> <span style="color:#0000cd">500000</span>; x<span style="color:#00f;font-weight:700">++</span>) {
            bean<span style="color:#00f;font-weight:700">.</span>hashCode();
        }
        after <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>currentTimeMillis();
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Took </span> <span style="color:#00f;font-weight:700">+</span> (after <span style="color:#00f;font-weight:700">-</span> before) <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07"> ms</span>);
        <span style="color:#00f;font-weight:700">Advised</span> advised <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">Advised</span>) bean;
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Testing Advised.getProxyTargetClass() Method</span>);
        before <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>currentTimeMillis();
        <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">int</span> x <span style="color:#00f;font-weight:700">=</span> <span style="color:#0000cd">0</span>; x <span style="color:#00f;font-weight:700">&lt;</span> <span style="color:#0000cd">500000</span>; x<span style="color:#00f;font-weight:700">++</span>) {
            advised<span style="color:#00f;font-weight:700">.</span>getTargetClass();
        }
        after <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>currentTimeMillis();
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Took </span> <span style="color:#00f;font-weight:700">+</span> (after <span style="color:#00f;font-weight:700">-</span> before) <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07"> ms</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">&quot;&gt;&gt;&gt;<span style="color:#26b31a">\n</span>&quot;</span>);
    }
}
</pre>
                                <div class="Para" id="Par228">In this code, you can see that you are <span id="ITerm118">testing                      </span> three kinds of proxies:
                                    <div class="UnorderedList">
                                        <ul class="UnorderedListMarkBullet">
                                            <li>
                                                <div class="Para" id="Par229">A standard CGLIB proxy</div>
                                            </li>
                                            <li>
                                                <div class="Para" id="Par230">A CGLIB proxy with a frozen advice chain (that is, when a proxy is frozen by calling the <span class="EmphasisFontCategoryNonProportional">setFrozen()</span> method in the <span class="EmphasisFontCategoryNonProportional">ProxyConfig</span>                                                    class that <span class="EmphasisFontCategoryNonProportional">ProxyFactory</span> extends indirectly, CGLIB will perform further optimization; however, further advice change will not be allowed)</div>
                                            </li>
                                            <li>
                                                <div class="Para" id="Par231">A JDK <span id="ITerm119">proxy                                  </span> </div>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="Para" id="Par232">For each proxy type, you run the following five test cases:
                                    <div class="UnorderedList">
                                        <ul class="UnorderedListMarkBullet">
                                            <li>
                                                <div class="Para ParaOneEmphasisChild" id="Par233"> <span class="EmphasisTypeItalic">Advised method (test 1)</span>: This is a method that is advised. The advice type used in the test is before advice that performs no processing, so it reduces the effects
                                                    of the advice on the performance tests.</div>
                                            </li>
                                            <li>
                                                <div class="Para ParaOneEmphasisChild" id="Par234"> <span class="EmphasisTypeItalic">Unadvised method (test 2)</span>: This is a method on the proxy that is unadvised. Often your proxy has many methods that are not advised. This test looks at how well unadvised
                                                    methods perform for the different proxies.</div>
                                            </li>
                                            <li>
                                                <div class="Para" id="Par235"> <span class="EmphasisTypeItalic">The equals() method (test 3)</span>: This test looks at the overhead of invoking the <span class="EmphasisFontCategoryNonProportional">equals()</span> method. This is especially
                                                    important when you use proxies as keys in a <span class="EmphasisFontCategoryNonProportional">HashMap</span> or similar collection.</div>
                                            </li>
                                            <li>
                                                <div class="Para" id="Par236"> <span class="EmphasisTypeItalic">The hashCode() method (test 4)</span>: As with the <span class="EmphasisFontCategoryNonProportional">equals()</span> method, the <span class="EmphasisFontCategoryNonProportional">hashCode()</span>                                                    method is important when you are using <span class="EmphasisFontCategoryNonProportional">HashMap</span>s or similar collections.</div>
                                            </li>
                                            <li>
                                                <div class="Para" id="Par237"> <span class="EmphasisTypeItalic">Executing methods on the Advised interface (test 5)</span>: As we mentioned earlier, a proxy implements the <span class="EmphasisFontCategoryNonProportional">Advised</span>                                                    interface by default, allowing you to modify the proxy after creation and to query information about the proxy. This test looks at how fast methods on the <span class="EmphasisFontCategoryNonProportional">Advised</span>                                                    interface can be accessed using the different proxy types.</div>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="Para" id="Par238">Table <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Chapter.html#Tab3">5-3</a></span> shows the results of these tests.
                                    <div class="Table" id="Tab3">
                                        <div class="Caption" xml:lang="en">
                                            <div class="CaptionContent"><span class="CaptionNumber">Table 5-3.</span>
                                                <div class="SimplePara">Proxy Performance Test Results (in Milliseconds)</div>
                                            </div>
                                        </div>
                                        <table border="1">
                                            <colgroup>
                                                <col>
                                                <col>
                                                <col>
                                                <col>
                                            </colgroup>
                                            <thead>
                                                <tr class="header">
                                                    <th> </th>
                                                    <th>
                                                        <div class="SimplePara">CGLIB (Standard)</div>
                                                    </th>
                                                    <th>
                                                        <div class="SimplePara">CGLIB (Frozen)</div>
                                                    </th>
                                                    <th>
                                                        <div class="SimplePara">JDK</div>
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr class="noclass">
                                                    <td>
                                                        <div class="SimplePara">Advised method</div>
                                                    </td>
                                                    <td>
                                                        <div class="SimplePara">245</div>
                                                    </td>
                                                    <td>
                                                        <div class="SimplePara">135</div>
                                                    </td>
                                                    <td>
                                                        <div class="SimplePara">224</div>
                                                    </td>
                                                </tr>
                                                <tr class="noclass">
                                                    <td>
                                                        <div class="SimplePara">Unadvised method</div>
                                                    </td>
                                                    <td>
                                                        <div class="SimplePara">92</div>
                                                    </td>
                                                    <td>
                                                        <div class="SimplePara">42</div>
                                                    </td>
                                                    <td>
                                                        <div class="SimplePara">78</div>
                                                    </td>
                                                </tr>
                                                <tr class="noclass">
                                                    <td>
                                                        <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">equals()</span> </div>
                                                    </td>
                                                    <td>
                                                        <div class="SimplePara">9</div>
                                                    </td>
                                                    <td>
                                                        <div class="SimplePara">6</div>
                                                    </td>
                                                    <td>
                                                        <div class="SimplePara">77</div>
                                                    </td>
                                                </tr>
                                                <tr class="noclass">
                                                    <td>
                                                        <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">hashCode()</span> <span id="ITerm120">                                                                                  </span> </div>
                                                    </td>
                                                    <td>
                                                        <div class="SimplePara">29</div>
                                                    </td>
                                                    <td>
                                                        <div class="SimplePara">13</div>
                                                    </td>
                                                    <td>
                                                        <div class="SimplePara">23</div>
                                                    </td>
                                                </tr>
                                                <tr class="noclass">
                                                    <td>
                                                        <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">Advised.getProxyTargetClass()</span> </div>
                                                    </td>
                                                    <td>
                                                        <div class="SimplePara">9</div>
                                                    </td>
                                                    <td>
                                                        <div class="SimplePara">6</div>
                                                    </td>
                                                    <td>
                                                        <div class="SimplePara">15</div>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="Para" id="Par239">As you can see, the performance between standard CGLIB and JDK dynamic proxy for both advised and unadvised methods doesn’t differ much. As always, these numbers will vary based on hardware and the JDK being used.</div>
                                <div class="Para" id="Par240">However, there is a noticeable difference when you are using a CGLIB proxy with a frozen advice chain. Similar figures apply to the <span class="EmphasisFontCategoryNonProportional">equals()</span> and <span class="EmphasisFontCategoryNonProportional">hashCode()</span>                                    methods, which are noticeably faster when you are using the CGLIB proxy. For methods on the <span class="EmphasisFontCategoryNonProportional">Advised</span> interface, you will notice that they are also faster on the
                                    CGLIB frozen proxy. The reason for this is that <span class="EmphasisFontCategoryNonProportional">Advised</span> methods are handled early on in the <span class="EmphasisFontCategoryNonProportional">intercept()</span>                                    method, so they avoid much of the logic that is required for other methods.</div>
                            </div>
                            <div class="Section2 RenderAsSection2" id="Sec36">
                                <h3 class="Heading">Choosing a Proxy to Use</h3>
                                <div class="Para" id="Par241">Deciding which proxy to use is typically easy. The CGLIB proxy can proxy both classes and interfaces, whereas JDK proxies can proxy only interfaces. In terms of performance, there is no significant difference between JDK
                                    and CGLIB standard mode (at least in running both advised and unadvised methods), unless you use CGLIB in frozen mode, in which case the advice chain can’t be changed and CGLIB performs further optimization when in
                                    frozen mode. When proxying a class, the CGLIB proxy is the default choice because it is the only proxy capable of generating a proxy of a class. To use the CGLIB proxy when proxying an interface, you must set the value
                                    of the <span class="EmphasisFontCategoryNonProportional">optimize</span> flag in <span class="EmphasisFontCategoryNonProportional">ProxyFactory</span> to <span class="EmphasisFontCategoryNonProportional">true</span>                                    by using the <span class="EmphasisFontCategoryNonProportional">setOptimize()</span> method.</div>
                            </div>
                            </div>
                            <div class="Section1 RenderAsSection1" id="Sec37">
                                <h2 class="Heading">Advanced Use of Pointcuts</h2>
                                <div class="Para" id="Par242">Earlier in the chapter, we looked at the six basic <span class="EmphasisFontCategoryNonProportional">Pointcut</span> implementations Spring provides; for the most part, we have found that these meet the needs of our applications.
                                    However, sometimes you might need more flexibility when defining pointcuts. Spring provides two additional <span class="EmphasisFontCategoryNonProportional">Pointcut</span> implementations, <span class="EmphasisFontCategoryNonProportional">ComposablePointcut</span>                                    and <span class="EmphasisFontCategoryNonProportional">ControlFlowPointcut</span>, which provide exactly the flexibility you need.</div>
                                <div class="Section2 RenderAsSection2" id="Sec38">
                                    <h3 class="Heading">Using Control Flow Pointcuts</h3>
                                    <div class="Para" id="Par243">Spring <span id="ITerm121">control flow                      </span> pointcuts, implemented by the <span class="EmphasisFontCategoryNonProportional">ControlFlowPointcut</span> class, are similar to the <span class="EmphasisFontCategoryNonProportional">cflow</span>                                        construct available in many other AOP implementations, although they are not quite as powerful. Essentially, a control flow pointcut in Spring applies to all method calls below a given method or below all methods
                                        in a class. This is quite hard to visualize and is better explained using an example.</div>
                                    <div class="Para ParaOneEmphasisChild" id="Par244">The following code snippet shows a <span class="EmphasisFontCategoryNonProportional">SimpleBeforeAdvice</span> class that writes out a message describing the method it is advising:</div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.lang.reflect.Method</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.MethodBeforeAdvice</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SimpleBeforeAdvice</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">MethodBeforeAdvice</span> {
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">before</span>(<span style="color:#00f;font-weight:700">Method</span> <span style="font-style:italic">method</span>, <span style="color:#00f;font-weight:700">Object</span> <span style="font-style:italic">args</span>, <span style="color:#00f;font-weight:700">Object</span> <span style="font-style:italic">target</span>)
            <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Throwable</span> {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Before method: </span> <span style="color:#00f;font-weight:700">+</span> method);
    }
}</pre>
                                    <div class="Para" id="Par246">This advice class allows we to see which methods the <span class="EmphasisFontCategoryNonProportional">ControlFlowPointcut</span> applies to. Here, you can see the simple <span class="EmphasisFontCategoryNonProportional">TestBean</span>                                        class:</div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">TestBean</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">foo</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">foo()</span>);
    }
}</pre>
                                    <div class="Para ParaOneEmphasisChild" id="Par248">You can see the simple <span class="EmphasisFontCategoryNonProportional">foo()</span> method that we want to advise. We have, however, a special requirement: we want to advise this method only when it is called from
                                        another, specific method. The following code snippet shows a simple driver program for this example:</div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.Advisor</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.Pointcut</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.framework.ProxyFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.support.ControlFlowPointcut</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.support.DefaultPointcutAdvisor</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">ControlFlowDemo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">ControlFlowDemo</span> ex <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ControlFlowDemo</span>();
        ex<span style="color:#00f;font-weight:700">.</span>run();
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">run</span>() {
        <span style="color:#00f;font-weight:700">TestBean</span> target <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">TestBean</span>();
        <span style="color:#00f;font-weight:700">Pointcut</span> pc <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ControlFlowPointcut</span>(<span style="color:#00f;font-weight:700">ControlFlowDemo</span><span style="color:#00f;font-weight:700">.</span>class,
                <span style="color:#036a07">test</span>);
        <span style="color:#00f;font-weight:700">Advisor</span> advisor <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">DefaultPointcutAdvisor</span>(pc,
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SimpleBeforeAdvice</span>());
        <span style="color:#00f;font-weight:700">ProxyFactory</span> pf <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ProxyFactory</span>();
        pf<span style="color:#00f;font-weight:700">.</span>setTarget(target);
        pf<span style="color:#00f;font-weight:700">.</span>addAdvisor(advisor);
        <span style="color:#00f;font-weight:700">TestBean</span> proxy <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">TestBean</span>) pf<span style="color:#00f;font-weight:700">.</span>getProxy();
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">&quot;<span style="color:#26b31a">\t</span>Trying normal invoke&quot;</span>);
        proxy<span style="color:#00f;font-weight:700">.</span>foo();
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span><span style="color:#26b31a">\t</span>Trying under ControlFlowDemo.test()&quot;</span>);
        test(proxy);
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">test</span>(<span style="color:#00f;font-weight:700">TestBean</span> <span style="font-style:italic">bean</span>) {
        bean<span style="color:#00f;font-weight:700">.</span>foo();
    }
}</pre>
                                    <div class="Para" id="Par250">In the previous code snippet, the advised proxy is assembled with <span class="EmphasisFontCategoryNonProportional">ControlFlowPointcut</span>, and then the <span class="EmphasisFontCategoryNonProportional">foo()</span>                                        method is invoked twice, once directly from the <span class="EmphasisFontCategoryNonProportional">main()</span> method and once from the <span class="EmphasisFontCategoryNonProportional">test()</span> method. Here
                                        is the line of particular interest:</div>
                                    <div class="Para" id="Par251">
                                        <div class="ProgramCode" id="PC60">
                                            <div class="FixedLine">        Pointcut pc = new ControlFlowPointcut(ControlFlowDemo.class, &quot;test&quot;);</div>
                                        </div>
                                    </div>
                                    <div class="Para" id="Par252">In this line, we are creating a <span class="EmphasisFontCategoryNonProportional">ControlFlowPointcut</span> instance for the <span class="EmphasisFontCategoryNonProportional">test()</span> method of the <span class="EmphasisFontCategoryNonProportional">ControlFlowDemo</span>                                        class. Essentially, this says, “Pointcut all methods that are called from the <span class="EmphasisFontCategoryNonProportional">ControlFlowExample.test()</span> method.” Note that although we said “Pointcut all
                                        methods,” in fact this really means “Pointcut all methods on the proxy object that is advised using the <span class="EmphasisFontCategoryNonProportional">Advisor</span> corresponding to this instance of <span class="EmphasisFontCategoryNonProportional">ControlFlowPointcut</span>.”
                                        Running the previous example yields the following result in the console:</div>
                                    <div class="Para" id="Par253">
                                        <div class="ProgramCode" id="PC61">
                                            <div class="LineGroup">
                                                <div class="FixedLine">        Trying normal invoke</div>
                                                <div class="FixedLine">foo()</div>
                                            </div>
                                            <div class="LineGroup">
                                                <div class="FixedLine">        Trying under ControlFlowDemo.test()</div>
                                                <div class="FixedLine">Before method: public void com.apress.prospring5.ch5.TestBean.foo()</div>
                                                <div class="FixedLine">foo()</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="Para" id="Par254">As you can see, when the <span class="EmphasisFontCategoryNonProportional">sing()</span> method is first invoked outside of the control flow of the <span class="EmphasisFontCategoryNonProportional">test()</span> method,
                                        it is unadvised. When it executes for a second time, this time inside the control flow of the <span class="EmphasisFontCategoryNonProportional">test()</span> method, the <span class="EmphasisFontCategoryNonProportional">ControlFlowPointcut</span>                                        indicates that its associated advice applies to the method, and thus the method is advised. Note that if we had called another method from within the <span class="EmphasisFontCategoryNonProportional">test()</span>                                        method, one that was not on the advised proxy, it would not have been advised.</div>
                                    <div class="Para" id="Par255">Control flow pointcuts can be extremely useful, allowing you to advise an object selectively only when it is executed in the context of another. However, be aware that you take a substantial performance hit for using
                                        control flow pointcut over other <span id="ITerm124">pointcuts                      </span>.</div>
                                    <div class="Para" id="Par256">Let’s consider an example. Suppose we have a transaction processing system, which contains a <span class="EmphasisFontCategoryNonProportional">TransactionService</span> interface as well as an <span class="EmphasisFontCategoryNonProportional">AccountService</span>                                        interface. We would like to apply after advice so that when the <span class="EmphasisFontCategoryNonProportional">AccountService.updateBalance()</span> method is called by <span class="EmphasisFontCategoryNonProportional">TransactionService.reverseTransaction()</span>,
                                        an e-mail notification is sent to the customer, after the account balance is updated. However, an e-mail will not be sent under any other circumstances. In this case, the control flow pointcut will be useful. Figure
                                        <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Chapter.html#Fig6">5-6</a></span> shows the UML sequence diagram for this scenario.
                                        <div class="Figure" id="Fig6">
                                            <div class="MediaObject" id="MO6"><img alt="A315511_5_En_5_Fig6_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Fig6_HTML.jpg" height="478" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Fig6_HTML.jpg" width="640"/></div>
                                            <div class="Caption" xml:lang="en">
                                                <div class="CaptionContent"><span class="CaptionNumber">Figure 5-6.</span>
                                                    <div class="SimplePara">UML sequence diagram for a control flow pointcut</div>
                                                </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="Section2 RenderAsSection2" id="Sec39">
                                <h3 class="Heading">Using a <span id="ITerm125">Composable                      </span> Pointcut</h3>
                                <div class="Para" id="Par257">In previous pointcut examples, we used just a single pointcut for each <span class="EmphasisFontCategoryNonProportional">Advisor</span>. In most cases, this is usually enough, but in some cases, you may need to compose
                                    two or more pointcuts together to achieve the desired goal. Say you want to pointcut all getter and setter methods on a bean. You have a pointcut for getters and a pointcut for setters, but you don’t have one for both.
                                    Of course, you could just create another pointcut with the new logic, but a better approach is to combine the two pointcuts into a single pointcut by using <span class="EmphasisFontCategoryNonProportional">ComposablePointcut</span>.</div>
                                <div class="Para" id="Par258"> <span class="EmphasisFontCategoryNonProportional">ComposablePointcut</span> supports two methods: <span class="EmphasisFontCategoryNonProportional">union()</span> and <span class="EmphasisFontCategoryNonProportional">intersection()</span>.
                                    By default, <span class="EmphasisFontCategoryNonProportional">ComposablePointcut</span> is created with a <span class="EmphasisFontCategoryNonProportional">ClassFilter</span> that matches all classes and a <span class="EmphasisFontCategoryNonProportional">MethodMatcher</span>                                    that matches all methods, although you can supply your own initial <span class="EmphasisFontCategoryNonProportional">ClassFilter</span> and <span class="EmphasisFontCategoryNonProportional">MethodMatcher</span> during
                                    construction. The <span class="EmphasisFontCategoryNonProportional">union()</span> and <span class="EmphasisFontCategoryNonProportional">intersection()</span> methods are both overloaded to accept <span class="EmphasisFontCategoryNonProportional">ClassFilter</span>                                    and <span class="EmphasisFontCategoryNonProportional">MethodMatcher</span> arguments.</div>
                            <div class="Para" id="Par259">The <span class="EmphasisFontCategoryNonProportional">ComposablePointcut.union()</span> method can be called by passing in an instance of either the <span class="EmphasisFontCategoryNonProportional">ClassFilter</span>,
                                <span class="EmphasisFontCategoryNonProportional">MethodMatcher</span>, or <span class="EmphasisFontCategoryNonProportional">Pointcut</span> interface. The result of a union operation is that <span class="EmphasisFontCategoryNonProportional">ComposablePointcut</span> will
                                    add an “or” condition into its call chain for matching with the joinpoints. It’s the same for the <span class="EmphasisFontCategoryNonProportional">ComposablePointcut.intersection()</span> method, but this time an “and”
                                    condition will be added instead, which means that all <span class="EmphasisFontCategoryNonProportional">ClassFilter</span>, <span class="EmphasisFontCategoryNonProportional">MethodMatcher</span>, and <span class="EmphasisFontCategoryNonProportional">Pointcut</span>                                    definitions within <span class="EmphasisFontCategoryNonProportional">ComposablePointcut</span> should be matched for applying an advice. You can imagine it as the <span class="EmphasisFontCategoryNonProportional">WHERE</span>                                    clause in a SQL query, with the <span class="EmphasisFontCategoryNonProportional">union()</span> method like the “or” operator and the <span class="EmphasisFontCategoryNonProportional">intersection()</span> method like
                                    the “and” operator.</div>
                            <div class="Para" id="Par260">As with control flow pointcuts, this is quite difficult to visualize, and it is much easier to understand with an example. The following example shows the <span class="EmphasisFontCategoryNonProportional">GrammyGuitarist</span>                                class used in a previous example with its four <span id="ITerm126">methods                      </span>:</div>
                            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.common.Guitar</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.common.Singer</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">GrammyGuitarist</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Singer</span> {
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">sing</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">&quot;sing: Gravity is working against me<span style="color:#26b31a">\n</span>&quot;</span> <span style="color:#00f;font-weight:700">+</span>
                <span style="color:#036a07">And gravity wants to bring me down</span>);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">sing</span>(<span style="color:#00f;font-weight:700">Guitar</span> <span style="font-style:italic">guitar</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">play: </span> <span style="color:#00f;font-weight:700">+</span> guitar<span style="color:#00f;font-weight:700">.</span>play());
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">rest</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">zzz</span>);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">talk</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">talk</span>);
    }
}
</pre>
                            <div class="Para" id="Par262">With this example, we are going to generate three proxies by using the same <span class="EmphasisFontCategoryNonProportional">ComposablePointcut</span> instance, but each time, we are going to modify <span class="EmphasisFontCategoryNonProportional">ComposablePointcut</span>                                by using either the <span class="EmphasisFontCategoryNonProportional">union()</span> or <span class="EmphasisFontCategoryNonProportional">intersection()</span> method. Following this, we will invoke all three methods on
                                the <span class="EmphasisFontCategoryNonProportional">target</span> bean proxy and look at which ones have been advised. The following code sample depicts this:</div>
                            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.lang.reflect.Method</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.Advisor</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.ClassFilter</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.framework.ProxyFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.support.ComposablePointcut</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.support.DefaultPointcutAdvisor</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.support.StaticMethodMatcher</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">ComposablePointcutExample</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GrammyGuitarist</span> johnMayer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GrammyGuitarist</span>();
        <span style="color:#00f;font-weight:700">ComposablePointcut</span> pc <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ComposablePointcut</span>(<span style="color:#00f;font-weight:700">ClassFilter</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>TRUE</span>,
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SingMethodMatcher</span>());
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Test 1 &gt;&gt; </span>);
        <span style="color:#00f;font-weight:700">GrammyGuitarist</span> proxy <span style="color:#00f;font-weight:700">=</span> getProxy(pc, johnMayer);
        testInvoke(proxy);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println();
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Test 2 &gt;&gt; </span>);
        pc<span style="color:#00f;font-weight:700">.</span>union(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">TalkMethodMatcher</span>());
        proxy <span style="color:#00f;font-weight:700">=</span> getProxy(pc, johnMayer);
        testInvoke(proxy);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println();
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Test 3 &gt;&gt; </span>);
        pc<span style="color:#00f;font-weight:700">.</span>intersection(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">RestMethodMatcher</span>());
        proxy <span style="color:#00f;font-weight:700">=</span> getProxy(pc, johnMayer);
        testInvoke(proxy);
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">GrammyGuitarist</span> <span style="color:#0000a2;font-weight:700">getProxy</span>(<span style="color:#00f;font-weight:700">ComposablePointcut</span> <span style="font-style:italic">pc</span>,
                                            <span style="color:#00f;font-weight:700">GrammyGuitarist</span> <span style="font-style:italic">target</span>) {
        <span style="color:#00f;font-weight:700">Advisor</span> advisor <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">DefaultPointcutAdvisor</span>(pc,
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SimpleBeforeAdvice</span>());
        <span style="color:#00f;font-weight:700">ProxyFactory</span> pf <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ProxyFactory</span>();
        pf<span style="color:#00f;font-weight:700">.</span>setTarget(target);
        pf<span style="color:#00f;font-weight:700">.</span>addAdvisor(advisor);
        <span style="color:#00f;font-weight:700">return</span> (<span style="color:#00f;font-weight:700">GrammyGuitarist</span>) pf<span style="color:#00f;font-weight:700">.</span>getProxy();
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">testInvoke</span>(<span style="color:#00f;font-weight:700">GrammyGuitarist</span> <span style="font-style:italic">proxy</span>) {
        proxy<span style="color:#00f;font-weight:700">.</span>sing();
        proxy<span style="color:#00f;font-weight:700">.</span>sing(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Guitar</span>());
        proxy<span style="color:#00f;font-weight:700">.</span>talk();
        proxy<span style="color:#00f;font-weight:700">.</span>rest();
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingMethodMatcher</span> <span style="color:#00f;font-weight:700">extends</span> <span style="font-style:italic">StaticMethodMatcher</span> {
        <span style="color:#00f;font-weight:700">@Override</span>
        <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">boolean</span> <span style="color:#0000a2;font-weight:700">matches</span>(<span style="color:#00f;font-weight:700">Method</span> <span style="font-style:italic">method</span>, <span style="color:#00f;font-weight:700">Class&lt;?&gt;</span> <span style="font-style:italic">cls</span>) {
            <span style="color:#00f;font-weight:700">return</span> (method<span style="color:#00f;font-weight:700">.</span>getName()<span style="color:#00f;font-weight:700">.</span>startsWith(<span style="color:#036a07">si</span>));
        }
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">TalkMethodMatcher</span> <span style="color:#00f;font-weight:700">extends</span> <span style="font-style:italic">StaticMethodMatcher</span> {
        <span style="color:#00f;font-weight:700">@Override</span>
        <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">boolean</span> <span style="color:#0000a2;font-weight:700">matches</span>(<span style="color:#00f;font-weight:700">Method</span> <span style="font-style:italic">method</span>, <span style="color:#00f;font-weight:700">Class&lt;?&gt;</span> <span style="font-style:italic">cls</span>) {
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">talk</span><span style="color:#00f;font-weight:700">.</span>equals(method<span style="color:#00f;font-weight:700">.</span>getName());
        }
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">RestMethodMatcher</span> <span style="color:#00f;font-weight:700">extends</span> <span style="font-style:italic">StaticMethodMatcher</span> {
        <span style="color:#00f;font-weight:700">@Override</span>
        <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">boolean</span> <span style="color:#0000a2;font-weight:700">matches</span>(<span style="color:#00f;font-weight:700">Method</span> <span style="font-style:italic">method</span>, <span style="color:#00f;font-weight:700">Class&lt;?&gt;</span> <span style="font-style:italic">cls</span>) {
            <span style="color:#00f;font-weight:700">return</span> (method<span style="color:#00f;font-weight:700">.</span>getName()<span style="color:#00f;font-weight:700">.</span>endsWith(<span style="color:#036a07">st</span>));
        }
    }
}
</pre>
                            <div class="Para" id="Par264">The first thing to notice in this example is the set of three private <span class="EmphasisFontCategoryNonProportional">MethodMatcher</span> implementations. <span class="EmphasisFontCategoryNonProportional">SingMethodMatcher</span>                                matches all methods that start with <span class="EmphasisFontCategoryNonProportional">get</span>. This is the default <span class="EmphasisFontCategoryNonProportional">MethodMatcher</span> that we use to assemble
                                <span class="EmphasisFontCategoryNonProportional">ComposablePointcut</span>. Because of this, we expect that the first round of invocations on the <span class="EmphasisFontCategoryNonProportional">GrammyGuitarist</span> methods will result in only the <span class="EmphasisFontCategoryNonProportional">sing()</span>                                    methods being advised.</div>
                            <div class="Para" id="Par265"> <span class="EmphasisFontCategoryNonProportional">TalkMethodMatcher</span> matches all methods named <span class="EmphasisFontCategoryNonProportional">talk</span>, and it is combined with <span class="EmphasisFontCategoryNonProportional">ComposablePointcut</span>                                by using <span class="EmphasisFontCategoryNonProportional">union()</span> for the second round of invocations. At this point, we have a union of two <span class="EmphasisFontCategoryNonProportional">MethodMatcher</span>s—one
                                that matches all methods starting with <span class="EmphasisFontCategoryNonProportional">si</span> and one that matches all methods named <span class="EmphasisFontCategoryNonProportional">talk</span>. We now expect that
                                all invocations during the second round will be advised. <span class="EmphasisFontCategoryNonProportional">TalkMethodMatcher</span> is very specific and matches only the <span class="EmphasisFontCategoryNonProportional">talk()</span>                                method. This <span class="EmphasisFontCategoryNonProportional">MethodMatcher</span> is combined with <span class="EmphasisFontCategoryNonProportional">ComposablePointcut</span> by using <span class="EmphasisFontCategoryNonProportional">intersection()</span>                                for the third round for invocations.</div>
                            <div class="Para" id="Par266">Because <span class="EmphasisFontCategoryNonProportional">RestMethodMatcher</span> is being composed by using <span class="EmphasisFontCategoryNonProportional">intersection()</span>, we expect none of the methods to be advised
                                in the third round because there is no method that matches all the composed <span class="EmphasisFontCategoryNonProportional">MethodMatcher</span>s.</div>
                            <div class="Para" id="Par267">Running this example results in the following <span id="ITerm129">output                      </span>:</div>
                            <div class="Para" id="Par268">
                                <div class="ProgramCode" id="PC64">
                                    <div class="LineGroup">
                                        <div class="FixedLine">Test 1 &gt;&gt;</div>
                                        <div class="FixedLine">Before method: public void</div>
                                        <div class="FixedLine">       com.apress.prospring5.ch5.GrammyGuitarist.<span class="EmphasisTypeUnderline">sing()</span> </div>
                                        <div class="FixedLine">sing: Gravity is working against me</div>
                                        <div class="FixedLine">And gravity wants to bring me down</div>
                                        <div class="FixedLine">Before method: public void com.apress.prospring5.ch5.</div>
                                        <div class="FixedLine">    GrammyGuitarist.<span class="EmphasisTypeUnderline">sing</span>(com.apress.prospring5.ch2.common.Guitar)</div>
                                        <div class="FixedLine">play: G C G C Am D7</div>
                                        <div class="FixedLine">talk</div>
                                        <div class="FixedLine">zzz</div>
                                    </div>
                                    <div class="LineGroup">
                                        <div class="FixedLine">Test 2 &gt;&gt;</div>
                                        <div class="FixedLine">Before method: public void</div>
                                        <div class="FixedLine">       com.apress.prospring5.ch5.GrammyGuitarist.<span class="EmphasisTypeUnderline">sing()</span> </div>
                                        <div class="FixedLine">sing: Gravity is working against me</div>
                                        <div class="FixedLine">And gravity wants to bring me down</div>
                                        <div class="FixedLine">Before method: public void</div>
                                        <div class="FixedLine">      com.apress.prospring5.ch5.GrammyGuitarist.<span class="EmphasisTypeUnderline">talk()</span> </div>
                                        <div class="FixedLine">Before method: public void com.apress.prospring5.ch5.</div>
                                        <div class="FixedLine">      GrammyGuitarist.<span class="EmphasisTypeUnderline">sing</span>(com.apress.prospring5.ch2.common.Guitar)</div>
                                        <div class="FixedLine">play: G C G C Am D7</div>
                                        <div class="FixedLine">talk</div>
                                        <div class="FixedLine">zzz</div>
                                    </div>
                                    <div class="LineGroup">
                                        <div class="FixedLine">Test 3 &gt;&gt;</div>
                                        <div class="FixedLine">sing: Gravity is working against me</div>
                                        <div class="FixedLine">And gravity wants to bring me down</div>
                                        <div class="FixedLine">talk</div>
                                        <div class="FixedLine">zzz</div>
                                    </div>
                                </div>
                            </div>
                            <div class="Para" id="Par269">Although this example demonstrated the use of <span class="EmphasisFontCategoryNonProportional">MethodMatcher</span>s only in the composition process, it is just as simple to use <span class="EmphasisFontCategoryNonProportional">ClassFilter</span>                                when you are building the pointcut. Indeed, you can use a combination of <span class="EmphasisFontCategoryNonProportional">MethodMatcher</span>s and <span class="EmphasisFontCategoryNonProportional">ClassFilter</span>s
                                when building your composite <span id="ITerm130">pointcut                      </span>.</div>
                            </div>
                            <div class="Section2 RenderAsSection2" id="Sec40">
                                <h3 class="Heading"> <span id="ITerm131">Composition                      </span> and the Pointcut Interface</h3>
                                <div class="Para" id="Par270">In the previous section, you saw how to create a composite pointcut by using multiple <span class="EmphasisFontCategoryNonProportional">MethodMatchers</span> and <span class="EmphasisFontCategoryNonProportional">ClassFilter</span>s.
                                    You can also create composite pointcuts by using other objects that implement the <span class="EmphasisFontCategoryNonProportional">Pointcut</span> interface.</div>
                                <div class="Para" id="Par271">Another way to construct a composite pointcut is to use the <span class="EmphasisFontCategoryNonProportional">org.springframework.aop.support.Pointcuts</span> class. The class provides three static methods. The <span class="EmphasisFontCategoryNonProportional">intersection()</span>                                    and <span class="EmphasisFontCategoryNonProportional">union()</span> methods both take two pointcuts as arguments to construct a composite pointcut. On the other hand, a <span class="EmphasisFontCategoryNonProportional">matches(Pointcut, Method, Class, Object[])</span>                                    method is provided for performing a quick check on whether a pointcut matches with the provided method, class, and method arguments.</div>
                                <div class="Para" id="Par272">The <span class="EmphasisFontCategoryNonProportional">Pointcuts</span> class supports operations on only two pointcuts. So, if you need to combine <span class="EmphasisFontCategoryNonProportional">MethodMatcher</span> and
                                    <span class="EmphasisFontCategoryNonProportional">ClassFilter</span> with <span class="EmphasisFontCategoryNonProportional">Pointcut</span>, you need to use the <span class="EmphasisFontCategoryNonProportional">ComposablePointcut</span>                                    class. However, when you need to combine just two pointcuts, the <span class="EmphasisFontCategoryNonProportional">Pointcuts</span> class will be more convenient.</div>
                            </div>
                            <div class="Section2 RenderAsSection2" id="Sec41">
                                <h3 class="Heading">Pointcut Summary</h3>
                                <div class="Para" id="Par273">Spring offers a powerful set of <span class="EmphasisFontCategoryNonProportional">Pointcut</span> implementations that should meet most, if not all, of your application’s requirements. Remember that if you can’t find a
                                    pointcut to suit your needs, you can create your own implementation from scratch by implementing <span class="EmphasisFontCategoryNonProportional">Pointcut</span>, <span class="EmphasisFontCategoryNonProportional">MethodMatcher</span>,
                                    and <span class="EmphasisFontCategoryNonProportional">ClassFilter</span>.</div>
                                <div class="Para" id="Par274">You can use two patterns to combine pointcuts and advisors. The first pattern, the one we have used so far, involves having the pointcut implementation decoupled from the advisor. In the code we have seen up to this point,
                                    we created instances of <span class="EmphasisFontCategoryNonProportional">Pointcut</span> implementations and then used the <span class="EmphasisFontCategoryNonProportional">DefaultPointcutAdvisor</span> implementation
                                    to add advice along with the <span class="EmphasisFontCategoryNonProportional">Pointcut</span> to the proxy.</div>
                                <div class="Para" id="Par275">The second option, one that is adopted by many of the examples in the Spring documentation, is to encapsulate the <span class="EmphasisFontCategoryNonProportional">Pointcut</span> inside your own <span class="EmphasisFontCategoryNonProportional">Advisor</span>                                    implementation. This way, you have a class that implements both <span class="EmphasisFontCategoryNonProportional">Pointcut</span> and <span class="EmphasisFontCategoryNonProportional">PointcutAdvisor</span>, with the
                                    <span class="EmphasisFontCategoryNonProportional">PointcutAdvisor.getPointcut()</span> method simply returning this. This is an approach many classes, such as <span class="EmphasisFontCategoryNonProportional">StaticMethodMatcherPointcutAdvisor</span>,
                                    use in Spring. We find that the first approach is the most flexible, allowing you to use different <span class="EmphasisFontCategoryNonProportional">Pointcut</span> implementations with different <span class="EmphasisFontCategoryNonProportional">Advisor</span>                                    implementations. However, the second approach is useful in situations where you are going to be using the same combination of <span class="EmphasisFontCategoryNonProportional">Pointcut</span> and <span class="EmphasisFontCategoryNonProportional">Advisor</span>                                    in different parts of your application or, indeed, across many applications.</div>
                                <div class="Para" id="Par276">The second approach is useful when each <span class="EmphasisFontCategoryNonProportional">Advisor</span> must have a separate instance of a <span class="EmphasisFontCategoryNonProportional">Pointcut</span>; by making the
                                    <span class="EmphasisFontCategoryNonProportional">Advisor</span> responsible for creating the <span class="EmphasisFontCategoryNonProportional">Pointcut</span>, you can ensure that this is the case. If you recall the
                                    discussion on proxy performance from the previous chapter, you will remember that unadvised methods perform much better than methods that are advised. For this reason, you should ensure that, by using <span class="EmphasisFontCategoryNonProportional">Pointcuts</span>,
                                    you advise only the methods that are absolutely necessary. This way, you reduce the amount of unnecessary overhead added to your application by using AOP.</div>
                            </div>
                            </div>
                            <div class="Section1 RenderAsSection1" id="Sec42">
                                <h2 class="Heading">Getting Started with Introductions</h2>
                                <div class="Para" id="Par277">Introductions are an important part of the AOP feature set available in Spring. By using introductions, you can introduce new functionality to an existing object dynamically. In Spring, you can introduce an implementation
                                    of any interface to an existing object. You may well be wondering exactly why this is useful. Why would you want to add functionality dynamically at runtime when you can simply add that functionality at development
                                    time? The answer to this question is easy. You add functionality dynamically when the functionality is crosscutting and is not easily implemented using traditional advice.</div>
                                <div class="Section2 RenderAsSection2" id="Sec43">
                                    <h3 class="Heading">Introduction Basics</h3>
                                    <div class="Para" id="Par278">Spring treats <span class="EmphasisTypeItalic">introductions</span> as a special type of advice, more specifically, as a special type of around advice. Because introductions apply solely at the class level, you cannot
                                        use pointcuts with introductions; semantically, the two don’t match. An introduction adds new interface implementations to a class, and a pointcut defines which methods the advice applies to. You create an introduction
                                        by implementing the <span id="ITerm132">                <span class="EmphasisFontCategoryNonProportional">IntroductionInterceptor</span> </span> interface, which extends the <span class="EmphasisFontCategoryNonProportional">MethodInterceptor</span>                                        and <span class="EmphasisFontCategoryNonProportional">DynamicIntroductionAdvice</span> interfaces. Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Chapter.html#Fig7">5-7</a></span>                                        shows this structure along with the methods of both interfaces, as depicted by the IntelliJ IDEA UML plug-in. As you can see, the
                                        <div class="Figure" id="Fig7">
                                            <div class="MediaObject" id="MO7"><img alt="A315511_5_En_5_Fig7_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Fig7_HTML.jpg" height="316" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Fig7_HTML.jpg" width="640"/></div>
                                            <div class="Caption" xml:lang="en">
                                                <div class="CaptionContent"><span class="CaptionNumber">Figure 5-7.</span>
                                                    <div class="SimplePara"> <span id="ITerm133">Interface structure                                      </span> for introductions</div>
                                                </div>
                                        </div>
                                    </div> <span class="EmphasisFontCategoryNonProportional">MethodInterceptor</span> interface defines an <span class="EmphasisFontCategoryNonProportional">invoke()</span> method. Using this method, you provide the implementation
                                    for the interfaces that you are introducing and perform interception for any additional methods as required. Implementing all methods for an interface inside a single method can prove troublesome, and it is likely to
                                    result in an awful lot of code that you will have to wade through just to decide which method to invoke. Thankfully, Spring provides a default implementation of <span class="EmphasisFontCategoryNonProportional">IntroductionInterceptor</span>,
                                    called <span class="EmphasisFontCategoryNonProportional">DelegatingIntroductionInterceptor</span>, which makes creating introductions much simpler. To build an introduction by using <span class="EmphasisFontCategoryNonProportional">DelegatingIntroductionInterceptor</span>,
                                    you create a class that both inherits from <span class="EmphasisFontCategoryNonProportional">DelegatingIntroductionInterceptor</span> and implements the interfaces you want to introduce. The <span class="EmphasisFontCategoryNonProportional">DelegatingIntroductionInterceptor</span>                                    implementation then simply delegates all calls to introduced methods to the corresponding method on itself. Don’t worry if this seems a little unclear; you will see an example of it in the next section.</div>
                                <div class="Para" id="Par280">Just as you need to use <span id="ITerm134">                <span class="EmphasisFontCategoryNonProportional">PointcutAdvisor</span> </span> when you are working with pointcut advice, you need to use <span class="EmphasisFontCategoryNonProportional">IntroductionAdvisor</span>                                    to add introductions to a proxy. The default implementation of <span class="EmphasisFontCategoryNonProportional">IntroductionAdvisor</span> is <span class="EmphasisFontCategoryNonProportional">DefaultIntroductionAdvisor</span>,
                                    which should suffice for most, if not all, of your introduction needs. You should be aware that adding an introduction by using <span class="EmphasisFontCategoryNonProportional">ProxyFactory.addAdvice()</span> is not
                                    permitted and results in <span class="EmphasisFontCategoryNonProportional">AopConfigException</span> being thrown. Instead, you should use the <span class="EmphasisFontCategoryNonProportional">addAdvisor()</span> method
                                    and pass an instance of the <span class="EmphasisFontCategoryNonProportional">IntroductionAdvisor</span> interface.</div>
                                <div class="Para" id="Par281">When using standard advice—that is, not introductions—it is possible for the same advice instance to be used for many objects. The Spring documentation refers to this as the per-class life cycle, although you can use a
                                    single advice instance for many classes. For introductions, the introduction advice forms part of the state of the advised object, and as a result, you must have a distinct advice instance for every advised object.
                                    This is called the <span class="EmphasisTypeItalic">per-instance life cycle</span>. Because you must ensure that each advised object has a distinct instance of the introduction, it is often preferable to create a subclass
                                    of <span class="EmphasisFontCategoryNonProportional">DefaultIntroductionAdvisor</span> that is responsible for creating the introduction advice. This way, you need to ensure only that a new instance of your advisor
                                    class is created for each object because it will automatically create a new instance of the introduction. For example, say you want to apply before advice to the <span class="EmphasisFontCategoryNonProportional">setFirstName()</span>                                    method on all instances of the <span class="EmphasisFontCategoryNonProportional">Contact</span> class. Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Chapter.html#Fig8">5-8</a></span>                                    shows the same advice that applies to all objects of the <span id="ITerm135">                <span class="EmphasisFontCategoryNonProportional">Contact</span> </span> type. Now let’s say you want to mix an introduction
                                    into all instances of the <span class="EmphasisFontCategoryNonProportional">Contact</span> class, and the introduction will carry information <span id="ITerm136">for                      </span> each <span class="EmphasisFontCategoryNonProportional">Contact</span>                                    instance (for example, an attribute <span class="EmphasisFontCategoryNonProportional">isModified</span> that indicates whether the specific instance was modified).
                                    <div class="Figure" id="Fig8">
                                        <div class="MediaObject" id="MO8"><img alt="A315511_5_En_5_Fig8_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Fig8_HTML.jpg" height="213" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Fig8_HTML.jpg" width="319"/></div>
                                        <div class="Caption" xml:lang="en">
                                            <div class="CaptionContent"><span class="CaptionNumber">Figure 5-8.</span>
                                                <div class="SimplePara">Per-class life cycle of advice</div>
                                            </div>
                                    </div>
                                </div>
                            </div>
                            <div class="Para" id="Par282">In this case, the introduction will be created for each instance of <span class="EmphasisFontCategoryNonProportional">Contact</span> and tied to that specific instance, as shown in Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Chapter.html#Fig9">5-9</a></span>.
                                That covers the basics of introduction creation. We will now discuss how you can use introductions to solve the problem of object modification detection.
                                <div class="Figure" id="Fig9">
                                    <div class="MediaObject" id="MO9"><img alt="A315511_5_En_5_Fig9_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Fig9_HTML.jpg" height="276" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Fig9_HTML.jpg" width="277"/></div>
                                    <div class="Caption" xml:lang="en">
                                        <div class="CaptionContent"><span class="CaptionNumber">Figure 5-9.</span>
                                            <div class="SimplePara"> <span id="ITerm137">Per-instance                                      </span> introduction</div>
                                        </div>
                                </div>
                            </div>
                            </div>
                            </div>
                            <div class="Section2 RenderAsSection2" id="Sec44">
                                <h3 class="Heading">Object Modification Detection with Introductions</h3>
                                <div class="Para" id="Par284"> <span id="ITerm138">                <span class="EmphasisTypeItalic">Object modification detection</span> </span> <span id="ITerm139">                                              </span> is a useful technique for many
                                    reasons. Typically, you apply modification detection to prevent unnecessary database access when you are persisting object data. If an object is passed to a method for modification but it comes back unmodified, there
                                    is little point in issuing an update statement to the database. Using a modification check in this way can really increase application throughput, especially when the database is already under a substantial load or
                                    is located on a remote network, making communication an expensive operation.</div>
                                <div class="Para ParaOneEmphasisChild" id="Par285">Unfortunately, this kind of functionality is difficult to implement by hand because it requires you to add to every method that can modify object state to check whether the object state is actually being modified. When
                                    you consider all the <span class="EmphasisFontCategoryNonProportional">null</span> checks that have to be made and the checks to see whether the value is actually changing, you are looking at around eight lines of code
                                    per method. You could refactor this into a single method, but you still have to call this method every time you need to perform the check. Spread this across a typical application with many classes that require modification
                                    checks, and you have a disaster waiting to happen.</div>
                                <div class="Para" id="Par286">This is clearly a place where introductions will help. We don’t want to have each class that requires modification checks inherit from some base implementation, losing its only chance for inheritance as a result, nor do
                                    we really want to be adding checking code to each and every state-changing method. Using introductions, we can provide a flexible solution to the modification detection problem without having to write a bunch of repetitive,
                                    error-prone code.</div>
                                <div class="Para" id="Par287">In this example, we are going to build a full modification check framework using introductions. The modification check logic is encapsulated by the <span class="EmphasisFontCategoryNonProportional">IsModified</span> interface,
                                    an implementation of which will be introduced into the appropriate objects, along with interception logic to perform modification checks automatically. For the purposes of this example, we use JavaBeans conventions,
                                    in that we consider a modification to be any call to a setter method. Of course, we don’t just treat all calls to a setter method as a modification; we check to see whether the value being passed to the setter is different
                                    from the one currently stored in the object. The only flaw with this solution is that setting an object back to its original state will still reflect a modification if any one of the values on the object has changed.
                                    For example, you have a <span class="EmphasisFontCategoryNonProportional">Contact</span> object with the <span class="EmphasisFontCategoryNonProportional">firstName</span> attribute. Let’s say that during processing,
                                    the <span class="EmphasisFontCategoryNonProportional">firstName</span> attribute was changed from <span class="EmphasisFontCategoryNonProportional">Peter</span> to <span class="EmphasisFontCategoryNonProportional">John</span>.
                                    As a result, the object was marked as modified. However, it will still be marked as modified, even if the value is then changed back from <span class="EmphasisFontCategoryNonProportional">John</span> to its original
                                    value <span class="EmphasisFontCategoryNonProportional">Peter</span> in later processing. One way to keep track of such changes is to store the full history of changes in the object’s entire life cycle. However, the
                                    implementation here is nontrivial and suffices for most requirements. Implementing the more complete solution would result in an overly complex <span id="ITerm140">example          </span> <span id="ITerm141">                                              </span>.</div>
                                <div class="Section3 RenderAsSection3" id="Sec45">
                                    <h4 class="Heading">Using the IsModified Interface</h4>
                                    <div class="Para" id="Par288">Central to the modification check solution is the <span id="ITerm142">                  <span class="EmphasisFontCategoryNonProportional">IsModified</span> </span> <span id="ITerm143">                                                    </span>                                        interface, which the fictional application uses to make intelligent decisions about object persistence. We do not cover how the application would use <span class="EmphasisFontCategoryNonProportional">IsModified</span>;
                                        instead, we will focus on the implementation of the introduction. The following code snippet shows the <span class="EmphasisFontCategoryNonProportional">IsModified</span> interface:</div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5.introduction</span>;
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">IsModified</span> {
    <span style="color:#00f;font-weight:700">boolean</span> <span style="color:#0000a2;font-weight:700">isModified</span>();
}
</pre>
                                    <div class="Para ParaOneEmphasisChild" id="Par290">There’s nothing special here—just a single method, <span class="EmphasisFontCategoryNonProportional">isModified()</span>, indicating whether an object has been modified.</div>
                            </div>
                            <div class="Section3 RenderAsSection3" id="Sec46">
                                <h4 class="Heading">Creating a Mixin</h4>
                                <div class="Para" id="Par291">The next step is to create the code that implements <span class="EmphasisFontCategoryNonProportional">IsModified</span> and that is introduced to the objects; this is referred to as a <span id="ITerm144">                  <span class="EmphasisTypeItalic">mixin</span>                                    </span> <span id="ITerm145">                                                    </span>. As we mentioned earlier, it is much simpler to create mixins by subclassing <span class="EmphasisFontCategoryNonProportional">DelegatingIntroductionInterceptor</span>                                    than to create one by directly implementing the <span class="EmphasisFontCategoryNonProportional">IntroductionInterceptor</span> interface. The mixin class, <span class="EmphasisFontCategoryNonProportional">IsModifiedMixin</span>,
                                    subclasses <span class="EmphasisFontCategoryNonProportional">DelegatingIntroductionInterceptor</span> and also implements the <span class="EmphasisFontCategoryNonProportional">IsModified</span> interface. This is shown
                                    here:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5.introduction</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.lang.reflect.Method</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.HashMap</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Map</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.aopalliance.intercept.MethodInvocation</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.support.DelegatingIntroductionInterceptor</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">IsModifiedMixin</span> <span style="color:#00f;font-weight:700">extends</span> <span style="font-style:italic">DelegatingIntroductionInterceptor</span>
        <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">IsModified</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">boolean</span> isModified <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">false</span>;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Map&lt;<span style="color:#00f;font-weight:700">Method</span>, <span style="color:#00f;font-weight:700">Method</span>&gt;</span> methodCache <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HashMap&lt;&gt;</span>();

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">boolean</span> <span style="color:#0000a2;font-weight:700">isModified</span>() {
        <span style="color:#00f;font-weight:700">return</span> isModified;
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Object</span> <span style="color:#0000a2;font-weight:700">invoke</span>(<span style="color:#00f;font-weight:700">MethodInvocation</span> <span style="font-style:italic">invocation</span>) <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Throwable</span> {
        <span style="color:#00f;font-weight:700">if</span> (<span style="color:#00f;font-weight:700">!</span>isModified) {
            <span style="color:#00f;font-weight:700">if</span> ((invocation<span style="color:#00f;font-weight:700">.</span>getMethod()<span style="color:#00f;font-weight:700">.</span>getName()<span style="color:#00f;font-weight:700">.</span>startsWith(<span style="color:#036a07">set</span>))
                    <span style="color:#00f;font-weight:700">&amp;&amp;</span> (invocation<span style="color:#00f;font-weight:700">.</span>getArguments()<span style="color:#00f;font-weight:700">.</span>length <span style="color:#00f;font-weight:700">==</span> <span style="color:#0000cd">1</span>)) {
                <span style="color:#00f;font-weight:700">Method</span> getter <span style="color:#00f;font-weight:700">=</span> getGetter(invocation<span style="color:#00f;font-weight:700">.</span>getMethod());
                <span style="color:#00f;font-weight:700">if</span> (getter <span style="color:#00f;font-weight:700">!=</span> <span style="color:#585cf6;font-weight:700">null</span>) {
                    <span style="color:#00f;font-weight:700">Object</span> newVal <span style="color:#00f;font-weight:700">=</span> invocation<span style="color:#00f;font-weight:700">.</span>getArguments() <span style="color:#0000cd">0</span>;
                    <span style="color:#00f;font-weight:700">Object</span> oldVal <span style="color:#00f;font-weight:700">=</span> getter<span style="color:#00f;font-weight:700">.</span>invoke(invocation<span style="color:#00f;font-weight:700">.</span>getThis(), <span style="color:#585cf6;font-weight:700">null</span>);
                    <span style="color:#00f;font-weight:700">if</span> ((newVal <span style="color:#00f;font-weight:700">==</span> <span style="color:#585cf6;font-weight:700">null</span>) <span style="color:#00f;font-weight:700">&amp;&amp;</span> (oldVal <span style="color:#00f;font-weight:700">==</span> <span style="color:#585cf6;font-weight:700">null</span>)) {
                        isModified <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">false</span>;
                    } <span style="color:#00f;font-weight:700">else</span> <span style="color:#00f;font-weight:700">if</span> ((newVal <span style="color:#00f;font-weight:700">==</span> <span style="color:#585cf6;font-weight:700">null</span>) <span style="color:#00f;font-weight:700">&amp;&amp;</span> (oldVal <span style="color:#00f;font-weight:700">!=</span> <span style="color:#585cf6;font-weight:700">null</span>)) {
                        isModified <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>;
                    } <span style="color:#00f;font-weight:700">else</span> <span style="color:#00f;font-weight:700">if</span> ((newVal <span style="color:#00f;font-weight:700">!=</span> <span style="color:#585cf6;font-weight:700">null</span>) <span style="color:#00f;font-weight:700">&amp;&amp;</span> (oldVal <span style="color:#00f;font-weight:700">==</span> <span style="color:#585cf6;font-weight:700">null</span>)) {
                        isModified <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>;
                    } <span style="color:#00f;font-weight:700">else</span> {
                        isModified <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">!</span>newVal<span style="color:#00f;font-weight:700">.</span>equals(oldVal);
                    }
                }
            }
        }
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">super</span><span style="color:#00f;font-weight:700">.</span>invoke(invocation);
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Method</span> <span style="color:#0000a2;font-weight:700">getGetter</span>(<span style="color:#00f;font-weight:700">Method</span> <span style="font-style:italic">setter</span>) {
        <span style="color:#00f;font-weight:700">Method</span> getter <span style="color:#00f;font-weight:700">=</span> methodCache<span style="color:#00f;font-weight:700">.</span>get(setter);
        <span style="color:#00f;font-weight:700">if</span> (getter <span style="color:#00f;font-weight:700">!=</span> <span style="color:#585cf6;font-weight:700">null</span>) {
            <span style="color:#00f;font-weight:700">return</span> getter;
        }
        <span style="color:#00f;font-weight:700">String</span> getterName <span style="color:#00f;font-weight:700">=</span> setter<span style="color:#00f;font-weight:700">.</span>getName()<span style="color:#00f;font-weight:700">.</span>replaceFirst(<span style="color:#036a07">set</span>, <span style="color:#036a07">get</span>);
        <span style="color:#00f;font-weight:700">try</span> {
            getter <span style="color:#00f;font-weight:700">=</span> setter<span style="color:#00f;font-weight:700">.</span>getDeclaringClass()<span style="color:#00f;font-weight:700">.</span>getMethod(getterName, <span style="color:#585cf6;font-weight:700">null</span>);
            <span style="color:#00f;font-weight:700">synchronized</span> (methodCache) {
                methodCache<span style="color:#00f;font-weight:700">.</span>put(setter, getter);
            }
            <span style="color:#00f;font-weight:700">return</span> getter;
        } <span style="color:#00f;font-weight:700">catch</span> (<span style="color:#00f;font-weight:700">NoSuchMethodException</span> ex) {
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#585cf6;font-weight:700">null</span>;
        }
    }
}
</pre>
                                <div class="Para" id="Par293">The first thing to notice here is the implementation of <span class="EmphasisFontCategoryNonProportional">IsModified</span>, which consists of the private modified field and the <span class="EmphasisFontCategoryNonProportional">isModified()</span>                                    method. This example highlights why you must have one mixin instance per advised object—the mixin introduces not only methods to the object but also state. If you share a single instance of this mixin across many objects,
                                    then you are also sharing the state, which means all objects show as modified the first time a single object becomes modified.</div>
                                <div class="Para" id="Par294">You do not actually have to implement the <span class="EmphasisFontCategoryNonProportional">invoke()</span> method for a mixin, but in this case, doing so allows us to detect automatically when a modification occurs. We
                                    start by performing the check only if the object is still unmodified; we do not need to check for modifications once we know that the object has been modified. Next, we check to see whether the method is a setter, and
                                    if it is, we retrieve the corresponding getter method. Note that we cache the getter/setter pairs for quicker future retrieval. Finally, we compare the value returned by the getter with that passed to the setter to
                                    determine whether a modification has occurred. Notice that we check for the different possible combinations of <span class="EmphasisFontCategoryNonProportional">null</span> and set the modifications appropriately. It
                                    is important to remember that when you are using <span class="EmphasisFontCategoryNonProportional">DelegatingIntroductionInterceptor</span>, you must call <span class="EmphasisFontCategoryNonProportional">super.invoke()</span>                                    when overriding <span class="EmphasisFontCategoryNonProportional">invoke()</span> because it is the <span class="EmphasisFontCategoryNonProportional">DelegatingIntroductionInterceptor</span> that dispatches the invocation
                                    to the correct location, either the advised object or the mixin itself.</div>
                                <div class="Para" id="Par295">You can implement as many interfaces as you like in your mixin, each of which is automatically introduced into the advised object.</div>
                            </div>
                            <div class="Section3 RenderAsSection3" id="Sec47">
                                <h4 class="Heading">Creating an Advisor</h4>
                                <div class="Para" id="Par296">The next step is to create an <span id="ITerm150">                  <span class="EmphasisFontCategoryNonProportional">Advisor</span> </span> to wrap the creation of the mixin class. This step is optional, but it does help
                                    ensure that a new instance of the mixin is being used for each advised object. The following code snippet shows the <span class="EmphasisFontCategoryNonProportional">IsModifiedAdvisor</span> class:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5.introduction</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.support.DefaultIntroductionAdvisor</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">IsModifiedAdvisor</span> <span style="color:#00f;font-weight:700">extends</span> <span style="font-style:italic">DefaultIntroductionAdvisor</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">IsModifiedAdvisor</span>() {
        <span style="color:#318495">super</span>(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">IsModifiedMixin</span>());
    }
}</pre>
                                <div class="Para" id="Par298">Notice that we have extended <span class="EmphasisFontCategoryNonProportional">DefaultIntroductionAdvisor</span> to create your <span class="EmphasisFontCategoryNonProportional">IsModifiedAdvisor</span>. The implementation
                                    of this advisor is trivial and self-explanatory.</div>
                            </div>
                            <div class="Section3 RenderAsSection3" id="Sec48">
                                <h4 class="Heading">Putting It All <span id="ITerm151">Together                          </span> </h4>
                                <div class="Para" id="Par299">Now that we have a mixin class and an <span class="EmphasisFontCategoryNonProportional">Advisor</span> class, we can test the modification check framework. The class that we are going to use is the <span class="EmphasisFontCategoryNonProportional">Contact</span>                                    class that was mentioned earlier, which is part of a <span class="EmphasisFontCategoryNonProportional">common</span> package. This class is often used as a dependency for projects in this book for reasons of reusability.
                                    The contents of this class are shown here:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.common</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Contact</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> name;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> phoneNumber;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> email;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getName</span>() {
        <span style="color:#00f;font-weight:700">return</span> name;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setName</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">name</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>name <span style="color:#00f;font-weight:700">=</span> name;
    }
    <span style="color:#06f;font-style:italic">// getters and setter for other fields</span>
        .<span style="color:#00f;font-weight:700">.</span>.
}
</pre>
                                <div class="Para ParaOneEmphasisChild" id="Par301">This bean has a set of properties, but only the <span class="EmphasisFontCategoryNonProportional">name</span> property for testing the modification check mixin. The following code snippet shows how to assemble the advised
                                    proxy and then tests the modification check code:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.common.Contact</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5.introduction.IsModified</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5.introduction.IsModifiedAdvisor</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.IntroductionAdvisor</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.framework.ProxyFactory</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">IntroductionDemo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">Contact</span> target <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Contact</span>();
        target<span style="color:#00f;font-weight:700">.</span>setName(<span style="color:#036a07">John Mayer</span>);
        <span style="color:#00f;font-weight:700">IntroductionAdvisor</span> advisor <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">IsModifiedAdvisor</span>();
        <span style="color:#00f;font-weight:700">ProxyFactory</span> pf <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ProxyFactory</span>();
        pf<span style="color:#00f;font-weight:700">.</span>setTarget(target);
        pf<span style="color:#00f;font-weight:700">.</span>addAdvisor(advisor);
        pf<span style="color:#00f;font-weight:700">.</span>setOptimize(<span style="color:#585cf6;font-weight:700">true</span>);
        <span style="color:#00f;font-weight:700">Contact</span> proxy <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">Contact</span>) pf<span style="color:#00f;font-weight:700">.</span>getProxy();
        <span style="color:#00f;font-weight:700">IsModified</span> proxyInterface <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">IsModified</span>) proxy;
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Is Contact?: </span> <span style="color:#00f;font-weight:700">+</span> (proxy <span style="color:#00f;font-weight:700">instanceof</span> <span style="color:#00f;font-weight:700">Contact</span>));
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Is IsModified?: </span> <span style="color:#00f;font-weight:700">+</span> (proxy <span style="color:#00f;font-weight:700">instanceof</span> <span style="color:#00f;font-weight:700">IsModified</span>));
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Has been modified?: </span> <span style="color:#00f;font-weight:700">+</span>
                proxyInterface<span style="color:#00f;font-weight:700">.</span>isModified());
        proxy<span style="color:#00f;font-weight:700">.</span>setName(<span style="color:#036a07">John Mayer</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Has been modified?: </span> <span style="color:#00f;font-weight:700">+</span>
                proxyInterface<span style="color:#00f;font-weight:700">.</span>isModified());
        proxy<span style="color:#00f;font-weight:700">.</span>setName(<span style="color:#036a07">Eric Clapton</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Has been modified?: </span> <span style="color:#00f;font-weight:700">+</span>
                proxyInterface<span style="color:#00f;font-weight:700">.</span>isModified());
    }
}
</pre>
                                <div class="Para" id="Par303">Notice that when we are creating the proxy, we set the <span class="EmphasisFontCategoryNonProportional">optimize</span> flag to <span class="EmphasisFontCategoryNonProportional">true</span> to force the use of the CGLIB
                                    proxy. The reason for this is that when you are using the JDK proxy to introduce a mixin, the resulting proxy will not be an instance of the object class (in this case <span class="EmphasisFontCategoryNonProportional">Contact</span>);
                                    the proxy implements only the mixin interfaces, not the original class. With the CGLIB proxy, the original class is implemented by the proxy along with the mixin interfaces.</div>
                                <div class="Para" id="Par304">Notice in the code that we test first to see whether the proxy is an instance of <span class="EmphasisFontCategoryNonProportional">Contact</span> and then to see whether it is an instance of <span class="EmphasisFontCategoryNonProportional">IsModified</span>.
                                    Both tests return <span class="EmphasisFontCategoryNonProportional">true</span> when you are using the CGLIB proxy, but only the <span class="EmphasisFontCategoryNonProportional">IsModified</span> test returns
                                    <span class="EmphasisFontCategoryNonProportional">true</span> for the JDK proxy. Finally, we test the modification check code by first setting the <span class="EmphasisFontCategoryNonProportional">name</span> property to its current value and then to a new value, checking
                                        the value of the <span class="EmphasisFontCategoryNonProportional">isModified</span> flag each time. Running this example results in the following output:</div>
                                <div class="Para" id="Par305">
                                    <div class="ProgramCode" id="PC70">
                                        <div class="FixedLine">Is Contact?: true</div>
                                        <div class="FixedLine">Is IsModified?: true</div>
                                        <div class="FixedLine">Has been modified?: false</div>
                                        <div class="FixedLine">Has been modified?: false</div>
                                        <div class="FixedLine">Has been modified?: true</div>
                                    </div>
                                </div>
                                <div class="Para" id="Par306">As expected, both <span class="EmphasisFontCategoryNonProportional">instanceof</span> tests return <span class="EmphasisFontCategoryNonProportional">true</span>. Notice that the first call to <span class="EmphasisFontCategoryNonProportional">isModified()</span>,
                                    before any modification occurred, returns <span class="EmphasisFontCategoryNonProportional">false</span>. The next call, after we set the value of <span class="EmphasisFontCategoryNonProportional">name</span> to the
                                    same value, also returns <span class="EmphasisFontCategoryNonProportional">false</span>. For the final call, however, after we set the value of name to a new value, the <span class="EmphasisFontCategoryNonProportional">isModified()</span>                                    method returns <span class="EmphasisFontCategoryNonProportional">true</span>, indicating that the object has in fact been modified.</div>
                            </div>
                            </div>
                            </div>
                            <div class="Section1 RenderAsSection1" id="Sec49">
                                <h2 class="Heading">Introduction Summary</h2>
                                <div class="Para ParaOneEmphasisChild" id="Par307">Introductions are one of the most powerful features of Spring AOP; they allow you not only to extend the functionality of existing methods but to extend the set of interfaces and object implementations dynamically. Using
                                    introductions is the perfect way to implement crosscutting logic that your application interacts with through well-defined interfaces. In general, this is the kind of logic that you want to apply declaratively rather
                                    than programmatically. By using <span class="EmphasisFontCategoryNonProportional">IsModifiedMixin</span> defined in this example and the framework services discussed in the next section, we can declaratively define
                                    which objects are capable of modification checks, without needing to modify the implementations of those objects.</div>
                                <div class="Para" id="Par308">Obviously, because introductions work via proxies, they add a certain amount of overhead. All methods on the proxy are considered advised since pointcuts cannot be used in conjunction with introductions. However, in the
                                    case of many of the services that you can implement by using introductions such as the object modification check, this performance overhead is a small price to pay for the reduction in code required to implement the
                                    service, as well as the increase in stability and maintainability that comes from fully centralizing the service logic.</div>
                            </div>
                            <div class="Section1 RenderAsSection1" id="Sec50">
                                <h2 class="Heading">Framework Services for AOP</h2>
                                <div class="Para" id="Par309">Up to now, we have had to write a lot of code to advise objects and generate the proxies for them. Although this in itself is not a huge problem, it does mean that all advice configuration is hard-coded into your application,
                                    removing some of the benefits of being able to advise a method implementation transparently. Thankfully, Spring provides additional framework services that allow you to create an advised proxy in your application configuration
                                    and then inject this proxy into a target bean just like any other dependencies.</div>
                                <div class="Para" id="Par310">Using the declarative approach to AOP configuration is preferable to the manual, programmatic mechanism. When you use the declarative mechanism, not only do you externalize the configuration of advice but you also reduce
                                    the chance of coding errors. You can also take advantage of DI and AOP combined to enable AOP so that it can be used in a completely transparent environment.</div>
                                <div class="Section2 RenderAsSection2" id="Sec51">
                                    <h3 class="Heading">Configuring AOP Declaratively</h3>
                                    <div class="Para" id="Par311">When using <span id="ITerm153">declarative configuration                      </span> of Spring AOP, three options exist.
                                        <div class="UnorderedList">
                                            <ul class="UnorderedListMarkBullet">
                                                <li>
                                                    <div class="Para" id="Par312"> <span class="EmphasisTypeItalic">Using ProxyFactoryBean</span>: In Spring AOP, <span class="EmphasisFontCategoryNonProportional">ProxyFactoryBean</span> provides a declarative way to configure Spring’s
                                                        <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> (and hence the underlying <span class="EmphasisFontCategoryNonProportional">BeanFactory</span>) when creating AOP proxies
                                                        based on defined Spring beans.</div>
                                                </li>
                                                <li>
                                                    <div class="Para" id="Par313"> <span class="EmphasisTypeItalic">Using the Spring aop namespace</span>: Introduced in Spring 2.0, the <span class="EmphasisFontCategoryNonProportional">aop</span> namespace provides a simplified way
                                                        (when compared to <span class="EmphasisFontCategoryNonProportional">ProxyFactoryBean</span>) to define aspects and their DI requirements in Spring applications. However, the <span class="EmphasisFontCategoryNonProportional">aop</span>                                                        namespace also uses <span class="EmphasisFontCategoryNonProportional">ProxyFactoryBean</span> behind the scenes.</div>
                                                </li>
                                                <li>
                                                    <div class="Para" id="Par314"> <span class="EmphasisTypeItalic">Using @AspectJ-style annotations</span>: Besides the XML-based <span class="EmphasisFontCategoryNonProportional">aop</span> namespace, you can use the <span class="EmphasisFontCategoryNonProportional">@AspectJ-</span>style
                                                        annotations within your classes for configuring Spring AOP. Although the syntax it uses is based on AspectJ and you need to include some AspectJ libraries when using this option, Spring still uses
                                                        the proxy mechanism (that is, creates proxied objects for the targets) when bootstrapping <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>.</div>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="Section2 RenderAsSection2" id="Sec52">
                                    <h3 class="Heading">Using ProxyFactoryBean</h3>
                                    <div class="Para" id="Par315">The <span class="EmphasisFontCategoryNonProportional">ProxyFactoryBean</span> class is an implementation of <span class="EmphasisFontCategoryNonProportional">FactoryBean</span> that allows you to specify a bean to target,
                                        and it provides a set of advice and advisors for that bean that are eventually merged into an AOP proxy. <span class="EmphasisFontCategoryNonProportional">ProxyFactoryBean</span> is used to apply interceptor logic
                                        to an existing target bean in a way that when methods on that bean are invoked, the interceptors are executed before and after that method call. Because you can use both advisor and advice with <span class="EmphasisFontCategoryNonProportional">ProxyFactoryBean</span>,
                                        you can configure not only the advice declaratively but the pointcuts as well.</div>
                                    <div class="Para" id="Par316"> <span class="EmphasisFontCategoryNonProportional">ProxyFactoryBean</span> shares a common interface (the <span class="EmphasisFontCategoryNonProportional">org.springframework.aop.framework.Advised</span> interface)
                                        with <span class="EmphasisFontCategoryNonProportional">ProxyFactory</span> (both classes extend the <span class="EmphasisFontCategoryNonProportional">org.springframework.aop.framework.AdvisedSupport</span> class
                                        indirectly, which implements the <span class="EmphasisFontCategoryNonProportional">Advised</span> interface), and as a result, it exposes many of the same flags such as <span class="EmphasisFontCategoryNonProportional">frozen</span>,
                                        <span class="EmphasisFontCategoryNonProportional">optimize</span>, and <span class="EmphasisFontCategoryNonProportional">exposeProxy</span>. The values for these flags are passed directly to the underlying
                                        <span class="EmphasisFontCategoryNonProportional">ProxyFactory</span>, which allows you to configure the factory declaratively as well.</div>
                                    <div class="Section3 RenderAsSection3" id="Sec53">
                                        <h4 class="Heading">ProxyFactoryBean in Action</h4>
                                        <div class="Para" id="Par317">Using <span class="EmphasisFontCategoryNonProportional">ProxyFactoryBean</span> is simple. You define a bean that will be the target bean, and then using <span class="EmphasisFontCategoryNonProportional">ProxyFactoryBean</span>,
                                            you define the bean that your application will access, using the target bean as the proxy target. Where possible, define the target bean as an anonymous bean inside the proxy bean declaration. This prevents
                                            your application from accidentally accessing the unadvised bean. However, in some cases, such as the sample we are about to show you, you may want to create more than one proxy for the same bean, so you should
                                            use a normal top-level bean for this case.</div>
                                        <div class="Para" id="Par318">For the following example, imagine this scenario: you have a singer working together with a documentarist to produce a documentary of a tour. In this case, <span class="EmphasisFontCategoryNonProportional">Documentarist</span>                                            has a dependency of the <span class="EmphasisFontCategoryNonProportional">Singer</span> implementation. The <span class="EmphasisFontCategoryNonProportional">Singer</span> <span id="ITerm154">implementation                          </span>                                            that we will use here is the previously introduced <span class="EmphasisFontCategoryNonProportional">GrammyGuitarist</span>. The contents are shown again here:</div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.common.Guitar</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.common.Singer</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">GrammyGuitarist</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Singer</span> {
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">sing</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">&quot;sing: Gravity is working against me<span style="color:#26b31a">\n</span>&quot;</span> <span style="color:#00f;font-weight:700">+</span>
                <span style="color:#036a07">And gravity wants to bring me down</span>);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">sing</span>(<span style="color:#00f;font-weight:700">Guitar</span> <span style="font-style:italic">guitar</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">play: </span> <span style="color:#00f;font-weight:700">+</span> guitar<span style="color:#00f;font-weight:700">.</span>play());
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">rest</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">zzz</span>);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">talk</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">talk</span>);
    }
}
</pre>
                                        <div class="Para ParaOneEmphasisChild" id="Par320">The <span class="EmphasisFontCategoryNonProportional">Documentarist</span> class that will basically tell the singer what to do while filming the documentary is shown here:</div>
                                        <div class="Para" id="Par321">
                                            <div class="ProgramCode" id="PC72">
                                                <div class="LineGroup">
                                                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Documentarist</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">GrammyGuitarist</span> guitarist;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">execute</span>() {
        guitarist<span style="color:#00f;font-weight:700">.</span>sing();
        guitarist<span style="color:#00f;font-weight:700">.</span>talk();
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setDep</span>(<span style="color:#00f;font-weight:700">GrammyGuitarist</span> <span style="font-style:italic">guitarist</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>guitarist <span style="color:#00f;font-weight:700">=</span> guitarist;
    }
}
</pre></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="Para ParaOneEmphasisChild" id="Par322">For this example, we are going to create two proxies for a single <span class="EmphasisFontCategoryNonProportional">GrammySinger</span> instance, both with the same basic advice shown here:</div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.aspectj.lang.JoinPoint</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AuditAdvice</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">simpleBeforeAdvice</span>(<span style="color:#00f;font-weight:700">JoinPoint</span> <span style="font-style:italic">joinPoint</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Executing: </span> <span style="color:#00f;font-weight:700">+</span>
                joinPoint<span style="color:#00f;font-weight:700">.</span>getSignature()<span style="color:#00f;font-weight:700">.</span>getDeclaringTypeName() <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07"> </span>
                <span style="color:#00f;font-weight:700">+</span> joinPoint<span style="color:#00f;font-weight:700">.</span>getSignature()<span style="color:#00f;font-weight:700">.</span>getName());
    }
}
</pre>
                                        <div class="Para" id="Par324">The first proxy will just advise the target by using the advice directly; thus, all methods will be advised. For the second proxy, we will configure <span class="EmphasisFontCategoryNonProportional">AspectJExpressionPointcut</span>                                            and <span class="EmphasisFontCategoryNonProportional">DefaultPointcutAdvisor</span> so that only the <span class="EmphasisFontCategoryNonProportional">sing()</span> method of the <span class="EmphasisFontCategoryNonProportional">GrammySinger</span>                                            class is advised. To test the advice, we will create two bean definitions of type <span class="EmphasisFontCategoryNonProportional">Documentarist</span>, each of which will be injected with a different proxy.
                                            Then we will invoke the <span class="EmphasisFontCategoryNonProportional">execute()</span> method on each of these beans and observe what happens when the advised methods on the dependency are invoked. Figure
                                            <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Chapter.html#Fig10">5-10</a></span> shows the <span id="ITerm156">configuration                          </span>                                            for this example (<span class="EmphasisFontCategoryNonProportional">app-context-xml.xml</span>). We used an image to de
                                            <div class="Figure" id="Fig10">
                                                <div class="MediaObject" id="MO10"><img alt="A315511_5_En_5_Fig10_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Fig10_HTML.jpg" height="555" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Fig10_HTML.jpg" width="570"/></div>
                                                <div class="Caption" xml:lang="en">
                                                    <div class="CaptionContent"><span class="CaptionNumber">Figure 5-10.</span>
                                                        <div class="SimplePara">Declarative AOP <span id="ITerm157">configuration                                          </span> </div>
                                                    </div>
                                            </div>
                                        </div>pict this configuration because it might look a little confusing and we wanted to make sure it is easy to see where each bean is injected. In the example, we are simply setting the properties that we set in code
                                        using Spring’s DI capabilities. The only points of interest are that we use an anonymous bean for the pointcut, and we use the <span class="EmphasisFontCategoryNonProportional">ProxyFactoryBean</span> class. We
                                        prefer to use anonymous beans for pointcuts when they are not being shared because it keeps the set of beans that are directly accessible as small and as relevant to the application as possible. The important point
                                        to realize when you are using <span class="EmphasisFontCategoryNonProportional">ProxyFactoryBean</span> is that the <span class="EmphasisFontCategoryNonProportional">ProxyFactoryBean</span> declaration is the one
                                        to expose to your application and the one to use when you are fulfilling dependencies. The underlying target bean declaration is not advised, so you should use this bean only when you want to bypass the AOP framework,
                                        although in general, your application should not be aware of the AOP framework and thus should not want to bypass it. For this reason, you should use anonymous beans wherever possible to avoid accidental access
                                        from the application.</div>
                                    <div class="Para" id="Par326">The following code snippet shows a simple class that obtains the two <span class="EmphasisFontCategoryNonProportional">Documentarist</span> instances from <span id="ITerm158">                  <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>                                        </span> and then runs the <span class="EmphasisFontCategoryNonProportional">execute()</span> method for each one:</div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">ProxyFactoryBeanDemo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">spring/app-context-xml.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">Documentarist</span> documentaristOne <span style="color:#00f;font-weight:700">=</span>
                ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">documentaristOne</span>, <span style="color:#00f;font-weight:700">Documentarist</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">Documentarist</span> documentaristTwo <span style="color:#00f;font-weight:700">=</span>
                ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">documentaristTwo</span>, <span style="color:#00f;font-weight:700">Documentarist</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Documentarist One &gt;&gt;</span>);
        documentaristOne<span style="color:#00f;font-weight:700">.</span>execute();
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">&quot;<span style="color:#26b31a">\n</span>Documentarist Two &gt;&gt; &quot;</span>);
        documentaristTwo<span style="color:#00f;font-weight:700">.</span>execute();
    }
}
</pre>
                                    <div class="Para" id="Par328">Running this example produces the following output:</div>
                                    <div class="Para" id="Par329">
                                        <div class="ProgramCode" id="PC75">
                                            <div class="LineGroup">
                                                <div class="FixedLine">Documentarist One &gt;&gt;</div>
                                                <div class="FixedLine">Executing: public void com.apress.prospring5.ch5.GrammyGuitarist.sing()</div>
                                                <div class="FixedLine">sing: Gravity is working against me</div>
                                                <div class="FixedLine">And gravity wants to bring me down</div>
                                                <div class="FixedLine">Executing: public void com.apress.prospring5.ch5.GrammyGuitarist.talk()</div>
                                                <div class="FixedLine">talk</div>
                                            </div>
                                            <div class="LineGroup">
                                                <div class="FixedLine">Documentarist Two &gt;&gt;</div>
                                                <div class="FixedLine">Executing: public void com.apress.prospring5.ch5.GrammyGuitarist.sing()</div>
                                                <div class="FixedLine">sing: Gravity is working against me</div>
                                                <div class="FixedLine">And gravity wants to bring me down</div>
                                                <div class="FixedLine">talk</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="Para" id="Par330">As expected, both the <span class="EmphasisFontCategoryNonProportional">sing()</span> and <span class="EmphasisFontCategoryNonProportional">talk()</span> methods in the first proxy are advised because no pointcut was
                                        used in its configuration. For the second proxy, however, only the <span class="EmphasisFontCategoryNonProportional">sing()</span> method was advised because of the pointcut used in the configuration.</div>
                                </div>
                                <div class="Section3 RenderAsSection3" id="Sec54">
                                    <h4 class="Heading">Using ProxyFactoryBean for <span id="ITerm160">Introductions                          </span> </h4>
                                    <div class="Para" id="Par331">You are not limited in using the <span class="EmphasisFontCategoryNonProportional">ProxyFactoryBean</span> class for just advising an object but also for introducing mixins to your objects. Remember from the earlier
                                        discussion on introductions that you must use an <span class="EmphasisFontCategoryNonProportional">IntroductionAdvisor</span> to add an introduction; you cannot add an introduction directly. The same rule applies
                                        when you are using <span class="EmphasisFontCategoryNonProportional">ProxyFactoryBean</span> with introductions. When you are using <span class="EmphasisFontCategoryNonProportional">ProxyFactoryBean</span>, it becomes
                                        much easier to configure your proxies if you created a custom <span class="EmphasisFontCategoryNonProportional">Advisor</span> for your mixin. The following configuration snippet shows a sample configuration for
                                        the <span class="EmphasisFontCategoryNonProportional">IsModifiedMixin</span> introduction from earlier in the chapter (<span class="EmphasisFontCategoryNonProportional">app-context-xml.xml</span>):</div>
                                    <pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">guitarist</span>
          <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch2.common.Contact</span>
          <span style="font-style:italic">p</span>:name=<span style="color:#036a07">John Mayer</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">advisor</span>
               <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch5.introduction.IsModifiedAdvisor</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">util</span><span style="font-weight:700">:</span><span style="font-weight:700">list</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">interceptorAdvisorNames</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">value</span>&gt;</span>advisor<span style="color:#1c02ff">&lt;/<span style="font-weight:700">value</span>&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">util</span><span style="font-weight:700">:</span><span style="font-weight:700">list</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">bean</span>
          <span style="font-style:italic">class</span>=<span style="color:#036a07">org.springframework.aop.framework.ProxyFactoryBean</span>
          <span style="font-style:italic">p</span>:target-ref=<span style="color:#036a07">guitarist</span>
          <span style="font-style:italic">p</span>:interceptorNames-ref=<span style="color:#036a07">interceptorAdvisorNames</span>
          <span style="font-style:italic">p</span>:proxyTargetClass=<span style="color:#036a07">true</span>&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">bean</span>&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
                                    <div class="Para" id="Par333">As you can see from the configuration, we use the <span class="EmphasisFontCategoryNonProportional">IsModifiedAdvisor</span> class as the advisor for <span class="EmphasisFontCategoryNonProportional">ProxyFactoryBean</span>,
                                        and because we do not need to create another proxy of the same target object, we use an anonymous declaration for the target bean. The following code snippet shows a modification of the previous introduction example
                                        that obtains the proxy from <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>:</div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.common.Contact</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5.introduction.IsModified</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">IntroductionConfigDemo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-xml.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">Contact</span> bean <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">Contact</span>) ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">bean</span>);
        <span style="color:#00f;font-weight:700">IsModified</span> mod <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">IsModified</span>) bean;
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Is Contact?: </span> <span style="color:#00f;font-weight:700">+</span> (bean <span style="color:#00f;font-weight:700">instanceof</span> <span style="color:#00f;font-weight:700">Contact</span>));
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Is IsModified?: </span> <span style="color:#00f;font-weight:700">+</span> (bean <span style="color:#00f;font-weight:700">instanceof</span> <span style="color:#00f;font-weight:700">IsModified</span>));
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Has been modified?: </span> <span style="color:#00f;font-weight:700">+</span> mod<span style="color:#00f;font-weight:700">.</span>isModified());
        bean<span style="color:#00f;font-weight:700">.</span>setName(<span style="color:#036a07">John Mayer</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Has been modified?: </span> <span style="color:#00f;font-weight:700">+</span> mod<span style="color:#00f;font-weight:700">.</span>isModified());
        bean<span style="color:#00f;font-weight:700">.</span>setName(<span style="color:#036a07">Eric Clapton</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Has been modified?: </span> <span style="color:#00f;font-weight:700">+</span> mod<span style="color:#00f;font-weight:700">.</span>isModified());
    }
}
</pre>
                                    <div class="Para ParaOneEmphasisChild" id="Par335">Running this example yields exactly the same output as the previous introduction example, but this time the proxy is obtained from <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> and no configuration
                                        is present in the application code.</div>
                                    <div class="Para" id="Par336">And since we’ve already covered Java configuration, the XML configuration depicted previously can be replaced with a configuration class like the one shown here:</div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5.config</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.common.Contact</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5.introduction.IsModifiedAdvisor</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.Advisor</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.aop.framework.ProxyFactoryBean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Bean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Configuration</span>;

@<span style="color:#00f;font-weight:700">Configuration</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AppConfig</span> {
    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Contact</span> <span style="color:#0000a2;font-weight:700">guitarist</span>() {
        <span style="color:#00f;font-weight:700">Contact</span> guitarist <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Contact</span>();
        guitarist<span style="color:#00f;font-weight:700">.</span>setName(<span style="color:#036a07">John Mayer</span>);
        <span style="color:#00f;font-weight:700">return</span> guitarist;
    }

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Advisor</span> <span style="color:#0000a2;font-weight:700">advisor</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">IsModifiedAdvisor</span>();
    }

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">ProxyFactoryBean</span> <span style="color:#0000a2;font-weight:700">bean</span>() {
        <span style="color:#00f;font-weight:700">ProxyFactoryBean</span> proxyFactoryBean <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ProxyFactoryBean</span>();
        proxyFactoryBean<span style="color:#00f;font-weight:700">.</span>setTarget(guitarist());
        proxyFactoryBean<span style="color:#00f;font-weight:700">.</span>setProxyTargetClass(<span style="color:#585cf6;font-weight:700">true</span>);
        proxyFactoryBean<span style="color:#00f;font-weight:700">.</span>addAdvisor(advisor());
        <span style="color:#00f;font-weight:700">return</span> proxyFactoryBean;
    }
}
</pre>
                                    <div class="Para" id="Par338">To test that the previous class actually works, in the <span class="EmphasisFontCategoryNonProportional">main()</span> method of class <span class="EmphasisFontCategoryNonProportional">IntroductionConfigDemo</span>,
                                        just replace the lines that initialize the context with the following:</div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
     <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">AppConfig</span><span style="color:#00f;font-weight:700">.</span>class);
</pre>
                                    <div class="Para" id="Par340">The difference in the configuration class is that there is no need to refer to the <span class="EmphasisFontCategoryNonProportional">advisor</span> bean by name or add it in a list to provide it as an argument to
                                        <span class="EmphasisFontCategoryNonProportional">ProxyFactoryBean</span> because <span class="EmphasisFontCategoryNonProportional">addAdvisor(..)</span> can be called directly and the <span class="EmphasisFontCategoryNonProportional">advisor</span> bean can be
                                            provided as the argument. This obviously simplifies the configuration.</div>
                                </div>
                                <div class="Section3 RenderAsSection3" id="Sec55">
                                    <h4 class="Heading">ProxyFactoryBean Summary</h4>
                                    <div class="Para ParaOneEmphasisChild" id="Par341">When you use <span class="EmphasisFontCategoryNonProportional">ProxyFactoryBean</span>, you can configure AOP proxies that provide all the flexibility of the programmatic method without needing to couple your application
                                        to the AOP configuration. Unless you need to perform decisions at runtime as to how your proxies should be created, it is best to use the declarative method of proxy configuration over the programmatic method. Let’s
                                        move on so you can see the other two options for declarative Spring AOP, which are both preferred options for applications based on Spring 2.0 or newer with JDK 5 or newer.</div>
                                </div>
                            </div>
                            <div class="Section2 RenderAsSection2" id="Sec56">
                                <h3 class="Heading">Using the aop Namespace</h3>
                                <div class="Para" id="Par342">The <span id="ITerm163">            <span class="EmphasisFontCategoryNonProportional">aop</span> namespace </span> provides a greatly simplified syntax for declarative Spring AOP configurations. To show you how it works,
                                    let’s reuse the previous <span class="EmphasisFontCategoryNonProportional">ProxyFactoryBean</span> example with a slightly modified version in order to demonstrate its usage. The <span class="EmphasisFontCategoryNonProportional">GrammyGuitarist</span>                                    class from the previous example is still used, but <span class="EmphasisFontCategoryNonProportional">Documentarist</span> will be extended to call the <span class="EmphasisFontCategoryNonProportional">sing()</span>                                    method with a <span class="EmphasisFontCategoryNonProportional">Guitar</span> argument.</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.common.Guitar</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">NewDocumentarist</span> <span style="color:#00f;font-weight:700">extends</span> <span style="font-style:italic">Documentarist</span> {
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">execute</span>() {
        guitarist<span style="color:#00f;font-weight:700">.</span>sing();
        guitarist<span style="color:#00f;font-weight:700">.</span>sing(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Guitar</span>());
        guitarist<span style="color:#00f;font-weight:700">.</span>talk();
    }
}
</pre>
                                <div class="Para" id="Par344">The <span id="ITerm164">advice class                      </span> changes to the following:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.aspectj.lang.JoinPoint</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SimpleAdvice</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">simpleBeforeAdvice</span>(<span style="color:#00f;font-weight:700">JoinPoint</span> <span style="font-style:italic">joinPoint</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Executing: </span> <span style="color:#00f;font-weight:700">+</span>
                joinPoint<span style="color:#00f;font-weight:700">.</span>getSignature()<span style="color:#00f;font-weight:700">.</span>getDeclaringTypeName() <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07"> </span>
                <span style="color:#00f;font-weight:700">+</span> joinPoint<span style="color:#00f;font-weight:700">.</span>getSignature()<span style="color:#00f;font-weight:700">.</span>getName());
    }
}
</pre>
                                <div class="Para" id="Par346">You will see that the advice class no longer needs to implement the <span id="ITerm165">                <span class="EmphasisFontCategoryNonProportional">MethodBeforeAdvice</span> </span> interface. Also, the before advice
                                    accepts the joinpoint as an argument but not the method, object, and arguments. Actually, for the advice class, this argument is optional, so you can leave the method with no argument. However, if in the advice you
                                    need to access the information of the joinpoint being advised (in this case, we want to dump the information of the calling type and method name), then we need to define the acceptance of the argument. When the argument
                                    is defined for the method, Spring will automatically pass the joinpoint into the method for your processing. Here is the Spring XML configuration with the <span class="EmphasisFontCategoryNonProportional">aop</span>                                    namespace from the <span class="EmphasisFontCategoryNonProportional">app-context-xml-01.xml</span> file:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#68685b">&lt;?<span style="color:#888">xml</span><span style="color:#888"> version</span>=<span style="color:#888">1.0</span><span style="color:#888"> encoding</span>=<span style="color:#888">UTF-8</span>?&gt;</span>
<span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> <span style="font-style:italic">xmlns</span>=<span style="color:#036a07">http://www.springframework.org/schema/beans</span>
      <span style="font-style:italic">xmlns</span>:xsi=<span style="color:#036a07">http://www.w3.org/2001/XMLSchema-instance</span>
       <span style="font-style:italic">xmlns</span>:p=<span style="color:#036a07">http://www.springframework.org/schema/p</span>
      <span style="font-style:italic">xmlns</span>:aop=<span style="color:#036a07">http://www.springframework.org/schema/aop</span>
      <span style="font-style:italic">xsi</span>:schemaLocation=<span style="color:#036a07">http://www.springframework.org/schema/beans
          http://www.springframework.org/schema/beans/spring-beans.xsd
          http://www.springframework.org/schema/aop
          http://www.springframework.org/schema/aop/spring-aop.xsd</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">aop</span><span style="font-weight:700">:</span><span style="font-weight:700">config</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">aop</span><span style="font-weight:700">:</span><span style="font-weight:700">pointcut</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">singExecution</span>
            <span style="font-style:italic">expression</span>=<span style="color:#036a07">execution(
  * com.apress.prospring5.ch5..sing*(com.apress.prospring5.ch2.common.Guitar)
)</span>/&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">aop</span><span style="font-weight:700">:</span><span style="font-weight:700">aspect</span> <span style="font-style:italic">ref</span>=<span style="color:#036a07">advice</span>&gt;</span>
            <span style="color:#1c02ff">&lt;<span style="font-weight:700">aop</span><span style="font-weight:700">:</span><span style="font-weight:700">before</span> <span style="font-style:italic">pointcut-ref</span>=<span style="color:#036a07">singExecution</span>
                   <span style="font-style:italic">method</span>=<span style="color:#036a07">simpleBeforeAdvice</span>/&gt;</span>
        <span style="color:#1c02ff">&lt;/<span style="font-weight:700">aop</span><span style="font-weight:700">:</span><span style="font-weight:700">aspect</span>&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">aop</span><span style="font-weight:700">:</span><span style="font-weight:700">config</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">advice</span>
          <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch5.SimpleAdvice</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">johnMayer</span>
          <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch5.GrammyGuitarist</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">documentarist</span>
          <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch5.NewDocumentarist</span>
          <span style="font-style:italic">p</span>:guitarist-ref=<span style="color:#036a07">johnMayer</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
                                <div class="Para" id="Par348">First, we need to declare the <span class="EmphasisFontCategoryNonProportional">aop</span> namespace in the <span class="EmphasisFontCategoryNonProportional">&lt;beans&gt;</span> tags. Second, all the Spring AOP configuration
                                    was put under the tag <span class="EmphasisFontCategoryNonProportional">&lt;aop:config&gt;</span>. Under <span class="EmphasisFontCategoryNonProportional">&lt;aop:config&gt;</span>, you can then define the pointcut,
                                    aspects, advisors, and so on, and reference other Spring beans as usual.</div>
                                <div class="Para ParaOneEmphasisChild" id="Par349">From the previous configuration, we defined a pointcut with the ID <span class="EmphasisFontCategoryNonProportional">singExecution</span>. The expression</div>
                                <div class="Para" id="Par350">
                                    <div class="ProgramCode" id="PC83">
                                        <div class="FixedLine">&quot;execution(*</div>
                                        <div class="FixedLine">   com.apress.prospring5.ch5..sing*(com.apress.prospring5.ch2.common.Guitar)</div>
                                        <div class="FixedLine">)&quot;</div>
                                    </div>
                                </div>
                                <div class="Para" id="Par351">means that we want to advise all methods with the prefix <span class="EmphasisFontCategoryNonProportional">sing</span>, and the classes are defined under the package <span class="EmphasisFontCategoryNonProportional">com.apress.prospring5.ch5</span>                                    (including all the subpackages). Also, the <span class="EmphasisFontCategoryNonProportional">sing()</span> method should receive one argument with the <span class="EmphasisFontCategoryNonProportional">Guitar</span>                                    type. Afterward, the aspect was declared by using the <span class="EmphasisFontCategoryNonProportional">&lt;aop:aspect&gt;</span> tag, and the advice class is referencing the Spring bean with the ID <span class="EmphasisFontCategoryNonProportional">advice</span>,
                                    which is the <span class="EmphasisFontCategoryNonProportional">SimpleAdvice</span> class. The <span class="EmphasisFontCategoryNonProportional">pointcut-ref</span> attribute is referencing the defined pointcut with
                                    the ID <span class="EmphasisFontCategoryNonProportional">singExecution</span>, and the before advice (declared by using the <span class="EmphasisFontCategoryNonProportional">&lt;aop:before&gt;</span> tag) is the method
                                    <span id="ITerm166">                <span class="EmphasisFontCategoryNonProportional">simpleBeforeAdvice</span> </span> <span class="EmphasisFontCategoryNonProportional">()</span> within the advice bean. To test the
                                    previous configuration, you can use the following class:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AopNamespaceDemo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-xml-01.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">NewDocumentarist</span> documentarist <span style="color:#00f;font-weight:700">=</span>
                ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">documentarist</span>, <span style="color:#00f;font-weight:700">NewDocumentarist</span><span style="color:#00f;font-weight:700">.</span>class);
        documentarist<span style="color:#00f;font-weight:700">.</span>execute();
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                                <div class="Para" id="Par353">In this example, we simply initialize <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> as usual, retrieve the bean, and call its <span class="EmphasisFontCategoryNonProportional">execute()</span>                                    method. Running the program will yield the following output:</div>
                                <div class="Para" id="Par354">
                                    <div class="ProgramCode" id="PC85">
                                        <div class="FixedLine">sing: Gravity is working against me</div>
                                        <div class="FixedLine">And gravity wants to bring me down</div>
                                        <div class="FixedLine">Executing: com.apress.prospring5.ch5.GrammyGuitarist sing</div>
                                        <div class="FixedLine">play: G C G C Am D7</div>
                                        <div class="FixedLine">talk</div>
                                    </div>
                                </div>
                                <div class="Para" id="Par355">As you can see, only the call to the <span class="EmphasisFontCategoryNonProportional">sing(..)</span> method with a <span class="EmphasisFontCategoryNonProportional">Guitar</span> argument was advised; the <span class="EmphasisFontCategoryNonProportional">sing()</span>                                    method with no argument and the <span class="EmphasisFontCategoryNonProportional">talk()</span> method were not. This exactly works as expected, and you can see the configuration was greatly simplified when compared
                                    to the <span class="EmphasisFontCategoryNonProportional">ProxyFactoryBean</span> configuration.</div>
                                <div class="Para" id="Par356">Let’s further revise the previous sample into a bit more complicated case. Suppose now we want to advise only those methods with Spring beans with an ID starting with <span class="EmphasisFontCategoryNonProportional">john</span>                                    and a parameter of type <span class="EmphasisFontCategoryNonProportional">Guitar</span> that has the <span class="EmphasisFontCategoryNonProportional">brand</span> property set to <span class="EmphasisFontCategoryNonProportional">Gibson</span>.</div>
                                <div class="Para" id="Par357">For this, first the <span class="EmphasisFontCategoryNonProportional">Guitar</span> class must be changed to add the <span class="EmphasisFontCategoryNonProportional">brand</span> property. We’ll make it nonmandatory and
                                    populate it with a default value, just to keep the previous examples working.</div>
                            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.common</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Guitar</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> brand <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07"> Martin</span>;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">play</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">G C G C Am D7</span>;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getBrand</span>() {
        <span style="color:#00f;font-weight:700">return</span> brand;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setBrand</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">brand</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>brand <span style="color:#00f;font-weight:700">=</span> brand;
    }
}
</pre>
                            <div class="Para" id="Par359">Then we need to make <span class="EmphasisFontCategoryNonProportional">NewDocumentarist</span> call the <span id="ITerm167">                <span class="EmphasisFontCategoryNonProportional">sing()</span> </span> method with
                                a special brand of guitar.</div>
                            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.common.Guitar</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">NewDocumentarist</span> <span style="color:#00f;font-weight:700">extends</span> <span style="font-style:italic">Documentarist</span> {
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">execute</span>() {
        guitarist<span style="color:#00f;font-weight:700">.</span>sing();
        <span style="color:#00f;font-weight:700">Guitar</span> guitar <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Guitar</span>();
        guitar<span style="color:#00f;font-weight:700">.</span>setBrand(<span style="color:#036a07">Gibson</span>);
        guitarist<span style="color:#00f;font-weight:700">.</span>sing(guitar);
        guitarist<span style="color:#00f;font-weight:700">.</span>talk();
    }
}
</pre>
                            <div class="Para" id="Par361">Now we need a new and more complex type of advice. The argument <span class="EmphasisFontCategoryNonProportional">guitar</span> was added into the signature of the before advice. Second, in the advice, we check and execute
                                the logic only when the argument’s <span class="EmphasisFontCategoryNonProportional">brand</span> property is equal to <span class="EmphasisFontCategoryNonProportional">Gibson</span>.</div>
                            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.common.Guitar</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.aspectj.lang.JoinPoint</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">ComplexAdvice</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">simpleBeforeAdvice</span>(<span style="color:#00f;font-weight:700">JoinPoint</span> <span style="font-style:italic">joinPoint</span>, <span style="color:#00f;font-weight:700">Guitar</span> <span style="font-style:italic">value</span>) {
        <span style="color:#00f;font-weight:700">if</span> (value<span style="color:#00f;font-weight:700">.</span>getBrand()<span style="color:#00f;font-weight:700">.</span>equals(<span style="color:#036a07">Gibson</span>)) {
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Executing: </span> <span style="color:#00f;font-weight:700">+</span>
                    joinPoint<span style="color:#00f;font-weight:700">.</span>getSignature()<span style="color:#00f;font-weight:700">.</span>getDeclaringTypeName() <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07"> </span>
                    <span style="color:#00f;font-weight:700">+</span> joinPoint<span style="color:#00f;font-weight:700">.</span>getSignature()<span style="color:#00f;font-weight:700">.</span>getName());
        }
    }
}
</pre>
                            <div class="Para" id="Par363">Also, the XML configuration needs to be revised because we need to use the new type of advice and update the pointcut expression. (You can find the full <span id="ITerm169">configuration                      </span> in
                                <span class="EmphasisFontCategoryNonProportional">app-context-xml-02.xml</span>, and except for the lines shown next, everything else is identical to the contents of <span class="EmphasisFontCategoryNonProportional">app-context-xml-01.xml</span>, so they won’t be depicted
                                    again here.)</div>
                            <pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ..&gt;</span>
...
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">advice</span>
          <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch5.ComplexAdvice</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">aop</span><span style="font-weight:700">:</span><span style="font-weight:700">config</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">aop</span><span style="font-weight:700">:</span><span style="font-weight:700">pointcut</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">singExecution</span>
            <span style="font-style:italic">expression</span>=<span style="color:#036a07">execution(* sing*(com.apress.prospring5.ch2.common.Guitar))
                and args(value) and bean(john*)</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
                            <div class="Para" id="Par365">Two more directives were added to the pointcut expression. First, <span class="EmphasisFontCategoryNonProportional">args(value)</span> instructs Spring to also pass the argument with the name <span class="EmphasisFontCategoryNonProportional">value</span>                                into the before advice. Second, the <span class="EmphasisFontCategoryNonProportional">bean(john*)</span> directive instructs Spring to advise only the beans with an ID that has <span class="EmphasisFontCategoryNonProportional">john</span>                                as the prefix. This is a powerful feature; if you have a well-defined structure of Spring beans naming, you can easily advise the objects you want. For example, you can have advice that applies to all DAO beans by using
                                <span class="EmphasisFontCategoryNonProportional">bean(*DAO*)</span> or all service layer beans using <span class="EmphasisFontCategoryNonProportional">bean(*Service*)</span>, instead of using the fully qualified class
                                name for matching. Running the same testing program with the new configuration file <span class="EmphasisFontCategoryNonProportional">app-context-xml02.xml</span> produces the following output:</div>
                            <div class="Para" id="Par366">
                                <div class="ProgramCode" id="PC90">
                                    <div class="FixedLine">sing: Gravity is working against me</div>
                                    <div class="FixedLine">And gravity wants to bring me down</div>
                                    <div class="FixedLine">Executing: com.apress.prospring5.ch5.GrammyGuitarist sing</div>
                                    <div class="FixedLine">play: G C G C Am D7</div>
                                    <div class="FixedLine">talk</div>
                                </div>
                            </div>
                            <div class="Para" id="Par367">You can see that only the <span class="EmphasisFontCategoryNonProportional">sing()</span> method with the <span class="EmphasisFontCategoryNonProportional">Guitar</span> argument and <span class="EmphasisFontCategoryNonProportional">brand</span>                                equal to <span class="EmphasisFontCategoryNonProportional">Gibson</span> was advised.</div>
                            <div class="Para" id="Par368">Let’s see one more example of using the <span class="EmphasisFontCategoryNonProportional">aop</span> namespace for the around advice. Instead of creating another class to implement the <span id="ITerm170">                <span class="EmphasisFontCategoryNonProportional">MethodInterceptor</span>                                </span> interface, we can simply add a new method to the <span class="EmphasisFontCategoryNonProportional">ComplexAdvice</span> class. The following code sample shows the new method named <span class="EmphasisFontCategoryNonProportional">simpleAroundAdvice()</span>                                in the revised <span class="EmphasisFontCategoryNonProportional">ComplexAdvice</span> class:</div>
                            <pre style="background:#fff;color:#000"><span style="color:#06f;font-style:italic">//ComplexAdvice.java</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Object</span> simpleAroundAdvice(<span style="color:#00f;font-weight:700">ProceedingJoinPoint</span> pjp,
      <span style="color:#00f;font-weight:700">Guitar</span> value) throws <span style="color:#00f;font-weight:700">Throwable</span> {
    <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Before execution: </span> <span style="color:#00f;font-weight:700">+</span>
        pjp<span style="color:#00f;font-weight:700">.</span>getSignature()<span style="color:#00f;font-weight:700">.</span>getDeclaringTypeName() <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07"> </span>
            <span style="color:#00f;font-weight:700">+</span> pjp<span style="color:#00f;font-weight:700">.</span>getSignature()<span style="color:#00f;font-weight:700">.</span>getName()
            <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07"> argument: </span> <span style="color:#00f;font-weight:700">+</span> value<span style="color:#00f;font-weight:700">.</span>getBrand());
        <span style="color:#00f;font-weight:700">Object</span> retVal <span style="color:#00f;font-weight:700">=</span> pjp<span style="color:#00f;font-weight:700">.</span>proceed();
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">After execution: </span> <span style="color:#00f;font-weight:700">+</span>
            pjp<span style="color:#00f;font-weight:700">.</span>getSignature()<span style="color:#00f;font-weight:700">.</span>getDeclaringTypeName() <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07"> </span>
                <span style="color:#00f;font-weight:700">+</span> pjp<span style="color:#00f;font-weight:700">.</span>getSignature()<span style="color:#00f;font-weight:700">.</span>getName()
                <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07"> argument: </span> <span style="color:#00f;font-weight:700">+</span> value<span style="color:#00f;font-weight:700">.</span>getBrand());
    <span style="color:#00f;font-weight:700">return</span> retVal;
}
</pre>
                            <div class="Para" id="Par370">The newly added <span class="EmphasisFontCategoryNonProportional">simpleAroundAdvice()</span> method needs to take at least one argument of type <span class="EmphasisFontCategoryNonProportional">ProceedingJoinPoint</span> so
                                that it can proceed with the invocation of the target object. We also add the <span class="EmphasisFontCategoryNonProportional">value</span> argument to display the value in the advice. The XML configuration for <span class="EmphasisFontCategoryNonProportional">&lt;aop:aspect&gt;</span>                                must be adapted to add the new advice. (You can find the full configuration in <span class="EmphasisFontCategoryNonProportional">app-context-xml-03.xml</span>, and except for the lines shown next, everything else is identical
                                to the contents from <span class="EmphasisFontCategoryNonProportional">app-context-xml-02.xml</span>, so they won’t be depicted again here.)</div>
                            <pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ..&gt;</span>
...
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">aop</span><span style="font-weight:700">:</span><span style="font-weight:700">config</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">aop</span><span style="font-weight:700">:</span><span style="font-weight:700">pointcut</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">singExecution</span>
            <span style="font-style:italic">expression</span>=<span style="color:#036a07">execution(
                     * sing*(com.apress.prospring5.ch2.common.Guitar))
                    and args(value) and bean(john*)</span>
        /&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">aop</span><span style="font-weight:700">:</span><span style="font-weight:700">aspect</span> <span style="font-style:italic">ref</span>=<span style="color:#036a07">advice</span>&gt;</span>
            <span style="color:#1c02ff">&lt;<span style="font-weight:700">aop</span><span style="font-weight:700">:</span><span style="font-weight:700">before</span> <span style="font-style:italic">pointcut-ref</span>=<span style="color:#036a07">singExecution</span>
                <span style="font-style:italic">method</span>=<span style="color:#036a07">simpleBeforeAdvice</span>/&gt;</span>
            <span style="color:#1c02ff">&lt;<span style="font-weight:700">aop</span><span style="font-weight:700">:</span><span style="font-weight:700">around</span> <span style="font-style:italic">pointcut-ref</span>=<span style="color:#036a07">singExecution</span>
                <span style="font-style:italic">method</span>=<span style="color:#036a07">simpleAroundAdvice</span>/&gt;</span>
        <span style="color:#1c02ff">&lt;/<span style="font-weight:700">aop</span><span style="font-weight:700">:</span><span style="font-weight:700">aspect</span>&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">aop</span><span style="font-weight:700">:</span><span style="font-weight:700">config</span>&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
                            <div class="Para" id="Par372">We just added the new tag <span class="EmphasisFontCategoryNonProportional">&lt;aop:around&gt;</span> to declare the around advice and reference the same <span id="ITerm171">pointcut                      </span>. Let’s modify
                                the <span class="EmphasisFontCategoryNonProportional">NewDocumentarist.execute()</span> method again to include a <span class="EmphasisFontCategoryNonProportional">sing()</span> call with a default <span class="EmphasisFontCategoryNonProportional">Guitar</span>                                to obtain the behavior we want to analyze.</div>
                            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.common.Guitar</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">NewDocumentarist</span> <span style="color:#00f;font-weight:700">extends</span> <span style="font-style:italic">Documentarist</span> {
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">execute</span>() {
        guitarist<span style="color:#00f;font-weight:700">.</span>sing();
        <span style="color:#00f;font-weight:700">Guitar</span> guitar <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Guitar</span>();
        guitar<span style="color:#00f;font-weight:700">.</span>setBrand(<span style="color:#036a07">Gibson</span>);
        guitarist<span style="color:#00f;font-weight:700">.</span>sing(guitar);
        guitarist<span style="color:#00f;font-weight:700">.</span>sing(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Guitar</span>());
        guitarist<span style="color:#00f;font-weight:700">.</span>talk();
    }
}
</pre>
                            <div class="Para" id="Par374">Run the testing program again, and you will have the following output:</div>
                            <div class="Para" id="Par375">
                                <div class="ProgramCode" id="PC94">
                                    <div class="LineGroup">
                                        <div class="FixedLine">sing: Gravity is working against me</div>
                                        <div class="FixedLine">And gravity wants to bring me down</div>
                                    </div>
                                    <div class="LineGroup">
                                        <div class="FixedLine">Executing: com.apress.prospring5.ch5.GrammyGuitarist sing</div>
                                        <div class="FixedLine">Before execution: com.apress.prospring5.ch5.GrammyGuitarist sing argument: Gibson</div>
                                        <div class="FixedLine">play: G C G C Am D7</div>
                                        <div class="FixedLine">After execution: com.apress.prospring5.ch5.GrammyGuitarist sing argument: <span id="ITerm172">Gibson                                  </span> </div>
                                    </div>
                                    <div class="LineGroup">
                                        <div class="FixedLine">Before execution: com.apress.prospring5.ch5.GrammyGuitarist sing argument: Martin</div>
                                        <div class="FixedLine">play: G C G C Am D7</div>
                                        <div class="FixedLine">After execution: com.apress.prospring5.ch5.GrammyGuitarist sing argument: Martin</div>
                                        <div class="FixedLine">talk</div>
                                    </div>
                                </div>
                            </div>
                            <div class="Para" id="Par376">There are two interesting points here. First, you see that the around advice was applied to both invocations of the <span class="EmphasisFontCategoryNonProportional">sing(..)</span> method with a <span class="EmphasisFontCategoryNonProportional">Guitar</span>                                argument, since it doesn’t check the argument. Second, for the <span class="EmphasisFontCategoryNonProportional">sing()</span> method with <span class="EmphasisFontCategoryNonProportional">&quot;Gibson&quot; Guitar</span> as an argument,
                                both the before and around advice were executed, and by default the before advice takes precedence.</div>
                            <div class="Para ParaTypeImportant" id="Par377"> <img alt="A315511_5_En_5_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Figa_HTML.jpg" width="30"/>                                When using the <span class="EmphasisFontCategoryNonProportional">aop</span> namespace or the <span class="EmphasisFontCategoryNonProportional">@AspectJ</span> style, there are two types of after advice. The <span class="EmphasisFontCategoryNonProportional">after-returning</span>                                advice (using the <span class="EmphasisFontCategoryNonProportional">&lt;aop:after-returning&gt;</span> tag) applies only when the target method is completed normally. Another one is the after advice (using the <span class="EmphasisFontCategoryNonProportional">&lt;aop:after&gt;</span>                                tag), which takes place whether the method was completed normally or the method runs into an error and an exception is thrown. If you need advice that executes regardless of the execution result of the target method, you
                                should use after advice.</div>
                            </div>
                            </div>
                            <div class="Section1 RenderAsSection1" id="Sec57">
                                <h2 class="Heading">Using @AspectJ-Style Annotations</h2>
                                <div class="Para ParaOneEmphasisChild" id="Par378">When using Spring AOP with JDK 5 or newer, you can also use the <span class="EmphasisFontCategoryNonProportional">@AspectJ-</span>style annotations to declare your advice. However, as stated before, Spring still uses its
                                    own proxying mechanism for advising the target methods, not AspectJ’s weaving mechanism.</div>
                                <div class="Para" id="Par379">In this section, we will go through how to implement the same aspects as the ones in the <span class="EmphasisFontCategoryNonProportional">aop</span> namespace by using <span class="EmphasisFontCategoryNonProportional">@AspectJ-</span>style
                                    annotations. AspectJ is a general-purpose aspect-oriented extension to Java born out of need to solve issues or concerns that are not well captured by traditional programming methodologies, in other words, crosscutting
                                    concerns. For the examples in this section, we will use annotations for other Spring beans as well, and we will use <span id="ITerm173">Java configuration                  </span> classes.</div>
                                <div class="Para ParaOneEmphasisChild" id="Par380">The following example depicts the <span class="EmphasisFontCategoryNonProportional">GrammyGuitarist</span> class with the bean being declared using annotations:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.common.Guitar</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.common.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Component</span>;

@Component(<span style="color:#036a07">johnMayer</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">GrammyGuitarist</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Singer</span> {
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">sing</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">&quot;sing: Gravity is working against me<span style="color:#26b31a">\n</span>&quot;</span> <span style="color:#00f;font-weight:700">+</span>
                <span style="color:#036a07">And gravity wants to bring me down</span>);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">sing</span>(<span style="color:#00f;font-weight:700">Guitar</span> <span style="font-style:italic">guitar</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">play: </span> <span style="color:#00f;font-weight:700">+</span> guitar<span style="color:#00f;font-weight:700">.</span>play());
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">rest</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">zzz</span>);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">talk</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">talk</span>);
    }
}
</pre>
                                <div class="Para ParaOneEmphasisChild" id="Par382">The <span class="EmphasisFontCategoryNonProportional">NewDocumentarist</span> class needs adapting too.</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.common.Guitar</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Autowired</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Qualifier</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Component</span>;

@Component(<span style="color:#036a07">documentarist</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">NewDocumentarist</span> {
    <span style="color:#00f;font-weight:700">protected</span> <span style="color:#00f;font-weight:700">GrammyGuitarist</span> guitarist;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">execute</span>() {
        guitarist<span style="color:#00f;font-weight:700">.</span>sing();
        <span style="color:#00f;font-weight:700">Guitar</span> guitar <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Guitar</span>();
        guitar<span style="color:#00f;font-weight:700">.</span>setBrand(<span style="color:#036a07">Gibson</span>);
        guitarist<span style="color:#00f;font-weight:700">.</span>sing(guitar);
        guitarist<span style="color:#00f;font-weight:700">.</span>talk();
    }

    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">@Qualifier</span>(<span style="color:#036a07">johnMayer</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setGuitarist</span>(<span style="color:#00f;font-weight:700">GrammyGuitarist</span> <span style="font-style:italic">guitarist</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>guitarist <span style="color:#00f;font-weight:700">=</span> guitarist;
    }
}
</pre>
                                <div class="Para" id="Par384">We annotate both classes with the <span class="EmphasisFontCategoryNonProportional">@Component</span> annotation and assign them with the corresponding name. In the <span class="EmphasisFontCategoryNonProportional">GrammyGuitarist</span>                                    class, the setter method of the property <span class="EmphasisFontCategoryNonProportional">guitarist</span> was annotated with <span class="EmphasisFontCategoryNonProportional">@Autowired</span> for automatic injection
                                    by Spring.</div>
                                <div class="Para" id="Par385">Now let’s see the <span class="EmphasisFontCategoryNonProportional">AnnotationAdvice</span> class using <span class="EmphasisFontCategoryNonProportional">@AspectJ-</span>style annotations. We will implement the pointcuts,
                                    before advice, and around advice altogether in one shot. The following code snippet shows the <span id="ITerm176">              <span class="EmphasisFontCategoryNonProportional">AnnotationAdvice</span> </span> class:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch2.common.Guitar</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.aspectj.lang.JoinPoint</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.aspectj.lang.ProceedingJoinPoint</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.aspectj.lang.annotation.Around</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.aspectj.lang.annotation.Aspect</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.aspectj.lang.annotation.Before</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.aspectj.lang.annotation.Pointcut</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Component</span>;

@<span style="color:#00f;font-weight:700">Component</span>
@<span style="color:#00f;font-weight:700">Aspect</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AnnotatedAdvice</span> {
    <span style="color:#00f;font-weight:700">@Pointcut</span>(<span style="color:#036a07">execution(*
            com.apress.prospring5.ch5..sing*(com.apress.prospring5.ch2.common.Guitar))
        &amp;&amp;

    args(value)</span>)

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">singExecution</span>(<span style="color:#00f;font-weight:700">Guitar</span> <span style="font-style:italic">value</span>) {
    }

    <span style="color:#00f;font-weight:700">@Pointcut</span>(<span style="color:#036a07">bean(john*)</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">isJohn</span>() {
    }

    <span style="color:#00f;font-weight:700">@Before</span>(<span style="color:#036a07">singExecution(value) &amp;&amp; isJohn()</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">simpleBeforeAdvice</span>(<span style="color:#00f;font-weight:700">JoinPoint</span> <span style="font-style:italic">joinPoint</span>, <span style="color:#00f;font-weight:700">Guitar</span> <span style="font-style:italic">value</span>) {
        <span style="color:#00f;font-weight:700">if</span> (value<span style="color:#00f;font-weight:700">.</span>getBrand()<span style="color:#00f;font-weight:700">.</span>equals(<span style="color:#036a07">Gibson</span>)) {
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Executing: </span> <span style="color:#00f;font-weight:700">+</span>
                    joinPoint<span style="color:#00f;font-weight:700">.</span>getSignature()<span style="color:#00f;font-weight:700">.</span>getDeclaringTypeName() <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07"> </span>
                    <span style="color:#00f;font-weight:700">+</span> joinPoint<span style="color:#00f;font-weight:700">.</span>getSignature()<span style="color:#00f;font-weight:700">.</span>getName() <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07"> argument: </span> <span style="color:#00f;font-weight:700">+</span> value<span style="color:#00f;font-weight:700">.</span>getBrand());
        }
    }

    <span style="color:#00f;font-weight:700">@Around</span>(<span style="color:#036a07">singExecution(value) &amp;&amp; isJohn()</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Object</span> <span style="color:#0000a2;font-weight:700">simpleAroundAdvice</span>(<span style="color:#00f;font-weight:700">ProceedingJoinPoint</span> <span style="font-style:italic">pjp</span>,
                                     <span style="color:#00f;font-weight:700">Guitar</span> <span style="font-style:italic">value</span>) <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Throwable</span> {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Before execution: </span> <span style="color:#00f;font-weight:700">+</span>
                pjp<span style="color:#00f;font-weight:700">.</span>getSignature()<span style="color:#00f;font-weight:700">.</span>getDeclaringTypeName() <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07"> </span>
                <span style="color:#00f;font-weight:700">+</span> pjp<span style="color:#00f;font-weight:700">.</span>getSignature()<span style="color:#00f;font-weight:700">.</span>getName()
                <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07"> argument: </span> <span style="color:#00f;font-weight:700">+</span> value<span style="color:#00f;font-weight:700">.</span>getBrand());
        <span style="color:#00f;font-weight:700">Object</span> retVal <span style="color:#00f;font-weight:700">=</span> pjp<span style="color:#00f;font-weight:700">.</span>proceed();
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">After execution: </span> <span style="color:#00f;font-weight:700">+</span>
                pjp<span style="color:#00f;font-weight:700">.</span>getSignature()<span style="color:#00f;font-weight:700">.</span>getDeclaringTypeName() <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07"> </span>
                <span style="color:#00f;font-weight:700">+</span> pjp<span style="color:#00f;font-weight:700">.</span>getSignature()<span style="color:#00f;font-weight:700">.</span>getName()
                <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07"> argument: </span> <span style="color:#00f;font-weight:700">+</span> value<span style="color:#00f;font-weight:700">.</span>getBrand());
        <span style="color:#00f;font-weight:700">return</span> retVal;
    }
}
</pre>
                            <div class="Para" id="Par387">You will notice that the code structure is quite like the one we used in the <span id="ITerm178">          <span class="EmphasisFontCategoryNonProportional">aop</span> namespace </span>, just in this case we used annotations
                                instead. However, there are still a few points worth noting.
                                <div class="UnorderedList">
                                    <ul class="UnorderedListMarkBullet">
                                        <li>
                                            <div class="Para" id="Par388">We used both <span class="EmphasisFontCategoryNonProportional">@Component</span> and <span class="EmphasisFontCategoryNonProportional">@Aspect</span> to annotate the <span class="EmphasisFontCategoryNonProportional">AnnotatedAdvice</span>                                                class. The <span class="EmphasisFontCategoryNonProportional">@Aspect</span> annotation is used to declare that it’s an aspect class. To allow Spring to scan the component when we use the <span class="EmphasisFontCategoryNonProportional">&lt;context:component-scan&gt;</span>                                                tag in the XML configuration, you also need to annotate the class with <span class="EmphasisFontCategoryNonProportional">@Component</span>.</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par389">The pointcuts were defined as methods that return <span class="EmphasisFontCategoryNonProportional">void</span>. In the class, we defined two pointcuts; both are annotated with <span class="EmphasisFontCategoryNonProportional">@Pointcut</span>.
                                                We intentionally split the pointcut expression in the <span class="EmphasisFontCategoryNonProportional">aop</span> namespace example into two. The first one (indicated by the method <span class="EmphasisFontCategoryNonProportional">singExecution(Guitar value))</span>                                                defines the pointcut for execution of <span class="EmphasisFontCategoryNonProportional">sing*()</span> methods within all classes under the package <span class="EmphasisFontCategoryNonProportional">com.apress.prospring4.ch5</span>                                                with a <span class="EmphasisFontCategoryNonProportional">guitar</span> argument, and the argument <span class="EmphasisFontCategoryNonProportional">(value)</span> will also be passed into the advice. The
                                                other one (indicated by the method <span class="EmphasisFontCategoryNonProportional">isJohn()</span>) is to define another pointcut that defines all method executions with Spring beans’ names prefixed by
                                                <span class="EmphasisFontCategoryNonProportional">john</span>. Also note that we need to use <span class="EmphasisFontCategoryNonProportional">&amp;&amp;</span> to define the “and” condition in the pointcut
                                                expression, while for the <span class="EmphasisFontCategoryNonProportional">aop</span> namespace, we need to use the <span class="EmphasisFontCategoryNonProportional">and</span> <span id="ITerm179">operator                              </span>.</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par390">The before-advice method was annotated with <span class="EmphasisFontCategoryNonProportional">@Before</span>, while the around advice was annotated with <span class="EmphasisFontCategoryNonProportional">@Around</span>.
                                                For both advice types, we pass in the value that uses the two pointcuts defined in the class. The value <span class="EmphasisFontCategoryNonProportional">singExecution(value) &amp;&amp; isJohn()</span> means
                                                the condition of both pointcuts should be matched for applying the advice, which is the same as the intersection operation in <span class="EmphasisFontCategoryNonProportional">ComposablePointcut</span>.</div>
                                        </li>
                                        <li>
                                            <div class="Para ParaOneEmphasisChild" id="Par391">The before-advice logic and the around-advice logic are the same as in the <span class="EmphasisFontCategoryNonProportional">aop</span> namespace example.</div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="Para" id="Par392">With all the annotations in place, the XML <span id="ITerm180">configuration                  </span> becomes simple.</div>
                            <pre style="background:#fff;color:#000"><span style="color:#68685b">&lt;?<span style="color:#888">xml</span><span style="color:#888"> version</span>=<span style="color:#888">1.0</span><span style="color:#888"> encoding</span>=<span style="color:#888">UTF-8</span>?&gt;</span>
<span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> <span style="font-style:italic">xmlns</span>=<span style="color:#036a07">http://www.springframework.org/schema/beans</span>
    <span style="font-style:italic">xmlns</span>:xsi=<span style="color:#036a07">http://www.w3.org/2001/XMLSchema-instance</span>
    <span style="font-style:italic">xmlns</span>:aop=<span style="color:#036a07">http://www.springframework.org/schema/aop</span>
    <span style="font-style:italic">xmlns</span>:context=<span style="color:#036a07">http://www.springframework.org/schema/context</span>
    <span style="font-style:italic">xsi</span>:schemaLocation=<span style="color:#036a07">http://www.springframework.org/schema/aop
      http://www.springframework.org/schema/aop/spring-aop.xsd
      http://www.springframework.org/schema/beans
      http://www.springframework.org/schema/beans/spring-beans.xsd
      http://www.springframework.org/schema/context
      http://www.springframework.org/schema/context/spring-context.xsd</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">aop</span><span style="font-weight:700">:</span><span style="font-weight:700">aspectj-autoproxy</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">context</span><span style="font-weight:700">:</span><span style="font-weight:700">component-scan</span>
      <span style="font-style:italic">base-package</span>=<span style="color:#036a07">com.apress.prospring5.ch5</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
                            <div class="Para" id="Par394">Only two tags were declared. The <span class="EmphasisFontCategoryNonProportional">&lt;aop:aspect-autoproxy&gt;</span> tag is to inform Spring to scan for <span class="EmphasisFontCategoryNonProportional">@AspectJ-</span>style
                                annotations, while the <span class="EmphasisFontCategoryNonProportional">&lt;context:component-scan&gt;</span> tag was still required for Spring to scan for Spring beans within the package that the advice resides. We also
                                need to annotate the advice class with <span class="EmphasisFontCategoryNonProportional">@Component</span> to indicate that it’s a Spring <span id="ITerm181">component                  </span>.</div>
                            <div class="Para" id="Par395">The class to test this configuration is depicted in the following code snippet:</div>
                            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AspectJAnnotationDemo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-xml.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">NewDocumentarist</span> documentarist <span style="color:#00f;font-weight:700">=</span>
                ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">documentarist</span>, <span style="color:#00f;font-weight:700">NewDocumentarist</span><span style="color:#00f;font-weight:700">.</span>class);
        documentarist<span style="color:#00f;font-weight:700">.</span>execute();
    }
}
</pre>
                            <div class="Para" id="Par397">If you were to run the example as it is, you would get a little surprise as this is what you would see in the console:</div>
                            <div class="Para" id="Par398">
                                <div class="ProgramCode" id="PC100">
                                    <div class="FixedLine">Exception in thread &quot;main&quot;</div>
                                    <div class="FixedLine">org.springframework.beans.factory.UnsatisfiedDependencyException:</div>
                                    <div class="FixedLine">Error creating bean with name &apos;documentarist&apos;: Unsatisfied dependency</div>
                                    <div class="FixedLine">expressed through method &apos;setGuitarist&apos; parameter 0; nested exception is</div>
                                    <div class="FixedLine"> org.springframework.beans.factory.BeanNotOfRequiredTypeException:</div>
                                    <div class="FixedLine"> Bean named &apos;johnMayer&apos; is expected to be of type</div>
                                    <div class="FixedLine">   &apos;com.apress.prospring5.ch5.GrammyGuitarist&apos; but was actually of</div>
                                    <div class="FixedLine">   type &apos;com.sun.proxy.$Proxy18&apos;</div>
                                    <div class="FixedLine">...<span id="ITerm182">                                                    </span> </div>
                                </div>
                            </div>
                            <div class="Para" id="Par399">So, what is going on here? Well, <span class="EmphasisFontCategoryNonProportional">GrammyGuitarist</span> implements the <span class="EmphasisFontCategoryNonProportional">Singer</span> interface, and by default interface-based
                                JDK dynamic proxies are created. But <span class="EmphasisFontCategoryNonProportional">NewDocumentarist</span> strictly requires the dependency to be of type <span class="EmphasisFontCategoryNonProportional">Grammy-Guitarist</span>                                or an extension of it. Thus, the previous exception is thrown. How do we fix it? There are two ways: one is to modify <span class="EmphasisFontCategoryNonProportional">NewDocumentarist</span> to accept a <span class="EmphasisFontCategoryNonProportional">Singer</span>                                dependency, but this is not suitable for our example as we want to access methods in the <span class="EmphasisFontCategoryNonProportional">GrammyGuitarist</span> class, which are not implementations of methods defined in
                                the <span class="EmphasisFontCategoryNonProportional">Singer</span> interface. The second way is to request Spring to generate CGLIB, class-based proxies. In XML, this can be done by modifying the configuration of the
                                <span class="EmphasisFontCategoryNonProportional">&lt;aop:aspectj-autoproxy/&gt;</span> tag and setting the <span class="EmphasisFontCategoryNonProportional">proxy-target-class</span> attribute value to <span class="EmphasisFontCategoryNonProportional">true</span>.</div>
                            <div class="Para" id="Par400">The Java configuration class is even simpler than this:</div>
                                <pre style="background:#fff;color:#000">@<span style="color:#00f;font-weight:700">Configuration</span>
@ComponentScan(basePackages <span style="color:#00f;font-weight:700">=</span> {<span style="color:#036a07">com.apress.prospring5.ch5</span>})
@EnableAspectJAutoProxy(proxyTargetClass <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AppConfig</span> {
}
</pre>
                                <div class="Para" id="Par402">Notice the <span class="EmphasisFontCategoryNonProportional">@EnableAspectJAutoProxy</span> annotation. It is the equivalent of <span class="EmphasisFontCategoryNonProportional">&lt;aop:aspectj-autoproxy/&gt;</span> and
                                    also has an attribute called <span class="EmphasisFontCategoryNonProportional">proxyTargetClass</span> that is analogous to the <span class="EmphasisFontCategoryNonProportional">proxy-target-class</span> attribute.
                                    This annotation enables support for handling components marked with AspectJ’s <span class="EmphasisFontCategoryNonProportional">@Aspect</span> annotation and is designed to be used on classes annotated with <span class="EmphasisFontCategoryNonProportional">@Configuration</span>.</div>
                                <div class="Para" id="Par403">The following is the testing program. It was designed as a JUnit test case so that both XML and Java configuration examples can be placed in the same class. Smart editors like IntelliJ IDEA offer the possibility to execute
                                    every test method in <span id="ITerm183">isolation                  </span>.</div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Test</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.AnnotationConfigApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AspectJAnnotationTest</span> {
    <span style="color:#00f;font-weight:700">@Test</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">xmlTest</span>() {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-xml.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">NewDocumentarist</span> documentarist <span style="color:#00f;font-weight:700">=</span>
                ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">documentarist</span>, <span style="color:#00f;font-weight:700">NewDocumentarist</span><span style="color:#00f;font-weight:700">.</span>class);
        documentarist<span style="color:#00f;font-weight:700">.</span>execute();
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }

    <span style="color:#00f;font-weight:700">@Test</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">configTest</span>() {
        <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">AppConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">NewDocumentarist</span> documentarist <span style="color:#00f;font-weight:700">=</span>
                ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">documentarist</span>, <span style="color:#00f;font-weight:700">NewDocumentarist</span><span style="color:#00f;font-weight:700">.</span>class);
        documentarist<span style="color:#00f;font-weight:700">.</span>execute();
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                                    <div class="Para" id="Par405">Running any of these <span id="ITerm184">test methods                  </span>, if it passes, yields the following output:</div>
                                    <div class="Para" id="Par406">
                                        <div class="ProgramCode" id="PC103">
                                            <div class="FixedLine">sing: Gravity is working against me</div>
                                            <div class="FixedLine">And gravity wants to bring me down</div>
                                            <div class="FixedLine">Before execution: com.apress.prospring5.ch5.GrammyGuitarist sing argument: Gibson</div>
                                            <div class="FixedLine">Executing: com.apress.prospring5.ch5.GrammyGuitarist sing argument: Gibson</div>
                                            <div class="FixedLine">play: G C G C Am D7</div>
                                            <div class="FixedLine">After execution: com.apress.prospring5.ch5.GrammyGuitarist sing argument: Gibson</div>
                                            <div class="FixedLine">talk</div>
                                        </div>
                                    </div>
                                    <div class="Para" id="Par407"> <span id="ITerm185">Spring Boot                  </span> provides a special AOP starter library that removes a little of the hassle of configuration. The library is configured as usual in the <span class="EmphasisFontCategoryNonProportional">pro-spring-15/build.properties</span>                                        file and added as a dependency using its given name in the child project configuration file <span class="EmphasisFontCategoryNonProportional">aspectj-boot/build.gradle</span>.</div>
                                    <pre style="background:#fff;color:#000"><span style="color:#06f;font-style:italic">//pro-spring-15/build.properties</span>
ext {
    bootVersion <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">2.0.0.BUILD-SNAPSHOT</span>
    .<span style="color:#00f;font-weight:700">.</span>.
    boot <span style="color:#00f;font-weight:700">=</span> [
         springBootPlugin<span style="color:#00f;font-weight:700">:</span>
              <span style="color:#036a07">org.springframework.boot:spring-boot-gradle-plugin:$bootVersion</span>,
         .<span style="color:#00f;font-weight:700">.</span>.
         starterAop<span style="color:#00f;font-weight:700">:</span>
             <span style="color:#036a07">org.springframework.boot:spring-boot-starter-aop:$bootVersion</span>
    ]
}
<span style="color:#06f;font-style:italic">//aspectj-boot/build.gradle</span>
buildscript {
          .<span style="color:#00f;font-weight:700">.</span>.
    dependencies {
        classpath boot<span style="color:#00f;font-weight:700">.</span>springBootPlugin
    }
}
apply plugin<span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">org.springframework.boot</span>
dependencies {
    compile boot<span style="color:#00f;font-weight:700">.</span>starterAop
}
</pre>
                                    <div class="Para" id="Par409">In Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Chapter.html#Fig11">5-11</a></span> you can see the set of libraries added as dependencies
                                        to the Spring Boot project. By adding this library
                                        <div class="Figure" id="Fig11">
                                            <div class="MediaObject" id="MO11"><img alt="A315511_5_En_5_Fig11_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Fig11_HTML.jpg" height="237" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Fig11_HTML.jpg" width="690"/></div>
                                            <div class="Caption" xml:lang="en">
                                                <div class="CaptionContent"><span class="CaptionNumber">Figure 5-11.</span>
                                                    <div class="SimplePara">Spring Boot AOP starter tranzitive dependencies as depicted in IntelliJ <span id="ITerm186">IDEA                                  </span> </div>
                                                </div>
                                        </div>
                                    </div>
                                    </div>
                                    <div class="Para" id="Par410">to your application as a dependency, the <span class="EmphasisFontCategoryNonProportional">@EnableAspectJAutoProxy(proxyTargetClass = true)</span> annotation is no longer needed because the AOP Spring support is already
                                        enabled by default. The attribute does not have to be set anywhere either because Spring Boot automatically detects what type of proxies you need. Considering the previous example, you can remove the <span class="EmphasisFontCategoryNonProportional">AppConfig</span>                                        class and replace it with a typical Spring Boot application class.</div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.Logger</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.LoggerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.boot.SpringApplication</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.boot.autoconfigure.SpringBootApplication</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.ConfigurableApplicationContext</span>;

@<span style="color:#00f;font-weight:700">SpringBootApplication</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Application</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">Application</span><span style="color:#00f;font-weight:700">.</span>class);

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">args</span>) <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Exception</span> {
        <span style="color:#00f;font-weight:700">ConfigurableApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">SpringApplication</span><span style="color:#00f;font-weight:700">.</span>run(<span style="color:#00f;font-weight:700">Application</span><span style="color:#00f;font-weight:700">.</span>class, args);
        <span style="color:#00f;font-weight:700">assert</span> (ctx <span style="color:#00f;font-weight:700">!=</span> <span style="color:#585cf6;font-weight:700">null</span>);
        <span style="color:#00f;font-weight:700">NewDocumentarist</span> documentarist <span style="color:#00f;font-weight:700">=</span>
                ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">documentarist</span>, <span style="color:#00f;font-weight:700">NewDocumentarist</span><span style="color:#00f;font-weight:700">.</span>class);
        documentarist<span style="color:#00f;font-weight:700">.</span>execute();
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>in<span style="color:#00f;font-weight:700">.</span>read();
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                                    <div class="Section2 RenderAsSection2" id="Sec58">
                                        <h3 class="Heading">Considerations for Declarative Spring AOP Configuration</h3>
                                        <div class="Para" id="Par412">So far, we have discussed three ways of declaring Spring <span id="ITerm188">AOP configuration                      </span>, including the <span class="EmphasisFontCategoryNonProportional">ProxyFactoryBean</span>,
                                            the <span class="EmphasisFontCategoryNonProportional">aop</span> namespace, and <span class="EmphasisFontCategoryNonProportional">@AspectJ-</span>style annotations. We believe you will agree that the <span class="EmphasisFontCategoryNonProportional">aop</span>                                            namespace is much simpler than <span class="EmphasisFontCategoryNonProportional">ProxyFactoryBean</span>. So, the general question is, do you use the <span class="EmphasisFontCategoryNonProportional">aop</span>                                            namespace or <span class="EmphasisFontCategoryNonProportional">@AspectJ-</span>style annotations?</div>
                                        <div class="Para" id="Par413">If your Spring application is XML configuration–based, using the <span class="EmphasisFontCategoryNonProportional">aop</span> namespace approach is a natural choice because it keeps the AOP and DI configuration
                                            styles consistent. On the other hand, if your application is mainly annotation based, use the <span class="EmphasisFontCategoryNonProportional">@AspectJ</span> annotation. Again, let the requirements of your
                                            application drive the configuration approach and make your best effort to be consistent.</div>
                                        <div class="Para" id="Par414">Moreover, there are some other differences between the <span class="EmphasisFontCategoryNonProportional">aop</span> namespace and <span class="EmphasisFontCategoryNonProportional">@AspectJ</span> annotation approaches.
                                            <div class="UnorderedList">
                                                <ul class="UnorderedListMarkBullet">
                                                    <li>
                                                        <div class="Para" id="Par415">The pointcut expression syntax has some minor differences (for example, in the previous discussions, we need to use <span class="EmphasisFontCategoryNonProportional">and</span> in the <span class="EmphasisFontCategoryNonProportional">aop</span>                                                            namespace, but <span class="EmphasisFontCategoryNonProportional">&amp;&amp;</span> in <span class="EmphasisFontCategoryNonProportional">@AspectJ</span> annotation).</div>
                                                    </li>
                                                    <li>
                                                        <div class="Para ParaOneEmphasisChild" id="Par416">The <span class="EmphasisFontCategoryNonProportional">aop</span> namespace approach supports only the “singleton” aspect instantiation model.</div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par417">In the <span class="EmphasisFontCategoryNonProportional">aop</span> namespace, you can’t “combine” multiple pointcut expressions. In the example using <span class="EmphasisFontCategoryNonProportional">@AspectJ</span>,
                                                            we can combine the two pointcut definitions (that is, <span class="EmphasisFontCategoryNonProportional">singExecution(value) &amp;&amp; isJohn()</span>) in the before and around advice. When
                                                            using the <span class="EmphasisFontCategoryNonProportional">aop</span> namespace and you need to create a new pointcut expression that combines the matching conditions, you need to use the
                                                            <span class="EmphasisFontCategoryNonProportional">ComposablePointcut</span> class.</div>
                                                    </li>
                                                </ul>
                                        </div>
                                    </div>
                                    </div>
                                    </div>
                                    <div class="Section1 RenderAsSection1" id="Sec59">
                                        <h2 class="Heading">AspectJ Integration</h2>
                                        <div class="Para" id="Par418">AOP provides a powerful solution to many of the common problems that arise with OOP-based applications. When using Spring AOP, you can take advantage of a select subset of AOP functionality that, in most cases,
                                            enables you to solve problems you encounter in your application. However, in some cases, you may want to use some AOP features that are outside the scope of Spring AOP.</div>
                                        <div class="Para" id="Par419">From the joinpoint perspective, Spring AOP supports only pointcuts matching on the execution of public nonstatic methods. However, in some cases, you may need to apply advice to protected/private methods, during
                                            object construction or field access, and so on.</div>
                                        <div class="Para" id="Par420">In those cases, you need to look at an AOP implementation with a fuller feature set. Our preference, in this case, is to use AspectJ, and because you can now configure AspectJ aspects using Spring, AspectJ forms
                                            the perfect complement to Spring AOP.</div>
                                        <div class="Section2 RenderAsSection2" id="Sec60">
                                            <h3 class="Heading">About AspectJ</h3>
                                            <div class="Para ParaOneEmphasisChild" id="Par421">AspectJ is a fully featured AOP implementation that uses a weaving process (either compile-time or load-time weaving) to introduce aspects into your code. In AspectJ, aspects and pointcuts are built using a
                                                Java-like syntax, which reduces the learning curve for Java developers. We are not going to spend too much time looking at AspectJ and how it works because that is outside the scope of this book. Instead,
                                                we present some simple AspectJ examples and show you how to configure them using Spring. For more information on AspectJ, you should definitely read <span class="EmphasisTypeItalic">AspectJ in Action: Enterprise AOP with Spring Applications</span>                                                by Ramnivas Laddad (Manning, 2009).</div>
                                            <div class="Para ParaTypeImportant" id="Par422"> <img alt="A315511_5_En_5_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Figa_HTML.jpg" width="30"/>                                                We are not going to cover how to weave AspectJ aspects into your application. Refer to the AspectJ documentation for details or take a look at the provided Gradle build in Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Chapter.html"><span class="RefSource">5</span></a>
                                                </span>’s <span class="EmphasisFontCategoryNonProportional">aspectj-aspects</span> project.</div>
                                        </div>
                                        <div class="Section2 RenderAsSection2" id="Sec61">
                                            <h3 class="Heading">Using <span id="ITerm189">Singleton Aspects                      </span> </h3>
                                            <div class="Para" id="Par423">By default, AspectJ aspects are singletons, meaning you get a single instance per class loader. The problem Spring faces with any AspectJ aspect is that it cannot create the aspect instance, as this is already
                                                handled by AspectJ itself. However, each aspect exposes a method called <span class="EmphasisFontCategoryNonProportional">org.aspectj.lang.Aspects.aspectOf()</span> that can be used to access the aspect
                                                instance. Using the <span class="EmphasisFontCategoryNonProportional">aspectOf()</span> method and a special feature of Spring configuration, you can have Spring configure the aspect for you. With this support,
                                                you can take full advantage of AspectJ’s powerful AOP feature set without losing out on Spring’s excellent DI and configuration abilities. This also means you do not need two separate configuration methods
                                                for your application; you can use the same Spring <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> approach for all your Spring-managed beans and for your AspectJ aspects.</div>
                                            <div class="Para" id="Par424">To support aspects in a Spring application, a Gradle plug-in needs to be added to the configuration. You can find the source code and instructions on how to use it in a Gradle application here: <span class="ExternalRef"><a href="https://github.com/eveoh/gradle-aspectj"><span class="RefSource">                  <span class="EmphasisFontCategoryNonProportional">https://github.com/eveoh/gradle-aspectj</span>                                                </span>
                                                </a>
                                                </span>. Here you can see the contents of the <span class="EmphasisFontCategoryNonProportional">chapter05/aspectj-aspects/build.gradle</span>:</div>
                                        <pre style="background:#fff;color:#000">buildscript {
   repositories {
      mavenLocal()
      mavenCentral()
      maven { url <span style="color:#036a07">http://repo.spring.io/release</span> }
      maven { url <span style="color:#036a07">http://repo.spring.io/milestone</span> }
      maven { url <span style="color:#036a07">http://repo.spring.io/snapshot</span> }
      maven { url <span style="color:#036a07">https://repo.spring.io/libs-snapshot</span> }
      maven { url <span style="color:#036a07">https://maven.eveoh.nl/content/repositories/releases</span> }
   }
   dependencies {
      classpath <span style="color:#036a07">nl.eveoh:gradle-aspectj:1.6</span>
   }
}
apply plugin<span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">aspectj</span>
jar {
   manifest {
      attributes(
         <span style="color:#036a07">Main-Class</span><span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">com.apress.prospring5.ch5.AspectJDemo</span>,
         <span style="color:#036a07">Class-Path</span><span style="color:#00f;font-weight:700">:</span> configurations<span style="color:#00f;font-weight:700">.</span>compile<span style="color:#00f;font-weight:700">.</span>collect { it<span style="color:#00f;font-weight:700">.</span>getName() }<span style="color:#00f;font-weight:700">.</span>join(<span style="color:#036a07"> </span>))
   }
}
</pre>
                                        <div class="Para ParaOneEmphasisChild" id="Par426">In the following code snippet, you can see a basic class, <span class="EmphasisFontCategoryNonProportional">MessageWriter</span>, that we will advise using AspectJ:</div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">MessageWriter</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">writeMessage</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">foobar!</span>);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">foo</span>() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">foo</span>);
    }
}
</pre>
                                        <div class="Para" id="Par428">For this example, we are going to use AspectJ to advise the <span class="EmphasisFontCategoryNonProportional">writeMessage()</span> method and write out a message before and after the method invocation. These messages
                                            will be configurable using Spring. The following code sample shows the <span class="EmphasisFontCategoryNonProportional">MessageWrapper</span> aspect (the file name is <span class="EmphasisFontCategoryNonProportional">MessageWrapper.aj</span>,
                                            which is an AspectJ file instead of a standard Java class):</div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;
<span style="color:#00f;font-weight:700">public</span> aspect <span style="color:#00f;font-weight:700">MessageWrapper</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> prefix;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> suffix;
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> setPrefix(<span style="color:#00f;font-weight:700">String</span> prefix) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>prefix <span style="color:#00f;font-weight:700">=</span> prefix;
    }
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> getPrefix() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>prefix;
    }
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> setSuffix(<span style="color:#00f;font-weight:700">String</span> suffix) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>suffix <span style="color:#00f;font-weight:700">=</span> suffix;
    }
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> getSuffix() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>suffix;
    }
    pointcut doWriting() <span style="color:#00f;font-weight:700">:</span>
        execution(<span style="color:#00f;font-weight:700">*</span>
    <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5<span style="color:#00f;font-weight:700">.</span>MessageWriter</span><span style="color:#00f;font-weight:700">.</span>writeMessage());
    before() <span style="color:#00f;font-weight:700">:</span> doWriting() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(prefix);
    }
    after() <span style="color:#00f;font-weight:700">:</span> doWriting() {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(suffix);
    }
}
</pre>
                                        <div class="Para" id="Par430">Essentially, we create an aspect called <span class="EmphasisFontCategoryNonProportional">MessageWrapper</span>, and, just as with a normal Java class, we give the aspect two properties, <span class="EmphasisFontCategoryNonProportional">suffix</span>                                            and <span class="EmphasisFontCategoryNonProportional">prefix</span>, which we will use when advising the <span class="EmphasisFontCategoryNonProportional">writeMessage()</span> method. Next, we define a named
                                            pointcut, <span class="EmphasisFontCategoryNonProportional">doWriting()</span>, for a single joinpoint, in this case, the execution of the <span class="EmphasisFontCategoryNonProportional">writeMessage()</span>                                            method. AspectJ has a large number of joinpoints, but coverage of those is outside the scope of this example. Finally, we define two bits of advice: one that executes before the <span class="EmphasisFontCategoryNonProportional">doWriting()</span>                                            pointcut and one that executes after it. The following configuration snippet shows how this aspect is configured in Spring (<span class="EmphasisFontCategoryNonProportional">app-config-xml.xml</span>):</div>
                                        <pre style="background:#fff;color:#000"><span style="color:#68685b">&lt;?<span style="color:#888">xml</span><span style="color:#888"> version</span>=<span style="color:#888">1.0</span><span style="color:#888"> encoding</span>=<span style="color:#888">UTF-8</span>?&gt;</span>
<span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> <span style="font-style:italic">xmlns</span>=<span style="color:#036a07">http://www.springframework.org/schema/beans</span>
    <span style="font-style:italic">xmlns</span>:xsi=<span style="color:#036a07">http://www.w3.org/2001/XMLSchema-instance</span>
    <span style="font-style:italic">xmlns</span>:aop=<span style="color:#036a07">http://www.springframework.org/schema/aop</span>
    <span style="font-style:italic">xmlns</span>:context=<span style="color:#036a07">http://www.springframework.org/schema/context</span>
    <span style="font-style:italic">xsi</span>:schemaLocation=<span style="color:#036a07">http://www.springframework.org/schema/aop
      http://www.springframework.org/schema/aop/spring-aop.xsd
      http://www.springframework.org/schema/beans
      http://www.springframework.org/schema/beans/spring-beans.xsd
      http://www.springframework.org/schema/context
      http://www.springframework.org/schema/context/spring-context.xsd</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">aop</span><span style="font-weight:700">:</span><span style="font-weight:700">aspectj-autoproxy</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">context</span><span style="font-weight:700">:</span><span style="font-weight:700">component-scan</span>
      <span style="font-style:italic">base-package</span>=<span style="color:#036a07">com.apress.prospring5.ch5</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
                                    <div class="Para" id="Par432">As you can see, much of the configuration of the aspect bean is similar to standard bean configuration. The only difference is the use of the <span class="EmphasisFontCategoryNonProportional">factory-method</span> attribute
                                        of the <span class="EmphasisFontCategoryNonProportional">&lt;bean&gt;</span> tag. The <span class="EmphasisFontCategoryNonProportional">factory-method</span> attribute is intended to allow classes that follow a
                                        traditional Factory pattern to be integrated seamlessly into Spring. For instance, if you have a class <span class="EmphasisFontCategoryNonProportional">Foo</span> with a private constructor and then a static factory
                                        method, <span class="EmphasisFontCategoryNonProportional">getInstance()</span>, using the <span class="EmphasisFontCategoryNonProportional">factory-method</span> attribute allows a bean of this class to be managed
                                        by Spring. The <span class="EmphasisFontCategoryNonProportional">aspectOf()</span> method exposed by every AspectJ aspect allows you to access the instance of the aspect and thus allows Spring to set the properties
                                        of the aspect. Here you can see a simple driver application for this example:</div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch5</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AspectJDemo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/app-context-xml.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">MessageWriter</span> writer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">MessageWriter</span>();
        writer<span style="color:#00f;font-weight:700">.</span>writeMessage();
        writer<span style="color:#00f;font-weight:700">.</span>foo();
    }
}
</pre>
                                    <div class="Para" id="Par434">Notice that first we load <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> to allow Spring to configure the aspect. Next we create an instance of <span class="EmphasisFontCategoryNonProportional">MessageWriter</span>                                        and then invoke the <span class="EmphasisFontCategoryNonProportional">writeMessage()</span> and <span class="EmphasisFontCategoryNonProportional">foo()</span> methods. The output from this example is as follows:</div>
                                    <div class="Para" id="Par435">
                                        <div class="ProgramCode" id="PC111">
                                            <div class="FixedLine">The Prefix</div>
                                            <div class="FixedLine">foobar!</div>
                                            <div class="FixedLine">The Suffix</div>
                                            <div class="FixedLine">foo</div>
                                        </div>
                                        </div>
                                        <div class="Para" id="Par436">As you can see, the advice in the <span class="EmphasisFontCategoryNonProportional">MessageWrapper</span> aspect was applied to the <span class="EmphasisFontCategoryNonProportional">writeMessage()</span> method,
                                            and the prefix and suffix values specified in the <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> configuration were used by the advice when writing out the before and after messages.</div>
                                        </div>
                                        </div>
                                        <div class="Section1 RenderAsSection1" id="Sec62">
                                            <h2 class="Heading">Summary</h2>
                                            <div class="Para" id="Par437">In this chapter, we covered a large number of AOP core concepts and looked at how these concepts translate into the Spring AOP implementation. We discussed the features that are (and are not) implemented in
                                                Spring AOP, and we pointed to AspectJ as an AOP solution for those features that Spring does not implement. We spent some time explaining the details of the advice types available in Spring, and you saw
                                                examples of the four types in action. We also looked at how you limit the methods to which advice applies by using pointcuts. In particular, we looked at the six basic pointcut implementations available
                                                with Spring. We also covered the details of how the AOP proxies are constructed, the different options, and what makes them different. We compared performance among three proxy types and highlighted some
                                                major differences and restrictions for choosing between a JDK vs. CGLIB proxy. We covered the advanced options for pointcutting, as well as how to extend the set of interfaces implemented by an object using
                                                introductions. We also covered Spring Framework services to configure AOP declaratively, thus avoiding the need to hard-code AOP proxy construction logic into your code. We spent some time looking at how
                                                Spring and AspectJ are integrated to allow you to use the added power of AspectJ without losing any of the flexibility of Spring. That’s certainly a lot of AOP!</div>
                                            <div class="Para" id="Par438">In the next chapter, we move on to a completely different topic—how we can use Spring’s JDBC support to radically simplify the creation of JDBC-based data access code.</div>
                                        </div>
                                        <div class="FootnoteSection">
                                            <div class="Heading">Footnotes</div>
                                            <div class="Footnote" id="Fn1"><span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Chapter.html#Fn1_source">1</a></span>
                                                <div class="FootnoteParas">
                                                    <div class="Para" id="Par6"> <span class="ExternalRef"><a href="http://eclipse.org/aspectj"><span class="RefSource">                        <span class="EmphasisFontCategoryNonProportional">http://eclipse.org/aspectj</span> </span>
                                                        </a>
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="ClearBoth"> </div>
                                            </div>
                                            <div class="Footnote" id="Fn2"><span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Chapter.html#Fn2_source">2</a></span>
                                                <div class="FootnoteParas">
                                                    <div class="Para" id="Par144">UML is quite important in development because it is a way to simplify application logic and make it visual, thus making it easy to detect issues before the code is even written. It can also be used as
                                                        documentation when introducing new members to a team, making them productive as soon as possible. You can find more information at <span class="ExternalRef"><a href="http://www.uml.org/"><span class="RefSource">                      <span class="EmphasisFontCategoryNonProportional">www.uml.org/</span>                                                        </span>
                                                        </a>
                                                        </span>.</div>
                                                </div>
                                                <div class="ClearBoth"> </div>
                                            </div>
                                        </div>
                                        </div>
                                        <div class="annotator-outer annotator-viewer viewer annotator-hide"> </div>
                                        </div>
                                        </div>
                                        </section>
                                        </div>
                                        </div>



<hr/>
<!--if IE]><![endif]-->

<!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"            itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"data-offline-url="/"data-url="/library/view/pro-spring-5/9781484228081/A315511_5_En_6_Chapter.html"data-csrf-cookie="csrfsafari"data-highlight-privacy=""  data-user-id="3866890"  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"  data-username="levinxccai"  data-account-type="B2B"    data-activated-trial-date="11/06/2017"  data-archive="9781484228081"  data-publishers="Apress"  data-htmlfile-name="A315511_5_En_6_Chapter.html"  data-epub-title="Pro Spring 5: An In-Depth Guide to the Spring Framework and Its Tools" data-debug=0 data-testing=0><![endif]-->
<!--if gt IE 8]><!-->

<!--![endif]-->




<a name="7_"></a>

    <div class="application" id="container" style="height: auto;">
        <div class="js-toc">
            <section role="document">
                <div id="sbo-rt-content" style="max-width:72.5em; transform: none;">
                    <div class="annotator-wrapper">
                        <!--egin Abstract-->
                        <div class="MainTitleSection">
                            <h1 class="ChapterTitle" xml:lang="en">6. Spring JDBC Support</h1>
                        </div>
                        <div class="AuthorGroup">
                            <div class="AuthorNames"><span class="Author"><span class="AuthorName">Iuliana Cosmina</span><sup>1 <span class="ContactIcon"></span></sup>, </span><span class="Author"><span class="AuthorName">Rob Harrop</span><sup>2</sup>, </span>
                                <span class="Author"><span class="AuthorName">Chris Schaefer</span><sup>3</sup> and </span><span class="Author"><span class="AuthorName">Clarence Ho</span><sup>4</sup></span>
                            </div>
                            <div class="Affiliations">
                                <div class="Affiliation" id="Aff5"><span class="AffiliationNumber">(1)</span>
                                    <div class="AffiliationText">Sibiu, Sibiu, Romania</div>
                                </div>
                                <div class="Affiliation" id="Aff6"><span class="AffiliationNumber">(2)</span>
                                    <div class="AffiliationText">Reddish, UK</div>
                                </div>
                                <div class="Affiliation" id="Aff7"><span class="AffiliationNumber">(3)</span>
                                    <div class="AffiliationText">Venice, Florida, USA</div>
                                </div>
                                <div class="Affiliation" id="Aff8"><span class="AffiliationNumber">(4)</span>
                                    <div class="AffiliationText">Hong Kong, China</div>
                                </div>
                                <div class="ClearBoth"> </div>
                            </div>
                        </div>
                        <!--nd Abstract-->
                        <div class="Fulltext">
                            <div class="Para" id="Par1">By now you have seen how easy it is to build a fully Spring-managed application. You have a solid understanding of bean configuration and aspect-oriented programming (AOP). However, one part of the puzzle is missing: how do
                                you get the data that drives the application?</div>
                            <div class="Para" id="Par2">Besides simple throwaway command-line utilities, almost every application needs to persist data to some sort of data store. The most usual and convenient data store is a <span id="ITerm1">relational database              </span>.</div>
                            <div class="Para" id="Par3">These are the top seven relational enterprise databases for 2017:
                                <div class="UnorderedList">
                                    <ul class="UnorderedListMarkBullet">
                                        <li>
                                            <div class="Para" id="Par4">Oracle Database</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par5">Microsoft SQL Server</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par6">IBM DB2</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par7">SAP Sybase ASE</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par8">PostgreSQL</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par9">MariaDB Enterprise</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par10">MySQL</div>
                                        </li>
                                    </ul>
                                </div>
                        </div>
                        <div class="Para" id="Par11">If you are not working for a big company that can afford licenses for the first four, you probably are using one of the last three in the previous list. The most used open source relational databases are perhaps MySQL (<span class="ExternalRef"><a href="http://mysql.com/"><span class="RefSource">              <span class="EmphasisFontCategoryNonProportional">http://mysql.com</span>                            </span>
                            </a>
                            </span>) and PostgreSQL (<span class="EmphasisFontCategoryNonProportional">postgresql.org</span>). MySQL is generally more widely used for web application development, especially on the Linux platform.<a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_6_Chapter.html#Fn1" id="Fn1_source"><sup>1</sup></a> On the other side, PostgreSQL is friendlier to Oracle developers because its procedural language, PLpgSQL, is very close to Oracle’s PL/SQL language.</div>
                        <div class="Para" id="Par13">Even if you choose the fastest and most reliable database, you cannot afford to lose its speed and flexibility by using a poorly designed and implemented data access layer. Applications tend to use the data access layer very frequently;
                            thus, any unnecessary bottlenecks in the data access code impact the entire application, no matter how well designed it is.</div>
                        <div class="Para" id="Par14">In this chapter, we show you how you can use Spring to simplify the implementation of data access code using JDBC. We start by looking at the large and repetitive amount of code you would normally need to write without Spring and
                            then compare it to a class implemented using Spring’s data access classes. The result is truly amazing because Spring allows you to use the full power of human-tuned SQL queries while minimizing the amount of support code you
                            need to <span id="ITerm2">implement              </span>. Specifically, we discuss the following:
                            <div class="UnorderedList">
                                <ul class="UnorderedListMarkBullet">
                                    <li>
                                        <div class="Para" id="Par15"> <span class="EmphasisTypeItalic">Comparing traditional JDBC code and Spring JDBC support</span>: We explore how Spring simplifies the old-style JDBC code while keeping the same functionality. You will also see how
                                            Spring accesses the low-level JDBC API and how this low-level API is mapped into convenient classes such as <span class="EmphasisFontCategoryNonProportional">JdbcTemplate</span>.</div>
                                    </li>
                                    <li>
                                        <div class="Para" id="Par16"> <span class="EmphasisTypeItalic">Connecting to the database</span>: Even though we do not go into every little detail of database connection management, we do show you the fundamental differences between a simple
                                            <span class="EmphasisFontCategoryNonProportional">Connection</span> and a <span class="EmphasisFontCategoryNonProportional">DataSource</span>. Naturally, we discuss how Spring manages the data sources and which
                                            data sources you can use in your applications.</div>
                                    </li>
                                    <li>
                                        <div class="Para ParaOneEmphasisChild" id="Par17"> <span class="EmphasisTypeItalic">Retrieving and mapping the data to Java objects</span>: We show you how to retrieve data and then how to effectively map the selected data to Java objects. You also learn that Spring
                                            JDBC is a viable alternative to object-relational mapping (ORM) tools.</div>
                                    </li>
                                    <li>
                                        <div class="Para ParaOneEmphasisChild" id="Par18"> <span class="EmphasisTypeItalic">Inserting, updating, and deleting data</span>: Finally, we discuss how you can implement the insert, update, and delete operations by using Spring to execute these types of queries.</div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="Section1 RenderAsSection1" id="Sec1">
                            <h2 class="Heading">Introducing Lambda Expressions</h2>
                            <div class="Para" id="Par19">The release of Java version 8 brings <span id="ITerm3">lambda expression                            </span> support, among many other features. Lambda expressions make a great replacement for anonymous inner class usage and
                                are an ideal candidate for working with Spring’s JDBC support. The usage of lambda expressions requires the use of Java 8. This book was written during the prerelease versions of Java 8 and the first General Availability
                                version, so we understand not everybody will be using Java 8 yet. Given that, the chapter code samples and source code download show both flavors where applicable. Lambda expressions are suitable in most places of the Spring
                                API where templates or callbacks are used, not just limited to JDBC. This chapter does not cover lambda expressions themselves, as they are a Java language feature, and you should be familiar with lambda concepts and syntax.
                                Please refer to the Lambda Expressions tutorial at <span class="ExternalRef"><a href="http://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html"><span class="RefSource">                <span class="EmphasisFontCategoryNonProportional">http://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html</span>                                </span>
                                </a>
                                </span> for more information.</div>
                        </div>
                        <div class="Section1 RenderAsSection1" id="Sec2">
                            <h2 class="Heading">Sample Data Model for Example Code</h2>
                            <div class="Para" id="Par20">Before proceeding with the discussion, we introduce a simple data model that is used for the examples throughout this chapter, as well as the next few chapters when discussing other data access techniques (we will expand the
                                model accordingly to fulfill the needs of each topic as we go).</div>
                            <div class="Para" id="Par21">The model is a simple music database with two tables. The first one is the <span class="EmphasisFontCategoryNonProportional">SINGER</span> table, which stores a singer’s information, and the other table is <span class="EmphasisFontCategoryNonProportional">ALBUM</span>,
                                which stores the albums released by that singer. Each singer can have zero or more albums; in other words, it’s a one-to-many relationship between <span class="EmphasisFontCategoryNonProportional">SINGER</span> and
                                <span class="EmphasisFontCategoryNonProportional">ALBUM</span>. A singer’s information includes their first and last names and date of birth. Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_6_Chapter.html#Fig1">6-1</a></span>                                    shows the <span id="ITerm4">entity-relationship (ER)                            </span> diagram of the database.
                                    <div class="Figure" id="Fig1">
                                        <div class="MediaObject" id="MO1"><img alt="A315511_5_En_6_Fig1_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_6_Fig1_HTML.jpg" height="148" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_6_Fig1_HTML.jpg" width="686"/></div>
                                        <div class="Caption" xml:lang="en">
                                            <div class="CaptionContent"><span class="CaptionNumber">Figure 6-1.</span>
                                                <div class="SimplePara">Simple data model for the example code</div>
                                            </div>
                                    </div>
                            </div>
                        </div>
                        <div class="Para" id="Par22">As you can see, both tables have an ID column that will be automatically assigned by the database during insertion. For the <span class="EmphasisFontCategoryNonProportional">ALBUM</span> table, there is a foreign-key relation to
                            the <span class="EmphasisFontCategoryNonProportional">SINGER</span> table, which is linked by the column <span class="EmphasisFontCategoryNonProportional">SINGER_ID</span> with the primary key of the <span class="EmphasisFontCategoryNonProportional">SINGER</span>                            table (that is, the ID column).</div>
                        <div class="Para ParaTypeImportant" id="Par23"><img alt="A315511_5_En_6_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_6_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_6_Figa_HTML.jpg" width="30"/>                            In this chapter, we use the open source database MySQL to show interactions with a real database in some examples. This will require you to have an instance of MySQL available to use. We do not cover how to install MySQL. You
                            can use another database of your choice, but you may need to modify the schema and function definitions. We also cover embedded database usage, which does not require a MySQL database.</div>
                        <div class="Para" id="Par24">Just in case you want to use <span id="ITerm5">MySQL                            </span>, on the official site you can find very good tutorials on installing and configuring MySQL. After you have downloaded MySQL<a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_6_Chapter.html#Fn2" id="Fn2_source"><sup>2</sup></a> and installed it, you can access it using the <span class="EmphasisFontCategoryNonProportional">root</span> account. Usually, when you develop an application, you need
                            a new schema and user. For the code samples in this chapter, the schema is named <span class="EmphasisFontCategoryNonProportional">MUSICDB</span>, and the user to access it is named <span class="EmphasisFontCategoryNonProportional">prospring5</span>.
                            The SQL code to execute to create them is depicted next, and you can find them in the <span class="EmphasisFontCategoryNonProportional">ddl.sql</span> file, under the <span class="EmphasisFontCategoryNonProportional">resources</span>                            directory of the <span class="EmphasisFontCategoryNonProportional">plain-jdbc</span> project. Included is a fix for a bug in the MySQL Community Server version 5.17.18, the current version at the time this book was written.</div>
                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">CREATE</span> <span style="color:#00f;font-weight:700">USER</span> &apos;<span style="color:#0000a2;font-weight:700">prospring5</span>&apos;@<span style="color:#036a07">localhost</span> IDENTIFIED BY <span style="color:#036a07">prospring5</span>;
<span style="color:#00f;font-weight:700">CREATE</span> <span style="color:#00f;font-weight:700">SCHEMA</span> <span style="color:#0000a2;font-weight:700">MUSICDB</span>;
<span style="color:#00f;font-weight:700">GRANT</span> ALL PRIVILEGES <span style="color:#00f;font-weight:700">ON</span> MUSICDB . <span style="color:#00f;font-weight:700">*</span> TO <span style="color:#036a07">prospring5</span>@<span style="color:#036a07">localhost</span>;
FLUSH PRIVILEGES;
<span style="color:#06f;font-style:italic">/*in case of java.sql.SQLException: The server timezone value &apos;UTC&apos;
       is unrecognized or represents more than one timezone. */</span>
<span style="color:#00f;font-weight:700">SET</span> GLOBAL time_zone <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">+3:00</span>;
</pre>
                    <div class="Para" id="Par27">The following code snippet depicts the SQL code necessary to create the two tables mentioned previously. This code is in the <span id="ITerm6">              <span class="EmphasisFontCategoryNonProportional">resources</span> </span>
                        directory of the <span class="EmphasisFontCategoryNonProportional">plain-jdbc</span> project in <span class="EmphasisFontCategoryNonProportional">schema.sql</span>.</div>
                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">CREATE</span> <span style="color:#00f;font-weight:700">TABLE</span> <span style="color:#0000a2;font-weight:700">singer</span> 
  ( 
     id         <span style="color:#00f;font-weight:700">INT</span> <span style="color:#00f;font-weight:700">NOT NULL</span> auto_increment, 
     first_name <span style="color:#00f;font-weight:700">VARCHAR</span>(<span style="color:#0000cd">60</span>) <span style="color:#00f;font-weight:700">NOT NULL</span>, 
     last_name  <span style="color:#00f;font-weight:700">VARCHAR</span>(<span style="color:#0000cd">40</span>) <span style="color:#00f;font-weight:700">NOT NULL</span>, 
     birth_date <span style="color:#00f;font-weight:700">DATE</span>, 
     UNIQUE uq_singer_1 (first_name, last_name), 
     <span style="color:#00f;font-weight:700">PRIMARY KEY</span> (id) 
  ); 

<span style="color:#00f;font-weight:700">CREATE</span> <span style="color:#00f;font-weight:700">TABLE</span> <span style="color:#0000a2;font-weight:700">album</span> 
  ( 
     id           <span style="color:#00f;font-weight:700">INT</span> <span style="color:#00f;font-weight:700">NOT NULL</span> auto_increment, 
     singer_id    <span style="color:#00f;font-weight:700">INT</span> <span style="color:#00f;font-weight:700">NOT NULL</span>, 
     title        <span style="color:#00f;font-weight:700">VARCHAR</span>(<span style="color:#0000cd">100</span>) <span style="color:#00f;font-weight:700">NOT NULL</span>, 
     release_date <span style="color:#00f;font-weight:700">DATE</span>, 
     UNIQUE uq_singer_album_1 (singer_id, title), 
     <span style="color:#00f;font-weight:700">PRIMARY KEY</span> (id), 
     <span style="color:#00f;font-weight:700">CONSTRAINT</span> fk_album <span style="color:#00f;font-weight:700">FOREIGN KEY</span> (singer_id) <span style="color:#00f;font-weight:700">REFERENCES</span> singer (id) 
  ); 
</pre>
                    <div class="Para" id="Par29">If you use a smart editor like IntelliJ IDEA, you can use the <span id="ITerm7">Database                            </span> view to inspect your schema and tables. In Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_6_Chapter.html#Fig2">6-2</a></span>                        you can see the contents of the <span class="EmphasisFontCategoryNonProportional">MUSICDB</span> schema as depicted in IntelliJ IDEA.
                        <div class="Figure" id="Fig2">
                            <div class="MediaObject" id="MO2"><img alt="A315511_5_En_6_Fig2_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_6_Fig2_HTML.jpg" height="419" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_6_Fig2_HTML.jpg" width="396"/></div>
                            <div class="Caption" xml:lang="en">
                                <div class="CaptionContent"><span class="CaptionNumber">Figure 6-2.</span>
                                    <div class="SimplePara">Contents of the MUSICDB <span id="ITerm8">schema                                                    </span> </div>
                                </div>
                        </div>
                    </div>
                </div>
                <div class="Para" id="Par30">Because we need data to test the JDBC usage, a file named <span class="EmphasisFontCategoryNonProportional">test-data.sql</span> is also provided containing a set of <span class="EmphasisFontCategoryNonProportional">INSERT</span> statements
                    that populate the two tables.</div>
                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">INSERT INTO</span> singer 
            (first_name, 
             last_name, 
             birth_date) 
<span style="color:#00f;font-weight:700">VALUES</span>      (<span style="color:#036a07">John</span>, 
             <span style="color:#036a07">Mayer</span>, 
             <span style="color:#036a07">1977-10-16</span>); 

<span style="color:#00f;font-weight:700">INSERT INTO</span> singer 
            (first_name, 
             last_name, 
             birth_date) 
<span style="color:#00f;font-weight:700">VALUES</span>      (<span style="color:#036a07">Eric</span>, 
             <span style="color:#036a07">Clapton</span>, 
             <span style="color:#036a07">1945-03-30</span>); 

<span style="color:#00f;font-weight:700">INSERT INTO</span> singer 
            (first_name, 
             last_name, 
             birth_date) 
<span style="color:#00f;font-weight:700">VALUES</span>      (<span style="color:#036a07">John</span>, 
             <span style="color:#036a07">Butler</span>, 
             <span style="color:#036a07">1975-04-01</span>); 

<span style="color:#00f;font-weight:700">INSERT INTO</span> album 
            (singer_id, 
             title, 
             release_date) 
<span style="color:#00f;font-weight:700">VALUES</span>      (<span style="color:#0000cd">1</span>, 
             <span style="color:#036a07">The Search For Everything</span>, 
             <span style="color:#036a07">2017-01-20</span>); 

<span style="color:#00f;font-weight:700">INSERT INTO</span> album 
            (singer_id, 
             title, 
             release_date) 
<span style="color:#00f;font-weight:700">VALUES</span>      (<span style="color:#0000cd">1</span>, 
             <span style="color:#036a07">Battle Studies</span>, 
             <span style="color:#036a07">2009-11-17</span>); 

<span style="color:#00f;font-weight:700">INSERT INTO</span> album 
            (singer_id, 
             title, 
             release_date) 
<span style="color:#00f;font-weight:700">VALUES</span>      (<span style="color:#0000cd">2</span>, 
             <span style="color:#036a07"> From The Cradle </span>, 
             <span style="color:#036a07">1994-09-13</span>); 
</pre>
                <div class="Para" id="Par32">In later sections of this chapter, you will see examples of retrieving the data via JDBC from the database and directly mapping the result set into Java objects (that is, POJOs). These classes that map to the records in tables are also
                    called <span id="ITerm9">              <span class="EmphasisFontCategoryNonProportional">entities</span> </span>. For the <span class="EmphasisFontCategoryNonProportional">SINGER</span> table, a <span class="EmphasisFontCategoryNonProportional">Singer</span>                    class will be created that will be instantiated to create Java objects that map to singer records.</div>
                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6.entities</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.io.Serializable</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.sql.Date</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.ArrayList</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Singer</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Serializable</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Long</span> id;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> firstName;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> lastName;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Date</span> birthDate;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Album</span>&gt;</span> albums;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setId</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">id</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>id <span style="color:#00f;font-weight:700">=</span> id;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Long</span> <span style="color:#0000a2;font-weight:700">getId</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>id;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setFirstName</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">firstName</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>firstName <span style="color:#00f;font-weight:700">=</span> firstName;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getFirstName</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>firstName;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setLastName</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">lastName</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>lastName <span style="color:#00f;font-weight:700">=</span> lastName;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getLastName</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>lastName;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">boolean</span> <span style="color:#0000a2;font-weight:700">addAbum</span>(<span style="color:#00f;font-weight:700">Album</span> <span style="font-style:italic">album</span>) {
        <span style="color:#00f;font-weight:700">if</span> (albums <span style="color:#00f;font-weight:700">==</span> <span style="color:#585cf6;font-weight:700">null</span>) {
            albums <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ArrayList&lt;&gt;</span>();
            albums<span style="color:#00f;font-weight:700">.</span>add(album);
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#585cf6;font-weight:700">true</span>;
        } <span style="color:#00f;font-weight:700">else</span> {
            <span style="color:#00f;font-weight:700">if</span> (albums<span style="color:#00f;font-weight:700">.</span>contains(album)) {
                <span style="color:#00f;font-weight:700">return</span> <span style="color:#585cf6;font-weight:700">false</span>;
            }
        }
        albums<span style="color:#00f;font-weight:700">.</span>add(album);
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#585cf6;font-weight:700">true</span>;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setAlbums</span>(<span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Album</span>&gt;</span> <span style="font-style:italic">albums</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>albums <span style="color:#00f;font-weight:700">=</span> albums;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Album</span>&gt;</span> <span style="color:#0000a2;font-weight:700">getAlbums</span>() {
        <span style="color:#00f;font-weight:700">return</span> albums;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setBirthDate</span>(<span style="color:#00f;font-weight:700">Date</span> <span style="font-style:italic">birthDate</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>birthDate <span style="color:#00f;font-weight:700">=</span> birthDate;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Date</span> <span style="color:#0000a2;font-weight:700">getBirthDate</span>() {
        <span style="color:#00f;font-weight:700">return</span> birthDate;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">toString</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">Singer - Id: </span> <span style="color:#00f;font-weight:700">+</span> id <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">, First name: </span> <span style="color:#00f;font-weight:700">+</span> firstName
                <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">, Last name: </span> <span style="color:#00f;font-weight:700">+</span> lastName <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">, Birthday: </span> <span style="color:#00f;font-weight:700">+</span> birthDate;
    }
}</pre>
                <div class="Para ParaOneEmphasisChild" id="Par34">In a similar manner, an <span class="EmphasisFontCategoryNonProportional">Album</span> class is created as well.</div>
                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6.entities</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.io.Serializable</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.sql.Date</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Album</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Serializable</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Long</span> id;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Long</span> singerId;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> title;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Date</span> releaseDate;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setId</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">id</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>id <span style="color:#00f;font-weight:700">=</span> id;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Long</span> <span style="color:#0000a2;font-weight:700">getId</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>id;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setSingerId</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">singerId</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>singerId <span style="color:#00f;font-weight:700">=</span> singerId;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Long</span> <span style="color:#0000a2;font-weight:700">getSingerId</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>singerId;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setTitle</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">title</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>title <span style="color:#00f;font-weight:700">=</span> title;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getTitle</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>title;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setReleaseDate</span>(<span style="color:#00f;font-weight:700">Date</span> <span style="font-style:italic">releaseDate</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>releaseDate <span style="color:#00f;font-weight:700">=</span> releaseDate;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Date</span> <span style="color:#0000a2;font-weight:700">getReleaseDate</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>releaseDate;
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">toString</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">Album - Id: </span> <span style="color:#00f;font-weight:700">+</span> id <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">, Singer id: </span> <span style="color:#00f;font-weight:700">+</span> singerId
                <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">, Title: </span> <span style="color:#00f;font-weight:700">+</span> title <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">, Release Date: </span> <span style="color:#00f;font-weight:700">+</span> releaseDate;
    }
}
</pre>
                <div class="Para ParaOneEmphasisChild" id="Par36">Let’s start with a simple interface for <span class="EmphasisFontCategoryNonProportional">SingerDao</span> that encapsulates all the data access services for singer information. The code is as follows:</div>
                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6.dao</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6.entities.Singer</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">SingerDao</span> {
    <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAll</span>();

    <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findByFirstName</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">firstName</span>);

    <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">findLastNameById</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">id</span>);

    <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">findFirstNameById</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">id</span>);

    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">insert</span>(<span style="color:#00f;font-weight:700">Singer</span> <span style="font-style:italic">singer</span>);

    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">update</span>(<span style="color:#00f;font-weight:700">Singer</span> <span style="font-style:italic">singer</span>);

    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">delete</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">singerId</span>);

    <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAllWithDetail</span>();

    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">insertWithDetail</span>(<span style="color:#00f;font-weight:700">Singer</span> <span style="font-style:italic">singer</span>);
} 
</pre>
                <div class="Para" id="Par38">In the previous interface, we define two finder methods and the insert, update, and delete methods, respectively. They correspond to the CRUD terms (create, read, update, delete).</div>
                <div class="Para" id="Par39">Finally, to facilitate testing, let’s modify the <span class="EmphasisFontCategoryNonProportional">logback.xml</span> configuration file to turn the log level to <span class="EmphasisFontCategoryNonProportional">DEBUG</span> for all classes.
                    At the <span class="EmphasisFontCategoryNonProportional">DEBUG</span> level, the Spring JDBC module will output all the underlying SQL statements being fired to the database so you know what exactly is going on; this is especially
                    useful for troubleshooting SQL statement syntax errors. The following configuration sample depicts the contents of the <span class="EmphasisFontCategoryNonProportional">logback.xml</span> file (residing under <span class="EmphasisFontCategoryNonProportional">src/main/resources</span>                    with the source code files for the Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_6_Chapter.html"><span class="RefSource">6</span></a>
                    </span>
                    project) with the <span id="ITerm14">          <span class="EmphasisFontCategoryNonProportional">DEBUG</span> level </span> turned on.</div>
                <div class="Para" id="Par40">
                    <div class="ProgramCode" id="PC7">
                        <div class="LineGroup">
                            <div class="FixedLine">&lt;?xml version=&quot;1.0&quot;  encoding=&quot;UTF-8&quot;?&gt;</div>
                            <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#68685b">&lt;?<span style="color:#888">xml</span><span style="color:#888"> version</span>=<span style="color:#888">1.0</span> <span style="color:#888"> encoding</span>=<span style="color:#888">UTF-8</span>?&gt;</span>
<span style="color:#1c02ff">&lt;<span style="font-weight:700">configuration</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">contextListener</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">ch.qos.logback.classic.jul.LevelChangePropagator</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">resetJUL</span>&gt;</span>true<span style="color:#1c02ff">&lt;/<span style="font-weight:700">resetJUL</span>&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">contextListener</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">appender</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">console</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">ch.qos.logback.core.ConsoleAppender</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">encoder</span>&gt;</span>
            <span style="color:#1c02ff">&lt;<span style="font-weight:700">pattern</span>&gt;</span>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{5} - %msg%n<span style="color:#1c02ff">&lt;/<span style="font-weight:700">pattern</span>&gt;</span>
        <span style="color:#1c02ff">&lt;/<span style="font-weight:700">encoder</span>&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">appender</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">logger</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">com.apress.prospring5.ch5</span> <span style="font-style:italic">level</span>=<span style="color:#036a07">debug</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">logger</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">org.springframework</span> <span style="font-style:italic">level</span>=<span style="color:#036a07">off</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">root</span> <span style="font-style:italic">level</span>=<span style="color:#036a07">debug</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">appender-ref</span> <span style="font-style:italic">ref</span>=<span style="color:#036a07">console</span> /&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">root</span>&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">configuration</span>&gt;</span>
</pre></span> </div>
                        </div>
                    </div>
                </div>
        </div>
        <div class="Section1 RenderAsSection1" id="Sec3">
            <h2 class="Heading">Exploring the JDBC Infrastructure</h2>
            <div class="Para" id="Par41">JDBC provides a standard way for Java applications to access data stored in a database. The core of the JDBC infrastructure is a driver that is specific to each database; it is this driver that allows Java code to access the database.</div>
            <div class="Para" id="Par42">Once a driver is loaded, it registers itself with a <span class="EmphasisFontCategoryNonProportional">java.sql.DriverManager</span> class. This class manages a list of drivers and provides static methods for establishing connections to the
                database. The <span class="EmphasisFontCategoryNonProportional">DriverManager</span>’s <span class="EmphasisFontCategoryNonProportional">getConnection()</span> method returns a driver-implemented <span class="EmphasisFontCategoryNonProportional">java.sql.Connection</span>                interface. This interface allows you to run SQL statements against the database.</div>
        <div class="Para" id="Par43">The JDBC framework is quite complex and well tested; however, with this complexity comes difficulty in development. The first level of complexity lies in making sure your code manages the connections to the database. A connection is a scarce resource
            and is very expensive to establish. Generally, the database creates a thread or spawns a child process for each connection. Also, the number of concurrent connections is usually limited, and an excessive number of open connections will slow
            down the database.</div>
        <div class="Para" id="Par44">We will show you how Spring helps manage this complexity, but before we can proceed any further, we need to show you how to select, delete, and update data in pure JDBC.</div>
        <div class="Para" id="Par45">All projects covered in this chapter need special databases libraries as dependencies: <span class="EmphasisFontCategoryNonProportional">mysql-connector</span>, <span class="EmphasisFontCategoryNonProportional">spring-jdbc</span>, <span class="EmphasisFontCategoryNonProportional">dbcp</span>,
            and so on. Just look in the <span class="EmphasisFontCategoryNonProportional">build.gradle</span> configuration files for each project and in the <span class="EmphasisFontCategoryNonProportional">pro-spring-15/build.gradle</span> for the version
            and libraries used.</div>
        <div class="Para" id="Par46">Let’s create a plain form of implementation of the <span class="EmphasisFontCategoryNonProportional">SingerDao</span> interface for interacting with the database via pure JDBC. Keeping in mind what we already know about database connections, we
            will take the cautious and expensive (in terms of performance) approach of creating a connection for each statement. This greatly degrades the performance of Java and adds extra stress to the database because a connection has to be established
            for each query. However, if we kept a connection open, we could bring the database server to a halt. The following code snippet shows the code required for managing a JDBC connection, using <span id="ITerm16">MySQL                  </span>            as an example:</div>
        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6.dao</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.sql.DriverManager</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.sql.SQLException</span>;<span style="color:#00f;font-weight:700">.</span><span style="color:#00f;font-weight:700">.</span>.

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">PlainSingerDao</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerDao</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">PlainSingerDao</span><span style="color:#00f;font-weight:700">.</span>class);

    <span style="color:#00f;font-weight:700">static</span> {
        <span style="color:#00f;font-weight:700">try</span> {
            <span style="color:#00f;font-weight:700">Class</span><span style="color:#00f;font-weight:700">.</span>forName(<span style="color:#036a07">com.mysql.cj.jdbc.Driver</span>);
        } <span style="color:#00f;font-weight:700">catch</span> (<span style="color:#00f;font-weight:700">ClassNotFoundException</span> ex) {
            logger<span style="color:#00f;font-weight:700">.</span>error(<span style="color:#036a07">Prblem  loadng DB dDiver!</span>, ex);
        }
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Connection</span> <span style="color:#0000a2;font-weight:700">getConnection</span>() <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">SQLException</span> {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">DriverManager</span><span style="color:#00f;font-weight:700">.</span>getConnection(
                <span style="color:#036a07">jdbc:mysql://localhost:3306/musicdb?useSSL=true</span>,
                <span style="color:#036a07">prospring5</span>, <span style="color:#036a07">prospring5</span>);
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">closeConnection</span>(<span style="color:#00f;font-weight:700">Connection</span> <span style="font-style:italic">connection</span>) {
        <span style="color:#00f;font-weight:700">if</span> (connection <span style="color:#00f;font-weight:700">==</span> <span style="color:#585cf6;font-weight:700">null</span>) {
            <span style="color:#00f;font-weight:700">return</span>;
        }
        <span style="color:#00f;font-weight:700">try</span> {
            connection<span style="color:#00f;font-weight:700">.</span>close();
        } <span style="color:#00f;font-weight:700">catch</span> (<span style="color:#00f;font-weight:700">SQLException</span> ex) {
            logger<span style="color:#00f;font-weight:700">.</span>error(<span style="color:#036a07">Problem  closing  connection to the database!</span>, ex);
        }
    }
.<span style="color:#00f;font-weight:700">.</span>.
</pre>
        <div class="Para" id="Par48">This code is far from complete, but it gives you an idea of the steps you need in order to manage a JDBC connection. This code does not even deal with connection pooling, which is a common technique for managing connections to the database more
            effectively. We do not discuss connection pooling at this point (connection pooling is discussed in the “Database Connections and DataSources” section later in this chapter); instead, the following code snippet shows an implementation of the
            <span class="EmphasisFontCategoryNonProportional">findAll()</span>, <span class="EmphasisFontCategoryNonProportional">insert()</span>, and <span class="EmphasisFontCategoryNonProportional">delete()</span> methods of the <span id="ITerm18">              <span class="EmphasisFontCategoryNonProportional">SingerDao</span>            </span> interface using plain JDBC:</div>
        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6.dao</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.sql.PreparedStatement</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.sql.ResultSet</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.sql.SQLException</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.sql.Statement</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.ArrayList</span>;<span style="color:#00f;font-weight:700">.</span><span style="color:#00f;font-weight:700">.</span>.

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">PlainSingerDao</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerDao</span> {
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAll</span>() {
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> result <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ArrayList&lt;&gt;</span>();
        <span style="color:#00f;font-weight:700">Connection</span> connection <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">null</span>;
        <span style="color:#00f;font-weight:700">try</span> {
            connection <span style="color:#00f;font-weight:700">=</span> getConnection();
            <span style="color:#00f;font-weight:700">PreparedStatement</span> statement <span style="color:#00f;font-weight:700">=</span>
                    connection<span style="color:#00f;font-weight:700">.</span>prepareStatement(<span style="color:#036a07">select * from singer</span>);
            <span style="color:#00f;font-weight:700">ResultSet</span> resultSet <span style="color:#00f;font-weight:700">=</span> statement<span style="color:#00f;font-weight:700">.</span>executeQuery();
            <span style="color:#00f;font-weight:700">while</span> (resultSet<span style="color:#00f;font-weight:700">.</span>next()) {
                <span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Singer</span>();
                singer<span style="color:#00f;font-weight:700">.</span>setId(resultSet<span style="color:#00f;font-weight:700">.</span>getLong(<span style="color:#036a07">id</span>));
                singer<span style="color:#00f;font-weight:700">.</span>setFirstName(resultSet<span style="color:#00f;font-weight:700">.</span>getString(<span style="color:#036a07">first_name</span>));
                singer<span style="color:#00f;font-weight:700">.</span>setLastName(resultSet<span style="color:#00f;font-weight:700">.</span>getString(<span style="color:#036a07">last_name</span>));
                singer<span style="color:#00f;font-weight:700">.</span>setBirthDate(resultSet<span style="color:#00f;font-weight:700">.</span>getDate(<span style="color:#036a07">birth_date</span>));
                result<span style="color:#00f;font-weight:700">.</span>add(singer);
            }
            statement<span style="color:#00f;font-weight:700">.</span>close();
        } <span style="color:#00f;font-weight:700">catch</span> (<span style="color:#00f;font-weight:700">SQLException</span> ex){
            logger<span style="color:#00f;font-weight:700">.</span>error(<span style="color:#036a07">Problem when executing SELECT!</span>, ex);
        } <span style="color:#00f;font-weight:700">finally</span>{
            closeConnection(connection);
        }
        <span style="color:#00f;font-weight:700">return</span> result;
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">insert</span>(<span style="color:#00f;font-weight:700">Singer</span> <span style="font-style:italic">singer</span>) {
        <span style="color:#00f;font-weight:700">Connection</span> connection <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">null</span>;
        <span style="color:#00f;font-weight:700">try</span> {
            connection <span style="color:#00f;font-weight:700">=</span> getConnection();
            <span style="color:#00f;font-weight:700">PreparedStatement</span> statement <span style="color:#00f;font-weight:700">=</span> connection<span style="color:#00f;font-weight:700">.</span>prepareStatement(
                    <span style="color:#036a07">insert into Singer (first_name, last_name, birth_date)
                    values( ?, ?, ?)</span>
                    , <span style="color:#00f;font-weight:700">Statement</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>RETURN_GENERATED_KEYS</span>);
            statement<span style="color:#00f;font-weight:700">.</span>setString(<span style="color:#0000cd">1</span>, singer<span style="color:#00f;font-weight:700">.</span>getFirstName());
            statement<span style="color:#00f;font-weight:700">.</span>setString(<span style="color:#0000cd">2</span>, singer<span style="color:#00f;font-weight:700">.</span>getLastName());
            statement<span style="color:#00f;font-weight:700">.</span>setDate(<span style="color:#0000cd">3</span>, singer<span style="color:#00f;font-weight:700">.</span>getBirthDate());
            statement<span style="color:#00f;font-weight:700">.</span>execute();
            <span style="color:#00f;font-weight:700">ResultSet</span> generatedKeys <span style="color:#00f;font-weight:700">=</span> statement<span style="color:#00f;font-weight:700">.</span>getGeneratedKeys();
            <span style="color:#00f;font-weight:700">if</span> (generatedKeys<span style="color:#00f;font-weight:700">.</span>next()) {
                singer<span style="color:#00f;font-weight:700">.</span>setId(generatedKeys<span style="color:#00f;font-weight:700">.</span>getLong(<span style="color:#0000cd">1</span>));
            }
            statement<span style="color:#00f;font-weight:700">.</span>close();
        } <span style="color:#00f;font-weight:700">catch</span> (<span style="color:#00f;font-weight:700">SQLException</span> ex) {
            logger<span style="color:#00f;font-weight:700">.</span>error(<span style="color:#036a07">Prblem executing INSERT</span>, ex);
        } <span style="color:#00f;font-weight:700">finally</span> {
            closeConnection(connection);
        }
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">delete</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">singerId</span>) {
        <span style="color:#00f;font-weight:700">Connection</span> connection <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">null</span>;
        <span style="color:#00f;font-weight:700">try</span> {
            connection <span style="color:#00f;font-weight:700">=</span> getConnection();
            <span style="color:#00f;font-weight:700">PreparedStatement</span> statement <span style="color:#00f;font-weight:700">=</span> connection<span style="color:#00f;font-weight:700">.</span>prepareStatement
                    (<span style="color:#036a07">delete from singer where id=?</span>);
            statement<span style="color:#00f;font-weight:700">.</span>setLong(<span style="color:#0000cd">1</span>, singerId);
            statement<span style="color:#00f;font-weight:700">.</span>execute();
            statement<span style="color:#00f;font-weight:700">.</span>close();
        } <span style="color:#00f;font-weight:700">catch</span> (<span style="color:#00f;font-weight:700">SQLException</span> ex) {
            logger<span style="color:#00f;font-weight:700">.</span>error(<span style="color:#036a07">Prblem executing DELETE</span>, ex);
        } <span style="color:#00f;font-weight:700">finally</span> {
            closeConnection(connection);
        }
    }

.<span style="color:#00f;font-weight:700">.</span>.
}</pre>
        <div class="Para" id="Par50">To test the <span id="ITerm21">              <span class="EmphasisFontCategoryNonProportional">PlainSingerDao</span> </span> class, you can use the following class:</div>
        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6.dao.PlainSingerDao</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6.dao.SingerDao</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6.entities.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.Logger</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.LoggerFactory</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.sql.Date</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.GregorianCalendar</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">PlainJdbcDemo</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">SingerDao</span> singerDao <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">PlainSingerDao</span>();
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">PlainJdbcDemo</span><span style="color:#00f;font-weight:700">.</span>class);

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">Listing initial singer data:</span>);
        listAllSingers();
        logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">-------------</span>);
        logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">Insert a new singer</span>);
        <span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Singer</span>();
        singer<span style="color:#00f;font-weight:700">.</span>setFirstName(<span style="color:#036a07">Ed</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setLastName(<span style="color:#036a07">Sheeran</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setBirthDate(<span style="color:#00f;font-weight:700">new</span> Date
                ((new <span style="color:#00f;font-weight:700">GregorianCalendar</span>(<span style="color:#0000cd">1991</span>, <span style="color:#0000cd">2</span>, <span style="color:#0000cd">1991</span>))<span style="color:#00f;font-weight:700">.</span>getTime()<span style="color:#00f;font-weight:700">.</span>getTime()));
        singerDao<span style="color:#00f;font-weight:700">.</span>insert(singer);
        logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">Listing singer data after new singer created:</span>);
        listAllSingers();
        logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">-------------</span>);
        logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">Deleting the previous created singer</span>);
        singerDao<span style="color:#00f;font-weight:700">.</span>delete(singer<span style="color:#00f;font-weight:700">.</span>getId());
        logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">Listing singer data after new singer deleted:</span>);
        listAllSingers();
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">listAllSingers</span>() {
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> singers <span style="color:#00f;font-weight:700">=</span> singerDao<span style="color:#00f;font-weight:700">.</span>findAll();
        <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">:</span> singers) {
            logger<span style="color:#00f;font-weight:700">.</span>info(singer<span style="color:#00f;font-weight:700">.</span>toString());
        }
    }
}
</pre>
        <div class="Para" id="Par52">As you can notice, we will now use a logger to print the messages in the console. Running the previous program yields the following result (assuming you have a locally installed MySQL database called <span class="EmphasisFontCategoryNonProportional">MUSICDB</span>            that has a username and password set to <span class="EmphasisFontCategoryNonProportional">prospring5</span> and the sample data was loaded):</div>
        <pre style="background:#fff;color:#000">INFO    c.a.p.c.PlainJdbcDemo - Listing initial singer data:
INFO    c.a.p.c.PlainJdbcDemo - Singer - Id: 1, First name: John, Last name: Mayer,
                                Birthday: 1977-10-15
INFO    c.a.p.c.PlainJdbcDemo - Singer - Id: 2, First name: Eric, Last name: Clapton,
                                Birthday:  1945-03-29
INFO    c.a.p.c.PlainJdbcDemo - Singer - Id: 3, First name: John, Last name: Butler,
Birthday: 1975-03-31
INFO    c.a.p.c.PlainJdbcDemo - -------------
INFO    c.a.p.c.PlainJdbcDemo - Insert a new singer
INFO    c.a.p.c.PlainJdbcDemo - Listing singer data after new singer created:
INFO    c.a.p.c.PlainJdbcDemo - Singer - Id: 1, First name: John, Last name: Mayer,
                                Birthday: 1977-10-15
INFO    c.a.p.c.PlainJdbcDemo - Singer - Id: 2, First name: Eric, Last name: Clapton,
                                Birthday: 1945-03-29
INFO    c.a.p.c.PlainJdbcDemo - Singer - Id: 3, First name: John, Last name: Butler,
                                Birthday: 1975-03-31
INFO    c.a.p.c.PlainJdbcDemo - Singer - Id: 5, First name: Ed,   Last name: Sheeran,
                                Birthday: 1996-08-10
INFO    c.a.p.c.PlainJdbcDemo - -------------
INFO    c.a.p.c.PlainJdbcDemo - Deleting the previous created singer
INFO    c.a.p.c.PlainJdbcDemo - Listing singer data after new singer deleted:
INFO    c.a.p.c.PlainJdbcDemo - Singer - Id: 1, First name: John, Last name: Mayer,
                                Birthday: 1977-10-15
INFO    c.a.p.c.PlainJdbcDemo - Singer - Id: 2, First name: Eric, Last name: Clapton,
                                Birthday: 1945-03-29
INFO    c.a.p.c.PlainJdbcDemo - Singer - Id: 3, First name: John, Last name: Butler,
                                Birthday: 1975-03-31
</pre>
    <div class="Para" id="Par54">As shown in the output, the first block of lines shows the initial data. The second block of lines shows that the new record was added. The final block of lines shows that the newly created singer (Ed Sheeran) was deleted.</div>
    <div class="Para" id="Par55">As you can see in the previous code samples, a lot of code needs to be moved to a helper class or, even worse, duplicated in each DAO class. This is the main disadvantage of JDBC from the application programmer’s point of view; you just do not have
        time to write repetitive code in every DAO class. Instead, you want to concentrate on writing code that actually does what you need the DAO class to do: select, update, and delete the data. The more helper code you need to write, the more checked
        exceptions you need to handle, and the more bugs you may introduce in your code.</div>
    <div class="Para" id="Par56">This is where a DAO framework and Spring come in. A framework eliminates the code that does not actually perform any custom logic and allows you to forget about all the housekeeping that needs to be performed. In addition, Spring’s extensive JDBC
        support makes your life a lot easier.</div>
    </div>
    <div class="Section1 RenderAsSection1" id="Sec4">
        <h2 class="Heading">Spring JDBC Infrastructure</h2>
        <div class="Para" id="Par57">The code we discussed in the first part of the chapter is not very complex, but it is tedious, and because there is so much of it to write, the likelihood of coding errors is quite high. It is time to take a look at how Spring makes things easier
            and more elegant.</div>
        <div class="Section2 RenderAsSection2" id="Sec5">
            <h3 class="Heading">Overview and <span id="ITerm23">Used Packages                      </span> </h3>
            <div class="Para" id="Par58">JDBC support in Spring is divided into the five packages detailed in Table <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_6_Chapter.html#Tab1">6-1</a></span>; each handles
                different aspects of JDBC access.
                <div class="Table" id="Tab1">
                    <div class="Caption" xml:lang="en">
                        <div class="CaptionContent"><span class="CaptionNumber">Table 6-1.</span>
                            <div class="SimplePara">Spring JDBC Packages</div>
                        </div>
                    </div>
                    <table border="1">
                        <colgroup>
                            <col>
                            <col>
                        </colgroup>
                        <thead>
                            <tr class="header">
                                <th>
                                    <div class="SimplePara">Package</div>
                                </th>
                                <th>
                                    <div class="SimplePara">Description</div>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="noclass">
                                <td>
                                    <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">org.springframework.jdbc.core</span> </div>
                                </td>
                                <td>
                                    <div class="SimplePara">This contains the foundations of JDBC classes in Spring. It includes the core JDBC class, <span class="EmphasisFontCategoryNonProportional">JdbcTemplate</span>, which simplifies programming database operations with
                                        JDBC. Several subpackages provide support of JDBC data access with more specific purposes (e.g., a <span class="EmphasisFontCategoryNonProportional">JdbcTemplate</span> class that supports named parameters) and
                                        related support classes as well.</div>
                                </td>
                            </tr>
                            <tr class="noclass">
                                <td>
                                    <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">org.springframework.jdbc.datasource</span> </div>
                                </td>
                                <td>
                                    <div class="SimplePara">This contains helper classes and <span class="EmphasisFontCategoryNonProportional">DataSource</span> implementations that you can use to run JDBC code outside a JEE container. Several subpackages provide support for
                                        embedded databases, database initialization, and various data source lookup mechanisms.</div>
                                </td>
                            </tr>
                            <tr class="noclass">
                                <td>
                                    <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">org.springframework.jdbc.object</span> </div>
                                </td>
                                <td>
                                    <div class="SimplePara">This contains classes that help convert the data returned from the database into objects or lists of objects. These objects and lists are plain Java objects and therefore are disconnected from the database.</div>
                                </td>
                            </tr>
                            <tr class="noclass">
                                <td>
                                    <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">org.springframework.jdbc.support</span> </div>
                                </td>
                                <td>
                                    <div class="SimplePara">The most important class in this package is <span class="EmphasisFontCategoryNonProportional">SQLException</span> translation support. This allows Spring to recognize error codes used by the database and map them to
                                        higher-level exceptions.</div>
                                </td>
                            </tr>
                            <tr class="noclass">
                                <td>
                                    <div class="SimplePara"> <span class="EmphasisFontCategoryNonProportional">org.springframework.</span> <span id="ITerm24">                            <span class="EmphasisFontCategoryNonProportional">jdbc.config</span> </span>
                                    </div>
                                </td>
                                <td>
                                    <div class="SimplePara">This contains classes that support JDBC configuration within Spring’s <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span>. For example, it contains a handler class for the <span class="EmphasisFontCategoryNonProportional">jdbc</span>                                        namespace (e.g., <span class="EmphasisFontCategoryNonProportional">&lt;jdbc:embedded-database&gt;</span> tags).</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="Para" id="Par59">Let’s start the discussion of Spring JDBC support by looking at the lowest-level functionality. The first thing that needs to be done before running SQL queries is establishing a connection to the database.</div>
        </div>
    </div>
    <div class="Section1 RenderAsSection1" id="Sec6">
        <h2 class="Heading">Database Connections and DataSources</h2>
        <div class="Para" id="Par60">You can use Spring to manage the database connection for you by providing a bean that implements <span class="EmphasisFontCategoryNonProportional">javax.sql.DataSource</span>. The difference between a <span id="ITerm25">              <span class="EmphasisFontCategoryNonProportional">DataSource</span>            </span> and a <span class="EmphasisFontCategoryNonProportional">Connection</span> is that a <span class="EmphasisFontCategoryNonProportional">DataSource</span> provides and manages <span class="EmphasisFontCategoryNonProportional">Connection</span>s.</div>
        <div class="Para" id="Par61"> <span id="ITerm26">              <span class="EmphasisFontCategoryNonProportional">DriverManagerDataSource</span> </span> (under the package <span class="EmphasisFontCategoryNonProportional">org.springframework.jdbc.datasource</span>) is the simplest
            implementation of a <span class="EmphasisFontCategoryNonProportional">DataSource</span>. By looking at the class name, you can guess that it simply calls <span class="EmphasisFontCategoryNonProportional">DriverManager</span> to obtain a connection.
            The fact that <span class="EmphasisFontCategoryNonProportional">DriverManagerDataSource</span> doesn’t support database connection pooling makes this class unsuitable for anything other than testing. The configuration of <span class="EmphasisFontCategoryNonProportional">DriverManagerDataSource</span>            is quite simple, as you can see in the following code snippet; you just need to supply the driver class name, a connection URL, a username, and a password (<span class="EmphasisFontCategoryNonProportional">drivermanager-cfg-01.xml</span>).</div>
    <pre style="background:#fff;color:#000"><span style="color:#68685b">&lt;?<span style="color:#888">xml</span><span style="color:#888"> version</span>=<span style="color:#888">1.0</span><span style="color:#888"> encoding</span>=<span style="color:#888">UTF-8</span>?&gt;</span>
<span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> <span style="font-style:italic">xmlns</span>=<span style="color:#036a07">http://www.springframework.org/schema/beans</span>
       <span style="font-style:italic">xmlns</span>:xsi=<span style="color:#036a07">http://www.w3.org/2001/XMLSchema-instance</span>
       <span style="font-style:italic">xmlns</span>:context=<span style="color:#036a07">http://www.springframework.org/schema/context</span>
       <span style="font-style:italic">xmlns</span>:p=<span style="color:#036a07">http://www.springframework.org/schema/p</span>
       <span style="font-style:italic">xsi</span>:schemaLocation=<span style="color:#036a07">http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">dataSource</span>
          <span style="font-style:italic">class</span>=<span style="color:#036a07">org.springframework.jdbc.datasource.DriverManagerDataSource</span>
          <span style="font-style:italic">p</span>:driverClassName=<span style="color:#036a07">${jdbc.driverClassName}</span>
          <span style="font-style:italic">p</span>:url=<span style="color:#036a07">${jdbc.url}</span> <span style="font-style:italic">p</span>:username=<span style="color:#036a07">${jdbc.username}</span>
          <span style="font-style:italic">p</span>:password=<span style="color:#036a07">${jdbc.password}</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">context</span><span style="font-weight:700">:</span><span style="font-weight:700">property-placeholder</span> <span style="font-style:italic">location</span>=<span style="color:#036a07">classpath:db/jdbc.properties</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
        <div class="Para" id="Par63">You most likely recognize the properties in the listing. They represent the values you normally pass to JDBC to obtain a <span class="EmphasisFontCategoryNonProportional">Connection</span> interface. The database connection information typically
            is stored in a properties file for easy maintenance and substitution in different deployment environments. The following snippet shows a sample <span class="EmphasisFontCategoryNonProportional">jdbc.properties</span> from which Spring’s property
            placeholder will load the connection information:</div>
        <pre style="background:#fff;color:#000">jdbc.driverClassName=com.mysql.cj.jdbc.Driver jdbc.url=jdbc:mysql://localhost:3306/musicdb?useSSL=true
jdbc.username=prospring5
jdbc.password=prospring5</pre>
        <div class="Para" id="Par65">By adding the <span class="EmphasisFontCategoryNonProportional">util</span> namespace in the mix, the same configuration can be written like this as well (<span class="EmphasisFontCategoryNonProportional">drivermanager-cfg-02.xml</span>):</div>
        <pre style="background:#fff;color:#000"><span style="color:#68685b">&lt;?<span style="color:#888">xml</span><span style="color:#888"> version</span>=<span style="color:#888">1.0</span><span style="color:#888"> encoding</span>=<span style="color:#888">UTF-8</span>?&gt;</span>
<span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> <span style="font-style:italic">xmlns</span>=<span style="color:#036a07">http://www.springframework.org/schema/beans</span>
       <span style="font-style:italic">xmlns</span>:xsi=<span style="color:#036a07">http://www.w3.org/2001/XMLSchema-instance</span>
       <span style="font-style:italic">xmlns</span>:util=<span style="color:#036a07">http://www.springframework.org/schema/util</span>
       <span style="font-style:italic">xmlns</span>:p=<span style="color:#036a07">http://www.springframework.org/schema/p</span>
       <span style="font-style:italic">xsi</span>:schemaLocation=<span style="color:#036a07">http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/util
        http://www.springframework.org/schema/util/spring-util.xsd</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">dataSource</span>
          <span style="font-style:italic">class</span>=<span style="color:#036a07">org.springframework.jdbc.datasource.DriverManagerDataSource</span>
          <span style="font-style:italic">p</span>:driverClassName=<span style="color:#036a07">#{jdbc.driverClassName}</span>
          <span style="font-style:italic">p</span>:url=<span style="color:#036a07">#{jdbc.url}</span>
          <span style="font-style:italic">p</span>:username=<span style="color:#036a07">#{jdbc.username}</span>
          <span style="font-style:italic">p</span>:password=<span style="color:#036a07">#{jdbc.password}</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">util</span><span style="font-weight:700">:</span><span style="font-weight:700">properties</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">jdbc</span> <span style="font-style:italic">location</span>=<span style="color:#036a07">classpath:db/jdbc2.properties</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
            <div class="Para" id="Par67">One change is required here. The properties are loaded into a <span class="EmphasisFontCategoryNonProportional">java.util.Properties</span> bean named <span class="EmphasisFontCategoryNonProportional">jdbc</span>, so you need to change the
                name of the property names in the properties file to be able to access them with the <span class="EmphasisFontCategoryNonProportional">jdbc</span> prefix. Here’s <span class="EmphasisFontCategoryNonProportional">jdbc2.properties</span>                file content:</div>
            <div class="Para" id="Par68">
                <div class="ProgramCode" id="PC15">
                    <div class="FixedLine">driverClassName=com.mysql.cj.jdbc.Driver</div>
                    <div class="FixedLine">url=jdbc:mysql://localhost:3306/musicdb?useSSL=true</div>
                    <div class="FixedLine">username=prospring5</div>
                    <div class="FixedLine">password=prospring5</div>
                </div>
            </div>
            <div class="Para" id="Par69">Since this book is focused more on Java <span id="ITerm28">              <span class="EmphasisFontCategoryNonProportional">Configuration</span> </span> classes, here is a configuration class as well:</div>
            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6.config</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Value</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Bean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Configuration</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Lazy</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.PropertySource</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.PropertySourcesPlaceholderConfigurer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.jdbc.datasource.SimpleDriverDataSource</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.jdbc.datasource.init.DatabasePopulatorUtils</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.sql.DataSource</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.sql.Driver</span>;

@<span style="color:#00f;font-weight:700">Configuration</span>
@PropertySource(<span style="color:#036a07">classpath:db/jdbc2.properties</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">DbConfig</span> {
    <span style="color:#00f;font-weight:700">@Value</span>(<span style="color:#036a07">${driverClassName}</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> driverClassName;
    <span style="color:#00f;font-weight:700">@Value</span>(<span style="color:#036a07">${url}</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> url;
    <span style="color:#00f;font-weight:700">@Value</span>(<span style="color:#036a07">${username}</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> username;
    <span style="color:#00f;font-weight:700">@Value</span>(<span style="color:#036a07">${password}</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> password;

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">PropertySourcesPlaceholderConfigurer</span>
    propertySourcesPlaceholderConfigurer() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">PropertySourcesPlaceholderConfigurer</span>();
    }

    @<span style="color:#00f;font-weight:700">Lazy</span>
    @<span style="color:#00f;font-weight:700">Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">DataSource</span> dataSource() {
        <span style="color:#00f;font-weight:700">try</span> {
            <span style="color:#00f;font-weight:700">SimpleDriverDataSource</span> dataSource <span style="color:#00f;font-weight:700">=</span>
                    <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SimpleDriverDataSource</span>();
            <span style="color:#00f;font-weight:700">Class&lt;? extends <span style="color:#00f;font-weight:700">Driver</span>&gt;</span> driver <span style="color:#00f;font-weight:700">=</span>
                    (<span style="color:#00f;font-weight:700">Class&lt;? extends <span style="color:#00f;font-weight:700">Driver</span>&gt;</span>) <span style="color:#00f;font-weight:700">Class</span><span style="color:#00f;font-weight:700">.</span>forName(driverClassName);
            dataSource<span style="color:#00f;font-weight:700">.</span>setDriverClass(driver);
            dataSource<span style="color:#00f;font-weight:700">.</span>setUrl(url);
            dataSource<span style="color:#00f;font-weight:700">.</span>setUsername(username);
            dataSource<span style="color:#00f;font-weight:700">.</span>setPassword(password);
            <span style="color:#00f;font-weight:700">return</span> dataSource;
        } <span style="color:#00f;font-weight:700">catch</span> (<span style="color:#00f;font-weight:700">Exception</span> e) {
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#585cf6;font-weight:700">null</span>;
        }
    }
}</pre>
            <div class="Para" id="Par71">To test any of these classes, you can use the following <span id="ITerm30">test class                  </span>:</div>
            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6.config.DbConfig</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Test</span>;

.<span style="color:#00f;font-weight:700">.</span>.
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.sql.PreparedStatement</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.sql.ResultSet</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.sql.SQLException</span>;

<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">org.junit.Assert.assertNotNull</span>;
<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">org.junit.Assert.assertTrue</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">DbConfigTest</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">DbConfigTest</span><span style="color:#00f;font-weight:700">.</span>class);

    <span style="color:#00f;font-weight:700">@Test</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">testOne</span>() <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">SQLException</span> {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/drivermanager-cfg-01.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">DataSource</span> dataSource <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">dataSource</span>, <span style="color:#00f;font-weight:700">DataSource</span><span style="color:#00f;font-weight:700">.</span>class);
        assertNotNull(dataSource);
        testDataSource(dataSource);
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }

    <span style="color:#00f;font-weight:700">@Test</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">testTwo</span>() <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">SQLException</span> {
        <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">DbConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">DataSource</span> dataSource <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">dataSource</span>, <span style="color:#00f;font-weight:700">DataSource</span><span style="color:#00f;font-weight:700">.</span>class);
        assertNotNull(dataSource);
        testDataSource(dataSource);
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">testDataSource</span>(<span style="color:#00f;font-weight:700">DataSource</span> <span style="font-style:italic">dataSource</span>) <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">SQLException</span> {
        <span style="color:#00f;font-weight:700">Connection</span> connection <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">null</span>;
        <span style="color:#00f;font-weight:700">try</span> {
            connection <span style="color:#00f;font-weight:700">=</span> dataSource<span style="color:#00f;font-weight:700">.</span>getConnection();
            <span style="color:#00f;font-weight:700">PreparedStatement</span> statement <span style="color:#00f;font-weight:700">=</span>
                    connection<span style="color:#00f;font-weight:700">.</span>prepareStatement(<span style="color:#036a07">SELECT 1</span>);
            <span style="color:#00f;font-weight:700">ResultSet</span> resultSet <span style="color:#00f;font-weight:700">=</span> statement<span style="color:#00f;font-weight:700">.</span>executeQuery();
            <span style="color:#00f;font-weight:700">while</span> (resultSet<span style="color:#00f;font-weight:700">.</span>next()) {
                <span style="color:#00f;font-weight:700">int</span> mockVal <span style="color:#00f;font-weight:700">=</span> resultSet<span style="color:#00f;font-weight:700">.</span>getInt(<span style="color:#036a07">1</span>);
                assertTrue(mockVal <span style="color:#00f;font-weight:700">==</span> <span style="color:#0000cd">1</span>);
            }
            statement<span style="color:#00f;font-weight:700">.</span>close();
        } <span style="color:#00f;font-weight:700">catch</span> (<span style="color:#00f;font-weight:700">Exception</span> e) {
            logger<span style="color:#00f;font-weight:700">.</span>debug(<span style="color:#036a07">Something unexpected happened.</span>, e);
        } <span style="color:#00f;font-weight:700">finally</span> {
            <span style="color:#00f;font-weight:700">if</span> (connection <span style="color:#00f;font-weight:700">!=</span> <span style="color:#585cf6;font-weight:700">null</span>) {
                connection<span style="color:#00f;font-weight:700">.</span>close();
            }
        }
    }
} </pre>
            <div class="Para" id="Par73">Again, a test class was used because it is more practical to reuse some of the code and also teach you to work with JUnit to quickly write tests for any piece of code you write. The first method, <span class="EmphasisFontCategoryNonProportional">testOne()</span>,
                is used to test XML configurations, and the second is used to test the <span class="EmphasisFontCategoryNonProportional">DbConfig</span> configuration class. After obtaining the <span class="EmphasisFontCategoryNonProportional">dataSource</span>                bean from any configuration, the mock query <span class="EmphasisFontCategoryNonProportional">SELECT 1</span> is used to test the connection to the MySQL database.</div>
            <div class="Para" id="Par74">In real-world applications, you can use the Apache Commons <span class="EmphasisFontCategoryNonProportional">BasicDataSource</span> <a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_6_Chapter.html#Fn3" id="Fn3_source"><sup>3</sup></a> or a <span class="EmphasisFontCategoryNonProportional">DataSource</span> implemented by a JEE application server (for example, JBoss, WebSphere, WebLogic, or GlassFish), which may
                further increase the performance of the application. You could use a <span class="EmphasisFontCategoryNonProportional">DataSource</span> in the plain JDBC code and get the same pooling benefits; however, in most cases, you would still
                miss a central place to configure the <span class="EmphasisFontCategoryNonProportional">DataSource</span>. Spring, on the other hand, allows you to declare a <span class="EmphasisFontCategoryNonProportional">dataSource</span> bean and
                set the connection properties in the <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> definition files. See the following configuration sample; the file name is <span class="EmphasisFontCategoryNonProportional">datasource-dbcp.xml</span>:</div>
            <pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">dataSource</span>
class=<span style="color:#036a07">org.apache.commons.dbcp2.BasicDataSource</span>
destroy-method=<span style="color:#036a07">close</span>
p:driverClassName=<span style="color:#036a07">#{jdbc.driverClassName}</span>
p:url=<span style="color:#036a07">#{jdbc.url}</span>
p:username=<span style="color:#036a07">#{jdbc.username}</span>
p:password=<span style="color:#036a07">#{jdbc.password}</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">util</span><span style="font-weight:700">:</span><span style="font-weight:700">properties</span> id=<span style="color:#036a07">jdbc</span> <span style="font-style:italic">location</span>=<span style="color:#036a07">classpath:db/jdbc2.properties</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
                <div class="Para" id="Par77">This particular Spring-managed <span class="EmphasisFontCategoryNonProportional">DataSource</span> is implemented in <span class="EmphasisFontCategoryNonProportional">org.apache.commons.dbcp.BasicDataSource</span>. The most important bit
                    is that the <span class="EmphasisFontCategoryNonProportional">dataSource</span> bean implements <span class="EmphasisFontCategoryNonProportional">javax.sql.DataSource</span>, and you can immediately start using it in your data access
                    classes.</div>
                <div class="Para" id="Par78">Another way to configure a <span class="EmphasisFontCategoryNonProportional">dataSource</span> bean is to use <span id="ITerm33">JNDI                  </span>. If the application you are developing is going to run in a JEE container, we
                    can take advantage of the container-managed connection pooling. To use a JNDI-based data source, you need to change the <span class="EmphasisFontCategoryNonProportional">dataSource</span> bean declaration, as shown in the following
                    example (<span class="EmphasisFontCategoryNonProportional">datasource-jndi.xml</span>):</div>
                <pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">dataSource</span>
      <span style="font-style:italic">class</span>=<span style="color:#036a07">org.springframework.jndi.JndiObjectFactoryBean</span>
      <span style="font-style:italic">p</span>:jndiName=<span style="color:#036a07">java:comp/env/jdbc/musicdb</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
                <div class="Para" id="Par80">In the previous example, we use Spring’s <span class="EmphasisFontCategoryNonProportional">JndiObjectFactoryBean</span> to obtain the data source by JNDI lookup. Starting from version 2.5, Spring provides the <span class="EmphasisFontCategoryNonProportional">jee</span>                    namespace, which further simplifies the configuration. Here you can see the same <span id="ITerm34">JNDI data source                  </span> configuration using the <span class="EmphasisFontCategoryNonProportional">jee</span> namespace
                    (<span class="EmphasisFontCategoryNonProportional">datasource-jee.xml</span>):</div>
                <pre style="background:#fff;color:#000"><span style="color:#68685b">&lt;?<span style="color:#888">xml</span><span style="color:#888"> version</span>=<span style="color:#888">1.0</span><span style="color:#888"> encoding</span>=<span style="color:#888">UTF-8</span>?&gt;</span>
<span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> <span style="font-style:italic">xmlns</span>=<span style="color:#036a07">http://www.springframework.org/schema/beans</span>
    <span style="font-style:italic">xmlns</span>:xsi=<span style="color:#036a07">http://www.w3.org/2001/XMLSchema-instance</span>
    <span style="font-style:italic">xmlns</span>:jee=<span style="color:#036a07">http://www.springframework.org/schema/jee</span>
    <span style="font-style:italic">xsi</span>:schemaLocation=<span style="color:#036a07">http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/jee
        http://www.springframework.org/schema/jee/spring-jee.xsd</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">jee</span><span style="font-weight:700">:</span><span style="font-weight:700">jndi-lookup</span> <span style="font-style:italic">jndi-name</span>=<span style="color:#036a07">java:comp/env/jdbc/prospring5ch6</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
                <div class="Para" id="Par82">In the previous configuration snippet, we declare the <span class="EmphasisFontCategoryNonProportional">jee</span> namespace in the <span class="EmphasisFontCategoryNonProportional">&lt;beans&gt;</span> tag and then the <span class="EmphasisFontCategoryNonProportional">&lt;jee:jndi-lookup&gt;</span>                    tag to declare the data source. If you take the JNDI approach, you must not forget to add a resource reference (<span class="EmphasisFontCategoryNonProportional">resourceref</span>) in the application descriptor file. See the following
                    code snippet:</div>
                <pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">root-node</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">resource-ref</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">res-ref-name</span>&gt;</span>jdbc/musicdb<span style="color:#1c02ff">&lt;/<span style="font-weight:700">res-ref-name</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">res-type</span>&gt;</span>javax.sql.DataSource<span style="color:#1c02ff">&lt;/<span style="font-weight:700">res-type</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">res-auth</span>&gt;</span>Container<span style="color:#1c02ff">&lt;/<span style="font-weight:700">res-auth</span>&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">resource-ref</span>&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">root-node</span>&gt;</span>
</pre>
                <div class="Para" id="Par84"> <span class="EmphasisFontCategoryNonProportional">&lt;root-node&gt;</span> is a placeholder value; you need to change it depending on how your module is packaged. For example, it becomes <span class="EmphasisFontCategoryNonProportional">&lt;web-app&gt;</span>                    in the web deployment descriptor (<span class="EmphasisFontCategoryNonProportional">WEB-INF/web.xml</span>) if the application is a web module. Most likely, you will need to configure <span class="EmphasisFontCategoryNonProportional">resource-ref</span>                    in an application server–specific descriptor file as well. However, notice that the <span class="EmphasisFontCategoryNonProportional">resource-ref</span> element configures the <span class="EmphasisFontCategoryNonProportional">jdbc/musicdb</span>                    reference name and that the <span class="EmphasisFontCategoryNonProportional">dataSource</span> bean’s <span class="EmphasisFontCategoryNonProportional">jndiName</span> is set to <span class="EmphasisFontCategoryNonProportional">java:comp/env/jdbc/musicdb</span>.</div>
                <div class="Para" id="Par85">As you can see, Spring allows you to configure the <span class="EmphasisFontCategoryNonProportional">DataSource</span> in almost any way you like, and it hides the actual implementation or location of the data source from the rest of the
                    application’s code. In other words, your DAO classes do not know and do not need to know where the <span class="EmphasisFontCategoryNonProportional">DataSource</span> points.</div>
                    <div class="Para ParaOneEmphasisChild" id="Par86">The connection management is also delegated to the <span class="EmphasisFontCategoryNonProportional">dataSource</span> bean, which in turn performs the management itself or uses the JEE container to do all the work.</div>
                    </div>
                    <div class="Section1 RenderAsSection1" id="Sec7">
                        <h2 class="Heading">Embedded Database Support</h2>
                        <div class="Para" id="Par87">Starting from version 3.0, Spring also offers embedded database support, which automatically starts an embedded database and exposes it as a <span class="EmphasisFontCategoryNonProportional">DataSource</span> for the application.
                            The following configuration snippet shows the configuration of an <span id="ITerm35">embedded database                  </span> (<span class="EmphasisFontCategoryNonProportional">embedded-h2-cfg.xml</span>):</div>
                        <pre style="background:#fff;color:#000"><span style="color:#68685b">&lt;?<span style="color:#888">xml</span><span style="color:#888"> version</span>=<span style="color:#888">1.0</span><span style="color:#888"> encoding</span>=<span style="color:#888">UTF-8</span>?&gt;</span>
<span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> <span style="font-style:italic">xmlns</span>=<span style="color:#036a07">http://www.springframework.org/schema/beans</span>
    <span style="font-style:italic">xmlns</span>:xsi=<span style="color:#036a07">http://www.w3.org/2001/XMLSchema-instance</span>
    <span style="font-style:italic">xmlns</span>:jdbc=<span style="color:#036a07">http://www.springframework.org/schema/jdbc</span>
    <span style="font-style:italic">xmlns</span>:p=<span style="color:#036a07">http://www.springframework.org/schema/p</span>
    <span style="font-style:italic">xmlns</span>:c=<span style="color:#036a07">http://www.springframework.org/schema/c</span>
    <span style="font-style:italic">xsi</span>:schemaLocation=<span style="color:#036a07">http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/jdbc
        http://www.springframework.org/schema/jdbc/spring-jdbc.xsd</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">jdbc</span><span style="font-weight:700">:</span><span style="font-weight:700">embedded-database</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">dataSource</span>  <span style="font-style:italic">type</span>=<span style="color:#036a07">H2</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">jdbc</span><span style="font-weight:700">:</span><span style="font-weight:700">script</span>  <span style="font-style:italic">location</span>=<span style="color:#036a07">classpath:db/h2/schema.sql</span>/&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">jdbc</span><span style="font-weight:700">:</span><span style="font-weight:700">script</span> <span style="font-style:italic">location</span>=<span style="color:#036a07">classpath:db/h2/test-data.sql</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">jdbc</span><span style="font-weight:700">:</span><span style="font-weight:700">embedded-database</span>&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
                        <div class="Para" id="Par89">In the previous listing, we first declare the <span class="EmphasisFontCategoryNonProportional">jdbc</span> namespace in the <span class="EmphasisFontCategoryNonProportional">&lt;beans&gt;</span> tag. Afterward, we use <span class="EmphasisFontCategoryNonProportional">&lt;jdbc:embedded-database&gt;</span>                            to declare the embedded database and assign it an ID of <span class="EmphasisFontCategoryNonProportional">dataSource</span>. Within the tag, we also instruct Spring to execute the scripts specified to create the database schema
                            and populate testing data accordingly. Note that the order of the scripts is important, and the file that contains Data Definition Language (DDL) should always appear first, followed by the file with Data Manipulation Language
                            (DML). For the <span class="EmphasisFontCategoryNonProportional">type</span> attribute, we specify the type of embedded database to use. As of version 4.0, Spring supports HSQL (the default), H2, and DERBY.</div>
                        <div class="Para" id="Par90">Embedded databases can be configured using Java <span class="EmphasisFontCategoryNonProportional">Configuration</span> classes too. The class to use is <span class="EmphasisFontCategoryNonProportional">EmbeddedDatabaseBuilder</span>,
                            which uses the database creation and loading data scripts as arguments to create an instance of <span class="EmphasisFontCategoryNonProportional">EmbeddedDatabase</span> that implements <span class="EmphasisFontCategoryNonProportional">DataSource</span>.</div>
                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6.config</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.Logger</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.LoggerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Bean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Configuration</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.jdbc.datasource.embedded.EmbeddedDatabaseBuilder</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.jdbc.datasource.embedded.EmbeddedDatabaseType</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.sql.DataSource</span>;

@<span style="color:#00f;font-weight:700">Configuration</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">EmbeddedJdbcConfig</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">EmbeddedJdbcConfig</span><span style="color:#00f;font-weight:700">.</span>class);

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">DataSource</span> <span style="color:#0000a2;font-weight:700">dataSource</span>() {
        <span style="color:#00f;font-weight:700">try</span> {
            <span style="color:#00f;font-weight:700">EmbeddedDatabaseBuilder</span> dbBuilder <span style="color:#00f;font-weight:700">=</span>
                    <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">EmbeddedDatabaseBuilder</span>();
            <span style="color:#00f;font-weight:700">return</span> dbBuilder<span style="color:#00f;font-weight:700">.</span>setType(<span style="color:#00f;font-weight:700">EmbeddedDatabaseType</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>H2</span>)
                    .addScripts(<span style="color:#036a07">classpath:db/h2/schema.sql</span>,
                            <span style="color:#036a07">classpath:db/h2/test-data.sql</span>)<span style="color:#00f;font-weight:700">.</span>build();
        } <span style="color:#00f;font-weight:700">catch</span> (<span style="color:#00f;font-weight:700">Exception</span> e) {
            logger<span style="color:#00f;font-weight:700">.</span>error(<span style="color:#036a07">Embedded DataSource bean cannot be created!</span>, e);
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#585cf6;font-weight:700">null</span>;
        }
    }
.<span style="color:#00f;font-weight:700">.</span>.
}</pre>
                    <div class="Para" id="Par92">The embedded database support is extremely useful for local development or unit testing. Throughout the rest of this chapter, we use the embedded database to run the sample code, so your machine doesn’t require a database to be installed
                        in order to run the samples.</div>
                    <div class="Para" id="Par93">Not only can you utilize the embedded database support via the JDBC namespace but also initialize a database instance running elsewhere, such as MySQL, Oracle, and so on. Rather than specifying <span class="EmphasisFontCategoryNonProportional">type</span>                        and <span class="EmphasisFontCategoryNonProportional">embedded-database</span>, simply use <span class="EmphasisFontCategoryNonProportional">initialize-database</span>, and your scripts will execute against the intended <span class="EmphasisFontCategoryNonProportional">dataSource</span>                        just as they would with an embedded database.</div>
                    </div>
                    <div class="Section1 RenderAsSection1" id="Sec8">
                        <h2 class="Heading">Using DataSources in DAO Classes</h2>
                        <div class="Para" id="Par94">The Data Access Object (<span id="ITerm37">DAO)                            </span> pattern is used to separate low-level data accessing APIs or operations from high-level business services. The Data Access Object pattern requires
                            the following <span id="ITerm38">components                  </span>:
                            <div class="UnorderedList">
                                <ul class="UnorderedListMarkBullet">
                                    <li>
                                        <div class="Para ParaOneEmphasisChild" id="Par95"> <span class="EmphasisTypeItalic">DAO interface</span>: This defines the standard operations to be performed on a model object (or objects).</div>
                                    </li>
                                    <li>
                                        <div class="Para ParaOneEmphasisChild" id="Par96"> <span class="EmphasisTypeItalic">DAO implementation</span>: This class provides a concrete implementation for the DAO interface. Typically this uses a JDBC connection or data source to handle model object (or objects).</div>
                                    </li>
                                    <li>
                                        <div class="Para ParaOneEmphasisChild" id="Par97"> <span class="EmphasisTypeItalic">Model objects also called data objects or entities</span>: This is a simple POJO mapping to a table record.</div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="Para ParaOneEmphasisChild" id="Par98">Let’s create a <span class="EmphasisFontCategoryNonProportional">SingerDao</span> interface to implement for the sample, as shown here:</div>
                        <div class="Para" id="Par99">
                            <div class="ProgramCode" id="PC24">
                                <div class="LineGroup">
                                    <div class="FixedLine">package com.apress.prospring5.ch6.dao;</div>
                                </div>
                                <div class="LineGroup">
                                    <div class="FixedLine">public interface SingerDao {</div>
                                    <div class="FixedLine">    String findNameById(Long id);</div>
                                    <div class="FixedLine">}</div>
                                </div>
                            </div>
                        </div>
                        <div class="Para" id="Par100">For the simple implementation, first we will add a <span class="EmphasisFontCategoryNonProportional">dataSource</span> property to the <span id="ITerm39">              <span class="EmphasisFontCategoryNonProportional">JdbcSingerDao</span>                            </span> implementation class. The reason we want to add the <span class="EmphasisFontCategoryNonProportional">dataSource</span> property to the implementation class rather than the interface should be quite obvious: the interface
                            does not need to know how the data is going to be retrieved and updated. By adding <span class="EmphasisFontCategoryNonProportional">DataSource</span> mutator methods to the interface, in the best-case scenario this forces
                            the implementations to declare the getter and setter stubs. Clearly, this is not a very good design practice. Take a look at the simple <span class="EmphasisFontCategoryNonProportional">JdbcSingerDao</span> class shown here:</div>
                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6.dao.SingerDao</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6.entities.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.apache.commons.lang3.NotImplementedException</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.BeanCreationException</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.InitializingBean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.jdbc.core.JdbcTemplate</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.sql.DataSource</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">JdbcSingerDao</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerDao</span>,  <span style="font-style:italic">InitializingBean</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">DataSource</span> dataSource;
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setDataSource</span>(<span style="color:#00f;font-weight:700">DataSource</span> <span style="font-style:italic">dataSource</span>)  {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>dataSource <span style="color:#00f;font-weight:700">=</span> dataSource;
    }
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">afterPropertiesSet</span>()  <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Exception</span> {
        <span style="color:#00f;font-weight:700">if</span> (dataSource <span style="color:#00f;font-weight:700">==</span>  <span style="color:#585cf6;font-weight:700">null</span>) {
            <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">BeanCreationException</span>(
               <span style="color:#036a07">Must set  dataSource on  SingerDao</span>);
        }
    }
.<span style="color:#00f;font-weight:700">.</span>.
}
</pre>
                    <div class="Para" id="Par102">We can now instruct Spring to configure our <span class="EmphasisFontCategoryNonProportional">singerDao</span> bean by using the <span class="EmphasisFontCategoryNonProportional">JdbcSingerDao</span> implementation and set the
                        <span class="EmphasisFontCategoryNonProportional">dataSource</span> property as shown in the following <span class="EmphasisFontCategoryNonProportional">EmbeddedJdbcConfig</span> configuration <span id="ITerm40">class                  </span>:</div>
                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6.config</span>;
.<span style="color:#00f;font-weight:700">.</span>.

@<span style="color:#00f;font-weight:700">Configuration</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">EmbeddedJdbcConfig</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">EmbeddedJdbcConfig</span><span style="color:#00f;font-weight:700">.</span>class);

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">DataSource</span> <span style="color:#0000a2;font-weight:700">dataSource</span>() {
        <span style="color:#00f;font-weight:700">try</span> {
            <span style="color:#00f;font-weight:700">EmbeddedDatabaseBuilder</span> dbBuilder <span style="color:#00f;font-weight:700">=</span>
                    <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">EmbeddedDatabaseBuilder</span>();
            <span style="color:#00f;font-weight:700">return</span> dbBuilder<span style="color:#00f;font-weight:700">.</span>setType(<span style="color:#00f;font-weight:700">EmbeddedDatabaseType</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>H2</span>)
                    .addScripts(<span style="color:#036a07">classpath:db/h2/schema.sql</span>,
                            <span style="color:#036a07">classpath:db/h2/test-data.sql</span>)<span style="color:#00f;font-weight:700">.</span>build();
        } <span style="color:#00f;font-weight:700">catch</span> (<span style="color:#00f;font-weight:700">Exception</span> e) {
            logger<span style="color:#00f;font-weight:700">.</span>error(<span style="color:#036a07">Embedded  DataSource bean  cannot be  created!</span>, e);
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#585cf6;font-weight:700">null</span>;
        }
    }

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">SingerDao</span> <span style="color:#0000a2;font-weight:700">singerDao</span>() {
        <span style="color:#00f;font-weight:700">JdbcSingerDao</span> dao <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">JdbcSingerDao</span>();
        dao<span style="color:#00f;font-weight:700">.</span>setDataSource(dataSource());
        <span style="color:#00f;font-weight:700">return</span> dao;
    }
}
</pre>
                    <div class="Para ParaOneEmphasisChild" id="Par104">Spring supports quite a few embedded databases, but they have to be added as dependencies to the projects. Here you can see a few database-specific libraries being configured for use in <span class="EmphasisFontCategoryNonProportional">pro-spring-15\gradle.build</span>:</div>
                    <pre style="background:#fff;color:#000">ext {
    derbyVersion = &apos;10.13.1.1&apos;
    dbcpVersion = &apos;2.1&apos;
    mysqlVersion = &apos;6.0.6&apos;
    h2Version = &apos;1.4.194&apos;
    ...
    db = [
        mysql: &quot;mysql:mysql-connector-java:$mysqlVersion&quot;,
        derby: &quot;org.apache.derby:derby:$derbyVersion&quot;,
        dbcp : &quot;org.apache.commons:commons-dbcp2:$dbcpVersion&quot;,
        h2   : &quot;com.h2database:h2:$h2Version&quot;
    ]
}</pre>
                        <div class="Para" id="Par106">Spring now creates the <span class="EmphasisFontCategoryNonProportional">singerDao</span> bean by instantiating the <span class="EmphasisFontCategoryNonProportional">JdbcSingerDao</span> class with the <span class="EmphasisFontCategoryNonProportional">dataSource</span>                            property set to the <span class="EmphasisFontCategoryNonProportional">dataSource</span> bean. It is good practice to make sure that all required properties on a bean have been set. The easiest way to do this is to implement
                            the <span class="EmphasisFontCategoryNonProportional">InitializingBean</span> interface and provide an implementation for the <span class="EmphasisFontCategoryNonProportional">afterPropertiesSet</span>() method. This way, we
                            make sure that all required properties have been set on our <span class="EmphasisFontCategoryNonProportional">JdbcSingerDao</span>. For further discussion of bean initialization, refer to Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_4_Chapter.html"><span class="RefSource">4</span></a>
                            </span>.</div>
                        <div class="Para" id="Par107">The code we have looked at so far uses Spring to manage the data source and introduces the <span class="EmphasisFontCategoryNonProportional">SingerDao</span> interface and its JDBC implementation. We also set the <span class="EmphasisFontCategoryNonProportional">dataSource</span>                            property on the <span class="EmphasisFontCategoryNonProportional">JdbcSingerDao</span> class in the Spring <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> file. Now we expand the code by adding the
                            actual DAO operations to the interface and implementation.</div>
                        </div>
                        <div class="Section1 RenderAsSection1" id="Sec9">
                            <h2 class="Heading">Exception Handling</h2>
                            <div class="Para" id="Par108">Because Spring advocates using runtime exceptions rather than checked exceptions, you need a mechanism to translate the checked <span id="ITerm42">              <span class="EmphasisFontCategoryNonProportional">SQLException</span>                                </span> into a runtime Spring JDBC exception. Because Spring’s SQL exceptions are runtime exceptions, they can be much more granular than checked exceptions. By definition, this is not a feature of runtime exceptions, but
                                it is inconvenient to have to declare a long list of checked exceptions in the <span class="EmphasisFontCategoryNonProportional">throws</span> clause; hence, checked exceptions tend to be much more coarse-grained than their
                                runtime equivalents.</div>
                            <div class="Para" id="Par109">Spring provides a default implementation of the <span class="EmphasisFontCategoryNonProportional">SQLExceptionTranslator</span> interface, which takes care of translating the generic SQL error codes into Spring JDBC exceptions.
                                In most cases, this implementation is sufficient enough, but you can extend Spring’s default implementation and set your new <span class="EmphasisFontCategoryNonProportional">SQLExceptionTranslator</span> implementation
                                to be used in <span class="EmphasisFontCategoryNonProportional">JdbcTemplate</span>, as shown in the following code <span id="ITerm43">sample        </span>:</div>
                            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.sql.SQLException</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.dao.DataAccessException</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.dao.DeadlockLoserDataAccessException</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.jdbc.support.SQLErrorCodeSQLExceptionTranslator</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">MySQLErrorCodesTranslator</span> <span style="color:#00f;font-weight:700">extends</span>
        <span style="font-style:italic">SQLErrorCodeSQLExceptionTranslator</span> {
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">protected</span> <span style="color:#00f;font-weight:700">DataAccessException</span> <span style="color:#0000a2;font-weight:700">customTranslate</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">task</span>,
                                                  <span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">sql</span>, <span style="color:#00f;font-weight:700">SQLException</span> <span style="font-style:italic">sqlex</span>) {
        <span style="color:#00f;font-weight:700">if</span> (sqlex<span style="color:#00f;font-weight:700">.</span>getErrorCode() <span style="color:#00f;font-weight:700">==</span> <span style="color:#00f;font-weight:700">-</span><span style="color:#0000cd">12345</span>){
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">DeadlockLoserDataAccessException</span>(task, sqlex);
        }
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#585cf6;font-weight:700">null</span>;
    }
}</pre>
                            <div class="Para" id="Par111">At the same time, we need to add the dependency on <span class="EmphasisFontCategoryNonProportional">spring-jdbc</span> into the project. Here you can see <span class="EmphasisFontCategoryNonProportional">spring-jdbc</span>                                being configured for use in <span class="EmphasisFontCategoryNonProportional">pro-spring-15/gradle.build</span>:</div>
                            <pre style="background:#fff;color:#000">ext {
springVersion = &apos;5.0.0.M4&apos;
...

spring = [
jdbc : &quot;org.springframework:spring-jdbc:$springVersion&quot;,
...
]
}</pre>
                            <div class="Para" id="Par113">This library is added as a dependency to all JDBC projects used as samples for this chapter.</div>
                            <pre style="background:#fff;color:#000">//chapter06/spring-jdbc-embedded/build.gradle
dependencies {
    compile spring.jdbc
    compile db.h2,  db.derby
}</pre>
                            <div class="Para" id="Par115">To use the custom translator, we need to pass it into <span class="EmphasisFontCategoryNonProportional">JdbcTemplate</span> in the DAO classes. The following code snippet represents a piece of the enhanced <span class="EmphasisFontCategoryNonProportional">JdbcSingerDao.setDataSource()</span>                                method to illustrate its usage:</div>
                            <pre style="background:#fff;color:#000">.<span style="color:#00f;font-weight:700">.</span>.
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">JdbcSingerDao</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerDao</span>, <span style="font-style:italic">InitializingBean</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">DataSource</span> dataSource;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">JdbcTemplate</span> jdbcTemplate;
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setDataSource</span>(<span style="color:#00f;font-weight:700">DataSource</span> <span style="font-style:italic">dataSource</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>dataSource <span style="color:#00f;font-weight:700">=</span> dataSource;
        <span style="color:#00f;font-weight:700">JdbcTemplate</span> jdbcTemplate  <span style="color:#00f;font-weight:700">=</span>  <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">JdbcTemplate</span>();
        jdbcTemplate<span style="color:#00f;font-weight:700">.</span>setDataSource(dataSource);
        <span style="color:#00f;font-weight:700">MySQLErrorCodesTranslator</span> errorTranslator <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">MySQLErrorCodesTranslator</span>();
        errorTranslator<span style="color:#00f;font-weight:700">.</span>setDataSource(dataSource);
        jdbcTemplate<span style="color:#00f;font-weight:700">.</span>setExceptionTranslator(errorTranslator);
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>jdbcTemplate <span style="color:#00f;font-weight:700">=</span>  jdbcTemplate;
    }
.<span style="color:#00f;font-weight:700">.</span>.
}</pre>
                            <div class="Para" id="Par117">Having the custom SQL exception translator in place, Spring will invoke it upon SQL exceptions detected when executing SQL statements against the database, and custom exception translation will happen when the error code is
                                <span class="EmphasisFontCategoryNonProportional">-12345</span>. For other errors, Spring will fall back to its default mechanism for exception translation. Obviously, nothing can stop you from creating <span class="EmphasisFontCategoryNonProportional">SQLExceptionTranslator</span>                                as a Spring-managed bean and using the <span class="EmphasisFontCategoryNonProportional">JdbcTemplate</span> bean in your DAO classes. Don’t worry if you don’t remember reading about the <span class="EmphasisFontCategoryNonProportional">JdbcTemplate</span>                                class; we are going to discuss it in more detail.<span id="ITerm45">                          </span> </div>
                        </div>
                        <div class="Section1 RenderAsSection1" id="Sec10">
                            <h2 class="Heading">The JdbcTemplate Class</h2>
                            <div class="Para" id="Par118">This class represents the core of Spring’s JDBC support. It can execute all types of SQL statements. In the most simplistic view, you can classify the data definition and data manipulation statements. Data definition statements
                                cover creating various database objects (tables, views, stored procedures, and so on). Data manipulation statements manipulate the data and can be classified as select and update statements. A select statement generally
                                returns a set of rows; each row has the same set of columns. An update statement modifies the data in the database but does not return any results.</div>
                            <div class="Para ParaOneEmphasisChild" id="Par119">The <span class="EmphasisFontCategoryNonProportional">JdbcTemplate</span> class allows you to issue any type of SQL statement to the database and return any type of result.</div>
                            <div class="Para ParaOneEmphasisChild" id="Par120">In this section, we will go through several common use cases for JDBC programming in Spring with the <span class="EmphasisFontCategoryNonProportional">JdbcTemplate</span> class.</div>
                            <div class="Section2 RenderAsSection2" id="Sec11">
                                <h3 class="Heading">Initializing JdbcTemplate in a <span id="ITerm46">DAO Class                      </span> </h3>
                                <div class="Para" id="Par121">Before discussing how to use <span class="EmphasisFontCategoryNonProportional">JdbcTemplate</span>, let’s take a look at how to prepare <span class="EmphasisFontCategoryNonProportional">JdbcTemplate</span> for use in the
                                    DAO class. It’s straightforward; most of the time you just need to construct the class by passing in the data source object (which should be injected by Spring into the DAO class). The following code snippet shows the
                                    code snippet that will initialize the <span class="EmphasisFontCategoryNonProportional">JdbcTemplate</span> object:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">JdbcSingerDao</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerDao</span>, <span style="font-style:italic">InitializingBean</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">DataSource</span> dataSource;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">JdbcTemplate</span> jdbcTemplate;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setDataSource</span>(<span style="color:#00f;font-weight:700">DataSource</span> <span style="font-style:italic">dataSource</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>dataSource <span style="color:#00f;font-weight:700">=</span> dataSource;
        <span style="color:#00f;font-weight:700">JdbcTemplate</span> jdbcTemplate <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">JdbcTemplate</span>();
        jdbcTemplate<span style="color:#00f;font-weight:700">.</span>setDataSource(dataSource);
    }
    .<span style="color:#00f;font-weight:700">.</span>.
}</pre>
                                <div class="Para" id="Par123">The general practice is to initialize <span class="EmphasisFontCategoryNonProportional">JdbcTemplate</span> within the <span class="EmphasisFontCategoryNonProportional">setDataSource</span> method so that once the data
                                    source is injected by Spring, <span class="EmphasisFontCategoryNonProportional">JdbcTemplate</span> will also be initialized and ready for use.</div>
                                <div class="Para" id="Par124">Once configured, <span class="EmphasisFontCategoryNonProportional">JdbcTemplate</span> is thread-safe. That means you can also choose to initialize a single instance of <span class="EmphasisFontCategoryNonProportional">JdbcTemplate</span>                                    in Spring’s configuration and have it injected into all DAO beans. A configuration like this is depicted here:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6.config</span>;
.<span style="color:#00f;font-weight:700">.</span>.

@<span style="color:#00f;font-weight:700">Configuration</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">EmbeddedJdbcConfig</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">EmbeddedJdbcConfig</span><span style="color:#00f;font-weight:700">.</span>class);

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">DataSource</span> <span style="color:#0000a2;font-weight:700">dataSource</span>() {
        <span style="color:#00f;font-weight:700">try</span> {
            <span style="color:#00f;font-weight:700">EmbeddedDatabaseBuilder</span> dbBuilder <span style="color:#00f;font-weight:700">=</span>
                    <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">EmbeddedDatabaseBuilder</span>();
            <span style="color:#00f;font-weight:700">return</span> dbBuilder<span style="color:#00f;font-weight:700">.</span>setType(<span style="color:#00f;font-weight:700">EmbeddedDatabaseType</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>H2</span>)
                    .addScripts(<span style="color:#036a07">classpath:db/h2/schema.sql</span>,
                            <span style="color:#036a07">classpath:db/h2/test-data.sql</span>)<span style="color:#00f;font-weight:700">.</span>build();
        } <span style="color:#00f;font-weight:700">catch</span> (<span style="color:#00f;font-weight:700">Exception</span> e) {
            logger<span style="color:#00f;font-weight:700">.</span>error(<span style="color:#036a07">Embedded DataSource bean cannot be created!</span>, e);
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#585cf6;font-weight:700">null</span>;
        }
    }

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">JdbcTemplate</span> <span style="color:#0000a2;font-weight:700">jdbcTemplate</span>() {
        <span style="color:#00f;font-weight:700">JdbcTemplate</span> jdbcTemplate <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">JdbcTemplate</span>();
        jdbcTemplate<span style="color:#00f;font-weight:700">.</span>setDataSource(dataSource());
        <span style="color:#00f;font-weight:700">return</span> jdbcTemplate;
    }

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">SingerDao</span> <span style="color:#0000a2;font-weight:700">singerDao</span>() {
        <span style="color:#00f;font-weight:700">JdbcSingerDao</span> dao <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">JdbcSingerDao</span>();
        dao<span style="color:#00f;font-weight:700">.</span>setJdbcTemplate(jdbcTemplate());
        <span style="color:#00f;font-weight:700">return</span> dao;
    }
}</pre>
                                <div class="Para ParaOneEmphasisChild"> <span class="EmphasisTypeBold">Retrieving a Single-Value by Using JdbcTemplate</span> </div>
                                <div class="Para">Let’s start with a simple query that returns a single value. For example, we want to be able to retrieve the name of a singer by its ID. Using  <span class="EmphasisTypeUnderline">jdbcTemplate</span>, we can retrieve
                                    the value easily. The following code snippet shows the implementation of the <span class="EmphasisTypeItalic">findNameById()</span> method in the <span class="EmphasisTypeItalic">JdbcSingerDao</span> class. For other
                                    methods, empty implementations were created.
                                    <div class="ProgramCode">
                                        <div class="LineGroup">
                                            <div class="FixedLine"></div>
                                            <div class="FixedLine"><pre style="background:#fff;color:#000">.<span style="color:#00f;font-weight:700">.</span>.
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">JdbcSingerDao</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerDao</span>, <span style="font-style:italic">InitializingBean</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">JdbcTemplate</span> jdbcTemplate;
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setJdbcTemplate</span>(<span style="color:#00f;font-weight:700">JdbcTemplate</span> <span style="font-style:italic">jdbcTemplate</span>)  {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>jdbcTemplate <span style="color:#00f;font-weight:700">=</span> jdbcTemplate;
    }
    <span style="color:#00f;font-weight:700">@Override</span> <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">findNameById</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">id</span>) {
        <span style="color:#00f;font-weight:700">return</span> jdbcTemplate<span style="color:#00f;font-weight:700">.</span>queryForObject(
            <span style="color:#036a07">select first_name || &apos; &apos; || last_name from singer where id = ?</span>,
                <span style="color:#00f;font-weight:700">new</span> Object{id}, <span style="color:#00f;font-weight:700">String</span><span style="color:#00f;font-weight:700">.</span>class);
    }
    <span style="color:#00f;font-weight:700">@Override</span> <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">insert</span>(<span style="color:#00f;font-weight:700">Singer</span> <span style="font-style:italic">singer</span>) {
        <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">NotImplementedException</span>(<span style="color:#036a07">insert</span>);
    }
.<span style="color:#00f;font-weight:700">.</span>.
}
</pre></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="Para" id="Par126">In the previous listing, we use the <span class="EmphasisFontCategoryNonProportional">queryForObject()</span> method of <span class="EmphasisFontCategoryNonProportional">JdbcTemplate</span> to retrieve the value of the
                                    first name. The first argument is the SQL string, and the second argument consists of the parameters to be passed to the SQL for parameter binding in object array format. The last argument is the type to be returned,
                                    which is <span class="EmphasisFontCategoryNonProportional">String</span> in this case. Besides <span class="EmphasisFontCategoryNonProportional">Object</span>, you can also query for other types such as <span class="EmphasisFontCategoryNonProportional">Long</span>                                    and <span class="EmphasisFontCategoryNonProportional">Integer</span>. Let’s take a look at the outcome. The following code snippet shows the testing program. Again, a JUnit test class will be used because this allows
                                    us to run test methods separately, and as tests are run when executing <span class="EmphasisFontCategoryNonProportional">glade build</span>, we are also ensuring that our build remains stable.</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6</span>;

.<span style="color:#00f;font-weight:700">.</span>.
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Test</span>;

<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">org.junit.Assert.assertNotNull</span>;
<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">org.junit.Assert.assertTrue</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">JdbcCfgTest</span> {
    <span style="color:#00f;font-weight:700">@Test</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">testH2DB</span>() {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/embedded-h2-cfg.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        testDao(ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">SingerDao</span><span style="color:#00f;font-weight:700">.</span>class));
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">testDao</span>(<span style="color:#00f;font-weight:700">SingerDao</span> <span style="font-style:italic">singerDao</span>) {
        assertNotNull(singerDao);
        <span style="color:#00f;font-weight:700">String</span> singerName <span style="color:#00f;font-weight:700">=</span> singerDao<span style="color:#00f;font-weight:700">.</span>findNameById(<span style="color:#0000cd">1l</span>);
        assertTrue(<span style="color:#036a07">John Mayer</span><span style="color:#00f;font-weight:700">.</span>equals(singerName));
    }
}</pre>
                                <div class="Para" id="Par128">When executing the test method <span class="EmphasisFontCategoryNonProportional">testH2DB()</span>, we expect the <span class="EmphasisFontCategoryNonProportional">John Mayer</span> string to be returned by the <span class="EmphasisFontCategoryNonProportional">singerDao.findNameById(1l)</span>                                    call, and we test this assumption using the <span class="EmphasisFontCategoryNonProportional">asertTrue</span> method. If there were any problems when initializing the database, this test will fail.</div>
                            </div>
                            <div class="Section2 RenderAsSection2" id="Sec12">
                                <h3 class="Heading">Using <span id="ITerm49">Named Parameters                      </span> with NamedParameterJdbcTemplate</h3>
                                <div class="Para" id="Par129">In the previous example, we are using the normal placeholder (the <span class="EmphasisFontCategoryNonProportional">?</span> character) as a query parameter, and we need to pass the parameter values as an <span class="EmphasisFontCategoryNonProportional">Object</span>                                    array. When using a normal placeholder, the order is important, and the order that you put the parameters into the array should be the same as the order of the parameters in the query.</div>
                                <div class="Para" id="Par130">Some developers prefer to use named parameters to ensure that each parameter is being bound exactly as intended. In Spring, an extension of the <span class="EmphasisFontCategoryNonProportional">JdbcTemplate</span> class,
                                    called <span class="EmphasisFontCategoryNonProportional">NamedParameterJdbcTemplate</span> (under the package <span class="EmphasisFontCategoryNonProportional">org.springframework.jdbc.core.namedparam</span>), provides
                                    support for this.</div>
                                <div class="Para" id="Par131">The initialization of <span class="EmphasisFontCategoryNonProportional">NamedParameterJdbcTemplate</span> is the same as <span class="EmphasisFontCategoryNonProportional">JdbcTemplate</span>, so we just need to declare
                                    a bean of type <span class="EmphasisFontCategoryNonProportional">NamedParameterJdbcTemplate</span> and inject it in the <span class="EmphasisFontCategoryNonProportional">Dao</span> class. In the following code, you
                                    can see the new and improved <span class="EmphasisFontCategoryNonProportional">JdbcSingerDao</span>:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.HashMap</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Map</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">JdbcSingerDao</span> implements
        SingerDao, InitializingBean {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">NamedParameterJdbcTemplate</span> namedParameterJdbcTemplate;

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">findNameById</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">id</span>) {
        <span style="color:#00f;font-weight:700">String</span> sql <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">SELECT first_name ||&apos; &apos;|| last_name
        FROM singer WHERE id = :singerId </span>;
        <span style="color:#00f;font-weight:700">Map&lt;<span style="color:#00f;font-weight:700">String</span>, <span style="color:#00f;font-weight:700">Object</span>&gt;</span> namedParameters <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HashMap&lt;&gt;</span>();
        namedParameters<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">singerId</span>, id);
        <span style="color:#00f;font-weight:700">return</span> namedParameterJdbcTemplate<span style="color:#00f;font-weight:700">.</span>queryForObject(sql,
                namedParameters, <span style="color:#00f;font-weight:700">String</span><span style="color:#00f;font-weight:700">.</span>class);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> setNamedParameterJdbcTemplate
            (<span style="color:#00f;font-weight:700">NamedParameterJdbcTemplate</span> namedParameterJdbcTemplate) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>namedParameterJdbcTemplate <span style="color:#00f;font-weight:700">=</span> namedParameterJdbcTemplate;
    }

    @<span style="color:#00f;font-weight:700">Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> afterPropertiesSet() throws <span style="color:#00f;font-weight:700">Exception</span> {
        <span style="color:#00f;font-weight:700">if</span> (namedParameterJdbcTemplate <span style="color:#00f;font-weight:700">==</span> <span style="color:#585cf6;font-weight:700">null</span>) {
            <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> BeanCreationException
                    (&quot;Null NamedParameterJdbcTemplate on  SingerDao&quot;);
        }
    }
    .<span style="color:#00f;font-weight:700">.</span>.
}</pre>
                                <div class="Para" id="Par133">You will see that instead of the <span class="EmphasisFontCategoryNonProportional">?</span> placeholder, the named parameter (prefixed by a semicolon) is used instead: <span class="EmphasisFontCategoryNonProportional">:singerId</span>.
                                    The following code snippet can used to test the new <span class="EmphasisFontCategoryNonProportional">JdbcSingerDao</span>:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Test</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">NamedJdbcCfgTest</span> {
    <span style="color:#00f;font-weight:700">@Test</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">testCfg</span>() {
        <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">NamedJdbcCfg</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">SingerDao</span> singerDao <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">SingerDao</span><span style="color:#00f;font-weight:700">.</span>class);
        assertNotNull(singerDao);
        <span style="color:#00f;font-weight:700">String</span> singerName <span style="color:#00f;font-weight:700">=</span> singerDao<span style="color:#00f;font-weight:700">.</span>findNameById(<span style="color:#0000cd">1l</span>);
        assertTrue(<span style="color:#036a07">John Mayer</span><span style="color:#00f;font-weight:700">.</span>equals(singerName));
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                                <div class="Para" id="Par135">When executing the test method <span class="EmphasisFontCategoryNonProportional">testCfg()</span>, we expect the <span class="EmphasisFontCategoryNonProportional">John Mayer</span> string to be returned by the <span class="EmphasisFontCategoryNonProportional">singerDao.findNameById(1l)</span>                                    call, and we test this assumption using the <span class="EmphasisFontCategoryNonProportional">asertTrue</span> method. If there were any problems when initializing the database, this test will fail.</div>
                            </div>
                            <div class="Section2 RenderAsSection2" id="Sec13">
                                <h3 class="Heading">Retrieving Domain Objects with <span id="ITerm51">RowMapper&lt;T&gt;                      </span> </h3>
                                <div class="Para" id="Par136">Rather than retrieving a single value, most of the time you will want to query one or more rows and then transform each row into the corresponding domain object or entity. Spring’s <span class="EmphasisFontCategoryNonProportional">RowMapper&lt;T&gt;</span>                                    interface (under the package <span class="EmphasisFontCategoryNonProportional">org.springframework.jdbc.core</span>) provides a simple way for you to perform mapping from a JDBC result set to POJOs. Let’s see it in
                                    action by implementing the <span class="EmphasisFontCategoryNonProportional">findAll()</span> method of the <span class="EmphasisFontCategoryNonProportional">SingerDao</span> using the <span class="EmphasisFontCategoryNonProportional">RowMapper&lt;T&gt;</span>                                    interface. In the following code snippet, you can see the implementation of the <span class="EmphasisFontCategoryNonProportional">findAll()</span> method:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.sql.ResultSet</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.sql.SQLException</span>;<span style="color:#00f;font-weight:700">.</span><span style="color:#00f;font-weight:700">.</span>.

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">JdbcSingerDao</span> implements
        SingerDao, InitializingBean {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">NamedParameterJdbcTemplate</span> namedParameterJdbcTemplate;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setNamedParameterJdbcTemplate</span>(
            <span style="color:#00f;font-weight:700">NamedParameterJdbcTemplate</span> <span style="font-style:italic">namedParameterJdbcTemplate</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>namedParameterJdbcTemplate <span style="color:#00f;font-weight:700">=</span> namedParameterJdbcTemplate;
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAll</span>() {
        <span style="color:#00f;font-weight:700">String</span> sql <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">select id, first_name, last_name, birth_date from singer</span>;
        <span style="color:#00f;font-weight:700">return</span> namedParameterJdbcTemplate<span style="color:#00f;font-weight:700">.</span>query(sql, <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SingerMapper</span>());
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerMapper</span>
            <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">RowMapper&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> {
        <span style="color:#00f;font-weight:700">@Override</span>
        <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">mapRow</span>(<span style="color:#00f;font-weight:700">ResultSet</span> <span style="font-style:italic">rs</span>, <span style="color:#00f;font-weight:700">int</span> <span style="font-style:italic">rowNum</span>)
                <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">SQLException</span> {
            <span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Singer</span>();
            singer<span style="color:#00f;font-weight:700">.</span>setId(rs<span style="color:#00f;font-weight:700">.</span>getLong(<span style="color:#036a07">id</span>));
            singer<span style="color:#00f;font-weight:700">.</span>setFirstName(rs<span style="color:#00f;font-weight:700">.</span>getString(<span style="color:#036a07">first_name</span>));
            singer<span style="color:#00f;font-weight:700">.</span>setLastName(rs<span style="color:#00f;font-weight:700">.</span>getString(<span style="color:#036a07">last_name</span>));
            singer<span style="color:#00f;font-weight:700">.</span>setBirthDate(rs<span style="color:#00f;font-weight:700">.</span>getDate(<span style="color:#036a07">birth_date</span>));
            <span style="color:#00f;font-weight:700">return</span> singer;
        }
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">afterPropertiesSet</span>() <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Exception</span> {
        <span style="color:#00f;font-weight:700">if</span> (namedParameterJdbcTemplate <span style="color:#00f;font-weight:700">==</span> <span style="color:#585cf6;font-weight:700">null</span>) {
            <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">BeanCreationException</span>(
                    <span style="color:#036a07">Null NamedParameterJdbcTemplate on  SingerDao</span>);
        }
    }
}
</pre>
                                <div class="Para" id="Par138">In the previous code snippet, we define a static inner class called <span class="EmphasisFontCategoryNonProportional">SingerMapper</span> that implements the <span class="EmphasisFontCategoryNonProportional">RowMapper&lt;Singer&gt;</span>                                    interface. The class needs to provide the <span class="EmphasisFontCategoryNonProportional">mapRow()</span> implementation, which transforms the values in a specific record of the <span class="EmphasisFontCategoryNonProportional">ResultSet</span>                                    into the domain object you want. Making it a static inner class allows you to share the <span class="EmphasisFontCategoryNonProportional">RowMapper&lt;Singer&gt;</span> among multiple finder <span id="ITerm53">methods                      </span>.</div>
                                <div class="Para" id="Par139">The class <span class="EmphasisFontCategoryNonProportional">SingerMapper</span> explicit implementation can be skipped altogether using Java 8 lambda expressions; thus, the <span class="EmphasisFontCategoryNonProportional">findAll()</span>                                    method can be refactored like this:</div>
                            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> findAll(){
        <span style="color:#00f;font-weight:700">String</span> sql<span style="color:#00f;font-weight:700">=</span><span style="color:#036a07">select id, first_name, last_name, birth_date from singer</span>;
        <span style="color:#00f;font-weight:700">return</span> namedParameterJdbcTemplate<span style="color:#00f;font-weight:700">.</span>query(sql,(rs,rowNum)<span style="color:#00f;font-weight:700">-</span><span style="color:#00f;font-weight:700">&gt;</span>{
        <span style="color:#00f;font-weight:700">Singer</span> singer<span style="color:#00f;font-weight:700">=</span><span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Singer</span>();
        singer<span style="color:#00f;font-weight:700">.</span>setId(rs<span style="color:#00f;font-weight:700">.</span>getLong(<span style="color:#036a07">id</span>));
        singer<span style="color:#00f;font-weight:700">.</span>setFirstName(rs<span style="color:#00f;font-weight:700">.</span>getString(<span style="color:#036a07">first_name</span>));
        singer<span style="color:#00f;font-weight:700">.</span>setLastName(rs<span style="color:#00f;font-weight:700">.</span>getString(<span style="color:#036a07">last_name</span>));
        singer<span style="color:#00f;font-weight:700">.</span>setBirthDate(rs<span style="color:#00f;font-weight:700">.</span>getDate(<span style="color:#036a07">birth_date</span>));
        <span style="color:#00f;font-weight:700">return</span> singer;
        });
        }
</pre>
                            <div class="Para" id="Par141">Afterward, the <span class="EmphasisFontCategoryNonProportional">findAll()</span> method just needs to invoke the query method and pass in the query string and the row mapper. If the query requires parameters, the <span class="EmphasisFontCategoryNonProportional">query()</span>                                method provides an overloaded method that accepts the query parameters. The following test class contains a test method for the <span class="EmphasisFontCategoryNonProportional">findAll()</span> method:</div>
                            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Test</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">RowMapperTest</span> {
    <span style="color:#00f;font-weight:700">@Test</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">testRowMapper</span>() {
        <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">NamedJdbcCfg</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">SingerDao</span> singerDao <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">SingerDao</span><span style="color:#00f;font-weight:700">.</span>class);
        assertNotNull(singerDao);
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> singers <span style="color:#00f;font-weight:700">=</span> singerDao<span style="color:#00f;font-weight:700">.</span>findAll();
        assertTrue(singers<span style="color:#00f;font-weight:700">.</span>size() <span style="color:#00f;font-weight:700">==</span> <span style="color:#0000cd">3</span>);
        singers<span style="color:#00f;font-weight:700">.</span>forEach(singer <span style="color:#00f;font-weight:700">-</span><span style="color:#00f;font-weight:700">&gt;</span> {
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(singer);
            <span style="color:#00f;font-weight:700">if</span> (singer<span style="color:#00f;font-weight:700">.</span>getAlbums() <span style="color:#00f;font-weight:700">!=</span> <span style="color:#585cf6;font-weight:700">null</span>) {
                <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">Album</span> album <span style="color:#00f;font-weight:700">:</span>
                        singer<span style="color:#00f;font-weight:700">.</span>getAlbums()) {
                    <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">---</span> <span style="color:#00f;font-weight:700">+</span> album);
                }
            }
        });
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                            <div class="Para ParaOneEmphasisChild" id="Par143">If you run the <span class="EmphasisFontCategoryNonProportional">testRowMapper</span> method, the test must pass, and the following must be produced:</div>
                            <pre style="background:#fff;color:#000">Singer - Id: 1, First name: John, Last name: Mayer, Birthday: 1977-10-16

Singer - Id: 2, First name: Eric, Last name: Clapton, Birthday: 1945-03-30

Singer - Id: 3, First name: John, Last name: Butler, Birthday: 1975-04-01</pre>
                            <div class="Para" id="Par145">The albums are not printed because the <span class="EmphasisFontCategoryNonProportional">RowMapper&lt;Singer&gt;</span> implementation does not actually set them on the returned <span class="EmphasisFontCategoryNonProportional">Singer</span>                                instances.</div>
                        </div>
                        </div>
                        <div class="Section1 RenderAsSection1" id="Sec14">
                            <h2 class="Heading">Retrieving Nested Domain Objects with ResultSetExtractor</h2>
                            <div class="Para" id="Par146">Let’s proceed to a somewhat more complicated example, in which we need to retrieve the data from the parent (<span class="EmphasisFontCategoryNonProportional">SINGER</span>) and child (<span class="EmphasisFontCategoryNonProportional">ALBUM</span>)
                                tables with a join and then transform the data back into the nested object (<span class="EmphasisFontCategoryNonProportional">Album</span> within <span class="EmphasisFontCategoryNonProportional">Singer</span>) accordingly.</div>
                            <div class="Para" id="Par147">The previously mentioned <span class="EmphasisFontCategoryNonProportional">RowMapper&lt;T&gt;</span> is suitable only for row mapping to a single domain object. For a more complicated object structure, we need to use the
                                <span class="EmphasisFontCategoryNonProportional">ResultSetExtractor</span> interface. To demonstrate its use, let’s add one more method, <span class="EmphasisFontCategoryNonProportional">findAllWithAlbums()</span>, into the <span class="EmphasisFontCategoryNonProportional">SingerDao</span>                                    interface. The method should populate the list of singers with their album details.</div>
                        <div class="Para" id="Par148">The following code snippet shows the addition of the <span id="ITerm55">              <span class="EmphasisFontCategoryNonProportional">findAllWithAlbums()</span> </span> method to the interface and the implementation of the method
                            using <span class="EmphasisFontCategoryNonProportional">ResultSetExtractor</span>:</div>
                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.sql.ResultSet</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.sql.SQLException</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.ArrayList</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.HashMap</span>;<span style="color:#00f;font-weight:700">.</span><span style="color:#00f;font-weight:700">.</span>.

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">JdbcSingerDao</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerDao</span>, <span style="font-style:italic">InitializingBean</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">NamedParameterJdbcTemplate</span> namedParameterJdbcTemplate;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setNamedParameterJdbcTemplate</span>(
            <span style="color:#00f;font-weight:700">NamedParameterJdbcTemplate</span> <span style="font-style:italic">namedParameterJdbcTemplate</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>namedParameterJdbcTemplate <span style="color:#00f;font-weight:700">=</span> namedParameterJdbcTemplate;
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAllWithAlbums</span>() {
        <span style="color:#00f;font-weight:700">String</span> sql <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">select s.id, s.first_name, s.last_name, s.birth_date</span> <span style="color:#00f;font-weight:700">+</span>
                <span style="color:#036a07">, a.id as a.album_id, a.title, a.release_date from singer s </span> <span style="color:#00f;font-weight:700">+</span>
                <span style="color:#036a07">left join album a on s.id = a.singer_id</span>;
        <span style="color:#00f;font-weight:700">return</span> namedParameterJdbcTemplate<span style="color:#00f;font-weight:700">.</span>query(sql, <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SingerWithDetailExtractor</span>());
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerWithDetailExtractor</span> implements
            ResultSetExtractor&lt;List&lt;Singer&gt;&gt; {
        <span style="color:#00f;font-weight:700">@Override</span>
        <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">extractData</span>(<span style="color:#00f;font-weight:700">ResultSet</span> <span style="font-style:italic">rs</span>) <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">SQLException</span>,
                <span style="color:#00f;font-weight:700">DataAccessException</span> {
            <span style="color:#00f;font-weight:700">Map&lt;<span style="color:#00f;font-weight:700">Long</span>, <span style="color:#00f;font-weight:700">Singer</span>&gt;</span> map <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HashMap&lt;&gt;</span>();
            <span style="color:#00f;font-weight:700">Singer</span> singer;
            <span style="color:#00f;font-weight:700">while</span> (rs<span style="color:#00f;font-weight:700">.</span>next()) {
                <span style="color:#00f;font-weight:700">Long</span> id <span style="color:#00f;font-weight:700">=</span> rs<span style="color:#00f;font-weight:700">.</span>getLong(<span style="color:#036a07">id</span>);
                singer <span style="color:#00f;font-weight:700">=</span> map<span style="color:#00f;font-weight:700">.</span>get(id);
                <span style="color:#00f;font-weight:700">if</span> (singer <span style="color:#00f;font-weight:700">==</span> <span style="color:#585cf6;font-weight:700">null</span>) {
                    singer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Singer</span>();
                    singer<span style="color:#00f;font-weight:700">.</span>setId(id);
                    singer<span style="color:#00f;font-weight:700">.</span>setFirstName(rs<span style="color:#00f;font-weight:700">.</span>getString(<span style="color:#036a07">first_name</span>));
                    singer<span style="color:#00f;font-weight:700">.</span>setLastName(rs<span style="color:#00f;font-weight:700">.</span>getString(<span style="color:#036a07">last_name</span>));
                    singer<span style="color:#00f;font-weight:700">.</span>setBirthDate(rs<span style="color:#00f;font-weight:700">.</span>getDate(<span style="color:#036a07">birth_date</span>));
                    singer<span style="color:#00f;font-weight:700">.</span>setAlbums(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ArrayList&lt;&gt;</span>());
                    map<span style="color:#00f;font-weight:700">.</span>put(id, singer);
                }
                <span style="color:#00f;font-weight:700">Long</span> albumId <span style="color:#00f;font-weight:700">=</span> rs<span style="color:#00f;font-weight:700">.</span>getLong(<span style="color:#036a07">singer_tel_id</span>);
                <span style="color:#00f;font-weight:700">if</span> (albumId <span style="color:#00f;font-weight:700">&gt;</span> <span style="color:#0000cd">0</span>) {
                    <span style="color:#00f;font-weight:700">Album</span> album <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Album</span>();
                    album<span style="color:#00f;font-weight:700">.</span>setId(albumId);
                    album<span style="color:#00f;font-weight:700">.</span>setSingerId(id);
                    album<span style="color:#00f;font-weight:700">.</span>setTitle(rs<span style="color:#00f;font-weight:700">.</span>getString(<span style="color:#036a07">title</span>));
                    album<span style="color:#00f;font-weight:700">.</span>setReleaseDate(rs<span style="color:#00f;font-weight:700">.</span>getDate(<span style="color:#036a07">release_date</span>));
                    singer<span style="color:#00f;font-weight:700">.</span>addAbum(album);
                }
            }
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ArrayList&lt;&gt;</span>(map<span style="color:#00f;font-weight:700">.</span>values());
        }
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">afterPropertiesSet</span>() <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Exception</span> {

        <span style="color:#00f;font-weight:700">if</span> (namedParameterJdbcTemplate <span style="color:#00f;font-weight:700">==</span> <span style="color:#585cf6;font-weight:700">null</span>) {
            <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">BeanCreationException</span>(
                    <span style="color:#036a07">Null NamedParameterJdbcTemplate on SingerDao</span>);
        }
    }
}
</pre>
                        <div class="Para" id="Par150">The code looks quite like the <span class="EmphasisFontCategoryNonProportional">RowMapper</span> sample, but this time we declare an inner class that implements <span class="EmphasisFontCategoryNonProportional">ResultSetExtractor</span>.
                            Then we implement the <span class="EmphasisFontCategoryNonProportional">extractData()</span> method to transform the result set into a list of <span class="EmphasisFontCategoryNonProportional">Singer</span> objects accordingly.
                            For the <span class="EmphasisFontCategoryNonProportional">findAllWithDetail()</span> method, the query uses a left join to join the two tables so that singers with no albums will also be retrieved. The result is a Cartesian
                            product of the two tables. Finally, we use the <span class="EmphasisFontCategoryNonProportional">JdbcTemplate.query()</span> method, passing in the query string and the result set extractor.</div>
                        <div class="Para" id="Par151">Of course, the <span class="EmphasisFontCategoryNonProportional">SingerWithDetailExtractor</span> inner class is not actually necessary because <span id="ITerm58">lambda expressions                  </span> are used. Here you can
                            see the <span class="EmphasisFontCategoryNonProportional">findAllWithAlbums()</span> version that makes use of Java 8 lambda expressions:</div>
                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> findAllWithAlbums() {
        <span style="color:#00f;font-weight:700">String</span> sql <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">select s.id, s.first_name, s.last_name, s.birth_date</span> <span style="color:#00f;font-weight:700">+</span>
            <span style="color:#036a07">, a.id as a.album_id, a.title, a.release_date from singer s </span> <span style="color:#00f;font-weight:700">+</span>
             <span style="color:#036a07">left join album a on s.id = a.singer_id</span>;
        <span style="color:#00f;font-weight:700">return</span> namedParameterJdbcTemplate<span style="color:#00f;font-weight:700">.</span>query(sql, rs  <span style="color:#00f;font-weight:700">-</span><span style="color:#00f;font-weight:700">&gt;</span> {
            <span style="color:#00f;font-weight:700">Map&lt;<span style="color:#00f;font-weight:700">Long</span>, <span style="color:#00f;font-weight:700">Singer</span>&gt;</span> map <span style="color:#00f;font-weight:700">=</span>  <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HashMap&lt;&gt;</span>();
            <span style="color:#00f;font-weight:700">Singer</span> singer;
            <span style="color:#00f;font-weight:700">while</span> (rs<span style="color:#00f;font-weight:700">.</span>next())  {
                <span style="color:#00f;font-weight:700">Long</span> id <span style="color:#00f;font-weight:700">=</span> rs<span style="color:#00f;font-weight:700">.</span>getLong(<span style="color:#036a07">id</span>);
                singer <span style="color:#00f;font-weight:700">=</span>  map<span style="color:#00f;font-weight:700">.</span>get(id);
                <span style="color:#00f;font-weight:700">if</span> (singer <span style="color:#00f;font-weight:700">==</span>  <span style="color:#585cf6;font-weight:700">null</span>) {
                    singer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Singer</span>();
                    singer<span style="color:#00f;font-weight:700">.</span>setId(id);
                    singer<span style="color:#00f;font-weight:700">.</span>setFirstName(rs<span style="color:#00f;font-weight:700">.</span>getString(<span style="color:#036a07">first_name</span>));
                    singer<span style="color:#00f;font-weight:700">.</span>setLastName(rs<span style="color:#00f;font-weight:700">.</span>getString(<span style="color:#036a07">last_name</span>));
                    singer<span style="color:#00f;font-weight:700">.</span>setBirthDate(rs<span style="color:#00f;font-weight:700">.</span>getDate(<span style="color:#036a07">birth_date</span>));
                    singer<span style="color:#00f;font-weight:700">.</span>setAlbums(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ArrayList&lt;&gt;</span>());
                    map<span style="color:#00f;font-weight:700">.</span>put(id, singer);
                }
                <span style="color:#00f;font-weight:700">Long</span> albumId <span style="color:#00f;font-weight:700">=</span> rs<span style="color:#00f;font-weight:700">.</span>getLong(<span style="color:#036a07">singer_tel_id</span>);
                <span style="color:#00f;font-weight:700">if</span> (albumId <span style="color:#00f;font-weight:700">&gt;</span>  <span style="color:#0000cd">0</span>) {
                    <span style="color:#00f;font-weight:700">Album</span> album <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Album</span>();
                    album<span style="color:#00f;font-weight:700">.</span>setId(albumId);
                    album<span style="color:#00f;font-weight:700">.</span>setSingerId(id);
                    album<span style="color:#00f;font-weight:700">.</span>setTitle(rs<span style="color:#00f;font-weight:700">.</span>getString(<span style="color:#036a07">title</span>));
                    album<span style="color:#00f;font-weight:700">.</span>setReleaseDate(rs<span style="color:#00f;font-weight:700">.</span>getDate(<span style="color:#036a07">release_date</span>));
                    singer<span style="color:#00f;font-weight:700">.</span>addAbum(album);
                }
            }
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ArrayList&lt;&gt;</span>(map<span style="color:#00f;font-weight:700">.</span>values());
        });
}
</pre>
                        <div class="Para" id="Par153">The following <span id="ITerm60">test class                  </span> contains a test method for the <span class="EmphasisFontCategoryNonProportional">findAllWithAlbums()</span> method:</div>
                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">ResultSetExtractorTest</span> {
    <span style="color:#00f;font-weight:700">@Test</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">testResultSetExtractor</span>() {
        <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx  <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">NamedJdbcCfg</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">SingerDao</span> singerDao <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">SingerDao</span><span style="color:#00f;font-weight:700">.</span>class);
        assertNotNull(singerDao);
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> singers <span style="color:#00f;font-weight:700">=</span> findAllWithAlbums();
        assertTrue(singers<span style="color:#00f;font-weight:700">.</span>size() <span style="color:#00f;font-weight:700">==</span>  <span style="color:#0000cd">3</span>);
        singers<span style="color:#00f;font-weight:700">.</span>forEach(singer <span style="color:#00f;font-weight:700">-</span><span style="color:#00f;font-weight:700">&gt;</span> {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(singer);
            <span style="color:#00f;font-weight:700">if</span> (singer<span style="color:#00f;font-weight:700">.</span>getAlbums() <span style="color:#00f;font-weight:700">!=</span> <span style="color:#585cf6;font-weight:700">null</span>) {
                <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">Album</span> album   <span style="color:#00f;font-weight:700">:</span>
                        singer<span style="color:#00f;font-weight:700">.</span>getAlbums()) {
                    <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">&quot;<span style="color:#26b31a">\t</span>--&gt; &quot;</span> <span style="color:#00f;font-weight:700">+</span>  album);
                }
            }
        });
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                        <div class="Para ParaOneEmphasisChild" id="Par155">If you run the <span class="EmphasisFontCategoryNonProportional">testResultSetExtractor()</span> method, the test must pass, and the following must be produced:</div>
                        <pre style="background:#fff;color:#000">Singer - Id: 1, First name:  John, Last name:  Mayer, Birthday:  1977-10-16
    --&gt; Album - Id: 2, Singer id: 1, Title: Battle Studies,
            Release Date:  2009-11-17
    --&gt; Album - Id: 1, Singer id: 1, Title: The Search For Everything,
            Release Date:  2017-01-20
Singer - Id: 2, First name: Eric, Last name: Clapton, Birthday: 1945-03-30
    --&gt; Album - Id: 3, Singer id: 2, Title: From The Cradle,
            Release Date: 1994-09-13
Singer - Id: 3, First name: John, Last name: Butler, Birthday: 1975-04-01
</pre>
                        <div class="Para" id="Par157">You can see the singers and their album details are listed accordingly. The data is based on the data population script that you can find in <span class="EmphasisFontCategoryNonProportional">resources/db/test-data.sql</span> for
                            each of the JDBC sample projects. So far, you have seen how to use <span class="EmphasisFontCategoryNonProportional">JdbcTemplate</span> to perform some common query operations. <span class="EmphasisFontCategoryNonProportional">JdbcTemplate</span>                            (and the <span class="EmphasisFontCategoryNonProportional">NamedParameterJdbcTemplate</span> class too) provides a number of overloading <span class="EmphasisFontCategoryNonProportional">update()</span> methods that support
                            data update operations, including insert, update, delete, and so on. However, the <span class="EmphasisFontCategoryNonProportional">update()</span> method is quite self-explanatory, so we leave it as an exercise for you to
                            explore. On the other side, as you will see in later sections, we will use the Spring-provided <span class="EmphasisFontCategoryNonProportional">SqlUpdate</span> class to perform data update operations.</div>
                        </div>
                        <div class="Section1 RenderAsSection1" id="Sec15">
                            <h2 class="Heading">Spring Classes That Model JDBC Operations</h2>
                            <div class="Para" id="Par158">In the preceding section, you saw how <span class="EmphasisFontCategoryNonProportional">JdbcTemplate</span> and the related data mapper utility classes greatly simplify the programming model in developing data access logic
                                with JDBC. Built on top of <span class="EmphasisFontCategoryNonProportional">JdbcTemplate</span>, Spring also provides a number of useful classes that model JDBC data operations and let developers maintain the query and
                                transformation logic from <span class="EmphasisFontCategoryNonProportional">ResultSet</span> to domain objects in a more object-oriented fashion. Specifically, this section presents the following classes:
                                <div class="UnorderedList">
                                    <ul class="UnorderedListMarkBullet">
                                        <li>
                                            <div class="Para" id="Par159"> <span class="EmphasisFontCategoryNonProportional">MappingSqlQuery&lt;T&gt;</span>: The <span class="EmphasisFontCategoryNonProportional">MappingSqlQuery&lt;T&gt;</span> class allows you to wrap the query string
                                                together with the <span class="EmphasisFontCategoryNonProportional">mapRow()</span> method into a single class.</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par160"> <span class="EmphasisFontCategoryNonProportional">SqlUpdate</span>: The <span class="EmphasisFontCategoryNonProportional">SqlUpdate</span> class allows you to wrap any SQL update statement into it. It also provides
                                                a lot of useful functions for you to bind SQL parameters, retrieve the RDBMS-generated key after a new record is inserted, and so on.</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par161"> <span class="EmphasisFontCategoryNonProportional">BatchSqlUpdate</span>: As its name indicates, this class allows you to perform batch update operations. For example, you can loop through a Java <span class="EmphasisFontCategoryNonProportional">List</span>                                                object and have the <span class="EmphasisFontCategoryNonProportional">BatchSqlUpdate</span> queue up the records and submit the update statements for you in a batch. You can set the batch size and flush
                                                the operation at any time.</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par162"> <span class="EmphasisFontCategoryNonProportional">SqlFunction&lt;T&gt;</span>: The <span class="EmphasisFontCategoryNonProportional">SqlFunction&lt;T&gt;</span> class allows you to call stored functions in the
                                                database with argument and return types. Another class, <span class="EmphasisFontCategoryNonProportional">StoredProcedure</span>, also exists that helps you invoke stored procedures.</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par163">Setting up JDBC DAO by using annotations</div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="Para" id="Par164">First let’s take a look at how to set up the <span id="ITerm62">DAO implementation                  </span> class by using annotations. The following example code implements the <span class="EmphasisFontCategoryNonProportional">SingerDao</span>                                interface method by method until we have a full <span class="EmphasisFontCategoryNonProportional">SingerDao</span> implementation. The following code snippet shows the <span class="EmphasisFontCategoryNonProportional">SingerDao</span>                                interface class with a complete listing of the data access services it provides:</div>
                            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6.dao</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6.entities.Singer</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">SingerDao</span> {
    <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAll</span>();

    <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findByFirstName</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">firstName</span>);

    <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">findNameById</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">id</span>);

    <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">findLastNameById</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">id</span>);

    <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">findFirstNameById</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">id</span>);

    <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAllWithAlbums</span>();

    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">insert</span>(<span style="color:#00f;font-weight:700">Singer</span> <span style="font-style:italic">singer</span>);

    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">update</span>(<span style="color:#00f;font-weight:700">Singer</span> <span style="font-style:italic">singer</span>);

    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">delete</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">singerId</span>);

    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">insertWithAlbum</span>(<span style="color:#00f;font-weight:700">Singer</span> <span style="font-style:italic">singer</span>);
}
</pre>
                            <div class="Para" id="Par166">At the beginning of the book, stereotype annotations were introduced, and <span class="EmphasisFontCategoryNonProportional">@Repository</span> was introduced as a specialization of the <span class="EmphasisFontCategoryNonProportional">@Component</span>                                annotation, which is designed to be used for beans handling database operations.<a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_6_Chapter.html#Fn4" id="Fn4_source"><sup>4</sup></a>                                The following code snippet shows the initial declaration and injection of the data source property into a <span class="EmphasisFontCategoryNonProportional">@Repository</span> annotated DAO class using the <span id="ITerm64">JSR-250 annotation                  </span>:</div>
                            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6.dao</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">sun.rmi.runtime.Log</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.annotation.Resource</span>;<span style="color:#00f;font-weight:700">.</span><span style="color:#00f;font-weight:700">.</span>.

@Repository(<span style="color:#036a07">singerDao</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">JdbcSingerDao</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerDao</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">Log</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LogFactory</span><span style="color:#00f;font-weight:700">.</span>getLog(<span style="color:#00f;font-weight:700">JdbcSingerDao</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">DataSource</span> dataSource;

    <span style="color:#00f;font-weight:700">@Resource</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">dataSource</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setDataSource</span>(<span style="color:#00f;font-weight:700">DataSource</span> <span style="font-style:italic">dataSource</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>dataSource <span style="color:#00f;font-weight:700">=</span> dataSource;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">DataSource</span> <span style="color:#0000a2;font-weight:700">getDataSource</span>() {
        <span style="color:#00f;font-weight:700">return</span> dataSource;
    }
    .<span style="color:#00f;font-weight:700">.</span>.
}
</pre>
                        <div class="Para" id="Par169">In the previous listing, we use <span class="EmphasisFontCategoryNonProportional">@Repository</span> to declare the Spring bean with a name of <span class="EmphasisFontCategoryNonProportional">singerDao</span>, and since the class
                            contains data access code, <span class="EmphasisFontCategoryNonProportional">@Repository</span> also instructs Spring to perform database-specific SQL exceptions to the more application-friendly <span class="EmphasisFontCategoryNonProportional">DataAccessException</span>                            hierarchy in Spring.</div>
                        <div class="Para" id="Par170">We also declare the log variable by using SL4J logging to log the message within the program. We use JSR-250’s <span class="EmphasisFontCategoryNonProportional">@Resource</span> for the <span class="EmphasisFontCategoryNonProportional">dataSource</span>                            property to let Spring inject the data source with a name of <span id="ITerm65">              <span class="EmphasisFontCategoryNonProportional">dataSource</span> </span>.</div>
                        <div class="Para" id="Par171">In the following code sample, you can see the Java configuration class for the situation when annotations are used to declare DAO handling beans:</div>
                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6.config</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.apache.commons.dbcp2.BasicDataSource</span>;
.<span style="color:#00f;font-weight:700">.</span>.

@<span style="color:#00f;font-weight:700">Configuration</span>
@PropertySource(<span style="color:#036a07">classpath:db/jdbc2.properties</span>)
@ComponentScan(basePackages <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">com.apress.prospring5.ch6</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AppConfig</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">AppConfig</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">@Value</span>(<span style="color:#036a07">${driverClassName}</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> driverClassName;
    <span style="color:#00f;font-weight:700">@Value</span>(<span style="color:#036a07">${url}</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> url;
    <span style="color:#00f;font-weight:700">@Value</span>(<span style="color:#036a07">${username}</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> username;
    <span style="color:#00f;font-weight:700">@Value</span>(<span style="color:#036a07">${password}</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> password;

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">PropertySourcesPlaceholderConfigurer</span>
    propertySourcesPlaceholderConfigurer() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">PropertySourcesPlaceholderConfigurer</span>();
    }

    @Bean(destroyMethod <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">close</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">DataSource</span> dataSource() {
        <span style="color:#00f;font-weight:700">try</span> {
            <span style="color:#00f;font-weight:700">BasicDataSource</span> dataSource <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">BasicDataSource</span>();
            dataSource<span style="color:#00f;font-weight:700">.</span>setDriverClassName(driverClassName);
            dataSource<span style="color:#00f;font-weight:700">.</span>setUrl(url);
            dataSource<span style="color:#00f;font-weight:700">.</span>setUsername(username);
            dataSource<span style="color:#00f;font-weight:700">.</span>setPassword(password);
            <span style="color:#00f;font-weight:700">return</span> dataSource;
        } <span style="color:#00f;font-weight:700">catch</span> (<span style="color:#00f;font-weight:700">Exception</span> e) {
            logger<span style="color:#00f;font-weight:700">.</span>error(<span style="color:#036a07">DBCP DataSource bean cannot be created!</span>, e);
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#585cf6;font-weight:700">null</span>;
        }
    }
}
</pre>
                        <div class="Para" id="Par173">In this configuration, we declare a MySQL database, which is being accessed using a poolable <span class="EmphasisFontCategoryNonProportional">BasicDataSource</span>, and use component scanning for automatic Spring bean discovery.
                            You were instructed at the beginning of the chapter how to install and set up a MySQL database and create the <span class="EmphasisFontCategoryNonProportional">musicdb</span> schema. Having the infrastructure in place, we can
                            now proceed to the implementation of JDBC operations.</div>
                        </div>
                        <div class="Section1 RenderAsSection1" id="Sec16">
                            <h2 class="Heading">Querying Data by Using MappingSqlQuery&lt;T&gt;</h2>
                            <div class="Para" id="Par174">Spring provides the <span class="EmphasisFontCategoryNonProportional">MappingSqlQuery&lt;T&gt;</span> class for modeling query operations. Basically, we construct a <span class="EmphasisFontCategoryNonProportional">MappingSqlQuery&lt;T&gt;</span>                                class by using the data source and the query string. We then implement the <span class="EmphasisFontCategoryNonProportional">mapRow()</span> method to map each <span class="EmphasisFontCategoryNonProportional">ResultSet</span>                                record into the corresponding domain object.</div>
                            <div class="Para" id="Par175">Let’s begin by creating the <span id="ITerm67">              <span class="EmphasisFontCategoryNonProportional">SelectAllSingers</span> </span> class (which represents the query operation for selecting all singers) that extends
                                the <span class="EmphasisFontCategoryNonProportional">MappingSqlQuery&lt;T&gt;</span> abstract class. The <span class="EmphasisFontCategoryNonProportional">SelectAllSingers</span> class is shown here:</div>
                            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.sql.ResultSet</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.sql.SQLException</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.sql.DataSource</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6.entities.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.jdbc.object.MappingSqlQuery</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SelectAllSingers</span> <span style="color:#00f;font-weight:700">extends</span> <span style="font-style:italic">MappingSqlQuery&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#c5060b;font-weight:700">SQL_SELECT_ALL_SINGER</span> <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#036a07">select id, first_name, last_name, birth_date from singer</span>;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">SelectAllSingers</span>(<span style="color:#00f;font-weight:700">DataSource</span> <span style="font-style:italic">dataSource</span>) {
        <span style="color:#318495">super</span>(dataSource, <span style="color:#c5060b;font-weight:700">SQL_SELECT_ALL_SINGER</span>);
    }

    <span style="color:#00f;font-weight:700">protected</span> <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">mapRow</span>(<span style="color:#00f;font-weight:700">ResultSet</span> <span style="font-style:italic">rs</span>, <span style="color:#00f;font-weight:700">int</span> <span style="font-style:italic">rowNum</span>)
            <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">SQLException</span> {
        <span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Singer</span>();
        singer<span style="color:#00f;font-weight:700">.</span>setId(rs<span style="color:#00f;font-weight:700">.</span>getLong(<span style="color:#036a07">id</span>));
        singer<span style="color:#00f;font-weight:700">.</span>setFirstName(rs<span style="color:#00f;font-weight:700">.</span>getString(<span style="color:#036a07">first_name</span>));
        singer<span style="color:#00f;font-weight:700">.</span>setLastName(rs<span style="color:#00f;font-weight:700">.</span>getString(<span style="color:#036a07">last_name</span>));
        singer<span style="color:#00f;font-weight:700">.</span>setBirthDate(rs<span style="color:#00f;font-weight:700">.</span>getDate(<span style="color:#036a07">birth_date</span>));
        <span style="color:#00f;font-weight:700">return</span> singer;
    }
}
</pre>
                            <div class="Para" id="Par177">Within the <span class="EmphasisFontCategoryNonProportional">SelectAllSingers</span> class, the SQL for selecting all singers is declared. In the class constructor, the <span class="EmphasisFontCategoryNonProportional">super()</span>                                method is called to construct the class, using the <span class="EmphasisFontCategoryNonProportional">DataSource</span> as well as the SQL statement. Moreover, the <span class="EmphasisFontCategoryNonProportional">MappingSqlQuery&lt;T&gt;.mapRow()</span>                                method is implemented to provide the mapping of the result set to the <span class="EmphasisFontCategoryNonProportional">Singer</span> domain <span id="ITerm68">object                  </span>.</div>
                            <div class="Para" id="Par178">Having the <span class="EmphasisFontCategoryNonProportional">SelectAllSingers</span> class in place, we can implement the <span class="EmphasisFontCategoryNonProportional">findAll()</span> method in the <span class="EmphasisFontCategoryNonProportional">JdbcSingerDao</span>                                class. The following code snippet depicts a section of the <span class="EmphasisFontCategoryNonProportional">JdbcSingerDao</span> class:</div>
                            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.annotation.Resource</span>;

@Repository(<span style="color:#036a07">singerDao</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">JdbcSingerDao</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerDao</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">DataSource</span> dataSource;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SelectAllSingers</span> selectAllSingers;

    <span style="color:#00f;font-weight:700">@Resource</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">dataSource</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setDataSource</span>(<span style="color:#00f;font-weight:700">DataSource</span> <span style="font-style:italic">dataSource</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>dataSource <span style="color:#00f;font-weight:700">=</span> dataSource;
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>selectAllSingers <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SelectAllSingers</span>(dataSource);
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAll</span>() {
        <span style="color:#00f;font-weight:700">return</span> selectAllSingers<span style="color:#00f;font-weight:700">.</span>execute();
    }
    .<span style="color:#00f;font-weight:700">.</span>.
}
</pre>
                            <div class="Para" id="Par180">In the <span id="ITerm69">              <span class="EmphasisFontCategoryNonProportional">setDataSource()</span> </span> method, upon the injection of the <span class="EmphasisFontCategoryNonProportional">DataSource</span>,
                                an instance of the <span class="EmphasisFontCategoryNonProportional">SelectAllSingers</span> class is constructed. In the <span class="EmphasisFontCategoryNonProportional">findAll()</span> method, we simply invoke the
                                <span class="EmphasisFontCategoryNonProportional">execute()</span> method, which is inherited from the <span class="EmphasisFontCategoryNonProportional">SqlQuery&lt;T&gt;</span> abstract class indirectly. That’s all we need to do. The following code snippet shows the method
                                    used to test the <span class="EmphasisFontCategoryNonProportional">findAll()</span> method implemented this way:</div>
                            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Before</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Test</span>;com<span style="color:#00f;font-weight:700">.</span>apress<span style="color:#00f;font-weight:700">.</span>prospring5<span style="color:#00f;font-weight:700">.</span>ch6;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AnnotationJdbcTest</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SingerDao</span> singerDao;

    <span style="color:#00f;font-weight:700">@Before</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setUp</span>() {
        ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">AppConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        singerDao <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">SingerDao</span><span style="color:#00f;font-weight:700">.</span>class);
        assertNotNull(singerDao);
    }

    <span style="color:#00f;font-weight:700">@Test</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">testFindAll</span>() {
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> singers <span style="color:#00f;font-weight:700">=</span> singerDao<span style="color:#00f;font-weight:700">.</span>findAll();
        assertTrue(singers<span style="color:#00f;font-weight:700">.</span>size() <span style="color:#00f;font-weight:700">==</span> <span style="color:#0000cd">3</span>);
        singers<span style="color:#00f;font-weight:700">.</span>forEach(singer <span style="color:#00f;font-weight:700">-</span><span style="color:#00f;font-weight:700">&gt;</span> {
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(singer);
            <span style="color:#00f;font-weight:700">if</span> (singer<span style="color:#00f;font-weight:700">.</span>getAlbums() <span style="color:#00f;font-weight:700">!=</span> <span style="color:#585cf6;font-weight:700">null</span>) {
                <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">Album</span> album <span style="color:#00f;font-weight:700">:</span> singer<span style="color:#00f;font-weight:700">.</span>getAlbums()) {
                    <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">&quot;<span style="color:#26b31a">\t</span>--&gt; &quot;</span> <span style="color:#00f;font-weight:700">+</span> album);
                }
            }
        });
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }

    <span style="color:#00f;font-weight:700">@After</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">tearDown</span>() {
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                            <div class="Para" id="Par182">Running the testing method, if the test passes, yields the following output:</div>
                            <pre style="background:#fff;color:#000">Singer - Id: 1, First name:  John, Last name:  Mayer, Birthday:  1977-10-15
Singer - Id: 2, First name:  Eric, Last name:  Clapton, Birthday:  1945-03-29
Singer - Id: 3, First name:  John, Last name:  Butler,  Birthday: 1975-03-31
</pre>
                            <div class="Para" id="Par184">If <span class="EmphasisFontCategoryNonProportional">DEBUG</span> logging is enabled for the <span class="EmphasisFontCategoryNonProportional">org.springframework.jdbc</span> package by editing the <span class="EmphasisFontCategoryNonProportional">logback-test.xml</span>                                configuration file and adding the following element:</div>
                            <pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">logger</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">org.springframework.jdbc</span> <span style="font-style:italic">level</span>=<span style="color:#036a07">debug</span>/&gt;</span>
</pre>
                            <div class="Para" id="Par186">then in the console you will also see the query that was submitted by Spring, as shown here:</div>
                            <pre style="background:#fff;color:#000">DEBUG o.s.j.c.JdbcTemplate - Executing prepared SQL query
DEBUG o.s.j.c.JdbcTemplate - Executing prepared SQL statement
   [select id, first_name, last_name, birth_date from singer]
</pre>
                            <div class="Para" id="Par188">Let’s proceed to implement the <span class="EmphasisFontCategoryNonProportional">findByFirstName()</span> method, which takes one named parameter. As in the previous sample, we create the class <span class="EmphasisFontCategoryNonProportional">SelectSingerByFirstName</span>                                for the operation, which is depicted here:</div>
                            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.After</span>;
<span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6</span>;
        .<span style="color:#00f;font-weight:700">.</span>.
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.jdbc.core.SqlParameter</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.sql.ResultSet</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.sql.SQLException</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.sql.Types</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SelectSingerByFirstName</span> <span style="color:#00f;font-weight:700">extends</span> <span style="font-style:italic">MappingSqlQuery&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#c5060b;font-weight:700">SQL_FIND_BY_FIRST_NAME</span> <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#036a07">select id, first_name, last_name, birth_date from
    singer where
    first_name =:first_name</span>;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">SelectSingerByFirstName</span>(<span style="color:#00f;font-weight:700">DataSource</span> <span style="font-style:italic">dataSource</span>) {
        <span style="color:#318495">super</span>(dataSource, <span style="color:#c5060b;font-weight:700">SQL_FIND_BY_FIRST_NAME</span>);
        <span style="color:#318495">super</span><span style="color:#00f;font-weight:700">.</span>declareParameter(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SqlParameter</span>(<span style="color:#036a07">first_name</span>, <span style="color:#00f;font-weight:700">Types</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>VARCHAR</span>));
    }

    <span style="color:#00f;font-weight:700">protected</span> <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">mapRow</span>(<span style="color:#00f;font-weight:700">ResultSet</span> <span style="font-style:italic">rs</span>, <span style="color:#00f;font-weight:700">int</span> <span style="font-style:italic">rowNum</span>) <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">SQLException</span> {
        <span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Singer</span>();
        singer<span style="color:#00f;font-weight:700">.</span>setId(rs<span style="color:#00f;font-weight:700">.</span>getLong(<span style="color:#036a07">id</span>));
        singer<span style="color:#00f;font-weight:700">.</span>setFirstName(rs<span style="color:#00f;font-weight:700">.</span>getString(<span style="color:#036a07">first_name</span>));
        singer<span style="color:#00f;font-weight:700">.</span>setLastName(rs<span style="color:#00f;font-weight:700">.</span>getString(<span style="color:#036a07">last_name</span>));
        singer<span style="color:#00f;font-weight:700">.</span>setBirthDate(rs<span style="color:#00f;font-weight:700">.</span>getDate(<span style="color:#036a07">birth_date</span>));
        <span style="color:#00f;font-weight:700">return</span> singer;
    }
}
</pre>
                            <div class="Para" id="Par190">The <span class="EmphasisFontCategoryNonProportional">SelectSingerByFirstName</span> class is similar to the <span class="EmphasisFontCategoryNonProportional">SelectAllSingers</span> class. First, the SQL statement is different
                                and carries a named parameter called <span class="EmphasisFontCategoryNonProportional">first_name</span>. In the constructor method, the <span class="EmphasisFontCategoryNonProportional">declareParameter()</span> method
                                is called (which is inherited from the <span class="EmphasisFontCategoryNonProportional">org.springframework.jdbc.object.RdbmsOperation</span> abstract class indirectly). Let’s proceed to implement the <span class="EmphasisFontCategoryNonProportional">findByFirstName()</span>                                method in the <span class="EmphasisFontCategoryNonProportional">JdbcSingerDao</span> class. Here you can see the updated code:</div>
                            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6.dao</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.annotation.Resource</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.HashMap</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Map</span>;<span style="color:#00f;font-weight:700">.</span><span style="color:#00f;font-weight:700">.</span>.

@Repository(<span style="color:#036a07">singerDao</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">JdbcSingerDao</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerDao</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">JdbcSingerDao</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">DataSource</span> dataSource;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SelectSingerByFirstName</span> selectSingerByFirstName;

    <span style="color:#00f;font-weight:700">@Resource</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">dataSource</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setDataSource</span>(<span style="color:#00f;font-weight:700">DataSource</span> <span style="font-style:italic">dataSource</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>dataSource <span style="color:#00f;font-weight:700">=</span> dataSource;
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>selectSingerByFirstName <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SelectSingerByFirstName</span>(dataSource);
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findByFirstName</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">firstName</span>) {
        <span style="color:#00f;font-weight:700">Map&lt;<span style="color:#00f;font-weight:700">String</span>, <span style="color:#00f;font-weight:700">Object</span>&gt;</span> paramMap <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HashMap&lt;&gt;</span>();
        paramMap<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">first_name</span>, firstName);
        <span style="color:#00f;font-weight:700">return</span> selectSingerByFirstName<span style="color:#00f;font-weight:700">.</span>executeByNamedParam(paramMap);
    }
.<span style="color:#00f;font-weight:700">.</span>.
}
</pre>
                            <div class="Para" id="Par192">Upon data source injection, an instance of <span class="EmphasisFontCategoryNonProportional">SelectSingerByFirstName</span> is constructed. Afterward, in the <span class="EmphasisFontCategoryNonProportional">findByFirstName()</span>                                method, a <span class="EmphasisFontCategoryNonProportional">HashMap</span> is constructed with the named parameters and values. Finally, the <span class="EmphasisFontCategoryNonProportional">executeByNamedParam()</span>                                method (inherited from the <span class="EmphasisFontCategoryNonProportional">SqlQuery&lt;T&gt;</span> abstract class indirectly) is called. Let’s test this method by executing the <span class="EmphasisFontCategoryNonProportional">testFindByFirstName()</span>                                <span id="ITerm72">test method                  </span> shown here:</div>
                            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6</span>;

.<span style="color:#00f;font-weight:700">.</span>.
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.After</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Before</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Test</span>;

<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">org.junit.Assert.assertNotNull</span>;
<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">org.junit.Assert.assertTrue</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AnnotationJdbcTest</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SingerDao</span> singerDao;

    <span style="color:#00f;font-weight:700">@Before</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setUp</span>() {
        ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">AppConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        singerDao <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">SingerDao</span><span style="color:#00f;font-weight:700">.</span>class);
        assertNotNull(singerDao);
    }

    <span style="color:#00f;font-weight:700">@Test</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">testFindByFirstName</span>() {
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> singers <span style="color:#00f;font-weight:700">=</span> singerDao<span style="color:#00f;font-weight:700">.</span>findByFirstName(<span style="color:#036a07">John</span>);
        assertTrue(singers<span style="color:#00f;font-weight:700">.</span>size() <span style="color:#00f;font-weight:700">==</span> <span style="color:#0000cd">1</span>);
        listSingers(singers);
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">listSingers</span>(<span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="font-style:italic">singers</span>) {
        singers<span style="color:#00f;font-weight:700">.</span>forEach(singer <span style="color:#00f;font-weight:700">-</span><span style="color:#00f;font-weight:700">&gt;</span> {
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(singer);
            <span style="color:#00f;font-weight:700">if</span> (singer<span style="color:#00f;font-weight:700">.</span>getAlbums() <span style="color:#00f;font-weight:700">!=</span> <span style="color:#585cf6;font-weight:700">null</span>) {
                <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">Album</span> album <span style="color:#00f;font-weight:700">:</span> singer<span style="color:#00f;font-weight:700">.</span>getAlbums()) {
                    <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">&quot;<span style="color:#26b31a">\t</span>--&gt; &quot;</span> <span style="color:#00f;font-weight:700">+</span> album);
                }
            }
        });
    }

    <span style="color:#00f;font-weight:700">@After</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">tearDown</span>() {
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                            <div class="Para" id="Par194">Running the testing method, if the test passes, yields the following output:</div>
                            <div class="Para" id="Par195">
                                <div class="ProgramCode" id="PC57">
                                    <div class="FixedLine">Singer - Id: 1, First name: John, Last name: Mayer, Birthday: 1977-10-15</div>
                                </div>
                            </div>
                            <div class="Para" id="Par196">One point worth noting here is that <span class="EmphasisFontCategoryNonProportional">MappingSqlQuery&lt;T&gt;</span> is suitable only for mapping a single row to a domain object. For a nested object, you still need to use
                                <span class="EmphasisFontCategoryNonProportional">JdbcTemplate</span> with <span class="EmphasisFontCategoryNonProportional">ResultSetExtractor</span>, like the example method <span class="EmphasisFontCategoryNonProportional">findAllWithAlbums()</span>                                presented in the <span class="EmphasisFontCategoryNonProportional">JdbcTemplate</span> class section.</div>
                            <div class="Section2 RenderAsSection2" id="Sec17">
                                <h3 class="Heading">Updating Data by Using SqlUpdate</h3>
                                <div class="Para" id="Par197">For updating data, Spring provides the <span id="ITerm74">                <span class="EmphasisFontCategoryNonProportional">SqlUpdate</span> </span> class. The following code snippet shows the <span class="EmphasisFontCategoryNonProportional">UpdateSinger</span>                                    class that extends the <span class="EmphasisFontCategoryNonProportional">SqlUpdate</span> class for update operations:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.sql.Types</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.sql.DataSource</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.jdbc.core.SqlParameter</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.jdbc.object.SqlUpdate</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">UpdateSinger</span> <span style="color:#00f;font-weight:700">extends</span> <span style="font-style:italic">SqlUpdate</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#c5060b;font-weight:700">SQL_UPDATE_SINGER</span> <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#036a07">update singer set first_name=:first_name, last_name=:last_name,
    birth_date=:
    birth_date where
    id=:id</span>;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">UpdateSinger</span>(<span style="color:#00f;font-weight:700">DataSource</span> <span style="font-style:italic">dataSource</span>) {
        <span style="color:#318495">super</span>(dataSource, <span style="color:#c5060b;font-weight:700">SQL_UPDATE_SINGER</span>);
        <span style="color:#318495">super</span><span style="color:#00f;font-weight:700">.</span>declareParameter(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SqlParameter</span>(<span style="color:#036a07">first_name</span>, <span style="color:#00f;font-weight:700">Types</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>VARCHAR</span>));
        <span style="color:#318495">super</span><span style="color:#00f;font-weight:700">.</span>declareParameter(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SqlParameter</span>(<span style="color:#036a07">last_name</span>, <span style="color:#00f;font-weight:700">Types</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>VARCHAR</span>));
        <span style="color:#318495">super</span><span style="color:#00f;font-weight:700">.</span>declareParameter(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SqlParameter</span>(<span style="color:#036a07">birth_date</span>, <span style="color:#00f;font-weight:700">Types</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>DATE</span>));
        <span style="color:#318495">super</span><span style="color:#00f;font-weight:700">.</span>declareParameter(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SqlParameter</span>(<span style="color:#036a07">id</span>, <span style="color:#00f;font-weight:700">Types</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>INTEGER</span>));
    }
}
</pre>
                                <div class="Para" id="Par199">The preceding listing should be familiar to you now. An instance of the <span class="EmphasisFontCategoryNonProportional">SqlUpdate</span> class is constructed with the query, and the named parameters are declared too.
                                    The following code snippet shows the implementation of the <span class="EmphasisFontCategoryNonProportional">update()</span> method in the <span class="EmphasisFontCategoryNonProportional">JdbcSingerDao</span> class:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6.dao</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.annotation.Resource</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.HashMap</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Map</span>;<span style="color:#00f;font-weight:700">.</span><span style="color:#00f;font-weight:700">.</span>.

@Repository(<span style="color:#036a07">singerDao</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">JdbcSingerDao</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerDao</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">JdbcSingerDao</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">DataSource</span> dataSource;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">UpdateSinger</span> updateSinger;

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">update</span>(<span style="color:#00f;font-weight:700">Singer</span> <span style="font-style:italic">singer</span>) {
        <span style="color:#00f;font-weight:700">Map&lt;<span style="color:#00f;font-weight:700">String</span>, <span style="color:#00f;font-weight:700">Object</span>&gt;</span> paramMap <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HashMap&lt;<span style="color:#00f;font-weight:700">String</span>, <span style="color:#00f;font-weight:700">Object</span>&gt;</span>();
        paramMap<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">first_name</span>, singer<span style="color:#00f;font-weight:700">.</span>getFirstName());
        paramMap<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">last_name</span>, singer<span style="color:#00f;font-weight:700">.</span>getLastName());
        paramMap<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">birth_date</span>, singer<span style="color:#00f;font-weight:700">.</span>getBirthDate());
        paramMap<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">id</span>, singer<span style="color:#00f;font-weight:700">.</span>getId());
        updateSinger<span style="color:#00f;font-weight:700">.</span>updateByNamedParam(paramMap);
        logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">Existing singer updated with  id: </span> <span style="color:#00f;font-weight:700">+</span> singer<span style="color:#00f;font-weight:700">.</span>getId());
    }

    <span style="color:#00f;font-weight:700">@Resource</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">dataSource</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setDataSource</span>(<span style="color:#00f;font-weight:700">DataSource</span> <span style="font-style:italic">dataSource</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>dataSource <span style="color:#00f;font-weight:700">=</span> dataSource;
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>updateSinger <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">UpdateSinger</span>(dataSource);
    }
    .<span style="color:#00f;font-weight:700">.</span>.
}
</pre>
                            <div class="Para" id="Par201">Upon data source injection, an instance of <span class="EmphasisFontCategoryNonProportional">UpdateSinger</span> is constructed. In the <span class="EmphasisFontCategoryNonProportional">update()</span> method, a <span class="EmphasisFontCategoryNonProportional">HashMap</span>                                of named parameters is constructed from the passed-in <span class="EmphasisFontCategoryNonProportional">Singer</span> object, and then <span class="EmphasisFontCategoryNonProportional">updateByNamedParam()</span> is called
                                to update the contact record. To test the operation, let’s add a new method to the <span class="EmphasisFontCategoryNonProportional">AnnotationJdbcTest</span>.</div>
                            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.After</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Before</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Test</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.GregorianCalendar</span>;<span style="color:#00f;font-weight:700">.</span><span style="color:#00f;font-weight:700">.</span>.

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AnnotationJdbcTest</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SingerDao</span> singerDao;

    <span style="color:#00f;font-weight:700">@Before</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setUp</span>() {
        ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">AppConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        singerDao <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">SingerDao</span><span style="color:#00f;font-weight:700">.</span>class);
        assertNotNull(singerDao);
    }

    <span style="color:#00f;font-weight:700">@Test</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">testSingerUpdate</span>() {
        <span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Singer</span>();
        singer<span style="color:#00f;font-weight:700">.</span>setId(<span style="color:#0000cd">1L</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setFirstName(<span style="color:#036a07">John Clayton</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setLastName(<span style="color:#036a07">Mayer</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setBirthDate(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Date</span>(
                (<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GregorianCalendar</span>(<span style="color:#0000cd">1977</span>, <span style="color:#0000cd">9</span>, <span style="color:#0000cd">16</span>))<span style="color:#00f;font-weight:700">.</span>getTime()<span style="color:#00f;font-weight:700">.</span>getTime()));
        singerDao<span style="color:#00f;font-weight:700">.</span>update(singer);
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> singers <span style="color:#00f;font-weight:700">=</span> singerDao<span style="color:#00f;font-weight:700">.</span>findAll();
        listSingers(singers);
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">listSingers</span>(<span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="font-style:italic">singers</span>) {
        singers<span style="color:#00f;font-weight:700">.</span>forEach(singer <span style="color:#00f;font-weight:700">-</span><span style="color:#00f;font-weight:700">&gt;</span> {
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(singer);
            <span style="color:#00f;font-weight:700">if</span> (singer<span style="color:#00f;font-weight:700">.</span>getAlbums() <span style="color:#00f;font-weight:700">!=</span> <span style="color:#585cf6;font-weight:700">null</span>) {
                <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">Album</span> album <span style="color:#00f;font-weight:700">:</span> singer<span style="color:#00f;font-weight:700">.</span>getAlbums()) {
                    <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">&quot;<span style="color:#26b31a">\t</span>--&gt; &quot;</span> <span style="color:#00f;font-weight:700">+</span> album);
                }
            }
        });
    }

    <span style="color:#00f;font-weight:700">@After</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">tearDown</span>() {
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                            <div class="Para" id="Par203">Here we simply construct a <span class="EmphasisFontCategoryNonProportional">Singer</span> object and then invoke the <span class="EmphasisFontCategoryNonProportional">update()</span> method. Running the program produces the
                                following output from the last <span class="EmphasisFontCategoryNonProportional">listSingers()</span> method. Running the testing method, if the test passes, yields the following output:</div>
                            <div class="Para" id="Par204">
                                <div class="ProgramCode" id="PC61">
                                    <pre style="background:#fff;color:#000">Singer - Id: 1, First name: John Clayton, Last name: Mayer, Birthday: 1977-10-16
Singer - Id: 2, First name: Eric, Last name: Clapton, Birthday: 1945-03-29
Singer - Id: 3, First name: Jimi, Last name: Hendrix, Birthday: 1942-11-26</pre>
                                </div>
                            </div>
                        </div>
                        </div>
                        <div class="Section1 RenderAsSection1" id="Sec18">
                            <h2 class="Heading">Inserting Data and Retrieving the <span id="ITerm77">Generated Key                  </span> </h2>
                            <div class="Para" id="Par205">For inserting data, we can also use the <span class="EmphasisFontCategoryNonProportional">SqlUpdate</span> class. One interesting point is how the primary key is generated (which is typically the <span class="EmphasisFontCategoryNonProportional">id</span>                                column). This value is available only after the insert statement has completed; that’s because the RDBMS generates the identity value for the record on insert. The column ID is declared with the attribute <span class="EmphasisFontCategoryNonProportional">AUTO_INCREMENT</span>                                and is the primary key, and this value will be assigned by the RDBMS during the insert operation. If you are using Oracle, you will probably get a unique ID first from an Oracle sequence and then execute an insert statement
                                with the query result.</div>
                            <div class="Para" id="Par206">In old versions of JDBC, the method is a bit tricky. For example, if we are using MySQL, you need to execute the SQL <span class="EmphasisFontCategoryNonProportional">select last_insert_id()</span> and select <span class="EmphasisFontCategoryNonProportional">@@IDENTITY</span>                                statements for Microsoft SQL Server.</div>
                            <div class="Para ParaOneEmphasisChild" id="Par207">Luckily, starting from JDBC version 3.0, a new feature was added that allows the retrieval of an RDBMS-generated key in a unified fashion. The following code snippet shows the implementation of the <span class="EmphasisFontCategoryNonProportional">insert()</span>                                method, which also retrieves the generated key for the inserted contact record. It will work in most databases (if not all); just make sure you are using a JDBC driver that is compatible with JDBC 3.0 or newer.</div>
                            <div class="Para" id="Par208">We start by creating the <span class="EmphasisFontCategoryNonProportional">InsertSinger</span> class for the insert operation, which extends the <span class="EmphasisFontCategoryNonProportional">SqlUpdate</span> class.</div>
                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.sql.Types</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.sql.DataSource</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.jdbc.core.SqlParameter</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.jdbc.object.SqlUpdate</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">InsertSinger</span> <span style="color:#00f;font-weight:700">extends</span> <span style="font-style:italic">SqlUpdate</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#c5060b;font-weight:700">SQL_INSERT_SINGER</span> <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#036a07">insert into singer (first_name, last_name, birth_date)

    values(:first_name, :last_name, :birth_date)</span>;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">InsertSinger</span>(<span style="color:#00f;font-weight:700">DataSource</span> <span style="font-style:italic">dataSource</span>) {
        <span style="color:#318495">super</span>(dataSource, <span style="color:#c5060b;font-weight:700">SQL_INSERT_SINGER</span>);
        <span style="color:#318495">super</span><span style="color:#00f;font-weight:700">.</span>declareParameter(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SqlParameter</span>(<span style="color:#036a07">first_name</span>, <span style="color:#00f;font-weight:700">Types</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>VARCHAR</span>));
        <span style="color:#318495">super</span><span style="color:#00f;font-weight:700">.</span>declareParameter(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SqlParameter</span>(<span style="color:#036a07">last_name</span>, <span style="color:#00f;font-weight:700">Types</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>VARCHAR</span>));
        <span style="color:#318495">super</span><span style="color:#00f;font-weight:700">.</span>declareParameter(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SqlParameter</span>(<span style="color:#036a07">birth_date</span>, <span style="color:#00f;font-weight:700">Types</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>DATE</span>));
        <span style="color:#318495">super</span><span style="color:#00f;font-weight:700">.</span>setGeneratedKeysColumnNames(<span style="color:#00f;font-weight:700">new</span> String {
            <span style="color:#036a07">id</span>
        });
        <span style="color:#318495">super</span><span style="color:#00f;font-weight:700">.</span>setReturnGeneratedKeys(<span style="color:#585cf6;font-weight:700">true</span>);
    }
}
</pre>
                            <div class="Para" id="Par210">The <span class="EmphasisFontCategoryNonProportional">InsertSinger</span> class is almost the same as the <span class="EmphasisFontCategoryNonProportional">UpdateSinger</span> class; we need to do just two more things. When
                                constructing the <span class="EmphasisFontCategoryNonProportional">InsertSinger</span> class, we call the method <span class="EmphasisFontCategoryNonProportional">SqlUpdate.setGeneratedKeysColumnNames()</span> to declare
                                the name of the ID column. The method <span class="EmphasisFontCategoryNonProportional">SqlUpdate.setReturnGeneratedKeys()</span> then instructs the underlying JDBC driver to retrieve the generated key. In the following
                                code, you can see the implementation of the <span class="EmphasisFontCategoryNonProportional">insert()</span> method in the <span class="EmphasisFontCategoryNonProportional">JdbcSingerDao</span> class:</div>
                            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6.dao</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.annotation.Resource</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.HashMap</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Map</span>;<span style="color:#00f;font-weight:700">.</span><span style="color:#00f;font-weight:700">.</span>.

@Repository(<span style="color:#036a07">singerDao</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">JdbcSingerDao</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerDao</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">JdbcSingerDao</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">DataSource</span> dataSource;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">InsertSinger</span> insertSinger;

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">insert</span>(<span style="color:#00f;font-weight:700">Singer</span> <span style="font-style:italic">singer</span>) {
        <span style="color:#00f;font-weight:700">Map&lt;<span style="color:#00f;font-weight:700">String</span>, <span style="color:#00f;font-weight:700">Object</span>&gt;</span> paramMap <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HashMap&lt;&gt;</span>();
        paramMap<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">first_name</span>, singer<span style="color:#00f;font-weight:700">.</span>getFirstName());
        paramMap<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">last_name</span>, singer<span style="color:#00f;font-weight:700">.</span>getLastName());
        paramMap<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">birth_date</span>, singer<span style="color:#00f;font-weight:700">.</span>getBirthDate());
        <span style="color:#00f;font-weight:700">KeyHolder</span> keyHolder <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GeneratedKeyHolder</span>();
        insertSinger<span style="color:#00f;font-weight:700">.</span>updateByNamedParam(paramMap, keyHolder);
        singer<span style="color:#00f;font-weight:700">.</span>setId(keyHolder<span style="color:#00f;font-weight:700">.</span>getKey()<span style="color:#00f;font-weight:700">.</span>longValue());
        logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">New singer inserted with id: </span> <span style="color:#00f;font-weight:700">+</span> singer<span style="color:#00f;font-weight:700">.</span>getId());
    }

    <span style="color:#00f;font-weight:700">@Resource</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">dataSource</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setDataSource</span>(<span style="color:#00f;font-weight:700">DataSource</span> <span style="font-style:italic">dataSource</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>dataSource <span style="color:#00f;font-weight:700">=</span> dataSource;
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>insertSinger <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">InsertSinger</span>(dataSource);
    }
.<span style="color:#00f;font-weight:700">.</span>.
}
</pre>
                            <div class="Para" id="Par212">Upon data source injection, an instance of <span class="EmphasisFontCategoryNonProportional">InsertSinger</span> is constructed. In the <span class="EmphasisFontCategoryNonProportional">insert()</span> method, we also use the
                                <span class="EmphasisFontCategoryNonProportional">SqlUpdate.updateByNamedParam()</span> method. Additionally, we pass in an instance of <span class="EmphasisFontCategoryNonProportional">KeyHolder</span> to the method, which
                                will have the generated ID stored in it. After the data is inserted, we can then retrieve the generated key from the <span class="EmphasisFontCategoryNonProportional">KeyHolder</span>. Let’s see how the test method looks
                                for <span class="EmphasisFontCategoryNonProportional">insert()</span>.</div>
                            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.After</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Before</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Test</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.GregorianCalendar</span>;<span style="color:#00f;font-weight:700">.</span><span style="color:#00f;font-weight:700">.</span>.

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AnnotationJdbcTest</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SingerDao</span> singerDao;

    <span style="color:#00f;font-weight:700">@Before</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setUp</span>() {
        ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">AppConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        singerDao <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">SingerDao</span><span style="color:#00f;font-weight:700">.</span>class);
        assertNotNull(singerDao);
    }

    <span style="color:#00f;font-weight:700">@Test</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">testSingerInsert</span>() {
        <span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Singer</span>();
        singer<span style="color:#00f;font-weight:700">.</span>setFirstName(<span style="color:#036a07">Ed</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setLastName(<span style="color:#036a07">Sheeran</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setBirthDate(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Date</span>(
                (<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GregorianCalendar</span>(<span style="color:#0000cd">1991</span>, <span style="color:#0000cd">1</span>, <span style="color:#0000cd">17</span>))<span style="color:#00f;font-weight:700">.</span>getTime()<span style="color:#00f;font-weight:700">.</span>getTime()));
        singerDao<span style="color:#00f;font-weight:700">.</span>insert(singer);
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> singers <span style="color:#00f;font-weight:700">=</span> singerDao<span style="color:#00f;font-weight:700">.</span>findAll();
        listSingers(singers);
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">listSingers</span>(<span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="font-style:italic">singers</span>) {
        singers<span style="color:#00f;font-weight:700">.</span>forEach(singer <span style="color:#00f;font-weight:700">-</span><span style="color:#00f;font-weight:700">&gt;</span> {
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(singer);
            <span style="color:#00f;font-weight:700">if</span> (singer<span style="color:#00f;font-weight:700">.</span>getAlbums() <span style="color:#00f;font-weight:700">!=</span> <span style="color:#585cf6;font-weight:700">null</span>) {
                <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">Album</span> album <span style="color:#00f;font-weight:700">:</span> singer<span style="color:#00f;font-weight:700">.</span>getAlbums()) {
                    <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">&quot;<span style="color:#26b31a">\t</span>--&gt; &quot;</span> <span style="color:#00f;font-weight:700">+</span> album);
                }
            }
        });
    }

    <span style="color:#00f;font-weight:700">@After</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">tearDown</span>() {
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                            <div class="Para" id="Par214">Running the testing method, if the test passes, yields the following output:<span id="ITerm80">                                        </span> </div>
                            <div class="Para" id="Par215">
                                <div class="ProgramCode" id="PC65">
                                   <pre style="background:#fff;color:#000">Singer - Id: 1, First name: John Clayton, Last name: Mayer, Birthday: 1977-10-16
Singer - Id: 2, First name: Eric, Last name: Clapton, Birthday: 1945-03-29
Singer - Id: 3, First name: Jimi, Last name: Hendrix, Birthday: 1942-11-26
Singer - Id: 6, First name: Ed, Last name: Sheeran, Birthday: 1991-02-17
</pre>
                                </div>
                            </div>
                            </div>
                            <div class="Section1 RenderAsSection1" id="Sec19">
                                <h2 class="Heading">Batching Operations with BatchSqlUpdate</h2>
                                <div class="Para" id="Par216">For batch operations, we use the <span class="EmphasisFontCategoryNonProportional">BatchSqlUpdate</span> class. The new <span id="ITerm81">              <span class="EmphasisFontCategoryNonProportional">insertWithAlbum()</span>                                    </span> method will insert both the singer and its released album into the database. To be able to insert the album record, we need to create the <span class="EmphasisFontCategoryNonProportional">InsertSingerAlbum</span>                                    class, which is shown here:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.sql.Types</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.sql.DataSource</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.jdbc.core.SqlParameter</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.jdbc.object.BatchSqlUpdate</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">InsertSingerAlbum</span> <span style="color:#00f;font-weight:700">extends</span> <span style="font-style:italic">BatchSqlUpdate</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#c5060b;font-weight:700">SQL_INSERT_SINGER_ALBUM</span> <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#036a07">insert into album (singer_id, title, release_date)

    values(:singer_id, :title, :release_date)</span>;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">int</span> <span style="color:#c5060b;font-weight:700">BATCH_SIZE</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#0000cd">10</span>;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">InsertSingerAlbum</span>(<span style="color:#00f;font-weight:700">DataSource</span> <span style="font-style:italic">dataSource</span>) {
        <span style="color:#318495">super</span>(dataSource, <span style="color:#c5060b;font-weight:700">SQL_INSERT_SINGER_ALBUM</span>);
        declareParameter(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SqlParameter</span>(<span style="color:#036a07">singer_id</span>, <span style="color:#00f;font-weight:700">Types</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>INTEGER</span>));
        declareParameter(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SqlParameter</span>(<span style="color:#036a07">title</span>, <span style="color:#00f;font-weight:700">Types</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>VARCHAR</span>));
        declareParameter(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SqlParameter</span>(<span style="color:#036a07">release_date</span>, <span style="color:#00f;font-weight:700">Types</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>DATE</span>));
        setBatchSize(<span style="color:#c5060b;font-weight:700">BATCH_SIZE</span>);
    }
}
</pre>
                                <div class="Para" id="Par218">Note that in the constructor, we call the <span class="EmphasisFontCategoryNonProportional">BatchSqlUpdate.setBatchSize()</span> method to set the batch size for the JDBC insert operation. Here you can see the implementation
                                    of the <span class="EmphasisFontCategoryNonProportional">insertWithAlbum()</span> method in the <span class="EmphasisFontCategoryNonProportional">JdbcSingerDao</span> class:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6.dao</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.annotation.Resource</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.sql.ResultSet</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.sql.SQLException</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.ArrayList</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.HashMap</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Map</span>;<span style="color:#00f;font-weight:700">.</span><span style="color:#00f;font-weight:700">.</span>.

@Repository(<span style="color:#036a07">singerDao</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">JdbcSingerDao</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerDao</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">JdbcSingerDao</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">DataSource</span> dataSource;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">InsertSingerAlbum</span> insertSingerAlbum;

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">insertWithAlbum</span>(<span style="color:#00f;font-weight:700">Singer</span> <span style="font-style:italic">singer</span>) {
        insertSingerAlbum <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">InsertSingerAlbum</span>(dataSource);
        <span style="color:#00f;font-weight:700">Map&lt;<span style="color:#00f;font-weight:700">String</span>, <span style="color:#00f;font-weight:700">Object</span>&gt;</span> paramMap <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HashMap&lt;&gt;</span>();
        paramMap<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">first_name</span>, singer<span style="color:#00f;font-weight:700">.</span>getFirstName());
        paramMap<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">last_name</span>, singer<span style="color:#00f;font-weight:700">.</span>getLastName());
        paramMap<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">birth_date</span>, singer<span style="color:#00f;font-weight:700">.</span>getBirthDate());
        <span style="color:#00f;font-weight:700">KeyHolder</span> keyHolder <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GeneratedKeyHolder</span>();
        insertSinger<span style="color:#00f;font-weight:700">.</span>updateByNamedParam(paramMap, keyHolder);
        singer<span style="color:#00f;font-weight:700">.</span>setId(keyHolder<span style="color:#00f;font-weight:700">.</span>getKey()<span style="color:#00f;font-weight:700">.</span>longValue());
        logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">New singer inserted with id: </span> <span style="color:#00f;font-weight:700">+</span> singer<span style="color:#00f;font-weight:700">.</span>getId());
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Album</span>&gt;</span> albums <span style="color:#00f;font-weight:700">=</span> singer<span style="color:#00f;font-weight:700">.</span>getAlbums();
        <span style="color:#00f;font-weight:700">if</span> (albums <span style="color:#00f;font-weight:700">!=</span> <span style="color:#585cf6;font-weight:700">null</span>) {
            <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">Album</span> album <span style="color:#00f;font-weight:700">:</span> albums) {
                paramMap <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HashMap&lt;&gt;</span>();
                paramMap<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">singer_id</span>, singer<span style="color:#00f;font-weight:700">.</span>getId());
                paramMap<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">title</span>, album<span style="color:#00f;font-weight:700">.</span>getTitle());
                paramMap<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">release_date</span>, album<span style="color:#00f;font-weight:700">.</span>getReleaseDate());
                insertSingerAlbum<span style="color:#00f;font-weight:700">.</span>updateByNamedParam(paramMap);
            }
        }
        insertSingerAlbum<span style="color:#00f;font-weight:700">.</span>flush();
    }

    <span style="color:#00f;font-weight:700">@Resource</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">dataSource</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setDataSource</span>(<span style="color:#00f;font-weight:700">DataSource</span> <span style="font-style:italic">dataSource</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>dataSource <span style="color:#00f;font-weight:700">=</span> dataSource;
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAllWithAlbums</span>() {
        <span style="color:#00f;font-weight:700">JdbcTemplate</span> jdbcTemplate <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">JdbcTemplate</span>(getDataSource());
        <span style="color:#00f;font-weight:700">String</span> sql <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">SELECT s.id, s.first_name, s.last_name, s.birth_date</span> <span style="color:#00f;font-weight:700">+</span>
                <span style="color:#036a07">, a.id AS album_id, a.title, a.release_date FROM  singer s </span> <span style="color:#00f;font-weight:700">+</span>
                <span style="color:#036a07">LEFT JOIN album a ON s.id = a.singer_id</span>;
        <span style="color:#00f;font-weight:700">return</span> jdbcTemplate<span style="color:#00f;font-weight:700">.</span>query(sql, <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SingerWithAlbumExtractor</span>());
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerWithAlbumExtractor</span>
            <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">ResultSetExtractor&lt;<span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span>&gt;</span> {
        <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">extractData</span>(<span style="color:#00f;font-weight:700">ResultSet</span> <span style="font-style:italic">rs</span>) <span style="color:#00f;font-weight:700">throws</span>
                <span style="color:#00f;font-weight:700">SQLException</span>, <span style="color:#00f;font-weight:700">DataAccessException</span> {
            <span style="color:#00f;font-weight:700">Map&lt;<span style="color:#00f;font-weight:700">Long</span>, <span style="color:#00f;font-weight:700">Singer</span>&gt;</span> map <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HashMap&lt;&gt;</span>();
            <span style="color:#00f;font-weight:700">Singer</span> singer;
            <span style="color:#00f;font-weight:700">while</span> (rs<span style="color:#00f;font-weight:700">.</span>next()) {
                <span style="color:#00f;font-weight:700">Long</span> id <span style="color:#00f;font-weight:700">=</span> rs<span style="color:#00f;font-weight:700">.</span>getLong(<span style="color:#036a07">id</span>);
                singer <span style="color:#00f;font-weight:700">=</span> map<span style="color:#00f;font-weight:700">.</span>get(id);
                <span style="color:#00f;font-weight:700">if</span> (singer <span style="color:#00f;font-weight:700">==</span> <span style="color:#585cf6;font-weight:700">null</span>) {
                    singer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Singer</span>();
                    singer<span style="color:#00f;font-weight:700">.</span>setId(id);
                    singer<span style="color:#00f;font-weight:700">.</span>setFirstName(rs<span style="color:#00f;font-weight:700">.</span>getString(<span style="color:#036a07">first_name</span>));
                    singer<span style="color:#00f;font-weight:700">.</span>setLastName(rs<span style="color:#00f;font-weight:700">.</span>getString(<span style="color:#036a07">last_name</span>));
                    singer<span style="color:#00f;font-weight:700">.</span>setBirthDate(rs<span style="color:#00f;font-weight:700">.</span>getDate(<span style="color:#036a07">birth_date</span>));
                    singer<span style="color:#00f;font-weight:700">.</span>setAlbums(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ArrayList&lt;&gt;</span>());
                    map<span style="color:#00f;font-weight:700">.</span>put(id, singer);
                }
                <span style="color:#00f;font-weight:700">Long</span> albumId <span style="color:#00f;font-weight:700">=</span> rs<span style="color:#00f;font-weight:700">.</span>getLong(<span style="color:#036a07">album_id</span>);
                <span style="color:#00f;font-weight:700">if</span> (albumId <span style="color:#00f;font-weight:700">&gt;</span> <span style="color:#0000cd">0</span>) {
                    <span style="color:#00f;font-weight:700">Album</span> album <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Album</span>();
                    album<span style="color:#00f;font-weight:700">.</span>setId(albumId);
                    album<span style="color:#00f;font-weight:700">.</span>setSingerId(id);
                    album<span style="color:#00f;font-weight:700">.</span>setTitle(rs<span style="color:#00f;font-weight:700">.</span>getString(<span style="color:#036a07">title</span>));
                    album<span style="color:#00f;font-weight:700">.</span>setReleaseDate(rs<span style="color:#00f;font-weight:700">.</span>getDate(<span style="color:#036a07">release_date</span>));
                    singer<span style="color:#00f;font-weight:700">.</span>getAlbums()<span style="color:#00f;font-weight:700">.</span>add(album);
                }
            }
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ArrayList&lt;&gt;</span>(map<span style="color:#00f;font-weight:700">.</span>values());
        }
    }
.<span style="color:#00f;font-weight:700">.</span>.
}
</pre>
                                <div class="Para" id="Par220">Each time the <span class="EmphasisFontCategoryNonProportional">insertWithAlbum()</span> method is called, a new instance of <span class="EmphasisFontCategoryNonProportional">InsertSingerAlbum</span> is constructed because
                                    the <span class="EmphasisFontCategoryNonProportional">BatchSqlUpdate</span> class is not thread safe. Then we use it just like <span class="EmphasisFontCategoryNonProportional">SqlUpdate</span>. The main difference
                                    is that the <span class="EmphasisFontCategoryNonProportional">BatchSqlUpdate</span> class will queue up the insert operations and submit them to the database in batch. Every time the number of records equals the batch
                                    size, Spring will execute a bulk insert operation to the database for the pending records. On the other hand, upon completion, we call the <span class="EmphasisFontCategoryNonProportional">BatchSqlUpdate.flush()</span>                                    method to instruct Spring to flush all pending operations (that is, the insert operations being queued that still haven’t reached the batch size yet). Finally, we loop through the list of <span class="EmphasisFontCategoryNonProportional">Album</span>                                    objects in the <span class="EmphasisFontCategoryNonProportional">Singer</span> object and invoke the <span class="EmphasisFontCategoryNonProportional">BatchSqlUpdate.updateByNamedParam()</span> method. To facilitate
                                    testing, the <span class="EmphasisFontCategoryNonProportional">insertWithAlbum()</span> method is also implemented. As this implementation is pretty big, it can be reduced by making use of Java 8 lambda expressions.</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> findAllWithAlbums() {
        <span style="color:#00f;font-weight:700">JdbcTemplate</span> jdbcTemplate <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">JdbcTemplate</span>(getDataSource());
        <span style="color:#00f;font-weight:700">String</span> sql <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">SELECT s.id, s.first_name, s.last_name, s.birth_date</span> <span style="color:#00f;font-weight:700">+</span>
             <span style="color:#036a07">, a.id AS album_id, a.title, a.release_date FROM  singer s  </span> <span style="color:#00f;font-weight:700">+</span>
             <span style="color:#036a07">LEFT JOIN album a ON s.id = a.singer_id</span>;
        <span style="color:#00f;font-weight:700">return</span> jdbcTemplate<span style="color:#00f;font-weight:700">.</span>query(sql, rs <span style="color:#00f;font-weight:700">-</span><span style="color:#00f;font-weight:700">&gt;</span> {
            <span style="color:#00f;font-weight:700">Map&lt;<span style="color:#00f;font-weight:700">Long</span>, <span style="color:#00f;font-weight:700">Singer</span>&gt;</span> map <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HashMap&lt;&gt;</span>();
            <span style="color:#00f;font-weight:700">Singer</span> singer;
            <span style="color:#00f;font-weight:700">while</span> (rs<span style="color:#00f;font-weight:700">.</span>next())  {
                <span style="color:#00f;font-weight:700">Long</span> id <span style="color:#00f;font-weight:700">=</span> rs<span style="color:#00f;font-weight:700">.</span>getLong(<span style="color:#036a07">id</span>);
                singer <span style="color:#00f;font-weight:700">=</span>  map<span style="color:#00f;font-weight:700">.</span>get(id);
                <span style="color:#00f;font-weight:700">if</span> (singer <span style="color:#00f;font-weight:700">==</span> <span style="color:#585cf6;font-weight:700">null</span>) {
                    singer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Singer</span>();
                    singer<span style="color:#00f;font-weight:700">.</span>setId(id);
                    singer<span style="color:#00f;font-weight:700">.</span>setFirstName(rs<span style="color:#00f;font-weight:700">.</span>getString(<span style="color:#036a07">first_name</span>));
                    singer<span style="color:#00f;font-weight:700">.</span>setLastName(rs<span style="color:#00f;font-weight:700">.</span>getString(<span style="color:#036a07">last_name</span>));
                    singer<span style="color:#00f;font-weight:700">.</span>setBirthDate(rs<span style="color:#00f;font-weight:700">.</span>getDate(<span style="color:#036a07">birth_date</span>));
                    singer<span style="color:#00f;font-weight:700">.</span>setAlbums(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ArrayList&lt;&gt;</span>());
                    map<span style="color:#00f;font-weight:700">.</span>put(id, singer);
                }
                <span style="color:#00f;font-weight:700">Long</span> albumId <span style="color:#00f;font-weight:700">=</span> rs<span style="color:#00f;font-weight:700">.</span>getLong(<span style="color:#036a07">album_id</span>);
                <span style="color:#00f;font-weight:700">if</span> (albumId <span style="color:#00f;font-weight:700">&gt;</span> <span style="color:#0000cd">0</span>) {
                    <span style="color:#00f;font-weight:700">Album</span> album <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Album</span>();
                    album<span style="color:#00f;font-weight:700">.</span>setId(albumId);
                    album<span style="color:#00f;font-weight:700">.</span>setSingerId(id);
                    album<span style="color:#00f;font-weight:700">.</span>setTitle(rs<span style="color:#00f;font-weight:700">.</span>getString(<span style="color:#036a07">title</span>));
                    album<span style="color:#00f;font-weight:700">.</span>setReleaseDate(rs<span style="color:#00f;font-weight:700">.</span>getDate(<span style="color:#036a07">release_date</span>));
                    singer<span style="color:#00f;font-weight:700">.</span>getAlbums()<span style="color:#00f;font-weight:700">.</span>add(album);
                }
            }
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ArrayList&lt;&gt;</span>(map<span style="color:#00f;font-weight:700">.</span>values());
        });
}
</pre>
                            <div class="Para" id="Par222">Let’s see how the <span id="ITerm86">test method                  </span> looks for <span class="EmphasisFontCategoryNonProportional">insertWithAlbum()</span>.</div>
                            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.After</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Before</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Test</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.GregorianCalendar</span>;<span style="color:#00f;font-weight:700">.</span><span style="color:#00f;font-weight:700">.</span>.

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AnnotationJdbcTest</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SingerDao</span> singerDao;

    <span style="color:#00f;font-weight:700">@Before</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setUp</span>() {
        ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">AppConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        singerDao <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">SingerDao</span><span style="color:#00f;font-weight:700">.</span>class);
        assertNotNull(singerDao);
    }

    <span style="color:#00f;font-weight:700">@Test</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">testSingerInsertWithAlbum</span>() {
        <span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Singer</span>();
        singer<span style="color:#00f;font-weight:700">.</span>setFirstName(<span style="color:#036a07">BB</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setLastName(<span style="color:#036a07">King</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setBirthDate(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Date</span>(
                (<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GregorianCalendar</span>(<span style="color:#0000cd">1940</span>, <span style="color:#0000cd">8</span>, <span style="color:#0000cd">16</span>))<span style="color:#00f;font-weight:700">.</span>getTime()<span style="color:#00f;font-weight:700">.</span>getTime()));
        <span style="color:#00f;font-weight:700">Album</span> album <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Album</span>();
        album<span style="color:#00f;font-weight:700">.</span>setTitle(<span style="color:#036a07">My Kind of Blues</span>);
        album<span style="color:#00f;font-weight:700">.</span>setReleaseDate(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Date</span>(
                (<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GregorianCalendar</span>(<span style="color:#0000cd">1961</span>, <span style="color:#0000cd">7</span>, <span style="color:#0000cd">18</span>))<span style="color:#00f;font-weight:700">.</span>getTime()<span style="color:#00f;font-weight:700">.</span>getTime()));
        singer<span style="color:#00f;font-weight:700">.</span>addAbum(album);
        album <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Album</span>();
        album<span style="color:#00f;font-weight:700">.</span>setTitle(<span style="color:#036a07">A Heart Full  of Blues</span>);
        album<span style="color:#00f;font-weight:700">.</span>setReleaseDate(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Date</span>(
                (<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GregorianCalendar</span>(<span style="color:#0000cd">1962</span>, <span style="color:#0000cd">3</span>, <span style="color:#0000cd">20</span>))<span style="color:#00f;font-weight:700">.</span>getTime()<span style="color:#00f;font-weight:700">.</span>getTime()));
        singer<span style="color:#00f;font-weight:700">.</span>addAbum(album);
        singerDao<span style="color:#00f;font-weight:700">.</span>insertWithAlbum(singer);
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> singers <span style="color:#00f;font-weight:700">=</span> singerDao<span style="color:#00f;font-weight:700">.</span>findAllWithAlbums();
        listSingers(singers);
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">listSingers</span>(<span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="font-style:italic">singers</span>) {
        singers<span style="color:#00f;font-weight:700">.</span>forEach(singer <span style="color:#00f;font-weight:700">-</span><span style="color:#00f;font-weight:700">&gt;</span> {
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(singer);
            <span style="color:#00f;font-weight:700">if</span> (singer<span style="color:#00f;font-weight:700">.</span>getAlbums() <span style="color:#00f;font-weight:700">!=</span> <span style="color:#585cf6;font-weight:700">null</span>) {
                <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">Album</span> album <span style="color:#00f;font-weight:700">:</span> singer<span style="color:#00f;font-weight:700">.</span>getAlbums()) {
                    <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">&quot;<span style="color:#26b31a">\t</span>--&gt; &quot;</span> <span style="color:#00f;font-weight:700">+</span> album);
                }
            }
        });
    }

    <span style="color:#00f;font-weight:700">@After</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">tearDown</span>() {
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                            <div class="Para" id="Par224">Running the testing method, if the test passes, yields the following output:<span id="ITerm88">                                        </span> </div>
                            <div class="Para" id="Par225">
                                <div class="ProgramCode" id="PC70">
                                   <pre style="background:#fff;color:#000">Singer - Id: 1, First name:  John, Last name:  Mayer, Birthday:  1977-10-15
    --&gt; Album - Id: 1, Singer id: 1, Title: The Search For Everything,
       Release Date: 2017-01-19
    --&gt; Album - Id: 2, Singer id: 1, Title: Paradise Valley,
       Release Date: 2013-08-19
    --&gt; Album - Id: 3, Singer id: 1, Title: Born and Raised,
       Release Date:  2012-05-22
    --&gt; Album - Id: 4, Singer id: 1, Title: Battle Studies,
       Release Date: 2009-11-16
Singer - Id: 2, First name: Eric, Last name: Clapton, Birthday: 1945-03-29
    --&gt; Album - Id: 5, Singer id: 2, Title: From The Cradle,
       Release Date: 1994-09-13
Singer - Id: 3, First name: Jimi, Last name: Hendrix, Birthday: 1942-11-26
Singer - Id: 4, First name: BB, Last name: King, Birthday: 1940-09-15
    --&gt; Album - Id: 6, Singer id: 4, Title: My Kind of Blues,
       Release Date:  1961-08-17
    --&gt; Album - Id: 7, Singer id: 4, Title: A Heart Full of Blues,
       Release Date:  1962-04-19
</pre>
                                </div>
                            </div>
                            </div>
                            <div class="Section1 RenderAsSection1" id="Sec20">
                                <h2 class="Heading">Calling Stored Functions by Using <span id="ITerm89">SqlFunction        </span> </h2>
                                <div class="Para" id="Par226">Spring also provides classes to simplify the execution of stored procedures/functions using JDBC. In this section, we show you how to execute a simple function by using the <span class="EmphasisFontCategoryNonProportional">SqlFunction</span>                                    class. We show how to use MySQL for the database, create a stored function, and call it by using the <span class="EmphasisFontCategoryNonProportional">SqlFunction&lt;T&gt;</span> class.</div>
                                <div class="Para" id="Par227">We’re assuming you have a MySQL database with a schema called <span class="EmphasisFontCategoryNonProportional">musicdb</span>, with a username and password both equaling <span class="EmphasisFontCategoryNonProportional">prospring5</span>                                    (the same as the example in the section “Exploring the JDBC Infrastructure”). Let’s create a stored function called <span class="EmphasisFontCategoryNonProportional">getFirstNameById()</span>, which accepts the contact’s
                                    ID and returns the first name of the contact. The following code shows the script to create the stored function in MySQL (<span class="EmphasisFontCategoryNonProportional">stored-function.sql</span>). Run the script
                                    against the MySQL database.</div>
                                <pre style="background:#fff;color:#000">DELIMITER <span style="color:#00f;font-weight:700">/</span><span style="color:#00f;font-weight:700">/</span>CREATE FUNCTION getfirstnamebyid(in_id <span style="color:#00f;font-weight:700">int</span>) 
returns <span style="color:#00f;font-weight:700">varchar</span>(<span style="color:#0000cd">60</span>) 
BEGINRETURN 
  ( 
         <span style="color:#00f;font-weight:700">SELECT</span> first_name 
         <span style="color:#00f;font-weight:700">FROM</span>   singer 
         <span style="color:#00f;font-weight:700">WHERE</span>  id <span style="color:#00f;font-weight:700">=</span> in_id);END <span style="color:#00f;font-weight:700">/</span><span style="color:#00f;font-weight:700">/</span> 
delimiter ;
</pre>
                                <div class="Para" id="Par229">The stored function simply accepts the ID and returns the first name of the singer record with the ID. Next we create a <span class="EmphasisFontCategoryNonProportional">StoredFunctionFirstNameById</span> class to represent
                                    the stored function operation, which extends the <span class="EmphasisFontCategoryNonProportional">SqlFunction&lt;T&gt;</span> class. You can see the content of the class in the following code snippet:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.sql.Types</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.sql.DataSource</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.jdbc.core.SqlParameter</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.jdbc.object.SqlFunction</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">StoredFunctionFirstNameById</span> <span style="color:#00f;font-weight:700">extends</span> <span style="font-style:italic">SqlFunction&lt;<span style="color:#00f;font-weight:700">String</span>&gt;</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#c5060b;font-weight:700">SQL</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">select getfirstnamebyid(?)</span>;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">StoredFunctionFirstNameById</span>(<span style="color:#00f;font-weight:700">DataSource</span> <span style="font-style:italic">dataSource</span>) {
        <span style="color:#318495">super</span>(dataSource, <span style="color:#c5060b;font-weight:700">SQL</span>);
        declareParameter(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SqlParameter</span>(<span style="color:#00f;font-weight:700">Types</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>INTEGER</span>));
        compile();
    }
}</pre>
                                <div class="Para" id="Par231">Here the class extends <span class="EmphasisFontCategoryNonProportional">SqlFunction&lt;T&gt;</span> and passes in the type <span class="EmphasisFontCategoryNonProportional">String</span>, which indicates the return type
                                    of the function. Then we declare the SQL to call the stored function in MySQL. Afterward, in the constructor, the parameter is declared, and we compile the operation. The class is now ready for use in the implementation
                                    class. The following code snippet shows the updated <span class="EmphasisFontCategoryNonProportional">JdbcSingerDao</span> class to use the stored function:</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6.dao</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;<span style="color:#00f;font-weight:700">.</span><span style="color:#00f;font-weight:700">.</span>.

@Repository(<span style="color:#036a07">singerDao</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">JdbcSingerDao</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerDao</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">JdbcSingerDao</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">DataSource</span> dataSource;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">StoredFunctionFirstNameById</span> storedFunctionFirstNameById;

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">findFirstNameById</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">id</span>) {
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">String</span>&gt;</span> result <span style="color:#00f;font-weight:700">=</span> storedFunctionFirstNameById<span style="color:#00f;font-weight:700">.</span>execute(id);
        <span style="color:#00f;font-weight:700">return</span> result<span style="color:#00f;font-weight:700">.</span>get(<span style="color:#0000cd">0</span>);
    }
    .<span style="color:#00f;font-weight:700">.</span>.
}</pre>
                                <div class="Para" id="Par233">Upon data source injection, an instance of <span class="EmphasisFontCategoryNonProportional">StoredFunctionFirstNameById</span> is constructed. Then in the <span class="EmphasisFontCategoryNonProportional">findFirstNameById()</span>                                    method, its <span class="EmphasisFontCategoryNonProportional">execute()</span> method is called, passing in the contact ID. The method will return a list of <span class="EmphasisFontCategoryNonProportional">String</span>s,
                                    and we need only the first one, because there should be only one record returned in the result set. Testing this functionality is quite simple.</div>
                                <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.After</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Before</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Test</span>;<span style="color:#00f;font-weight:700">.</span><span style="color:#00f;font-weight:700">.</span>.

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AnnotationJdbcTest</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SingerDao</span> singerDao;

    <span style="color:#00f;font-weight:700">@Before</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setUp</span>() {
        ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">AppConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        singerDao <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">SingerDao</span><span style="color:#00f;font-weight:700">.</span>class);
        assertNotNull(singerDao);
    }

    <span style="color:#00f;font-weight:700">@Test</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">testFindFirstNameById</span>() {
        <span style="color:#00f;font-weight:700">String</span> firstName <span style="color:#00f;font-weight:700">=</span> singerDao<span style="color:#00f;font-weight:700">.</span>findFirstNameById(<span style="color:#0000cd">2L</span>);
        assertEquals(<span style="color:#036a07">Eric</span>, firstName);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Retrieved value: </span> <span style="color:#00f;font-weight:700">+</span> firstName);
    }

    <span style="color:#00f;font-weight:700">@After</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">tearDown</span>() {
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}</pre>
                                <div class="Para" id="Par235">In the program, we pass an ID of 2 into the stored function. This will return <span class="EmphasisFontCategoryNonProportional">Eric</span>, which is the first name of the record with ID equal to 2 if you run the
                                    <span class="EmphasisFontCategoryNonProportional">test-data.sql</span> against the MySQL database. Running the program produces the following output:</div>
                                <pre style="background:#fff;color:#000">o.s.j.c.JdbcTemplate - Executing  prepared SQL query
o.s.j.c.JdbcTemplate - Executing  prepared SQL statement
    [select  getfirstnamebyid?]
o.s.j.d.DataSourceUtils - Fetching JDBC Connection from DataSource
o.s.j.d.DataSourceUtils - Returning JDBC Connection to  DataSource
Retrieved value: Eric
</pre>
                                <div class="Para ParaOneEmphasisChild" id="Par237">You can see that the first name is retrieved correctly. What is presented here is just a simple sample to demonstrate the Spring JDBC module’s function capabilities. Spring also provides other classes (for example,
                                    <span class="EmphasisFontCategoryNonProportional">StoredProcedure</span>) for you to invoke complex stored procedures that return complex data types. We recommend you refer to Spring’s reference manual in case you need to access stored procedures using JDBC.</div>
                            </div>
                            <div class="Section1 RenderAsSection1" id="Sec21">
                                <h2 class="Heading">Spring Data Project: JDBC <span id="ITerm93">Extensions                  </span> </h2>
                                <div class="Para" id="Par238">In recent years, database technology has evolved so quickly with the rise of so many purpose-specific databases, nowadays an RDBMS is not the only choice for an application’s back-end database. In response to this database
                                    technology evolution and the developer community’s needs, Spring created the Spring Data project (<span class="ExternalRef"><a href="http://springsource.org/spring-data"><span class="RefSource">                <span class="EmphasisFontCategoryNonProportional">http://springsource.org/spring-data</span>                                    </span>
                                    </a>
                                    </span>). The major objective of the project is to provide useful extensions on top of Spring’s core data access functionality to interact with databases other than traditional RDBMSs.</div>
                                <div class="Para" id="Par239">The Spring Data project comes with various extensions. One that we would like to mention here is JDBC Extensions (<span class="ExternalRef"><a href="http://springsource.org/spring-data/jdbc-extensions"><span class="RefSource">                <span class="EmphasisFontCategoryNonProportional">http://springsource.org/spring-data/jdbc-extensions</span>                                    </span>
                                    </a>
                                    </span>). As its name implies, the extension provides some advanced features to facilitate the development of JDBC applications using Spring. The main features that JDBC Extensions provides are listed here:
                                    <div class="UnorderedList">
                                        <ul class="UnorderedListMarkBullet">
                                            <li>
                                                <div class="Para" id="Par240"> <span class="EmphasisTypeItalic">QueryDSL support</span>: QueryDSL (<span class="ExternalRef"><a href="http://querydsl.com/"><span class="RefSource">                      <span class="EmphasisFontCategoryNonProportional">http://querydsl.com</span>                                                    </span>
                                                    </a>
                                                    </span>) is a domain-specific language that provides a framework for developing type-safe queries. Spring Data’s JDBC Extensions provides <span class="EmphasisFontCategoryNonProportional">QueryDslJdbcTemplate</span>                                                    to facilitate the development of JDBC applications using QueryDSL instead of SQL statements.</div>
                                            </li>
                                            <li>
                                                <div class="Para" id="Par241"> <span class="EmphasisTypeItalic">Advanced support for Oracle Database</span>: The extension provides advanced features for Oracle Database users. On the database connection side, it supports Oracle-specific
                                                    session settings, as well as Fast Connection Failover technology when working with Oracle RAC. Also, classes that integrate with Oracle Advanced Queueing are provided. On the data type side, native support
                                                    for Oracle’s XML types, <span class="EmphasisFontCategoryNonProportional">STRUCT</span> and <span class="EmphasisFontCategoryNonProportional">ARRAY</span>, and so on, are provided.</div>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="Para" id="Par242">If you are developing JDBC applications using Spring with Oracle Database, JDBC Extensions is really worth a look.</div>
                            </div>
                            <div class="Section1 RenderAsSection1" id="Sec22">
                                <h2 class="Heading">Considerations for Using JDBC</h2>
                                <div class="Para" id="Par243">With this rich feature set, you can see how Spring can make your life much easier when using JDBC to interact with the underlying RDBMS. However, there is still quite a lot of code you need to develop, especially when transforming
                                    the result set into the corresponding domain objects.</div>
                                <div class="Para ParaOneEmphasisChild" id="Par244">On top of JDBC, a lot of open source libraries have been developed to help close the gap between the relational data structure and Java’s OO model. For example, iBATIS is a popular <span class="EmphasisFontCategoryNonProportional">DataMapper</span>                                    framework that is also based on SQL mapping. iBATIS lets you map objects with stored procedures or queries to an XML descriptor file. Like Spring, iBATIS provides a declarative way to query object mapping, greatly saving
                                    you the time it takes to maintain SQL queries that may be scattered around various DAO classes.</div>
                                <div class="Para" id="Par245">There are also many other <span id="ITerm94">ORM                  </span> frameworks that focus on the object model, rather than the query. Popular ones include Hibernate, EclipseLink (also known as TopLink), and OpenJPA.
                                    All of them comply with the JCP’s JPA specification.</div>
                                <div class="Para" id="Par246">In recent years, these ORM tools and mapping frameworks have become much more mature so that most developers will settle on one of them, instead of using JDBC directly. However, in cases where you need to have absolute
                                    control over the query that will be submitted to the database for performance purposes (for example, using a hierarchical query in Oracle), Spring JDBC is really a viable option. And when using Spring, one great advantage
                                    is that you can mix and match different data access technologies. For example, you can use Hibernate as the main ORM and then JDBC as a supplement for some of the complex query logic or batch operations; you can mix
                                    and match them in a single business operation and then wrap them under the same database transaction. Spring will help you handle those situations easily.</div>
                            </div>
                            <div class="Section1 RenderAsSection1" id="Sec23">
                                <h2 class="Heading"> <span id="ITerm95">Spring Boot                  </span> JDBC</h2>
                                <div class="Para" id="Par247">As we’ve already introduced Spring Boot for web and simple console applications, it is only logical to cover a Spring Boot starter library for JDBC in this book. It helps you remove boilerplate configurations and jump directly
                                    into implementation.</div>
                                <div class="Para" id="Par248">When <span class="EmphasisFontCategoryNonProportional">spring-boot-starter-jdbc</span> is added as a dependency to a project, a set of libraries is added to the project. What is not added is a database driver. That decision
                                    must be taken by the developer. The project that will be covered in this section is <span class="EmphasisFontCategoryNonProportional">spring-boot-jdbc</span> and is a submodule of the <span class="EmphasisFontCategoryNonProportional">chapter06</span>                                    project. Its Gradle dependencies and versions are specified in the following parent <span class="EmphasisFontCategoryNonProportional">build.gradle</span> file:</div>
                                <pre style="background:#fff;color:#000">ext {
    h2Version <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">1.4.194</span>
    bootVersion <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">2.0.0.BUILD-SNAPSHOT</span>
    boot <span style="color:#00f;font-weight:700">=</span> [
        springBootPlugin<span style="color:#00f;font-weight:700">:</span>
              <span style="color:#036a07">org.springframework.boot:spring-boot-gradle-plugin:$bootVersion</span>,
        <span style="color:#00f;font-weight:700">Starter</span>         <span style="color:#00f;font-weight:700">:</span>
               <span style="color:#036a07">org.springframework.boot:spring-boot-starter:$bootVersion</span>,
        starterWeb      <span style="color:#00f;font-weight:700">:</span>
              <span style="color:#036a07">org.springframework.boot:spring-boot-starter-web:$bootVersion</span>,
        <span style="color:#00f;font-weight:700">Actuator</span>        <span style="color:#00f;font-weight:700">:</span>
               <span style="color:#036a07">org.springframework.boot:spring-boot-starter-actuator:$bootVersion</span>,
        starterTest     <span style="color:#00f;font-weight:700">:</span>
               <span style="color:#036a07">org.springframework.boot:spring-boot-starter-test:$bootVersion</span>,
        starterAop       <span style="color:#00f;font-weight:700">:</span>
              <span style="color:#036a07">org.springframework.boot:spring-boot-starter-aop:$bootVersion</span>,
        starterJdbc      <span style="color:#00f;font-weight:700">:</span>
              <span style="color:#036a07">org.springframework.boot:spring-boot-starter-jdbc:$bootVersion</span>
    ]
    db <span style="color:#00f;font-weight:700">=</span> [
        h2   <span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">com.h2database:h2:$h2Version</span>,
        ..
     ]
    .<span style="color:#00f;font-weight:700">.</span>.
}
</pre>
                                <div class="Para ParaOneEmphasisChild" id="Par250">They are declared as dependencies in the <span class="EmphasisFontCategoryNonProportional">spring-boot-jdbc\build.gradle</span> configuration file, only by using their property names.</div>
                                <pre style="background:#fff;color:#000">buildscript {
    repositories {
        mavenLocal() mavenCentral()
        maven { url <span style="color:#036a07">http://repo.spring.io/release</span> }
        maven { url <span style="color:#036a07">http://repo.spring.io/milestone</span> }
        maven { url <span style="color:#036a07">http://repo.spring.io/snapshot</span> }
        maven { url <span style="color:#036a07">https://repo.spring.io/libs-snapshot</span> }
    }
    dependencies {
        classpath boot<span style="color:#00f;font-weight:700">.</span>springBootPlugin
    }
}
apply plugin<span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">org.springframework.boot</span>
dependencies {
    compile project(<span style="color:#036a07">:chapter06:plain-jdbc</span>)
    compile boot<span style="color:#00f;font-weight:700">.</span>starterJdbc, db<span style="color:#00f;font-weight:700">.</span>h2
}
</pre>
                                <div class="Para" id="Par252">The autoconfigured libraries are depicted in Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_6_Chapter.html#Fig3">6-3</a></span> in the IntelliJ
                                    IDEA Gradle Projects view. The <span class="EmphasisFontCategoryNonProportional">spring-boot-starter-jdbc</span> library uses <span class="EmphasisFontCategoryNonProportional">tomcat-jdbc</span> to configure the
                                    <span class="EmphasisFontCategoryNonProportional">DataSource</span> bean. Thus, if there is no <span class="EmphasisFontCategoryNonProportional">DataSource</span> bean explicitly configured and there is an embedded database driver in the classpath, Spring Boot will
                                        automatically register the <span class="EmphasisFontCategoryNonProportional">DataSource</span> bean using in-memory database settings. Spring Boot also registers the following beans <span id="ITerm97">automatically                  </span>:
                                        <div class="UnorderedList">
                                            <ul class="UnorderedListMarkBullet">
                                                <li>
                                                    <div class="Para ParaOneEmphasisChild" id="Par253">A <span class="EmphasisFontCategoryNonProportional">JdbcTemplate</span> bean</div>
                                                </li>
                                                <li>
                                                    <div class="Para ParaOneEmphasisChild" id="Par254">A <span class="EmphasisFontCategoryNonProportional">NamedParameterJdbcTemplate</span> bean</div>
                                                </li>
                                                <li>
                                                    <div class="Para ParaOneEmphasisChild" id="Par255">A <span class="EmphasisFontCategoryNonProportional">PlatformTransactionManager (DataSourceTransactionManager)</span> bean</div>
                                                </li>
                                            </ul>
                                </div>
                                <div class="Figure" id="Fig3">
                                    <div class="MediaObject" id="MO3"><img alt="A315511_5_En_6_Fig3_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_6_Fig3_HTML.jpg" height="234" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_6_Fig3_HTML.jpg" width="686"/></div>
                                    <div class="Caption" xml:lang="en">
                                        <div class="CaptionContent"><span class="CaptionNumber">Figure 6-3.</span>
                                            <div class="SimplePara">Spring Boot JDBC starter dependencies</div>
                                        </div>
                                </div>
                            </div>
                            </div>
                            <div class="Para" id="Par256">Here are other things that might be interesting that reduce the amount of environment setup work:
                                <div class="UnorderedList">
                                    <ul class="UnorderedListMarkBullet">
                                        <li>
                                            <div class="Para" id="Par257">Spring Boot looks for embedded database initialization files under <span class="EmphasisFontCategoryNonProportional">src/main/resources</span>. It expects to find a file named <span class="EmphasisFontCategoryNonProportional">schema.sql</span>                                                that contains SQL DDL statements (for example, <span class="EmphasisFontCategoryNonProportional">CREATE TABLE</span> statements) and a file named <span class="EmphasisFontCategoryNonProportional">data.sql</span>                                                that contains DML statements (for example, <span class="EmphasisFontCategoryNonProportional">INSERT</span> statements). It uses this file to initialize a database at boot time.</div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par258">The location and names for these files can be configured in the <span class="EmphasisFontCategoryNonProportional">application.properties</span> files, which is located under <span class="EmphasisFontCategoryNonProportional">src/main/resources</span>                                                as well. A sample configuration file that would allow the Spring Boot application to use SQL files is shown here:</div>
                                            <div class="Para" id="Par259">
                                                <div class="ProgramCode" id="PC78">
                                                    <div class="FixedLine">spring.datasource.schema=db/schema.sql</div>
                                                    <div class="FixedLine">spring.datasource.data=db/test-data.sql</div>
                                                </div>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="Para" id="Par260">By default Spring Boot initializes the database at boot time, but this could be changed as well by adding the property <span class="EmphasisFontCategoryNonProportional">spring.datasource.initialize=false</span>                                                to the <span class="EmphasisFontCategoryNonProportional">application.properties</span> file.</div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="Para" id="Par261">Aside from all that was mentioned, what is left to do with Spring Boot is to provide some domain classes or entities and a DAO bean. The <span class="EmphasisFontCategoryNonProportional">Singer</span> bean is the same as the
                                one used everywhere in this chapter, and its implementation resides in the <span class="EmphasisFontCategoryNonProportional">chapter06/plain-jdbc</span> project, which is added as a dependency everywhere. The <span class="EmphasisFontCategoryNonProportional">JdbcSingerDao</span>                                class to use is shown here:<span id="ITerm98">                                        </span> </div>
                            <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6.dao.SingerDao</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6.entities.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.apache.commons.lang3.NotImplementedException</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.BeanCreationException</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.InitializingBean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Autowired</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.jdbc.core.JdbcTemplate</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Component</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

@<span style="color:#00f;font-weight:700">Component</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">JdbcSingerDao</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerDao</span>, <span style="font-style:italic">InitializingBean</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">JdbcTemplate</span> jdbcTemplate;

    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setJdbcTemplate</span>(<span style="color:#00f;font-weight:700">JdbcTemplate</span> <span style="font-style:italic">jdbcTemplate</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>jdbcTemplate <span style="color:#00f;font-weight:700">=</span> jdbcTemplate;
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">findNameById</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">id</span>) {
        <span style="color:#00f;font-weight:700">return</span> jdbcTemplate<span style="color:#00f;font-weight:700">.</span>queryForObject(
                <span style="color:#036a07">SELECT first_name || &apos; &apos; || last_name FROM  singer WHERE id = ?</span>,
                <span style="color:#00f;font-weight:700">new</span> Object {
            id
        },<span style="color:#00f;font-weight:700">String</span><span style="color:#00f;font-weight:700">.</span>class);
    }
    .<span style="color:#00f;font-weight:700">.</span>.
}
</pre>
                            <div class="Para ParaOneEmphasisChild" id="Par263">The Spring Boot entrypoint class, the one annotated with <span class="EmphasisFontCategoryNonProportional">@SpringBootApplication</span>, is shown in the following code sample. Notice how how simple it is.</div>
                            <div class="Para" id="Par264">
                               <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6.dao.SingerDao</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.Logger</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.LoggerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.boot.SpringApplication</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.boot.autoconfigure.SpringBootApplication</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.ConfigurableApplicationContext</span>;

@<span style="color:#00f;font-weight:700">SpringBootApplication</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Application</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">Application</span><span style="color:#00f;font-weight:700">.</span>class);

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Exception</span> {
        <span style="color:#00f;font-weight:700">ConfigurableApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">SpringApplication</span><span style="color:#00f;font-weight:700">.</span>run(<span style="color:#00f;font-weight:700">Application</span><span style="color:#00f;font-weight:700">.</span>class, args);
        <span style="color:#00f;font-weight:700">assert</span> (ctx <span style="color:#00f;font-weight:700">!=</span> <span style="color:#585cf6;font-weight:700">null</span>);
        <span style="color:#00f;font-weight:700">SingerDao</span> singerDao <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">SingerDao</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">String</span> singerName <span style="color:#00f;font-weight:700">=</span> singerDao<span style="color:#00f;font-weight:700">.</span>findNameById(<span style="color:#0000cd">1L</span>);
        logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">Retrieved singer: </span> <span style="color:#00f;font-weight:700">+</span> singerName);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>in<span style="color:#00f;font-weight:700">.</span>read();
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}</pre>
                                    </div>
                                </div>
                            </div>
                            </div>
                            <div class="Section1 RenderAsSection1" id="Sec24">
                                <h2 class="Heading">Summary</h2>
                                <div class="Para" id="Par265">This chapter showed you how to use Spring to simplify JDBC programming. You learned how to connect to a database and perform selects, updates, deletes, and inserts, as well as call database stored functions. Using the core
                                    Spring JDBC class, <span class="EmphasisFontCategoryNonProportional">JdbcTemplate</span>, was discussed in detail. We covered other Spring classes that are built on top of <span class="EmphasisFontCategoryNonProportional">JdbcTemplate</span>                                    and that help you model various JDBC operations. We also showed how to use the new lambda expressions from Java 8 where appropriate. In addition, Spring Boot JDBC was covered because whatever helps you focus more on
                                    the implementation of the business logic of an application and less on the configurations is a great tool to know. In the next couple of chapters, we discuss how to use Spring with popular ORM technologies when developing
                                    data access logic.</div>
                            </div>
                            <div class="FootnoteSection">
                                <div class="Heading">Footnotes</div>
                                <div class="Footnote" id="Fn1"><span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_6_Chapter.html#Fn1_source">1</a></span>
                                    <div class="FootnoteParas">
                                        <div class="Para" id="Par12">WordPress is a widely used blogging platform that uses MySQL or MariaDB for storing data.</div>
                                    </div>
                                    <div class="ClearBoth"> </div>
                                </div>
                                <div class="Footnote" id="Fn2"><span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_6_Chapter.html#Fn2_source">2</a></span>
                                    <div class="FootnoteParas">
                                        <div class="Para" id="Par25">Download MySQL Community Server from <span class="ExternalRef"><a href="https://dev.mysql.com/downloads/"><span class="RefSource">                    <span class="EmphasisFontCategoryNonProportional">https://dev.mysql.com/downloads/</span>                                            </span>
                                            </a>
                                            </span>.</div>
                                    </div>
                                    <div class="ClearBoth"> </div>
                                </div>
                                <div class="Footnote" id="Fn3"><span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_6_Chapter.html#Fn3_source">3</a></span>
                                    <div class="FootnoteParas">
                                        <div class="Para" id="Par75">Here is the official site: <span class="ExternalRef"><a href="http://commons.apache.org/dbcp"><span class="RefSource">                    <span class="EmphasisFontCategoryNonProportional">http://commons.apache.org/dbcp</span>                                            </span>
                                            </a>
                                            </span>.</div>
                                    </div>
                                    <div class="ClearBoth"> </div>
                                </div>
                                <div class="Footnote" id="Fn4"><span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_6_Chapter.html#Fn4_source">4</a></span>
                                    <div class="FootnoteParas">
                                        <div class="Para ParaOneEmphasisChild" id="Par167">This indicates that the annotated class is a repository, originally defined by <span class="EmphasisTypeItalic">Domain-Driven Design</span> (Evans, 2003) as “a mechanism for encapsulating storage, retrieval, and
                                            search behavior which emulates a collection of objects.”</div>
                                    </div>
                                    <div class="ClearBoth"> </div>
                                </div>
                            </div>
                            </div>
                            </div>
                            </div>
                            </section>
                            </div>
                            </div>



<hr/>
<!--if IE]><![endif]-->

<!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"            itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"data-offline-url="/"data-url="/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html"data-csrf-cookie="csrfsafari"data-highlight-privacy=""  data-user-id="3866890"  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"  data-username="levinxccai"  data-account-type="B2B"    data-activated-trial-date="11/06/2017"  data-archive="9781484228081"  data-publishers="Apress"  data-htmlfile-name="A315511_5_En_7_Chapter.html"  data-epub-title="Pro Spring 5: An In-Depth Guide to the Spring Framework and Its Tools" data-debug=0 data-testing=0><![endif]-->
<!--if gt IE 8]><!-->

    <!--![endif]-->
    
    
<a name="8_"></a>
 
        <div class="hide working" role="status"> 
            <div class="working-image"></div>             
        </div>         

        <div class="sbo-site-nav"> 
            <a class="skip" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html#container">Skip to content</a> 
        </div>         

        <div class="application" id="container" style="height: auto;"> 
            <div class="nav-container clearfix"> </div>             

            <div class="js-toc">                  

                <div class="interface-controls interface-controls-top">                      
</div>                 

                <section role="document"> 
                    <div class="t-sbo-prev sbo-prev sbo-nav-top">                          
</div>                     

                    <div class="t-sbo-next sbo-next sbo-nav-top">                          
</div>
                    <div id="sbo-rt-content" style="max-width:72.5em; transform: none;">
                        <div class="annotator-wrapper">
                            <div class="ChapterContextInformation">
                                <div class="ContextInformation" id="b978-1-4842-2808-1_7">
                                    <div class="ChapterCopyright">© Iuliana Cosmina, Rob Harrop, Chris Schaefer, and Clarence Ho 2017</div>
                                    <span class="ContextInformationAuthorEditorNames"><span class="Author"><span class="AuthorName">Iuliana Cosmina</span>, </span><span class="Author"><span class="AuthorName">Rob Harrop</span>, </span><span class="Author"><span class="AuthorName">Chris Schaefer</span> and </span><span class="Author"><span class="AuthorName">Clarence Ho</span></span></span>
                                    <span class="ContextInformationBookTitles"><span class="BookTitle" xml:lang="en">Pro Spring 5</span></span>
                                    <span class="ChapterDOI"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html">https://doi.org/10.1007/978-1-4842-2808-1_7</a></span>
                                </div>
                            </div>
                            <!--egin Abstract-->
                            <div class="MainTitleSection">
                                <h1 class="ChapterTitle" xml:lang="en">7. Using Hibernate in Spring</h1>
                            </div>
                            <div class="AuthorGroup">
                                <div class="AuthorNames">
                                    <span class="Author"><span class="AuthorName">Iuliana Cosmina</span><sup>1 <span class="ContactIcon"></span></sup>, </span>
                                    <span class="Author"><span class="AuthorName">Rob Harrop</span><sup>2</sup>, </span>
                                    <span class="Author"><span class="AuthorName">Chris Schaefer</span><sup>3</sup> and </span>
                                    <span class="Author"><span class="AuthorName">Clarence Ho</span><sup>4</sup></span>
                                </div>
                                <div class="Affiliations">
                                    <div class="Affiliation" id="Aff5">
                                        <span class="AffiliationNumber">(1)</span>
                                        <div class="AffiliationText">Sibiu, Sibiu, Romania</div>
                                    </div>
                                    <div class="Affiliation" id="Aff6">
                                        <span class="AffiliationNumber">(2)</span>
                                        <div class="AffiliationText">Reddish, UK</div>
                                    </div>
                                    <div class="Affiliation" id="Aff7">
                                        <span class="AffiliationNumber">(3)</span>
                                        <div class="AffiliationText">Venice, Florida, USA</div>
                                    </div>
                                    <div class="Affiliation" id="Aff8">
                                        <span class="AffiliationNumber">(4)</span>
                                        <div class="AffiliationText">Hong Kong, China</div>
                                    </div>
                                    <div class="ClearBoth"> </div>
                                </div>
                            </div>
                            <!--nd Abstract-->
                            <div class="Fulltext">
                                <div class="Para" id="Par1">In the previous chapter, you saw how to use JDBC in Spring applications. However, even though Spring goes a long way toward simplifying JDBC development, you still have a lot of code to write. In this chapter, we cover one of the object-relational mapping (ORM) libraries called Hibernate.</div>
                                <div class="Para" id="Par2">If you have experience developing data access applications using EJB entity beans (prior to EJB 3.0), you may remember the painful process. Tedious configuration of mappings, transaction demarcation, and much boilerplate code in each bean to manage its life cycle greatly reduced productivity when developing enterprise Java applications.</div>
                                <div class="Para" id="Par3">Just like Spring was developed to embrace POJO-based development and declarative configuration management rather than EJB’s heavy and clumsy setup, the developer community realized that a simpler, lightweight, and POJO-based framework could ease the development of data access logic. Since then, many libraries have appeared; they are generally referred to as 
                                    <span id="ITerm1"> <span class="EmphasisTypeItalic">ORM libraries</span> </span>. The main objectives of an ORM library are to close the gap between the relational data structure in the relational database management system (RDBMS) and the object-oriented (OO) model in Java so that developers can focus on programming with the object model and at the same time easily perform actions related to persistence.
                                </div>
                                <div class="Para" id="Par4">Out of the ORM libraries available in the open source community, Hibernate is one of the most successful. Its features, such as a POJO-based approach, ease of development, and support of sophisticated relationship definitions, have won the heart of the mainstream Java developer community.</div>
                                <div class="Para" id="Par5">Hibernate’s popularity has also influenced the 
                                    <span id="ITerm2">JCP              </span>, which developed the 
                                    <span id="ITerm3">Java Data Objects (JDO)      </span> specification as one of the standard ORM technologies in Java EE. Starting from EJB 3.0, the EJB entity bean was even replaced with the 
                                    <span id="ITerm4">Java Persistence API (JPA)      </span>. JPA has a lot of concepts that were influenced by popular ORM libraries such as Hibernate, TopLink, and JDO. The relationship between Hibernate and JPA is also very close. Gavin King, the founder of Hibernate, represented JBoss as one of the JCP expert group members in defining the JPA specification. Starting from version 3.2, Hibernate provides an implementation of JPA. That means when you develop applications with Hibernate, you can choose to use either Hibernate’s own API or the JPA API with Hibernate as the persistence service provider.
                                </div>
                                <div class="Para" id="Par6">Having offered a brief history of Hibernate, this chapter will cover how to use Spring with Hibernate when developing data access logic. Hibernate is such an extensive ORM library that covering every aspect in just one chapter is simply not possible, and numerous books are dedicated to discussing Hibernate.</div>
                                <div class="Para" id="Par7">This chapter covers the basic ideas and main use cases of Hibernate in Spring. In particular, we discuss the following topics:
                                    <div class="UnorderedList">
                                        <ul class="UnorderedListMarkBullet">
                                            <li>
                                                <div class="Para" id="Par8"> 
                                                    <span class="EmphasisTypeItalic">Configuring the Hibernate SessionFactory</span>: The core concept of Hibernate revolves around the 
                                                    <span class="EmphasisFontCategoryNonProportional">Session</span> interface, which is managed by 
                                                    <span class="EmphasisFontCategoryNonProportional">SessionFactory</span>. We show you how to configure Hibernate’s session factory to work in a Spring application.
                                                </div>
                                            </li>
                                            <li>
                                                <div class="Para ParaOneEmphasisChild" id="Par9"> 
                                                    <span class="EmphasisTypeItalic">Major concepts of ORMs using Hibernate</span>: We go through the major concepts of how to use Hibernate to map a POJO to the underlying relational database structure. Some commonly used relationships, including one-to-many and many-to-many, are also discussed.
                                                </div>
                                            </li>
                                            <li>
                                                <div class="Para" id="Par10"> 
                                                    <span class="EmphasisTypeItalic">Data operations</span>: We present examples of how to perform data operations (query, insert, update, delete) by using Hibernate in the Spring environment. When working with Hibernate, its 
                                                    <span class="EmphasisFontCategoryNonProportional">Session</span> interface is the main interface that you will interact with.
                                                </div>
                                            </li>
                                        </ul>
                                    </div>                                     
                                </div>
                                <div class="Para ParaTypeImportant" id="Par11">
                                    <img alt="A315511_5_En_7_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Figa_HTML.jpg" width="30"/> When defining object-to-relational mappings, Hibernate supports two configuration styles. One is configuring the mapping information in XML files, and the other is using Java annotations within the entity classes (in the ORM or JPA world, a Java class that is mapped to the underlying relational database structure is called an 
                                    <span class="EmphasisTypeItalic">entity class</span>). This chapter focuses on using the annotation approach for object-relational mapping. For the mapping annotation, we use the JPA standards (for example, under the 
                                    <span class="EmphasisFontCategoryNonProportional">javax.persistence</span> package) because they are interchangeable with Hibernate’s own annotations and will help you with future migrations to a JPA environment.
                                </div>
                                <div class="Section1 RenderAsSection1" id="Sec1">
                                    <h2 class="Heading">Sample Data Model for Example Code</h2>
                                    <div class="Para" id="Par12">Figure 
                                        <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html#Fig1">7-1</a></span> shows the data model used in this 
                                        <span id="ITerm5">chapter                  </span>.
                                        <div class="Figure" id="Fig1">
                                            <div class="MediaObject" id="MO1">
                                                <img alt="A315511_5_En_7_Fig1_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Fig1_HTML.jpg" height="304" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Fig1_HTML.jpg" width="686"/>
                                            </div>
                                            <div class="Caption" xml:lang="en">
                                                <div class="CaptionContent">
                                                    <span class="CaptionNumber">Figure 7-1.</span>
                                                    <div class="SimplePara">Sample 
                                                        <span id="ITerm6">data model                                  </span> 
                                                    </div>
                                                </div>
                                            </div>
                                        </div>                                         
                                    </div>
                                    <div class="Para" id="Par13">As shown in this data model, two new tables were added, namely, 
                                        <span class="EmphasisFontCategoryNonProportional">INSTRUMENT</span> and 
                                        <span class="EmphasisFontCategoryNonProportional">SINGER_INSTRUMENT</span> (the join table). 
                                        <span class="EmphasisFontCategoryNonProportional">SINGER_INSTRUMENT</span> models the many-to-many relationships between the 
                                        <span class="EmphasisFontCategoryNonProportional">SINGER</span> and 
                                        <span class="EmphasisFontCategoryNonProportional">INSTRUMENT</span> tables. A 
                                        <span class="EmphasisFontCategoryNonProportional">VERSION</span> column was added to the 
                                        <span class="EmphasisFontCategoryNonProportional">SINGER</span> and 
                                        <span class="EmphasisFontCategoryNonProportional">ALBUM</span> tables for optimistic locking, which will be discussed in detail later. In the examples in this chapter, we will use the embedded H2 database, so the database name is not required. Here are the scripts to create the tables needed for the examples in this chapter:
                                    </div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">CREATE</span> <span style="color:#00f;font-weight:700">TABLE</span> <span style="color:#0000a2;font-weight:700">singer</span> 
  ( 
     id         <span style="color:#00f;font-weight:700">INT</span> <span style="color:#00f;font-weight:700">NOT NULL</span> auto_increment, 
     first_name <span style="color:#00f;font-weight:700">VARCHAR</span>(<span style="color:#0000cd">60</span>) <span style="color:#00f;font-weight:700">NOT NULL</span>, 
     last_name  <span style="color:#00f;font-weight:700">VARCHAR</span>(<span style="color:#0000cd">40</span>) <span style="color:#00f;font-weight:700">NOT NULL</span>, 
     birth_date <span style="color:#00f;font-weight:700">DATE</span>, 
     version    <span style="color:#00f;font-weight:700">INT</span> <span style="color:#00f;font-weight:700">NOT NULL</span> DEFAULT <span style="color:#0000cd">0</span>, 
     UNIQUE uq_singer_1 (first_name, last_name), 
     <span style="color:#00f;font-weight:700">PRIMARY KEY</span> (id) 
  ); 

<span style="color:#00f;font-weight:700">CREATE</span> <span style="color:#00f;font-weight:700">TABLE</span> <span style="color:#0000a2;font-weight:700">album</span> 
  ( 
     id           <span style="color:#00f;font-weight:700">INT</span> <span style="color:#00f;font-weight:700">NOT NULL</span> auto_increment, 
     singer_id    <span style="color:#00f;font-weight:700">INT</span> <span style="color:#00f;font-weight:700">NOT NULL</span>, 
     title        <span style="color:#00f;font-weight:700">VARCHAR</span>(<span style="color:#0000cd">100</span>) <span style="color:#00f;font-weight:700">NOT NULL</span>, 
     release_date <span style="color:#00f;font-weight:700">DATE</span>, 
     version      <span style="color:#00f;font-weight:700">INT</span> <span style="color:#00f;font-weight:700">NOT NULL</span> DEFAULT <span style="color:#0000cd">0</span>, 
     UNIQUE uq_singer_album_1 (singer_id, title), 
     <span style="color:#00f;font-weight:700">PRIMARY KEY</span> (id), 
     <span style="color:#00f;font-weight:700">CONSTRAINT</span> fk_album_singer <span style="color:#00f;font-weight:700">FOREIGN KEY</span> (singer_id) <span style="color:#00f;font-weight:700">REFERENCES</span> singer (id) 
  ); 

<span style="color:#00f;font-weight:700">CREATE</span> <span style="color:#00f;font-weight:700">TABLE</span> <span style="color:#0000a2;font-weight:700">instrument</span> 
  ( 
     instrument_id <span style="color:#00f;font-weight:700">VARCHAR</span>(<span style="color:#0000cd">20</span>) <span style="color:#00f;font-weight:700">NOT NULL</span>, 
     <span style="color:#00f;font-weight:700">PRIMARY KEY</span> (instrument_id) 
  ); 

<span style="color:#00f;font-weight:700">CREATE</span> <span style="color:#00f;font-weight:700">TABLE</span> <span style="color:#0000a2;font-weight:700">singer_instrument</span> 
  ( 
     singer_id     <span style="color:#00f;font-weight:700">INT</span> <span style="color:#00f;font-weight:700">NOT NULL</span>, 
     instrument_id <span style="color:#00f;font-weight:700">VARCHAR</span>(<span style="color:#0000cd">20</span>) <span style="color:#00f;font-weight:700">NOT NULL</span>, 
     <span style="color:#00f;font-weight:700">PRIMARY KEY</span> (singer_id, instrument_id), 
     <span style="color:#00f;font-weight:700">CONSTRAINT</span> fk_singer_instrument_1 <span style="color:#00f;font-weight:700">FOREIGN KEY</span> (singer_id) <span style="color:#00f;font-weight:700">REFERENCES</span> singer 
     (id) <span style="color:#00f;font-weight:700">ON DELETE CASCADE</span>, 
     <span style="color:#00f;font-weight:700">CONSTRAINT</span> fk_singer_instrument_2 <span style="color:#00f;font-weight:700">FOREIGN KEY</span> (instrument_id) <span style="color:#00f;font-weight:700">REFERENCES</span> 
     instrument (instrument_id) 
  ); 
</pre>
                                    <div class="Para" id="Par15">The following 
                                        <span id="ITerm7">SQL                  </span> is the script for data population:
                                    </div>
                                    <div class="Para" id="Par16"> 
                                        <div class="ProgramCode" id="PC2">
                                            <div class="LineGroup">
                                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">INSERT INTO</span> singer 
            (first_name, 
             last_name, 
             birth_date) 
<span style="color:#00f;font-weight:700">VALUES</span>      (<span style="color:#036a07">John</span>, 
             <span style="color:#036a07">Mayer</span>, 
             <span style="color:#036a07">1977-10-16</span>); 

<span style="color:#00f;font-weight:700">INSERT INTO</span> singer 
            (first_name, 
             last_name, 
             birth_date) 
<span style="color:#00f;font-weight:700">VALUES</span>      (<span style="color:#036a07">Eric</span>, 
             <span style="color:#036a07">Clapton</span>, 
             <span style="color:#036a07">1945-03-30</span>); 

<span style="color:#00f;font-weight:700">INSERT INTO</span> singer 
            (first_name, 
             last_name, 
             birth_date) 
<span style="color:#00f;font-weight:700">VALUES</span>      (<span style="color:#036a07">John</span>, 
             <span style="color:#036a07">Butler</span>, 
             <span style="color:#036a07">1975-04-01</span>); 

<span style="color:#00f;font-weight:700">INSERT INTO</span> album 
            (singer_id, 
             title, 
             release_date) 
<span style="color:#00f;font-weight:700">VALUES</span>      (<span style="color:#0000cd">1</span>, 
             <span style="color:#036a07">The Search For Everything</span>, 
             <span style="color:#036a07">2017-01-20</span>); 

<span style="color:#00f;font-weight:700">INSERT INTO</span> album 
            (singer_id, 
             title, 
             release_date) 
<span style="color:#00f;font-weight:700">VALUES</span>      (<span style="color:#0000cd">1</span>, 
             <span style="color:#036a07">Battle Studies</span>, 
             <span style="color:#036a07">2009-11-17</span>); 

<span style="color:#00f;font-weight:700">INSERT INTO</span> album 
            (singer_id, 
             title, 
             release_date) 
<span style="color:#00f;font-weight:700">VALUES</span>      (<span style="color:#0000cd">2</span>, 
             <span style="color:#036a07">From The Cradle </span>, 
             <span style="color:#036a07">1994-09-13</span>); 

<span style="color:#00f;font-weight:700">INSERT INTO</span> instrument 
            (instrument_id) 
<span style="color:#00f;font-weight:700">VALUES</span>      (<span style="color:#036a07">Guitar</span>); 

<span style="color:#00f;font-weight:700">INSERT INTO</span> instrument 
            (instrument_id) 
<span style="color:#00f;font-weight:700">VALUES</span>      (<span style="color:#036a07">Piano</span>); 

<span style="color:#00f;font-weight:700">INSERT INTO</span> instrument 
            (instrument_id) 
<span style="color:#00f;font-weight:700">VALUES</span>      (<span style="color:#036a07">Voice</span>); 

<span style="color:#00f;font-weight:700">INSERT INTO</span> instrument 
            (instrument_id) 
<span style="color:#00f;font-weight:700">VALUES</span>      (<span style="color:#036a07">Drums</span>); 

<span style="color:#00f;font-weight:700">INSERT INTO</span> instrument 
            (instrument_id) 
<span style="color:#00f;font-weight:700">VALUES</span>      (<span style="color:#036a07">Synthesizer</span>); 

<span style="color:#00f;font-weight:700">INSERT INTO</span> singer_instrument 
            (singer_id, 
             instrument_id) 
<span style="color:#00f;font-weight:700">VALUES</span>      (<span style="color:#0000cd">1</span>, 
             <span style="color:#036a07">Guitar</span>); 

<span style="color:#00f;font-weight:700">INSERT INTO</span> singer_instrument 
            (singer_id, 
             instrument_id) 
<span style="color:#00f;font-weight:700">VALUES</span>      (<span style="color:#0000cd">1</span>, 
             <span style="color:#036a07">Piano</span>); 

<span style="color:#00f;font-weight:700">INSERT INTO</span> singer_instrument 
            (singer_id, 
             instrument_id) 
<span style="color:#00f;font-weight:700">VALUES</span>      (<span style="color:#0000cd">2</span>, 
             <span style="color:#036a07">Guitar</span>); 
</pre></div>
                                            </div>
                                        </div>                                         
                                    </div>
                                </div>
                                <div class="Section1 RenderAsSection1" id="Sec2">
                                    <h2 class="Heading">Configuring Hibernate’s SessionFactory</h2>
                                    <div class="Para" id="Par17">As mentioned earlier in this chapter, the core concept of Hibernate is based on the 
                                        <span class="EmphasisFontCategoryNonProportional">Session</span> interface, which is obtained from 
                                        <span id="ITerm8"> <span class="EmphasisFontCategoryNonProportional">SessionFactory</span> </span>. Spring provides classes to support the configuration of Hibernate’s session factory as a Spring bean with the desired properties. To use Hibernate, you must add the Hibernate dependency as a dependency to the project. Here is the Gradle configuration used for the projects in this chapter:
                                    </div>
                                    <pre style="background:#fff;color:#000"><span style="color:#06f;font-style:italic">//pro-spring-15/build.gradle</span>
ext {
  hibernateVersion <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">5.2.10.Final</span>
  .<span style="color:#00f;font-weight:700">.</span>.
  hibernate <span style="color:#00f;font-weight:700">=</span> [
    validator<span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">org.hibernate:hibernate-validator:5.1.3.Final</span>,
    ehcache <span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">org.hibernate:hibernate-ehcache:$hibernateVersion</span>,
    [ em] <span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">org.hibernate:hibernate-entitymanager:$hibernateVersion</span>
  ]
  .<span style="color:#00f;font-weight:700">.</span>.
}
<span style="color:#06f;font-style:italic">//chapter07.gradle</span>
dependencies {
  <span style="color:#06f;font-style:italic">//we specify these dependencies for all submodules,</span>
    except the boot module, that defines its own
  <span style="color:#00f;font-weight:700">if</span> <span style="color:#00f;font-weight:700">!</span>project<span style="color:#00f;font-weight:700">.</span>name<span style="color:#00f;font-weight:700">.</span>contains<span style="color:#036a07">boot</span> {
   compile spring<span style="color:#00f;font-weight:700">.</span>contextSupport, spring<span style="color:#00f;font-weight:700">.</span>orm,
   misc<span style="color:#00f;font-weight:700">.</span>slf4jJcl, misc<span style="color:#00f;font-weight:700">.</span>logback, db<span style="color:#00f;font-weight:700">.</span>h2, misc<span style="color:#00f;font-weight:700">.</span>lang3, [hibernate<span style="color:#00f;font-weight:700">.</span>em]
  }
  testCompile testing. junit
}
</pre>
                                    <div class="Para" id="Par19">In the following configuration, you can see the XML elements needed to configure the application sample for this chapter:</div>
                                    <pre style="background:#fff;color:#000"><span style="color:#68685b">&lt;?<span style="color:#888">xml</span><span style="color:#888"> version</span>=<span style="color:#888">1.0</span><span style="color:#888"> encoding</span>=<span style="color:#888">UTF-8</span>?&gt;</span>
<span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span>
    <span style="font-style:italic">xmlns</span>=<span style="color:#036a07">http://www.springframework.org/schema/beans</span>
    <span style="font-style:italic">xmlns</span>:xsi=<span style="color:#036a07">http://www.w3.org/2001/XMLSchema-instance</span>
    <span style="font-style:italic">xmlns</span>:context=<span style="color:#036a07">http://www.springframework.org/schema/context</span>
    <span style="font-style:italic">xmlns</span>:tx=<span style="color:#036a07">http://www.springframework.org/schema/tx</span>
    <span style="font-style:italic">xmlns</span>:p=<span style="color:#036a07">http://www.springframework.org/schema/p</span>
    <span style="font-style:italic">xmlns</span>:jdbc=<span style="color:#036a07">http://www.springframework.org/schema/jdbc</span>
    <span style="font-style:italic">xmlns</span>:util=<span style="color:#036a07">http://www.springframework.org/schema/util</span>
  <span style="font-style:italic">xsi</span>:schemaLocation=<span style="color:#036a07">
    http://www.springframework.org/schema/jdbc
    http://www.springframework.org/schema/jdbc/spring-jdbc.xsd
    http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/tx
    http://www.springframework.org/schema/tx/spring-tx.xsd
    http://www.springframework.org/schema/util
    http://www.springframework.org/schema/util/spring-util.xsd
    http://www.springframework.org/schema/context
    http://www.springframework.org/schema/context/spring-context.xsd</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">jdbc</span><span style="font-weight:700">:</span><span style="font-weight:700">embedded-database</span> <span style="font-style:italic">id</span>=<span style="color:#036a07"> dataSource</span> <span style="font-style:italic">type</span>=<span style="color:#036a07">H2</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">jdbc</span><span style="font-weight:700">:</span><span style="font-weight:700">script</span> <span style="font-style:italic">location</span>=<span style="color:#036a07">classpath:sql/schema.sql</span>/&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">jdbc</span><span style="font-weight:700">:</span><span style="font-weight:700">script</span> <span style="font-style:italic">location</span>=<span style="color:#036a07">classpath:sql/test-data.sql</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">jdbc</span><span style="font-weight:700">:</span><span style="font-weight:700">embedded-database</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>= <span style="color:#036a07">transactionManager</span>
    <span style="font-style:italic">class</span>=<span style="color:#036a07">org.springframework.orm.hibernate5.HibernateTransactionManager</span>
    <span style="font-style:italic">p</span>:sessionFactory-ref=<span style="color:#036a07">sessionFactory</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">tx</span><span style="font-weight:700">:</span><span style="font-weight:700">annotation-driven</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">context:</span> component-scan <span style="font-style:italic">base-package</span>=
           <span style="color:#036a07">com.apress.prospring5.ch7</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07"> sessionFactory</span>
    <span style="font-style:italic">class</span>=<span style="color:#036a07">org.springframework.orm.hibernate5.LocalSessionFactoryBean</span>
     <span style="font-style:italic">p</span>:dataSource-ref=<span style="color:#036a07">dataSource</span>
     <span style="font-style:italic">p</span>:packagesToScan=<span style="color:#036a07">com.apress.prospring5.ch7.entities</span>
     <span style="font-style:italic">p</span>:hibernateProperties-ref=<span style="color:#036a07">hibernateProperties</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">util</span><span style="font-weight:700">:</span><span style="font-weight:700">properties</span> <span style="font-style:italic">id</span>=<span style="color:#036a07"> hibernateProperties</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">prop</span> <span style="font-style:italic">key</span>=<span style="color:#036a07">hibernate.dialect</span>&gt;</span>org.hibernate.dialect.H2Dialect<span style="color:#1c02ff">&lt;/<span style="font-weight:700">prop</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">prop</span> <span style="font-style:italic">key</span>=<span style="color:#036a07">hibernate.max_fetch_depth</span>&gt;</span>3<span style="color:#1c02ff">&lt;/<span style="font-weight:700">prop</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">prop</span> <span style="font-style:italic">key</span>=<span style="color:#036a07">hibernate.jdbc.fetch_size</span>&gt;</span>50<span style="color:#1c02ff">&lt;/<span style="font-weight:700">prop</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">prop</span> <span style="font-style:italic">key</span>=<span style="color:#036a07">hibernate.jdbc.batch_size</span>&gt;</span>10<span style="color:#1c02ff">&lt;/<span style="font-weight:700">prop</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">prop</span> <span style="font-style:italic">key</span>=<span style="color:#036a07">hibernate.hbm2ddl.auto</span>&gt;</span>create-drop<span style="color:#1c02ff">&lt;/<span style="font-weight:700">prop</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">prop</span> <span style="font-style:italic">key</span>=<span style="color:#036a07">hibernate.format_sql</span>&gt;</span>true<span style="color:#1c02ff">&lt;/<span style="font-weight:700">prop</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">prop</span> <span style="font-style:italic">key</span>=<span style="color:#036a07">hibernate.use_sql_comments</span>&gt;</span>true<span style="color:#1c02ff">&lt;/<span style="font-weight:700">prop</span>&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">util</span><span style="font-weight:700">:</span><span style="font-weight:700">properties</span>&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
                                    <div class="Para" id="Par21">The equivalent Java configuration class is depicted next, and the components for these two configurations are explained in parallel after the code snippet:</div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.config</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6.CleanUp</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.hibernate.SessionFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.Logger</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.LoggerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Bean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Configuration</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.jdbc.core.JdbcTemplate</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.jdbc.datasource.embedded.EmbeddedDatabaseBuilder</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.jdbc.datasource.embedded.EmbeddedDatabaseType</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.orm.hibernate5.HibernateTransactionManager</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.orm.hibernate5.LocalSessionFactoryBean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.PlatformTransactionManager</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.annotation.EnableTransactionManagement</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.sql.DataSource</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.io.IOException</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Properties</span>;

@<span style="color:#00f;font-weight:700">Configuration</span>
@ComponentScan(basePackages <span style="color:#00f;font-weight:700">=</span>
        <span style="color:#036a07">com.apress.prospring5.ch7</span>)
@<span style="color:#00f;font-weight:700">EnableTransactionManagement</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AppConfig</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">AppConfig</span><span style="color:#00f;font-weight:700">.</span>class);

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">DataSource</span> <span style="color:#0000a2;font-weight:700">dataSource</span>() {
        <span style="color:#00f;font-weight:700">try</span> {
            <span style="color:#00f;font-weight:700">EmbeddedDatabaseBuilder</span> dbBuilder <span style="color:#00f;font-weight:700">=</span>
                    <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">EmbeddedDatabaseBuilder</span>();
            <span style="color:#00f;font-weight:700">return</span> dbBuilder<span style="color:#00f;font-weight:700">.</span>setType(<span style="color:#00f;font-weight:700">EmbeddedDatabaseType</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>H2</span>)
                    .addScripts(<span style="color:#036a07">classpath:sql/schema.sql</span>,
                            <span style="color:#036a07">classpath:sql/test-data.sql</span>)<span style="color:#00f;font-weight:700">.</span>build();
        } <span style="color:#00f;font-weight:700">catch</span> (<span style="color:#00f;font-weight:700">Exception</span> e) {
            logger<span style="color:#00f;font-weight:700">.</span>error(<span style="color:#036a07">Embedded DataSource bean cannot be created!</span>, e);
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#585cf6;font-weight:700">null</span>;
        }
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Properties</span> <span style="color:#0000a2;font-weight:700">hibernateProperties</span>() {
        <span style="color:#00f;font-weight:700">Properties</span> hibernateProp <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Properties</span>();
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.dialect</span>, <span style="color:#036a07">org.hibernate.dialect.H2Dialect</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.format_sql</span>, <span style="color:#585cf6;font-weight:700">true</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.use_sql_comments</span>, <span style="color:#585cf6;font-weight:700">true</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.show_sql</span>, <span style="color:#585cf6;font-weight:700">true</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.max_fetch_depth</span>, <span style="color:#0000cd">3</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.jdbc.batch_size</span>, <span style="color:#0000cd">10</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.jdbc.fetch_size</span>, <span style="color:#0000cd">50</span>);
        <span style="color:#00f;font-weight:700">return</span> hibernateProp;
    }

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">SessionFactory</span> <span style="color:#0000a2;font-weight:700">sessionFactory</span>()
            <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">IOException</span> {
        <span style="color:#00f;font-weight:700">LocalSessionFactoryBean</span> sessionFactoryBean <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">LocalSessionFactoryBean</span>();
        sessionFactoryBean<span style="color:#00f;font-weight:700">.</span>setDataSource(dataSource());
        sessionFactoryBean<span style="color:#00f;font-weight:700">.</span>setPackagesToScan(<span style="color:#036a07">com.apress.prospring5.ch7.entities</span>);
        sessionFactoryBean<span style="color:#00f;font-weight:700">.</span>setHibernateProperties(hibernateProperties());
        sessionFactoryBean<span style="color:#00f;font-weight:700">.</span>afterPropertiesSet();
        <span style="color:#00f;font-weight:700">return</span> sessionFactoryBean<span style="color:#00f;font-weight:700">.</span>getObject();
    }

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">PlatformTransactionManager</span> <span style="color:#0000a2;font-weight:700">transactionManager</span>()
            <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">IOException</span> {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HibernateTransactionManager</span>(sessionFactory());
    }
}
</pre>
                                    <div class="Para" id="Par23">In the previous configuration, several beans were declared to be able to support Hibernate’s session 
                                        <span id="ITerm13">factory                  </span>. The main configurations are listed here:
                                        <div class="UnorderedList">
                                            <ul class="UnorderedListMarkBullet">
                                                <li>
                                                    <div class="Para" id="Par24"> 
                                                        <span class="EmphasisTypeItalic">The dataSource bean</span>: The database used is an H2 embedded one, declared as previously explained in Chapter 
                                                        <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_6_Chapter.html"><span class="RefSource">6</span></a></span>.
                                                    </div>
                                                </li>
                                                <li>
                                                    <div class="Para" id="Par25"> 
                                                        <span class="EmphasisTypeItalic">The transactionManager bean</span>: The Hibernate session factory requires a transaction manager for transactional data access. Spring provides a transaction manager specifically for Hibernate 5 declared in package 
                                                        <span class="EmphasisFontCategoryNonProportional">org.springframework.orm.hibernate5.HibernateTransactionManager</span>. The bean was declared with the ID 
                                                        <span class="EmphasisFontCategoryNonProportional">transactionManager</span> assigned. By default, when using XML configuration, Spring will look up the bean with the name 
                                                        <span class="EmphasisFontCategoryNonProportional">transactionManager</span> within its 
                                                        <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> whenever transaction management is required. Java configuration is a little more flexible when the bean is being searched by its type, not by its name. We discuss transactions in detail in Chapter 
                                                        <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html"><span class="RefSource">9</span></a></span>. In addition, we declare the tag 
                                                        <span class="EmphasisFontCategoryNonProportional">&lt;tx:annotation-driven&gt;</span> to support the declaration of transaction demarcation requirements using annotations. The equivalent for the Java configuration is the 
                                                        <span class="EmphasisFontCategoryNonProportional">@EnableTransactionManagement</span> annotation.
                                                    </div>
                                                </li>
                                                <li>
                                                    <div class="Para" id="Par26"> 
                                                        <span class="EmphasisTypeItalic">Component scan</span>: This tag and the 
                                                        <span class="EmphasisFontCategoryNonProportional">@ComponentScan</span> annotation should be familiar to you. We instruct Spring to scan the components under the package 
                                                        <span class="EmphasisFontCategoryNonProportional">com.apress.prospring5.ch7</span> to detect the beans annotated with 
                                                        <span class="EmphasisFontCategoryNonProportional">@Repository</span>.
                                                    </div>
                                                </li>
                                                <li>
                                                    <div class="Para" id="Par27"> 
                                                        <span class="EmphasisTypeItalic">Hibernate SessionFactory bean</span>: The 
                                                        <span class="EmphasisFontCategoryNonProportional">sessionFactory</span> bean is the most important part. Within the bean, several properties are provided. First, we need to inject the 
                                                        <span class="EmphasisFontCategoryNonProportional">dataSource</span> bean into the session factory. Second, we instruct Hibernate to scan for the domain objects under the package 
                                                        <span class="EmphasisFontCategoryNonProportional">com.apress.prospring5.ch.entities</span>. Finally, the 
                                                        <span class="EmphasisFontCategoryNonProportional">hibernateProperties</span> property provides configuration details for Hibernate. There are many configuration parameters, and we define only a few important properties that should be provided for every application. Table 
                                                        <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html#Tab1">7-1</a></span> lists the main configuration parameters for the Hibernate session factory.
                                                        <div class="Table" id="Tab1">
                                                            <div class="Caption" xml:lang="en">
                                                                <div class="CaptionContent">
                                                                    <span class="CaptionNumber">Table 7-1.</span>
                                                                    <div class="SimplePara">Hibernate 
                                                                        <span id="ITerm14">Properties                                              </span> 
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <table border="1">
                                                                <colgroup>
                                                                    <col>
                                                                    <col>
                                                                </colgroup>
                                                                <thead>
                                                                    <tr class="header">
                                                                        <th>
                                                                            <div class="SimplePara">Property</div>
                                                                        </th>
                                                                        <th>
                                                                            <div class="SimplePara">Description</div>
                                                                        </th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr class="noclass">
                                                                        <td>
                                                                            <div class="SimplePara"> 
                                                                                <span class="EmphasisFontCategoryNonProportional">hibernate.dialect</span> 
                                                                            </div>
                                                                        </td>
                                                                        <td>
                                                                            <div class="SimplePara">Specifies the database dialect for the queries that Hibernate should use. Hibernate supports the SQL dialects for many databases. Those dialects are subclasses of 
                                                                                <span class="EmphasisFontCategoryNonProportional">org.hibernate.dialect.Dialect</span>. Major dialects include 
                                                                                <span class="EmphasisFontCategoryNonProportional">H2Dialect</span>, 
                                                                                <span class="EmphasisFontCategoryNonProportional">Oracle10gDialect</span>, 
                                                                                <span class="EmphasisFontCategoryNonProportional">PostgreSQLDialect</span>, 
                                                                                <span class="EmphasisFontCategoryNonProportional">MySQLDialect</span>, 
                                                                                <span class="EmphasisFontCategoryNonProportional">SQLServerDialect</span>, and so on.
                                                                            </div>
                                                                        </td>
                                                                    </tr>
                                                                    <tr class="noclass">
                                                                        <td>
                                                                            <div class="SimplePara"> 
                                                                                <span class="EmphasisFontCategoryNonProportional">hibernate.max_fetch_depth</span> 
                                                                            </div>
                                                                        </td>
                                                                        <td>
                                                                            <div class="SimplePara">Declares the “depth” for outer joins when the mapping objects have associations with other mapped objects. This setting prevents Hibernate from fetching too much data with a lot of nested associations. A commonly used value is 3.</div>
                                                                        </td>
                                                                    </tr>
                                                                    <tr class="noclass">
                                                                        <td>
                                                                            <div class="SimplePara"> 
                                                                                <span class="EmphasisFontCategoryNonProportional">hibernate.jdbc.fetch_size</span> 
                                                                            </div>
                                                                        </td>
                                                                        <td>
                                                                            <div class="SimplePara">Specifies the number of records from the underlying JDBC 
                                                                                <span class="EmphasisFontCategoryNonProportional">ResultSet</span> that Hibernate should use to retrieve the records from the database for each fetch. For example, a query was submitted to the database, and 
                                                                                <span class="EmphasisFontCategoryNonProportional">ResultSet</span> contains 500 records. If the fetch size is 50, Hibernate will need to fetch 10 times to get all the data.
                                                                            </div>
                                                                        </td>
                                                                    </tr>
                                                                    <tr class="noclass">
                                                                        <td>
                                                                            <div class="SimplePara"> 
                                                                                <span class="EmphasisFontCategoryNonProportional">ibernate.jdbc.batch_</span> 
                                                                                <span id="ITerm15"> <span class="EmphasisFontCategoryNonProportional">size</span> </span> 
                                                                            </div>
                                                                        </td>
                                                                        <td>
                                                                            <div class="SimplePara">Instructs Hibernate on the number of update operations that should be grouped together into a batch. This is useful for performing batch job operations in Hibernate. Obviously, when we are doing a batch job updating hundreds of thousands of records, we would like Hibernate to group the queries in batches, rather than submit the updates one by one.</div>
                                                                        </td>
                                                                    </tr>
                                                                    <tr class="noclass">
                                                                        <td>
                                                                            <div class="SimplePara"> 
                                                                                <span class="EmphasisFontCategoryNonProportional">hibernate.show_sql</span> 
                                                                            </div>
                                                                        </td>
                                                                        <td>
                                                                            <div class="SimplePara">Indicates whether Hibernate should output the SQL queries to the log file or console. You should turn this on in a development environment, which can greatly help in the testing and troubleshooting process.</div>
                                                                        </td>
                                                                    </tr>
                                                                    <tr class="noclass">
                                                                        <td>
                                                                            <div class="SimplePara"> 
                                                                                <span class="EmphasisFontCategoryNonProportional">hibernate.format_sql</span> 
                                                                            </div>
                                                                        </td>
                                                                        <td>
                                                                            <div class="SimplePara">Indicates whether SQL output in the log or console should be formatted.</div>
                                                                        </td>
                                                                    </tr>
                                                                    <tr class="noclass">
                                                                        <td>
                                                                            <div class="SimplePara"> 
                                                                                <span class="EmphasisFontCategoryNonProportional">hibernate..use_sql_comments</span> 
                                                                            </div>
                                                                        </td>
                                                                        <td>
                                                                            <div class="SimplePara">If set to 
                                                                                <span class="EmphasisFontCategoryNonProportional">true</span>, Hibernate generates comments inside the SQL for easier debugging.
                                                                            </div>
                                                                        </td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                        </div>                                                         
                                                    </div>
                                                </li>
                                            </ul>
                                        </div>                                         
                                    </div>
                                    <div class="Para" id="Par28">For the full list of properties that Hibernate supports, please refer to Hibernate’s ORM user guide, specifically, Section 23, at 
                                        <span class="ExternalRef"><a href="https://docs.jboss.org/hibernate/orm/5.2/userguide/html_single/Hibernate_User_Guide.html"><span class="RefSource"> <span class="EmphasisFontCategoryNonProportional">https://docs.jboss.org/hibernate/orm/5.2/userguide/html_single/Hibernate_User_Guide.html</span> </span></a></span>.
                                    </div>
                                </div>
                                <div class="Section1 RenderAsSection1" id="Sec3">
                                    <h2 class="Heading">ORM Mapping Using Hibernate Annotations</h2>
                                    <div class="Para" id="Par29">Having the configuration in place, the next step is to model the Java POJO entity classes and their mapping to the underlying relational data structure.</div>
                                    <div class="Para" id="Par30">There are two approaches to the 
                                        <span id="ITerm16">mapping                            </span>. The first one is to design the object model and then generate the database scripts based on the 
                                        <span id="ITerm17">object model        </span>. For example, for the session factory configuration, you can pass in the Hibernate property 
                                        <span class="EmphasisFontCategoryNonProportional">hibernate.hbm2ddl.auto</span> to have Hibernate automatically export the schema DDL to the database. The second approach is to start with the data model and then model the POJOs with the desired mappings. We prefer the latter approach because we can have more control over the data model, which is useful in optimizing the performance of data access. But the first will be covered later in the chapter to depict a different way of configuring a Spring application with Hibernate. Based on the data model, Figure 
                                        <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html#Fig2">7-2</a></span> shows the corresponding OO model with a class diagram.
                                        <div class="Figure" id="Fig2">
                                            <div class="MediaObject" id="MO2">
                                                <img alt="A315511_5_En_7_Fig2_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Fig2_HTML.jpg" height="329" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Fig2_HTML.jpg" width="686"/>
                                            </div>
                                            <div class="Caption" xml:lang="en">
                                                <div class="CaptionContent">
                                                    <span class="CaptionNumber">Figure 7-2.</span>
                                                    <div class="SimplePara">Class diagram for the sample 
                                                        <span id="ITerm18">data model                                  </span> 
                                                    </div>
                                                </div>
                                            </div>
                                        </div>                                         
                                    </div>
                                    <div class="Para" id="Par31">You can see there is a one-to-many relationship between 
                                        <span class="EmphasisFontCategoryNonProportional">Singer</span> and 
                                        <span class="EmphasisFontCategoryNonProportional">Album</span>, while there’s a many-to-many relationship between the 
                                        <span class="EmphasisFontCategoryNonProportional">Singer</span> and 
                                        <span class="EmphasisFontCategoryNonProportional">Instrument</span> objects.
                                    </div>
                                    <div class="Section2 RenderAsSection2" id="Sec4">
                                        <h3 class="Heading">Simple Mappings</h3>
                                        <div class="Para" id="Par32">First let’s start by mapping the simple 
                                            <span id="ITerm19">attributes                                  </span> of the class. The following code snippet shows the 
                                            <span class="EmphasisFontCategoryNonProportional">Singer</span> class with the mapping annotations:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.entities</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.*</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.io.Serializable</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Date</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.HashSet</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Set</span>;

<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">javax.persistence.GenerationType.IDENTITY</span>;

@<span style="color:#00f;font-weight:700">Entity</span>
@Table(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">singer</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Singer</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Serializable</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Long</span> id;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> firstName;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> lastName;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Date</span> birthDate;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">int</span> version;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setId</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">id</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>id <span style="color:#00f;font-weight:700">=</span> id;
    }

    <span style="color:#00f;font-weight:700">@Id</span>
    <span style="color:#00f;font-weight:700">@GeneratedValue</span>(<span style="color:#c5060b;font-weight:700">strategy</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#c5060b;font-weight:700">IDENTITY</span>)
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">ID</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Long</span> <span style="color:#0000a2;font-weight:700">getId</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>id;
    }

    <span style="color:#00f;font-weight:700">@Version</span>
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">VERSION</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">int</span> <span style="color:#0000a2;font-weight:700">getVersion</span>() {
        <span style="color:#00f;font-weight:700">return</span> version;
    }

    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">FIRST_NAME</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getFirstName</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>firstName;
    }

    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">LAST_NAME</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getLastName</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>lastName;
    }

    <span style="color:#00f;font-weight:700">@Temporal</span>(<span style="color:#00f;font-weight:700">TemporalType</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>DATE</span>)
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">BIRTH_DATE</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Date</span> <span style="color:#0000a2;font-weight:700">getBirthDate</span>() {
        <span style="color:#00f;font-weight:700">return</span> birthDate;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setFirstName</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">firstName</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>firstName <span style="color:#00f;font-weight:700">=</span> firstName;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setLastName</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">lastName</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>lastName <span style="color:#00f;font-weight:700">=</span> lastName;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setBirthDate</span>(<span style="color:#00f;font-weight:700">Date</span> <span style="font-style:italic">birthDate</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>birthDate <span style="color:#00f;font-weight:700">=</span> birthDate;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setVersion</span>(<span style="color:#00f;font-weight:700">int</span> <span style="font-style:italic">version</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>version <span style="color:#00f;font-weight:700">=</span> version;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">toString</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">Singer - Id: </span> <span style="color:#00f;font-weight:700">+</span> id <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">, First name: </span> <span style="color:#00f;font-weight:700">+</span> firstName
                <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">, Last name: </span> <span style="color:#00f;font-weight:700">+</span> lastName <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">, Birthday: </span> <span style="color:#00f;font-weight:700">+</span> birthDate;
    }
}a
</pre>
                                        <div class="Para" id="Par34">First we annotate the type with 
                                            <span class="EmphasisFontCategoryNonProportional">@</span> 
                                            <span id="ITerm22"> <span class="EmphasisFontCategoryNonProportional">Entity</span> </span> 
                                            <span id="ITerm23"> </span> 
                                            <span id="ITerm24"> </span> 
                                            <span id="ITerm25"> </span>, which means that this is a mapped entity class. The 
                                            <span class="EmphasisFontCategoryNonProportional">@Table</span> annotation defines the table name in the database that this entity is being mapped to. For each mapped attribute, you annotate it with the 
                                            <span class="EmphasisFontCategoryNonProportional">@Column</span> annotation, with the column names provided.
                                        </div>
                                        <div class="Para ParaTypeImportant" id="Par35"> 
                                            <img alt="A315511_5_En_7_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Figa_HTML.jpg" width="30"/> Table and column names can be skipped if the type and attribute names are the same as the table and column names.
                                        </div>
                                        <div class="Para" id="Par36">About the mappings, we would like to highlight a few points.
                                            <div class="UnorderedList">
                                                <ul class="UnorderedListMarkBullet">
                                                    <li>
                                                        <div class="Para" id="Par37">For the 
                                                            <span class="EmphasisFontCategoryNonProportional">birthDate</span> attribute, we annotate it with 
                                                            <span class="EmphasisFontCategoryNonProportional">@Temporal</span>, using the 
                                                            <span class="EmphasisFontCategoryNonProportional">TemporalType.DATE</span> value as an argument. This means we would like to map the data type from the Java date type (
                                                            <span class="EmphasisFontCategoryNonProportional">java.util.Date</span>) to the SQL date type (
                                                            <span class="EmphasisFontCategoryNonProportional">java.sql.Date</span>). This allows us to access the attribute 
                                                            <span class="EmphasisFontCategoryNonProportional">birthDate</span> in the 
                                                            <span class="EmphasisFontCategoryNonProportional">Singer</span> object by using 
                                                            <span class="EmphasisFontCategoryNonProportional">java.util.Date</span> as usual in our application.
                                                        </div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par38">For the 
                                                            <span class="EmphasisFontCategoryNonProportional">id</span> attribute, we annotate it with 
                                                            <span class="EmphasisFontCategoryNonProportional">@Id</span>. This means it’s the primary key of the object. Hibernate will use it as the unique identifier when managing the contact entity instances within its session. Additionally, the 
                                                            <span class="EmphasisFontCategoryNonProportional">@GeneratedValue</span> annotation tells Hibernate how the 
                                                            <span class="EmphasisFontCategoryNonProportional">id</span> value was generated. The 
                                                            <span class="EmphasisFontCategoryNonProportional">IDENTITY</span> strategy means that the 
                                                            <span class="EmphasisFontCategoryNonProportional">id</span> value was generated by the back end during insert.
                                                        </div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par39">For the 
                                                            <span class="EmphasisFontCategoryNonProportional">version</span> attribute, we annotate it with 
                                                            <span class="EmphasisFontCategoryNonProportional">@Version</span>. This instructs Hibernate that we would like to use an optimistic locking mechanism, using the 
                                                            <span class="EmphasisFontCategoryNonProportional">version</span> attribute as a control. Every time Hibernate updates a record, it compares the version of the entity instance to that of the record in the database. If both versions are the same, it means that no one updated the data before, and Hibernate will update the data and increment the version column. However, if the version is not the same, it means that someone has updated the record before, and Hibernate will throw a 
                                                            <span class="EmphasisFontCategoryNonProportional">StaleObjectStateException</span> exception, which Spring will translate to 
                                                            <span class="EmphasisFontCategoryNonProportional">HibernateOptimisticLockingFailureException</span>. The example we used an integer for version control. In addition to an integer, Hibernate supports using a timestamp. However, using an integer for version control is recommended since Hibernate will always increment the version number by 1 after each 
                                                            <span id="ITerm26">update                                                    </span>. When using a timestamp, Hibernate will update the latest timestamp after each update. A timestamp is slightly less safe because two concurrent transactions may both load and update the same item in the same millisecond.
                                                        </div>
                                                    </li>
                                                </ul>
                                            </div>                                             
                                        </div>
                                        <div class="Para" id="Par40">Another mapped object is 
                                            <span id="ITerm27"> <span class="EmphasisFontCategoryNonProportional">Album</span> </span>, as shown here:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.entities</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.*</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.io.Serializable</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Date</span>;

<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">javax.persistence.GenerationType.IDENTITY</span>;

@<span style="color:#00f;font-weight:700">Entity</span>
@Table(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">album</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Album</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Serializable</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Long</span> id;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> title;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Date</span> releaseDate;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">int</span> version;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setId</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">id</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>id <span style="color:#00f;font-weight:700">=</span> id;
    }

    <span style="color:#00f;font-weight:700">@Id</span>
    <span style="color:#00f;font-weight:700">@GeneratedValue</span>(<span style="color:#c5060b;font-weight:700">strategy</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#c5060b;font-weight:700">IDENTITY</span>)
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">ID</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Long</span> <span style="color:#0000a2;font-weight:700">getId</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>id;
    }

    <span style="color:#00f;font-weight:700">@Version</span>
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">VERSION</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">int</span> <span style="color:#0000a2;font-weight:700">getVersion</span>() {
        <span style="color:#00f;font-weight:700">return</span> version;
    }

    <span style="color:#00f;font-weight:700">@Column</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getTitle</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>title;
    }

    <span style="color:#00f;font-weight:700">@Temporal</span>(<span style="color:#00f;font-weight:700">TemporalType</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>DATE</span>)
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">RELEASE_DATE</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Date</span> <span style="color:#0000a2;font-weight:700">getReleaseDate</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>releaseDate;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setTitle</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">title</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>title <span style="color:#00f;font-weight:700">=</span> title;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setReleaseDate</span>(<span style="color:#00f;font-weight:700">Date</span> <span style="font-style:italic">releaseDate</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>releaseDate <span style="color:#00f;font-weight:700">=</span> releaseDate;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setVersion</span>(<span style="color:#00f;font-weight:700">int</span> <span style="font-style:italic">version</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>version <span style="color:#00f;font-weight:700">=</span> version;
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">toString</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">Album - Id: </span> <span style="color:#00f;font-weight:700">+</span> id <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">, Title: </span> <span style="color:#00f;font-weight:700">+</span>
                title <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">, Release Date: </span> <span style="color:#00f;font-weight:700">+</span> releaseDate;
    }
}
</pre>
                                        <div class="Para" id="Par42">Here is the third entity class used in the examples for this chapter:</div>
                                        <div class="Para" id="Par43"> 
                                            <div class="ProgramCode" id="PC8">
                                                <div class="LineGroup">
                                                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.entities</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.*</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.io.Serializable</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.HashSet</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Set</span>;

@<span style="color:#00f;font-weight:700">Entity</span>
@Table(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">instrument</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Instrument</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Serializable</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> instrumentId;

    <span style="color:#00f;font-weight:700">@Id</span>
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">INSTRUMENT_ID</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getInstrumentId</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>instrumentId;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setInstrumentId</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">instrumentId</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>instrumentId <span style="color:#00f;font-weight:700">=</span> instrumentId;
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">toString</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">Instrument :</span> <span style="color:#00f;font-weight:700">+</span> getInstrumentId();
    }
}
</pre></div>
                                                </div>
                                            </div>                                             
                                        </div>
                                    </div>
                                    <div class="Section2 RenderAsSection2" id="Sec5">
                                        <h3 class="Heading">One-to-Many Mappings</h3>
                                        <div class="Para" id="Par44">Hibernate has the capability to 
                                            <span id="ITerm30">model                      </span> 
                                            <span id="ITerm31"> </span> many kinds of associations. The most common associations are one-to-many and many-to-many. Each 
                                            <span class="EmphasisFontCategoryNonProportional">Singer</span> will have zero or more albums, so it’s a one-to-many association (in ORM terms, the one-to-many association is used to model both zero-to-many and one-to-many relationships within the data structure). The following code snippet depicts the properties and the methods necessary to define the one-to-many relationship between the 
                                            <span class="EmphasisFontCategoryNonProportional">Singer</span> and 
                                            <span class="EmphasisFontCategoryNonProportional">Album</span> entities:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.entities</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.*</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.io.Serializable</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Date</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.HashSet</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Set</span>;

<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">javax.persistence.GenerationType.IDENTITY</span>;

@<span style="color:#00f;font-weight:700">Entity</span>
@Table(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">singer</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Singer</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Serializable</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Long</span> id;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> firstName;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> lastName;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Date</span> birthDate;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">int</span> version;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Set&lt;<span style="color:#00f;font-weight:700">Album</span>&gt;</span> albums <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HashSet&lt;&gt;</span>();
   .<span style="color:#00f;font-weight:700">.</span>.

    <span style="color:#00f;font-weight:700">@OneToMany</span>(<span style="color:#c5060b;font-weight:700">mappedBy</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">singer</span>, <span style="color:#c5060b;font-weight:700">cascade</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">CascadeType</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>ALL</span>,
            <span style="color:#c5060b;font-weight:700">orphanRemoval</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Set&lt;<span style="color:#00f;font-weight:700">Album</span>&gt;</span> <span style="color:#0000a2;font-weight:700">getAlbums</span>() {
        <span style="color:#00f;font-weight:700">return</span> albums;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">boolean</span> <span style="color:#0000a2;font-weight:700">addAbum</span>(<span style="color:#00f;font-weight:700">Album</span> <span style="font-style:italic">album</span>) {
        album<span style="color:#00f;font-weight:700">.</span>setSinger(<span style="color:#318495">this</span>);
        <span style="color:#00f;font-weight:700">return</span> getAlbums()<span style="color:#00f;font-weight:700">.</span>add(album);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">removeAlbum</span>(<span style="color:#00f;font-weight:700">Album</span> <span style="font-style:italic">album</span>) {
        getAlbums()<span style="color:#00f;font-weight:700">.</span>remove(album);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setAlbums</span>(<span style="color:#00f;font-weight:700">Set&lt;<span style="color:#00f;font-weight:700">Album</span>&gt;</span> <span style="font-style:italic">albums</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>albums <span style="color:#00f;font-weight:700">=</span> albums;
    }
   .<span style="color:#00f;font-weight:700">.</span>.
}</pre>
                                        <div class="Para" id="Par46">The getter method of the attribute 
                                            <span class="EmphasisFontCategoryNonProportional">contactTelDetails</span> is annotated with 
                                            <span class="EmphasisFontCategoryNonProportional">@OneToMany</span>, which indicates the one-to-many relationship with the 
                                            <span class="EmphasisFontCategoryNonProportional">Album</span> class. Several attributes are passed to the annotation. The 
                                            <span class="EmphasisFontCategoryNonProportional">mappedBy</span> attribute indicates the property in the 
                                            <span class="EmphasisFontCategoryNonProportional">Album</span> class that provides the association (that is, linked up by the foreign-key definition in the 
                                            <span class="EmphasisFontCategoryNonProportional">FK_ALBUM_SINGER</span> table). The 
                                            <span class="EmphasisFontCategoryNonProportional">cascade</span> attribute means that the update operation should “cascade” to the child. The 
                                            <span class="EmphasisFontCategoryNonProportional">orphanRemoval</span> attribute means that after the albums have been updated, those entries that no longer exist in the set should be deleted from the 
                                            <span id="ITerm34">database                      </span> 
                                            <span id="ITerm35"> </span>. The following code snippet shows the updated code in the 
                                            <span class="EmphasisFontCategoryNonProportional">Album</span> class for the association mapping:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.entities</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.*</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.io.Serializable</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Date</span>;

<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">javax.persistence.GenerationType.IDENTITY</span>;

@<span style="color:#00f;font-weight:700">Entity</span>
@Table(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">album</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Album</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Serializable</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Long</span> id;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> title;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Date</span> releaseDate;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">int</span> version;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Singer</span> singer;

    <span style="color:#00f;font-weight:700">@ManyToOne</span>
    <span style="color:#00f;font-weight:700">@JoinColumn</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">SINGER_ID</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">getSinger</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>singer;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setSinger</span>(<span style="color:#00f;font-weight:700">Singer</span> <span style="font-style:italic">singer</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>singer <span style="color:#00f;font-weight:700">=</span> singer;
    }
   .<span style="color:#00f;font-weight:700">.</span>.
}
</pre>
                                        <div class="Para" id="Par48">We annotate the getter method of the 
                                            <span class="EmphasisFontCategoryNonProportional">singer</span> 
                                            <span id="ITerm36">attribute                      </span> 
                                            <span id="ITerm37"> </span> with 
                                            <span class="EmphasisFontCategoryNonProportional">@ManyToOne</span>, which indicates it’s the other side of the association from 
                                            <span class="EmphasisFontCategoryNonProportional">Singer</span>. We also specify the 
                                            <span class="EmphasisFontCategoryNonProportional">@JoinColumn</span> annotation for the underlying foreign-key column name. Finally, the 
                                            <span class="EmphasisFontCategoryNonProportional">toString()</span> method is overridden to facilitate testing by printing its output to the console in the example code later.
                                        </div>
                                    </div>
                                    <div class="Section2 RenderAsSection2" id="Sec6">
                                        <h3 class="Heading">Many-to-Many Mappings</h3>
                                        <div class="Para" id="Par49">Every 
                                            <span id="ITerm38">singer                      </span> 
                                            <span id="ITerm39"> </span> can play zero or more instruments, and each instrument is also associated with zero or more singers, which means it’s a many-to-many mapping. A many-to-many mapping requires a join table, which is 
                                            <span class="EmphasisFontCategoryNonProportional">SINGER_INSTRUMENT</span>. The following code sample shows the code that needs to be added to the 
                                            <span class="EmphasisFontCategoryNonProportional">Singer</span> class to implement this relationship:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.entities</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.*</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.io.Serializable</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Date</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.HashSet</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Set</span>;

<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">javax.persistence.GenerationType.IDENTITY</span>;

@<span style="color:#00f;font-weight:700">Entity</span>
@Table(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">singer</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Singer</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Serializable</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Long</span> id;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> firstName;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> lastName;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Date</span> birthDate;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">int</span> version;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Set&lt;<span style="color:#00f;font-weight:700">Instrument</span>&gt;</span> instruments <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HashSet&lt;&gt;</span>();

    <span style="color:#00f;font-weight:700">@ManyToMany</span>
    <span style="color:#00f;font-weight:700">@JoinTable</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">singer_instrument</span>,
            <span style="color:#c5060b;font-weight:700">joinColumns</span> <span style="color:#00f;font-weight:700">=</span> @JoinColumn(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">SINGER_ID</span>),
            <span style="color:#c5060b;font-weight:700">inverseJoinColumns</span> <span style="color:#00f;font-weight:700">=</span> @JoinColumn(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">INSTRUMENT_ID</span>))
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Set&lt;<span style="color:#00f;font-weight:700">Instrument</span>&gt;</span> <span style="color:#0000a2;font-weight:700">getInstruments</span>() {
        <span style="color:#00f;font-weight:700">return</span> instruments;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setInstruments</span>(<span style="color:#00f;font-weight:700">Set&lt;<span style="color:#00f;font-weight:700">Instrument</span>&gt;</span> <span style="font-style:italic">instruments</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>instruments <span style="color:#00f;font-weight:700">=</span> instruments;
    }
   .<span style="color:#00f;font-weight:700">.</span>.
}</pre>
                                        <div class="Para" id="Par51">The getter method of the attribute 
                                            <span class="EmphasisFontCategoryNonProportional">instruments</span> in the 
                                            <span class="EmphasisFontCategoryNonProportional">Singer</span> class is annotated with 
                                            <span class="EmphasisFontCategoryNonProportional">@ManyToMany</span>. We also provide 
                                            <span class="EmphasisFontCategoryNonProportional">@JoinTable</span> to indicate the underlying join table that Hibernate should look for. The name is the join table’s name, 
                                            <span class="EmphasisFontCategoryNonProportional">joinColumns</span> defines the column that is the foreign key to the 
                                            <span class="EmphasisFontCategoryNonProportional">SINGER</span> table, and 
                                            <span class="EmphasisFontCategoryNonProportional">inverseJoinColumns</span> defines the column that is the foreign key to the other side of the association (that is, the 
                                            <span class="EmphasisFontCategoryNonProportional">INSTRUMENT</span> table). The following is the 
                                            <span class="EmphasisFontCategoryNonProportional">Instrument</span> 
                                            <span id="ITerm42">class                      </span> 
                                            <span id="ITerm43"> </span> with the code to implement the other side of this relationship added:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.entities</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.*</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.io.Serializable</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.HashSet</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Set</span>;

@<span style="color:#00f;font-weight:700">Entity</span>
@Table(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">instrument</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Instrument</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Serializable</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> instrumentId;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Set&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> singers <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HashSet&lt;&gt;</span>();

    <span style="color:#00f;font-weight:700">@Id</span>
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">INSTRUMENT_ID</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getInstrumentId</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>instrumentId;
    }

    <span style="color:#00f;font-weight:700">@ManyToMany</span>
    <span style="color:#00f;font-weight:700">@JoinTable</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">singer_instrument</span>,
            <span style="color:#c5060b;font-weight:700">joinColumns</span> <span style="color:#00f;font-weight:700">=</span> @JoinColumn(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">INSTRUMENT_ID</span>),
            <span style="color:#c5060b;font-weight:700">inverseJoinColumns</span> <span style="color:#00f;font-weight:700">=</span> @JoinColumn(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">SINGER_ID</span>))
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Set&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">getSingers</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>singers;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setSingers</span>(<span style="color:#00f;font-weight:700">Set&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="font-style:italic">singers</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>singers <span style="color:#00f;font-weight:700">=</span> singers;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setInstrumentId</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">instrumentId</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>instrumentId <span style="color:#00f;font-weight:700">=</span> instrumentId;
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">toString</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">Instrument :</span> <span style="color:#00f;font-weight:700">+</span> getInstrumentId();
    }
}
</pre>
                                        <div class="Para" id="Par53">The mapping is more or less the 
                                            <span id="ITerm44">same                      </span> 
                                            <span id="ITerm45"> </span> as the one for 
                                            <span class="EmphasisFontCategoryNonProportional">Singer</span>, but the 
                                            <span class="EmphasisFontCategoryNonProportional">joinColumns</span> and 
                                            <span class="EmphasisFontCategoryNonProportional">inverseJoinColumns</span> attributes are reversed to reflect the association.
                                        </div>
                                    </div>
                                </div>
                                <div class="Section1 RenderAsSection1" id="Sec7">
                                    <h2 class="Heading">The Hibernate Session Interface</h2>
                                    <div class="Para" id="Par54">In Hibernate, when interacting with the database, the main interface you need to deal with is the 
                                        <span class="EmphasisFontCategoryNonProportional">Session</span> interface, which is obtained from 
                                        <span class="EmphasisFontCategoryNonProportional">SessionFactory</span>.
                                    </div>
                                    <div class="Para" id="Par55">The following code snippet shows the 
                                        <span class="EmphasisFontCategoryNonProportional">SingerDaoImpl</span> 
                                        <span id="ITerm46">class                            </span> 
                                        <span id="ITerm47"> </span> used in the samples in this chapter and has the configured Hibernate 
                                        <span class="EmphasisFontCategoryNonProportional">SessionFactory</span> injected into the class:
                                    </div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.dao</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.entities.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.apache.commons.logging.Log</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.apache.commons.logging.LogFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.hibernate.SessionFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Repository</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.annotation.Transactional</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.annotation.Resource</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

@<span style="color:#00f;font-weight:700">Transactional</span>
@Repository(<span style="color:#036a07">singerDao</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerDaoImpl</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerDao</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SessionFactory</span> sessionFactory;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">SessionFactory</span> <span style="color:#0000a2;font-weight:700">getSessionFactory</span>() {
        <span style="color:#00f;font-weight:700">return</span> sessionFactory;
    }

    <span style="color:#00f;font-weight:700">@Resource</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">sessionFactory</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setSessionFactory</span>(<span style="color:#00f;font-weight:700">SessionFactory</span> <span style="font-style:italic">sessionFactory</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>sessionFactory <span style="color:#00f;font-weight:700">=</span> sessionFactory;
    }
   .<span style="color:#00f;font-weight:700">.</span>.
}
</pre>
                                    <div class="Para" id="Par57">As usual, we declare the DAO class as a Spring bean by using the 
                                        <span class="EmphasisFontCategoryNonProportional">@Repository</span> annotation. The 
                                        <span class="EmphasisFontCategoryNonProportional">@Transactional</span> annotation defines the transaction requirements that we discuss further in Chapter 
                                        <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html"><span class="RefSource">9</span></a></span>. The 
                                        <span class="EmphasisFontCategoryNonProportional">sessionFactory</span> attribute is injected by using the 
                                        <span id="ITerm48"> <span class="EmphasisFontCategoryNonProportional">@Resource</span> </span> annotation.
                                    </div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.dao</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.entities.Singer</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">SingerDao</span> {
    <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAll</span>();

    <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAllWithAlbum</span>();

    <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">findById</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">id</span>);

    <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">save</span>(<span style="color:#00f;font-weight:700">Singer</span> <span style="font-style:italic">contact</span>);

    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">delete</span>(<span style="color:#00f;font-weight:700">Singer</span> <span style="font-style:italic">contact</span>);
}
</pre>
                                    <div class="Para ParaOneEmphasisChild" id="Par59">The interface is simple; it has just three finder methods, one save method, and one delete method. The 
                                        <span class="EmphasisFontCategoryNonProportional">save()</span> method will perform both the insert and update operations.
                                    </div>
                                    <div class="Section2 RenderAsSection2" id="Sec8">
                                        <h3 class="Heading">Querying Data by Using the Hibernate Query Language</h3>
                                        <div class="Para" id="Par60">Hibernate, together with other ORM tools such as JDO and JPA, is engineered around the object model. So, after the mappings are defined, we don’t need to construct SQL to interact with the database. Instead, for Hibernate, we use the 
                                            <span id="ITerm49">Hibernate Query Language (HQL)          </span> 
                                            <span id="ITerm50"> </span> to define our queries. When interacting with the database, Hibernate will translate the queries into SQL statements on our behalf.
                                        </div>
                                        <div class="Para" id="Par61">When coding HQL queries, the syntax is quite like SQL. However, you need to think on the object side rather than database side. We will take you through several examples in the following sections.</div>
                                    </div>
                                    <div class="Section2 RenderAsSection2" id="Sec9">
                                        <h3 class="Heading">Simple Querying with <span id="ITerm51">Lazy Fetching                                  </span> </h3>
                                        <div class="Para ParaOneEmphasisChild" id="Par62">Let’s begin by implementing the 
                                            <span class="EmphasisFontCategoryNonProportional">findAll()</span> method, which simply retrieves all the contacts from the database. The following code sample shows the updated code for this functionality:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.dao</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.entities.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.apache.commons.logging.Log</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.apache.commons.logging.LogFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.hibernate.SessionFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Repository</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.annotation.Transactional</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.annotation.Resource</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

@<span style="color:#00f;font-weight:700">Transactional</span>
@Repository(<span style="color:#036a07">singerDao</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerDaoImpl</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerDao</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">Log</span> logger <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">LogFactory</span><span style="color:#00f;font-weight:700">.</span>getLog(<span style="color:#00f;font-weight:700">SingerDaoImpl</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SessionFactory</span> sessionFactory;

    <span style="color:#00f;font-weight:700">@Transactional</span>(<span style="color:#c5060b;font-weight:700">readOnly</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAll</span>() {
        <span style="color:#00f;font-weight:700">return</span> sessionFactory<span style="color:#00f;font-weight:700">.</span>getCurrentSession()
                .createQuery(<span style="color:#036a07">from Singer s</span>)<span style="color:#00f;font-weight:700">.</span>list();
    }
   .<span style="color:#00f;font-weight:700">.</span>.
}</pre>
                                        <div class="Para" id="Par64">The method 
                                            <span class="EmphasisFontCategoryNonProportional">SessionFactory.getCurrentSession()</span> gets hold of Hibernate’s 
                                            <span class="EmphasisFontCategoryNonProportional">Session</span> interface. Then, the 
                                            <span class="EmphasisFontCategoryNonProportional">Session.createQuery()</span> 
                                            <span id="ITerm52">method                                  </span> is called, passing in the HQL statement. The statement 
                                            <span class="EmphasisFontCategoryNonProportional">from Singer s</span> simply retrieves all contacts from the database. An alternative syntax for the statement is 
                                            <span class="EmphasisFontCategoryNonProportional">select s from Singer s</span>. The 
                                            <span class="EmphasisFontCategoryNonProportional">@Transactional(readOnly=true)</span> annotation means we want the transaction to be set as read-only. Setting that attribute for read-only methods will result in better performance.
                                        </div>
                                        <div class="Para ParaOneEmphasisChild" id="Par65">The following code snippet shows a simple testing program for 
                                            <span class="EmphasisFontCategoryNonProportional">SingerDaoImpl</span>:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.config.AppConfig</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.dao.SingerDao</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.entities.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.Logger</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.LoggerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.AnnotationConfigApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericApplicationContext</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SpringHibernateDemo</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">SpringHibernateDemo</span><span style="color:#00f;font-weight:700">.</span>class);

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">AppConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">SingerDao</span> singerDao <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">SingerDao</span><span style="color:#00f;font-weight:700">.</span>class);
        singerDao<span style="color:#00f;font-weight:700">.</span>delete(singer);
        listSingers(singerDao<span style="color:#00f;font-weight:700">.</span>findAll());
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">listSingers</span>(<span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="font-style:italic">singers</span>) {
        logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07"> ---- Listing singers:</span>);
        <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">:</span> singers) {
            logger<span style="color:#00f;font-weight:700">.</span>info(singer<span style="color:#00f;font-weight:700">.</span>toString());
        }
    }
}
</pre>
                                        <div class="Para" id="Par67">Running the previous class yields the following output:</div>
                                        <pre style="background:#fff;color:#000">---- Listing singers:
Singer - Id: 1, First name: John, Last name: Mayer, Birthday: 1977-10-16
Singer - Id: 3, First name: John, Last name: Butler, Birthday: 1975-04-01
Singer - Id: 2, First name: Eric, Last name: Clapton, Birthday: 1945-03-30
</pre>
                                        <div class="Para" id="Par69">Although the singer records were retrieved, what about the albums and instruments? Let’s modify the testing class to print the details information. In the following code snippet, you can see the method 
                                            <span class="EmphasisFontCategoryNonProportional">listSingers()</span> being replaced with 
                                            <span class="EmphasisFontCategoryNonProportional">listSingersWithAlbum()</span>:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.config.AppConfig</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.dao.SingerDao</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.entities.Album</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.entities.Instrument</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.entities.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.Logger</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.LoggerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.AnnotationConfigApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericApplicationContext</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SpringHibernateDemo</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">SpringHibernateDemo</span><span style="color:#00f;font-weight:700">.</span>class);

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">AppConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">SingerDao</span> singerDao <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">SingerDao</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">=</span> singerDao<span style="color:#00f;font-weight:700">.</span>findById(<span style="color:#0000cd">2l</span>);
        singerDao<span style="color:#00f;font-weight:700">.</span>delete(singer);
        listSingersWithAlbum(singerDao<span style="color:#00f;font-weight:700">.</span>findAllWithAlbum());
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">listSingersWithAlbum</span>(<span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="font-style:italic">singers</span>) {
        logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07"> ---- Listing singers with instruments:</span>);
        <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">:</span> singers) {
            logger<span style="color:#00f;font-weight:700">.</span>info(singer<span style="color:#00f;font-weight:700">.</span>toString());
            <span style="color:#00f;font-weight:700">if</span> (singer<span style="color:#00f;font-weight:700">.</span>getAlbums() <span style="color:#00f;font-weight:700">!=</span> <span style="color:#585cf6;font-weight:700">null</span>) {
                <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">Album</span> album <span style="color:#00f;font-weight:700">:</span>
                        singer<span style="color:#00f;font-weight:700">.</span>getAlbums()) {
                    logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">&quot;<span style="color:#26b31a">\t</span>&quot;</span> <span style="color:#00f;font-weight:700">+</span> album<span style="color:#00f;font-weight:700">.</span>toString());
                }
            }
            <span style="color:#00f;font-weight:700">if</span> (singer<span style="color:#00f;font-weight:700">.</span>getInstruments() <span style="color:#00f;font-weight:700">!=</span> <span style="color:#585cf6;font-weight:700">null</span>) {
                <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">Instrument</span> instrument <span style="color:#00f;font-weight:700">:</span> singer<span style="color:#00f;font-weight:700">.</span>getInstruments()) {
                    logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">&quot;<span style="color:#26b31a">\t</span>&quot;</span> <span style="color:#00f;font-weight:700">+</span> instrument<span style="color:#00f;font-weight:700">.</span>getInstrumentId());
                }
            }
        }
    }
}
</pre>
                                        <div class="Para" id="Par71">If you run the program again, you will see the following exception:</div>
                                        <pre style="background:#fff;color:#000">---- Listing singers with instruments:
Singer - Id: 1, First name: John, Last name: Mayer, Birthday: 1977-10-16
org.hibernate.LazyInitializationException: failed to lazily initialize a
  collection of role: com.apress.prospring5.ch7.entities.Singer.albums,
  could not initialize proxy - no Session
</pre>
                                        <div class="Para" id="Par73">You will see 
                                            <span id="ITerm55">Hibernate                                  </span> throw the 
                                            <span class="EmphasisFontCategoryNonProportional">LazyInitializationException</span> when you try to access the associations.
                                        </div>
                                        <div class="Para" id="Par74">This is because, by default, Hibernate will fetch the associations 
                                            <span class="EmphasisTypeItalic">lazily</span>, which means that Hibernate will not join the association tables (that is, 
                                            <span class="EmphasisFontCategoryNonProportional">ALBUM</span>) for records. The rationale behind this is for performance; as you can imagine, if a query is retrieving thousands of records and all the associations are retrieved, the massive amount of data transfer will degrade performance.
                                        </div>
                                    </div>
                                    <div class="Section2 RenderAsSection2" id="Sec10">
                                        <h3 class="Heading">Querying with Associations Fetching</h3>
                                        <div class="Para" id="Par75">To have Hibernate fetch the data from 
                                            <span id="ITerm56">associations                                  </span>, there are two options. First, you can define the association with the fetch mode 
                                            <span class="EmphasisFontCategoryNonProportional">EAGER</span>, for example, 
                                            <span class="EmphasisFontCategoryNonProportional">@ManyToMany(fetch=FetchType.EAGER)</span>. This tells Hibernate to fetch the associated records in every query. However, as discussed, this will impact data retrieval performance.
                                        </div>
                                        <div class="Para" id="Par76">The other option is to force Hibernate to fetch the associated records in the query when required. If you use the 
                                            <span class="EmphasisFontCategoryNonProportional">Criteria</span> query, you can call the function 
                                            <span class="EmphasisFontCategoryNonProportional">Criteria.setFetchMode()</span> to instruct Hibernate to eagerly fetch the association. When using 
                                            <span class="EmphasisFontCategoryNonProportional">NamedQuery</span>, you can use the 
                                            <span class="EmphasisFontCategoryNonProportional">fetch</span> operator to instruct Hibernate to fetch the association eagerly.
                                        </div>
                                        <div class="Para" id="Par77">Let’s take a look at the implementation of the 
                                            <span class="EmphasisFontCategoryNonProportional">findAllWithAlbum()</span> method, which will retrieve all contact information together with their telephone details and hobbies. This example will use the 
                                            <span class="EmphasisFontCategoryNonProportional">NamedQuery</span> approach. 
                                            <span class="EmphasisFontCategoryNonProportional">NamedQuery</span> can be externalized into an XML file or declared using an annotation on the entity class. Here you can see the revised 
                                            <span class="EmphasisFontCategoryNonProportional">Singer</span> domain object with the named query defined using annotations:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.entities</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.Entity</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.Table</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.NamedQueries</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.NamedQuery</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.io.Serializable</span>;
.<span style="color:#00f;font-weight:700">.</span>.

@<span style="color:#00f;font-weight:700">Entity</span>
@Table(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">singer</span>)
@NamedQueries({
        @NamedQuery(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">Singer.findAllWithAlbum</span>,
                query <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">select distinct s from Singer s </span> <span style="color:#00f;font-weight:700">+</span>
                        <span style="color:#036a07">left join fetch s.albums a </span> <span style="color:#00f;font-weight:700">+</span>
                        <span style="color:#036a07">left join fetch s.instruments i</span>)
})
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Singer</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Serializable</span> {
   .<span style="color:#00f;font-weight:700">.</span>.
}
</pre>
                                        <div class="Para" id="Par79">First you define a 
                                            <span class="EmphasisFontCategoryNonProportional">NamedQuery</span> instance called 
                                            <span class="EmphasisFontCategoryNonProportional">Singer.findAllWithAlbum</span>. Then we define the query in HQL. Pay attention to the 
                                            <span class="EmphasisFontCategoryNonProportional">left join fetch</span> 
                                            <span id="ITerm57">clause                                  </span>, which instructs Hibernate to fetch the association eagerly. You also need to use 
                                            <span class="EmphasisFontCategoryNonProportional">select distinct</span>; otherwise, Hibernate will return duplicate objects (two singer objects will be returned if a single singer has two albums associated with him).
                                        </div>
                                        <div class="Para ParaOneEmphasisChild" id="Par80">Here is the implementation of the 
                                            <span class="EmphasisFontCategoryNonProportional">findAllWithAlbum()</span> method:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.dao</span>;
.<span style="color:#00f;font-weight:700">.</span>.

@<span style="color:#00f;font-weight:700">Transactional</span>
@Repository(<span style="color:#036a07">singerDao</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerDaoImpl</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerDao</span> {
    <span style="color:#00f;font-weight:700">@Transactional</span>(<span style="color:#c5060b;font-weight:700">readOnly</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAllWithAlbum</span>() {
        <span style="color:#00f;font-weight:700">return</span> sessionFactory<span style="color:#00f;font-weight:700">.</span>getCurrentSession().
                getNamedQuery(<span style="color:#036a07"> Singer.findAllWithAlbum</span>)<span style="color:#00f;font-weight:700">.</span>list();
    }
}
</pre>
                                        <div class="Para" id="Par82">This time we use the 
                                            <span class="EmphasisFontCategoryNonProportional">Session.getNamedQuery()</span> method, passing in the name of the 
                                            <span class="EmphasisFontCategoryNonProportional">NamedQuery</span> instance. Modifying the testing program (
                                            <span class="EmphasisFontCategoryNonProportional">SpringHibernateDemo</span>) to call 
                                            <span class="EmphasisFontCategoryNonProportional">singerDao.findAllWithAlbum()</span> will yield the following output:
                                        </div>
                                        <pre style="background:#fff;color:#000">---- Listing singers with instruments:
Singer - Id: 1, First name: John, Last name: Mayer, Birthday: 1977-10-16
  Album - Id: 2, Singer id: 1, Title: Battle Studies, Release Date: 2009-11-17
  Album - Id: 1, Singer id: 1, Title: The Search For Everything,
     Release Date: 2017-01-20
    Instrument: Guitar
   Instrument: Piano
Singer - Id: 3, First name: John, Last name: Butler, Birthday: 1975-04-01
Singer - Id: 2, First name: Eric, Last name: Clapton, Birthday: 1945-03-30
  Album - Id: 3, Singer id: 2, Title: From The Cradle, Release Date: 1994-09-13
   Instrument: Guitar
</pre>
                                        <div class="Para" id="Par84">Now all the singers with 
                                            <span id="ITerm58">details                                  </span> were retrieved correctly. Let’s see another example with 
                                            <span class="EmphasisFontCategoryNonProportional">NamedQuery</span> with parameters. This time, we will implement the 
                                            <span class="EmphasisFontCategoryNonProportional">findById()</span> method and would like to fetch the associations as well. The following code snippet shows the 
                                            <span class="EmphasisFontCategoryNonProportional">Singer</span> class with the new named query added:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.entities</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.*</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.io.Serializable</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Date</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.HashSet</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Set</span>;

<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">javax.persistence.GenerationType.IDENTITY</span>;

@<span style="color:#00f;font-weight:700">Entity</span>
@Table(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">singer</span>)
@NamedQueries({
        @NamedQuery(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07"> Singer.findById</span>,
                query <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">select distinct s from Singer s </span> <span style="color:#00f;font-weight:700">+</span>
                        <span style="color:#036a07">left join fetch s.albums a </span> <span style="color:#00f;font-weight:700">+</span>
                        <span style="color:#036a07">left join fetch s.instruments i </span> <span style="color:#00f;font-weight:700">+</span>
                        <span style="color:#036a07">where s.id = :id</span>),
        @NamedQuery(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">Singer.findAllWithAlbum</span>,
                query <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">select distinct s from Singer s </span> <span style="color:#00f;font-weight:700">+</span>
                        <span style="color:#036a07">left join fetch s.albums a </span> <span style="color:#00f;font-weight:700">+</span>
                        <span style="color:#036a07">left join fetch s.instruments i</span>)
})
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Singer</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Serializable</span> {
   .<span style="color:#00f;font-weight:700">.</span>.
}
</pre>
                                        <div class="Para" id="Par86">From the named query with the name 
                                            <span class="EmphasisFontCategoryNonProportional">Singer.findById</span>, we declare a named parameter: 
                                            <span class="EmphasisFontCategoryNonProportional">id</span>. Here you can see the implementation of the 
                                            <span class="EmphasisFontCategoryNonProportional">findById()</span> method in 
                                            <span class="EmphasisFontCategoryNonProportional">SingerDaoImpl</span>:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.dao</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.entities.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.apache.commons.logging.Log</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.apache.commons.logging.LogFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.hibernate.SessionFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Repository</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.annotation.Transactional</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.annotation.Resource</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

@<span style="color:#00f;font-weight:700">Transactional</span>
@Repository(<span style="color:#036a07">singerDao</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerDaoImpl</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerDao</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">Log</span> logger <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">LogFactory</span><span style="color:#00f;font-weight:700">.</span>getLog(<span style="color:#00f;font-weight:700">SingerDaoImpl</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SessionFactory</span> sessionFactory;

    <span style="color:#00f;font-weight:700">@Transactional</span>(<span style="color:#c5060b;font-weight:700">readOnly</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">findById</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">id</span>) {
        <span style="color:#00f;font-weight:700">return</span> (<span style="color:#00f;font-weight:700">Singer</span>) sessionFactory<span style="color:#00f;font-weight:700">.</span>getCurrentSession().
                getNamedQuery(<span style="color:#036a07">Singer.findById</span>).
                setParameter(<span style="color:#036a07">id</span>, id)<span style="color:#00f;font-weight:700">.</span>uniqueResult();
    }
   .<span style="color:#00f;font-weight:700">.</span>.
}
</pre>
                                        <div class="Para" id="Par88">In this listing, we use the same 
                                            <span class="EmphasisFontCategoryNonProportional">Session.getNameQuery()</span> method. But then we also call the 
                                            <span class="EmphasisFontCategoryNonProportional">setParameter()</span> method, passing in the named parameter with its value. For multiple parameters, you can use the 
                                            <span class="EmphasisFontCategoryNonProportional">setParameterList()</span> or 
                                            <span class="EmphasisFontCategoryNonProportional">setParameters()</span> method of the 
                                            <span class="EmphasisFontCategoryNonProportional">Query</span> interface.
                                        </div>
                                        <div class="Para ParaOneEmphasisChild" id="Par89">There are also some more advanced query methods, such as native query and criteria query, which we discuss in the next chapter when we talk about JPA. To test the method, the 
                                            <span class="EmphasisFontCategoryNonProportional">SpringHibernateDemo</span> class must be modified accordingly.
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7</span>;
.<span style="color:#00f;font-weight:700">.</span>.

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SpringHibernateDemo</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">SpringHibernateDemo</span><span style="color:#00f;font-weight:700">.</span>class);

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">AppConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">SingerDao</span> singerDao <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">SingerDao</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">=</span> singerDao<span style="color:#00f;font-weight:700">.</span>findById(<span style="color:#0000cd">2l</span>);
        logger<span style="color:#00f;font-weight:700">.</span>info(singer<span style="color:#00f;font-weight:700">.</span>toString());
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                                        <div class="Para" id="Par91">Running the program produces the following output:</div>
                                        <div class="Para" id="Par92"> 
                                            <div class="ProgramCode" id="PC26">
                                                <div class="FixedLine">Singer - Id: 1, First name: John, Last name: Mayer, Birthday: 1977-10-
                                                    <span id="ITerm60">16                                              </span> 
                                                </div>
                                            </div>                                             
                                        </div>
                                    </div>
                                </div>
                                <div class="Section1 RenderAsSection1" id="Sec11">
                                    <h2 class="Heading">Inserting Data</h2>
                                    <div class="Para" id="Par93"> 
                                        <span id="ITerm61">Inserting data                  </span> with Hibernate is simple. One other fancy thing is retrieving the database-generated primary key. In the previous chapter on JDBC, we needed to explicitly declare that we wanted to retrieve the generated key, pass in the 
                                        <span class="EmphasisFontCategoryNonProportional">KeyHolder</span> instance, and get the key back from it after executing the insert statement. With Hibernate, all those actions are not required. Hibernate will retrieve the generated key and populate the domain object after the insert operation. The following code snippet shows the implementation of the 
                                        <span class="EmphasisFontCategoryNonProportional">save()</span> method:
                                    </div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.dao</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.entities.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.apache.commons.logging.Log</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.apache.commons.logging.LogFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.hibernate.SessionFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Repository</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.annotation.Transactional</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.annotation.Resource</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

@<span style="color:#00f;font-weight:700">Transactional</span>
@Repository(<span style="color:#036a07">singerDao</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerDaoImpl</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerDao</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">Log</span> logger <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">LogFactory</span><span style="color:#00f;font-weight:700">.</span>getLog(<span style="color:#00f;font-weight:700">SingerDaoImpl</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SessionFactory</span> sessionFactory;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">save</span>(<span style="color:#00f;font-weight:700">Singer</span> <span style="font-style:italic">singer</span>) {
        sessionFactory<span style="color:#00f;font-weight:700">.</span>getCurrentSession()<span style="color:#00f;font-weight:700">.</span>saveOrUpdate(singer);
        logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">Singer saved with id: </span> <span style="color:#00f;font-weight:700">+</span> singer<span style="color:#00f;font-weight:700">.</span>getId());
        <span style="color:#00f;font-weight:700">return</span> singer;
    }
   .<span style="color:#00f;font-weight:700">.</span>.
}
</pre>
                                    <div class="Para" id="Par95">We just need to invoke the 
                                        <span class="EmphasisFontCategoryNonProportional">Session.saveOrUpdate()</span> 
                                        <span id="ITerm62">method                  </span>, which can be used for both insert and update operations. We also log the ID of the saved singer object that will be populated by Hibernate after the object is persisted. The following code snippet shows the code for inserting a new singer record in the 
                                        <span class="EmphasisFontCategoryNonProportional">SINGER</span> table with two child records in the 
                                        <span class="EmphasisFontCategoryNonProportional">ALBUM</span> table and testing that the insertion succeeded. Also, because now we are modifying the contents of the tables, a JUnit class is more suitable to test each operation in isolation.
                                    </div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.config.AppConfig</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.dao.SingerDao</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.entities.Album</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.entities.Instrument</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.entities.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.After</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Before</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Test</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.Logger</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.LoggerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.AnnotationConfigApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericApplicationContext</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Date</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.GregorianCalendar</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">org.junit.Assert.assertEquals</span>;
<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">org.junit.Assert.assertNotNull</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerDaoTest</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">SingerDaoTest</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SingerDao</span> singerDao;

    <span style="color:#00f;font-weight:700">@Before</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setUp</span>() {
        ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">AppConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        singerDao <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">SingerDao</span><span style="color:#00f;font-weight:700">.</span>class);
        assertNotNull(singerDao);
    }

    <span style="color:#00f;font-weight:700">@Test</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">testInsert</span>() {
        <span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Singer</span>();
        singer<span style="color:#00f;font-weight:700">.</span>setFirstName(<span style="color:#036a07">BB</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setLastName(<span style="color:#036a07">King</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setBirthDate(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Date</span>(
                (<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GregorianCalendar</span>(<span style="color:#0000cd">1940</span>, <span style="color:#0000cd">8</span>, <span style="color:#0000cd">16</span>))<span style="color:#00f;font-weight:700">.</span>getTime()<span style="color:#00f;font-weight:700">.</span>getTime()));
        <span style="color:#00f;font-weight:700">Album</span> album <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Album</span>();
        album<span style="color:#00f;font-weight:700">.</span>setTitle(<span style="color:#036a07">My Kind of Blues</span>);
        album<span style="color:#00f;font-weight:700">.</span>setReleaseDate(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">java.sql<span style="color:#00f;font-weight:700">.</span>Date</span>(
                (<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GregorianCalendar</span>(<span style="color:#0000cd">1961</span>, <span style="color:#0000cd">7</span>, <span style="color:#0000cd">18</span>))<span style="color:#00f;font-weight:700">.</span>getTime()<span style="color:#00f;font-weight:700">.</span>getTime()));
        singer<span style="color:#00f;font-weight:700">.</span>addAbum(album);
        album <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Album</span>();
        album<span style="color:#00f;font-weight:700">.</span>setTitle(<span style="color:#036a07">A Heart Full of Blues</span>);
        album<span style="color:#00f;font-weight:700">.</span>setReleaseDate(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">java.sql<span style="color:#00f;font-weight:700">.</span>Date</span>(
                (<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GregorianCalendar</span>(<span style="color:#0000cd">1962</span>, <span style="color:#0000cd">3</span>, <span style="color:#0000cd">20</span>))<span style="color:#00f;font-weight:700">.</span>getTime()<span style="color:#00f;font-weight:700">.</span>getTime()));
        singer<span style="color:#00f;font-weight:700">.</span>addAbum(album);
        singerDao<span style="color:#00f;font-weight:700">.</span>save(singer);
        assertNotNull(singer<span style="color:#00f;font-weight:700">.</span>getId());
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> singers <span style="color:#00f;font-weight:700">=</span> singerDao<span style="color:#00f;font-weight:700">.</span>findAllWithAlbum();
        assertEquals(<span style="color:#0000cd">4</span>, singers<span style="color:#00f;font-weight:700">.</span>size());
        listSingersWithAlbum(singers);
    }

    <span style="color:#00f;font-weight:700">@Test</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">testFindAll</span>() {
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> singers <span style="color:#00f;font-weight:700">=</span> singerDao<span style="color:#00f;font-weight:700">.</span>findAll();
        assertEquals(<span style="color:#0000cd">3</span>, singers<span style="color:#00f;font-weight:700">.</span>size());
        listSingers(singers);
    }

    <span style="color:#00f;font-weight:700">@Test</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">testFindAllWithAlbum</span>() {
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> singers <span style="color:#00f;font-weight:700">=</span> singerDao<span style="color:#00f;font-weight:700">.</span>findAllWithAlbum();
        assertEquals(<span style="color:#0000cd">3</span>, singers<span style="color:#00f;font-weight:700">.</span>size());
        listSingersWithAlbum(singers);
    }

    <span style="color:#00f;font-weight:700">@Test</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">testFindByID</span>() {
        <span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">=</span> singerDao<span style="color:#00f;font-weight:700">.</span>findById(<span style="color:#0000cd">1L</span>);
        assertNotNull(singer);
        logger<span style="color:#00f;font-weight:700">.</span>info(singer<span style="color:#00f;font-weight:700">.</span>toString());
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">listSingers</span>(<span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="font-style:italic">singers</span>) {
        logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07"> ---- Listing singers:</span>);
        <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">:</span> singers) {
            logger<span style="color:#00f;font-weight:700">.</span>info(singer<span style="color:#00f;font-weight:700">.</span>toString());
        }
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">listSingersWithAlbum</span>(<span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="font-style:italic">singers</span>) {
        logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07"> ---- Listing singers with instruments:</span>);
        <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">:</span> singers) {
            logger<span style="color:#00f;font-weight:700">.</span>info(singer<span style="color:#00f;font-weight:700">.</span>toString());
            <span style="color:#00f;font-weight:700">if</span> (singer<span style="color:#00f;font-weight:700">.</span>getAlbums() <span style="color:#00f;font-weight:700">!=</span> <span style="color:#585cf6;font-weight:700">null</span>) {
                <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">Album</span> album <span style="color:#00f;font-weight:700">:</span>
                        singer<span style="color:#00f;font-weight:700">.</span>getAlbums()) {
                    logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">&quot;<span style="color:#26b31a">\t</span>&quot;</span> <span style="color:#00f;font-weight:700">+</span> album<span style="color:#00f;font-weight:700">.</span>toString());
                }
            }
            <span style="color:#00f;font-weight:700">if</span> (singer<span style="color:#00f;font-weight:700">.</span>getInstruments() <span style="color:#00f;font-weight:700">!=</span> <span style="color:#585cf6;font-weight:700">null</span>) {
                <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">Instrument</span> instrument <span style="color:#00f;font-weight:700">:</span> singer<span style="color:#00f;font-weight:700">.</span>getInstruments()) {
                    logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">&quot;<span style="color:#26b31a">\t</span>Instrument: &quot;</span> <span style="color:#00f;font-weight:700">+</span> instrument<span style="color:#00f;font-weight:700">.</span>getInstrumentId());
                }
            }
        }
    }

    <span style="color:#00f;font-weight:700">@After</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">tearDown</span>() {
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                                    <div class="Para" id="Par97">As shown in the previous code, in the 
                                        <span class="EmphasisFontCategoryNonProportional">testInsert()</span> method, we add two albums, and save the object. Afterward, we list all the singers again by calling 
                                        <span class="EmphasisFontCategoryNonProportional">listSingersWithAlbum</span>. Running the 
                                        <span class="EmphasisFontCategoryNonProportional">testInsert()</span> method yields the following 
                                        <span id="ITerm65">output                  </span>:
                                    </div>
                                    <pre style="background:#fff;color:#000">...
INFO  o.h.d.Dialect - HHH000400:
    Using dialect: org.hibernate.dialect.H2Dialect
INFO  o.h.h.i.QueryTranslatorFactoryInitiator - HHH000397:
    Using ASTQueryTranslatorFactory
Hibernate:
  /* insert com.apress.prospring5.ch7.entities.Singer
    */ insert
    into
     singer
     (ID, BIRTH_DATE, FIRST_NAME, LAST_NAME, VERSION)
    values
     (null, ?, ?, ?, ?)
Hibernate:
  /* insert com.apress.prospring5.ch7.entities.Album
    */ insert
    into
     album
     (ID, RELEASE_DATE, SINGER_ID, title, VERSION)
    values
     (null, ?, ?, ?, ?)
Hibernate:
  /* insert com.apress.prospring5.ch7.entities.Album
    */ insert
    into
     album
     (ID, RELEASE_DATE, SINGER_ID, title, VERSION)
    values
     (null, ?, ?, ?, ?)
INFO   c.a.p.c.d.SingerDaoImpl - Singer saved with id: 4
...
INFO  - ---- Listing singers with instruments:
INFO  - Singer - Id: 4, First name: BB, Last name: King,
   Birthday: 1940-09-16
INFO  -    Album - Id: 5, Singer id: 4, Title: A Heart Full of Blues,
   Release Date: 1962-04-20
INFO  -    Album - Id: 4, Singer id: 4, Title: My Kind of Blues,
   Release Date: 1961-08-18
INFO  - Singer - Id: 1, First name: John, Last name: Mayer,
Birthday: 1977-10-16
INFO  -   Album - Id: 2, Singer id: 1, Title: Battle Studies,
   Release Date: 2009-11-17
INFO  -   Album - Id: 1, Singer id: 1, Title: The Search For Everything,
   Release Date: 2017-01-20
INFO  -   Instrument: Piano
INFO  -   Instrument: Guitar
INFO  - Singer - Id: 3, First name: John, Last name: Butler,
   Birthday: 1975-04-01
INFO  - Singer - Id: 2, First name: Eric, Last name: Clapton,
   Birthday: 1945-03-30
INFO  -   Album - Id: 3, Singer id: 2, Title: From The Cradle,
   Release Date: 1994-09-13
INFO  -   Instrument: Guitar
</pre>
                                    <div class="Para" id="Par99">The logging configuration has been 
                                        <span id="ITerm66">modified                  </span> so that more detailed Hibernate information is printed. From the 
                                        <span class="EmphasisFontCategoryNonProportional">INFO</span> log record, we can see that the ID of the newly saved contact was populated correctly. Hibernate will also show all the SQL statements being executed against the database so you know what is happening behind the scenes.
                                    </div>
                                </div>
                                <div class="Section1 RenderAsSection1" id="Sec12">
                                    <h2 class="Heading">Updating Data</h2>
                                    <div class="Para" id="Par100"> 
                                        <span id="ITerm67">Updating                  </span> a record is as easy as inserting data. Suppose for the singer with an ID of 1 we want to update the first name and remove one album. To test the update operation, the following code snippet shows the 
                                        <span class="EmphasisFontCategoryNonProportional">testUpdate()</span> method:
                                    </div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Test</span>;<span style="color:#00f;font-weight:700">.</span><span style="color:#00f;font-weight:700">.</span>.

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerDaoTest</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SingerDao</span> singerDao;
   .<span style="color:#00f;font-weight:700">.</span>.

    <span style="color:#00f;font-weight:700">@Test</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">testUpdate</span>() {
        <span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">=</span> singerDao<span style="color:#00f;font-weight:700">.</span>findById(<span style="color:#0000cd">1L</span>);
        <span style="color:#06f;font-style:italic">//making sure such singer exists</span>
        assertNotNull(singer);
        <span style="color:#06f;font-style:italic">//making sure we got expected singer</span>
        assertEquals(<span style="color:#036a07">Mayer</span>, singer<span style="color:#00f;font-weight:700">.</span>getLastName());
        <span style="color:#06f;font-style:italic">//retrieve the album</span>
        <span style="color:#00f;font-weight:700">Album</span> album <span style="color:#00f;font-weight:700">=</span> singer<span style="color:#00f;font-weight:700">.</span>getAlbums()<span style="color:#00f;font-weight:700">.</span>stream()<span style="color:#00f;font-weight:700">.</span>filter(
                a <span style="color:#00f;font-weight:700">-</span><span style="color:#00f;font-weight:700">&gt;</span> a<span style="color:#00f;font-weight:700">.</span>getTitle()<span style="color:#00f;font-weight:700">.</span>equals(<span style="color:#036a07">Battle Studies</span>))<span style="color:#00f;font-weight:700">.</span>findFirst()<span style="color:#00f;font-weight:700">.</span>get();
        singer<span style="color:#00f;font-weight:700">.</span>setFirstName(<span style="color:#036a07">John Clayton</span>);
        singer<span style="color:#00f;font-weight:700">.</span>removeAlbum(album);
        singerDao<span style="color:#00f;font-weight:700">.</span>save(singer);
        <span style="color:#06f;font-style:italic">// test the update</span>
        listSingersWithAlbum(singerDao<span style="color:#00f;font-weight:700">.</span>findAllWithAlbum());
    }
   .<span style="color:#00f;font-weight:700">.</span>.
}
</pre>
                                    <div class="Para" id="Par102">As shown in the previous code sample, we first 
                                        <span id="ITerm68">retrieve                  </span> the record with an ID of 1. Afterward, the first name is changed. We then loop through the album objects, retrieve the one with the title 
                                        <span class="EmphasisTypeItalic">Battle Studies</span>, and remove it from the singer’s 
                                        <span class="EmphasisFontCategoryNonProportional">albums</span> property. Finally, we call the 
                                        <span class="EmphasisFontCategoryNonProportional">singerDao.save()</span> method again. When you run the program, you will see the following output:
                                    </div>
                                    <pre style="background:#fff;color:#000">INFO  o.h.h.i.QueryTranslatorFactoryInitiator - HHH000397:
    Using ASTQueryTranslatorFactory
...
INFO - Singer saved with id: 1
Hibernate:
    /* update
       com.apress.prospring5.ch7.entities.Album */ update
          album
       set
          RELEASE_DATE=?,
          SINGER_ID=?,
          title=?,
          VERSION=?
       where
          ID=?
          and VERSION=?
Hibernate:
    /* delete com.apress.prospring5.ch7.entities.Album */ delete
       from
          album
       where
          ID=?
          and VERSION=?
INFO  ----- Listing singers with instruments:
INFO  - Singer - Id: 1, First name: John Clayton, Last name: Mayer,
    Birthday: 1977-10-16
INFO  -     Album - Id: 1, Singer id: 1, Title: The Search For Everything,
    Release Date: 2017-01-20
INFO  -    Instrument: Guitar
INFO  -    Instrument: Piano
INFO  - Singer - Id: 2, First name: Eric, Last name: Clapton,
    Birthday: 1945-03-30
INFO  -    Album - Id: 3, Singer id: 2, Title: From The Cradle,
    Release Date: 1994-09-13
INFO  -    Instrument: Guitar
INFO  - Singer - Id: 3, First name: John, Last name: Butler,
    Birthday: 1975-04-01
</pre>
                                    <div class="Para" id="Par104">You will see the first name is 
                                        <span id="ITerm69">updated                  </span>, and the 
                                        <span class="EmphasisTypeItalic">Battle Studies</span> album is removed. The album can be removed because of the 
                                        <span class="EmphasisFontCategoryNonProportional">orphanRemoval=true</span> attribute we pass into the one-to-many association, which instructs Hibernate to remove all orphan records that exist in the database but are no longer found in the object when persisted.
                                    </div>
                                </div>
                                <div class="Section1 RenderAsSection1" id="Sec13">
                                    <h2 class="Heading">Deleting Data</h2>
                                    <div class="Para" id="Par105"> 
                                        <span id="ITerm70">Deleting data                  </span> is simple as well. Just call the 
                                        <span class="EmphasisFontCategoryNonProportional">Session.delete()</span> method and pass in the contact object. The following code snippet shows the code for deletion:
                                    </div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.dao</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">sun.rmi.runtime.Log</span>;<span style="color:#00f;font-weight:700">.</span><span style="color:#00f;font-weight:700">.</span>.

@<span style="color:#00f;font-weight:700">Transactional</span>
@Repository(<span style="color:#036a07">singerDao</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerDaoImpl</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerDao</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">Log</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LogFactory</span><span style="color:#00f;font-weight:700">.</span>getLog(<span style="color:#00f;font-weight:700">SingerDaoImpl</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SessionFactory</span> sessionFactory;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">delete</span>(<span style="color:#00f;font-weight:700">Singer</span> <span style="font-style:italic">singer</span>) {
        sessionFactory<span style="color:#00f;font-weight:700">.</span>getCurrentSession()<span style="color:#00f;font-weight:700">.</span>delete(singer);
        logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">Singer deleted with id: </span> <span style="color:#00f;font-weight:700">+</span> singer<span style="color:#00f;font-weight:700">.</span>getId());
    }
    .<span style="color:#00f;font-weight:700">.</span>.
}
</pre>
                                    <div class="Para" id="Par107">The delete operation will delete the singer record, together with all its associated information, including albums and instruments, as we defined 
                                        <span class="EmphasisFontCategoryNonProportional">cascade=CascadeType.ALL</span> in the mapping. The following code snippet shows the code for testing the 
                                        <span id="ITerm71">delete                  </span> method, 
                                        <span class="EmphasisFontCategoryNonProportional">testDelete()</span>:
                                    </div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Test</span>;<span style="color:#00f;font-weight:700">.</span><span style="color:#00f;font-weight:700">.</span>.

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerDaoTest</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">SingerDaoTest</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SingerDao</span> singerDao;

    <span style="color:#00f;font-weight:700">@Test</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">testDelete</span>() {
        <span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">=</span> singerDao<span style="color:#00f;font-weight:700">.</span>findById(<span style="color:#0000cd">2l</span>);
        <span style="color:#06f;font-style:italic">//making sure such singer exists</span>
        assertNotNull(singer);
        singerDao<span style="color:#00f;font-weight:700">.</span>delete(singer);
        listSingersWithAlbum(singerDao<span style="color:#00f;font-weight:700">.</span>findAllWithAlbum());
    }
}
</pre>
                                    <div class="Para" id="Par109">The previous listing retrieves the singer with an ID of 2 and then calls the delete method to delete the singer information. Running the program will produce the following output:</div>
                                    <pre style="background:#fff;color:#000">INFO  o.h.h.i.QueryTranslatorFactoryInitiator - HHH000397:
    Using ASTQueryTranslatorFactory
...
INFO c.a.p.c.d.SingerDaoImpl - Singer deleted with id: 2
Hibernate:
    /* delete collection com.apress.prospring5.ch7.entities.
         Singer.instruments */ delete
        from
            singer_instrument
        where
            SINGER_ID=?
Hibernate:
    /* delete com.apress.prospring5.ch7.entities.Album */ delete
        from
            album
        where
            ID=?
            and VERSION=?
Hibernate:
    /* delete com.apress.prospring5.ch7.entities.Singer */ delete
        from
            singer
        where
            ID=?
            and VERSION=?
INFO -  ---- Listing singers with instruments:
INFO - Singer - Id: 1, First name: John, Last name: Mayer,
    Birthday: 1977-10-16
INFO -    Album - Id: 1, Singer id: 1, Title: The Search For Everything,
    Release Date: 2017-01-20
INFO -    Album - Id: 2, Singer id: 1, Title: Battle Studies,
    Release Date: 2009-11-17
INFO -    Instrument: Piano
INFO -    Instrument: Guitar
INFO - Singer - Id: 3, First name: John, Last name: Butler,
    Birthday: 1975-04-01
</pre>
                                    <div class="Para" id="Par111">You can see that the 
                                        <span id="ITerm72">singer                  </span> with an ID of 2 was deleted together with its child records in the 
                                        <span class="EmphasisFontCategoryNonProportional">ALBUM</span> and 
                                        <span class="EmphasisFontCategoryNonProportional">SINGER_INSTRUMENT</span> tables.
                                    </div>
                                </div>
                                <div class="Section1 RenderAsSection1" id="Sec14">
                                    <h2 class="Heading">Configuring Hibernate to Generate Tables from Entities</h2>
                                    <div class="Para" id="Par112">In startup applications using Hibernate, it is common behavior to first write the entity classes and then generate the database tables based on their contents. This is done by using the 
                                        <span class="EmphasisFontCategoryNonProportional">hibernate.hbm2ddl.auto</span> Hibernate property. When the application is started the first time, this property value is set to 
                                        <span class="EmphasisFontCategoryNonProportional">create</span>; this will make Hibernate scan the entities and generate tables and keys (primary, foreign, unique) according to the relationships defined using JPA and Hibernate annotations.
                                    </div>
                                    <div class="Para" id="Par113">If the entities are configured correctly and the resulting database objects are exactly as expected, the value of the property should be changed to 
                                        <span class="EmphasisFontCategoryNonProportional">update</span>. This will tell Hibernate to update the existing database with any changes performed later on 
                                        <span id="ITerm73">entities                            </span> and keep the original database and any data that has been inserted into it.
                                    </div>
                                    <div class="Para" id="Par114">In production applications, it is practical to write unit and integration tests that run on a pseudo-database that is discarded after all test cases are executed. Usually the test database is an in-memory database and Hibernate is told to create the database and discard it after the execution of the tests by setting the 
                                        <span class="EmphasisFontCategoryNonProportional">hibernate.hbm2ddl.auto</span> value to 
                                        <span class="EmphasisFontCategoryNonProportional">create-drop</span>.
                                    </div>
                                    <div class="Para" id="Par115">You can find the full list of values for the 
                                        <span class="EmphasisFontCategoryNonProportional">hibernate.hbm2ddl.auto</span> property in the Hibernate official documentation.
                                        <a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html#Fn1" id="Fn1_source"><sup>1</sup></a> 
                                    </div>
                                    <div class="Para" id="Par117">The following code snippet shows the Java configuration 
                                        <span class="EmphasisFontCategoryNonProportional">AdvancedConfig</span> class. As you can see, 
                                        <span class="EmphasisFontCategoryNonProportional">hibernate.hbm2ddl.auto</span> is introduced, and the 
                                        <span id="ITerm74">data source                            </span> used is a DBCP pooled data source.
                                    </div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.config</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch6.CleanUp</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.apache.commons.dbcp2.BasicDataSource</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.hibernate.SessionFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.Logger</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.LoggerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Value</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Bean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.ComponentScan</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Configuration</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.PropertySource</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.PropertySourcesPlaceholderConfigurer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.jdbc.core.JdbcTemplate</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.orm.hibernate5.HibernateTransactionManager</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.orm.hibernate5.LocalSessionFactoryBuilder</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.PlatformTransactionManager</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.annotation.EnableTransactionManagement</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.sql.DataSource</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.io.IOException</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Properties</span>;

@<span style="color:#00f;font-weight:700">Configuration</span>
@ComponentScan(basePackages <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">com.apress.prospring5.ch7</span>)
@<span style="color:#00f;font-weight:700">EnableTransactionManagement</span>
@PropertySource(<span style="color:#036a07">classpath:db/jdbc.properties</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AdvancedConfig</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">AdvancedConfig</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">@Value</span>(<span style="color:#036a07">${driverClassName}</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> driverClassName;
    <span style="color:#00f;font-weight:700">@Value</span>(<span style="color:#036a07">${url}</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> url;
    <span style="color:#00f;font-weight:700">@Value</span>(<span style="color:#036a07">${username}</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> username;
    <span style="color:#00f;font-weight:700">@Value</span>(<span style="color:#036a07">${password}</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> password;

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">PropertySourcesPlaceholderConfigurer</span>
    propertySourcesPlaceholderConfigurer() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">PropertySourcesPlaceholderConfigurer</span>();
    }

    @Bean(destroyMethod <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">close</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">DataSource</span> dataSource() {
        <span style="color:#00f;font-weight:700">try</span> {
            <span style="color:#00f;font-weight:700">BasicDataSource</span> dataSource <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">BasicDataSource</span>();
            dataSource<span style="color:#00f;font-weight:700">.</span>setDriverClassName(driverClassName);
            dataSource<span style="color:#00f;font-weight:700">.</span>setUrl(url);
            dataSource<span style="color:#00f;font-weight:700">.</span>setUsername(username);
            dataSource<span style="color:#00f;font-weight:700">.</span>setPassword(password);
            <span style="color:#00f;font-weight:700">return</span> dataSource;
        } <span style="color:#00f;font-weight:700">catch</span> (<span style="color:#00f;font-weight:700">Exception</span> e) {
            logger<span style="color:#00f;font-weight:700">.</span>error(<span style="color:#036a07">DBCP DataSource bean cannot be created!</span>, e);
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#585cf6;font-weight:700">null</span>;
        }
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Properties</span> hibernateProperties() {
        <span style="color:#00f;font-weight:700">Properties</span> hibernateProp <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Properties</span>();
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.dialect</span>, <span style="color:#036a07">org.hibernate.dialect.H2Dialect</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07"> hibernate.hbm2ddl.auto</span>, <span style="color:#036a07"> create-drop</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.format_sql</span>, <span style="color:#585cf6;font-weight:700">true</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.use_sql_comments</span>, <span style="color:#585cf6;font-weight:700">true</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.show_sql</span>, <span style="color:#585cf6;font-weight:700">true</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.max_fetch_depth</span>, <span style="color:#0000cd">3</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.jdbc.batch_size</span>, <span style="color:#0000cd">10</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.jdbc.fetch_size</span>, <span style="color:#0000cd">50</span>);
        <span style="color:#00f;font-weight:700">return</span> hibernateProp;
    }

    @<span style="color:#00f;font-weight:700">Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">SessionFactory</span> sessionFactory() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">LocalSessionFactoryBuilder</span>(dataSource())
                .scanPackages(<span style="color:#036a07">com.apress.prospring5.ch7.entities</span>)
                .addProperties(hibernateProperties())
                .buildSessionFactory();
    }

    @<span style="color:#00f;font-weight:700">Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">PlatformTransactionManager</span> transactionManager()
            throws <span style="color:#00f;font-weight:700">IOException</span> {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HibernateTransactionManager</span>(sessionFactory());
    }
}
</pre>
                                    <div class="Para" id="Par119">The 
                                        <span class="EmphasisFontCategoryNonProportional">jdbc.properties</span> file contains the properties necessary to access an 
                                        <span id="ITerm77">in-memory database                            </span>.
                                    </div>
                                    <pre style="background:#fff;color:#000">driverClassName=org.h2.Driver
url=jdbc:h2:musicdb
username=prospring5
password=prospring5
</pre>
                                    <div class="Para" id="Par121">But in this case how do we initially populate the data? You can use a 
                                        <span id="ITerm78"> <span class="EmphasisFontCategoryNonProportional">DatabasePopulator</span> </span> instance, a library like DbUnit,
                                        <a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html#Fn2" id="Fn2_source"><sup>2</sup></a> or a custom populator bean similar to the 
                                        <span class="EmphasisFontCategoryNonProportional">DbIntializer</span> bean, as shown here:
                                    </div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.config</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.dao.InstrumentDao</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.dao.SingerDao</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.entities.Album</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.entities.Instrument</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.entities.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.Logger</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.LoggerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Autowired</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Service</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.annotation.PostConstruct</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Date</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.GregorianCalendar</span>;

@<span style="color:#00f;font-weight:700">Service</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">DBInitializer</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">DBInitializer</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">SingerDao</span> singerDao;
    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">InstrumentDao</span> instrumentDao;

    <span style="color:#00f;font-weight:700">@PostConstruct</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">initDB</span>() {
        logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">Starting database initialization...</span>);
        <span style="color:#00f;font-weight:700">Instrument</span> guitar <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Instrument</span>();
        guitar<span style="color:#00f;font-weight:700">.</span>setInstrumentId(<span style="color:#036a07">Guitar</span>);
        instrumentDao<span style="color:#00f;font-weight:700">.</span>save(guitar);
        .<span style="color:#00f;font-weight:700">.</span>.
        <span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Singer</span>();
        singer<span style="color:#00f;font-weight:700">.</span>setFirstName(<span style="color:#036a07">John</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setLastName(<span style="color:#036a07">Mayer</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setBirthDate(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Date</span>(
                (<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GregorianCalendar</span>(<span style="color:#0000cd">1977</span>, <span style="color:#0000cd">9</span>, <span style="color:#0000cd">16</span>))<span style="color:#00f;font-weight:700">.</span>getTime()<span style="color:#00f;font-weight:700">.</span>getTime()));
        singer<span style="color:#00f;font-weight:700">.</span>addInstrument(guitar);
        singer<span style="color:#00f;font-weight:700">.</span>addInstrument(piano);
        <span style="color:#00f;font-weight:700">Album</span> album1 <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Album</span>();
        album1<span style="color:#00f;font-weight:700">.</span>setTitle(<span style="color:#036a07">The Search For Everything</span>);
        album1<span style="color:#00f;font-weight:700">.</span>setReleaseDate(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">java.sql<span style="color:#00f;font-weight:700">.</span>Date</span>(
                (<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GregorianCalendar</span>(<span style="color:#0000cd">2017</span>, <span style="color:#0000cd">0</span>, <span style="color:#0000cd">20</span>))<span style="color:#00f;font-weight:700">.</span>getTime()<span style="color:#00f;font-weight:700">.</span>getTime()));
        singer<span style="color:#00f;font-weight:700">.</span>addAbum(album1);
        <span style="color:#00f;font-weight:700">Album</span> album2 <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Album</span>();
        album2<span style="color:#00f;font-weight:700">.</span>setTitle(<span style="color:#036a07">Battle Studies</span>);
        album2<span style="color:#00f;font-weight:700">.</span>setReleaseDate(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">java.sql<span style="color:#00f;font-weight:700">.</span>Date</span>(
                (<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GregorianCalendar</span>(<span style="color:#0000cd">2009</span>, <span style="color:#0000cd">10</span>, <span style="color:#0000cd">17</span>))<span style="color:#00f;font-weight:700">.</span>getTime()<span style="color:#00f;font-weight:700">.</span>getTime()));
        singer<span style="color:#00f;font-weight:700">.</span>addAbum(album2);
        singerDao<span style="color:#00f;font-weight:700">.</span>save(singer);
        .<span style="color:#00f;font-weight:700">.</span>.
        logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">Database initialization finished.</span>);
    }
}
</pre>
                                    <div class="Para" id="Par124"> 
                                        <span id="ITerm79"> <span class="EmphasisFontCategoryNonProportional">DbIntializer</span> </span> is just a simple bean, in which the repositories get injected as dependencies and that has an initialization method defined by the annotation 
                                        <span class="EmphasisFontCategoryNonProportional">@PostConstruct</span> in which objects are created and persisted to the database. The bean was annotated with the 
                                        <span class="EmphasisFontCategoryNonProportional">@Service</span> annotation to mark it as a bean providing the service of initializing the contents of a database. This bean will be created when 
                                        <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> is created, and the initialization method will be executed, which will ensure the database will be populated before the context is used.
                                    </div>
                                    <div class="Para ParaOneEmphasisChild" id="Par125">Using the 
                                        <span class="EmphasisFontCategoryNonProportional">AdvancedConfig</span> configuration class, the same sets of tests run previously will pass.
                                    </div>
                                </div>
                                <div class="Section1 RenderAsSection1" id="Sec15">
                                    <h2 class="Heading">Annotating Methods or Fields?</h2>
                                    <div class="Para" id="Par126">In the previous example, the entities had JPA annotations on their getters. But JPA annotations can be used directly on the fields, which has a few advantages.
                                        <div class="UnorderedList">
                                            <ul class="UnorderedListMarkBullet">
                                                <li>
                                                    <div class="Para" id="Par127">Entity 
                                                        <span id="ITerm80">configuration                                              </span> is clearer and located in the fields section, instead of being scattered in the whole class content. This is obviously true only if the code was written following clean code recommendations to keep all field declarations in a class in the same continuous section.
                                                    </div>
                                                </li>
                                                <li>
                                                    <div class="Para ParaOneEmphasisChild" id="Par128">Annotating entity fields does not enforce providing setter/getters. This is useful for the 
                                                        <span class="EmphasisFontCategoryNonProportional">@Version</span> annotated field, which should never be modified manually; only Hibernate should have access to it.
                                                    </div>
                                                </li>
                                                <li>
                                                    <div class="Para" id="Par129">Annotating 
                                                        <span id="ITerm81">fields                              </span> allows to do extra processing in setters (for example, encrypting/calculating the value after loading it from the database). The problem with the property access is that the setters are also called when the object is loaded.
                                                    </div>
                                                </li>
                                            </ul>
                                        </div>                                         
                                    </div>
                                    <div class="Para" id="Par130">There are a lot of discussions on the Internet over which one is better. From a performance point of view, there isn’t any difference. The decision is eventually up to the developer because there might be some valid cases when annotating accessors makes more sense. But keep in mind in the database the state of the objects is actually saved, and the state of the object is defined by the values of its fields, not the values returned by accessors. This also means that an object can be accurately re-created from the database exactly the way it was persisted. So, in a way, setting the annotations on the getters can be seen as breaking encapsulation.</div>
                                    <div class="Para" id="Par131">Here you can see the 
                                        <span class="EmphasisFontCategoryNonProportional">Singer</span> entity class that was rewritten to have annotated fields and that extends the abstract class 
                                        <span id="ITerm82"> <span class="EmphasisFontCategoryNonProportional">AbstractEntity</span> </span>, which contains the two fields common to all Hibernate entity classes in an application:
                                    </div>
                                    <div class="Para" id="Par132"> 
                                        <div class="ProgramCode" id="PC38">
                                            <div class="LineGroup">
                                                <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#06f;font-style:italic">// AbstractEntity.java</span>
<span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch7.entities</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.*</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.io.Serializable</span>;

@<span style="color:#00f;font-weight:700">MappedSuperclass</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">abstract</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AbstractEntity</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Serializable</span> {
    <span style="color:#00f;font-weight:700">@Id</span>
    <span style="color:#00f;font-weight:700">@GeneratedValue</span>(<span style="color:#c5060b;font-weight:700">strategy</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">GenerationType</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>AUTO</span>)
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">updatable</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">false</span>)
    <span style="color:#00f;font-weight:700">protected</span> <span style="color:#00f;font-weight:700">Long</span> id;
    <span style="color:#00f;font-weight:700">@Version</span>
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">VERSION</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">int</span> version;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Long</span> <span style="color:#0000a2;font-weight:700">getId</span>() {
        <span style="color:#00f;font-weight:700">return</span> id;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setId</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">id</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>id <span style="color:#00f;font-weight:700">=</span> id;
    }
}

<span style="color:#06f;font-style:italic">//Singer.java</span>
@<span style="color:#00f;font-weight:700">Entity</span>
@Table(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">singer</span>)
@NamedQueries({
        @NamedQuery(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">Singer</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>FIND_SINGER_BY_ID</span>,
                query <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">select distinct s from Singer s </span> <span style="color:#00f;font-weight:700">+</span>
                        <span style="color:#036a07">left join fetch s.albums a </span> <span style="color:#00f;font-weight:700">+</span>
                        <span style="color:#036a07">left join fetch s.instruments i </span> <span style="color:#00f;font-weight:700">+</span>
                        <span style="color:#036a07">where s.id = :id</span>),
        @NamedQuery(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">Singer</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>FIND_ALL_WITH_ALBUM</span>,
                query <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">select distinct s from Singer s </span> <span style="color:#00f;font-weight:700">+</span>
                        <span style="color:#036a07">left join fetch s.albums a </span> <span style="color:#00f;font-weight:700">+</span>
                        <span style="color:#036a07">left join fetch s.instruments i</span>)
})
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Singer</span> <span style="color:#00f;font-weight:700">extends</span> <span style="font-style:italic">AbstractEntity</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#c5060b;font-weight:700">FIND_SINGER_BY_ID</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">Singer.findById</span>;
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#c5060b;font-weight:700">FIND_ALL_WITH_ALBUM</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">Singer.findAllWithAlbum</span>;
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">FIRST_NAME</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> firstName;
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">LAST_NAME</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> lastName;
    <span style="color:#00f;font-weight:700">@Temporal</span>(<span style="color:#00f;font-weight:700">TemporalType</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>DATE</span>)
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">BIRTH_DATE</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Date</span> birthDate;
    <span style="color:#00f;font-weight:700">@OneToMany</span>(<span style="color:#c5060b;font-weight:700">mappedBy</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">singer</span>, <span style="color:#c5060b;font-weight:700">cascade</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">CascadeType</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>ALL</span>,
            <span style="color:#c5060b;font-weight:700">orphanRemoval</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Set&lt;<span style="color:#00f;font-weight:700">Album</span>&gt;</span> albums <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HashSet&lt;&gt;</span>();
    <span style="color:#00f;font-weight:700">@ManyToMany</span>
    <span style="color:#00f;font-weight:700">@JoinTable</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">singer_instrument</span>,
            <span style="color:#c5060b;font-weight:700">joinColumns</span> <span style="color:#00f;font-weight:700">=</span> @JoinColumn(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">SINGER_ID</span>),
            <span style="color:#c5060b;font-weight:700">inverseJoinColumns</span> <span style="color:#00f;font-weight:700">=</span> @JoinColumn(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">INSTRUMENT_ID</span>))
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Set&lt;<span style="color:#00f;font-weight:700">Instrument</span>&gt;</span> instruments <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HashSet&lt;&gt;</span>();
    .<span style="color:#00f;font-weight:700">.</span>.
}
</pre></div>
                                            </div>
                                        </div>                                         
                                    </div>
                                </div>
                                <div class="Section1 RenderAsSection1" id="Sec16">
                                    <h2 class="Heading">Considerations When Using Hibernate</h2>
                                    <div class="Para" id="Par133">As shown in the examples of this chapter, once all the object-to-relational mapping, associations, and queries are properly defined, Hibernate can provide an environment for you to focus on programming with the object model, rather than composing SQL statements for each operation. In the past few years, Hibernate has been evolving quickly and has been widely adopted by Java developers as the data access layer library, both in the open source community and in enterprises.</div>
                                    <div class="Para" id="Par134">However, there are some points you need to bear in mind. First, because you don’t have control over the generated SQL, you should be careful when defining the mappings, especially the associations and their fetching strategy. Second, you should observe the SQL statements generated by Hibernate to verify that all perform as you expect.</div>
                                    <div class="Para" id="Par135">Understanding the 
                                        <span id="ITerm85">internal mechanism                  </span> of how Hibernate manages its session is also important, especially in batch job operations. Hibernate will keep the managed objects in session and will flush and clear them regularly. Poorly designed data access logic may cause Hibernate to flush the session too frequently and greatly impact the performance. If you want absolute control over the query, you can use a native query, which we discuss in the next chapter.
                                    </div>
                                    <div class="Para" id="Par136">Finally, the settings (batch size, fetch size, and so forth) play an important role in tuning Hibernate’s performance. You should define them in your session factory and adjust them while load testing your application to identify the optimal value.</div>
                                    <div class="Para" id="Par137">After all, Hibernate, and its excellent JPA support that we discuss in the next chapter, is a natural decision for Java developers looking for an OO way to implement data access logic.</div>
                                </div>
                                <div class="Section1 RenderAsSection1" id="Sec17">
                                    <h2 class="Heading">Summary</h2>
                                    <div class="Para" id="Par138">In this chapter, we discussed the basic concepts of Hibernate and how to configure it within a Spring application. Then we covered common techniques for defining ORM mappings, and we covered associations and how to use the 
                                        <span class="EmphasisFontCategoryNonProportional">HibernateTemplate</span> class to perform various database operations. With regard to Hibernate, we covered only a small piece of its functionality and features. For those interested in using Hibernate with Spring, we highly recommend you study Hibernate’s standard documentation. Also, numerous books discuss Hibernate in detail. We recommend 
                                        <span class="EmphasisTypeItalic">Beginning Hibernate: For Hibernate 5</span> by Joseph Ottinger, Jeff Linwood, and Dave Minter (Apress, 2016),
                                        <a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html#Fn3" id="Fn3_source"><sup>3</sup></a> as well as 
                                        <span class="EmphasisTypeItalic">Pro JPA 2</span> by Mike Keith and Merrick Schincariol (Apress, 2013).
                                        <a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html#Fn4" id="Fn4_source"><sup>4</sup></a> In the next chapter, you will take a look at JPA and how to use it when using Spring. Hibernate provides excellent support for JPA, and we will continue to use Hibernate as the persistence provider for the examples in the next chapter. For query and update operations, JPA act likes Hibernate. In the next chapter, we discuss advanced topics including native and criteria query and how we can use Hibernate as well as its JPA support.
                                    </div>
                                </div>
                                <div class="FootnoteSection">
                                    <div class="Heading">Footnotes</div>
                                    <div class="Footnote" id="Fn1">
                                        <span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html#Fn1_source">1</a></span>
                                        <div class="FootnoteParas">
                                            <div class="Para" id="Par116">See Table 3.7 at 
                                                <span class="ExternalRef"><a href="https://docs.jboss.org/hibernate/orm/5.0/manual/en-US/html/ch03.html"><span class="RefSource"> <span class="EmphasisFontCategoryNonProportional">https://docs.jboss.org/hibernate/orm/5.0/manual/en-US/html/ch03.html</span> </span></a></span>.
                                            </div>
                                        </div>
                                        <div class="ClearBoth"> </div>
                                    </div>
                                    <div class="Footnote" id="Fn2">
                                        <span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html#Fn2_source">2</a></span>
                                        <div class="FootnoteParas">
                                            <div class="Para" id="Par122">We will find the official DbUnit site at 
                                                <span class="ExternalRef"><a href="http://dbunit.sourceforge.net/"><span class="RefSource"> <span class="EmphasisFontCategoryNonProportional">http://dbunit.sourceforge.net/</span> </span></a></span>.
                                            </div>
                                        </div>
                                        <div class="ClearBoth"> </div>
                                    </div>
                                    <div class="Footnote" id="Fn3">
                                        <span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html#Fn3_source">3</a></span>
                                        <div class="FootnoteParas">
                                            <div class="Para" id="Par139">Download the e-book from the Apress official site: 
                                                <span class="ExternalRef"><a href="http://apress.com/us/book/9781484223185"><span class="RefSource"> <span class="EmphasisFontCategoryNonProportional">http://apress.com/us/book/9781484223185</span> </span></a></span>.
                                            </div>
                                        </div>
                                        <div class="ClearBoth"> </div>
                                    </div>
                                    <div class="Footnote" id="Fn4">
                                        <span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html#Fn4_source">4</a></span>
                                        <div class="FootnoteParas">
                                            <div class="Para" id="Par140">Download the e-book from the Apress official site: 
                                                <span class="ExternalRef"><a href="http://apress.com/us/book/9781430249269"><span class="RefSource"> <span class="EmphasisFontCategoryNonProportional">http://apress.com/us/book/9781430249269</span> </span></a></span>.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="annotator-outer annotator-viewer viewer annotator-hide"> 
                                <ul class="annotator-widget annotator-listing"></ul>
                            </div>
                            <div class="annotator-modal-wrapper annotator-editor-modal annotator-editor annotator-hide"> 
                                <div class="annotator-outer editor"> 
                                    <h2 class="title">Highlight</h2> 
                                    <form class="annotator-widget"> 
                                        <ul class="annotator-listing"> 
                                            <li class="annotator-item">
                                                <textarea class="js-editor" id="annotator-field-0" maxlength="750" placeholder="Add a note using markdown (optional)"></textarea>
                                            </li>
                                        </ul>                                         

                                        <div class="annotator-controls"> 
                                            <a class="link-to-markdown" href="https://daringfireball.net/projects/markdown/basics" target="_blank">?</a> 
                                            <ul> 
                                                <li class="delete annotator-hide">
                                                    <a class="annotator-delete-note button positive" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html#delete">Delete Note</a>
                                                </li>                                                 

                                                <li class="save">
                                                    <a class="annotator-save annotator-focus button positive" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html#save">Save Note</a>
                                                </li>                                                 

                                                <li class="cancel">
                                                    <a class="annotator-cancel button" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html#cancel">Cancel</a>
                                                </li>                                                 
                                            </ul>                                             
                                        </div>                                         
                                    </form>                                     
                                </div>
                            </div>
                            <div class="annotator-modal-wrapper annotator-delete-confirm-modal" style="display: none;"> 
                                <div class="annotator-outer"> 
                                    <h2 class="title">Highlight</h2> 
                                    <a class="js-close-delete-confirm annotator-cancel close" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html#close">Close</a> 
                                    <div class="annotator-widget"> 
                                        <div class="delete-confirm">            Are you sure you want to permanently delete this note?         </div>                                         

                                        <div class="annotator-controls"> 
                                            <a class="annotator-cancel button js-cancel-delete-confirm" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html#cancel">No, I changed my mind</a> 
                                            <a class="annotator-delete button positive js-delete-confirm" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html#delete">Yes, delete it</a> 
                                        </div>                                         
                                    </div>                                     
                                </div>
                            </div>
                            <div class="annotator-adder" style="display: none;"> 
                                <ul class="adders"> 
                                    <li class="copy">
                                        <a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html#">Copy</a>
                                    </li>                                     

                                    <li class="add-highlight">
                                        <a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html#">Add Highlight</a>
                                    </li>                                     

                                    <li class="add-note">
                                        <a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html#">			Add Note		</a>
                                    </li>                                     
                                </ul>
                            </div>
                        </div>
                    </div>                     

                    <div class="t-sbo-prev sbo-prev sbo-nav-bottom"> 
                        <a class="prev nav-link" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_6_Chapter.html"> 
                            <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span> 
                            <span class="visuallyhidden">Previous Chapter</span> 
                            <div class="pagination-title t-prev-title">6. Spring JDBC Support</div>                             
                        </a>                         
                    </div>                     

                    <div class="t-sbo-next sbo-next sbo-nav-bottom"> 
                        <a class="next nav-link" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Chapter.html"> 
                            <span aria-hidden="true" class="pagination-label t-next-label">Next</span> 
                            <span class="visuallyhidden">Next Chapter</span> 
                            <div class="pagination-title t-next-title">8. Data Access in Spring with JPA2</div>                             
                        </a>                         
                    </div>                     
                </section>                 
            </div>
            <section class="sbo-saved-archives"></section>             
        </div>                  

        <div id="batBeacon0.10470653245404127" style="width:0px; height:0px; display:none; visibility:hidden;">
            <img alt="" height="0" id="batBeacon0.18895955618729587" src="https://bat.bing.com/action/0?ti=5794699&amp;Ver=2&amp;mid=27e9b5f4-cbdd-e2ff-05fc-2af19b1c8f9a&amp;pi=1200101525&amp;lg=zh-CN&amp;sw=1366&amp;sh=768&amp;sc=24&amp;tl=7.%20Using%20Hibernate%20in%20Spring%20-%20Pro%20Spring%205%3A%20An%20In-Depth%20Guide%20to%20the%20Spring%20Framework%20and%20Its%20Tools&amp;p=https%3A%2F%2Flearning.oreilly.com%2Flibrary%2Fview%2Fpro-spring-5%2F9781484228081%2FA315511_5_En_7_Chapter.html&amp;r=&amp;evt=pageLoad&amp;msclkid=N&amp;rn=413357" style="width:0px; height:0px; display:none; visibility:hidden;" width="0"/>
        </div>         

        <div class="annotator-notice"></div>
        <div class="font-flyout" style="top: 201.037px; left: 1280px;">
            <div class="font-controls-panel"> 
                <div class="nightmodes"> 
                    <ul> 
                        <li class="day">
                            <a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html#" id="day-mode" title="Day Mode"> <i class="fa fa-sun-o"></i> <span>Day Mode</span></a>
                        </li>                         

                        <li class="cloudy">
                            <a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html#" id="cloudy-mode" title="Cloudy Mode"> <i class="fa fa-cloud"></i> <span>Cloud Mode</span> </a>
                        </li>                         

                        <li class="night">
                            <a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html#" id="night-mode" title="Night Mode"> <i class="fa fa-moon-o"></i> <span>Night Mode</span> </a>
                        </li>                         
                    </ul>                     
                </div>                 

                <div class="font-resizer resizer"> 
                    <div class="draggable-containment-wrapper"> 
                        <i class="fa fa-font left"></i> 
                        <span class="filler" style="width: 50%;"></span> 
                        <div class="draggable ui-widget-content ui-draggable ui-draggable-handle" id="js-font-size-draggable" style="position: relative; left: 80px;"></div>                         

                        <i class="fa fa-font right"></i> 
                    </div>                     
                </div>                 

                <div class="column-resizer resizer"> 
                    <div class="draggable-containment-wrapper"> 
                        <i class="fa fa-compress left"></i> 
                        <span class="filler" style="width: 50%;"></span> 
                        <div class="draggable ui-widget-content ui-draggable ui-draggable-handle" id="js-column-size-draggable" style="position: relative; left: 80px;"></div>                         

                        <i class="fa fa-expand right"></i> 
                    </div>                     
                </div>                 

                <a class="button" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html#" id="reset">Reset</a>
            </div>
        </div>
        <iframe src="cid:frame-7C48B76240097F126938F8BC9681158F@mhtml.blink" style="display: none;"></iframe>
        <span><div id="KampyleAnimationContainer" style="z-index: 2147483000; border: 0px; position: fixed; display: block; width: 0px; height: 0px;"></div></span>
        <div style="display: none; visibility: hidden;"></div>
        <iframe allowtransparency="true" frameborder="0" scrolling="no" src="cid:frame-6C92FDCB179B855675D5715AC89DB6E5@mhtml.blink" style="display: none;" title="Twitter settings iframe"></iframe>
    

<hr/>
<!--if IE]><![endif]-->

<!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"            itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"data-offline-url="/"data-url="/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Chapter.html"data-csrf-cookie="csrfsafari"data-highlight-privacy=""  data-user-id="3866890"  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"  data-username="levinxccai"  data-account-type="B2B"    data-activated-trial-date="11/06/2017"  data-archive="9781484228081"  data-publishers="Apress"  data-htmlfile-name="A315511_5_En_8_Chapter.html"  data-epub-title="Pro Spring 5: An In-Depth Guide to the Spring Framework and Its Tools" data-debug=0 data-testing=0><![endif]-->
<!--if gt IE 8]><!-->

    <!--![endif]-->
    
    
<a name="9_"></a>

        <div class="application" id="container" style="height: auto;">
          <div class="js-toc">
            <div id="sbo-rt-content" style="max-width:72.5em; transform: none;">
              <div class="annotator-wrapper">
                            <div class="ChapterContextInformation">
                                <div class="ContextInformation" id="b978-1-4842-2808-1_8">
                                    <div class="ChapterCopyright">© Iuliana Cosmina, Rob Harrop, Chris Schaefer, and Clarence Ho 2017</div>
                                    <span class="ContextInformationAuthorEditorNames"><span class="Author"><span class="AuthorName">Iuliana Cosmina</span>, </span><span class="Author"><span class="AuthorName">Rob Harrop</span>, </span><span class="Author"><span class="AuthorName">Chris Schaefer</span> and </span><span class="Author"><span class="AuthorName">Clarence Ho</span></span></span>
                                    <span class="ContextInformationBookTitles"><span class="BookTitle" xml:lang="en">Pro Spring 5</span></span>
                                    <span class="ChapterDOI"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Chapter.html">https://doi.org/10.1007/978-1-4842-2808-1_8</a></span>
                                </div>
                            </div>
                            <!--egin Abstract-->
                            <div class="MainTitleSection">
                                <h1 class="ChapterTitle" xml:lang="en">8. Data Access in Spring with JPA2</h1>
                            </div>
                            <div class="AuthorGroup">
                                <div class="AuthorNames">
                                    <span class="Author"><span class="AuthorName">Iuliana Cosmina</span><sup>1 <span class="ContactIcon"></span></sup>, </span>
                                    <span class="Author"><span class="AuthorName">Rob Harrop</span><sup>2</sup>, </span>
                                    <span class="Author"><span class="AuthorName">Chris Schaefer</span><sup>3</sup> and </span>
                                    <span class="Author"><span class="AuthorName">Clarence Ho</span><sup>4</sup></span>
                                </div>
                                <div class="Affiliations">
                                    <div class="Affiliation" id="Aff5">
                                        <span class="AffiliationNumber">(1)</span>
                                        <div class="AffiliationText">Sibiu, Sibiu, Romania</div>
                                    </div>
                                    <div class="Affiliation" id="Aff6">
                                        <span class="AffiliationNumber">(2)</span>
                                        <div class="AffiliationText">Reddish, UK</div>
                                    </div>
                                    <div class="Affiliation" id="Aff7">
                                        <span class="AffiliationNumber">(3)</span>
                                        <div class="AffiliationText">Venice, Florida, USA</div>
                                    </div>
                                    <div class="Affiliation" id="Aff8">
                                        <span class="AffiliationNumber">(4)</span>
                                        <div class="AffiliationText">Hong Kong, China</div>
                                    </div>
                                    <div class="ClearBoth"> </div>
                                </div>
                            </div>
                            <!--nd Abstract-->
                            <div class="Fulltext">
                                <div class="Para" id="Par1">In the previous chapter, we discussed how to use Hibernate with Spring when implementing data access logic with the ORM approach. We demonstrated how to configure Hibernate’s 
                                    <span class="EmphasisFontCategoryNonProportional">SessionFactory</span> in Spring’s configuration and how to use the 
                                    <span class="EmphasisFontCategoryNonProportional">Session</span> interface for various data access operations. However, that is just one way Hibernate can be used. Another way of adopting Hibernate in a Spring application is to use Hibernate as a persistence provider of the standard Java Persistence API (JPA).
                                </div>
                                <div class="Para" id="Par2">Hibernate’s POJO mapping and its powerful query language (HQL) have gained great success and also influenced the development of data access technology standards in the Java world. After Hibernate, the JCP developed the Java Data Objects (JDO) standard and then JPA.</div>
                                <div class="Para" id="Par3">At the time of this writing, JPA has reached version 2.1 and provides concepts that were standardized such as 
                                    <span class="EmphasisFontCategoryNonProportional">PersistenceContext</span>, 
                                    <span class="EmphasisFontCategoryNonProportional">EntityManager</span>, and the Java Persistence Query Language (JPQL). These standardizations provide a way for developers to switch between JPA persistence providers such as Hibernate, EclipseLink, Oracle TopLink, and Apache OpenJPA. As a result, most new JEE applications are adopting JPA as the data access layer.
                                </div>
                                <div class="Para ParaOneEmphasisChild" id="Par4">Spring also provides excellent support for JPA. For example, a number of 
                                    <span class="EmphasisFontCategoryNonProportional">EntityManagerFactoryBean</span> implementations are provided for bootstrapping a JPA entity manager with support for all of the JPA providers mentioned earlier. The Spring Data project also provides a subproject called Spring Data JPA, which provides advanced support for using JPA in Spring applications. The main features of the Spring Data JPA project include concepts of a repository and specification and support for the Query Domain-Specific Language (QueryDSL).
                                </div>
                                <div class="Para ParaOneEmphasisChild" id="Par5">This chapter covers how to use JPA 2.1 with Spring, using Hibernate as the underlying persistence provider. You will learn how to implement various database operations by using JPA’s 
                                    <span class="EmphasisFontCategoryNonProportional">EntityManager</span> interface and JPQL. Then you will see how Spring Data JPA can further help simplify JPA development. Finally, we present advanced topics related to ORM, including native queries and criteria queries.
                                </div>
                                <div class="Para" id="Par6">Specifically, we discuss the following topics:
                                    <div class="UnorderedList">
                                        <ul class="UnorderedListMarkBullet">
                                            <li>
                                                <div class="Para ParaOneEmphasisChild" id="Par7"> 
                                                    <span class="EmphasisTypeItalic">Core concepts of Java Persistence API (JPA)</span>: We cover some of the major concepts of JPA.
                                                </div>
                                            </li>
                                            <li>
                                                <div class="Para" id="Par8"> 
                                                    <span class="EmphasisTypeItalic">Configuring the JPA entity manager</span>: We discuss the types of 
                                                    <span class="EmphasisFontCategoryNonProportional">EntityManagerFactory</span> that Spring supports and how to configure the most commonly used one, 
                                                    <span class="EmphasisFontCategoryNonProportional">LocalContainerEntityManagerFactoryBean</span>, in Spring’s XML configuration.
                                                </div>
                                            </li>
                                            <li>
                                                <div class="Para ParaOneEmphasisChild" id="Par9"> 
                                                    <span class="EmphasisTypeItalic">Data operations</span>: We show how to implement basic database operations in JPA, which is much like the concepts when using Hibernate on its own.
                                                </div>
                                            </li>
                                            <li>
                                                <div class="Para ParaOneEmphasisChild" id="Par10"> 
                                                    <span class="EmphasisTypeItalic">Advanced query operations</span>: We discuss how to use native queries in JPA and the strongly typed criteria API in JPA for more flexible query operations.
                                                </div>
                                            </li>
                                            <li>
                                                <div class="Para ParaOneEmphasisChild" id="Par11"> 
                                                    <span class="EmphasisTypeItalic">Introducing Spring Data Java Persistence API (JPA)</span>: We discuss the Spring Data JPA project and demonstrate how it can help simplify the development of data access logic.
                                                </div>
                                            </li>
                                            <li>
                                                <div class="Para ParaOneEmphasisChild" id="Par12"> 
                                                    <span class="EmphasisTypeItalic">Tracking entity changes and auditing</span>: In database update operations, it’s a common requirement to keep track of the date an entity was created or last updated and who made the change. Also, for critical information such as a customer, a history table that stores each version of the entity is usually required. We discuss how Spring DataJPA and Hibernate Envers (Hibernate Entity Versioning System) can help ease the development of such logic.
                                                </div>
                                            </li>
                                        </ul>
                                    </div>                                     
                                </div>
                                <div class="Para ParaTypeImportant" id="Par13">
                                    <img alt="A315511_5_En_8_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Figa_HTML.jpg" width="30"/> Like Hibernate, JPA supports the definition of mappings either in XML or in Java annotations. This chapter focuses on the annotation type of mapping because its usage tends to be much more popular than the XML style.
                                </div>
                                <div class="Section1 RenderAsSection1" id="Sec1">
                                    <h2 class="Heading">Introducing JPA 2.1</h2>
                                    <div class="Para" id="Par14">Like other Java specification requests (JSRs), the objective of the JPA 2.1 specification (JSR-338) is to standardize the ORM programming model in both the JSE and JEE environments. It defines a common set of concepts, annotations, interfaces, and other services that a JPA persistence provider should implement. When programming to the JPA standard, developers have the option of switching the underlying provider at will, just like switching to another JEE-compliant application server for applications developed on the JEE standards.</div>
                                    <div class="Para" id="Par15">Within JPA, the core concept is the 
                                        <span class="EmphasisFontCategoryNonProportional">EntityManager</span> 
                                        <span id="ITerm1">interface                  </span>, which comes from factories of the type 
                                        <span class="EmphasisFontCategoryNonProportional">EntityManagerFactory</span>. The main job of 
                                        <span class="EmphasisFontCategoryNonProportional">EntityManager</span> is to maintain a persistence context, in which all the entity instances managed by it will be stored. The configuration of 
                                        <span class="EmphasisFontCategoryNonProportional">EntityManager</span> is defined as a persistence unit, and there can be more than one persistence unit in an application. If you are using Hibernate, you can think of the persistence context in the same way as the 
                                        <span class="EmphasisFontCategoryNonProportional">Session</span> interface, while 
                                        <span class="EmphasisFontCategoryNonProportional">EntityManagerFactory</span> is the same as 
                                        <span class="EmphasisFontCategoryNonProportional">SessionFactory</span>. In Hibernate, the managed entities are stored in the session, which you can directly interact with via Hibernate’s 
                                        <span class="EmphasisFontCategoryNonProportional">SessionFactory</span> or 
                                        <span class="EmphasisFontCategoryNonProportional">Session</span> interface. In JPA, however, you can’t interact with the persistence context directly. Instead, you need to rely on 
                                        <span class="EmphasisFontCategoryNonProportional">EntityManager</span> to do the work for you.
                                    </div>
                                    <div class="Para" id="Par16">JPQL is similar to HQL, so if you have used HQL before, JPQL should be easy to pick up. However, in JPA 2, a strongly typed Criteria API was introduced, which relies on the mapped entities’ metadata to construct the query. Given this, any errors will be discovered at compile time rather than runtime.</div>
                                    <div class="Para" id="Par17">For a detailed discussion of JPA 2, we recommend the book 
                                        <span class="EmphasisTypeItalic">Pro JPA 2</span> by Mike Keith and Merrick Schincariol (Apress, 2013).
                                        <a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Chapter.html#Fn1" id="Fn1_source"><sup>1</sup></a> In this section, we discuss the basic concepts of JPA, the sample data model that will be used in this chapter, and how to configure Spring’s 
                                        <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> to support JPA.
                                    </div>
                                    <div class="Section2 RenderAsSection2" id="Sec2">
                                        <h3 class="Heading">Sample Data Model for Example Code</h3>
                                        <div class="Para" id="Par19">In this chapter, we use the same data model as used in Chapter 
                                            <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html"><span class="RefSource">7</span></a></span>. However, when we discuss how to implement the auditing features, we will add a few columns and a history table for demonstration. To get started, we will begin with the same database creation scripts used in the previous chapter. If you skipped Chapter 
                                            <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html"><span class="RefSource">7</span></a></span>, take a look at the data model presented in that chapter’s “Sample Data Model for Example Code” section, which can help you understand the sample code in this chapter.
                                        </div>
                                    </div>
                                    <div class="Section2 RenderAsSection2" id="Sec3">
                                        <h3 class="Heading">Configuring JPA’s EntityManagerFactory</h3>
                                        <div class="Para" id="Par20">As mentioned earlier in this chapter, to use JPA in Spring, we need to configure 
                                            <span class="EmphasisFontCategoryNonProportional">EntityManagerFactory</span>, just like 
                                            <span id="ITerm2"> <span class="EmphasisFontCategoryNonProportional">SessionFactory</span> </span> used in Hibernate. Spring supports three types of 
                                            <span class="EmphasisFontCategoryNonProportional">EntityManagerFactory</span> configurations.
                                        </div>
                                        <div class="Para" id="Par21">The first one uses the 
                                            <span class="EmphasisFontCategoryNonProportional">LocalEntityManagerFactoryBean</span> class. It’s the simplest one, which requires only the persistence unit name. However, since it doesn’t support the injection of 
                                            <span class="EmphasisFontCategoryNonProportional">DataSource</span> and hence isn’t able to participate in global transactions, it’s suitable only for simple development purposes.
                                        </div>
                                        <div class="Para" id="Par22">The second option is for use in a JEE-compliant container, in which the application server bootstraps the JPA persistence unit based on the information in the deployment descriptors. This allows Spring to look up the entity manager via JNDI lookup. The following configuration snippet depicts the element needed for looking up an entity manager via JNDI:</div>
                                        <pre style="background:#fff;color:#000"><span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> ...&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">jee</span><span style="font-weight:700">:</span><span style="font-weight:700">jndi-lookup</span>  <span style="font-style:italic">id</span>=<span style="color:#036a07">prospring5Emf</span>
       <span style="font-style:italic">jndi-name</span>=<span style="color:#036a07">persistence/prospring5PersistenceUnit</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
                                        <div class="Para ParaOneEmphasisChild" id="Par24">In the JPA specification, a persistence unit should be defined in the configuration file 
                                            <span class="EmphasisFontCategoryNonProportional">META-INF/persistence.xml</span>. However, as of Spring 3.1, a new feature has been added that eliminates this need; we show you how to use it later in this chapter.
                                        </div>
                                        <div class="Para" id="Par25">The third option, which is the most common and is used in this chapter, is the 
                                            <span class="EmphasisFontCategoryNonProportional">LocalContainerEntityManagerFactoryBean</span> class that supports the injection of 
                                            <span class="EmphasisFontCategoryNonProportional">DataSource</span> and can participate in both local and global 
                                            <span id="ITerm3">transactions                      </span>. The following configuration snippet shows the corresponding XML configuration file (
                                            <span class="EmphasisFontCategoryNonProportional">app-context-annotation.xml</span>):
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#68685b">&lt;?<span style="color:#888">xml</span><span style="color:#888"> version</span>=<span style="color:#888">1.0</span> <span style="color:#888"> encoding</span>=<span style="color:#888">UTF-8</span>?&gt;</span>
<span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span>
    <span style="font-style:italic">xmlns</span>=<span style="color:#036a07">http://www.springframework.org/schema/beans</span>
    <span style="font-style:italic">xmlns</span>:xsi=<span style="color:#036a07">http://www.w3.org/2001/XMLSchema-instance</span>
    <span style="font-style:italic">xmlns</span>:context=<span style="color:#036a07">http://www.springframework.org/schema/context</span>
    <span style="font-style:italic">xmlns</span>:jdbc=<span style="color:#036a07">http://www.springframework.org/schema/jdbc</span>
    <span style="font-style:italic">xmlns</span>:tx=<span style="color:#036a07">http://www.springframework.org/schema/tx</span>
    <span style="font-style:italic">xsi</span>:schemaLocation=<span style="color:#036a07">http://www.springframework.org/schema/jdbc
       http://www.springframework.org/schema/jdbc/spring-jdbc.xsd
       http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/tx
       http://www.springframework.org/schema/tx/spring-tx.xsd
       http://www.springframework.org/schema/context
       http://www.springframework.org/schema/context/spring-context.xsd</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">jdbc</span><span style="font-weight:700">:</span><span style="font-weight:700">embedded-database</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">dataSource</span>  <span style="font-style:italic">type</span>=<span style="color:#036a07">H2</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">jdbc</span><span style="font-weight:700">:</span><span style="font-weight:700">script</span>  <span style="font-style:italic">location</span>=<span style="color:#036a07">classpath:sql/schema.sql</span>/&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">jdbc</span><span style="font-weight:700">:</span><span style="font-weight:700">script</span> <span style="font-style:italic">location</span>=<span style="color:#036a07">classpath:sql/test-data.sql</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">jdbc</span><span style="font-weight:700">:</span><span style="font-weight:700">embedded-database</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">transactionManager</span> <span style="font-style:italic">class</span>=
         <span style="color:#036a07">org.springframework.orm.jpa.JpaTransactionManager</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">property</span> <span style="font-style:italic">name</span>=<span style="color:#036a07"> entityManagerFactory</span> <span style="font-style:italic">ref</span>=<span style="color:#036a07">emf</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">bean</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">tx</span><span style="font-weight:700">:</span><span style="font-weight:700">annotation-driven</span> <span style="font-style:italic">transaction-manager</span>=<span style="color:#036a07">transactionManager</span> /&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">emf</span> <span style="font-style:italic">class</span>=
         <span style="color:#036a07">org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">property</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">dataSource</span> <span style="font-style:italic">ref</span>=<span style="color:#036a07">dataSource</span> /&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">property</span> <span style="font-style:italic">name</span>=<span style="color:#036a07"> jpaVendorAdapter</span>&gt;</span>
            <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">class</span>=
          <span style="color:#036a07">org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter</span> /&gt;</span>
        <span style="color:#1c02ff">&lt;/<span style="font-weight:700">property</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">property</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">packagesToScan</span> <span style="font-style:italic">value</span>=<span style="color:#036a07">com.apress.prospring5.ch8.entities</span>/&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">property</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">jpaProperties</span>&gt;</span>
            <span style="color:#1c02ff">&lt;<span style="font-weight:700">props</span>&gt;</span>
                <span style="color:#1c02ff">&lt;<span style="font-weight:700">prop</span> <span style="font-style:italic">key</span>=<span style="color:#036a07">hibernate.dialect</span>&gt;</span>
       org.hibernate.dialect.H2Dialect
     <span style="color:#1c02ff">&lt;/<span style="font-weight:700">prop</span>&gt;</span>
                <span style="color:#1c02ff">&lt;<span style="font-weight:700">prop</span> <span style="font-style:italic">key</span>=<span style="color:#036a07">hibernate.max_fetch_depth</span>&gt;</span>3<span style="color:#1c02ff">&lt;/<span style="font-weight:700">prop</span>&gt;</span>
                <span style="color:#1c02ff">&lt;<span style="font-weight:700">prop</span> <span style="font-style:italic">key</span>=<span style="color:#036a07">hibernate.jdbc.fetch_size</span>&gt;</span>50<span style="color:#1c02ff">&lt;/<span style="font-weight:700">prop</span>&gt;</span>
                <span style="color:#1c02ff">&lt;<span style="font-weight:700">prop</span> <span style="font-style:italic">key</span>=<span style="color:#036a07">hibernate.jdbc.batch_size</span>&gt;</span>10<span style="color:#1c02ff">&lt;/<span style="font-weight:700">prop</span>&gt;</span>
                <span style="color:#1c02ff">&lt;<span style="font-weight:700">prop</span> <span style="font-style:italic">key</span>=<span style="color:#036a07">hibernate.show_sql</span>&gt;</span>true<span style="color:#1c02ff">&lt;/<span style="font-weight:700">prop</span>&gt;</span>
            <span style="color:#1c02ff">&lt;/<span style="font-weight:700">props</span>&gt;</span>
        <span style="color:#1c02ff">&lt;/<span style="font-weight:700">property</span>&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">bean</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">context</span><span style="font-weight:700">:</span><span style="font-weight:700">component-scan</span> <span style="font-style:italic">base-package</span>=<span style="color:#036a07">com.apress.prospring5.ch8</span>  /&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
                                        <div class="Para" id="Par27">You probably expect that there is an equivalent 
                                            <span id="ITerm4">configuration                      </span> using Java configuration classes. There is, as shown here:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.config</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.Logger</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.LoggerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Bean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.ComponentScan</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Configuration</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.jdbc.datasource.embedded.EmbeddedDatabaseBuilder</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.jdbc.datasource.embedded.EmbeddedDatabaseType</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.orm.jpa.JpaTransactionManager</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.orm.jpa.JpaVendorAdapter</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.PlatformTransactionManager</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.annotation.EnableTransactionManagement</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.EntityManagerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.sql.DataSource</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Properties</span>;

@<span style="color:#00f;font-weight:700">Configuration</span>
@<span style="color:#00f;font-weight:700">EnableTransactionManagement</span>
@ComponentScan(basePackages <span style="color:#00f;font-weight:700">=</span> {<span style="color:#036a07">com.apress.prospring5.ch8.service</span>})
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">JpaConfig</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">JpaConfig</span><span style="color:#00f;font-weight:700">.</span>class);

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">DataSource</span> <span style="color:#0000a2;font-weight:700">dataSource</span>() {
        <span style="color:#00f;font-weight:700">try</span> {
            <span style="color:#00f;font-weight:700">EmbeddedDatabaseBuilder</span> dbBuilder <span style="color:#00f;font-weight:700">=</span>
                    <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">EmbeddedDatabaseBuilder</span>();
            <span style="color:#00f;font-weight:700">return</span> dbBuilder<span style="color:#00f;font-weight:700">.</span>setType(<span style="color:#00f;font-weight:700">EmbeddedDatabaseType</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>H2</span>)
                    .addScripts(<span style="color:#036a07">classpath:db/schema.sql</span>, <span style="color:#036a07">classpath:db/test-data.sql</span>)<span style="color:#00f;font-weight:700">.</span>build();
        } <span style="color:#00f;font-weight:700">catch</span> (<span style="color:#00f;font-weight:700">Exception</span> e) {
            logger<span style="color:#00f;font-weight:700">.</span>error(<span style="color:#036a07">Embedded DataSource bean cannot be created!</span>, e);
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#585cf6;font-weight:700">null</span>;
        }
    }

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">PlatformTransactionManager</span> <span style="color:#0000a2;font-weight:700">transactionManager</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">JpaTransactionManager</span>(entityManagerFactory());
    }

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">JpaVendorAdapter</span> <span style="color:#0000a2;font-weight:700">jpaVendorAdapter</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HibernateJpaVendorAdapter</span>();
    }

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Properties</span> <span style="color:#0000a2;font-weight:700">hibernateProperties</span>() {
        <span style="color:#00f;font-weight:700">Properties</span> hibernateProp <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Properties</span>();
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.dialect</span>, <span style="color:#036a07">org.hibernate.dialect.H2Dialect</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.format_sql</span>, <span style="color:#585cf6;font-weight:700">true</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.use_sql_comments</span>, <span style="color:#585cf6;font-weight:700">true</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.show_sql</span>, <span style="color:#585cf6;font-weight:700">true</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.max_fetch_depth</span>, <span style="color:#0000cd">3</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.jdbc.batch_size</span>, <span style="color:#0000cd">10</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.jdbc.fetch_size</span>, <span style="color:#0000cd">50</span>);
        <span style="color:#00f;font-weight:700">return</span> hibernateProp;
    }

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">EntityManagerFactory</span> <span style="color:#0000a2;font-weight:700">entityManagerFactory</span>() {
        <span style="color:#00f;font-weight:700">LocalContainerEntityManagerFactoryBean</span> factoryBean <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">LocalContainerEntityManagerFactoryBean</span>();
        factoryBean<span style="color:#00f;font-weight:700">.</span>setPackagesToScan(<span style="color:#036a07">com.apress.prospring5.ch8.entities</span>);
        factoryBean<span style="color:#00f;font-weight:700">.</span>setDataSource(dataSource());
        factoryBean<span style="color:#00f;font-weight:700">.</span>setJpaVendorAdapter(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HibernateJpaVendorAdapter</span>());
        factoryBean<span style="color:#00f;font-weight:700">.</span>setJpaProperties(hibernateProperties());
        factoryBean<span style="color:#00f;font-weight:700">.</span>setJpaVendorAdapter(jpaVendorAdapter());
        factoryBean<span style="color:#00f;font-weight:700">.</span>afterPropertiesSet();
        <span style="color:#00f;font-weight:700">return</span> factoryBean<span style="color:#00f;font-weight:700">.</span>getNativeEntityManagerFactory();
    }
}
</pre>
                                        <div class="Para" id="Par29">In the previous configurations, several beans are declared in order to be able to support the configuration of 
                                            <span class="EmphasisFontCategoryNonProportional">LocalContainerEntityManagerFactoryBean</span> with Hibernate as the persistence provider. The main configurations are as follows:
                                            <div class="UnorderedList">
                                                <ul class="UnorderedListMarkBullet">
                                                    <li>
                                                        <div class="Para" id="Par30"> 
                                                            <span class="EmphasisTypeItalic">The</span> 
                                                            <span id="ITerm7"> <span class="EmphasisTypeItalic">dataSource bean</span> </span>: We declared the data source with an embedded database using H2. Because it’s an embedded database, the database name is not required.
                                                        </div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par31"> 
                                                            <span class="EmphasisTypeItalic">The</span> 
                                                            <span id="ITerm8"> <span class="EmphasisTypeItalic">transactionManager bean</span> </span>: 
                                                            <span class="EmphasisFontCategoryNonProportional">EntityManagerFactory</span> requires a transaction manager for transactional data access. Spring provides a transaction manager specifically for JPA (
                                                            <span class="EmphasisFontCategoryNonProportional">org.springframework.orm.jpa.JpaTransactionManager</span>). The bean is declared with an ID of 
                                                            <span class="EmphasisFontCategoryNonProportional">transactionManager</span> assigned. We discuss transactions in detail in Chapter 
                                                            <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html"><span class="RefSource">9</span></a></span>. We declare the tag 
                                                            <span class="EmphasisFontCategoryNonProportional">&lt;tx:annotation-driven&gt;</span> to support a declaration of the transaction demarcation requirements using annotations. Its equivalent annotation is 
                                                            <span class="EmphasisFontCategoryNonProportional">@EnableTransactionManagement</span>, which must be placed on a class annotated with 
                                                            <span class="EmphasisFontCategoryNonProportional">@Configuration</span>.
                                                        </div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par32"> 
                                                            <span id="ITerm9"> <span class="EmphasisTypeItalic">Component scan</span> </span>: The tag should be familiar to you. We instruct Spring to scan the components under the package 
                                                            <span class="EmphasisFontCategoryNonProportional">com.apress.prospring5.ch8</span> 
                                                            <span class="EmphasisTypeItalic">.</span> 
                                                        </div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par33"> 
                                                            <span class="EmphasisTypeItalic">JPA</span> 
                                                            <span id="ITerm10"> <span class="EmphasisTypeItalic">EntityManagerFactory</span> </span> 
                                                            <span class="EmphasisTypeItalic">bean</span>: The 
                                                            <span class="EmphasisFontCategoryNonProportional">emf</span> bean is the most important part. First, we declare the bean to use 
                                                            <span class="EmphasisFontCategoryNonProportional">LocalContainerEntityManagerFactoryBean</span>. Within the bean, several properties are provided. First, as you might have expected, we need to inject the 
                                                            <span class="EmphasisFontCategoryNonProportional">DataSource</span> bean. Second, we configure the property 
                                                            <span class="EmphasisFontCategoryNonProportional">jpaVendorAdapter</span> with the class 
                                                            <span class="EmphasisFontCategoryNonProportional">HibernateJpaVendorAdapter</span> because we are using Hibernate. Third, we instruct the entity factory to scan for the domain objects with ORM annotations under the package 
                                                            <span class="EmphasisFontCategoryNonProportional">com.apress.prospring5.ch8</span> (specified by the 
                                                            <span class="EmphasisFontCategoryNonProportional">&lt;property name=&quot;packagesToScan&quot;&gt;</span> tag). Note that this feature has been available only since Spring 3.1, and with the support of domain class scanning, you can skip the definition of the persistence unit in the 
                                                            <span class="EmphasisFontCategoryNonProportional">META-INF/persistence.xml</span> file. Finally, the 
                                                            <span class="EmphasisFontCategoryNonProportional">jpaProperties</span> property provides configuration details for the persistence provider Hibernate. You will see that the configuration options are the same as those we used in Chapter 
                                                            <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html"><span class="RefSource">7</span></a></span>, so we can skip the explanation here.
                                                        </div>
                                                    </li>
                                                </ul>
                                            </div>                                             
                                        </div>
                                    </div>
                                    <div class="Section2 RenderAsSection2" id="Sec4">
                                        <h3 class="Heading">Using JPA Annotations for ORM Mapping</h3>
                                        <div class="Para" id="Par34">Hibernate influenced the design of 
                                            <span id="ITerm11">JPA                      </span> 
                                            <span id="ITerm12"> </span> in many ways. For the mapping annotations, they are so close that the annotations we used in Chapter 
                                            <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html"><span class="RefSource">7</span></a></span> for mapping the domain objects to the database are the same in JPA. If you take a look at the domain classes’ source code in Chapter 
                                            <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html"><span class="RefSource">7</span></a></span>, you will see that all mapping annotations are under the package 
                                            <span class="EmphasisFontCategoryNonProportional">javax.persistence</span>, which means those annotations are already JPA compatible.
                                        </div>
                                        <div class="Para" id="Par35">Once 
                                            <span class="EmphasisFontCategoryNonProportional">EntityManagerFactory</span> has been properly configured, injecting it into your classes is simple. The following code snippet shows the code for the 
                                            <span class="EmphasisFontCategoryNonProportional">SingerServiceImpl</span> class, which we will use as the sample for performing database operations using JPA:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.service</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.Logger</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.LoggerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Service</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Repository</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.annotation.Transactional</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.apache.commons.lang3.NotImplementedException</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.PersistenceContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.EntityManager</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.TypedQuery</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.apache.commons.logging.Log</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.apache.commons.logging.LogFactory</span>;

@Service(<span style="color:#036a07">jpaSingerService</span>)
@<span style="color:#00f;font-weight:700">Repository</span>
@<span style="color:#00f;font-weight:700">Transactional</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerServiceImpl</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerService</span> {
    <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#c5060b;font-weight:700">ALL_SINGER_NATIVE_QUERY</span> <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#036a07">select id, first_name,  last_name, birth_date,  version from singer</span>;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">SingerServiceImpl</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">@PersistenceContext</span>
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">EntityManager</span> em;

    <span style="color:#00f;font-weight:700">@Transactional</span>(<span style="color:#c5060b;font-weight:700">readOnly</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAll</span>() {
        <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">NotImplementedException</span>(<span style="color:#036a07">findAll</span>);
    }

    <span style="color:#00f;font-weight:700">@Transactional</span>(<span style="color:#c5060b;font-weight:700">readOnly</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAllWithAlbum</span>() {
        <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">NotImplementedException</span>(<span style="color:#036a07">findAllWithAlbum</span>);
    }

    <span style="color:#00f;font-weight:700">@Transactional</span>(<span style="color:#c5060b;font-weight:700">readOnly</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">findById</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">id</span>) {
        <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">NotImplementedException</span>(<span style="color:#036a07">findById</span>);
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">save</span>(<span style="color:#00f;font-weight:700">Singer</span> <span style="font-style:italic">singer</span>) {
        <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">NotImplementedException</span>(<span style="color:#036a07">save</span>);
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">delete</span>(<span style="color:#00f;font-weight:700">Singer</span> <span style="font-style:italic">singer</span>) {
        <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">NotImplementedException</span>(<span style="color:#036a07">delete</span>);
    }

    <span style="color:#00f;font-weight:700">@Transactional</span>(<span style="color:#c5060b;font-weight:700">readOnly</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAllByNativeQuery</span>() {
        <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">NotImplementedException</span>(<span style="color:#036a07">findAllByNativeQuery</span>);
    }
}
</pre>
                                        <div class="Para" id="Par37">Several annotations are applied to the 
                                            <span id="ITerm13">class                      </span> 
                                            <span id="ITerm14"> </span>. The 
                                            <span class="EmphasisFontCategoryNonProportional">@Service</span> annotation is used to identify the class as being a Spring component that provides business services to another layer and assigns the Spring bean the name 
                                            <span class="EmphasisFontCategoryNonProportional">jpaSingerService</span>. The 
                                            <span class="EmphasisFontCategoryNonProportional">@Repository</span> annotation indicates that the class contains data access logic and instructs Spring to translate the vendor-specific exceptions to Spring’s 
                                            <span class="EmphasisFontCategoryNonProportional">DataAccessException</span> hierarchy. As you are already familiar with, the 
                                            <span class="EmphasisFontCategoryNonProportional">@Transactional</span> annotation is used for defining transaction requirements.
                                        </div>
                                        <div class="Para" id="Par38">To inject 
                                            <span class="EmphasisFontCategoryNonProportional">EntityManager</span>, we use the 
                                            <span class="EmphasisFontCategoryNonProportional">@PersistenceContext</span> annotation, which is the standard JPA annotation for entity manager injection. It may be questionable as to why we’re using the name 
                                            <span class="EmphasisFontCategoryNonProportional">@PersistenceContext</span> to inject an entity manager, but if you consider that the persistence context itself is managed by 
                                            <span class="EmphasisFontCategoryNonProportional">EntityManager</span>, the annotation naming makes perfect sense. If you have multiple persistence units in your application, you can also add the 
                                            <span class="EmphasisFontCategoryNonProportional">unitName</span> 
                                            <span id="ITerm15">attribute                      </span> 
                                            <span id="ITerm16"> </span> to the annotation to specify which persistence unit you want to be injected. Typically, a persistence unit represents an individual back-end 
                                            <span class="EmphasisFontCategoryNonProportional">DataSource</span>.
                                        </div>
                                    </div>
                                </div>
                                <div class="Section1 RenderAsSection1" id="Sec5">
                                    <h2 class="Heading">Performing Database Operations with JPA</h2>
                                    <div class="Para ParaOneEmphasisChild" id="Par39">This section covers how to perform database operations in JPA. The following code snippet shows the 
                                        <span class="EmphasisFontCategoryNonProportional">SingerService</span> interface, which indicates the singer information services we are going to provide:
                                    </div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.service</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities.Singer</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">SingerService</span> {
    <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAll</span>();

    <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAllWithAlbum</span>();

    <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">findById</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">id</span>);

    <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">save</span>(<span style="color:#00f;font-weight:700">Singer</span> <span style="font-style:italic">singer</span>);

    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">delete</span>(<span style="color:#00f;font-weight:700">Singer</span> <span style="font-style:italic">singer</span>);

    <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAllByNativeQuery</span>();
}
</pre>
                                    <div class="Para" id="Par41">The interface is very simple; it has just three finder methods, one save method, and one delete method. The save method will serve both the insert and update operations.</div>
                                    <div class="Section2 RenderAsSection2" id="Sec6">
                                        <h3 class="Heading">Using the Java Persistence Query Language to Query Data</h3>
                                        <div class="Para" id="Par42">The syntax for JPQL and 
                                            <span id="ITerm17">HQL                                  </span> 
                                            <span id="ITerm18"> </span> is similar, and in fact, all the HQL queries that we used in Chapter 
                                            <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html"><span class="RefSource">7</span></a></span> are reusable to implement the three finder methods within the 
                                            <span class="EmphasisFontCategoryNonProportional">SingerService</span> interface. To use JPA and Hibernate, you need to add the following dependencies to the project:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#06f;font-style:italic">//pro-spring-15/build.gradle</span>
ext {
    hibernateVersion <span style="color:#00f;font-weight:700">=</span>  <span style="color:#036a07">5.2.10.Final</span>
    hibernateJpaVersion <span style="color:#00f;font-weight:700">=</span>  <span style="color:#036a07">1.0.0.Final</span>
    ..
    hibernate <span style="color:#00f;font-weight:700">=</span>  [
      em <span style="color:#00f;font-weight:700">:</span>
        <span style="color:#036a07">org.hibernate:hibernate-entitymanager:$hibernateVersion</span>,
      jpaApi <span style="color:#00f;font-weight:700">:</span>
        <span style="color:#036a07">org.hibernate.javax.persistence:hibernate-jpa-2.1-api:$hibernateJpaVersion</span>
    ]
}
<span style="color:#06f;font-style:italic">//chapter08.gradle</span>
dependencies {
       <span style="color:#06f;font-style:italic">//we specify these dependencies for all submodules,</span>
        <span style="color:#06f;font-style:italic">//except the boot module, that defines its own</span>
       <span style="color:#00f;font-weight:700">if</span> <span style="color:#00f;font-weight:700">!</span>project<span style="color:#00f;font-weight:700">.</span>name<span style="color:#00f;font-weight:700">.</span>contains<span style="color:#036a07">boot</span> {
          compile spring<span style="color:#00f;font-weight:700">.</span>contextSupport, spring<span style="color:#00f;font-weight:700">.</span>orm, spring<span style="color:#00f;font-weight:700">.</span>context,
        misc<span style="color:#00f;font-weight:700">.</span>slf4jJcl, misc<span style="color:#00f;font-weight:700">.</span>logback, db<span style="color:#00f;font-weight:700">.</span>h2, misc<span style="color:#00f;font-weight:700">.</span>lang3,
     hibernate<span style="color:#00f;font-weight:700">.</span>em, hibernate<span style="color:#00f;font-weight:700">.</span>jpaApi
       }
       testCompile testing<span style="color:#00f;font-weight:700">.</span>junit
}
</pre>
                                        <div class="Para" id="Par44">The following code snippet recaps the code for the 
                                            <span class="EmphasisFontCategoryNonProportional">Singer</span> 
                                            <span id="ITerm19">domain                                  </span> 
                                            <span id="ITerm20"> </span> object model classes from Chapter 
                                            <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html"><span class="RefSource">7</span></a></span>:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#06f;font-style:italic">//Singer.java</span>
<span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities</span>;

<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">javax.persistence.GenerationType.IDENTITY</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.io.Serializable</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Date</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.HashSet</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Set</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.Entity</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.Table</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.Id</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.GeneratedValue</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.Column</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.Version</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.Temporal</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.TemporalType</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.OneToMany</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.ManyToMany</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.JoinTable</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.JoinColumn</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.CascadeType</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.NamedQueries</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.NamedQuery</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.SqlResultSetMapping</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.EntityResult</span>;

@<span style="color:#00f;font-weight:700">Entity</span>
@Table(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">singer</span>)
@NamedQueries({
        @NamedQuery(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">Singer</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>FIND_ALL</span>, query <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">select s  from Singer  s</span>),
        @NamedQuery(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">Singer</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>FIND_SINGER_BY_ID</span>,
                query <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">select distinct s from Singer s </span> <span style="color:#00f;font-weight:700">+</span>
                        <span style="color:#036a07">left join fetch s.albums a </span> <span style="color:#00f;font-weight:700">+</span>
                        <span style="color:#036a07">left join fetch s.instruments i </span> <span style="color:#00f;font-weight:700">+</span>
                        <span style="color:#036a07">where s.id = :id</span>),
        @NamedQuery(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">Singer</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>FIND_ALL_WITH_ALBUM</span>,
                query <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">select distinct s  from Singer  s  </span> <span style="color:#00f;font-weight:700">+</span>
                        <span style="color:#036a07">left join fetch s.albums a </span> <span style="color:#00f;font-weight:700">+</span>
                        <span style="color:#036a07">left join fetch s.instruments i</span>)
})
@SqlResultSetMapping(
        name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">singerResult</span>,
        entities <span style="color:#00f;font-weight:700">=</span> @EntityResult(entityClass <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">Singer</span><span style="color:#00f;font-weight:700">.</span>class)
)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Singer</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Serializable</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#c5060b;font-weight:700">FIND_ALL</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">Singer.findAll</span>;
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#c5060b;font-weight:700">FIND_SINGER_BY_ID</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">Singer.findById</span>;
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#c5060b;font-weight:700">FIND_ALL_WITH_ALBUM</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">Singer.findAllWithAlbum</span>;
    <span style="color:#00f;font-weight:700">@Id</span>
    <span style="color:#00f;font-weight:700">@GeneratedValue</span>(<span style="color:#c5060b;font-weight:700">strategy</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#c5060b;font-weight:700">IDENTITY</span>)
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">ID</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Long</span> id;
    <span style="color:#00f;font-weight:700">@Version</span>
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">VERSION</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">int</span> version;
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">FIRST_NAME</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> firstName;
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">LAST_NAME</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> lastName;
    <span style="color:#00f;font-weight:700">@Temporal</span>(<span style="color:#00f;font-weight:700">TemporalType</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>DATE</span>)
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">BIRTH_DATE</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Date</span> birthDate;
    <span style="color:#00f;font-weight:700">@OneToMany</span>(<span style="color:#c5060b;font-weight:700">mappedBy</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">singer</span>, <span style="color:#c5060b;font-weight:700">cascade</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">CascadeType</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>ALL</span>,
            <span style="color:#c5060b;font-weight:700">orphanRemoval</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Set&lt;<span style="color:#00f;font-weight:700">Album</span>&gt;</span> albums <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HashSet&lt;&gt;</span>();
    <span style="color:#00f;font-weight:700">@ManyToMany</span>
    <span style="color:#00f;font-weight:700">@JoinTable</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">singer_instrument</span>,
            <span style="color:#c5060b;font-weight:700">joinColumns</span> <span style="color:#00f;font-weight:700">=</span> @JoinColumn(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">SINGER_ID</span>),
            <span style="color:#c5060b;font-weight:700">inverseJoinColumns</span> <span style="color:#00f;font-weight:700">=</span> @JoinColumn(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">INSTRUMENT_ID</span>))
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Set&lt;<span style="color:#00f;font-weight:700">Instrument</span>&gt;</span> instruments <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HashSet&lt;&gt;</span>();

    <span style="color:#06f;font-style:italic">//setters and getters</span>
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">toString</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">Singer - Id: </span> <span style="color:#00f;font-weight:700">+</span> id <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">, First name: </span> <span style="color:#00f;font-weight:700">+</span> firstName
                <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">, Last name: </span> <span style="color:#00f;font-weight:700">+</span> lastName <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">, Birthday: </span> <span style="color:#00f;font-weight:700">+</span> birthDate;
    }
}
<span style="color:#06f;font-style:italic">// Album. java</span>
<span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities</span>;
        <span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">javax.persistence.GenerationType.IDENTITY</span>;
        <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.io.Serializable</span>;
        <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.text.SimpleDateFormat</span>;
        <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Date</span>;
        <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.*</span>;

@<span style="color:#00f;font-weight:700">Entity</span>
@Table(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">album</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Album</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Serializable</span> {
    <span style="color:#00f;font-weight:700">@Id</span>
    <span style="color:#00f;font-weight:700">@GeneratedValue</span>(<span style="color:#c5060b;font-weight:700">strategy</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#c5060b;font-weight:700">IDENTITY</span>)
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">ID</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Long</span> id;
    <span style="color:#00f;font-weight:700">@Version</span>
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">VERSION</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">int</span> version;
    <span style="color:#00f;font-weight:700">@Column</span>
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> title;
    <span style="color:#00f;font-weight:700">@Temporal</span>(<span style="color:#00f;font-weight:700">TemporalType</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>DATE</span>)
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">RELEASE_DATE</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Date</span> releaseDate;
    <span style="color:#00f;font-weight:700">@ManyToOne</span>
    <span style="color:#00f;font-weight:700">@JoinColumn</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">SINGER_ID</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Singer</span> singer;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">Album</span>() {
        <span style="color:#06f;font-style:italic">//needed  byJPA</span>
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">Album</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">title</span>, <span style="color:#00f;font-weight:700">Date</span> <span style="font-style:italic">releaseDate</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>title <span style="color:#00f;font-weight:700">=</span> title;
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>releaseDate <span style="color:#00f;font-weight:700">=</span> releaseDate;
    }
    <span style="color:#06f;font-style:italic">//setters and getters</span>
}
<span style="color:#06f;font-style:italic">//Instrument.java</span>
<span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities</span>;
        <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.io.Serializable</span>;
        <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.Entity</span>;
        <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.Table</span>;
        <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.Column</span>;
        <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.Id</span>;
        <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.ManyToMany</span>;
        <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.JoinTable</span>;
        <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.JoinColumn</span>;
        <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Set</span>;
        <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.HashSet</span>;

@<span style="color:#00f;font-weight:700">Entity</span>
@Table(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">instrument</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Instrument</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Serializable</span> {
    <span style="color:#00f;font-weight:700">@Id</span>
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">INSTRUMENT_ID</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> instrumentId;
    <span style="color:#00f;font-weight:700">@ManyToMany</span>
    <span style="color:#00f;font-weight:700">@JoinTable</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">singer_instrument</span>,
            <span style="color:#c5060b;font-weight:700">joinColumns</span> <span style="color:#00f;font-weight:700">=</span> @JoinColumn(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">INSTRUMENT_ID</span>),
            <span style="color:#c5060b;font-weight:700">inverseJoinColumns</span> <span style="color:#00f;font-weight:700">=</span> @JoinColumn(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">SINGER_ID</span>))
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Set&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> singers <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HashSet&lt;&gt;</span>();
    <span style="color:#06f;font-style:italic">//setters and getters</span>
}
</pre>
                                        <div class="Para" id="Par46">If you analyze the queries defined using 
                                            <span id="ITerm29"> <span class="EmphasisFontCategoryNonProportional">@NamedQuery</span> </span> 
                                            <span id="ITerm30"> </span>, you will see that there seems to be no difference between HQL and JPQL. Let’s begin with the 
                                            <span id="ITerm31"> <span class="EmphasisFontCategoryNonProportional">findAll()</span> </span> 
                                            <span id="ITerm32"> </span> method, which simply retrieves all the singers from the database.
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.service</span>;
.<span style="color:#00f;font-weight:700">.</span>.

@Service(<span style="color:#036a07">jpaSingerService</span>)
@<span style="color:#00f;font-weight:700">Repository</span>
@<span style="color:#00f;font-weight:700">Transactional</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerServiceImpl</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerService</span> {
    <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#c5060b;font-weight:700">ALL_SINGER_NATIVE_QUERY</span> <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#036a07">select id, first_name,  last_name, birth_date,  version from singer</span>;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">SingerServiceImpl</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">@PersistenceContext</span>
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">EntityManager</span> em;

    <span style="color:#00f;font-weight:700">@Transactional</span>(<span style="color:#c5060b;font-weight:700">readOnly</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAll</span>() {
        <span style="color:#00f;font-weight:700">return</span> em<span style="color:#00f;font-weight:700">.</span>createNamedQuery(<span style="color:#00f;font-weight:700">Singer</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>FIND_ALL</span>, <span style="color:#00f;font-weight:700">Singer</span><span style="color:#00f;font-weight:700">.</span>class)
                .getResultList();
    }
    .<span style="color:#00f;font-weight:700">.</span>.
}
</pre>
                                        <div class="Para" id="Par48">As 
                                            <span id="ITerm33">shown                      </span> in this listing, we use the 
                                            <span class="EmphasisFontCategoryNonProportional">EntityManager.createNamedQuery()</span> method, passing in the name of the query and the expected return type. In this case, 
                                            <span class="EmphasisFontCategoryNonProportional">EntityManager</span> will return a 
                                            <span class="EmphasisFontCategoryNonProportional">TypedQuery&lt;X&gt;</span> interface. The method 
                                            <span id="ITerm34"> <span class="EmphasisFontCategoryNonProportional">TypedQuery.getResultList()</span> </span> 
                                            <span id="ITerm35"> </span> is then called to retrieve the singers. To test the implementation of the method, we will use a test class that will contain a test method for each JPA method that will be implemented.
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.config.JpaConfig</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.service.SingerService</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.After</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Before</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Test</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.Logger</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.LoggerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.AnnotationConfigApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericApplicationContext</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">org.junit.Assert.assertEquals</span>;
<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">org.junit.Assert.assertNotNull</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerJPATest</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">SingerJPATest</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SingerService</span> singerService;

    <span style="color:#00f;font-weight:700">@Before</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setUp</span>() {
        ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">JpaConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        singerService <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">SingerService</span><span style="color:#00f;font-weight:700">.</span>class);
        assertNotNull(singerService);
    }

    <span style="color:#00f;font-weight:700">@Test</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">testFindAll</span>() {
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> singers <span style="color:#00f;font-weight:700">=</span> singerService<span style="color:#00f;font-weight:700">.</span>findAll();
        assertEquals(<span style="color:#0000cd">3</span>, singers<span style="color:#00f;font-weight:700">.</span>size());
        listSingers(singers);
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">listSingers</span>(<span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="font-style:italic">singers</span>) {
        logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07"> ----  Listing singers:</span>);
        <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">:</span> singers) {
            logger<span style="color:#00f;font-weight:700">.</span>info(singer<span style="color:#00f;font-weight:700">.</span>toString());
        }
    }

    <span style="color:#00f;font-weight:700">@After</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">tearDown</span>() {
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                                        <div class="Para" id="Par50">If 
                                            <span class="EmphasisFontCategoryNonProportional">assertEquals</span> does not throw an exception (the test failed), running the 
                                            <span id="ITerm37"> <span class="EmphasisFontCategoryNonProportional">testFindAll()</span> </span> 
                                            <span id="ITerm38"> </span> test method will produce the following output:
                                        </div>
                                        <pre style="background:#fff;color:#000">----  Listing singers:
Singer - Id: 1, First name: John, Last name: Mayer, Birthday: 1977-10-16
Singer - Id: 2, First name: Eric, Last name: Clapton, Birthday: 1945-03-30
Singer - Id: 3, First name: John, Last name: Butler, Birthday: 1975-04-01
</pre>
                                        <div class="Para ParaTypeImportant" id="Par52"> 
                                            <img alt="A315511_5_En_8_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Figa_HTML.jpg" width="30"/> For associations, the JPA specification states that, by default, the persistence providers must fetch the association eagerly. However, for Hibernate’s JPA implementation, the default fetching strategy is still lazy. So, when using Hibernate’s JPA implementation, you don’t need to explicitly define an association as lazy fetching. The default fetching strategy of Hibernate is different from the JPA specification.
                                        </div>
                                        <div class="Para" id="Par53">Now let’s implement the 
                                            <span id="ITerm39"> <span class="EmphasisFontCategoryNonProportional">findAllWithAlbum()</span> </span> 
                                            <span id="ITerm40"> </span> method, which will fetch all the associated albums and instruments. The implementation is shown here:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.service</span>;
.<span style="color:#00f;font-weight:700">.</span>.

@Service(<span style="color:#036a07">jpaSingerService</span>)
@<span style="color:#00f;font-weight:700">Repository</span>
@<span style="color:#00f;font-weight:700">Transactional</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerServiceImpl</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerService</span> {
    <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#c5060b;font-weight:700">ALL_SINGER_NATIVE_QUERY</span> <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#036a07">select id, first_name, last_name, birth_date, version from singer</span>;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">SingerServiceImpl</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">@PersistenceContext</span>
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">EntityManager</span> em;

    <span style="color:#00f;font-weight:700">@Transactional</span>(<span style="color:#c5060b;font-weight:700">readOnly</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAllWithAlbum</span>() {
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> singers <span style="color:#00f;font-weight:700">=</span> em<span style="color:#00f;font-weight:700">.</span>createNamedQuery
                (<span style="color:#00f;font-weight:700">Singer</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>FIND_ALL_WITH_ALBUM</span>, <span style="color:#00f;font-weight:700">Singer</span><span style="color:#00f;font-weight:700">.</span>class)<span style="color:#00f;font-weight:700">.</span>getResultList();
        <span style="color:#00f;font-weight:700">return</span> singers;
    }
    .<span style="color:#00f;font-weight:700">.</span>.
}
</pre>
                                        <div class="Para" id="Par55"> 
                                            <span class="EmphasisFontCategoryNonProportional">findAllWithAlbum()</span> is the same as the 
                                            <span class="EmphasisFontCategoryNonProportional">findAll()</span> method, but it uses a different named query with 
                                            <span class="EmphasisFontCategoryNonProportional">left join fetch</span> enabled. The method used to test it and print the entries is shown here:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.After</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Before</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Test</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.sound.midi.Instrument</span>;<span style="color:#00f;font-weight:700">.</span><span style="color:#00f;font-weight:700">.</span>.

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerJPATest</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">SingerJPATest</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SingerService</span> singerService;

    <span style="color:#00f;font-weight:700">@Before</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setUp</span>() {
        ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">JpaConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        singerService <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">SingerService</span><span style="color:#00f;font-weight:700">.</span>class);
        assertNotNull(singerService);
    }

    <span style="color:#00f;font-weight:700">@Test</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">testFindAllWithAlbum</span>() {
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> singers <span style="color:#00f;font-weight:700">=</span> singerService<span style="color:#00f;font-weight:700">.</span>findAllWithAlbum();
        assertEquals(<span style="color:#0000cd">3</span>, singers<span style="color:#00f;font-weight:700">.</span>size());
        listSingersWithAlbum(singers);
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">listSingersWithAlbum</span>(<span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="font-style:italic">singers</span>) {
        logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07"> ---- Listing singers with instruments:</span>);
        <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">:</span> singers) {
            logger<span style="color:#00f;font-weight:700">.</span>info(singer<span style="color:#00f;font-weight:700">.</span>toString());
            <span style="color:#00f;font-weight:700">if</span> (singer<span style="color:#00f;font-weight:700">.</span>getAlbums() <span style="color:#00f;font-weight:700">!=</span> <span style="color:#585cf6;font-weight:700">null</span>) {
                <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">Album</span> album <span style="color:#00f;font-weight:700">:</span>
                        singer<span style="color:#00f;font-weight:700">.</span>getAlbums()) {
                    logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">&quot;<span style="color:#26b31a">\t</span>&quot;</span> <span style="color:#00f;font-weight:700">+</span> album<span style="color:#00f;font-weight:700">.</span>toString());
                }
            }
            <span style="color:#00f;font-weight:700">if</span> (singer<span style="color:#00f;font-weight:700">.</span>getInstruments() <span style="color:#00f;font-weight:700">!=</span> <span style="color:#585cf6;font-weight:700">null</span>) {
                <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">Instrument</span> instrument <span style="color:#00f;font-weight:700">:</span> singer<span style="color:#00f;font-weight:700">.</span>getInstruments()) {
                    logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">&quot;<span style="color:#26b31a">\t</span>Instrument: &quot;</span> <span style="color:#00f;font-weight:700">+</span> instrument<span style="color:#00f;font-weight:700">.</span>getInstrumentId());
                }
            }
        }
    }

    <span style="color:#00f;font-weight:700">@After</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">tearDown</span>() {
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                                        <div class="Para" id="Par57">If 
                                            <span class="EmphasisFontCategoryNonProportional">assertEquals</span> does not throw an exception (the test failed), running the 
                                            <span id="ITerm43"> <span class="EmphasisFontCategoryNonProportional">testFindAllWithAlbum()</span> </span> 
                                            <span id="ITerm44"> </span> test method will produce the following output:
                                        </div>
                                        <pre style="background:#fff;color:#000">INFO  o.h.h.i.QueryTranslatorFactoryInitiator - HHH000397:
    Using ASTQueryTranslatorFactory
Hibernate:
    /* Singer.findAllWithAlbum */ select
       distinct singer0_.ID as  ID1_2_0_,
       albums1_.ID as  ID1_0_1_,
       instrument3_.INSTRUMENT_ID as  INSTRUME1_1_2_,
       singer0_.BIRTH_DATE as BIRTH_DA2_2_0_,
       singer0_.FIRST_NAME as FIRST_NA3_2_0_,
       singer0_.LAST_NAME as LAST_NAM4_2_0_,
       singer0_.VERSION as VERSION5_2_0_,
       albums1_.RELEASE_DATE as RELEASE_2_0_1_,
       albums1_.SINGER_ID as SINGER_I5_0_1_,
       albums1_.title as title3_0_1_,
       albums1_.VERSION as VERSION4_0_1_,
       albums1_.SINGER_ID as SINGER_I5_0_0__,
       albums1_.ID as ID1_0_0    ,
       instrument2_.SINGER_ID as SINGER_I1_3_1__,
       instrument2_.INSTRUMENT_ID as INSTRUME2_3_1__
    from
       singer singer0_
    left outer join
       album albums1_
          on singer0_.ID=albums1_.SINGER_ID
    left outer join
       singer_instrument instrument2_
          on singer0_.ID=instrument2_.SINGER_ID
    left outer join
       instrument instrument3_
          on instrument2_.INSTRUMENT_ID=instrument3_.INSTRUMENT_ID
INFO  ----- Listing  singers with instruments:
INFO  - Singer - Id: 1, First name: John, Last name: Mayer, Birthday: 1977-10-16
INFO  -     Album - id: 2, Singer id: 1, Title: Battle Studies,
    Release Date: 2009-11-17
INFO  -     Album - id: 1, Singer id: 1, Title: The Search For Everything,
    Release Date: 2017-01-20
INFO  -     Instrument: Guitar
INFO  -     Instrument: Piano
INFO  - Singer - Id: 3, First name: John, Last name: Butler, Birthday: 1975-04-01
INFO  - Singer - Id: 2, First name: Eric, Last name: Clapton, Birthday: 1945-03-30
INFO  -     Album - id: 3, Singer id: 2, Title: From The Cradle,
    Release Date:  1994-09-13
INFO  -     Instrument: Guitar
</pre>
                                        <div class="Para" id="Par59">If logging is enabled for Hibernate, you can also see the native query that was generated to extract all the data from the database.</div>
                                        <div class="Para" id="Par60">Now let’s see the 
                                            <span id="ITerm45"> <span class="EmphasisFontCategoryNonProportional">findById()</span> </span> method, which demonstrates how to use a named 
                                            <span id="ITerm46">query                      </span> with named parameters in JPA. The associations will be fetched as well. The following code snippet shows the implementation:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.service</span>;
.<span style="color:#00f;font-weight:700">.</span>.

@Service(<span style="color:#036a07">jpaSingerService</span>)
@<span style="color:#00f;font-weight:700">Repository</span>
@<span style="color:#00f;font-weight:700">Transactional</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerServiceImpl</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerService</span> {
    <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#c5060b;font-weight:700">ALL_SINGER_NATIVE_QUERY</span> <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#036a07">select id, first_name, last_name, birth_date, version from singer</span>;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">SingerServiceImpl</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">@PersistenceContext</span>
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">EntityManager</span> em;

    <span style="color:#00f;font-weight:700">@Transactional</span>(<span style="color:#c5060b;font-weight:700">readOnly</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">findById</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">id</span>) {
        <span style="color:#00f;font-weight:700">TypedQuery&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> query <span style="color:#00f;font-weight:700">=</span> em<span style="color:#00f;font-weight:700">.</span>createNamedQuery
                (<span style="color:#00f;font-weight:700">Singer</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>FIND_SINGER_BY_ID</span>, <span style="color:#00f;font-weight:700">Singer</span><span style="color:#00f;font-weight:700">.</span>class);
        query<span style="color:#00f;font-weight:700">.</span>setParameter(<span style="color:#036a07">id</span>, id);
        <span style="color:#00f;font-weight:700">return</span> query<span style="color:#00f;font-weight:700">.</span>getSingleResult();
    }
    .<span style="color:#00f;font-weight:700">.</span>.
}
</pre>
                                        <div class="Para" id="Par62"> 
                                            <span class="EmphasisFontCategoryNonProportional">EntityManager.createNamedQuery(java.lang.String name, java.lang.Class&lt;T&gt; resultClass)</span> was called to get an instance of the 
                                            <span class="EmphasisFontCategoryNonProportional">TypedQuery&lt;T&gt;</span> interface, which ensures that the result of the query must be of type 
                                            <span class="EmphasisFontCategoryNonProportional">Singer</span>. Then the 
                                            <span class="EmphasisFontCategoryNonProportional">TypedQuery&lt;T&gt;.setParameter()</span> method was used to set the values of the named parameters within the query and to invoke the 
                                            <span id="ITerm47"> <span class="EmphasisFontCategoryNonProportional">getSingleResult()</span> </span> 
                                            <span id="ITerm48"> </span> method, since the result should contain only a single 
                                            <span class="EmphasisFontCategoryNonProportional">Singer</span> object with the specified ID. We will leave the testing of the method as an exercise for you.
                                        </div>
                                        <div class="Para" id="Par63"> 
                                            <div class="ProgramCode" id="PC15">
                                                <div class="LineGroup">
                                                    <div class="FixedLine">package com.apress.prospring5.ch8.service;</div>
                                                    <div class="FixedLine">...</div>
                                                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.service</span>;
.<span style="color:#00f;font-weight:700">.</span>.

@Service(<span style="color:#036a07">jpaSingerService</span>)
@<span style="color:#00f;font-weight:700">Repository</span>
@<span style="color:#00f;font-weight:700">Transactional</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerServiceImpl</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerService</span> {
    <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#c5060b;font-weight:700">ALL_SINGER_NATIVE_QUERY</span> <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#036a07">select id, first_name,  last_name, birth_date,  version from singer</span>;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">SingerServiceImpl</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">@PersistenceContext</span>
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">EntityManager</span> em;

    <span style="color:#00f;font-weight:700">@Transactional</span>(<span style="color:#c5060b;font-weight:700">readOnly</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">findById</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">id</span>) {
        <span style="color:#00f;font-weight:700">TypedQuery&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> query <span style="color:#00f;font-weight:700">=</span> em<span style="color:#00f;font-weight:700">.</span>createNamedQuery
                (<span style="color:#00f;font-weight:700">Singer</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>FIND_SINGER_BY_ID</span>, <span style="color:#00f;font-weight:700">Singer</span><span style="color:#00f;font-weight:700">.</span>class);
        query<span style="color:#00f;font-weight:700">.</span>setParameter(<span style="color:#036a07">id</span>, id);
        <span style="color:#00f;font-weight:700">return</span> query<span style="color:#00f;font-weight:700">.</span>getSingleResult();
    }    .<span style="color:#00f;font-weight:700">.</span>.
}
</pre></div>
                                                </div>
                                            </div>                                             
                                        </div>
                                    </div>
                                    <div class="Section2 RenderAsSection2" id="Sec7">
                                        <h3 class="Heading">Querying with Untyped Results</h3>
                                        <div class="Para" id="Par64">In many cases, you want to submit a 
                                            <span id="ITerm49">query                                  </span> 
                                            <span id="ITerm50"> </span> to the database and manipulate the results at will, instead of storing them in a mapped entity class. One typical example is a web-based report that lists only a certain number of columns across multiple tables. For example, say you have a web page that shows the singer information and his most recently released album title. The summary information contains the complete name of the singer and his most recently released album title. Singers without albums will not be listed. In this case, we can implement this use case with a query and then manually manipulate the 
                                            <span class="EmphasisFontCategoryNonProportional">ResultSet</span> object.
                                        </div>
                                        <div class="Para" id="Par65">Let’s create a new class called 
                                            <span class="EmphasisFontCategoryNonProportional">SingerSummaryUntypeImpl</span> and name the method 
                                            <span class="EmphasisFontCategoryNonProportional">displayAllSingerSummary()</span>. The following code 
                                            <span id="ITerm51">snippet                                  </span> shows a typical implementation of the method:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.service</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Repository</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Service</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.annotation.Transactional</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.EntityManager</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.PersistenceContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Iterator</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

@Service(<span style="color:#036a07">singerSummaryUntype</span>)
@<span style="color:#00f;font-weight:700">Repository</span>
@<span style="color:#00f;font-weight:700">Transactional</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerSummaryUntypeImpl</span> {
    <span style="color:#00f;font-weight:700">@PersistenceContext</span>
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">EntityManager</span> em;

    <span style="color:#00f;font-weight:700">@Transactional</span>(<span style="color:#c5060b;font-weight:700">readOnly</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">displayAllSingerSummary</span>() {
        <span style="color:#00f;font-weight:700">List</span> result <span style="color:#00f;font-weight:700">=</span> em<span style="color:#00f;font-weight:700">.</span>createQuery(
                <span style="color:#036a07">select  s.firstName, s.lastName, a.title from Singer s </span>
                        <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">left join s.albums a </span>
                        <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">where a.releaseDate=(select max(a2.releaseDate) </span>
                        <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">from Album a2 where a2.singer.id = s.id)</span>)
                .getResultList();
        <span style="color:#00f;font-weight:700">int</span> count <span style="color:#00f;font-weight:700">=</span> <span style="color:#0000cd">0</span>;
        <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">Iterator</span> i <span style="color:#00f;font-weight:700">=</span> result<span style="color:#00f;font-weight:700">.</span>iterator(); i<span style="color:#00f;font-weight:700">.</span>hasNext(); ) {
            <span style="color:#00f;font-weight:700">Object</span>[] values <span style="color:#00f;font-weight:700">=</span> (<span style="color:#00f;font-weight:700">Object</span>[]) i<span style="color:#00f;font-weight:700">.</span>next();
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#00f;font-weight:700">++</span>count <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">: </span> <span style="color:#00f;font-weight:700">+</span> values[<span style="color:#0000cd">0</span>] <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">, </span>
                    <span style="color:#00f;font-weight:700">+</span> values[<span style="color:#0000cd">1</span>] <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">, </span> <span style="color:#00f;font-weight:700">+</span> values[<span style="color:#0000cd">2</span>]);
        }
    }
}
</pre>
                                        <div class="Para" id="Par67">As shown in the previous code sample, we use the 
                                            <span class="EmphasisFontCategoryNonProportional">EntityManager.createQuery()</span> method to create 
                                            <span class="EmphasisFontCategoryNonProportional">Query</span>, passing in the JPQL statement, and then get the result list.
                                        </div>
                                        <div class="Para" id="Par68">When we explicitly specify the columns to be selected within JPQL, JPA will return an iterator, and each item within the iterator is an array of objects. We loop through the iterator, and for each element in the object array, the value is displayed. Each object array 
                                            <span id="ITerm52">corresponds                      </span> 
                                            <span id="ITerm53"> </span> to a record within the 
                                            <span class="EmphasisFontCategoryNonProportional">ResultSet</span> object. The following code snippet shows the testing program:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.config.JpaConfig</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.service.SingerSummaryUntypeImpl</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.After</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Before</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Test</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.Logger</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.LoggerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.AnnotationConfigApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericApplicationContext</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">org.junit.Assert.assertEquals</span>;
<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">org.junit.Assert.assertNotNull</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerSummaryJPATest</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">SingerSummaryJPATest</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SingerSummaryUntypeImpl</span> singerSummaryUntype;

    <span style="color:#00f;font-weight:700">@Before</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setUp</span>() {
        ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">JpaConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        singerSummaryUntype <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">SingerSummaryUntypeImpl</span><span style="color:#00f;font-weight:700">.</span>class);
        assertNotNull(singerSummaryUntype);
    }

    <span style="color:#00f;font-weight:700">@Test</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">testFindAllUntype</span>() {
        singerSummaryUntype<span style="color:#00f;font-weight:700">.</span>displayAllSingerSummary();
    }

    <span style="color:#00f;font-weight:700">@After</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">tearDown</span>() {
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                                        <div class="Para" id="Par70">Running the testing 
                                            <span id="ITerm54">program                                  </span> 
                                            <span id="ITerm55"> </span> produces the following output:
                                        </div>
                                        <div class="Para" id="Par71"> 
                                            <div class="ProgramCode" id="PC18">
                                                <div class="FixedLine">1: John, Mayer, The Search For Everything</div>
                                                <div class="FixedLine">2: Eric, Clapton, From The Cradle</div>
                                            </div>                                             
                                        </div>
                                        <div class="Para" id="Par72">In JPA, there is a more elegant solution, rather than playing around with the object array returned from the query, that is discussed in the next section.</div>
                                    </div>
                                </div>
                                <div class="Section1 RenderAsSection1" id="Sec8">
                                    <h2 class="Heading">Querying for a Custom Result Type with a Constructor Expression</h2>
                                    <div class="Para" id="Par73">In JPA, when querying for a custom result like the one in the previous section, you can instruct JPA to directly construct a POJO from each record for you. This POJO is also called a 
                                        <span class="EmphasisTypeItalic">view</span> because it contains data from multiple tables. For the example in the previous section, let’s create a POJO called 
                                        <span id="ITerm56"> <span class="EmphasisFontCategoryNonProportional">SingerSummary</span> </span> 
                                        <span id="ITerm57"> </span> that stores the results of the query for the singer summary. The following code snippet shows the class:
                                    </div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.view</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.io.Serializable</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerSummary</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Serializable</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> firstName;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> lastName;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> latestAlbum;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">SingerSummary</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">firstName</span>, <span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">lastName</span>,
                         <span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">latestAlbum</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>firstName <span style="color:#00f;font-weight:700">=</span> firstName;
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>lastName <span style="color:#00f;font-weight:700">=</span> lastName;
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>latestAlbum <span style="color:#00f;font-weight:700">=</span> latestAlbum;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getFirstName</span>() {
        <span style="color:#00f;font-weight:700">return</span> firstName;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getLastName</span>() {
        <span style="color:#00f;font-weight:700">return</span> lastName;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getLatestAlbum</span>() {
        <span style="color:#00f;font-weight:700">return</span> latestAlbum;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">toString</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">First name: </span> <span style="color:#00f;font-weight:700">+</span> firstName <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">, Last Name: </span> <span style="color:#00f;font-weight:700">+</span> lastName
                <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">, Most  Recent Album: </span> <span style="color:#00f;font-weight:700">+</span> latestAlbum;
    }
}
</pre>
                                    <div class="Para" id="Par75">The previous 
                                        <span id="ITerm58"> <span class="EmphasisFontCategoryNonProportional">SingerSummary</span> </span> 
                                        <span id="ITerm59"> </span> class has the properties for each singer summary, with a constructor method that accepts all the properties. Having the 
                                        <span class="EmphasisFontCategoryNonProportional">SingerSummary</span> class in place, we can revise the 
                                        <span class="EmphasisFontCategoryNonProportional">findAll()</span> method and use a constructor expression within the query to instruct the JPA provider to map the 
                                        <span class="EmphasisFontCategoryNonProportional">ResultSet</span> to the 
                                        <span class="EmphasisFontCategoryNonProportional">SingerSummary</span> class. Let’s create an interface for the 
                                        <span class="EmphasisFontCategoryNonProportional">SingerSummary</span> service first. The following code snippet shows the interface:
                                    </div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.service</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.view.SingerSummary</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">SingerSummaryService</span> {
    <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">SingerSummary</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAll</span>();
}
</pre>
                                    <div class="Para" id="Par77">Here you can see the implementation of the 
                                        <span class="EmphasisFontCategoryNonProportional">SingerSummaryImpl.findAll()</span> 
                                        <span id="ITerm60">method                            </span> 
                                        <span id="ITerm61"> </span>, using the constructor expression for the 
                                        <span class="EmphasisFontCategoryNonProportional">ResultSet</span> mapping:
                                    </div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.service</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.view.SingerSummary</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Repository</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Service</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.annotation.Transactional</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.EntityManager</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.PersistenceContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

@Service(<span style="color:#036a07">singerSummaryService</span>)
@<span style="color:#00f;font-weight:700">Repository</span>
@<span style="color:#00f;font-weight:700">Transactional</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerSummaryServiceImpl</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerSummaryService</span> {
    <span style="color:#00f;font-weight:700">@PersistenceContext</span>
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">EntityManager</span> em;

    <span style="color:#00f;font-weight:700">@Transactional</span>(<span style="color:#c5060b;font-weight:700">readOnly</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">SingerSummary</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAll</span>() {
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">SingerSummary</span>&gt;</span> result <span style="color:#00f;font-weight:700">=</span> em<span style="color:#00f;font-weight:700">.</span>createQuery(
                <span style="color:#036a07">select new com.apress.prospring5.ch8.view.SingerSummary(</span>
                        <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">s.firstName, s.lastName, a.title) from Singer s </span>
                        <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">left join s.albums a </span>
                        <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">where a.releaseDate=(select  max(a2.releaseDate):
                        + </span>from <span style="color:#00f;font-weight:700">Album</span> a2 where a2<span style="color:#00f;font-weight:700">.</span>singer<span style="color:#00f;font-weight:700">.</span>id <span style="color:#00f;font-weight:700">=</span> s<span style="color:#00f;font-weight:700">.</span>id)<span style="color:#036a07">&quot;,
                SingerSummary.class).getResultList();
        return result;
    }
}
</span></pre>
                                    <div class="Para" id="Par79">In the JPQL statement, the 
                                        <span class="EmphasisFontCategoryNonProportional">new</span> keyword was specified, together with the fully qualified name of the POJO class that will store the results and pass in the selected attributes as the constructor argument of each 
                                        <span class="EmphasisFontCategoryNonProportional">SingerSummary</span> class. Finally, the 
                                        <span class="EmphasisFontCategoryNonProportional">SingerSummary</span> class was passed into the 
                                        <span id="ITerm62"> <span class="EmphasisFontCategoryNonProportional">createQuery()</span> </span> 
                                        <span id="ITerm63"> </span> method to indicate the result type. The following code snippet shows the testing program:
                                    </div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.config.JpaConfig</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.service.SingerSummaryService</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.view.SingerSummary</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.After</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Before</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Test</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.Logger</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.LoggerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.AnnotationConfigApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericApplicationContext</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">org.junit.Assert.assertEquals</span>;
<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">org.junit.Assert.assertNotNull</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerSummaryJPATest</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">SingerSummaryJPATest</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SingerSummaryService</span> singerSummaryService;

    <span style="color:#00f;font-weight:700">@Before</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setUp</span>() {
        ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">JpaConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        singerSummaryService <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">SingerSummaryService</span><span style="color:#00f;font-weight:700">.</span>class);
        assertNotNull(singerSummaryService);
    }

    <span style="color:#00f;font-weight:700">@Test</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">testFindAll</span>() {
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">SingerSummary</span>&gt;</span> singers <span style="color:#00f;font-weight:700">=</span> singerSummaryService<span style="color:#00f;font-weight:700">.</span>findAll();
        listSingerSummary(singers);
        assertEquals(<span style="color:#0000cd">2</span>, singers<span style="color:#00f;font-weight:700">.</span>size());
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">listSingerSummary</span>(<span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">SingerSummary</span>&gt;</span> <span style="font-style:italic">singers</span>) {
        logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07"> ---- Listing singers summary:</span>);
        <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">SingerSummary</span> singer <span style="color:#00f;font-weight:700">:</span> singers) {
            logger<span style="color:#00f;font-weight:700">.</span>info(singer<span style="color:#00f;font-weight:700">.</span>toString());
        }
    }

    <span style="color:#00f;font-weight:700">@After</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">tearDown</span>() {
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                                    <div class="Para" id="Par81">Executing the 
                                        <span class="EmphasisFontCategoryNonProportional">testFindAll</span> 
                                        <span id="ITerm66">method                            </span> 
                                        <span id="ITerm67"> </span> class again produces the output for each 
                                        <span class="EmphasisFontCategoryNonProportional">SingerSummary</span> object within the list, as shown here (other output was omitted):
                                    </div>
                                    <pre style="background:#fff;color:#000">INFO    ---- Listing singers summary:
INFO    - First name: John, Last Name: Mayer, Most Recent Album: The Search For Everything
INFO    - First name: Eric, Last Name: Clapton, Most Recent Album: From The Cradle
</pre>
                                    <div class="Para" id="Par83">As you can see, the constructor expression is useful for mapping the result of a custom query into POJOs for further application processing.</div>
                                    <div class="Section2 RenderAsSection2" id="Sec9">
                                        <h3 class="Heading">Inserting Data</h3>
                                        <div class="Para" id="Par84"> 
                                            <span id="ITerm68">Inserting data                                  </span> 
                                            <span id="ITerm69"> </span> by using JPA is simple. Like Hibernate, JPA also supports retrieving a database-generated primary key. The following code snippet shows the 
                                            <span class="EmphasisFontCategoryNonProportional">save()</span> method:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.service</span>;
.<span style="color:#00f;font-weight:700">.</span>.

@Service(<span style="color:#036a07">jpaSingerService</span>)
@<span style="color:#00f;font-weight:700">Repository</span>
@<span style="color:#00f;font-weight:700">Transactional</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerServiceImpl</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerService</span> {
    <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#c5060b;font-weight:700">ALL_SINGER_NATIVE_QUERY</span> <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#036a07">select id, first_name, last_name, birth_date, version from singer</span>;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">SingerServiceImpl</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">@PersistenceContext</span>
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">EntityManager</span> em;

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">save</span>(<span style="color:#00f;font-weight:700">Singer</span> <span style="font-style:italic">singer</span>) {
        <span style="color:#00f;font-weight:700">if</span> (singer<span style="color:#00f;font-weight:700">.</span>getId() <span style="color:#00f;font-weight:700">==</span> <span style="color:#585cf6;font-weight:700">null</span>) {
            logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">Inserting new singer</span>);
            em<span style="color:#00f;font-weight:700">.</span>persist(singer);
        } <span style="color:#00f;font-weight:700">else</span> {
            em<span style="color:#00f;font-weight:700">.</span>merge(singer);
            logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">Updating existing singer</span>);
        }
        logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">Singer saved with id: </span> <span style="color:#00f;font-weight:700">+</span> singer<span style="color:#00f;font-weight:700">.</span>getId());
        <span style="color:#00f;font-weight:700">return</span> singer;
    }
    .<span style="color:#00f;font-weight:700">.</span>.
}
</pre>
                                        <div class="Para" id="Par86">As shown here, the 
                                            <span class="EmphasisFontCategoryNonProportional">save()</span> 
                                            <span id="ITerm70">method                                  </span> 
                                            <span id="ITerm71"> </span> first checks whether the object is a new entity instance, by checking the 
                                            <span class="EmphasisFontCategoryNonProportional">id</span> value. If 
                                            <span class="EmphasisFontCategoryNonProportional">id</span> is 
                                            <span class="EmphasisFontCategoryNonProportional">null</span> (that is, not yet assigned), the object is a new entity instance, and the 
                                            <span class="EmphasisFontCategoryNonProportional">EntityManager.persist()</span> method will be invoked. When calling the 
                                            <span class="EmphasisFontCategoryNonProportional">persist()</span> method, 
                                            <span class="EmphasisFontCategoryNonProportional">EntityManager</span> persists the entity and makes it a managed instance within the current persistence context. If the 
                                            <span class="EmphasisFontCategoryNonProportional">id</span> value exists, then we’re carrying out an update, and the 
                                            <span class="EmphasisFontCategoryNonProportional">EntityManager.merge()</span> method will be called instead. When the 
                                            <span class="EmphasisFontCategoryNonProportional">merge()</span> method is called, the 
                                            <span class="EmphasisFontCategoryNonProportional">EntityManager</span> merges the state of the entity into the current persistence context.
                                        </div>
                                        <div class="Para" id="Par87">The following code snippet shows the code to insert a new singer record. It’s all done in a test method because we want to test that the insert succeed.</div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.After</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Before</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Test</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.GregorianCalendar</span>;<span style="color:#00f;font-weight:700">.</span><span style="color:#00f;font-weight:700">.</span>.

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerJPATest</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">SingerJPATest</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SingerService</span> singerService;

    <span style="color:#00f;font-weight:700">@Before</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setUp</span>() {
        ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">JpaConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        singerService <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">SingerService</span><span style="color:#00f;font-weight:700">.</span>class);
        assertNotNull(singerService);
    }

    <span style="color:#00f;font-weight:700">@Test</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">testInsert</span>() {
        <span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Singer</span>();
        singer<span style="color:#00f;font-weight:700">.</span>setFirstName(<span style="color:#036a07">BB</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setLastName(<span style="color:#036a07">King</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setBirthDate(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Date</span>(
                (<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GregorianCalendar</span>(<span style="color:#0000cd">1940</span>, <span style="color:#0000cd">8</span>, <span style="color:#0000cd">16</span>))<span style="color:#00f;font-weight:700">.</span>getTime()<span style="color:#00f;font-weight:700">.</span>getTime()));
        <span style="color:#00f;font-weight:700">Album</span> album <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Album</span>();
        album<span style="color:#00f;font-weight:700">.</span>setTitle(<span style="color:#036a07">My Kind of Blues</span>);
        album<span style="color:#00f;font-weight:700">.</span>setReleaseDate(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">java.sql<span style="color:#00f;font-weight:700">.</span>Date</span>(
                (<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GregorianCalendar</span>(<span style="color:#0000cd">1961</span>, <span style="color:#0000cd">7</span>, <span style="color:#0000cd">18</span>))<span style="color:#00f;font-weight:700">.</span>getTime()<span style="color:#00f;font-weight:700">.</span>getTime()));
        singer<span style="color:#00f;font-weight:700">.</span>addAbum(album);
        album <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Album</span>();
        album<span style="color:#00f;font-weight:700">.</span>setTitle(<span style="color:#036a07">A Heart Full of Blues</span>);
        album<span style="color:#00f;font-weight:700">.</span>setReleaseDate(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">java.sql<span style="color:#00f;font-weight:700">.</span>Date</span>(
                (<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GregorianCalendar</span>(<span style="color:#0000cd">1962</span>, <span style="color:#0000cd">3</span>, <span style="color:#0000cd">20</span>))<span style="color:#00f;font-weight:700">.</span>getTime()<span style="color:#00f;font-weight:700">.</span>getTime()));
        singer<span style="color:#00f;font-weight:700">.</span>addAbum(album);
        singerService<span style="color:#00f;font-weight:700">.</span>save(singer);
        assertNotNull(singer<span style="color:#00f;font-weight:700">.</span>getId());
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> singers <span style="color:#00f;font-weight:700">=</span> singerService<span style="color:#00f;font-weight:700">.</span>findAllWithAlbum();
        assertEquals(<span style="color:#0000cd">4</span>, singers<span style="color:#00f;font-weight:700">.</span>size());
        listSingersWithAlbum(singers);
    }
    .<span style="color:#00f;font-weight:700">.</span>.

    <span style="color:#00f;font-weight:700">@After</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">tearDown</span>() {
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                                        <div class="Para" id="Par89">As shown here, we 
                                            <span id="ITerm74">create                                  </span> 
                                            <span id="ITerm75"> </span> a new singer, add two albums, and save the object. Then we list all the singers again, after we test that we have the correct number of records in the table. Running the program yields the following output:
                                        </div>
                                        <pre style="background:#fff;color:#000">INFO -  ---- Listing singers with instruments:
INFO - Singer - Id: 4, First name: BB, Last name: King, Birthday: 1940-09-16
INFO -    Album - id: 5, Singer id: 4, Title: A Heart Full of Blues,
    Release Date: 1962-04-20
INFO  -   Album - id: 4, Singer id: 4, Title: My Kind of Blues,
    Release Date: 1961-08-18
INFO - Singer - Id: 1, First name: John, Last name: Mayer, Birthday: 1977-10-16
INFO -    Album - id: 1, Singer id: 1, Title: The Search For Everything,
    Release Date: 2017-01-20
INFO -    Album - id: 2, Singer id: 1, Title: Battle Studies,
    Release Date:  2009-11-17
INFO -    Instrument:  Piano
INFO -    Instrument: Guitar
INFO - Singer - Id: 3, First name: John, Last name: Butler, Birthday: 1975-04-01
INFO - Singer - Id: 2, First name: Eric, Last name: Clapton, Birthday: 1945-03-30
INFO -    Album - id: 3, Singer id: 2, Title: From  The Cradle,
   Release Date: 1994-09-13
INFO -    Instrument: Guitar
</pre>
                                        <div class="Para" id="Par91">From the 
                                            <span class="EmphasisFontCategoryNonProportional">INFO</span> log record, you can see that the 
                                            <span class="EmphasisFontCategoryNonProportional">id</span> of the newly saved singer was populated correctly. Hibernate will also show all the SQL statements being fired to the database.
                                        </div>
                                    </div>
                                    <div class="Section2 RenderAsSection2" id="Sec10">
                                        <h3 class="Heading">Updating Data</h3>
                                        <div class="Para" id="Par92"> 
                                            <span id="ITerm76">Updating data                                  </span> 
                                            <span id="ITerm77"> </span> is as easy as inserting data. Let’s go through an example. Suppose for a singer with an ID of 1, we want to update its first name and remove an album. To test the update operation, the following code snippet shows the 
                                            <span class="EmphasisFontCategoryNonProportional">testUpdate()</span> method:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.After</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Before</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Test</span>;<span style="color:#00f;font-weight:700">.</span><span style="color:#00f;font-weight:700">.</span>.

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerJPATest</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">SingerJPATest</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SingerService</span> singerService;

    <span style="color:#00f;font-weight:700">@Before</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setUp</span>() {
        ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">JpaConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        singerService <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">SingerService</span><span style="color:#00f;font-weight:700">.</span>class);
        assertNotNull(singerService);
    }

    <span style="color:#00f;font-weight:700">@Test</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">testUpdate</span>() {
        <span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">=</span> singerService<span style="color:#00f;font-weight:700">.</span>findById(<span style="color:#0000cd">1L</span>);
        <span style="color:#06f;font-style:italic">//making sure such singer exists assertNotNull(singer);</span>
        <span style="color:#06f;font-style:italic">//making sure we got expected record assertEquals(&quot;Mayer&quot;, singer.getLastName());</span>
        <span style="color:#06f;font-style:italic">//retrieve the  album</span>
        <span style="color:#00f;font-weight:700">Album</span> album <span style="color:#00f;font-weight:700">=</span> singer<span style="color:#00f;font-weight:700">.</span>getAlbums()<span style="color:#00f;font-weight:700">.</span>stream()
                .filter(a <span style="color:#00f;font-weight:700">-</span><span style="color:#00f;font-weight:700">&gt;</span> a<span style="color:#00f;font-weight:700">.</span>getTitle()<span style="color:#00f;font-weight:700">.</span>equals(<span style="color:#036a07">Battle  Studies</span>))<span style="color:#00f;font-weight:700">.</span>findFirst()<span style="color:#00f;font-weight:700">.</span>get();
        singer<span style="color:#00f;font-weight:700">.</span>setFirstName(<span style="color:#036a07">John Clayton</span>);
        singer<span style="color:#00f;font-weight:700">.</span>removeAlbum(album);
        singerService<span style="color:#00f;font-weight:700">.</span>save(singer);
        listSingersWithAlbum(singerService<span style="color:#00f;font-weight:700">.</span>findAllWithAlbum());
    }
    .<span style="color:#00f;font-weight:700">.</span>.

    <span style="color:#00f;font-weight:700">@After</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">tearDown</span>() {
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                                        <div class="Para" id="Par94">We first retrieve the record with an ID of 1 and we change the first name. Then we loop through the album objects and retrieve the one with title 
                                            <span class="EmphasisTypeItalic">Battle Studies</span> and remove it from the singer’s 
                                            <span class="EmphasisFontCategoryNonProportional">albums</span> property. Finally, we call the 
                                            <span class="EmphasisFontCategoryNonProportional">SingerService.save()</span> method again. When you run the program, you will see the following output (other output was omitted):
                                        </div>
                                        <pre style="background:#fff;color:#000">---- Listing singers with instruments:
Singer - Id: 1, First name: John Clayton, Last name: Mayer, Birthday: 1977-10-16
    Album - id: 1, Singer id: 1, Title: The Search For Everything,
       Release Date:  2017-01-20
    Instrument: Piano
    Instrument: Guitar
Singer - Id: 2, First name: Eric, Last name: Clapton, Birthday: 1945-03-30
     Album - id: 3, Singer id: 2, Title: From The Cradle,
        Release Date: 1994-09-13
     Instrument: Guitar
Singer - Id: 3, First name: John, Last name: Butler, Birthday: 1975-04-01
</pre>
                                        <div class="Para" id="Par96">You will see that the first 
                                            <span id="ITerm80">name                                  </span> 
                                            <span id="ITerm81"> </span> was updated and the album was removed. The album can be removed because of the 
                                            <span class="EmphasisFontCategoryNonProportional">rphanRemoval=true</span> attribute that was defined in the one-to-many association, which instructs the JPA provider (Hibernate) to remove all orphan records that exist in the database but are no longer found in the object when persisted.
                                        </div>
                                        <div class="Para" id="Par97"> 
                                            <div class="ProgramCode" id="PC29">
                                                <div class="FixedLine">@OneToMany(mappedBy = &quot;singer&quot;, cascade=CascadeType.ALL, orphanRemoval=true)</div>
                                            </div>                                             
                                        </div>
                                    </div>
                                    <div class="Section2 RenderAsSection2" id="Sec11">
                                        <h3 class="Heading">Deleting data</h3>
                                        <div class="Para" id="Par98"> 
                                            <span id="ITerm82">Deleting data                                  </span> 
                                            <span id="ITerm83"> </span> is just as simple. Simply call the 
                                            <span class="EmphasisFontCategoryNonProportional">EntityManager.remove()</span> method and pass in the singer object. The following code snippet shows the updated code to delete a singer:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.service</span>;
.<span style="color:#00f;font-weight:700">.</span>.

@Service(<span style="color:#036a07">jpaSingerService</span>)
@<span style="color:#00f;font-weight:700">Repository</span>
@<span style="color:#00f;font-weight:700">Transactional</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerServiceImpl</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerService</span> {
    <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#c5060b;font-weight:700">ALL_SINGER_NATIVE_QUERY</span> <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#036a07">select id, first_name, last_name, birth_date, version from singer</span>;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">SingerServiceImpl</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">@PersistenceContext</span>
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">EntityManager</span> em;

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">delete</span>(<span style="color:#00f;font-weight:700">Singer</span> <span style="font-style:italic">singer</span>) {
        <span style="color:#00f;font-weight:700">Singer</span> mergedSinger <span style="color:#00f;font-weight:700">=</span> em<span style="color:#00f;font-weight:700">.</span>merge(singer);
        em<span style="color:#00f;font-weight:700">.</span>remove(mergedSinger);
        logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">Singer with id: </span> <span style="color:#00f;font-weight:700">+</span> singer<span style="color:#00f;font-weight:700">.</span>getId() <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07"> deleted successfully</span>);
    }
       .<span style="color:#00f;font-weight:700">.</span>.
}
</pre>
                                        <div class="Para" id="Par100">First the 
                                            <span class="EmphasisFontCategoryNonProportional">EntityManager.merge()</span> 
                                            <span id="ITerm84">method                                  </span> 
                                            <span id="ITerm85"> </span> is invoked to merge the state of the entity into the current persistence context. The 
                                            <span class="EmphasisFontCategoryNonProportional">merge()</span> method returns the managed entity instance. Then 
                                            <span class="EmphasisFontCategoryNonProportional">EntityManager.remove()</span> is called, passing in the managed singer entity instance. The remove operation deletes the singer record, together with all its associated information, including albums and instruments, as we defined the 
                                            <span class="EmphasisFontCategoryNonProportional">cascade=CascadeType.ALL</span> in the mapping. To test the delete operation, the 
                                            <span class="EmphasisFontCategoryNonProportional">testDelete()</span> method can be used, which is depicted in the following code snippet:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.After</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Before</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Test</span>;<span style="color:#00f;font-weight:700">.</span><span style="color:#00f;font-weight:700">.</span>.

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerJPATest</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">SingerJPATest</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SingerService</span> singerService;

    <span style="color:#00f;font-weight:700">@Before</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setUp</span>() {
        ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">JpaConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        singerService <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">SingerService</span><span style="color:#00f;font-weight:700">.</span>class);
        assertNotNull(singerService);
    }

    <span style="color:#00f;font-weight:700">@Test</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">testDelete</span>() {
        <span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">=</span> singerService<span style="color:#00f;font-weight:700">.</span>findById(<span style="color:#0000cd">2l</span>);
        <span style="color:#06f;font-style:italic">//making sure such singer exists</span>
        assertNotNull(singer);
        singerService<span style="color:#00f;font-weight:700">.</span>delete(singer);
        listSingersWithAlbum(singerService<span style="color:#00f;font-weight:700">.</span>findAllWithAlbum());
    }
    .<span style="color:#00f;font-weight:700">.</span>.

    <span style="color:#00f;font-weight:700">@After</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">tearDown</span>() {
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                                        <div class="Para" id="Par102">The previous listing retrieves the 
                                            <span id="ITerm86">singer                                  </span> 
                                            <span id="ITerm87"> </span> with an ID of 
                                            <span class="EmphasisFontCategoryNonProportional">2</span> and then calls the 
                                            <span class="EmphasisFontCategoryNonProportional">delete()</span> method to delete the singer information. Running the program produces the following output:
                                        </div>
                                        <pre style="background:#fff;color:#000"> ---- Listing singers with instruments:
Singer - Id: 1, First name: John, Last name: Mayer, Birthday: 1977-10-16
    Album - id: 1, Singer id: 1, Title: The Search For Everything,
         Release Date: 2017-01-20
     Album - id: 2, Singer id: 1, Title: Battle Studies,
        Release Date: 2009-11-17
     Instrument: Piano
    Instrument: Guitar
Singer - Id: 3, First name: John, Last name: Butler, Birthday: 1975-04-01
</pre>
                                        <div class="Para ParaOneEmphasisChild" id="Par104">You can see that the singer with an ID of 
                                            <span class="EmphasisFontCategoryNonProportional">1</span> was deleted.
                                        </div>
                                    </div>
                                </div>
                                <div class="Section1 RenderAsSection1" id="Sec12">
                                    <h2 class="Heading">Using a Native Query</h2>
                                    <div class="Para ParaOneEmphasisChild" id="Par105">Having discussed performing trivial database operations by using JPA, now let’s move on to some more advanced topics. Sometimes you may want to have absolute control over the query that will be submitted to the database. One example is using a hierarchical query in an Oracle database. This kind of query is database-specific and referred to as a 
                                        <span class="EmphasisTypeItalic">native query</span>.
                                    </div>
                                    <div class="Para" id="Par106">JPA supports the execution of native 
                                        <span id="ITerm88">queries                            </span>; 
                                        <span class="EmphasisFontCategoryNonProportional">EntityManager</span> will submit the query to the database as is, without any mapping or transformation performed. One main benefit of using JPA native queries is the mapping of 
                                        <span class="EmphasisFontCategoryNonProportional">ResultSet</span> back to the ORM-mapped entity classes. The following two sections discuss how to use a native query to retrieve all singers and directly map 
                                        <span class="EmphasisFontCategoryNonProportional">ResultSet</span> back to the 
                                        <span class="EmphasisFontCategoryNonProportional">Singer</span> objects.
                                    </div>
                                </div>
                                <div class="Section1 RenderAsSection1" id="Sec13">
                                    <h2 class="Heading">Using a Simple Native Query</h2>
                                    <div class="Para ParaOneEmphasisChild" id="Par107">To demonstrate how to use a native query, let’s implement a new method to retrieve all the singers from the database. The following snippet shows the new method that must be added to the 
                                        <span class="EmphasisFontCategoryNonProportional">SingerServiceImpl</span>:
                                    </div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.service</span>;
.<span style="color:#00f;font-weight:700">.</span>.

@Service(<span style="color:#036a07">jpaSingerService</span>)
@<span style="color:#00f;font-weight:700">Repository</span>
@<span style="color:#00f;font-weight:700">Transactional</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerServiceImpl</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerService</span> {
    <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#c5060b;font-weight:700">ALL_SINGER_NATIVE_QUERY</span> <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#036a07">select id, first_name, last_name, birth_date, version from singer</span>;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">SingerServiceImpl</span><span style="color:#00f;font-weight:700">.</span>class);

    <span style="color:#00f;font-weight:700">@Transactional</span>(<span style="color:#c5060b;font-weight:700">readOnly</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAllByNativeQuery</span>() {
        <span style="color:#00f;font-weight:700">return</span> em<span style="color:#00f;font-weight:700">.</span>createNativeQuery(<span style="color:#c5060b;font-weight:700">ALL_SINGER_NATIVE_QUERY</span>,
                <span style="color:#00f;font-weight:700">Singer</span><span style="color:#00f;font-weight:700">.</span>class)<span style="color:#00f;font-weight:700">.</span>getResultList();
    }
    .<span style="color:#00f;font-weight:700">.</span>.
}
</pre>
                                    <div class="Para" id="Par109">You can see that the native query is just a simple SQL statement to retrieve all the columns from the 
                                        <span class="EmphasisFontCategoryNonProportional">SINGER</span> table. To 
                                        <span id="ITerm89">create and execute                  </span> the query, 
                                        <span class="EmphasisFontCategoryNonProportional">EntityManager.createNativeQuery()</span> was first called, passing in the query string as well as the result type. The result type should be a mapped entity class (in this case the 
                                        <span class="EmphasisFontCategoryNonProportional">Singer</span> class). The 
                                        <span class="EmphasisFontCategoryNonProportional">createNativeQuery()</span> method returns a 
                                        <span class="EmphasisFontCategoryNonProportional">Query</span> interface, which provides the 
                                        <span class="EmphasisFontCategoryNonProportional">getResultList()</span> operation to get the result list. The JPA provider will execute the query and transform the 
                                        <span class="EmphasisFontCategoryNonProportional">ResultSet</span> object into the entity instances, based on the JPA mappings defined in the entity class. Executing the previous method produces the same result as the 
                                        <span class="EmphasisFontCategoryNonProportional">findAll()</span> method.
                                    </div>
                                </div>
                                <div class="Section1 RenderAsSection1" id="Sec14">
                                    <h2 class="Heading">Native Querying with SQL ResultSet Mapping</h2>
                                    <div class="Para" id="Par110">Besides the mapped domain object, you can pass in a string, which indicates the name of a SQL 
                                        <span class="EmphasisFontCategoryNonProportional">ResultSet</span> mapping. A SQL 
                                        <span class="EmphasisFontCategoryNonProportional">ResultSet</span> mapping is defined at the entity class level by using the 
                                        <span class="EmphasisFontCategoryNonProportional">@SqlResultSetMapping</span> annotation. A 
                                        <span id="ITerm90">SQL <span class="EmphasisFontCategoryNonProportional">ResultSet</span> mapping                            </span> can have one or more entity and column mappings.
                                    </div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.Entity</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.Table</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.SqlResultSetMapping</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.EntityResult</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.io.Serializable</span>;
.<span style="color:#00f;font-weight:700">.</span>.

@<span style="color:#00f;font-weight:700">Entity</span>
@Table(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">singer</span>)
@SqlResultSetMapping(
        name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">singerResult</span>,
        entities <span style="color:#00f;font-weight:700">=</span> @EntityResult(entityClass <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">Singer</span><span style="color:#00f;font-weight:700">.</span>class)
)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Singer</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Serializable</span> {
 .<span style="color:#00f;font-weight:700">.</span>.
}
</pre>
                                    <div class="Para" id="Par112">A SQL 
                                        <span class="EmphasisFontCategoryNonProportional">ResultSet</span> mapping called 
                                        <span class="EmphasisFontCategoryNonProportional">singerResult</span> is defined for the entity class, with the 
                                        <span class="EmphasisFontCategoryNonProportional">entityClass</span> attribute in the 
                                        <span class="EmphasisFontCategoryNonProportional">Singer</span> class itself. JPA supports more complex mapping for multiple entities and supports mapping down to column-level mapping.
                                    </div>
                                    <div class="Para" id="Par113">After the SQL 
                                        <span class="EmphasisFontCategoryNonProportional">ResultSet</span> mapping is defined, the 
                                        <span id="ITerm91"> <span class="EmphasisFontCategoryNonProportional">findAllByNativeQuery()</span> method                            </span> can be invoked using the 
                                        <span class="EmphasisFontCategoryNonProportional">ResultSet</span> mapping’s name. The following code snippet shows the updated 
                                        <span class="EmphasisFontCategoryNonProportional">findAllByNativeQuery()</span> method:
                                    </div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.service</span>;
.<span style="color:#00f;font-weight:700">.</span>.

@Service(<span style="color:#036a07">jpaSingerService</span>)
@<span style="color:#00f;font-weight:700">Repository</span>
@<span style="color:#00f;font-weight:700">Transactional</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerServiceImpl</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerService</span> {
    <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#c5060b;font-weight:700">ALL_SINGER_NATIVE_QUERY</span> <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#036a07">select id, first_name, last_name, birth_date, version from singer</span>;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">SingerServiceImpl</span><span style="color:#00f;font-weight:700">.</span>class);

    <span style="color:#00f;font-weight:700">@Transactional</span>(<span style="color:#c5060b;font-weight:700">readOnly</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAllByNativeQuery</span>() {
        <span style="color:#00f;font-weight:700">return</span> em<span style="color:#00f;font-weight:700">.</span>createNativeQuery(<span style="color:#c5060b;font-weight:700">ALL_SINGER_NATIVE_QUERY</span>,
                <span style="color:#036a07">singerResult</span>)<span style="color:#00f;font-weight:700">.</span>getResultList();
    }
    .<span style="color:#00f;font-weight:700">.</span>.
}
</pre>
                                    <div class="Para ParaOneEmphasisChild" id="Par115">As you can see, JPA also provides strong support for executing native queries, with a flexible SQL 
                                        <span class="EmphasisFontCategoryNonProportional">ResultSet</span> mapping facility provided.
                                    </div>
                                    <div class="Section2 RenderAsSection2" id="Sec15">
                                        <h3 class="Heading">Using the JPA 2 Criteria API for a Criteria Query</h3>
                                        <div class="Para" id="Par116">Most applications provide a front end for users to search for information. Most likely, a large number of searchable fields are displayed, and the users enter information in only some of them and do the search. It’s difficult to prepare a large number of queries, with each possible combination of parameters that users may choose to enter. In this situation, the criteria API query feature comes to the rescue.</div>
                                        <div class="Para" id="Par117">In JPA 2, one major new feature introduced was a strongly typed Criteria API query. In this new Criteria API, the criteria being passed into the query is based on the mapped entity classes’ meta-model. As a result, each criteria specified is strongly typed, and errors will be discovered at compile time, rather than runtime.</div>
                                        <div class="Para" id="Par118">In the JPA Criteria API, an entity class meta-model is represented by the entity class name with a suffix of an underscore (
                                            <span class="EmphasisFontCategoryNonProportional">_</span>). For example, the 
                                            <span id="ITerm92">meta-model class                      </span> for the 
                                            <span class="EmphasisFontCategoryNonProportional">Singer</span> entity class is 
                                            <span class="EmphasisFontCategoryNonProportional">Singer_</span>. The following code snippet shows the 
                                            <span class="EmphasisFontCategoryNonProportional">Singer_</span> class:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Date</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.annotation.Generated</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.metamodel.SetAttribute</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.metamodel.SingularAttribute</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.metamodel.StaticMetamodel</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.sound.midi.Instrument</span>;

@Generated(value <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">org.hibernate.jpamodelgen.JPAMetaModelEntityProcessor</span>)
@StaticMetamodel(<span style="color:#00f;font-weight:700">Singer</span><span style="color:#00f;font-weight:700">.</span>class)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">abstract</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Singer_</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> volatile <span style="color:#00f;font-weight:700">SingularAttribute&lt;<span style="color:#00f;font-weight:700">Singer</span>, <span style="color:#00f;font-weight:700">String</span>&gt;</span> firstName;
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> volatile <span style="color:#00f;font-weight:700">SingularAttribute&lt;<span style="color:#00f;font-weight:700">Singer</span>, <span style="color:#00f;font-weight:700">String</span>&gt;</span> lastName;
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> volatile <span style="color:#00f;font-weight:700">SetAttribute&lt;<span style="color:#00f;font-weight:700">Singer</span>, <span style="color:#00f;font-weight:700">Album</span>&gt;</span> albums;
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> volatile <span style="color:#00f;font-weight:700">SetAttribute&lt;<span style="color:#00f;font-weight:700">Singer</span>, <span style="color:#00f;font-weight:700">Instrument</span>&gt;</span> instruments;
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> volatile <span style="color:#00f;font-weight:700">SingularAttribute&lt;<span style="color:#00f;font-weight:700">Singer</span>, <span style="color:#00f;font-weight:700">Long</span>&gt;</span> id;
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> volatile <span style="color:#00f;font-weight:700">SingularAttribute&lt;<span style="color:#00f;font-weight:700">Singer</span>, <span style="color:#00f;font-weight:700">Integer</span>&gt;</span> version;
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> volatile <span style="color:#00f;font-weight:700">SingularAttribute&lt;<span style="color:#00f;font-weight:700">Singer</span>, <span style="color:#00f;font-weight:700">Date</span>&gt;</span> birthDate;
}
</pre>
                                        <div class="Para" id="Par120">The 
                                            <span id="ITerm93">meta-model class                      </span> is annotated with 
                                            <span class="EmphasisFontCategoryNonProportional">@StaticMetamodel</span>, and the attribute is the mapped entity class. Within the class are the declaration of each attribute and its related types.
                                        </div>
                                        <div class="Para" id="Par121">It would be tedious to code and maintain those meta-model classes. However, tools can help generate those meta-model classes automatically based on the JPA mappings within the entity classes. The one provided by Hibernate is called Hibernate Metamodel Generator (
                                            <span class="ExternalRef"><a href="http://www.hibernate.org/subprojects/jpamodelgen.html"><span class="RefSource"> <span class="EmphasisFontCategoryNonProportional">www.hibernate.org/subprojects/jpamodelgen.html</span> </span></a></span>).
                                        </div>
                                        <div class="Para" id="Par122">The way you go about generating your meta-model classes depends on what tools you are using to develop and build your project. We recommend reading the “Usage” section of the documentation (
                                            <span class="ExternalRef"><a href="http://docs.jboss.org/hibernate/jpamodelgen/1.3/reference/en-US/html_single/#chapter-usage"><span class="RefSource"> <span class="EmphasisFontCategoryNonProportional">http://docs.jboss.org/hibernate/jpamodelgen/1.3/reference/en-US/html_single/#chapter-usage</span> </span></a></span>) for specific details. The sample code that comes as part of this book uses Gradle to generate the meta-classes. The required dependency for meta-model class generation is the 
                                            <span class="EmphasisFontCategoryNonProportional">hibernate-jpamodelgen</span> library. This dependency is configured with its version in the 
                                            <span class="EmphasisFontCategoryNonProportional">pro-spring-15/build.gradle</span> file.
                                        </div>
                                        <pre style="background:#fff;color:#000">ext {
    .<span style="color:#00f;font-weight:700">.</span>.
    <span style="color:#06f;font-style:italic">//persistency libraries</span>
    hibernateVersion <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">5.2.10.Final</span>
    hibernateJpaVersion <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">1.0.0.Final</span>
    hibernate <span style="color:#00f;font-weight:700">=</span>  [
    .<span style="color:#00f;font-weight:700">.</span>.
     jpaModelGen<span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">org.hibernate:hibernate-jpamodelgen:$hibernateVersion</span>,
    jpaApi     <span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">org.hibernate.javax.persistence:hibernate-jpa-2.1-api:
         $hibernateJpaVersion</span>,
    querydslapt<span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">com.mysema.querydsl:querydsl-apt:2.7.1</span>
    ]
    .<span style="color:#00f;font-weight:700">.</span>.
</pre>
                                        <div class="Para" id="Par124">This is the main library for generating meta-
                                            <span id="ITerm94">model                      </span> classes. It is used in 
                                            <span class="EmphasisFontCategoryNonProportional">chapter08/jpa-criteria/build.gradle</span> by the 
                                            <span class="EmphasisFontCategoryNonProportional">generateQueryDSL</span> Gradle task to generate the meta-model classes, before compiling the module. The 
                                            <span class="EmphasisFontCategoryNonProportional">chapter08/jpa-criteria/build.gradle</span> configuration is shown here:
                                        </div>
                                        <pre style="background:#fff;color:#000">sourceSets {
    generated
}
sourceSets<span style="color:#00f;font-weight:700">.</span>generated<span style="color:#00f;font-weight:700">.</span>java<span style="color:#00f;font-weight:700">.</span>srcDirs <span style="color:#00f;font-weight:700">=</span>  [<span style="color:#036a07">src/main/generated</span>]
configurations {
    querydslapt
}
dependencies {
    compile hibernate<span style="color:#00f;font-weight:700">.</span>querydslapt, hibernate<span style="color:#00f;font-weight:700">.</span>jpaModelGen
}
task generateQueryDSL(type<span style="color:#00f;font-weight:700">:</span> <span style="color:#00f;font-weight:700">JavaCompile</span>, group<span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">build</span>,
    description<span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">Generates the QueryDSL query types</span>) {
    source <span style="color:#00f;font-weight:700">=</span> sourceSets<span style="color:#00f;font-weight:700">.</span>main<span style="color:#00f;font-weight:700">.</span>java
    classpath <span style="color:#00f;font-weight:700">=</span> configurations<span style="color:#00f;font-weight:700">.</span>compile <span style="color:#00f;font-weight:700">+</span> configurations<span style="color:#00f;font-weight:700">.</span>querydslapt
    options<span style="color:#00f;font-weight:700">.</span>compilerArgs <span style="color:#00f;font-weight:700">=</span> [
    <span style="color:#036a07">-proc:only</span>,
    <span style="color:#036a07">-processor</span>, <span style="color:#036a07">org.hibernate.jpamodelgen.JPAMetaModelEntityProcessor</span>
    ]
    destinationDir <span style="color:#00f;font-weight:700">=</span> sourceSets<span style="color:#00f;font-weight:700">.</span>generated<span style="color:#00f;font-weight:700">.</span>java<span style="color:#00f;font-weight:700">.</span>srcDirs<span style="color:#00f;font-weight:700">.</span>iterator<span style="color:#00f;font-weight:700">.</span>next
}
compileJava<span style="color:#00f;font-weight:700">.</span>dependsOn generateQueryDSL
</pre>
                                        <div class="Para" id="Par126">With the class generation strategy set up, let’s define a query that accepts both the first name and last name for searching singers. The following code snippet shows the definition of the new method 
                                            <span id="ITerm95"> <span class="EmphasisFontCategoryNonProportional">findByCriteriaQuery()</span> </span> in the 
                                            <span class="EmphasisFontCategoryNonProportional">SingerService</span> interface:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">SingerService</span> {
    <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAll</span>();

    <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAllWithAlbum</span>();

    <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">findById</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">id</span>);

    <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">save</span>(<span style="color:#00f;font-weight:700">Singer</span> <span style="font-style:italic">singer</span>);

    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">delete</span>(<span style="color:#00f;font-weight:700">Singer</span> <span style="font-style:italic">singer</span>);

    <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAllByNativeQuery</span>();

    <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findByCriteriaQuery</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">firstName</span>, <span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">lastName</span>);
}
    <span style="color:#00f;font-weight:700">The</span> n
</pre>
                                        <div class="Para" id="Par128">The next code snippet shows the implementation of the 
                                            <span id="ITerm96"> <span class="EmphasisFontCategoryNonProportional">findByCriteriaQuery()</span> </span> method using a JPA 2 criteria API query:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Service</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Repository</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.annotation.Transactional</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.PersistenceContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.EntityManager</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.TypedQuery</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.criteria.CriteriaBuilder</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.criteria.CriteriaQuery</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.criteria.Root</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.criteria.JoinType</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.criteria.Predicate</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.apache.commons.logging.Log</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.apache.commons.logging.LogFactory</span>;

@Service(<span style="color:#036a07">jpaSingerService</span>)
@<span style="color:#00f;font-weight:700">Repository</span>
@<span style="color:#00f;font-weight:700">Transactional</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerServiceImpl</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerService</span> {
    <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#c5060b;font-weight:700">ALL_SINGER_NATIVE_QUERY</span> <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#036a07">select id, first_name,  last_name, birth_date,  version from singer</span>;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Log</span> log <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LogFactory</span><span style="color:#00f;font-weight:700">.</span>getLog(<span style="color:#00f;font-weight:700">SingerServiceImpl</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">@PersistenceContext</span>
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">EntityManager</span> em;
    .<span style="color:#00f;font-weight:700">.</span>.

    <span style="color:#00f;font-weight:700">@Transactional</span>(<span style="color:#c5060b;font-weight:700">readOnly</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findByCriteriaQuery</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">firstName</span>, <span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">lastName</span>) {
        log<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">Finding singer for firstName: </span> <span style="color:#00f;font-weight:700">+</span> firstName
                <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07"> and  lastName: </span> <span style="color:#00f;font-weight:700">+</span> lastName);
        <span style="color:#00f;font-weight:700">CriteriaBuilder</span> cb <span style="color:#00f;font-weight:700">=</span> em<span style="color:#00f;font-weight:700">.</span>getCriteriaBuilder();
        <span style="color:#00f;font-weight:700">CriteriaQuery&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> criteriaQuery <span style="color:#00f;font-weight:700">=</span> cb<span style="color:#00f;font-weight:700">.</span>createQuery(<span style="color:#00f;font-weight:700">Singer</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">Root&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> singerRoot <span style="color:#00f;font-weight:700">=</span> criteriaQuery<span style="color:#00f;font-weight:700">.</span>from(<span style="color:#00f;font-weight:700">Singer</span><span style="color:#00f;font-weight:700">.</span>class);
        singerRoot<span style="color:#00f;font-weight:700">.</span>fetch(<span style="color:#00f;font-weight:700">Singer_</span><span style="color:#00f;font-weight:700">.</span>albums, <span style="color:#00f;font-weight:700">JoinType</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>LEFT</span>);
        singerRoot<span style="color:#00f;font-weight:700">.</span>fetch(<span style="color:#00f;font-weight:700">Singer_</span><span style="color:#00f;font-weight:700">.</span>instruments, <span style="color:#00f;font-weight:700">JoinType</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>LEFT</span>);
        criteriaQuery<span style="color:#00f;font-weight:700">.</span>select(singerRoot)<span style="color:#00f;font-weight:700">.</span>distinct(<span style="color:#585cf6;font-weight:700">true</span>);
        <span style="color:#00f;font-weight:700">Predicate</span> criteria <span style="color:#00f;font-weight:700">=</span> cb<span style="color:#00f;font-weight:700">.</span>conjunction();
        <span style="color:#00f;font-weight:700">if</span> (firstName <span style="color:#00f;font-weight:700">!=</span> <span style="color:#585cf6;font-weight:700">null</span>) {
            <span style="color:#00f;font-weight:700">Predicate</span> p <span style="color:#00f;font-weight:700">=</span> cb<span style="color:#00f;font-weight:700">.</span>equal(singerRoot<span style="color:#00f;font-weight:700">.</span>get(<span style="color:#00f;font-weight:700">Singer_</span><span style="color:#00f;font-weight:700">.</span>firstName),
                    firstName);
            criteria <span style="color:#00f;font-weight:700">=</span> cb<span style="color:#00f;font-weight:700">.</span>and(criteria, p);
        }
        <span style="color:#00f;font-weight:700">if</span> (lastName <span style="color:#00f;font-weight:700">!=</span> <span style="color:#585cf6;font-weight:700">null</span>) {
            <span style="color:#00f;font-weight:700">Predicate</span> p <span style="color:#00f;font-weight:700">=</span> cb<span style="color:#00f;font-weight:700">.</span>equal(singerRoot<span style="color:#00f;font-weight:700">.</span>get(<span style="color:#00f;font-weight:700">Singer_</span><span style="color:#00f;font-weight:700">.</span>lastName),
                    lastName);
            criteria <span style="color:#00f;font-weight:700">=</span> cb<span style="color:#00f;font-weight:700">.</span>and(criteria, p);
        }
        criteriaQuery<span style="color:#00f;font-weight:700">.</span>where(criteria);
        <span style="color:#00f;font-weight:700">return</span> em<span style="color:#00f;font-weight:700">.</span>createQuery(criteriaQuery)<span style="color:#00f;font-weight:700">.</span>getResultList();
    }
}
</pre>
                                        <div class="Para" id="Par130">Let’s break down the Criteria API usage.
                                            <div class="UnorderedList">
                                                <ul class="UnorderedListMarkBullet">
                                                    <li>
                                                        <div class="Para" id="Par131"> 
                                                            <span class="EmphasisFontCategoryNonProportional">EntityManager.getCriteriaBuilder()</span> is called to retrieve an instance of 
                                                            <span id="ITerm97"> <span class="EmphasisFontCategoryNonProportional">CriteriaBuilder</span> </span>.
                                                        </div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par132">A typed query is created using 
                                                            <span class="EmphasisFontCategoryNonProportional">CriteriaBuilder.createQuery()</span>, passing in 
                                                            <span class="EmphasisFontCategoryNonProportional">Singer</span> as the result type.
                                                        </div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par133">The 
                                                            <span id="ITerm98"> <span class="EmphasisFontCategoryNonProportional">CriteriaQuery.from()</span> method                                  </span> is invoked, passing in the entity class. The result is a query root object (the 
                                                            <span class="EmphasisFontCategoryNonProportional">Root&lt;Singer&gt;</span> interface) corresponding to the specified entity. The query root object forms the basis for path expressions within the query.
                                                        </div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par134">The two 
                                                            <span id="ITerm99"> <span class="EmphasisFontCategoryNonProportional">Root.fetch()</span> method                                  </span> calls enforce the eager fetching of the associations relating to albums and instruments. The 
                                                            <span class="EmphasisFontCategoryNonProportional">JoinType.LEFT</span> argument specifies an outer join. Calling the 
                                                            <span class="EmphasisFontCategoryNonProportional">Root.fetch()</span> method with 
                                                            <span class="EmphasisFontCategoryNonProportional">JoinType.LEFT</span> as the second argument is equivalent to specifying the left join fetch join operation in JPQL.
                                                        </div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par135">The 
                                                            <span id="ITerm100"> <span class="EmphasisFontCategoryNonProportional">CriteriaQuery.select()</span> method                                  </span> is called and passes the root query object as the result type. The 
                                                            <span class="EmphasisFontCategoryNonProportional">distinct()</span> method with true means that duplicate records should be eliminated.
                                                        </div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par136">A 
                                                            <span class="EmphasisFontCategoryNonProportional">Predicate</span> instance is obtained by calling the 
                                                            <span class="EmphasisFontCategoryNonProportional">CriteriaBuilder.conjunction()</span> method, which means that a conjunction of one or more restrictions is made. A 
                                                            <span class="EmphasisFontCategoryNonProportional">Predicate</span> can be a simple or compound predicate, and a predicate is a restriction that indicates the selection criteria defined by an expression.
                                                        </div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par137">The first- and last-name arguments are checked. For each not 
                                                            <span class="EmphasisFontCategoryNonProportional">null</span> argument, a new 
                                                            <span class="EmphasisFontCategoryNonProportional">Predicate</span> will be constructed using the 
                                                            <span class="EmphasisFontCategoryNonProportional">CriteriaBuilder()</span> method (that is, the 
                                                            <span class="EmphasisFontCategoryNonProportional">CriteriaBuilder.and()</span> method). The method 
                                                            <span class="EmphasisFontCategoryNonProportional">equal()</span> is to specify an equal restriction, within which 
                                                            <span class="EmphasisFontCategoryNonProportional">Root.get()</span> is called, passing in the corresponding attribute of the entity class meta-model to which the restriction applies. The constructed predicate is then “conjunct” with the existing predicate (stored by the variable criteria) by calling the 
                                                            <span class="EmphasisFontCategoryNonProportional">CriteriaBuilder.and()</span> method.
                                                        </div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par138">The 
                                                            <span class="EmphasisFontCategoryNonProportional">Predicate</span> is 
                                                            <span id="ITerm101">constructed                                  </span> with all the criteria and restrictions and passed as the 
                                                            <span class="EmphasisFontCategoryNonProportional">where</span> clause to the query by calling the 
                                                            <span class="EmphasisFontCategoryNonProportional">CriteriaQuery.where()</span> method.
                                                        </div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par139">Finally, 
                                                            <span class="EmphasisFontCategoryNonProportional">CriteriaQuery</span> is passed to 
                                                            <span class="EmphasisFontCategoryNonProportional">EntityManager. EntityManager</span> then constructs the query based on the 
                                                            <span class="EmphasisFontCategoryNonProportional">CriteriaQuery</span> value passed in, executes the query, and returns the result.
                                                        </div>
                                                    </li>
                                                </ul>
                                            </div>                                             
                                        </div>
                                        <div class="Para" id="Par140">To 
                                            <span id="ITerm102">test                      </span> the criteria query operation, the following code snippet shows the updated 
                                            <span class="EmphasisFontCategoryNonProportional">SingerJPATest</span> class:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.config.JpaConfig</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.Album</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.Instrument</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.SingerService</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.After</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Before</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Test</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.Logger</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.LoggerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.AnnotationConfigApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericApplicationContext</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">org.junit.Assert.assertEquals</span>;
<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">org.junit.Assert.assertNotNull</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerJPATest</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">SingerJPATest</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SingerService</span> singerService;

    <span style="color:#00f;font-weight:700">@Before</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setUp</span>() {
        ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">JpaConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        singerService <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#036a07">jpaSingerService</span>, <span style="color:#00f;font-weight:700">SingerService</span><span style="color:#00f;font-weight:700">.</span>class);
        assertNotNull(singerService);
    }

    <span style="color:#00f;font-weight:700">@Test</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">tesFindByCriteriaQuery</span>() {
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> singers <span style="color:#00f;font-weight:700">=</span> singerService<span style="color:#00f;font-weight:700">.</span>findByCriteriaQuery(<span style="color:#036a07">John</span>, <span style="color:#036a07">Mayer</span>);
        assertEquals(<span style="color:#0000cd">1</span>, singers<span style="color:#00f;font-weight:700">.</span>size());
        listSingersWithAlbum(singers);
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">listSingersWithAlbum</span>(<span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="font-style:italic">singers</span>) {
        logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07"> ---- Listing singers with instruments:</span>);
        singers<span style="color:#00f;font-weight:700">.</span>forEach(s <span style="color:#00f;font-weight:700">-</span><span style="color:#00f;font-weight:700">&gt;</span> {
            logger<span style="color:#00f;font-weight:700">.</span>info(s<span style="color:#00f;font-weight:700">.</span>toString());
            <span style="color:#00f;font-weight:700">if</span> (s<span style="color:#00f;font-weight:700">.</span>getAlbums() <span style="color:#00f;font-weight:700">!=</span> <span style="color:#585cf6;font-weight:700">null</span>) {
                s<span style="color:#00f;font-weight:700">.</span>getAlbums()<span style="color:#00f;font-weight:700">.</span>forEach(a <span style="color:#00f;font-weight:700">-</span><span style="color:#00f;font-weight:700">&gt;</span> logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">&quot;<span style="color:#26b31a">\t</span>&quot;</span> <span style="color:#00f;font-weight:700">+</span> a<span style="color:#00f;font-weight:700">.</span>toString()));
            }
            <span style="color:#00f;font-weight:700">if</span> (s<span style="color:#00f;font-weight:700">.</span>getInstruments() <span style="color:#00f;font-weight:700">!=</span> <span style="color:#585cf6;font-weight:700">null</span>) {
                s<span style="color:#00f;font-weight:700">.</span>getInstruments()<span style="color:#00f;font-weight:700">.</span>forEach(i <span style="color:#00f;font-weight:700">-</span><span style="color:#00f;font-weight:700">&gt;</span> logger<span style="color:#00f;font-weight:700">.</span>info
                        (<span style="color:#036a07">&quot;<span style="color:#26b31a">\t</span>Instrument: &quot;</span> <span style="color:#00f;font-weight:700">+</span> i<span style="color:#00f;font-weight:700">.</span>getInstrumentId()));
            }
        });
    }

    <span style="color:#00f;font-weight:700">@After</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">tearDown</span>() {
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                                        <div class="Para" id="Par142"> 
                                            <span id="ITerm104">Running                      </span> the program produces the following output (other output was omitted, but the generated query was kept):
                                        </div>
                                        <pre style="background:#fff;color:#000">INFO   o.h.h.i.QueryTranslatorFactoryInitiator -
      HHH000397: Using ASTQueryTranslatorFactory
INFO   c.a.p.c.SingerServiceImpl -
      Finding singer for firstName: John and lastName: Mayer
Hibernate:
    select
     distinct singer0_.ID as  ID1_2_0_,
     albums1_.ID as ID1_0_1_,
     instrument3_.INSTRUMENT_ID as INSTRUME1_1_2_,
     singer0_.BIRTH_DATE as BIRTH_DA2_2_0_,
     singer0_.FIRST_NAME as FIRST_NA3_2_0_,
     singer0_.LAST_NAME as LAST_NAM4_2_0_,
     singer0_.VERSION as VERSION5_2_0_,
     albums1_.RELEASE_DATE as RELEASE_2_0_1_,
     albums1_.SINGER_ID as SINGER_I5_0_1_,
     albums1_.title as title3_0_1_,
     albums1_.VERSION as VERSION4_0_1_,
     albums1_.SINGER_ID as SINGER_I5_0_0__,
     albums1_.ID as  ID1_0_0__,
     instrument2_.SINGER_ID as  SINGER_I1_3_1__,
     instrument2_.INSTRUMENT_ID  as  INSTRUME2_3_1__
         from
     singer singer0_
         left outer join
     album albums1_
         on singer0_.ID=albums1_.SINGER_ID
         left outer join
     singer_instrument  instrument2_
         on singer0_.ID=instrument2_.SINGER_ID
         left outer join
     instrument instrument3_
         on instrument2_.INSTRUMENT_ID=instrument3_.INSTRUMENT_ID
         where
     1=1
     and singer0_.FIRST_NAME=?
     and singer0_.LAST_NAME=?
INFO   c.a.p.c.SingerJPATest -  ---- Listing  singers with instruments:
INFO   c.a.p.c.SingerJPATest - Singer - Id: 1, First name: John, Last name: Mayer,
   Birthday: 1977-10-16
INFO   c.a.p.c.SingerJPATest -    Album - id: 2, Singer id: 1,
   Title: Battle Studies, Release Date:  2009-11-17
INFO   c.a.p.c.SingerJPATest -    Album  - id: 1, Singer id: 1,
   Title: The Search For   Everything, Release Date: 2017-01-20
INFO   c.a.p.c.SingerJPATest -    Instrument: Guitar
INFO   c.a.p.c.SingerJPATest -    Instrument:  Piano
</pre>
                                        <div class="Para ParaOneEmphasisChild" id="Par144">You can try a different combination or pass a 
                                            <span class="EmphasisFontCategoryNonProportional">null</span> value to either of the arguments to observe the output.
                                        </div>
                                    </div>
                                </div>
                                <div class="Section1 RenderAsSection1" id="Sec16">
                                    <h2 class="Heading">Introducing Spring Data JPA</h2>
                                    <div class="Para" id="Par145">The Spring Data JPA project is a subproject under the Spring Data umbrella project. The main objective of the project is to provide additional features for simplifying application development with JPA.</div>
                                    <div class="Para ParaOneEmphasisChild" id="Par146">Spring Data JPA provides several main features. In this section, we discuss two. The first one is the 
                                        <span class="EmphasisFontCategoryNonProportional">Repository</span> abstraction, and the other one is the entity listener for keeping track of basic audit information of entity classes.
                                    </div>
                                    <div class="Section2 RenderAsSection2" id="Sec17">
                                        <h3 class="Heading">Adding Spring Data JPA Library Dependencies</h3>
                                        <div class="Para" id="Par147">To use 
                                            <span id="ITerm106">Spring Data JPA                      </span>, we need to add the dependency to the project. Here you can see the Gradle configuration necessary to use Spring Data JPA:
                                        </div>
                                        <div class="Para" id="Par148"> 
                                            <div class="ProgramCode" id="PC43">
                                                <div class="LineGroup">
                                                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#06f;font-style:italic">//pro-spring-15/build.gradle</span>
ext {
    <span style="color:#06f;font-style:italic">//spring libs</span>
    springVersion <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">5.0.0.M5</span>
    bootVersion <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">2.0.0.BUILD-SNAPSHOT</span>
    springDataVersion <span style="color:#00f;font-weight:700">=</span>  <span style="color:#036a07">2.0.0.M2</span>
    .<span style="color:#00f;font-weight:700">.</span>.
    spring <span style="color:#00f;font-weight:700">=</span> [
            data <span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">org.springframework.data:spring-data-jpa:$springDataVersion</span>,
            .<span style="color:#00f;font-weight:700">.</span>.
    ]
     .<span style="color:#00f;font-weight:700">.</span>.
}
<span style="color:#06f;font-style:italic">//chapter08/spring-data-jpa/build.gradle</span>
dependencies {
    compile spring<span style="color:#00f;font-weight:700">.</span>aop, spring<span style="color:#00f;font-weight:700">.</span>data, misc<span style="color:#00f;font-weight:700">.</span>guava
}
</pre></div>
                                                </div>
                                            </div>                                             
                                        </div>
                                    </div>
                                    <div class="Section2 RenderAsSection2" id="Sec18">
                                        <h3 class="Heading">Using Spring Data JPA Repository Abstraction for Database Operations</h3>
                                        <div class="Para" id="Par149">One of the main concepts of Spring Data and all its subprojects is the 
                                            <span id="ITerm107"> <span class="EmphasisFontCategoryNonProportional">Repository</span> abstraction                      </span>, which belongs to the Spring Data Commons project (
                                            <span class="ExternalRef"><a href="https://github.com/spring-projects/spring-data-commons"><span class="RefSource"> <span class="EmphasisFontCategoryNonProportional">https://github.com/spring-projects/spring-data-commons</span> </span></a></span>). At the time of this writing, it’s at version 2.0.0 M2. In Spring Data JPA, the repository abstraction wraps the underlying JPA 
                                            <span class="EmphasisFontCategoryNonProportional">EntityManager</span> and provides a simpler interface for JPA-based data access. The central interface within Spring Data is the 
                                            <span class="EmphasisFontCategoryNonProportional">org.springframework.data.repository.Repository&lt;T,ID extends Serializable&gt;</span> interface, which is a marker interface belonging to the Spring Data Commons distribution. Spring Data provides various extensions of the 
                                            <span class="EmphasisFontCategoryNonProportional">Repository</span> interface; one of them is the 
                                            <span class="EmphasisFontCategoryNonProportional">org.springframework.data.repository.CrudRepository</span> interface (which also belongs to the Spring Data Commons project), which we discuss in this section.
                                        </div>
                                        <div class="Para" id="Par150">The 
                                            <span class="EmphasisFontCategoryNonProportional">CrudRepository</span> 
                                            <span id="ITerm108">interface                      </span> provides a number of commonly used methods. The following code snippet shows the interface declaration, which is extracted from Spring Data Commons project source code:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">org.springframework.data.repository</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.io.Serializable</span>;

@<span style="color:#00f;font-weight:700">NoRepositoryBean</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">CrudRepository</span>&lt;T, ID <span style="color:#00f;font-weight:700">extends</span> <span style="font-style:italic">Serializable</span>&gt;
        extends <span style="font-style:italic">Repository&lt;<span style="color:#00f;font-weight:700">T</span>, <span style="color:#00f;font-weight:700">ID</span>&gt;</span> {
    <span style="color:#00f;font-weight:700">long</span> <span style="color:#0000a2;font-weight:700">count</span>();

    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">delete</span>(<span style="color:#00f;font-weight:700">ID</span> <span style="font-style:italic">id</span>);

    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">delete</span>(<span style="color:#00f;font-weight:700">Iterable&lt;? extends <span style="color:#00f;font-weight:700">T</span>&gt;</span> <span style="font-style:italic">entities</span>);

    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">delete</span>(<span style="color:#00f;font-weight:700">T</span> <span style="font-style:italic">entity</span>);

    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">deleteAll</span>();

    <span style="color:#00f;font-weight:700">boolean</span> <span style="color:#0000a2;font-weight:700">exists</span>(<span style="color:#00f;font-weight:700">ID</span> <span style="font-style:italic">id</span>);

    <span style="color:#00f;font-weight:700">Iterable&lt;<span style="color:#00f;font-weight:700">T</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAll</span>();

    <span style="color:#00f;font-weight:700">T</span> <span style="color:#0000a2;font-weight:700">findOne</span>(<span style="color:#00f;font-weight:700">ID</span> <span style="font-style:italic">id</span>);

    <span style="color:#00f;font-weight:700">Iterable&lt;<span style="color:#00f;font-weight:700">T</span>&gt;</span> <span style="color:#0000a2;font-weight:700">save</span>(<span style="color:#00f;font-weight:700">Iterable&lt;? extends <span style="color:#00f;font-weight:700">T</span>&gt;</span> <span style="font-style:italic">entities</span>);

    <span style="color:#00f;font-weight:700">T</span> <span style="color:#0000a2;font-weight:700">save</span>(<span style="color:#00f;font-weight:700">T</span> <span style="font-style:italic">entity</span>);
}
</pre>
                                        <div class="Para" id="Par152">Although the method naming is self-explanatory, it’s better to show how the 
                                            <span class="EmphasisFontCategoryNonProportional">Repository</span> abstraction works by going through a simple example. Let’s revise the 
                                            <span class="EmphasisFontCategoryNonProportional">SingerService</span> interface a bit, down to just three finder methods. The following code snippet shows the revised 
                                            <span class="EmphasisFontCategoryNonProportional">SingerService</span> interface:
                                        </div>
                                        <div class="Para" id="Par153"> 
                                            <div class="ProgramCode" id="PC45">
                                                <div class="LineGroup">
                                                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities.Singer</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">SingerService</span> {
    <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAll</span>();

    <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findByFirstName</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">firstName</span>);

    <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findByFirstNameAndLastName</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">firstName</span>, <span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">lastName</span>);
}
</pre></div>
                                                </div>
                                            </div>                                             
                                        </div>
                                        <div class="Para" id="Par154">The next step is to prepare the 
                                            <span class="EmphasisFontCategoryNonProportional">SingerRepository</span> interface, which extends the 
                                            <span class="EmphasisFontCategoryNonProportional">CrudRepository</span> interface. The following code snippet shows the 
                                            <span class="EmphasisFontCategoryNonProportional">SingerRepository</span> interface:
                                        </div>
                                        <div class="Para" id="Par155"> 
                                            <div class="ProgramCode" id="PC46">
                                                <div class="LineGroup">
                                                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.data.repository.CrudRepository</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">SingerRepository</span> <span style="color:#00f;font-weight:700">extends</span> <span style="font-style:italic">CrudRepository&lt;<span style="color:#00f;font-weight:700">Singer</span>, <span style="color:#00f;font-weight:700">Long</span>&gt;</span> {
    <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findByFirstName</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">firstName</span>);

    <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findByFirstNameAndLastName</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">firstName</span>, <span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">lastName</span>);
}
</pre></div>
                                                </div>
                                            </div>                                             
                                        </div>
                                        <div class="Para" id="Par156">We just need to declare two 
                                            <span id="ITerm109">methods                      </span> in this interface, as the 
                                            <span class="EmphasisFontCategoryNonProportional">findAll()</span> method is already provided by the 
                                            <span class="EmphasisFontCategoryNonProportional">CrudRepository.findAll()</span> method. As shown in the preceding listing, the 
                                            <span class="EmphasisFontCategoryNonProportional">SingerRepository</span> interface extends the 
                                            <span class="EmphasisFontCategoryNonProportional">CrudRepository</span> interface, passing in the entity class (
                                            <span class="EmphasisFontCategoryNonProportional">Singer</span>) and the ID type (
                                            <span class="EmphasisFontCategoryNonProportional">Long</span>). One fancy aspect of Spring Data’s 
                                            <span class="EmphasisFontCategoryNonProportional">Repository</span> abstraction is that when you use the common naming convention of 
                                            <span class="EmphasisFontCategoryNonProportional">findByFirstName</span> and 
                                            <span class="EmphasisFontCategoryNonProportional">findByFirstNameAndLastName</span>, you don’t need to provide Spring Data JPA with the named query. Instead, Spring Data JPA will “infer” and construct the query for you based on the method name. For example, for the 
                                            <span class="EmphasisFontCategoryNonProportional">findByFirstName()</span> method, Spring Data JPA will automatically prepare the query 
                                            <span class="EmphasisFontCategoryNonProportional">select s from Singer s where s.firstName = :firstName</span> for you and set the named parameter 
                                            <span class="EmphasisFontCategoryNonProportional">firstName</span> from the argument.
                                        </div>
                                        <div class="Para" id="Par157">To use the 
                                            <span class="EmphasisFontCategoryNonProportional">Repository</span> abstraction, you have to define it in Spring’s configuration. The following code snippet shows the configuration file (
                                            <span class="EmphasisFontCategoryNonProportional">app-context-annotation.xml</span>):
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#68685b">&lt;?<span style="color:#888">xml</span><span style="color:#888"> version</span>=<span style="color:#888">1.0</span> <span style="color:#888"> encoding</span>=<span style="color:#888">UTF-8</span>?&gt;</span>
<span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span> <span style="font-style:italic">xmlns</span>=<span style="color:#036a07">http://www.springframework.org/schema/beans</span>
    <span style="font-style:italic">xmlns</span>:xsi=<span style="color:#036a07">http://www.w3.org/2001/XMLSchema-instance</span>
    <span style="font-style:italic">xmlns</span>:context=<span style="color:#036a07">http://www.springframework.org/schema/context</span>
    <span style="font-style:italic">xmlns</span>:jdbc=<span style="color:#036a07">http://www.springframework.org/schema/jdbc</span>
    <span style="font-style:italic">xmlns</span>:jpa=<span style="color:#036a07">http://www.springframework.org/schema/data/jpa</span>
    <span style="font-style:italic">xmlns</span>:tx=<span style="color:#036a07">http://www.springframework.org/schema/tx</span>
    <span style="font-style:italic">xsi</span>:schemaLocation=<span style="color:#036a07">http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd
        http://www.springframework.org/schema/jdbc
        http://www.springframework.org/schema/jdbc/spring-jdbc.xsd
        http://www.springframework.org/schema/data/jpa
        http://www.springframework.org/schema/data/jpa/spring-jpa.xsd
        http://www.springframework.org/schema/tx
        http://www.springframework.org/schema/tx/spring-tx.xsd</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">jdbc</span><span style="font-weight:700">:</span><span style="font-weight:700">embedded-database</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">dataSource</span>  <span style="font-style:italic">type</span>=<span style="color:#036a07">H2</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">jdbc</span><span style="font-weight:700">:</span><span style="font-weight:700">script</span>  <span style="font-style:italic">location</span>=<span style="color:#036a07">classpath:db/schema.sql</span>/&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">jdbc</span><span style="font-weight:700">:</span><span style="font-weight:700">script</span> <span style="font-style:italic">location</span>=<span style="color:#036a07">classpath:db/test-data.sql</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">jdbc</span><span style="font-weight:700">:</span><span style="font-weight:700">embedded-database</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">transactionManager</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">org.springframework.orm.jpa.JpaTransactionManager</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">property</span>  <span style="font-style:italic">name</span>=<span style="color:#036a07">entityManagerFactory</span> <span style="font-style:italic">ref</span>=<span style="color:#036a07">emf</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">bean</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">tx</span><span style="font-weight:700">:</span><span style="font-weight:700">annotation-driven</span> <span style="font-style:italic">transaction-manager</span>=<span style="color:#036a07">transactionManager</span> /&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">emf</span>
       <span style="font-style:italic">class</span>=<span style="color:#036a07">org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">property</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">dataSource</span> <span style="font-style:italic">ref</span>=<span style="color:#036a07">dataSource</span> /&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">property</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">jpaVendorAdapter</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter</span> /&gt;</span>
        <span style="color:#1c02ff">&lt;/<span style="font-weight:700">property</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">property</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">packagesToScan</span>
             <span style="font-style:italic">value</span>=<span style="color:#036a07">com.apress.prospring5.ch8.entities</span>/&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">property</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">jpaProperties</span>&gt;</span>
            <span style="color:#1c02ff">&lt;<span style="font-weight:700">props</span>&gt;</span>
                <span style="color:#1c02ff">&lt;<span style="font-weight:700">prop</span> <span style="font-style:italic">key</span>=<span style="color:#036a07">hibernate.dialect</span>&gt;</span>
                    org.hibernate.dialect.H2Dialect
                <span style="color:#1c02ff">&lt;/<span style="font-weight:700">prop</span>&gt;</span>
                <span style="color:#1c02ff">&lt;<span style="font-weight:700">prop</span> <span style="font-style:italic">key</span>=<span style="color:#036a07">hibernate.max_fetch_depth</span>&gt;</span>3<span style="color:#1c02ff">&lt;/<span style="font-weight:700">prop</span>&gt;</span>
                <span style="color:#1c02ff">&lt;<span style="font-weight:700">prop</span> <span style="font-style:italic">key</span>=<span style="color:#036a07">hibernate.jdbc.fetch_size</span>&gt;</span>50<span style="color:#1c02ff">&lt;/<span style="font-weight:700">prop</span>&gt;</span>
                <span style="color:#1c02ff">&lt;<span style="font-weight:700">prop</span> <span style="font-style:italic">key</span>=<span style="color:#036a07">hibernate.jdbc.batch_size</span>&gt;</span>10<span style="color:#1c02ff">&lt;/<span style="font-weight:700">prop</span>&gt;</span>
                <span style="color:#1c02ff">&lt;<span style="font-weight:700">prop</span> <span style="font-style:italic">key</span>=<span style="color:#036a07">hibernate.show_sql</span>&gt;</span>true<span style="color:#1c02ff">&lt;/<span style="font-weight:700">prop</span>&gt;</span>
            <span style="color:#1c02ff">&lt;/<span style="font-weight:700">props</span>&gt;</span>
        <span style="color:#1c02ff">&lt;/<span style="font-weight:700">property</span>&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">bean</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">context</span><span style="font-weight:700">:</span><span style="font-weight:700">annotation-config</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">context</span><span style="font-weight:700">:</span><span style="font-weight:700">component-scan</span> <span style="font-style:italic">base-package</span>=<span style="color:#036a07">com.apress.prospring5.ch8</span>  &gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">context</span><span style="font-weight:700">:</span><span style="font-weight:700">exclude-filter</span> <span style="font-style:italic">type</span>=<span style="color:#036a07">annotation</span>
            <span style="font-style:italic">expression</span>=<span style="color:#036a07">org.springframework.context.annotation.Configuration</span> /&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">context</span><span style="font-weight:700">:</span><span style="font-weight:700">component-scan</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">jpa</span><span style="font-weight:700">:</span><span style="font-weight:700">repositories</span> <span style="font-style:italic">base-package</span>=<span style="color:#036a07">com.apress.prospring5.ch8</span>
                      <span style="font-style:italic">entity-manager-factory-ref</span>=<span style="color:#036a07">emf</span>
                      <span style="font-style:italic">transaction-manager-ref</span>=<span style="color:#036a07">transactionManager</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
                                        <div class="Para" id="Par159">First, we need to add the 
                                            <span class="EmphasisFontCategoryNonProportional">jpa</span> 
                                            <span id="ITerm111">namespace                      </span> in the configuration file. Then, the 
                                            <span class="EmphasisFontCategoryNonProportional">&lt;jpa:repositories&gt;</span> tag is used to configure Spring Data JPA’s 
                                            <span class="EmphasisFontCategoryNonProportional">Repository</span> abstraction. We instruct Spring to scan the package 
                                            <span class="EmphasisFontCategoryNonProportional">com.apress.prospring5.ch8</span> for repository interfaces and to pass in 
                                            <span class="EmphasisFontCategoryNonProportional">EntityManagerFactory</span> and the transaction manager, respectively.
                                        </div>
                                        <div class="Para" id="Par160">In case you haven’t noticed, there is an 
                                            <span class="EmphasisFontCategoryNonProportional">&lt;context:exclude-filter&gt;</span> in the 
                                            <span class="EmphasisFontCategoryNonProportional">&lt;context:component-scan&gt;</span> definition that specified classes annotated with 
                                            <span class="EmphasisFontCategoryNonProportional">@Configuration</span>. That element is introduced to exclude from scanning the Java configuration class that can be used instead of the XML configuration previously depicted. That class is shown here:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.config</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.Logger</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.LoggerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Bean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.ComponentScan</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Configuration</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.data.jpa.repository.config.EnableJpaRepositories</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.jdbc.datasource.embedded.EmbeddedDatabaseBuilder</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.jdbc.datasource.embedded.EmbeddedDatabaseType</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.orm.jpa.JpaTransactionManager</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.orm.jpa.JpaVendorAdapter</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.PlatformTransactionManager</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.annotation.EnableTransactionManagement</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.EntityManagerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.sql.DataSource</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Properties</span>;

@<span style="color:#00f;font-weight:700">Configuration</span>
@<span style="color:#00f;font-weight:700">EnableTransactionManagement</span>
@ComponentScan(basePackages <span style="color:#00f;font-weight:700">=</span> {<span style="color:#036a07">com.apress.prospring5.ch8</span>})
@EnableJpaRepositories(basePackages <span style="color:#00f;font-weight:700">=</span> {<span style="color:#036a07">com.apress.prospring5.ch8</span>})
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">DataJpaConfig</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">DataJpaConfig</span><span style="color:#00f;font-weight:700">.</span>class);

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">DataSource</span> <span style="color:#0000a2;font-weight:700">dataSource</span>() {
        <span style="color:#00f;font-weight:700">try</span> {
            <span style="color:#00f;font-weight:700">EmbeddedDatabaseBuilder</span> dbBuilder <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">EmbeddedDatabaseBuilder</span>();
            <span style="color:#00f;font-weight:700">return</span> dbBuilder<span style="color:#00f;font-weight:700">.</span>setType(<span style="color:#00f;font-weight:700">EmbeddedDatabaseType</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>H2</span>)
                    .addScripts(<span style="color:#036a07">classpath:db/schema.sql</span>,
                            <span style="color:#036a07">classpath:db/test-data.sql</span>)<span style="color:#00f;font-weight:700">.</span>build();
        } <span style="color:#00f;font-weight:700">catch</span> (<span style="color:#00f;font-weight:700">Exception</span> e) {
            logger<span style="color:#00f;font-weight:700">.</span>error(<span style="color:#036a07">Embedded  DataSource bean  cannot be  created!</span>, e);
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#585cf6;font-weight:700">null</span>;
        }
    }

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">PlatformTransactionManager</span> <span style="color:#0000a2;font-weight:700">transactionManager</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">JpaTransactionManager</span>(entityManagerFactory());
    }

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">JpaVendorAdapter</span> <span style="color:#0000a2;font-weight:700">jpaVendorAdapter</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HibernateJpaVendorAdapter</span>();
    }

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Properties</span> <span style="color:#0000a2;font-weight:700">hibernateProperties</span>() {
        <span style="color:#00f;font-weight:700">Properties</span> hibernateProp <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Properties</span>();
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.dialect</span>, <span style="color:#036a07">org.hibernate.dialect.H2Dialect</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.format_sql</span>, <span style="color:#585cf6;font-weight:700">true</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.use_sql_comments</span>, <span style="color:#585cf6;font-weight:700">true</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.show_sql</span>, <span style="color:#585cf6;font-weight:700">true</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.max_fetch_depth</span>, <span style="color:#0000cd">3</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.jdbc.batch_size</span>, <span style="color:#0000cd">10</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.jdbc.fetch_size</span>, <span style="color:#0000cd">50</span>);
        <span style="color:#00f;font-weight:700">return</span> hibernateProp;
    }

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">EntityManagerFactory</span> <span style="color:#0000a2;font-weight:700">entityManagerFactory</span>() {
        <span style="color:#00f;font-weight:700">LocalContainerEntityManagerFactoryBean</span> factoryBean <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">LocalContainerEntityManagerFactoryBean</span>();
        factoryBean<span style="color:#00f;font-weight:700">.</span>setPackagesToScan(<span style="color:#036a07">com.apress.prospring5.ch8.entities</span>);
        factoryBean<span style="color:#00f;font-weight:700">.</span>setDataSource(dataSource());
        factoryBean<span style="color:#00f;font-weight:700">.</span>setJpaVendorAdapter(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HibernateJpaVendorAdapter</span>());
        factoryBean<span style="color:#00f;font-weight:700">.</span>setJpaProperties(hibernateProperties());
        factoryBean<span style="color:#00f;font-weight:700">.</span>setJpaVendorAdapter(jpaVendorAdapter());
        factoryBean<span style="color:#00f;font-weight:700">.</span>afterPropertiesSet();
        <span style="color:#00f;font-weight:700">return</span> factoryBean<span style="color:#00f;font-weight:700">.</span>getNativeEntityManagerFactory();
    }
}
</pre>
                                        <div class="Para" id="Par162">The only configuration element used here to enable support of Spring Data JPA repositories is the 
                                            <span class="EmphasisFontCategoryNonProportional">@</span> 
                                            <span id="ITerm114"> <span class="EmphasisFontCategoryNonProportional">EnableJpaRepositories</span> </span> annotation. Using the 
                                            <span class="EmphasisFontCategoryNonProportional">basePackages</span> attribute, the packages where the custom 
                                            <span class="EmphasisFontCategoryNonProportional">Repository</span> extensions are scanned and the repository beans are created. The rest of the dependencies (the 
                                            <span class="EmphasisFontCategoryNonProportional">emf</span> and the 
                                            <span class="EmphasisFontCategoryNonProportional">transactionManager</span> beans) are injected automatically by the Spring container.
                                        </div>
                                        <div class="Para ParaOneEmphasisChild" id="Par163">The following code snippet shows the implementation of the three finder methods of the 
                                            <span class="EmphasisFontCategoryNonProportional">SingerService</span> interface:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Service</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.annotation.Transactional</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Autowired</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.google.common.collect.Lists</span>;

@Service(<span style="color:#036a07">springJpaSingerService</span>)
@<span style="color:#00f;font-weight:700">Transactional</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerServiceImpl</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerService</span> {
    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SingerRepository</span> singerRepository;

    <span style="color:#00f;font-weight:700">@Transactional</span>(<span style="color:#c5060b;font-weight:700">readOnly</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAll</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">Lists</span><span style="color:#00f;font-weight:700">.</span>newArrayList(singerRepository<span style="color:#00f;font-weight:700">.</span>findAll());
    }

    <span style="color:#00f;font-weight:700">@Transactional</span>(<span style="color:#c5060b;font-weight:700">readOnly</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findByFirstName</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">firstName</span>) {
        <span style="color:#00f;font-weight:700">return</span> singerRepository<span style="color:#00f;font-weight:700">.</span>findByFirstName(firstName);
    }

    <span style="color:#00f;font-weight:700">@Transactional</span>(<span style="color:#c5060b;font-weight:700">readOnly</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findByFirstNameAndLastName</span>(
            <span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">firstName</span>, <span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">lastName</span>) {
        <span style="color:#00f;font-weight:700">return</span> singerRepository<span style="color:#00f;font-weight:700">.</span>findByFirstNameAndLastName(
                firstName, lastName);
    }
}
</pre>
                                        <div class="Para" id="Par165">You can see that instead of 
                                            <span class="EmphasisFontCategoryNonProportional">EntityManager</span>, we just need to inject the 
                                            <span class="EmphasisFontCategoryNonProportional">singerRepository</span> bean, generated by Spring based on the 
                                            <span class="EmphasisFontCategoryNonProportional">SingerRepository</span> interface, into the service class, and Spring Data JPA will do all the low-level work for us. In the following code 
                                            <span id="ITerm115">snippet                      </span>, you can see a testing class, and by now you should already be familiar with its content:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.config.DataJpaConfig</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.After</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Before</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Test</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.Logger</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.LoggerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.AnnotationConfigApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericApplicationContext</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">org.junit.Assert.assertEquals</span>;
<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">org.junit.Assert.assertNotNull</span>;
<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">org.junit.Assert.assertTrue</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerDataJPATest</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">SingerDataJPATest</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SingerService</span> singerService;

    <span style="color:#00f;font-weight:700">@Before</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setUp</span>() {
        ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">DataJpaConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        singerService <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">SingerService</span><span style="color:#00f;font-weight:700">.</span>class);
        assertNotNull(singerService);
    }

    <span style="color:#00f;font-weight:700">@Test</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">testFindAll</span>() {
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> singers <span style="color:#00f;font-weight:700">=</span> singerService<span style="color:#00f;font-weight:700">.</span>findAll();
        assertTrue(singers<span style="color:#00f;font-weight:700">.</span>size() <span style="color:#00f;font-weight:700">&gt;</span> <span style="color:#0000cd">0</span>);
        listSingers(singers);
    }

    <span style="color:#00f;font-weight:700">@Test</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">testFindByFirstName</span>() {
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> singers <span style="color:#00f;font-weight:700">=</span> singerService<span style="color:#00f;font-weight:700">.</span>findByFirstName(<span style="color:#036a07">John</span>);
        assertTrue(singers<span style="color:#00f;font-weight:700">.</span>size() <span style="color:#00f;font-weight:700">&gt;</span> <span style="color:#0000cd">0</span>);
        assertEquals(<span style="color:#0000cd">2</span>, singers<span style="color:#00f;font-weight:700">.</span>size());
        listSingers(singers);
    }

    <span style="color:#00f;font-weight:700">@Test</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">testFindByFirstNameAndLastName</span>() {
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> singers <span style="color:#00f;font-weight:700">=</span>
                singerService<span style="color:#00f;font-weight:700">.</span>findByFirstNameAndLastName(<span style="color:#036a07">John</span>, <span style="color:#036a07">Mayer</span>);
        assertTrue(singers<span style="color:#00f;font-weight:700">.</span>size() <span style="color:#00f;font-weight:700">&gt;</span> <span style="color:#0000cd">0</span>);
        assertEquals(<span style="color:#0000cd">1</span>, singers<span style="color:#00f;font-weight:700">.</span>size());
        listSingers(singers);
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">listSingers</span>(<span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="font-style:italic">singers</span>) {
        logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07"> ----  Listing singers:</span>);
        <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">:</span> singers) {
            logger<span style="color:#00f;font-weight:700">.</span>info(singer<span style="color:#00f;font-weight:700">.</span>toString());
        }
    }

    <span style="color:#00f;font-weight:700">@After</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">tearDown</span>() {
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                                        <div class="Para" id="Par167">Running the test class, all tests should pass, and the expected data will be printed in the console.</div>
                                    </div>
                                </div>
                                <div class="Section1 RenderAsSection1" id="Sec19">
                                    <h2 class="Heading">Using <span id="ITerm117">JpaRepository        </span> </h2>
                                    <div class="Para" id="Par168">Besides 
                                        <span class="EmphasisFontCategoryNonProportional">CrudRepository</span>, there is an even more advanced Spring interface that can make creating custom repositories easier; it’s called the 
                                        <span class="EmphasisFontCategoryNonProportional">JpaRepository</span> interface, and it provides batch, paging, and sorting operations. Figure 
                                        <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Chapter.html#Fig1">8-1</a></span> shows the relationship between 
                                        <span class="EmphasisFontCategoryNonProportional">JpaRepository</span> and the 
                                        <span class="EmphasisFontCategoryNonProportional">CrudRepository</span> 
                                        <span id="ITerm118">interface        </span>. Depending on the complexity of the application, you can choose to use 
                                        <span class="EmphasisFontCategoryNonProportional">CrudRepository</span> or 
                                        <span class="EmphasisFontCategoryNonProportional">JpaRepository</span>. As you can see from Figure 
                                        <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Chapter.html#Fig1">8-1</a></span>, 
                                        <span class="EmphasisFontCategoryNonProportional">JpaRepository</span> extends 
                                        <span class="EmphasisFontCategoryNonProportional">CrudRepository</span>; thus, it provides all the functionalities this interface does.
                                        <div class="Figure" id="Fig1">
                                            <div class="MediaObject" id="MO1">
                                                <img alt="A315511_5_En_8_Fig1_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Fig1_HTML.jpg" height="702" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Fig1_HTML.jpg" width="560"/>
                                            </div>
                                            <div class="Caption" xml:lang="en">
                                                <div class="CaptionContent">
                                                    <span class="CaptionNumber">Figure 8-1.</span>
                                                    <div class="SimplePara">Spring Data JPA Repository interfaces hierarchy</div>
                                                </div>
                                            </div>
                                        </div>                                         
                                    </div>
                                </div>
                                <div class="Section1 RenderAsSection1" id="Sec20">
                                    <h2 class="Heading">Spring Data JPA with Custom Queries</h2>
                                    <div class="Para" id="Par169">In complex applications, you might need custom queries that cannot be “inferred” by Spring. In this case, the query must be defined explicitly using the 
                                        <span class="EmphasisFontCategoryNonProportional">@Query</span> 
                                        <span id="ITerm119">annotation                            </span>. Let’s use this annotation to search for all music albums containing 
                                        <span class="EmphasisTypeItalic">The</span> in their title. The following code snippet depicts the 
                                        <span class="EmphasisFontCategoryNonProportional">AlbumRepository</span> interface:
                                    </div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.repos</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities.Album</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.data.jpa.repository.JpaRepository</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.data.jpa.repository.Query</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.data.repository.query.Param</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">AlbumRepository</span> <span style="color:#00f;font-weight:700">extends</span> <span style="font-style:italic">JpaRepository&lt;<span style="color:#00f;font-weight:700">Album</span>, <span style="color:#00f;font-weight:700">Long</span>&gt;</span> {
    <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Album</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findBySinger</span>(<span style="color:#00f;font-weight:700">Singer</span> <span style="font-style:italic">singer</span>);

    <span style="color:#00f;font-weight:700">@Query</span>(<span style="color:#036a07">select a from Album a where a.title like %:title%</span>)
    <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Album</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findByTitle</span>(@<span style="color:#00f;font-weight:700">Param</span>(&quot;<span style="font-style:italic">title</span>&quot;) String t);
}
</pre>
                                    <div class="Para" id="Par171">The previous query has a named parameter called 
                                        <span class="EmphasisFontCategoryNonProportional">title</span>. When the name of the named parameter is the same as the name of the argument in the method annotated with 
                                        <span class="EmphasisFontCategoryNonProportional">@Query</span>, the 
                                        <span class="EmphasisFontCategoryNonProportional">@Param</span> annoation is not needed. But if the method argument has a different name, the 
                                        <span id="ITerm120"> <span class="EmphasisFontCategoryNonProportional">@Param</span> </span> annotation is needed to tell Spring that the value of this argument is to be injected in the named parameter in the query.
                                    </div>
                                    <div class="Para" id="Par172"> 
                                        <span class="EmphasisFontCategoryNonProportional">AlbumServiceImpl</span> is quite simple and only uses the 
                                        <span class="EmphasisFontCategoryNonProportional">albumRepository</span> bean to call its methods.
                                    </div>
                                    <pre style="background:#fff;color:#000"><span style="color:#06f;font-style:italic">//AlbumService.java</span>
<span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.services</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities.Album</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities.Singer</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">AlbumService</span> {
    <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Album</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findBySinger</span>(<span style="color:#00f;font-weight:700">Singer</span> <span style="font-style:italic">singer</span>);

    <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Album</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findByTitle</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">title</span>);
}
<span style="color:#06f;font-style:italic">//AlbumServiceImpl.java</span>
<span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.services</span>;
        <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities.Album</span>;
        <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities.Singer</span>;
        <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.repos.AlbumRepository</span>;
        <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Autowired</span>;
        <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Service</span>;
        <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.annotation.Transactional</span>;
        <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

@Service(<span style="color:#036a07">springJpaAlbumService</span>)
@<span style="color:#00f;font-weight:700">Transactional</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AlbumServiceImpl</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">AlbumService</span> {
    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">AlbumRepository</span> albumRepository;

    <span style="color:#00f;font-weight:700">@Transactional</span>(<span style="color:#c5060b;font-weight:700">readOnly</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Album</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findBySinger</span>(<span style="color:#00f;font-weight:700">Singer</span> <span style="font-style:italic">singer</span>) {
        <span style="color:#00f;font-weight:700">return</span> albumRepository<span style="color:#00f;font-weight:700">.</span>findBySinger(singer);
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Album</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findByTitle</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">title</span>) {
        <span style="color:#00f;font-weight:700">return</span> albumRepository<span style="color:#00f;font-weight:700">.</span>findByTitle(title);
    }
}
</pre>
                                    <div class="Para" id="Par174">To test the 
                                        <span class="EmphasisFontCategoryNonProportional">findByTitle(..)</span> method, you can use the 
                                        <span id="ITerm121">following                            </span> test class:
                                    </div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.config.DataJpaConfig</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities.Album</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.services.AlbumService</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.After</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Before</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.junit.Test</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.Logger</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.LoggerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.AnnotationConfigApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericApplicationContext</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">org.junit.Assert.assertEquals</span>;
<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">org.junit.Assert.assertNotNull</span>;
<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">org.junit.Assert.assertTrue</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerDataJPATest</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">SingerDataJPATest</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">AlbumService</span> albumService;

    <span style="color:#00f;font-weight:700">@Before</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setUp</span>() {
        ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">DataJpaConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        albumService <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">AlbumService</span><span style="color:#00f;font-weight:700">.</span>class);
        assertNotNull(albumService);
    }

    <span style="color:#00f;font-weight:700">@Test</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">testFindByTitle</span>() {
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Album</span>&gt;</span> albums <span style="color:#00f;font-weight:700">=</span> albumService<span style="color:#00f;font-weight:700">.</span>findByTitle(<span style="color:#036a07">The</span>);
        assertTrue(albums<span style="color:#00f;font-weight:700">.</span>size() <span style="color:#00f;font-weight:700">&gt;</span> <span style="color:#0000cd">0</span>);
        assertEquals(<span style="color:#0000cd">2</span>, albums<span style="color:#00f;font-weight:700">.</span>size());
        albums<span style="color:#00f;font-weight:700">.</span>forEach(a <span style="color:#00f;font-weight:700">-</span><span style="color:#00f;font-weight:700">&gt;</span> logger<span style="color:#00f;font-weight:700">.</span>info(a<span style="color:#00f;font-weight:700">.</span>toString() <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">, Singer: </span>
                <span style="color:#00f;font-weight:700">+</span> a<span style="color:#00f;font-weight:700">.</span>getSinger()<span style="color:#00f;font-weight:700">.</span>getFirstName() <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07"> </span>
                <span style="color:#00f;font-weight:700">+</span> a<span style="color:#00f;font-weight:700">.</span>getSinger()<span style="color:#00f;font-weight:700">.</span>getLastName()));
    }

    <span style="color:#00f;font-weight:700">@After</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">tearDown</span>() {
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                                    <div class="Para ParaOneEmphasisChild" id="Par176">If you run the previous test class, the 
                                        <span class="EmphasisFontCategoryNonProportional">testFindByTitle</span> passes, and the two album details are printed in the console.
                                    </div>
                                    <pre style="background:#fff;color:#000">INFO  c.a.p.c.SingerDataJPATest - Album  - id: 1, Singer id: 1,
   Title: The Search For Everything, Release Date: 2017-01-20, Singer: John  Mayer
INFO  c.a.p.c.SingerDataJPATest - Album  - id: 3, Singer id: 2,
   Title: From The Cradle, Release Date: 1994-09-13, Singer: Eric Clapton
</pre>
                                    <div class="Section2 RenderAsSection2" id="Sec21">
                                        <h3 class="Heading">Keeping Track of Changes on the Entity Class</h3>
                                        <div class="Para" id="Par178">In most applications, we need to keep track of basic audit activities for the business data being maintained by users. The audit information typically includes the user who creates the data, the date it was created, the date it was last modified, and the user who last modified it.</div>
                                        <div class="Para" id="Par179">The Spring Data JPA project provides this function in the form of a JPA 
                                            <span id="ITerm123">entity listener                                  </span>, which helps you keep track of the audit information automatically. To use the feature, until Spring 4, the entity class needed to implement the 
                                            <span class="EmphasisFontCategoryNonProportional">Auditable&lt;U, ID extends Serializable, T extends TemporalAccessor&gt; extends Persistable&lt;ID&gt;</span> interface (belonging to Spring Data Commons) or extend any class that implements this interface. The following code snippet shows the 
                                            <span class="EmphasisFontCategoryNonProportional">Auditable</span> interface that was extracted from Spring Data’s reference documentation:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">org.springframework.data.domain</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.io.Serializable</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.time.temporal.TemporalAccessor</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Optional</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">Auditable</span>&lt;U, ID <span style="color:#00f;font-weight:700">extends</span> <span style="font-style:italic">Serializable</span>,
        <span style="font-style:italic">T</span> extends <span style="font-style:italic">TemporalAccessor</span>&gt; extends <span style="font-style:italic">Persistable&lt;<span style="color:#00f;font-weight:700">ID</span>&gt;</span> {
    <span style="color:#00f;font-weight:700">Optional&lt;<span style="color:#00f;font-weight:700">U</span>&gt;</span> <span style="color:#0000a2;font-weight:700">getCreatedBy</span>();

    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setCreatedBy</span>(<span style="color:#00f;font-weight:700">U</span> <span style="font-style:italic">createdBy</span>);

    <span style="color:#00f;font-weight:700">Optional&lt;<span style="color:#00f;font-weight:700">T</span>&gt;</span> <span style="color:#0000a2;font-weight:700">getCreatedDate</span>();

    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setCreatedDate</span>(<span style="color:#00f;font-weight:700">T</span> <span style="font-style:italic">creationDate</span>);

    <span style="color:#00f;font-weight:700">Optional&lt;<span style="color:#00f;font-weight:700">U</span>&gt;</span> <span style="color:#0000a2;font-weight:700">getLastModifiedBy</span>();

    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setLastModifiedBy</span>(<span style="color:#00f;font-weight:700">U</span> <span style="font-style:italic">lastModifiedBy</span>);

    <span style="color:#00f;font-weight:700">Optional&lt;<span style="color:#00f;font-weight:700">T</span>&gt;</span> <span style="color:#0000a2;font-weight:700">getLastModifiedDate</span>();

    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setLastModifiedDate</span>(<span style="color:#00f;font-weight:700">T</span> <span style="font-style:italic">lastModifiedDate</span>);
}
</pre>
                                        <div class="Para" id="Par181">To show how it works, let’s create a new table called 
                                            <span class="EmphasisFontCategoryNonProportional">SINGER_AUDIT</span> in the database schema, which is based on the 
                                            <span class="EmphasisFontCategoryNonProportional">SINGER</span> table, with four audit-related columns added. 
                                            <span id="ITerm124"> </span> The following code snippet shows the table creation script (
                                            <span class="EmphasisFontCategoryNonProportional">schema.sql</span>):
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">CREATE</span> <span style="color:#00f;font-weight:700">TABLE</span> <span style="color:#0000a2;font-weight:700">singer_audit</span> 
  ( 
     id                 <span style="color:#00f;font-weight:700">INT</span> <span style="color:#00f;font-weight:700">NOT NULL</span> auto_increment, 
     first_name         <span style="color:#00f;font-weight:700">VARCHAR</span>(<span style="color:#0000cd">60</span>) <span style="color:#00f;font-weight:700">NOT NULL</span>, 
     last_name          <span style="color:#00f;font-weight:700">VARCHAR</span>(<span style="color:#0000cd">40</span>) <span style="color:#00f;font-weight:700">NOT NULL</span>, 
     birth_date         <span style="color:#00f;font-weight:700">DATE</span>, 
     version            <span style="color:#00f;font-weight:700">INT</span> <span style="color:#00f;font-weight:700">NOT NULL</span> DEFAULT <span style="color:#0000cd">0</span>, 
     created_by         <span style="color:#00f;font-weight:700">VARCHAR</span>(<span style="color:#0000cd">20</span>), 
     created_date       <span style="color:#00f;font-weight:700">TIMESTAMP</span>, 
     last_modified_by   <span style="color:#00f;font-weight:700">VARCHAR</span>(<span style="color:#0000cd">20</span>), 
     last_modified_date <span style="color:#00f;font-weight:700">TIMESTAMP</span>, 
     UNIQUE uq_singer_audit_1 (first_name, last_name), 
     <span style="color:#00f;font-weight:700">PRIMARY KEY</span> (id) 
  ); 
</pre>
                                        <div class="Para" id="Par183">As you can see from the definition of the 
                                            <span class="EmphasisFontCategoryNonProportional">Auditable</span> interface previously shown, the date types columns are restricted to types extending 
                                            <span class="EmphasisFontCategoryNonProportional">java.time.temporal.TemporalAccessor</span>.
                                        </div>
                                        <div class="Para" id="Par184">Starting with Spring 5, implementing 
                                            <span class="EmphasisFontCategoryNonProportional">Auditable&lt;U,ID extends Serializable&gt;</span> is no longer necessary because everything can be replaced by annotations. The four underlined columns indicate the audit-related columns. Notice the 
                                            <span class="EmphasisFontCategoryNonProportional">@CreatedBy</span>, 
                                            <span class="EmphasisFontCategoryNonProportional">@CreatedDate</span>, 
                                            <span class="EmphasisFontCategoryNonProportional">@LastModifiedBy</span>, and 
                                            <span class="EmphasisFontCategoryNonProportional">@LastModifiedDate</span> annotations. Using these annotations, the type restriction for the date columns no longer applies. The next step is to create the entity class called 
                                            <span id="ITerm125"> <span class="EmphasisFontCategoryNonProportional">SingerAudit</span> </span>. The following code snippet shows the 
                                            <span class="EmphasisFontCategoryNonProportional">SingerAudit</span> class:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.data.annotation.CreatedBy</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.data.annotation.CreatedDate</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.data.annotation.LastModifiedBy</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.data.annotation.LastModifiedDate</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.data.jpa.domain.support.AuditingEntityListener</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.*</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.io.Serializable</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Date</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Optional</span>;

<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">javax.persistence.GenerationType.IDENTITY</span>;

@<span style="color:#00f;font-weight:700">Entity</span>
@EntityListeners(<span style="color:#00f;font-weight:700">AuditingEntityListener</span><span style="color:#00f;font-weight:700">.</span>class)
@Table(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">singer_audit</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerAudit</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Serializable</span> {
    <span style="color:#00f;font-weight:700">@Id</span>
    <span style="color:#00f;font-weight:700">@GeneratedValue</span>(<span style="color:#c5060b;font-weight:700">strategy</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#c5060b;font-weight:700">IDENTITY</span>)
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">ID</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Long</span> id;
    <span style="color:#00f;font-weight:700">@Version</span>
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">VERSION</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">int</span> version;
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">FIRST_NAME</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> firstName;
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">LAST_NAME</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> lastName;
    <span style="color:#00f;font-weight:700">@Temporal</span>(<span style="color:#00f;font-weight:700">TemporalType</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>DATE</span>)
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">BIRTH_DATE</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Date</span> birthDate;
    <span style="color:#00f;font-weight:700">@CreatedDate</span>
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">CREATED_DATE</span>)
    <span style="color:#00f;font-weight:700">@Temporal</span>(<span style="color:#00f;font-weight:700">TemporalType</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>TIMESTAMP</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Date</span> createdDate;
    <span style="color:#00f;font-weight:700">@CreatedBy</span>
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">CREATED_BY</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> createdBy;
    <span style="color:#00f;font-weight:700">@LastModifiedBy</span>
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">LAST_MODIFIED_BY</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> lastModifiedBy;
    <span style="color:#00f;font-weight:700">@LastModifiedDate</span>
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">LAST_MODIFIED_DATE</span>)
    <span style="color:#00f;font-weight:700">@Temporal</span>(<span style="color:#00f;font-weight:700">TemporalType</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>TIMESTAMP</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Date</span> lastModifiedDate;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Long</span> <span style="color:#0000a2;font-weight:700">getId</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>id;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getFirstName</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>firstName;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setFirstName</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">firstName</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>firstName <span style="color:#00f;font-weight:700">=</span> firstName;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getLastName</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>lastName;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setLastName</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">lastName</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>lastName <span style="color:#00f;font-weight:700">=</span> lastName;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Date</span> <span style="color:#0000a2;font-weight:700">getBirthDate</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>birthDate;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setBirthDate</span>(<span style="color:#00f;font-weight:700">Date</span> <span style="font-style:italic">birthDate</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>birthDate <span style="color:#00f;font-weight:700">=</span> birthDate;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Optional&lt;<span style="color:#00f;font-weight:700">String</span>&gt;</span> <span style="color:#0000a2;font-weight:700">getCreatedBy</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">Optional</span><span style="color:#00f;font-weight:700">.</span>of(createdBy);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setCreatedBy</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">createdBy</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>createdBy <span style="color:#00f;font-weight:700">=</span> createdBy;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Optional&lt;<span style="color:#00f;font-weight:700">Date</span>&gt;</span> <span style="color:#0000a2;font-weight:700">getCreatedDate</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">Optional</span><span style="color:#00f;font-weight:700">.</span>of(createdDate);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setCreatedDate</span>(<span style="color:#00f;font-weight:700">Date</span> <span style="font-style:italic">createdDate</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>createdDate <span style="color:#00f;font-weight:700">=</span> createdDate;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Optional&lt;<span style="color:#00f;font-weight:700">String</span>&gt;</span> <span style="color:#0000a2;font-weight:700">getLastModifiedBy</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">Optional</span><span style="color:#00f;font-weight:700">.</span>of(lastModifiedBy);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setLastModifiedBy</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">lastModifiedBy</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>lastModifiedBy <span style="color:#00f;font-weight:700">=</span> lastModifiedBy;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Optional&lt;<span style="color:#00f;font-weight:700">Date</span>&gt;</span> <span style="color:#0000a2;font-weight:700">getLastModifiedDate</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">Optional</span><span style="color:#00f;font-weight:700">.</span>of(lastModifiedDate);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setLastModifiedDate</span>(<span style="color:#00f;font-weight:700">Date</span> <span style="font-style:italic">lastModifiedDate</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>lastModifiedDate <span style="color:#00f;font-weight:700">=</span> lastModifiedDate;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">toString</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">Singer - Id: </span> <span style="color:#00f;font-weight:700">+</span> id <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">, First name:  </span> <span style="color:#00f;font-weight:700">+</span> firstName
                <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">, Last name:  </span> <span style="color:#00f;font-weight:700">+</span> lastName <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">, Birthday: </span> <span style="color:#00f;font-weight:700">+</span> birthDate
                <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">, Created by:  </span> <span style="color:#00f;font-weight:700">+</span> createdBy <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">, Create date:  </span> <span style="color:#00f;font-weight:700">+</span> createdDate
                <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">, Modified by: </span> <span style="color:#00f;font-weight:700">+</span> lastModifiedBy <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">, Modified date: </span>
                <span style="color:#00f;font-weight:700">+</span> lastModifiedDate;
    }
}
</pre>
                                        <div class="Para" id="Par186">The 
                                            <span id="ITerm129"> <span class="EmphasisFontCategoryNonProportional">@Column</span> </span> annotations are applied on the auditing fields to map to the actual column in the table. The 
                                            <span class="EmphasisFontCategoryNonProportional">@EntityListeners(AuditingEntityListener.class)</span> annotation registers 
                                            <span class="EmphasisFontCategoryNonProportional">AuditingEntityListener</span> to be used only for this entity in the persistence context. In more complex examples when more than one entity class is needed, the auditing functionality is isolated into an abstract class annotated with 
                                            <span id="ITerm130"> <span class="EmphasisFontCategoryNonProportional">@MappedSuperclass</span> </span> 
                                            <span id="ITerm131"> </span>, and this will be the class also annotated with 
                                            <span class="EmphasisFontCategoryNonProportional">@EntityListeners(AuditingEntityListener.class)</span>. If 
                                            <span class="EmphasisFontCategoryNonProportional">SingerAudit</span> were part of such hierarchy, it would have to extend the following class:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.data.annotation.CreatedBy</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.data.annotation.CreatedDate</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.data.annotation.LastModifiedBy</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.data.annotation.LastModifiedDate</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.data.jpa.domain.support.AuditingEntityListener</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.*</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.io.Serializable</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Date</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Optional</span>;

@<span style="color:#00f;font-weight:700">MappedSuperclass</span>
@EntityListeners(<span style="color:#00f;font-weight:700">AuditingEntityListener</span><span style="color:#00f;font-weight:700">.</span>class)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">abstract</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AuditableEntity</span>&lt;U&gt; <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Serializable</span> {
    <span style="color:#00f;font-weight:700">@CreatedDate</span>
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">CREATED_DATE</span>)
    <span style="color:#00f;font-weight:700">@Temporal</span>(<span style="color:#00f;font-weight:700">TemporalType</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>TIMESTAMP</span>)
    <span style="color:#00f;font-weight:700">protected</span> <span style="color:#00f;font-weight:700">Date</span> createdDate;
    <span style="color:#00f;font-weight:700">@CreatedBy</span>
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">CREATED_BY</span>)
    <span style="color:#00f;font-weight:700">protected</span> <span style="color:#00f;font-weight:700">String</span> createdBy;
    <span style="color:#00f;font-weight:700">@LastModifiedBy</span>
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">LAST_MODIFIED_BY</span>)
    <span style="color:#00f;font-weight:700">protected</span> <span style="color:#00f;font-weight:700">String</span> lastModifiedBy;
    <span style="color:#00f;font-weight:700">@LastModifiedDate</span>
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">LAST_MODIFIED_DATE</span>)
    <span style="color:#00f;font-weight:700">@Temporal</span>(<span style="color:#00f;font-weight:700">TemporalType</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>TIMESTAMP</span>)
    <span style="color:#00f;font-weight:700">protected</span> <span style="color:#00f;font-weight:700">Date</span> lastModifiedDate;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Optional&lt;<span style="color:#00f;font-weight:700">String</span>&gt;</span> <span style="color:#0000a2;font-weight:700">getCreatedBy</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">Optional</span><span style="color:#00f;font-weight:700">.</span>of(createdBy);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setCreatedBy</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">createdBy</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>createdBy <span style="color:#00f;font-weight:700">=</span> createdBy;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Optional&lt;<span style="color:#00f;font-weight:700">Date</span>&gt;</span> <span style="color:#0000a2;font-weight:700">getCreatedDate</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">Optional</span><span style="color:#00f;font-weight:700">.</span>of(createdDate);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setCreatedDate</span>(<span style="color:#00f;font-weight:700">Date</span> <span style="font-style:italic">createdDate</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>createdDate <span style="color:#00f;font-weight:700">=</span> createdDate;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Optional&lt;<span style="color:#00f;font-weight:700">String</span>&gt;</span> <span style="color:#0000a2;font-weight:700">getLastModifiedBy</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">Optional</span><span style="color:#00f;font-weight:700">.</span>of(lastModifiedBy);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setLastModifiedBy</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">lastModifiedBy</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>lastModifiedBy <span style="color:#00f;font-weight:700">=</span> lastModifiedBy;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Optional&lt;<span style="color:#00f;font-weight:700">Date</span>&gt;</span> <span style="color:#0000a2;font-weight:700">getLastModifiedDate</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">Optional</span><span style="color:#00f;font-weight:700">.</span>of(lastModifiedDate);
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setLastModifiedDate</span>(<span style="color:#00f;font-weight:700">Date</span> <span style="font-style:italic">lastModifiedDate</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>lastModifiedDate <span style="color:#00f;font-weight:700">=</span> lastModifiedDate;
    }
}
</pre>
                                        <div class="Para ParaOneEmphasisChild" id="Par188">This would greatly reduce the size of 
                                            <span class="EmphasisFontCategoryNonProportional">SingerAudit</span>, becoming this:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.*</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Date</span>;

<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">javax.persistence.GenerationType.IDENTITY</span>;

@<span style="color:#00f;font-weight:700">Entity</span>
@Table(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">singer_audit</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerAudit</span> <span style="color:#00f;font-weight:700">extends</span> <span style="font-style:italic">AuditableEntity&lt;<span style="color:#00f;font-weight:700">SingerAudit</span>&gt;</span> {
    <span style="color:#00f;font-weight:700">@Id</span>
    <span style="color:#00f;font-weight:700">@GeneratedValue</span>(<span style="color:#c5060b;font-weight:700">strategy</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#c5060b;font-weight:700">IDENTITY</span>)
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">ID</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Long</span> id;
    <span style="color:#00f;font-weight:700">@Version</span>
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">VERSION</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">int</span> version;
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">FIRST_NAME</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> firstName;
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">LAST_NAME</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> lastName;
    <span style="color:#00f;font-weight:700">@Temporal</span>(<span style="color:#00f;font-weight:700">TemporalType</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>DATE</span>)
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">BIRTH_DATE</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Date</span> birthDate;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Long</span> <span style="color:#0000a2;font-weight:700">getId</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>id;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getFirstName</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>firstName;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setFirstName</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">firstName</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>firstName <span style="color:#00f;font-weight:700">=</span> firstName;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getLastName</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>lastName;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setLastName</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">lastName</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>lastName <span style="color:#00f;font-weight:700">=</span> lastName;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Date</span> <span style="color:#0000a2;font-weight:700">getBirthDate</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>birthDate;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setBirthDate</span>(<span style="color:#00f;font-weight:700">Date</span> <span style="font-style:italic">birthDate</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>birthDate <span style="color:#00f;font-weight:700">=</span> birthDate;
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">toString</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#036a07">Singer - Id: </span> <span style="color:#00f;font-weight:700">+</span> id <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">, First name: </span> <span style="color:#00f;font-weight:700">+</span> firstName
                <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">, Last name: </span> <span style="color:#00f;font-weight:700">+</span> lastName <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">, Birthday: </span> <span style="color:#00f;font-weight:700">+</span> birthDate
                <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">, Created by: </span> <span style="color:#00f;font-weight:700">+</span> createdBy <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">, Create date: </span> <span style="color:#00f;font-weight:700">+</span> createdDate
                <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">, Modified by: </span> <span style="color:#00f;font-weight:700">+</span> lastModifiedBy <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">, Modified date: </span>
                <span style="color:#00f;font-weight:700">+</span> lastModifiedDate;
    }
}
</pre>
                                        <div class="Para" id="Par190">The following code snippet shows the 
                                            <span id="ITerm135"> <span class="EmphasisFontCategoryNonProportional">SingerAuditService</span> </span> interface, where we define only a few methods to demonstrate the auditing feature:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.services</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities.SingerAudit</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">SingerAuditService</span> {
    <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">SingerAudit</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAll</span>();

    <span style="color:#00f;font-weight:700">SingerAudit</span> <span style="color:#0000a2;font-weight:700">findById</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">id</span>);

    <span style="color:#00f;font-weight:700">SingerAudit</span> <span style="color:#0000a2;font-weight:700">save</span>(<span style="color:#00f;font-weight:700">SingerAudit</span> <span style="font-style:italic">singer</span>);
}
</pre>
                                        <div class="Para" id="Par192">The 
                                            <span id="ITerm136"> <span class="EmphasisFontCategoryNonProportional">SingerAuditRepository</span> </span> interface just extends 
                                            <span class="EmphasisFontCategoryNonProportional">CrudRepository</span>, which has already implemented all the methods that we are going to use for 
                                            <span class="EmphasisFontCategoryNonProportional">SingerAuditService</span>. The 
                                            <span class="EmphasisFontCategoryNonProportional">findById()</span> method is implemented by the 
                                            <span class="EmphasisFontCategoryNonProportional">CrudRepository.findOne()</span> method. The following code snippet shows the service implementation class 
                                            <span class="EmphasisFontCategoryNonProportional">SingerAuditServiceImpl</span>:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.services</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities.SingerAudit</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.repos.SingerAuditRepository</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Service</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.annotation.Transactional</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Autowired</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.google.common.collect.Lists</span>;

@Service(<span style="color:#036a07">singerAuditService</span>)
@<span style="color:#00f;font-weight:700">Transactional</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerAuditServiceImpl</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerAuditService</span> {
    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SingerAuditRepository</span> singerAuditRepository;

    <span style="color:#00f;font-weight:700">@Transactional</span>(<span style="color:#c5060b;font-weight:700">readOnly</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">SingerAudit</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAll</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">Lists</span><span style="color:#00f;font-weight:700">.</span>newArrayList(singerAuditRepository<span style="color:#00f;font-weight:700">.</span>findAll());
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">SingerAudit</span> <span style="color:#0000a2;font-weight:700">findById</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">id</span>) {
        <span style="color:#00f;font-weight:700">return</span> singerAuditRepository<span style="color:#00f;font-weight:700">.</span>findOne(id)<span style="color:#00f;font-weight:700">.</span>get();
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">SingerAudit</span> <span style="color:#0000a2;font-weight:700">save</span>(<span style="color:#00f;font-weight:700">SingerAudit</span> <span style="font-style:italic">singer</span>) {
        <span style="color:#00f;font-weight:700">return</span> singerAuditRepository<span style="color:#00f;font-weight:700">.</span>save(singer);
    }
}
</pre>
                                        <div class="Para" id="Par194">We also need to do a little configuration work. Using the XML configuration, the 
                                            <span class="EmphasisFontCategoryNonProportional">AuditingEntityListener&lt;T&gt;</span> JPA entity listener that provides the auditing service needs to be declared into a file called 
                                            <span class="EmphasisFontCategoryNonProportional">/src/main/resources/META-INF/orm.xml</span> (it’s mandatory to use this file name, which is indicated by the JPA specification) under the project root folder and declare the listener, like the one shown here:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#68685b">&lt;?<span style="color:#888">xml</span><span style="color:#888"> version</span>=<span style="color:#888">1.0</span><span style="color:#888"> encoding</span>=<span style="color:#888">UTF-8</span> ?&gt;</span>
<span style="color:#1c02ff">&lt;<span style="font-weight:700">entity-mappings</span> <span style="font-style:italic">xmlns</span>=<span style="color:#036a07">http://java.sun.com/xml/ns/persistence/orm</span>
    <span style="font-style:italic">xmlns</span>:xsi=<span style="color:#036a07">http://www.w3.org/2001/XMLSchema-instance</span>
    <span style="font-style:italic">xsi</span>:schemaLocation=<span style="color:#036a07">http://java.sun.com/xml/ns/persistence/orm
        http://java.sun.com/xml/ns/persistence/orm_2_0.xsd</span>
        <span style="font-style:italic">version</span>=<span style="color:#036a07">2.0</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">description</span>&gt;</span>JPA<span style="color:#1c02ff">&lt;/<span style="font-weight:700">description</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">persistence-unit-metadata</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">persistence-unit-defaults</span>&gt;</span>
            <span style="color:#1c02ff">&lt;<span style="font-weight:700">entity-listeners</span>&gt;</span>
                <span style="color:#1c02ff">&lt;<span style="font-weight:700">entity-listener</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">org.springframework.data.jpa.domain.support.AuditingEntityListener</span> /&gt;</span>
        <span style="color:#1c02ff">&lt;/<span style="font-weight:700">entity-listeners</span>&gt;</span>
        <span style="color:#1c02ff">&lt;/<span style="font-weight:700">persistence-unit-defaults</span>&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">persistence-unit-metadata</span>&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">entity-mappings</span>&gt;</span>
</pre>
                                        <div class="Para" id="Par196">Using annotation configuration, this file is replaced by the 
                                            <span id="ITerm137"> <span class="EmphasisFontCategoryNonProportional">@EntityListeners</span> </span> 
                                            <span class="EmphasisFontCategoryNonProportional">(AuditingEntityListener.class)</span> annotation. The JPA provider will discover this listener during persistence operations (save and update events) for audit fields processing. The rest of the Spring configuration is almost identical to what you’ve seen so far, with one exception: a new configuration annotation to enable auditing, of course.
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.com.apress.prospring5.ch8.config</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.Logger</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.LoggerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Bean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.ComponentScan</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Configuration</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.data.jpa.repository.config.EnableJpaAuditing</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.data.jpa.repository.config.EnableJpaRepositories</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.jdbc.datasource.embedded.EmbeddedDatabaseBuilder</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.jdbc.datasource.embedded.EmbeddedDatabaseType</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.orm.jpa.JpaTransactionManager</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.orm.jpa.JpaVendorAdapter</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.PlatformTransactionManager</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.annotation.EnableTransactionManagement</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.EntityManagerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.sql.DataSource</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Properties</span>;

@<span style="color:#00f;font-weight:700">Configuration</span>
@<span style="color:#00f;font-weight:700">EnableTransactionManagement</span>
@ComponentScan(basePackages <span style="color:#00f;font-weight:700">=</span> {<span style="color:#036a07">com.apress.prospring5.ch8</span>})
@EnableJpaRepositories(basePackages <span style="color:#00f;font-weight:700">=</span> {<span style="color:#036a07">com.apress.prospring5.ch8.repos</span>})
@EnableJpaAuditing(auditorAwareRef <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">auditorAwareBean</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AuditConfig</span> {
    <span style="color:#06f;font-style:italic">// same content as  the configuration in the previous section</span>
    .<span style="color:#00f;font-weight:700">.</span>.
}
</pre>
                                        <div class="Para" id="Par198">The 
                                            <span class="EmphasisFontCategoryNonProportional">@EnableJpaAuditing(auditorAwareRef = &quot;auditorAwareBean&quot;)</span> annoation is the equivalent of the 
                                            <span class="EmphasisFontCategoryNonProportional">&lt;jpa:auditing auditor-aware-ref=&quot;auditorAwareBean&quot;/&gt;</span> element that is used to enable the JPA auditing feature using XML configuration. The 
                                            <span class="EmphasisFontCategoryNonProportional">auditorAwareBean</span> bean provides the user information. The following code snippet shows the 
                                            <span id="ITerm138"> <span class="EmphasisFontCategoryNonProportional">AuditorAwareBean</span> </span> class:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.data.domain.AuditorAware</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Component</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Optional</span>;

@<span style="color:#00f;font-weight:700">Component</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">AuditorAwareBean</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">AuditorAware&lt;<span style="color:#00f;font-weight:700">String</span>&gt;</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Optional&lt;<span style="color:#00f;font-weight:700">String</span>&gt;</span> <span style="color:#0000a2;font-weight:700">getCurrentAuditor</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">Optional</span><span style="color:#00f;font-weight:700">.</span>of(<span style="color:#036a07">prospring5</span>);
    }
}
</pre>
                                        <div class="Para" id="Par200"> 
                                            <span id="ITerm139"> <span class="EmphasisFontCategoryNonProportional">AuditorAwareBean</span> </span> implements the 
                                            <span class="EmphasisFontCategoryNonProportional">AuditorAware&lt;T&gt;</span> interface, passing in the type 
                                            <span class="EmphasisFontCategoryNonProportional">String</span>. In real situations, this should be an instance of user information, for example, a 
                                            <span class="EmphasisFontCategoryNonProportional">User</span> class, which represents the logged-in user who is performing the data update action. We use 
                                            <span class="EmphasisFontCategoryNonProportional">String</span> here just for simplicity. In the 
                                            <span class="EmphasisFontCategoryNonProportional">AuditorAwareBean</span> class, the method 
                                            <span class="EmphasisFontCategoryNonProportional">getCurrentAuditor()</span> is implemented, and the value is hard-coded to 
                                            <span class="EmphasisFontCategoryNonProportional">prospring5</span>. In real situations, the user should be obtained from the underlying security infrastructure. For example, in Spring Security, the user information can be retrieved from the 
                                            <span class="EmphasisFontCategoryNonProportional">SecurityContextHolder</span> class.
                                        </div>
                                        <div class="Para" id="Par201">Now that all the 
                                            <span id="ITerm140">implementation                                  </span> work is completed, the following code snippet shows the 
                                            <span class="EmphasisFontCategoryNonProportional">SpringAuditJPADemo</span> testing program:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.GregorianCalendar</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Date</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.config.AuditConfig</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities.SingerAudit</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.services.SingerAuditService</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.AnnotationConfigApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SpringAuditJPADemo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">AuditConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">SingerAuditService</span> singerAuditService <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">SingerAuditService</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">SingerAudit</span>&gt;</span> singers <span style="color:#00f;font-weight:700">=</span> singerAuditService<span style="color:#00f;font-weight:700">.</span>findAll();
        listSingers(singers);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Add new singer</span>);
        <span style="color:#00f;font-weight:700">SingerAudit</span> singer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SingerAudit</span>();
        singer<span style="color:#00f;font-weight:700">.</span>setFirstName(<span style="color:#036a07">BB</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setLastName(<span style="color:#036a07">King</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setBirthDate(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Date</span>(
                (<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GregorianCalendar</span>(<span style="color:#0000cd">1940</span>, <span style="color:#0000cd">8</span>, <span style="color:#0000cd">16</span>))<span style="color:#00f;font-weight:700">.</span>getTime()<span style="color:#00f;font-weight:700">.</span>getTime()));
        singerAuditService<span style="color:#00f;font-weight:700">.</span>save(singer);
        singers <span style="color:#00f;font-weight:700">=</span> singerAuditService<span style="color:#00f;font-weight:700">.</span>findAll();
        listSingers(singers);
        singer <span style="color:#00f;font-weight:700">=</span> singerAuditService<span style="color:#00f;font-weight:700">.</span>findById(<span style="color:#0000cd">4l</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07"></span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Singer with id 4:</span> <span style="color:#00f;font-weight:700">+</span> singer);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07"></span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Update singer</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setFirstName(<span style="color:#036a07">John Clayton</span>);
        singerAuditService<span style="color:#00f;font-weight:700">.</span>save(singer);
        singers <span style="color:#00f;font-weight:700">=</span> singerAuditService<span style="color:#00f;font-weight:700">.</span>findAll();
        listSingers(singers);
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">listSingers</span>(<span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">SingerAudit</span>&gt;</span> <span style="font-style:italic">singerAudits</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07"></span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Listing singers without details:</span>);
        <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">SingerAudit</span> audit <span style="color:#00f;font-weight:700">:</span> singerAudits) {
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(audit);
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println();
        }
    }
}
</pre>
                                        <div class="Para ParaOneEmphasisChild" id="Par203">In the 
                                            <span class="EmphasisFontCategoryNonProportional">main()</span> method, we list the singer audit information both after a new singer is inserted and after it’s later updated. Running the program produces the following output:
                                        </div>
                                        <pre style="background:#fff;color:#000">Add new singer
Listing singers without details:
// other singers ...
Singer - Id: 4, First name: BB, Last name: King, Birthday: 1940-09-16,
   Created by: prospring5, Create date:  2017-05-07 14:19:02.96,
   Modified by: prospring5, Modified date: 2017-05-07 14:19:02.96
Update singer
Listing  singers without details:
// other singers ...
Singer - Id: 4, First name:  Riley B., Last name:  King, Birthday: 1940-09-16,
  Created by: prospring5, Create date: 2017-05-07 14:33:15.645,
  Modified by: prospring5, Modified date: 2017-05-07 14:33:15.663
</pre>
                                        <div class="Para" id="Par205">In the previous output, you can 
                                            <span id="ITerm142">see                                  </span> that after the new singer is created, the create date and last-modified dates are the same. However, after the update, the last-modified date is updated. Auditing is another handy feature that Spring Data JPA provides so that you don’t need to implement the logic yourself.
                                        </div>
                                    </div>
                                </div>
                                <div class="Section1 RenderAsSection1" id="Sec22">
                                    <h2 class="Heading">Keeping Entity Versions by Using Hibernate Envers</h2>
                                    <div class="Para" id="Par206">In an enterprise application, for business-critical data, it is always a requirement to keep versions of each entity. For example, in a customer relationship management (CRM) system, each time a customer record is inserted, updated, or deleted, the previous version should be kept in a history or auditing table to fulfill the firm’s auditing or other compliance requirements.</div>
                                    <div class="Para" id="Par207">To accomplish this, there are two common options. The first one is to create database triggers that will clone the pre-update record into the history table before any update operations. The second is to develop the logic in the data access layer (for example, by using AOP). However, both options have their drawbacks. The trigger approach is tied to the database platform, while implementing the logic manually is quite clumsy and error prone.</div>
                                    <div class="Para ParaOneEmphasisChild" id="Par208">Hibernate Envers (short for “entity versioning system”) is a Hibernate module specifically designed to automate the versioning of entities. In this section, we discuss how to use Envers to implement the versioning of the 
                                        <span class="EmphasisFontCategoryNonProportional">SingerAudit</span> entity.
                                    </div>
                                    <div class="Para ParaTypeImportant" id="Par209"> 
                                        <img alt="A315511_5_En_8_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Figa_HTML.jpg" width="30"/> Hibernate Envers is not a feature of JPA. We mention it here because we believe it’s more appropriate to cover this after we have discussed some basic auditing features that you can use with Spring Data JPA.
                                    </div>
                                    <div class="Para" id="Par210">Envers supports two 
                                        <span id="ITerm143">auditing strategies                  </span>, which are shown in Table 
                                        <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Chapter.html#Tab1">8-1</a></span>.
                                        <div class="Table" id="Tab1">
                                            <div class="Caption" xml:lang="en">
                                                <div class="CaptionContent">
                                                    <span class="CaptionNumber">Table 8-1.</span>
                                                    <div class="SimplePara">Envers 
                                                        <span id="ITerm144">Auditing Strategies                </span> 
                                                    </div>
                                                </div>
                                            </div>
                                            <table border="1">
                                                <colgroup>
                                                    <col>
                                                    <col>
                                                </colgroup>
                                                <thead>
                                                    <tr class="header">
                                                        <th>
                                                            <div class="SimplePara">Auditing Strategy</div>
                                                        </th>
                                                        <th>
                                                            <div class="SimplePara">Description</div>
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr class="noclass">
                                                        <td>
                                                            <div class="SimplePara">Default</div>
                                                        </td>
                                                        <td>
                                                            <div class="SimplePara">Envers maintains a column for the revision of the record. Every time a record is inserted or updated, a new record will be inserted into the history table with the revision number retrieved from a database sequence or table.</div>
                                                        </td>
                                                    </tr>
                                                    <tr class="noclass">
                                                        <td>
                                                            <div class="SimplePara">Validity audit</div>
                                                        </td>
                                                        <td>
                                                            <div class="SimplePara">This strategy stores both the start and end revisions of each history record. Every time a record is inserted or updated, a new record will be inserted into the history table with the start revision number. At the same time, the previous record will be updated with the end revision number. It’s also possible to configure Envers to record the timestamp at which the end revision was updated into the previous history record.</div>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>                                         
                                    </div>
                                    <div class="Para" id="Par211">In this section, we demonstrate the validity audit strategy. Although it will trigger more database updates, retrieving the history records becomes much faster. Because the end revision timestamp is also written to the history records, it will be easier to identify the snapshot of a record at a specific point in time when querying the data.</div>
                                    <div class="Section2 RenderAsSection2" id="Sec23">
                                        <h3 class="Heading">Adding Tables for Entity Versioning</h3>
                                        <div class="Para" id="Par212">To support 
                                            <span id="ITerm145">entity                      </span> versioning, we need to add a few tables. First, for each table that the entity (in this case, the 
                                            <span class="EmphasisFontCategoryNonProportional">SingerAudit</span> entity class) will be versioning, we need to create the corresponding history table. For the versioning of records in the 
                                            <span class="EmphasisFontCategoryNonProportional">SINGER_AUDIT</span> table, let’s create a history table called 
                                            <span class="EmphasisFontCategoryNonProportional">SINGER_AUDIT_H</span>. The following code snippet shows the table creation script (
                                            <span class="EmphasisFontCategoryNonProportional">schema.sql</span>):
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">CREATE</span> <span style="color:#00f;font-weight:700">TABLE</span> <span style="color:#0000a2;font-weight:700">SINGER_AUDIT_H</span> (
    ID <span style="color:#00f;font-weight:700">INT</span> <span style="color:#00f;font-weight:700">NOT NULL</span> AUTO_INCREMENT
  , FIRST_NAME <span style="color:#00f;font-weight:700">VARCHAR</span>(<span style="color:#0000cd">60</span>) <span style="color:#00f;font-weight:700">NOT NULL</span>
  , LAST_NAME <span style="color:#00f;font-weight:700">VARCHAR</span>(<span style="color:#0000cd">40</span>) <span style="color:#00f;font-weight:700">NOT NULL</span>
  , BIRTH_DATE <span style="color:#00f;font-weight:700">DATE</span>
  , VERSION <span style="color:#00f;font-weight:700">INT</span> <span style="color:#00f;font-weight:700">NOT NULL</span> DEFAULT <span style="color:#0000cd">0</span>
  , CREATED_BY <span style="color:#00f;font-weight:700">VARCHAR</span>(<span style="color:#0000cd">20</span>)
  , CREATED_DATE <span style="color:#00f;font-weight:700">TIMESTAMP</span>
  , LAST_MODIFIED_BY <span style="color:#00f;font-weight:700">VARCHAR</span>(<span style="color:#0000cd">20</span>)
  , LAST_MODIFIED_DATE <span style="color:#00f;font-weight:700">TIMESTAMP</span>
  , AUDIT_REVISION <span style="color:#00f;font-weight:700">INT</span> NOT NUL
  ,   ACTION_TYPE <span style="color:#00f;font-weight:700">INT</span>
  ,   AUDIT_REVISION_ END <span style="color:#00f;font-weight:700">INT</span>
  ,   AUDIT_REVISION_END_TS <span style="color:#00f;font-weight:700">TIMESTAMP</span>
  , UNIQUE UQ_SINGER_AUDIT_H_1 (FIRST_NAME,  LAST_NAME)
  , <span style="color:#00f;font-weight:700">PRIMARY KEY</span> (ID, AUDIT_REVISION)
);
</pre>
                                        <div class="Para" id="Par214">To support the 
                                            <span id="ITerm146">validity                      </span> audit strategy, we need to add four columns for each history table, shown underlined in the previous script snippet. Table 
                                            <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Chapter.html#Tab2">8-2</a></span> shows the columns and their purposes. Hibernate Envers requires another table for keeping track of the revision number and the timestamp at which each revision was created. The table name should be 
                                            <span class="EmphasisFontCategoryNonProportional">REVINFO</span>.
                                            <div class="Table" id="Tab2">
                                                <div class="Caption" xml:lang="en">
                                                    <div class="CaptionContent">
                                                        <span class="CaptionNumber">Table 8-2.</span>
                                                        <div class="SimplePara">Envers 
                                                            <span id="ITerm147">Auditing Strategies                  </span> 
                                                        </div>
                                                    </div>
                                                </div>
                                                <table border="1">
                                                    <colgroup>
                                                        <col>
                                                        <col>
                                                        <col>
                                                    </colgroup>
                                                    <thead>
                                                        <tr class="header">
                                                            <th>
                                                                <div class="SimplePara">Auditing Strategy</div>
                                                            </th>
                                                            <th>
                                                                <div class="SimplePara">Data Type</div>
                                                            </th>
                                                            <th>
                                                                <div class="SimplePara">Description</div>
                                                            </th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr class="noclass">
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">AUDIT_REVISION</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">INT</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">The start revision of the history record.</div>
                                                            </td>
                                                        </tr>
                                                        <tr class="noclass">
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">ACTION_TYPE</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">INT</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">The action type, with these possible values: 0 for add, 1 for modify, and 2 for delete</div>
                                                            </td>
                                                        </tr>
                                                        <tr class="noclass">
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">AUDIT_REVISION_END</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">INT</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">The end revision of the history record</div>
                                                            </td>
                                                        </tr>
                                                        <tr class="noclass">
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">AUDIT_REVISION_END_TS</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">TIMESTAMP</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">The timestamp at which the end revision was updated</div>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>                                             
                                        </div>
                                        <div class="Para ParaOneEmphasisChild" id="Par215">The following code snippet shows the table creation script (
                                            <span class="EmphasisFontCategoryNonProportional">schema.sql</span>):
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">CREATE</span> <span style="color:#00f;font-weight:700">TABLE</span> <span style="color:#0000a2;font-weight:700">REVINFO</span> (
    REVTSTMP <span style="color:#00f;font-weight:700">BIGINT</span> <span style="color:#00f;font-weight:700">NOT NULL</span>
    , REV <span style="color:#00f;font-weight:700">INT</span> <span style="color:#00f;font-weight:700">NOT NULL</span> AUTO_INCREMENT
    , <span style="color:#00f;font-weight:700">PRIMARY KEY</span> (REVTSTMP, REV)
);
</pre>
                                        <div class="Para" id="Par217">The 
                                            <span class="EmphasisFontCategoryNonProportional">REV</span> column is for storing each revision number, which will be auto-incremented when a new history record is created. The 
                                            <span class="EmphasisFontCategoryNonProportional">REVTSTMP</span> column stores the timestamp (in a number format) when the revision was created.
                                        </div>
                                    </div>
                                    <div class="Section2 RenderAsSection2" id="Sec24">
                                        <h3 class="Heading">Configuring EntityManagerFactory for Entity Versioning</h3>
                                        <div class="Para" id="Par218"> 
                                            <span id="ITerm148">Hibernate Envers                      </span> is implemented in the form of EJB listeners. We can configure those listeners in the 
                                            <span class="EmphasisFontCategoryNonProportional">LocalContainerEntityManagerFactory</span> bean. Here you can see the Java configuration class. There is no point in showing an XML configuration because the only difference for this section is that we have a lot of extra Hibernate-specific properties.
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.config</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.hibernate.envers.boot.internal.EnversServiceImpl</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.hibernate.envers.event.spi.EnversPostUpdateEventListenerImpl</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.hibernate.event.spi.PostUpdateEventListener</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.Logger</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.LoggerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Bean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.ComponentScan</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Configuration</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.data.jpa.domain.support.AuditingEntityListener</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.data.jpa.repository.config.EnableJpaAuditing</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.data.jpa.repository.config.EnableJpaRepositories</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.jdbc.datasource.embedded.EmbeddedDatabaseBuilder</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.jdbc.datasource.embedded.EmbeddedDatabaseType</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.orm.jpa.JpaTransactionManager</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.orm.jpa.JpaVendorAdapter</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.PlatformTransactionManager</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.annotation.EnableTransactionManagement</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.EntityManagerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.sql.DataSource</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Properties</span>;

@<span style="color:#00f;font-weight:700">Configuration</span>
@<span style="color:#00f;font-weight:700">EnableTransactionManagement</span>
@ComponentScan(basePackages <span style="color:#00f;font-weight:700">=</span> {<span style="color:#036a07">com.apress.prospring5.ch8</span>})
@EnableJpaRepositories(basePackages <span style="color:#00f;font-weight:700">=</span> {<span style="color:#036a07">com.apress.prospring5.ch8.repos</span>})
@EnableJpaAuditing(auditorAwareRef <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">auditorAwareBean</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">EnversConfig</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">EnversConfig</span><span style="color:#00f;font-weight:700">.</span>class);

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">DataSource</span> <span style="color:#0000a2;font-weight:700">dataSource</span>() {
        <span style="color:#00f;font-weight:700">try</span> {
            <span style="color:#00f;font-weight:700">EmbeddedDatabaseBuilder</span> dbBuilder <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">EmbeddedDatabaseBuilder</span>();
            <span style="color:#00f;font-weight:700">return</span> dbBuilder<span style="color:#00f;font-weight:700">.</span>setType(<span style="color:#00f;font-weight:700">EmbeddedDatabaseType</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>H2</span>)
                    .addScripts(<span style="color:#036a07">classpath:db/schema.sql</span>, <span style="color:#036a07">classpath:db/test-data.sql</span>)<span style="color:#00f;font-weight:700">.</span>build();
        } <span style="color:#00f;font-weight:700">catch</span> (<span style="color:#00f;font-weight:700">Exception</span> e) {
            logger<span style="color:#00f;font-weight:700">.</span>error(<span style="color:#036a07">Embedded DataSource bean cannot be created!</span>, e);
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#585cf6;font-weight:700">null</span>;
        }
    }

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">PlatformTransactionManager</span> <span style="color:#0000a2;font-weight:700">transactionManager</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">JpaTransactionManager</span>(entityManagerFactory());
    }

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">JpaVendorAdapter</span> <span style="color:#0000a2;font-weight:700">jpaVendorAdapter</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HibernateJpaVendorAdapter</span>();
    }

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Properties</span> <span style="color:#0000a2;font-weight:700">hibernateProperties</span>() {
        <span style="color:#00f;font-weight:700">Properties</span> hibernateProp <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Properties</span>();
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.dialect</span>, <span style="color:#036a07">org.hibernate.dialect.H2Dialect</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.format_sql</span>, <span style="color:#585cf6;font-weight:700">true</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.show_sql</span>, <span style="color:#585cf6;font-weight:700">true</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.max_fetch_depth</span>, <span style="color:#0000cd">3</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.jdbc.batch_size</span>, <span style="color:#0000cd">10</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.jdbc.fetch_size</span>, <span style="color:#0000cd">50</span>);
        <span style="color:#06f;font-style:italic">//Properties for Hibernate Envers</span>
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07"> org.hibernate.envers.audit_table_suffix</span>, <span style="color:#036a07"> _H</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07"> org.hibernate.envers.revision_field_name</span>,
                <span style="color:#036a07">AUDIT_REVISION</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07"> org.hibernate.envers.revision_type_field_name</span>,
                <span style="color:#036a07">ACTION_TYPE</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07"> org.hibernate.envers.audit_strategy</span>,
                <span style="color:#036a07">org.hibernate.envers.strategy.ValidityAuditStrategy</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(
                <span style="color:#036a07"> org.hibernate.envers.audit_strategy_validity_end_rev_field_name</span>,
                <span style="color:#036a07">AUDIT_REVISION_END</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(
                <span style="color:#036a07"> org.hibernate.envers.audit_strategy_validity_store_revend_timestamp</span>,
                <span style="color:#036a07">True</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(
                <span style="color:#036a07"> org.hibernate.envers.audit_strategy_validity_revend_timestamp_field_name</span>,
                <span style="color:#036a07">AUDIT_REVISION_END_TS</span>);
        <span style="color:#00f;font-weight:700">return</span> hibernateProp;
    }

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">EntityManagerFactory</span> <span style="color:#0000a2;font-weight:700">entityManagerFactory</span>() {
        <span style="color:#00f;font-weight:700">LocalContainerEntityManagerFactoryBean</span> factoryBean <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">LocalContainerEntityManagerFactoryBean</span>();
        factoryBean<span style="color:#00f;font-weight:700">.</span>setPackagesToScan(<span style="color:#036a07">com.apress.prospring5.ch8.entities</span>);
        factoryBean<span style="color:#00f;font-weight:700">.</span>setDataSource(dataSource());
        factoryBean<span style="color:#00f;font-weight:700">.</span>setJpaVendorAdapter(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HibernateJpaVendorAdapter</span>());
        factoryBean<span style="color:#00f;font-weight:700">.</span>setJpaProperties(hibernateProperties());
        factoryBean<span style="color:#00f;font-weight:700">.</span>setJpaVendorAdapter(jpaVendorAdapter());
        factoryBean<span style="color:#00f;font-weight:700">.</span>afterPropertiesSet();
        <span style="color:#00f;font-weight:700">return</span> factoryBean<span style="color:#00f;font-weight:700">.</span>getObject();
    }
}
</pre>
                                        <div class="Para" id="Par220">The Envers audit event listener 
                                            <span class="EmphasisFontCategoryNonProportional">org.hibernate.envers.event.AuditEventListener</span> is attached to various persistence events. The listener intercepts the events post-insert, post-update, or post-delete and clones the pre-update snapshot of the entity class into the history table. The listener is also attached to those association update events (pre-collection-update, pre-collection-remove, and pre-collection-recreate) for handling the update operations of the entity class’s associations. Envers is capable of keeping the history of the entities within an association (for example one-to-many or many-to-many). A few 
                                            <span id="ITerm152">properties                      </span> are also defined for Hibernate Envers, which are summarized in Table 
                                            <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Chapter.html#Tab3">8-3</a></span> (the prefix of the properties, 
                                            <span class="EmphasisFontCategoryNonProportional">org.hibernate.envers</span>, is omitted for clarity).
                                            <a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Chapter.html#Fn2" id="Fn2_source"><sup>2</sup></a> 
                                            <div class="Table" id="Tab3">
                                                <div class="Caption" xml:lang="en">
                                                    <div class="CaptionContent">
                                                        <span class="CaptionNumber">Table 8-3.</span>
                                                        <div class="SimplePara">Hibernate Envers Properties Table</div>
                                                    </div>
                                                </div>
                                                <table border="1">
                                                    <colgroup>
                                                        <col>
                                                        <col>
                                                    </colgroup>
                                                    <thead>
                                                        <tr class="header">
                                                            <th>
                                                                <div class="SimplePara">Method</div>
                                                            </th>
                                                            <th>
                                                                <div class="SimplePara">Description</div>
                                                            </th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr class="noclass">
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">audit_table_suffix</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">The table name suffix for the versioned entity. For example, for the entity class 
                                                                    <span class="EmphasisFontCategoryNonProportional">SingerAudit</span>, which is mapped to the 
                                                                    <span class="EmphasisFontCategoryNonProportional">SINGER_AUDIT</span> table, Envers will keep the history in the table 
                                                                    <span class="EmphasisFontCategoryNonProportional">SINGER_AUDIT_H</span>, since we defined the value 
                                                                    <span class="EmphasisFontCategoryNonProportional">_H</span> for the property.
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr class="noclass">
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">revision_field_name</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">The history table’s column for storing the revision number for each history record.</div>
                                                            </td>
                                                        </tr>
                                                        <tr class="noclass">
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">revision_type_field_name</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">The history table’s column for storing the update action type.</div>
                                                            </td>
                                                        </tr>
                                                        <tr class="noclass">
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">audit_strategy</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">The audit strategy to use for entity versioning.</div>
                                                            </td>
                                                        </tr>
                                                        <tr class="noclass">
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">audit_strategy_validity_end_rev_field_name</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">The history table’s column for storing the end revision number for each history record. Required only when using the validity audit 
                                                                    <span id="ITerm153">strategy                                              </span>.
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr class="noclass">
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">audit_strategy_validity_store_revend_timestamp</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">Whether to store the timestamp when the end revision number for each history record is updated. Required only when using the validity audit strategy.</div>
                                                            </td>
                                                        </tr>
                                                        <tr class="noclass">
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">audit_strategy_validity_revend_timestamp_field_name</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">The history table’s column for storing the timestamp when the end revision number for each history record is updated. Required only when using the validity audit strategy and the previous property is set to 
                                                                    <span class="EmphasisFontCategoryNonProportional">true</span>.
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>                                             
                                        </div>
                                    </div>
                                    <div class="Section2 RenderAsSection2" id="Sec25">
                                        <h3 class="Heading">Enabling Entity Versioning and History Retrieval</h3>
                                        <div class="Para" id="Par222">To enable 
                                            <span id="ITerm154">versioning                      </span> of an entity, just annotate the entity class with 
                                            <span class="EmphasisFontCategoryNonProportional">@Audited</span>. This annotation can be used at the class level and then the changes on all the fields will be audited. If you want to escape certain fields from auditing, 
                                            <span class="EmphasisFontCategoryNonProportional">@NotAudited</span> can be used on those fields. Here you can see a snippet of the 
                                            <span class="EmphasisFontCategoryNonProportional">SingerAudit</span> entity class with the annotation applied:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.hibernate.envers.Audited</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.data.jpa.domain.support.AuditingEntityListener</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.io.Serializable</span>;
.<span style="color:#00f;font-weight:700">.</span>.

@<span style="color:#00f;font-weight:700">Entity</span>
@Table(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">singer_audit</span>)
@<span style="color:#00f;font-weight:700">Audited</span>
@EntityListeners(<span style="color:#00f;font-weight:700">AuditingEntityListener</span><span style="color:#00f;font-weight:700">.</span>class)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerAudit</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Serializable</span> {
    .<span style="color:#00f;font-weight:700">.</span>.
}
</pre>
                                        <div class="Para" id="Par224">The entity class is annotated with @
                                            <span class="EmphasisFontCategoryNonProportional">Audited</span>, which Envers listeners will check for and perform versioning of the updated entities. By default, Envers will also try to keep a history of the associations; if you want to avoid this, you should use the 
                                            <span class="EmphasisFontCategoryNonProportional">@NotAudited</span> annotation mentioned earlier.
                                        </div>
                                        <div class="Para" id="Par225">To retrieve the 
                                            <span id="ITerm155">history                      </span> records, Envers provides the 
                                            <span class="EmphasisFontCategoryNonProportional">org.hibernate.envers.AuditReader</span> interface, which can be obtained from the 
                                            <span class="EmphasisFontCategoryNonProportional">AuditReaderFactory</span> class. Let’s add a new method called 
                                            <span class="EmphasisFontCategoryNonProportional">findAuditByRevision()</span> into the 
                                            <span class="EmphasisFontCategoryNonProportional">SingerAuditService</span> interface for retrieving the 
                                            <span class="EmphasisFontCategoryNonProportional">SingerAudit</span> history record by the revision number. The following code snippet shows the 
                                            <span class="EmphasisFontCategoryNonProportional">SingerAuditService</span> interface:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.services</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities.SingerAudit</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">SingerAuditService</span> {
    <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">SingerAudit</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAll</span>();

    <span style="color:#00f;font-weight:700">SingerAudit</span> <span style="color:#0000a2;font-weight:700">findById</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">id</span>);

    <span style="color:#00f;font-weight:700">SingerAudit</span> <span style="color:#0000a2;font-weight:700">save</span>(<span style="color:#00f;font-weight:700">SingerAudit</span> <span style="font-style:italic">singerAudit</span>);

    <span style="color:#00f;font-weight:700">SingerAudit</span> <span style="color:#0000a2;font-weight:700">findAuditByRevision</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">id</span>, <span style="color:#00f;font-weight:700">int</span> <span style="font-style:italic">revision</span>);
}
</pre>
                                        <div class="Para" id="Par227">To retrieve a history record, one option is to pass in the entity’s ID and the revision number. The following code snippet shows the implementation of the method extracting revisions:</div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.services</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities.SingerAudit</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.repos.SingerAuditRepository</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.google.common.collect.Lists</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.hibernate.envers.AuditReader</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.hibernate.envers.AuditReaderFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Autowired</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Service</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.annotation.Transactional</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.EntityManager</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.PersistenceContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

@Service(<span style="color:#036a07">singerAuditService</span>)
@<span style="color:#00f;font-weight:700">Transactional</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerAuditServiceImpl</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerAuditService</span> {
    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SingerAuditRepository</span> singerAuditRepository;
    <span style="color:#00f;font-weight:700">@PersistenceContext</span>
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">EntityManager</span> entityManager;

    <span style="color:#00f;font-weight:700">@Transactional</span>(<span style="color:#c5060b;font-weight:700">readOnly</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">SingerAudit</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAll</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">Lists</span><span style="color:#00f;font-weight:700">.</span>newArrayList(singerAuditRepository<span style="color:#00f;font-weight:700">.</span>findAll());
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">SingerAudit</span> <span style="color:#0000a2;font-weight:700">findById</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">id</span>) {
        <span style="color:#00f;font-weight:700">return</span> singerAuditRepository<span style="color:#00f;font-weight:700">.</span>findOne(id)<span style="color:#00f;font-weight:700">.</span>get();
    }

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">SingerAudit</span> <span style="color:#0000a2;font-weight:700">save</span>(<span style="color:#00f;font-weight:700">SingerAudit</span> <span style="font-style:italic">singer</span>) {
        <span style="color:#00f;font-weight:700">return</span> singerAuditRepository<span style="color:#00f;font-weight:700">.</span>save(singer);
    }

    <span style="color:#00f;font-weight:700">@Transactional</span>(<span style="color:#c5060b;font-weight:700">readOnly</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">SingerAudit</span> <span style="color:#0000a2;font-weight:700">findAuditByRevision</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">id</span>, <span style="color:#00f;font-weight:700">int</span> <span style="font-style:italic">revision</span>) {
        <span style="color:#00f;font-weight:700">AuditReader</span> auditReader <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">AuditReaderFactory</span><span style="color:#00f;font-weight:700">.</span>get(entityManager);
        <span style="color:#00f;font-weight:700">return</span> auditReader<span style="color:#00f;font-weight:700">.</span>find(<span style="color:#00f;font-weight:700">SingerAudit</span><span style="color:#00f;font-weight:700">.</span>class, id, revision);
    }
}
</pre>
                                        <div class="Para" id="Par229">The 
                                            <span class="EmphasisFontCategoryNonProportional">EntityManager</span> is injected into the class, which is passed to 
                                            <span class="EmphasisFontCategoryNonProportional">AuditReaderFactory</span> to retrieve an instance of 
                                            <span class="EmphasisFontCategoryNonProportional">AuditReader</span>. Then we can call the 
                                            <span class="EmphasisFontCategoryNonProportional">AuditReader.find()</span> method to retrieve the instance of the 
                                            <span class="EmphasisFontCategoryNonProportional">SingerAudit</span> entity at a particular revision.
                                        </div>
                                    </div>
                                    <div class="Section2 RenderAsSection2" id="Sec26">
                                        <h3 class="Heading">Testing <span id="ITerm157">Entity Versioning                      </span> </h3>
                                        <div class="Para" id="Par230">Let’s take a look at how 
                                            <span id="ITerm158">entity                      </span> versioning works. The following code snippet shows the testing code snippet; the code for bootstrapping 
                                            <span class="EmphasisFontCategoryNonProportional">ApplicationContext</span> and the 
                                            <span class="EmphasisFontCategoryNonProportional">listSingers()</span> function is the same as the code in the 
                                            <span class="EmphasisFontCategoryNonProportional">SpringJpaDemo</span> class.
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.GregorianCalendar</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Date</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.config.EnversConfig</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities.SingerAudit</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.services.SingerAuditService</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.AnnotationConfigApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SpringEnversJPADemo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicati</span> onContext(<span style="color:#00f;font-weight:700">EnversConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">SingerAuditService</span> singerAuditService <span style="color:#00f;font-weight:700">=</span>
                ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">SingerAuditService</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Add new singer</span>);
        <span style="color:#00f;font-weight:700">SingerAudit</span> singer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SingerAudit</span>();
        singer<span style="color:#00f;font-weight:700">.</span>setFirstName(<span style="color:#036a07">BB</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setLastName(<span style="color:#036a07">King</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setBirthDate(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Date</span>(
                (<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GregorianCalendar</span>(<span style="color:#0000cd">1940</span>, <span style="color:#0000cd">8</span>, <span style="color:#0000cd">16</span>))<span style="color:#00f;font-weight:700">.</span>getTime()<span style="color:#00f;font-weight:700">.</span>getTime()));
        singerAuditService<span style="color:#00f;font-weight:700">.</span>save(singer);
        listSingers(singerAuditService<span style="color:#00f;font-weight:700">.</span>findAll());
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Update singer</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setFirstName(<span style="color:#036a07">Riley B.</span>);
        singerAuditService<span style="color:#00f;font-weight:700">.</span>save(singer);
        listSingers(singerAuditService<span style="color:#00f;font-weight:700">.</span>findAll());
        <span style="color:#00f;font-weight:700">SingerAudit</span> oldSinger <span style="color:#00f;font-weight:700">=</span> singerAuditService<span style="color:#00f;font-weight:700">.</span>findAuditByRevision(<span style="color:#0000cd">4l</span>, <span style="color:#0000cd">1</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07"></span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Old Singer with id 1 and rev 1:</span> <span style="color:#00f;font-weight:700">+</span> oldSinger);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07"></span>);
        oldSinger <span style="color:#00f;font-weight:700">=</span> singerAuditService<span style="color:#00f;font-weight:700">.</span>findAuditByRevision(<span style="color:#0000cd">4l</span>, <span style="color:#0000cd">2</span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07"></span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Old Singer with id 1 and rev 2:</span> <span style="color:#00f;font-weight:700">+</span> oldSinger);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07"></span>);
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">listSingers</span>(<span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">SingerAudit</span>&gt;</span> <span style="font-style:italic">singers</span>) {
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07"></span>);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Listing singers:</span>);
        <span style="color:#00f;font-weight:700">for</span> (<span style="color:#00f;font-weight:700">SingerAudit</span> singer <span style="color:#00f;font-weight:700">:</span> singers) {
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(singer);
            <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println();
        }
    }
}
</pre>
                                        <div class="Para ParaOneEmphasisChild" id="Par232">We first create a new singer and then update it. Then we retrieve the 
                                            <span class="EmphasisFontCategoryNonProportional">SingerAudit</span> entities with revisions 1 and 2, respectively. Running the code produces the following output:
                                        </div>
                                        <pre style="background:#fff;color:#000">...//
Singer - Id: 4, First name: BB, Last name: King, Birthday: 1940-09-16,
    Created by: prospring5, Create date: 2017-05-11 23:50:14.778,
    Modified by: prospring5, Modified date: 2017-05-11 23:50:14.778
Old Singer with id 1 and rev 1:Singer - Id: 4,
    First name: BB, Last name: King, Birthday: 1940-09-16,
    Created by: prospring5, Create date:  2017-05-11 23:50:14.778,
    Modified by: prospring5, Modified date: 2017-05-11 23:50:14.778
Old Singer with id 1 and rev 2:Singer - Id: 4,
    First name: Riley B., Last name: King, Birthday: 1940-09-16,
    Created by: prospring5, Create date: 2017-05-11 23:50:14.778,
    Modified by: prospring5, Modified date: 2017-05-11 23:50:15.0
</pre>
                                        <div class="Para" id="Par234">From the previous output, you can see that after the update 
                                            <span id="ITerm161">operation                      </span>, the 
                                            <span class="EmphasisFontCategoryNonProportional">SingerAudit</span>’s first name is changed to 
                                            <span class="EmphasisFontCategoryNonProportional">Riley B.</span>. However, when looking at the history, at revision 1, the first name is 
                                            <span class="EmphasisFontCategoryNonProportional">BB</span>. At revision 2, the first name becomes 
                                            <span class="EmphasisFontCategoryNonProportional">Riley B.</span>. Also notice that the last-modified date of revision 2 reflects the updated date and time correctly.
                                        </div>
                                    </div>
                                </div>
                                <div class="Section1 RenderAsSection1" id="Sec27">
                                    <h2 class="Heading">Spring Boot JPA</h2>
                                    <div class="Para" id="Par235">Until now we have configured everything including entities, database, repositories, and services. As you probably expect by now, there should be a Spring Boot starter artifact to help you develop your project faster and minimize the effort of configuration. A Spring Boot JPA starter depends on Spring Boot JPA, so it comes with preconfigured embedded database; all it’s needed is for the dependency to be on the classpath. It also comes with Hibernate to abstract the persistence layer. Spring 
                                        <span class="EmphasisFontCategoryNonProportional">Repository</span> interfaces are automatically detected. So, all that is left for the developer to do is to provide entities, repository extensions, and an 
                                        <span class="EmphasisFontCategoryNonProportional">Application</span> class to use them all together. Eventually, you can also develop a class to populate the database. All this will be done and explained in this section.
                                    </div>
                                    <div class="Para" id="Par236">First we need to add the 
                                        <span id="ITerm162">Spring Boot                            </span> 
                                        <span id="ITerm163"> </span> starter JPA as a dependency. This is done like all other libraries before it. Add the version, group ID, and artifact ID in the root 
                                        <span class="EmphasisFontCategoryNonProportional">build.gradle</span> file and define the dependencies in the 
                                        <span class="EmphasisFontCategoryNonProportional">chapter08/boot-jpa/build.gradle</span> file. The two configuration snippets are shown here:
                                    </div>
                                    <pre style="background:#fff;color:#000"><span style="color:#06f;font-style:italic">//pro-spring-15/build.gradle</span>
ext {
    <span style="color:#06f;font-style:italic">//spring libs</span>
    springVersion <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">5.0.0.M5</span>
    bootVersion <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">2.0.0.BUILD-SNAPSHOT</span>
    springDataVersion <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">2.0.0.M2</span>
    .<span style="color:#00f;font-weight:700">.</span>.
    boot <span style="color:#00f;font-weight:700">=</span>  [
            .<span style="color:#00f;font-weight:700">.</span>.
            starterJdbc     <span style="color:#00f;font-weight:700">:</span>
                <span style="color:#036a07">org.springframework.boot:spring-boot-starter-jdbc:$bootVersion</span>,
            starterJpa      <span style="color:#00f;font-weight:700">:</span>
                <span style="color:#036a07">org.springframework.boot:spring-boot-starter-data-jpa:$bootVersion</span>
    ]
    testing <span style="color:#00f;font-weight:700">=</span> [
            junit<span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">junit:junit:$junitVersion</span>
    ]
    db  <span style="color:#00f;font-weight:700">=</span> [
            .<span style="color:#00f;font-weight:700">.</span>.
            h2   <span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">com.h2database:h2:$h2Version</span>
    ]
}
<span style="color:#06f;font-style:italic">//chapter08/boot-jpa/build.gradle</span>
buildscript {
    repositories {
        mavenLocal
        mavenCentral
        maven { url <span style="color:#036a07">http://repo.spring.io/release</span> }
        maven { url <span style="color:#036a07">http://repo.spring.io/milestone</span> }
        maven { url  <span style="color:#036a07">http://repo.spring.io/snapshot</span> }
        maven { url <span style="color:#036a07">https://repo.spring.io/libs-snapshot</span> }
    }
    dependencies {
        classpath boot<span style="color:#00f;font-weight:700">.</span>springBootPlugin
    }
}
    apply plugin<span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">org.springframework.boot</span>
    dependencies {
      compile boot<span style="color:#00f;font-weight:700">.</span>starterJpa,  db<span style="color:#00f;font-weight:700">.</span>h2
    }
}
</pre>
                                    <div class="Para" id="Par238">After adding these 
                                        <span id="ITerm165">dependencies                            </span> and refreshing the project, the entire tree of 
                                        <span class="EmphasisFontCategoryNonProportional">spring-boot-starter-data-jpa</span> dependencies should be visible in the IntelliJ IDEA Gradle Projects view, as shown in Figure 
                                        <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Chapter.html#Fig2">8-2</a></span>.
                                        <div class="Figure" id="Fig2">
                                            <div class="MediaObject" id="MO2">
                                                <img alt="A315511_5_En_8_Fig2_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Fig2_HTML.jpg" height="456" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Fig2_HTML.jpg" width="520"/>
                                            </div>
                                            <div class="Caption" xml:lang="en">
                                                <div class="CaptionContent">
                                                    <span class="CaptionNumber">Figure 8-2.</span>
                                                    <div class="SimplePara">Dependency tree for the Spring Boot Starter 
                                                        <span id="ITerm166">artifact                                                    </span> 
                                                    </div>
                                                </div>
                                            </div>
                                        </div>                                         
                                    </div>
                                    <div class="Para" id="Par239">The entities will be the same as used until now (
                                        <span class="EmphasisFontCategoryNonProportional">Singer</span>, 
                                        <span class="EmphasisFontCategoryNonProportional">Album</span>, and 
                                        <span class="EmphasisFontCategoryNonProportional">Instrument</span>), so there is no need to depict them again. The bean to initialize them is of type 
                                        <span id="ITerm167"> <span class="EmphasisFontCategoryNonProportional">DBInitializer</span> </span>, and it is a service class that uses the 
                                        <span class="EmphasisFontCategoryNonProportional">SingerRepository</span> and 
                                        <span class="EmphasisFontCategoryNonProportional">InstrumentRepository</span> beans, provided by Spring Boot to save a set of objects to the database. Its contents are shown here:
                                    </div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.config</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.InstrumentRepository</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.SingerRepository</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities.Album</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities.Instrument</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.Logger</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.LoggerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Autowired</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Service</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.annotation.PostConstruct</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Date</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.GregorianCalendar</span>;

@<span style="color:#00f;font-weight:700">Service</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">DBInitializer</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">DBInitializer</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">SingerRepository</span> singerRepository;
    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">InstrumentRepository</span> instrumentRepository;

    <span style="color:#00f;font-weight:700">@PostConstruct</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">initDB</span>() {
        logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">Starting database initialization...</span>);
        <span style="color:#00f;font-weight:700">Instrument</span> guitar <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Instrument</span>();
        guitar<span style="color:#00f;font-weight:700">.</span>setInstrumentId(<span style="color:#036a07">Guitar</span>);
        instrumentRepository<span style="color:#00f;font-weight:700">.</span>save(guitar);
        <span style="color:#00f;font-weight:700">Instrument</span> piano <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Instrument</span>();
        piano<span style="color:#00f;font-weight:700">.</span>setInstrumentId(<span style="color:#036a07">Piano</span>);
        instrumentRepository<span style="color:#00f;font-weight:700">.</span>save(piano);
        <span style="color:#00f;font-weight:700">Instrument</span> voice <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Instrument</span>();
        voice<span style="color:#00f;font-weight:700">.</span>setInstrumentId(<span style="color:#036a07">Voice</span>);
        instrumentRepository<span style="color:#00f;font-weight:700">.</span>save(voice);
        <span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Singer</span>();
        singer<span style="color:#00f;font-weight:700">.</span>setFirstName(<span style="color:#036a07">John</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setLastName(<span style="color:#036a07">Mayer</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setBirthDate(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Date</span>(
                (<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GregorianCalendar</span>(<span style="color:#0000cd">1977</span>, <span style="color:#0000cd">9</span>, <span style="color:#0000cd">16</span>))<span style="color:#00f;font-weight:700">.</span>getTime()<span style="color:#00f;font-weight:700">.</span>getTime()));
        singer<span style="color:#00f;font-weight:700">.</span>addInstrument(guitar);
        singer<span style="color:#00f;font-weight:700">.</span>addInstrument(piano);
        <span style="color:#00f;font-weight:700">Album</span> album1 <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Album</span>();
        album1<span style="color:#00f;font-weight:700">.</span>setTitle(<span style="color:#036a07">The Search For Everything</span>);
        album1<span style="color:#00f;font-weight:700">.</span>setReleaseDate(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">java.sql<span style="color:#00f;font-weight:700">.</span>Date</span>(
                (<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GregorianCalendar</span>(<span style="color:#0000cd">2017</span>, <span style="color:#0000cd">0</span>, <span style="color:#0000cd">20</span>))<span style="color:#00f;font-weight:700">.</span>getTime()<span style="color:#00f;font-weight:700">.</span>getTime()));
        singer<span style="color:#00f;font-weight:700">.</span>addAbum(album1);
        <span style="color:#00f;font-weight:700">Album</span> album2 <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Album</span>();
        album2<span style="color:#00f;font-weight:700">.</span>setTitle(<span style="color:#036a07">Battle Studies</span>);
        album2<span style="color:#00f;font-weight:700">.</span>setReleaseDate(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">java.sql<span style="color:#00f;font-weight:700">.</span>Date</span>(
                (<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GregorianCalendar</span>(<span style="color:#0000cd">2009</span>, <span style="color:#0000cd">10</span>, <span style="color:#0000cd">17</span>))<span style="color:#00f;font-weight:700">.</span>getTime()<span style="color:#00f;font-weight:700">.</span>getTime()));
        singer<span style="color:#00f;font-weight:700">.</span>addAbum(album2);
        singerRepository<span style="color:#00f;font-weight:700">.</span>save(singer);
        singer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Singer</span>();
        singer<span style="color:#00f;font-weight:700">.</span>setFirstName(<span style="color:#036a07">Eric</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setLastName(<span style="color:#036a07">Clapton</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setBirthDate(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Date</span>(
                (<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GregorianCalendar</span>(<span style="color:#0000cd">1945</span>, <span style="color:#0000cd">2</span>, <span style="color:#0000cd">30</span>))<span style="color:#00f;font-weight:700">.</span>getTime()<span style="color:#00f;font-weight:700">.</span>getTime()));
        singer<span style="color:#00f;font-weight:700">.</span>addInstrument(guitar);
        <span style="color:#00f;font-weight:700">Album</span> album <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Album</span>();
        album<span style="color:#00f;font-weight:700">.</span>setTitle(<span style="color:#036a07">From The Cradle</span>);
        album<span style="color:#00f;font-weight:700">.</span>setReleaseDate(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">java.sql<span style="color:#00f;font-weight:700">.</span>Date</span>(
                (<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GregorianCalendar</span>(<span style="color:#0000cd">1994</span>, <span style="color:#0000cd">8</span>, <span style="color:#0000cd">13</span>))<span style="color:#00f;font-weight:700">.</span>getTime()<span style="color:#00f;font-weight:700">.</span>getTime()));
        singer<span style="color:#00f;font-weight:700">.</span>addAbum(album);
        singerRepository<span style="color:#00f;font-weight:700">.</span>save(singer);
        singer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Singer</span>();
        singer<span style="color:#00f;font-weight:700">.</span>setFirstName(<span style="color:#036a07">John</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setLastName(<span style="color:#036a07">Butler</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setBirthDate(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Date</span>(
                (<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GregorianCalendar</span>(<span style="color:#0000cd">1975</span>, <span style="color:#0000cd">3</span>, <span style="color:#0000cd">1</span>))<span style="color:#00f;font-weight:700">.</span>getTime()<span style="color:#00f;font-weight:700">.</span>getTime()));
        singer<span style="color:#00f;font-weight:700">.</span>addInstrument(guitar);
        singerRepository<span style="color:#00f;font-weight:700">.</span>save(singer);
        logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">Database initialization finished.</span>);
    }
}
</pre>
                                    <div class="Para" id="Par241">The 
                                        <span class="EmphasisFontCategoryNonProportional">SingerRepository</span> and 
                                        <span id="ITerm170"> <span class="EmphasisFontCategoryNonProportional">InstrumentRepository</span> </span> interfaces are quite simple for this example and are shown here:
                                    </div>
                                    <pre style="background:#fff;color:#000"><span style="color:#06f;font-style:italic">//InstrumentRepository.java</span>
<span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities.Instrument</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.data.repository.CrudRepository</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">InstrumentRepository</span>
        <span style="color:#00f;font-weight:700">extends</span> <span style="font-style:italic">CrudRepository&lt;<span style="color:#00f;font-weight:700">Instrument</span>, <span style="color:#00f;font-weight:700">Long</span>&gt;</span> {
}
<span style="color:#06f;font-style:italic">//SingerRepository.java</span>
<span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8</span>;
        <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities.Singer</span>;
        <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.data.repository.CrudRepository</span>;
        <span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">SingerRepository</span>
        <span style="color:#00f;font-weight:700">extends</span> <span style="font-style:italic">CrudRepository&lt;<span style="color:#00f;font-weight:700">Singer</span>, <span style="color:#00f;font-weight:700">Long</span>&gt;</span> {
    <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findByFirstName</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">firstName</span>);

    <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findByFirstNameAndLastName</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">firstName</span>, <span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">lastName</span>);
}
</pre>
                                    <div class="Para" id="Par243"> 
                                        <span id="ITerm173"> <span class="EmphasisFontCategoryNonProportional">SingerRepository</span> </span> will be directly injected into the Spring Boot annotated 
                                        <span class="EmphasisFontCategoryNonProportional">Application</span> class and used to retrieve all singer records and their children records from the database and log them in the console. The 
                                        <span class="EmphasisFontCategoryNonProportional">Application</span> class is shown here:
                                    </div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch8.entities.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.Logger</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.LoggerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Autowired</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.boot.CommandLineRunner</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.boot.SpringApplication</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.boot.autoconfigure.SpringBootApplication</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.ConfigurableApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.annotation.Transactional</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

@SpringBootApplication(scanBasePackages <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">com.apress.prospring5.ch8.config</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Application</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">CommandLineRunner</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">Application</span><span style="color:#00f;font-weight:700">.</span>class);
    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">SingerRepository</span> singerRepository;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Exception</span> {
        <span style="color:#00f;font-weight:700">ConfigurableApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">SpringApplication</span><span style="color:#00f;font-weight:700">.</span>run(<span style="color:#00f;font-weight:700">Application</span><span style="color:#00f;font-weight:700">.</span>class, args);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>in<span style="color:#00f;font-weight:700">.</span>read();
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }

    <span style="color:#00f;font-weight:700">@Transactional</span>(<span style="color:#c5060b;font-weight:700">readOnly</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">run</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Exception</span> {
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> singers <span style="color:#00f;font-weight:700">=</span> singerRepository<span style="color:#00f;font-weight:700">.</span>findByFirstName(<span style="color:#036a07">John</span>);
        listSingersWithAlbum(singers);
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">listSingersWithAlbum</span>(<span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="font-style:italic">singers</span>) {
        logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07"> ---- Listing singers with instruments:</span>);
        singers<span style="color:#00f;font-weight:700">.</span>forEach(singer <span style="color:#00f;font-weight:700">-</span><span style="color:#00f;font-weight:700">&gt;</span> {
            logger<span style="color:#00f;font-weight:700">.</span>info(singer<span style="color:#00f;font-weight:700">.</span>toString());
            <span style="color:#00f;font-weight:700">if</span> (singer<span style="color:#00f;font-weight:700">.</span>getAlbums() <span style="color:#00f;font-weight:700">!=</span> <span style="color:#585cf6;font-weight:700">null</span>) {
                singer<span style="color:#00f;font-weight:700">.</span>getAlbums()<span style="color:#00f;font-weight:700">.</span>forEach(
                        album <span style="color:#00f;font-weight:700">-</span><span style="color:#00f;font-weight:700">&gt;</span> logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">&quot;<span style="color:#26b31a">\t</span>&quot;</span> <span style="color:#00f;font-weight:700">+</span> album<span style="color:#00f;font-weight:700">.</span>toString()));
            }
            <span style="color:#00f;font-weight:700">if</span> (singer<span style="color:#00f;font-weight:700">.</span>getInstruments() <span style="color:#00f;font-weight:700">!=</span> <span style="color:#585cf6;font-weight:700">null</span>) {
                singer<span style="color:#00f;font-weight:700">.</span>getInstruments()<span style="color:#00f;font-weight:700">.</span>forEach(
                        instrument <span style="color:#00f;font-weight:700">-</span><span style="color:#00f;font-weight:700">&gt;</span> logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">&quot;<span style="color:#26b31a">\t</span>&quot;</span> <span style="color:#00f;font-weight:700">+</span> instrument<span style="color:#00f;font-weight:700">.</span>getInstrumentId()));
            }
        });
    }
}
</pre>
                                    <div class="Para" id="Par245">This 
                                        <span class="EmphasisFontCategoryNonProportional">Application</span> class introduces something new; it implements the 
                                        <span class="EmphasisFontCategoryNonProportional">CommandLineRunner</span> interface. This interface is used to tell Spring Boot that the 
                                        <span id="ITerm175"> <span class="EmphasisFontCategoryNonProportional">run()</span> </span> method should be executed when this bean is contained within a Spring application.
                                    </div>
                                    <div class="Para" id="Par246">The 
                                        <span class="EmphasisFontCategoryNonProportional">scanBasePackages = &quot;com.apress.prospring5.ch8.config&quot;</span> attribute is used to enable component scanning for the package (or packages) specified as an argument so that the beans contained there are created and added to the application context. This is needed when the beans are defined in a different package than the 
                                        <span class="EmphasisFontCategoryNonProportional">Application</span> class.
                                    </div>
                                    <div class="Para ParaOneEmphasisChild" id="Par247">Another thing you should notice is that no other configuration class is needed; you don’t need any SQL scripts to initialize the database nor any other annotations on the 
                                        <span class="EmphasisFontCategoryNonProportional">Application</span> class. Clearly, if you want to focus on the logic of an application, Spring Boot with its starter dependencies are quite handy.
                                    </div>
                                    <div class="Para" id="Par248">If you run the previous class, you will get the expected result. (Note that the application waits for a key to be pressed before exiting).</div>
<pre style="background:#fff;color:#000">INFO  c.a.p.c.c.DBInitializer - Starting database initialization...
INFO  c.a.p.c.c.DBInitializer - Database initialization  finished.
INFO  c.a.p.c.Application -  ---- Listing  singers with instruments:
INFO  c.a.p.c.Application - Singer - Id: 1, First name: John, Last name: Mayer,
   Birthday: 1977-10-16
INFO  c.a.p.c.Application -   Album  - id: 1, Singer id: 1, Title: Battle Studies,
   Release Date:  2009-11-17
INFO  c.a.p.c.Application -   Album  - id: 2, Singer id: 1,
  Title: The  Search For   Everything, Release Date: 2017-01-20
INFO  c.a.p.c.Application -   Piano
INFO  c.a.p.c.Application -   Guitar
INFO  c.a.p.c.Application - Singer - Id: 3, First name:  John, Last name: Butler,
  Birthday:  1975-04-01
INFO  c.a.p.c.Application -   Guitar
INFO  c.a.p.c.Application - Started Application in 3.464  seconds (JVM  running for 4.0)
</pre>
                                        </div>                                         
                                    </div>
                                </div>
                                <div class="Section1 RenderAsSection1" id="Sec28">
                                    <h2 class="Heading">Considerations When Using JPA</h2>
                                    <div class="Para" id="Par250">Although we covered a fair amount, this chapter discussed only a small portion of JPA. For example, using JPA to call a database stored procedure was not covered. JPA is a complete and powerful ORM data access standard, and with the help of third-party libraries such as Spring Data JPA and Hibernate Envers, you can implement various crosscutting concerns relatively easily.</div>
                                    <div class="Para" id="Par251">JPA is a JEE standard that is supported by most major open source communities as well as commercial vendors (JBoss, GlassFish, WebSphere, WebLogic, and so on). So, it’s a compelling choice for adopting JPA as the data access standard. If you require absolute control over the query, you can use JPA’s native query support instead of using JDBC directly.</div>
                                    <div class="Para" id="Par252">In conclusion, for developing JEE applications with Spring, we recommend using JPA to implement the data access layer. When desired, you can still mix in JDBC for some special data access needs. Always remember that Spring allows you to mix and match data access technologies easily, with the transaction management transparently handled for you. And if you want to simplify the development even more, Spring Boot makes that happen with its preconfigured beans and custom configurations.</div>
                                </div>
                                <div class="Section1 RenderAsSection1" id="Sec29">
                                    <h2 class="Heading">Summary</h2>
                                    <div class="Para ParaOneEmphasisChild" id="Par253">In this chapter, we covered the basic concepts of JPA and how to configure JPA’s 
                                        <span class="EmphasisFontCategoryNonProportional">EntityManagerFactory</span> in Spring by using Hibernate as the persistence service provider. Then we discussed using JPA to perform basic database operations. Advanced topics included native queries and the strongly typed JPA Criteria API.
                                    </div>
                                    <div class="Para ParaOneEmphasisChild" id="Par254">Additionally, we demonstrated how Spring Data JPA’s 
                                        <span class="EmphasisFontCategoryNonProportional">Repository</span> abstraction can help simplify JPA application development, as well as how to use its entity listener to keep track of basic auditing information for entity classes. For full versioning of entity classes, using Hibernate Envers to fulfill the requirement was also covered.
                                    </div>
                                    <div class="Para" id="Par255">Spring Boot for JPA applications was also covered, as it simplifies configuration a lot and keeps the focus on developing the required functionality.</div>
                                    <div class="Para" id="Par256">In the next chapter, we discuss transaction management in Spring.</div>
                                </div>
                                <div class="FootnoteSection">
                                    <div class="Heading">Footnotes</div>
                                    <div class="Footnote" id="Fn1">
                                        <span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Chapter.html#Fn1_source">1</a></span>
                                        <div class="FootnoteParas">
                                            <div class="Para" id="Par18">Get it online from at 
                                                <span class="ExternalRef"><a href="http://www.apress.com/us/book/9781430249269"><span class="RefSource"> <span class="EmphasisFontCategoryNonProportional">www.apress.com/us/book/9781430249269</span> </span></a></span>.
                                            </div>
                                        </div>
                                        <div class="ClearBoth"> </div>
                                    </div>
                                    <div class="Footnote" id="Fn2">
                                        <span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Chapter.html#Fn2_source">2</a></span>
                                        <div class="FootnoteParas">
                                            <div class="Para" id="Par221">You can find the full list of Hibernate properties in the Hibernate official documentation at 
                                                <span class="ExternalRef"><a href="https://docs.jboss.org/hibernate/orm/5.2/userguide/html_single/Hibernate_User_Guide.html%23envers-configuration"><span class="RefSource"> <span class="EmphasisFontCategoryNonProportional">https://docs.jboss.org/hibernate/orm/5.2/userguide/html_single/Hibernate_User_Guide.html#envers-configuration</span> </span></a></span>.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="annotator-outer annotator-viewer viewer annotator-hide"> 
                                <ul class="annotator-widget annotator-listing"></ul>
                            </div>
                            <div class="annotator-modal-wrapper annotator-editor-modal annotator-editor annotator-hide"> 
                                <div class="annotator-outer editor"> 
                                    <h2 class="title">Highlight</h2> 
                                    <form class="annotator-widget"> 
                                        <ul class="annotator-listing"> 
                                            <li class="annotator-item">
                                                <textarea class="js-editor" id="annotator-field-0" maxlength="750" placeholder="Add a note using markdown (optional)"></textarea>
                                            </li>
                                        </ul>                                         

                                        <div class="annotator-controls"> 
                                            <a class="link-to-markdown" href="https://daringfireball.net/projects/markdown/basics" target="_blank">?</a> 
                                            <ul> 
                                                <li class="delete annotator-hide">
                                                    <a class="annotator-delete-note button positive" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Chapter.html#delete">Delete Note</a>
                                                </li>                                                 

                                                <li class="save">
                                                    <a class="annotator-save annotator-focus button positive" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Chapter.html#save">Save Note</a>
                                                </li>                                                 

                                                <li class="cancel">
                                                    <a class="annotator-cancel button" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Chapter.html#cancel">Cancel</a>
                                                </li>                                                 
                                            </ul>                                             
                                        </div>                                         
                                    </form>                                     
                                </div>
                            </div>
                            <div class="annotator-modal-wrapper annotator-delete-confirm-modal" style="display: none;"> 
                                <div class="annotator-outer"> 
                                    <h2 class="title">Highlight</h2> 
                                    <a class="js-close-delete-confirm annotator-cancel close" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Chapter.html#close">Close</a> 
                                    <div class="annotator-widget"> 
                                        <div class="delete-confirm">            Are you sure you want to permanently delete this note?         </div>                                         

                                        <div class="annotator-controls"> 
                                            <a class="annotator-cancel button js-cancel-delete-confirm" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Chapter.html#cancel">No, I changed my mind</a> 
                                            <a class="annotator-delete button positive js-delete-confirm" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Chapter.html#delete">Yes, delete it</a> 
                                        </div>                                         
                                    </div>                                     
                                </div>
                            </div>
                            <div class="annotator-adder" style="display: none;"> 
                                <ul class="adders"> 
                                    <li class="copy">
                                        <a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Chapter.html#">Copy</a>
                                    </li>                                     

                                    <li class="add-highlight">
                                        <a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Chapter.html#">Add Highlight</a>
                                    </li>                                     

                                    <li class="add-note">
                                        <a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Chapter.html#">			Add Note		</a>
                                    </li>                                     
                                </ul>
                            </div>
                      </div>
                  </div>                     

                    <div class="t-sbo-prev sbo-prev sbo-nav-bottom"> 
                        <a class="prev nav-link" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_7_Chapter.html"> 
                            <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span> 
                            <span class="visuallyhidden">Previous Chapter</span> 
                            <div class="pagination-title t-prev-title">7. Using Hibernate in Spring</div>                             
                        </a>                         
                    </div>                     

                    <div class="t-sbo-next sbo-next sbo-nav-bottom"> 
                        <a class="next nav-link" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html"> 
                            <span aria-hidden="true" class="pagination-label t-next-label">Next</span> 
                            <span class="visuallyhidden">Next Chapter</span> 
                            <div class="pagination-title t-next-title">9. Transaction Management</div>                             
                        </a>                         
                    </div>                     
                </section>                 
            </div>
            <section class="sbo-saved-archives"></section>             
        </div>                  

        <div id="batBeacon0.550258277557268" style="width:0px; height:0px; display:none; visibility:hidden;">
            <img alt="" height="0" id="batBeacon0.8004630261819305" src="https://bat.bing.com/action/0?ti=5794699&amp;Ver=2&amp;mid=7c4a0ab3-7e36-4a17-3aa9-c4a1ba5dcbbb&amp;pi=1200101525&amp;lg=zh-CN&amp;sw=1366&amp;sh=768&amp;sc=24&amp;tl=8.%20Data%20Access%20in%20Spring%20with%20JPA2%20-%20Pro%20Spring%205%3A%20An%20In-Depth%20Guide%20to%20the%20Spring%20Framework%20and%20Its%20Tools&amp;p=https%3A%2F%2Flearning.oreilly.com%2Flibrary%2Fview%2Fpro-spring-5%2F9781484228081%2FA315511_5_En_8_Chapter.html&amp;r=&amp;evt=pageLoad&amp;msclkid=N&amp;rn=710042" style="width:0px; height:0px; display:none; visibility:hidden;" width="0"/>
        </div>         

        <div class="annotator-notice"></div>
        <div class="font-flyout" style="top: 201.156px; left: 1280px;">
            <div class="font-controls-panel"> 
                <div class="nightmodes"> 
                    <ul> 
                        <li class="day">
                            <a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Chapter.html#" id="day-mode" title="Day Mode"> <i class="fa fa-sun-o"></i> <span>Day Mode</span></a>
                        </li>                         

                        <li class="cloudy">
                            <a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Chapter.html#" id="cloudy-mode" title="Cloudy Mode"> <i class="fa fa-cloud"></i> <span>Cloud Mode</span> </a>
                        </li>                         

                        <li class="night">
                            <a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Chapter.html#" id="night-mode" title="Night Mode"> <i class="fa fa-moon-o"></i> <span>Night Mode</span> </a>
                        </li>                         
                    </ul>                     
                </div>                 

                <div class="font-resizer resizer"> 
                    <div class="draggable-containment-wrapper"> 
                        <i class="fa fa-font left"></i> 
                        <span class="filler" style="width: 50%;"></span> 
                        <div class="draggable ui-widget-content ui-draggable ui-draggable-handle" id="js-font-size-draggable" style="position: relative; left: 80px;"></div>                         

                        <i class="fa fa-font right"></i> 
                    </div>                     
                </div>                 

                <div class="column-resizer resizer"> 
                    <div class="draggable-containment-wrapper"> 
                        <i class="fa fa-compress left"></i> 
                        <span class="filler" style="width: 50%;"></span> 
                        <div class="draggable ui-widget-content ui-draggable ui-draggable-handle" id="js-column-size-draggable" style="position: relative; left: 80px;"></div>                         

                        <i class="fa fa-expand right"></i> 
                    </div>                     
                </div>                 

                <a class="button" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Chapter.html#" id="reset">Reset</a>
            </div>
        </div>
    

<hr/>
<!--if IE]><![endif]-->

<!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"            itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"data-offline-url="/"data-url="/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html"data-csrf-cookie="csrfsafari"data-highlight-privacy=""  data-user-id="3866890"  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"  data-username="levinxccai"  data-account-type="B2B"    data-activated-trial-date="11/06/2017"  data-archive="9781484228081"  data-publishers="Apress"  data-htmlfile-name="A315511_5_En_9_Chapter.html"  data-epub-title="Pro Spring 5: An In-Depth Guide to the Spring Framework and Its Tools" data-debug=0 data-testing=0><![endif]-->
<!--if gt IE 8]><!-->

    <!--![endif]-->
    
    
<a name="10_"></a>
 
        <div class="hide working" role="status"> 
            <div class="working-image"></div>             
        </div>         

        <div class="sbo-site-nav"> 
            <a class="skip" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html#container">Skip to content</a> 
        </div>         

        <div class="application" id="container" style="height: auto;"> 
            <div class="nav-container clearfix"> </div>             

            <div class="js-toc">                  

                <div class="interface-controls interface-controls-top">                      
</div>                 

                <section role="document"> 
                    <div class="t-sbo-prev sbo-prev sbo-nav-top">                          
</div>                     

                    <div class="t-sbo-next sbo-next sbo-nav-top">                          
</div>
                    <div id="sbo-rt-content" style="max-width:72.5em; transform: none;">
                        <div class="annotator-wrapper">
                            <div class="ChapterContextInformation">
                                <div class="ContextInformation" id="b978-1-4842-2808-1_9">
                                    <div class="ChapterCopyright">© Iuliana Cosmina, Rob Harrop, Chris Schaefer, and Clarence Ho 2017</div>
                                    <span class="ContextInformationAuthorEditorNames"><span class="Author"><span class="AuthorName">Iuliana Cosmina</span>, </span><span class="Author"><span class="AuthorName">Rob Harrop</span>, </span><span class="Author"><span class="AuthorName">Chris Schaefer</span> and </span><span class="Author"><span class="AuthorName">Clarence Ho</span></span></span>
                                    <span class="ContextInformationBookTitles"><span class="BookTitle" xml:lang="en">Pro Spring 5</span></span>
                                    <span class="ChapterDOI"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html">https://doi.org/10.1007/978-1-4842-2808-1_9</a></span>
                                </div>
                            </div>
                            <!--egin Abstract-->
                            <div class="MainTitleSection">
                                <h1 class="ChapterTitle" xml:lang="en">9. Transaction Management</h1>
                            </div>
                            <div class="AuthorGroup">
                                <div class="AuthorNames">
                                    <span class="Author"><span class="AuthorName">Iuliana Cosmina</span><sup>1 <span class="ContactIcon"></span></sup>, </span>
                                    <span class="Author"><span class="AuthorName">Rob Harrop</span><sup>2</sup>, </span>
                                    <span class="Author"><span class="AuthorName">Chris Schaefer</span><sup>3</sup> and </span>
                                    <span class="Author"><span class="AuthorName">Clarence Ho</span><sup>4</sup></span>
                                </div>
                                <div class="Affiliations">
                                    <div class="Affiliation" id="Aff5">
                                        <span class="AffiliationNumber">(1)</span>
                                        <div class="AffiliationText">Sibiu, Sibiu, Romania</div>
                                    </div>
                                    <div class="Affiliation" id="Aff6">
                                        <span class="AffiliationNumber">(2)</span>
                                        <div class="AffiliationText">Reddish, UK</div>
                                    </div>
                                    <div class="Affiliation" id="Aff7">
                                        <span class="AffiliationNumber">(3)</span>
                                        <div class="AffiliationText">Venice, Florida, USA</div>
                                    </div>
                                    <div class="Affiliation" id="Aff8">
                                        <span class="AffiliationNumber">(4)</span>
                                        <div class="AffiliationText">Hong Kong, China</div>
                                    </div>
                                    <div class="ClearBoth"> </div>
                                </div>
                            </div>
                            <!--nd Abstract-->
                            <div class="Fulltext">
                                <div class="Para" id="Par1">Transactions are one of the most critical parts of building a reliable enterprise application. The most common type of transaction is a database operation. In a typical database update operation, a database transaction begins, data is updated, and then the transaction is committed or rolled back, depending on the result of the database operation. However, in many cases, depending on the application requirements and the back-end resources that the application needs to interact with (such as an RDBMS, message-oriented middleware, an ERP system, and so on), transaction management can be much more complicated.</div>
                                <div class="Para" id="Par2">In the early days of Java application development (after JDBC was created but before the JEE standard or an application framework like Spring was available), developers programmatically controlled and managed transactions within application code. When JEE and, more specifically, the EJB standard became available, developers were able to use 
                                    <span id="ITerm1">container-managed transactions (CMTs)      </span> to manage transactions in a declarative way. But the complicated transaction declaration in the EJB deployment descriptor was difficult to maintain and introduced unnecessary complexity for transaction processing. Some developers favored having more control over the transaction and chose 
                                    <span id="ITerm2">bean-managed transactions (BMTs)      </span> to manage transactions in a programmatic way. However, the complexity of programming with the Java Transaction API (JTA) also hindered developers’ productivity.
                                </div>
                                <div class="Para" id="Par3">As discussed in Chapter 
                                    <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_5_Chapter.html"><span class="RefSource">5</span></a></span>, transaction management is a crosscutting concern and should not be coded within the business logic. The most appropriate way to implement transaction management is to allow developers to define transaction requirements in a declarative way and have frameworks such as Spring, JEE, or AOP weave in the transaction processing logic on our behalf. In this chapter, we discuss how Spring helps simplify the implementation of transaction-processing logic. Spring provides support for both declarative and programmatic transaction management.
                                </div>
                                <div class="Para" id="Par4">Spring offers excellent support for declarative transactions, which means you do not need to clutter your business logic with transaction management code. All you have to do is declare those methods (within classes or layers) that must participate in a transaction, together with the details of the transaction configuration, and Spring will take care of handling the transaction management. To be more specific, this chapter covers the following:
                                    <div class="UnorderedList">
                                        <ul class="UnorderedListMarkBullet">
                                            <li>
                                                <div class="Para" id="Par5"> 
                                                    <span id="ITerm3"> <span class="EmphasisTypeItalic">Spring transaction abstraction layer</span> </span>: We discuss the base components of Spring transaction abstraction classes and explain how to use these classes to control the properties of the transactions.
                                                </div>
                                            </li>
                                            <li>
                                                <div class="Para ParaOneEmphasisChild" id="Par6"> 
                                                    <span class="EmphasisTypeItalic">Declarative transaction management</span>: We show you how to use Spring and just plain Java objects to implement declarative transactional management. We offer examples for declarative transaction management using the XML configuration files as well as Java annotations.
                                                </div>
                                            </li>
                                            <li>
                                                <div class="Para" id="Par7"> 
                                                    <span class="EmphasisTypeItalic">Programmatic transaction management</span>: Even though programmatic transaction management is not used very often, we explain how to use the Spring-provided 
                                                    <span class="EmphasisFontCategoryNonProportional">TransactionTemplate</span> class, which gives you full control over the transaction management code.
                                                </div>
                                            </li>
                                            <li>
                                                <div class="Para ParaOneEmphasisChild" id="Par8"> 
                                                    <span class="EmphasisTypeItalic">Global transactions with JTA</span>: For global transactions that need to span multiple back-end resources, we show how to configure and implement global transactions in Spring by using JTA.
                                                </div>
                                            </li>
                                        </ul>
                                    </div>                                     
                                </div>
                                <div class="Section1 RenderAsSection1" id="Sec1">
                                    <h2 class="Heading">Exploring the Spring Transaction Abstraction Layer</h2>
                                    <div class="Para" id="Par9">When developing your 
                                        <span id="ITerm4">applications        </span>, no matter whether you choose to use Spring or not, you have to make a fundamental choice when using transactions about whether to use global or local transactions. Local transactions are specific to a single transactional resource (a JDBC connection, for example), whereas global transactions are managed by the container and can span multiple transactional resources.
                                    </div>
                                    <div class="Section2 RenderAsSection2" id="Sec2">
                                        <h3 class="Heading">Transaction Types</h3>
                                        <div class="Para" id="Par10">Local transactions are easy to 
                                            <span id="ITerm5">manage                      </span>, and if all operations in your application need to interact with just one transactional resource (such as a JDBC transaction), using local transactions will be sufficient. However, if you are not using an application framework such as Spring, you have a lot of transaction management code to write, and if in the future the scope of the transaction needs to be extended across multiple transactional resources, you have to drop the local transaction management code and rewrite it to use global transactions.
                                        </div>
                                        <div class="Para" id="Par11">In the Java world, global transactions were implemented with the JTA. In this scenario, a JTA-compatible transaction manager connects to multiple transactional resources via respective resource managers, which are capable of communicating with the transaction manager over the XA protocol (an open standard defining distributed transactions), and the 2 Phase Commit (2PC) mechanism was used to ensure that all back-end data sources were updated or rolled back altogether. If either of the back-end resources fails, the entire transaction will roll back, and hence the updates to other resources will be rolled back too.</div>
                                        <div class="Para" id="Par12">Figure 
                                            <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html#Fig1">9-1</a></span> shows a high-level view of global transactions with JTA. As shown in Figure 
                                            <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html#Fig1">9-1</a></span>, four main parties participate in a global transaction (also generally referred to as a 
                                            <span class="EmphasisTypeItalic">distributed transaction</span>). The first party is the back-end resource, such as an RDBMS, messaging middleware, an enterprise resource planning (ERP) system, and so on.
                                            <div class="Figure" id="Fig1">
                                                <div class="MediaObject" id="MO1">
                                                    <img alt="A315511_5_En_9_Fig1_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Fig1_HTML.jpg" height="339" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Fig1_HTML.jpg" width="690"/>
                                                </div>
                                                <div class="Caption" xml:lang="en">
                                                    <div class="CaptionContent">
                                                        <span class="CaptionNumber">Figure 9-1.</span>
                                                        <div class="SimplePara">Overview of global transactions with JTA</div>
                                                    </div>
                                                </div>
                                            </div>                                             
                                        </div>
                                        <div class="Para" id="Par13">The second party is the resource manager, which is generally provided by the back-end resource vendor and is responsible for interacting with the back-end 
                                            <span id="ITerm6">resource          </span>. For example, when connecting to a MySQL database, we need to interact with the 
                                            <span class="EmphasisFontCategoryNonProportional">MysqlXADataSource</span> class provided by MySQL’s Java connector. Other back-end resources (for example, MQ, ERP, and so on) provide their resource managers too.
                                        </div>
                                        <div class="Para" id="Par14">The third party is the 
                                            <span id="ITerm7">JTA                      </span> transaction manager, which is responsible for managing, coordinating, and synchronizing the transaction status with all resource managers that are participating in the transaction. The XA protocol is used, which is an open standard widely used for distributed transaction processing. The JTA transaction manager also supports 2PC so that all changes will be committed together, and if any resource update fails, the entire transaction will be rolled back, resulting in none of the resources being updated. The entire mechanism was specified by the 
                                            <span id="ITerm8">Java Transaction Service (JTS)          </span> specification.
                                        </div>
                                        <div class="Para" id="Par15">The final component is the application. Either the application itself or the underlying container or Spring Framework that the application runs on manages the transaction (begin, commit, roll back a transaction, and so on). At the same time, the application interacts with the underlying back-end resources via various standards defined by JEE. As shown in Figure 
                                            <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html#Fig1">9-1</a></span>, the application connects to the RDBMS via JDBC, MQ via JMS, and an ERP system via Java EE Connector Architecture (JCA).
                                        </div>
                                        <div class="Para" id="Par16">JTA is supported by all full-blown JEE-compliant application servers (for example, JBoss, WebSphere, WebLogic, and GlassFish), within which the transaction is available via JNDI lookup. As for stand-alone applications or web containers (for example, Tomcat and Jetty), there also exist open source and commercial solutions that provide support for JTA/XA in those environments (for example, Atomikos, Java Open Transaction Manager [JOTM], and Bitronix).</div>
                                    </div>
                                </div>
                                <div class="Section1 RenderAsSection1" id="Sec3">
                                    <h2 class="Heading">Implementations of the PlatformTransactionManager</h2>
                                    <div class="Para" id="Par17">In Spring, the 
                                        <span id="ITerm9"> <span class="EmphasisFontCategoryNonProportional">PlatformTransactionManager</span> </span> 
                                        <span id="ITerm10"> </span> interface uses the 
                                        <span class="EmphasisFontCategoryNonProportional">TransactionDefinition</span> and 
                                        <span class="EmphasisFontCategoryNonProportional">TransactionStatus</span> interfaces to create and manage transactions. The actual implementation of these interfaces must have detailed knowledge of the transaction manager.
                                    </div>
                                    <div class="Para" id="Par18">Figure 
                                        <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html#Fig2">9-2</a></span> shows the implementations of 
                                        <span class="EmphasisFontCategoryNonProportional">PlatformTransactionManager</span> in Spring.
                                        <div class="Figure" id="Fig2">
                                            <div class="MediaObject" id="MO2">
                                                <img alt="A315511_5_En_9_Fig2_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Fig2_HTML.jpg" height="239" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Fig2_HTML.jpg" width="690"/>
                                            </div>
                                            <div class="Caption" xml:lang="en">
                                                <div class="CaptionContent">
                                                    <span class="CaptionNumber">Figure 9-2.</span>
                                                    <div class="SimplePara">PlatformTransactionManager implementations as of Spring</div>
                                                </div>
                                            </div>
                                        </div>                                         
                                    </div>
                                    <div class="Para" id="Par19">Spring provides a rich set of 
                                        <span id="ITerm11">implementations                  </span> 
                                        <span id="ITerm12"> </span> for the 
                                        <span class="EmphasisFontCategoryNonProportional">PlatformTransactionManager</span> interface. The 
                                        <span class="EmphasisFontCategoryNonProportional">CciLocalTransactionManager</span> class supports JEE, JCA, and the Common Client Interface (CCI). The 
                                        <span class="EmphasisFontCategoryNonProportional">DataSourceTransactionManager</span> class is for generic JDBC connections. For the ORM side, there are a number of implementations, including JPA (the 
                                        <span class="EmphasisFontCategoryNonProportional">JpaTransactionManager</span> class)
                                        <a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html#Fn1" id="Fn1_source"><sup>1</sup></a> and Hibernate 5 (
                                        <span class="EmphasisFontCategoryNonProportional">HibernateTransactionManager</span>).
                                        <a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html#Fn2" id="Fn2_source"><sup>2</sup></a> For JMS, the implementations support JMS 2.0 through the 
                                        <span class="EmphasisFontCategoryNonProportional">JmsTransactionManager</span> class.
                                        <a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html#Fn3" id="Fn3_source"><sup>3</sup></a> For JTA, the generic implementation class is 
                                        <span class="EmphasisFontCategoryNonProportional">JtaTransactionManager</span>. Spring also provides several JTA transaction manager classes that are specific to particular application servers. Those classes provide native support for WebSphere (the 
                                        <span class="EmphasisFontCategoryNonProportional">WebSphereUowTransactionManager</span> class), WebLogic (the 
                                        <span class="EmphasisFontCategoryNonProportional">WebLogicJtaTransactionManager</span> class), and Oracle OC4J (the 
                                        <span class="EmphasisFontCategoryNonProportional">OC4JJtaTransactionManager</span> class).
                                    </div>
                                </div>
                                <div class="Section1 RenderAsSection1" id="Sec4">
                                    <h2 class="Heading">Analyzing Transaction Properties</h2>
                                    <div class="Para" id="Par23">In this section, we discuss the transaction properties that Spring supports, focusing on interacting with RDBMS as the back-end resource.</div>
                                    <div class="Para" id="Par24">Transactions have the four notoriously known ACID properties (atomicity, consistency, isolation, and durability), and it is up to the transactional resources to maintain these aspects of a transaction. You cannot control the atomicity, consistency, and durability of a transaction. However, you can control the transaction propagation and timeout, as well as configure whether the transaction should be read-only and specify the isolation level.</div>
                                    <div class="Para" id="Par25">Spring encapsulates all these settings in a 
                                        <span class="EmphasisFontCategoryNonProportional">TransactionDefinition</span> interface. This interface is used in the core interface of the transaction support in Spring, which is the 
                                        <span class="EmphasisFontCategoryNonProportional">PlatformTransactionManager</span> interface, whose implementations perform transaction management on a specific platform, such as JDBC or JTA. The core method, 
                                        <span class="EmphasisFontCategoryNonProportional">PlatformTransactionManager.getTransaction()</span>, takes a 
                                        <span class="EmphasisFontCategoryNonProportional">TransactionDefinition</span> interface as an argument and returns a 
                                        <span class="EmphasisFontCategoryNonProportional">TransactionStatus</span> interface. The 
                                        <span class="EmphasisFontCategoryNonProportional">TransactionStatus</span> interface is used to control the transaction execution, more specifically to set the transaction result and to check whether the transaction is completed or whether it is a new transaction.
                                    </div>
                                    <div class="Section2 RenderAsSection2" id="Sec5">
                                        <h3 class="Heading">The TransactionDefinition Interface</h3>
                                        <div class="Para" id="Par26">As we mentioned earlier, the 
                                            <span id="ITerm13"> <span class="EmphasisFontCategoryNonProportional">TransactionDefinition</span> interface                      </span> controls the properties of a transaction. Let’s take a more detailed look at the 
                                            <span class="EmphasisFontCategoryNonProportional">TransactionDefinition</span> interface, shown here, and describe its methods:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">org.springframework.transaction</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.sql.Connection</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">TransactionDefinition</span> {
    <span style="color:#06f;font-style:italic">// Variable declaration statements omitted</span>
    .<span style="color:#00f;font-weight:700">.</span>.

    <span style="color:#00f;font-weight:700">int</span> <span style="color:#0000a2;font-weight:700">getPropagationBehavior</span>();

    <span style="color:#00f;font-weight:700">int</span> <span style="color:#0000a2;font-weight:700">getIsolationLevel</span>();

    <span style="color:#00f;font-weight:700">int</span> <span style="color:#0000a2;font-weight:700">getTimeout</span>();

    <span style="color:#00f;font-weight:700">boolean</span> <span style="color:#0000a2;font-weight:700">isReadOnly</span>();

    <span style="color:#00f;font-weight:700">String</span> <span style="color:#0000a2;font-weight:700">getName</span>();
}
</pre>
                                        <div class="Para" id="Par28">The simple and obvious methods of this interface are 
                                            <span class="EmphasisFontCategoryNonProportional">getTimeout()</span>, which returns the time (in seconds) in which the transaction must complete, and 
                                            <span class="EmphasisFontCategoryNonProportional">isReadOnly()</span>, which indicates whether the transaction is read-only. The transaction manager implementation can use this value to optimize the execution and check to make sure that the transaction is performing only read operations. The 
                                            <span class="EmphasisFontCategoryNonProportional">getName()</span> method returns the name of the transaction.
                                        </div>
                                        <div class="Para" id="Par29">The other two methods, 
                                            <span class="EmphasisFontCategoryNonProportional">getPropagationBehavior()</span> and 
                                            <span class="EmphasisFontCategoryNonProportional">getIsolationLevel()</span>, need to be discussed in more detail. We begin with 
                                            <span class="EmphasisFontCategoryNonProportional">getIsolationLevel()</span>, which controls what changes to the data other transactions see. Table 
                                            <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html#Tab1">9-1</a></span> lists the transaction isolation levels you can use and explains what changes made in the current transaction other transactions can access. The isolation levels are represented as static values defined in the 
                                            <span class="EmphasisFontCategoryNonProportional">TransactionDefinition</span> interface.
                                            <div class="Table" id="Tab1">
                                                <div class="Caption" xml:lang="en">
                                                    <div class="CaptionContent">
                                                        <span class="CaptionNumber">Table 9-1.</span>
                                                        <div class="SimplePara">Transaction Isolation Levels</div>
                                                    </div>
                                                </div>
                                                <table border="1">
                                                    <colgroup>
                                                        <col>
                                                        <col>
                                                    </colgroup>
                                                    <thead>
                                                        <tr class="header">
                                                            <th>
                                                                <div class="SimplePara">Isolation Level</div>
                                                            </th>
                                                            <th>
                                                                <div class="SimplePara">Description</div>
                                                            </th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr class="noclass">
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">ISOLATION_DEFAULT</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">Default isolation level of the underlying data store.</div>
                                                            </td>
                                                        </tr>
                                                        <tr class="noclass">
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">ISOLATION_READ_UNCOMMITTED</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">Lowest level of isolation; it is barely a transaction at all because it allows this transaction to see data modified by other uncommitted transactions.</div>
                                                            </td>
                                                        </tr>
                                                        <tr class="noclass">
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">ISOLATION_READ_COMMITTED</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">Default level in most databases; it ensures that other transactions are not able to read data that has not been committed by other transactions. However, the data that was read by one transaction can be updated by other transactions.</div>
                                                            </td>
                                                        </tr>
                                                        <tr class="noclass">
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">ISOLATION_REPEATABLE_READ</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">Stricter than 
                                                                    <span class="EmphasisFontCategoryNonProportional">ISOLATION_READ_COMMITTED</span>; it ensures that once you select data, you can select at least the same set again. However, if other transactions insert new data, you can still select the newly inserted data.
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr class="noclass">
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">ISOLATION_SERIALIZABLE</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">The most expensive and reliable isolation level; all transactions are treated as if they were executed one after another.</div>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>                                             
                                        </div>
                                        <div class="Para ParaOneEmphasisChild" id="Par30">Choosing the appropriate isolation level is important for the consistency of the data, but making these choices can have a great impact on performance. The highest isolation level, 
                                            <span class="EmphasisFontCategoryNonProportional">ISOLATION_SERIALIZABLE</span>, is particularly expensive to maintain.
                                        </div>
                                        <div class="Para" id="Par31">The 
                                            <span class="EmphasisFontCategoryNonProportional">getPropagationBehavior()</span> 
                                            <span id="ITerm14">method                      </span> specifies what happens to a transactional call, depending on whether there is an active transaction. Table 
                                            <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html#Tab2">9-2</a></span> describes the values for this method. The propagation types are represented as static values defined in the 
                                            <span class="EmphasisFontCategoryNonProportional">TransactionDefinition</span> interface.
                                            <div class="Table" id="Tab2">
                                                <div class="Caption" xml:lang="en">
                                                    <div class="CaptionContent">
                                                        <span class="CaptionNumber">Table 9-2.</span>
                                                        <div class="SimplePara">Transaction Isolation Levels</div>
                                                    </div>
                                                </div>
                                                <table border="1">
                                                    <colgroup>
                                                        <col>
                                                        <col>
                                                    </colgroup>
                                                    <thead>
                                                        <tr class="header">
                                                            <th>
                                                                <div class="SimplePara">Propagation Type</div>
                                                            </th>
                                                            <th>
                                                                <div class="SimplePara">Description</div>
                                                            </th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr class="noclass">
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">PROPAGATION_REQUIRED</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">Supports a transaction if one already exists. If there is no transaction, it starts a new one.</div>
                                                            </td>
                                                        </tr>
                                                        <tr class="noclass">
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">PROPAGATION_SUPPORTS</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">Supports a transaction if one already exists. If there is no transaction, it executes nontransactionally.</div>
                                                            </td>
                                                        </tr>
                                                        <tr class="noclass">
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">PROPAGATION_MANDATORY</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">Supports a transaction if one already exists. Throws an exception if there is no active transaction.</div>
                                                            </td>
                                                        </tr>
                                                        <tr class="noclass">
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">PROPAGATION_REQUIRES_NEW</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">Always starts a new transaction. If an active transaction already exists, it is suspended.</div>
                                                            </td>
                                                        </tr>
                                                        <tr class="noclass">
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">PROPAGATION_NOT_SUPPORTED</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">Does not support execution with an active transaction. Always executes nontransactionally and suspends any existing transaction.</div>
                                                            </td>
                                                        </tr>
                                                        <tr class="noclass">
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">PROPAGATION_NEVER</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">Always executes nontransactionally even if an active transaction exists. Throws an exception if an active transaction exists.</div>
                                                            </td>
                                                        </tr>
                                                        <tr class="noclass">
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">PROPAGATION_NESTED</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">Runs in a nested transaction if an active transaction exists. If there is no active transaction, the execution is executed as if 
                                                                    <span class="EmphasisFontCategoryNonProportional">PROPAGATION_REQUIRED</span> is set.
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>                                             
                                        </div>
                                    </div>
                                    <div class="Section2 RenderAsSection2" id="Sec6">
                                        <h3 class="Heading">The TransactionStatus Interface</h3>
                                        <div class="Para" id="Par32">The 
                                            <span id="ITerm15"> <span class="EmphasisFontCategoryNonProportional">TransactionStatus</span> </span> interface, shown next, allows a transactional manager to control the transaction execution. The code can check whether the transaction is a new one or whether it is a read-only transaction, and it can initiate a rollback.
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">org.springframework.transaction</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">TransactionStatus</span> <span style="color:#00f;font-weight:700">extends</span> <span style="font-style:italic">SavepointManager</span> {
    <span style="color:#00f;font-weight:700">boolean</span> <span style="color:#0000a2;font-weight:700">isNewTransaction</span>();

    <span style="color:#00f;font-weight:700">boolean</span> <span style="color:#0000a2;font-weight:700">hasSavepoint</span>();

    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setRollbackOnly</span>();

    <span style="color:#00f;font-weight:700">boolean</span> <span style="color:#0000a2;font-weight:700">isRollbackOnly</span>();

    <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">flush</span>();

    <span style="color:#00f;font-weight:700">boolean</span> <span style="color:#0000a2;font-weight:700">isCompleted</span>();
}
</pre>
                                        <div class="Para" id="Par34">The methods of the 
                                            <span id="ITerm16"> <span class="EmphasisFontCategoryNonProportional">TransactionStatus</span> interface                      </span> are fairly self-explanatory; the most notable one is 
                                            <span class="EmphasisFontCategoryNonProportional">setRollbackOnly()</span>, which causes a rollback and ends the active transaction.
                                        </div>
                                        <div class="Para" id="Par35">The 
                                            <span class="EmphasisFontCategoryNonProportional">hasSavePoint()</span> method returns whether the transaction internally carries a save point (that is, the transaction was created as a nested transaction based on a save point). The 
                                            <span class="EmphasisFontCategoryNonProportional">flush()</span> method es the underlying session to a data store if applicable (for example, when using with Hibernate). The 
                                            <span class="EmphasisFontCategoryNonProportional">isCompleted()</span> method returns whether the transaction has ended (that is, committed or rolled back).
                                        </div>
                                    </div>
                                </div>
                                <div class="Section1 RenderAsSection1" id="Sec7">
                                    <h2 class="Heading">Sample Data Model and Infrastructure for Example Code</h2>
                                    <div class="Para" id="Par36">This section provides an overview of the data model and the infrastructure used in our examples of transaction management. We use JPA with Hibernate as the persistence layer for implementing data access logic. In addition, the Spring Data JPA and its repository abstraction are used to simplify the development of basic database operations.</div>
                                    <div class="Section2 RenderAsSection2" id="Sec8">
                                        <h3 class="Heading">Creating a Simple Spring JPA Project with <span id="ITerm17">Dependencies                                  </span> </h3>
                                        <div class="Para" id="Par37">Let’s start by creating the project. Because we are using JPA, we also need to add the required dependencies to the project for the examples in this chapter.</div>
                                        <pre style="background:#fff;color:#000"><span style="color:#06f;font-style:italic">//pro-spring-15/build.gradle</span>
ext {
    <span style="color:#06f;font-style:italic">//spring libs</span>
    springVersion <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">5.0.0.RC1</span>
    bootVersion <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">2.0.0.BUILD-SNAPSHOT</span>
    springDataVersion <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">2.0.0.M3</span>
    <span style="color:#06f;font-style:italic">//logging libs</span>
    slf4jVersion <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">1.7.25</span>
    logbackVersion <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">1.2.3</span>
    guavaVersion <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">21.0</span>
    junitVersion <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">4.12</span>
    aspectjVersion <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">1.9.0.BETA-5</span>
    <span style="color:#06f;font-style:italic">//database library</span>
    h2Version <span style="color:#00f;font-weight:700">=</span>  <span style="color:#036a07">1.4.194</span>
    <span style="color:#06f;font-style:italic">//persistency libraries</span>
    hibernateVersion <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">5.2.10.Final</span>
    hibernateJpaVersion <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">1.0.0.Final</span>
    atomikosVersion <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">4.0.0M4</span>
    spring <span style="color:#00f;font-weight:700">=</span> [
        context       <span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">org.springframework:spring-context:$springVersion</span>,
        aop           <span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">org.springframework:spring-aop:$springVersion</span>,
        aspects       <span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">org.springframework:spring-aspects:$springVersion</span>,
        tx            <span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">org.springframework:spring-tx:$springVersion</span>,
        jdbc          <span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">org.springframework:spring-jdbc:$springVersion</span>,
        contextSupport<span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">org.springframework:spring-context-support:$springVersion</span>,
        orm           <span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">org.springframework:spring-orm:$springVersion</span>,
        data          <span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">org.springframework.data:spring-data-jpa:$springDataVersion</span>,
        test          <span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">org.springframework:spring-test:$springVersion</span>
    ]
    hibernate <span style="color:#00f;font-weight:700">=</span> [
        .<span style="color:#00f;font-weight:700">.</span>.
        em            <span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">org.hibernate:hibernate-entitymanager:$hibernateVersion</span>,
        tx            <span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">com.atomikos:transactions-hibernate4:$atomikosVersion</span>
    ]
    boot <span style="color:#00f;font-weight:700">=</span> [
        .<span style="color:#00f;font-weight:700">.</span>.
        springBootPlugin<span style="color:#00f;font-weight:700">:</span>
           <span style="color:#036a07">org.springframework.boot:spring-boot-gradle-plugin:$bootVersion</span>,
        starterJpa      <span style="color:#00f;font-weight:700">:</span>
            <span style="color:#036a07">org.springframework.boot:spring-boot-starter-data-jpa:$bootVersion</span>
    ]
    testing <span style="color:#00f;font-weight:700">=</span> [
        junit<span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">junit:junit:$junitVersion</span>
    ]
    misc <span style="color:#00f;font-weight:700">=</span> [
        .<span style="color:#00f;font-weight:700">.</span>.
        slf4jJcl     <span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">org.slf4j:jcl-over-slf4j:$slf4jVersion</span>,
        logback      <span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">ch.qos.logback:logback-classic:$logbackVersion</span>,
        aspectjweaver<span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">org.aspectj:aspectjweaver:$aspectjVersion</span>,
        lang3        <span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">org.apache.commons:commons-lang3:3.5</span>,
        guava        <span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">com.google.guava:guava:$guavaVersion</span>
    ]
    db <span style="color:#00f;font-weight:700">=</span> [
        .<span style="color:#00f;font-weight:700">.</span>.
        h2   <span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">com.h2database:h2:$h2Version</span>
    ]
}
<span style="color:#06f;font-style:italic">//chapter09/build.gradle</span>
dependencies {
    <span style="color:#06f;font-style:italic">//we specify these dependencies for all submodules, except</span>
    <span style="color:#06f;font-style:italic">// the boot module, that defines its own</span>
    <span style="color:#00f;font-weight:700">if</span> <span style="color:#00f;font-weight:700">!</span>project<span style="color:#00f;font-weight:700">.</span>name<span style="color:#00f;font-weight:700">.</span>contains<span style="color:#036a07">boot</span> {
        <span style="color:#06f;font-style:italic">//we exclude transitive dependencies, because spring-data</span>
        <span style="color:#06f;font-style:italic">//will take care of these</span>
           compile spring<span style="color:#00f;font-weight:700">.</span>contextSupport {
           exclude  module<span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">spring-context</span>
           exclude  module<span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">spring-beans</span>
           exclude  module<span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">spring-core</span>
        }
        <span style="color:#06f;font-style:italic">//we exclude the &apos;hibernate&apos; transitive dependency</span>
        <span style="color:#06f;font-style:italic">//to have control over the version used</span>
        compile hibernate<span style="color:#00f;font-weight:700">.</span>tx {
       exclude group<span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">org.hibernate</span>, module<span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">hibernate</span>
    }
        compile spring<span style="color:#00f;font-weight:700">.</span>orm, spring<span style="color:#00f;font-weight:700">.</span>context, misc<span style="color:#00f;font-weight:700">.</span>slf4jJcl,
           misc<span style="color:#00f;font-weight:700">.</span>logback, db<span style="color:#00f;font-weight:700">.</span>h2, misc<span style="color:#00f;font-weight:700">.</span>lang3,
         hibernate<span style="color:#00f;font-weight:700">.</span>em
     }
     testCompile testing<span style="color:#00f;font-weight:700">.</span>junit
}
</pre>
                                        <div class="Para" id="Par39">To observe the detailed 
                                            <span id="ITerm19">behavior                                  </span> of the example code as we modify the transaction attributes, let’s also turn on the 
                                            <span class="EmphasisFontCategoryNonProportional">DEBUG</span>-level logging in 
                                            <span class="EmphasisFontCategoryNonProportional">logback</span>. The following snippet shows the 
                                            <span class="EmphasisFontCategoryNonProportional">logback.xml</span> file:
                                        </div>
                                        <div class="Para" id="Par40"> 
                                            <div class="ProgramCode" id="PC4">
                                                <div class="LineGroup">
                                                    <div class="FixedLine"><pre style="background:#fff;color:#000"><span style="color:#68685b">&lt;?<span style="color:#888">xml</span><span style="color:#888"> version</span>=<span style="color:#888">1.0</span><span style="color:#888"> encoding</span>=<span style="color:#888">UTF-8</span>?&gt;</span>
<span style="color:#1c02ff">&lt;<span style="font-weight:700">configuration</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">contextListener</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">ch.qos.logback.classic.jul.LevelChangePropagator</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">resetJUL</span>&gt;</span>true<span style="color:#1c02ff">&lt;/<span style="font-weight:700">resetJUL</span>&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">contextListener</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">appender</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">console</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">ch.qos.logback.core.ConsoleAppender</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">encoder</span>&gt;</span>
            <span style="color:#1c02ff">&lt;<span style="font-weight:700">pattern</span>&gt;</span>%d{HH:mm:ss.SSS} %thread %-5level %logger{5} - %msg%n<span style="color:#1c02ff">&lt;/<span style="font-weight:700">pattern</span>&gt;</span>
        <span style="color:#1c02ff">&lt;/<span style="font-weight:700">encoder</span>&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">appender</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">logger</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">com.apress.prospring5.ch8</span> <span style="font-style:italic">level</span>=<span style="color:#036a07">debug</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">logger</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">org.springframework.transaction</span>  <span style="font-style:italic">level</span>=<span style="color:#036a07">info</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">logger</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">org.hibernate.SQL</span> <span style="font-style:italic">level</span>=<span style="color:#036a07">debug</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">root</span> <span style="font-style:italic">level</span>=<span style="color:#036a07">info</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">appender-ref</span> <span style="font-style:italic">ref</span>=<span style="color:#036a07">console</span> /&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">root</span>&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">configuration</span>&gt;</span>
</pre></div>
                                                </div>
                                            </div>                                             
                                        </div>
                                    </div>
                                    <div class="Section2 RenderAsSection2" id="Sec9">
                                        <h3 class="Heading">Sample Data Model and Common Classes</h3>
                                        <div class="Para" id="Par41">To keep things 
                                            <span id="ITerm21">simple                                  </span>, we will use just two tables, namely, the 
                                            <span class="EmphasisFontCategoryNonProportional">SINGER</span> and 
                                            <span class="EmphasisFontCategoryNonProportional">ALBUM</span> tables that we used throughout the chapters about data access. No SQL script to create the tables is needed because you can use the Hibernate property 
                                            <span class="EmphasisFontCategoryNonProportional">hibernate.hbm2ddl.auto</span> and set it to 
                                            <span class="EmphasisFontCategoryNonProportional">create-drop</span> so we’ll always have a clean run every time you test something. The tables will be generated based on the 
                                            <span class="EmphasisTypeItalic"><span class="EmphasisFontCategoryNonProportional">Singer</span></span> and 
                                            <span class="EmphasisFontCategoryNonProportional">Album</span> entities. Snippets with the annotated fields of each are depicted here:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#06f;font-style:italic">//Singer.java</span>
<span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.entities</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.io.Serializable</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.HashSet</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Set</span>;<span style="color:#00f;font-weight:700">.</span><span style="color:#00f;font-weight:700">.</span>.

@<span style="color:#00f;font-weight:700">Entity</span>
@Table(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">singer</span>)
@NamedQueries({
        @NamedQuery(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">Singer</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>FIND_ALL</span>, query <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">select s from Singer s</span>),
        @NamedQuery(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">Singer</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>COUNT_ALL</span>, query <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">select count(s) from Singer s</span>)
})
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Singer</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Serializable</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#c5060b;font-weight:700">FIND_ALL</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">Singer.findAll</span>;
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#c5060b;font-weight:700">COUNT_ALL</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">Singer.countAll</span>;
    <span style="color:#00f;font-weight:700">@Id</span>
    <span style="color:#00f;font-weight:700">@GeneratedValue</span>(<span style="color:#c5060b;font-weight:700">strategy</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#c5060b;font-weight:700">IDENTITY</span>)
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">ID</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Long</span> id;
    <span style="color:#00f;font-weight:700">@Version</span>
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">VERSION</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">int</span> version;
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">FIRST_NAME</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> firstName;
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">LAST_NAME</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> lastName;
    <span style="color:#00f;font-weight:700">@Temporal</span>(<span style="color:#00f;font-weight:700">TemporalType</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>DATE</span>)
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">BIRTH_DATE</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Date</span> birthDate;
    <span style="color:#00f;font-weight:700">@OneToMany</span>(<span style="color:#c5060b;font-weight:700">mappedBy</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">singer</span>, <span style="color:#c5060b;font-weight:700">cascade</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">CascadeType</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>ALL</span>, <span style="color:#c5060b;font-weight:700">orphanRemoval</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Set&lt;<span style="color:#00f;font-weight:700">Album</span>&gt;</span> albums <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HashSet&lt;&gt;</span>();
    .<span style="color:#00f;font-weight:700">.</span>.
}
<span style="color:#00f;font-weight:700">/</span><span style="color:#00f;font-weight:700">Album</span><span style="color:#00f;font-weight:700">.</span>java
        <span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.entities</span>;
        .<span style="color:#00f;font-weight:700">.</span>.

@<span style="color:#00f;font-weight:700">Entity</span>
@Table(name <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">album</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Album</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">Serializable</span> {
    <span style="color:#00f;font-weight:700">@Id</span>
    <span style="color:#00f;font-weight:700">@GeneratedValue</span>(<span style="color:#c5060b;font-weight:700">strategy</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#c5060b;font-weight:700">IDENTITY</span>)
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">ID</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Long</span> id;
    <span style="color:#00f;font-weight:700">@Version</span>
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">VERSION</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">int</span> version;
    <span style="color:#00f;font-weight:700">@Column</span>
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">String</span> title;
    <span style="color:#00f;font-weight:700">@Temporal</span>(<span style="color:#00f;font-weight:700">TemporalType</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>DATE</span>)
    <span style="color:#00f;font-weight:700">@Column</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">RELEASE_DATE</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Date</span> releaseDate;
    <span style="color:#00f;font-weight:700">@ManyToOne</span>
    <span style="color:#00f;font-weight:700">@JoinColumn</span>(<span style="color:#c5060b;font-weight:700">name</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">SINGER_ID</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Singer</span> singer;
    .<span style="color:#00f;font-weight:700">.</span>.
}
</pre>
                                        <div class="Para" id="Par43">These two classes will be isolated in a project named 
                                            <span class="EmphasisFontCategoryNonProportional">base-dao</span> that will be a dependency for all transaction projects. Aside from the entities, repository interfaces are defined in this project also. They will be depicted a little bit later in the session. A configuration class to define the 
                                            <span class="EmphasisFontCategoryNonProportional">DataSource</span> bean is also needed. The configuration class is shown here, and because of practical and educational purposes, the database credentials, driver, and URL will be used directly and not read from an external file. (In production you will never encounter this, though. We hope.)
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.config</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.sql.Driver</span>;<span style="color:#00f;font-weight:700">.</span><span style="color:#00f;font-weight:700">.</span>.

@<span style="color:#00f;font-weight:700">Configuration</span>
@EnableJpaRepositories(basePackages <span style="color:#00f;font-weight:700">=</span> {<span style="color:#036a07">com.apress.prospring5.ch9.repos</span>})
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">DataJpaConfig</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span>
            <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">DataJpaConfig</span><span style="color:#00f;font-weight:700">.</span>class);

    <span style="color:#00f;font-weight:700">@SuppressWarnings</span>(<span style="color:#036a07">unchecked</span>)
    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">DataSource</span> <span style="color:#0000a2;font-weight:700">dataSource</span>() {
        <span style="color:#00f;font-weight:700">try</span> {
            <span style="color:#00f;font-weight:700">SimpleDriverDataSource</span> dataSource <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">SimpleDriverDataSource</span>();
            <span style="color:#00f;font-weight:700">Class&lt;? extends <span style="color:#00f;font-weight:700">Driver</span>&gt;</span> driver <span style="color:#00f;font-weight:700">=</span>
                    (<span style="color:#00f;font-weight:700">Class&lt;? extends <span style="color:#00f;font-weight:700">Driver</span>&gt;</span>) <span style="color:#00f;font-weight:700">Class</span><span style="color:#00f;font-weight:700">.</span>forName(<span style="color:#036a07">org.h2.Driver</span>);
            dataSource<span style="color:#00f;font-weight:700">.</span>setDriverClass(driver);
            dataSource<span style="color:#00f;font-weight:700">.</span>setUrl(<span style="color:#036a07">jdbc:h2:musicdb</span>);
            dataSource<span style="color:#00f;font-weight:700">.</span>setUsername(<span style="color:#036a07">prospring5</span>);
            dataSource<span style="color:#00f;font-weight:700">.</span>setPassword(<span style="color:#036a07">prospring5</span>);
            <span style="color:#00f;font-weight:700">return</span> dataSource;
        } <span style="color:#00f;font-weight:700">catch</span> (<span style="color:#00f;font-weight:700">Exception</span> e) {
            logger<span style="color:#00f;font-weight:700">.</span>error(<span style="color:#036a07">Populator DataSource bean cannot be created!</span>, e);
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#585cf6;font-weight:700">null</span>;
        }
    }

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Properties</span> <span style="color:#0000a2;font-weight:700">hibernateProperties</span>() {
        <span style="color:#00f;font-weight:700">Properties</span> hibernateProp <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Properties</span>();
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.dialect</span>, <span style="color:#036a07">org.hibernate.dialect.H2Dialect</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.hbm2ddl.auto</span>, <span style="color:#036a07">create-drop</span>);
        <span style="color:#06f;font-style:italic">//hibernateProp.put(&quot;hibernate.format_sql&quot;, true);</span>
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.show_sql</span>, <span style="color:#585cf6;font-weight:700">true</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.max_fetch_depth</span>, <span style="color:#0000cd">3</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.jdbc.batch_size</span>, <span style="color:#0000cd">10</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.jdbc.fetch_size</span>, <span style="color:#0000cd">50</span>);
        <span style="color:#00f;font-weight:700">return</span> hibernateProp;
    }

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">JpaVendorAdapter</span> <span style="color:#0000a2;font-weight:700">jpaVendorAdapter</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HibernateJpaVendorAdapter</span>();
    }

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">EntityManagerFactory</span> <span style="color:#0000a2;font-weight:700">entityManagerFactory</span>() {
        <span style="color:#00f;font-weight:700">LocalContainerEntityManagerFactoryBean</span> factoryBean <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">LocalContainerEntityManagerFactoryBean</span>();
        factoryBean<span style="color:#00f;font-weight:700">.</span>setPackagesToScan(<span style="color:#036a07">com.apress.prospring5.ch9.entities</span>);
        factoryBean<span style="color:#00f;font-weight:700">.</span>setDataSource(dataSource());
        factoryBean<span style="color:#00f;font-weight:700">.</span>setJpaVendorAdapter(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HibernateJpaVendorAdapter</span>());
        factoryBean<span style="color:#00f;font-weight:700">.</span>setJpaProperties(hibernateProperties());
        factoryBean<span style="color:#00f;font-weight:700">.</span>setJpaVendorAdapter(jpaVendorAdapter());
        factoryBean<span style="color:#00f;font-weight:700">.</span>afterPropertiesSet();
        <span style="color:#00f;font-weight:700">return</span> factoryBean<span style="color:#00f;font-weight:700">.</span>getNativeEntityManagerFactory();
    }
}
</pre>
                                        <div class="Para" id="Par45">An embedded H2 database is defined. The credentials are set directly in the code, and the 
                                            <span class="EmphasisFontCategoryNonProportional">DataSource</span> implementation is 
                                            <span class="EmphasisFontCategoryNonProportional">SimpleDriverDataSource</span>, which is designed to be used only in simple, testing, or educational applications.
                                        </div>
                                        <div class="Para" id="Par46">Currently, using annotations is the most common way to define transaction requirements in Spring. The main benefit is that the transaction requirement together with the detail transaction properties (timeout, isolation level, propagation behavior, and so on) are defined within the code itself, which makes the application easier to trace and maintain. The configuration is also done using annotations and Java configuration classes. To enable annotation support for transaction management in Spring using XML configuration, we need to add the 
                                            <span class="EmphasisFontCategoryNonProportional">&lt;tx:annotation-driven&gt;</span> tag in the XML 
                                            <span id="ITerm24">configuration                                  </span> file. In the following configuration snippet, you can see a snippet of transactional configuration and the transactional matching namespaces. You can find the full configuration in the project in case you are interested.
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#68685b">&lt;?<span style="color:#888">xml</span><span style="color:#888"> version</span>=<span style="color:#888">1.0</span><span style="color:#888"> encoding</span>=<span style="color:#888">UTF-8</span>?&gt;</span>
<span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span>
    <span style="font-style:italic">xmlns</span>=<span style="color:#036a07">http://www.springframework.org/schema/beans</span>
    <span style="font-style:italic">xmlns</span>:xsi=<span style="color:#036a07">http://www.w3.org/2001/XMLSchema-instance</span>
       ...
    <span style="font-style:italic">xmlns</span>:tx=<span style="color:#036a07">http://www.springframework.org/schema/tx</span>
       <span style="font-style:italic">xsi</span>:schemaLocation=<span style="color:#036a07">http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/tx
        http://www.springframework.org/schema/tx/spring-tx.xsd ...</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>= <span style="color:#036a07">transactionManager</span>
        <span style="font-style:italic">class</span>=<span style="color:#036a07">org.springframework.orm.jpa.JpaTransactionManager</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">property</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">entityManagerFactory</span> <span style="font-style:italic">ref</span>=<span style="color:#036a07">emf</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">bean</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">tx</span><span style="font-weight:700">:</span><span style="font-weight:700">annotation-driven</span> /&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">emf</span>
       <span style="font-style:italic">class</span>=<span style="color:#036a07">org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean</span>&gt;</span>
        ...
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">bean</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">context</span><span style="font-weight:700">:</span><span style="font-weight:700">component-scan</span>
            <span style="font-style:italic">base-package</span>=<span style="color:#036a07">com.apress.prospring5.ch9</span> /&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">jpa</span><span style="font-weight:700">:</span><span style="font-weight:700">repositories</span> <span style="font-style:italic">base-package</span>=<span style="color:#036a07">com.apress.prospring5.ch9.repos</span>
                      <span style="font-style:italic">entity-manager-factory-ref</span>=<span style="color:#036a07">emf</span>
                      <span style="font-style:italic">transaction-manager-ref</span>=<span style="color:#036a07">transactionManager</span>/&gt;</span>
<span style="color:#1c02ff">&lt;/<span style="font-weight:700">beans</span>&gt;</span>
</pre>
                                        <div class="Para" id="Par48">Because we are using JPA, you define the 
                                            <span class="EmphasisFontCategoryNonProportional">JpaTransactionManager</span> bean. The 
                                            <span class="EmphasisFontCategoryNonProportional">&lt;tx:annotation-driven&gt;</span> tag specifies that we are using annotations for transaction management. This simple definition instructs Spring to look for a bean named 
                                            <span class="EmphasisFontCategoryNonProportional">transactionManager</span> of type 
                                            <span class="EmphasisFontCategoryNonProportional">PlatformTransactionManager</span>. If the transaction bean is named differently, let’s say 
                                            <span class="EmphasisFontCategoryNonProportional">customTransactionManager</span>, the element definition must be declared with the 
                                            <span class="EmphasisFontCategoryNonProportional">transaction-manager</span> attribute that must receive as a value the name of the transaction management bean.
                                        </div>
                                        <div class="Para" id="Par49"> 
                                            <div class="ProgramCode" id="PC8">
                                                <div class="FixedLine">&lt;tx:annotation-driven 
                                                    <span class="EmphasisTypeUnderline">transaction-manager</span>=&quot;customTransactionManager&quot;/&gt;
                                                </div>
                                            </div>                                             
                                        </div>
                                        <div class="Para" id="Par50">The 
                                            <span id="ITerm25"> <span class="EmphasisFontCategoryNonProportional">EntityManagerFactory</span> </span> bean is then defined, followed by the 
                                            <span class="EmphasisFontCategoryNonProportional">&lt;context:component-scan&gt;</span> tag to scan the service-layer classes. Finally, the 
                                            <span class="EmphasisFontCategoryNonProportional">&lt;jpa:repositories&gt;</span> tag is used to enable Spring Data JPA’s repository abstraction. This element is replaced in the 
                                            <span class="EmphasisFontCategoryNonProportional">DataJpaConfiguration</span> class with the 
                                            <span class="EmphasisFontCategoryNonProportional">@EnableJpaRepositories</span> annotation.
                                        </div>
                                        <div class="Para" id="Par51">In professional environments, it is a common practice to separate the persistence configuration (DAO) from the transactional configuration (service). That is why the contents of the XML introduced before were split in the Java configuration into two configuration classes. 
                                            <span class="EmphasisFontCategoryNonProportional">DataJpaConfig</span>, which was introduced before, contains only data access beans, and 
                                            <span class="EmphasisFontCategoryNonProportional">ServicesConfig</span>, which is depicted next, contains only transactional management–related beans:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.config</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Autowired</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Bean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.ComponentScan</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Configuration</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.orm.jpa.JpaTransactionManager</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.PlatformTransactionManager</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.annotation.EnableTransactionManagement</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.EntityManagerFactory</span>;

@<span style="color:#00f;font-weight:700">Configuration</span>
@<span style="color:#00f;font-weight:700">EnableTransactionManagement</span>
@ComponentScan(basePackages <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">com.apress.prospring5.ch9</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">ServicesConfig</span> {
    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">EntityManagerFactory</span> entityManagerFactory;

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">PlatformTransactionManager</span> <span style="color:#0000a2;font-weight:700">transactionManager</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">JpaTransactionManager</span>(entityManagerFactory);
    }
}
</pre>
                                        <div class="Para" id="Par53">For the implementation of the 
                                            <span class="EmphasisFontCategoryNonProportional">SingerService</span> 
                                            <span id="ITerm26">interface                                  </span>, we begin by creating the class with an empty implementation of all the methods in the 
                                            <span class="EmphasisFontCategoryNonProportional">SingerService</span> interface. Let’s implement the 
                                            <span class="EmphasisFontCategoryNonProportional">SingerService.findAll()</span> method first. The following code snippet shows the 
                                            <span class="EmphasisFontCategoryNonProportional">SingerServiceImpl</span> class with the 
                                            <span class="EmphasisFontCategoryNonProportional">findAll()</span> method implemented:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.services</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.entities.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.repos.SingerRepository</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.google.common.collect.Lists</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Autowired</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Service</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.annotation.Propagation</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.annotation.Transactional</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

@Service(<span style="color:#036a07">singerService</span>)
@<span style="color:#00f;font-weight:700">Transactional</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerServiceImpl</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerService</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SingerRepository</span> singerRepository;

    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setSingerRepository</span>(<span style="color:#00f;font-weight:700">SingerRepository</span> <span style="font-style:italic">singerRepository</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>singerRepository <span style="color:#00f;font-weight:700">=</span> singerRepository;
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">@Transactional</span>(<span style="color:#c5060b;font-weight:700">readOnly</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAll</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">Lists</span><span style="color:#00f;font-weight:700">.</span>newArrayList(singerRepository<span style="color:#00f;font-weight:700">.</span>findAll());
    }
}
</pre>
                                        <div class="Para" id="Par55">When using annotation-based transaction management, the only annotation that we need to deal with is 
                                            <span class="EmphasisFontCategoryNonProportional">@Transactional</span>. In the previous code snippet, the 
                                            <span id="ITerm27"> <span class="EmphasisFontCategoryNonProportional">@Transactional</span> annotation                                  </span> is applied at the class level, which means that, by default, Spring will ensure that a transaction is present before the execution of each method within the class. The 
                                            <span class="EmphasisFontCategoryNonProportional">@Transactional</span> annotation supports a number of attributes that you can provide to override the default behavior. Table 
                                            <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html#Tab3">9-3</a></span> shows the available attributes, together with the possible and default values.
                                            <div class="Table" id="Tab3">
                                                <div class="Caption" xml:lang="en">
                                                    <div class="CaptionContent">
                                                        <span class="CaptionNumber">Table 9-3.</span>
                                                        <div class="SimplePara">Attributes for the @Transactional Annotation</div>
                                                    </div>
                                                </div>
                                                <table border="1">
                                                    <colgroup>
                                                        <col>
                                                        <col>
                                                        <col>
                                                    </colgroup>
                                                    <thead>
                                                        <tr class="header">
                                                            <th>
                                                                <div class="SimplePara">Attribute Name</div>
                                                            </th>
                                                            <th>
                                                                <div class="SimplePara">Default Value</div>
                                                            </th>
                                                            <th>
                                                                <div class="SimplePara">Possible Values</div>
                                                            </th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr class="noclass">
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">propagation</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">Propagation.REQUIRED</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">Propagation.REQUIRED</span> 
                                                                </div>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">Propagation.SUPPORTS</span> 
                                                                </div>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">Propagation.MANDATORY</span> 
                                                                </div>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">Propagation.REQUIRES_NEW</span> 
                                                                </div>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">Propagation.NOT_SUPPORTED</span> 
                                                                </div>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">Propagation.NEVER</span> 
                                                                </div>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">Propagation.NESTED</span> 
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr class="noclass">
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">isolation</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">Isolation.DEFAULT</span> (default isolation level of the underlying resource)
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">Isolation.DEFAULT</span> 
                                                                </div>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">Isolation.READ_UNCOMMITTED</span> 
                                                                </div>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">Isolation.READ_COMMITTED</span> 
                                                                </div>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">Isolation.REPEATABLE_READ</span> 
                                                                </div>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">Isolation.SERIALIZABLE</span> 
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr class="noclass">
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">timeout</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">TransactionDefinition.TIMEOUT_DEFAULT</span> (default transaction timeout in seconds of the underlying resource)
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">An integer value larger than zero; indicates the number in seconds for timeout</div>
                                                            </td>
                                                        </tr>
                                                        <tr class="noclass">
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">readOnly</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">false</div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">{
                                                                    <span class="EmphasisFontCategoryNonProportional">true</span>, 
                                                                    <span class="EmphasisFontCategoryNonProportional">false</span>}
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr class="noclass">
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">rollbackFor</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">Exception classes for which the transaction will be rolled back</div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">N/A</div>
                                                            </td>
                                                        </tr>
                                                        <tr class="noclass">
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">rollbackForClassName</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">Exception class names for which the transaction will be rolled back</div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">N/A</div>
                                                            </td>
                                                        </tr>
                                                        <tr class="noclass">
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">noRollbackFor</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">Exception classes for which the transaction will not be rolled back</div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">N/A</div>
                                                            </td>
                                                        </tr>
                                                        <tr class="noclass">
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">noRollbackForClassName</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">Exception class names for which the transaction will not be rolled back</div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">N/A</div>
                                                            </td>
                                                        </tr>
                                                        <tr class="noclass">
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional">value</span> 
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara"> 
                                                                    <span class="EmphasisFontCategoryNonProportional"></span> (a qualifier value for the specified transaction)
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="SimplePara">N/A</div>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>                                             
                                        </div>
                                        <div class="Para" id="Par56">As a result, based on Table 
                                            <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html#Tab3">9-3</a></span>, the 
                                            <span id="ITerm28"> <span class="EmphasisFontCategoryNonProportional">@Transactional</span> annotation                                  </span> without any attribute means that the transaction propagation is required, the isolation is the default, the timeout is the default, and the mode is read-write. For the 
                                            <span class="EmphasisFontCategoryNonProportional">findAll()</span> method introduced previously, the method is annotated with 
                                            <span class="EmphasisFontCategoryNonProportional">@Transactional(readOnly=true)</span>. This will override the default annotation applied at the class level, with all other attributes unchanged, but the transaction is set to read-only. The following code snippet shows the testing program for the 
                                            <span class="EmphasisFontCategoryNonProportional">findAll()</span> method:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.config.DataJpaConfig</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.config.ServicesConfig</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.entities.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.services.SingerService</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.AnnotationConfigApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">TxAnnotationDemo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">ServicesConfig</span><span style="color:#00f;font-weight:700">.</span>class,
                        <span style="color:#00f;font-weight:700">DataJpaConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">SingerService</span> singerService <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">SingerService</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> singers <span style="color:#00f;font-weight:700">=</span> singerService<span style="color:#00f;font-weight:700">.</span>findAll();
        singers<span style="color:#00f;font-weight:700">.</span>forEach(s <span style="color:#00f;font-weight:700">-</span><span style="color:#00f;font-weight:700">&gt;</span> <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(s));
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                                        <div class="Para" id="Par58">With the proper logging enabled, in other words, 
                                            <span class="EmphasisFontCategoryNonProportional">&lt;logger name=&quot;org.springframework.orm.jpa&quot; level=&quot;debug&quot;/&gt;</span>, you will be able to see in the log messages related to transaction 
                                            <span id="ITerm29">handling                                  </span>. Running the program produces the following reduced output (see the debug log in the console for full details):
                                        </div>
                                        <pre style="background:#fff;color:#000">DEBUG o.s.o.j.JpaTransactionManager - Creating new transaction with name
  [com.apress.prospring5.ch9.services.SingerServiceImpl.findAll]:
     PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly; &apos;&apos;
DEBUG o.s.o.j.JpaTransactionManager - Participating in existing transaction
Hibernate: select singer0_.ID as ID1_1_, singer0_.BIRTH_DATE as BIRTH_DA2_1_,
   singer0_.FIRST_NAME as FIRST_NA3_1_, singer0_.LAST_NAME as LAST_NAM4_1_,
   singer0_.VERSION as VERSION5_1_ from singer singer0_
DEBUG o.s.o.j.JpaTransactionManager - Closing JPA EntityManager
 [...] after transaction
DEBUG o.s.o.j.JpaTransactionManager - Initiating transaction commit
Singer - Id: 1, First name: John, Last name: Mayer, Birthday: 1977-10-16
Singer - Id: 2, First name: Eric, Last name: Clapton, Birthday: 1945-03-30
Singer - Id: 3, First name: John, Last name: Butler, Birthday: 1975-04-01
</pre>
                                        <div class="Para" id="Par60">As shown in the previous output, the irrelevant output statements were removed for clarity. First, before the 
                                            <span id="ITerm30"> <span class="EmphasisFontCategoryNonProportional">findAll()</span> </span> method is run, Spring’s 
                                            <span class="EmphasisFontCategoryNonProportional">JpaTransactionManager</span> creates a new transaction (the name is equal to the fully qualified class name with the method name) with default attributes, but the transaction is set to read-only, as defined at the method-level 
                                            <span class="EmphasisFontCategoryNonProportional">@Transactional</span> annotation. Then, the query is submitted, and upon completion and without any errors, the transaction is committed. The 
                                            <span class="EmphasisFontCategoryNonProportional">JpaTransactionManager</span> handles the creation and commit operations of the transaction.
                                        </div>
                                        <div class="Para" id="Par61">Let’s proceed to the implementation of the update operation. We need to implement both the 
                                            <span class="EmphasisFontCategoryNonProportional">findById()</span> and 
                                            <span class="EmphasisFontCategoryNonProportional">save()</span> methods in the 
                                            <span class="EmphasisFontCategoryNonProportional">SingerServiceImpl</span> interface. The following code snippet shows the implementation:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.services</span>;
.<span style="color:#00f;font-weight:700">.</span>.

@Service(<span style="color:#036a07">singerService</span>)
@<span style="color:#00f;font-weight:700">Transactional</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerServiceImpl</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerService</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SingerRepository</span> singerRepository;

    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setSingerRepository</span>(<span style="color:#00f;font-weight:700">SingerRepository</span> <span style="font-style:italic">singerRepository</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>singerRepository <span style="color:#00f;font-weight:700">=</span> singerRepository;
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">@Transactional</span>(<span style="color:#c5060b;font-weight:700">readOnly</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAll</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">Lists</span><span style="color:#00f;font-weight:700">.</span>newArrayList(singerRepository<span style="color:#00f;font-weight:700">.</span>findAll());
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">@Transactional</span>(<span style="color:#c5060b;font-weight:700">readOnly</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">findById</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">id</span>) {
        <span style="color:#00f;font-weight:700">return</span> singerRepository<span style="color:#00f;font-weight:700">.</span>findById(id)<span style="color:#00f;font-weight:700">.</span>get();
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">save</span>(<span style="color:#00f;font-weight:700">Singer</span> <span style="font-style:italic">singer</span>) {
        <span style="color:#00f;font-weight:700">return</span> singerRepository<span style="color:#00f;font-weight:700">.</span>save(singer);
    }
}
</pre>
                                        <div class="Para" id="Par63">The 
                                            <span id="ITerm31"> <span class="EmphasisFontCategoryNonProportional">findById()</span> </span> method is also annotated with 
                                            <span class="EmphasisFontCategoryNonProportional">@Transactional(readOnly=true)</span>. Generally, the 
                                            <span class="EmphasisFontCategoryNonProportional">readOnly=true</span> attribute should be applied to all finder methods. The main reason is that most persistence providers will perform a certain level of optimization on read-only transactions. For example, Hibernate will not maintain the snapshots of the managed instances retrieved from the database with read-only turned on.
                                        </div>
                                        <div class="Para" id="Par64">For the 
                                            <span id="ITerm32"> <span class="EmphasisFontCategoryNonProportional">save()</span> </span> method, we simply invoke the 
                                            <span class="EmphasisFontCategoryNonProportional">CrudRepository.save()</span> method and don’t provide any annotation. This means the class-level annotation will be used, which is a read-write transaction. Let’s modify the 
                                            <span class="EmphasisFontCategoryNonProportional">TxAnnotationDemo</span> class for testing the 
                                            <span class="EmphasisFontCategoryNonProportional">save()</span> method, as shown in the following code:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9</span>;
.<span style="color:#00f;font-weight:700">.</span>.

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">TxAnnotationDemo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">ServicesConfig</span><span style="color:#00f;font-weight:700">.</span>class,
                        <span style="color:#00f;font-weight:700">DataJpaConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">SingerService</span> singerService <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">SingerService</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> singers <span style="color:#00f;font-weight:700">=</span> singerService<span style="color:#00f;font-weight:700">.</span>findAll();
        singers<span style="color:#00f;font-weight:700">.</span>forEach(s <span style="color:#00f;font-weight:700">-</span><span style="color:#00f;font-weight:700">&gt;</span> <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(s));
        <span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">=</span> singerService<span style="color:#00f;font-weight:700">.</span>findById(<span style="color:#0000cd">1L</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setFirstName(<span style="color:#036a07">John Clayton</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setLastName(<span style="color:#036a07">Mayer</span>);
        singerService<span style="color:#00f;font-weight:700">.</span>save(singer);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Singer saved successfully: </span> <span style="color:#00f;font-weight:700">+</span> singer);
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                                        <div class="Para ParaOneEmphasisChild" id="Par66">The 
                                            <span class="EmphasisFontCategoryNonProportional">Singer</span> object with an ID of 1 is retrieved, and then the first name is updated and saved to the database. Running the code produces the following relevant output:
                                        </div>
                                        <pre style="background:#fff;color:#000">Singer saved successfully: Singer - Id: 1, First name: John Clayton,
   Last name: Mayer, Birthday: 1977-10-16
</pre>
                                        <div class="Para" id="Par68">The 
                                            <span class="EmphasisFontCategoryNonProportional">save()</span> method gets the default attributes that are inherited from the class-level 
                                            <span class="EmphasisFontCategoryNonProportional">@Transactional</span> annotation. Upon completion of the update operation, Spring’s 
                                            <span class="EmphasisFontCategoryNonProportional">JpaTransactionManager</span> fires a transaction commit, which causes Hibernate to flush the persistence context and commit the underlying JDBC connection to the database. Finally, let’s take a look at the 
                                            <span class="EmphasisFontCategoryNonProportional">countAll()</span> method. We will investigate two transaction configurations for this method. Although the 
                                            <span class="EmphasisFontCategoryNonProportional">CrudRepository.count()</span> method can fulfill the purpose, we will not use that method. Instead, we will implement another method for demonstration purposes, mainly because the methods defined by the 
                                            <span class="EmphasisFontCategoryNonProportional">CrudRepository</span> interface in Spring Data are already marked with the appropriate transaction attributes.
                                        </div>
                                        <div class="Para" id="Par69">The following code snippet shows the new method 
                                            <span class="EmphasisFontCategoryNonProportional">countAllSingers()</span> defined in the 
                                            <span class="EmphasisFontCategoryNonProportional">SingerRepository</span> interface:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.repos</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.entities.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.data.jpa.repository.JpaRepository</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.data.jpa.repository.Query</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.data.repository.CrudRepository</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">interface</span> <span style="text-decoration:underline">SingerRepository</span> <span style="color:#00f;font-weight:700">extends</span>
        <span style="font-style:italic">CrudRepository&lt;<span style="color:#00f;font-weight:700">Singer</span>, <span style="color:#00f;font-weight:700">Long</span>&gt;</span> {
    <span style="color:#00f;font-weight:700">@Query</span>(<span style="color:#036a07">select count(s) from Singer s</span>)
    <span style="color:#00f;font-weight:700">Long</span> <span style="color:#0000a2;font-weight:700">countAllSingers</span>();
}
</pre>
                                        <div class="Para" id="Par71">For the new 
                                            <span class="EmphasisFontCategoryNonProportional">countAllSingers()</span> method, the 
                                            <span id="ITerm33"> <span class="EmphasisFontCategoryNonProportional">@Query</span> </span> annotation is applied, with the value equaling the JPQL statement that counts the number of contacts. The following code snippet shows the implementation of the 
                                            <span class="EmphasisFontCategoryNonProportional">countAll()</span> method in the 
                                            <span class="EmphasisFontCategoryNonProportional">SingerServiceImpl</span> class:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.services</span>;
.<span style="color:#00f;font-weight:700">.</span>.

@Service(<span style="color:#036a07">singerService</span>)
@<span style="color:#00f;font-weight:700">Transactional</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerServiceImpl</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerService</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SingerRepository</span> singerRepository;

    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">setSingerRepository</span>(<span style="color:#00f;font-weight:700">SingerRepository</span> <span style="font-style:italic">singerRepository</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>singerRepository <span style="color:#00f;font-weight:700">=</span> singerRepository;
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">@Transactional</span>(<span style="color:#c5060b;font-weight:700">readOnly</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">long</span> <span style="color:#0000a2;font-weight:700">countAll</span>() {
        <span style="color:#00f;font-weight:700">return</span> singerRepository<span style="color:#00f;font-weight:700">.</span>countAllSingers();
    }
}
</pre>
                                        <div class="Para" id="Par73">The annotation is the same as other finder methods. To test this method, just add 
                                            <span class="EmphasisFontCategoryNonProportional">System.out.println(&quot;Singer count: &quot; + contactService.countAll());</span> in the 
                                            <span class="EmphasisFontCategoryNonProportional">main()</span> method of the 
                                            <span class="EmphasisFontCategoryNonProportional">TxAnnotationDemo</span> class and watch the console. If you see a message like 
                                            <span class="EmphasisFontCategoryNonProportional">Singer count: 3</span>, the method was executed correctly.
                                        </div>
                                        <div class="Para" id="Par74">In this output, you can see that the transaction for 
                                            <span id="ITerm34"> <span class="EmphasisFontCategoryNonProportional">countAll()</span> </span> was created with read-only equaling true, as expected. But for the 
                                            <span class="EmphasisFontCategoryNonProportional">countAll()</span> function, we don’t want it to be enlisted in a transaction at all. We don’t need the result to be managed by the underlying JPA 
                                            <span class="EmphasisFontCategoryNonProportional">EntityManager</span>. Instead, we just want to get the count and forget about it. In this case, we can override the transaction propagation behavior to 
                                            <span class="EmphasisFontCategoryNonProportional">Propagation.NEVER</span>. The following method shows the revised 
                                            <span class="EmphasisFontCategoryNonProportional">countAll()</span> method:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.services</span>;
.<span style="color:#00f;font-weight:700">.</span>.

@Service(<span style="color:#036a07">singerService</span>)
@<span style="color:#00f;font-weight:700">Transactional</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerServiceImpl</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerService</span> {
    .<span style="color:#00f;font-weight:700">.</span>.

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">@Transactional</span>(<span style="color:#c5060b;font-weight:700">propagation</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">Propagation</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>NEVER</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">long</span> <span style="color:#0000a2;font-weight:700">countAll</span>() {
        <span style="color:#00f;font-weight:700">return</span> singerRepository<span style="color:#00f;font-weight:700">.</span>countAllSingers();
    }
}
</pre>
                                        <div class="Para" id="Par76">Run the testing code again, and you will 
                                            <span id="ITerm35">find                                  </span> that the transaction will not be created for the 
                                            <span class="EmphasisFontCategoryNonProportional">countAll()</span> method in the debug output.
                                        </div>
                                        <div class="Para" id="Par77">This section covered some major configurations that you will deal with when processing transactions on a day-to-day basis. For special cases, you may need to define the timeout, isolation level, rollback (or not) for specific exceptions, and so on.</div>
                                        <div class="Para ParaTypeImportant" id="Par78">
                                            <img alt="A315511_5_En_9_Figa_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Figa_HTML.jpg" height="28" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Figa_HTML.jpg" width="30"/> Spring’s 
                                            <span class="EmphasisFontCategoryNonProportional">JpaTransactionManager</span> doesn’t support a custom isolation level. Instead, it always uses the default isolation level for the underlying data store. If you are using Hibernate as the JPA service provider, you can use a workaround: extend the 
                                            <span class="EmphasisFontCategoryNonProportional">HibernateJpaDialect</span> class to support a custom isolation level.
                                        </div>
                                    </div>
                                    <div class="Section2 RenderAsSection2" id="Sec10">
                                        <h3 class="Heading">Using AOP Configuration for Transaction Management</h3>
                                        <div class="Para" id="Par79">Another common 
                                            <span id="ITerm36">approach                      </span> of declarative transaction management is to use Spring’s AOP support. Before Spring version 2, we needed to use the 
                                            <span class="EmphasisFontCategoryNonProportional">TransactionProxyFactoryBean</span> class to define transaction requirements for Spring beans. However, ever since version 2, Spring provides a much simpler way by introducing the 
                                            <span class="EmphasisFontCategoryNonProportional">aop</span> namespace and using the common AOP configuration technique for defining transaction requirements. Of course, after introducing annotations, this way of configuring transaction management is deprecated as well. But is useful to know it exists, just in case you might need to wrap in a transaction code that is not part of your project and you cannot edit it to add 
                                            <span class="EmphasisFontCategoryNonProportional">@Transaction</span> annotations in it.
                                        </div>
                                        <div class="Para ParaOneEmphasisChild" id="Par80">In the following configuration snippet, the example in the previous section is configured using XML and makes use of the 
                                            <span class="EmphasisFontCategoryNonProportional">aop</span> namespace:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#68685b">&lt;?<span style="color:#888">xml</span><span style="color:#888"> version</span>=<span style="color:#888">1.0</span><span style="color:#888"> encoding</span>=<span style="color:#888">UTF-8</span>?&gt;</span>
<span style="color:#1c02ff">&lt;<span style="font-weight:700">beans</span>
    <span style="font-style:italic">xmlns</span>=<span style="color:#036a07">http://www.springframework.org/schema/beans</span>
    <span style="font-style:italic">xmlns</span>:xsi=<span style="color:#036a07">http://www.w3.org/2001/XMLSchema-instance</span>
    <span style="font-style:italic">xmlns</span>:context=<span style="color:#036a07">http://www.springframework.org/schema/context</span>
    <span style="font-style:italic">xmlns</span>:tx=<span style="color:#036a07">http://www.springframework.org/schema/tx</span>
    <span style="font-style:italic">xmlns</span>:aop=<span style="color:#036a07">http://www.springframework.org/schema/aop</span>
       <span style="font-style:italic">xsi</span>:schemaLocation=<span style="color:#036a07">
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/tx
        http://www.springframework.org/schema/tx/spring-tx.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">dataJpaConfig</span>
       <span style="font-style:italic">class</span>=<span style="color:#036a07">com.apress.prospring5.ch9.config.DataJpaConfig</span> /&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">aop</span><span style="font-weight:700">:</span><span style="font-weight:700">config</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">aop</span><span style="font-weight:700">:</span><span style="font-weight:700">pointcut</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">serviceOperation</span> <span style="font-style:italic">expression</span>=
                <span style="color:#036a07">execution(* com.apress.prospring5.ch9.*ServiceImpl.*(..))</span>/&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">aop</span><span style="font-weight:700">:</span><span style="font-weight:700">advisor</span> <span style="font-style:italic">pointcut-ref</span>=<span style="color:#036a07">serviceOperation</span> <span style="font-style:italic">advice-ref</span>=<span style="color:#036a07">txAdvice</span>/&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">aop</span><span style="font-weight:700">:</span><span style="font-weight:700">config</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">tx</span><span style="font-weight:700">:</span><span style="font-weight:700">advice</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">txAdvice</span>&gt;</span>
        <span style="color:#1c02ff">&lt;<span style="font-weight:700">tx</span><span style="font-weight:700">:</span><span style="font-weight:700">attributes</span>&gt;</span>
            <span style="color:#1c02ff">&lt;<span style="font-weight:700">tx</span><span style="font-weight:700">:</span><span style="font-weight:700">method</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">find*</span> <span style="font-style:italic">read-only</span>=<span style="color:#036a07">true</span>/&gt;</span>
            <span style="color:#1c02ff">&lt;<span style="font-weight:700">tx</span><span style="font-weight:700">:</span><span style="font-weight:700">method</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">count*</span> <span style="font-style:italic">propagation</span>=<span style="color:#036a07">NEVER</span>/&gt;</span>
            <span style="color:#1c02ff">&lt;<span style="font-weight:700">tx</span><span style="font-weight:700">:</span><span style="font-weight:700">method</span> <span style="font-style:italic">name</span>=<span style="color:#036a07">*</span>/&gt;</span>
        <span style="color:#1c02ff">&lt;/<span style="font-weight:700">tx</span><span style="font-weight:700">:</span><span style="font-weight:700">attributes</span>&gt;</span>
    <span style="color:#1c02ff">&lt;/<span style="font-weight:700">tx</span><span style="font-weight:700">:</span><span style="font-weight:700">advice</span>&gt;</span>
    <span style="color:#1c02ff">&lt;<span style="font-weight:700">bean</span> <span style="font-style:italic">id</span>=<span style="color:#036a07">transactionManager</span> <span style="font-style:italic">class</span>=<span style="color:#036a07">org.springframework.orm.jpa.JpaTransactionManager
        
        &lt;property name=</span>entityManagerFactory<span style="color:#036a07"> ref=</span>entityManagerFactory<span style="color:#036a07">/&gt;
    &lt;/bean&gt;
    &lt;context:component-scan
            base-package=</span>com.apress.prospring5.ch9.services<span style="color:#036a07">&quot; /&gt;
&lt;/beans&gt;
</span></span></pre>
                                        <div class="Para" id="Par82">The configuration is quite similar to the 
                                            <span id="ITerm37">XML                      </span> one introduced at the beginning of the section. Basically, the 
                                            <span class="EmphasisFontCategoryNonProportional">&lt;tx:annotation-driven&gt;</span> tag is removed, and the 
                                            <span class="EmphasisFontCategoryNonProportional">&lt;context:component-scan&gt;</span> tag is modified for the package name we used for declarative transaction management. The most important tags are 
                                            <span class="EmphasisFontCategoryNonProportional">&lt;aop:config&gt;</span> and 
                                            <span class="EmphasisFontCategoryNonProportional">&lt;tx:advice&gt;</span>.
                                        </div>
                                        <div class="Para" id="Par83">Under the 
                                            <span class="EmphasisFontCategoryNonProportional">&lt;aop:config&gt;</span> tag, a pointcut is defined for all operations within the service layer (that is, all implementation classes under the 
                                            <span class="EmphasisFontCategoryNonProportional">com.apress.prospring5.ch9.services</span> package). The advice is referencing the bean with an ID of 
                                            <span class="EmphasisFontCategoryNonProportional">txAdvice</span>, which is defined by the 
                                            <span class="EmphasisFontCategoryNonProportional">&lt;tx:advice&gt;</span> tag. In the 
                                            <span class="EmphasisFontCategoryNonProportional">&lt;tx:advice&gt;</span> tag, we configure the transaction attributes for various methods that we want to participate in a transaction. As shown in the tag, you specify that all finder methods (methods with the prefix 
                                            <span class="EmphasisFontCategoryNonProportional">find</span>) will be read-only, and we specify that the count methods (methods with the prefix 
                                            <span class="EmphasisFontCategoryNonProportional">count</span>) will not participate in the transaction. For the rest of the methods, the default transaction behavior will be applied. This configuration is the same as the one in the annotation example.
                                        </div>
                                        <div class="Para" id="Par84">Because transaction management is done explicitly through 
                                            <span class="EmphasisFontCategoryNonProportional">aop</span>, the 
                                            <span class="EmphasisFontCategoryNonProportional">@Transactional</span> annotation is no longer needed on the 
                                            <span class="EmphasisFontCategoryNonProportional">SingerServiceImpl</span> class or methods within.
                                        </div>
                                        <div class="Para" id="Par85">To test the previous configuration, you can use the following class:</div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.entities.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.services.SingerService</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericXmlApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">TxDeclarativeDemo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GenericXmlApplicationContext</span>();
        ctx<span style="color:#00f;font-weight:700">.</span>load(<span style="color:#036a07">classpath:spring/tx-declarative-app-context.xml</span>);
        ctx<span style="color:#00f;font-weight:700">.</span>refresh();
        <span style="color:#00f;font-weight:700">SingerService</span> singerService <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">SingerService</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#06f;font-style:italic">// Testing  findAll()</span>
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> singers <span style="color:#00f;font-weight:700">=</span> singerService<span style="color:#00f;font-weight:700">.</span>findAll();
        singers<span style="color:#00f;font-weight:700">.</span>forEach(s <span style="color:#00f;font-weight:700">-</span><span style="color:#00f;font-weight:700">&gt;</span> <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(s));
        <span style="color:#06f;font-style:italic">// Testing save()</span>
        <span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">=</span> singerService<span style="color:#00f;font-weight:700">.</span>findById(<span style="color:#0000cd">1L</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setFirstName(<span style="color:#036a07">John Clayton</span>);
        singerService<span style="color:#00f;font-weight:700">.</span>save(singer);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Singer saved successfully: </span> <span style="color:#00f;font-weight:700">+</span> singer);
        <span style="color:#06f;font-style:italic">// Testing  countAll()</span>
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Singer count: </span> <span style="color:#00f;font-weight:700">+</span> singerService<span style="color:#00f;font-weight:700">.</span>countAll());
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                                        <div class="Para" id="Par87">We will leave you to test the 
                                            <span id="ITerm38">program                      </span> and observe the output for transaction-related operations that Spring and Hibernate have performed. Basically, they are the same as the annotation example.
                                        </div>
                                    </div>
                                </div>
                                <div class="Section1 RenderAsSection1" id="Sec11">
                                    <h2 class="Heading">Using Programmatic Transactions</h2>
                                    <div class="Para" id="Par88">The third option is to control the transaction behavior 
                                        <span id="ITerm39">programmatically                  </span>. In this case, we have two options. The first one is to inject an instance of 
                                        <span class="EmphasisFontCategoryNonProportional">PlatformTransactionManager</span> into the bean and interact with the transaction manager directly. Another option is to use the Spring-provided 
                                        <span class="EmphasisFontCategoryNonProportional">TransactionTemplate</span> class, which simplifies your work a lot. In this section, we demonstrate using the 
                                        <span class="EmphasisFontCategoryNonProportional">TransactionTemplate class</span>. To make it simple, we focus on implementing the 
                                        <span class="EmphasisFontCategoryNonProportional">SingerServiceImpl.countAll()</span> method. The following code snippet depicts the 
                                        <span class="EmphasisFontCategoryNonProportional">ServiceConfig</span> class, modified for using programmatic transactions:
                                    </div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.config</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Autowired</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Bean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.ComponentScan</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Configuration</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.orm.jpa.JpaTransactionManager</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.PlatformTransactionManager</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.TransactionDefinition</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.support.TransactionTemplate</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.EntityManagerFactory</span>;

@<span style="color:#00f;font-weight:700">Configuration</span>
@ComponentScan(basePackages <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">com.apress.prospring5.ch9</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">ServicesConfig</span> {
    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">EntityManagerFactory</span> entityManagerFactory;

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">TransactionTemplate</span> <span style="color:#0000a2;font-weight:700">transactionTemplate</span>() {
        <span style="color:#00f;font-weight:700">TransactionTemplate</span> tt <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">TransactionTemplate</span>();
        tt<span style="color:#00f;font-weight:700">.</span>setPropagationBehavior(<span style="color:#00f;font-weight:700">TransactionDefinition</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>PROPAGATION_NEVER</span>);
        tt<span style="color:#00f;font-weight:700">.</span>setTimeout(<span style="color:#0000cd">30</span>);
        tt<span style="color:#00f;font-weight:700">.</span>setTransactionManager(transactionManager());
        <span style="color:#00f;font-weight:700">return</span> tt;
    }

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">PlatformTransactionManager</span> <span style="color:#0000a2;font-weight:700">transactionManager</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">JpaTransactionManager</span>(entityManagerFactory);
    }
}
</pre>
                                    <div class="Para" id="Par90">Here the AOP transaction advice is 
                                        <span id="ITerm40">removed                  </span>. In addition, a 
                                        <span class="EmphasisFontCategoryNonProportional">transactionTemplate</span> bean is defined, using the 
                                        <span class="EmphasisFontCategoryNonProportional">org.springframework.transaction.support.TransactionTemplate</span> class, with a few transaction attributes. Also, the 
                                        <span class="EmphasisFontCategoryNonProportional">@EnableTransactionManagement</span> was removed, because transaction management is not now done explicitly. Let’s take a look at the implementation of the 
                                        <span class="EmphasisFontCategoryNonProportional">countAll()</span> method, which is shown here:
                                    </div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.services</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.entities.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.repos.SingerRepository</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.google.common.collect.Lists</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Autowired</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Repository</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Service</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.support.TransactionTemplate</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.EntityManager</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.PersistenceContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

@Service(<span style="color:#036a07">singerService</span>)
@<span style="color:#00f;font-weight:700">Repository</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerServiceImpl</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerService</span> {
    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SingerRepository</span> singerRepository;
    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">TransactionTemplate</span> transactionTemplate;
    <span style="color:#00f;font-weight:700">@PersistenceContext</span>
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">EntityManager</span> em;

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">long</span> <span style="color:#0000a2;font-weight:700">countAll</span>() {
        <span style="color:#00f;font-weight:700">return</span> transactionTemplate<span style="color:#00f;font-weight:700">.</span>execute(
                transactionStatus <span style="color:#00f;font-weight:700">-</span><span style="color:#00f;font-weight:700">&gt;</span> em<span style="color:#00f;font-weight:700">.</span>createNamedQuery(<span style="color:#00f;font-weight:700">Singer</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>COUNT_ALL</span>,
                        <span style="color:#00f;font-weight:700">Long</span><span style="color:#00f;font-weight:700">.</span>class)<span style="color:#00f;font-weight:700">.</span>getSingleResult());
    }
}
</pre>
                                    <div class="Para" id="Par92">Here the 
                                        <span class="EmphasisFontCategoryNonProportional">TransactionTemplate</span> class is injected from Spring. And then in the 
                                        <span class="EmphasisFontCategoryNonProportional">countAll()</span> method, the 
                                        <span class="EmphasisFontCategoryNonProportional">TransactionTemplate.execute()</span> method is invoked, passing in a declaration of an inner class that implements the 
                                        <span class="EmphasisFontCategoryNonProportional">TransactionCallback&lt;T&gt;</span> interface. Then 
                                        <span class="EmphasisFontCategoryNonProportional">doInTransaction()</span> is overridden with the desired logic. The 
                                        <span id="ITerm41">logic                  </span> will run within the attributes as defined by the 
                                        <span class="EmphasisFontCategoryNonProportional">transactionTemplate</span> bean. The reason you are not clearly seeing all that in the previous code snippet is because Java 8 lambda expression are used. The following code is the expanded version (because it was written before lambda expressions were introduced) of the previous method:
                                    </div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">long</span> countAll() {
       <span style="color:#00f;font-weight:700">return</span> transactionTemplate<span style="color:#00f;font-weight:700">.</span>execute(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">TransactionCallback&lt;<span style="color:#00f;font-weight:700">Long</span>&gt;</span>() {
           <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Long</span> <span style="color:#0000a2;font-weight:700">doInTransaction</span>(<span style="color:#00f;font-weight:700">TransactionStatus</span> <span style="font-style:italic">transactionStatus</span>) {
               <span style="color:#00f;font-weight:700">return</span> em<span style="color:#00f;font-weight:700">.</span>createNamedQuery(<span style="color:#00f;font-weight:700">Singer</span><span style="color:#c5060b;font-weight:700"><span style="color:#00f;font-weight:700">.</span>COUNT_ALL</span>,
                       <span style="color:#00f;font-weight:700">Long</span><span style="color:#00f;font-weight:700">.</span>class)<span style="color:#00f;font-weight:700">.</span>getSingleResult();
           }
       });
   }
</pre>
                                    <div class="Para" id="Par94">The following code snippet shows the testing program:</div>
                                    <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.config.DataJpaConfig</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.config.ServicesConfig</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.services.SingerService</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.AnnotationConfigApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericApplicationContext</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">TxProgrammaticDemo</span> {
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">ServicesConfig</span><span style="color:#00f;font-weight:700">.</span>class,
                        <span style="color:#00f;font-weight:700">DataJpaConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">SingerService</span> singerService <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">SingerService</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>out<span style="color:#00f;font-weight:700">.</span>println(<span style="color:#036a07">Singer count: </span> <span style="color:#00f;font-weight:700">+</span> singerService<span style="color:#00f;font-weight:700">.</span>countAll());
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                                    <div class="Para ParaOneEmphasisChild" id="Par96">We will leave it to you to run the program and observe the result. Try to tweak the transaction attributes and see what happens in the transaction processing of the 
                                        <span class="EmphasisFontCategoryNonProportional">countAll()</span> method.
                                    </div>
                                    <div class="Section2 RenderAsSection2" id="Sec12">
                                        <h3 class="Heading">Considerations on Transaction Management</h3>
                                        <div class="Para" id="Par97">So, having discussed the various ways for implementing transaction management, which one should you use? The declarative approach is recommended in all cases, and you should avoid implementing transaction management within your code as much as possible. Most of the time, when you find it necessary to code transaction control logic in the application, it is because of bad design, and in this case, you should consider refactoring your logic into manageable pieces and have the 
                                            <span id="ITerm42">transaction                      </span> requirements defined on those pieces declaratively.
                                        </div>
                                        <div class="Para" id="Par98">For the declarative approach, using XML and using annotations both have their own pros and cons. Some developers prefer not to declare transaction requirements in code, while others prefer using annotations for easy maintenance, because you can see all the transaction requirement declarations within the code. Again, let the application requirements drive your decision, and once your team or company has standardized on the approach, stay consistent with the configuration style.</div>
                                    </div>
                                </div>
                                <div class="Section1 RenderAsSection1" id="Sec13">
                                    <h2 class="Heading">Global Transactions with Spring</h2>
                                    <div class="Para" id="Par99">Many enterprise Java applications need to access multiple back-end resources. For example, a piece of customer information received from an external business partner may need to update the databases for multiple systems (CRM, ERP, and so on). Some may even need to produce a message and send it to an MQ server via JMS for all other applications within the company that are interested in customer information. Transactions that span multiple back-end resources are referred to as 
                                        <span class="EmphasisTypeItalic">global</span> (or 
                                        <span class="EmphasisTypeItalic">distributed</span>) transactions.
                                    </div>
                                    <div class="Para" id="Par100">A main characteristic of a global transaction is the guarantee of atomicity, which means that involved resources are all updated, or none is updated. This includes complex coordination and synchronization logic that should be handled by the transaction manager. In the Java world, JTA is the de facto standard for implementing global transactions.</div>
                                    <div class="Para" id="Par101">Spring supports 
                                        <span id="ITerm43">JTA transactions                                      </span> equally well as local transactions and hides that logic from the business code. In this section, we demonstrate how to implement global transactios by using JTA with Spring.
                                    </div>
                                    <div class="Section2 RenderAsSection2" id="Sec14">
                                        <h3 class="Heading"> <span id="ITerm44">Infrastructure                      </span> for Implementing the JTA Sample</h3>
                                        <div class="Para" id="Par102">We are using the same tables as for the previous samples in this chapter. However, the embedded H2 database doesn’t fully support XA (at least at the time of writing), so in this example, we use MySQL as the back-end database.</div>
                                        <div class="Para" id="Par103">We also want to show how to implement global transactions with JTA in a stand-alone application or web container environment. So, in this example, we use Atomikos (
                                            <span class="ExternalRef"><a href="http://www.atomikos.com/Main/TransactionsEssentials"><span class="RefSource"> <span class="EmphasisFontCategoryNonProportional">www.atomikos.com/Main/TransactionsEssentials</span> </span></a></span>), which is a widely used open source JTA transaction manager for use in a non-JEE environment.
                                        </div>
                                        <div class="Para" id="Par104">To show how global transactions work, we need at least two back-end resources. To make things simple, we will use one MySQL database but two JPA entity managers to simulate the use case. The effect is the same because you have multiple JPA persistence units to distinct back-end databases.</div>
                                        <div class="Para" id="Par105">In the MySQL database, we create two 
                                            <span id="ITerm45">schemas                      </span> and corresponding users, as shown in the following DDL script:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">CREATE</span> <span style="color:#00f;font-weight:700">USER</span> &apos;<span style="color:#0000a2;font-weight:700">prospring5_a</span>&apos;@<span style="color:#036a07">localhost</span> IDENTIFIED BY <span style="color:#036a07">prospring5_a</span>;
<span style="color:#00f;font-weight:700">CREATE</span> <span style="color:#00f;font-weight:700">SCHEMA</span> <span style="color:#0000a2;font-weight:700">MUSICDB_A</span>;
<span style="color:#00f;font-weight:700">GRANT</span> ALL PRIVILEGES <span style="color:#00f;font-weight:700">ON</span> MUSICDB_A . <span style="color:#00f;font-weight:700">*</span> TO <span style="color:#036a07">prospring5_a</span>@<span style="color:#036a07">localhost</span>;
     PRIVILEGES;
<span style="color:#00f;font-weight:700">CREATE</span> <span style="color:#00f;font-weight:700">USER</span> &apos;<span style="color:#0000a2;font-weight:700">prospring5_b</span>&apos;@<span style="color:#036a07">localhost</span> IDENTIFIED BY <span style="color:#036a07">prospring5_b</span>;
<span style="color:#00f;font-weight:700">CREATE</span> <span style="color:#00f;font-weight:700">SCHEMA</span>  <span style="color:#0000a2;font-weight:700">MUSICDB_B</span>;
<span style="color:#00f;font-weight:700">GRANT</span> ALL PRIVILEGES <span style="color:#00f;font-weight:700">ON</span> MUSICDB_B . <span style="color:#00f;font-weight:700">*</span> TO <span style="color:#036a07">prospring5_b</span>@<span style="color:#036a07">localhost</span>;
     PRIVILEGES;
</pre>
                                        <div class="Para" id="Par107">After the setup has completed, we can proceed to the Spring configuration and implementation.</div>
                                    </div>
                                    <div class="Section2 RenderAsSection2" id="Sec15">
                                        <h3 class="Heading">Implementing Global Transactions with JTA</h3>
                                        <div class="Para" id="Par108">First let’s take a look at Spring’s 
                                            <span id="ITerm46">configuration                      </span>. The following code snippet depicts the 
                                            <span class="EmphasisFontCategoryNonProportional">XAJpaConfig</span> configuration class that declares beans needed to access the two databases:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.config</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.atomikos.jdbc.AtomikosDataSourceBean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.Logger</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.LoggerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Bean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Configuration</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.data.jpa.repository.config.EnableJpaRepositories</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.jdbc.datasource.SimpleDriverDataSource</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.orm.jpa.JpaVendorAdapter</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.EntityManagerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.sql.DataSource</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.sql.Driver</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Properties</span>;

@<span style="color:#00f;font-weight:700">Configuration</span>
@<span style="color:#00f;font-weight:700">EnableJpaRepositories</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">XAJpaConfig</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">XAJpaConfig</span><span style="color:#00f;font-weight:700">.</span>class);

    <span style="color:#00f;font-weight:700">@SuppressWarnings</span>(<span style="color:#036a07">unchecked</span>)
    <span style="color:#00f;font-weight:700">@Bean</span>(<span style="color:#c5060b;font-weight:700">initMethod</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">init</span>, <span style="color:#c5060b;font-weight:700">destroyMethod</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">close</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">DataSource</span> <span style="color:#0000a2;font-weight:700">dataSourceA</span>() {
        <span style="color:#00f;font-weight:700">try</span> {
            <span style="color:#00f;font-weight:700">AtomikosDataSourceBean</span> dataSource <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AtomikosDataSourceBean</span>();
            dataSource<span style="color:#00f;font-weight:700">.</span>setUniqueResourceName(<span style="color:#036a07">XADBMSA</span>);
            dataSource<span style="color:#00f;font-weight:700">.</span>setXaDataSourceClassName(
                    <span style="color:#036a07">com.mysql.cj.jdbc.MysqlXADataSource</span>);
            dataSource<span style="color:#00f;font-weight:700">.</span>setXaProperties(xaAProperties());
            dataSource<span style="color:#00f;font-weight:700">.</span>setPoolSize(<span style="color:#0000cd">1</span>);
            <span style="color:#00f;font-weight:700">return</span> dataSource;
        } <span style="color:#00f;font-weight:700">catch</span> (<span style="color:#00f;font-weight:700">Exception</span> e) {
            logger<span style="color:#00f;font-weight:700">.</span>error(<span style="color:#036a07">Populator DataSource bean cannot be created!</span>, e);
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#585cf6;font-weight:700">null</span>;
        }
    }

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Properties</span> <span style="color:#0000a2;font-weight:700">xaAProperties</span>() {
        <span style="color:#00f;font-weight:700">Properties</span> xaProp <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Properties</span>();
        xaProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">databaseName</span>, <span style="color:#036a07">musicdb_a</span>);
        xaProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">user</span>, <span style="color:#036a07">prospring5_a</span>);
        xaProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">password</span>, <span style="color:#036a07">prospring5_a</span>);
        <span style="color:#00f;font-weight:700">return</span> xaProp;
    }

    <span style="color:#00f;font-weight:700">@SuppressWarnings</span>(<span style="color:#036a07">unchecked</span>)
    <span style="color:#00f;font-weight:700">@Bean</span>(<span style="color:#c5060b;font-weight:700">initMethod</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">init</span>, <span style="color:#c5060b;font-weight:700">destroyMethod</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">close</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">DataSource</span> <span style="color:#0000a2;font-weight:700">dataSourceB</span>() {
        <span style="color:#00f;font-weight:700">try</span> {
            <span style="color:#00f;font-weight:700">AtomikosDataSourceBean</span> dataSource <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AtomikosDataSourceBean</span>();
            dataSource<span style="color:#00f;font-weight:700">.</span>setUniqueResourceName(<span style="color:#036a07">XADBMSB</span>);
            dataSource<span style="color:#00f;font-weight:700">.</span>setXaDataSourceClassName(
                    <span style="color:#036a07">com.mysql.cj.jdbc.MysqlXADataSource</span>);
            dataSource<span style="color:#00f;font-weight:700">.</span>setXaProperties(xaBProperties());
            dataSource<span style="color:#00f;font-weight:700">.</span>setPoolSize(<span style="color:#0000cd">1</span>);
            <span style="color:#00f;font-weight:700">return</span> dataSource;
        } <span style="color:#00f;font-weight:700">catch</span> (<span style="color:#00f;font-weight:700">Exception</span> e) {
            logger<span style="color:#00f;font-weight:700">.</span>error(<span style="color:#036a07">Populator DataSource bean cannot be created!</span>, e);
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#585cf6;font-weight:700">null</span>;
        }
    }

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Properties</span> <span style="color:#0000a2;font-weight:700">xaBProperties</span>() {
        <span style="color:#00f;font-weight:700">Properties</span> xaProp <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Properties</span>();
        xaProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">databaseName</span>, <span style="color:#036a07">musicdb_b</span>);
        xaProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">user</span>, <span style="color:#036a07">prospring5_b</span>);
        xaProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">password</span>, <span style="color:#036a07">prospring5_b</span>);
        <span style="color:#00f;font-weight:700">return</span> xaProp;
    }

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Properties</span> <span style="color:#0000a2;font-weight:700">hibernateProperties</span>() {
        <span style="color:#00f;font-weight:700">Properties</span> hibernateProp <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Properties</span>();
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.transaction.factory_class</span>,
                <span style="color:#036a07">org.hibernate.transaction.JTATransactionFactory</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.transaction.jta.platform</span>,
                <span style="color:#036a07">com.atomikos.icatch.jta.hibernate4.AtomikosPlatform</span>);
        <span style="color:#06f;font-style:italic">// required by Hibernate 5</span>
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.transaction.coordinator_class</span>, <span style="color:#036a07">jta</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.dialect</span>,
                <span style="color:#036a07">org.hibernate.dialect.MySQL5Dialect</span>);
        <span style="color:#06f;font-style:italic">// this will work only if users/schemas are created first,</span>
        <span style="color:#06f;font-style:italic">// use ddl.sql script for this</span>
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.hbm2ddl.auto</span>, <span style="color:#036a07">create-drop</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.show_sql</span>, <span style="color:#585cf6;font-weight:700">true</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.max_fetch_depth</span>, <span style="color:#0000cd">3</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.jdbc.batch_size</span>, <span style="color:#0000cd">10</span>);
        hibernateProp<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">hibernate.jdbc.fetch_size</span>, <span style="color:#0000cd">50</span>);
        <span style="color:#00f;font-weight:700">return</span> hibernateProp;
    }

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">EntityManagerFactory</span> <span style="color:#0000a2;font-weight:700">emfA</span>() {
        <span style="color:#00f;font-weight:700">LocalContainerEntityManagerFactoryBean</span> factoryBean <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">LocalContainerEntityManagerFactoryBean</span>();
        factoryBean<span style="color:#00f;font-weight:700">.</span>setPackagesToScan(<span style="color:#036a07">com.apress.prospring5.ch9.entities</span>);
        factoryBean<span style="color:#00f;font-weight:700">.</span>setDataSource(dataSourceA());
        factoryBean<span style="color:#00f;font-weight:700">.</span>setJpaVendorAdapter(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HibernateJpaVendorAdapter</span>());
        factoryBean<span style="color:#00f;font-weight:700">.</span>setJpaProperties(hibernateProperties());
        factoryBean<span style="color:#00f;font-weight:700">.</span>setPersistenceUnitName(<span style="color:#036a07">emfA</span>);
        factoryBean<span style="color:#00f;font-weight:700">.</span>afterPropertiesSet();
        <span style="color:#00f;font-weight:700">return</span> factoryBean<span style="color:#00f;font-weight:700">.</span>getObject();
    }

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">EntityManagerFactory</span> <span style="color:#0000a2;font-weight:700">emfB</span>() {
        <span style="color:#00f;font-weight:700">LocalContainerEntityManagerFactoryBean</span> factoryBean <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">LocalContainerEntityManagerFactoryBean</span>();
        factoryBean<span style="color:#00f;font-weight:700">.</span>setPackagesToScan(<span style="color:#036a07">com.apress.prospring5.ch9.entities</span>);
        factoryBean<span style="color:#00f;font-weight:700">.</span>setDataSource(dataSourceB());
        factoryBean<span style="color:#00f;font-weight:700">.</span>setJpaVendorAdapter(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">HibernateJpaVendorAdapter</span>());
        factoryBean<span style="color:#00f;font-weight:700">.</span>setJpaProperties(hibernateProperties());
        factoryBean<span style="color:#00f;font-weight:700">.</span>setPersistenceUnitName(<span style="color:#036a07">emfB</span>);
        factoryBean<span style="color:#00f;font-weight:700">.</span>afterPropertiesSet();
        <span style="color:#00f;font-weight:700">return</span> factoryBean<span style="color:#00f;font-weight:700">.</span>getObject();
    }
}
</pre>
                                        <div class="Para" id="Par110">The 
                                            <span id="ITerm48">configuration                      </span> is long but not too complex. First, two 
                                            <span class="EmphasisFontCategoryNonProportional">DataSource</span> beans are defined to indicate the two database resources. The bean names are 
                                            <span class="EmphasisFontCategoryNonProportional">dataSourceA</span> and 
                                            <span class="EmphasisFontCategoryNonProportional">dataSourceB</span>, which connect to the schemas 
                                            <span class="EmphasisFontCategoryNonProportional">musicdb_a</span> and 
                                            <span class="EmphasisFontCategoryNonProportional">musicdb_a</span>, respectively. Both 
                                            <span class="EmphasisFontCategoryNonProportional">DataSource</span> beans use the class 
                                            <span class="EmphasisFontCategoryNonProportional">com.atomikos.jdbc.AtomikosDataSourceBean</span>, which supports an XA-compliant 
                                            <span class="EmphasisFontCategoryNonProportional">DataSource</span>, and within the two beans’ definitions, MySQL’s XA 
                                            <span class="EmphasisFontCategoryNonProportional">DataSource</span> implementation class is defined: 
                                            <span class="EmphasisFontCategoryNonProportional">com.mysql.cj.jdbc.MysqlXADataSource</span>, which is the resource manager for MySQL. Then, the database connection information is provided. Note that the 
                                            <span class="EmphasisFontCategoryNonProportional">poolSize</span> attribute defines the number of connections within the connection pool that Atomikos needs to maintain. It’s not mandatory. However, if the attribute is not provided, Atomikos will use the default value 1.
                                        </div>
                                        <div class="Para" id="Par111">Then, two 
                                            <span id="ITerm49"> <span class="EmphasisFontCategoryNonProportional">EntityManagerFactory</span> </span> beans are defined, named 
                                            <span class="EmphasisFontCategoryNonProportional">emfA</span> and 
                                            <span class="EmphasisFontCategoryNonProportional">emfB</span>. The common JPA properties are wrapped together in the 
                                            <span class="EmphasisFontCategoryNonProportional">hibernateProperties</span> bean. The only difference between the two beans is that they were injected with the corresponding data source (that is, 
                                            <span class="EmphasisFontCategoryNonProportional">dataSourceA</span> injected into 
                                            <span class="EmphasisFontCategoryNonProportional">emfA</span>, and 
                                            <span class="EmphasisFontCategoryNonProportional">dataSourceB</span> injected into 
                                            <span class="EmphasisFontCategoryNonProportional">emfB</span>). Consequently, 
                                            <span class="EmphasisFontCategoryNonProportional">emfA</span> will connect to MySQL’s 
                                            <span class="EmphasisFontCategoryNonProportional">prospring5_a</span> schema via the 
                                            <span class="EmphasisFontCategoryNonProportional">dataSourceA</span> bean, while 
                                            <span class="EmphasisFontCategoryNonProportional">emfB</span> will connect to the 
                                            <span class="EmphasisFontCategoryNonProportional">prospring5_b</span> schema via the 
                                            <span class="EmphasisFontCategoryNonProportional">dataSourceB</span> bean. Take a look at the properties 
                                            <span class="EmphasisFontCategoryNonProportional">hibernate.transaction.factory_class</span> and 
                                            <span class="EmphasisFontCategoryNonProportional">hibernate.transaction.jta.platform</span> in the 
                                            <span class="EmphasisFontCategoryNonProportional">emfBase</span> bean. These two properties are very important because they are used by Hibernate to look up the underlying 
                                            <span class="EmphasisFontCategoryNonProportional">UserTransaction</span> and 
                                            <span class="EmphasisFontCategoryNonProportional">TransactionManager</span> beans to participate in the persistence context that it’s managing into the global transaction. Also important is the 
                                            <span class="EmphasisFontCategoryNonProportional">hibernate.transaction.coordinator_class</span> that is needed to make the Atomikos classes for Hibernate 4 work with Hibernate 5.
                                            <a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html#Fn4" id="Fn4_source"><sup>4</sup></a> 
                                        </div>
                                        <div class="Para" id="Par113">The following codes snippet depicts 
                                            <span class="EmphasisFontCategoryNonProportional">ServicesConfig</span>, which 
                                            <span id="ITerm50">declares                      </span> beans used for implementing the global transactions management:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.config</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.atomikos.icatch.config.UserTransactionService</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.atomikos.icatch.config.UserTransactionServiceImp</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.atomikos.icatch.jta.UserTransactionImp</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.atomikos.icatch.jta.UserTransactionManager</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.Logger</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.LoggerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Bean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.ComponentScan</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Configuration</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.DependsOn</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.PlatformTransactionManager</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.annotation.EnableTransactionManagement</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.jta.JtaTransactionManager</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.transaction.SystemException</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.transaction.UserTransaction</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Properties</span>;

@<span style="color:#00f;font-weight:700">Configuration</span>
@<span style="color:#00f;font-weight:700">EnableTransactionManagement</span>
@ComponentScan(basePackages <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">com.apress.prospring5.ch9.services</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">ServicesConfig</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">ServicesConfig</span><span style="color:#00f;font-weight:700">.</span>class);

    <span style="color:#00f;font-weight:700">@Bean</span>(<span style="color:#c5060b;font-weight:700">initMethod</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">init</span>, <span style="color:#c5060b;font-weight:700">destroyMethod</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">shutdownForce</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">UserTransactionService</span> <span style="color:#0000a2;font-weight:700">userTransactionService</span>() {
        <span style="color:#00f;font-weight:700">Properties</span> atProps <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Properties</span>();
        atProps<span style="color:#00f;font-weight:700">.</span>put(<span style="color:#036a07">com.atomikos.icatch.service</span>,
                <span style="color:#036a07">com.atomikos.icatch.standalone.UserTransactionServiceFactory</span>);
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">UserTransactionServiceImp</span>(atProps);
    }

    <span style="color:#00f;font-weight:700">@Bean</span>(<span style="color:#c5060b;font-weight:700">initMethod</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">init</span>, <span style="color:#c5060b;font-weight:700">destroyMethod</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">close</span>)
    <span style="color:#00f;font-weight:700">@DependsOn</span>(<span style="color:#036a07">userTransactionService</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">UserTransactionManager</span> <span style="color:#0000a2;font-weight:700">atomikosTransactionManager</span>() {
        <span style="color:#00f;font-weight:700">UserTransactionManager</span> utm <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">UserTransactionManager</span>();
        utm<span style="color:#00f;font-weight:700">.</span>setStartupTransactionService(<span style="color:#585cf6;font-weight:700">false</span>);
        utm<span style="color:#00f;font-weight:700">.</span>setForceShutdown(<span style="color:#585cf6;font-weight:700">true</span>);
        <span style="color:#00f;font-weight:700">return</span> utm;
    }

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">@DependsOn</span>(<span style="color:#036a07">userTransactionService</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">UserTransaction</span> <span style="color:#0000a2;font-weight:700">userTransaction</span>() {
        <span style="color:#00f;font-weight:700">UserTransactionImp</span> ut <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">UserTransactionImp</span>();
        <span style="color:#00f;font-weight:700">try</span> {
            ut<span style="color:#00f;font-weight:700">.</span>setTransactionTimeout(<span style="color:#0000cd">300</span>);
        } <span style="color:#00f;font-weight:700">catch</span> (<span style="color:#00f;font-weight:700">SystemException</span> se) {
            logger<span style="color:#00f;font-weight:700">.</span>error(<span style="color:#036a07">Configuration  exception.</span>, se);
            <span style="color:#00f;font-weight:700">return</span> <span style="color:#585cf6;font-weight:700">null</span>;
        }
        <span style="color:#00f;font-weight:700">return</span> ut;
    }

    <span style="color:#00f;font-weight:700">@Bean</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">PlatformTransactionManager</span> <span style="color:#0000a2;font-weight:700">transactionManager</span>() {
        <span style="color:#00f;font-weight:700">JtaTransactionManager</span> ptm <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">JtaTransactionManager</span>();
        ptm<span style="color:#00f;font-weight:700">.</span>setTransactionManager(atomikosTransactionManager());
        ptm<span style="color:#00f;font-weight:700">.</span>setUserTransaction(userTransaction());
        <span style="color:#00f;font-weight:700">return</span> ptm;
    }
}
</pre>
                                        <div class="Para" id="Par115">For the 
                                            <span id="ITerm51">Atomikos                      </span> part, two beans, the 
                                            <span class="EmphasisFontCategoryNonProportional">atomikosTransactionManager</span> and 
                                            <span class="EmphasisFontCategoryNonProportional">atomikosUserTransaction</span> beans, are defined. The implementation classes are provided by Atomikos, which implements the standard Spring 
                                            <span class="EmphasisFontCategoryNonProportional">org.springframework.transaction.PlatformTransactionManager</span> and 
                                            <span class="EmphasisFontCategoryNonProportional">javax.transaction.UserTransaction</span> interfaces, respectively. Those beans provide the transaction coordination and synchronization services required by JTA and communicate with the resource managers over the XA protocol in supporting 2PC. Then, Spring’s 
                                            <span class="EmphasisFontCategoryNonProportional">transactionManager</span> bean (with 
                                            <span class="EmphasisFontCategoryNonProportional">org.springframework.transaction.jta.JtaTransactionManager</span> as the implementation class) is defined, injecting the two transaction beans provided by Atomikos. This instructs Spring to use Atomikos JTA for transaction management. Also, notice the 
                                            <span id="ITerm52"> <span class="EmphasisFontCategoryNonProportional">UserTransactionService</span> </span> bean that is used to configure the Atomikos transaction service to administer pending transactions.
                                            <a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html#Fn5" id="Fn5_source"><sup>5</sup></a> 
                                        </div>
                                        <div class="Para" id="Par117">The following code snippet shows the 
                                            <span class="EmphasisFontCategoryNonProportional">SingerServiceImpl</span> class for JTA. Note that for simplicity, only the 
                                            <span id="ITerm53"> <span class="EmphasisFontCategoryNonProportional">save()</span> method                      </span> is implemented.
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.services</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.entities.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.apache.commons.lang3.NotImplementedException</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.orm.jpa.JpaSystemException</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Repository</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Service</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.annotation.Transactional</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.EntityManager</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.PersistenceContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.PersistenceException</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.List</span>;

@Service(<span style="color:#036a07">singerService</span>)
@<span style="color:#00f;font-weight:700">Repository</span>
@<span style="color:#00f;font-weight:700">Transactional</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerServiceImpl</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerService</span> {
    <span style="color:#00f;font-weight:700">@PersistenceContext</span>(<span style="color:#c5060b;font-weight:700">unitName</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">emfA</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">EntityManager</span> emA;
    <span style="color:#00f;font-weight:700">@PersistenceContext</span>(<span style="color:#c5060b;font-weight:700">unitName</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">emfB</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">EntityManager</span> emB;

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">@Transactional</span>(<span style="color:#c5060b;font-weight:700">readOnly</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAll</span>() {
        <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">NotImplementedException</span>(<span style="color:#036a07">findAll</span>);
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">@Transactional</span>(<span style="color:#c5060b;font-weight:700">readOnly</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">findById</span>(<span style="color:#00f;font-weight:700">Long</span> <span style="font-style:italic">id</span>) {
        <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">NotImplementedException</span>(<span style="color:#036a07">findById</span>);
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">save</span>(<span style="color:#00f;font-weight:700">Singer</span> <span style="font-style:italic">singer</span>) {
        <span style="color:#00f;font-weight:700">Singer</span> singerB <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Singer</span>();
        singerB<span style="color:#00f;font-weight:700">.</span>setFirstName(singer<span style="color:#00f;font-weight:700">.</span>getFirstName());
        singerB<span style="color:#00f;font-weight:700">.</span>setLastName(singer<span style="color:#00f;font-weight:700">.</span>getLastName());
        <span style="color:#00f;font-weight:700">if</span> (singer<span style="color:#00f;font-weight:700">.</span>getId() <span style="color:#00f;font-weight:700">==</span> <span style="color:#585cf6;font-weight:700">null</span>) {
            emA<span style="color:#00f;font-weight:700">.</span>persist(singer);
            emB<span style="color:#00f;font-weight:700">.</span>persist(singerB);
            <span style="color:#06f;font-style:italic">//throw new JpaSystemException(new PersistenceException());</span>
        } <span style="color:#00f;font-weight:700">else</span> {
            emA<span style="color:#00f;font-weight:700">.</span>merge(singer);
            emB<span style="color:#00f;font-weight:700">.</span>merge(singer);
        }
        <span style="color:#00f;font-weight:700">return</span> singer;
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">long</span> <span style="color:#0000a2;font-weight:700">countAll</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#0000cd">0</span>;
    }
}
</pre>
                                        <div class="Para" id="Par119">The two entity managers defined are injected into the 
                                            <span class="EmphasisFontCategoryNonProportional">SingerServiceImpl</span> class. In the 
                                            <span class="EmphasisFontCategoryNonProportional">save()</span> method, we persist the 
                                            <span id="ITerm54">contact                      </span> object to the two schemas, respectively. Ignore the throw exception statement at the moment; we will use it later to verify that the transaction was rolled back when saving to the schema 
                                            <span class="EmphasisFontCategoryNonProportional">prospring5_b</span> fails. The following code snippet shows the testing program:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.config.ServicesConfig</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.config.XAJpaConfig</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.entities.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.services.SingerService</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.Logger</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.LoggerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.AnnotationConfigApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.support.GenericApplicationContext</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Date</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.GregorianCalendar</span>;

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">TxJtaDemo</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">TxJtaDemo</span><span style="color:#00f;font-weight:700">.</span>class);

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">ServicesConfig</span><span style="color:#00f;font-weight:700">.</span>class,
                        <span style="color:#00f;font-weight:700">XAJpaConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">SingerService</span> singerService <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">SingerService</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Singer</span>();
        singer<span style="color:#00f;font-weight:700">.</span>setFirstName(<span style="color:#036a07">John</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setLastName(<span style="color:#036a07">Mayer</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setBirthDate(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Date</span>(
                (<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GregorianCalendar</span>(<span style="color:#0000cd">1977</span>, <span style="color:#0000cd">9</span>, <span style="color:#0000cd">16</span>))<span style="color:#00f;font-weight:700">.</span>getTime()<span style="color:#00f;font-weight:700">.</span>getTime()));
        singerService<span style="color:#00f;font-weight:700">.</span>save(singer);
        <span style="color:#00f;font-weight:700">if</span> (singer<span style="color:#00f;font-weight:700">.</span>getId() <span style="color:#00f;font-weight:700">!=</span> <span style="color:#585cf6;font-weight:700">null</span>) {
            logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">--&gt; Singer saved successfully</span>);
        } <span style="color:#00f;font-weight:700">else</span> {
            logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">--&gt; Singer was  not saved, check the configuration!!</span>);
        }
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                                        <div class="Para ParaOneEmphasisChild" id="Par121">The program creates a new contact object and calls the 
                                            <span class="EmphasisFontCategoryNonProportional">SingerService.save()</span> method. The implementation will try to persist the same object to two databases. Providing all went well, running the program produces the following output (the other output was omitted):
                                        </div>
                                        <div class="Para" id="Par122"> 
                                            <div class="ProgramCode" id="PC30">
                                                <div class="FixedLine">--&gt; Singer saved successfully</div>
                                            </div>                                             
                                        </div>
                                        <div class="Para" id="Par123">Atomikos creates a composite transaction, communicates with the XA 
                                            <span class="EmphasisFontCategoryNonProportional">DataSource</span> (MySQL, in this case), performs synchronization, commits the transaction, and so on. From the database, you will see that the new contact is persisted to both schemas of the database, respectively. But if you want to check the saving in the code, you can provide an implementation to the 
                                            <span id="ITerm55"> <span class="EmphasisFontCategoryNonProportional">findAll()</span> </span> method that does that for you.
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.services</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.ArrayList</span>;<span style="color:#00f;font-weight:700">.</span><span style="color:#00f;font-weight:700">.</span>.

@Service(<span style="color:#036a07">singerService</span>)
@<span style="color:#00f;font-weight:700">Repository</span>
@<span style="color:#00f;font-weight:700">Transactional</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerServiceImpl</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerService</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#c5060b;font-weight:700">FIND_ALL</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">select s from Singer s</span>;
    <span style="color:#00f;font-weight:700">@PersistenceContext</span>(<span style="color:#c5060b;font-weight:700">unitName</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">emfA</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">EntityManager</span> emA;
    <span style="color:#00f;font-weight:700">@PersistenceContext</span>(<span style="color:#c5060b;font-weight:700">unitName</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">emfB</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">EntityManager</span> emB;

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">@Transactional</span>(<span style="color:#c5060b;font-weight:700">readOnly</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#585cf6;font-weight:700">true</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAll</span>() {
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> singersFromA <span style="color:#00f;font-weight:700">=</span> findAllInA();
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> singersFromB <span style="color:#00f;font-weight:700">=</span> findAllInB();
        <span style="color:#00f;font-weight:700">if</span> (singersFromA<span style="color:#00f;font-weight:700">.</span>size() <span style="color:#00f;font-weight:700">!=</span> singersFromB<span style="color:#00f;font-weight:700">.</span>size()) {
            <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AsyncXAResourcesException</span>(<span style="color:#036a07">
                    XA resources do not contain the same expected data.</span>);
        }
        <span style="color:#00f;font-weight:700">Singer</span> sA <span style="color:#00f;font-weight:700">=</span> singersFromA<span style="color:#00f;font-weight:700">.</span>get(<span style="color:#0000cd">0</span>);
        <span style="color:#00f;font-weight:700">Singer</span> sB <span style="color:#00f;font-weight:700">=</span> singersFromB<span style="color:#00f;font-weight:700">.</span>get(<span style="color:#0000cd">0</span>);
        <span style="color:#00f;font-weight:700">if</span> (<span style="color:#00f;font-weight:700">!</span>sA<span style="color:#00f;font-weight:700">.</span>getFirstName()<span style="color:#00f;font-weight:700">.</span>equals(sB<span style="color:#00f;font-weight:700">.</span>getFirstName())) {
            <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AsyncXAResourcesException</span>(<span style="color:#036a07">
                    XA resources do not contain the same expected data.</span>);
        }
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> singersFromBoth <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">ArrayList&lt;&gt;</span>();
        singersFromBoth<span style="color:#00f;font-weight:700">.</span>add(sA);
        singersFromBoth<span style="color:#00f;font-weight:700">.</span>add(sB);
        <span style="color:#00f;font-weight:700">return</span> singersFromBoth;
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAllInA</span>() {
        <span style="color:#00f;font-weight:700">return</span> emA<span style="color:#00f;font-weight:700">.</span>createQuery(<span style="color:#c5060b;font-weight:700">FIND_ALL</span>)<span style="color:#00f;font-weight:700">.</span>getResultList();
    }

    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> <span style="color:#0000a2;font-weight:700">findAllInB</span>() {
        <span style="color:#00f;font-weight:700">return</span> emB<span style="color:#00f;font-weight:700">.</span>createQuery(<span style="color:#c5060b;font-weight:700">FIND_ALL</span>)<span style="color:#00f;font-weight:700">.</span>getResultList();
    }
    .<span style="color:#00f;font-weight:700">.</span>.
}
</pre>
                                        <div class="Para" id="Par125">So, the code to 
                                            <span id="ITerm56">test                      </span> the singer being saved in both databases can be modified like this:
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.GregorianCalendar</span>;<span style="color:#00f;font-weight:700">.</span><span style="color:#00f;font-weight:700">.</span>.

<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">TxJtaDemo</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">TxJtaDemo</span><span style="color:#00f;font-weight:700">.</span>class);

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) {
        <span style="color:#00f;font-weight:700">GenericApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AnnotationConfigApplicationContext</span>(<span style="color:#00f;font-weight:700">ServicesConfig</span><span style="color:#00f;font-weight:700">.</span>class,
                        <span style="color:#00f;font-weight:700">XAJpaConfig</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">SingerService</span> singerService <span style="color:#00f;font-weight:700">=</span> ctx<span style="color:#00f;font-weight:700">.</span>getBean(<span style="color:#00f;font-weight:700">SingerService</span><span style="color:#00f;font-weight:700">.</span>class);
        <span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Singer</span>();
        singer<span style="color:#00f;font-weight:700">.</span>setFirstName(<span style="color:#036a07">John</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setLastName(<span style="color:#036a07">Mayer</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setBirthDate(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Date</span>(
                (<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GregorianCalendar</span>(<span style="color:#0000cd">1977</span>, <span style="color:#0000cd">9</span>, <span style="color:#0000cd">16</span>))<span style="color:#00f;font-weight:700">.</span>getTime()<span style="color:#00f;font-weight:700">.</span>getTime()));
        singerService<span style="color:#00f;font-weight:700">.</span>save(singer);
        <span style="color:#00f;font-weight:700">if</span> (singer<span style="color:#00f;font-weight:700">.</span>getId() <span style="color:#00f;font-weight:700">!=</span> <span style="color:#585cf6;font-weight:700">null</span>) {
            logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">--&gt; Singer saved successfully</span>);
        } <span style="color:#00f;font-weight:700">else</span> {
            logger<span style="color:#00f;font-weight:700">.</span>error(<span style="color:#036a07">--&gt; Singer was not saved, check the configuration!!</span>);
        }
        <span style="color:#06f;font-style:italic">// check saving in  both databases</span>
        <span style="color:#00f;font-weight:700">List&lt;<span style="color:#00f;font-weight:700">Singer</span>&gt;</span> singers <span style="color:#00f;font-weight:700">=</span> singerService<span style="color:#00f;font-weight:700">.</span>findAll();
        <span style="color:#00f;font-weight:700">if</span> (singers<span style="color:#00f;font-weight:700">.</span>size() <span style="color:#00f;font-weight:700">!=</span> <span style="color:#0000cd">2</span>) {
            logger<span style="color:#00f;font-weight:700">.</span>error(<span style="color:#036a07">--&gt; Something went wrong.</span>);
        } <span style="color:#00f;font-weight:700">else</span> {
            logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">--&gt; Singers form both DBs: </span> <span style="color:#00f;font-weight:700">+</span> singers);
        }
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }
}
</pre>
                                        <div class="Para" id="Par127">Now let’s see how the 
                                            <span id="ITerm57">rollback                      </span> works. As shown in the next code snippet, instead of calling 
                                            <span class="EmphasisFontCategoryNonProportional">emB.persist()</span>, we just throw an exception to simulate that something went wrong and the data could not be saved in the second database.
                                        </div>
                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.services</span>;
.<span style="color:#00f;font-weight:700">.</span>.

@Service(<span style="color:#036a07">singerService</span>)
@<span style="color:#00f;font-weight:700">Repository</span>
@<span style="color:#00f;font-weight:700">Transactional</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerServiceImpl</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerService</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">final</span> <span style="color:#00f;font-weight:700">String</span> <span style="color:#c5060b;font-weight:700">FIND_ALL</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">select s from Singer s</span>;
    <span style="color:#00f;font-weight:700">@PersistenceContext</span>(<span style="color:#c5060b;font-weight:700">unitName</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">emfA</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">EntityManager</span> emA;
    <span style="color:#00f;font-weight:700">@PersistenceContext</span>(<span style="color:#c5060b;font-weight:700">unitName</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">emfB</span>)
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">EntityManager</span> emB;
    .<span style="color:#00f;font-weight:700">.</span>.

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">save</span>(<span style="color:#00f;font-weight:700">Singer</span> <span style="font-style:italic">singer</span>) {
        <span style="color:#00f;font-weight:700">Singer</span> singerB <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Singer</span>();
        singerB<span style="color:#00f;font-weight:700">.</span>setFirstName(singer<span style="color:#00f;font-weight:700">.</span>getFirstName());
        singerB<span style="color:#00f;font-weight:700">.</span>setLastName(singer<span style="color:#00f;font-weight:700">.</span>getLastName());
        <span style="color:#00f;font-weight:700">if</span> (singer<span style="color:#00f;font-weight:700">.</span>getId() <span style="color:#00f;font-weight:700">==</span> <span style="color:#585cf6;font-weight:700">null</span>) {
            emA<span style="color:#00f;font-weight:700">.</span>persist(singer);
            <span style="color:#00f;font-weight:700">if</span> (<span style="color:#585cf6;font-weight:700">true</span>) {
                <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">JpaSystemException</span>(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">PersistenceException</span>(
                        <span style="color:#036a07">Simulation of something going wrong.</span>));
            }
            emB<span style="color:#00f;font-weight:700">.</span>persist(singerB);
        } <span style="color:#00f;font-weight:700">else</span> {
            emA<span style="color:#00f;font-weight:700">.</span>merge(singer);
            emB<span style="color:#00f;font-weight:700">.</span>merge(singer);
        }
        <span style="color:#00f;font-weight:700">return</span> singer;
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">long</span> <span style="color:#0000a2;font-weight:700">countAll</span>() {
        <span style="color:#00f;font-weight:700">return</span> <span style="color:#0000cd">0</span>;
    }
}
</pre>
                                        <div class="Para" id="Par129">Running the program again produces the following results:</div>
                                        <pre style="background:#fff;color:#000">...
INFO  o.h.h.i.QueryTranslatorFactoryInitiator - HHH000397:
   Using ASTQueryTranslatorFactory
INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA
   EntityManagerFactory for persistence unit &apos;emfA&apos;
INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA
   EntityManagerFactory for persistence unit &apos;emfB&apos;
INFO  o.s.t.j.JtaTransactionManager - Using JTA UserTransaction:
   com.atomikos.icatch.jta.UserTransactionImp@6da9dc6
INFO  o.s.t.j.JtaTransactionManager - Using JTA TransactionManager:
   com.atomikos.icatch.jta.UserTransactionManager@2216effc
DEBUG o.s.t.j.JtaTransactionManager - Creating new transaction with name
[com.apress.prospring5.ch9.services.SingerServiceImpl.save]:
   PROPAGATION_REQUIRED,ISOLATION_DEFAULT; &apos;&apos;
DEBUG  o.s.o.j.EntityManagerFactoryUtils - Opening JPA EntityManager
DEBUG  o.s.o.j.EntityManagerFactoryUtils - Registering transaction synchronization
   for JPA EntityManager
Hibernate: insert  into singer (BIRTH_DATE, FIRST_NAME, LAST_NAME, VERSION)
values (?, ?, ?, ?)
DEBUG  o.s.o.j.EntityManagerFactoryUtils - Closing JPA EntityManager
DEBUG  o.s.t.j.JtaTransactionManager - Initiating transaction rollback
WARN   c.a.j.AbstractConnectionProxy - Forcing close of pending statement:
   com.mysql.cj.jdbc.PreparedStatementWrapper@3f685162
Exception in  thread &quot;main&quot; org.springframework.orm.jpa.JpaSystemException:
   Simulation of something going wrong.;
...
Caused by: javax.persistence.PersistenceException:
   Simulation of something going wrong.
</pre>
                                        <div class="Para" id="Par131">As shown in the previous output, the first singer is persisted (note the 
                                            <span class="EmphasisFontCategoryNonProportional">insert</span> statement). However, when saving to the second 
                                            <span class="EmphasisFontCategoryNonProportional">DataSource</span>, because an exception is thrown, Atomikos will roll 
                                            <span id="ITerm58">back                      </span> the entire transaction. You can take a look at the schema 
                                            <span class="EmphasisFontCategoryNonProportional">musicdb_a</span> to check that the new singer was not saved.
                                        </div>
                                    </div>
                                    <div class="Section2 RenderAsSection2" id="Sec16">
                                        <h3 class="Heading">Spring Boot JTA</h3>
                                        <div class="Para" id="Par132">The Spring Boot for JTA starter comes out of the box with a set of preconfigured beans designed to help you focus on the business 
                                            <span id="ITerm59">functionality                      </span> of the code and not on the environment setup. Then again, this is what all Spring Boot starter libraries do, no matter the component, so the previous sentence might seem a little redundant. Spring Boot for JTA contains a library for using Atomikos, which pulls the appropriate libraries and configures Atomikos components for you. Migrating the previous example to Spring Boot would mean basically importing the 
                                            <span class="EmphasisFontCategoryNonProportional">DataSource</span> and transaction manager configurations into the Spring Boot application. But as the purpose of this section is to show how Spring Boot can help speed up development for applications involving global transaction management by the provided preconfigured beans, a different example is necessary. We’ll assume we want to transmit a message to a messaging queue signaling the creation of a new 
                                            <span class="EmphasisFontCategoryNonProportional">Singer</span> instance. Obviously, if saving the 
                                            <span class="EmphasisFontCategoryNonProportional">Singer</span> record to the database fails, we want to roll back the transaction and prevent the message from being sent. To wrap up this example, we need to do the following:
                                            <div class="UnorderedList">
                                                <ul class="UnorderedListMarkBullet">
                                                    <li>
                                                        <div class="Para" id="Par133">Configure the Spring Boot Gradle project for JTA and JMS usage. The configuration is as follows:</div>
                                                        <pre style="background:#fff;color:#000"><span style="color:#06f;font-style:italic">//build.gradle</span>
ext {
   .<span style="color:#00f;font-weight:700">.</span>.
   bootVersion <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">2.0.0.M1</span>
   atomikosVersion <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">4.0.4</span>
   boot <span style="color:#00f;font-weight:700">=</span> [
         .<span style="color:#00f;font-weight:700">.</span>.
    starterJpa <span style="color:#00f;font-weight:700">:</span>
      <span style="color:#036a07">org.springframework.boot:spring-boot-starter-data-jpa:$bootVersion</span>,
    starterJta <span style="color:#00f;font-weight:700">:</span>
      <span style="color:#036a07">org.springframework.boot:spring-boot-starter-jta-atomikos:$bootVersion</span>,
    starterJms <span style="color:#00f;font-weight:700">:</span>
      <span style="color:#036a07">org.springframework.boot:spring-boot-starter-artemis:$bootVersion</span>
   ]
   misc <span style="color:#00f;font-weight:700">=</span> [
         .<span style="color:#00f;font-weight:700">.</span>.
         artemis      <span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">org.apache.activemq:artemis-jms-server:2.1.0</span>
   ]
   db <span style="color:#00f;font-weight:700">=</span> [
         .<span style="color:#00f;font-weight:700">.</span>.
         h2   <span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">com.h2database:h2:$h2Version</span>
   ]
}
<span style="color:#06f;font-style:italic">//chapter09/boot-jta/build.gradle</span>
buildscript {
   repositories {
      .<span style="color:#00f;font-weight:700">.</span>.
   }
   dependencies {
      classpath boot<span style="color:#00f;font-weight:700">.</span>springBootPlugin
   }
}
apply plugin<span style="color:#00f;font-weight:700">:</span>  <span style="color:#036a07">org.springframework.boot</span>
dependencies {
   compile boot<span style="color:#00f;font-weight:700">.</span>starterJpa, boot<span style="color:#00f;font-weight:700">.</span>starterJta, boot<span style="color:#00f;font-weight:700">.</span>starterJms, db<span style="color:#00f;font-weight:700">.</span>h2
   compilemisc<span style="color:#00f;font-weight:700">.</span>artemis {
      exclude group<span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">org.apache.geronimo.specs</span>,
          module<span style="color:#00f;font-weight:700">:</span> <span style="color:#036a07">geronimo-jms_2.0_spec</span>
   }
}
</pre>
                                                        <div class="Para" id="Par135">In Figure 
                                                            <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html#Fig3">9-3</a></span> you can see the 
                                                            <span id="ITerm60">Spring Boot                                  </span> starter libraries declared earlier as dependencies for the project, and you can see the dependencies they add to the project.
                                                            <div class="Figure" id="Fig3">
                                                                <div class="MediaObject" id="MO3">
                                                                    <img alt="A315511_5_En_9_Fig3_HTML.jpg" data-mfp-src="/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Fig3_HTML.jpg" height="331" src="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Fig3_HTML.jpg" width="480"/>
                                                                </div>
                                                                <div class="Caption" xml:lang="en">
                                                                    <div class="CaptionContent">
                                                                        <span class="CaptionNumber">Figure 9-3.</span>
                                                                        <div class="SimplePara">Spring Boot Starter libraries and their dependencies</div>
                                                                    </div>
                                                                </div>
                                                            </div>                                                             
                                                        </div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par136">Define the 
                                                            <span class="EmphasisFontCategoryNonProportional">Singer</span> entity class and the repository handling it. The 
                                                            <span class="EmphasisFontCategoryNonProportional">Singer</span> entity class has the same structure as mentioned earlier in the section, but without any related entities. And the 
                                                            <span class="EmphasisFontCategoryNonProportional">SingerRepository</span> will be left empty as only methods already provided by 
                                                            <span class="EmphasisFontCategoryNonProportional">CrudRepository</span> will be used in this example: 
                                                            <span class="EmphasisFontCategoryNonProportional">save(..)</span> and 
                                                            <span class="EmphasisFontCategoryNonProportional">count()</span>.
                                                        </div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par137">Define a service class that will save the 
                                                            <span class="EmphasisFontCategoryNonProportional">Singer</span> 
                                                            <span id="ITerm61">record                                  </span> and send the confirmation message.
                                                        </div>
                                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.services</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.entities.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.ex.AsyncXAResourcesException</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.repos.SingerRepository</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Autowired</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.jms.core.JmsTemplate</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Repository</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Service</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.transaction.annotation.Transactional</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.EntityManager</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.PersistenceContext</span>;

@Service(<span style="color:#036a07">singerService</span>)
@<span style="color:#00f;font-weight:700">Transactional</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">SingerServiceImpl</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">SingerService</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">SingerRepository</span> singerRepository;
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">JmsTemplate</span> jmsTemplate;

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#0000a2;font-weight:700">SingerServiceImpl</span>(<span style="color:#00f;font-weight:700">SingerRepository</span> <span style="font-style:italic">singerRepository</span>,
                             <span style="color:#00f;font-weight:700">JmsTemplate</span> <span style="font-style:italic">jmsTemplate</span>) {
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>singerRepository <span style="color:#00f;font-weight:700">=</span> singerRepository;
        <span style="color:#318495">this</span><span style="color:#00f;font-weight:700">.</span>jmsTemplate <span style="color:#00f;font-weight:700">=</span> jmsTemplate;
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">Singer</span> <span style="color:#0000a2;font-weight:700">save</span>(<span style="color:#00f;font-weight:700">Singer</span> <span style="font-style:italic">singer</span>) {
        jmsTemplate<span style="color:#00f;font-weight:700">.</span>convertAndSend(<span style="color:#036a07">singers</span>, <span style="color:#036a07">Just saved:</span> <span style="color:#00f;font-weight:700">+</span> singer);
        <span style="color:#00f;font-weight:700">if</span> (singer <span style="color:#00f;font-weight:700">==</span> <span style="color:#585cf6;font-weight:700">null</span>) {
            <span style="color:#00f;font-weight:700">throw</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">AsyncXAResourcesException</span>(
                    <span style="color:#036a07">Simulation of something going wrong.</span>);
        }
        singerRepository<span style="color:#00f;font-weight:700">.</span>save(singer);
        <span style="color:#00f;font-weight:700">return</span> singer;
    }

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">long</span> <span style="color:#0000a2;font-weight:700">count</span>() {
        <span style="color:#00f;font-weight:700">return</span> singerRepository<span style="color:#00f;font-weight:700">.</span>count();
    }
}
</pre>
                                                        <div class="Para" id="Par139">No 
                                                            <span class="EmphasisFontCategoryNonProportional">@Autowired</span> annotation is needed to inject the repository bean, nor for the 
                                                            <span class="EmphasisFontCategoryNonProportional">JmsTemplate</span>. Spring Boot is magic like that and injects the required 
                                                            <span id="ITerm62">beans                                  </span>, if they are the only ones declared.
                                                        </div>
                                                    </li>
                                                    <li>
                                                        <div class="Para ParaOneEmphasisChild" id="Par140">A bean that will listen for messages being delivered to the 
                                                            <span class="EmphasisFontCategoryNonProportional">singers</span> queue and print them.
                                                        </div>
                                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.Logger</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.LoggerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.jms.annotation.JmsListener</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.stereotype.Component</span>;

@<span style="color:#00f;font-weight:700">Component</span>
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Messages</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">Messages</span><span style="color:#00f;font-weight:700">.</span>class);

    <span style="color:#00f;font-weight:700">@JmsListener</span>(<span style="color:#c5060b;font-weight:700">destination</span> <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">singers</span>)
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">onMessage</span>(<span style="color:#00f;font-weight:700">String</span> <span style="font-style:italic">content</span>) {
        logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">--&gt; Received content: </span> <span style="color:#00f;font-weight:700">+</span> content);
    }
}
</pre>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par142">Configure the Artemis 
                                                            <span id="ITerm63">JMS                                  </span> server to create an embedded queue named 
                                                            <span class="EmphasisFontCategoryNonProportional">singers</span>. This is done by setting the 
                                                            <span class="EmphasisFontCategoryNonProportional">spring.artemis.embedded.queues</span> property with the value 
                                                            <span class="EmphasisFontCategoryNonProportional">singers</span> in the 
                                                            <span class="EmphasisFontCategoryNonProportional">application.properties</span> file, which is the file that can be used to configure a Spring Boot application.
                                                        </div>
                                                        <pre style="background:#fff;color:#000">spring.artemis.embedded.queues=singers
spring.jta.log-dir=out
</pre>
                                                        <div class="Para" id="Par144">The previous configuration snippet depicts the content of the 
                                                            <span class="EmphasisFontCategoryNonProportional">application.properties</span> file. Besides the 
                                                            <span class="EmphasisFontCategoryNonProportional">spring.artemis.embedded.queues</span> property, 
                                                            <span class="EmphasisFontCategoryNonProportional">spring.jta.log-dir</span> is used to set where the JTA log should be written by Atomikos, and in this case the 
                                                            <span class="EmphasisFontCategoryNonProportional">out</span> directory was set.
                                                        </div>
                                                    </li>
                                                    <li>
                                                        <div class="Para" id="Par145">Here is the 
                                                            <span id="ITerm64">application                                  </span> class to wrap it all together and test it:
                                                        </div>
                                                        <pre style="background:#fff;color:#000"><span style="color:#00f;font-weight:700">package</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.entities.Singer</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.apress.prospring5.ch9.services.SingerService</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">com.atomikos.jdbc.AtomikosDataSourceBean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.h2.jdbcx.JdbcDataSource</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.Logger</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.slf4j.LoggerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.beans.factory.annotation.Autowired</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.boot.CommandLineRunner</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.boot.SpringApplication</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.boot.autoconfigure.SpringBootApplication</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.ConfigurableApplicationContext</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.context.annotation.Bean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter</span>;

<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.persistence.EntityManagerFactory</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">javax.sql.DataSource</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Date</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.GregorianCalendar</span>;
<span style="color:#00f;font-weight:700">import</span> <span style="color:#00f;font-weight:700">java.util.Properties</span>;

<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">org.hibernate.cfg.AvailableSettings.*</span>;
<span style="color:#00f;font-weight:700">import static</span> <span style="color:#00f;font-weight:700">org.hibernate.cfg.AvailableSettings.STATEMENT_FETCH_SIZE</span>;

@SpringBootApplication(scanBasePackages <span style="color:#00f;font-weight:700">=</span> <span style="color:#036a07">com.apress.prospring5.ch9.services</span>)
<span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">class</span> <span style="text-decoration:underline">Application</span> <span style="color:#00f;font-weight:700">implements</span> <span style="font-style:italic">CommandLineRunner</span> {
    <span style="color:#00f;font-weight:700">private</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">Logger</span> logger <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">LoggerFactory</span><span style="color:#00f;font-weight:700">.</span>getLogger(<span style="color:#00f;font-weight:700">Application</span><span style="color:#00f;font-weight:700">.</span>class);

    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">static</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">main</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Exception</span> {
        <span style="color:#00f;font-weight:700">ConfigurableApplicationContext</span> ctx <span style="color:#00f;font-weight:700">=</span>
                <span style="color:#00f;font-weight:700">SpringApplication</span><span style="color:#00f;font-weight:700">.</span>run(<span style="color:#00f;font-weight:700">Application</span><span style="color:#00f;font-weight:700">.</span>class, args);
        <span style="color:#00f;font-weight:700">System</span><span style="color:#00f;font-weight:700">.</span>in<span style="color:#00f;font-weight:700">.</span>read();
        ctx<span style="color:#00f;font-weight:700">.</span>close();
    }

    <span style="color:#00f;font-weight:700">@Autowired</span>
    <span style="color:#00f;font-weight:700">SingerService</span> singerService;

    <span style="color:#00f;font-weight:700">@Override</span>
    <span style="color:#00f;font-weight:700">public</span> <span style="color:#00f;font-weight:700">void</span> <span style="color:#0000a2;font-weight:700">run</span>(<span style="color:#00f;font-weight:700">String</span>... <span style="font-style:italic">args</span>) <span style="color:#00f;font-weight:700">throws</span> <span style="color:#00f;font-weight:700">Exception</span> {
        <span style="color:#00f;font-weight:700">Singer</span> singer <span style="color:#00f;font-weight:700">=</span> <span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Singer</span>();
        singer<span style="color:#00f;font-weight:700">.</span>setFirstName(<span style="color:#036a07">John</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setLastName(<span style="color:#036a07">Mayer</span>);
        singer<span style="color:#00f;font-weight:700">.</span>setBirthDate(<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">Date</span>(
                (<span style="color:#00f;font-weight:700">new</span> <span style="color:#00f;font-weight:700">GregorianCalendar</span>(<span style="color:#0000cd">1977</span>, <span style="color:#0000cd">9</span>, <span style="color:#0000cd">16</span>))<span style="color:#00f;font-weight:700">.</span>getTime()<span style="color:#00f;font-weight:700">.</span>getTime()));
        singerService<span style="color:#00f;font-weight:700">.</span>save(singer);
        <span style="color:#00f;font-weight:700">long</span> count <span style="color:#00f;font-weight:700">=</span> singerService<span style="color:#00f;font-weight:700">.</span>count();
        <span style="color:#00f;font-weight:700">if</span> (count <span style="color:#00f;font-weight:700">==</span> <span style="color:#0000cd">1</span>) {
            logger<span style="color:#00f;font-weight:700">.</span>info(<span style="color:#036a07">--&gt; Singer saved successfully</span>);
        } <span style="color:#00f;font-weight:700">else</span> {
            logger<span style="color:#00f;font-weight:700">.</span>error(<span style="color:#036a07">--&gt; Singer was not saved, check the configuration!!</span>);
        }
        <span style="color:#00f;font-weight:700">try</span> {
            singerService<span style="color:#00f;font-weight:700">.</span>save(<span style="color:#585cf6;font-weight:700">null</span>);
        } <span style="color:#00f;font-weight:700">catch</span> (<span style="color:#00f;font-weight:700">Exception</span> ex) {
            logger<span style="color:#00f;font-weight:700">.</span>error(ex<span style="color:#00f;font-weight:700">.</span>getMessage() <span style="color:#00f;font-weight:700">+</span> <span style="color:#036a07">Final count:</span> <span style="color:#00f;font-weight:700">+</span> singerService<span style="color:#00f;font-weight:700">.</span>count());
        }
    }
}
</pre>
                                                    </li>
                                                </ul>
                                            </div>                                             
                                        </div>
                                        <div class="Para ParaOneEmphasisChild" id="Par147">If you run 
                                            <span class="EmphasisFontCategoryNonProportional">Application</span>, you will see output similar to this:
                                        </div>
                                        <pre style="background:#fff;color:#000">...
INFO  c.a.j.AtomikosConnectionFactoryBean - AtomikosConnectionFactoryBean
    &apos;jmsConnectionFactory&apos;: init...
INFO  o.s.t.j.JtaTransactionManager - Using JTA  UserTransaction:
   com.atomikos.icatch.jta.UserTransactionManager@408a247c
INFO  c.a.j.AtomikosJmsXaSessionProxy - atomikos xa session proxy for resource
    jmsConnectionFactory: calling createQueue on JMS driver session...
INFO  c.a.j.AtomikosJmsXaSessionProxy - atomikos xa session proxy for resource
    jmsConnectionFactory: calling getTransacted on JMS driver session...
DEBUG o.s.t.j.JtaTransactionManager - Participating in existing transaction
DEBUG o.s.t.j.JtaTransactionManager - Initiating transaction commit
INFO  c.a.d.x.XAResourceTransaction - XAResource.start ...
INFO  c.a.d.x.XAResourceTransaction - XAResource.end ...
DEBUG o.s.t.j.JtaTransactionManager - Initiating transaction commit
DEBUG o.s.t.j.JtaTransactionManager - Creating new transaction with name
   [com.apress.prospring5.ch9.services.SingerServiceImpl.save]:
    PROPAGATION_REQUIRED,ISOLATION_DEFAULT; &apos;&apos;
INFO  c.a.i.i.BaseTransactionManager - createCompositeTransaction ( 10000 ):
   created new ROOT transaction with id 127.0.0.1.tm0000200001
DEBUG o.s.t.j.JtaTransactionManager - Participating in existing transaction
INFO  c.a.p.c.Application - --&gt; Singer saved successfully
...//etc
</pre>
                                        <div class="Para" id="Par149">From the log you can clearly see the global 
                                            <span id="ITerm65">transaction                      </span> being created and reused for each of the operations. If you exit the application normally by pressing any key and then Enter, be patient, because it takes a while for the application to shut down gracefully.
                                        </div>
                                        <div class="Para" id="Par150">Here are some conclusions about creating JTA applications with Spring Boot: although it seems easy, when working with multiple data sources, configuring the environment is something you cannot get out of. Also, if the JTA provider is provided by a JEE server, things get quite complicated. But for sample applications used for educational purposes and testing, it is quite practical.</div>
                                    </div>
                                    <div class="Section2 RenderAsSection2" id="Sec17">
                                        <h3 class="Heading">Considerations on Using JTA Transaction Manager</h3>
                                        <div class="Para" id="Par151">Whether to use JTA for global transaction management is under hot debate. For example, the Spring development team generally does not recommend using JTA for global transactions.</div>
                                        <div class="Para" id="Par152">As a general 
                                            <span id="ITerm66">principle                      </span>, when your application is deployed to a full-blown JEE application server, there is no point in not using JTA because all the vendors of the popular JEE application servers have optimized their JTA implementation for their platforms. That’s one major feature you are paying for.
                                        </div>
                                        <div class="Para" id="Par153">For stand-alone or web container deployment, let the application requirements drive your decision. Perform load testing as early as possible to verify that performance is not being impaired by using JTA.</div>
                                        <div class="Para ParaOneEmphasisChild" id="Par154">One piece of good news is that Spring works seamlessly with both local and global transactions in most major web and JEE containers, so code modification is generally not required when you switch from one transaction management strategy to another. If you decide to use JTA within your application, make sure you use Spring’s 
                                            <span class="EmphasisFontCategoryNonProportional">JtaTransactionManager</span>.
                                        </div>
                                    </div>
                                </div>
                                <div class="Section1 RenderAsSection1" id="Sec18">
                                    <h2 class="Heading">Summary</h2>
                                    <div class="Para" id="Par155">Transaction management is a key part of ensuring data integrity in almost any type of application. In this chapter, we discussed how to use Spring to manage transactions with almost no impact on your source code. You also learned how to use local and global transactions.</div>
                                    <div class="Para" id="Par156">We provided various examples of transaction implementation, including declarative ways of using XML configuration and annotation, as well as the programmatic approach.</div>
                                    <div class="Para" id="Par157">Local transactions are supported inside/outside a JEE application server, and only simple configuration is required to enable local transaction support in Spring. However, setting up a global transaction environment involves more work and greatly depends on which JTA provider and corresponding back-end resources your application needs to interact with.</div>
                                </div>
                                <div class="FootnoteSection">
                                    <div class="Heading">Footnotes</div>
                                    <div class="Footnote" id="Fn1">
                                        <span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html#Fn1_source">1</a></span>
                                        <div class="FootnoteParas">
                                            <div class="Para ParaOneEmphasisChild" id="Par20">JDO support was dropped in Spring 5; thus, 
                                                <span class="EmphasisFontCategoryNonProportional">JdoTransactionManager</span> is missing from the class diagram.
                                            </div>
                                        </div>
                                        <div class="ClearBoth"> </div>
                                    </div>
                                    <div class="Footnote" id="Fn2">
                                        <span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html#Fn2_source">2</a></span>
                                        <div class="FootnoteParas">
                                            <div class="Para" id="Par21">Spring 5 works only with Hibernate 5; implementations for Hibernate 3 and Hibernate 4 have been removed.</div>
                                        </div>
                                        <div class="ClearBoth"> </div>
                                    </div>
                                    <div class="Footnote" id="Fn3">
                                        <span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html#Fn3_source">3</a></span>
                                        <div class="FootnoteParas">
                                            <div class="Para" id="Par22">Support for JMS 1.1 was dropped in Spring 5.</div>
                                        </div>
                                        <div class="ClearBoth"> </div>
                                    </div>
                                    <div class="Footnote" id="Fn4">
                                        <span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html#Fn4_source">4</a></span>
                                        <div class="FootnoteParas">
                                            <div class="Para" id="Par112">This configuration was created with help from the official Atomikos documentation for integration with Spring at 
                                                <span class="ExternalRef"><a href="https://www.atomikos.com/Documentation/SpringIntegration"><span class="RefSource"> <span class="EmphasisFontCategoryNonProportional">https://www.atomikos.com/Documentation/SpringIntegration</span> </span></a></span> and with help from the Stack Overflow community at 
                                                <span class="ExternalRef"><a href="https://stackoverflow.com/questions/33127854/hibernate-5-with-spring-jta"><span class="RefSource"> <span class="EmphasisFontCategoryNonProportional">https://stackoverflow.com/questions/33127854/hibernate-5-with-spring-jta</span> </span></a></span>.
                                            </div>
                                        </div>
                                        <div class="ClearBoth"> </div>
                                    </div>
                                    <div class="Footnote" id="Fn5">
                                        <span class="FootnoteNumber"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html#Fn5_source">5</a></span>
                                        <div class="FootnoteParas">
                                            <div class="Para" id="Par116">This configuration is an annotation configuration adaptation of the XML configuration given as an example in the Atomikos documentation at 
                                                <span class="ExternalRef"><a href="https://www.atomikos.com/Documentation/SpringIntegration#The_Advanced_Case_40As_of_3.3_41"><span class="RefSource"> <span class="EmphasisFontCategoryNonProportional">https://www.atomikos.com/Documentation/SpringIntegration#The_Advanced_Case_40As_of_3.3_41</span> </span></a></span>.
                                            </div>
                                        </div>
                                        <div class="ClearBoth"> </div>
                                    </div>
                                </div>
                            </div>
                            <div class="annotator-outer annotator-viewer viewer annotator-hide"> 
                                <ul class="annotator-widget annotator-listing"></ul>
                            </div>
                            <div class="annotator-modal-wrapper annotator-editor-modal annotator-editor annotator-hide"> 
                                <div class="annotator-outer editor"> 
                                    <h2 class="title">Highlight</h2> 
                                    <form class="annotator-widget"> 
                                        <ul class="annotator-listing"> 
                                            <li class="annotator-item">
                                                <textarea class="js-editor" id="annotator-field-0" maxlength="750" placeholder="Add a note using markdown (optional)"></textarea>
                                            </li>
                                        </ul>                                         

                                        <div class="annotator-controls"> 
                                            <a class="link-to-markdown" href="https://daringfireball.net/projects/markdown/basics" target="_blank">?</a> 
                                            <ul> 
                                                <li class="delete annotator-hide">
                                                    <a class="annotator-delete-note button positive" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html#delete">Delete Note</a>
                                                </li>                                                 

                                                <li class="save">
                                                    <a class="annotator-save annotator-focus button positive" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html#save">Save Note</a>
                                                </li>                                                 

                                                <li class="cancel">
                                                    <a class="annotator-cancel button" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html#cancel">Cancel</a>
                                                </li>                                                 
                                            </ul>                                             
                                        </div>                                         
                                    </form>                                     
                                </div>
                            </div>
                            <div class="annotator-modal-wrapper annotator-delete-confirm-modal" style="display: none;"> 
                                <div class="annotator-outer"> 
                                    <h2 class="title">Highlight</h2> 
                                    <a class="js-close-delete-confirm annotator-cancel close" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html#close">Close</a> 
                                    <div class="annotator-widget"> 
                                        <div class="delete-confirm">            Are you sure you want to permanently delete this note?         </div>                                         

                                        <div class="annotator-controls"> 
                                            <a class="annotator-cancel button js-cancel-delete-confirm" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html#cancel">No, I changed my mind</a> 
                                            <a class="annotator-delete button positive js-delete-confirm" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html#delete">Yes, delete it</a> 
                                        </div>                                         
                                    </div>                                     
                                </div>
                            </div>
                            <div class="annotator-adder" style="display: none;"> 
                                <ul class="adders"> 
                                    <li class="copy">
                                        <a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html#">Copy</a>
                                    </li>                                     

                                    <li class="add-highlight">
                                        <a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html#">Add Highlight</a>
                                    </li>                                     

                                    <li class="add-note">
                                        <a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html#">			Add Note		</a>
                                    </li>                                     
                                </ul>
                            </div>
                        </div>
                    </div>                     

                    <div class="t-sbo-prev sbo-prev sbo-nav-bottom"> 
                        <a class="prev nav-link" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_8_Chapter.html"> 
                            <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span> 
                            <span class="visuallyhidden">Previous Chapter</span> 
                            <div class="pagination-title t-prev-title">8. Data Access in Spring with JPA2</div>                             
                        </a>                         
                    </div>                     

                    <div class="t-sbo-next sbo-next sbo-nav-bottom"> 
                        <a class="next nav-link" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_10_Chapter.html"> 
                            <span aria-hidden="true" class="pagination-label t-next-label">Next</span> 
                            <span class="visuallyhidden">Next Chapter</span> 
                            <div class="pagination-title t-next-title">10. Validation with Type Conversion and Formatting</div>                             
                        </a>                         
                    </div>                     
                </section>                 
            </div>
            <section class="sbo-saved-archives"></section>             
        </div>                  

        <div id="batBeacon0.3684770053345583" style="width:0px; height:0px; display:none; visibility:hidden;">
            <img alt="" height="0" id="batBeacon0.339271314453927" src="https://bat.bing.com/action/0?ti=5794699&amp;Ver=2&amp;mid=f948336c-d219-7334-0810-c0f761421888&amp;pi=1200101525&amp;lg=zh-CN&amp;sw=1366&amp;sh=768&amp;sc=24&amp;tl=9.%20Transaction%20Management%20-%20Pro%20Spring%205%3A%20An%20In-Depth%20Guide%20to%20the%20Spring%20Framework%20and%20Its%20Tools&amp;p=https%3A%2F%2Flearning.oreilly.com%2Flibrary%2Fview%2Fpro-spring-5%2F9781484228081%2FA315511_5_En_9_Chapter.html&amp;r=&amp;evt=pageLoad&amp;msclkid=N&amp;rn=124087" style="width:0px; height:0px; display:none; visibility:hidden;" width="0"/>
        </div>         

        <div class="annotator-notice"></div>
        <div class="font-flyout" style="top: 200.984px; left: 1280px;">
            <div class="font-controls-panel"> 
                <div class="nightmodes"> 
                    <ul> 
                        <li class="day">
                            <a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html#" id="day-mode" title="Day Mode"> <i class="fa fa-sun-o"></i> <span>Day Mode</span></a>
                        </li>                         

                        <li class="cloudy">
                            <a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html#" id="cloudy-mode" title="Cloudy Mode"> <i class="fa fa-cloud"></i> <span>Cloud Mode</span> </a>
                        </li>                         

                        <li class="night">
                            <a href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html#" id="night-mode" title="Night Mode"> <i class="fa fa-moon-o"></i> <span>Night Mode</span> </a>
                        </li>                         
                    </ul>                     
                </div>                 

                <div class="font-resizer resizer"> 
                    <div class="draggable-containment-wrapper"> 
                        <i class="fa fa-font left"></i> 
                        <span class="filler" style="width: 50%;"></span> 
                        <div class="draggable ui-widget-content ui-draggable ui-draggable-handle" id="js-font-size-draggable" style="position: relative; left: 80px;"></div>                         

                        <i class="fa fa-font right"></i> 
                    </div>                     
                </div>                 

                <div class="column-resizer resizer"> 
                    <div class="draggable-containment-wrapper"> 
                        <i class="fa fa-compress left"></i> 
                        <span class="filler" style="width: 50%;"></span> 
                        <div class="draggable ui-widget-content ui-draggable ui-draggable-handle" id="js-column-size-draggable" style="position: relative; left: 80px;"></div>                         

                        <i class="fa fa-expand right"></i> 
                    </div>                     
                </div>                 

                <a class="button" href="https://learning.oreilly.com/library/view/pro-spring-5/9781484228081/A315511_5_En_9_Chapter.html#" id="reset">Reset</a>
            </div>
        </div>
        <iframe src="cid:frame-2D3B7D73CB1B66F9BA72E39827895D4C@mhtml.blink" style="display: none;"></iframe>
        <span><div id="KampyleAnimationContainer" style="z-index: 2147483000; border: 0px; position: fixed; display: block; width: 0px; height: 0px;"></div></span>
        <div style="display: none; visibility: hidden;"></div>
        <iframe allowtransparency="true" frameborder="0" scrolling="no" src="cid:frame-3D753A300CD29202970A61135A484D6B@mhtml.blink" style="display: none;" title="Twitter settings iframe"></iframe>
    </body>
</html>