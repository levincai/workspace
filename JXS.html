<!--if IE]><![endif]--><!DOCTYPE html><!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/java-xml-and/9781484243305/html/Part_1.xhtml"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="3866890"
  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"
  data-username="levinxccai"
  data-account-type="B2B"
  
  data-activated-trial-date="11/06/2017"


  data-archive="9781484243305"
  data-publishers="Apress"



  data-htmlfile-name="Part_1.xhtml"
  data-epub-title="Java XML and JSON: Document Processing for Java SE" data-debug=0 data-testing=0><![endif]--><!--if gt IE 8]><!--><html class="js flexbox flexboxlegacy no-touch websqldatabase indexeddb history csscolumns csstransforms localstorage sessionstorage applicationcache svg inlinesvg zoom gr__learning_oreilly_com fa-events-icons-ready" data-account-type="B2B" data-activated-trial-date="11/06/2017" data-archive="9781484243305" data-csrf-cookie="csrfsafari" data-debug="0" data-epub-title="Java XML and JSON: Document Processing for Java SE" data-highlight-privacy="" data-htmlfile-name="Part_1.xhtml" data-login-url="/accounts/login/" data-offline-url="/" data-publishers="Apress" data-testing="0" data-url="/library/view/java-xml-and/9781484243305/html/Part_1.xhtml" data-user-id="3866890" data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca" data-username="levinxccai" itemscope="" itemtype="http://schema.org/Book http://schema.org/ItemPage" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#" style=""><!--![endif]--><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><link href="cid:css-c29c2c13-d1d2-47f7-87c8-9732bddc8079@mhtml.blink" rel="stylesheet" type="text/css"/><link href="cid:css-461b4ae3-c75b-4598-bfa0-3dfc3b840921@mhtml.blink" rel="stylesheet" type="text/css"/><link href="cid:css-1c7cae12-ddc5-4e8e-a2df-4bf39b087e28@mhtml.blink" rel="stylesheet" type="text/css"/><link href="cid:css-a2fcc84e-3d01-4603-935e-62a1992e73fe@mhtml.blink" rel="stylesheet" type="text/css"/><link href="cid:css-6100383e-4c0b-406c-be4a-53b489b829b8@mhtml.blink" rel="stylesheet" type="text/css"/><link href="cid:css-b7039175-2908-4c5c-954b-2025dcd8539d@mhtml.blink" rel="stylesheet" type="text/css"/><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"/><meta content="Safari Books Online" name="author"/><meta content="telephone=no" name="format-detection"/><meta content="on" http-equiv="cleartype"/><meta content="True" name="HandheldFriendly"/><meta content="320" name="MobileOptimized"/><meta content="app-id=881697395, app-argument=safaridetail://9781484243305" name="apple-itunes-app"/><meta content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0" name="viewport"/><meta content="4503599627559754" property="twitter:account_id"/><link href="https://learning.oreilly.com/static/images/apple-touch-icon.0c29511d2d72.png" rel="apple-touch-icon"/><link href="https://learning.oreilly.com/favicon.ico" rel="shortcut icon" type="image/x-icon"/><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900,200italic,300italic,400italic,600italic,700italic,900italic" rel="stylesheet" type="text/css"/><title>ch003-Part_1</title><link href="https://learning.oreilly.com/static/CACHE/css/output.8054605313ed.css" rel="stylesheet" type="text/css"/><link href="https://learning.oreilly.com/static/css/annotator.e3b0c44298fc.css" rel="stylesheet" type="text/css"/><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet"/><link href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/Part_1.xhtml" rel="canonical"/><meta content="Part IExploring XML " name="description"/><meta content="Part I. Exploring XML" property="og:title"/><meta content="/library/view/java-xml-and/9781484243305/" itemprop="isPartOf"/><meta content="Part I. Exploring XML" itemprop="name"/><meta content="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/Part_1.xhtml" itemprop="url" property="og:url"/><meta content="Safari" property="og:site_name"/><meta content="https://learning.oreilly.com/library/cover/9781484243305/" itemprop="thumbnailUrl" property="og:image"/><meta content="Part IExploring XML " itemprop="description" property="og:description"/><meta content="en" itemprop="inLanguage"/><meta content="Apress" itemprop="publisher"/><meta content="book" property="og:type"/><meta content="9781484243305" itemprop="isbn" property="og:book:isbn"/><meta content="Jeff Friesen" itemprop="author" property="og:book:author"/><meta content="summary" name="twitter:card"/><meta content="@safari" name="twitter:site"/><link href="https://use.fontawesome.com/840a321d95.css" media="all" rel="stylesheet"/></head>


<body class="reading sidenav nav-collapsed  scalefonts day-mode library" data-gr-c-s-loaded="true">
<a name="1_"></a>

<div class="application" id="container" style="height: auto;">
  <div class="js-toc">
    <section role="document">
      <div id="sbo-rt-content" style="max-width:72.5em; transform: none;"><div class="annotator-wrapper"><h1><span class="PartNumber">Part I</span><span class="PartTitle" lang="en">Exploring XML</span></h1><div class="annotator-outer annotator-viewer viewer annotator-hide"> </div></div></div>
    </section>
  </div>
</div>

<hr/>

<!--if IE]><![endif]--><!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="3866890"
  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"
  data-username="levinxccai"
  data-account-type="B2B"
  
  data-activated-trial-date="11/06/2017"


  data-archive="9781484243305"
  data-publishers="Apress"



  data-htmlfile-name="394211_2_En_1_Chapter.xhtml"
  data-epub-title="Java XML and JSON: Document Processing for Java SE" data-debug=0 data-testing=0><![endif]--><!--if gt IE 8]><!--><!--![endif]-->



<a name="2_"></a>

<div class="application" id="container" style="height: auto;">
  <div class="js-toc">
    <section role="document">
      <div id="sbo-rt-content" style="max-width:72.5em; transform: none;"><div class="annotator-wrapper"><!--egin Abstract--><div class="MainTitleSection"><h1 class="ChapterTitle" lang="en">1. Introducing XML</h1></div><div class="AuthorGroup"><div class="AuthorNames"><span class="Author"><span class="AuthorName">Jeff Friesen</span><sup><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#Aff2">1</a> <span class="ContactIcon"></span></sup></span></div><div class="Affiliations"><div class="Affiliation" id="Aff2"><span class="AffiliationNumber">(1)</span><div class="AffiliationText">Dauphin, MB, Canada</div></div><div class="ClearBoth"> </div></div></div><!--nd Abstract--><div class="Fulltext"><p class="Para" id="Par2">Applications commonly use XML documents to store and exchange data. XML defines rules for encoding documents in a format that is both human-readable and machine-readable. Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml"><span class="RefSource">1</span></a></span> introduces XML, tours the XML language features, and discusses well-formed and valid documents.</p><section class="Section1 RenderAsSection1" id="Sec1"><h2 class="Heading">What Is XML?</h2><p class="Para" id="Par3"><em class="EmphasisTypeItalic ">XML</em> (eXtensible Markup Language) <span id="ITerm1">
                
              </span> is a <em class="EmphasisTypeItalic ">meta-language</em> (a language used to describe other languages) for defining <em class="EmphasisTypeItalic ">vocabularies</em> (custom markup languages), which is the key to XML鈥檚 importance and popularity. XML-based vocabularies (such as XHTML) let you describe documents in a meaningful way.</p><p class="Para" id="Par4">XML vocabulary documents are like HTML (see <span class="ExternalRef"><a href="http://en.wikipedia.org/wiki/HTML"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional ">http://en.wikipedia.org/wiki/HTML</span>
                </span></a></span>) documents in that they are text-based and consist of <em class="EmphasisTypeItalic ">markup</em> (encoded descriptions of a document鈥檚 logical structure) and <em class="EmphasisTypeItalic ">content</em> (document text not interpreted as markup). Markup is evidenced via <em class="EmphasisTypeItalic ">tags</em> (angle bracket鈥揹elimited syntactic constructs), and each tag has a name. Furthermore, some tags have <em class="EmphasisTypeItalic ">attributes</em> (name/value pairs).</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar1"><h3 class="Heading">Note</h3><p class="Para" id="Par5">XML and HTML are descendants of <em class="EmphasisTypeItalic ">Standard Generalized Markup Language</em> (<em class="EmphasisTypeItalic ">SGML</em>), which is the original meta-language for creating vocabularies鈥擷ML is essentially a restricted form of SGML, while HTML is an <em class="EmphasisTypeItalic ">application</em> of SGML. The key difference between XML and HTML is that XML invites you to create your own vocabularies with their own tags and rules, whereas HTML gives you a single pre-created vocabulary with its own fixed set of tags and rules. XHTML and other XML-based vocabularies are <em class="EmphasisTypeItalic ">XML applications</em>. XHTML was created to be a cleaner implementation of HTML.</p></div><div class="Para" id="Par6">If you haven鈥檛 previously encountered XML, you might be surprised by its simplicity and how closely its vocabularies resemble HTML. You don鈥檛 need to be a rocket scientist to learn how to create an XML document. To prove this to yourself, check out Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC1">1-1</a></span>.<div class="ProgramCode" id="PC1"><div class="LineGroup"><div class="FixedLine">&lt;recipe&gt;</div><div class="FixedLine">   &lt;title&gt;</div><div class="FixedLine">      Grilled Cheese Sandwich</div><div class="FixedLine">   &lt;/title&gt;</div><div class="FixedLine">   &lt;ingredients&gt;</div><div class="FixedLine">      &lt;ingredient qty=&quot;2&quot;&gt;</div><div class="FixedLine">         bread slice</div><div class="FixedLine">      &lt;/ingredient&gt;</div><div class="FixedLine">      &lt;ingredient&gt;</div><div class="FixedLine">         cheese slice</div><div class="FixedLine">      &lt;/ingredient&gt;</div><div class="FixedLine">      &lt;ingredient qty=&quot;2&quot;&gt;</div><div class="FixedLine">         margarine pat</div><div class="FixedLine">      &lt;/ingredient&gt;</div><div class="FixedLine">   &lt;/ingredients&gt;</div><div class="FixedLine">   &lt;instructions&gt;</div><div class="FixedLine">      Place frying pan on element and select medium heat.</div><div class="FixedLine">      For each bread slice, smear one pat of margarine on</div><div class="FixedLine">      one side of bread slice. Place cheese slice between</div><div class="FixedLine">      bread slices with margarine-smeared sides away from</div><div class="FixedLine">      the cheese. Place sandwich in frying pan with one</div><div class="FixedLine">      margarine-smeared side in contact with pan. Fry for</div><div class="FixedLine">      a couple of minutes and flip. Fry other side for a</div><div class="FixedLine">      minute and serve.</div><div class="FixedLine">   &lt;/instructions&gt;</div><div class="FixedLine">&lt;/recipe&gt;</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 1-1</span><p class="SimplePara">XML-Based Recipe for a Grilled Cheese Sandwich</p></div></div></div></div><p class="Para" id="Par7">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC1">1-1</a></span> presents an XML document that describes a recipe for making a grilled cheese sandwich. This document is reminiscent of an HTML document in that it consists of tags, attributes, and content. However, that鈥檚 where the similarity ends. Instead of presenting HTML tags such as <span class="EmphasisFontCategoryNonProportional ">&lt;html&gt;</span>, <span class="EmphasisFontCategoryNonProportional ">&lt;head&gt;</span>, <span class="EmphasisFontCategoryNonProportional ">&lt;img&gt;</span>, and <span class="EmphasisFontCategoryNonProportional ">&lt;p&gt;</span>, this informal recipe language presents its own <span class="EmphasisFontCategoryNonProportional ">&lt;recipe&gt;</span>, <span class="EmphasisFontCategoryNonProportional ">&lt;ingredients&gt;</span>, and other tags.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar2"><h3 class="Heading">Note</h3><p class="Para" id="Par8">Although Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC1">1-1</a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">&lt;title&gt;</span> and <span class="EmphasisFontCategoryNonProportional ">&lt;/title&gt;</span> tags are also found in HTML, they differ from their HTML counterparts. Web browsers typically display the content between these tags in their title bars or tab headers. In contrast, the content between Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC1">1-1</a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">&lt;title&gt;</span> and <span class="EmphasisFontCategoryNonProportional ">&lt;/title&gt;</span> tags might be displayed as a recipe header, spoken aloud, or presented in some other way, depending on the application that parses this document.</p></div></section><section class="Section1 RenderAsSection1" id="Sec2"><h2 class="Heading">Language Features Tour</h2><p class="Para" id="Par9">XML provides several language features for use in defining custom markup languages: XML declaration, elements and attributes, character references and CDATA sections, namespaces, and comments and processing instructions. You will learn about these language features in this section.</p><section class="Section2 RenderAsSection2" id="Sec3"><h3 class="Heading">XML Declaration</h3><p class="Para" id="Par10">An XML document usually begins with the <em class="EmphasisTypeItalic ">XML declaration</em>, special markup telling an XML <span id="ITerm2">parser</span> that the document is XML. The absence of the XML declaration in Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC1">1-1</a></span> reveals that this special markup isn鈥檛 mandatory. When the XML declaration is present, nothing can appear before it.</p><p class="Para" id="Par11">The XML declaration minimally looks like <span class="EmphasisFontCategoryNonProportional ">&lt;?xml version=&quot;1.0&quot;?&gt;</span> in which the nonoptional <span class="EmphasisFontCategoryNonProportional ">version</span> attribute identifies the version of the XML specification to which the document conforms. The initial version of this specification (1.0) was introduced in 1998 and is widely implemented.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar3"><h3 class="Heading">Note</h3><p class="Para" id="Par12">The World Wide Web Consortium (W3C), which maintains XML, released version 1.1 in 2004. This version mainly supports the use of line-ending characters used on EBCDIC platforms (see <span class="ExternalRef"><a href="http://en.wikipedia.org/wiki/EBCDIC"><span class="RefSource">
                      <span class="EmphasisFontCategoryNonProportional ">http://en.wikipedia.org/wiki/EBCDIC</span>
                    </span></a></span>) and the use of scripts and characters that are absent from Unicode (see <span class="ExternalRef"><a href="http://en.wikipedia.org/wiki/Unicode"><span class="RefSource">
                      <span class="EmphasisFontCategoryNonProportional ">http://en.wikipedia.org/wiki/Unicode</span>
                    </span></a></span>) 3.2. Unlike XML 1.0, XML 1.1 isn鈥檛 widely implemented and should be used only when its unique features are needed.</p></div><p class="Para" id="Par13">XML supports Unicode, which means that XML documents consist entirely of characters taken from the <span id="ITerm3">Unicode character set</span>. The document鈥檚 characters are encoded into bytes for storage or transmission, and the encoding is specified via the XML declaration鈥檚 optional <span class="EmphasisFontCategoryNonProportional ">encoding</span> attribute. One common encoding is <em class="EmphasisTypeItalic ">UTF-8</em> (see <span class="ExternalRef"><a href="http://en.wikipedia.org/wiki/UTF-8"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://en.wikipedia.org/wiki/UTF-8</span>
                  </span></a></span>), which is a variable-length encoding of the Unicode character set. UTF-8 is a strict superset of ASCII (see <span class="ExternalRef"><a href="http://en.wikipedia.org/wiki/ASCII"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://en.wikipedia.org/wiki/ASCII</span>
                  </span></a></span>), which means that pure ASCII text files are also UTF-8 documents.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar4"><h3 class="Heading">Note</h3><p class="Para" id="Par14">In the absence of the XML declaration or when the XML declaration鈥檚 <span class="EmphasisFontCategoryNonProportional ">encoding</span> attribute isn鈥檛 present, an XML parser typically looks for a special character sequence at the start of a document to determine the document鈥檚 encoding. This character sequence is known as the <em class="EmphasisTypeItalic ">byte-order-mark</em> (<em class="EmphasisTypeItalic ">BOM</em>)<span id="ITerm4">
                    
                  </span> and is created by an editor program (such as Microsoft Windows Notepad) when it saves the document according to UTF-8 or some other encoding. For example, the hexadecimal sequence <span class="EmphasisFontCategoryNonProportional ">EF BB BF</span> signifies UTF-8 as the encoding. Similarly, <span class="EmphasisFontCategoryNonProportional ">FE FF</span> signifies UTF-16 (see <span class="ExternalRef"><a href="https://en.wikipedia.org/wiki/UTF-16"><span class="RefSource">
                      <span class="EmphasisFontCategoryNonProportional ">http://en.wikipedia.org/wiki/UTF-16</span>
                    </span></a></span>) big endian, <span class="EmphasisFontCategoryNonProportional ">FF FE</span> signifies UTF-16 little endian, <span class="EmphasisFontCategoryNonProportional ">00 00 FE FF</span> signifies UTF-32 (see <span class="ExternalRef"><a href="https://en.wikipedia.org/wiki/UTF-32"><span class="RefSource">
                      <span class="EmphasisFontCategoryNonProportional ">http://en.wikipedia.org/wiki/UTF-32</span>
                    </span></a></span>) big endian, and <span class="EmphasisFontCategoryNonProportional ">FF FE 00 00</span> signifies UTF-32 little endian. UTF-8 is assumed when no BOM is present.</p></div><div class="Para" id="Par15">If you鈥檒l never use characters apart from the ASCII character set, you can probably forget about the <span class="EmphasisFontCategoryNonProportional ">encoding</span> attribute. However, when your native language isn鈥檛 English or when you鈥檙e called to create XML documents that include non-ASCII characters, you need to properly specify <span class="EmphasisFontCategoryNonProportional ">encoding</span>. For example, when your document contains <span id="ITerm5">ASCII</span> plus characters from a non-English Western European language (such as 莽, the cedilla used in French, Portuguese, and other languages), you might want to choose <span class="EmphasisFontCategoryNonProportional ">ISO-8859-1</span> as the <span class="EmphasisFontCategoryNonProportional ">encoding</span> attribute鈥檚 value鈥攖he document will probably have a smaller size when encoded in this manner than when encoded with UTF-8. Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC2">1-2</a></span> shows you the resulting XML declaration.<div class="ProgramCode" id="PC2"><div class="LineGroup"><div class="FixedLine">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</div><div class="FixedLine">&lt;movie&gt;</div><div class="FixedLine">   &lt;name&gt;Le Fabuleux Destin d&apos;Am茅lie Poulain&lt;/name&gt;</div><div class="FixedLine">   &lt;language&gt;fran莽ais&lt;/language&gt;</div><div class="FixedLine">&lt;/movie&gt;</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 1-2</span><p class="SimplePara">An <span id="ITerm6">Encoded Document</span> Containing Non-ASCII Characters</p></div></div></div></div><p class="Para" id="Par16">The final attribute that can appear in the XML declaration is <span class="EmphasisFontCategoryNonProportional ">standalone</span>. This optional attribute, which is only relevant with DTDs (discussed later), determines whether or not there are external markup declarations that affect the information passed from an <em class="EmphasisTypeItalic ">XML processor</em> (a parser) to the application. Its value defaults to <span class="EmphasisFontCategoryNonProportional ">no</span>, implying that there are or may be such declarations. A <span class="EmphasisFontCategoryNonProportional ">yes</span> value indicates that there are no such declarations. For more information, check out 鈥淭he standalone pseudo-attribute is only relevant if a DTD is used鈥?(<span class="ExternalRef"><a href="http://www.xmlplease.com/xml/standalone/"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">www.xmlplease.com/xml/standalone/</span>
                  </span></a></span>).</p></section><section class="Section2 RenderAsSection2" id="Sec4"><h3 class="Heading">Elements and Attributes</h3><div class="Para" id="Par17">Following the XML declaration is a <em class="EmphasisTypeItalic ">hierarchical</em> (tree) structure of elements, where an <em class="EmphasisTypeItalic ">element</em> is a portion of the document delimited by a <em class="EmphasisTypeItalic ">start tag</em> (such as <span class="EmphasisFontCategoryNonProportional ">&lt;name&gt;</span>) and an <em class="EmphasisTypeItalic ">end tag</em> (such as <span class="EmphasisFontCategoryNonProportional ">&lt;/name&gt;</span>), or is an <em class="EmphasisTypeItalic ">empty-element tag</em> (a standalone tag whose name ends with a forward slash [<span class="EmphasisFontCategoryNonProportional ">/</span>], such as <span class="EmphasisFontCategoryNonProportional ">&lt;break/&gt;</span>). Start tags and end tags surround content and possibly other markup, whereas empty-element tags don鈥檛 surround anything. Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#Fig1">1-1</a></span> reveals Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC1">1-1</a></span>鈥檚 XML document <span id="ITerm7">tree structure</span>.<figure class="Figure" id="Fig1"><div class="MediaObject" id="MO1"><img alt="../images/394211_2_En_1_Chapter/394211_2_En_1_Fig1_HTML.png" data-mfp-src="/library/view/java-xml-and/9781484243305/images/394211_2_En_1_Chapter/394211_2_En_1_Fig1_HTML.png" height="704" src="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/images/394211_2_En_1_Chapter/394211_2_En_1_Fig1_HTML.png" style="height:17.6em" width="1192"/></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 1-1</span><p class="SimplePara">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC1">1-1</a></span>鈥檚 tree structure is rooted in the <span class="EmphasisFontCategoryNonProportional ">recipe</span> element</p></div></figcaption></figure></div><p class="Para" id="Par18">As with HTML document structure, the structure of an XML document is anchored in a <em class="EmphasisTypeItalic ">root element</em> (the topmost element). In HTML, the root element is <span class="EmphasisFontCategoryNonProportional ">html</span> (the <span class="EmphasisFontCategoryNonProportional ">&lt;html&gt;</span> and <span class="EmphasisFontCategoryNonProportional ">&lt;/html&gt;</span> tag pair). Unlike in HTML, you can choose the root element for your XML documents. Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#Fig1">1-1</a></span> shows the root element to be <span class="EmphasisFontCategoryNonProportional ">recipe</span>.</p><p class="Para" id="Par19">Unlike the other elements, which have parent elements, <span class="EmphasisFontCategoryNonProportional ">recipe</span> has no parent. Also, <span class="EmphasisFontCategoryNonProportional ">recipe</span> and <span class="EmphasisFontCategoryNonProportional ">ingredients</span> have child elements: <span class="EmphasisFontCategoryNonProportional ">recipe</span>鈥檚 children are <span class="EmphasisFontCategoryNonProportional ">title</span>, <span class="EmphasisFontCategoryNonProportional ">ingredients</span>, and <span class="EmphasisFontCategoryNonProportional ">instructions</span>; and <span class="EmphasisFontCategoryNonProportional ">ingredients</span>鈥?children are three instances of <span class="EmphasisFontCategoryNonProportional ">ingredient</span>. The <span class="EmphasisFontCategoryNonProportional ">title</span>, <span class="EmphasisFontCategoryNonProportional ">instructions</span>, and <span class="EmphasisFontCategoryNonProportional ">ingredient</span> elements don鈥檛 have child elements.</p><div class="Para" id="Par20">Elements can contain child elements, content, or <em class="EmphasisTypeItalic ">mixed content</em> (a combination of child elements and content). Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC2">1-2</a></span> reveals that the <span class="EmphasisFontCategoryNonProportional ">movie</span> element contains <span class="EmphasisFontCategoryNonProportional ">name</span> and <span class="EmphasisFontCategoryNonProportional ">language</span> child elements and also reveals that each of these child elements contains content (e.g., <span class="EmphasisFontCategoryNonProportional ">language</span> contains <span class="EmphasisFontCategoryNonProportional ">fran莽ais</span>). Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC3">1-3</a></span> presents another example that demonstrates mixed content along with child elements and content.<div class="ProgramCode" id="PC3"><div class="LineGroup"><div class="FixedLine">&lt;?xml version=&quot;1.0&quot;?&gt;</div><div class="FixedLine">&lt;article title=&quot;The Rebirth of JavaFX&quot; lang=&quot;en&quot;&gt;</div><div class="FixedLine">   &lt;abstract&gt;</div><div class="FixedLine">      JavaFX 2 marks a significant milestone in the history</div><div class="FixedLine">      of JavaFX. Now that Sun Microsystems has passed the</div><div class="FixedLine">      torch to Oracle, JavaFX Script is gone and</div><div class="FixedLine">      JavaFX-oriented Java APIS (such as</div><div class="FixedLine">      &lt;code&gt;javafx.application.Application&lt;/code&gt;) have</div><div class="FixedLine">      emerged for interacting with this technology. This</div><div class="FixedLine">      article introduces you to this refactored JavaFX,</div><div class="FixedLine">      where you learn about JavaFX 2 architecture and key</div><div class="FixedLine">      APIs.</div><div class="FixedLine">   &lt;/abstract&gt;</div><div class="FixedLine">   &lt;body&gt;</div><div class="FixedLine">   &lt;/body&gt;</div><div class="FixedLine">&lt;/article&gt;</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 1-3</span><p class="SimplePara">An <span class="EmphasisFontCategoryNonProportional ">Abstract</span> Element<span id="ITerm8">
                          
                          
                          
                        </span> Containing Mixed Content</p></div></div></div></div><p class="Para" id="Par21">This document鈥檚 root element is <span class="EmphasisFontCategoryNonProportional ">article</span>, which contains <span class="EmphasisFontCategoryNonProportional ">abstract</span> and <span class="EmphasisFontCategoryNonProportional ">body</span> child elements. The <span class="EmphasisFontCategoryNonProportional ">abstract</span> element mixes content with a <span class="EmphasisFontCategoryNonProportional ">code</span> element, which contains content. In contrast, the <span class="EmphasisFontCategoryNonProportional ">body</span> element is empty.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar5"><h3 class="Heading">Note</h3><p class="Para" id="Par22">As with Listings <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC1">1-1</a></span> and <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC2">1-2</a></span>, Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC3">1-3</a></span> also contains <em class="EmphasisTypeItalic ">whitespace</em> (invisible characters such as spaces, tabs, carriage returns, and line feeds). The XML specification permits whitespace to be added to a document. Whitespace appearing within content (such as spaces between words) is considered part of the content. In contrast, the parser typically ignores whitespace appearing between an end tag and the next start tag. Such whitespace isn鈥檛 considered part of the content.</p></div><p class="Para" id="Par23">An XML element鈥檚 start tag can contain one or more <span id="ITerm9">attributes</span>. For example, Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC1">1-1</a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">&lt;ingredient&gt;</span> tag has a <span class="EmphasisFontCategoryNonProportional ">qty</span> (quantity) attribute, and Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC3">1-3</a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">&lt;article&gt;</span> tag has <span class="EmphasisFontCategoryNonProportional ">title</span> and <span class="EmphasisFontCategoryNonProportional ">lang</span> attributes. Attributes provide additional details about elements. For example, <span class="EmphasisFontCategoryNonProportional ">qty</span> identifies the amount of an ingredient that can be added, <span class="EmphasisFontCategoryNonProportional ">title</span> identifies an article鈥檚 title, and <span class="EmphasisFontCategoryNonProportional ">lang</span> identifies the language in which the article is written (<span class="EmphasisFontCategoryNonProportional ">en</span> for English). Attributes can be <span id="ITerm10">optional</span>. For example, when <span class="EmphasisFontCategoryNonProportional ">qty</span> isn鈥檛 specified, a default value of <span class="EmphasisFontCategoryNonProportional ">1</span> is assumed.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar6"><h3 class="Heading">Note</h3><p class="Para" id="Par24">Element and attribute names may contain any alphanumeric character from English or another language and may also include the underscore (<span class="EmphasisFontCategoryNonProportional ">_</span>), hyphen (<span class="EmphasisFontCategoryNonProportional ">-</span>), period (<span class="EmphasisFontCategoryNonProportional ">.</span>), and colon (<span class="EmphasisFontCategoryNonProportional ">:</span>) punctuation characters. The colon should only be used with namespaces (discussed later in this chapter), and <strong class="EmphasisTypeBold ">names cannot contain whitespace</strong>.</p></div></section><section class="Section2 RenderAsSection2" id="Sec5"><h3 class="Heading">Character References and CDATA Sections</h3><p class="Para" id="Par25">Certain <span id="ITerm11">characters</span> cannot appear literally in the content that appears between a start tag and an end tag or within an attribute value. For example, you cannot place a literal <span class="EmphasisFontCategoryNonProportional ">&lt;</span> character between a start tag and an end tag because doing so would confuse an XML parser into thinking that it had encountered another tag.</p><div class="Para" id="Par26">One solution to this problem is to replace the literal character with a <em class="EmphasisTypeItalic ">character reference</em>, which is a code that represents the character. Character references are classified as numeric character references or character entity references:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par27">A <span id="ITerm12">
                        <em class="EmphasisTypeItalic ">numeric character reference</em>
                        
                        
                      </span> refers to a character via its Unicode code point and adheres to the format <span class="EmphasisFontCategoryNonProportional ">&amp;#</span><em class="EmphasisTypeItalic ">nnnn</em><span class="EmphasisFontCategoryNonProportional ">;</span> (not restricted to four positions) or <span class="EmphasisFontCategoryNonProportional ">&amp;#x</span><em class="EmphasisTypeItalic ">hhhh</em><span class="EmphasisFontCategoryNonProportional ">;</span> (not restricted to four positions), where <em class="EmphasisTypeItalic ">nnnn</em> provides a decimal representation of the code point and <em class="EmphasisTypeItalic ">hhhh</em> provides a hexadecimal representation. For example, <span class="EmphasisFontCategoryNonProportional ">危</span> and <span class="EmphasisFontCategoryNonProportional ">危</span> represent the Greek capital letter sigma. Although XML mandates that the <span class="EmphasisFontCategoryNonProportional ">x</span> in <span class="EmphasisFontCategoryNonProportional ">&amp;#x</span><em class="EmphasisTypeItalic ">hhhh</em><span class="EmphasisFontCategoryNonProportional ">;</span> be lowercase, it鈥檚 flexible in that the leading zero is optional in either format and in allowing you to specify an uppercase or lowercase letter for each <em class="EmphasisTypeItalic ">h</em>. As a result, <span class="EmphasisFontCategoryNonProportional ">危</span>, <span class="EmphasisFontCategoryNonProportional ">危</span>, and <span class="EmphasisFontCategoryNonProportional ">危</span> are also valid representations of the Greek capital letter sigma.</p></li><li><p class="Para" id="Par28">A <span id="ITerm13">
                        <em class="EmphasisTypeItalic ">character entity reference</em>
                        
                        
                      </span> refers to a character via the name of an <em class="EmphasisTypeItalic ">entity</em> (aliased data) that specifies the desired character as its replacement text. Character entity references are predefined by XML and have the format <span class="EmphasisFontCategoryNonProportional ">&amp;</span><em class="EmphasisTypeItalic ">name</em><span class="EmphasisFontCategoryNonProportional ">;</span>, in which <em class="EmphasisTypeItalic ">name</em> is the entity鈥檚 name. XML predefines five character entity references: <span class="EmphasisFontCategoryNonProportional ">&lt;</span> (<span class="EmphasisFontCategoryNonProportional ">&lt;</span>), <span class="EmphasisFontCategoryNonProportional ">&gt;</span> (<span class="EmphasisFontCategoryNonProportional ">&gt;</span>), <span class="EmphasisFontCategoryNonProportional ">&amp;</span> (<span class="EmphasisFontCategoryNonProportional ">&amp;</span>), <span class="EmphasisFontCategoryNonProportional ">&amp;apos;</span> (<span class="EmphasisFontCategoryNonProportional ">&apos;</span>), and <span class="EmphasisFontCategoryNonProportional ">&amp;quot;</span> (<span class="EmphasisFontCategoryNonProportional ">&quot;</span>).</p></li></ul></div></div><p class="Para" id="Par29">Consider <span class="EmphasisFontCategoryNonProportional ">&lt;expression&gt;6 &lt; 4&lt;/expression&gt;</span>. You could replace the <span class="EmphasisFontCategoryNonProportional ">&lt;</span> with numeric reference <span class="EmphasisFontCategoryNonProportional ">&lt;</span>, yielding <span class="EmphasisFontCategoryNonProportional ">&lt;expression&gt;6 &lt; 4&lt;/expression&gt;</span>, or better yet with <span class="EmphasisFontCategoryNonProportional ">&lt;</span>, yielding <span class="EmphasisFontCategoryNonProportional ">&lt;expression&gt;6 &lt; 4&lt;/expression&gt;</span>. The second choice is clearer and easier to remember.</p><p class="Para" id="Par30">Suppose you want to embed an HTML or XML document within an element. To make the embedded document acceptable to an XML parser, you would need to replace each literal <span class="EmphasisFontCategoryNonProportional ">&lt;</span> (start of tag) and <span class="EmphasisFontCategoryNonProportional ">&amp;</span> (start of entity) character with its <span class="EmphasisFontCategoryNonProportional ">&lt;</span> and <span class="EmphasisFontCategoryNonProportional ">&amp;</span> predefined character entity reference, a <span id="ITerm14">tedious</span> and possibly error-prone undertaking鈥攜ou might forget to replace one of these characters. To save you from tedium and potential errors, XML provides an alternative in the form of a <span id="ITerm15">CDATA</span> (character data) section.</p><div class="Para" id="Par31">A <span id="ITerm16">
                  <em class="EmphasisTypeItalic ">CDATA section</em>
                  
                  
                </span> is a section of literal HTML or XML markup and content surrounded by the <span class="EmphasisFontCategoryNonProportional ">&lt;![CDATA[</span> prefix and the <span class="EmphasisFontCategoryNonProportional ">]]&gt;</span> suffix. You don鈥檛 need to specify predefined character entity references within a CDATA section, as demonstrated in Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC4">1-4</a></span>.<div class="ProgramCode" id="PC4"><div class="LineGroup"><div class="FixedLine">&lt;?xml version=&quot;1.0&quot;?&gt;</div><div class="FixedLine">&lt;svg-examples&gt;</div><div class="FixedLine">   &lt;example&gt;</div><div class="FixedLine">      The following Scalable Vector Graphics document</div><div class="FixedLine">      describes a blue-filled and black-stroked</div><div class="FixedLine">      rectangle.</div><div class="FixedLine">      &lt;![CDATA[&lt;svg width=&quot;100%&quot; height=&quot;100%&quot;</div><div class="FixedLine">           version=&quot;1.1&quot;</div><div class="FixedLine">           xmlns:=&quot;http://www.w3.org/2000/svg&quot;&gt;</div><div class="FixedLine">         &lt;rect width=&quot;300&quot; height=&quot;100&quot;</div><div class="FixedLine">               style=&quot;fill:rgb(0,0,255);stroke-width:1;</div><div class="FixedLine">                      stroke:rgb(0,0,0)&quot;/&gt;</div><div class="FixedLine">      &lt;/svg&gt;]]&gt;</div><div class="FixedLine">   &lt;/example&gt;</div><div class="FixedLine">&lt;/svg-examples&gt;</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 1-4</span><p class="SimplePara">Embedding an XML Document in Another Document鈥檚 CDATA Section</p></div></div></div></div><p class="Para" id="Par32">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC4">1-4</a></span> embeds<span id="ITerm17">
                  
                  
                </span> a <span id="ITerm18">Scalable Vector Graphics (SVG)</span> [see <span class="ExternalRef"><a href="http://en.wikipedia.org/wiki/Scalable_Vector_Graphics"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://en.wikipedia.org/wiki/Scalable_Vector_Graphics</span>
                  </span></a></span>] XML document within the <span class="EmphasisFontCategoryNonProportional ">example</span> element of an SVG examples document. The SVG document is placed in a <span class="EmphasisFontCategoryNonProportional ">CDATA</span> section, obviating the need to replace all <span class="EmphasisFontCategoryNonProportional ">&lt;</span> characters with <span class="EmphasisFontCategoryNonProportional ">&lt;</span> predefined character entity references.</p></section><section class="Section2 RenderAsSection2" id="Sec6"><h3 class="Heading">Namespaces</h3><p class="Para" id="Par33">It鈥檚 common to create XML documents that combine features from different XML languages. <span id="ITerm19">Namespaces</span> are used to prevent name conflicts when elements and other XML language features appear. Without namespaces, an XML parser couldn鈥檛 distinguish between same-named elements or other language features that mean different things, for example, two same-named <span class="EmphasisFontCategoryNonProportional ">title</span> elements from two different languages.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar7"><h3 class="Heading">Note</h3><p class="Para" id="Par34">Namespaces aren鈥檛 part of XML 1.0. They arrived about a year after this specification was released. To ensure backward compatibility with XML 1.0, namespaces take advantage of colon characters, which are legal characters in XML names. Parsers that don鈥檛 recognize namespaces return names that include colons.</p></div><p class="Para" id="Par35">A <em class="EmphasisTypeItalic ">namespace</em><span id="ITerm20">
                  
                  
                  
                </span> is a Uniform Resource <span id="ITerm21">Identifier</span> (URI)-based container that helps differentiate XML vocabularies by providing a unique context for its contained identifiers. The namespace URI is associated with a <em class="EmphasisTypeItalic ">namespace prefix</em> (an alias for the URI) by specifying, typically on an XML document鈥檚 root element, either the <span class="EmphasisFontCategoryNonProportional ">xmlns</span> attribute by itself (which signifies the default namespace) or the <span class="EmphasisFontCategoryNonProportional ">xmlns:</span><em class="EmphasisTypeItalic ">prefix</em> attribute (which signifies the namespace identified as <em class="EmphasisTypeItalic ">prefix</em>), and assigning the URI to this attribute.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar8"><h3 class="Heading">Note</h3><p class="Para" id="Par36">A namespace鈥檚 scope starts at the element where it鈥檚 declared and applies to all of the element鈥檚 content unless overridden by another namespace declaration with the same prefix name.</p></div><div class="Para" id="Par37">When <em class="EmphasisTypeItalic ">prefix</em> is specified, the <span id="ITerm22">prefix</span> and a colon character are prepended to the name of each element tag that belongs to that namespace鈥攕ee Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC5">1-5</a></span>.<div class="ProgramCode" id="PC5"><div class="LineGroup"><div class="FixedLine">&lt;?xml version=&quot;1.0&quot;?&gt;</div><div class="FixedLine">&lt;h:html xmlns:h=&quot;http://www.w3.org/1999/xhtml&quot;</div><div class="FixedLine">        xmlns:r=&quot;http://www.javajeff.ca/&quot;&gt;</div><div class="FixedLine">   &lt;h:head&gt;</div><div class="FixedLine">      &lt;h:title&gt;</div><div class="FixedLine">         Recipe</div><div class="FixedLine">      &lt;/h:title&gt;</div><div class="FixedLine">   &lt;/h:head&gt;</div><div class="FixedLine">   &lt;h:body&gt;</div><div class="FixedLine">   &lt;r:recipe&gt;</div><div class="FixedLine">      &lt;r:title&gt;</div><div class="FixedLine">         Grilled Cheese Sandwich</div><div class="FixedLine">      &lt;/r:title&gt;</div><div class="FixedLine">      &lt;r:ingredients&gt;</div><div class="FixedLine">         &lt;h:ul&gt;</div><div class="FixedLine">         &lt;h:li&gt;</div><div class="FixedLine">         &lt;r:ingredient qty=&quot;2&quot;&gt;</div><div class="FixedLine">            bread slice</div><div class="FixedLine">         &lt;/r:ingredient&gt;</div><div class="FixedLine">         &lt;/h:li&gt;</div><div class="FixedLine">         &lt;h:li&gt;</div><div class="FixedLine">         &lt;r:ingredient&gt;</div><div class="FixedLine">            cheese slice</div><div class="FixedLine">         &lt;/r:ingredient&gt;</div><div class="FixedLine">         &lt;/h:li&gt;</div><div class="FixedLine">         &lt;h:li&gt;</div><div class="FixedLine">         &lt;r:ingredient qty=&quot;2&quot;&gt;</div><div class="FixedLine">            margarine pat</div><div class="FixedLine">         &lt;/r:ingredient&gt;</div><div class="FixedLine">         &lt;/h:li&gt;</div><div class="FixedLine">         &lt;/h:ul&gt;</div><div class="FixedLine">      &lt;/r:ingredients&gt;</div><div class="FixedLine">      &lt;h:p&gt;</div><div class="FixedLine">      &lt;r:instructions&gt;</div><div class="FixedLine">         Place frying pan on element and select medium</div><div class="FixedLine">         heat. For each bread slice, smear one pat of</div><div class="FixedLine">         margarine on one side of bread slice. Place</div><div class="FixedLine">         cheese slice between bread slices with</div><div class="FixedLine">         margarine-smeared sides away from the cheese.</div><div class="FixedLine">         Place sandwich in frying pan with one</div><div class="FixedLine">         margarine-smeared side in contact with pan.</div><div class="FixedLine">         Fry for a couple of minutes and flip. Fry</div><div class="FixedLine">         other side for a minute and serve.</div><div class="FixedLine">      &lt;/r:instructions&gt;</div><div class="FixedLine">      &lt;/h:p&gt;</div><div class="FixedLine">   &lt;/r:recipe&gt;</div><div class="FixedLine">   &lt;/h:body&gt;</div><div class="FixedLine">&lt;/h:html&gt;</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 1-5</span><p class="SimplePara">Introducing a Pair of Namespaces</p></div></div></div></div><p class="Para" id="Par38">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC5">1-5</a></span> describes a document that combines elements from the <span id="ITerm23">XHTML</span> (see <span class="ExternalRef"><a href="http://en.wikipedia.org/wiki/XHTML"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://en.wikipedia.org/wiki/XHTML</span>
                  </span></a></span>) language with elements from the recipe language. All element tags that associate with XHTML are prefixed with <span class="EmphasisFontCategoryNonProportional ">h:,</span> and all element tags that associate with the recipe language are prefixed with <span class="EmphasisFontCategoryNonProportional ">r:</span>.</p><p class="Para" id="Par39">The <span class="EmphasisFontCategoryNonProportional ">h:</span> prefix associates with the <span class="ExternalRef"><a href="http://www.w3.org/1999/xhtml"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">www.w3.org/1999/xhtml</span>
                  </span></a></span> URI, and the <span class="EmphasisFontCategoryNonProportional ">r:</span> prefix associates with the <span class="ExternalRef"><a href="http://www.javajeff.ca/"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">www.javajeff.ca</span>
                  </span></a></span> URI. XML doesn鈥檛 mandate that URIs point to document files. It only requires that they be unique to guarantee unique namespaces.</p><div class="Para" id="Par40">This document鈥檚 separation of the recipe data from the XHTML elements makes it possible to preserve this data鈥檚 structure while also allowing an XHTML-compliant web browser (such as Mozilla Firefox) to present the recipe via a web page (see Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#Fig2">1-2</a></span>).<figure class="Figure" id="Fig2"><div class="MediaObject" id="MO2"><img alt="../images/394211_2_En_1_Chapter/394211_2_En_1_Fig2_HTML.jpg" data-mfp-src="/library/view/java-xml-and/9781484243305/images/394211_2_En_1_Chapter/394211_2_En_1_Fig2_HTML.jpg" height="940" src="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/images/394211_2_En_1_Chapter/394211_2_En_1_Fig2_HTML.jpg" style="height:23.5em" width="1725"/></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 1-2</span><p class="SimplePara">Mozilla Firefox presents the recipe data via XHTML tags</p></div></figcaption></figure></div><div class="Para" id="Par41">A tag鈥檚 <span id="ITerm24">attributes</span> don鈥檛 need to be prefixed when those attributes belong to the element. For example, <span class="EmphasisFontCategoryNonProportional ">qty</span> isn鈥檛 prefixed in <span class="EmphasisFontCategoryNonProportional ">&lt;r:ingredient qty=&quot;2&quot;&gt;</span>. However, a prefix is required for attributes belonging to other namespaces. For example, suppose you want to add an XHTML <span class="EmphasisFontCategoryNonProportional ">style</span> attribute to the document鈥檚 <span class="EmphasisFontCategoryNonProportional ">&lt;r:title&gt;</span> tag to provide styling for the recipe title when displayed via an application. You can accomplish this task by inserting an XHTML attribute into the <span class="EmphasisFontCategoryNonProportional ">title</span> tag, as follows:<div class="ProgramCode" id="PC6"><div class="LineGroup"><div class="FixedLine">&lt;r:title h:style=&quot;font-family: sans-serif;&quot;&gt;</div></div></div></div><p class="Para" id="Par42">The XHTML <span class="EmphasisFontCategoryNonProportional ">style</span> attribute has been prefixed with <span class="EmphasisFontCategoryNonProportional ">h:</span> because this attribute belongs to the XHTML language namespace and not to the recipe language namespace.</p><div class="Para" id="Par43">When multiple namespaces are involved, it can be convenient to specify one of these namespaces as the default namespace to reduce the tedium in entering namespace prefixes. Consider Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC7">1-6</a></span>.<div class="ProgramCode" id="PC7"><div class="LineGroup"><div class="FixedLine">&lt;?xml version=&quot;1.0&quot;?&gt;</div><div class="FixedLine">&lt;html xmlns:=&quot;http://www.w3.org/1999/xhtml&quot;</div><div class="FixedLine">      xmlns:r=&quot;http://www.javajeff.ca/&quot;&gt;</div><div class="FixedLine">   &lt;head&gt;</div><div class="FixedLine">      &lt;title&gt;</div><div class="FixedLine">         Recipe</div><div class="FixedLine">      &lt;/title&gt;</div><div class="FixedLine">   &lt;/head&gt;</div><div class="FixedLine">   &lt;body&gt;</div><div class="FixedLine">   &lt;r:recipe&gt;</div><div class="FixedLine">      &lt;r:title&gt;</div><div class="FixedLine">         Grilled Cheese Sandwich</div><div class="FixedLine">      &lt;/r:title&gt;</div><div class="FixedLine">      &lt;r:ingredients&gt;</div><div class="FixedLine">         &lt;ul&gt;</div><div class="FixedLine">         &lt;li&gt;</div><div class="FixedLine">         &lt;r:ingredient qty=&quot;2&quot;&gt;</div><div class="FixedLine">            bread slice</div><div class="FixedLine">         &lt;/r:ingredient&gt;</div><div class="FixedLine">         &lt;/li&gt;</div><div class="FixedLine">         &lt;li&gt;</div><div class="FixedLine">         &lt;r:ingredient&gt;</div><div class="FixedLine">            cheese slice</div><div class="FixedLine">         &lt;/r:ingredient&gt;</div><div class="FixedLine">         &lt;/li&gt;</div><div class="FixedLine">         &lt;li&gt;</div><div class="FixedLine">         &lt;r:ingredient qty=&quot;2&quot;&gt;</div><div class="FixedLine">            margarine pat</div><div class="FixedLine">         &lt;/r:ingredient&gt;</div><div class="FixedLine">         &lt;/li&gt;</div><div class="FixedLine">         &lt;/ul&gt;</div><div class="FixedLine">      &lt;/r:ingredients&gt;</div><div class="FixedLine">      &lt;p&gt;</div><div class="FixedLine">      &lt;r:instructions&gt;</div><div class="FixedLine">         Place frying pan on element and select medium</div><div class="FixedLine">         heat. For each bread slice, smear one pat of</div><div class="FixedLine">         margarine on one side of bread slice. Place<span id="ITerm25">
                        
                        
                        
                      </span></div><div class="FixedLine">         cheese slice between bread slices with</div><div class="FixedLine">         margarine-smeared sides away from the cheese.</div><div class="FixedLine">         Place sandwich in frying pan with one</div><div class="FixedLine">         margarine-smeared side in contact with pan.</div><div class="FixedLine">         Fry for a couple of minutes and flip. Fry</div><div class="FixedLine">         other side for a minute and serve.</div><div class="FixedLine">      &lt;/r:instructions&gt;</div><div class="FixedLine">      &lt;/p&gt;</div><div class="FixedLine">   &lt;/r:recipe&gt;</div><div class="FixedLine">   &lt;/body&gt;</div><div class="FixedLine">&lt;/html&gt;</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 1-6</span><p class="SimplePara">Specifying a Default <span id="ITerm26">Namespace</span></p></div></div></div></div><p class="Para" id="Par44">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC7">1-6</a></span> specifies a default <span id="ITerm27">namespace</span> for the XHTML language. No XHTML element tag needs to be prefixed with <span class="EmphasisFontCategoryNonProportional ">h:</span>. However, recipe language element tags must still be prefixed with the <span class="EmphasisFontCategoryNonProportional ">r:</span> prefix.</p></section><section class="Section2 RenderAsSection2" id="Sec7"><h3 class="Heading">Comments and Processing Instructions</h3><p class="Para" id="Par45">XML documents can contain <em class="EmphasisTypeItalic ">comments</em>, which are character <span id="ITerm28">sequences</span> beginning with <span class="EmphasisFontCategoryNonProportional ">&lt;!--</span> and ending with <span class="EmphasisFontCategoryNonProportional ">--&gt;</span>. For example, you might place <span class="EmphasisFontCategoryNonProportional ">&lt;!-- Todo --&gt;</span> in Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC3">1-3</a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">body</span> element to remind yourself that you need to finish coding this element.</p><p class="Para" id="Par46">Comments are used to clarify portions of a document. They can appear anywhere after the XML declaration except within tags, cannot be nested, cannot contain a double hyphen (<span class="EmphasisFontCategoryNonProportional ">--</span>) because doing so might confuse an XML parser that the comment has been closed, shouldn鈥檛 contain a hyphen (<span class="EmphasisFontCategoryNonProportional ">-</span>) for the same reason, and are typically ignored during processing. Comments are not content.</p><p class="Para" id="Par47">XML also permits <span id="ITerm29">processing instructions</span> to be present. A <em class="EmphasisTypeItalic ">processing instruction</em> is an instruction that鈥檚 made available to the application parsing the document. The instruction begins with <span class="EmphasisFontCategoryNonProportional ">&lt;?</span> and ends with <span class="EmphasisFontCategoryNonProportional ">?&gt;</span>. The <span class="EmphasisFontCategoryNonProportional ">&lt;?</span> prefix is followed by a name known as the <em class="EmphasisTypeItalic ">target</em>. This name typically identifies the application to which the processing instruction is intended. The rest of the processing instruction contains text in a format appropriate to the application. Two examples of processing instructions are <span class="EmphasisFontCategoryNonProportional ">&lt;?xml-stylesheet href=&quot;modern.xsl&quot; type=&quot;text/xml&quot;?&gt;</span> (associate an eXtensible Stylesheet Language [XSL] [see <span class="ExternalRef"><a href="http://en.wikipedia.org/wiki/XSL"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://en.wikipedia.org/wiki/XSL</span>
                  </span></a></span>] stylesheet with an XML document) and <span class="EmphasisFontCategoryNonProportional ">&lt;?php /* PHP code */ ?&gt;</span> (pass a PHP [see <span class="ExternalRef"><a href="http://en.wikipedia.org/wiki/PHP"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://en.wikipedia.org/wiki/PHP</span>
                  </span></a></span>] code fragment to the application). Although the XML <span id="ITerm30">declaration</span> looks like a processing instruction, this isn鈥檛 the case.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar9"><h3 class="Heading">Note</h3><p class="Para" id="Par48">The XML declaration isn鈥檛 a processing instruction.</p></div></section></section><section class="Section1 RenderAsSection1" id="Sec8"><h2 class="Heading">Well-Formed Documents</h2><div class="Para" id="Par49">HTML is a sloppy language in which elements can be specified out of order, end tags can be omitted, and so on. The complexity of a web browser鈥檚 page layout code is partly due to the need to handle these special cases. In contrast, XML is a much stricter language. To make XML documents easier to parse, XML mandates that XML documents follow certain rules:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par50"><em class="EmphasisTypeItalic ">All elements must either have start and end tags or consist of empty-element tags.</em> For example, unlike the HTML <span class="EmphasisFontCategoryNonProportional ">&lt;p&gt;</span> tag that鈥檚 often specified without a <span class="EmphasisFontCategoryNonProportional ">&lt;/p&gt;</span> counterpart, <span class="EmphasisFontCategoryNonProportional ">&lt;/p&gt;</span> must also be present from an XML document perspective.</p></li><li><p class="Para" id="Par51"><em class="EmphasisTypeItalic ">Tags must be nested correctly.</em> For example, while you鈥檒l probably get away with specifying <span class="EmphasisFontCategoryNonProportional ">&lt;b&gt;&lt;i&gt;XML&lt;/b&gt;&lt;/i&gt;</span> in HTML, an XML parser would report an error. In contrast, <span class="EmphasisFontCategoryNonProportional ">&lt;b&gt;&lt;i&gt;XML&lt;/i&gt;&lt;/b&gt;</span> doesn鈥檛 result in an error, because the nested tag pairs mirror each other.</p></li><li><p class="Para" id="Par52"><em class="EmphasisTypeItalic ">All attribute values must be quoted.</em> Either single quotes (<span class="EmphasisFontCategoryNonProportional ">&apos;</span>) or double quotes (<span class="EmphasisFontCategoryNonProportional ">&quot;</span>) are permissible (although double quotes are the more commonly specified quotes). It鈥檚 an error to omit these quotes.</p></li><li><p class="Para" id="Par53"><em class="EmphasisTypeItalic ">Empty elements must be properly formatted.</em> For example, HTML鈥檚 <span class="EmphasisFontCategoryNonProportional ">&lt;br&gt;</span> tag would have to be specified as <span class="EmphasisFontCategoryNonProportional ">&lt;br/&gt;</span> in XML. You can specify a space between the tag鈥檚 name and the <span class="EmphasisFontCategoryNonProportional ">/</span> character although the space is optional.</p></li><li><p class="Para" id="Par54"><em class="EmphasisTypeItalic ">Be careful with case.</em> XML is a <strong class="EmphasisTypeBold ">case-sensitive</strong> language in which tags differing in case (such as <span class="EmphasisFontCategoryNonProportional ">394211_2_En</span> and <span class="EmphasisFontCategoryNonProportional ">394211_2_En</span>) are considered different. It鈥檚 an error to mix start and end tags of different cases, for example, <span class="EmphasisFontCategoryNonProportional ">394211_2_En</span> with <span class="EmphasisFontCategoryNonProportional ">&lt;/Author&gt;</span>.</p></li></ul></div></div><div class="Para" id="Par55">XML parsers that are aware of namespaces enforce two additional rules:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par56">Each element and attribute name must not include more than one colon character.</p></li><li><p class="Para" id="Par57">No entity names, processing instruction targets, or notation names (discussed later) can contain colons.</p></li></ul></div></div><p class="Para" id="Par58">An XML document that conforms to these rules is <em class="EmphasisTypeItalic ">well formed</em>. The document has a logical and clean appearance and is much easier to process. XML parsers will only parse well-formed XML documents.</p></section><section class="Section1 RenderAsSection1" id="Sec9"><h2 class="Heading">Valid Documents</h2><p class="Para" id="Par59">It鈥檚 not always enough for an XML document to be well formed; in many cases the document must also be valid. A <em class="EmphasisTypeItalic ">valid</em><span id="ITerm31">document</span> adheres to constraints. For example, a constraint could be placed upon Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC1">1-1</a></span>鈥檚 recipe document to ensure that the <span class="EmphasisFontCategoryNonProportional ">ingredients</span> element always precedes the <span class="EmphasisFontCategoryNonProportional ">instructions</span> element; perhaps an application must first process <span class="EmphasisFontCategoryNonProportional ">ingredients</span>.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar10"><h3 class="Heading">Note</h3><p class="Para" id="Par60">XML document validation is similar to a compiler analyzing source code to make sure that the code makes sense in a machine context. For example, each of <span class="EmphasisFontCategoryNonProportional ">int</span>, <span class="EmphasisFontCategoryNonProportional ">count</span>, <span class="EmphasisFontCategoryNonProportional ">=</span>, <span class="EmphasisFontCategoryNonProportional ">1</span>, and <span class="EmphasisFontCategoryNonProportional ">;</span> is a valid Java character sequence, but <span class="EmphasisFontCategoryNonProportional ">1 count ; int =</span> isn鈥檛 a valid Java construct (whereas <span class="EmphasisFontCategoryNonProportional ">int count = 1;</span> is a valid Java construct).</p></div><p class="Para" id="Par61">Some XML parsers perform validation, whereas other parsers don鈥檛 because validating parsers are harder to write. A parser that performs validation compares an XML document to a <em class="EmphasisTypeItalic ">grammar document</em>. Any deviation from the grammar document is reported as an error to the application鈥攖he XML <span id="ITerm32">document</span> isn鈥檛 valid. The application may choose to fix the error or reject the XML document. Unlike well-formedness errors, validity errors aren鈥檛 necessarily fatal and the parser can continue to parse the XML document.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar11"><h3 class="Heading">Note</h3><p class="Para" id="Par62">Validating XML parsers often don鈥檛 validate by default because validation can be time consuming. They must be instructed to perform validation.</p></div><p class="Para" id="Par63">Grammar documents are written in a special language. Two commonly used grammar languages are Document Type Definition and XML Schema.</p><section class="Section2 RenderAsSection2" id="Sec10"><h3 class="Heading">Document Type Definition</h3><p class="Para" id="Par64"><em class="EmphasisTypeItalic ">Document Type Definition</em> (<em class="EmphasisTypeItalic ">DTD</em>)<span id="ITerm33">
                  
                </span> is the oldest grammar language for specifying an XML document鈥檚 <em class="EmphasisTypeItalic ">grammar</em>. DTD grammar documents (known as DTDs) are written in accordance to a strict syntax that states what elements may be present and in what parts of a document, and also what is contained within elements (child elements, content, or mixed content) and what attributes may be specified. For example, a DTD may specify that a <span class="EmphasisFontCategoryNonProportional ">recipe</span> element must have an <span class="EmphasisFontCategoryNonProportional ">ingredients</span> element followed by an <span class="EmphasisFontCategoryNonProportional ">instructions</span> element.</p><div class="Para" id="Par65">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC8">1-7</a></span> presents a DTD for the recipe language that was used to construct Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC1">1-1</a></span>鈥檚 document.<div class="ProgramCode" id="PC8"><div class="LineGroup"><div class="FixedLine">&lt;!ELEMENT recipe (title, ingredients, instructions)&gt;</div><div class="FixedLine">&lt;!ELEMENT title (#PCDATA)&gt;</div><div class="FixedLine">&lt;!ELEMENT ingredients (ingredient+)&gt;</div><div class="FixedLine">&lt;!ELEMENT ingredient (#PCDATA)&gt;</div><div class="FixedLine">&lt;!ELEMENT instructions (#PCDATA)&gt;</div><div class="FixedLine">&lt;!ATTLIST ingredient qty CDATA &quot;1&quot;&gt;</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 1-7</span><p class="SimplePara">The <span id="ITerm34">Recipe Language鈥檚</span> DTD</p></div></div></div></div><p class="Para" id="Par66">This DTD first declares the recipe language鈥檚 elements. Element declarations take the form <span class="EmphasisFontCategoryNonProportional ">&lt;!ELEMENT</span>
<em class="EmphasisTypeItalic ">name content-specifier</em><span class="EmphasisFontCategoryNonProportional ">&gt;</span>, where <em class="EmphasisTypeItalic ">name</em> is any legal XML name (e.g., it cannot contain whitespace), and <em class="EmphasisTypeItalic ">content-specifier</em> identifies what can appear within the element.</p><p class="Para" id="Par67">The first element declaration states that exactly one <span class="EmphasisFontCategoryNonProportional ">recipe</span> element can appear in the XML document鈥攖his declaration doesn鈥檛 imply that <span class="EmphasisFontCategoryNonProportional ">recipe</span> is the root element. Furthermore, this element must include exactly one each of the <span class="EmphasisFontCategoryNonProportional ">title</span>, <span class="EmphasisFontCategoryNonProportional ">ingredients</span>, and <span class="EmphasisFontCategoryNonProportional ">instructions</span> child elements, and in that order. Child elements must be specified as a comma-separated list. Furthermore, a list is always surrounded by parentheses.</p><p class="Para" id="Par68">The second element declaration states that the <span class="EmphasisFontCategoryNonProportional ">title</span> element contains <em class="EmphasisTypeItalic ">parsed character data</em> (nonmarkup text). The third element declaration states that at least one <span class="EmphasisFontCategoryNonProportional ">ingredient</span> element must appear in <span class="EmphasisFontCategoryNonProportional ">ingredients</span>. The <span class="EmphasisFontCategoryNonProportional ">+</span> character is an example of a regular expression that means one or more. Other expressions that may be used are <span class="EmphasisFontCategoryNonProportional ">*</span> (zero or more) and <span class="EmphasisFontCategoryNonProportional ">?</span> (once or not at all). The fourth and fifth element declarations are similar to the second by stating that <span class="EmphasisFontCategoryNonProportional ">ingredient</span> and <span class="EmphasisFontCategoryNonProportional ">instructions</span> elements contain parsed character data.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar12"><h3 class="Heading">Note</h3><p class="Para" id="Par69">Element declarations support three other content specifiers. You can specify <span class="EmphasisFontCategoryNonProportional ">&lt;!ELEMENT</span>
<em class="EmphasisTypeItalic ">name</em>
<span class="EmphasisFontCategoryNonProportional ">ANY&gt;</span> to allow any type of element content or <span class="EmphasisFontCategoryNonProportional ">&lt;!ELEMENT</span>
<em class="EmphasisTypeItalic ">name</em>
<span class="EmphasisFontCategoryNonProportional ">EMPTY&gt;</span> to disallow any element content. To state that an element contains mixed content, you would specify <span class="EmphasisFontCategoryNonProportional ">#PCDATA</span> and a list of element names, separated by vertical bars (<span class="EmphasisFontCategoryNonProportional ">|</span>). For example, <span class="EmphasisFontCategoryNonProportional ">&lt;!ELEMENT ingredient (#PCDATA | measure | note)*&gt;</span> states that the <span class="EmphasisFontCategoryNonProportional ">ingredient</span> element can contain a mix of parsed character data, zero or more <span class="EmphasisFontCategoryNonProportional ">measure</span> elements, and zero or more <span class="EmphasisFontCategoryNonProportional ">note</span> elements. It doesn鈥檛 specify the order in which the parsed character data and these elements occur. However, <span class="EmphasisFontCategoryNonProportional ">#PCDATA</span> must be the first item specified in the list. When a regular expression is used in this context, it must appear to the right of the closing parenthesis.</p></div><p class="Para" id="Par70">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC8">1-7</a></span>鈥檚 DTD lastly declares the recipe language鈥檚 attributes, of which there is only one: <span class="EmphasisFontCategoryNonProportional ">qty</span>. <span id="ITerm35">Attribute declarations</span> take the form <span class="EmphasisFontCategoryNonProportional ">&lt;!ATTLIST</span>
<em class="EmphasisTypeItalic ">ename aname type default-value</em><span class="EmphasisFontCategoryNonProportional ">&gt;</span>, where <em class="EmphasisTypeItalic ">ename</em> is the name of the element to which the attribute belongs, <em class="EmphasisTypeItalic ">aname</em> is the name of the attribute, <em class="EmphasisTypeItalic ">type</em> is the attribute鈥檚 type, and <em class="EmphasisTypeItalic ">default-value</em> is the attribute鈥檚 default value.</p><p class="Para" id="Par71">The attribute declaration identifies <span class="EmphasisFontCategoryNonProportional ">qty</span> as an attribute of <span class="EmphasisFontCategoryNonProportional ">ingredient</span>. It also states that <span class="EmphasisFontCategoryNonProportional ">qty</span>鈥檚 type is <span class="EmphasisFontCategoryNonProportional ">CDATA</span> (any string of characters not including the ampersand, less than or greater than signs, or double quotes may appear; these characters may be represented via <span class="EmphasisFontCategoryNonProportional ">&amp;</span>, <span class="EmphasisFontCategoryNonProportional ">&lt;</span>, <span class="EmphasisFontCategoryNonProportional ">&gt;</span>, and <span class="EmphasisFontCategoryNonProportional ">&amp;quot;</span>, respectively) and that <span class="EmphasisFontCategoryNonProportional ">qty</span> is optional, assuming default value <span class="EmphasisFontCategoryNonProportional ">1</span> when absent.</p><div class="FormalPara FormalParaRenderingStyle3 ParaTypeOverview" id="FPar13"><h3 class="Heading">More About Attributes</h3><p class="Para" id="Par72">DTD lets you specify additional attribute types: <span class="EmphasisFontCategoryNonProportional ">ID</span> (create a unique identifier for an attribute that identifies an element), <span class="EmphasisFontCategoryNonProportional ">IDREF</span> (an attribute鈥檚 value is an element located elsewhere in the document), <span class="EmphasisFontCategoryNonProportional ">IDREFS</span> (the value consists of multiple <span class="EmphasisFontCategoryNonProportional ">IDREF</span>s), <span class="EmphasisFontCategoryNonProportional ">ENTITY</span> (you can use external binary data or unparsed entities), <span class="EmphasisFontCategoryNonProportional ">ENTITIES</span> (the value consists of multiple entities), <span class="EmphasisFontCategoryNonProportional ">NMTOKEN</span> (the value is restricted to any valid XML name), <span class="EmphasisFontCategoryNonProportional ">NMTOKENS</span> (the value is composed of multiple XML names), <span class="EmphasisFontCategoryNonProportional ">NOTATION</span> (the value is already specified via a DTD notation declaration), and enumerated (a list of possible values to choose from; values are separated with vertical bars).</p><p class="Para" id="Par73">Instead of specifying a default value verbatim, you can specify <span class="EmphasisFontCategoryNonProportional ">#REQUIRED</span> to mean that the attribute must always be present with some value <span class="EmphasisFontCategoryNonProportional ">(&lt;!ATTLIST</span>
<em class="EmphasisTypeItalic ">ename aname type</em>
<span class="EmphasisFontCategoryNonProportional ">#REQUIRED&gt;</span>), <span class="EmphasisFontCategoryNonProportional ">#IMPLIED</span> to mean that the attribute is optional and no default value is provided (<span class="EmphasisFontCategoryNonProportional ">&lt;!ATTLIST</span>
<em class="EmphasisTypeItalic ">ename aname type</em>
<span class="EmphasisFontCategoryNonProportional ">#IMPLIED&gt;</span>), or <span class="EmphasisFontCategoryNonProportional ">#FIXED</span> to mean that the attribute is optional and must always take on the DTD-assigned default value when used (<span class="EmphasisFontCategoryNonProportional ">&lt;!ATTLIST</span>
<em class="EmphasisTypeItalic ">ename aname type</em>
<span class="EmphasisFontCategoryNonProportional ">#FIXED &quot;value&quot;&gt;</span>).</p><p class="Para" id="Par74">You can specify a list of attributes in one <span class="EmphasisFontCategoryNonProportional ">ATTLIST</span> declaration. For example, <span class="EmphasisFontCategoryNonProportional ">&lt;!ATTLIST</span>
<em class="EmphasisTypeItalic ">ename aname1 type1 default-value1 aname2 type2 default-value2</em><span class="EmphasisFontCategoryNonProportional ">&gt;</span> declares two attributes identified as <em class="EmphasisTypeItalic ">aname1</em> and <em class="EmphasisTypeItalic ">aname2</em>.</p></div><p class="Para" id="Par75">A DTD-based validating XML parser requires that a document include a <em class="EmphasisTypeItalic ">document type declaration</em> identifying the DTD that specifies the document鈥檚 grammar before it will validate the document.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar14"><h3 class="Heading">Note</h3><p class="Para" id="Par76">Document Type Definition and document type declaration are two different things. The DTD acronym identifies a Document Type Definition and never identifies a document type declaration.</p></div><div class="Para" id="Par77">A <span id="ITerm36">document type declaration</span> appears immediately after the XML declaration and is specified in one of the following ways:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par78"><span class="EmphasisFontCategoryNonProportional ">&lt;!DOCTYPE</span>
<em class="EmphasisTypeItalic ">root-element-name</em>
<span class="EmphasisFontCategoryNonProportional ">SYSTEM</span>
<em class="EmphasisTypeItalic ">uri</em><span class="EmphasisFontCategoryNonProportional ">&gt;</span> references an external but private DTD via <em class="EmphasisTypeItalic ">uri</em>. The referenced DTD isn鈥檛 available for public scrutiny. For example, I might store my recipe language鈥檚 DTD file (<span class="EmphasisFontCategoryNonProportional ">recipe.dtd</span>) in a private <span class="EmphasisFontCategoryNonProportional ">dtds</span> directory on my <span class="ExternalRef"><a href="http://www.javajeff.ca/"><span class="RefSource">
                          <span class="EmphasisFontCategoryNonProportional ">www.javajeff.ca</span>
                        </span></a></span> website, and use <span class="EmphasisFontCategoryNonProportional ">&lt;!DOCTYPE recipe SYSTEM &quot;</span><span class="ExternalRef"><a href="http://www.javajeff.ca/dtds/recipe.dtd"><span class="RefSource">
                          <span class="EmphasisFontCategoryNonProportional ">http://www.javajeff.ca/dtds/recipe.dtd</span>
                        </span></a></span><span class="EmphasisFontCategoryNonProportional ">&quot;&gt;</span> to identify this DTD鈥檚 location via <em class="EmphasisTypeItalic ">system identifier</em>
<span class="ExternalRef"><a href="http://www.javajeff.ca/dtds/recipe.dtd"><span class="RefSource">
                          <span class="EmphasisFontCategoryNonProportional ">http://www.javajeff.ca/dtds/recipe.dtd</span>
                        </span></a></span>.</p></li><li><p class="Para" id="Par79"><span class="EmphasisFontCategoryNonProportional ">&lt;!DOCTYPE</span>
<em class="EmphasisTypeItalic ">root-element-name</em>
<span class="EmphasisFontCategoryNonProportional ">PUBLIC</span>
<em class="EmphasisTypeItalic ">fpi uri</em><span class="EmphasisFontCategoryNonProportional ">&gt;</span> references an external but public DTD via <em class="EmphasisTypeItalic ">fpi</em>, a <em class="EmphasisTypeItalic ">formal public identifier</em> (see <span class="ExternalRef"><a href="http://en.wikipedia.org/wiki/Formal_Public_Identifier"><span class="RefSource">
                          <span class="EmphasisFontCategoryNonProportional ">http://en.wikipedia.org/wiki/Formal_Public_Identifier</span>
                        </span></a></span>), and <em class="EmphasisTypeItalic ">uri</em>. If a validating XML parser cannot locate the DTD via public identifier <em class="EmphasisTypeItalic ">fpi</em>, it can use system identifier <em class="EmphasisTypeItalic ">uri</em> to locate the DTD. For example, <span class="EmphasisFontCategoryNonProportional ">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;</span><span class="ExternalRef"><a href="http://www.w3.org/TR/xhtml1/DTD/xhtml1-%25c2%25adtransitional.dtd"><span class="RefSource">
                          <span class="EmphasisFontCategoryNonProportional ">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</span>
                        </span></a></span><span class="EmphasisFontCategoryNonProportional ">&quot;&gt;</span> references the XHTML 1.0 DTD first via public identifier <span class="EmphasisFontCategoryNonProportional ">-//W3C//DTD XHTML 1.0 Transitional//EN</span> and second via system identifier <span class="ExternalRef"><a href="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><span class="RefSource">
                          <span class="EmphasisFontCategoryNonProportional ">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</span>
                        </span></a></span>.</p></li><li><p class="Para" id="Par80"><span class="EmphasisFontCategoryNonProportional ">&lt;!DOCTYPE</span>
<em class="EmphasisTypeItalic ">root-element</em>
<span class="EmphasisFontCategoryNonProportional ">[</span>
<em class="EmphasisTypeItalic ">dtd</em>
<span class="EmphasisFontCategoryNonProportional ">]&gt;</span> references an internal DTD, one that is embedded within the XML document. The internal <span id="ITerm37">DTD</span> must appear between square brackets.</p></li></ul></div></div><div class="Para" id="Par81">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC9">1-8</a></span> presents Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC1">1-1</a></span> (minus the child elements between the <span class="EmphasisFontCategoryNonProportional ">&lt;recipe&gt;</span> and <span class="EmphasisFontCategoryNonProportional ">&lt;/recipe&gt;</span> tags) with an internal DTD.<div class="ProgramCode" id="PC9"><div class="LineGroup"><div class="FixedLine">&lt;?xml version=&quot;1.0&quot;?&gt;</div><div class="FixedLine">&lt;!DOCTYPE recipe [</div><div class="FixedLine">   &lt;!ELEMENT recipe (title, ingredients, instructions)&gt;</div><div class="FixedLine">   &lt;!ELEMENT title (#PCDATA)&gt;</div><div class="FixedLine">   &lt;!ELEMENT ingredients (ingredient+)&gt;</div><div class="FixedLine">   &lt;!ELEMENT ingredient (#PCDATA)&gt;</div><div class="FixedLine">   &lt;!ELEMENT instructions (#PCDATA)&gt;</div><div class="FixedLine">   &lt;!ATTLIST ingredient qty CDATA &quot;1&quot;&gt;</div><div class="FixedLine">]&gt;</div><div class="FixedLine">&lt;recipe&gt;</div><div class="FixedLine">   &lt;!-- Child elements removed for brevity. --&gt;<span id="ITerm38">
                        
                        
                      </span></div><div class="FixedLine">&lt;/recipe&gt;</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 1-8</span><p class="SimplePara">The Recipe Document with an Internal <span id="ITerm39">DTD</span></p></div></div></div></div><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar15"><h3 class="Heading">Note</h3><p class="Para" id="Par82">A document can have internal and external DTDs, for example, <span class="EmphasisFontCategoryNonProportional ">&lt;!DOCTYPE recipe SYSTEM &quot;</span><span class="ExternalRef"><a href="http://www.javajeff.ca/dtds/recipe.dtd"><span class="RefSource">
                      <span class="EmphasisFontCategoryNonProportional ">http://www.javajeff.ca/dtds/recipe.dtd</span>
                    </span></a></span><span class="EmphasisFontCategoryNonProportional ">&quot; [ &lt;!ELEMENT ...&gt;]&gt;</span>. The internal DTD is referred to as the <em class="EmphasisTypeItalic ">internal DTD subset</em>, and the external DTD is referred to as the <em class="EmphasisTypeItalic ">external DTD subset</em>. Neither subset can override the element declarations of the other subset.</p></div><p class="Para" id="Par83">You can also declare notations and general and parameter entities within DTDs. A <em class="EmphasisTypeItalic ">notation</em> is an arbitrary piece of data that typically describes the format of unparsed binary data and typically has the form <span class="EmphasisFontCategoryNonProportional ">&lt;!NOTATION</span>
<em class="EmphasisTypeItalic ">name</em>
<span class="EmphasisFontCategoryNonProportional ">SYSTEM</span>
<em class="EmphasisTypeItalic ">uri</em><span class="EmphasisFontCategoryNonProportional ">&gt;</span>, where <em class="EmphasisTypeItalic ">name</em> identifies the notation and <em class="EmphasisTypeItalic ">uri</em> identifies some kind of plugin that can process the data on behalf of the application that鈥檚 parsing the XML document. For example, <span class="EmphasisFontCategoryNonProportional ">&lt;!NOTATION image SYSTEM &quot;psp.exe&quot;&gt;</span> declares a notation named <span class="EmphasisFontCategoryNonProportional ">image</span> and identifies Windows executable <span class="EmphasisFontCategoryNonProportional ">psp.exe</span> as a plugin for processing images.</p><p class="Para" id="Par84">It鈥檚 also common to use <span id="ITerm40">notations</span> to specify binary data types via media types (see <span class="ExternalRef"><a href="http://en.wikipedia.org/wiki/Media_type"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://en.wikipedia.org/wiki/Media_type</span>
                  </span></a></span>). For example, <span class="EmphasisFontCategoryNonProportional ">&lt;!NOTATION image SYSTEM &quot;image/jpeg&quot;&gt;</span> declares an image notation that identifies the <span class="EmphasisFontCategoryNonProportional ">image/jpeg</span> media type for Joint Photographic Experts Group images.</p><p class="Para" id="Par85"><em class="EmphasisTypeItalic ">General entities</em> are entities referenced from inside an XML document via <em class="EmphasisTypeItalic ">general entity references</em>, syntactic constructs of the form <span class="EmphasisFontCategoryNonProportional ">&amp;</span><em class="EmphasisTypeItalic ">name</em><span class="EmphasisFontCategoryNonProportional ">;</span>. Examples include the predefined <span class="EmphasisFontCategoryNonProportional ">lt</span>, <span class="EmphasisFontCategoryNonProportional ">gt</span>, <span class="EmphasisFontCategoryNonProportional ">amp</span>, <span class="EmphasisFontCategoryNonProportional ">apos</span>, and <span class="EmphasisFontCategoryNonProportional ">quot</span> character entities, whose <span class="EmphasisFontCategoryNonProportional ">&lt;</span>, <span class="EmphasisFontCategoryNonProportional ">&gt;</span>, <span class="EmphasisFontCategoryNonProportional ">&amp;</span>, <span class="EmphasisFontCategoryNonProportional ">&amp;apos;</span>, and <span class="EmphasisFontCategoryNonProportional ">&amp;quot;</span> character entity references are aliases for characters <span class="EmphasisFontCategoryNonProportional ">&lt;</span>, <span class="EmphasisFontCategoryNonProportional ">&gt;</span>, <span class="EmphasisFontCategoryNonProportional ">&amp;</span>, <span class="EmphasisFontCategoryNonProportional ">&apos;</span>, and <span class="EmphasisFontCategoryNonProportional ">&quot;</span>, respectively.</p><p class="Para" id="Par86">General entities are classified as internal or external. An <em class="EmphasisTypeItalic ">internal general entity</em> is a general entity whose value is stored in the DTD and has the form <span class="EmphasisFontCategoryNonProportional ">&lt;!ENTITY</span>
<em class="EmphasisTypeItalic ">name value</em><span class="EmphasisFontCategoryNonProportional ">&gt;</span>, where <em class="EmphasisTypeItalic ">name</em> identifies the entity and <em class="EmphasisTypeItalic ">value</em> specifies its value. For example, <span class="EmphasisFontCategoryNonProportional ">&lt;!ENTITY copyright &quot;Copyright &amp;copy; 2019 Jeff Friesen. All rights reserved.&quot;&gt;</span> declares an internal general entity named <span class="EmphasisFontCategoryNonProportional ">copyright</span>. The value of this entity may include another declared entity, such as <span class="EmphasisFontCategoryNonProportional ">&amp;copy;</span> (the HTML entity for the copyright symbol), and can be referenced from anywhere in an XML document by specifying <span class="EmphasisFontCategoryNonProportional ">&amp;copyright;</span>.</p><p class="Para" id="Par87">An <span id="ITerm41">
                  <em class="EmphasisTypeItalic ">external general entity</em>
                  
                  
                </span> is a general entity whose value is stored outside the DTD. The value might be textual data (such as an XML document), or it might be binary data (such as a JPEG image). External general entities are classified as external parsed general entity and external unparsed general entity.</p><p class="Para" id="Par88">An <em class="EmphasisTypeItalic ">external parsed general entity</em>
<span id="ITerm42">references</span> an external file that stores the entity鈥檚 textual data, which is subject to being inserted into a document and parsed by a validating parser when a general entity reference is specified in the document, and which has the form <span class="EmphasisFontCategoryNonProportional ">&lt;!ENTITY</span>
<em class="EmphasisTypeItalic ">name</em>
<span class="EmphasisFontCategoryNonProportional ">SYSTEM</span>
<em class="EmphasisTypeItalic ">uri</em><span class="EmphasisFontCategoryNonProportional ">&gt;</span>, where <em class="EmphasisTypeItalic ">name</em> identifies the entity and <em class="EmphasisTypeItalic ">uri</em> identifies the external file. For example, <span class="EmphasisFontCategoryNonProportional ">&lt;!ENTITY chapter-header SYSTEM &quot;</span><span class="ExternalRef"><a href="http://www.javajeff.ca/entities/chapheader.xml"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://www.javajeff.ca/entities/chapheader.xml</span>
                  </span></a></span><span class="EmphasisFontCategoryNonProportional ">&quot;&gt;</span> identifies <span class="EmphasisFontCategoryNonProportional ">chapheader.xml</span> as storing the XML content to be inserted into an XML document wherever <span class="EmphasisFontCategoryNonProportional ">&amp;chapter-header;</span> appears in the document. The alternative <span class="EmphasisFontCategoryNonProportional ">&lt;!ENTITY</span>
<em class="EmphasisTypeItalic ">name</em>
<span class="EmphasisFontCategoryNonProportional ">PUBLIC</span>
<em class="EmphasisTypeItalic ">fpi uri</em><span class="EmphasisFontCategoryNonProportional ">&gt;</span> form can be specified.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar16"><h3 class="Heading">Caution</h3><p class="Para" id="Par89">Because the contents of an external file may be parsed, this content must be well formed.</p></div><p class="Para" id="Par90">An <em class="EmphasisTypeItalic ">external unparsed general entity</em>
<span id="ITerm43">references</span> an external file that stores the entity鈥檚 binary data and has the form <span class="EmphasisFontCategoryNonProportional ">&lt;!ENTITY</span>
<em class="EmphasisTypeItalic ">name</em>
<span class="EmphasisFontCategoryNonProportional ">SYSTEM</span>
<em class="EmphasisTypeItalic ">uri</em>
<span class="EmphasisFontCategoryNonProportional ">NDATA</span>
<em class="EmphasisTypeItalic ">nname</em><span class="EmphasisFontCategoryNonProportional ">&gt;</span>, where <em class="EmphasisTypeItalic ">name</em> identifies the entity, <em class="EmphasisTypeItalic ">uri</em> locates the external file, and <span class="EmphasisFontCategoryNonProportional ">NDATA</span> identifies the notation declaration named <em class="EmphasisTypeItalic ">nname</em>. The notation typically identifies a plugin for processing the binary data or the Internet media type of this data. For example, <span class="EmphasisFontCategoryNonProportional ">&lt;!ENTITY photo SYSTEM &quot;photo.jpg&quot; NDATA image&gt;</span> associates name <span class="EmphasisFontCategoryNonProportional ">photo</span> with external binary file <span class="EmphasisFontCategoryNonProportional ">photo.png</span> and notation <span class="EmphasisFontCategoryNonProportional ">image</span>. The alternative <span class="EmphasisFontCategoryNonProportional ">&lt;!ENTITY</span>
<em class="EmphasisTypeItalic ">name</em>
<span class="EmphasisFontCategoryNonProportional ">PUBLIC</span>
<em class="EmphasisTypeItalic ">fpi uri</em>
<span class="EmphasisFontCategoryNonProportional ">NDATA</span>
<em class="EmphasisTypeItalic ">nname</em><span class="EmphasisFontCategoryNonProportional ">&gt;</span> form can be specified.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar17"><h3 class="Heading">Note</h3><p class="Para" id="Par91">XML doesn鈥檛 allow references to external general entities to appear in attribute values. For example, you cannot specify <span class="EmphasisFontCategoryNonProportional ">&amp;chapter-header;</span> in an attribute鈥檚 value.</p></div><p class="Para" id="Par92"><span id="ITerm44">
                  <em class="EmphasisTypeItalic ">Parameter entities</em>
                  
                  
                </span> are entities referenced from inside a DTD via <em class="EmphasisTypeItalic ">parameter entity references</em>, syntactic constructs of the form <span class="EmphasisFontCategoryNonProportional ">%</span><em class="EmphasisTypeItalic ">name</em><span class="EmphasisFontCategoryNonProportional ">;</span>. They鈥檙e useful for eliminating repetitive content from element declarations. For example, you鈥檙e creating a DTD for a large company, and this DTD contains three element declarations: <span class="EmphasisFontCategoryNonProportional ">&lt;!ELEMENT salesperson (firstname, lastname)&gt;</span>, <span class="EmphasisFontCategoryNonProportional ">&lt;!ELEMENT lawyer (firstname, lastname)&gt;</span>, and <span class="EmphasisFontCategoryNonProportional ">&lt;!ELEMENT accountant (firstname, lastname)&gt;</span>. Each element contains repeated child element content. If you need to add another child element (such as <span class="EmphasisFontCategoryNonProportional ">middleinitial</span>), you鈥檒l need to make sure that all of the elements are updated; otherwise, you risk a malformed DTD. Parameter entities can help you solve this problem.</p><p class="Para" id="Par93">Parameter entities are classified as internal or external. An <span id="ITerm45">
                  <em class="EmphasisTypeItalic ">internal</em>
                  
                  
                </span>
<em class="EmphasisTypeItalic ">parameter entity</em> is a parameter entity whose value is stored in the DTD and has the form <span class="EmphasisFontCategoryNonProportional ">&lt;!ENTITY %</span>
<em class="EmphasisTypeItalic ">name value</em><span class="EmphasisFontCategoryNonProportional ">&gt;</span>, where <em class="EmphasisTypeItalic ">name</em> identifies the entity and <em class="EmphasisTypeItalic ">value</em> specifies its value. For example, <span class="EmphasisFontCategoryNonProportional ">&lt;!ENTITY % person-name &quot;firstname, lastname&quot;&gt;</span> declares a parameter entity named <span class="EmphasisFontCategoryNonProportional ">person-name</span> with value <span class="EmphasisFontCategoryNonProportional ">firstname, lastname</span>. Once declared, this entity can be referenced in the three previous element declarations, as follows: <span class="EmphasisFontCategoryNonProportional ">&lt;!ELEMENT salesperson (%person-name;)&gt;</span>, <span class="EmphasisFontCategoryNonProportional ">&lt;!ELEMENT lawyer (%person-name;)&gt;</span>, and <span class="EmphasisFontCategoryNonProportional ">&lt;!ELEMENT accountant (%person-name;)&gt;</span>. Instead of adding <span class="EmphasisFontCategoryNonProportional ">middleinitial</span> to each of <span class="EmphasisFontCategoryNonProportional ">salesperson</span>, <span class="EmphasisFontCategoryNonProportional ">lawyer</span>, and <span class="EmphasisFontCategoryNonProportional ">accountant</span>, as was done previously, you would now add this child element to <span class="EmphasisFontCategoryNonProportional ">person-name</span>, as in <span class="EmphasisFontCategoryNonProportional ">&lt;!ENTITY % person-name &quot;firstname, middleinitial, lastname&quot;&gt;</span>, and this change would be applied to these element declarations.</p><p class="Para" id="Par94">An <em class="EmphasisTypeItalic ">external parameter entity</em><span id="ITerm46">
                  
                  
                </span> is a parameter entity whose value is stored outside the DTD. It has the form <span class="EmphasisFontCategoryNonProportional ">&lt;!ENTITY % name SYSTEM uri&gt;</span>, where <span class="EmphasisFontCategoryNonProportional ">name</span> identifies the entity and <span class="EmphasisFontCategoryNonProportional ">uri</span> locates the external file. For example, <span class="EmphasisFontCategoryNonProportional ">&lt;!ENTITY % person-name SYSTEM &quot;</span><span class="ExternalRef"><a href="http://www.javajeff.ca/entities/names.dtd"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://www.javajeff.ca/entities/names.dtd</span>
                  </span></a></span><span class="EmphasisFontCategoryNonProportional ">&quot;&gt;</span> identifies <span class="EmphasisFontCategoryNonProportional ">names.dtd</span> as storing the <span class="EmphasisFontCategoryNonProportional ">firstname, lastname</span> text to be inserted into a DTD wherever <span class="EmphasisFontCategoryNonProportional ">%person-name;</span> appears in the DTD. The alternative <span class="EmphasisFontCategoryNonProportional ">&lt;!ENTITY %</span>
<em class="EmphasisTypeItalic ">name</em>
<span class="EmphasisFontCategoryNonProportional ">PUBLIC</span>
<em class="EmphasisTypeItalic ">fpi uri</em><span class="EmphasisFontCategoryNonProportional ">&gt;</span> form can be specified.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar18"><h3 class="Heading">Note</h3><p class="Para" id="Par95">This discussion sums up the basics of DTD. One additional topic that wasn鈥檛 covered (for brevity) is <em class="EmphasisTypeItalic ">conditional inclusion</em>, which lets you specify those portions of a DTD to make available to parsers and is typically used with parameter entity references.</p></div></section><section class="Section2 RenderAsSection2" id="Sec11"><h3 class="Heading">XML Schema</h3><p class="Para" id="Par96"><em class="EmphasisTypeItalic ">XML Schema</em> is a grammar language for declaring the structure, content, and <em class="EmphasisTypeItalic ">semantics</em> (meaning) of an XML document. This language鈥檚 grammar documents are known as <em class="EmphasisTypeItalic ">schemas</em> that are themselves XML documents. Schemas must conform to the XML Schema DTD (see <span class="ExternalRef"><a href="http://www.w3.org/2001/XMLSchema.dtd"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">www.w3.org/2001/XMLSchema.dtd</span>
                  </span></a></span>).</p><p class="Para" id="Par97">XML Schema was introduced by the W3C to overcome limitations with DTD, such as DTD鈥檚 lack of support for namespaces. Also, XML Schema provides an <span id="ITerm47">object-oriented approach</span> to declaring an XML document鈥檚 grammar. This grammar language provides a much larger set of primitive types than DTD鈥檚 CDATA and PCDATA types. For example, you鈥檒l find integer, floating-point, various date and time, and string types to be part of XML Schema.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar19"><h3 class="Heading">Note</h3><p class="Para" id="Par98">XML Schema predefines 19 primitive types, which are expressed via the following identifiers: <span class="EmphasisFontCategoryNonProportional ">anyURI</span>, <span class="EmphasisFontCategoryNonProportional ">base64Binary</span>, <span class="EmphasisFontCategoryNonProportional ">boolean</span>, <span class="EmphasisFontCategoryNonProportional ">date</span>, <span class="EmphasisFontCategoryNonProportional ">dateTime</span>, <span class="EmphasisFontCategoryNonProportional ">decimal</span>, <span class="EmphasisFontCategoryNonProportional ">double</span>, <span class="EmphasisFontCategoryNonProportional ">duration</span>, <span class="EmphasisFontCategoryNonProportional ">float</span>, <span class="EmphasisFontCategoryNonProportional ">hexBinary</span>, <span class="EmphasisFontCategoryNonProportional ">gDay</span>, <span class="EmphasisFontCategoryNonProportional ">gMonth</span>, <span class="EmphasisFontCategoryNonProportional ">gMonthDay</span>, <span class="EmphasisFontCategoryNonProportional ">gYear</span>, <span class="EmphasisFontCategoryNonProportional ">gYearMonth</span>, <span class="EmphasisFontCategoryNonProportional ">NOTATION</span>, <span class="EmphasisFontCategoryNonProportional ">QName</span>, <span class="EmphasisFontCategoryNonProportional ">string</span>, and <span class="EmphasisFontCategoryNonProportional ">time</span>.</p></div><p class="Para" id="Par99">XML Schema provides <em class="EmphasisTypeItalic ">restriction</em> (reducing the set of permitted values through constraints), <em class="EmphasisTypeItalic ">list</em> (allowing a sequence of values), and <em class="EmphasisTypeItalic ">union</em> (allowing a choice of values from several types) derivation methods for creating new <em class="EmphasisTypeItalic ">simple types</em> from these primitive <span id="ITerm48">types</span>. For example, XML Schema derives 13 integer types from <span class="EmphasisFontCategoryNonProportional ">decimal</span> through restriction; these types are expressed via the following identifiers: <span class="EmphasisFontCategoryNonProportional ">byte</span>, <span class="EmphasisFontCategoryNonProportional ">int</span>, <span class="EmphasisFontCategoryNonProportional ">integer</span>, <span class="EmphasisFontCategoryNonProportional ">long</span>, <span class="EmphasisFontCategoryNonProportional ">negativeInteger</span>, <span class="EmphasisFontCategoryNonProportional ">nonNegativeInteger</span>, <span class="EmphasisFontCategoryNonProportional ">nonPositiveInteger</span>, <span class="EmphasisFontCategoryNonProportional ">positiveInteger</span>, <span class="EmphasisFontCategoryNonProportional ">short</span>, <span class="EmphasisFontCategoryNonProportional ">unsignedByte</span>, <span class="EmphasisFontCategoryNonProportional ">unsignedInt</span>, <span class="EmphasisFontCategoryNonProportional ">unsignedLong</span>, and <span class="EmphasisFontCategoryNonProportional ">unsignedShort</span>. It also provides support for creating <em class="EmphasisTypeItalic ">complex types</em> from simple types.</p><p class="Para" id="Par100">A good way to become familiar with XML Schema is to follow through an example, such as creating a schema for Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC1">1-1</a></span>鈥檚 recipe <span id="ITerm49">language document</span>. The first step in creating this recipe language schema is to identify all of its elements and attributes. The elements are <span class="EmphasisFontCategoryNonProportional ">recipe</span>, <span class="EmphasisFontCategoryNonProportional ">title</span>, <span class="EmphasisFontCategoryNonProportional ">ingredients</span>, <span class="EmphasisFontCategoryNonProportional ">instructions</span>, and <span class="EmphasisFontCategoryNonProportional ">ingredient</span>; <span class="EmphasisFontCategoryNonProportional ">qty</span> is the solitary attribute.</p><p class="Para" id="Par101">The next step is to classify the elements according to XML Schema鈥檚 <span id="ITerm50">
                  <em class="EmphasisTypeItalic ">content model</em>
                  
                  
                </span>, which specifies the types of child elements and text <em class="EmphasisTypeItalic ">nodes</em> (see <span class="ExternalRef"><a href="http://en.wikipedia.org/wiki/Node_(computer_science)"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://en.wikipedia.org/wiki/Node_(computer_science)</span>
                  </span></a></span>) that can be included in an element. An element is considered to be <em class="EmphasisTypeItalic ">empty</em> when the element has no child elements or text nodes, <em class="EmphasisTypeItalic ">simple</em> when only text nodes are accepted, <em class="EmphasisTypeItalic ">complex</em> when only child elements are accepted, and <em class="EmphasisTypeItalic ">mixed</em> when child elements and text nodes are accepted. None of Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC1">1-1</a></span>鈥檚 elements have empty or mixed <span id="ITerm51">content models</span>. However, the <span class="EmphasisFontCategoryNonProportional ">title</span>, <span class="EmphasisFontCategoryNonProportional ">ingredient</span>, and <span class="EmphasisFontCategoryNonProportional ">instructions</span> elements have simple content models; and the <span class="EmphasisFontCategoryNonProportional ">recipe</span> and <span class="EmphasisFontCategoryNonProportional ">ingredients</span> elements have complex content models.</p><p class="Para" id="Par102">For elements that have a simple content model, we can distinguish between elements having attributes and elements not having attributes. XML Schema classifies elements having a simple content model and no attributes as simple types. Furthermore, it classifies elements having a simple content model and attributes, or elements from other content models as complex types. Furthermore, XML Schema classifies attributes as simple types because they only contain text values鈥攁ttributes don鈥檛 have child elements. Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC1">1-1</a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">title</span> and <span class="EmphasisFontCategoryNonProportional ">instructions</span> elements and its <span class="EmphasisFontCategoryNonProportional ">qty</span> attribute are simple types. Its <span class="EmphasisFontCategoryNonProportional ">recipe</span>, <span class="EmphasisFontCategoryNonProportional ">ingredients</span>, and <span class="EmphasisFontCategoryNonProportional ">ingredient</span> elements are complex types.</p><div class="Para" id="Par103">At this point, we can begin to declare the schema. The following code fragment presents the introductory <span class="EmphasisFontCategoryNonProportional ">schema</span> element:<div class="ProgramCode" id="PC10"><div class="LineGroup"><div class="FixedLine">&lt;xs:schema xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema&quot;&gt;</div></div></div></div><p class="Para" id="Par104">The <span class="EmphasisFontCategoryNonProportional ">schema</span> element introduces the grammar. It also assigns the commonly used <span class="EmphasisFontCategoryNonProportional ">xs</span> namespace prefix to the standard XML Schema namespace; <span class="EmphasisFontCategoryNonProportional ">xs:</span> is subsequently prepended to XML Schema <span id="ITerm52">element names</span>.</p><div class="Para" id="Par105">Next, we use the <span class="EmphasisFontCategoryNonProportional ">element</span> element to declare the <span class="EmphasisFontCategoryNonProportional ">title</span> and <span class="EmphasisFontCategoryNonProportional ">instructions</span> simple type elements, as follows:<div class="ProgramCode" id="PC11"><div class="LineGroup"><div class="FixedLine">&lt;xs:element name=&quot;title&quot; type=&quot;xs:string&quot;/&gt;</div><div class="FixedLine">&lt;xs:element name=&quot;instructions&quot; type=&quot;xs:string&quot;/&gt;</div></div></div></div><p class="Para" id="Par106">XML Schema requires that each element have a name and (unlike DTD) be associated with a type, which identifies the kind of data stored in the element. For example, the first <span class="EmphasisFontCategoryNonProportional ">element</span> declaration identifies <span class="EmphasisFontCategoryNonProportional ">title</span> as the name via its <span class="EmphasisFontCategoryNonProportional ">name</span> attribute and <span class="EmphasisFontCategoryNonProportional ">string</span> as the type via its <span class="EmphasisFontCategoryNonProportional ">type</span> attribute (string or character data appears between the <span class="EmphasisFontCategoryNonProportional ">&lt;title&gt;</span> and <span class="EmphasisFontCategoryNonProportional ">&lt;/title&gt;</span> tags). The <span class="EmphasisFontCategoryNonProportional ">xs:</span> prefix in <span class="EmphasisFontCategoryNonProportional ">xs:string</span> is required because <span class="EmphasisFontCategoryNonProportional ">string</span> is a predefined <span id="ITerm53">W3C type</span>.</p><div class="Para" id="Par107">Continuing, we now use the <span class="EmphasisFontCategoryNonProportional ">attribute</span> element to declare the <span class="EmphasisFontCategoryNonProportional ">qty</span> simple type attribute, as follows:<div class="ProgramCode" id="PC12"><div class="LineGroup"><div class="FixedLine">&lt;xs:attribute name=&quot;qty&quot; type=&quot;xs:unsignedInt&quot; default=&quot;1&quot;/&gt;</div></div></div></div><p class="Para" id="Par108">This <span class="EmphasisFontCategoryNonProportional ">attribute</span> element declares an attribute named <span class="EmphasisFontCategoryNonProportional ">qty</span>. I鈥檝e chosen <span class="EmphasisFontCategoryNonProportional ">unsignedInt</span> as this attribute鈥檚 <span class="EmphasisFontCategoryNonProportional ">type</span> because quantities are nonnegative values. Furthermore, I鈥檝e specified <span class="EmphasisFontCategoryNonProportional ">1</span> as the <span class="EmphasisFontCategoryNonProportional ">default</span> value for when <span class="EmphasisFontCategoryNonProportional ">qty</span> isn鈥檛 specified鈥?span class=&quot;EmphasisFontCategoryNonProportional &quot;&gt;attribute</span> elements default to declaring optional attributes.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar20"><h3 class="Heading">Note</h3><p class="Para" id="Par109">The order of element and attribute declarations isn鈥檛 significant within a schema.</p></div><div class="Para" id="Par110">Now that we鈥檝e declared the simple types, we can start to declare the <span id="ITerm54">complex types</span>. To begin, we鈥檒l declare <span class="EmphasisFontCategoryNonProportional ">recipe</span>, as follows:<div class="ProgramCode" id="PC13"><div class="LineGroup"><div class="FixedLine">&lt;xs:element name=&quot;recipe&quot;&gt;</div><div class="FixedLine">   &lt;xs:complexType&gt;</div><div class="FixedLine">      &lt;xs:sequence&gt;</div><div class="FixedLine">         &lt;xs:element ref=&quot;title&quot;/&gt;</div><div class="FixedLine">         &lt;xs:element ref=&quot;ingredients&quot;/&gt;</div><div class="FixedLine">         &lt;xs:element ref=&quot;instructions&quot;/&gt;</div><div class="FixedLine">      &lt;/xs:sequence&gt;</div><div class="FixedLine">   &lt;/xs:complexType&gt;</div><div class="FixedLine">&lt;/xs:element&gt;</div></div></div></div><p class="Para" id="Par111">This declaration states that <span class="EmphasisFontCategoryNonProportional ">recipe</span> is a complex type (via the <span class="EmphasisFontCategoryNonProportional ">complexType</span> element) consisting of a sequence (via the <span class="EmphasisFontCategoryNonProportional ">sequence</span> element) of one <span class="EmphasisFontCategoryNonProportional ">title</span> element followed by one <span class="EmphasisFontCategoryNonProportional ">ingredients</span> element followed by one <span class="EmphasisFontCategoryNonProportional ">instructions</span> element. Each of these elements is declared by a different <span class="EmphasisFontCategoryNonProportional ">element</span> that鈥檚 referred to by its <span class="EmphasisFontCategoryNonProportional ">element</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">ref</span> attribute.</p><div class="Para" id="Par112">The next complex type to declare is <span class="EmphasisFontCategoryNonProportional ">ingredients</span>. The following <span id="ITerm55">code fragment</span> provides its declaration:<div class="ProgramCode" id="PC14"><div class="LineGroup"><div class="FixedLine">&lt;xs:element name=&quot;ingredients&quot;&gt;</div><div class="FixedLine">   &lt;xs:complexType&gt;</div><div class="FixedLine">      &lt;xs:sequence&gt;</div><div class="FixedLine">         &lt;xs:element ref=&quot;ingredient&quot;</div><div class="FixedLine">                     maxOccurs=&quot;unbounded&quot;/&gt;</div><div class="FixedLine">      &lt;/xs:sequence&gt;</div><div class="FixedLine">   &lt;/xs:complexType&gt;</div><div class="FixedLine">&lt;/xs:element&gt;</div></div></div></div><p class="Para" id="Par113">This declaration states that <span class="EmphasisFontCategoryNonProportional ">ingredients</span> is a complex type consisting of a sequence of one or more <span class="EmphasisFontCategoryNonProportional ">ingredient</span> elements. The 鈥渙r more鈥?is specified by including <span class="EmphasisFontCategoryNonProportional ">element</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">maxOccurs</span> attribute and setting this attribute鈥檚 value to <span class="EmphasisFontCategoryNonProportional ">unbounded</span>.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar21"><h3 class="Heading">Note</h3><p class="Para" id="Par114">The <span class="EmphasisFontCategoryNonProportional ">maxOccurs</span> attribute identifies the maximum number of times that an element can occur. A similar <span class="EmphasisFontCategoryNonProportional ">minOccurs</span> attribute identifies the minimum number of times that an element can occur. Each attribute can be assigned <span class="EmphasisFontCategoryNonProportional ">0</span> or a positive integer. Furthermore, you can specify <span class="EmphasisFontCategoryNonProportional ">unbounded</span> for <span class="EmphasisFontCategoryNonProportional ">maxOccurs</span>, which means that there鈥檚 no upper limit on occurrences of the element. Each attribute defaults to a value of <span class="EmphasisFontCategoryNonProportional ">1</span>, which means that an element can appear only one time when neither attribute is present.</p></div><div class="Para" id="Par115">The final complex type to declare is <span class="EmphasisFontCategoryNonProportional ">ingredient</span>. Although <span class="EmphasisFontCategoryNonProportional ">ingredient</span> can contain only text nodes, which implies that it should be a simple type, it鈥檚 the presence of the <span class="EmphasisFontCategoryNonProportional ">qty</span> attribute that makes it <span id="ITerm56">complex</span>. Check out the following declaration:<div class="ProgramCode" id="PC15"><div class="LineGroup"><div class="FixedLine">&lt;xs:element name=&quot;ingredient&quot;&gt;</div><div class="FixedLine">   &lt;xs:complexType&gt;</div><div class="FixedLine">      &lt;xs:simpleContent&gt;</div><div class="FixedLine">         &lt;xs:extension base=&quot;xs:string&quot;&gt;</div><div class="FixedLine">            &lt;xs:attribute ref=&quot;qty&quot;/&gt;</div><div class="FixedLine">         &lt;/xs:extension&gt;</div><div class="FixedLine">      &lt;/xs:simpleContent&gt;</div><div class="FixedLine">   &lt;/xs:complexType&gt;</div><div class="FixedLine">&lt;/xs:element&gt;</div></div></div></div><p class="Para" id="Par116">The element named <span class="EmphasisFontCategoryNonProportional ">ingredient</span> is a complex type (because of its optional <span class="EmphasisFontCategoryNonProportional ">qty</span> attribute). The <span class="EmphasisFontCategoryNonProportional ">simpleContent</span> element indicates that <span class="EmphasisFontCategoryNonProportional ">ingredient</span> can only contain simple content (text nodes), and the <span class="EmphasisFontCategoryNonProportional ">extension</span> element indicates that <span class="EmphasisFontCategoryNonProportional ">ingredient</span> is a new type that extends the predefined <span class="EmphasisFontCategoryNonProportional ">string</span> type (specified via the <span class="EmphasisFontCategoryNonProportional ">base</span> attribute), implying that <span class="EmphasisFontCategoryNonProportional ">ingredient</span> inherits all of <span class="EmphasisFontCategoryNonProportional ">string</span>鈥檚 attributes and structure. Furthermore, <span class="EmphasisFontCategoryNonProportional ">ingredient</span> is given an additional <span class="EmphasisFontCategoryNonProportional ">qty</span> attribute.</p><div class="Para" id="Par117">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC16">1-9</a></span> combines the previous examples into a complete <span id="ITerm57">schema</span>.<div class="ProgramCode" id="PC16"><div class="LineGroup"><div class="FixedLine">&lt;?xml version=&quot;1.0&quot;?&gt;</div><div class="FixedLine">&lt;xs:schema xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema&quot;&gt;</div><div class="FixedLine">&lt;xs:element name=&quot;title&quot; type=&quot;xs:string&quot;/&gt;</div><div class="FixedLine">&lt;xs:element name=&quot;instructions&quot; type=&quot;xs:string&quot;/&gt;</div><div class="FixedLine">&lt;xs:attribute name=&quot;qty&quot; type=&quot;xs:unsignedInt&quot; default=&quot;1&quot;/&gt;</div><div class="FixedLine">&lt;xs:element name=&quot;recipe&quot;&gt;</div><div class="FixedLine">   &lt;xs:complexType&gt;</div><div class="FixedLine">      &lt;xs:sequence&gt;</div><div class="FixedLine">         &lt;xs:element ref=&quot;title&quot;/&gt;</div><div class="FixedLine">         &lt;xs:element ref=&quot;ingredients&quot;/&gt;</div><div class="FixedLine">         &lt;xs:element ref=&quot;instructions&quot;/&gt;</div><div class="FixedLine">      &lt;/xs:sequence&gt;</div><div class="FixedLine">   &lt;/xs:complexType&gt;</div><div class="FixedLine">&lt;/xs:element&gt;</div><div class="FixedLine">&lt;xs:element name=&quot;ingredients&quot;&gt;</div><div class="FixedLine">   &lt;xs:complexType&gt;</div><div class="FixedLine">      &lt;xs:sequence&gt;</div><div class="FixedLine">         &lt;xs:element ref=&quot;ingredient&quot;</div><div class="FixedLine">                     maxOccurs=&quot;unbounded&quot;/&gt;</div><div class="FixedLine">      &lt;/xs:sequence&gt;</div><div class="FixedLine">   &lt;/xs:complexType&gt;</div><div class="FixedLine">&lt;/xs:element&gt;</div><div class="FixedLine">&lt;xs:element name=&quot;ingredient&quot;&gt;</div><div class="FixedLine">   &lt;xs:complexType&gt;</div><div class="FixedLine">      &lt;xs:simpleContent&gt;</div><div class="FixedLine">         &lt;xs:extension base=&quot;xs:string&quot;&gt;</div><div class="FixedLine">            &lt;xs:attribute ref=&quot;qty&quot;/&gt;</div><div class="FixedLine">         &lt;/xs:extension&gt;</div><div class="FixedLine">      &lt;/xs:simpleContent&gt;</div><div class="FixedLine">   &lt;/xs:complexType&gt;</div><div class="FixedLine">&lt;/xs:element&gt;</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 1-9</span><p class="SimplePara">The Recipe Document鈥檚 Schema</p></div></div></div></div><div class="Para" id="Par118">After creating the schema, you can reference it from a recipe document. Accomplish this task by specifying <span class="EmphasisFontCategoryNonProportional ">xmlns:xsi</span> and <span class="EmphasisFontCategoryNonProportional ">xsi:schemaLocation</span> attributes on the document鈥檚 root element start tag (<span class="EmphasisFontCategoryNonProportional ">&lt;recipe&gt;</span>), as follows:<div class="ProgramCode" id="PC17"><div class="LineGroup"><div class="FixedLine">&lt;recipe xmlns:=&quot;http://www.javajeff.ca/&quot;</div><div class="FixedLine">        xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class="FixedLine">        xsi:schemaLocation=&quot;http://www.javajeff.ca/schemas recipe.xsd&quot;&gt;</div></div></div></div><p class="Para" id="Par119">The <span class="EmphasisFontCategoryNonProportional ">xmlns</span> attribute identifies <span class="ExternalRef"><a href="http://www.javajeff.ca/"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://www.javajeff.ca/</span>
                  </span></a></span> as the document鈥檚 default namespace. Unprefixed elements and their unprefixed attributes belong to this namespace.</p><p class="Para" id="Par120">The <span class="EmphasisFontCategoryNonProportional ">xmlns:xsi</span> attribute associates the conventional <span class="EmphasisFontCategoryNonProportional ">xsi</span> (XML Schema Instance) prefix with the standard <span class="ExternalRef"><a href="http://www.w3.org/2001/XMLSchema-instance"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://www.w3.org/2001/XMLSchema-instance</span>
                  </span></a></span> namespace. The only item in the document that鈥檚 prefixed with <span class="EmphasisFontCategoryNonProportional ">xsi:</span> is <span class="EmphasisFontCategoryNonProportional ">schemaLocation</span>.</p><p class="Para" id="Par121">The <span class="EmphasisFontCategoryNonProportional ">schemaLocation</span> attribute<span id="ITerm58">
                  
                  
                </span> is used to locate the schema. This attribute鈥檚 value can be multiple pairs of space-separated values but is specified as a single pair of such values in this example. The first value (<span class="ExternalRef"><a href="http://www.javajeff.ca/schemas"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://www.javajeff.ca/schemas</span>
                  </span></a></span>) identifies the target namespace for the schema, and the second value (<span class="EmphasisFontCategoryNonProportional ">recipe.xsd</span>) identifies the location of the schema within this namespace.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar22"><h3 class="Heading">Note</h3><p class="Para" id="Par122">Schema files that conform to XML Schema鈥檚 grammar are commonly assigned the <span class="EmphasisFontCategoryNonProportional ">.xsd</span> file extension.</p></div><div class="Para" id="Par123">If an XML document declares a <span id="ITerm59">namespace</span> (<span class="EmphasisFontCategoryNonProportional ">xmlns</span> default or <span class="EmphasisFontCategoryNonProportional ">xmlns:prefix</span>), that namespace must be made available to the schema so that a validating parser can resolve all references to elements and other schema components for that namespace. We also need to mention which namespace the schema describes, and we do so by including the <span class="EmphasisFontCategoryNonProportional ">targetNamespace</span> attribute on the <span class="EmphasisFontCategoryNonProportional ">schema</span> element. For example, suppose our recipe document declares a default XML namespace, as follows:<div class="ProgramCode" id="PC18"><div class="LineGroup"><div class="FixedLine">&lt;?xml version=&quot;1.0&quot;?&gt;</div><div class="FixedLine">&lt;recipe xmlns:=&quot;http://www.javajeff.ca/&quot;&gt;</div></div></div></div><div class="Para" id="Par124">At minimum, we would need to modify Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC16">1-9</a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">schema</span> element to include <span class="EmphasisFontCategoryNonProportional ">targetNameSpace</span><span id="ITerm60">
                  
                  
                </span> and the recipe document鈥檚 default namespace as <span class="EmphasisFontCategoryNonProportional ">targetNameSpace</span>鈥檚 value, as follows:<div class="ProgramCode" id="PC19"><div class="LineGroup"><div class="FixedLine">&lt;xs:schema targetNamespace=&quot;http://www.javajeff.ca/&quot;</div><div class="FixedLine">           xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema&quot;&gt;</div></div></div></div><div class="FormalPara FormalParaRenderingStyle3 ParaTypeOverview" id="FPar23"><h3 class="Heading">Exercises</h3><div class="Para" id="Par125">The following exercises are designed to test your understanding of Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml"><span class="RefSource">1</span></a></span>鈥檚 content:<div class="OrderedList"><ol><li class="ListItem"><span class="ItemNumber">1.</span><div class="ItemContent"><p class="Para" id="Par126">Define XML.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">2.</span><div class="ItemContent"><p class="Para" id="Par127">True or false: XML and HTML are descendants of SGML.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">3.</span><div class="ItemContent"><p class="Para" id="Par128">What language features does XML provide for use in defining custom markup languages?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">4.</span><div class="ItemContent"><p class="Para" id="Par129">What is the XML declaration?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">5.</span><div class="ItemContent"><p class="Para" id="Par130">Identify the XML declaration鈥檚 three attributes. Which attribute is nonoptional?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">6.</span><div class="ItemContent"><p class="Para" id="Par131">True or false: An element always consists of a start tag followed by content followed by an end tag.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">7.</span><div class="ItemContent"><p class="Para" id="Par132">Following the XML declaration, an XML document is anchored in what kind of element?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">8.</span><div class="ItemContent"><p class="Para" id="Par133">What is mixed content?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">9.</span><div class="ItemContent"><p class="Para" id="Par134">What is a character reference? Identify the two kinds of character references.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">10.</span><div class="ItemContent"><p class="Para" id="Par135">What is a CDATA section? Why would you use it?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">11.</span><div class="ItemContent"><p class="Para" id="Par136">Define namespace.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">12.</span><div class="ItemContent"><p class="Para" id="Par137">What is a namespace prefix?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">13.</span><div class="ItemContent"><p class="Para" id="Par138">True or false: A tag鈥檚 attributes don鈥檛 need to be prefixed when those attributes belong to the element.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">14.</span><div class="ItemContent"><p class="Para" id="Par139">What is a comment? Where can it appear in an XML document?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">15.</span><div class="ItemContent"><p class="Para" id="Par140">Define processing instruction.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">16.</span><div class="ItemContent"><p class="Para" id="Par141">Identify the rules that an XML document must follow to be considered well formed.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">17.</span><div class="ItemContent"><p class="Para" id="Par142">What does it mean for an XML document to be valid?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">18.</span><div class="ItemContent"><p class="Para" id="Par143">A parser that performs validation compares an XML document to a grammar document. Identify the two common grammar languages.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">19.</span><div class="ItemContent"><p class="Para" id="Par144">What is the general syntax for declaring an element in a DTD?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">20.</span><div class="ItemContent"><p class="Para" id="Par145">Which grammar language lets you create complex types from simple types?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">21.</span><div class="ItemContent"><p class="Para" id="Par146">Create a <span class="EmphasisFontCategoryNonProportional ">books.xml</span> document file with a <span class="EmphasisFontCategoryNonProportional ">books</span> root element. The <span class="EmphasisFontCategoryNonProportional ">books</span> element must contain one or more <span class="EmphasisFontCategoryNonProportional ">book</span> elements, where a <span class="EmphasisFontCategoryNonProportional ">book</span> element must contain one <span class="EmphasisFontCategoryNonProportional ">title</span> element, one or more <span class="EmphasisFontCategoryNonProportional ">author</span> elements, and one <span class="EmphasisFontCategoryNonProportional ">publisher</span> element (and in that order). Also, the <span class="EmphasisFontCategoryNonProportional ">book</span> element鈥檚 <span class="EmphasisFontCategoryNonProportional ">&lt;book&gt;</span> tag must contain <span class="EmphasisFontCategoryNonProportional ">isbn</span> and <span class="EmphasisFontCategoryNonProportional ">pubyear</span> attributes. Record <span class="EmphasisFontCategoryNonProportional ">Advanced C++</span>/<span class="EmphasisFontCategoryNonProportional ">James Coplien</span>/<span class="EmphasisFontCategoryNonProportional ">Addison Wesley</span>/<span class="EmphasisFontCategoryNonProportional ">0201548550</span>/<span class="EmphasisFontCategoryNonProportional ">1992</span> in the first <span class="EmphasisFontCategoryNonProportional ">book</span> element, <span class="EmphasisFontCategoryNonProportional ">Beginning Groovy and Grails</span>/<span class="EmphasisFontCategoryNonProportional ">Christopher M. Judd</span>/<span class="EmphasisFontCategoryNonProportional ">Joseph Faisal Nusairat</span>/<span class="EmphasisFontCategoryNonProportional ">James Shingler</span>/<span class="EmphasisFontCategoryNonProportional ">Apress</span>/<span class="EmphasisFontCategoryNonProportional ">9781430210450</span>/<span class="EmphasisFontCategoryNonProportional ">2008</span> in the second <span class="EmphasisFontCategoryNonProportional ">book</span> element, and <span class="EmphasisFontCategoryNonProportional ">Effective Java</span>/<span class="EmphasisFontCategoryNonProportional ">Joshua Bloch</span>/<span class="EmphasisFontCategoryNonProportional ">Addison Wesley</span>/<span class="EmphasisFontCategoryNonProportional ">0201310058</span>/<span class="EmphasisFontCategoryNonProportional ">2001</span> in the third <span class="EmphasisFontCategoryNonProportional ">book</span> element.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">22.</span><div class="ItemContent"><p class="Para" id="Par147">Modify <span class="EmphasisFontCategoryNonProportional ">books.xml</span> to include an internal DTD that satisfies the previous exercise鈥檚 requirements.</p></div><div class="ClearBoth"> </div></li></ol></div></div></div></section></section><section class="Section1 RenderAsSection1" id="Sec12"><h2 class="Heading">Summary</h2><p class="Para" id="Par148">Applications often use XML documents to store and exchange data. XML defines rules for encoding documents in a format that is both human-readable and machine-readable. It鈥檚 a meta-language for defining vocabularies, which is the key to XML鈥檚 importance and popularity.</p><p class="Para" id="Par149">XML provides several language features for use in defining custom markup languages. These features include the XML declaration, elements and attributes, character references and CDATA sections, namespaces, and comments and processing instructions.</p><p class="Para" id="Par150">HTML is a sloppy language where elements can be specified out of order, end tags can be omitted, and so on. In contrast, XML documents are well formed in that they conform to specific rules, which make them easier to process. XML parsers only parse well-formed XML documents.</p><p class="Para" id="Par151">In many cases, an XML document must also be valid. A valid document adheres to constraints as described by a grammar document. Grammar documents are written in a grammar language, such as the commonly used Document Type Definition and XML Schema.</p><p class="Para" id="Par152">Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_2_Chapter.xhtml"><span class="RefSource">2</span></a></span> introduces Java鈥檚 SAX API for parsing XML documents.</p></section></div><div class="annotator-outer annotator-viewer viewer annotator-hide"> </div></div></div>
    </section>
  </div>
</div>

<hr/>

<!--if IE]><![endif]--><!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/java-xml-and/9781484243305/html/394211_2_En_2_Chapter.xhtml"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="3866890"
  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"
  data-username="levinxccai"
  data-account-type="B2B"
  
  data-activated-trial-date="11/06/2017"


  data-archive="9781484243305"
  data-publishers="Apress"



  data-htmlfile-name="394211_2_En_2_Chapter.xhtml"
  data-epub-title="Java XML and JSON: Document Processing for Java SE" data-debug=0 data-testing=0><![endif]--><!--if gt IE 8]><!--><!--![endif]-->



<a name="3_"></a>

<div class="application" id="container" style="height: auto;">
  <div class="js-toc">
    <section role="document">
      <div id="sbo-rt-content" style="max-width:72.5em; transform: none;"><div class="annotator-wrapper"><!--egin Abstract--><div class="MainTitleSection"><h1 class="ChapterTitle" lang="en">2. Parsing XML Documents with SAX</h1></div><div class="AuthorGroup"><div class="AuthorNames"><span class="Author"><span class="AuthorName">Jeff Friesen</span><sup><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_2_Chapter.xhtml#Aff2">1</a> <span class="ContactIcon"></span></sup></span></div><div class="Affiliations"><div class="Affiliation" id="Aff2"><span class="AffiliationNumber">(1)</span><div class="AffiliationText">Dauphin, MB, Canada</div></div><div class="ClearBoth"> </div></div></div><!--nd Abstract--><div class="Fulltext"><p class="Para" id="Par2">Java provides several APIs for parsing XML documents. The most basic of these APIs is SAX, which is the focus of Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_2_Chapter.xhtml"><span class="RefSource">2</span></a></span>.</p><section class="Section1 RenderAsSection1" id="Sec1"><h2 class="Heading">What Is SAX?</h2><p class="Para" id="Par3"><em class="EmphasisTypeItalic ">Simple API for XML (SAX)</em> is an event-based Java API for parsing an XML <span id="ITerm1">document</span> sequentially from start to finish. As a SAX-oriented parser encounters an item from the document鈥檚 <em class="EmphasisTypeItalic ">infoset</em> (an abstract data model describing an XML document鈥檚 information鈥攕ee <span class="ExternalRef"><a href="http://en.wikipedia.org/wiki/XML_Information_Set"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional ">http://en.wikipedia.org/wiki/XML_Information_Set</span>
                </span></a></span>), it makes this item available to an application as an <em class="EmphasisTypeItalic ">event</em> by calling one of the methods in one of the application鈥檚 <em class="EmphasisTypeItalic ">handlers</em> (objects whose methods are called by the parser to make event information available), which the application has previously registered with the parser. The application can then <em class="EmphasisTypeItalic ">consume</em> this event by processing the infoset item in some manner.</p><p class="Para" id="Par4">A SAX <span id="ITerm2">parser</span> is more memory efficient than a DOM (see Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_3_Chapter.xhtml"><span class="RefSource">3</span></a></span>) parser in that it doesn鈥檛 require the entire document to fit into memory. This benefit becomes a drawback for using XPath (see Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_5_Chapter.xhtml"><span class="RefSource">5</span></a></span>) and XSLT (see Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_6_Chapter.xhtml"><span class="RefSource">6</span></a></span>), which require that the entire document be stored in memory.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar1"><h3 class="Heading">Note</h3><p class="Para" id="Par5">According to its official website (<span class="ExternalRef"><a href="http://www.saxproject.org/"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">www.saxproject.org</span>
                  </span></a></span>), SAX originated as an XML parsing API for Java. However, SAX isn鈥檛 exclusive to Java. SAX is also available for Microsoft鈥檚 .NET framework (see <span class="ExternalRef"><a href="http://saxdotnet.sourceforge.net/"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://saxdotnet.sourceforge.net</span>
                  </span></a></span>).</p></div></section><section class="Section1 RenderAsSection1" id="Sec2"><h2 class="Heading">Exploring the SAX API</h2><p class="Para" id="Par6">SAX exists in two major versions: SAX 1 and SAX 2. Java implements both versions through the <span class="EmphasisFontCategoryNonProportional ">javax.xml.parsers</span> package鈥檚 abstract <span class="EmphasisFontCategoryNonProportional ">SAXParser</span> and <span class="EmphasisFontCategoryNonProportional ">SAXParserFactory</span> classes. The <span class="EmphasisFontCategoryNonProportional ">org.xml.sax</span>, <span class="EmphasisFontCategoryNonProportional ">org.xml.sax.ext</span>, and <span class="EmphasisFontCategoryNonProportional ">org.xml.sax.helpers</span> packages provide various types that augment both Java implementations.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar2"><h3 class="Heading">Note</h3><p class="Para" id="Par7">I explore only the SAX 2 implementation because SAX 2 makes available additional infoset items about an XML document (such as comments and CDATA section notifications).</p><p class="Para" id="Par8">Before Java 9, you could use the <span class="EmphasisFontCategoryNonProportional ">org.xml.sax.helpers</span> package鈥檚 <span class="EmphasisFontCategoryNonProportional ">XMLReaderFactory</span> class to obtain a SAX 2 parser. In Java 9, Oracle deprecated <span class="EmphasisFontCategoryNonProportional ">XMLReaderFactory</span> and recommends using <span class="EmphasisFontCategoryNonProportional ">SAXParserFactory</span> instead.</p></div><section class="Section2 RenderAsSection2" id="Sec3"><h3 class="Heading">Obtaining a SAX 2 Parser</h3><div class="Para" id="Par9">Classes that implement the <span class="EmphasisFontCategoryNonProportional ">XMLReader</span> interface<span id="ITerm3">
                  
                </span> describe SAX 2-based parsers. Instances of these classes are obtained as follows:<div class="OrderedList"><ol><li class="ListItem"><span class="ItemNumber">1.</span><div class="ItemContent"><p class="Para" id="Par10">Call <span class="EmphasisFontCategoryNonProportional ">SAXParserFactory</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">static SAXParserFactory newInstance()</span> method<span id="ITerm4">
                          
                        </span> to obtain a new <span class="EmphasisFontCategoryNonProportional ">SAXParserFactory</span> subclass instance. Alternatively, you might want to call the <span class="EmphasisFontCategoryNonProportional ">static SAXParserFactory newDefaultInstance()</span> method (introduced by Java 9) to obtain an instance of the system-default <span class="EmphasisFontCategoryNonProportional ">SAXParserFactory</span> implementation.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">2.</span><div class="ItemContent"><p class="Para" id="Par11">Configure the <span class="EmphasisFontCategoryNonProportional ">SAXParserFactory</span> object by calling various <span class="EmphasisFontCategoryNonProportional ">SAXParserFactory</span> configuration methods, such as <span class="EmphasisFontCategoryNonProportional ">void setNamespaceAware(boolean awareness)</span>, which results in a parser that supports XML namespaces.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">3.</span><div class="ItemContent"><p class="Para" id="Par12">Call <span class="EmphasisFontCategoryNonProportional ">SAXParserFactory</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">SAXParser newSAXParser()</span> method to return a <span class="EmphasisFontCategoryNonProportional ">SAXParser</span> subclass instance.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">4.</span><div class="ItemContent"><p class="Para" id="Par13">Call <span class="EmphasisFontCategoryNonProportional ">SAXParser</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">XMLReader getXMLReader()</span> method to return an instance of a class that implements <span class="EmphasisFontCategoryNonProportional ">XMLReader</span>.</p></div><div class="ClearBoth"> </div></li></ol></div></div><div class="Para" id="Par14">The following code fragment follows these steps to create and return an <span class="EmphasisFontCategoryNonProportional ">XMLReader</span> object whose <span id="ITerm5">parser</span> is aware of namespaces:<div class="ProgramCode" id="PC1"><div class="LineGroup"><div class="FixedLine">SAXParserFactory spf = SAXParserFactory.newInstance();</div><div class="FixedLine">spf.setNamespaceAware(true);</div><div class="FixedLine">SAXParser sp = spf.newSAXParser();</div><div class="FixedLine">XMLReader xmlr = sp.getXMLReader();</div></div></div></div><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar3"><h3 class="Heading">Note</h3><p class="Para" id="Par15"><span class="EmphasisFontCategoryNonProportional ">SAXParserFactory</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">newInstance()</span> method follows an ordered lookup procedure to identify the <span class="EmphasisFontCategoryNonProportional ">SAXParserFactory</span> implementation class to load. First, it looks for a <span class="EmphasisFontCategoryNonProportional ">javax.xml.parsers.SAXParserFactory</span> system property and, when present, uses its value as the implementation class name. Lastly, it invokes <span class="EmphasisFontCategoryNonProportional ">newDefaultInstance()</span> to return the system-default implementation.</p><p class="Para" id="Par16">The <span class="EmphasisFontCategoryNonProportional ">newSAXParser()</span> method<span id="ITerm6">
                    
                  </span> creates a new <span class="EmphasisFontCategoryNonProportional ">SAXParser</span> subclass object using the currently configured factory parameters. It throws <span class="EmphasisFontCategoryNonProportional ">javax.xml.parsers.ParserConfigurationException</span> when a parser cannot be created that satisfies the requested configuration. It throws <span class="EmphasisFontCategoryNonProportional ">org.xml.sax.SAXException</span> when a SAX-oriented error occurs.</p></div></section><section class="Section2 RenderAsSection2" id="Sec4"><h3 class="Heading">Touring XMLReader Methods</h3><div class="Para" id="Par17">The returned <span class="EmphasisFontCategoryNonProportional ">XMLReader</span> object makes available several methods for configuring the parser<span id="ITerm7">
                  
                </span> and parsing a document鈥檚 content. These methods are described as follows:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par18"><span class="EmphasisFontCategoryNonProportional ">ContentHandler getContentHandler()</span><span id="ITerm8">
                        
                      </span> returns the current content handler, which is an instance of a class that implements the <span class="EmphasisFontCategoryNonProportional ">org.xml.sax.ContentHandler</span> interface, or <span class="EmphasisFontCategoryNonProportional ">null</span> when none has been registered.</p></li><li><p class="Para" id="Par19"><span class="EmphasisFontCategoryNonProportional ">DTDHandler getDTDHandler()</span><span id="ITerm9">
                        
                      </span> returns the current DTD handler, which is an instance of a class that implements the <span class="EmphasisFontCategoryNonProportional ">org.xml.sax.DTDHandler</span> interface, or <span class="EmphasisFontCategoryNonProportional ">null</span> when none has been registered.</p></li><li><p class="Para" id="Par20"><span class="EmphasisFontCategoryNonProportional ">EntityResolver getEntityResolver()</span><span id="ITerm10">
                        
                      </span> returns the current entity resolver, which is an instance of a class that implements the <span class="EmphasisFontCategoryNonProportional ">org.xml.sax.EntityResolver</span> interface, or <span class="EmphasisFontCategoryNonProportional ">null</span> when none has been registered.</p></li><li><p class="Para" id="Par21"><span class="EmphasisFontCategoryNonProportional ">ErrorHandler getErrorHandler()</span><span id="ITerm11">
                        
                      </span> returns the current error handler, which is an instance of a class that implements the <span class="EmphasisFontCategoryNonProportional ">org.xml.sax.ErrorHandler</span> interface, or <span class="EmphasisFontCategoryNonProportional ">null</span> when none has been registered.</p></li><li><p class="Para" id="Par22"><span id="ITerm12">
                        <span class="EmphasisFontCategoryNonProportional ">boolean getFeature(String name)</span>
                        
                      </span> returns the Boolean value that corresponds to the feature identified by <span class="EmphasisFontCategoryNonProportional ">name</span>, which must be a fully qualified URI. This method throws <span class="EmphasisFontCategoryNonProportional ">org.xml.sax.SAXNotRecognizedException</span> when the name isn鈥檛 recognized as a feature, and throws <span class="EmphasisFontCategoryNonProportional ">org.xml.sax.SAXNotSupportedException</span> when the name is recognized but the associated value cannot be determined when <span class="EmphasisFontCategoryNonProportional ">getFeature()</span> is called. <span class="EmphasisFontCategoryNonProportional ">SAXNotRecognizedException</span> and <span class="EmphasisFontCategoryNonProportional ">SAXNotSupportedException</span> are subclasses of <span class="EmphasisFontCategoryNonProportional ">SAXException</span>.</p></li><li><p class="Para" id="Par23"><span id="ITerm13">
                        <span class="EmphasisFontCategoryNonProportional ">Object getProperty(String name)</span>
                        
                      </span> returns the <span class="EmphasisFontCategoryNonProportional ">java.lang.Object</span> instance that corresponds to the property identified by <span class="EmphasisFontCategoryNonProportional ">name</span>, which must be a fully qualified URI. This method throws <span class="EmphasisFontCategoryNonProportional ">SAXNotRecognizedException</span> when the name isn鈥檛 recognized as a property, and throws <span class="EmphasisFontCategoryNonProportional ">SAXNotSupportedException</span> when the name is recognized but the associated value cannot be determined when <span class="EmphasisFontCategoryNonProportional ">getProperty()</span> is called.</p></li><li><p class="Para" id="Par24"><span id="ITerm14">
                        <span class="EmphasisFontCategoryNonProportional ">void parse(InputSource input)</span>
                        
                      </span> parses an XML document and doesn鈥檛 return until the document has been parsed. The <span class="EmphasisFontCategoryNonProportional ">input</span> parameter stores a reference to an <span class="EmphasisFontCategoryNonProportional ">org.xml.sax.InputSource</span> object, which describes the document鈥檚 source (such as a <span class="EmphasisFontCategoryNonProportional ">java.io.InputStream</span> object, or even a <span class="EmphasisFontCategoryNonProportional ">java.lang.String</span>-based system identifier URI). This method throws <span class="EmphasisFontCategoryNonProportional ">java.io.IOException</span> when the source cannot be read and <span class="EmphasisFontCategoryNonProportional ">SAXException</span> when parsing fails, probably due to a well-formedness violation.</p></li><li><p class="Para" id="Par25"><span id="ITerm15">
                        <span class="EmphasisFontCategoryNonProportional ">void parse(String systemId)</span>
                        
                      </span> parses an XML document by executing <span class="EmphasisFontCategoryNonProportional ">parse(new InputSource(systemId));</span>.</p></li><li><p class="Para" id="Par26"><span id="ITerm16">
                        <span class="EmphasisFontCategoryNonProportional ">void setContentHandler(ContentHandler handler)</span>
                        
                      </span> registers the content handler identified by <span class="EmphasisFontCategoryNonProportional ">handler</span> with the parser. The <span class="EmphasisFontCategoryNonProportional ">ContentHandler</span> interface provides 11 callback methods that are called to report various parsing events (such as the start and end of an element).</p></li><li><p class="Para" id="Par27"><span id="ITerm17">
                        <span class="EmphasisFontCategoryNonProportional ">void setDTDHandler(DTDHandler handler)</span>
                        
                      </span> registers the DTD handler identified by <span class="EmphasisFontCategoryNonProportional ">handler</span> with the parser. The <span class="EmphasisFontCategoryNonProportional ">DTDHandler</span> interface provides a pair of callback methods for reporting on notations and external unparsed entities.</p></li><li><p class="Para" id="Par28"><span id="ITerm18">
                        <span class="EmphasisFontCategoryNonProportional ">void setEntityResolver(EntityResolver resolver)</span>
                        
                      </span> registers the entity resolver identified by <span class="EmphasisFontCategoryNonProportional ">resolver</span> with the parser. The <span class="EmphasisFontCategoryNonProportional ">EntityResolver</span> interface provides a single callback method for resolving entities.</p></li><li><p class="Para" id="Par29"><span id="ITerm19">
                        <span class="EmphasisFontCategoryNonProportional ">void setErrorHandler(ErrorHandler handler)</span>
                        
                      </span> registers the error handler identified by <span class="EmphasisFontCategoryNonProportional ">handler</span> with the parser. The <span class="EmphasisFontCategoryNonProportional ">ErrorHandler</span> interface provides three callback methods that report <em class="EmphasisTypeItalic ">fatal errors</em> (problems that prevent further parsing, such as well-formedness violations), <em class="EmphasisTypeItalic ">recoverable errors</em> (problems that don鈥檛 prevent further parsing, such as validation failures), and <em class="EmphasisTypeItalic ">warnings</em> (nonerrors that need to be addressed, such as prefixing an element name with the W3C-reserved <span class="EmphasisFontCategoryNonProportional ">xml</span> prefix).</p></li><li><p class="Para" id="Par30"><span id="ITerm20">
                        <span class="EmphasisFontCategoryNonProportional ">void setFeature(String name, boolean value)</span>
                        
                      </span> assigns <span class="EmphasisFontCategoryNonProportional ">value</span> to the feature identified by <span class="EmphasisFontCategoryNonProportional ">name</span>, which must be a fully qualified URI. This method throws <span class="EmphasisFontCategoryNonProportional ">SAXNotRecognizedException</span> when the name isn鈥檛 recognized as a feature, and throws <span class="EmphasisFontCategoryNonProportional ">SAXNotSupportedException</span> when the name is recognized but the associated value cannot be set when <span class="EmphasisFontCategoryNonProportional ">setFeature()</span> is called.</p></li><li><p class="Para" id="Par31"><span id="ITerm21">
                        <span class="EmphasisFontCategoryNonProportional ">void setProperty(String name, Object value)</span>
                        
                      </span> assigns <span class="EmphasisFontCategoryNonProportional ">value</span> to the property identified by <span class="EmphasisFontCategoryNonProportional ">name</span>, which must be a fully qualified URI. This method throws <span class="EmphasisFontCategoryNonProportional ">SAXNotRecognizedException</span> when the name isn鈥檛 recognized as a property, and throws <span class="EmphasisFontCategoryNonProportional ">SAXNotSupportedException</span> when the name is recognized but the associated value cannot be set when <span class="EmphasisFontCategoryNonProportional ">setProperty()</span> is called.</p></li></ul></div></div><p class="Para" id="Par32">When a handler isn鈥檛 installed, all events pertaining to that handler are silently ignored. Not installing an error handler can be problematic because normal processing might not continue and the application wouldn鈥檛 be aware that anything had gone wrong. When an entity resolver isn鈥檛 installed, the parser performs its own default resolution. I鈥檒l have more to say about entity resolution later in this chapter.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar4"><h3 class="Heading">Note</h3><p class="Para" id="Par33">You typically install a new content handler, DTD handler, entity resolver, or error handler before a document is parsed, but can also do so while parsing the document. The parser starts using the handler when the next event occurs.</p></div><section class="Section3 RenderAsSection3" id="Sec5"><h4 class="Heading">Setting Features and Properties</h4><p class="Para" id="Par34">After obtaining an <span class="EmphasisFontCategoryNonProportional ">XMLReader</span> object, you can configure that object by setting its <span id="ITerm22">features and properties</span>. A <em class="EmphasisTypeItalic ">feature</em> is a name/value pair that describes a parser mode, such as validation. In contrast, a <em class="EmphasisTypeItalic ">property</em> is a name/value pair that describes some other aspect of the parser interface, such as a lexical handler that augments the content handler by providing callback methods for reporting on comments, CDATA delimiters, and a few other syntactic constructs.</p><div class="Para" id="Par35">Features and properties have names, which must be absolute URIs beginning with the <span class="EmphasisFontCategoryNonProportional ">http://</span> prefix. A feature鈥檚 value is always a Boolean <span class="EmphasisFontCategoryNonProportional ">true</span>/<span class="EmphasisFontCategoryNonProportional ">false</span> value. In contrast, a property鈥檚 value is an arbitrary object. The following code fragment demonstrates setting a feature and a property:<div class="ProgramCode" id="PC2"><div class="LineGroup"><div class="FixedLine">String FEAT_VAL = &quot;http://xml.org/sax/features/validation&quot;;</div><div class="FixedLine">xmlr.setFeature(FEAT_VAL, true);</div><div class="FixedLine">String PROP_LH = &quot;http://xml.org/sax/properties/lexical-handler&quot;;</div><div class="FixedLine">xmlr.setProperty(PROP_LH, new LexicalHandler() { /* ... */ });</div></div></div></div><p class="Para" id="Par36">The <span class="EmphasisFontCategoryNonProportional ">setFeature()</span> call<span id="ITerm23">
                    
                  </span> enables the <span class="EmphasisFontCategoryNonProportional ">validation</span> feature so that the parser will perform validation. Feature names are prefixed with <span class="ExternalRef"><a href="http://xml.org/sax/features/"><span class="RefSource">
                      <span class="EmphasisFontCategoryNonProportional ">http://xml.org/sax/features/</span>
                    </span></a></span>.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar5"><h3 class="Heading">Note</h3><p class="Para" id="Par37">Parsers must support the <span class="EmphasisFontCategoryNonProportional ">namespaces</span> and <span class="EmphasisFontCategoryNonProportional ">namespace-prefixes</span> features. <span class="EmphasisFontCategoryNonProportional ">namespaces</span> decides whether URIs and local names are passed to <span class="EmphasisFontCategoryNonProportional ">ContentHandler</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">startElement()</span> and <span class="EmphasisFontCategoryNonProportional ">endElement()</span> methods. It defaults to <span class="EmphasisFontCategoryNonProportional ">true</span>鈥攖hese names are passed. The parser can pass empty strings when <span class="EmphasisFontCategoryNonProportional ">false</span>. <span class="EmphasisFontCategoryNonProportional ">namespace-prefixes</span> decides whether a namespace declaration鈥檚 <span class="EmphasisFontCategoryNonProportional ">xmlns</span> and <span class="EmphasisFontCategoryNonProportional ">xmlns:prefix</span> attributes are included in the <span class="EmphasisFontCategoryNonProportional ">org.xml.sax.Attributes</span> list passed to <span class="EmphasisFontCategoryNonProportional ">startElement()</span>, and also decides whether qualified names are passed as the method鈥檚 third argument鈥攁 <em class="EmphasisTypeItalic ">qualified name</em> is a prefix plus a local name. It defaults to <span class="EmphasisFontCategoryNonProportional ">false</span>, meaning that <span class="EmphasisFontCategoryNonProportional ">xmlns</span> and <span class="EmphasisFontCategoryNonProportional ">xmlns:prefix</span> aren鈥檛 included and meaning that parsers don鈥檛 have to pass qualified names. No properties are mandatory. The JDK documentation鈥檚 <span class="EmphasisFontCategoryNonProportional ">org.xml.sax</span> package page lists standard SAX 2 features and properties.</p></div><p class="Para" id="Par38">The <span class="EmphasisFontCategoryNonProportional ">setProperty()</span> call<span id="ITerm24">
                    
                  </span> assigns an instance of a class that implements the <span class="EmphasisFontCategoryNonProportional ">org.xml.sax.ext.LexicalHandler</span> interface to the <span class="EmphasisFontCategoryNonProportional ">lexical-handler</span> property so that interface methods can be called to report on comments, CDATA sections, and so on. Property names are prefixed with <span class="ExternalRef"><a href="http://xml.org/sax/properties/"><span class="RefSource">
                      <span class="EmphasisFontCategoryNonProportional ">http://xml.org/sax/properties/</span>
                    </span></a></span>.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar6"><h3 class="Heading">Note</h3><p class="Para" id="Par39">Unlike <span class="EmphasisFontCategoryNonProportional ">ContentHandler</span>, <span class="EmphasisFontCategoryNonProportional ">DTDHandler</span>, <span class="EmphasisFontCategoryNonProportional ">EntityResolver</span>, and <span class="EmphasisFontCategoryNonProportional ">ErrorHandler</span>, <span class="EmphasisFontCategoryNonProportional ">LexicalHandler</span> is an extension (it鈥檚 not part of the core SAX API), which is why <span class="EmphasisFontCategoryNonProportional ">XMLReader</span> doesn鈥檛 declare a <span class="EmphasisFontCategoryNonProportional ">void setLexicalHandler(LexicalHandler handler)</span> method. If you want to install a lexical handler, you must use <span class="EmphasisFontCategoryNonProportional ">XMLReader</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">setProperty()</span> method to install the handler as the value of the <span class="ExternalRef"><a href="http://xml.org/sax/properties/lexical-handler"><span class="RefSource">
                        <span class="EmphasisFontCategoryNonProportional ">http://xml.org/sax/properties/lexical-handler</span>
                      </span></a></span> property.</p></div><p class="Para" id="Par40">Features and properties can be read-only or read-write. (In some rare cases, a feature or property might be write-only.) When setting or reading a feature or property, <span class="EmphasisFontCategoryNonProportional ">SAXNotSupportedException</span> or <span class="EmphasisFontCategoryNonProportional ">SAXNotRecognizedException</span> might be thrown. For example, if you try to modify a read-only feature/property, an instance of the <span class="EmphasisFontCategoryNonProportional ">SAXNotSupportedException</span> class is <span id="ITerm25">thrown</span>. Also, this exception could be thrown if you call <span class="EmphasisFontCategoryNonProportional ">setFeature()</span> or <span class="EmphasisFontCategoryNonProportional ">setProperty()</span> during parsing. Trying to set the validation feature for a parser that doesn鈥檛 perform validation is a scenario where an instance of the <span class="EmphasisFontCategoryNonProportional ">SAXNotRecognizedException</span> class is thrown.</p></section></section><section class="Section2 RenderAsSection2" id="Sec6"><h3 class="Heading">Touring the Handler and Resolver Interfaces</h3><p class="Para" id="Par41">The interface-based handlers installed by <span class="EmphasisFontCategoryNonProportional ">setContentHandler()</span>, <span class="EmphasisFontCategoryNonProportional ">setDTDHandler()</span>, and <span class="EmphasisFontCategoryNonProportional ">setErrorHandler()</span>; the entity resolver installed by <span class="EmphasisFontCategoryNonProportional ">setEntityResolver()</span>; and the handler described by the <span class="EmphasisFontCategoryNonProportional ">lexical-handler</span> property provide various callback methods. You need to understand these methods before you can codify them to respond effectively to parsing events.</p><section class="Section3 RenderAsSection3" id="Sec7"><h4 class="Heading">Touring ContentHandler</h4><div class="Para" id="Par42"><span id="ITerm26">
                    <span class="EmphasisFontCategoryNonProportional ">ContentHandler</span>
                    
                  </span>
declares the following content-oriented informational callback methods:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par43"><span class="EmphasisFontCategoryNonProportional ">void characters(char[] ch, int start, int length)</span> reports an element鈥檚 character data via the <span class="EmphasisFontCategoryNonProportional ">ch</span> array. The arguments that are passed to <span class="EmphasisFontCategoryNonProportional ">start</span> and <span class="EmphasisFontCategoryNonProportional ">length</span> identify that portion of the array that鈥檚 relevant to this method call. Characters are passed via a <span class="EmphasisFontCategoryNonProportional ">char[]</span> array instead of via a <span class="EmphasisFontCategoryNonProportional ">String</span> object as a performance optimization. Parsers commonly store a large amount of the document in an array and repeatedly pass a reference to this array along with updated <span class="EmphasisFontCategoryNonProportional ">start</span> and <span class="EmphasisFontCategoryNonProportional ">length</span> values to <span class="EmphasisFontCategoryNonProportional ">characters()</span>.</p></li><li><p class="Para" id="Par44"><span class="EmphasisFontCategoryNonProportional ">void endDocument()</span> reports that the end of the document has been reached. An application might use this method to close an output file or perform some other cleanup.</p></li><li><p class="Para" id="Par45"><span class="EmphasisFontCategoryNonProportional ">void endElement(String uri, String localName, String qName)</span> reports that the end of an element has been reached. <span class="EmphasisFontCategoryNonProportional ">uri</span> identifies the element鈥檚 namespace URI or is empty when there is no namespace URI or namespace processing hasn鈥檛 been enabled. <span class="EmphasisFontCategoryNonProportional ">localName</span> identifies the element鈥檚 local name, which is the name without a prefix (e.g., the <span class="EmphasisFontCategoryNonProportional ">html</span> in <span class="EmphasisFontCategoryNonProportional ">html</span> or <span class="EmphasisFontCategoryNonProportional ">h:html</span>). <span class="EmphasisFontCategoryNonProportional ">qName</span> references the qualified name, for example, <span class="EmphasisFontCategoryNonProportional ">h:html</span> or <span class="EmphasisFontCategoryNonProportional ">html</span> when there is no prefix. <span class="EmphasisFontCategoryNonProportional ">endElement()</span> is invoked when an end tag is detected, or immediately following <span class="EmphasisFontCategoryNonProportional ">startElement()</span> when an empty-element tag is detected.</p></li><li><p class="Para" id="Par46"><span class="EmphasisFontCategoryNonProportional ">void endPrefixMapping(String prefix)</span> reports that the end of a namespace prefix mapping (e.g., <span class="EmphasisFontCategoryNonProportional ">xmlns:h</span>) has been reached, and <span class="EmphasisFontCategoryNonProportional ">prefix</span> reports this prefix (e.g., <span class="EmphasisFontCategoryNonProportional ">h</span>).</p></li><li><p class="Para" id="Par47"><span class="EmphasisFontCategoryNonProportional ">void ignorableWhitespace(char[] ch, int start, int length)</span> reports <em class="EmphasisTypeItalic ">ignorable whitespace</em> (whitespace located between tags where the DTD doesn鈥檛 allow mixed content). This whitespace is often used to indent tags. The parameters serve the same purpose as those in the <span class="EmphasisFontCategoryNonProportional ">characters()</span> method.</p></li><li><p class="Para" id="Par48"><span class="EmphasisFontCategoryNonProportional ">void processingInstruction(String target, String data)</span> reports a processing instruction, in which <span class="EmphasisFontCategoryNonProportional ">target</span> identifies the application to which the instruction is directed and <span class="EmphasisFontCategoryNonProportional ">data</span> provides the instruction鈥檚 data (the null reference when there is no data).</p></li><li><p class="Para" id="Par49"><span class="EmphasisFontCategoryNonProportional ">void setDocumentLocator(Locator locator)</span> reports an <span class="EmphasisFontCategoryNonProportional ">org.xml.sax.Locator</span> object (an instance of a class implementing the <span class="EmphasisFontCategoryNonProportional ">Locator</span> interface) whose <span class="EmphasisFontCategoryNonProportional ">int getColumnNumber()</span>, <span class="EmphasisFontCategoryNonProportional ">int getLineNumber()</span>, <span class="EmphasisFontCategoryNonProportional ">String getPublicId()</span>, and <span class="EmphasisFontCategoryNonProportional ">String getSystemId()</span> methods can be called to obtain location information at the end position of any document-related event, even when the parser isn鈥檛 reporting an error. This method is called before <span class="EmphasisFontCategoryNonProportional ">startDocument()</span> and is a good place to save the <span class="EmphasisFontCategoryNonProportional ">Locator</span> object so that it can be accessed from other callback methods.</p></li><li><p class="Para" id="Par50"><span class="EmphasisFontCategoryNonProportional ">void skippedEntity(String name)</span> reports all skipped entities. Validating parsers resolve all general entity references, but nonvalidating parsers have the option of skipping them because nonvalidating parsers don鈥檛 read DTDs where these entities are declared. If the nonvalidating parser doesn鈥檛 read a DTD, it will not know if an entity is properly declared. Instead of attempting to read the DTD and report the entity鈥檚 replacement text, the nonvalidating parser calls <span class="EmphasisFontCategoryNonProportional ">skippedEntity()</span> with the entity鈥檚 name.</p></li><li><p class="Para" id="Par51"><span class="EmphasisFontCategoryNonProportional ">void startDocument()</span> reports that the start of the document has been reached. An application might use this method to create an output file or perform some other initialization.</p></li><li><p class="Para" id="Par52"><span class="EmphasisFontCategoryNonProportional ">void startElement(String uri, String localName, String qName, Attributes attributes)</span> reports that the start of an element has been reached. <span class="EmphasisFontCategoryNonProportional ">uri</span> identifies the element鈥檚 namespace URI or is empty when there is no namespace URI or namespace processing hasn鈥檛 been enabled. <span class="EmphasisFontCategoryNonProportional ">localName</span> identifies the element鈥檚 local name, <span class="EmphasisFontCategoryNonProportional ">qName</span> references its qualified name, and <span class="EmphasisFontCategoryNonProportional ">attributes</span> references a list of the element鈥檚 attributes鈥攖his list is empty when there are no attributes. <span class="EmphasisFontCategoryNonProportional ">startElement()</span> is invoked when a start tag or an empty-element tag is detected.</p></li><li><p class="Para" id="Par53"><span class="EmphasisFontCategoryNonProportional ">void startPrefixMapping(String prefix, String uri)</span> reports that the start of a namespace prefix mapping (e.g., <span class="EmphasisFontCategoryNonProportional ">xmlns:h=&quot;</span><span class="ExternalRef"><a href="http://www.w3.org/1999/xhtml"><span class="RefSource">
                            <span class="EmphasisFontCategoryNonProportional ">http://www.w3.org/1999/xhtml</span>
                          </span></a></span><span class="EmphasisFontCategoryNonProportional ">&quot;</span>) has been reached, in which <span class="EmphasisFontCategoryNonProportional ">prefix</span> reports this prefix (such as <span class="EmphasisFontCategoryNonProportional ">h</span>) and <span class="EmphasisFontCategoryNonProportional ">uri</span> reports the URI to which the prefix is mapped (e.g., <span class="ExternalRef"><a href="http://www.w3.org/1999/xhtml"><span class="RefSource">
                            <span class="EmphasisFontCategoryNonProportional ">http://www.w3.org/1999/xhtml</span>
                          </span></a></span>).</p></li></ul></div></div><p class="Para" id="Par54">Each method except for <span class="EmphasisFontCategoryNonProportional ">setDocumentLocator()</span> is declared to throw <span class="EmphasisFontCategoryNonProportional ">SAXException</span>, which an overriding callback method might choose to throw when it detects a problem.</p></section><section class="Section3 RenderAsSection3" id="Sec8"><h4 class="Heading">Touring DTDHandler</h4><div class="Para" id="Par55"><span id="ITerm27">
                    <span class="EmphasisFontCategoryNonProportional ">DTDHandler</span>
                    
                  </span> declares the following DTD-oriented informational callback methods:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par56"><span class="EmphasisFontCategoryNonProportional ">void notationDecl(String name, String publicId, String systemId)</span> reports a notation declaration, in which <span class="EmphasisFontCategoryNonProportional ">name</span> provides this declaration鈥檚 <span class="EmphasisFontCategoryNonProportional ">name</span> attribute value, <span class="EmphasisFontCategoryNonProportional ">publicId</span> provides this declaration鈥檚 <span class="EmphasisFontCategoryNonProportional ">public</span> attribute value (the null reference when this value isn鈥檛 available), and <span class="EmphasisFontCategoryNonProportional ">systemId</span> provides this declaration鈥檚 <span class="EmphasisFontCategoryNonProportional ">system</span> attribute value.</p></li><li><p class="Para" id="Par57"><span class="EmphasisFontCategoryNonProportional ">void unparsedEntityDecl(String name, String publicId, String systemId, String notationName)</span> reports an external unparsed entity declaration, in which <span class="EmphasisFontCategoryNonProportional ">name</span> provides the value of this declaration鈥檚 <span class="EmphasisFontCategoryNonProportional ">name</span> attribute, <span class="EmphasisFontCategoryNonProportional ">publicId</span> provides the value of the <span class="EmphasisFontCategoryNonProportional ">public</span> attribute (the null reference when this value isn鈥檛 available), <span class="EmphasisFontCategoryNonProportional ">systemId</span> provides the value of the <span class="EmphasisFontCategoryNonProportional ">system</span> attribute, and <span class="EmphasisFontCategoryNonProportional ">notationName</span> provides the <span class="EmphasisFontCategoryNonProportional ">NDATA</span> name.</p></li></ul></div></div><p class="Para" id="Par58">Each method is declared to throw <span class="EmphasisFontCategoryNonProportional ">SAXException</span>, which an overriding callback <span id="ITerm28">method</span> might choose to throw when it detects a problem.</p></section><section class="Section3 RenderAsSection3" id="Sec9"><h4 class="Heading">Touring ErrorHandler</h4><div class="Para" id="Par59"><span id="ITerm29">
                    <span class="EmphasisFontCategoryNonProportional ">ErrorHandler</span>
                    
                  </span> declares the following error-oriented informational callback methods:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par60"><span class="EmphasisFontCategoryNonProportional ">void error(SAXParseException exception)</span> reports that a recoverable parser error (typically the document isn鈥檛 valid) has occurred; the details are specified via the argument passed to <span class="EmphasisFontCategoryNonProportional ">exception</span>. This method is typically overridden to report the error via a command window or to log it to a file or a database.</p></li><li><p class="Para" id="Par61"><span class="EmphasisFontCategoryNonProportional ">void fatalError(SAXParseException exception)</span> reports that an unrecoverable parser error (the document isn鈥檛 well formed) has occurred; the details are specified via the argument passed to <span class="EmphasisFontCategoryNonProportional ">exception</span>. This method is typically overridden so that the application can log the error before it stops processing the document (because the document is no longer reliable).</p></li><li><p class="Para" id="Par62"><span class="EmphasisFontCategoryNonProportional ">void warning(SAXParseException e)</span> reports that a nonserious error (such as an element name beginning with the reserved <span class="EmphasisFontCategoryNonProportional ">xml</span> character sequence) has occurred; the details are specified via the argument passed to <span class="EmphasisFontCategoryNonProportional ">exception</span>. This method is typically overridden to report the warning via a console or to log it to a file or a database.</p></li></ul></div></div><p class="Para" id="Par63">Each <span id="ITerm30">method</span> is declared to throw <span class="EmphasisFontCategoryNonProportional ">SAXException</span>, which an overriding callback method might choose to throw when it detects a problem.</p></section><section class="Section3 RenderAsSection3" id="Sec10"><h4 class="Heading">Touring EntityResolver</h4><div class="Para" id="Par64"><span id="ITerm31">
                    <span class="EmphasisFontCategoryNonProportional ">EntityResolver</span>
                    
                  </span> declares the following callback method:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par65"><span class="EmphasisFontCategoryNonProportional ">InputSource resolveEntity(String publicId, String systemId)</span> is called to let the application resolve an external entity (such as an external DTD subset) by returning a custom <span class="EmphasisFontCategoryNonProportional ">InputSource</span> object that鈥檚 based on a different URI. This method is declared to throw <span class="EmphasisFontCategoryNonProportional ">SAXException</span> when it detects a SAX-oriented problem and is also declared to throw <span class="EmphasisFontCategoryNonProportional ">IOException</span> when it encounters an I/O error, possibly in response to creating an <span class="EmphasisFontCategoryNonProportional ">InputStream</span> object or a <span class="EmphasisFontCategoryNonProportional ">java.io.Reader</span> object for the <span class="EmphasisFontCategoryNonProportional ">InputSource</span> being created.</p></li></ul></div></div></section><section class="Section3 RenderAsSection3" id="Sec11"><h4 class="Heading">Touring LexicalHandler</h4><div class="Para" id="Par66"><span id="ITerm32">
                    <span class="EmphasisFontCategoryNonProportional ">LexicalHandler</span>
                    
                  </span> declares the following additional content-oriented informational callback methods:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par67"><span class="EmphasisFontCategoryNonProportional ">void comment(char[] ch, int start, int length)</span> reports a comment via the <span class="EmphasisFontCategoryNonProportional ">ch</span> array. The arguments that are passed to <span class="EmphasisFontCategoryNonProportional ">start</span> and <span class="EmphasisFontCategoryNonProportional ">length</span> identify that portion of the array that鈥檚 relevant to this method call.</p></li><li><p class="Para" id="Par68"><span class="EmphasisFontCategoryNonProportional ">void endCDATA()</span> reports the end of a CDATA section.</p></li><li><p class="Para" id="Par69"><span class="EmphasisFontCategoryNonProportional ">void endDTD()</span> reports the end of a DTD.</p></li><li><p class="Para" id="Par70"><span class="EmphasisFontCategoryNonProportional ">void endEntity(String name)</span> reports the end of the entity identified by <span class="EmphasisFontCategoryNonProportional ">name</span>.</p></li><li><p class="Para" id="Par71"><span class="EmphasisFontCategoryNonProportional ">void startCDATA()</span> reports the start of a CDATA section.</p></li><li><p class="Para" id="Par72"><span class="EmphasisFontCategoryNonProportional ">void startDTD(String name, String publicId, String systemId)</span> reports the start of the DTD identified by <span class="EmphasisFontCategoryNonProportional ">name</span>. <span class="EmphasisFontCategoryNonProportional ">publicId</span> specifies the declared public identifier for the external DTD subset or is the null reference when none was declared. Similarly, <span class="EmphasisFontCategoryNonProportional ">systemId</span> specifies the declared system identifier for the external DTD subset or is the null reference when none was declared.</p></li><li><p class="Para" id="Par73"><span class="EmphasisFontCategoryNonProportional ">void startEntity(String name)</span> reports the start of the entity identified by <span class="EmphasisFontCategoryNonProportional ">name</span>.</p></li></ul></div></div><p class="Para" id="Par74">Each <span id="ITerm33">method</span> is declared to throw <span class="EmphasisFontCategoryNonProportional ">SAXException</span>, which an overriding callback method might choose to throw when it detects a problem.</p><p class="Para" id="Par75">Because it can be tedious to implement all of the methods in each interface, the SAX API conveniently provides the <span class="EmphasisFontCategoryNonProportional ">org.xml.sax.helpers.DefaultHandler</span> adapter class to relieve you of this tedium. <span class="EmphasisFontCategoryNonProportional ">DefaultHandler</span> implements <span class="EmphasisFontCategoryNonProportional ">ContentHandler</span>, <span class="EmphasisFontCategoryNonProportional ">DTDHandler</span>, <span class="EmphasisFontCategoryNonProportional ">EntityResolver</span>, and <span class="EmphasisFontCategoryNonProportional ">ErrorHandler</span>. SAX also provides <span class="EmphasisFontCategoryNonProportional ">org.xml.sax.ext.DefaultHandler2</span>, which subclasses <span class="EmphasisFontCategoryNonProportional ">DefaultHandler</span> and which also implements <span class="EmphasisFontCategoryNonProportional ">LexicalHandler</span>.</p></section></section></section><section class="Section1 RenderAsSection1" id="Sec12"><h2 class="Heading">Demonstrating the SAX API</h2><div class="Para" id="Par76">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_2_Chapter.xhtml#PC3">2-1</a></span> presents the source code to <span class="EmphasisFontCategoryNonProportional ">SAXDemo</span>, an application that demonstrates the SAX API. The application consists of a <span class="EmphasisFontCategoryNonProportional ">SAXDemo</span> entry-point <span id="ITerm34">class</span> and a <span class="EmphasisFontCategoryNonProportional ">Handler</span> subclass of <span class="EmphasisFontCategoryNonProportional ">DefaultHandler2</span>.<div class="ProgramCode" id="PC3"><div class="LineGroup"><div class="FixedLine">import java.io.FileReader;</div><div class="FixedLine">import java.io.IOException;</div></div><div class="LineGroup"><div class="FixedLine">import javax.xml.parsers.ParserConfigurationException;</div><div class="FixedLine">import javax.xml.parsers.SAXParser;</div><div class="FixedLine">import javax.xml.parsers.SAXParserFactory;</div></div><div class="LineGroup"><div class="FixedLine">import org.xml.sax.InputSource;</div><div class="FixedLine">import org.xml.sax.SAXException;</div><div class="FixedLine">import org.xml.sax.XMLReader;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class SAXDemo</div><div class="FixedLine">{</div><div class="FixedLine">   final static String FEAT_NSP =</div><div class="FixedLine">      &quot;http://xml.org/sax/features/namespace-prefixes&quot;;</div></div><div class="LineGroup"><div class="FixedLine">   final static String FEAT_VAL =</div><div class="FixedLine">      &quot;http://xml.org/sax/features/validation&quot;;</div></div><div class="LineGroup"><div class="FixedLine">   final static String PROP_LH =</div><div class="FixedLine">      &quot;http://xml.org/sax/properties/lexical-handler&quot;;</div></div><div class="LineGroup"><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      if (args.length &lt; 1 || args.length &gt; 2)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.println(&quot;usage: java SAXDemo xmlfile [v]&quot;);</div><div class="FixedLine">         return;</div><div class="FixedLine">      }</div><div class="FixedLine">      try</div><div class="FixedLine">      {</div><div class="FixedLine">         SAXParserFactory spf =</div><div class="FixedLine">            SAXParserFactory.newInstance();</div><div class="FixedLine">         spf.setNamespaceAware(true);</div><div class="FixedLine">         SAXParser sp = spf.newSAXParser();</div><div class="FixedLine">         XMLReader xmlr = sp.getXMLReader();</div><div class="FixedLine">         if (args.length == 2 &amp;&amp; args[1].equals(&quot;v&quot;))</div><div class="FixedLine">            xmlr.setFeature(FEAT_VAL, true);</div><div class="FixedLine">         xmlr.setFeature(FEAT_NSP, true);</div><div class="FixedLine">         Handler handler = new Handler();</div><div class="FixedLine">         xmlr.setContentHandler(handler);</div><div class="FixedLine">         xmlr.setDTDHandler(handler);</div><div class="FixedLine">         xmlr.setEntityResolver(handler);</div><div class="FixedLine">         xmlr.setErrorHandler(handler);</div><div class="FixedLine">         xmlr.setProperty(PROP_LH, handler);</div><div class="FixedLine">         FileReader fr = new FileReader(args[0]);</div><div class="FixedLine">         xmlr.parse(new InputSource(fr));</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (IOException ioe)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;IOE: %s%n&quot;, ioe.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (ParserConfigurationException pce)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;PCE: %s%n&quot;, pce.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (SAXException saxe) <span id="ITerm35">
                      
                      
                    </span></div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;SAXE: %s%n&quot;, saxe.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 2-1</span><p class="SimplePara">
                      <span class="EmphasisFontCategoryNonProportional ">SAXDemo</span>
                    </p></div></div></div></div><p class="Para" id="Par77"><span class="EmphasisFontCategoryNonProportional ">SAXDemo</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">main()</span> method<span id="ITerm36">
                
              </span> first verifies that one or two command-line arguments (the name of an XML document optionally followed by lowercase letter <span class="EmphasisFontCategoryNonProportional ">v</span>, which tells <span class="EmphasisFontCategoryNonProportional ">SAXDemo</span> to create a validating parser) have been specified. It then creates an <span class="EmphasisFontCategoryNonProportional ">XMLReader</span> object; conditionally enables the <span class="EmphasisFontCategoryNonProportional ">validation</span> feature and enables the <span class="EmphasisFontCategoryNonProportional ">namespace-prefixes</span> feature; instantiates the companion <span class="EmphasisFontCategoryNonProportional ">Handler</span> class; installs this <span class="EmphasisFontCategoryNonProportional ">Handler</span> object as the parser鈥檚 content handler, DTD handler, entity resolver, and error handler; installs this <span class="EmphasisFontCategoryNonProportional ">Handler</span> object as the value of the <span class="EmphasisFontCategoryNonProportional ">lexical-handler</span> property; creates an input source to read the document from a file; and parses the document.</p><div class="Para" id="Par78">The <span class="EmphasisFontCategoryNonProportional ">Handler</span> class鈥檚 source <span id="ITerm37">code</span> is presented in Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_2_Chapter.xhtml#PC4">2-2</a></span>.<div class="ProgramCode" id="PC4"><div class="LineGroup"><div class="FixedLine">import org.xml.sax.Attributes;</div><div class="FixedLine">import org.xml.sax.InputSource;</div><div class="FixedLine">import org.xml.sax.Locator;</div><div class="FixedLine">import org.xml.sax.SAXParseException;</div></div><div class="LineGroup"><div class="FixedLine">import org.xml.sax.ext.DefaultHandler2;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class Handler extends DefaultHandler2</div><div class="FixedLine">{</div><div class="FixedLine">   private Locator locator;</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public void characters(char[] ch, int start, int length)</div><div class="FixedLine">   {</div><div class="FixedLine">      out.print(&quot;characters() [&quot;);</div><div class="FixedLine">      for (int i = start; i &lt; start + length; i++)</div><div class="FixedLine">         out.print(ch[i]);</div><div class="FixedLine">      out.println(&quot;]&quot;);</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public void comment(char[] ch, int start, int length)</div><div class="FixedLine">   {</div><div class="FixedLine">      out.print(&quot;characters() [&quot;);</div><div class="FixedLine">      for (int i = start; i &lt; start + length; i++)</div><div class="FixedLine">         out.print(ch[i]);</div><div class="FixedLine">      out.println(&quot;]&quot;);</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public void endCDATA()</div><div class="FixedLine">   {</div><div class="FixedLine">      out.println(&quot;endCDATA()&quot;);</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public void endDocument()</div><div class="FixedLine">   {</div><div class="FixedLine">      out.println(&quot;endDocument()&quot;);</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public void endDTD()</div><div class="FixedLine">   {</div><div class="FixedLine">      out.println(&quot;endDTD()&quot;);</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public void endElement(String uri, String localName,</div><div class="FixedLine">                          String qName)</div><div class="FixedLine">   {</div><div class="FixedLine">      out.print(&quot;endElement() &quot;);</div><div class="FixedLine">      out.printf(&quot;uri=[%s], &quot;, uri);</div><div class="FixedLine">      out.printf(&quot;localName=[%s], &quot;, localName);</div><div class="FixedLine">      out.printf(&quot;qName=[%s]%n&quot;, qName);</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public void endEntity(String name)</div><div class="FixedLine">   {</div><div class="FixedLine">      out.print(&quot;endEntity() &quot;);</div><div class="FixedLine">      out.printf(&quot;name=[%s]%n&quot;, name);</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public void endPrefixMapping(String prefix)</div><div class="FixedLine">   {</div><div class="FixedLine">      out.print(&quot;endPrefixMapping() &quot;);</div><div class="FixedLine">      out.printf(&quot;prefix=[%s]%n&quot;, prefix);</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public void error(SAXParseException saxpe)</div><div class="FixedLine">   {</div><div class="FixedLine">      out.printf(&quot;error() %s%n&quot;, saxpe.toString());</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public void fatalError(SAXParseException saxpe)</div><div class="FixedLine">   {</div><div class="FixedLine">      out.printf(&quot;fatalError() %s%n&quot;, saxpe.toString());</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public void ignorableWhitespace(char[] ch, int start, int length)</div><div class="FixedLine">   {</div><div class="FixedLine">      out.print(&quot;ignorableWhitespace() [&quot;);</div><div class="FixedLine">      for (int i = start; i &lt; start + length; i++)</div><div class="FixedLine">         out.print(ch[i]);</div><div class="FixedLine">      out.println(&quot;]&quot;);</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public void notationDecl(String name, String publicId,</div><div class="FixedLine">                            String systemId)</div><div class="FixedLine">   {</div><div class="FixedLine">      out.print(&quot;notationDecl() &quot;);</div><div class="FixedLine">      out.printf(&quot;name=[%s], &quot;, name);</div><div class="FixedLine">      out.printf(&quot;publicId=[%s], &quot;, publicId);</div><div class="FixedLine">      out.printf(&quot;systemId=[%s]%n&quot;, systemId);</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public void processingInstruction(String target, String data)</div><div class="FixedLine">   {</div><div class="FixedLine">      out.print(&quot;processingInstruction() &quot;);</div><div class="FixedLine">      out.printf(&quot;target=[%s], &quot;, target);</div><div class="FixedLine">      out.printf(&quot;data=[%s]%n&quot;, data);</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public InputSource resolveEntity(String publicId, String systemId)</div><div class="FixedLine">   {</div><div class="FixedLine">      out.print(&quot;resolveEntity() &quot;);</div><div class="FixedLine">      out.printf(&quot;publicId=[%s], &quot;, publicId);</div><div class="FixedLine">      out.printf(&quot;systemId=[%s]%n&quot;, systemId);</div><div class="FixedLine">      // Do not perform a remapping.</div><div class="FixedLine">      InputSource is = new InputSource();</div><div class="FixedLine">      is.setPublicId(publicId);</div><div class="FixedLine">      is.setSystemId(systemId);</div><div class="FixedLine">      return is;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public void setDocumentLocator(Locator locator)</div><div class="FixedLine">   {</div><div class="FixedLine">      out.print(&quot;setDocumentLocator() &quot;);</div><div class="FixedLine">      out.printf(&quot;locator=[%s]%n&quot;, locator);</div><div class="FixedLine">      this.locator = locator;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public void skippedEntity(String name)</div><div class="FixedLine">   {</div><div class="FixedLine">      out.print(&quot;skippedEntity() &quot;);</div><div class="FixedLine">      out.printf(&quot;name=[%s]%n&quot;, name);</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public void startCDATA()</div><div class="FixedLine">   {</div><div class="FixedLine">      out.println(&quot;startCDATA()&quot;);</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public void startDocument()</div><div class="FixedLine">   {</div><div class="FixedLine">      out.println(&quot;startDocument()&quot;);</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public void startDTD(String name, String publicId, String systemId)</div><div class="FixedLine">   {</div><div class="FixedLine">      out.print(&quot;startDTD() &quot;);</div><div class="FixedLine">      out.printf(&quot;name=[%s], &quot;, name);</div><div class="FixedLine">      out.printf(&quot;publicId=[%s], &quot;, publicId);</div><div class="FixedLine">      out.printf(&quot;systemId=[%s]%n&quot;, systemId);</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public void startElement(String uri, String localName, String qName, Attributes attributes)</div><div class="FixedLine">   {</div><div class="FixedLine">      out.print(&quot;startElement() &quot;);</div><div class="FixedLine">      out.printf(&quot;uri=[%s], &quot;, uri);</div><div class="FixedLine">      out.printf(&quot;localName=[%s], &quot;, localName);</div><div class="FixedLine">      out.printf(&quot;qName=[%s]%n&quot;, qName);</div><div class="FixedLine">      for (int i = 0; i &lt; attributes.getLength(); i++)</div><div class="FixedLine">         out.printf(&quot;  Attribute: %s, %s%n&quot;, attributes.getLocalName(i),</div><div class="FixedLine">                            attributes.getValue(i));</div><div class="FixedLine">      out.printf(&quot;Column number=[%d]%n&quot;, locator.getColumnNumber());</div><div class="FixedLine">      out.printf(&quot;Line number=[%d]%n&quot;, locator.getLineNumber());</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public void startEntity(String name)</div><div class="FixedLine">   {</div><div class="FixedLine">      out.print(&quot;startEntity() &quot;);</div><div class="FixedLine">      out.printf(&quot;name=[%s]%n&quot;, name);</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public void startPrefixMapping(String prefix, String uri)</div><div class="FixedLine">   {</div><div class="FixedLine">      out.print(&quot;startPrefixMapping() &quot;);</div><div class="FixedLine">      out.printf(&quot;prefix=[%s], &quot;, prefix);</div><div class="FixedLine">      out.printf(&quot;uri=[%s]%n&quot;, uri);</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public void unparsedEntityDecl(String name,</div><div class="FixedLine">                                  String publicId,</div><div class="FixedLine">                                  String systemId,</div><div class="FixedLine">                                  String notationName)</div><div class="FixedLine">   {</div><div class="FixedLine">      out.print(&quot;unparsedEntityDecl() &quot;);</div><div class="FixedLine">      out.printf(&quot;name=[%s], &quot;, name);</div><div class="FixedLine">      out.printf(&quot;publicId=[%s], &quot;, publicId);</div><div class="FixedLine">      out.printf(&quot;systemId=[%s], &quot;, systemId);</div><div class="FixedLine">      out.printf(&quot;notationName=[%s]%n&quot;, notationName);</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public void warning(SAXParseException saxpe)</div><div class="FixedLine">   {</div><div class="FixedLine">      out.printf(&quot;warning() %s%n&quot;, saxpe.toString());</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 2-2</span><p class="SimplePara">
                      <span class="EmphasisFontCategoryNonProportional ">Handler</span>
                    </p></div></div></div></div><p class="Para" id="Par79">The <span class="EmphasisFontCategoryNonProportional ">Handler</span> subclass is pretty straightforward; it outputs every possible piece of information about an XML document, subject to feature and property settings. You鈥檒l find this class handy for exploring the order in which events occur along with various features and properties.</p><div class="Para" id="Par80">Assuming that files based on Listings <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_2_Chapter.xhtml#PC3">2-1</a></span> and <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_2_Chapter.xhtml#PC4">2-2</a></span> are located in the same directory, compile them as follows:<div class="ProgramCode" id="PC5"><div class="LineGroup"><div class="FixedLine">javac SAXDemo.java</div></div></div></div><div class="Para" id="Par81">Execute the following command to parse Listing <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC4"><span class="RefSource">1-4</span></a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">svg-examples.xml</span> document:<div class="ProgramCode" id="PC6"><div class="LineGroup"><div class="FixedLine">java SAXDemo svg-examples.xml</div></div></div></div><div class="Para" id="Par82"><span class="EmphasisFontCategoryNonProportional ">SAXDemo</span> responds by presenting the following <span id="ITerm38">output</span> (the hashcode will probably be different):<div class="ProgramCode" id="PC7"><div class="LineGroup"><div class="FixedLine">setDocumentLocator() locator=[com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser$LocatorProxy@53b32d7]</div><div class="FixedLine">startDocument()</div><div class="FixedLine">startElement() uri=[], localName=[svg-examples], qName=[svg-examples]</div><div class="FixedLine">Column number=[15]</div><div class="FixedLine">Line number=[2]</div><div class="FixedLine">characters() [</div><div class="FixedLine">   ]</div><div class="FixedLine">startElement() uri=[], localName=[example], qName=[example]</div><div class="FixedLine">Column number=[13]</div><div class="FixedLine">Line number=[3]</div><div class="FixedLine">characters() [</div><div class="FixedLine">      The following Scalable Vector Graphics document ]</div><div class="FixedLine">characters() [</div><div class="FixedLine">      describes a blue-filled and black-stroked</div><div class="FixedLine">      rectangle.]</div><div class="FixedLine">characters() [</div><div class="FixedLine">      ]</div><div class="FixedLine">startCDATA()</div><div class="FixedLine">characters() [&lt;svg width=&quot;100%&quot; height=&quot;100%&quot;</div><div class="FixedLine">           version=&quot;1.1&quot;</div><div class="FixedLine">           xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;</div><div class="FixedLine">         &lt;rect width=&quot;300&quot; height=&quot;100&quot;</div><div class="FixedLine">               style=&quot;fill:rgb(0,0,255);stroke-width:1;</div><div class="FixedLine">                      stroke:rgb(0,0,0)&quot;/&gt;</div><div class="FixedLine">      &lt;/svg&gt;]</div><div class="FixedLine">endCDATA()</div><div class="FixedLine">characters() [</div><div class="FixedLine">   ]</div><div class="FixedLine">endElement() uri=[], localName=[example], qName=[example]</div><div class="FixedLine">characters() [</div><div class="FixedLine">]</div><div class="FixedLine">endElement() uri=[], localName=[svg-examples], qName=[svg-examples]</div><div class="FixedLine">endDocument()</div></div></div></div><p class="Para" id="Par83">The first <span id="ITerm39">output</span> line proves that <span class="EmphasisFontCategoryNonProportional ">setDocumentLocator()</span><span id="ITerm40">
                
              </span> is called first. The second and third lines also identify the <span class="EmphasisFontCategoryNonProportional ">Locator</span> object whose <span class="EmphasisFontCategoryNonProportional ">getColumnNumber()</span><span id="ITerm41">
                
              </span> and <span class="EmphasisFontCategoryNonProportional ">getLineNumber()</span> methods<span id="ITerm42">
                
              </span> are called to output the parser location when <span class="EmphasisFontCategoryNonProportional ">startElement()</span> is called鈥攖hese methods return column and line numbers starting at 1.</p><div class="Para" id="Par84">Perhaps you鈥檙e curious about the four instances of the following output:<div class="ProgramCode" id="PC8"><div class="LineGroup"><div class="FixedLine">characters() [</div><div class="FixedLine">   ]</div></div></div></div><p class="Para" id="Par85">The instance of this <span id="ITerm43">output</span> that follows the <span class="EmphasisFontCategoryNonProportional ">endCDATA()</span> output<span id="ITerm44">
                
              </span> is reporting a carriage return/line feed combination that wasn鈥檛 included in the preceding <span class="EmphasisFontCategoryNonProportional ">characters()</span> method call, which passed the contents of the CDATA section minus these line terminator characters. This is also the case for the instance of this output that follows the <span class="EmphasisFontCategoryNonProportional ">rectangle.]</span> output. In contrast, the instances of this output that follow the <span class="EmphasisFontCategoryNonProportional ">startElement()</span> call<span id="ITerm45">
                
              </span> for <span class="EmphasisFontCategoryNonProportional ">svg-examples</span> and follow the <span class="EmphasisFontCategoryNonProportional ">endElement()</span> call for <span class="EmphasisFontCategoryNonProportional ">example</span> are somewhat curious. There鈥檚 no content between <span class="EmphasisFontCategoryNonProportional ">&lt;svg-examples&gt;</span> and <span class="EmphasisFontCategoryNonProportional ">&lt;example&gt;</span>, and between <span class="EmphasisFontCategoryNonProportional ">&lt;/example&gt;</span> and <span class="EmphasisFontCategoryNonProportional ">&lt;/svg-examples&gt;</span>, or is there?</p><div class="Para" id="Par86">You can satisfy this curiosity by modifying <span class="EmphasisFontCategoryNonProportional ">svg-examples.xml</span> to include an internal DTD. Place the following DTD (which indicates that an <span class="EmphasisFontCategoryNonProportional ">svg-examples</span> element contains one or more <span class="EmphasisFontCategoryNonProportional ">example</span> elements and that an <span class="EmphasisFontCategoryNonProportional ">example</span> element contains parsed character data) between the XML declaration and the <span class="EmphasisFontCategoryNonProportional ">&lt;svg-examples&gt;</span>
<span id="ITerm46">start tag</span>:<div class="ProgramCode" id="PC9"><div class="LineGroup"><div class="FixedLine">&lt;!DOCTYPE svg-examples [</div><div class="FixedLine">&lt;!ELEMENT svg-examples (example+)&gt;</div><div class="FixedLine">&lt;!ELEMENT example (#PCDATA)&gt;</div><div class="FixedLine">]&gt;</div></div></div></div><div class="Para" id="Par87">Continuing, execute the following command:<div class="ProgramCode" id="PC10"><div class="LineGroup"><div class="FixedLine">java SAXDemo svg-examples.xml</div></div></div></div><div class="Para" id="Par88">This time, you should see the following output (although the hashcode will probably differ):<div class="ProgramCode" id="PC11"><div class="LineGroup"><div class="FixedLine">setDocumentLocator() locator=[com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser$LocatorProxy@53b32d7]</div><div class="FixedLine">startDocument()</div><div class="FixedLine">startDTD() name=[svg-examples], publicId=[null], systemId=[null]</div><div class="FixedLine">endDTD()</div><div class="FixedLine">startElement() uri=[], localName=[svg-examples], qName=[svg-examples]</div><div class="FixedLine">Column number=[15]</div><div class="FixedLine">Line number=[6]</div><div class="FixedLine">
                    <strong class="EmphasisTypeBold ">ignorableWhitespace() [</strong>
                  </div><div class="FixedLine">   <strong class="EmphasisTypeBold ">]</strong></div><div class="FixedLine">startElement() uri=[], localName=[example], qName=[example]</div><div class="FixedLine">Column number=[13]</div><div class="FixedLine">Line number=[7]</div><div class="FixedLine">characters() [</div><div class="FixedLine">      The following Scalable Vector Graphics document</div><div class="FixedLine">      describes a blue-filled and black-stroked ]</div><div class="FixedLine">characters() [</div><div class="FixedLine">      rectangle.</div><div class="FixedLine">      ]</div><div class="FixedLine">startCDATA()</div><div class="FixedLine">characters() [&lt;svg width=&quot;100%&quot; height=&quot;100%&quot;</div><div class="FixedLine">           version=&quot;1.1&quot;</div><div class="FixedLine">           xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;</div><div class="FixedLine">         &lt;rect width=&quot;300&quot; height=&quot;100&quot;</div><div class="FixedLine">               style=&quot;fill:rgb(0,0,255);stroke-width:1;</div><div class="FixedLine">                      stroke:rgb(0,0,0)&quot;/&gt;</div><div class="FixedLine">      &lt;/svg&gt;]</div><div class="FixedLine">endCDATA()</div><div class="FixedLine">characters() [</div><div class="FixedLine">   ]</div><div class="FixedLine">endElement() uri=[], localName=[example], qName=[example]</div><div class="FixedLine">
                    <strong class="EmphasisTypeBold ">ignorableWhitespace() [</strong>
                  </div><div class="FixedLine">
                    <strong class="EmphasisTypeBold ">]</strong>
                  </div><div class="FixedLine">endElement() uri=[], localName=[svg-examples], qName=[svg-examples]</div><div class="FixedLine">endDocument()</div></div></div></div><p class="Para" id="Par89">This output reveals that the <span class="EmphasisFontCategoryNonProportional ">ignorableWhitespace()</span> method<span id="ITerm47">
                
              </span> was called after <span class="EmphasisFontCategoryNonProportional ">startElement()</span> for <span id="ITerm48">
                <span class="EmphasisFontCategoryNonProportional ">svg-examples</span>
                
                
                
              </span> and after <span class="EmphasisFontCategoryNonProportional ">endElement()</span> for <span class="EmphasisFontCategoryNonProportional ">example</span>. The former two calls to <span class="EmphasisFontCategoryNonProportional ">characters()</span> that produced the strange output were reporting ignorable whitespace.</p><p class="Para" id="Par90">Recall that I previously defined <em class="EmphasisTypeItalic ">ignorable whitespace</em> as whitespace located between tags where the DTD doesn鈥檛 allow mixed content. For example, the DTD indicates that <span class="EmphasisFontCategoryNonProportional ">svg-examples</span> shall contain only <span class="EmphasisFontCategoryNonProportional ">example</span> elements, not <span class="EmphasisFontCategoryNonProportional ">example</span> elements and parsed character data. However, the line terminator following the <span class="EmphasisFontCategoryNonProportional ">&lt;svg-examples&gt;</span> tag and the leading whitespace before <span class="EmphasisFontCategoryNonProportional ">&lt;example&gt;</span> are parsed character data. The parser now reports these characters by calling <span class="EmphasisFontCategoryNonProportional ">ignorableWhitespace()</span>.</p><div class="Para" id="Par91">This time, there are only two occurrences of the following output:<div class="ProgramCode" id="PC12"><div class="LineGroup"><div class="FixedLine">characters() [</div><div class="FixedLine">   ]</div></div></div></div><p class="Para" id="Par92">The first occurrence reports the line terminator separately from the <span class="EmphasisFontCategoryNonProportional ">example</span> element鈥檚 text (before the CDATA section); it didn鈥檛 do so previously, which proves that <span class="EmphasisFontCategoryNonProportional ">characters()</span> is called with either all or part of an element鈥檚 <span id="ITerm49">content</span>. Once again, the second occurrence reports the line terminator that follows the CDATA section.</p><div class="Para" id="Par93">Let鈥檚 validate <span class="EmphasisFontCategoryNonProportional ">svg-examples.xml</span> without the previously presented internal DTD. We鈥檒l do so by executing the following command鈥攄on鈥檛 forget to include the <span class="EmphasisFontCategoryNonProportional ">v</span> command-line argument or the document won鈥檛 validate:<div class="ProgramCode" id="PC13"><div class="LineGroup"><div class="FixedLine">java SAXDemo svg-examples.xml v</div></div></div></div><div class="Para" id="Par94">Among its output are the following <span class="EmphasisFontCategoryNonProportional ">error()</span>-prefixed <span id="ITerm50">lines</span>:<div class="ProgramCode" id="PC14"><div class="LineGroup"><div class="FixedLine">error() org.xml.sax.SAXParseException; lineNumber: 2; columnNumber: 14; Document is invalid: no grammar found.</div><div class="FixedLine">error() org.xml.sax.SAXParseException; lineNumber: 2; columnNumber: 14; Document root element &quot;svg-examples&quot;, must match DOCTYPE root &quot;null&quot;.</div></div></div></div><p class="Para" id="Par95">These lines reveal that a DTD grammar hasn鈥檛 been found. Furthermore, the parser reports a mismatch between <span class="EmphasisFontCategoryNonProportional ">svg-examples</span> (it considers the first encountered element to be the root element) and <span class="EmphasisFontCategoryNonProportional ">null</span> (it considers <span class="EmphasisFontCategoryNonProportional ">null</span> to be the name of the root element in the absence of a DTD). Neither violation is considered to be fatal, which is why <span class="EmphasisFontCategoryNonProportional ">error()</span> is called instead of <span class="EmphasisFontCategoryNonProportional ">fatalError()</span>.</p><p class="Para" id="Par96">Add the internal DTD to <span class="EmphasisFontCategoryNonProportional ">svg-examples.xml</span> and reexecute <span class="EmphasisFontCategoryNonProportional ">java SAXDemo svg-examples.xml v</span>. This time, you should see no <span class="EmphasisFontCategoryNonProportional ">error()</span>-prefixed lines in the output.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar7"><h3 class="Heading">Tip</h3><p class="Para" id="Par97">SAX 2 validation defaults to validating against a DTD. To validate against an XML Schema-based schema instead, add the <span class="EmphasisFontCategoryNonProportional ">schemaLanguage</span> property with the <span class="ExternalRef"><a href="http://www.w3.org/2001/XMLSchema"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://www.w3.org/2001/XMLSchema</span>
                  </span></a></span> value to the <span class="EmphasisFontCategoryNonProportional ">XMLReader</span> object. Accomplish this task for <span class="EmphasisFontCategoryNonProportional ">SAXDemo</span> by specifying <span class="EmphasisFontCategoryNonProportional ">xmlr.setProperty(&quot;</span><span class="ExternalRef"><a href="http://java.sun.com/xml/jaxp/properties/schemaLanguage"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://java.sun.com/xml/jaxp/properties/schemaLanguage</span>
                  </span></a></span><span class="EmphasisFontCategoryNonProportional ">, </span><span class="ExternalRef"><a href="http://www.w3.org/2001/XMLSchema"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://www.w3.org/2001/XMLSchema</span>
                  </span></a></span><span class="EmphasisFontCategoryNonProportional ">&quot;);</span> before <span class="EmphasisFontCategoryNonProportional ">xmlr.parse(new InputSource(new FileReader(args[0])));</span>.</p></div></section><section class="Section1 RenderAsSection1" id="Sec13"><h2 class="Heading">Creating a Custom Entity Resolver</h2><p class="Para" id="Par98">While exploring XML in Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml"><span class="RefSource">1</span></a></span>, I introduced you to the concept of <em class="EmphasisTypeItalic ">entities</em>, which are aliased data. I then discussed general entities and parameter entities in terms of their internal and external variants.</p><p class="Para" id="Par99">Unlike <span id="ITerm51">internal entities</span>, whose values are specified in a DTD, the values of external entities are specified outside of a DTD and are identified via public and/or system identifiers. The system identifier is a URI, whereas the public identifier is a formal public identifier.</p><p class="Para" id="Par100">An XML parser reads an external <span id="ITerm52">entity</span> (including the external DTD subset) via an <span class="EmphasisFontCategoryNonProportional ">InputSource</span> object that鈥檚 connected to the appropriate system identifier. In many cases, you pass a system identifier or <span class="EmphasisFontCategoryNonProportional ">InputSource</span> object to the parser and let it discover where to find other entities that are referenced from the current document entity.</p><p class="Para" id="Par101">However, for performance or other reasons, you might want the parser to read the external entity鈥檚 value from a different system identifier, such as a local DTD copy鈥檚 system identifier. You can accomplish this task by creating an <em class="EmphasisTypeItalic ">entity resolver</em> that uses the public identifier to choose a different system identifier. Upon encountering an external entity, the parser calls the custom entity resolver to obtain this identifier.</p><div class="Para" id="Par102">Consider Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_2_Chapter.xhtml#PC15">2-3</a></span>鈥檚 formal specification of Listing <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC1"><span class="RefSource">1-1</span></a></span>鈥檚 grilled cheese sandwich recipe.<div class="ProgramCode" id="PC15"><div class="LineGroup"><div class="FixedLine">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="FixedLine">&lt;!DOCTYPE recipeml PUBLIC</div><div class="FixedLine">   &quot;-//FormatData//DTD RecipeML 0.5//EN&quot;</div><div class="FixedLine">   &quot;http://www.formatdata.com/recipeml/recipeml.dtd&quot;&gt;</div><div class="FixedLine">&lt;recipeml version=&quot;0.5&quot;&gt;</div><div class="FixedLine">   &lt;recipe&gt;</div><div class="FixedLine">      &lt;head&gt;</div><div class="FixedLine">         &lt;title&gt;Grilled Cheese Sandwich&lt;/title&gt;</div><div class="FixedLine">      &lt;/head&gt;</div><div class="FixedLine">      &lt;ingredients&gt;</div><div class="FixedLine">         &lt;ing&gt;</div><div class="FixedLine">            &lt;amt&gt;&lt;qty&gt;2&lt;/qty&gt;&lt;unit&gt;slice&lt;/unit&gt;&lt;/amt&gt;</div><div class="FixedLine">            &lt;item&gt;bread&lt;/item&gt;</div><div class="FixedLine">         &lt;/ing&gt;</div><div class="FixedLine">         &lt;ing&gt;</div><div class="FixedLine">            &lt;amt&gt;&lt;qty&gt;1&lt;/qty&gt;&lt;unit&gt;slice&lt;/unit&gt;&lt;/amt&gt;</div><div class="FixedLine">            &lt;item&gt;cheese&lt;/item&gt;</div><div class="FixedLine">         &lt;/ing&gt;</div><div class="FixedLine">         &lt;ing&gt;</div><div class="FixedLine">            &lt;amt&gt;&lt;qty&gt;2&lt;/qty&gt;&lt;unit&gt;pat&lt;/unit&gt;&lt;/amt&gt;</div><div class="FixedLine">            &lt;item&gt;margarine&lt;/item&gt;</div><div class="FixedLine">         &lt;/ing&gt;</div><div class="FixedLine">      &lt;/ingredients&gt;</div><div class="FixedLine">      &lt;directions&gt;</div><div class="FixedLine">         &lt;step&gt;Place frying pan on element and select</div><div class="FixedLine">         medium heat.&lt;/step&gt;</div><div class="FixedLine">         &lt;step&gt;For each bread slice, smear one pat of</div><div class="FixedLine">         margarine on one side of bread slice.&lt;/step&gt;</div><div class="FixedLine">         &lt;step&gt;Place cheese slice between bread slices with</div><div class="FixedLine">         margarine-smeared sides away from the</div><div class="FixedLine">         cheese.&lt;/step&gt;</div><div class="FixedLine">         &lt;step&gt;Place sandwich in frying pan with one</div><div class="FixedLine">         margarine-smeared size in contact with pan.&lt;/step&gt;</div><div class="FixedLine">         &lt;step&gt;Fry for a couple of minutes and flip.&lt;/step&gt;</div><div class="FixedLine">         &lt;step&gt;Fry other side for a minute and</div><div class="FixedLine">         serve.&lt;/step&gt;</div><div class="FixedLine">      &lt;/directions&gt;</div><div class="FixedLine">   &lt;/recipe&gt;</div><div class="FixedLine">&lt;/recipeml&gt;</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 2-3</span><p class="SimplePara">XML-Based Recipe for a Grilled Cheese Sandwich Specified in Recipe Markup <span id="ITerm53">Language</span></p></div></div></div></div><p class="Para" id="Par103">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_2_Chapter.xhtml#PC15">2-3</a></span> specifies the grilled cheese sandwich recipe in <em class="EmphasisTypeItalic ">Recipe Markup Language</em><span id="ITerm54">
                
                
              </span> (<em class="EmphasisTypeItalic ">RecipeML</em>), an XML-based language for marking up recipes. (A company named FormatData [see <span class="ExternalRef"><a href="http://www.formatdata.com/"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional ">www.formatdata.com</span>
                </span></a></span>] released this format in 2000.)</p><p class="Para" id="Par104">The document type declaration reports <span class="EmphasisFontCategoryNonProportional ">-//FormatData//DTD RecipeML 0.5//EN</span> as the formal public identifier and <span class="ExternalRef"><a href="http://www.formatdata.com/recipeml/recipeml.dtd"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional ">http://www.formatdata.com/recipeml/recipeml.dtd</span>
                </span></a></span> as the system identifier. Instead of keeping the default mapping, let鈥檚 map this formal public identifier to <span class="EmphasisFontCategoryNonProportional ">recipeml.dtd</span>, a system identifier for a local copy of this DTD file.</p><div class="Para" id="Par105">To create a custom entity resolver to perform this mapping, we declare a class that implements the <span class="EmphasisFontCategoryNonProportional ">EntityResolver</span> interface in terms of its <span class="EmphasisFontCategoryNonProportional ">InputSource resolveEntity(String publicId, String systemId)</span> method. We then use the supplied <span class="EmphasisFontCategoryNonProportional ">publicId</span> value as a key into a map that points to the desired <span class="EmphasisFontCategoryNonProportional ">systemId</span> value, and then use this value to create and return a custom <span class="EmphasisFontCategoryNonProportional ">InputSource</span>. Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_2_Chapter.xhtml#PC16">2-4</a></span> presents the resulting class.<div class="ProgramCode" id="PC16"><div class="LineGroup"><div class="FixedLine">import java.util.HashMap;</div><div class="FixedLine">import java.util.Map;</div></div><div class="LineGroup"><div class="FixedLine">import org.xml.sax.EntityResolver;</div><div class="FixedLine">import org.xml.sax.InputSource;</div><div class="FixedLine">import org.xml.sax.SAXException;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class LocalRecipeML implements EntityResolver</div><div class="FixedLine">{</div><div class="FixedLine">   private Map&lt;String, String&gt; mappings = new HashMap&lt;&gt;();</div></div><div class="LineGroup"><div class="FixedLine">   LocalRecipeML()</div><div class="FixedLine">   {</div><div class="FixedLine">      mappings.put(&quot;-//FormatData//DTD RecipeML 0.5//EN&quot;, &quot;recipeml.dtd&quot;);</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public InputSource resolveEntity(String publicId, String systemId)</div><div class="FixedLine">   {</div><div class="FixedLine">      if (mappings.containsKey(publicId))</div><div class="FixedLine">      {</div><div class="FixedLine">         out.println(&quot;obtaining cached recipeml.dtd&quot;);</div><div class="FixedLine">         systemId = mappings.get(publicId);</div><div class="FixedLine">         InputSource localSource =</div><div class="FixedLine">            new InputSource(systemId);</div><div class="FixedLine">         return localSource;</div><div class="FixedLine">      }</div><div class="FixedLine">      return null;</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 2-4</span><p class="SimplePara">
                      <span id="ITerm55">
                        <span class="EmphasisFontCategoryNonProportional ">LocalRecipeML</span>
                        
                        
                      </span>
                    </p></div></div></div></div><p class="Para" id="Par106">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_2_Chapter.xhtml#PC16">2-4</a></span> declares <span id="ITerm56">
                <span class="EmphasisFontCategoryNonProportional ">LocalRecipeML</span>
                
                
              </span>. This class鈥檚 constructor stores the formal public identifier for the RecipeML DTD and the system identifier for a local copy of this DTD鈥檚 document in a map.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar8"><h3 class="Heading">Note</h3><p class="Para" id="Par107">Although it鈥檚 unnecessary to use a map in this example (an <span class="EmphasisFontCategoryNonProportional ">if (publicId.equals(&quot;-//FormatData//DTD RecipeML 0.5//EN&quot;)) return new InputSource(&quot;recipeml.dtd&quot;) else return null;</span> statement would suffice), I鈥檝e chosen to use a map in case I want to expand the number of mappings in the future. In another scenario, you would probably find a map to be very convenient. For example, it鈥檚 easier to use a map than to use a series of <span class="EmphasisFontCategoryNonProportional ">if</span> statements in a custom entity resolver that maps XHTML鈥檚 strict, transitional, and frameset formal public identifiers and also maps its various entity sets to local copies of these document files.</p></div><p class="Para" id="Par108">The overriding <span class="EmphasisFontCategoryNonProportional ">resolveEntity()</span> method<span id="ITerm57">
                
              </span> uses <span class="EmphasisFontCategoryNonProportional ">publicId</span>鈥檚 argument to locate the corresponding system identifier in the map鈥攖he <span class="EmphasisFontCategoryNonProportional ">systemId</span> parameter value is ignored because it never refers to the local copy of <span class="EmphasisFontCategoryNonProportional ">recipeml.dtd</span>. When the mapping is found, an <span class="EmphasisFontCategoryNonProportional ">InputSource</span> object is created and returned. If the mapping couldn鈥檛 be found, <span class="EmphasisFontCategoryNonProportional ">null</span> would be returned.</p><div class="Para" id="Par109">To install this custom entity resolver in <span class="EmphasisFontCategoryNonProportional ">SAXDemo</span>, specify <span class="EmphasisFontCategoryNonProportional ">xmlr.setEntityResolver(new LocalRecipeML());</span> before the <span class="EmphasisFontCategoryNonProportional ">parse()</span> method call. After recompiling the source code, execute the following command:<div class="ProgramCode" id="PC17"><div class="LineGroup"><div class="FixedLine">java SAXDemo gcs.xml</div></div></div></div><p class="Para" id="Par110">Here, <span class="EmphasisFontCategoryNonProportional ">gcs.xml</span> stores Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_2_Chapter.xhtml#PC15">2-3</a></span>鈥檚 text. In the resulting output, you should observe the message 鈥?span class=&quot;EmphasisFontCategoryNonProportional &quot;&gt;obtaining cached recipeml.dtd</span>鈥?before the call to <span class="EmphasisFontCategoryNonProportional ">startEntity()</span>.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar9"><h3 class="Heading">Tip</h3><p class="Para" id="Par111">The SAX API includes an <span class="EmphasisFontCategoryNonProportional ">org.xml.sax.ext.EntityResolver2</span> interface that provides improved support for resolving entities. If you prefer to implement <span class="EmphasisFontCategoryNonProportional ">EntityResolver2</span> instead of <span class="EmphasisFontCategoryNonProportional ">EntityResolver</span>, replace the <span class="EmphasisFontCategoryNonProportional ">setEntityResolver()</span> call to install the entity resolver with a <span class="EmphasisFontCategoryNonProportional ">setFeature()</span> call whose feature name is <span class="EmphasisFontCategoryNonProportional ">use-entity-resolver2</span> (don鈥檛 forget the <span class="ExternalRef"><a href="http://xml.org/sax/features/prefix"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://xml.org/sax/features/prefix</span>
                  </span></a></span>).</p></div><div class="FormalPara FormalParaRenderingStyle3 ParaTypeOverview" id="FPar10"><h3 class="Heading">Exercises</h3><div class="Para" id="Par112">The following exercises are designed to test your understanding of Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_2_Chapter.xhtml"><span class="RefSource">2</span></a></span>鈥檚 content:<div class="OrderedList"><ol><li class="ListItem"><span class="ItemNumber">1.</span><div class="ItemContent"><p class="Para" id="Par113">Define SAX.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">2.</span><div class="ItemContent"><p class="Para" id="Par114">How do you obtain a SAX 2-based parser?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">3.</span><div class="ItemContent"><p class="Para" id="Par115">What is the purpose of the <span class="EmphasisFontCategoryNonProportional ">XMLReader</span> interface?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">4.</span><div class="ItemContent"><p class="Para" id="Par116">How do you tell a SAX parser to perform validation?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">5.</span><div class="ItemContent"><p class="Para" id="Par117">Identify the four kinds of SAX-oriented exceptions that can be thrown when working with SAX.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">6.</span><div class="ItemContent"><p class="Para" id="Par118">What interface does a handler class implement to respond to content-oriented events?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">7.</span><div class="ItemContent"><p class="Para" id="Par119">Identify the three other core interfaces that a handler class is likely to implement.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">8.</span><div class="ItemContent"><p class="Para" id="Par120">Define ignorable whitespace.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">9.</span><div class="ItemContent"><p class="Para" id="Par121">True or false: <span class="EmphasisFontCategoryNonProportional ">void error(SAXParseException exception)</span> is called for all kinds of errors.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">10.</span><div class="ItemContent"><p class="Para" id="Par122">What is the purpose of the <span class="EmphasisFontCategoryNonProportional ">DefaultHandler</span> class?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">11.</span><div class="ItemContent"><p class="Para" id="Par123">What is an entity? What is an entity resolver?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">12.</span><div class="ItemContent"><div class="Para" id="Par124"><em class="EmphasisTypeItalic ">Apache Tomcat</em> is an open-source web server developed by the Apache Software Foundation. Tomcat stores usernames, passwords, and roles (for authentication purposes) in its <span class="EmphasisFontCategoryNonProportional ">tomcat-users.xml</span> configuration file. Create a <span class="EmphasisFontCategoryNonProportional ">DumpUserInfo</span> application that uses SAX to parse the <span class="EmphasisFontCategoryNonProportional ">user</span> elements in the following example <span class="EmphasisFontCategoryNonProportional ">tomcat-users.xml</span> file and, for each <span class="EmphasisFontCategoryNonProportional ">user</span> element, dump its <span class="EmphasisFontCategoryNonProportional ">username</span>, <span class="EmphasisFontCategoryNonProportional ">password</span>, and <span class="EmphasisFontCategoryNonProportional ">roles</span> attribute values to standard output in a <em class="EmphasisTypeItalic ">key</em>
<span class="EmphasisFontCategoryNonProportional ">=</span>
<em class="EmphasisTypeItalic ">value</em> format:<div class="ProgramCode" id="PC18"><div class="LineGroup"><div class="FixedLine">&lt;?xml version=&apos;1.0&apos; encoding=&apos;utf-8&apos;?&gt;</div></div><div class="LineGroup"><div class="FixedLine">&lt;tomcat-users&gt;</div><div class="FixedLine">  &lt;role rolename=&quot;dbadmin&quot;/&gt;</div><div class="FixedLine">  &lt;role rolename=&quot;manager&quot;/&gt;</div><div class="FixedLine">  &lt;user username=&quot;JohnD&quot; password=&quot;password1&quot;</div><div class="FixedLine">        roles=&quot;dbadmin,manager&quot;/&gt;</div><div class="FixedLine">  &lt;user username=&quot;JillD&quot; password=&quot;password2&quot;</div><div class="FixedLine">        roles=&quot;manager&quot;/&gt;</div><div class="FixedLine">&lt;/tomcat-users&gt;</div></div></div></div></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">13.</span><div class="ItemContent"><p class="Para" id="Par125">Create a <span class="EmphasisFontCategoryNonProportional ">SAXSearch</span> application that searches Exercise 1-21鈥檚 <span class="EmphasisFontCategoryNonProportional ">books.xml</span> file for those <span class="EmphasisFontCategoryNonProportional ">book</span> elements whose <span class="EmphasisFontCategoryNonProportional ">publisher</span> child elements contain text that equals the application鈥檚 single command-line publisher name argument. Once there is a match, output the <span class="EmphasisFontCategoryNonProportional ">title</span> element鈥檚 text followed by the <span class="EmphasisFontCategoryNonProportional ">book</span> element鈥檚 <span class="EmphasisFontCategoryNonProportional ">isbn</span> attribute value. For example, <span class="EmphasisFontCategoryNonProportional ">java SAXSearch Apress</span> should output <span class="EmphasisFontCategoryNonProportional ">title = Beginning Groovy and Grails, isbn = 9781430210450</span>, whereas <span class="EmphasisFontCategoryNonProportional ">java SAXSearch &quot;Addison Wesley&quot;</span> should output <span class="EmphasisFontCategoryNonProportional ">title = Advanced C++, isbn = 0201548550</span> followed by <span class="EmphasisFontCategoryNonProportional ">title = Effective Java, isbn = 0201310058</span> on separate lines. Nothing should output when the command-line publisher name argument doesn鈥檛 match a <span class="EmphasisFontCategoryNonProportional ">publisher</span> element鈥檚 text.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">14.</span><div class="ItemContent"><p class="Para" id="Par126">Use Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_2_Chapter.xhtml#PC3">2-1</a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">SAXDemo</span> application to validate Exercise 1-22鈥檚 <span class="EmphasisFontCategoryNonProportional ">books.xml</span> content against its DTD. Execute <span class="EmphasisFontCategoryNonProportional ">java SAXDemo books.xml -v</span> to perform the validation.</p></div><div class="ClearBoth"> </div></li></ol></div></div></div></section><section class="Section1 RenderAsSection1" id="Sec14"><h2 class="Heading">Summary</h2><p class="Para" id="Par127">SAX is an event-based Java API for parsing an XML document sequentially from start to finish. As a SAX-oriented parser encounters an item from the document鈥檚 infoset, it makes this item available to an application as an event by calling one of the methods in one of the application鈥檚 handlers, which the application has previously registered with the parser. The application can then consume this event by processing the infoset item in some manner.</p><p class="Para" id="Par128">SAX exists in two major versions: SAX 1 and SAX 2. Java implements both versions through the <span class="EmphasisFontCategoryNonProportional ">javax.xml.parsers</span> package鈥檚 abstract <span class="EmphasisFontCategoryNonProportional ">SAXParser</span> and <span class="EmphasisFontCategoryNonProportional ">SAXParserFactory</span> classes. The <span class="EmphasisFontCategoryNonProportional ">org.xml.sax</span>, <span class="EmphasisFontCategoryNonProportional ">org.xml.sax.ext</span>, and <span class="EmphasisFontCategoryNonProportional ">org.xml.sax.helpers</span> packages provide various types that augment both Java implementations.</p><p class="Para" id="Par129"><span class="EmphasisFontCategoryNonProportional ">XMLReader</span> makes available several methods for configuring the parser and parsing a document鈥檚 content. Some of these methods get and set the content handler, DTD handler, entity resolver, and error handler, which are described by the <span class="EmphasisFontCategoryNonProportional ">ContentHandler</span>, <span class="EmphasisFontCategoryNonProportional ">DTDHandler</span>, <span class="EmphasisFontCategoryNonProportional ">EntityResolver</span>, and <span class="EmphasisFontCategoryNonProportional ">ErrorHandler</span> interfaces. After learning about <span class="EmphasisFontCategoryNonProportional ">XMLReader</span>鈥檚 methods and these interfaces, you learned about the nonstandard <span class="EmphasisFontCategoryNonProportional ">LexicalHandler</span> interface and how to create a custom entity resolver.</p><p class="Para" id="Par130">Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_3_Chapter.xhtml"><span class="RefSource">3</span></a></span> introduces Java鈥檚 DOM API for parsing/creating XML documents.</p></section></div><div class="annotator-outer annotator-viewer viewer annotator-hide"> </div></div></div>
    </section>
  </div>
</div>
<div class="font-flyout" style="top: 200.959px; left: 2474px;"> </div>
<hr/>

<!--if IE]><![endif]--><!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/java-xml-and/9781484243305/html/394211_2_En_3_Chapter.xhtml"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="3866890"
  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"
  data-username="levinxccai"
  data-account-type="B2B"
  
  data-activated-trial-date="11/06/2017"


  data-archive="9781484243305"
  data-publishers="Apress"



  data-htmlfile-name="394211_2_En_3_Chapter.xhtml"
  data-epub-title="Java XML and JSON: Document Processing for Java SE" data-debug=0 data-testing=0><![endif]--><!--if gt IE 8]><!--><!--![endif]-->



<a name="4_"></a>

<div class="application" id="container" style="height: auto;">
  <div class="js-toc">
    <section role="document">
      <div id="sbo-rt-content" style="max-width:72.5em; transform: none;"><div class="annotator-wrapper"><!--egin Abstract--><div class="MainTitleSection"><h1 class="ChapterTitle" lang="en">3. Parsing and Creating XML Documents with DOM</h1></div><div class="AuthorGroup"><div class="AuthorNames"><span class="Author"><span class="AuthorName">Jeff Friesen</span><sup><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_3_Chapter.xhtml#Aff2">1</a> <span class="ContactIcon"></span></sup></span></div><div class="Affiliations"><div class="Affiliation" id="Aff2"><span class="AffiliationNumber">(1)</span><div class="AffiliationText">Dauphin, MB, Canada</div></div><div class="ClearBoth"> </div></div></div><!--nd Abstract--><div class="Fulltext"><p class="Para" id="Par2">SAX can parse XML documents but cannot create them. In contrast, DOM can parse and create XML documents. Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_3_Chapter.xhtml"><span class="RefSource">3</span></a></span> introduces you to DOM.</p><section class="Section1 RenderAsSection1" id="Sec1"><h2 class="Heading">What Is DOM?</h2><p class="Para" id="Par3"><em class="EmphasisTypeItalic ">Document Object Model (DOM)</em> is a Java API for parsing an XML document into an in-memory tree of nodes and for creating an XML document from a node tree. After a DOM parser creates a tree, an application uses the DOM API to navigate over and extract infoset items from the tree鈥檚 nodes.</p><div class="Para" id="Par4">DOM has two big <span id="ITerm1">advantages</span> over SAX:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par5">DOM permits random access to a document鈥檚 infoset items, whereas SAX only permits serial access.</p></li><li><p class="Para" id="Par6">DOM lets you also create XML documents, whereas you can only parse documents with SAX.</p></li></ul></div></div><p class="Para" id="Par7">However, SAX is advantageous over DOM in that it can parse documents of arbitrary size, whereas the size of documents parsed or created by DOM is limited by the amount of available memory for storing the <span id="ITerm2">document鈥檚 node-based tree structure</span>.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar1"><h3 class="Heading">Note</h3><p class="Para" id="Par8">DOM originated as an object model for the Netscape Navigator 3 and Microsoft Internet Explorer 3 web browsers. Collectively, these implementations are known as DOM Level 0. Because each vendor鈥檚 DOM implementation was only slightly compatible with the other, the W3C subsequently took charge of DOM鈥檚 development to promote standardization and has so far released DOM Levels 1, 2, 3, and 4. Java 11 supports the first three DOM levels through its DOM API.</p></div></section><section class="Section1 RenderAsSection1" id="Sec2"><h2 class="Heading">A Tree of Nodes</h2><p class="Para" id="Par9">DOM views an XML document as a tree that鈥檚 composed of several kinds of nodes. This tree has a single <em class="EmphasisTypeItalic ">root node</em>, and all nodes except for the root have a <em class="EmphasisTypeItalic ">parent node</em>. Also, each node has a list of <em class="EmphasisTypeItalic ">child nodes</em>. When this list is empty, the child node is known as a <em class="EmphasisTypeItalic ">leaf node</em>.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar2"><h3 class="Heading">Note</h3><p class="Para" id="Par10">DOM permits nodes to exist that are not part of the tree structure. For example, an element node鈥檚 attribute nodes are not regarded as child nodes of the element node. Also, nodes can be created but not inserted into the tree; they can also be removed from the tree.</p></div><p class="Para" id="Par11">Each node has a <em class="EmphasisTypeItalic ">node name</em>, which is the complete name for nodes that have names (such as an element鈥檚 or an attribute鈥檚 prefixed name), and <span class="EmphasisFontCategoryNonProportional ">#</span><em class="EmphasisTypeItalic ">node-type</em> for unnamed nodes, where <em class="EmphasisTypeItalic ">node-type</em> is one of <span class="EmphasisFontCategoryNonProportional ">cdata-section</span>, <span class="EmphasisFontCategoryNonProportional ">comment</span>, <span class="EmphasisFontCategoryNonProportional ">document</span>, <span class="EmphasisFontCategoryNonProportional ">document-fragment</span>, or <span class="EmphasisFontCategoryNonProportional ">text</span>. Nodes also have <em class="EmphasisTypeItalic ">local names</em> (names without prefixes), prefixes, and namespace URIs (although these attributes may be null for certain kinds of nodes, such as comments). Finally, nodes have string values, which happen to be the content of text nodes, comment nodes, and similar text-oriented nodes; normalized values for attributes; and null for everything else.</p><div class="Para" id="Par12">DOM classifies nodes into 12 types; most of them can be considered part of a <em class="EmphasisTypeItalic ">DOM tree</em>. All of these <span id="ITerm3">types</span> are described as follows:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par13"><span id="ITerm4">
                      <em class="EmphasisTypeItalic ">Attribute node</em>
                      
                    </span>: one of an element鈥檚 attributes. It has a name, a local name, a prefix, a namespace URI, and a normalized string value. The value is <em class="EmphasisTypeItalic ">normalized</em> by resolving any entity references and by converting sequences of whitespace to a single whitespace character. An attribute node has children, which are the text and any entity reference nodes that form its value. Attribute nodes are not regarded as children of their associated element nodes.</p></li><li><p class="Para" id="Par14"><span id="ITerm5">
                      <em class="EmphasisTypeItalic ">CDATA section node</em>
                      
                    </span>: the contents of a CDATA section. Its name is <span class="EmphasisFontCategoryNonProportional ">#cdata-section</span> and its value is the CDATA section鈥檚 text.</p></li><li><p class="Para" id="Par15"><span id="ITerm6">
                      <em class="EmphasisTypeItalic ">Comment node</em>
                      
                    </span>: a document comment. Its name is <span class="EmphasisFontCategoryNonProportional ">#comment</span> and its value is the comment text. A comment node has a parent, which is the node that contains the comment.</p></li><li><p class="Para" id="Par16"><span id="ITerm7">
                      <em class="EmphasisTypeItalic ">Document node</em>
                      
                    </span>: the root of a DOM tree. Its name is <span class="EmphasisFontCategoryNonProportional ">#document</span>, it always has a single element child node, and it will also have a document type child node when the document has a document type <span id="ITerm8">declaration</span>. Furthermore, it can have additional child nodes describing comments or processing instructions that appear before or after the root element鈥檚 start tag. There can be only one document node in the tree.</p></li><li><p class="Para" id="Par17"><span id="ITerm9">
                      <em class="EmphasisTypeItalic ">Document fragment node</em>
                      
                    </span>: an alternative root node. Its name is <span class="EmphasisFontCategoryNonProportional ">#document-fragment</span> and it contains anything that an element node can contain (such as other element nodes and even comment nodes). A parser never creates this kind of a node. However, an application can create a document fragment node when it extracts part of a DOM tree to be moved somewhere else. Document fragment nodes let you work with subtrees.</p></li><li><p class="Para" id="Par18"><span id="ITerm10">
                      <em class="EmphasisTypeItalic ">Document type node</em>
                      
                    </span>: a document type declaration. Its name is the name specified by the document type declaration for the root element. Also, it has a (possibly null) public identifier, a required system identifier, an internal DTD subset (which is possibly null), a parent (the document node that contains the document type node), and lists of DTD-declared notations and general entities. Its value is always set to null.</p></li><li><p class="Para" id="Par19"><span id="ITerm11">
                      <em class="EmphasisTypeItalic ">Element node</em>
                      
                    </span>: a document鈥檚 element. It has a name, a local name, a (possibly null) prefix, and a namespace URI, which is null when the element doesn鈥檛 belong to any namespace. An element node contains children, including text nodes, and even comment and processing-instruction nodes.</p></li><li><p class="Para" id="Par20"><span id="ITerm12">
                      <em class="EmphasisTypeItalic ">Entity node</em>
                      
                    </span>: the parsed and unparsed entities that are declared in a document鈥檚 DTD. When a parser reads a DTD, it attaches a map of entity nodes (indexed by entity name) to the document type node. An entity node has a name and a system <span id="ITerm13">identifier</span> and can also have a public identifier if one appears in the DTD. Finally, when the parser reads the entity, the entity node is given a list of read-only child nodes that contain the entity鈥檚 replacement text.</p></li><li><p class="Para" id="Par21"><span id="ITerm14">
                      <em class="EmphasisTypeItalic ">Entity reference node</em>
                      
                    </span>: a reference to a DTD-declared entity. Each entity reference node has a name and is included in the tree when the parser doesn鈥檛 replace entity references with their values. The parser never includes entity reference nodes for character references (such as <span class="EmphasisFontCategoryNonProportional ">&amp;</span> or <span class="EmphasisFontCategoryNonProportional ">危</span>) because they鈥檙e replaced by their respective characters and included in a text node.</p></li><li><p class="Para" id="Par22"><span id="ITerm15">
                      <em class="EmphasisTypeItalic ">Notation node</em>
                      
                    </span>: a DTD-declared notation. A parser that reads the DTD attaches a map of notation nodes (indexed by notation name) to the document type node. Each notation node has a name and a public identifier or a system identifier, whichever identifier was used to declare the notation in the DTD. Notation nodes don鈥檛 have children.</p></li><li><p class="Para" id="Par23"><span id="ITerm16">
                      <em class="EmphasisTypeItalic ">Processing-instruction node</em>
                      
                    </span>: a processing instruction that appears in the document. It has a name (the instruction鈥檚 target), a string value (the instruction鈥檚 data), and a parent (its containing node).</p></li><li><p class="Para" id="Par24"><span id="ITerm17">
                      <em class="EmphasisTypeItalic ">Text node</em>
                      
                    </span>: document content. Its name is <span class="EmphasisFontCategoryNonProportional ">#text</span> and it represents a portion of an element鈥檚 content when an intervening node (such as a comment) must be created. Characters such as <span class="EmphasisFontCategoryNonProportional ">&lt;</span> and <span class="EmphasisFontCategoryNonProportional ">&amp;</span> that are represented in the document via character references are replaced by the literal characters they represent. When these nodes are written to a document, these characters must be escaped.</p></li></ul></div></div><p class="Para" id="Par25">Although these node types store considerable information about an XML document, there are <span id="ITerm18">limitations</span>, such as not exposing whitespace outside of the root element. Also, most DTD or schema information, such as element types <span class="EmphasisFontCategoryNonProportional ">(&lt;!ELEMENT...&gt;)</span> and attribute types (<span class="EmphasisFontCategoryNonProportional ">&lt;xs:attribute...&gt;</span>), cannot be accessed through the DOM.</p><p class="Para" id="Par26">DOM Level 3 addresses some of the DOM鈥檚 various limitations. For example, although DOM doesn鈥檛 provide a node type for the XML declaration, DOM Level 3 makes it possible to access the XML declaration鈥檚 <span class="EmphasisFontCategoryNonProportional ">version</span>, <span class="EmphasisFontCategoryNonProportional ">encoding</span>, and <span class="EmphasisFontCategoryNonProportional ">standalone</span> attribute values via attributes of the document node.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar3"><h3 class="Heading">Note</h3><p class="Para" id="Par27">Nonroot nodes never exist in isolation. For example, it鈥檚 never the case for an element node to not belong to a document or to a document fragment. Even when such nodes are disconnected from the main tree, they remain aware of the document or document fragment to which they belong.</p></div></section><section class="Section1 RenderAsSection1" id="Sec3"><h2 class="Heading">Exploring the DOM API</h2><p class="Para" id="Par28">Java implements DOM through the <span class="EmphasisFontCategoryNonProportional ">javax.xml.parsers</span> package鈥檚 abstract <span class="EmphasisFontCategoryNonProportional ">DocumentBuilder</span> and <span class="EmphasisFontCategoryNonProportional ">DocumentBuilderFactory</span> classes and the nonabstract <span class="EmphasisFontCategoryNonProportional ">FactoryConfigurationError</span> and <span class="EmphasisFontCategoryNonProportional ">ParserConfigurationException</span> classes. The <span class="EmphasisFontCategoryNonProportional ">org.w3c.dom</span>, <span class="EmphasisFontCategoryNonProportional ">org.w3c.dom.bootstrap</span>, <span class="EmphasisFontCategoryNonProportional ">org.w3c.dom.events</span>, <span class="EmphasisFontCategoryNonProportional ">org.w3c.dom.ls</span>, <span class="EmphasisFontCategoryNonProportional ">org.w3c.dom.ranges</span>, <span class="EmphasisFontCategoryNonProportional ">org.w3c.dom.traversal</span>, and <span class="EmphasisFontCategoryNonProportional ">org.w3c.dom.views</span> packages provide various types that augment this implementation.</p><section class="Section2 RenderAsSection2" id="Sec4"><h3 class="Heading">Obtaining a DOM Parser/Document Builder</h3><div class="Para" id="Par29">A DOM parser is also known as a <em class="EmphasisTypeItalic ">document builder</em> because of its dual role in parsing and creating XML documents. You obtain a DOM <span id="ITerm19">parser/document builder</span> by first instantiating <span class="EmphasisFontCategoryNonProportional ">DocumentBuilderFactory</span>, by calling one of its <span class="EmphasisFontCategoryNonProportional ">newInstance()</span> class methods. For example, the following code fragment invokes <span class="EmphasisFontCategoryNonProportional ">DocumentBuilderFactory</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">DocumentBuilderFactory newInstance()</span> class method:<div class="ProgramCode" id="PC1"><div class="LineGroup"><div class="FixedLine">DocumentBuilderFactory dbf =</div><div class="FixedLine">   DocumentBuilderFactory.newInstance();</div></div></div></div><p class="Para" id="Par30">Behind the scenes, <span class="EmphasisFontCategoryNonProportional ">newInstance()</span> follows an ordered lookup procedure to identify the <span class="EmphasisFontCategoryNonProportional ">DocumentBuilderFactory</span> implementation class to load. This procedure first examines the <span class="EmphasisFontCategoryNonProportional ">javax.xml.parsers.DocumentBuilderFactory</span> system property and lastly chooses the Java platform鈥檚 default <span class="EmphasisFontCategoryNonProportional ">DocumentBuilderFactory</span> implementation class when no other class is found. If an implementation class isn鈥檛 available (perhaps the class identified by the <span class="EmphasisFontCategoryNonProportional ">javax.xml.parsers.DocumentBuilderFactory</span> system property doesn鈥檛 exist) or cannot be instantiated, <span class="EmphasisFontCategoryNonProportional ">newInstance()</span> throws an instance of the <span class="EmphasisFontCategoryNonProportional ">FactoryConfigurationError</span> class. Otherwise, it instantiates the class and returns its instance.</p><p class="Para" id="Par31">After obtaining a <span class="EmphasisFontCategoryNonProportional ">DocumentBuilderFactory</span> instance, you can call various configuration methods to configure the factory. For example, you could call <span class="EmphasisFontCategoryNonProportional ">DocumentBuilderFactory</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">void setNamespaceAware(boolean awareness)</span> method<span id="ITerm20">
                  
                  
                </span> with a <span class="EmphasisFontCategoryNonProportional ">true</span> argument to tell the factory that any returned document builder must provide support for XML namespaces. You can also call <span class="EmphasisFontCategoryNonProportional ">void setValidating(boolean validating)</span> with <span class="EmphasisFontCategoryNonProportional ">true</span> as the argument to validate documents against their DTDs or call <span class="EmphasisFontCategoryNonProportional ">void setSchema(Schema schema)</span> to validate documents against the <span class="EmphasisFontCategoryNonProportional ">javax.xml.validation.Schema</span> instance identified by <span class="EmphasisFontCategoryNonProportional ">schema</span>.</p><div class="FormalPara FormalParaRenderingStyle3 ParaTypeOverview" id="FPar4"><h3 class="Heading">Validation API</h3><p class="Para" id="Par32"><span class="EmphasisFontCategoryNonProportional ">Schema</span> is a member of Java鈥檚 <span id="ITerm21">Validation API</span>, which decouples document parsing from validation, making it easier for applications to take advantage of specialized validation libraries that support additional schema languages (such as Relax NG鈥攕ee <span class="ExternalRef"><a href="http://en.wikipedia.org/wiki/RELAX_NG"><span class="RefSource">
                      <span class="EmphasisFontCategoryNonProportional ">http://en.wikipedia.org/wiki/RELAX_NG</span>
                    </span></a></span>), and making it easier to specify the location of a schema.</p><p class="Para" id="Par33">The Validation API is associated with the <span class="EmphasisFontCategoryNonProportional ">javax.xml.validation</span> package, which also includes <span class="EmphasisFontCategoryNonProportional ">SchemaFactory</span>, <span class="EmphasisFontCategoryNonProportional ">SchemaFactoryLoader</span>, <span class="EmphasisFontCategoryNonProportional ">TypeInfoProvider</span>, <span class="EmphasisFontCategoryNonProportional ">Validator</span>, and <span class="EmphasisFontCategoryNonProportional ">ValidatorHandler</span>. <span class="EmphasisFontCategoryNonProportional ">Schema</span> is the central class and represents an immutable in-memory representation of a grammar.</p><p class="Para" id="Par34">DOM supports the Validation API via <span class="EmphasisFontCategoryNonProportional ">DocumentBuilderFactory</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">void setSchema(Schema schema)</span> and <span class="EmphasisFontCategoryNonProportional ">Schema getSchema()</span> methods. Similarly, SAX supports Validation via j<span class="EmphasisFontCategoryNonProportional ">avax.xml.parsers.SAXParserFactory</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">void setSchema(Schema schema)</span> and <span class="EmphasisFontCategoryNonProportional ">Schema getSchema()</span> methods.</p><div class="Para" id="Par35">The following code fragment demonstrates the Validation API in a DOM context:<div class="ProgramCode" id="PC2"><div class="LineGroup"><div class="FixedLine">// Parse an XML document into a DOM tree.</div><div class="FixedLine">DocumentBuilder parser =</div><div class="FixedLine">   DocumentBuilderFactory.newInstance().newDocumentBuilder();</div><div class="FixedLine">Document document = parser.parse(new File(&quot;instance.xml&quot;));</div><div class="FixedLine">// Create a SchemaFactory capable of understanding W3C XML Schema (WXS).</div><div class="FixedLine">SchemaFactory factory =</div><div class="FixedLine">   SchemaFactory.newInstance(XMLConstants.W3C_XML_SCHEMA_NS_URI);</div><div class="FixedLine">// Load a WXS schema, represented by a Schema instance.</div><div class="FixedLine">Source schemaFile = new StreamSource(new File(&quot;mySchema.xsd&quot;));</div><div class="FixedLine">Schema schema = factory.newSchema(schemaFile);</div><div class="FixedLine">// Create a Validator instance, which is used to validate an XML document.</div><div class="FixedLine">Validator validator = schema.newValidator();</div><div class="FixedLine">// Validate the DOM tree.</div><div class="FixedLine">try</div><div class="FixedLine">{</div><div class="FixedLine">   validator.validate(new DOMSource(document));</div><div class="FixedLine">}</div><div class="FixedLine">catch (SAXException saxe)</div><div class="FixedLine">{</div><div class="FixedLine">   // XML document is invalid!</div><div class="FixedLine">}<span id="ITerm22">
                          
                        </span></div></div></div></div><p class="Para" id="Par36">This example refers to XSLT types such as <span class="EmphasisFontCategoryNonProportional ">Source</span>. I explore XSLT in Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_6_Chapter.xhtml"><span class="RefSource">6</span></a></span>.</p></div><div class="Para" id="Par37">After the factory has been configured, call its <span class="EmphasisFontCategoryNonProportional ">DocumentBuilder newDocumentBuilder()</span> method to return a document builder that supports the configuration, as demonstrated here:<div class="ProgramCode" id="PC3"><div class="LineGroup"><div class="FixedLine">DocumentBuilder db = dbf.newDocumentBuilder();</div></div></div></div><p class="Para" id="Par38">If a document builder cannot be <span id="ITerm23">returned</span> (perhaps the factory cannot create a document builder that supports XML namespaces), this method throws a <span class="EmphasisFontCategoryNonProportional ">ParserConfigurationException</span> instance.</p></section><section class="Section2 RenderAsSection2" id="Sec5"><h3 class="Heading">Parsing and Creating XML Documents</h3><p class="Para" id="Par39">Assuming that you鈥檝e successfully obtained a document builder, what happens next depends on whether you want to parse or create an XML document.</p><p class="Para" id="Par40"><span class="EmphasisFontCategoryNonProportional ">DocumentBuilder</span> provides several overloaded <span class="EmphasisFontCategoryNonProportional ">parse()</span> methods<span id="ITerm24">
                  
                  
                </span> for parsing an XML document into a node tree. These methods differ in how they obtain the document. For example, <span class="EmphasisFontCategoryNonProportional ">Document parse(String uri)</span> parses the document that鈥檚 identified by its string-based URI argument.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar5"><h3 class="Heading">Note</h3><p class="Para" id="Par41">Each <span class="EmphasisFontCategoryNonProportional ">parse()</span> method throws <span class="EmphasisFontCategoryNonProportional ">java.lang.IllegalArgumentException</span> when <span class="EmphasisFontCategoryNonProportional ">null</span> is passed as the method鈥檚 first argument, <span class="EmphasisFontCategoryNonProportional ">java.io.IOException</span> when an input/output error occurs, and <span class="EmphasisFontCategoryNonProportional ">org.xml.sax.SAXException</span> when the document cannot be parsed. This last exception type indicates that <span class="EmphasisFontCategoryNonProportional ">DocumentBuilder</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">parse()</span> methods rely on SAX to take care of the actual parsing work. Because they are more involved in building the node tree, DOM parsers are commonly referred to as <em class="EmphasisTypeItalic ">document builders</em>.</p></div><p class="Para" id="Par42"><span class="EmphasisFontCategoryNonProportional ">DocumentBuilder</span> also declares the abstract <span class="EmphasisFontCategoryNonProportional ">Document newDocument()</span> method<span id="ITerm25">
                  
                </span> for creating a DOM tree.</p><p class="Para" id="Par43">The returned <span class="EmphasisFontCategoryNonProportional ">org.w3c.dom.Document</span> object provides access to a parsed document through methods such as <span class="EmphasisFontCategoryNonProportional ">DocumentType getDoctype()</span>, which makes the document type declaration available through the <span class="EmphasisFontCategoryNonProportional ">org.w3c.dom.DocumentType</span> interface. Conceptually, <span class="EmphasisFontCategoryNonProportional ">Document</span> is the root of the document鈥檚 node tree. It also declares various 鈥?span class=&quot;EmphasisFontCategoryNonProportional &quot;&gt;create</span>鈥?and other methods for creating a node tree. For example, <span class="EmphasisFontCategoryNonProportional ">Element createElement(String tagName)</span>
<span id="ITerm26">
                  
                  
                </span>creates an element named by <span class="EmphasisFontCategoryNonProportional ">tagName</span>, returning a new <span class="EmphasisFontCategoryNonProportional ">org.w3c.dom.Element</span> object with the specified name but with its local name, prefix, and namespace URI set to <span class="EmphasisFontCategoryNonProportional ">null</span>.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar6"><h3 class="Heading">Note</h3><p class="Para" id="Par44">Apart from <span class="EmphasisFontCategoryNonProportional ">DocumentBuilder</span>, <span class="EmphasisFontCategoryNonProportional ">DocumentBuilderFactory</span>, and a few other classes, DOM is based on interfaces, of which <span class="EmphasisFontCategoryNonProportional ">Document</span> and <span class="EmphasisFontCategoryNonProportional ">DocumentType</span> are examples. Behind the scenes, DOM methods (such as the <span class="EmphasisFontCategoryNonProportional ">parse()</span> methods) return objects whose classes implement these interfaces.</p></div><p class="Para" id="Par45"><span class="EmphasisFontCategoryNonProportional ">Document</span> and all other <span class="EmphasisFontCategoryNonProportional ">org.w3c.dom</span> interfaces that describe different kinds of nodes are subinterfaces of the <span class="EmphasisFontCategoryNonProportional ">org.w3c.dom.Node</span> interface. As such, they inherit <span class="EmphasisFontCategoryNonProportional ">Node</span>鈥檚 constants and methods.</p><p class="Para" id="Par46"><span class="EmphasisFontCategoryNonProportional ">Node</span> declares 12 <span id="ITerm27">constants</span> that represent the various kinds of nodes; <span class="EmphasisFontCategoryNonProportional ">ATTRIBUTE_NODE</span> and <span class="EmphasisFontCategoryNonProportional ">ELEMENT_NODE</span> are examples. To identify the kind of node represented by a given <span class="EmphasisFontCategoryNonProportional ">Node</span> object, call <span class="EmphasisFontCategoryNonProportional ">Node</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">short getNodeType()</span> method and compare the returned value to one of these constants.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar7"><h3 class="Heading">Note</h3><p class="Para" id="Par47">The rationale for using <span class="EmphasisFontCategoryNonProportional ">getNodeType()</span> and these constants, instead of using <span class="EmphasisFontCategoryNonProportional ">instanceof</span> and a class name, is that DOM (the object model, not the Java DOM API) was designed to be language independent, and languages such as AppleScript don鈥檛 have the equivalent of <span class="EmphasisFontCategoryNonProportional ">instanceof</span>.</p></div><p class="Para" id="Par48"><span class="EmphasisFontCategoryNonProportional ">Node</span> declares several <span id="ITerm28">methods</span> for getting and setting common node properties. These methods include <span class="EmphasisFontCategoryNonProportional ">String getNodeName()</span>, <span class="EmphasisFontCategoryNonProportional ">String getLocalName()</span>, <span class="EmphasisFontCategoryNonProportional ">String getNamespaceURI()</span>, <span class="EmphasisFontCategoryNonProportional ">String getPrefix()</span>, <span class="EmphasisFontCategoryNonProportional ">void setPrefix(String prefix)</span>, <span class="EmphasisFontCategoryNonProportional ">String getNodeValue()</span>, and <span class="EmphasisFontCategoryNonProportional ">void setNodeValue(String nodeValue)</span>, which let you get and (for some properties) set a node鈥檚 name (such as <span class="EmphasisFontCategoryNonProportional ">#text</span>), local name, namespace URI, prefix, and normalized string value.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar8"><h3 class="Heading">Note</h3><p class="Para" id="Par49">Various <span class="EmphasisFontCategoryNonProportional ">Node</span> methods (such as <span class="EmphasisFontCategoryNonProportional ">setPrefix()</span> and <span class="EmphasisFontCategoryNonProportional ">getNodeValue()</span>) throw an instance of the <span class="EmphasisFontCategoryNonProportional ">org.w3c.dom.DOMException</span> class when something goes wrong. For example, <span class="EmphasisFontCategoryNonProportional ">setPrefix()</span> throws this exception when the <span class="EmphasisFontCategoryNonProportional ">prefix</span> argument contains an illegal character, the node is read-only, or the argument is malformed. Similarly, <span class="EmphasisFontCategoryNonProportional ">getNodeValue()</span> throws <span class="EmphasisFontCategoryNonProportional ">DOMException</span> when <span class="EmphasisFontCategoryNonProportional ">getNodeValue()</span> would return more characters than can fit into a <span class="EmphasisFontCategoryNonProportional ">DOMString</span> (a W3C type) variable on the implementation platform. <span class="EmphasisFontCategoryNonProportional ">DOMException</span> declares a series of constants (such as <span class="EmphasisFontCategoryNonProportional ">DOMSTRING_SIZE_ERR</span>) that classify the reason for the exception.</p></div><div class="Para" id="Par50"><span class="EmphasisFontCategoryNonProportional ">Node</span> declares several methods for navigating the node tree. Three of its <span id="ITerm29">navigation methods</span> are described here:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par51"><span class="EmphasisFontCategoryNonProportional ">boolean hasChildNodes()</span> returns <span class="EmphasisFontCategoryNonProportional ">true</span> when a node has child nodes.</p></li><li><p class="Para" id="Par52"><span class="EmphasisFontCategoryNonProportional ">Node getFirstChild()</span> returns the node鈥檚 first child.</p></li><li><p class="Para" id="Par53"><span class="EmphasisFontCategoryNonProportional ">Node getLastChild()</span> returns the node鈥檚 last child.</p></li></ul></div></div><p class="Para" id="Par54">For nodes with multiple children, you鈥檒l find the <span class="EmphasisFontCategoryNonProportional ">NodeList getChildNodes()</span> method to be handy. This method returns an <span class="EmphasisFontCategoryNonProportional ">org.w3c.dom.NodeList</span> instance whose <span class="EmphasisFontCategoryNonProportional ">int getLength()</span> method returns the number of nodes in the list and whose <span class="EmphasisFontCategoryNonProportional ">Node item(int index)</span> method returns the node at the <span class="EmphasisFontCategoryNonProportional ">index</span>th position in the list (or <span class="EmphasisFontCategoryNonProportional ">null</span> when <span class="EmphasisFontCategoryNonProportional ">index</span>鈥檚 value isn鈥檛 valid鈥攊t鈥檚 less than zero or greater than or equal to <span class="EmphasisFontCategoryNonProportional ">getLength()</span>鈥檚 value).</p><div class="Para" id="Par55"><span class="EmphasisFontCategoryNonProportional ">Node</span> declares four methods for <span id="ITerm30">modifying</span> the tree by inserting, removing, replacing, and appending child nodes:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par56"><span class="EmphasisFontCategoryNonProportional ">Node insertBefore(Node newChild, Node refChild)</span> inserts <span class="EmphasisFontCategoryNonProportional ">newChild</span> before the existing node specified by <span class="EmphasisFontCategoryNonProportional ">refChild</span> and returns <span class="EmphasisFontCategoryNonProportional ">newChild</span>.</p></li><li><p class="Para" id="Par57"><span class="EmphasisFontCategoryNonProportional ">Node removeChild(Node oldChild)</span> removes the child node identified by <span class="EmphasisFontCategoryNonProportional ">oldChild</span> from the tree and returns <span class="EmphasisFontCategoryNonProportional ">oldChild</span>.</p></li><li><p class="Para" id="Par58"><span class="EmphasisFontCategoryNonProportional ">Node replaceChild(Node newChild, Node oldChild)</span> replaces <span class="EmphasisFontCategoryNonProportional ">oldChild</span> with <span class="EmphasisFontCategoryNonProportional ">newChild</span> and returns <span class="EmphasisFontCategoryNonProportional ">oldChild</span>.</p></li><li><p class="Para" id="Par59"><span class="EmphasisFontCategoryNonProportional ">Node appendChild(Node newChild)</span> adds <span class="EmphasisFontCategoryNonProportional ">newChild</span> to the end of the current node鈥檚 child nodes and returns <span class="EmphasisFontCategoryNonProportional ">newChild</span>.</p></li></ul></div></div><p class="Para" id="Par60">Finally, <span class="EmphasisFontCategoryNonProportional ">Node</span> declares several <span id="ITerm31">utility methods</span>, including <span class="EmphasisFontCategoryNonProportional ">Node cloneNode(boolean deep)</span> (create and return a duplicate of the current node, recursively cloning its subtree when <span class="EmphasisFontCategoryNonProportional ">true</span> is passed to <span class="EmphasisFontCategoryNonProportional ">deep</span>), and <span class="EmphasisFontCategoryNonProportional ">void normalize()</span> (descend the tree from the given node and merge all adjacent text nodes, deleting those text nodes that are empty).</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar9"><h3 class="Heading">Tip</h3><p class="Para" id="Par61">To obtain an element node鈥檚 attributes, first call <span class="EmphasisFontCategoryNonProportional ">Node</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">NamedNodeMap getAttributes()</span> method. This method returns an <span class="EmphasisFontCategoryNonProportional ">org.w3c.dom.NamedNodeMap</span> implementation when the node represents an element; otherwise, it returns <span class="EmphasisFontCategoryNonProportional ">null</span>. As well as declaring methods for accessing these nodes by name (such as <span class="EmphasisFontCategoryNonProportional ">Node getNamedItem(String name)</span>), <span class="EmphasisFontCategoryNonProportional ">NamedNodeMap</span> declares <span class="EmphasisFontCategoryNonProportional ">int getLength()</span> and <span class="EmphasisFontCategoryNonProportional ">Node item(int index)</span> methods for returning all attribute nodes by <span class="EmphasisFontCategoryNonProportional ">index</span>. You would then obtain the <span class="EmphasisFontCategoryNonProportional ">Node</span>鈥檚 name by calling a method such as <span class="EmphasisFontCategoryNonProportional ">getNodeName()</span>.</p></div><p class="Para" id="Par62">In addition to inheriting <span class="EmphasisFontCategoryNonProportional ">Node</span>鈥檚 constants and <span id="ITerm32">methods</span>, <span class="EmphasisFontCategoryNonProportional ">Document</span> declares its own methods. For example, you can call <span class="EmphasisFontCategoryNonProportional ">Document</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">String getXmlEncoding()</span>, <span class="EmphasisFontCategoryNonProportional ">boolean getXmlStandalone()</span>, and <span class="EmphasisFontCategoryNonProportional ">String getXmlVersion()</span> methods to return the XML declaration鈥檚 <span class="EmphasisFontCategoryNonProportional ">encoding</span>, <span class="EmphasisFontCategoryNonProportional ">standalone</span>, and <span class="EmphasisFontCategoryNonProportional ">version</span> attribute values, respectively.</p><div class="Para" id="Par63"><span class="EmphasisFontCategoryNonProportional ">Document</span> declares three methods for locating one or more <span id="ITerm33">elements</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par64"><span class="EmphasisFontCategoryNonProportional ">Element getElementById(String elementId)</span> returns the element that has an <span class="EmphasisFontCategoryNonProportional ">id</span> attribute (as in <span class="EmphasisFontCategoryNonProportional ">&lt;img id=...&gt;</span>) matching the value specified by <span class="EmphasisFontCategoryNonProportional ">elementId</span>.</p></li><li><p class="Para" id="Par65"><span class="EmphasisFontCategoryNonProportional ">NodeList getElementsByTagName(String tagname)</span> returns a nodelist of a document鈥檚 elements (in document order) matching the specified <span class="EmphasisFontCategoryNonProportional ">tagName</span>.</p></li><li><p class="Para" id="Par66"><span class="EmphasisFontCategoryNonProportional ">NodeList getElementsByTagNameNS(String namespaceURI,String localName)</span> is equivalent to the second method except in adding to the nodelist only those elements matching <span class="EmphasisFontCategoryNonProportional ">localName</span> and <span class="EmphasisFontCategoryNonProportional ">namespaceURI</span> values. Pass <span class="EmphasisFontCategoryNonProportional ">&quot;</span>*<span class="EmphasisFontCategoryNonProportional ">&quot;</span> to <span class="EmphasisFontCategoryNonProportional ">namespaceURI</span> to match all namespaces; pass <span class="EmphasisFontCategoryNonProportional ">&quot;</span>*<span class="EmphasisFontCategoryNonProportional ">&quot;</span> to <span class="EmphasisFontCategoryNonProportional ">localName</span> to match all local names.</p></li></ul></div></div><p class="Para" id="Par67">The returned element <span id="ITerm34">node</span> and each element node in the list implement the <span class="EmphasisFontCategoryNonProportional ">Element</span> interface. This interface declares methods to return nodelists of descendent elements in the tree, attributes associated with the element, and more. For example, <span class="EmphasisFontCategoryNonProportional ">String getAttribute(String name)</span> returns the value of the attribute identified by <span class="EmphasisFontCategoryNonProportional ">name</span>, whereas <span class="EmphasisFontCategoryNonProportional ">Attr getAttributeNode(String name)</span> returns an attribute node by name. The returned node is an implementation of the <span class="EmphasisFontCategoryNonProportional ">org.w3c.dom.Attr</span> interface.</p></section></section><section class="Section1 RenderAsSection1" id="Sec6"><h2 class="Heading">Demonstrating the DOM API</h2><p class="Para" id="Par68">You now have enough information to explore applications for parsing and creating XML documents. This section shows you how to accomplish these tasks.</p><section class="Section2 RenderAsSection2" id="Sec7"><h3 class="Heading">Parsing an XML Document</h3><div class="Para" id="Par69">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_3_Chapter.xhtml#PC4">3-1</a></span> presents the source code to a DOM-based parsing application that briefly demonstrates how to parse an XML document into a DOM <span id="ITerm35">tree</span>.<div class="ProgramCode" id="PC4"><div class="LineGroup"><div class="FixedLine">import java.io.IOException;</div></div><div class="LineGroup"><div class="FixedLine">import javax.xml.parsers.DocumentBuilder;</div><div class="FixedLine">import javax.xml.parsers.DocumentBuilderFactory;</div><div class="FixedLine">import javax.xml.parsers.FactoryConfigurationError;</div><div class="FixedLine">import javax.xml.parsers.ParserConfigurationException;</div></div><div class="LineGroup"><div class="FixedLine">import org.w3c.dom.Attr;</div><div class="FixedLine">import org.w3c.dom.Document;</div><div class="FixedLine">import org.w3c.dom.Element;</div><div class="FixedLine">import org.w3c.dom.NamedNodeMap;</div><div class="FixedLine">import org.w3c.dom.Node;</div><div class="FixedLine">import org.w3c.dom.NodeList;</div></div><div class="LineGroup"><div class="FixedLine">import org.xml.sax.SAXException;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class DOMDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      if (args.length != 1)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.println(&quot;usage: java DOMDemo xmlfile&quot;);</div><div class="FixedLine">         return;</div><div class="FixedLine">      }</div><div class="FixedLine">      try</div><div class="FixedLine">      {</div><div class="FixedLine">         DocumentBuilderFactory dbf =</div><div class="FixedLine">            DocumentBuilderFactory.newInstance();</div><div class="FixedLine">         dbf.setNamespaceAware(true);</div><div class="FixedLine">         DocumentBuilder db = dbf.newDocumentBuilder();</div><div class="FixedLine">         Document doc = db.parse(args[0]);</div><div class="FixedLine">         out.printf(&quot;Version = %s%n&quot;, doc.getXmlVersion());</div><div class="FixedLine">         out.printf(&quot;Encoding = %s%n&quot;, doc.getXmlEncoding());</div><div class="FixedLine">         out.printf(&quot;Standalone = %b%n%n&quot;, doc.getXmlStandalone());</div><div class="FixedLine">         if (doc.hasChildNodes())</div><div class="FixedLine">         {</div><div class="FixedLine">            NodeList nl = doc.getChildNodes();</div><div class="FixedLine">            for (int i = 0; i &lt; nl.getLength(); i++)</div><div class="FixedLine">            {</div><div class="FixedLine">               Node node = nl.item(i);</div><div class="FixedLine">               if (node.<strong class="EmphasisTypeBold ">getNodeType()</strong> == Node.ELEMENT_NODE)</div><div class="FixedLine">                  dump((Element) node);</div><div class="FixedLine">            }</div><div class="FixedLine">         }</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (IOException ioe)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;IOE: %s%n&quot;, ioe.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (SAXException saxe)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;SAXE: %s%n&quot;, saxe.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (FactoryConfigurationError fce)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;FCE: %s%n&quot;, fce.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (ParserConfigurationException pce)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;PCE: %s%n&quot;, pce.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   static void dump(Element e)</div><div class="FixedLine">   {</div><div class="FixedLine">      out.printf(&quot;Element: %s, %s, %s, %s%n&quot;,</div><div class="FixedLine">                 e.getNodeName(), e.getLocalName(),</div><div class="FixedLine">                 e.getPrefix(), e.getNamespaceURI());</div><div class="FixedLine">      NamedNodeMap nnm = e.getAttributes();</div><div class="FixedLine">      if (nnm != null)</div><div class="FixedLine">         for (int i = 0; i &lt; nnm.getLength(); i++)</div><div class="FixedLine">         {</div><div class="FixedLine">            Node node = nnm.item(i) <span id="ITerm36">
                        
                        
                      </span>;</div><div class="FixedLine">            Attr attr = e.getAttributeNode(node.getNodeName());</div><div class="FixedLine">            out.printf(&quot;  Attribute %s = %s%n&quot;,</div><div class="FixedLine">                       attr.getName(), attr.getValue());</div><div class="FixedLine">         }</div><div class="FixedLine">      NodeList nl = e.getChildNodes();</div><div class="FixedLine">      for (int i = 0; i &lt; nl.getLength(); i++)</div><div class="FixedLine">      {</div><div class="FixedLine">         Node node = nl.item(i);</div><div class="FixedLine">         if (node <strong class="EmphasisTypeBold ">instanceof</strong> Element)</div><div class="FixedLine">            dump((Element) node);</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 3-1</span><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">DOMDemo</span> (Version 1)</p></div></div></div></div><p class="Para" id="Par70"><span class="EmphasisFontCategoryNonProportional ">DOMDemo</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">main()</span> method first verifies that one command-line argument (the name of an XML document) has been specified. It then creates a document builder factory, informs the factory that it wants a namespace-aware document builder, and has the factory return this document builder.</p><p class="Para" id="Par71">Continuing, <span class="EmphasisFontCategoryNonProportional ">main()</span> parses the document into a node tree; outputs the XML declaration鈥檚 version number, encoding, and standalone attribute values; and recursively dumps all element nodes (starting with the root node) and their attribute values.</p><p class="Para" id="Par72">Notice the use of <span class="EmphasisFontCategoryNonProportional ">getNodeType()</span> in one part of this listing and <span class="EmphasisFontCategoryNonProportional ">instanceof</span> in another part. The <span class="EmphasisFontCategoryNonProportional ">getNodeType()</span> method<span id="ITerm37">
                  
                </span> call isn鈥檛 necessary (it鈥檚 only present for demonstration) because <span class="EmphasisFontCategoryNonProportional ">instanceof</span> can be used instead. However, the cast from <span class="EmphasisFontCategoryNonProportional ">Node</span> type to <span class="EmphasisFontCategoryNonProportional ">Element</span> type in the <span class="EmphasisFontCategoryNonProportional ">dump()</span> method calls is necessary.</p><div class="Para" id="Par73">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_3_Chapter.xhtml#PC4">3-1</a></span> as follows:<div class="ProgramCode" id="PC5"><div class="LineGroup"><div class="FixedLine">javac DOMDemo.java</div></div></div></div><div class="Para" id="Par74">Run the resulting application to dump Listing <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC3"><span class="RefSource">1-3</span></a></span>鈥檚 article XML content, as follows:<div class="ProgramCode" id="PC6"><div class="LineGroup"><div class="FixedLine">java DOMDemo article.xml</div></div></div></div><div class="Para" id="Par75">You should observe the following output:<div class="ProgramCode" id="PC7"><div class="LineGroup"><div class="FixedLine">Version = 1.0</div><div class="FixedLine">Encoding = null</div><div class="FixedLine">Standalone = false</div></div><div class="LineGroup"><div class="FixedLine">Element: article, article, null, null</div><div class="FixedLine">  Attribute lang = en</div><div class="FixedLine">  Attribute title = The Rebirth of JavaFX</div><div class="FixedLine">Element: abstract, abstract, null, null</div><div class="FixedLine">Element: code, code, null, null</div><div class="FixedLine">Element: body, body, null, null</div></div></div></div><p class="Para" id="Par76">Each <span class="EmphasisFontCategoryNonProportional ">Element</span>-prefixed line presents the node name, followed by the local name, followed by the namespace prefix, followed by the namespace URI. The node and local names are identical because namespaces aren鈥檛 being used. For the same reason, the namespace prefix and namespace URI are <span class="EmphasisFontCategoryNonProportional ">null</span>.</p><div class="Para" id="Par77">Continuing, execute the following command to dump Listing <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC5"><span class="RefSource">1-5</span></a></span>鈥檚 recipe content:<div class="ProgramCode" id="PC8"><div class="LineGroup"><div class="FixedLine">java DOMDemo recipe.xml</div></div></div></div><div class="Para" id="Par78">This time, you observe the following <span id="ITerm38">output</span>, which includes namespace information:<div class="ProgramCode" id="PC9"><div class="LineGroup"><div class="FixedLine">Version = 1.0</div><div class="FixedLine">Encoding = null</div><div class="FixedLine">Standalone = false</div></div><div class="LineGroup"><div class="FixedLine">Element: h:html, html, h, http://www.w3.org/1999/xhtml</div><div class="FixedLine">  Attribute xmlns:h = http://www.w3.org/1999/xhtml</div><div class="FixedLine">  Attribute xmlns:r = http://www.javajeff.ca/</div><div class="FixedLine">Element: h:head, head, h, http://www.w3.org/1999/xhtml</div><div class="FixedLine">Element: h:title, title, h, http://www.w3.org/1999/xhtml</div><div class="FixedLine">Element: h:body, body, h, http://www.w3.org/1999/xhtml</div><div class="FixedLine">Element: r:recipe, recipe, r, http://www.javajeff.ca/</div><div class="FixedLine">Element: r:title, title, r, http://www.javajeff.ca/</div><div class="FixedLine">Element: r:ingredients, ingredients, r, http://www.javajeff.ca/</div><div class="FixedLine">Element: h:ul, ul, h, http://www.w3.org/1999/xhtml</div><div class="FixedLine">Element: h:li, li, h, http://www.w3.org/1999/xhtml</div><div class="FixedLine">Element: r:ingredient, ingredient, r, http://www.javajeff.ca/</div><div class="FixedLine">  Attribute qty = 2</div><div class="FixedLine">Element: h:li, li, h, http://www.w3.org/1999/xhtml</div><div class="FixedLine">Element: r:ingredient, ingredient, r, http://www.javajeff.ca/</div><div class="FixedLine">Element: h:li, li, h, http://www.w3.org/1999/xhtml</div><div class="FixedLine">Element: r:ingredient, ingredient, r, http://www.javajeff.ca/</div><div class="FixedLine">  Attribute qty = 2</div><div class="FixedLine">Element: h:p, p, h, http://www.w3.org/1999/xhtml</div><div class="FixedLine">Element: r:instructions, instructions, r, http://www.javajeff.ca/</div></div></div></div></section><section class="Section2 RenderAsSection2" id="Sec8"><h3 class="Heading">Creating an XML Document</h3><div class="Para" id="Par79">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_3_Chapter.xhtml#PC10">3-2</a></span> presents another version of the <span class="EmphasisFontCategoryNonProportional ">DOMDemo</span> application that briefly <span id="ITerm39">demonstrates</span> the creation of a DOM tree.<div class="ProgramCode" id="PC10"><div class="LineGroup"><div class="FixedLine">import javax.xml.parsers.DocumentBuilder;</div><div class="FixedLine">import javax.xml.parsers.DocumentBuilderFactory;</div><div class="FixedLine">import javax.xml.parsers.FactoryConfigurationError;</div><div class="FixedLine">import javax.xml.parsers.ParserConfigurationException;</div></div><div class="LineGroup"><div class="FixedLine">import org.w3c.dom.Document;</div><div class="FixedLine">import org.w3c.dom.Element;</div><div class="FixedLine">import org.w3c.dom.Node;</div><div class="FixedLine">import org.w3c.dom.NodeList;</div><div class="FixedLine">import org.w3c.dom.Text;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class DOMDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      try</div><div class="FixedLine">      {</div><div class="FixedLine">         DocumentBuilderFactory dbf =</div><div class="FixedLine">            DocumentBuilderFactory.newInstance();</div><div class="FixedLine">         DocumentBuilder db = dbf.newDocumentBuilder();</div><div class="FixedLine">         Document doc = db.newDocument();</div><div class="FixedLine">         // Create the root element.</div><div class="FixedLine">         Element root = doc.createElement(&quot;movie&quot;);</div><div class="FixedLine">         doc.appendChild(root);</div><div class="FixedLine">         // Create name child element and add it to the</div><div class="FixedLine">         // root.</div><div class="FixedLine">         Element name = doc.createElement(&quot;name&quot;);</div><div class="FixedLine">         root.appendChild(name);</div><div class="FixedLine">         // Add a text element to the name element.</div><div class="FixedLine">         Text text = doc.createTextNode(&quot;Le Fabuleux &quot; +</div><div class="FixedLine">                                        &quot;Destin d&apos;Am茅lie &quot; +</div><div class="FixedLine">                                        &quot;Poulain&quot;);</div><div class="FixedLine">         name.appendChild(text);</div><div class="FixedLine">         // Create language child element and add it to the</div><div class="FixedLine">         // root.</div><div class="FixedLine">         Element language = doc.createElement(&quot;language&quot;);</div><div class="FixedLine">         root.appendChild(language);</div><div class="FixedLine">         // Add a text element to the language element.</div><div class="FixedLine">         text = doc.createTextNode(&quot;fran莽ais&quot;);</div><div class="FixedLine">         language.appendChild(text);</div><div class="FixedLine">         out.printf(&quot;Version = %s%n&quot;, doc.getXmlVersion());</div><div class="FixedLine">         out.printf(&quot;Encoding = %s%n&quot;,</div><div class="FixedLine">                    doc.getXmlEncoding());</div><div class="FixedLine">         out.printf(&quot;Standalone = %b%n%n&quot;,</div><div class="FixedLine">                    doc.getXmlStandalone());</div><div class="FixedLine">         NodeList nl = doc.getChildNodes();</div><div class="FixedLine">         for (int i = 0; i &lt; nl.getLength(); i++)</div><div class="FixedLine">         {</div><div class="FixedLine">            Node node = nl.item(i);</div><div class="FixedLine">            if (node.getNodeType() == Node.ELEMENT_NODE)</div><div class="FixedLine">               dump((Element) node);</div><div class="FixedLine">         }</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (FactoryConfigurationError fce)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;FCE: %s%n&quot;, fce.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (ParserConfigurationException pce)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;PCE: %s%n&quot;, pce.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   static void dump(Element e)</div><div class="FixedLine">   {</div><div class="FixedLine">      out.printf(&quot;Element: %s, %s, %s, %s%n&quot;,</div><div class="FixedLine">                 e.getNodeName(), e.getLocalName(),</div><div class="FixedLine">                 e.getPrefix(), e.getNamespaceURI());</div><div class="FixedLine">      NodeList nl = e.getChildNodes();</div><div class="FixedLine">      for (int i = 0; i &lt; nl.getLength(); i++)</div><div class="FixedLine">      {</div><div class="FixedLine">         Node node = nl.item(i);</div><div class="FixedLine">         if (node instanceof Element)</div><div class="FixedLine">            dump((Element) node);</div><div class="FixedLine">         else</div><div class="FixedLine">         if (node instanceof Text)</div><div class="FixedLine">            out.printf(&quot;Text: %s%n&quot;, ((Text) node).getWholeText());</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 3-2</span><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">DOMDemo</span> (Version 2)</p></div></div></div></div><p class="Para" id="Par80"><span class="EmphasisFontCategoryNonProportional ">DOMDemo</span> creates Listing <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC2"><span class="RefSource">1-2</span></a></span>鈥檚 movie document. It uses <span class="EmphasisFontCategoryNonProportional ">Document</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">createElement()</span> method<span id="ITerm40">
                  
                  
                </span> to create the root <span class="EmphasisFontCategoryNonProportional ">movie</span> element and <span class="EmphasisFontCategoryNonProportional ">movie</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">name</span> and <span class="EmphasisFontCategoryNonProportional ">language</span> child elements. It also uses <span class="EmphasisFontCategoryNonProportional ">Document</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">Text createTextNode(String data)</span> method to create text nodes that are attached to the <span class="EmphasisFontCategoryNonProportional ">name</span> and <span class="EmphasisFontCategoryNonProportional ">language</span> nodes. Notice the calls to <span class="EmphasisFontCategoryNonProportional ">Node</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">appendChild()</span> method, to append child nodes (such as <span class="EmphasisFontCategoryNonProportional ">name</span>) to parent nodes (such as <span class="EmphasisFontCategoryNonProportional ">movie</span>).</p><div class="Para" id="Par81">After creating this tree, <span class="EmphasisFontCategoryNonProportional ">DOMDemo</span> outputs the tree鈥檚 element nodes and other information. This output appears as follows:<div class="ProgramCode" id="PC11"><div class="LineGroup"><div class="FixedLine">Version = 1.0</div><div class="FixedLine">Encoding = null</div><div class="FixedLine">Standalone = false</div></div><div class="LineGroup"><div class="FixedLine">Element: movie, null, null, null</div><div class="FixedLine">Element: name, null, null, null</div><div class="FixedLine">Text: Le Fabuleux Destin d&apos;Am茅lie Poulain</div><div class="FixedLine">Element: language, null, null, null</div><div class="FixedLine">Text: fran莽ais</div></div></div></div><p class="Para" id="Par82">There鈥檚 one problem with the output: the XML declaration鈥檚 <span class="EmphasisFontCategoryNonProportional ">encoding</span> attribute hasn鈥檛 been set to <span class="EmphasisFontCategoryNonProportional ">ISO-8859-1</span>. You cannot accomplish this task via the DOM API. Instead, you need to use the XSLT API. While exploring XSLT in Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_6_Chapter.xhtml"><span class="RefSource">6</span></a></span>, you鈥檒l learn how to set the <span class="EmphasisFontCategoryNonProportional ">encoding</span> attribute, and you鈥檒l also learn how to output this tree to an XML document file.</p></section></section><section class="Section1 RenderAsSection1" id="Sec9"><h2 class="Heading">Working with Load and Save</h2><p class="Para" id="Par83">Before DOM Level 3, there was no standard way to load XML content into a new DOM tree and save an existing DOM tree to an XML document. The World Wide Web Consortium (W3C) responded to this deficiency by developing the DOM Level 3 Load and Save Specification (<span class="ExternalRef"><a href="http://www.w3.org/TR/DOM-Level-3-LS/"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional ">www.w3.org/TR/DOM-Level-3-LS/</span>
                </span></a></span>), which adds this support. Although this capability might not seem like much, additional capabilities such as filtering data during a load operation have also been included.</p><div class="Para" id="Par84">Java supports the DOM Level 3 Load and Save Specification via the <span class="EmphasisFontCategoryNonProportional ">org.w3c.dom.ls</span> package and its <span id="ITerm41">interface types</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par85"><span class="EmphasisFontCategoryNonProportional ">DOMImplementationLS</span> contains factory methods for creating Load and Save objects.</p></li><li><p class="Para" id="Par86"><span class="EmphasisFontCategoryNonProportional ">LSInput</span> represents an input source for data.</p></li><li><p class="Para" id="Par87"><span class="EmphasisFontCategoryNonProportional ">LSLoadEvent</span> represents a load event object that signals the completion of a document load.</p></li><li><p class="Para" id="Par88"><span class="EmphasisFontCategoryNonProportional ">LSOutput</span> represents an output destination for data.</p></li><li><p class="Para" id="Par89"><span class="EmphasisFontCategoryNonProportional ">LSParser</span> provides an interface to an object that is able to build, or augment, a DOM tree from various input sources.</p></li><li><p class="Para" id="Par90"><span class="EmphasisFontCategoryNonProportional ">LSParserFilter</span> provides applications with the ability to examine nodes as they are being constructed while parsing.</p></li><li><p class="Para" id="Par91"><span class="EmphasisFontCategoryNonProportional ">LSProgressEvent</span> represents a progress event object that notifies the application about progress as a document is parsed.</p></li><li><p class="Para" id="Par92"><span class="EmphasisFontCategoryNonProportional ">LSResourceResolver</span> provides a way for applications to redirect references to external resources.</p></li><li><p class="Para" id="Par93"><span class="EmphasisFontCategoryNonProportional ">LSSerializer</span> provides an API for serializing (writing) a DOM document to an XML document.</p></li><li><p class="Para" id="Par94"><span class="EmphasisFontCategoryNonProportional ">LSSerializerFilter</span> provides applications with the ability to examine nodes as they are being serialized and decide what nodes should be serialized (or not).</p></li></ul></div></div><p class="Para" id="Par95">This API reveals that load <span id="ITerm42">operations</span> rely on a parser and save operations rely on a serializer.</p><p class="Para" id="Par96">This package also provides the <span class="EmphasisFontCategoryNonProportional ">LSException</span> class, which describes an exception that鈥檚 thrown when processing stops because of a DOM error during a parse or write operation.</p><section class="Section2 RenderAsSection2" id="Sec10"><h3 class="Heading">Loading an XML Document into a DOM Tree</h3><div class="Para" id="Par97">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_3_Chapter.xhtml#PC12">3-3</a></span> presents a third version of the <span class="EmphasisFontCategoryNonProportional ">DOMDemo</span> application that uses <span id="ITerm43">Load and Save</span> to load an XML document into a new DOM tree.<div class="ProgramCode" id="PC12"><div class="LineGroup"><div class="FixedLine">import org.w3c.dom.Attr;</div><div class="FixedLine">import org.w3c.dom.Document;</div><div class="FixedLine">import org.w3c.dom.Element;</div><div class="FixedLine">import org.w3c.dom.NamedNodeMap;</div><div class="FixedLine">import org.w3c.dom.Node;</div><div class="FixedLine">import org.w3c.dom.NodeList;</div></div><div class="LineGroup"><div class="FixedLine">import org.w3c.dom.bootstrap.DOMImplementationRegistry;</div></div><div class="LineGroup"><div class="FixedLine">import org.w3c.dom.ls.DOMImplementationLS;</div><div class="FixedLine">import org.w3c.dom.ls.LSParser;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class DOMDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args) throws Exception</div><div class="FixedLine">   {</div><div class="FixedLine">      if (args.length != 1)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.println(&quot;usage: java DOMDemo xmlfile&quot;);</div><div class="FixedLine">         return;</div><div class="FixedLine">      }</div><div class="FixedLine">      DOMImplementationLS ls = (DOMImplementationLS)</div><div class="FixedLine">         DOMImplementationRegistry.newInstance().</div><div class="FixedLine">         getDOMImplementation(&quot;LS&quot;);</div><div class="FixedLine">      if (ls == null)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.println(&quot;load and save not supported&quot;);</div><div class="FixedLine">         return;</div><div class="FixedLine">      }</div><div class="FixedLine">      LSParser parser =</div><div class="FixedLine">         ls.createLSParser(DOMImplementationLS.</div><div class="FixedLine">                           MODE_SYNCHRONOUS, null);</div><div class="FixedLine">      Document doc = parser.parseURI(args[0]);</div><div class="FixedLine">      if (doc.hasChildNodes())</div><div class="FixedLine">      {</div><div class="FixedLine">         NodeList nl = doc.getChildNodes();</div><div class="FixedLine">         for (int i = 0; i &lt; nl.getLength(); i++)</div><div class="FixedLine">         {</div><div class="FixedLine">            Node node = nl.item(i);</div><div class="FixedLine">            if (node.getNodeType() == Node.ELEMENT_NODE)</div><div class="FixedLine">               dump((Element) node);</div><div class="FixedLine">         }</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   static void dump(Element e)</div><div class="FixedLine">   {</div><div class="FixedLine">      out.printf(&quot;Element: %s, %s, %s, %s%n&quot;,</div><div class="FixedLine">                 e.getNodeName(), e.getLocalName(),</div><div class="FixedLine">                 e.getPrefix(), e.getNamespaceURI());</div><div class="FixedLine">      NamedNodeMap nnm = e.getAttributes();</div><div class="FixedLine">      if (nnm != null)</div><div class="FixedLine">         for (int i = 0; i &lt; nnm.getLength(); i++)</div><div class="FixedLine">         {</div><div class="FixedLine">            Node node = nnm.item(i);</div><div class="FixedLine">            Attr attr =</div><div class="FixedLine">               e.getAttributeNode(node.getNodeName());</div><div class="FixedLine">            out.printf(&quot;  Attribute %s = %s%n&quot;,</div><div class="FixedLine">                       attr.getName(), attr.getValue());</div><div class="FixedLine">         }</div><div class="FixedLine">      NodeList nl = e.getChildNodes();</div><div class="FixedLine">      for (int i = 0; i &lt; nl.getLength(); i++)</div><div class="FixedLine">      {</div><div class="FixedLine">         Node node = nl.item(i);</div><div class="FixedLine">         if (node instanceof Element)</div><div class="FixedLine">            dump((Element) node);</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 3-3</span><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">DOMDemo</span><span id="ITerm44">
                          
                          
                        </span> (Version 3)</p></div></div></div></div><div class="Para" id="Par98"><span class="EmphasisFontCategoryNonProportional ">DOMDemo</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">main()</span> method first validates the command line, which requires that only a single argument (the name of an XML file) be specified. <span class="EmphasisFontCategoryNonProportional ">main()</span> then creates a <span class="EmphasisFontCategoryNonProportional ">DOMImplementationLS</span> object<span id="ITerm45">
                  
                  
                </span>, as follows:<div class="OrderedList"><ol><li class="ListItem"><span class="ItemNumber">1.</span><div class="ItemContent"><p class="Para" id="Par99">It invokes <span class="EmphasisFontCategoryNonProportional ">org.w3c.dom.bootstrap.DOMImplementationRegistry</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">static DOMImplementationRegistry newInstance()</span> method to obtain a <span class="EmphasisFontCategoryNonProportional ">DOMImplementationRegistry</span> object.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">2.</span><div class="ItemContent"><p class="Para" id="Par100">It invokes <span class="EmphasisFontCategoryNonProportional ">DOMImplementationRegistry</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">DOMImplementation getDOMImplementation</span>鈥?span class=&quot;EmphasisFontCategoryNonProportional &quot;&gt;(String features)</span> method on the previously returned <span class="EmphasisFontCategoryNonProportional ">DOMImplementationRegistry</span> object to obtain an object from a class that implements the <span class="EmphasisFontCategoryNonProportional ">DOMImplementation</span> interface. The string <span class="EmphasisFontCategoryNonProportional ">LS</span> is passed to <span class="EmphasisFontCategoryNonProportional ">getDOMImplementation()</span> because a <span class="EmphasisFontCategoryNonProportional ">DOMImplementation</span> instance supporting Load and Save (<span class="EmphasisFontCategoryNonProportional ">DOMImplementationLS</span>) is required. This method returns <span class="EmphasisFontCategoryNonProportional ">null</span> when an implementation with the desired <span class="EmphasisFontCategoryNonProportional ">features</span> isn鈥檛 found. (For brevity, I omit checking for <span class="EmphasisFontCategoryNonProportional ">null</span> in subsequent 鈥淟oad and Save鈥?examples.)</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">3.</span><div class="ItemContent"><p class="Para" id="Par101">It casts the returned <span class="EmphasisFontCategoryNonProportional ">org.w3c.dom.DOMImplementation</span> instance to a <span class="EmphasisFontCategoryNonProportional ">DOMImplementationLS</span> instance, which is allowable because <span class="EmphasisFontCategoryNonProportional ">getDOMImplementation()</span> returns an object whose class implements <span class="EmphasisFontCategoryNonProportional ">DOMImplementation</span> and <span class="EmphasisFontCategoryNonProportional ">DOMImplementationLS</span>.</p></div><div class="ClearBoth"> </div></li></ol></div></div><p class="Para" id="Par102"><span class="EmphasisFontCategoryNonProportional ">main()</span> next invokes <span class="EmphasisFontCategoryNonProportional ">DOMImplementationLS</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">LSParser</span><span id="ITerm46">
                  
                  
                </span>
<span class="EmphasisFontCategoryNonProportional ">createLSParser</span>鈥?span class=&quot;EmphasisFontCategoryNonProportional &quot;&gt;(short mode, String schemaType)</span> method to create a new <span class="EmphasisFontCategoryNonProportional ">LSParser</span> object. <span class="EmphasisFontCategoryNonProportional ">DOMImplementationLS.MODE_SYNCHRONOUS</span> is passed to <span class="EmphasisFontCategoryNonProportional ">mode</span> to cause the application to wait until parsing is finished. <span class="EmphasisFontCategoryNonProportional ">null</span> is passed to <span class="EmphasisFontCategoryNonProportional ">schemaType</span> so that the created <span class="EmphasisFontCategoryNonProportional ">LSParser</span> can work with any kind of schema (although none is being used in this example).</p><p class="Para" id="Par103"><span class="EmphasisFontCategoryNonProportional ">LSParser</span> provides a <span class="EmphasisFontCategoryNonProportional ">Document parseURI</span>鈥?span class=&quot;EmphasisFontCategoryNonProportional &quot;&gt;(String uri)</span> method for parsing an XML document located at the specified <span class="EmphasisFontCategoryNonProportional ">uri</span> value. <span class="EmphasisFontCategoryNonProportional ">main()</span> calls this method to perform the parse and return a <span class="EmphasisFontCategoryNonProportional ">Document</span>, which is subsequently dumped to the standard output.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar10"><h3 class="Heading">Note</h3><p class="Para" id="Par104"><span class="EmphasisFontCategoryNonProportional ">LSParser</span> also provides <span class="EmphasisFontCategoryNonProportional ">Document parse</span>鈥?span class=&quot;EmphasisFontCategoryNonProportional &quot;&gt;(LSInput input)</span> and <span class="EmphasisFontCategoryNonProportional ">Node parseWithContext</span>鈥?span class=&quot;EmphasisFontCategoryNonProportional &quot;&gt;(LSInput input, Node contextArg, short action)</span> methods for parsing. The former method takes an <span class="EmphasisFontCategoryNonProportional ">LSInput</span> argument, which can represent a public identifier, a system identifier, a byte stream (possibly with a specified encoding), a base URI, or a character stream. The latter method lets you parse one XML document into another XML document. The value passed to <span class="EmphasisFontCategoryNonProportional ">action</span> determines whether the new content precedes, follows, or replaces existing content.</p></div><div class="Para" id="Par105">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_3_Chapter.xhtml#PC12">3-3</a></span> and run it against Listing <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC1"><span class="RefSource">1-1</span></a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">recipe.xml</span> document. You should observe the following <span id="ITerm47">output</span>:<div class="ProgramCode" id="PC13"><div class="LineGroup"><div class="FixedLine">Element: recipe, recipe, null, null</div><div class="FixedLine">Element: title, title, null, null</div><div class="FixedLine">Element: ingredients, ingredients, null, null</div><div class="FixedLine">Element: ingredient, ingredient, null, null</div><div class="FixedLine">  Attribute qty = 2</div><div class="FixedLine">Element: ingredient, ingredient, null, null</div><div class="FixedLine">Element: ingredient, ingredient, null, null</div><div class="FixedLine">  Attribute qty = 2</div><div class="FixedLine">Element: instructions, instructions, null, null</div></div></div></div></section><section class="Section2 RenderAsSection2" id="Sec11"><h3 class="Heading">Configuring a Parser</h3><p class="Para" id="Par106">The <span class="EmphasisFontCategoryNonProportional ">LSParser</span> interface declares a <span class="EmphasisFontCategoryNonProportional ">DOMConfiguration getDomConfig()</span> method<span id="ITerm48">
                  
                  
                </span> that returns the <span class="EmphasisFontCategoryNonProportional ">org.w3c.dom.DOMConfiguration</span> object used when <span id="ITerm49">parsing</span> an input source. You can use the <span class="EmphasisFontCategoryNonProportional ">DOMConfiguration</span> object to configure the parser before parsing an XML document.</p><p class="Para" id="Par107"><span class="EmphasisFontCategoryNonProportional ">DOMConfiguration</span> declares the <span class="EmphasisFontCategoryNonProportional ">void setParameter</span>鈥?span class=&quot;EmphasisFontCategoryNonProportional &quot;&gt;(String name, Object value)</span> method for setting the value of a configuration parameter. Supported parameter names and values are described in <span class="EmphasisFontCategoryNonProportional ">DOMConfiguration</span>鈥檚 Javadoc.</p><div class="Para" id="Par108">Several parameters deal with validation. For example, <span class="EmphasisFontCategoryNonProportional ">validation</span> requires that the parser validate the document against a schema (such as XML Schema or DTD), but only when this parameter is set to <span class="EmphasisFontCategoryNonProportional ">true</span> (it defaults to <span class="EmphasisFontCategoryNonProportional ">false</span>). Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_3_Chapter.xhtml#PC14">3-4</a></span> presents a <span class="EmphasisFontCategoryNonProportional ">DOMDemo</span> application that configures the parser to <span id="ITerm50">validate</span>.<div class="ProgramCode" id="PC14"><div class="LineGroup"><div class="FixedLine">import org.w3c.dom.Attr;</div><div class="FixedLine">import org.w3c.dom.Document;</div><div class="FixedLine">import org.w3c.dom.DOMConfiguration;</div><div class="FixedLine">import org.w3c.dom.Element;</div><div class="FixedLine">import org.w3c.dom.NamedNodeMap;</div><div class="FixedLine">import org.w3c.dom.Node;</div><div class="FixedLine">import org.w3c.dom.NodeList;</div></div><div class="LineGroup"><div class="FixedLine">import org.w3c.dom.bootstrap.DOMImplementationRegistry;</div></div><div class="LineGroup"><div class="FixedLine">import org.w3c.dom.ls.DOMImplementationLS;</div><div class="FixedLine">import org.w3c.dom.ls.LSParser;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class DOMDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args) throws Exception</div><div class="FixedLine">   {</div><div class="FixedLine">      if (args.length != 1)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.println(&quot;usage: java DOMDemo xmlfile&quot;);</div><div class="FixedLine">         return;</div><div class="FixedLine">      }</div><div class="FixedLine">      DOMImplementationLS ls = (DOMImplementationLS)</div><div class="FixedLine">         DOMImplementationRegistry.newInstance().</div><div class="FixedLine">         getDOMImplementation(&quot;LS&quot;);</div><div class="FixedLine">      LSParser parser =</div><div class="FixedLine">         ls.createLSParser(DOMImplementationLS.</div><div class="FixedLine">                           MODE_SYNCHRONOUS, null);</div><div class="FixedLine">      DOMConfiguration config = parser.getDomConfig();</div><div class="FixedLine">      config.setParameter(&quot;validate&quot;, Boolean.TRUE);</div><div class="FixedLine">      Document doc = parser.parseURI(args[0]);</div><div class="FixedLine">      if (doc.hasChildNodes())</div><div class="FixedLine">      {</div><div class="FixedLine">         NodeList nl = doc.getChildNodes();</div><div class="FixedLine">         for (int i = 0; i &lt; nl.getLength(); i++)</div><div class="FixedLine">         {</div><div class="FixedLine">            Node node = nl.item(i);</div><div class="FixedLine">            if (node.getNodeType() == Node.ELEMENT_NODE)</div><div class="FixedLine">               dump((Element) node);</div><div class="FixedLine">         }</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   static void dump(Element e)</div><div class="FixedLine">   {</div><div class="FixedLine">      out.printf(&quot;Element: %s, %s, %s, %s%n&quot;,</div><div class="FixedLine">                 e.getNodeName(), e.getLocalName(),</div><div class="FixedLine">                 e.getPrefix(), e.getNamespaceURI());</div><div class="FixedLine">      NamedNodeMap nnm = e.getAttributes();</div><div class="FixedLine">      if (nnm != null)</div><div class="FixedLine">         for (int i = 0; i &lt; nnm.getLength(); i++)</div><div class="FixedLine">         {</div><div class="FixedLine">            Node node = nnm.item(i);</div><div class="FixedLine">            Attr attr =</div><div class="FixedLine">               e.getAttributeNode(node.getNodeName());</div><div class="FixedLine">            out.printf(&quot;  Attribute %s = %s%n&quot;,</div><div class="FixedLine">                       attr.getName(), attr.getValue());</div><div class="FixedLine">         }</div><div class="FixedLine">      NodeList nl = e.getChildNodes();</div><div class="FixedLine">      for (int i = 0; i &lt; nl.getLength(); i++)</div><div class="FixedLine">      {</div><div class="FixedLine">         Node node = nl.item(i);</div><div class="FixedLine">         if (node instanceof Element)</div><div class="FixedLine">            dump((Element) node);</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 3-4</span><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">DOMDemo</span> (Version 4)</p></div></div></div></div><p class="Para" id="Par109"><span class="EmphasisFontCategoryNonProportional ">DOMDemo</span> executes <span class="EmphasisFontCategoryNonProportional ">DOMConfiguration config = parser.getDomConfig();</span> followed by <span class="EmphasisFontCategoryNonProportional ">config.setParameter(&quot;validate&quot;, Boolean.TRUE);</span> to configure the parser to perform validation.</p><div class="Para" id="Par110">Compile the source code. Before running the application, you鈥檒l need a suitable XML file. Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_3_Chapter.xhtml#PC15">3-5</a></span> offers a suitable candidate.<div class="ProgramCode" id="PC15"><div class="LineGroup"><div class="FixedLine">&lt;?xml version=&quot;1.0&quot;?&gt;</div><div class="FixedLine">&lt;!DOCTYPE recipe [</div><div class="FixedLine">   &lt;!ELEMENT recipe (title, ingredients, instructions)&gt;</div><div class="FixedLine">   &lt;!ELEMENT title (#PCDATA)&gt;</div><div class="FixedLine">   &lt;!ELEMENT ingredients (ingredient+)&gt;</div><div class="FixedLine">   &lt;!ELEMENT ingredient (#PCDATA)&gt;</div><div class="FixedLine">   &lt;!ELEMENT instructions (#PCDATA)&gt;</div><div class="FixedLine">   &lt;!ATTLIST ingredient qty CDATA &quot;1&quot;&gt;</div><div class="FixedLine">]&gt;</div><div class="FixedLine">&lt;recipe&gt;</div><div class="FixedLine">   &lt;title&gt;</div><div class="FixedLine">      Grilled Cheese Sandwich</div><div class="FixedLine">   &lt;/title&gt;</div><div class="FixedLine">   &lt;instructions&gt;</div><div class="FixedLine">      Place frying pan on element and select medium heat.</div><div class="FixedLine">      For each bread slice, smear one pat of margarine on</div><div class="FixedLine">      one side of bread slice. Place cheese slice between</div><div class="FixedLine">      bread slices with margarine-smeared sides away from</div><div class="FixedLine">      the cheese. Place sandwich in frying pan with one</div><div class="FixedLine">      margarine-smeared side in contact with pan. Fry for</div><div class="FixedLine">      a couple of minutes and flip. Fry other side for a</div><div class="FixedLine">      minute and serve.</div><div class="FixedLine">   &lt;/instructions&gt;</div><div class="FixedLine">   &lt;ingredients&gt;</div><div class="FixedLine">      &lt;ingredient qty=&quot;2&quot;&gt;</div><div class="FixedLine">         bread slice</div><div class="FixedLine">      &lt;/ingredient&gt;</div><div class="FixedLine">      &lt;ingredient&gt;</div><div class="FixedLine">         cheese slice</div><div class="FixedLine">      &lt;/ingredient&gt;</div><div class="FixedLine">      &lt;ingredient qty=&quot;2&quot;&gt;</div><div class="FixedLine">         margarine pat</div><div class="FixedLine">      &lt;/ingredient&gt;</div><div class="FixedLine">   &lt;/ingredients&gt;</div><div class="FixedLine">&lt;/recipe&gt;</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 3-5</span><p class="SimplePara">An <span id="ITerm51">Invalid Recipe Document</span></p></div></div></div></div><p class="Para" id="Par111">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_3_Chapter.xhtml#PC15">3-5</a></span> presents the contents of a recipe document that鈥檚 similar to the abbreviated <span id="ITerm52">recipe</span> content presented in Listing <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC9"><span class="RefSource">1-8</span></a></span>(see Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml"><span class="RefSource">1</span></a></span>). However, there is a crucial difference: I鈥檝e placed the <span class="EmphasisFontCategoryNonProportional ">instructions</span> element before the <span class="EmphasisFontCategoryNonProportional ">ingredients</span> element, which violates the document鈥檚 internal DTD.</p><div class="Para" id="Par112">Run <span class="EmphasisFontCategoryNonProportional ">DOMDemo</span> against a <span class="EmphasisFontCategoryNonProportional ">recipe.xml</span> file containing this content, and you should observe the following <span id="ITerm53">output</span>:<div class="ProgramCode" id="PC16"><div class="LineGroup"><div class="FixedLine">[Error] recipe.xml:35:10: The content of element type &quot;recipe&quot; must match &quot;(title,ingredients,instructions)&quot;.</div><div class="FixedLine">Element: recipe, recipe, null, null</div><div class="FixedLine">Element: title, title, null, null</div><div class="FixedLine">Element: instructions, instructions, null, null</div><div class="FixedLine">Element: ingredients, ingredients, null, null</div><div class="FixedLine">Element: ingredient, ingredient, null, null</div><div class="FixedLine">  Attribute qty = 2</div><div class="FixedLine">Element: ingredient, ingredient, null, null</div><div class="FixedLine">  Attribute qty = 1</div><div class="FixedLine">Element: ingredient, ingredient, null, null</div><div class="FixedLine">  Attribute qty = 2</div></div></div></div><div class="Para" id="Par113">You can use <span class="EmphasisFontCategoryNonProportional ">setParameter()</span> to register a <span id="ITerm54">custom error handler</span> with the parser, perhaps to log errors. Start by subclassing the <span class="EmphasisFontCategoryNonProportional ">org.w3c.dom.DOMErrorHandler</span> class, overriding its <span class="EmphasisFontCategoryNonProportional ">boolean handleError</span>鈥?span class=&quot;EmphasisFontCategoryNonProportional &quot;&gt;(DOMError error)</span> method:<div class="ProgramCode" id="PC17"><div class="LineGroup"><div class="FixedLine">public class ErrHandler implements DOMErrorHandler</div><div class="FixedLine">{</div><div class="FixedLine">   @Override</div><div class="FixedLine">   public boolean handleError(DOMError error)</div><div class="FixedLine">   {</div><div class="FixedLine">      short severity = error.getSeverity();</div><div class="FixedLine">      if (severity == error.SEVERITY_ERROR)</div><div class="FixedLine">         System.out.printf(&quot;DOM3 error: %s%n&quot;,</div><div class="FixedLine">                           error.getMessage());</div><div class="FixedLine">      else</div><div class="FixedLine">      if (severity == error.SEVERITY_FATAL_ERROR)</div><div class="FixedLine">         System.out.printf(&quot;DOM3 fatal error: %s%n&quot;,</div><div class="FixedLine">                           error.getMessage());</div><div class="FixedLine">      else</div><div class="FixedLine">      if (severity == error.SEVERITY_WARNING)</div><div class="FixedLine">         System.out.printf(&quot;DOM3 warning: %s%n&quot;,</div><div class="FixedLine">                           error.getMessage());</div><div class="FixedLine">      return true;</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div></div></div><p class="Para" id="Par114">The <span class="EmphasisFontCategoryNonProportional ">org.w3c.dom.DOMError</span> object passed to <span class="EmphasisFontCategoryNonProportional ">handleError()</span> describes a DOM error. This interface declares three severity level constants: <span class="EmphasisFontCategoryNonProportional ">SEVERITY_ERROR</span>, <span class="EmphasisFontCategoryNonProportional ">SEVERITY_FATAL_ERROR</span>, and <span class="EmphasisFontCategoryNonProportional ">SEVERITY_WARNING</span>. It also declares <span class="EmphasisFontCategoryNonProportional ">short getSeverity()</span> to return the severity level, and other useful methods.</p><p class="Para" id="Par115">The <span class="EmphasisFontCategoryNonProportional ">handleError()</span> method<span id="ITerm55">
                  
                </span> returns <span class="EmphasisFontCategoryNonProportional ">false</span> to inform the parser to stop as soon as possible or <span class="EmphasisFontCategoryNonProportional ">true</span> to inform the parser to continue (depending on the error鈥檚 severity level).</p><div class="Para" id="Par116">After instantiating the error handler subclass, register it with the parser by invoking <span class="EmphasisFontCategoryNonProportional ">setParameter()</span> with <span class="EmphasisFontCategoryNonProportional ">error-handler</span> as the name and an instance of the error handler subclass as the value:<div class="ProgramCode" id="PC18"><div class="LineGroup"><div class="FixedLine">DOMConfiguration config = parser.getDomConfig();</div><div class="FixedLine">config.setParameter(&quot;error-handler&quot;, new ErrHandler());</div></div></div></div></section><section class="Section2 RenderAsSection2" id="Sec12"><h3 class="Heading">Filtering an XML Document While Parsing</h3><div class="Para" id="Par117">You can install a <em class="EmphasisTypeItalic ">filter</em> on an <span class="EmphasisFontCategoryNonProportional ">LSParser</span> instance to determine what content to accept and what content to ignore while building a parse tree. A <span id="ITerm56">filter</span> is an instance of the <span class="EmphasisFontCategoryNonProportional ">LSParserFilter</span> interface and must implement the following <span id="ITerm57">methods</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par118"><span id="ITerm58">
                        <span class="EmphasisFontCategoryNonProportional ">short acceptNode(Node node)</span>
                        
                        
                      </span>: This method is called after the XML content corresponding to <span class="EmphasisFontCategoryNonProportional ">node</span> has been parsed. It returns <span class="EmphasisFontCategoryNonProportional ">LSParserFilter.FILTER_ACCEPT</span> if the node should be included in the DOM tree, <span class="EmphasisFontCategoryNonProportional ">LSParserFilter.FILTER_REJECT</span> if the node (and all of its children) should be rejected, <span class="EmphasisFontCategoryNonProportional ">LSParserFilter.FILTER_SKIP</span> if the node should be skipped (all of its children are inserted in its place), or <span class="EmphasisFontCategoryNonProportional ">LSParserFilter.INTERRUPT</span> if the filter wants to stop document processing (the node is rejected).</p></li><li><p class="Para" id="Par119"><span id="ITerm59">
                        <span class="EmphasisFontCategoryNonProportional ">int getWhatToShow()</span>
                        
                        
                      </span>: Tell the parser what types of nodes to show to <span class="EmphasisFontCategoryNonProportional ">acceptNode()</span>. Nodes that are not shown to the filter are automatically included in the DOM tree being built. It returns a bitwise ORed combination of <span class="EmphasisFontCategoryNonProportional ">org.w3c.dom.NodeFilter SHOW_</span>-prefixed constants (e.g., <span class="EmphasisFontCategoryNonProportional ">SHOW_ELEMENT</span>). Constants <span class="EmphasisFontCategoryNonProportional ">SHOW_ATTRIBUTE</span>, <span class="EmphasisFontCategoryNonProportional ">SHOW_DOCUMENT</span>, <span class="EmphasisFontCategoryNonProportional ">SHOW_DOCUMENT_TYPE</span>, <span class="EmphasisFontCategoryNonProportional ">SHOW_NOTATION</span>, <span class="EmphasisFontCategoryNonProportional ">SHOW_ENTITY</span>, and <span class="EmphasisFontCategoryNonProportional ">SHOW_DOCUMENT_FRAGMENT</span> are meaningless because such nodes are never passed to <span class="EmphasisFontCategoryNonProportional ">acceptNode()</span>.</p></li><li><p class="Para" id="Par120"><span class="EmphasisFontCategoryNonProportional ">short startElement(Element e)</span><span id="ITerm60">
                        
                        
                      </span>: The parser calls this method after element <span class="EmphasisFontCategoryNonProportional ">e</span>鈥檚 start tag is scanned but before the rest of the element is processed. The intent is to allow the element, including any children, to be efficiently skipped. Only element nodes are passed to <span class="EmphasisFontCategoryNonProportional ">startElement()</span>, which returns the same <span id="ITerm61">constants</span> as <span class="EmphasisFontCategoryNonProportional ">acceptNode()</span>.</p></li></ul></div></div><div class="Para" id="Par121">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_3_Chapter.xhtml#PC19">3-6</a></span> presents a <span class="EmphasisFontCategoryNonProportional ">DOMDemo</span> application that extends Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_3_Chapter.xhtml#PC12">3-3</a></span> with a <span id="ITerm62">filter</span>.<div class="ProgramCode" id="PC19"><div class="LineGroup"><div class="FixedLine">import org.w3c.dom.Attr;</div><div class="FixedLine">import org.w3c.dom.Document;</div><div class="FixedLine">import org.w3c.dom.Element;</div><div class="FixedLine">import org.w3c.dom.NamedNodeMap;</div><div class="FixedLine">import org.w3c.dom.Node;</div><div class="FixedLine">import org.w3c.dom.NodeList;</div></div><div class="LineGroup"><div class="FixedLine">import org.w3c.dom.bootstrap.DOMImplementationRegistry;</div></div><div class="LineGroup"><div class="FixedLine">import org.w3c.dom.ls.DOMImplementationLS;</div><div class="FixedLine">import org.w3c.dom.ls.LSParser;</div><div class="FixedLine">import org.w3c.dom.ls.LSParserFilter;</div></div><div class="LineGroup"><div class="FixedLine">import org.w3c.dom.traversal.NodeFilter;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">class InputFilter implements LSParserFilter</div><div class="FixedLine">{</div><div class="FixedLine">   private boolean accept;</div></div><div class="LineGroup"><div class="FixedLine">   InputFilter(boolean accept)</div><div class="FixedLine">   {</div><div class="FixedLine">      this.accept = accept;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public short acceptNode(Node node)</div><div class="FixedLine">   {</div><div class="FixedLine">      return (accept) ? FILTER_ACCEPT : FILTER_REJECT;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public int getWhatToShow()</div><div class="FixedLine">   {</div><div class="FixedLine">      return NodeFilter.SHOW_ELEMENT;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public short startElement(Element e)</div><div class="FixedLine">   {</div><div class="FixedLine">      return LSParserFilter.FILTER_ACCEPT;</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">public class DOMDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args) throws Exception</div><div class="FixedLine">   {</div><div class="FixedLine">      if (args.length != 2)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.println(&quot;usage: java DOMDemo xmlfile &quot; +</div><div class="FixedLine">                     &quot;accept|reject&quot;);</div><div class="FixedLine">         return;</div><div class="FixedLine">      }</div><div class="FixedLine">      DOMImplementationLS ls = (DOMImplementationLS)</div><div class="FixedLine">         DOMImplementationRegistry.newInstance().</div><div class="FixedLine">         getDOMImplementation(&quot;LS&quot;);</div><div class="FixedLine">      LSParser parser =</div><div class="FixedLine">         ls.createLSParser(DOMImplementationLS.</div><div class="FixedLine">                           MODE_SYNCHRONOUS, null);</div><div class="FixedLine">      LSParserFilter filter =</div><div class="FixedLine">         new InputFilter(args[1].equals(&quot;accept&quot;));</div><div class="FixedLine">      parser.setFilter(filter);</div><div class="FixedLine">      Document doc = parser.parseURI(args[0]);</div><div class="FixedLine">      if (doc.hasChildNodes())</div><div class="FixedLine">      {</div><div class="FixedLine">         NodeList nl = doc.getChildNodes();</div><div class="FixedLine">         for (int i = 0; i &lt; nl.getLength(); i++)</div><div class="FixedLine">         {</div><div class="FixedLine">            Node node = nl.item(i);</div><div class="FixedLine">            if (node.getNodeType() == Node.ELEMENT_NODE)</div><div class="FixedLine">               dump((Element) node);</div><div class="FixedLine">         }</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   static void dump(Element e)</div><div class="FixedLine">   {</div><div class="FixedLine">      out.printf(&quot;Element: %s, %s, %s, %s%n&quot;,</div><div class="FixedLine">                 e.getNodeName(), e.getLocalName(),</div><div class="FixedLine">                 e.getPrefix(), e.getNamespaceURI());</div><div class="FixedLine">      NamedNodeMap nnm = e.getAttributes();</div><div class="FixedLine">      if (nnm != null)</div><div class="FixedLine">         for (int i = 0; i &lt; nnm.getLength(); i++)</div><div class="FixedLine">         {</div><div class="FixedLine">            Node node = nnm.item(i);</div><div class="FixedLine">            Attr attr =</div><div class="FixedLine">               e.getAttributeNode(node.getNodeName());</div><div class="FixedLine">            out.printf(&quot;  Attribute %s = %s%n&quot;,</div><div class="FixedLine">                       attr.getName(), attr.getValue());</div><div class="FixedLine">         }</div><div class="FixedLine">      NodeList nl = e.getChildNodes();</div><div class="FixedLine">      for (int i = 0; i &lt; nl.getLength(); i++)</div><div class="FixedLine">      {</div><div class="FixedLine">         Node node = nl.item(i);</div><div class="FixedLine">         if (node instanceof Element)</div><div class="FixedLine">            dump((Element) node);</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 3-6</span><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">DOMDemo</span> (Version 5)</p></div></div></div></div><p class="Para" id="Par122">This version of <span class="EmphasisFontCategoryNonProportional ">DOMDemo</span> introduces an <span class="EmphasisFontCategoryNonProportional ">InputFilter</span> class that extends <span class="EmphasisFontCategoryNonProportional ">LSParserFilter</span>. Its constructor saves an <span class="EmphasisFontCategoryNonProportional ">accept</span> argument that tells the filter to accept every node (when <span class="EmphasisFontCategoryNonProportional ">true</span>) or reject every node (when <span class="EmphasisFontCategoryNonProportional ">false</span>). The filter is registered with the <span class="EmphasisFontCategoryNonProportional ">LSParser</span> by calling this interface鈥檚 <span class="EmphasisFontCategoryNonProportional ">void setFilter</span>鈥?span class=&quot;EmphasisFontCategoryNonProportional &quot;&gt;(LSParserFilter filter)</span> method.</p><div class="Para" id="Par123">Compile the listing and run the <span id="ITerm63">application</span> with Listing <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC1"><span class="RefSource">1-1</span></a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">recipe.xml</span> document as follows:<div class="ProgramCode" id="PC20"><div class="LineGroup"><div class="FixedLine">java DOMDemo recipe.xml accept</div></div></div></div><div class="Para" id="Par124">You should observe the following output:<div class="ProgramCode" id="PC21"><div class="LineGroup"><div class="FixedLine">Element: recipe, recipe, null, null</div><div class="FixedLine">Element: title, title, null, null</div><div class="FixedLine">Element: ingredients, ingredients, null, null</div><div class="FixedLine">Element: ingredient, ingredient, null, null</div><div class="FixedLine">  Attribute qty = 2</div><div class="FixedLine">Element: ingredient, ingredient, null, null</div><div class="FixedLine">Element: ingredient, ingredient, null, null</div><div class="FixedLine">  Attribute qty = 2</div><div class="FixedLine">Element: instructions, instructions, null, null</div></div></div></div><div class="Para" id="Par125">Now, run the application as follows:<div class="ProgramCode" id="PC22"><div class="LineGroup"><div class="FixedLine">java DOMDemo recipe.xml reject</div></div></div></div><div class="Para" id="Par126">This time, you should observe the following output:<div class="ProgramCode" id="PC23"><div class="LineGroup"><div class="FixedLine">Element: recipe, recipe, null, null</div></div></div></div><p class="Para" id="Par127">You might be surprised that there is still some output, which reveals <span class="EmphasisFontCategoryNonProportional ">recipe</span> as the element鈥檚 name. Recall that <span class="EmphasisFontCategoryNonProportional ">recipe</span> is the root element of the <span class="EmphasisFontCategoryNonProportional ">recipe.xml</span> document. A DOM tree requires a root element, which is why this element isn鈥檛 discarded.</p></section><section class="Section2 RenderAsSection2" id="Sec13"><h3 class="Heading">Saving a DOM Tree to an XML Document</h3><div class="Para" id="Par128">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_3_Chapter.xhtml#PC24">3-7</a></span> presents a sixth version of the <span class="EmphasisFontCategoryNonProportional ">DOMDemo</span> application that uses Load and <span id="ITerm64">Save</span> to save an existing DOM tree to an XML document.<div class="ProgramCode" id="PC24"><div class="LineGroup"><div class="FixedLine">import org.w3c.dom.Document;</div></div><div class="LineGroup"><div class="FixedLine">import org.w3c.dom.bootstrap.DOMImplementationRegistry;</div></div><div class="LineGroup"><div class="FixedLine">import org.w3c.dom.ls.DOMImplementationLS;</div><div class="FixedLine">import org.w3c.dom.ls.LSParser;</div><div class="FixedLine">import org.w3c.dom.ls.LSSerializer;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class DOMDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args) throws Exception</div><div class="FixedLine">   {</div><div class="FixedLine">      if (args.length != 1)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.println(&quot;usage: java DOMDemo xmlfile&quot;);</div><div class="FixedLine">         return;</div><div class="FixedLine">      }</div><div class="FixedLine">      DOMImplementationLS ls = (DOMImplementationLS)</div><div class="FixedLine">         DOMImplementationRegistry.newInstance().</div><div class="FixedLine">         getDOMImplementation(&quot;LS&quot;);</div><div class="FixedLine">      LSParser parser =</div><div class="FixedLine">         ls.createLSParser(DOMImplementationLS.</div><div class="FixedLine">                           MODE_SYNCHRONOUS, null);</div><div class="FixedLine">      Document doc = parser.parseURI(args[0]);</div><div class="FixedLine">      LSSerializer serializer = ls.createLSSerializer();</div><div class="FixedLine">      if (serializer.writeToURI(doc, &quot;_&quot; + args[0]))</div><div class="FixedLine">         out.println(&quot;serialization successful&quot;);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 3-7</span><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">DOMDemo</span> (Version 6)<span id="ITerm65">
                          
                          
                        </span></p></div></div></div></div><p class="Para" id="Par129"><span class="EmphasisFontCategoryNonProportional ">DOMDemo</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">main()</span> method invokes <span class="EmphasisFontCategoryNonProportional ">DOMImplementationLS</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">LSSerializer createLSSerializer()</span> method to create a new <span class="EmphasisFontCategoryNonProportional ">LSSerializer</span> object.</p><p class="Para" id="Par130"><span class="EmphasisFontCategoryNonProportional ">LSSerializer</span> provides a <span class="EmphasisFontCategoryNonProportional ">boolean writeToURI(Node node, String uri)</span> method for serializing a DOM tree anchored in <span class="EmphasisFontCategoryNonProportional ">node</span> to the XML document described by <span class="EmphasisFontCategoryNonProportional ">uri</span>. This <span id="ITerm66">method</span> returns <span class="EmphasisFontCategoryNonProportional ">true</span> when serialization is successful.</p><p class="Para" id="Par131"><span class="EmphasisFontCategoryNonProportional ">main()</span> calls <span class="EmphasisFontCategoryNonProportional ">writeToURI()</span> to perform the serialization and displays a suitable message when serialization is successful.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar11"><h3 class="Heading">Note</h3><p class="Para" id="Par132"><span class="EmphasisFontCategoryNonProportional ">LSSerializer</span> also provides <span class="EmphasisFontCategoryNonProportional ">boolean write(Node node, LSOutput destination)</span> and <span class="EmphasisFontCategoryNonProportional ">String writeToString(Node node)</span> methods for serializing a DOM tree. The former method takes an <span class="EmphasisFontCategoryNonProportional ">LSOutput</span> argument, which can represent a URI, a byte stream (possibly with a specified encoding), a base URI, or a character stream. The latter method lets you serialize a DOM tree to a string, which is returned.</p></div><div class="Para" id="Par133">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_3_Chapter.xhtml#PC24">3-7</a></span> and run it against Listing <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC1"><span class="RefSource">1-1</span></a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">recipe.xml</span> document. You should observe the following output:<div class="ProgramCode" id="PC25"><div class="LineGroup"><div class="FixedLine">serialization successful</div></div></div></div><p class="Para" id="Par134">You should also observe a <span class="EmphasisFontCategoryNonProportional ">_recipe.xml</span> file containing a nearly identical version of <span class="EmphasisFontCategoryNonProportional ">recipe.xml</span>鈥檚 content.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar12"><h3 class="Heading">Note</h3><p class="Para" id="Par135">You can configure an <span class="EmphasisFontCategoryNonProportional ">LSSerializer</span> instance in an identical manner to configuring an <span class="EmphasisFontCategoryNonProportional ">LSParser</span> instance. Also, you can filter what鈥檚 serialized by installing an <span class="EmphasisFontCategoryNonProportional ">LSSerializerFilter</span>-based filter instance via <span class="EmphasisFontCategoryNonProportional ">LSSerializer</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">void setFilter(LSSerializerFilter filter)</span> method.</p></div></section></section><section class="Section1 RenderAsSection1" id="Sec14"><h2 class="Heading">Working with Traversal and Range</h2><p class="Para" id="Par136">Iterating over a tree of nodes typically involves calling <span class="EmphasisFontCategoryNonProportional ">Element</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">getChildNodes()</span> method and using recursion to move down the tree. Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_3_Chapter.xhtml#PC4">3-1</a></span> provides an example. It鈥檚 also tedious to write code to perform a task on a range of nodes, such as deleting a node and its children. The W3C responded to this tedium by developing the DOM Level 2 Traversal and Range Specification (<span class="ExternalRef"><a href="http://www.w3.org/TR/2000/REC-DOM-Level-2-Traversal-Range-20001113/"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional ">www.w3.org/TR/2000/REC-DOM-Level-2-Traversal-Range-20001113/</span>
                </span></a></span>), which adds this support.</p><section class="Section2 RenderAsSection2" id="Sec15"><h3 class="Heading">Performing Traversals</h3><div class="Para" id="Par137">Traversal lets you walk through a DOM tree and select specific nodes. Java supports <span id="ITerm67">Traversal</span> via the <span class="EmphasisFontCategoryNonProportional ">org.w3c.dom.traversal</span> package and its four interface types:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par138"><span class="EmphasisFontCategoryNonProportional ">DocumentTraversal</span> contains methods that create <span class="EmphasisFontCategoryNonProportional ">NodeIterator</span>s and <span class="EmphasisFontCategoryNonProportional ">TreeWalker</span>s to traverse a node and its children.</p></li><li><p class="Para" id="Par139"><span class="EmphasisFontCategoryNonProportional ">NodeFilter</span> describes a filter for accepting or rejecting nodes.</p></li><li><p class="Para" id="Par140"><span class="EmphasisFontCategoryNonProportional ">NodeIterator</span> steps through a DOM tree鈥檚/subtree鈥檚 nodes.</p></li><li><p class="Para" id="Par141"><span class="EmphasisFontCategoryNonProportional ">TreeWalker</span> also steps through a DOM tree鈥檚/subtree鈥檚 nodes.</p></li></ul></div></div><p class="Para" id="Par142">According to the specification, 鈥?span class=&quot;EmphasisFontCategoryNonProportional &quot;&gt;NodeIterator</span>s and <span class="EmphasisFontCategoryNonProportional ">TreeWalker</span>s are two different ways of representing the nodes of a document subtree and a position within the nodes they present. A <span id="ITerm68">
                  <span class="EmphasisFontCategoryNonProportional ">NodeIterator</span>
                  
                  
                  
                </span> presents a flattened view of the subtree as an ordered sequence of nodes, presented in document order. Because this view is presented without respect to hierarchy, iterators have methods to move forward and backward, but not to move up and down. Conversely, a <span id="ITerm69">
                  <span class="EmphasisFontCategoryNonProportional ">TreeWalker</span>
                  
                  
                  
                </span> maintains the hierarchical relationships of the subtree, allowing navigation of this hierarchy. In general, <span class="EmphasisFontCategoryNonProportional ">TreeWalker</span>s are better for tasks in which the structure of the document around selected nodes will be manipulated, while <span class="EmphasisFontCategoryNonProportional ">NodeIterator</span>s are better for tasks that focus on the content of each selected node.鈥?/p&gt;<div class="Para" id="Par143"><span class="EmphasisFontCategoryNonProportional ">DocumentTraversal</span> declares a pair of methods for obtaining a <span class="EmphasisFontCategoryNonProportional ">NodeIterator</span> and a <span class="EmphasisFontCategoryNonProportional ">TreeWalker</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par144"><span id="ITerm70">
                        <span class="EmphasisFontCategoryNonProportional ">NodeIterator</span>
                        
                        
                        
                      </span>
<span class="EmphasisFontCategoryNonProportional ">createNodeIterator</span>鈥?span class=&quot;EmphasisFontCategoryNonProportional &quot;&gt;(Node root, int whatToShow, NodeFilter filter, boolean entityReferenceExpansion)</span>: Create a new <span class="EmphasisFontCategoryNonProportional ">NodeIterator</span> over the subtree anchored at the specified <span class="EmphasisFontCategoryNonProportional ">root</span> node.</p></li><li><p class="Para" id="Par145"><span id="ITerm71">
                        <span class="EmphasisFontCategoryNonProportional ">TreeWalker</span>
                        
                        
                        
                      </span>
<span class="EmphasisFontCategoryNonProportional ">createTreeWalker</span>鈥?span class=&quot;EmphasisFontCategoryNonProportional &quot;&gt;(Node root, int whatToShow, NodeFilter filter, boolean entityReferenceExpansion)</span>: Create a new <span class="EmphasisFontCategoryNonProportional ">TreeWalker</span> over the subtree anchored at the specified <span class="EmphasisFontCategoryNonProportional ">root</span> node.</p></li></ul></div></div><p class="Para" id="Par146">For either method, <span class="EmphasisFontCategoryNonProportional ">whatToShow</span> is a bitwise ORed set of <span class="EmphasisFontCategoryNonProportional ">SHOW_</span>-prefixed constants declared by the <span class="EmphasisFontCategoryNonProportional ">NodeFilter</span> class. These constants determine what node types may appear in the logical view of the tree presented by the <span class="EmphasisFontCategoryNonProportional ">NodeIterator</span> or <span class="EmphasisFontCategoryNonProportional ">TreeWalker</span> object. Also, <span class="EmphasisFontCategoryNonProportional ">filter</span> identifies a <span class="EmphasisFontCategoryNonProportional ">NodeFilter</span> object for filtering out nodes, or is passed <span class="EmphasisFontCategoryNonProportional ">null</span> when no filtering is desired. Finally, <span class="EmphasisFontCategoryNonProportional ">entityReferenceExpansion</span> is passed <span class="EmphasisFontCategoryNonProportional ">true</span> to expand entity reference nodes.</p><p class="Para" id="Par147">A <span class="EmphasisFontCategoryNonProportional ">DocumentTraversal</span> object is obtained by casting a <span class="EmphasisFontCategoryNonProportional ">Document</span> object to <span class="EmphasisFontCategoryNonProportional ">DocumentTraversal</span>.</p><p class="Para" id="Par148"><span id="ITerm72">
                  <span class="EmphasisFontCategoryNonProportional ">NodeFilter</span>
                  
                  
                  
                </span> declares a <span class="EmphasisFontCategoryNonProportional ">short acceptNode</span>鈥?span class=&quot;EmphasisFontCategoryNonProportional &quot;&gt;(Node n)</span> method that determines whether or not node <span class="EmphasisFontCategoryNonProportional ">n</span> is visible in the <em class="EmphasisTypeItalic ">logical view</em> (a filtered sequence of nodes) provided by <span class="EmphasisFontCategoryNonProportional ">NodeIterator</span> or <span class="EmphasisFontCategoryNonProportional ">TreeWalker</span>. This method returns one of <span class="EmphasisFontCategoryNonProportional ">NodeFilter</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">FILTER_ACCEPT</span>, <span class="EmphasisFontCategoryNonProportional ">FILTER_REJECT</span>, or <span class="EmphasisFontCategoryNonProportional ">FILTER_SKIP</span> constants. It鈥檚 called by a <span class="EmphasisFontCategoryNonProportional ">NodeFilter</span> or <span class="EmphasisFontCategoryNonProportional ">TreeWalker</span> implementation.</p><p class="Para" id="Par149"><span id="ITerm73">
                  <span class="EmphasisFontCategoryNonProportional ">NodeFilter</span>
                  
                  
                  
                </span> declares several methods, including <span class="EmphasisFontCategoryNonProportional ">Node nextNode()</span> and <span class="EmphasisFontCategoryNonProportional ">Node previousNode()</span>, for returning the next or previous node and advancing forward or backward to the node beyond that node. Either method returns <span class="EmphasisFontCategoryNonProportional ">null</span> when there are no more nodes to step through.</p><p class="Para" id="Par150"><span class="EmphasisFontCategoryNonProportional ">TreeWalker</span> declares several methods, including <span class="EmphasisFontCategoryNonProportional ">Node firstChild()</span> and <span class="EmphasisFontCategoryNonProportional ">Node lastChild()</span>, for stepping to the first visible or last visible child, respectively, of the current node.</p><div class="Para" id="Par151">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_3_Chapter.xhtml#PC26">3-8</a></span> presents a seventh version of the <span class="EmphasisFontCategoryNonProportional ">DOMDemo</span> application that uses <span class="EmphasisFontCategoryNonProportional ">NodeIterator</span> to traverse an XML document. It鈥檚 similar to (but shorter than) Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_3_Chapter.xhtml#PC4">3-1</a></span>.<div class="ProgramCode" id="PC26"><div class="LineGroup"><div class="FixedLine">import java.io.IOException;</div></div><div class="LineGroup"><div class="FixedLine">import javax.xml.parsers.DocumentBuilder;</div><div class="FixedLine">import javax.xml.parsers.DocumentBuilderFactory;</div><div class="FixedLine">import javax.xml.parsers.FactoryConfigurationError;</div><div class="FixedLine">import javax.xml.parsers.ParserConfigurationException;</div></div><div class="LineGroup"><div class="FixedLine">import org.w3c.dom.Attr;</div><div class="FixedLine">import org.w3c.dom.Document;</div><div class="FixedLine">import org.w3c.dom.DOMImplementation;</div><div class="FixedLine">import org.w3c.dom.Element;</div><div class="FixedLine">import org.w3c.dom.NamedNodeMap;</div><div class="FixedLine">import org.w3c.dom.Node;</div></div><div class="LineGroup"><div class="FixedLine">import org.w3c.dom.traversal.DocumentTraversal;</div><div class="FixedLine">import org.w3c.dom.traversal.NodeFilter;</div><div class="FixedLine">import org.w3c.dom.traversal.NodeIterator;</div></div><div class="LineGroup"><div class="FixedLine">import org.xml.sax.SAXException;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class DOMDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      if (args.length != 1)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.println(&quot;usage: java DOMDemo xmlfile&quot;);</div><div class="FixedLine">         return;</div><div class="FixedLine">      }</div><div class="FixedLine">      try</div><div class="FixedLine">      {</div><div class="FixedLine">         DocumentBuilderFactory dbf =</div><div class="FixedLine">            DocumentBuilderFactory.newInstance();</div><div class="FixedLine">         dbf.setNamespaceAware(true);</div><div class="FixedLine">         DocumentBuilder db = dbf.newDocumentBuilder();</div><div class="FixedLine">         DOMImplementation di = db.getDOMImplementation();</div><div class="FixedLine">         if (!di.hasFeature(&quot;Traversal&quot;, &quot;2.0&quot;))</div><div class="FixedLine">         {</div><div class="FixedLine">            err.println(&quot;parser doesn&apos;t support &quot; + &quot;traversal&quot;);</div><div class="FixedLine">            return;</div><div class="FixedLine">         }</div><div class="FixedLine">         Document doc = db.parse(args[0]);</div><div class="FixedLine">         out.printf(&quot;Version = %s%n&quot;, doc.getXmlVersion());</div><div class="FixedLine">         out.printf(&quot;Encoding = %s%n&quot;, doc.getXmlEncoding());</div><div class="FixedLine">         out.printf(&quot;Standalone = %b%n%n&quot;, doc.getXmlStandalone());</div><div class="FixedLine">         NodeIterator ni =</div><div class="FixedLine">            ((DocumentTraversal) doc).</div><div class="FixedLine">            createNodeIterator(doc.getDocumentElement(),</div><div class="FixedLine">                               NodeFilter.SHOW_ELEMENT,</div><div class="FixedLine">                               null, true);</div><div class="FixedLine">         Node node = ni.nextNode();</div><div class="FixedLine">         while (node != null)</div><div class="FixedLine">         {</div><div class="FixedLine">            dump((Element) node);</div><div class="FixedLine">            node = ni.nextNode();</div><div class="FixedLine">         }</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (IOException ioe)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;IOE: %s%n&quot;, ioe.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (SAXException saxe)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;SAXE: %s%n&quot;, saxe.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (FactoryConfigurationError fce)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;FCE: %s%n&quot;, fce.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (ParserConfigurationException pce)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;PCE: %s%n&quot;, pce.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   static void dump(Element e)</div><div class="FixedLine">   {</div><div class="FixedLine">      out.printf(&quot;Element: %s, %s, %s, %s%n&quot;,</div><div class="FixedLine">                 e.getNodeName(), e.getLocalName(),</div><div class="FixedLine">                 e.getPrefix(), e.getNamespaceURI());</div><div class="FixedLine">      NamedNodeMap nnm = e.getAttributes();</div><div class="FixedLine">      if (nnm != null)</div><div class="FixedLine">         for (int i = 0; i &lt; nnm.getLength(); i++)</div><div class="FixedLine">         {</div><div class="FixedLine">            Node node = nnm.item(i);</div><div class="FixedLine">            Attr attr =</div><div class="FixedLine">               e.getAttributeNode(node.getNodeName());</div><div class="FixedLine">            out.printf(&quot;  Attribute %s = %s%n&quot;,</div><div class="FixedLine">                       attr.getName(), attr.getValue());</div><div class="FixedLine">         }</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 3-8</span><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">DOMDemo</span><span id="ITerm74">
                          
                          
                          
                        </span> (Version 7)</p></div></div></div></div><p class="Para" id="Par152">The <span class="EmphasisFontCategoryNonProportional ">main()</span> method demonstrates how to determine if the document builder supports Traversal or not. It obtains a <span class="EmphasisFontCategoryNonProportional ">DOMImplementation</span> instance and invokes its <span class="EmphasisFontCategoryNonProportional ">boolean hasFeature</span>鈥?span class=&quot;EmphasisFontCategoryNonProportional &quot;&gt;(String feature, String version)</span> method with <span class="EmphasisFontCategoryNonProportional ">Traversal</span> passed to <span class="EmphasisFontCategoryNonProportional ">feature</span> and <span class="EmphasisFontCategoryNonProportional ">2.0</span> passed to <span class="EmphasisFontCategoryNonProportional ">version</span>. This method returns <span class="EmphasisFontCategoryNonProportional ">true</span> if the feature is supported. It鈥檚 a good idea to check for support in case a document builder doesn鈥檛 support Traversal.</p><p class="Para" id="Par153">Run this application against the <span class="EmphasisFontCategoryNonProportional ">article.xml</span> file that was used with the first version of <span class="EmphasisFontCategoryNonProportional ">DOMDemo</span> and you鈥檒l observe the same output.</p></section><section class="Section2 RenderAsSection2" id="Sec16"><h3 class="Heading">Performing Range Operations</h3><div class="Para" id="Par154">Range provides a convenient way to select, delete, extract, and insert a node into a range of nodes. Java supports Range via the <span class="EmphasisFontCategoryNonProportional ">org.w3c.dom.range</span>
<span id="ITerm75">package</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par155"><span class="EmphasisFontCategoryNonProportional ">DocumentRange</span> is an interface that contains a method for creating a <em class="EmphasisTypeItalic ">range</em> (all of the content between a pair of boundary-points).</p></li><li><p class="Para" id="Par156"><span class="EmphasisFontCategoryNonProportional ">Range</span> is an interface that contains methods for describing a range and performing various range operations.</p></li><li><p class="Para" id="Par157"><span class="EmphasisFontCategoryNonProportional ">RangeException</span> is an exception class that describes range operation failure.</p></li></ul></div></div><p class="Para" id="Par158">A boundary-point&apos;s position in a <span class="EmphasisFontCategoryNonProportional ">Document</span> or <span class="EmphasisFontCategoryNonProportional ">DocumentFragment</span> tree can be characterized by a node and an offset. The node is called the <em class="EmphasisTypeItalic ">container</em> of the boundary-point and of its position. The container and its ancestors are the <em class="EmphasisTypeItalic ">ancestor containers</em> of the boundary-point and of its position. The offset within the node is called the <em class="EmphasisTypeItalic ">offset</em> of the boundary-point and its position.</p><p class="Para" id="Par159"><span id="ITerm76">
                  <span class="EmphasisFontCategoryNonProportional ">DocumentRange</span>
                  
                  
                  
                </span> declares the <span class="EmphasisFontCategoryNonProportional ">Range createRange()</span> method for creating a <span class="EmphasisFontCategoryNonProportional ">Range</span> object. The returned <span class="EmphasisFontCategoryNonProportional ">Range</span> has both of its boundary-points positioned at the beginning of the corresponding <span class="EmphasisFontCategoryNonProportional ">Document</span> (before any content). The <span class="EmphasisFontCategoryNonProportional ">Range</span> can be used only to select content associated with this <span class="EmphasisFontCategoryNonProportional ">Document</span> or with <span class="EmphasisFontCategoryNonProportional ">DocumentFragment</span>s and <span class="EmphasisFontCategoryNonProportional ">Attr</span>s for which this <span class="EmphasisFontCategoryNonProportional ">Document</span> is the owner.</p><p class="Para" id="Par160">A <span class="EmphasisFontCategoryNonProportional ">DocumentRange</span> object is obtained by casting a <span class="EmphasisFontCategoryNonProportional ">Document</span> object to <span class="EmphasisFontCategoryNonProportional ">DocumentRange</span>.</p><p class="Para" id="Par161"><span class="EmphasisFontCategoryNonProportional ">Range</span> declares <span class="EmphasisFontCategoryNonProportional ">Node getEndContainer()</span>, <span class="EmphasisFontCategoryNonProportional ">int getEndOffset()</span>, <span class="EmphasisFontCategoryNonProportional ">Node getStartContainer()</span>, and <span class="EmphasisFontCategoryNonProportional ">int getStartOffset()</span> methods to describe a range. It also declares various operation methods, such as <span class="EmphasisFontCategoryNonProportional ">void deleteContents()</span> and <span class="EmphasisFontCategoryNonProportional ">void selectNodeContents(Node refNode)</span>.</p><p class="Para" id="Par162">Various methods throw <span id="ITerm77">
                  <span class="EmphasisFontCategoryNonProportional ">RangeException</span>
                  
                  
                  
                </span>. For example, <span class="EmphasisFontCategoryNonProportional ">selectNodeContents()</span> throws this exception when <span class="EmphasisFontCategoryNonProportional ">refNode</span> or one of its ancestor nodes is an <span class="EmphasisFontCategoryNonProportional ">Entity</span>, <span class="EmphasisFontCategoryNonProportional ">Notation</span>, or <span class="EmphasisFontCategoryNonProportional ">DocumentType</span> node.</p><div class="Para" id="Par163">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_3_Chapter.xhtml#PC27">3-9</a></span> presents a final version of the <span class="EmphasisFontCategoryNonProportional ">DOMDemo</span> application that uses <span class="EmphasisFontCategoryNonProportional ">Range</span> to delete the contents of the <span class="EmphasisFontCategoryNonProportional ">ingredients</span> element in Listing <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC1"><span class="RefSource">1-1</span></a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">recipe.xml</span> file.<div class="ProgramCode" id="PC27"><div class="LineGroup"><div class="FixedLine">import javax.xml.parsers.DocumentBuilder;</div><div class="FixedLine">import javax.xml.parsers.DocumentBuilderFactory;</div></div><div class="LineGroup"><div class="FixedLine">import org.w3c.dom.Document;</div><div class="FixedLine">import org.w3c.dom.DOMImplementation;</div><div class="FixedLine">import org.w3c.dom.Element;</div></div><div class="LineGroup"><div class="FixedLine">import org.w3c.dom.bootstrap.DOMImplementationRegistry;</div></div><div class="LineGroup"><div class="FixedLine">import org.w3c.dom.ls.DOMImplementationLS;</div><div class="FixedLine">import org.w3c.dom.ls.LSSerializer;</div></div><div class="LineGroup"><div class="FixedLine">import org.w3c.dom.ranges.DocumentRange;</div><div class="FixedLine">import org.w3c.dom.ranges.Range;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class DOMDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args) throws Exception</div><div class="FixedLine">   {</div><div class="FixedLine">      DocumentBuilderFactory dbf =</div><div class="FixedLine">         DocumentBuilderFactory.newInstance();</div><div class="FixedLine">      dbf.setNamespaceAware(true);</div><div class="FixedLine">      DocumentBuilder db = dbf.newDocumentBuilder();</div><div class="FixedLine">      DOMImplementation di = db.getDOMImplementation();</div><div class="FixedLine">      if (!di.hasFeature(&quot;Range&quot;, &quot;2.0&quot;))</div><div class="FixedLine">      {</div><div class="FixedLine">         err.println(&quot;parser doesn&apos;t support range&quot;);</div><div class="FixedLine">         return;</div><div class="FixedLine">      }</div><div class="FixedLine">      Document doc = db.parse(&quot;recipe.xml&quot;);</div><div class="FixedLine">      Range r = ((DocumentRange) doc).createRange();</div><div class="FixedLine">      Element root = doc.getDocumentElement();</div><div class="FixedLine">      r.selectNodeContents(root.getFirstChild().</div><div class="FixedLine">                                getNextSibling().</div><div class="FixedLine">                                getNextSibling().</div><div class="FixedLine">                                getNextSibling());</div><div class="FixedLine">      r.deleteContents();</div><div class="FixedLine">      DOMImplementationLS ls = (DOMImplementationLS)</div><div class="FixedLine">         DOMImplementationRegistry.newInstance().</div><div class="FixedLine">         getDOMImplementation(&quot;LS&quot;);</div><div class="FixedLine">      LSSerializer serializer = ls.createLSSerializer();</div><div class="FixedLine">      if (serializer.writeToURI(doc, &quot;_recipe.xml&quot;))</div><div class="FixedLine">         out.println(&quot;serialization successful&quot;);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 3-9</span><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">DOMDemo</span><span id="ITerm78">
                          
                          
                          
                        </span> (Version 8)</p></div></div></div></div><p class="Para" id="Par164">The <span class="EmphasisFontCategoryNonProportional ">main()</span> method demonstrates how to determine if the document builder supports Range or not. It obtains a <span class="EmphasisFontCategoryNonProportional ">DOMImplementation</span> instance and invokes its <span class="EmphasisFontCategoryNonProportional ">hasFeature()</span> method with <span class="EmphasisFontCategoryNonProportional ">Range</span> passed to <span class="EmphasisFontCategoryNonProportional ">feature</span> and <span class="EmphasisFontCategoryNonProportional ">2.0</span> passed to <span class="EmphasisFontCategoryNonProportional ">version</span>. This method returns <span class="EmphasisFontCategoryNonProportional ">true</span> if the feature is supported. It鈥檚 a good idea to check for support in case a document builder doesn鈥檛 support Range.</p><div class="Para" id="Par165">Run this application against Listing <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC1"><span class="RefSource">1-1</span></a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">recipe.xml</span> file, and you should observe a <span class="EmphasisFontCategoryNonProportional ">_recipe.xml</span> file with the following contents:<div class="ProgramCode" id="PC28"><div class="LineGroup"><div class="FixedLine">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;recipe&gt;</div><div class="FixedLine">   &lt;title&gt;</div><div class="FixedLine">      Grilled Cheese Sandwich</div><div class="FixedLine">   &lt;/title&gt;</div><div class="FixedLine">   &lt;ingredients/&gt;</div><div class="FixedLine">   &lt;instructions&gt;</div><div class="FixedLine">      Place frying pan on element and select medium heat.</div><div class="FixedLine">      For each bread slice, smear one pat of margarine on</div><div class="FixedLine">      one side of bread slice. Place cheese slice between</div><div class="FixedLine">      bread slices with margarine-smeared sides away from</div><div class="FixedLine">      the cheese. Place sandwich in frying pan with one</div><div class="FixedLine">      margarine-smeared side in contact with pan. Fry for</div><div class="FixedLine">      a couple of minutes and flip. Fry other side for a</div><div class="FixedLine">      minute and serve.</div><div class="FixedLine">   &lt;/instructions&gt;</div><div class="FixedLine">&lt;/recipe&gt;</div></div></div></div><p class="Para" id="Par166">Notice the <span class="EmphasisFontCategoryNonProportional ">&lt;ingredients/&gt;</span> empty-element tag, which proves that the <span class="EmphasisFontCategoryNonProportional ">ingredients</span> element鈥檚 three <span class="EmphasisFontCategoryNonProportional ">ingredient</span> child elements have been deleted.</p><div class="FormalPara FormalParaRenderingStyle3 ParaTypeOverview" id="FPar13"><h3 class="Heading">Exercises</h3><div class="Para" id="Par167">The following exercises are designed to test your understanding of Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_3_Chapter.xhtml"><span class="RefSource">3</span></a></span>鈥檚 content:<div class="OrderedList"><ol><li class="ListItem"><span class="ItemNumber">1.</span><div class="ItemContent"><p class="Para" id="Par168">Define DOM.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">2.</span><div class="ItemContent"><p class="Para" id="Par169">True or false: Java 11 supports DOM Levels 1 and 2 only.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">3.</span><div class="ItemContent"><p class="Para" id="Par170">Identify the 12 types of DOM nodes.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">4.</span><div class="ItemContent"><p class="Para" id="Par171">How do you obtain a document builder?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">5.</span><div class="ItemContent"><p class="Para" id="Par172">How do you use a document builder to parse an XML document?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">6.</span><div class="ItemContent"><p class="Para" id="Par173">True or false: <span class="EmphasisFontCategoryNonProportional ">Document</span> and all other <span class="EmphasisFontCategoryNonProportional ">org.w3c.dom</span> interfaces that describe different kinds of nodes are subinterfaces of the <span class="EmphasisFontCategoryNonProportional ">Node</span> interface.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">7.</span><div class="ItemContent"><p class="Para" id="Par174">How do you use a document builder to create a new XML document?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">8.</span><div class="ItemContent"><p class="Para" id="Par175">How would you determine if a node has children?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">9.</span><div class="ItemContent"><p class="Para" id="Par176">True or false: When creating a new XML document, you can use the DOM API to specify the XML declaration鈥檚 <span class="EmphasisFontCategoryNonProportional ">encoding</span> attribute.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">10.</span><div class="ItemContent"><p class="Para" id="Par177">What is the purpose of the Load and Save API?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">11.</span><div class="ItemContent"><p class="Para" id="Par178">What is the difference between <span class="EmphasisFontCategoryNonProportional ">NodeIterator</span> and <span class="EmphasisFontCategoryNonProportional ">TreeWalker</span>?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">12.</span><div class="ItemContent"><p class="Para" id="Par179">What is the difference between <span class="EmphasisFontCategoryNonProportional ">Range</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">selectNode()</span> and <span class="EmphasisFontCategoryNonProportional ">selectNodeContents()</span> methods?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">13.</span><div class="ItemContent"><p class="Para" id="Par180">Exercise 2-12 asked you to create a <span class="EmphasisFontCategoryNonProportional ">DumpUserInfo</span> application that uses SAX to parse the user elements in an <span class="EmphasisFontCategoryNonProportional ">example tomcat-users.xml</span> file and, for each user element, dump its <span class="EmphasisFontCategoryNonProportional ">username</span>, <span class="EmphasisFontCategoryNonProportional ">password</span>, and <span class="EmphasisFontCategoryNonProportional ">roles</span> attribute values to standard output in a <em class="EmphasisTypeItalic ">key</em>
<span class="EmphasisFontCategoryNonProportional ">=</span>
<em class="EmphasisTypeItalic ">value</em> format. Recreate this application to use DOM.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">14.</span><div class="ItemContent"><p class="Para" id="Par181">Create a <span class="EmphasisFontCategoryNonProportional ">DOMSearch</span> application that鈥檚 the equivalent of Exercise 2-13鈥檚 <span class="EmphasisFontCategoryNonProportional ">SAXSearch</span> application.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">15.</span><div class="ItemContent"><p class="Para" id="Par182">Create a <span class="EmphasisFontCategoryNonProportional ">DOMValidate</span> application based on Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_3_Chapter.xhtml#PC4">3-1</a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">DOMDemo</span> source code (plus one new line that enables validation) to validate Exercise 1-22鈥檚 <span class="EmphasisFontCategoryNonProportional ">books.xml</span> content against its DTD. Execute <span class="EmphasisFontCategoryNonProportional ">java DOMValidate books.xml</span> to perform the validation. You should observe no errors. However, if you attempt to validate <span class="EmphasisFontCategoryNonProportional ">books.xml</span> without the DTD, you should observe errors.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">16.</span><div class="ItemContent"><p class="Para" id="Par183">Extend Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_3_Chapter.xhtml#PC14">3-4</a></span> to also include the custom error handler that was presented while discussing parser configuration.</p></div><div class="ClearBoth"> </div></li></ol></div></div></div></section></section><section class="Section1 RenderAsSection1" id="Sec17"><h2 class="Heading">Summary</h2><p class="Para" id="Par184">Document Object Model (DOM) is a Java API for parsing an XML document into an in-memory tree of nodes and for creating an XML document from a node tree. After a DOM parser creates a tree, an application uses the DOM API to navigate over and extract infoset items from the tree鈥檚 nodes.</p><p class="Para" id="Par185">DOM views an XML document as a tree that鈥檚 composed of several kinds of nodes: attribute, CDATA section, comment, document, document fragment, document type, element, entity, entity reference, notation, processing instruction, and text.</p><p class="Para" id="Par186">A DOM parser is also known as a document builder because of its dual role in parsing and creating XML documents. You obtain a document builder by first instantiating <span class="EmphasisFontCategoryNonProportional ">DocumentBuilderFactory</span>. You then invoke the factory鈥檚 <span class="EmphasisFontCategoryNonProportional ">newDocumentBuilder()</span> method to return the document builder.</p><p class="Para" id="Par187">Call one of the document builder鈥檚 <span class="EmphasisFontCategoryNonProportional ">parse()</span> methods to parse an XML document into a node tree. Call the various document builder methods that are prefixed with 鈥?span class=&quot;EmphasisFontCategoryNonProportional &quot;&gt;create</span>鈥?(along with a few additional methods) to create an XML document.</p><p class="Para" id="Par188">Before DOM Level 3, there was no standard way to load XML content into a new DOM tree and save an existing DOM tree to an XML document. The W3C responded to this deficiency by developing the DOM Level 3 Load and Save Specification, which adds this support. Java supports the DOM Level 3 Load and Save Specification via the <span class="EmphasisFontCategoryNonProportional ">org.w3c.dom.ls</span> package and its interface types.</p><p class="Para" id="Par189">Iterating over a tree of nodes typically involves calling <span class="EmphasisFontCategoryNonProportional ">Element</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">getChildNodes()</span> method and using recursion to move down the tree. It鈥檚 also tedious to write code to perform a task on a range of nodes, such as deleting a node and its children. The W3C responded to this tedium by developing the DOM Level 2 Traversal and Range Specification. Traversal lets you walk through a DOM tree and select specific nodes. Range provides a convenient way to select, delete, extract, and insert a node into a range of nodes.</p><p class="Para" id="Par190">Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_4_Chapter.xhtml"><span class="RefSource">4</span></a></span> introduces the StAX API for parsing/creating XML documents.</p></section></div><div class="annotator-outer annotator-viewer viewer annotator-hide"> </div></div></div>
    </section>
  </div>
</div>
<iframe allowtransparency="true" frameborder="0" scrolling="no" src="cid:frame-69485BEE1FAB55D3566BF68930E1F291@mhtml.blink" style="display: none;" title="Twitter settings iframe"></iframe>
<hr/>

<!--if IE]><![endif]--><!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/java-xml-and/9781484243305/html/394211_2_En_4_Chapter.xhtml"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="3866890"
  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"
  data-username="levinxccai"
  data-account-type="B2B"
  
  data-activated-trial-date="11/06/2017"


  data-archive="9781484243305"
  data-publishers="Apress"



  data-htmlfile-name="394211_2_En_4_Chapter.xhtml"
  data-epub-title="Java XML and JSON: Document Processing for Java SE" data-debug=0 data-testing=0><![endif]--><!--if gt IE 8]><!--><!--![endif]-->



<a name="5_"></a>

<div class="application" id="container" style="height: auto;">
  <div class="js-toc">
    <section role="document">
      <div id="sbo-rt-content" style="max-width:72.5em; transform: none;"><div class="annotator-wrapper"><!--egin Abstract--><div class="MainTitleSection"><h1 class="ChapterTitle" lang="en">4. Parsing and Creating XML Documents with StAX</h1></div><div class="AuthorGroup"><div class="AuthorNames"><span class="Author"><span class="AuthorName">Jeff Friesen</span><sup><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_4_Chapter.xhtml#Aff2">1</a> <span class="ContactIcon"></span></sup></span></div><div class="Affiliations"><div class="Affiliation" id="Aff2"><span class="AffiliationNumber">(1)</span><div class="AffiliationText">Dauphin, MB, Canada</div></div><div class="ClearBoth"> </div></div></div><!--nd Abstract--><div class="Fulltext"><p class="Para" id="Par2">Java also includes the StAX API for parsing and creating XML documents. Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_4_Chapter.xhtml"><span class="RefSource">4</span></a></span> introduces you to StAX.</p><section class="Section1 RenderAsSection1" id="Sec1"><h2 class="Heading">What Is StAX?</h2><p class="Para" id="Par3"><em class="EmphasisTypeItalic ">Streaming API for XML (StAX)</em> is a Java API for parsing an XML document sequentially from start to finish and also for creating XML documents. StAX was introduced by Java 6 as an alternative to SAX and DOM and is located midway between these 鈥減olar opposites.鈥?/p&gt;<div class="FormalPara FormalParaRenderingStyle3 ParaTypeOverview" id="FPar1"><h3 class="Heading">StAX Versus SAX and DOM</h3><div class="Para" id="Par4">Because Java already supports SAX and <span id="ITerm1">DOM</span> for document parsing and DOM for document creation, you might be wondering why another XML API is needed. The following points justify StAX鈥檚 presence in core Java:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par5">StAX (like SAX) can be used to parse documents of arbitrary sizes. In contrast, the maximum size of documents parsed by DOM is limited by the available memory, which makes DOM unsuitable for mobile devices with limited amounts of memory.</p></li><li><p class="Para" id="Par6">StAX (like DOM) can be used to create documents. In contrast to DOM, which can create documents whose maximum size is constrained by available memory, StAX can create documents of arbitrary sizes. SAX cannot be used to create documents.</p></li><li><p class="Para" id="Par7">StAX (like SAX) makes infoset items available to applications almost immediately. In contrast, these items are not made available by DOM until after it finishes building the tree of nodes.</p></li><li><p class="Para" id="Par8">StAX (like DOM) adopts the <em class="EmphasisTypeItalic ">pull model</em>, in which the application tells the parser when it鈥檚 ready to receive the next infoset item. This model is based on the iterator design pattern (see <span class="ExternalRef"><a href="http://sourcemaking.com/design_patterns/iterator"><span class="RefSource">
                          <span class="EmphasisFontCategoryNonProportional ">http://sourcemaking.com/design_patterns/iterator</span>
                        </span></a></span>), which results in an application that鈥檚 easier to write and debug. In contrast, SAX adopts the <em class="EmphasisTypeItalic ">push model</em>, in which the parser passes infoset items via events to the application, whether or not the application is ready to receive them. This model is based on the observer design pattern (see <span class="ExternalRef"><a href="http://sourcemaking.com/design_patterns/observer"><span class="RefSource">
                          <span class="EmphasisFontCategoryNonProportional ">http://sourcemaking.com/design_patterns/observer</span>
                        </span></a></span>), which results in an application that鈥檚 often harder to write and debug.</p></li></ul></div></div><p class="Para" id="Par9">Summing up, <span id="ITerm2">StAX</span> can parse or create documents of arbitrary size, makes infoset items available to applications almost immediately, and uses the pull model to put the application in charge. Neither SAX nor DOM offers all of these advantages.</p></div></section><section class="Section1 RenderAsSection1" id="Sec2"><h2 class="Heading">Exploring StAX</h2><p class="Para" id="Par10">Java implements StAX through types stored in the <span class="EmphasisFontCategoryNonProportional ">javax.xml.stream</span>, <span class="EmphasisFontCategoryNonProportional ">javax.xml.stream.events</span>, and <span class="EmphasisFontCategoryNonProportional ">javax.xml.stream.util</span> packages. This section introduces you to various types from the first two packages while showing you how to use StAX to parse and create XML documents.</p><div class="FormalPara FormalParaRenderingStyle3 ParaTypeOverview" id="FPar2"><h3 class="Heading">Stream-Based Versus Event-Based Readers and Writers</h3><p class="Para" id="Par11">StAX parsers are known as <em class="EmphasisTypeItalic ">document readers</em><span id="ITerm3">
                  
                  
                </span>, and StAX document creators are known as <em class="EmphasisTypeItalic ">document writers</em>. StAX classifies document readers and document writers as stream-based or event-based.</p><p class="Para" id="Par12">A <em class="EmphasisTypeItalic ">stream-based reader</em> extracts the next infoset item from an input stream via a <em class="EmphasisTypeItalic ">cursor</em> (infoset item pointer). Similarly, a <em class="EmphasisTypeItalic ">stream-based writer</em> writes the next infoset item to an output stream at the cursor position. The cursor can point to only one item at a time, and always moves forward, typically by one infoset item.</p><p class="Para" id="Par13">Stream-based readers and writers are appropriate when writing code for memory-constrained environments such as Java ME Embedded, because you can use them to create smaller and more efficient code. They also offer better performance for low-level libraries, where performance is important.</p><p class="Para" id="Par14">An <em class="EmphasisTypeItalic ">event-based reader</em> extracts the next infoset item from an input stream by obtaining an event. Similarly, an <em class="EmphasisTypeItalic ">event-based writer</em> writes the next infoset item to the stream by adding an event to the output stream. In contrast to stream-based readers and writers, event-based readers and writers have no concept of a cursor.</p><p class="Para" id="Par15">Event-based readers and writers are appropriate for creating XML <span id="ITerm4">processing</span>
<em class="EmphasisTypeItalic ">pipelines</em> (sequences of components that transform the previous component鈥檚 input and pass the transformed output to the next component in the sequence), for modifying an event sequence, and more.</p></div><section class="Section2 RenderAsSection2" id="Sec3"><h3 class="Heading">Parsing XML Documents</h3><p class="Para" id="Par16">Document readers are obtained by calling the various 鈥?span class=&quot;EmphasisFontCategoryNonProportional &quot;&gt;create</span>鈥?<span id="ITerm5">methods</span> that are declared in the <span class="EmphasisFontCategoryNonProportional ">javax.xml.stream.XMLInputFactory</span> class. These creational methods are organized into two categories: methods for creating stream-based readers and methods for creating event-based readers.</p><div class="Para" id="Par17">Before you can obtain a stream-based or an event-based reader, you need to obtain an instance of the factory by calling one of the <span class="EmphasisFontCategoryNonProportional ">newFactory() static</span> methods, such as <span class="EmphasisFontCategoryNonProportional ">XMLInputFactory newFactory()</span>:<div class="ProgramCode" id="PC1"><div class="LineGroup"><div class="FixedLine">XMLInputFactory xmlif = XMLInputFactory.newFactory();</div></div></div></div><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar3"><h3 class="Heading">Note</h3><p class="Para" id="Par18">You can also call the <span class="EmphasisFontCategoryNonProportional ">XMLInputFactory newInstance() static</span> method but might not want to do so because its same-named but parameterized companion method has been deprecated to maintain API consistency, and it鈥檚 possible that <span class="EmphasisFontCategoryNonProportional ">newInstance()</span> will be deprecated as well.</p></div><p class="Para" id="Par19">The <span class="EmphasisFontCategoryNonProportional ">newFactory()</span> methods<span id="ITerm6">
                  
                </span> follow an ordered lookup procedure to locate the <span class="EmphasisFontCategoryNonProportional ">XMLInputFactory</span> implementation class. This procedure first examines the <span class="EmphasisFontCategoryNonProportional ">javax.xml.stream.XMLInputFactory</span> system property and lastly returns the system-default implementation (returned from <span class="EmphasisFontCategoryNonProportional ">XMLInputFactory newDefaultFactory()</span>). If there is a service configuration error, or if the implementation is not available or cannot be instantiated, the method throws an instance of the <span class="EmphasisFontCategoryNonProportional ">javax.xml.stream.FactoryConfigurationError</span> class.</p><p class="Para" id="Par20">After creating the factory, call <span class="EmphasisFontCategoryNonProportional ">XMLInputFactory</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">void setProperty(String name, Object value)</span> method to set various features and properties as necessary. For example, you might execute <span class="EmphasisFontCategoryNonProportional ">xmlif.setProperty(XMLInputFactory.IS_VALIDATING, true);</span> (<span class="EmphasisFontCategoryNonProportional ">true</span> is passed as a <span class="EmphasisFontCategoryNonProportional ">java.lang.Boolean</span> object via <em class="EmphasisTypeItalic ">autoboxing</em>鈥攕ee <span class="ExternalRef"><a href="http://docs.oracle.com/javase/tutorial/java/data/autoboxing.html"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://docs.oracle.com/javase/tutorial/java/data/autoboxing.html</span>
                  </span></a></span>) to request a DTD-validating stream-based reader. However, the default StAX factory <span id="ITerm7">implementation</span> throws <span class="EmphasisFontCategoryNonProportional ">java.lang.IllegalArgumentException</span> because it doesn鈥檛 support DTD validation. Similarly, you might execute <span class="EmphasisFontCategoryNonProportional ">xmlif.setProperty(XMLInputFactory.IS_NAMESPACE_AWARE, true);</span> to request a namespace-aware event-based reader, which is supported.</p><section class="Section3 RenderAsSection3" id="Sec4"><h4 class="Heading">Parsing Documents with Stream-Based Readers</h4><p class="Para" id="Par21">A stream-based reader<span id="ITerm8">
                    
                    
                    
                  </span> is created by calling one of <span class="EmphasisFontCategoryNonProportional ">XMLInputFactory</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">createXMLStreamReader()</span> methods, such as <span class="EmphasisFontCategoryNonProportional ">XMLStreamReader createXMLStreamReader(Reader reader)</span>. These methods throw <span class="EmphasisFontCategoryNonProportional ">javax.xml.stream.XMLStreamException</span> when the stream-based reader cannot be created.</p><div class="Para" id="Par22">The following code fragment <span id="ITerm9">creates</span> a stream-based reader whose source is a file named <span class="EmphasisFontCategoryNonProportional ">recipe.xml</span>:<div class="ProgramCode" id="PC2"><div class="LineGroup"><div class="FixedLine">Reader reader = new FileReader(&quot;recipe.xml&quot;);</div><div class="FixedLine">XMLStreamReader xmlsr = xmlif.createXMLStreamReader(reader);</div></div></div></div><p class="Para" id="Par23">The low-level <span class="EmphasisFontCategoryNonProportional ">javax.xml.stream.XMLStreamReader</span> interface offers the most efficient way to read XML data with StAX. This interface鈥檚 <span class="EmphasisFontCategoryNonProportional ">boolean hasNext()</span> method returns <span class="EmphasisFontCategoryNonProportional ">true</span> when there is a next infoset item to obtain; otherwise, it returns <span class="EmphasisFontCategoryNonProportional ">false</span>. The <span class="EmphasisFontCategoryNonProportional ">int next()</span> method advances the cursor by one infoset item and returns an integer code that identifies this item鈥檚 type.</p><p class="Para" id="Par24">Instead of comparing <span class="EmphasisFontCategoryNonProportional ">next()</span>鈥檚 return value with an integer value, you would compare this value against a <span class="EmphasisFontCategoryNonProportional ">javax.xml.stream.XMLStreamConstants</span> infoset constant, such as <span class="EmphasisFontCategoryNonProportional ">START_ELEMENT</span> or <span class="EmphasisFontCategoryNonProportional ">DTD</span>鈥?span class=&quot;EmphasisFontCategoryNonProportional &quot;&gt;XMLStreamReader</span> extends the <span class="EmphasisFontCategoryNonProportional ">XMLStreamConstants</span> interface.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar4"><h3 class="Heading">Note</h3><p class="Para" id="Par25">You can also obtain the type of the infoset item that the cursor is pointing to by calling <span class="EmphasisFontCategoryNonProportional ">XMLStreamReader</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">int getEventType()</span> method. Specifying 鈥?span class=&quot;EmphasisFontCategoryNonProportional &quot;&gt;Event</span>鈥?in the name of this method is unfortunate because it confuses stream-based readers with event-based readers.</p></div><div class="Para" id="Par26">The following code fragment uses the <span class="EmphasisFontCategoryNonProportional ">hasNext()</span> and <span class="EmphasisFontCategoryNonProportional ">next()</span> methods<span id="ITerm10">
                    
                    
                  </span> to codify a parsing loop that detects the start and end of each element:<div class="ProgramCode" id="PC3"><div class="LineGroup"><div class="FixedLine">while (xmlsr.hasNext())</div><div class="FixedLine">{</div><div class="FixedLine">   switch (xmlsr.next())</div><div class="FixedLine">   {</div><div class="FixedLine">      case XMLStreamReader.START_ELEMENT:</div><div class="FixedLine">         // Do something at element start.</div><div class="FixedLine">         break;</div></div><div class="LineGroup"><div class="FixedLine">      case XMLStreamReader.END_ELEMENT:</div><div class="FixedLine">         // Do something at element end.</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div></div></div><p class="Para" id="Par27"><span class="EmphasisFontCategoryNonProportional ">XMLStreamReader</span> also declares various methods for extracting infoset information. For example, <span class="EmphasisFontCategoryNonProportional ">QName getName()</span> returns the qualified name (as a <span class="EmphasisFontCategoryNonProportional ">javax.xml.namespace.QName</span> instance) of the element at the cursor position when <span class="EmphasisFontCategoryNonProportional ">next()</span> returns <span class="EmphasisFontCategoryNonProportional ">XMLStreamReader.START_ELEMENT</span> or <span class="EmphasisFontCategoryNonProportional ">XMLStreamReader.END_ELEMENT</span>.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar5"><h3 class="Heading">Note</h3><p class="Para" id="Par28"><span class="EmphasisFontCategoryNonProportional ">QName</span> describes a qualified name as a combination of namespace URI, local part, and prefix components. After instantiating this immutable class (via a constructor such as <span class="EmphasisFontCategoryNonProportional ">QName(String namespaceURI, String localPart, String prefix)</span>), you can return these components by calling <span class="EmphasisFontCategoryNonProportional ">QName</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">String getNamespaceURI()</span>, <span class="EmphasisFontCategoryNonProportional ">String getLocalPart()</span>, and <span class="EmphasisFontCategoryNonProportional ">String getPrefix()</span> methods.</p></div><div class="Para" id="Par29">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_4_Chapter.xhtml#PC4">4-1</a></span> presents the source code to a <span class="EmphasisFontCategoryNonProportional ">StAXDemo</span> application that reports an XML document鈥檚 <span id="ITerm11">start and end elements</span> via a stream-based reader.<div class="ProgramCode" id="PC4"><div class="LineGroup"><div class="FixedLine">import java.io.FileNotFoundException;</div><div class="FixedLine">import java.io.FileReader;</div></div><div class="LineGroup"><div class="FixedLine">import javax.xml.stream.FactoryConfigurationError;</div><div class="FixedLine">import javax.xml.stream.XMLInputFactory;</div><div class="FixedLine">import javax.xml.stream.XMLStreamException;</div><div class="FixedLine">import javax.xml.stream.XMLStreamReader;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class StAXDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      if (args.length != 1)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.println(&quot;usage: java StAXDemo xmlfile&quot;);</div><div class="FixedLine">         return;</div><div class="FixedLine">      }</div><div class="FixedLine">      try</div><div class="FixedLine">      {</div><div class="FixedLine">         XMLInputFactory xmlif = XMLInputFactory.newFactory();</div><div class="FixedLine">         FileReader fr = new FileReader(args[0]);</div><div class="FixedLine">         XMLStreamReader xmlsr = xmlif.createXMLStreamReader(fr);</div><div class="FixedLine">         while (xmlsr.hasNext())</div><div class="FixedLine">         {</div><div class="FixedLine">            switch (xmlsr.next())</div><div class="FixedLine">            {</div><div class="FixedLine">               case XMLStreamReader.START_ELEMENT:</div><div class="FixedLine">                  out.println(&quot;START_ELEMENT&quot;);</div><div class="FixedLine">                  out.printf(&quot;  Qname = %s%n&quot;,</div><div class="FixedLine">                             xmlsr.getName());</div><div class="FixedLine">                  break;</div><div class="FixedLine">               case XMLStreamReader.END_ELEMENT:</div><div class="FixedLine">                  out.println(&quot;END_ELEMENT&quot;);</div><div class="FixedLine">                  out.printf(&quot;  Qname = %s%n&quot;, xmlsr.getName());</div><div class="FixedLine">            }</div><div class="FixedLine">         }</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (FactoryConfigurationError fce)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;FCE: %s%n&quot;, fce.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (FileNotFoundException fnfe)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;FNFE: %s%n&quot;, fnfe.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (XMLStreamException xmlse)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;XMLSE: %s%n&quot;, xmlse.toString());</div><div class="FixedLine">      }<span id="ITerm12">
                          
                          
                        </span></div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 4-1</span><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">StAXDemo</span> (Version 1)</p></div></div></div></div><p class="Para" id="Par30">After verifying the number of command-line arguments, Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_4_Chapter.xhtml#PC4">4-1</a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">main()</span> method creates a factory, uses the factory to create a stream-based reader that obtains its XML data from the file identified by the solitary command-line argument, and enters a parsing loop. Whenever <span class="EmphasisFontCategoryNonProportional ">next()</span> returns <span class="EmphasisFontCategoryNonProportional ">XMLStreamReader.START_ELEMENT</span> or <span class="EmphasisFontCategoryNonProportional ">XMLStreamReader.END_ELEMENT</span>, <span class="EmphasisFontCategoryNonProportional ">XMLStreamReader</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">getName()</span> method<span id="ITerm13">
                    
                    
                  </span> is called to return the element鈥檚 qualified name.</p><div class="Para" id="Par31">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_4_Chapter.xhtml#PC4">4-1</a></span> as follows:<div class="ProgramCode" id="PC5"><div class="LineGroup"><div class="FixedLine">javac StAXDemo.java</div></div></div></div><div class="Para" id="Par32">Run the resulting application to dump Listing <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC2"><span class="RefSource">1-2</span></a></span>鈥檚 movie XML content, as follows:<div class="ProgramCode" id="PC6"><div class="LineGroup"><div class="FixedLine">java StAXDemo movie.xml</div></div></div></div><div class="Para" id="Par33">You should observe the following output:<div class="ProgramCode" id="PC7"><div class="LineGroup"><div class="FixedLine">START_ELEMENT</div><div class="FixedLine">  Qname = movie</div><div class="FixedLine">START_ELEMENT</div><div class="FixedLine">  Qname = name</div><div class="FixedLine">END_ELEMENT</div><div class="FixedLine">  Qname = name</div><div class="FixedLine">START_ELEMENT</div><div class="FixedLine">  Qname = language</div><div class="FixedLine">END_ELEMENT</div><div class="FixedLine">  Qname = language</div><div class="FixedLine">END_ELEMENT</div><div class="FixedLine">  Qname = movie</div></div></div></div><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar6"><h3 class="Heading">Note</h3><p class="Para" id="Par34"><span class="EmphasisFontCategoryNonProportional ">XMLStreamReader</span> declares a <span class="EmphasisFontCategoryNonProportional ">void close()</span> method that you will want to call to free any resources associated with this stream-based reader when your application is designed to run for an extended period of time. Calling this method doesn鈥檛 close the underlying input source.</p></div></section><section class="Section3 RenderAsSection3" id="Sec5"><h4 class="Heading">Parsing Documents with Event-Based Readers</h4><p class="Para" id="Par35">An event-based reader is created by calling one of <span class="EmphasisFontCategoryNonProportional ">XMLInputFactory</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">createXMLEventReader()</span> methods<span id="ITerm14">
                    
                    
                    
                  </span>, such as <span class="EmphasisFontCategoryNonProportional ">XMLEventReader createXMLEventReader(Reader reader)</span>. These methods throw <span class="EmphasisFontCategoryNonProportional ">XMLStreamException</span> when the event-based reader cannot be created.</p><div class="Para" id="Par36">The following code fragment creates an event-based reader whose source is a file named <span class="EmphasisFontCategoryNonProportional ">recipe.xml</span>:<div class="ProgramCode" id="PC8"><div class="LineGroup"><div class="FixedLine">Reader reader = new FileReader(&quot;recipe.xml&quot;);</div><div class="FixedLine">XMLEventReader xmler = xmlif.createXMLEventReader(reader);</div></div></div></div><p class="Para" id="Par37">The high-level <span class="EmphasisFontCategoryNonProportional ">javax.xml.stream.XMLEventReader</span> interface offers a somewhat less efficient but more object-oriented way to read XML data with StAX. This interface鈥檚 <span class="EmphasisFontCategoryNonProportional ">boolean hasNext()</span> method<span id="ITerm15">
                    
                    
                  </span> returns <span class="EmphasisFontCategoryNonProportional ">true</span> when there is an event to obtain; otherwise, it returns <span class="EmphasisFontCategoryNonProportional ">false</span>. The <span class="EmphasisFontCategoryNonProportional ">XMLEvent nextEvent()</span> method returns the next event as an object whose class implements a subinterface of the <span class="EmphasisFontCategoryNonProportional ">javax.xml.stream.events.XMLEvent</span> interface.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar7"><h3 class="Heading">Note</h3><p class="Para" id="Par38"><span class="EmphasisFontCategoryNonProportional ">XMLEvent</span> is the base interface for handling markup events. It declares methods that apply to all subinterfaces; for example, <span class="EmphasisFontCategoryNonProportional ">Location getLocation()</span> (return a <span class="EmphasisFontCategoryNonProportional ">javax.xml.stream.Location</span> object whose <span class="EmphasisFontCategoryNonProportional ">int getCharacterOffset()</span> and other methods return location information about the event) and <span class="EmphasisFontCategoryNonProportional ">int getEventType()</span> (return the event type as an <span class="EmphasisFontCategoryNonProportional ">XMLStreamConstants</span> infoset constant, such as <span class="EmphasisFontCategoryNonProportional ">START_ELEMENT</span> and <span class="EmphasisFontCategoryNonProportional ">PROCESSING_INSTRUCTION</span>鈥?span class=&quot;EmphasisFontCategoryNonProportional &quot;&gt;XMLEvent</span> extends <span class="EmphasisFontCategoryNonProportional ">XMLStreamConstants</span>). <span class="EmphasisFontCategoryNonProportional ">XMLEvent</span> is subtyped by other <span class="EmphasisFontCategoryNonProportional ">javax.xml.stream.events</span> interfaces that describe different kinds of events (such as <span class="EmphasisFontCategoryNonProportional ">Attribute</span>) in terms of methods that return infoset item-specific information (such as <span class="EmphasisFontCategoryNonProportional ">Attribute</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">QName getName()</span> and <span class="EmphasisFontCategoryNonProportional ">String getValue()</span> methods).</p></div><div class="Para" id="Par39">The following code fragment uses the <span class="EmphasisFontCategoryNonProportional ">hasNext()</span> and <span class="EmphasisFontCategoryNonProportional ">nextEvent()</span> methods to codify a parsing loop that detects the start and <span id="ITerm16">end</span> of an element:<div class="ProgramCode" id="PC9"><div class="LineGroup"><div class="FixedLine">while (xmler.hasNext())</div><div class="FixedLine">{</div><div class="FixedLine">   switch (xmler.nextEvent().getEventType())</div><div class="FixedLine">   {</div><div class="FixedLine">      case XMLEvent.START_ELEMENT:</div><div class="FixedLine">         // Do something at element start.</div><div class="FixedLine">         break;</div></div><div class="LineGroup"><div class="FixedLine">      case XMLEvent.END_ELEMENT:</div><div class="FixedLine">         // Do something at element end.</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div></div></div><div class="Para" id="Par40">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_4_Chapter.xhtml#PC10">4-2</a></span> presents the source code to a <span class="EmphasisFontCategoryNonProportional ">StAXDemo</span> application that reports an XML document鈥檚 start and <span id="ITerm17">end</span> elements via an event-based reader.<div class="ProgramCode" id="PC10"><div class="LineGroup"><div class="FixedLine">import java.io.FileNotFoundException;</div><div class="FixedLine">import java.io.FileReader;</div></div><div class="LineGroup"><div class="FixedLine">import javax.xml.stream.FactoryConfigurationError;</div><div class="FixedLine">import javax.xml.stream.XMLEventReader;</div><div class="FixedLine">import javax.xml.stream.XMLInputFactory;</div><div class="FixedLine">import javax.xml.stream.XMLStreamException;</div></div><div class="LineGroup"><div class="FixedLine">import javax.xml.stream.events.EndElement;</div><div class="FixedLine">import javax.xml.stream.events.StartElement;</div><div class="FixedLine">import javax.xml.stream.events.XMLEvent;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class StAXDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      if (args.length != 1)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.println(&quot;usage: java StAXDemo xmlfile&quot;);</div><div class="FixedLine">         return;</div><div class="FixedLine">      }</div><div class="FixedLine">      try</div><div class="FixedLine">      {</div><div class="FixedLine">         XMLInputFactory xmlif = XMLInputFactory.newFactory();</div><div class="FixedLine">         FileReader fr = new FileReader(args[0]);</div><div class="FixedLine">         XMLEventReader xmler = xmlif.createXMLEventReader(fr);</div><div class="FixedLine">         while (xmler.hasNext())</div><div class="FixedLine">         {</div><div class="FixedLine">            XMLEvent xmle = xmler.nextEvent();</div><div class="FixedLine">            switch (xmle.getEventType())</div><div class="FixedLine">            {</div><div class="FixedLine">               case XMLEvent.START_ELEMENT:</div><div class="FixedLine">                  out.println(&quot;START_ELEMENT&quot;);</div><div class="FixedLine">                  out.printf(&quot;  Qname = %s%n&quot;,</div><div class="FixedLine">                             ((StartElement) xmle). getName());</div><div class="FixedLine">                  break;</div><div class="FixedLine">               case XMLEvent.END_ELEMENT:</div><div class="FixedLine">                  out.println(&quot;END_ELEMENT&quot;);</div><div class="FixedLine">                  out.printf(&quot;  Qname = %s%n&quot;,</div><div class="FixedLine">                             ((EndElement) xmle). getName());</div><div class="FixedLine">            }</div><div class="FixedLine">         }</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (FactoryConfigurationError fce)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;FCE: %s%n&quot;, fce.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (FileNotFoundException fnfe)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;FNFE: %s%n&quot;, fnfe.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (XMLStreamException xmlse)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;XMLSE: %s%n&quot;, xmlse.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 4-2</span><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">StAXDemo</span> (Version 2)</p></div></div></div></div><p class="Para" id="Par41">After verifying the number of command-line arguments, Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_4_Chapter.xhtml#PC10">4-2</a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">main()</span> method creates a factory, uses the factory to create an event-based reader that obtains its XML data from the file identified by the solitary command-line argument, and enters a parsing loop. Whenever <span class="EmphasisFontCategoryNonProportional ">nextEvent()</span> returns <span class="EmphasisFontCategoryNonProportional ">XMLEvent.START_ELEMENT</span> or <span class="EmphasisFontCategoryNonProportional ">XMLEvent.END_ELEMENT</span>, <span class="EmphasisFontCategoryNonProportional ">StartElement</span>鈥檚 or <span class="EmphasisFontCategoryNonProportional ">EndElement</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">getName()</span> method is called to return the element鈥檚 qualified name.</p><div class="Para" id="Par42">After compiling Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_4_Chapter.xhtml#PC10">4-2</a></span>, run the resulting application to dump Listing <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC3"><span class="RefSource">1-3</span></a></span>鈥檚 article XML content, as follows:<div class="ProgramCode" id="PC11"><div class="LineGroup"><div class="FixedLine">java StAXDemo article.xml</div></div></div></div><div class="Para" id="Par43">You should observe the following <span id="ITerm18">output</span>:<div class="ProgramCode" id="PC12"><div class="LineGroup"><div class="FixedLine">START_ELEMENT</div><div class="FixedLine">  Qname = article</div><div class="FixedLine">START_ELEMENT</div><div class="FixedLine">  Qname = abstract</div><div class="FixedLine">START_ELEMENT</div><div class="FixedLine">  Qname = code</div><div class="FixedLine">END_ELEMENT</div><div class="FixedLine">  Qname = code</div><div class="FixedLine">END_ELEMENT</div><div class="FixedLine">  Qname = abstract</div><div class="FixedLine">START_ELEMENT</div><div class="FixedLine">  Qname = body</div><div class="FixedLine">END_ELEMENT</div><div class="FixedLine">  Qname = body</div><div class="FixedLine">END_ELEMENT</div><div class="FixedLine">  Qname = article</div></div></div></div><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar8"><h3 class="Heading">Note</h3><p class="Para" id="Par44">You can also create a filtered event-based reader to accept or reject various events by calling one of <span class="EmphasisFontCategoryNonProportional ">XMLInputFactory</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">createFilteredReader()</span> methods, such as <span class="EmphasisFontCategoryNonProportional ">XMLEventReader createFilteredReader(XMLEventReader reader, EventFilter filter)</span>. The <span class="EmphasisFontCategoryNonProportional ">javax.xml.stream.EventFilter</span> interface declares a <span class="EmphasisFontCategoryNonProportional ">boolean accept(XMLEvent event)</span> method that returns <span class="EmphasisFontCategoryNonProportional ">true</span> when the specified event is part of the event sequence; otherwise, it returns <span class="EmphasisFontCategoryNonProportional ">false</span>.</p></div></section></section><section class="Section2 RenderAsSection2" id="Sec6"><h3 class="Heading">Creating XML Documents</h3><p class="Para" id="Par45">Document writers are obtained by calling the various 鈥?span class=&quot;EmphasisFontCategoryNonProportional &quot;&gt;create</span>鈥?methods that are declared in the <span class="EmphasisFontCategoryNonProportional ">javax.xml.stream.XMLOutputFactory</span> class<span id="ITerm19">
                  
                  
                </span>. These creational methods are organized into two categories: methods for creating stream-based writers and methods for creating event-based writers.</p><div class="Para" id="Par46">Before you can obtain a stream-based or an event-based writer, you need to obtain an instance of the factory by calling one of the <span class="EmphasisFontCategoryNonProportional ">newFactory() static</span> methods, such as <span class="EmphasisFontCategoryNonProportional ">XMLOutputFactory newFactory()</span>:<div class="ProgramCode" id="PC13"><div class="LineGroup"><div class="FixedLine">XMLOutputFactory xmlof = XMLOutputFactory.newFactory();</div></div></div></div><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar9"><h3 class="Heading">Note</h3><p class="Para" id="Par47">You can also call the <span class="EmphasisFontCategoryNonProportional ">XMLOutputFactory newInstance() static</span> method but might not want to do so because its same-named but parameterized companion method has been deprecated to maintain API consistency, and it鈥檚 possible that <span class="EmphasisFontCategoryNonProportional ">newInstance()</span> will be deprecated as well.</p></div><p class="Para" id="Par48">The <span class="EmphasisFontCategoryNonProportional ">newFactory()</span> methods follow an ordered lookup procedure to locate the <span class="EmphasisFontCategoryNonProportional ">XMLOutputFactory</span> implementation class. This procedure first examines the <span class="EmphasisFontCategoryNonProportional ">javax.xml.stream.XMLOutputFactory</span> system property and lastly returns the system-default implementation (returned from <span class="EmphasisFontCategoryNonProportional ">XMLOutputFactory newDefaultFactory()</span>). If there is a service configuration error, or if the implementation is not available or cannot be instantiated, the method throws an instance of the <span class="EmphasisFontCategoryNonProportional ">FactoryConfigurationError</span> class.</p><p class="Para" id="Par49">After creating the factory, call <span class="EmphasisFontCategoryNonProportional ">XMLOutputFactory</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">void setProperty(String name, Object value)</span> method to set various features and properties as necessary. The only property currently supported by all writers is <span class="EmphasisFontCategoryNonProportional ">XMLOutputFactory.IS_REPAIRING_NAMESPACES</span>. When enabled (by passing <span class="EmphasisFontCategoryNonProportional ">true</span> or a <span class="EmphasisFontCategoryNonProportional ">Boolean</span> object, such as <span class="EmphasisFontCategoryNonProportional ">Boolean.TRUE</span>, to <span class="EmphasisFontCategoryNonProportional ">value</span>), the document writer takes care of all namespace bindings and declarations, with minimal help from the application. The output is always well formed with respect to namespaces. However enabling this <span id="ITerm20">property</span> adds some overhead to the job of writing the XML.</p><section class="Section3 RenderAsSection3" id="Sec7"><h4 class="Heading">Creating Documents with Stream-Based Writers</h4><p class="Para" id="Par50">A stream-based writer is created by calling one of <span class="EmphasisFontCategoryNonProportional ">XMLOutputFactory</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">createXMLStreamWriter()</span> methods<span id="ITerm21">
                    
                    
                    
                  </span>, such as <span class="EmphasisFontCategoryNonProportional ">XMLStreamWriter createXMLStreamWriter(Writer writer)</span>. These methods throw <span class="EmphasisFontCategoryNonProportional ">XMLStreamException</span> when the stream-based writer cannot be created.</p><div class="Para" id="Par51">The following code fragment creates a stream-based writer whose destination is a file named <span class="EmphasisFontCategoryNonProportional ">recipe.xml</span>:<div class="ProgramCode" id="PC14"><div class="LineGroup"><div class="FixedLine">Writer writer = new FileWriter(&quot;recipe.xml&quot;);</div><div class="FixedLine">XMLStreamWriter xmlsw = xmlof.createXMLStreamWriter(writer);</div></div></div></div><div class="Para" id="Par52">The low-level <span class="EmphasisFontCategoryNonProportional ">XMLStreamWriter</span> interface<span id="ITerm22">
                    
                    
                  </span> declares several methods for writing infoset items to the destination. The following list describes a few of these methods:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par53"><span class="EmphasisFontCategoryNonProportional ">void close()</span> closes this stream-based writer and frees any associated resources. The underlying writer is not closed.</p></li><li><p class="Para" id="Par54"><span class="EmphasisFontCategoryNonProportional ">void flush()</span> writes any cached data to the underlying writer.</p></li><li><p class="Para" id="Par55"><span class="EmphasisFontCategoryNonProportional ">void setPrefix(String prefix, String uri)</span> identifies the namespace <span class="EmphasisFontCategoryNonProportional ">prefix</span> to which the <span class="EmphasisFontCategoryNonProportional ">uri</span> value is bound. This <span class="EmphasisFontCategoryNonProportional ">prefix</span> is used by variants of the <span class="EmphasisFontCategoryNonProportional ">writeStartElement()</span>, <span class="EmphasisFontCategoryNonProportional ">writeAttribute()</span>, and <span class="EmphasisFontCategoryNonProportional ">writeEmptyElement()</span> methods that take namespace arguments but not prefixes. Also, it remains valid until the <span class="EmphasisFontCategoryNonProportional ">writeEndElement()</span> invocation that corresponds to the last <span class="EmphasisFontCategoryNonProportional ">writeStartElement()</span> invocation. This method doesn鈥檛 create any output.</p></li><li><p class="Para" id="Par56"><span class="EmphasisFontCategoryNonProportional ">void writeAttribute(String localName, String value)</span> writes the attribute identified by <span class="EmphasisFontCategoryNonProportional ">localName</span> and having the specified <span class="EmphasisFontCategoryNonProportional ">value</span> to the underlying writer. A namespace prefix isn鈥檛 included. This method escapes the <span class="EmphasisFontCategoryNonProportional ">&amp;</span>, <span class="EmphasisFontCategoryNonProportional ">&lt;</span>, <span class="EmphasisFontCategoryNonProportional ">&gt;</span>, and <span class="EmphasisFontCategoryNonProportional ">&quot;</span> characters.</p></li><li><p class="Para" id="Par57"><span class="EmphasisFontCategoryNonProportional ">void writeCharacters(String text)</span> writes <span class="EmphasisFontCategoryNonProportional ">text</span>鈥檚 characters to the underlying writer. This method escapes the <span class="EmphasisFontCategoryNonProportional ">&amp;</span>, <span class="EmphasisFontCategoryNonProportional ">&lt;</span>, and <span class="EmphasisFontCategoryNonProportional ">&gt;</span> characters.</p></li><li><p class="Para" id="Par58"><span class="EmphasisFontCategoryNonProportional ">void writeEndDocument()</span> closes any start tags and writes corresponding end tags to the underlying writer.</p></li><li><p class="Para" id="Par59"><span class="EmphasisFontCategoryNonProportional ">void writeEndElement()</span> writes an end tag to the underlying writer, relying on the internal state of the stream-based writer to determine the tag鈥檚 prefix and local name.</p></li><li><p class="Para" id="Par60"><span class="EmphasisFontCategoryNonProportional ">void writeNamespace(String prefix, String namespaceURI)</span> writes a namespace to the underlying writer. This method must be called to ensure that the namespace specified by <span class="EmphasisFontCategoryNonProportional ">setPrefix()</span> and duplicated in this method call is written; otherwise, the resulting document will not be well formed from a namespace perspective.</p></li><li><p class="Para" id="Par61"><span class="EmphasisFontCategoryNonProportional ">void writeStartDocument()</span> writes the XML declaration to the underlying writer.</p></li><li><p class="Para" id="Par62"><span class="EmphasisFontCategoryNonProportional ">void writeStartElement(String namespaceURI, String localName)</span> writes a start tag with the arguments passed to <span class="EmphasisFontCategoryNonProportional ">namespaceURI</span> and <span class="EmphasisFontCategoryNonProportional ">localName</span> to the underlying writer.</p></li></ul></div></div><div class="Para" id="Par63">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_4_Chapter.xhtml#PC15">4-3</a></span> presents the source code to a <span class="EmphasisFontCategoryNonProportional ">StAXDemo</span> application that creates a <span class="EmphasisFontCategoryNonProportional ">recipe.xml</span> file with many of Listing <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC5"><span class="RefSource">1-5</span></a></span>鈥檚 infoset <span id="ITerm23">items</span> via a stream-based writer.<div class="ProgramCode" id="PC15"><div class="LineGroup"><div class="FixedLine">import java.io.FileWriter;</div><div class="FixedLine">import java.io.IOException;</div></div><div class="LineGroup"><div class="FixedLine">import javax.xml.stream.FactoryConfigurationError;</div><div class="FixedLine">import javax.xml.stream.XMLOutputFactory;</div><div class="FixedLine">import javax.xml.stream.XMLStreamException;</div><div class="FixedLine">import javax.xml.stream.XMLStreamWriter;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class StAXDemo</div><div class="FixedLine">{</div><div class="FixedLine">   final static String NS1 = &quot;http://www.w3.org/1999/xhtml&quot;;</div><div class="FixedLine">   final static String NS2 = &quot;http://www.javajeff.ca/&quot;;</div></div><div class="LineGroup"><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      try</div><div class="FixedLine">      {</div><div class="FixedLine">         XMLOutputFactory xmlof =</div><div class="FixedLine">            XMLOutputFactory.newFactory();</div><div class="FixedLine">         FileWriter fw = new FileWriter(&quot;recipe.xml&quot;);</div><div class="FixedLine">         XMLStreamWriter xmlsw =</div><div class="FixedLine">            xmlof.createXMLStreamWriter(fw);</div><div class="FixedLine">         xmlsw.writeStartDocument();</div><div class="FixedLine">         xmlsw.setPrefix(&quot;h&quot;, NS1);</div><div class="FixedLine">         xmlsw.writeStartElement(NS1, &quot;html&quot;);</div><div class="FixedLine">         xmlsw.writeNamespace(&quot;h&quot;, NS1);</div><div class="FixedLine">         xmlsw.writeNamespace(&quot;r&quot;, NS2);</div><div class="FixedLine">         xmlsw.writeStartElement(NS1, &quot;head&quot;);</div><div class="FixedLine">         xmlsw.writeStartElement(NS1, &quot;title&quot;);</div><div class="FixedLine">         xmlsw.writeCharacters(&quot;Recipe&quot;);</div><div class="FixedLine">         xmlsw.writeEndElement();</div><div class="FixedLine">         xmlsw.writeEndElement();</div><div class="FixedLine">         xmlsw.writeStartElement(NS1, &quot;body&quot;);</div><div class="FixedLine">         xmlsw.setPrefix(&quot;r&quot;, NS2);</div><div class="FixedLine">         xmlsw.writeStartElement(NS2, &quot;recipe&quot;);</div><div class="FixedLine">         xmlsw.writeStartElement(NS2, &quot;title&quot;);</div><div class="FixedLine">         xmlsw.writeCharacters(&quot;Grilled Cheese Sandwich&quot;);</div><div class="FixedLine">         xmlsw.writeEndElement();</div><div class="FixedLine">         xmlsw.writeStartElement(NS2, &quot;ingredients&quot;);</div><div class="FixedLine">         xmlsw.setPrefix(&quot;h&quot;, NS1);</div><div class="FixedLine">         xmlsw.writeStartElement(NS1, &quot;ul&quot;);</div><div class="FixedLine">         xmlsw.writeStartElement(NS1, &quot;li&quot;);</div><div class="FixedLine">         xmlsw.setPrefix(&quot;r&quot;, NS2);</div><div class="FixedLine">         xmlsw.writeStartElement(NS2, &quot;ingredient&quot;);</div><div class="FixedLine">         xmlsw.writeAttribute(&quot;qty&quot;, &quot;2&quot;);</div><div class="FixedLine">         xmlsw.writeCharacters(&quot;bread slice&quot;);</div><div class="FixedLine">         xmlsw.writeEndElement();</div><div class="FixedLine">         xmlsw.setPrefix(&quot;h&quot;, NS1);</div><div class="FixedLine">         xmlsw.writeEndElement();</div><div class="FixedLine">         xmlsw.writeEndElement();</div><div class="FixedLine">         xmlsw.setPrefix(&quot;r&quot;, NS2);</div><div class="FixedLine">         xmlsw.writeEndElement();</div><div class="FixedLine">         xmlsw.writeEndDocument();</div><div class="FixedLine">         xmlsw.flush();</div><div class="FixedLine">         xmlsw.close();</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (FactoryConfigurationError fce)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;FCE: %s%n&quot;, fce.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (IOException ioe)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;IOE: %s%n&quot;, ioe.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (XMLStreamException xmlse)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;XMLSE: %s%n&quot;, xmlse.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 4-3</span><p class="SimplePara"><span id="ITerm24">
                            <span class="EmphasisFontCategoryNonProportional ">StAXDemo</span>
                            
                            
                          </span> (Version 3)</p></div></div></div></div><p class="Para" id="Par64">Although Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_4_Chapter.xhtml#PC15">4-3</a></span> is fairly easy to follow, you might be somewhat confused by the duplication of namespace URIs in the <span class="EmphasisFontCategoryNonProportional ">setPrefix()</span> and <span class="EmphasisFontCategoryNonProportional ">writeStartElement()</span> method calls. For example, you might be wondering about the duplicate URIs in <span class="EmphasisFontCategoryNonProportional ">xmlsw.setPrefix(&quot;h&quot;, NS1);</span> and its <span class="EmphasisFontCategoryNonProportional ">xmlsw.writeStartElement(NS1, &quot;html&quot;);</span> successor.</p><p class="Para" id="Par65">The <span class="EmphasisFontCategoryNonProportional ">setPrefix()</span> method <span id="ITerm25">call</span> creates a mapping between a namespace prefix (the value) and a URI (the key) without generating any output. The <span class="EmphasisFontCategoryNonProportional ">writeStartElement()</span> method call specifies the URI key, which this method uses to access the prefix value, which it then prepends (with a colon character) to the <span class="EmphasisFontCategoryNonProportional ">html</span> start tag鈥檚 name before writing this tag to the underlying writer.</p><p class="Para" id="Par66">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_4_Chapter.xhtml#PC15">4-3</a></span> and run the resulting application. You should discover a <span class="EmphasisFontCategoryNonProportional ">recipe.xml</span> file in the current directory.</p></section><section class="Section3 RenderAsSection3" id="Sec8"><h4 class="Heading">Creating Documents with Event-Based Writers</h4><p class="Para" id="Par67">An event-based writer is created by calling one of <span class="EmphasisFontCategoryNonProportional ">XMLOutputFactory</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">createXMLEventWriter()</span> methods<span id="ITerm26">
                    
                    
                    
                  </span>, such as <span class="EmphasisFontCategoryNonProportional ">XMLEventWriter createXMLEventWriter(Writer writer)</span>. These methods throw <span class="EmphasisFontCategoryNonProportional ">XMLStreamException</span> when the event-based writer cannot be created.</p><div class="Para" id="Par68">The following code fragment creates an event-based writer whose destination is a file named <span class="EmphasisFontCategoryNonProportional ">recipe.xml</span>:<div class="ProgramCode" id="PC16"><div class="LineGroup"><div class="FixedLine">Writer writer = new FileWriter(&quot;recipe.xml&quot;);</div><div class="FixedLine">XMLEventWriter xmlew = xmlof.createXMLEventWriter(writer);</div></div></div></div><p class="Para" id="Par69">The high-level <span class="EmphasisFontCategoryNonProportional ">XMLEventWriter</span> interface<span id="ITerm27">
                    
                    
                  </span><span id="ITerm28">
                    
                  </span> declares the <span class="EmphasisFontCategoryNonProportional ">void add(XMLEvent event)</span> method for adding events that describe infoset items to the output stream implemented by the underlying writer. Each argument passed to <span class="EmphasisFontCategoryNonProportional ">event</span> is an instance of a class that implements a subinterface of <span class="EmphasisFontCategoryNonProportional ">XMLEvent</span> (such as <span class="EmphasisFontCategoryNonProportional ">Attribute</span> and <span class="EmphasisFontCategoryNonProportional ">StartElement</span>).</p><p class="Para" id="Par70">To save you the trouble of implementing these interfaces, StAX provides <span class="EmphasisFontCategoryNonProportional ">javax.xml.stream.EventFactory</span>. This utility class declares various factory methods for creating <span class="EmphasisFontCategoryNonProportional ">XMLEvent</span> subinterface implementations. For example, <span class="EmphasisFontCategoryNonProportional ">Comment createComment(String text)</span> returns an object whose class implements the <span class="EmphasisFontCategoryNonProportional ">javax.xml.stream.events.Comment</span> subinterface of <span class="EmphasisFontCategoryNonProportional ">XMLEvent</span>.</p><div class="Para" id="Par71">Because these factory methods are declared <span class="EmphasisFontCategoryNonProportional ">abstract</span>, you must first obtain an instance of the <span class="EmphasisFontCategoryNonProportional ">EventFactory</span> class. You can easily accomplish this task by invoking <span class="EmphasisFontCategoryNonProportional ">XMLEventFactory</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">XMLEventFactory newFactory() static</span> method, as follows:<div class="ProgramCode" id="PC17"><div class="LineGroup"><div class="FixedLine">XMLEventFactory xmlef = XMLEventFactory.newFactory();</div></div></div></div><div class="Para" id="Par72">You can then obtain an <span class="EmphasisFontCategoryNonProportional ">XMLEvent</span> subinterface implementation, as follows:<div class="ProgramCode" id="PC18"><div class="LineGroup"><div class="FixedLine">XMLEvent comment = xmlef.createComment(&quot;ToDo&quot;);</div></div></div></div><div class="Para" id="Par73">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_4_Chapter.xhtml#PC19">4-4</a></span> presents the source code to a <span class="EmphasisFontCategoryNonProportional ">StAXDemo</span> application that creates a <span class="EmphasisFontCategoryNonProportional ">recipe.xml</span> file with many of Listing <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC5"><span class="RefSource">1-5</span></a></span>鈥檚 infoset items via an event-based writer.<div class="ProgramCode" id="PC19"><div class="LineGroup"><div class="FixedLine">import java.io.FileWriter;</div><div class="FixedLine">import java.io.IOException;</div></div><div class="LineGroup"><div class="FixedLine">import java.util.Iterator;</div></div><div class="LineGroup"><div class="FixedLine">import javax.xml.stream.FactoryConfigurationError;</div><div class="FixedLine">import javax.xml.stream.XMLEventFactory;</div><div class="FixedLine">import javax.xml.stream.XMLEventWriter;</div><div class="FixedLine">import javax.xml.stream.XMLOutputFactory;</div><div class="FixedLine">import javax.xml.stream.XMLStreamException;</div></div><div class="LineGroup"><div class="FixedLine">import javax.xml.stream.events.Attribute;</div><div class="FixedLine">import javax.xml.stream.events.Namespace;</div><div class="FixedLine">import javax.xml.stream.events.XMLEvent;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class StAXDemo</div><div class="FixedLine">{</div><div class="FixedLine">   final static String NS1 = &quot;http://www.w3.org/1999/xhtml&quot;;</div><div class="FixedLine">   final static String NS2 = &quot;http://www.javajeff.ca/&quot;;</div></div><div class="LineGroup"><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      try</div><div class="FixedLine">      {</div><div class="FixedLine">         XMLOutputFactory xmlof =</div><div class="FixedLine">            XMLOutputFactory.newFactory();</div><div class="FixedLine">         FileWriter fw = new FileWriter(&quot;recipe.xml&quot;);</div><div class="FixedLine">         XMLEventWriter xmlew;</div><div class="FixedLine">         xmlew = xmlof.createXMLEventWriter(fw);</div><div class="FixedLine">         final XMLEventFactory xmlef =</div><div class="FixedLine">            XMLEventFactory.newFactory();</div><div class="FixedLine">         XMLEvent event = xmlef.createStartDocument();</div><div class="FixedLine">         xmlew.add(event);</div><div class="FixedLine">         Iterator&lt;Namespace&gt; nsIter;</div><div class="FixedLine">         nsIter = new Iterator&lt;Namespace&gt;()</div><div class="FixedLine">         {</div><div class="FixedLine">            int index = 0;</div><div class="FixedLine">            Namespace[] ns;</div><div class="FixedLine">            {</div><div class="FixedLine">               ns = new Namespace[2];</div><div class="FixedLine">               ns[0] = xmlef.createNamespace(&quot;h&quot;, NS1);</div><div class="FixedLine">               ns[1] = xmlef.createNamespace(&quot;r&quot;, NS2);</div><div class="FixedLine">            }</div><div class="FixedLine">            @Override</div><div class="FixedLine">            public boolean hasNext()</div><div class="FixedLine">            {</div><div class="FixedLine">               return index != 2;</div><div class="FixedLine">            }</div><div class="FixedLine">            @Override</div><div class="FixedLine">            public Namespace next()</div><div class="FixedLine">            {</div><div class="FixedLine">               return ns[index++];</div><div class="FixedLine">            }</div><div class="FixedLine">            @Override</div><div class="FixedLine">            public void remove()</div><div class="FixedLine">            {</div><div class="FixedLine">               throw new UnsupportedOperationException();</div><div class="FixedLine">            }</div><div class="FixedLine">         };</div><div class="FixedLine">         event = xmlef.createStartElement(&quot;h&quot;, NS1, &quot;html&quot;, null, nsIter);</div><div class="FixedLine">         xmlew.add(event);</div><div class="FixedLine">         event = xmlef.createStartElement(&quot;h&quot;, NS2, &quot;head&quot;);</div><div class="FixedLine">         xmlew.add(event);</div><div class="FixedLine">         event = xmlef.createStartElement(&quot;h&quot;, NS1, &quot;title&quot;);</div><div class="FixedLine">         xmlew.add(event);</div><div class="FixedLine">         event = xmlef.createCharacters(&quot;Recipe&quot;);</div><div class="FixedLine">         xmlew.add(event);</div><div class="FixedLine">         event = xmlef.createEndElement(&quot;h&quot;, NS1, &quot;title&quot;);</div><div class="FixedLine">         xmlew.add(event);</div><div class="FixedLine">         event = xmlef.createEndElement(&quot;h&quot;, NS1, &quot;head&quot;);</div><div class="FixedLine">         xmlew.add(event);</div><div class="FixedLine">         event = xmlef.createStartElement(&quot;h&quot;, NS1, &quot;body&quot;);</div><div class="FixedLine">         xmlew.add(event);</div><div class="FixedLine">         event = xmlef.createStartElement(&quot;r&quot;, NS2, &quot;recipe&quot;);</div><div class="FixedLine">         xmlew.add(event);</div><div class="FixedLine">         event = xmlef.createStartElement(&quot;r&quot;, NS2, &quot;title&quot;);</div><div class="FixedLine">         xmlew.add(event);</div><div class="FixedLine">         event = xmlef.createCharacters(&quot;Grilled Cheese &quot; + &quot;Sandwich&quot;);</div><div class="FixedLine">         xmlew.add(event);</div><div class="FixedLine">         event = xmlef.createEndElement(&quot;r&quot;, NS2, &quot;title&quot;);</div><div class="FixedLine">         xmlew.add(event);</div><div class="FixedLine">         event = xmlef.createStartElement(&quot;r&quot;, NS2, &quot;ingredients&quot;);</div><div class="FixedLine">         xmlew.add(event);</div><div class="FixedLine">         event = xmlef.createStartElement(&quot;h&quot;, NS1, &quot;ul&quot;);</div><div class="FixedLine">         xmlew.add(event);</div><div class="FixedLine">         event = xmlef.createStartElement(&quot;h&quot;, NS1, &quot;li&quot;);</div><div class="FixedLine">         xmlew.add(event);</div><div class="FixedLine">         Iterator&lt;Attribute&gt; attrIter;</div><div class="FixedLine">         attrIter = new Iterator&lt;Attribute&gt;()</div><div class="FixedLine">         {</div><div class="FixedLine">            int index = 0;</div><div class="FixedLine">            Attribute[] attrs;</div><div class="FixedLine">            {</div><div class="FixedLine">               attrs = new Attribute[1];</div><div class="FixedLine">               attrs[0] = xmlef.createAttribute(&quot;qty&quot;, &quot;2&quot;);</div><div class="FixedLine">            }</div><div class="FixedLine">            @Override</div><div class="FixedLine">            public boolean hasNext()</div><div class="FixedLine">            {</div><div class="FixedLine">               return index != 1;</div><div class="FixedLine">            }</div><div class="FixedLine">            @Override</div><div class="FixedLine">            public Attribute next()</div><div class="FixedLine">            {</div><div class="FixedLine">               return attrs[index++];</div><div class="FixedLine">            }</div><div class="FixedLine">            @Override</div><div class="FixedLine">            public void remove()</div><div class="FixedLine">            {</div><div class="FixedLine">               throw new UnsupportedOperationException();</div><div class="FixedLine">            }</div><div class="FixedLine">         };</div><div class="FixedLine">         event = xmlef.createStartElement(&quot;r&quot;, NS2, &quot;ingredient&quot;, attrIter, null);</div><div class="FixedLine">         xmlew.add(event);</div><div class="FixedLine">         event = xmlef.createCharacters(&quot;bread slice&quot;);</div><div class="FixedLine">         xmlew.add(event);</div><div class="FixedLine">         event = xmlef.createEndElement(&quot;r&quot;, NS2, &quot;ingredient&quot;);</div><div class="FixedLine">         xmlew.add(event);</div><div class="FixedLine">         event = xmlef.createEndElement(&quot;h&quot;, NS1, &quot;li&quot;);</div><div class="FixedLine">         xmlew.add(event);</div><div class="FixedLine">         event = xmlef.createEndElement(&quot;h&quot;, NS1, &quot;ul&quot;);</div><div class="FixedLine">         xmlew.add(event);</div><div class="FixedLine">         event = xmlef.createEndElement(&quot;r&quot;, NS2, &quot;ingredients&quot;);</div><div class="FixedLine">         xmlew.add(event);</div><div class="FixedLine">         event = xmlef.createEndElement(&quot;r&quot;, NS2, &quot;recipe&quot;);</div><div class="FixedLine">         xmlew.add(event);</div><div class="FixedLine">         event = xmlef.createEndElement(&quot;h&quot;, NS1, &quot;body&quot;);</div><div class="FixedLine">         xmlew.add(event);</div><div class="FixedLine">         event = xmlef.createEndElement(&quot;h&quot;, NS1, &quot;html&quot;);</div><div class="FixedLine">         xmlew.add(event);</div><div class="FixedLine">         xmlew.flush();</div><div class="FixedLine">         xmlew.close();</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (FactoryConfigurationError fce)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;FCE: %s%n&quot;, fce.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (IOException ioe)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;IOE: %s%n&quot;, ioe.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (XMLStreamException xmlse)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;XMLSE: %s%n&quot;, xmlse.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 4-4</span><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">StAXDemo</span> (Version 4)</p></div></div></div></div><p class="Para" id="Par74">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_4_Chapter.xhtml#PC19">4-4</a></span> should be fairly easy to follow; it鈥檚 the event-based equivalent of Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_4_Chapter.xhtml#PC15">4-3</a></span>. Notice that this listing includes the creation of <span class="EmphasisFontCategoryNonProportional ">java.util.Iterator</span> instances from anonymous classes that implement this interface. These iterators are created to pass namespaces or attributes to <span class="EmphasisFontCategoryNonProportional ">XMLEventFactory</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">StartElement createStartElement</span>鈥?span class=&quot;EmphasisFontCategoryNonProportional &quot;&gt;(String prefix, String namespaceUri, String localName, Iterator&lt;? extends Attribute&gt; attributes, Iterator&lt;? extends Namespace&gt; namespaces)</span> method. (You can pass <span class="EmphasisFontCategoryNonProportional ">null</span> to this parameter when an iterator isn鈥檛 applicable; for example, when the start tag has no attributes.)</p><p class="Para" id="Par75">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_4_Chapter.xhtml#PC19">4-4</a></span> and run the resulting application. You should discover a <span class="EmphasisFontCategoryNonProportional ">recipe.xml</span> file in the current directory.</p><div class="Para" id="Par76"><span class="EmphasisFontCategoryNonProportional ">XMLEventWriter</span> declares a <span class="EmphasisFontCategoryNonProportional ">void add(XMLEventReader reader)</span> convenience method for adding a stream of input events to an output stream in one method call. Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_4_Chapter.xhtml#PC20">4-5</a></span> presents the source code to a <span class="EmphasisFontCategoryNonProportional ">Copy</span> application that uses this method to copy an XML file to another XML file.<div class="ProgramCode" id="PC20"><div class="LineGroup"><div class="FixedLine">import java.io.FileReader;</div><div class="FixedLine">import java.io.FileWriter;</div></div><div class="LineGroup"><div class="FixedLine">import javax.xml.stream.XMLEventReader;</div><div class="FixedLine">import javax.xml.stream.XMLEventWriter;</div><div class="FixedLine">import javax.xml.stream.XMLInputFactory;</div><div class="FixedLine">import javax.xml.stream.XMLOutputFactory;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class Copy</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args) throws Exception</div><div class="FixedLine">   {</div><div class="FixedLine">      if (args.length != 2)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.println(&quot;usage: java copy xmlfile1 xmlfile2&quot;);</div><div class="FixedLine">         return;</div><div class="FixedLine">      }</div><div class="FixedLine">      XMLInputFactory xmlif = XMLInputFactory.newFactory();</div><div class="FixedLine">      FileReader fr = new FileReader(args[0]);</div><div class="FixedLine">      XMLEventReader xmler = xmlif.createXMLEventReader(fr);</div><div class="FixedLine">      XMLOutputFactory xmlof = XMLOutputFactory.newFactory();</div><div class="FixedLine">      FileWriter fw = new FileWriter(args[1]);</div><div class="FixedLine">      XMLEventWriter xmlew;</div><div class="FixedLine">      xmlew = xmlof.createXMLEventWriter(fw);</div><div class="FixedLine">      xmlew.add(xmler);</div><div class="FixedLine">      xmlew.flush();</div><div class="FixedLine">      xmlew.close();</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 4-5</span><p class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional ">Copy</span>
                        </p></div></div></div></div><p class="Para" id="Par77">For brevity, I added a <span class="EmphasisFontCategoryNonProportional ">throws Exception</span> clause to <span class="EmphasisFontCategoryNonProportional ">main()</span>鈥檚 header.</p><div class="Para" id="Par78">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_4_Chapter.xhtml#PC20">4-5</a></span> as follows:<div class="ProgramCode" id="PC21"><div class="LineGroup"><div class="FixedLine">javac Copy.java</div></div></div></div><div class="Para" id="Par79">Run the resulting application to copy a <span class="EmphasisFontCategoryNonProportional ">recipe.xml</span> file to a <span class="EmphasisFontCategoryNonProportional ">_recipe.xml</span> backup file:<div class="ProgramCode" id="PC22"><div class="LineGroup"><div class="FixedLine">java Copy recipe.xml _recipe.xml</div></div></div></div><p class="Para" id="Par80">If the source XML file doesn鈥檛 have an XML declaration, it will be added to the destination XML file.</p><div class="FormalPara FormalParaRenderingStyle3 ParaTypeOverview" id="FPar10"><h3 class="Heading">Exercises</h3><div class="Para" id="Par81">The following exercises are designed to test your understanding of Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_4_Chapter.xhtml"><span class="RefSource">4</span></a></span>鈥檚 content:<div class="OrderedList"><ol><li class="ListItem"><span class="ItemNumber">1.</span><div class="ItemContent"><p class="Para" id="Par82">Define StAX.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">2.</span><div class="ItemContent"><p class="Para" id="Par83">What packages make up the StAX API?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">3.</span><div class="ItemContent"><p class="Para" id="Par84">True or false: A stream-based reader extracts the next infoset item from an input stream by obtaining an event.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">4.</span><div class="ItemContent"><p class="Para" id="Par85">How do you obtain a document reader? How do you obtain a document writer?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">5.</span><div class="ItemContent"><p class="Para" id="Par86">What does a document writer do when you call <span class="EmphasisFontCategoryNonProportional ">XMLOutputFactory</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">void setProperty(String name, Object value)</span> method with <span class="EmphasisFontCategoryNonProportional ">XMLOutputFactory.IS_REPAIRING_NAMESPACES</span> as the property name and <span class="EmphasisFontCategoryNonProportional ">true</span> as the value?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">6.</span><div class="ItemContent"><p class="Para" id="Par87">Create a <span class="EmphasisFontCategoryNonProportional ">ParseXMLDoc</span> application that uses a StAX stream-based reader to parse its single command-line argument, an XML document. After creating this reader, the application should verify that a <span class="EmphasisFontCategoryNonProportional ">START_DOCUMENT</span> infoset item has been detected, and then enter a loop that reads the next item and uses a <span class="EmphasisFontCategoryNonProportional ">switch</span> statement to output a message corresponding to the item that has been read: <span class="EmphasisFontCategoryNonProportional ">ATTRIBUTE</span>, <span class="EmphasisFontCategoryNonProportional ">CDATA</span>, <span class="EmphasisFontCategoryNonProportional ">CHARACTERS</span>, <span class="EmphasisFontCategoryNonProportional ">COMMENT</span>, <span class="EmphasisFontCategoryNonProportional ">DTD</span>, <span class="EmphasisFontCategoryNonProportional ">END_ELEMENT</span>, <span class="EmphasisFontCategoryNonProportional ">ENTITY_DECLARATION</span>, <span class="EmphasisFontCategoryNonProportional ">ENTITY_REFERENCE</span>, <span class="EmphasisFontCategoryNonProportional ">NAMESPACE</span>, <span class="EmphasisFontCategoryNonProportional ">NOTATION_DECLARATION</span>, <span class="EmphasisFontCategoryNonProportional ">PROCESSING_INSTRUCTION</span>, <span class="EmphasisFontCategoryNonProportional ">SPACE</span>, or <span class="EmphasisFontCategoryNonProportional ">START_ELEMENT</span>. When <span class="EmphasisFontCategoryNonProportional ">START_ELEMENT</span> is detected, output this element鈥檚 name and local name, and output the local names and values of all attributes. The loop ends when the <span class="EmphasisFontCategoryNonProportional ">END_DOCUMENT</span> infoset item has been detected. Explicitly close the stream reader followed by the file reader upon which it鈥檚 based. Test this application with Exercise 1-21鈥檚 <span class="EmphasisFontCategoryNonProportional ">books.xml</span> file.</p></div><div class="ClearBoth"> </div></li></ol></div></div></div></section></section></section><section class="Section1 RenderAsSection1" id="Sec9"><h2 class="Heading">Summary</h2><p class="Para" id="Par88">StAX is a Java API for parsing an XML document sequentially from start to finish and also for creating XML documents. Java implements StAX through types stored in the <span class="EmphasisFontCategoryNonProportional ">javax.xml.stream</span>, <span class="EmphasisFontCategoryNonProportional ">javax.xml.stream.events</span>, and <span class="EmphasisFontCategoryNonProportional ">javax.xml.stream.util</span> packages.</p><p class="Para" id="Par89">StAX parsers are known as document readers, and StAX document creators are known as document writers. StAX classifies document readers and document writers as stream-based or event-based.</p><p class="Para" id="Par90">Document readers are obtained by calling the various 鈥?span class=&quot;EmphasisFontCategoryNonProportional &quot;&gt;create</span>鈥?methods that are declared in the <span class="EmphasisFontCategoryNonProportional ">XMLInputFactory</span> class. Document writers are obtained by calling the various 鈥?span class=&quot;EmphasisFontCategoryNonProportional &quot;&gt;create</span>鈥?methods that are declared in the <span class="EmphasisFontCategoryNonProportional ">XMLOutputFactory</span> class.</p><p class="Para" id="Par91">The low-level <span class="EmphasisFontCategoryNonProportional ">XMLStreamReader</span> interface offers the most efficient way to read XML data with StAX. This interface鈥檚 <span class="EmphasisFontCategoryNonProportional ">boolean hasNext()</span> method returns <span class="EmphasisFontCategoryNonProportional ">true</span> when there is a next infoset item to obtain; otherwise, it returns <span class="EmphasisFontCategoryNonProportional ">false</span>. The <span class="EmphasisFontCategoryNonProportional ">int next()</span> method advances the cursor by one infoset item and returns an integer code that identifies this item鈥檚 type.</p><p class="Para" id="Par92">The low-level <span class="EmphasisFontCategoryNonProportional ">XMLStreamWriter</span> interface declares several methods for writing infoset items to the destination. Examples include <span class="EmphasisFontCategoryNonProportional ">void writeAttribute(String localName, String value)</span> and <span class="EmphasisFontCategoryNonProportional ">void writeCharacters(String text)</span>.</p><p class="Para" id="Par93">The high-level <span class="EmphasisFontCategoryNonProportional ">XMLEventReader</span> interface offers a somewhat less efficient but more object-oriented way to read XML data with StAX. This interface鈥檚 <span class="EmphasisFontCategoryNonProportional ">boolean hasNext()</span> method returns <span class="EmphasisFontCategoryNonProportional ">true</span> when there is an event to obtain; otherwise, it returns <span class="EmphasisFontCategoryNonProportional ">false</span>. The <span class="EmphasisFontCategoryNonProportional ">XMLEvent nextEvent()</span> method returns the next event as an object whose class implements a subinterface of the <span class="EmphasisFontCategoryNonProportional ">XMLEvent</span> interface.</p><p class="Para" id="Par94">The high-level <span class="EmphasisFontCategoryNonProportional ">XMLEventWriter</span> interface declares the <span class="EmphasisFontCategoryNonProportional ">void add(XMLEvent event)</span> method for adding events that describe infoset items to the output stream implemented by the underlying writer. Each argument passed to <span class="EmphasisFontCategoryNonProportional ">event</span> is an instance of a class that implements a subinterface of <span class="EmphasisFontCategoryNonProportional ">XMLEvent</span> (such as <span class="EmphasisFontCategoryNonProportional ">Attribute</span> and <span class="EmphasisFontCategoryNonProportional ">StartElement</span>).</p><p class="Para" id="Par95">Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_5_Chapter.xhtml"><span class="RefSource">5</span></a></span> introduces Java鈥檚 XPath API for simplifying DOM node access.</p></section></div><div class="annotator-outer annotator-viewer viewer annotator-hide"> </div></div></div>
    </section>
  </div>
</div>
<div class="font-flyout" style="top: 200.984px; left: 2474px;"> </div>
<hr/>

<!--if IE]><![endif]--><!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/java-xml-and/9781484243305/html/394211_2_En_5_Chapter.xhtml"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="3866890"
  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"
  data-username="levinxccai"
  data-account-type="B2B"
  
  data-activated-trial-date="11/06/2017"


  data-archive="9781484243305"
  data-publishers="Apress"



  data-htmlfile-name="394211_2_En_5_Chapter.xhtml"
  data-epub-title="Java XML and JSON: Document Processing for Java SE" data-debug=0 data-testing=0><![endif]--><!--if gt IE 8]><!--><!--![endif]-->



<a name="6_"></a>

<div class="application" id="container" style="height: auto;">
  <div class="js-toc">
    <section role="document">
      <div id="sbo-rt-content" style="max-width:72.5em; transform: none;"><div class="annotator-wrapper"><!--egin Abstract--><div class="MainTitleSection"><h1 class="ChapterTitle" lang="en">5. Selecting Nodes with XPath</h1></div><div class="AuthorGroup"><div class="AuthorNames"><span class="Author"><span class="AuthorName">Jeff Friesen</span><sup><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_5_Chapter.xhtml#Aff2">1</a> <span class="ContactIcon"></span></sup></span></div><div class="Affiliations"><div class="Affiliation" id="Aff2"><span class="AffiliationNumber">(1)</span><div class="AffiliationText">Dauphin, MB, Canada</div></div><div class="ClearBoth"> </div></div></div><!--nd Abstract--><div class="Fulltext"><p class="Para" id="Par2">Java includes an XPath API for simplifying access to a DOM tree鈥檚 nodes. Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_5_Chapter.xhtml"><span class="RefSource">5</span></a></span> introduces you to XPath.</p><section class="Section1 RenderAsSection1" id="Sec1"><h2 class="Heading">What Is XPath?</h2><p class="Para" id="Par3"><span id="ITerm1">
                <em class="EmphasisTypeItalic ">XPath</em>
                
                
              </span> is a nonXML declarative query language (defined by the W3C) for selecting an XML document鈥檚 infoset items as one or more nodes. For example, you can use XPath to locate Listing <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC1"><span class="RefSource">1-1</span></a></span>鈥檚 third <span class="EmphasisFontCategoryNonProportional ">ingredient</span> element and return this element node.</p><p class="Para" id="Par4">As well as simplifying access to a DOM tree鈥檚 nodes, XPath is commonly used in the context of XSLT (discussed in Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_6_Chapter.xhtml"><span class="RefSource">6</span></a></span>) where it鈥檚 typically employed to select (via XPath expressions) those input document elements that are to be copied to an output document.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar1"><h3 class="Heading">Note</h3><p class="Para" id="Par5">Java 11 supports XPath 1.0, which is assigned package <span class="EmphasisFontCategoryNonProportional ">javax.xml.xpath</span>.</p></div></section><section class="Section1 RenderAsSection1" id="Sec2"><h2 class="Heading">XPath Language Primer</h2><p class="Para" id="Par6">XPath regards an XML <span id="ITerm2">document</span> as a tree of nodes that starts from a root node. This language recognizes seven kinds of nodes: element, attribute, text, namespace, processing instruction, comment, and document. It doesn鈥檛 recognize CDATA sections, entity references, or document type declarations.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar2"><h3 class="Heading">Note</h3><p class="Para" id="Par7">A DOM tree鈥檚 root node (an <span class="EmphasisFontCategoryNonProportional ">org.w3c.dom.Document</span> object) isn鈥檛 the same as a document鈥檚 root element. The DOM tree鈥檚 root node contains the entire document, including the root element, any comments or processing instructions that appear before the root element鈥檚 start tag, and any comments or processing instructions that appear after the root element鈥檚 end tag.</p></div><section class="Section2 RenderAsSection2" id="Sec3"><h3 class="Heading">Location Path Expressions</h3><p class="Para" id="Par8">XPath provides <span id="ITerm3">location path expressions</span> for selecting nodes. A <em class="EmphasisTypeItalic ">location path expression</em> locates nodes via a sequence of <em class="EmphasisTypeItalic ">steps</em> starting from the <em class="EmphasisTypeItalic ">context node</em> (the root node or some other document node that鈥檚 the current node). The returned set of nodes, which is known as a <em class="EmphasisTypeItalic ">nodeset</em>, might be empty, or it might contain one or more nodes.</p><p class="Para" id="Par9">The simplest location path expression selects the document鈥檚 root node and consists of a single forward slash character (<span class="EmphasisFontCategoryNonProportional ">/</span>). The next simplest location path expression is the name of an element, which selects all child elements of the context node that have that name. For example, <span class="EmphasisFontCategoryNonProportional ">ingredient</span> refers to all <span class="EmphasisFontCategoryNonProportional ">ingredient</span> child elements of the context node in Listing <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC1"><span class="RefSource">1-1</span></a></span>鈥檚 recipe document. This XPath expression returns a set of three <span class="EmphasisFontCategoryNonProportional ">ingredient</span> nodes when the context node is <span class="EmphasisFontCategoryNonProportional ">ingredients</span>. However, if <span class="EmphasisFontCategoryNonProportional ">recipe</span> or <span class="EmphasisFontCategoryNonProportional ">instructions</span> happened to be the context node, <span class="EmphasisFontCategoryNonProportional ">ingredient</span> wouldn鈥檛 return any nodes (<span class="EmphasisFontCategoryNonProportional ">ingredient</span> is a child of <span class="EmphasisFontCategoryNonProportional ">ingredients</span> only). When an expression starts with a forward slash (<span class="EmphasisFontCategoryNonProportional ">/</span>), the expression represents an absolute path that starts from the root node. For example, expression <span class="EmphasisFontCategoryNonProportional ">/movie</span> selects all <span class="EmphasisFontCategoryNonProportional ">movie</span> child elements of the root node in Listing <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC2"><span class="RefSource">1-2</span></a></span>鈥檚 movie document.</p><p class="Para" id="Par10">Attributes are also handled by location path expressions. To select an element鈥檚 attribute, specify <span class="EmphasisFontCategoryNonProportional ">@</span> followed by the attribute鈥檚 name. For example, <span class="EmphasisFontCategoryNonProportional ">@qty</span> selects the <span class="EmphasisFontCategoryNonProportional ">qty</span> attribute node of the context node.</p><p class="Para" id="Par11">In most cases, you鈥檒l work with root nodes, element nodes, and attribute nodes. However, you might also need to work with namespace nodes, text nodes, processing-instruction nodes, and comment nodes. Unlike namespace nodes, which are typically handled by XSLT, you鈥檒l more likely need to process comments, text, and processing instructions. XPath provides <span class="EmphasisFontCategoryNonProportional ">comment()</span>, <span class="EmphasisFontCategoryNonProportional ">text()</span>, and <span class="EmphasisFontCategoryNonProportional ">processing-instruction()</span> functions for selecting comment, text, and processing-instruction nodes.</p><p class="Para" id="Par12">The <span class="EmphasisFontCategoryNonProportional ">comment()</span> and <span class="EmphasisFontCategoryNonProportional ">text()</span> functions don鈥檛 require arguments because comment and text nodes don鈥檛 have names. Each comment is a separate comment node, and each text node specifies the longest run of text not interrupted by a tag. The <span class="EmphasisFontCategoryNonProportional ">processing-instruction()</span> function may be called with an argument that identifies the target of the processing instruction. If called with no argument, all of the context node鈥檚 processing-instruction child nodes are selected.</p><div class="Para" id="Par13">XPath provides three <span id="ITerm4">wildcards</span><span id="ITerm5">
                  
                  
                </span> for selecting unknown nodes:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par14"><span class="EmphasisFontCategoryNonProportional ">*</span> matches any element node regardless of the node鈥檚 type. It doesn鈥檛 match attributes, text nodes, comments, or processing-instruction nodes. When you place a namespace prefix before the <span class="EmphasisFontCategoryNonProportional ">*</span>, only elements belonging to that namespace are matched.</p></li><li><p class="Para" id="Par15"><span class="EmphasisFontCategoryNonProportional ">node()</span> is a function that matches all nodes.</p></li><li><p class="Para" id="Par16"><span class="EmphasisFontCategoryNonProportional ">@*</span> matches all attribute nodes.</p></li></ul></div></div><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar3"><h3 class="Heading">Note</h3><p class="Para" id="Par17">XPath lets you perform multiple selections by using the vertical bar (<span class="EmphasisFontCategoryNonProportional ">|</span>). For example, <span class="EmphasisFontCategoryNonProportional ">author/*|publisher/*</span> selects the children of <span class="EmphasisFontCategoryNonProportional ">author</span> and the children of <span class="EmphasisFontCategoryNonProportional ">publisher</span>, and <span class="EmphasisFontCategoryNonProportional ">*|@*</span> matches all elements and attributes, but doesn鈥檛 match text, comment, or processing-instruction nodes.</p></div><p class="Para" id="Par18">XPath lets you combine steps into <em class="EmphasisTypeItalic ">compound paths</em> by using the <span class="EmphasisFontCategoryNonProportional ">/</span> character to separate them. For paths beginning with <span class="EmphasisFontCategoryNonProportional ">/</span>, the first path step is relative to the root node; otherwise, the first path step is relative to another context node. For example, <span class="EmphasisFontCategoryNonProportional ">/movie/name</span> starts with the root node, selects all <span class="EmphasisFontCategoryNonProportional ">movie</span> element children of the root node, and selects all <span class="EmphasisFontCategoryNonProportional ">name</span> children of the selected <span class="EmphasisFontCategoryNonProportional ">movie</span> nodes. If you wanted to return all text nodes of the selected <span class="EmphasisFontCategoryNonProportional ">name</span> elements, you would specify <span class="EmphasisFontCategoryNonProportional ">/movie/name/text()</span>.</p><p class="Para" id="Par19"><span id="ITerm6">Compound paths</span> can include <span class="EmphasisFontCategoryNonProportional ">//</span> to select nodes from all descendants of the context node (including the context node). When placed at the start of an expression, <span class="EmphasisFontCategoryNonProportional ">//</span> selects nodes from the entire tree. For example, <span class="EmphasisFontCategoryNonProportional ">//ingredient</span> selects all <span class="EmphasisFontCategoryNonProportional ">ingredient</span> nodes in the tree.</p><p class="Para" id="Par20">As with file systems that let you identify the current directory with a single period (<span class="EmphasisFontCategoryNonProportional ">.</span>) and its parent directory with a double period (<span class="EmphasisFontCategoryNonProportional ">..</span>), you can specify a single period to represent the current node and a double period to represent the parent of the current node. (You would typically use a single period in XSLT to indicate that you want to access the value of the currently matched element.)</p><p class="Para" id="Par21">It might be necessary to narrow the selection of nodes returned by an XPath expression. For example, expression <span class="EmphasisFontCategoryNonProportional ">/recipe/ingredients/ingredient</span> returns all <span class="EmphasisFontCategoryNonProportional ">ingredient</span> nodes, but perhaps you only want to return the first <span class="EmphasisFontCategoryNonProportional ">ingredient</span> node. You can narrow the selection by including predicates in the location path.</p><p class="Para" id="Par22">A <span id="ITerm7">
                  <em class="EmphasisTypeItalic ">predicate</em>
                  
                </span> is a <span id="ITerm8">square bracket-delimited Boolean expression</span> that鈥檚 tested against each selected node. If the expression evaluates to <span class="EmphasisFontCategoryNonProportional ">true</span>, that node is included in the set of nodes returned by the XPath expression; otherwise, the node isn鈥檛 included in the set. For example, <span class="EmphasisFontCategoryNonProportional ">/recipe/ingredients/ingredient[1]</span> selects the first <span class="EmphasisFontCategoryNonProportional ">ingredient</span> element that鈥檚 a child of the <span class="EmphasisFontCategoryNonProportional ">ingredients</span> element.</p><div class="Para" id="Par23">Predicates can include predefined functions (such as <span class="EmphasisFontCategoryNonProportional ">last()</span> and <span class="EmphasisFontCategoryNonProportional ">position()</span>), operators (such as <span class="EmphasisFontCategoryNonProportional ">-</span>, <span class="EmphasisFontCategoryNonProportional ">&lt;</span>, and <span class="EmphasisFontCategoryNonProportional ">=</span>), and other items. Consider the following <span id="ITerm9">examples</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par24"><span class="EmphasisFontCategoryNonProportional ">/recipe/ingredients/ingredient[last()]</span> selects the last <span class="EmphasisFontCategoryNonProportional ">ingredient</span> element that鈥檚 a child of the <span class="EmphasisFontCategoryNonProportional ">ingredients</span> element.</p></li><li><p class="Para" id="Par25"><span class="EmphasisFontCategoryNonProportional ">/recipe/ingredients/ingredient[last() - 1]</span> selects the next-to-last <span class="EmphasisFontCategoryNonProportional ">ingredient</span> element that鈥檚 a child of the <span class="EmphasisFontCategoryNonProportional ">ingredients</span> element.</p></li><li><p class="Para" id="Par26"><span class="EmphasisFontCategoryNonProportional ">/recipe/ingredients/ingredient[position() &lt; 3]</span> selects the first two <span class="EmphasisFontCategoryNonProportional ">ingredient</span> elements that are children of the <span class="EmphasisFontCategoryNonProportional ">ingredients</span> element.</p></li><li><p class="Para" id="Par27"><span class="EmphasisFontCategoryNonProportional ">//ingredient[@qty]</span> selects all <span class="EmphasisFontCategoryNonProportional ">ingredient</span> elements (no matter where they鈥檙e located) that have <span class="EmphasisFontCategoryNonProportional ">qty</span> attributes.</p></li><li><p class="Para" id="Par28"><span class="EmphasisFontCategoryNonProportional ">//ingredient[@qty=&apos;1&apos;]</span> or <span class="EmphasisFontCategoryNonProportional ">//ingredient[@qty=&quot;1&quot;]</span> selects all <span class="EmphasisFontCategoryNonProportional ">ingredient</span> elements (no matter where they鈥檙e located) that have <span class="EmphasisFontCategoryNonProportional ">qty</span> attributes with value <span class="EmphasisFontCategoryNonProportional ">1</span>.</p></li></ul></div></div><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar4"><h3 class="Heading">Note</h3><p class="Para" id="Par29">XPath predefines several functions for use with nodesets: <span class="EmphasisFontCategoryNonProportional ">last()</span> returns a number identifying the last node, <span class="EmphasisFontCategoryNonProportional ">position()</span> returns a number identifying a node鈥檚 position, <span class="EmphasisFontCategoryNonProportional ">count()</span> returns the number of nodes in its nodeset argument, <span class="EmphasisFontCategoryNonProportional ">id()</span> selects elements by their unique IDs and returns a nodeset of these elements, <span class="EmphasisFontCategoryNonProportional ">local-name()</span> returns the local part of the qualified name of the first node in its nodeset argument, <span class="EmphasisFontCategoryNonProportional ">namespace-uri()</span> returns the namespace part of the qualified name of the first node in its nodeset argument, and <span class="EmphasisFontCategoryNonProportional ">name()</span> returns the qualified name of the first node in its nodeset argument.</p></div><p class="Para" id="Par30">Although predicates are supposed to be Boolean expressions, the predicate might not evaluate to a Boolean value. For example, it could evaluate to a number or a string鈥擷Path supports Boolean, number (IEEE 754 double precision floating-point values), and string expression types as well as a location path expression鈥檚 nodeset type. If a predicate evaluates to a number, XPath converts that number to <span class="EmphasisFontCategoryNonProportional ">true</span> when it equals the context node鈥檚 position; otherwise, XPath converts that number to <span class="EmphasisFontCategoryNonProportional ">false</span>. If a predicate evaluates to a string, XPath converts that string to <span class="EmphasisFontCategoryNonProportional ">true</span> when the string isn鈥檛 empty; otherwise, XPath converts that string to <span class="EmphasisFontCategoryNonProportional ">false</span>. Finally, if a predicate evaluates to a nodeset, XPath converts that nodeset to <span class="EmphasisFontCategoryNonProportional ">true</span> when the nodeset is nonempty; otherwise, XPath converts that nodeset to <span class="EmphasisFontCategoryNonProportional ">false</span>.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar5"><h3 class="Heading">Note</h3><p class="Para" id="Par31">The previously presented location path expression examples demonstrate XPath鈥檚 abbreviated syntax. However, XPath also supports an unabbreviated syntax that鈥檚 more descriptive of what鈥檚 happening and is based on an <em class="EmphasisTypeItalic ">axis specifier</em>, which indicates the navigation direction within the XML document鈥檚 tree representation. For example, where <span class="EmphasisFontCategoryNonProportional ">/movie/name</span> selects all <span class="EmphasisFontCategoryNonProportional ">movie</span> child elements of the root node followed by all <span class="EmphasisFontCategoryNonProportional ">name</span> child elements of the <span class="EmphasisFontCategoryNonProportional ">movie</span> elements using the abbreviated syntax, <span class="EmphasisFontCategoryNonProportional ">/child::movie/child::name</span> accomplishes the same task with the expanded syntax. Check out Wikipedia鈥檚 鈥淴Path鈥?entry (<span class="ExternalRef"><a href="https://en.wikipedia.org/wiki/XPath"><span class="RefSource">
                      <span class="EmphasisFontCategoryNonProportional ">https://en.wikipedia.org/wiki/XPath</span>
                    </span></a></span>) for more information.</p></div></section><section class="Section2 RenderAsSection2" id="Sec4"><h3 class="Heading">General Expressions</h3><p class="Para" id="Par32">Location path expressions (which return nodesets) are one kind of XPath expression. XPath also supports <span id="ITerm10">general expressions</span> that evaluate to Boolean (such as predicates), number, or string type; for example, <span class="EmphasisFontCategoryNonProportional ">position() = 2</span>, <span class="EmphasisFontCategoryNonProportional ">6.8</span>, and <span class="EmphasisFontCategoryNonProportional ">Hello</span>. General expressions are often used in XSLT.</p><div class="Para" id="Par33">XPath Boolean values can be compared via relational operators <span class="EmphasisFontCategoryNonProportional ">&lt;</span>, <span class="EmphasisFontCategoryNonProportional ">&lt;=</span>, <span class="EmphasisFontCategoryNonProportional ">&gt;</span>, <span class="EmphasisFontCategoryNonProportional ">&gt;=</span>, <span class="EmphasisFontCategoryNonProportional ">=</span>, and <span class="EmphasisFontCategoryNonProportional ">!=</span> . Boolean expressions can be combined by using operators <span class="EmphasisFontCategoryNonProportional ">and</span> and <span class="EmphasisFontCategoryNonProportional ">or</span>. Also, XPath predefines the following <span id="ITerm11">Boolean functions</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par34"><span class="EmphasisFontCategoryNonProportional ">boolean()</span> returns a Boolean value for a number, string, or nodeset.</p></li><li><p class="Para" id="Par35"><span class="EmphasisFontCategoryNonProportional ">not()</span> returns <span class="EmphasisFontCategoryNonProportional ">true</span> when its Boolean argument is <span class="EmphasisFontCategoryNonProportional ">false</span> and vice versa.</p></li><li><p class="Para" id="Par36"><span class="EmphasisFontCategoryNonProportional ">true()</span> returns <span class="EmphasisFontCategoryNonProportional ">true</span>.</p></li><li><p class="Para" id="Par37"><span class="EmphasisFontCategoryNonProportional ">false()</span> returns <span class="EmphasisFontCategoryNonProportional ">false</span>.</p></li><li><p class="Para" id="Par38"><span class="EmphasisFontCategoryNonProportional ">lang()</span> returns <span class="EmphasisFontCategoryNonProportional ">true</span> or <span class="EmphasisFontCategoryNonProportional ">false</span> depending on whether the language of the context node (as specified by <span class="EmphasisFontCategoryNonProportional ">xml:lang</span> attributes) is the same as or is a sublanguage of the language specified by the argument string.</p></li></ul></div></div><div class="Para" id="Par39">XPath numeric values can be manipulated via operators <span class="EmphasisFontCategoryNonProportional ">+</span>, <span class="EmphasisFontCategoryNonProportional ">-</span>, <span class="EmphasisFontCategoryNonProportional ">*</span>, <span class="EmphasisFontCategoryNonProportional ">div</span>, and <span class="EmphasisFontCategoryNonProportional ">mod</span> (remainder)鈥攆orward slash cannot be used for division because it鈥檚 used to separate location steps. All five operators behave like their Java language counterparts. XPath also predefines the following <span id="ITerm12">numeric functions</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par40"><span class="EmphasisFontCategoryNonProportional ">number()</span> converts its argument to a number.</p></li><li><p class="Para" id="Par41"><span class="EmphasisFontCategoryNonProportional ">sum()</span> returns the sum of the numeric values represented by the nodes in its nodeset argument.</p></li><li><p class="Para" id="Par42"><span class="EmphasisFontCategoryNonProportional ">floor()</span> returns the largest (closest to positive infinity) number that鈥檚 not greater than its number argument and that鈥檚 an integer.</p></li><li><p class="Para" id="Par43"><span class="EmphasisFontCategoryNonProportional ">ceiling()</span> returns the smallest (closest to negative infinity) number that鈥檚 not less than its number argument and that鈥檚 an integer.</p></li><li><p class="Para" id="Par44"><span class="EmphasisFontCategoryNonProportional ">round()</span> returns the number that鈥檚 closest to the argument and that鈥檚 an integer. When there are two such numbers, the one closest to positive infinity is returned.</p></li></ul></div></div><div class="Para" id="Par45">XPath strings are ordered character sequences that are enclosed in single quotes or double quotes. A string literal cannot contain the same kind of quote that鈥檚 also used to delimit the string. For example, a string that contains a single quote cannot be delimited with single quotes. XPath provides the <span class="EmphasisFontCategoryNonProportional ">=</span> and <span class="EmphasisFontCategoryNonProportional ">!=</span> operators for comparing strings. XPath also predefines the following <span id="ITerm13">string functions</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par46"><span class="EmphasisFontCategoryNonProportional ">string()</span> converts its argument to a string.</p></li><li><p class="Para" id="Par47"><span class="EmphasisFontCategoryNonProportional ">concat()</span> returns a concatenation of its string arguments.</p></li><li><p class="Para" id="Par48"><span class="EmphasisFontCategoryNonProportional ">starts-with()</span> returns <span class="EmphasisFontCategoryNonProportional ">true</span> when its first argument string starts with its second argument string (and otherwise returns <span class="EmphasisFontCategoryNonProportional ">false</span>).</p></li><li><p class="Para" id="Par49"><span class="EmphasisFontCategoryNonProportional ">contains()</span> returns <span class="EmphasisFontCategoryNonProportional ">true</span> when its first argument string contains its second argument string (and otherwise returns <span class="EmphasisFontCategoryNonProportional ">false</span>).</p></li><li><p class="Para" id="Par50"><span class="EmphasisFontCategoryNonProportional ">substring-before()</span> returns the substring of its first argument string that precedes the first occurrence of its second argument string in its first argument string or the empty string when its first argument string doesn鈥檛 contain its second argument string.</p></li><li><p class="Para" id="Par51"><span class="EmphasisFontCategoryNonProportional ">substring-after()</span> returns the substring of its first argument string that follows the first occurrence of its second argument string in its first argument string or the empty string when its first argument string doesn鈥檛 contain its second argument string.</p></li><li><p class="Para" id="Par52"><span class="EmphasisFontCategoryNonProportional ">substring()</span> returns the substring of its first (string) argument starting at the position specified in its second (number) argument with length specified in its third (number) argument.</p></li><li><p class="Para" id="Par53"><span class="EmphasisFontCategoryNonProportional ">string-length()</span> returns the number of characters in its string argument (or the length of the context node when converted to a string in the absence of an argument).</p></li><li><p class="Para" id="Par54"><span class="EmphasisFontCategoryNonProportional ">normalize-space()</span> returns the argument string with whitespace normalized by stripping leading and trailing whitespace and replacing sequences of whitespace characters by a single space (or performing the same action on the context node when converted to a string in the absence of an argument).</p></li><li><p class="Para" id="Par55"><span class="EmphasisFontCategoryNonProportional ">translate()</span> returns its first argument string with occurrences of characters in its second argument string replaced by the character at the corresponding position in its third argument <span id="ITerm14">string</span>.</p></li></ul></div></div></section></section><section class="Section1 RenderAsSection1" id="Sec5"><h2 class="Heading">XPath and DOM</h2><p class="Para" id="Par56">Suppose you need <span id="ITerm15">someone</span> in your home to purchase a bag of sugar. You can tell this person to 鈥淧lease buy me some sugar.鈥?Alternatively, you could say the following: 鈥淧lease open the front door. Walk down to the sidewalk. Turn left. Walk up the sidewalk for three blocks. Turn right. Walk up the sidewalk one block. Enter the store. Go to aisle 7. Walk two meters down the aisle. Pick up a bag of sugar. Walk to a checkout counter. Pay for the sugar. Retrace your steps home.鈥?Most people would expect to receive the shorter instruction and would probably have you committed to an institution if you made a habit out of providing the longer set of instructions.</p><div class="Para" id="Par57">Traversing a DOM tree of nodes is similar to providing the longer sequence of instructions. In contrast, XPath lets you traverse this tree via a succinct instruction. To see this difference for yourself, consider a scenario where you have an XML-based contacts document that lists your various professional contacts. Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_5_Chapter.xhtml#PC1">5-1</a></span> presents a trivial example of such a document.<div class="ProgramCode" id="PC1"><div class="LineGroup"><div class="FixedLine">&lt;?xml version=&quot;1.0&quot;?&gt;</div><div class="FixedLine">&lt;contacts&gt;</div><div class="FixedLine">   &lt;contact&gt;</div><div class="FixedLine">      &lt;name&gt;John Doe&lt;/name&gt;</div><div class="FixedLine">      &lt;city&gt;Chicago&lt;/city&gt;</div><div class="FixedLine">      &lt;city&gt;Denver&lt;/city&gt;</div><div class="FixedLine">   &lt;/contact&gt;</div><div class="FixedLine">   &lt;contact&gt;</div><div class="FixedLine">      &lt;name&gt;Jane Doe&lt;/name&gt;</div><div class="FixedLine">      &lt;city&gt;New York&lt;/city&gt;</div><div class="FixedLine">   &lt;/contact&gt;</div><div class="FixedLine">   &lt;contact&gt;</div><div class="FixedLine">      &lt;name&gt;Sandra Smith&lt;/name&gt;</div><div class="FixedLine">      &lt;city&gt;Denver&lt;/city&gt;</div><div class="FixedLine">      &lt;city&gt;Miami&lt;/city&gt;</div><div class="FixedLine">   &lt;/contact&gt;</div><div class="FixedLine">   &lt;contact&gt;</div><div class="FixedLine">     &lt;name&gt;Bob Jones&lt;/name&gt;</div><div class="FixedLine">     &lt;city&gt;Chicago&lt;/city&gt;</div><div class="FixedLine">   &lt;/contact&gt;</div><div class="FixedLine">&lt;/contacts&gt;</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 5-1</span><p class="SimplePara">
                      <span id="ITerm16">XML-Based Contacts Database</span>
                    </p></div></div></div></div><p class="Para" id="Par58">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_5_Chapter.xhtml#PC1">5-1</a></span> reveals a simple XML grammar consisting of a <span class="EmphasisFontCategoryNonProportional ">contacts</span> root element that contains a sequence of <span class="EmphasisFontCategoryNonProportional ">contact</span> elements. Each <span class="EmphasisFontCategoryNonProportional ">contact</span> element contains one <span class="EmphasisFontCategoryNonProportional ">name</span> element and one or more <span class="EmphasisFontCategoryNonProportional ">city</span> elements (various contacts travel frequently and spend a lot of time in each city). (To keep the example simple, I鈥檓 not providing a DTD or a schema.)</p><div class="Para" id="Par59">Suppose you want to locate and output the names of all contacts that live at least part of each year in Chicago. Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_5_Chapter.xhtml#PC2">5-2</a></span> presents the source code to a <span class="EmphasisFontCategoryNonProportional ">DOMSearch</span> application that accomplishes this task with the DOM API.<div class="ProgramCode" id="PC2"><div class="LineGroup"><div class="FixedLine">import java.io.IOException;</div></div><div class="LineGroup"><div class="FixedLine">import java.util.ArrayList;</div><div class="FixedLine">import java.util.List;</div></div><div class="LineGroup"><div class="FixedLine">import javax.xml.parsers.DocumentBuilder;</div><div class="FixedLine">import javax.xml.parsers.DocumentBuilderFactory;</div><div class="FixedLine">import javax.xml.parsers.FactoryConfigurationError;</div><div class="FixedLine">import javax.xml.parsers.ParserConfigurationException;</div></div><div class="LineGroup"><div class="FixedLine">import org.w3c.dom.Document;</div><div class="FixedLine">import org.w3c.dom.Element;</div><div class="FixedLine">import org.w3c.dom.Node;</div><div class="FixedLine">import org.w3c.dom.NodeList;</div></div><div class="LineGroup"><div class="FixedLine">import org.xml.sax.SAXException;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class DOMSearch</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      try</div><div class="FixedLine">      {</div><div class="FixedLine">         DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();</div><div class="FixedLine">         DocumentBuilder db = dbf.newDocumentBuilder();</div><div class="FixedLine">         Document doc = db.parse(&quot;contacts.xml&quot;);</div><div class="FixedLine">         List&lt;String&gt; contactNames = new ArrayList&lt;String&gt;();</div><div class="FixedLine">         NodeList contacts = doc.getElementsByTagName(&quot;contact&quot;);</div><div class="FixedLine">         for (int i = 0; i &lt; contacts.getLength(); i++)</div><div class="FixedLine">         {</div><div class="FixedLine">            Element contact = (Element) contacts.item(i);</div><div class="FixedLine">            NodeList cities = contact.getElementsByTagName(&quot;city&quot;);</div><div class="FixedLine">            boolean chicago = false;</div><div class="FixedLine">            for (int j = 0; j &lt; cities.getLength(); j++)</div><div class="FixedLine">            {</div><div class="FixedLine">               Element city = (Element) cities.item(j); <span id="ITerm17">
                      
                      
                    </span></div><div class="FixedLine">               NodeList children = city.getChildNodes();</div><div class="FixedLine">               StringBuilder sb = new StringBuilder();</div><div class="FixedLine">               for (int k = 0; k &lt; children.getLength(); k++)</div><div class="FixedLine">               {</div><div class="FixedLine">                  Node child = children.item(k);</div><div class="FixedLine">                  if (child.getNodeType() == Node.TEXT_NODE)</div><div class="FixedLine">                     sb.append(child.getNodeValue());</div><div class="FixedLine">               }</div><div class="FixedLine">               if (sb.toString().equals(&quot;Chicago&quot;))</div><div class="FixedLine">               {</div><div class="FixedLine">                  chicago = true;</div><div class="FixedLine">                  break;</div><div class="FixedLine">               }</div><div class="FixedLine">            }</div><div class="FixedLine">            if (chicago)</div><div class="FixedLine">            {</div><div class="FixedLine">               NodeList names = contact.getElementsByTagName(&quot;name&quot;);</div><div class="FixedLine">               contactNames.add(names.item(0). getFirstChild(). getNodeValue());</div><div class="FixedLine">            }</div><div class="FixedLine">         }</div><div class="FixedLine">         for (String contactName: contactNames)</div><div class="FixedLine">            out.println(contactName);</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (IOException ioe)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;IOE: %s%n&quot;, ioe.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (SAXException saxe)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;SAXE: %s%n&quot;, saxe.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (FactoryConfigurationError fce)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;FCE: %s%n&quot;, fce.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (ParserConfigurationException pce)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;PCE: %s%n&quot;, pce.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div><div class="FixedLine">}<span id="ITerm18">
                      
                      
                    </span></div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 5-2</span><p class="SimplePara">Locating Chicago Contacts with the <span id="ITerm19">DOM API</span></p></div></div></div></div><p class="Para" id="Par60">After parsing <span class="EmphasisFontCategoryNonProportional ">contacts.xml</span> and building the DOM tree, <span class="EmphasisFontCategoryNonProportional ">main()</span> uses <span class="EmphasisFontCategoryNonProportional ">Document</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">getElementsByTagName()</span> method<span id="ITerm20">
                
              </span> to return an <span class="EmphasisFontCategoryNonProportional ">org.w3c.dom.NodeList</span> of <span class="EmphasisFontCategoryNonProportional ">contact</span> element nodes. For each member of this list, <span class="EmphasisFontCategoryNonProportional ">main()</span> extracts the <span class="EmphasisFontCategoryNonProportional ">contact</span> element node and uses this node with <span class="EmphasisFontCategoryNonProportional ">getElementsByTagName()</span> to return a <span class="EmphasisFontCategoryNonProportional ">NodeList</span> of the <span class="EmphasisFontCategoryNonProportional ">contact</span> element node鈥檚 <span class="EmphasisFontCategoryNonProportional ">city</span> element nodes.</p><p class="Para" id="Par61">For each member of the <span class="EmphasisFontCategoryNonProportional ">cities</span> list, <span class="EmphasisFontCategoryNonProportional ">main()</span> extracts the <span class="EmphasisFontCategoryNonProportional ">city</span> element node and uses this node with <span class="EmphasisFontCategoryNonProportional ">getElementsByTagName()</span> to return a <span class="EmphasisFontCategoryNonProportional ">NodeList</span> of the <span class="EmphasisFontCategoryNonProportional ">city</span> element node鈥檚 child nodes鈥攖here鈥檚 only a single child text node in this example, but the presence of a comment or processing instruction would increase the number of child nodes. For example, <span class="EmphasisFontCategoryNonProportional ">&lt;city&gt;Chicago&lt;!--The windy city--&gt;&lt;/city&gt;</span> increases the number of child nodes to 2.</p><p class="Para" id="Par62">If the child鈥檚 node type indicates that it鈥檚 a text node, the child node鈥檚 value (obtained via <span class="EmphasisFontCategoryNonProportional ">getNodeValue()</span>) is stored in a string builder鈥攐nly one child node is stored in the string builder in this example. If the builder鈥檚 contents indicate that <span class="EmphasisFontCategoryNonProportional ">Chicago</span> has been found, the <span class="EmphasisFontCategoryNonProportional ">chicago</span> flag is set to <span class="EmphasisFontCategoryNonProportional ">true</span> and execution leaves the <span class="EmphasisFontCategoryNonProportional ">cities</span> loop.</p><p class="Para" id="Par63">If the <span class="EmphasisFontCategoryNonProportional ">chicago</span> flag is set when the <span class="EmphasisFontCategoryNonProportional ">cities</span> loop exits, the current <span class="EmphasisFontCategoryNonProportional ">contact</span> element node鈥檚 <span class="EmphasisFontCategoryNonProportional ">getElementsByTagName()</span> method<span id="ITerm21">
                
              </span> is called to return a <span class="EmphasisFontCategoryNonProportional ">NodeList</span> of the <span class="EmphasisFontCategoryNonProportional ">contact</span> element node鈥檚 <span class="EmphasisFontCategoryNonProportional ">name</span> element nodes (of which there should only be one, and which I could enforce through a DTD or schema). It鈥檚 now a simple matter to extract the first item from this list, call <span class="EmphasisFontCategoryNonProportional ">getFirstChild()</span> on this item to return the text node (I assume that only text appears between <span class="EmphasisFontCategoryNonProportional ">&lt;name&gt;</span> and <span class="EmphasisFontCategoryNonProportional ">&lt;/name&gt;</span>), and call <span class="EmphasisFontCategoryNonProportional ">getNodeValue()</span> on the text node to obtain its value, which is then added to the <span class="EmphasisFontCategoryNonProportional ">contactNames</span> list.</p><div class="Para" id="Par64">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_5_Chapter.xhtml#PC2">5-2</a></span> as follows:<div class="ProgramCode" id="PC3"><div class="LineGroup"><div class="FixedLine">javac DOMSearch.java</div></div></div></div><div class="Para" id="Par65">Run the resulting application as follows:<div class="ProgramCode" id="PC4"><div class="LineGroup"><div class="FixedLine">java DOMSearch</div></div></div></div><div class="Para" id="Par66">You should observe the following output:<div class="ProgramCode" id="PC5"><div class="LineGroup"><div class="FixedLine">John Doe</div><div class="FixedLine">Bob Jones</div></div></div></div><p class="Para" id="Par67">Traversing the DOM鈥檚 tree of nodes is a tedious exercise at best and is error-prone at worst. Fortunately, XPath can greatly simplify this situation.</p><p class="Para" id="Par68">Before writing the XPath equivalent of Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_5_Chapter.xhtml#PC2">5-2</a></span>, it helps to define a location path expression. For this example, that expression is <span class="EmphasisFontCategoryNonProportional ">//contact[city = &quot;Chicago&quot;]/name/text()</span>, which uses a predicate to select all <span class="EmphasisFontCategoryNonProportional ">contact</span> nodes that contain a <span class="EmphasisFontCategoryNonProportional ">Chicago city</span> node, then select all child <span class="EmphasisFontCategoryNonProportional ">name</span> nodes from these <span class="EmphasisFontCategoryNonProportional ">contact</span> nodes, and finally select all child text nodes from these <span class="EmphasisFontCategoryNonProportional ">name</span> nodes.</p><div class="Para" id="Par69">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_5_Chapter.xhtml#PC6">5-3</a></span> presents the source code to an <span class="EmphasisFontCategoryNonProportional ">XPathSearch</span> application that uses this XPath expression and Java鈥檚 XPath API, which consists of various types in the <span class="EmphasisFontCategoryNonProportional ">javax.xml.xpath</span> package, to locate Chicago contacts.<div class="ProgramCode" id="PC6"><div class="LineGroup"><div class="FixedLine">import java.io.IOException;</div></div><div class="LineGroup"><div class="FixedLine">import javax.xml.parsers.DocumentBuilder;</div><div class="FixedLine">import javax.xml.parsers.DocumentBuilderFactory;</div><div class="FixedLine">import javax.xml.parsers.FactoryConfigurationError;</div><div class="FixedLine">import javax.xml.parsers.ParserConfigurationException;</div></div><div class="LineGroup"><div class="FixedLine">import javax.xml.xpath.XPath;</div><div class="FixedLine">import javax.xml.xpath.XPathConstants;</div><div class="FixedLine">import javax.xml.xpath.XPathException;</div><div class="FixedLine">import javax.xml.xpath.XPathExpression;</div><div class="FixedLine">import javax.xml.xpath.XPathFactory;</div></div><div class="LineGroup"><div class="FixedLine">import org.w3c.dom.Document;</div><div class="FixedLine">import org.w3c.dom.NodeList;</div></div><div class="LineGroup"><div class="FixedLine">import org.xml.sax.SAXException;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class XPathSearch</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args) <span id="ITerm22">
                      
                      
                    </span></div><div class="FixedLine">   {</div><div class="FixedLine">      try</div><div class="FixedLine">      {</div><div class="FixedLine">         DocumentBuilderFactory dbf =</div><div class="FixedLine">            DocumentBuilderFactory.newInstance();</div><div class="FixedLine">         DocumentBuilder db = dbf.newDocumentBuilder();</div><div class="FixedLine">         Document doc = db.parse(&quot;contacts.xml&quot;);</div><div class="FixedLine">         XPathFactory xpf = XPathFactory.newInstance();</div><div class="FixedLine">         XPath xp = xpf.newXPath();</div><div class="FixedLine">         XPathExpression xpe;</div><div class="FixedLine">         xpe = xp.compile(&quot;//contact[city = &apos;Chicago&apos;]/&quot; +</div><div class="FixedLine">                          &quot;name/text()&quot;);</div><div class="FixedLine">         Object result =</div><div class="FixedLine">            xpe.evaluate(doc, XPathConstants.NODESET);</div><div class="FixedLine">         NodeList nl = (NodeList) result;</div><div class="FixedLine">         for (int i = 0; i &lt; nl.getLength(); i++)</div><div class="FixedLine">            out.println(nl.item(i).getNodeValue());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (IOException ioe)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;IOE: %s%n&quot;, ioe.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (SAXException saxe)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;SAXE: %s%n&quot;, saxe.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (FactoryConfigurationError fce)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;FCE: %s%n&quot;, fce.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (ParserConfigurationException pce)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;PCE: %s%n&quot;, pce.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (XPathException xpe)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;XPE: %s%n&quot;, xpe.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div><div class="FixedLine">}<span id="ITerm23">
                      
                      
                    </span></div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 5-3</span><p class="SimplePara">Locating Chicago Contacts with the <span id="ITerm24">XPath API</span></p></div></div></div></div><p class="Para" id="Par70">After parsing <span class="EmphasisFontCategoryNonProportional ">contacts.xml</span> and building the DOM tree, <span class="EmphasisFontCategoryNonProportional ">main()</span> instantiates <span class="EmphasisFontCategoryNonProportional ">javax.xml.xpath.XPathFactory</span> by calling its <span class="EmphasisFontCategoryNonProportional ">XPathFactory newInstance()</span> method<span id="ITerm25">
                
              </span>. The resulting <span class="EmphasisFontCategoryNonProportional ">XPathFactory</span> instance can be used to set features (such as secure processing, to process XML documents securely) by calling its <span class="EmphasisFontCategoryNonProportional ">void setFeature(String name, boolean value)</span> method, create a <span class="EmphasisFontCategoryNonProportional ">javax.xml.xpath.XPath</span> object by calling its <span class="EmphasisFontCategoryNonProportional ">XPath newXPath()</span> method, and more.</p><p class="Para" id="Par71"><span class="EmphasisFontCategoryNonProportional ">XPath</span> declares an <span class="EmphasisFontCategoryNonProportional ">XPathExpression compile(String expression)</span> method for compiling the specified <span class="EmphasisFontCategoryNonProportional ">expression</span> (an XPath expression) and returning the compiled expression as an instance of a class that implements the <span class="EmphasisFontCategoryNonProportional ">javax.xml.xpath.XPathExpression</span> interface. This method throws <span class="EmphasisFontCategoryNonProportional ">javax.xml.xpath.XPathExpressionException</span> (a subclass of <span class="EmphasisFontCategoryNonProportional ">javax.xml.xpath.XPathException</span>) when the expression cannot be compiled.</p><p class="Para" id="Par72"><span class="EmphasisFontCategoryNonProportional ">XPath</span> also declares several overloaded <span class="EmphasisFontCategoryNonProportional ">evaluate()</span> methods for immediately evaluating an expression and returning the result. Because it can take time to evaluate an expression, you might choose to compile a complex expression first (to boost performance) when you plan to evaluate this expression many times.</p><p class="Para" id="Par73">After compiling the expression, <span class="EmphasisFontCategoryNonProportional ">main()</span> calls <span class="EmphasisFontCategoryNonProportional ">XPathExpression</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">Object evaluate(Object item, QName returnType)</span> method to evaluate the expression. The first argument is the context node for the expression, which happens to be a <span class="EmphasisFontCategoryNonProportional ">Document</span> instance in the example. The second argument specifies the kind of object returned by <span class="EmphasisFontCategoryNonProportional ">evaluate()</span> and is set to <span class="EmphasisFontCategoryNonProportional ">javax.xml.xpath.XPathConstants.NODESET</span>, a qualified name for the XPath 1.0 nodeset type, which is implemented via DOM鈥檚 <span class="EmphasisFontCategoryNonProportional ">NodeList</span> interface.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar6"><h3 class="Heading">Note</h3><p class="Para" id="Par74">The XPath API maps XPath鈥檚 Boolean, number, string, and nodeset types to Java鈥檚 <span class="EmphasisFontCategoryNonProportional ">java.lang.Boolean</span>, <span class="EmphasisFontCategoryNonProportional ">java.lang.Double</span>, <span class="EmphasisFontCategoryNonProportional ">java.lang.String</span>, and <span class="EmphasisFontCategoryNonProportional ">NodeList</span> types, respectively. When calling an <span class="EmphasisFontCategoryNonProportional ">evaluate()</span> method, you specify XPath types via <span class="EmphasisFontCategoryNonProportional ">XPathConstants</span> constants (<span class="EmphasisFontCategoryNonProportional ">BOOLEAN</span>, <span class="EmphasisFontCategoryNonProportional ">NUMBER</span>, <span class="EmphasisFontCategoryNonProportional ">STRING</span>, and <span class="EmphasisFontCategoryNonProportional ">NODESET</span>), and the method takes care of returning an object of the appropriate type. <span class="EmphasisFontCategoryNonProportional ">XPathConstants</span> also declares a <span class="EmphasisFontCategoryNonProportional ">NODE</span> constant, which doesn鈥檛 map to a Java type. Instead, it鈥檚 used to tell <span class="EmphasisFontCategoryNonProportional ">evaluate()</span> that you only want the resulting nodeset to contain a single node.</p></div><p class="Para" id="Par75">After casting <span class="EmphasisFontCategoryNonProportional ">Object</span> to <span class="EmphasisFontCategoryNonProportional ">NodeList</span>, <span class="EmphasisFontCategoryNonProportional ">main()</span> uses this interface鈥檚 <span class="EmphasisFontCategoryNonProportional ">getLength()</span> and <span class="EmphasisFontCategoryNonProportional ">item()</span> methods to traverse the nodelist. For each item in this list, <span class="EmphasisFontCategoryNonProportional ">getNodeValue()</span> is called to return the node鈥檚 value, which is subsequently output.</p><div class="Para" id="Par76">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_5_Chapter.xhtml#PC6">5-3</a></span> as follows:<div class="ProgramCode" id="PC7"><div class="LineGroup"><div class="FixedLine">javac XPathSearch.java</div></div></div></div><div class="Para" id="Par77">Run the resulting application as follows:<div class="ProgramCode" id="PC8"><div class="LineGroup"><div class="FixedLine">java XPathSearch</div></div></div></div><div class="Para" id="Par78">You should observe the following output:<div class="ProgramCode" id="PC9"><div class="LineGroup"><div class="FixedLine">John Doe</div><div class="FixedLine">Bob Jones</div></div></div></div></section><section class="Section1 RenderAsSection1" id="Sec6"><h2 class="Heading">Advanced XPath</h2><p class="Para" id="Par79">The XPath API provides <span id="ITerm26">three</span> advanced features to overcome limitations with the XPath 1.0 language. These features are namespace contexts, extension functions and function resolvers, and variables and variable resolvers.</p><section class="Section2 RenderAsSection2" id="Sec7"><h3 class="Heading">Namespace Contexts</h3><p class="Para" id="Par80">When an XML document鈥檚 elements belong to a <span id="ITerm27">namespace</span> (including the default namespace), any XPath expression that queries the document must account for this namespace. For nondefault namespaces, the expression doesn鈥檛 need to use the same namespace prefix; it only needs to use the same URI. However, when a document specifies the default namespace, the expression must use a prefix even though the document doesn鈥檛 use a prefix.</p><p class="Para" id="Par81">To appreciate this situation, suppose Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_5_Chapter.xhtml#PC1">5-1</a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">&lt;contacts&gt;</span> tag was declared as follows to introduce a default namespace: <span class="EmphasisFontCategoryNonProportional ">&lt;contacts xmlns=&quot;</span><span class="ExternalRef"><a href="http://www.javajeff.ca/"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://www.javajeff.ca/</span>
                  </span></a></span><span class="EmphasisFontCategoryNonProportional ">&quot;&gt;</span>. Furthermore, suppose that Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_5_Chapter.xhtml#PC6">5-3</a></span> included <span class="EmphasisFontCategoryNonProportional ">dbf.setNamespaceAware(true);</span> after the line that instantiates <span class="EmphasisFontCategoryNonProportional ">DocumentBuilderFactory</span>. If you were to run the revised <span class="EmphasisFontCategoryNonProportional ">XPathSearch</span> application against the revised <span class="EmphasisFontCategoryNonProportional ">contacts.xml</span> file, you wouldn鈥檛 see any output.</p><div class="Para" id="Par82">You can correct this problem by implementing <span class="EmphasisFontCategoryNonProportional ">javax.xml.namespace.NamespaceContext</span> to map an arbitrary prefix to the namespace URI and then registering this namespace context with the <span class="EmphasisFontCategoryNonProportional ">XPath</span> instance. Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_5_Chapter.xhtml#PC10">5-4</a></span> presents a minimal implementation of the <span class="EmphasisFontCategoryNonProportional ">NamespaceContext</span> interface<span id="ITerm28">
                  
                </span><span id="ITerm29">
                  
                  
                </span>.<div class="ProgramCode" id="PC10"><div class="LineGroup"><div class="FixedLine">import java.util.Iterator;</div></div><div class="LineGroup"><div class="FixedLine">import javax.xml.XMLConstants;</div></div><div class="LineGroup"><div class="FixedLine">import javax.xml.namespace.NamespaceContext;</div></div><div class="LineGroup"><div class="FixedLine">public class NSContext implements NamespaceContext</div><div class="FixedLine">{</div><div class="FixedLine">   @Override</div><div class="FixedLine">   public String getNamespaceURI(String prefix)</div><div class="FixedLine">   {</div><div class="FixedLine">      if (prefix == null)</div><div class="FixedLine">         throw new</div><div class="FixedLine">            IllegalArgumentException(&quot;prefix is null&quot;);</div><div class="FixedLine">      else</div><div class="FixedLine">      if (prefix.equals(&quot;tt&quot;))</div><div class="FixedLine">         return &quot;http://www.javajeff.ca/&quot;;</div><div class="FixedLine">      else</div><div class="FixedLine">         return null;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public String getPrefix(String uri)</div><div class="FixedLine">   {</div><div class="FixedLine">      return null;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public Iterator&lt;String&gt; getPrefixes(String uri)</div><div class="FixedLine">   {</div><div class="FixedLine">      return null;</div><div class="FixedLine">   }</div><div class="FixedLine">}<span id="ITerm30">
                        
                      </span><span id="ITerm31">
                        
                        
                      </span></div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 5-4</span><p class="SimplePara">Minimally Implementing <span id="ITerm32">
                          <span class="EmphasisFontCategoryNonProportional ">NamespaceContext</span>
                          
                        </span><span id="ITerm33">
                          
                          
                        </span></p></div></div></div></div><p class="Para" id="Par83">The <span class="EmphasisFontCategoryNonProportional ">getNamespaceURI()</span> method<span id="ITerm34">
                  
                </span> is passed a <span class="EmphasisFontCategoryNonProportional ">prefix</span> argument that must be mapped to a URI. When this argument is <span class="EmphasisFontCategoryNonProportional ">null</span>, a <span class="EmphasisFontCategoryNonProportional ">java.lang.IllegalArgumentException</span> object must be thrown (according to the Java documentation). When the argument is the desired prefix value, the namespace URI is returned.</p><p class="Para" id="Par84">After instantiating the <span class="EmphasisFontCategoryNonProportional ">XPath</span> class, you would instantiate <span class="EmphasisFontCategoryNonProportional ">NSContext</span> and register this object with the <span class="EmphasisFontCategoryNonProportional ">XPath</span> object by calling <span class="EmphasisFontCategoryNonProportional ">XPath</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">void setNamespaceContext(NamespaceContext nsContext)</span> method. For example, you would specify <span class="EmphasisFontCategoryNonProportional ">xp.setNamespaceContext(new NSContext());</span> after <span class="EmphasisFontCategoryNonProportional ">XPath xp = xpf.newXPath();</span> to register the <span class="EmphasisFontCategoryNonProportional ">NSContext</span> object with <span class="EmphasisFontCategoryNonProportional ">xp</span>.</p><p class="Para" id="Par85">All that鈥檚 left to accomplish is to apply the prefix to the XPath expression, which now becomes <span class="EmphasisFontCategoryNonProportional ">//tt:contact[tt:city=&apos;Chicago&apos;]/tt:name/text()</span> because the <span class="EmphasisFontCategoryNonProportional ">contact</span>, <span class="EmphasisFontCategoryNonProportional ">city</span>, and <span class="EmphasisFontCategoryNonProportional ">name</span> elements are now part of the default namespace, whose URI is mapped to arbitrary prefix <span class="EmphasisFontCategoryNonProportional ">tt</span> in the <span class="EmphasisFontCategoryNonProportional ">NSContext</span> instance鈥檚 <span class="EmphasisFontCategoryNonProportional ">getNamespaceURI()</span> method.</p><p class="Para" id="Par86">Compile and run the revised <span class="EmphasisFontCategoryNonProportional ">XPathSearch</span> application and you鈥檒l see <span class="EmphasisFontCategoryNonProportional ">John Doe</span> followed by <span class="EmphasisFontCategoryNonProportional ">Bob Jones</span> on separate <span id="ITerm35">lines</span><span id="ITerm36">
                  
                </span>.</p></section><section class="Section2 RenderAsSection2" id="Sec8"><h3 class="Heading">Extension Functions and Function Resolvers</h3><p class="Para" id="Par87">The XPath API lets you define functions (via Java methods) that extend XPath鈥檚 predefined function repertoire by offering new features not already provided. These Java methods cannot have side effects because XPath functions can be evaluated multiple times and in any order. Furthermore, they cannot override predefined functions; a Java method with the same name as a predefined <span id="ITerm37">function</span><span id="ITerm38">
                  
                  
                </span> is never executed.</p><div class="Para" id="Par88">Suppose you modify Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_5_Chapter.xhtml#PC1">5-1</a></span>鈥檚 XML document to include a <span class="EmphasisFontCategoryNonProportional ">birth</span> element that records a contact鈥檚 date of birth information in YYYY-MM-DD format. Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_5_Chapter.xhtml#PC11">5-5</a></span> shows the resulting XML file.<div class="ProgramCode" id="PC11"><div class="LineGroup"><div class="FixedLine">&lt;?xml version=&quot;1.0&quot;?&gt;</div><div class="FixedLine">&lt;contacts xmlns=&quot;http://www.javajeff.ca/&quot;&gt;</div><div class="FixedLine">   &lt;contact&gt;</div><div class="FixedLine">      &lt;name&gt;John Doe&lt;/name&gt;</div><div class="FixedLine">      &lt;birth&gt;1953-01-02&lt;/birth&gt;</div><div class="FixedLine">      &lt;city&gt;Chicago&lt;/city&gt;</div><div class="FixedLine">      &lt;city&gt;Denver&lt;/city&gt;</div><div class="FixedLine">   &lt;/contact&gt;</div><div class="FixedLine">   &lt;contact&gt;</div><div class="FixedLine">      &lt;name&gt;Jane Doe&lt;/name&gt;</div><div class="FixedLine">      &lt;birth&gt;1965-07-12&lt;/birth&gt;</div><div class="FixedLine">      &lt;city&gt;New York&lt;/city&gt;</div><div class="FixedLine">   &lt;/contact&gt;</div><div class="FixedLine">   &lt;contact&gt;</div><div class="FixedLine">      &lt;name&gt;Sandra Smith&lt;/name&gt;</div><div class="FixedLine">      &lt;birth&gt;1976-11-22&lt;/birth&gt;</div><div class="FixedLine">      &lt;city&gt;Denver&lt;/city&gt;</div><div class="FixedLine">      &lt;city&gt;Miami&lt;/city&gt;</div><div class="FixedLine">   &lt;/contact&gt;</div><div class="FixedLine">   &lt;contact&gt;</div><div class="FixedLine">      &lt;name&gt;Bob Jones&lt;/name&gt;</div><div class="FixedLine">      &lt;birth&gt;1958-03-14&lt;/birth&gt;</div><div class="FixedLine">      &lt;city&gt;Chicago&lt;/city&gt;</div><div class="FixedLine">   &lt;/contact&gt;</div><div class="FixedLine">&lt;/contacts&gt;</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 5-5</span><p class="SimplePara"><span id="ITerm39">XML-Based Contacts Database</span> with Birth Information</p></div></div></div></div><div class="Para" id="Par89">Now suppose that you want to select contacts based on birth information. For example, you only want to select contacts whose date of birth is greater than <span class="EmphasisFontCategoryNonProportional ">1960-01-01</span>. Because XPath doesn鈥檛 provide this function for you, you decide to declare a <span class="EmphasisFontCategoryNonProportional ">date()</span> extension function. Your first step is to declare a <span class="EmphasisFontCategoryNonProportional ">Date</span> class that implements the <span class="EmphasisFontCategoryNonProportional ">javax.xml.xpath.XPathFunction</span> interface鈥攕ee Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_5_Chapter.xhtml#PC12">5-6</a></span>.<div class="ProgramCode" id="PC12"><div class="LineGroup"><div class="FixedLine">import java.text.ParsePosition;</div><div class="FixedLine">import java.text.SimpleDateFormat;</div></div><div class="LineGroup"><div class="FixedLine">import java.util.List;</div></div><div class="LineGroup"><div class="FixedLine">import javax.xml.xpath.XPathFunction;</div><div class="FixedLine">import javax.xml.xpath.XPathFunctionException;</div></div><div class="LineGroup"><div class="FixedLine">import org.w3c.dom.Node;</div><div class="FixedLine">import org.w3c.dom.NodeList;</div></div><div class="LineGroup"><div class="FixedLine">public class Date implements XPathFunction</div><div class="FixedLine">{</div><div class="FixedLine">   private final static ParsePosition POS = new ParsePosition(0);</div></div><div class="LineGroup"><div class="FixedLine">   private SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-mm-dd&quot;);</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public Object evaluate(List args)</div><div class="FixedLine">      throws XPathFunctionException</div><div class="FixedLine">   {</div><div class="FixedLine">      if (args.size() != 1)</div><div class="FixedLine">         throw new XPathFunctionException(&quot;Invalid &quot; + &quot;number of &quot; + &quot;arguments&quot;);</div><div class="FixedLine">      String value;</div><div class="FixedLine">      Object o = args.get(0);</div><div class="FixedLine">      if (o instanceof NodeList)</div><div class="FixedLine">      {</div><div class="FixedLine">         NodeList list = (NodeList) o;</div><div class="FixedLine">         value = list.item(0).getTextContent();</div><div class="FixedLine">      }</div><div class="FixedLine">      else</div><div class="FixedLine">      if (o instanceof String)</div><div class="FixedLine">         value = (String) o;</div><div class="FixedLine">      else</div><div class="FixedLine">         throw new XPathFunctionException(&quot;Cannot &quot; + &quot;convert &quot; + &quot;argument &quot; + &quot;type&quot;);</div><div class="FixedLine">      POS.setIndex(0);</div><div class="FixedLine">      return sdf.parse(value, POS).getTime();<span id="ITerm40">
                        
                        
                      </span><span id="ITerm41">
                        
                      </span></div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 5-6</span><p class="SimplePara">An <span id="ITerm42">Extension Function</span><span id="ITerm43">
                          
                          
                        </span> for Returning a Date as a Milliseconds Value</p></div></div></div></div><p class="Para" id="Par90"><span class="EmphasisFontCategoryNonProportional ">XPathFunction</span> declares a single <span class="EmphasisFontCategoryNonProportional ">Object evaluate(List args)</span> method that XPath calls when it needs to execute the extension function. <span class="EmphasisFontCategoryNonProportional ">evaluate()</span> is passed a <span class="EmphasisFontCategoryNonProportional ">java.util.List</span> of objects that describe the arguments that were passed to the extension function by the XPath evaluator. Furthermore, this method returns a value of a type appropriate to the extension function (<span class="EmphasisFontCategoryNonProportional ">date()</span>鈥檚 long integer return type is compatible with XPath鈥檚 number type).</p><p class="Para" id="Par91">The <span class="EmphasisFontCategoryNonProportional ">date()</span> extension <span id="ITerm44">function</span><span id="ITerm45">
                  
                  
                </span><span id="ITerm46">
                  
                </span> is intended to be called with a single argument, which is either of type nodeset or of type string. This extension function throws <span class="EmphasisFontCategoryNonProportional ">javax.xml.xpath.XPathFunctionException</span> when the number of arguments (as indicated by the list鈥檚 size) isn鈥檛 equal to 1.</p><p class="Para" id="Par92">When the argument is of type <span class="EmphasisFontCategoryNonProportional ">NodeList</span> (a nodeset), the textual content of the first node in the nodeset is obtained; this content is assumed to be a date value in YYYY-MM-DD format (for brevity, I鈥檓 overlooking error checking). When the argument is of type <span class="EmphasisFontCategoryNonProportional ">String</span>, it鈥檚 assumed to be a date value in this format. Any other type of argument results in a thrown <span class="EmphasisFontCategoryNonProportional ">XPathFunctionException</span> object.</p><p class="Para" id="Par93">Date comparison is simplified by converting the date to a milliseconds value. This task is accomplished with the help of the <span class="EmphasisFontCategoryNonProportional ">java.text.SimpleDateFormat</span> and <span class="EmphasisFontCategoryNonProportional ">java.text.ParsePosition</span> classes. After resetting the <span class="EmphasisFontCategoryNonProportional ">ParsePosition</span> object鈥檚 index (via <span class="EmphasisFontCategoryNonProportional ">setIndex(0)</span>), <span class="EmphasisFontCategoryNonProportional ">SimpleDateFormat</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">Date parse(String text, ParsePosition pos)</span> method is called to parse the string according to the pattern established when <span class="EmphasisFontCategoryNonProportional ">SimpleDateFormat</span> was instantiated, and starting from the parse position identified by the <span class="EmphasisFontCategoryNonProportional ">ParsePosition</span> index. This index is reset before the <span class="EmphasisFontCategoryNonProportional ">parse()</span> method call because <span class="EmphasisFontCategoryNonProportional ">parse()</span> updates this object鈥檚 index.</p><p class="Para" id="Par94">The <span class="EmphasisFontCategoryNonProportional ">parse()</span> method<span id="ITerm47">
                  
                </span> returns a <span class="EmphasisFontCategoryNonProportional ">java.util.Date</span> object whose <span class="EmphasisFontCategoryNonProportional ">long getTime()</span> method<span id="ITerm48">
                  
                </span> is called to return the number of milliseconds represented by the parsed date.</p><div class="Para" id="Par95">After implementing the <span id="ITerm49">extension function</span><span id="ITerm50">
                  
                  
                </span>, you need to create a <em class="EmphasisTypeItalic ">function resolver</em>, which is an object whose class implements the <span class="EmphasisFontCategoryNonProportional ">javax.xml.xpath.XPathFunctionResolver</span> interface and which tells the XPath evaluator about the extension function (or functions). Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_5_Chapter.xhtml#PC13">5-7</a></span> presents the <span class="EmphasisFontCategoryNonProportional ">DateResolver</span> class.<div class="ProgramCode" id="PC13"><div class="LineGroup"><div class="FixedLine">import javax.xml.namespace.QName;</div></div><div class="LineGroup"><div class="FixedLine">import javax.xml.xpath.XPathFunction;</div><div class="FixedLine">import javax.xml.xpath.XPathFunctionResolver;</div></div><div class="LineGroup"><div class="FixedLine">public class DateResolver implements XPathFunctionResolver</div><div class="FixedLine">{</div><div class="FixedLine">   private static final QName name =</div><div class="FixedLine">      new QName(&quot;http://www.javajeff.ca/&quot;, &quot;date&quot;, &quot;tt&quot;);</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public XPathFunction resolveFunction(QName name, int arity)</div><div class="FixedLine">   {</div><div class="FixedLine">      if (name.equals(this.name) &amp;&amp; arity == 1)</div><div class="FixedLine">         return new Date();</div><div class="FixedLine">      return null;</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 5-7</span><p class="SimplePara">A <span id="ITerm51">Function Resolver</span> for the <span class="EmphasisFontCategoryNonProportional ">date()</span> Extension <span id="ITerm52">Function</span></p></div></div></div></div><p class="Para" id="Par96"><span class="EmphasisFontCategoryNonProportional ">XPathFunctionResolver</span><span id="ITerm53">
                  
                </span> declares a single <span class="EmphasisFontCategoryNonProportional ">XPathFunction resolveFunction(QName functionName, int arity)</span> method that XPath calls to identify the name of the extension function and obtain an instance of a Java object whose <span class="EmphasisFontCategoryNonProportional ">evaluate()</span> method implements the function.</p><p class="Para" id="Par97">The <span class="EmphasisFontCategoryNonProportional ">functionName</span> parameter identifies the function鈥檚 qualified name because all extension functions must live in a namespace and must be referenced via a prefix (which doesn鈥檛 have to match the prefix in the document). As a result, you must also bind a namespace to the prefix via a namespace context (as demonstrated previously). The <span class="EmphasisFontCategoryNonProportional ">arity</span> parameter identifies the number of arguments that the extension function accepts and is useful when overloading extension functions. If the <span class="EmphasisFontCategoryNonProportional ">functionName</span> and <span class="EmphasisFontCategoryNonProportional ">arity</span> values are acceptable, the extension function鈥檚 Java class is instantiated and returned; otherwise, <span class="EmphasisFontCategoryNonProportional ">null</span> is returned.</p><p class="Para" id="Par98">Finally, the function resolver class is instantiated and registered with the XPath object by calling <span class="EmphasisFontCategoryNonProportional ">XPath</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">void setXPathFunctionResolver(XPathFunctionResolver resolver)</span> method<span id="ITerm54">
                  
                  
                </span><span id="ITerm55">
                  
                </span>.</p><div class="Para" id="Par99">The following excerpt from Version 3 of this chapter鈥檚 <span class="EmphasisFontCategoryNonProportional ">XPathSearch</span> application (in this book鈥檚 code archive) demonstrates all of these tasks in order to use <span class="EmphasisFontCategoryNonProportional ">date()</span> in XPath expression <span class="EmphasisFontCategoryNonProportional ">//tt:contact[tt:date(tt:birth) &gt; tt:date(&apos;1960-01-01&apos;)]/tt:name/text()</span>, which returns only those contacts whose date of birth is greater than 1960-01-01 (<span class="EmphasisFontCategoryNonProportional ">Jane Doe</span> followed by <span class="EmphasisFontCategoryNonProportional ">Sandra Smith</span>):<div class="ProgramCode" id="PC14"><div class="LineGroup"><div class="FixedLine">DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();</div><div class="FixedLine">dbf.setNamespaceAware(true);</div><div class="FixedLine">DocumentBuilder db = dbf.newDocumentBuilder();</div><div class="FixedLine">Document doc = db.parse(&quot;contacts.xml&quot;);</div><div class="FixedLine">XPathFactory xpf = XPathFactory.newInstance();</div><div class="FixedLine">XPath xp = xpf.newXPath();</div><div class="FixedLine">xp.setNamespaceContext(new NSContext());</div><div class="FixedLine">xp.setXPathFunctionResolver(new DateResolver());</div><div class="FixedLine">XPathExpression xpe;</div><div class="FixedLine">String expr;</div><div class="FixedLine">expr = &quot;//tt:contact[tt:date(tt:birth) &gt; &quot; +</div><div class="FixedLine">       &quot;tt:date(&apos;1960-01-01&apos;)]/tt:name/text()&quot;;</div><div class="FixedLine">xpe = xp.compile(expr);</div><div class="FixedLine">Object result = xpe.evaluate(doc, XPathConstants.NODESET);</div><div class="FixedLine">NodeList nl = (NodeList) result;</div><div class="FixedLine">for (int i = 0; i &lt; nl.getLength(); i++)</div><div class="FixedLine">   out.println(nl.item(i).getNodeValue());</div></div></div></div><p class="Para" id="Par100">Compile and run the revised <span class="EmphasisFontCategoryNonProportional ">XPathSearch</span> application and you鈥檒l see <span class="EmphasisFontCategoryNonProportional ">Jane Doe</span> followed by <span class="EmphasisFontCategoryNonProportional ">Sandra Smith</span> on separate lines. <span id="ITerm56">
                  
                  
                </span><span id="ITerm57">
                  
                  
                </span><span id="ITerm58">
                  
                </span><span id="ITerm59">
                  
                </span></p></section><section class="Section2 RenderAsSection2" id="Sec9"><h3 class="Heading">Variables and Variable Resolvers</h3><p class="Para" id="Par101">All of the previously specified XPath expressions have been based on literal text. XPath also lets you specify variables to parameterize these expressions in a similar manner to using variables with SQL prepared <span id="ITerm60">statements</span>.</p><div class="Para" id="Par102">A <span id="ITerm61">variable</span> appears in an expression by prefixing its name (which may or may not have a namespace prefix) with a <span class="EmphasisFontCategoryNonProportional ">$</span>. For example, <span class="EmphasisFontCategoryNonProportional ">/a/b[@c = $d]/text()</span> is an XPath expression that selects all <span class="EmphasisFontCategoryNonProportional ">a</span> elements of the root node, and all of <span class="EmphasisFontCategoryNonProportional ">a</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">b</span> elements that have <span class="EmphasisFontCategoryNonProportional ">c</span> attributes containing the value identified by variable <span class="EmphasisFontCategoryNonProportional ">$d</span>, and returns the text of these <span class="EmphasisFontCategoryNonProportional ">b</span> elements. This expression corresponds to Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_5_Chapter.xhtml#PC15">5-8</a></span>鈥檚 XML document.<div class="ProgramCode" id="PC15"><div class="LineGroup"><div class="FixedLine">&lt;?xml version=&quot;1.0&quot;?&gt;</div><div class="FixedLine">&lt;a&gt;</div><div class="FixedLine">   &lt;b c=&quot;x&quot;&gt;b1&lt;/b&gt;</div><div class="FixedLine">   &lt;b&gt;b2&lt;/b&gt;</div><div class="FixedLine">   &lt;b c=&quot;y&quot;&gt;b3&lt;/b&gt;</div><div class="FixedLine">   &lt;b&gt;b4&lt;/b&gt;</div><div class="FixedLine">   &lt;b c=&quot;x&quot;&gt;b5&lt;/b&gt;</div><div class="FixedLine">&lt;/a&gt;</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 5-8</span><p class="SimplePara">A Simple XML Document for Demonstrating an XPath <span id="ITerm62">Variable</span></p></div></div></div></div><p class="Para" id="Par103">To specify variables whose values are obtained during expression evaluation, you must register a variable resolver with your <span class="EmphasisFontCategoryNonProportional ">XPath</span> object. A <span id="ITerm63">
                  <em class="EmphasisTypeItalic ">variable resolver</em>
                  
                  
                </span> is an instance of a class that implements the <span class="EmphasisFontCategoryNonProportional ">javax.xml.xpath.XPathVariableResolver</span> interface in terms of its <span class="EmphasisFontCategoryNonProportional ">Object resolveVariable(QName variableName)</span> method and which tells the evaluator about the variable (or variables).</p><p class="Para" id="Par104">The <span class="EmphasisFontCategoryNonProportional ">variableName</span> parameter contains the qualified name of a variable鈥檚 name. (Remember that a variable name may be prefixed with a namespace prefix.) This method verifies that the qualified name appropriately names the variable and then returns its value.</p><p class="Para" id="Par105">After creating the <span id="ITerm64">variable resolver</span><span id="ITerm65">
                  
                </span>, you register it with the <span class="EmphasisFontCategoryNonProportional ">XPath</span> object by calling <span class="EmphasisFontCategoryNonProportional ">XPath</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">void setXPathVariableResolver(XPathVariableResolver resolver)</span> method.</p><div class="Para" id="Par106">The following excerpt from Version 4 of this chapter鈥檚 <span class="EmphasisFontCategoryNonProportional ">XPathSearch</span> application (in this book鈥檚 code archive) demonstrates all of these tasks in order to specify <span class="EmphasisFontCategoryNonProportional ">$d</span> in XPath expression <span class="EmphasisFontCategoryNonProportional ">/a/b[@c=$d]/text()</span>, which returns <span class="EmphasisFontCategoryNonProportional ">b1</span> followed by <span class="EmphasisFontCategoryNonProportional ">b5</span>. It assumes that Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_5_Chapter.xhtml#PC15">5-8</a></span> is stored in a file named <span class="EmphasisFontCategoryNonProportional ">example.xml</span>:<div class="ProgramCode" id="PC16"><div class="LineGroup"><div class="FixedLine">DocumentBuilderFactory dbf =</div><div class="FixedLine">   DocumentBuilderFactory.newInstance();</div><div class="FixedLine">DocumentBuilder db = dbf.newDocumentBuilder();</div><div class="FixedLine">Document doc = db.parse(&quot;example.xml&quot;);</div><div class="FixedLine">XPathFactory xpf = XPathFactory.newInstance();</div><div class="FixedLine">XPath xp = xpf.newXPath();</div><div class="FixedLine">XPathVariableResolver xpvr =</div><div class="FixedLine">   new XPathVariableResolver()</div><div class="FixedLine">   {</div><div class="FixedLine">      @Override</div><div class="FixedLine">      public Object resolveVariable(QName varname)</div><div class="FixedLine">      {</div><div class="FixedLine">         if (varname.getLocalPart().equals(&quot;d&quot;))</div><div class="FixedLine">            return &quot;x&quot;;</div><div class="FixedLine">         else</div><div class="FixedLine">            return null;</div><div class="FixedLine">      }</div><div class="FixedLine">   };</div><div class="FixedLine">xp.setXPathVariableResolver(xpvr);</div><div class="FixedLine">XPathExpression xpe;</div><div class="FixedLine">xpe = xp.compile(&quot;/a/b[@c = $d]/text()&quot;);</div><div class="FixedLine">Object result = xpe.evaluate(doc, XPathConstants.NODESET);</div><div class="FixedLine">NodeList nl = (NodeList) result;</div><div class="FixedLine">for (int i = 0; i &lt; nl.getLength(); i++)</div><div class="FixedLine">   out.println(nl.item(i).getNodeValue());</div></div></div></div><p class="Para" id="Par107">Compile and run the revised <span class="EmphasisFontCategoryNonProportional ">XPathSearch</span> application and you鈥檒l see <span class="EmphasisFontCategoryNonProportional ">b1</span> followed by <span class="EmphasisFontCategoryNonProportional ">b5</span> on separate <span id="ITerm66">lines</span><span id="ITerm67">
                  
                  
                </span><span id="ITerm68">
                  
                </span>.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar7"><h3 class="Heading">Caution</h3><p class="Para" id="Par108">When you qualify a variable name with a namespace prefix (as in <span class="EmphasisFontCategoryNonProportional ">$ns:d</span>), you must also register a namespace context to resolve the prefix.</p></div><div class="FormalPara FormalParaRenderingStyle3 ParaTypeOverview" id="FPar8"><h3 class="Heading">Exercises</h3><div class="Para" id="Par109">The following exercises are designed to test your understanding of Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_5_Chapter.xhtml"><span class="RefSource">5</span></a></span>鈥檚 content:<div class="OrderedList"><ol><li class="ListItem"><span class="ItemNumber">1.</span><div class="ItemContent"><p class="Para" id="Par110">Define XPath.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">2.</span><div class="ItemContent"><p class="Para" id="Par111">Where is XPath commonly used?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">3.</span><div class="ItemContent"><p class="Para" id="Par112">Identify the seven kinds of nodes that XPath recognizes.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">4.</span><div class="ItemContent"><p class="Para" id="Par113">True or false: XPath recognizes CDATA sections.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">5.</span><div class="ItemContent"><p class="Para" id="Par114">Describe what XPath provides for selecting nodes.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">6.</span><div class="ItemContent"><p class="Para" id="Par115">True or false: In a location path expression, you must prefix an attribute name with the <span class="EmphasisFontCategoryNonProportional ">@</span> symbol.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">7.</span><div class="ItemContent"><p class="Para" id="Par116">Identify the functions that XPath provides for selecting comment, text, and processing-instruction nodes.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">8.</span><div class="ItemContent"><p class="Para" id="Par117">What does XPath provide for selecting unknown nodes?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">9.</span><div class="ItemContent"><p class="Para" id="Par118">How do you perform multiple selections?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">10.</span><div class="ItemContent"><p class="Para" id="Par119">What is a predicate?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">11.</span><div class="ItemContent"><p class="Para" id="Par120">Identify the functions that XPath provides for working with nodesets.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">12.</span><div class="ItemContent"><p class="Para" id="Par121">Identify the three advanced features that the XPath API provides to overcome limitations with the XPath 1.0 language.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">13.</span><div class="ItemContent"><p class="Para" id="Par122">True or false: The XPath API maps XPath鈥檚 number type to <span class="EmphasisFontCategoryNonProportional ">java.lang.Float</span>.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">14.</span><div class="ItemContent"><p class="Para" id="Par123">Modify Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_5_Chapter.xhtml#PC1">5-1</a></span>鈥檚 contacts document by changing <span class="EmphasisFontCategoryNonProportional ">&lt;name&gt;John Doe&lt;/name&gt;</span> to <span class="EmphasisFontCategoryNonProportional ">&lt;Name&gt;John Doe&lt;/Name&gt;</span>. Because you no longer see <span class="EmphasisFontCategoryNonProportional ">John Doe</span> in the output when you run Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_5_Chapter.xhtml#PC6">5-3</a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">XPathSearch</span> application (you only see <span class="EmphasisFontCategoryNonProportional ">Bob Jones</span>), modify this application鈥檚 location path expression so that you see <span class="EmphasisFontCategoryNonProportional ">John Doe</span> followed by <span class="EmphasisFontCategoryNonProportional ">Bob Jones</span>.</p></div><div class="ClearBoth"> </div></li></ol></div></div></div></section></section><section class="Section1 RenderAsSection1" id="Sec10"><h2 class="Heading">Summary</h2><p class="Para" id="Par124">XPath is a nonXML declarative query language for selecting an XML document鈥檚 infoset items as one or more nodes. It simplifies access to a DOM tree鈥檚 nodes and is also useful with XSLT where it鈥檚 typically employed to select those input document elements (via XPath expressions) that are to be copied to an output document.</p><p class="Para" id="Par125">XPath regards an XML document as a tree of nodes that starts from a root node. This language recognizes seven kinds of nodes: element, attribute, text, namespace, processing instruction, comment, and document. It doesn鈥檛 recognize CDATA sections, entity references, or document type declarations.</p><p class="Para" id="Par126">XPath provides location path expressions for selecting nodes. A location path expression locates nodes via a sequence of steps starting from the context node (the root node or some other document node that鈥檚 the current node). The returned set of nodes, which is known as a nodeset, might be empty, or it might contain one or more nodes.</p><p class="Para" id="Par127">Location path expressions (which return nodesets) are one kind of XPath expression. XPath also supports general expressions that evaluate to Boolean (such as predicates), number, or string type; for example, <span class="EmphasisFontCategoryNonProportional ">position() = 2</span>, <span class="EmphasisFontCategoryNonProportional ">6.8</span>, and <span class="EmphasisFontCategoryNonProportional ">Hello</span>. General expressions are often used in XSLT.</p><p class="Para" id="Par128">The XPath API provides advanced features to overcome limitations with the XPath 1.0 language: namespace contexts (which map arbitrary namespace prefixes to namespace URIs), extension functions and function resolvers (for defining functions that extend XPath鈥檚 predefined function repertoire), and variables and variable resolvers (for parameterizing XPath expressions).</p><p class="Para" id="Par129">Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_6_Chapter.xhtml"><span class="RefSource">6</span></a></span> introduces you to XSLT for transforming XML documents.</p></section></div><div class="annotator-outer annotator-viewer viewer annotator-hide"> </div></div></div>
    </section>
  </div>
</div>
<div class="font-flyout" style="top: 200.984px; left: 2474px;"> </div>
<hr/>

<!--if IE]><![endif]--><!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/java-xml-and/9781484243305/html/394211_2_En_6_Chapter.xhtml"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="3866890"
  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"
  data-username="levinxccai"
  data-account-type="B2B"
  
  data-activated-trial-date="11/06/2017"


  data-archive="9781484243305"
  data-publishers="Apress"



  data-htmlfile-name="394211_2_En_6_Chapter.xhtml"
  data-epub-title="Java XML and JSON: Document Processing for Java SE" data-debug=0 data-testing=0><![endif]--><!--if gt IE 8]><!--><!--![endif]-->



<a name="7_"></a>

<div class="application" id="container" style="height: auto;">
  <div class="js-toc">
    <section role="document">
      <div id="sbo-rt-content" style="max-width:72.5em; transform: none;"><div class="annotator-wrapper"><!--egin Abstract--><div class="MainTitleSection"><h1 class="ChapterTitle" lang="en">6. Transforming XML Documents with XSLT</h1></div><div class="AuthorGroup"><div class="AuthorNames"><span class="Author"><span class="AuthorName">Jeff Friesen</span><sup><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_6_Chapter.xhtml#Aff2">1</a> <span class="ContactIcon"></span></sup></span></div><div class="Affiliations"><div class="Affiliation" id="Aff2"><span class="AffiliationNumber">(1)</span><div class="AffiliationText">Dauphin, MB, Canada</div></div><div class="ClearBoth"> </div></div></div><!--nd Abstract--><div class="Fulltext"><p class="Para" id="Par2">Along with SAX, DOM, StAX, and XPath, Java includes the XSLT API, for transforming XML documents. Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_6_Chapter.xhtml"><span class="RefSource">6</span></a></span> introduces you to XSLT.</p><section class="Section1 RenderAsSection1" id="Sec1"><h2 class="Heading">What Is XSLT?</h2><p class="Para" id="Par3"><em class="EmphasisTypeItalic ">Extensible Stylesheet Language</em> (<em class="EmphasisTypeItalic ">XSL</em>) is a family of <span id="ITerm1">languages</span> for transforming and formatting XML documents. <em class="EmphasisTypeItalic ">XSL Transformation</em><span id="ITerm2">
                
              </span> (<em class="EmphasisTypeItalic ">XSLT</em>) is the XSL language for transforming XML documents to other formats, such as HTML (for presenting an XML document鈥檚 content via a web browser).</p><div class="Para" id="Par4">XSLT accomplishes its work by using XSLT processors and stylesheets. An <span id="ITerm3">
                <em class="EmphasisTypeItalic ">XSLT processor</em>
                
              </span> is a software component that applies an <em class="EmphasisTypeItalic ">XSLT stylesheet</em> (an XML-based template consisting of content and transformation instructions) to an input document (without modifying the document) and copies the transformed result to a result tree, which can be output to a file or output stream or even piped into another XSLT processor for additional transformations. Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_6_Chapter.xhtml#Fig1">6-1</a></span> illustrates the transformation process.<figure class="Figure" id="Fig1"><div class="MediaObject" id="MO1"><img alt="../images/394211_2_En_6_Chapter/394211_2_En_6_Fig1_HTML.png" data-mfp-src="/library/view/java-xml-and/9781484243305/images/394211_2_En_6_Chapter/394211_2_En_6_Fig1_HTML.png" height="354" src="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/images/394211_2_En_6_Chapter/394211_2_En_6_Fig1_HTML.png" style="height:8.85em" width="1496"/></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 6-1</span><p class="SimplePara">An <span id="ITerm4">XSLT processor</span> transforms an XML input document into a result tree</p></div></figcaption></figure></div><p class="Para" id="Par5">The beauty of XSLT is that you don鈥檛 need to develop custom software applications to perform the transformations. Instead, you simply create an XSLT stylesheet and input it along with the XML document needing to be transformed to an XSLT processor.</p></section><section class="Section1 RenderAsSection1" id="Sec2"><h2 class="Heading">Exploring the XSLT API</h2><p class="Para" id="Par6">Java implements XSLT through the types in the <span class="EmphasisFontCategoryNonProportional ">javax.xml.transform</span>, <span class="EmphasisFontCategoryNonProportional ">javax.xml.transform.dom</span>, <span class="EmphasisFontCategoryNonProportional ">javax.xml.transform.sax</span>, <span class="EmphasisFontCategoryNonProportional ">javax.xml.transform.stax</span>, and <span class="EmphasisFontCategoryNonProportional ">javax.xml.transform.stream</span> packages. The <span class="EmphasisFontCategoryNonProportional ">javax.xml.transform</span> package defines the generic <span id="ITerm5">APIs</span> for processing transformation instructions and for performing a transformation from a <em class="EmphasisTypeItalic ">source</em> (where the XSLT processor鈥檚 input originates) to a <em class="EmphasisTypeItalic ">result</em> (where the processor鈥檚 output is sent). The remaining packages define the APIs for obtaining different kinds of sources and results.</p><div class="Para" id="Par7">The <span class="EmphasisFontCategoryNonProportional ">javax.xml.transform.TransformerFactory</span> class<span id="ITerm6">
                
              </span> is the starting point for working with XSLT. You instantiate <span class="EmphasisFontCategoryNonProportional ">TransformerFactory</span> by calling one of its <span class="EmphasisFontCategoryNonProportional ">newInstance()</span> methods<span id="ITerm7">
                
              </span>. For example, the following code fragment uses <span class="EmphasisFontCategoryNonProportional ">TransformerFactory</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">TransformerFactory newInstance()</span> class method to create the factory:<div class="ProgramCode" id="PC1"><div class="LineGroup"><div class="FixedLine">TransformerFactory tf = TransformerFactory.newInstance();</div></div></div></div><p class="Para" id="Par8">Behind the scenes, <span class="EmphasisFontCategoryNonProportional ">newInstance()</span> follows an ordered lookup procedure to identify the <span class="EmphasisFontCategoryNonProportional ">TransformerFactory</span> implementation class to load. This procedure first examines the <span class="EmphasisFontCategoryNonProportional ">javax.xml.transform.TransformerFactory</span> system property and lastly returns the system-default implementation (returned from <span class="EmphasisFontCategoryNonProportional ">TransformerFactory newDefaultInstance()</span>). If there is a service configuration error, or if the <span id="ITerm8">implementation</span> is not available or cannot be instantiated, this method throws an instance of the <span class="EmphasisFontCategoryNonProportional ">javax.xml.stream.TransformerFactoryConfigurationError</span> class.</p><p class="Para" id="Par9">After obtaining a <span class="EmphasisFontCategoryNonProportional ">TransformerFactory</span> object, you can call various configuration methods to configure the factory. For example, you could call <span class="EmphasisFontCategoryNonProportional ">TransformerFactory</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">void setFeature(String name, boolean value)</span> method to enable a feature (such as secure processing, to transform XML documents securely).</p><div class="Para" id="Par10">Following the factory鈥檚 configuration, call one of its <span class="EmphasisFontCategoryNonProportional ">newTransformer()</span> methods<span id="ITerm9">
                
              </span> to create and return instances of the <span class="EmphasisFontCategoryNonProportional ">javax.xml.transform.Transformer</span> class. The following code fragment calls <span class="EmphasisFontCategoryNonProportional ">Transformer newTransformer()</span> to accomplish this task:<div class="ProgramCode" id="PC2"><div class="LineGroup"><div class="FixedLine">Transformer t = tf.newTransformer();</div></div></div></div><p class="Para" id="Par11">The noargument <span class="EmphasisFontCategoryNonProportional ">newTransformer()</span> method <span id="ITerm10">copies</span> source input to the destination without making any changes. This kind of transformation is known as the <span id="ITerm11">
                <em class="EmphasisTypeItalic ">identity transformation</em>
                
              </span>.</p><div class="Para" id="Par12">To change input, specify a <em class="EmphasisTypeItalic ">stylesheet</em>. Accomplish this task by calling the factory鈥檚 <span class="EmphasisFontCategoryNonProportional ">Transformer newTransformer(Source source)</span> method, where the <span class="EmphasisFontCategoryNonProportional ">javax.xml.transform.Source</span> interface describes a source for the stylesheet. The following code fragment accomplishes this task:<div class="ProgramCode" id="PC3"><div class="LineGroup"><div class="FixedLine">FileReader fr = new FileReader(&quot;recipe.xsl&quot;);</div><div class="FixedLine">Transformer t = tf.newTransformer(new StreamSource(fr));</div></div></div></div><p class="Para" id="Par13">This code fragment creates a transformer that obtains a stylesheet from a file named <span class="EmphasisFontCategoryNonProportional ">recipe.xsl</span> via a <span class="EmphasisFontCategoryNonProportional ">javax.xml.transform.stream.StreamSource</span> object connected to a file reader. It鈥檚 customary to use the <span class="EmphasisFontCategoryNonProportional ">.xsl</span> or <span class="EmphasisFontCategoryNonProportional ">.xslt</span> extension to identify XSLT stylesheet files.</p><p class="Para" id="Par14">The <span class="EmphasisFontCategoryNonProportional ">newTransformer()</span> methods<span id="ITerm12">
                
              </span> throw <span class="EmphasisFontCategoryNonProportional ">javax.xml.transform.TransformerConfigurationException</span> when they cannot return a <span class="EmphasisFontCategoryNonProportional ">Transformer</span> instance that corresponds to the factory configuration.</p><p class="Para" id="Par15">After obtaining a <span class="EmphasisFontCategoryNonProportional ">Transformer</span> instance, you can call its <span class="EmphasisFontCategoryNonProportional ">void setOutputProperty(String name, String value)</span> method to influence a transformation. The <span class="EmphasisFontCategoryNonProportional ">javax.xml.transform.OutputKeys</span> class declares <span id="ITerm13">constants</span> for frequently used keys. For example, <span id="ITerm14">
                <span class="EmphasisFontCategoryNonProportional ">OutputKeys.METHOD</span>
                
              </span> is the key for specifying the method for outputting the result tree (as XML, HTML, plain text, or something else).</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar1"><h3 class="Heading">Tip</h3><p class="Para" id="Par16">To set multiple properties in a single method call, create a <span class="EmphasisFontCategoryNonProportional ">java.util.Properties</span> object and pass this object as an argument to <span class="EmphasisFontCategoryNonProportional ">Transformer</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">void setOutputProperties(Properties prop)</span> method. Properties set by <span class="EmphasisFontCategoryNonProportional ">setOutputProperty()</span> and <span class="EmphasisFontCategoryNonProportional ">setOutputProperties()</span> override the stylesheet鈥檚 <span class="EmphasisFontCategoryNonProportional ">xsl:output</span> instruction settings.</p></div><p class="Para" id="Par17">Before you can perform a transformation, you need to obtain instances of classes that implement the <span class="EmphasisFontCategoryNonProportional ">Source</span> and <span class="EmphasisFontCategoryNonProportional ">javax.xml.transform.Result</span> interfaces. You then pass these instances to <span class="EmphasisFontCategoryNonProportional ">Transformer</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">void transform(Source xmlSource, Result outputTarget)</span> method, which throws an instance of the <span class="EmphasisFontCategoryNonProportional ">javax.xml.transform.TransformerException</span> class<span id="ITerm15">
                
                
              </span> when a problem arises during the transformation.</p><div class="Para" id="Par18">The following code fragment shows you how to obtain a source and a result and perform the transformation:<div class="ProgramCode" id="PC4"><div class="LineGroup"><div class="FixedLine">Source source = new DOMSource(doc);</div><div class="FixedLine">Result result = new StreamResult(System.out);</div><div class="FixedLine">t.transform(source, result);</div></div></div></div><p class="Para" id="Par19">The first line instantiates the <span class="EmphasisFontCategoryNonProportional ">javax.xml.transform.dom.DOMSource</span> class, which acts as a holder for a DOM tree rooted in the <span class="EmphasisFontCategoryNonProportional ">org.w3c.dom.Document</span> object specified by <span class="EmphasisFontCategoryNonProportional ">doc</span>. The second line instantiates the <span class="EmphasisFontCategoryNonProportional ">javax.xml.transform.stream.StreamResult</span> class, which acts as a holder for the standard output stream, to which the transformed data items are <span id="ITerm16">sent</span>. The third line reads data from the <span class="EmphasisFontCategoryNonProportional ">Source</span> object and outputs transformed data to the <span class="EmphasisFontCategoryNonProportional ">Result</span> object.</p><div class="FormalPara FormalParaRenderingStyle3 ParaTypeOverview" id="FPar2"><h3 class="Heading">Transformer Factory Feature Detection</h3><p class="Para" id="Par20">Although Java鈥檚 default transformers support the various <span class="EmphasisFontCategoryNonProportional ">Source</span> and <span class="EmphasisFontCategoryNonProportional ">Result</span> implementation classes that are located in the <span class="EmphasisFontCategoryNonProportional ">javax.xml.transform.dom</span>, <span class="EmphasisFontCategoryNonProportional ">javax.xml.transform.sax</span>, <span class="EmphasisFontCategoryNonProportional ">javax.xml.transform.stax</span>, and <span class="EmphasisFontCategoryNonProportional ">javax.xml.transform.stream</span> packages, a nondefault transformer (perhaps specified via the <span class="EmphasisFontCategoryNonProportional ">javax.xml.transform.TransformerFactory</span> system property) might be more limited. For this reason, each <span class="EmphasisFontCategoryNonProportional ">Source</span> and <span class="EmphasisFontCategoryNonProportional ">Result</span> implementation class declares a <span class="EmphasisFontCategoryNonProportional ">FEATURE</span> string constant that can be passed to <span class="EmphasisFontCategoryNonProportional ">TransformerFactory</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">boolean getFeature(String name)</span> method. This method returns <span class="EmphasisFontCategoryNonProportional ">true</span> when the <span class="EmphasisFontCategoryNonProportional ">Source</span> or <span class="EmphasisFontCategoryNonProportional ">Result</span> implementation class is supported. For example, <span class="EmphasisFontCategoryNonProportional ">tf.getFeature(StreamSource.FEATURE)</span> returns <span class="EmphasisFontCategoryNonProportional ">true</span> when stream sources are supported.</p><p class="Para" id="Par21">The <span class="EmphasisFontCategoryNonProportional ">javax.xml.transform.sax.SAXTransformerFactory</span> class provides additional SAX-specific factory methods that can be used only when the <span class="EmphasisFontCategoryNonProportional ">TransformerFactory</span> object is also an instance of this class. To help you make the determination, <span class="EmphasisFontCategoryNonProportional ">SAXTransformerFactory</span> also declares a <span class="EmphasisFontCategoryNonProportional ">FEATURE</span> string constant that you can pass to <span class="EmphasisFontCategoryNonProportional ">getFeature()</span>. For example, <span class="EmphasisFontCategoryNonProportional ">tf.getFeature(SAXTransformerFactory.FEATURE)</span> returns <span class="EmphasisFontCategoryNonProportional ">true</span> when the transformer factory referenced from <span class="EmphasisFontCategoryNonProportional ">tf</span> is an instance of <span class="EmphasisFontCategoryNonProportional ">SAXTransformerFactory</span>.</p></div><p class="Para" id="Par22">Most of Java鈥檚 XML API interface objects and the factories that return them are not thread-safe. This situation also applies to <span id="ITerm17">transformers</span>. Although you can reuse the same transformer multiple times on the same thread, you cannot access the transformer from multiple threads.</p><p class="Para" id="Par23">This problem can be solved for transformers by using instances of classes that implement the <span class="EmphasisFontCategoryNonProportional ">javax.xml.transform.Templates</span> interface. The Java documentation for this interface has this to say: <em class="EmphasisTypeItalic ">Templates must be threadsafe for a given instance over multiple threads running concurrently, and may be used multiple times in a given session.</em> As well as promoting thread safety, <span class="EmphasisFontCategoryNonProportional ">Templates</span> instances can improve performance because they represent compiled XSLT stylesheets.</p><div class="Para" id="Par24">The following code fragment shows how you might perform a transformation without a <span class="EmphasisFontCategoryNonProportional ">Templates</span> object:<div class="ProgramCode" id="PC5"><div class="LineGroup"><div class="FixedLine">TransformerFactory tf = TransformerFactory.newInstance();</div><div class="FixedLine">FileReader fr = new FileReader(&quot;recipe.xsl&quot;);</div><div class="FixedLine">StreamSource ssStyleSheet = new StreamSource(fr);</div><div class="FixedLine">Transformer t = tf.newTransformer(ssStyleSheet);</div><div class="FixedLine">t.transform(new DOMSource(doc), new StreamResult(System.out));</div></div></div></div><div class="Para" id="Par25">You cannot access <span class="EmphasisFontCategoryNonProportional ">t</span>鈥檚 transformer from multiple <span id="ITerm18">threads</span>. In contrast, the following code fragment shows you how to construct a transformer from a <span class="EmphasisFontCategoryNonProportional ">Templates</span> object so that it can be accessed from multiple threads:<div class="ProgramCode" id="PC6"><div class="LineGroup"><div class="FixedLine">TransformerFactory tf = TransformerFactory.newInstance();</div><div class="FixedLine">FileReader fr = new FileReader(&quot;recipe.xsl&quot;);</div><div class="FixedLine">StreamSource ssStyleSheet = new StreamSource(fr);</div><div class="FixedLine">Templates te = tf.newTemplates(ssStylesheet);</div><div class="FixedLine">Transformer t = te.newTransformer();</div><div class="FixedLine">t.transform(new DOMSource(doc), new StreamResult(System.out));</div></div></div></div><p class="Para" id="Par26">The differences are the call to <span class="EmphasisFontCategoryNonProportional ">Transformerfactory</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">Templates newTemplates(Source source)</span> method to create and return objects whose classes implement the <span class="EmphasisFontCategoryNonProportional ">Templates</span> interface, and the call to this interface鈥檚 <span class="EmphasisFontCategoryNonProportional ">Transformer newTransformer()</span> method<span id="ITerm19">
                
              </span> to obtain the <span class="EmphasisFontCategoryNonProportional ">Transformer</span> object.</p></section><section class="Section1 RenderAsSection1" id="Sec3"><h2 class="Heading">Demonstrating the XSLT API</h2><div class="Para" id="Par27">Listing <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_3_Chapter.xhtml#PC2"><span class="RefSource">3-2</span></a></span> presents a <span class="EmphasisFontCategoryNonProportional ">DOMDemo</span> application that creates a DOM document tree based on Listing <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC2"><span class="RefSource">1-2</span></a></span>鈥檚 movie XML document. Unfortunately, you cannot use the DOM API to assign <span class="EmphasisFontCategoryNonProportional ">ISO-8859-1</span> to the XML declaration鈥檚 <span class="EmphasisFontCategoryNonProportional ">encoding</span> attribute. Also, you cannot use DOM (apart from Load and Save) to output this tree to a file or other destination. However, you can overcome these problems with <span id="ITerm20">XSLT</span>, as demonstrated in Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_6_Chapter.xhtml#PC7">6-1</a></span>.<div class="ProgramCode" id="PC7"><div class="LineGroup"><div class="FixedLine">import javax.xml.parsers.DocumentBuilder;</div><div class="FixedLine">import javax.xml.parsers.DocumentBuilderFactory;</div><div class="FixedLine">import javax.xml.parsers.FactoryConfigurationError;</div><div class="FixedLine">import javax.xml.parsers.ParserConfigurationException;</div></div><div class="LineGroup"><div class="FixedLine">import javax.xml.transform.OutputKeys;</div><div class="FixedLine">import javax.xml.transform.Result;</div><div class="FixedLine">import javax.xml.transform.Source;</div><div class="FixedLine">import javax.xml.transform.Transformer;</div><div class="FixedLine">import javax.xml.transform.TransformerConfigurationException;</div><div class="FixedLine">import javax.xml.transform.TransformerException;</div><div class="FixedLine">import javax.xml.transform.TransformerFactory;</div><div class="FixedLine">import javax.xml.transform.TransformerFactoryConfigurationError;</div></div><div class="LineGroup"><div class="FixedLine">import javax.xml.transform.dom.DOMSource;</div></div><div class="LineGroup"><div class="FixedLine">import javax.xml.transform.stream.StreamResult;</div></div><div class="LineGroup"><div class="FixedLine">import org.w3c.dom.Document;</div><div class="FixedLine">import org.w3c.dom.Element;</div><div class="FixedLine">import org.w3c.dom.Text;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class XSLTDemo<span id="ITerm21">
                      
                      
                      
                    </span></div><div class="FixedLine">{</div><div class="FixedLine">   final static String KEY_INDENT =</div><div class="FixedLine">      &quot;{http://xml.apache.org/xslt}indent-amount&quot;;</div></div><div class="LineGroup"><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      try</div><div class="FixedLine">      {</div><div class="FixedLine">         DocumentBuilderFactory dbf =</div><div class="FixedLine">            DocumentBuilderFactory.newInstance();</div><div class="FixedLine">         DocumentBuilder db = dbf.newDocumentBuilder();</div><div class="FixedLine">         Document doc = db.newDocument();</div><div class="FixedLine">         doc.setXmlStandalone(true);</div><div class="FixedLine">         // Create the root element.</div><div class="FixedLine">         Element root = doc.createElement(&quot;movie&quot;);</div><div class="FixedLine">         doc.appendChild(root);</div><div class="FixedLine">         // Create name child element and add it to the</div><div class="FixedLine">         // root.</div><div class="FixedLine">         Element name = doc.createElement(&quot;name&quot;);</div><div class="FixedLine">         root.appendChild(name); <span id="ITerm22">
                      
                      
                      
                    </span></div><div class="FixedLine">         // Add a text element to the name element.</div><div class="FixedLine">         Text text = doc.createTextNode(&quot;Le Fabuleux &quot; + &quot;Destin d&apos;Am茅lie &quot; + &quot;Poulain&quot;);</div><div class="FixedLine">         name.appendChild(text);</div><div class="FixedLine">         // Create language child element and add it to the</div><div class="FixedLine">         // root.</div><div class="FixedLine">         Element language = doc.createElement(&quot;language&quot;);</div><div class="FixedLine">         root.appendChild(language);</div><div class="FixedLine">         // Add a text element to the language element.</div><div class="FixedLine">         text = doc.createTextNode(&quot;fran莽ais&quot;);</div><div class="FixedLine">         language.appendChild(text);</div><div class="FixedLine">         // Use a transformer to output this tree with</div><div class="FixedLine">         // ISO-8859-1 encoding to the standard output</div><div class="FixedLine">         // stream.</div><div class="FixedLine">         TransformerFactory tf = TransformerFactory.newInstance();</div><div class="FixedLine">         Transformer t = tf.newTransformer();</div><div class="FixedLine">         t.setOutputProperty(OutputKeys.METHOD, &quot;xml&quot;);</div><div class="FixedLine">         t.setOutputProperty(OutputKeys.ENCODING, &quot;ISO-8859-1&quot;);</div><div class="FixedLine">         t.setOutputProperty(OutputKeys.INDENT, &quot;yes&quot;);</div><div class="FixedLine">         t.setOutputProperty(KEY_INDENT, &quot;3&quot;);</div><div class="FixedLine">         Source source = new DOMSource(doc);</div><div class="FixedLine">         Result result = new StreamResult(out);</div><div class="FixedLine">         t.transform(source, result); <span id="ITerm23">
                      
                      
                      
                    </span></div><div class="FixedLine">      }</div><div class="FixedLine">      catch (FactoryConfigurationError fce)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;FCE: %s%n&quot;, fce.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (ParserConfigurationException pce)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;PCE: %s%n&quot;, pce.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (TransformerConfigurationException tce)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;TCE: %s%n&quot;, tce.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (TransformerException te)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;TE: %s%n&quot;, te.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (TransformerFactoryConfigurationError tfce)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;TFCE: %s%n&quot;, tfce.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 6-1</span><p class="SimplePara">Assigning <span class="EmphasisFontCategoryNonProportional ">ISO-8859-1</span> to the XML Declaration鈥檚 <span class="EmphasisFontCategoryNonProportional ">Encoding</span> Attribute via XSLT</p></div></div></div></div><p class="Para" id="Par28">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_6_Chapter.xhtml#PC7">6-1</a></span> first creates a DOM tree. It then creates a transformer factory and obtains a transformer from this factory. Four properties are then set on the <span id="ITerm24">transformer</span>, and a stream source and result are obtained. Finally, the <span class="EmphasisFontCategoryNonProportional ">transform()</span> method<span id="ITerm25">
                
              </span> is called to transform source content to the result.</p><p class="Para" id="Par29">The four properties set on the transformer influence the transformation. <span class="EmphasisFontCategoryNonProportional ">OutputKeys.METHOD</span> specifies that the result tree will be written out as XML, <span class="EmphasisFontCategoryNonProportional ">OutputKeys.ENCODING</span> specifies that <span class="EmphasisFontCategoryNonProportional ">ISO-8859-1</span> will be the value of the XML declaration鈥檚 <span class="EmphasisFontCategoryNonProportional ">encoding</span> attribute, and <span class="EmphasisFontCategoryNonProportional ">OutputKeys.INDENT</span> specifies that the transformer can output additional <span id="ITerm26">whitespace</span>.</p><p class="Para" id="Par30">The additional whitespace is used to output the XML across multiple lines instead of on a single line. Because it would be nice to indicate the number of spaces for indenting lines of XML, and because this information cannot be specified via an <span class="EmphasisFontCategoryNonProportional ">OutputKeys</span> property, the nonstandard <span class="EmphasisFontCategoryNonProportional ">&quot;{</span><span class="ExternalRef"><a href="http://xml.apache.org/xslt%257dindent-amount"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional ">http://xml.apache.org/xslt}indent-amount</span>
                </span></a></span><span class="EmphasisFontCategoryNonProportional ">&quot;</span> property (property keys begin with brace-delimited URIs) is used to specify an appropriate value (such as <span class="EmphasisFontCategoryNonProportional ">3</span> spaces). It鈥檚 okay to specify this property in this application because Java鈥檚 default XSLT implementation is based on Apache鈥檚 XSLT <span id="ITerm27">implementation</span>.</p><div class="Para" id="Par31">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_6_Chapter.xhtml#PC7">6-1</a></span> as follows:<div class="ProgramCode" id="PC8"><div class="LineGroup"><div class="FixedLine">javac XSLTDemo.java</div></div></div></div><div class="Para" id="Par32">Run the resulting application as follows:<div class="ProgramCode" id="PC9"><div class="LineGroup"><div class="FixedLine">java XSLTDemo</div></div></div></div><div class="Para" id="Par33">You should observe the following output:<div class="ProgramCode" id="PC10"><div class="LineGroup"><div class="FixedLine">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;&lt;movie&gt;</div><div class="FixedLine">   &lt;name&gt;Le Fabuleux Destin d&apos;Am茅lie Poulain&lt;/name&gt;</div><div class="FixedLine">   &lt;language&gt;fran莽ais&lt;/language&gt;</div><div class="FixedLine">&lt;/movie&gt;</div></div></div></div><p class="Para" id="Par34">Although this example shows you how to output a DOM tree and also how to specify an <span class="EmphasisFontCategoryNonProportional ">encoding</span> value for the XML declaration of the resulting XML <span id="ITerm28">document</span>, the example doesn鈥檛 really demonstrate the power of XSLT because (apart from setting the <span class="EmphasisFontCategoryNonProportional ">encoding</span> attribute value) it performs an identity transformation. A more interesting example would take advantage of a stylesheet.</p><div class="Para" id="Par35">Consider a scenario where you want to convert Listing <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC1"><span class="RefSource">1-1</span></a></span>鈥檚 recipe document to an HTML <span id="ITerm29">document</span> for presentation via a web browser. Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_6_Chapter.xhtml#PC11">6-2</a></span> presents a stylesheet that a transformer can use to perform the conversion.<div class="ProgramCode" id="PC11"><div class="LineGroup"><div class="FixedLine">&lt;?xml version=&quot;1.0&quot;?&gt;</div><div class="FixedLine">&lt;xsl:stylesheet version=&quot;1.0&quot;</div><div class="FixedLine">   xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;&gt;</div><div class="FixedLine">&lt;xsl:template match=&quot;/recipe&quot;&gt;</div><div class="FixedLine">&lt;html&gt;</div><div class="FixedLine">   &lt;head&gt;</div><div class="FixedLine">      &lt;title&gt;Recipes&lt;/title&gt;</div><div class="FixedLine">   &lt;/head&gt;</div></div><div class="LineGroup"><div class="FixedLine">   &lt;body&gt;</div><div class="FixedLine">      &lt;h2&gt;</div><div class="FixedLine">         &lt;xsl:value-of select=&quot;normalize-space(title)&quot;/&gt;</div><div class="FixedLine">      &lt;/h2&gt;</div></div><div class="LineGroup"><div class="FixedLine">      &lt;h3&gt;Ingredients&lt;/h3&gt;<span id="ITerm30">
                      
                      
                      
                    </span></div></div><div class="LineGroup"><div class="FixedLine">      &lt;ul&gt;</div><div class="FixedLine">      &lt;xsl:for-each select=&quot;ingredients/ingredient&quot;&gt;</div><div class="FixedLine">        &lt;li&gt;</div><div class="FixedLine">           &lt;xsl:value-of select=&quot;normalize-space(text())&quot;/&gt;</div><div class="FixedLine">           &lt;xsl:if test=&quot;@qty&quot;&gt; (&lt;xsl:value-of</div><div class="FixedLine">                                 select=&quot;@qty&quot;/&gt;)&lt;/xsl:if&gt;</div><div class="FixedLine">        &lt;/li&gt;</div><div class="FixedLine">      &lt;/xsl:for-each&gt;</div><div class="FixedLine">      &lt;/ul&gt;</div></div><div class="LineGroup"><div class="FixedLine">      &lt;h3&gt;Instructions&lt;/h3&gt;</div></div><div class="LineGroup"><div class="FixedLine">      &lt;xsl:value-of select=&quot;normalize-space(instructions)&quot;/&gt;</div><div class="FixedLine">   &lt;/body&gt;</div><div class="FixedLine">&lt;/html&gt;</div><div class="FixedLine">&lt;/xsl:template&gt;</div><div class="FixedLine">&lt;/xsl:stylesheet&gt;</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 6-2</span><p class="SimplePara">An XSLT Stylesheet for Converting a Recipe Document to an HTML Document</p></div></div></div></div><p class="Para" id="Par36">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_6_Chapter.xhtml#PC11">6-2</a></span> reveals that a stylesheet is an XML document. Its root element is <span class="EmphasisFontCategoryNonProportional ">stylesheet</span><span id="ITerm31">
                
                
                
              </span>, which identifies the standard namespace for stylesheets. It鈥檚 conventional to specify <span class="EmphasisFontCategoryNonProportional ">xsl</span> as the namespace prefix for referring to XSLT instruction elements, although any prefix could be specified.</p><p class="Para" id="Par37">A stylesheet is based on <span class="EmphasisFontCategoryNonProportional ">template</span> elements that control how an element and its content are converted. A template focuses on a single element that鈥檚 identified via the <span class="EmphasisFontCategoryNonProportional ">match</span> attribute. This attribute鈥檚 value is an <span id="ITerm32">XPath location</span> path expression, which matches all <span class="EmphasisFontCategoryNonProportional ">recipe</span> child nodes of the root element node. Regarding Listing <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC1"><span class="RefSource">1-1</span></a></span>, only the single <span class="EmphasisFontCategoryNonProportional ">recipe</span> root element will be matched and selected.</p><p class="Para" id="Par38">A <span class="EmphasisFontCategoryNonProportional ">template</span> element can contain literal text and stylesheet instructions. For example, the <span class="EmphasisFontCategoryNonProportional ">value-of</span> instruction in <span class="EmphasisFontCategoryNonProportional ">&lt;xsl:value-of select=&quot;normalize-space(title)&quot;/&gt;</span> specifies that the value of the <span class="EmphasisFontCategoryNonProportional ">title</span> element (which is a child of the <span class="EmphasisFontCategoryNonProportional ">recipe</span> context node) is to be retrieved and copied to the output. Because this text is surrounded by space and newline characters, XPath鈥檚 <span class="EmphasisFontCategoryNonProportional ">normalize-string()</span> function<span id="ITerm33">
                
              </span> is called to remove this whitespace before the title is copied.</p><p class="Para" id="Par39">XSLT is a powerful declarative language that includes control flow instructions such as <span class="EmphasisFontCategoryNonProportional ">for-each</span> and <span class="EmphasisFontCategoryNonProportional ">if</span>. In the context of <span class="EmphasisFontCategoryNonProportional ">&lt;xsl:for-each select=&quot;ingredients/ingredient&quot;&gt;</span>, <span class="EmphasisFontCategoryNonProportional ">for-each</span> causes all of the <span class="EmphasisFontCategoryNonProportional ">ingredient</span> child nodes of the <span class="EmphasisFontCategoryNonProportional ">ingredients</span> node to be selected and processed one at a time. For each node, <span class="EmphasisFontCategoryNonProportional ">&lt;xsl:value-of select=&quot;normalize-space(text())&quot;/&gt;</span> is executed to copy the content of the <span class="EmphasisFontCategoryNonProportional ">ingredient</span> node, normalized to remove whitespace. Also, the <span class="EmphasisFontCategoryNonProportional ">if</span> instruction in <span class="EmphasisFontCategoryNonProportional ">&lt;xsl:if test=&quot;@qty&quot;&gt; (&lt;xsl:value-of select=&quot;@qty&quot;/&gt;)</span> determines whether or not the <span class="EmphasisFontCategoryNonProportional ">ingredient</span> node has a <span class="EmphasisFontCategoryNonProportional ">qty</span> attribute, and (if so) copies a space character followed by this attribute鈥檚 value (surrounded by parentheses) to the output.</p><div class="Para" id="Par40">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_6_Chapter.xhtml#PC12">6-3</a></span> presents the source <span id="ITerm34">code</span> to an <span class="EmphasisFontCategoryNonProportional ">XSLTDemo</span> application that shows you how to write the Java code to process Listing <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_1_Chapter.xhtml#PC1"><span class="RefSource">1-1</span></a></span> via Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_6_Chapter.xhtml#PC11">6-2</a></span>鈥檚 stylesheet.<div class="ProgramCode" id="PC12"><div class="LineGroup"><div class="FixedLine">import java.io.FileReader;</div><div class="FixedLine">import java.io.IOException;</div></div><div class="LineGroup"><div class="FixedLine">import javax.xml.parsers.DocumentBuilder;</div><div class="FixedLine">import javax.xml.parsers.DocumentBuilderFactory;</div><div class="FixedLine">import javax.xml.parsers.FactoryConfigurationError;</div><div class="FixedLine">import javax.xml.parsers.ParserConfigurationException;</div></div><div class="LineGroup"><div class="FixedLine">import javax.xml.transform.OutputKeys;</div><div class="FixedLine">import javax.xml.transform.Result;</div><div class="FixedLine">import javax.xml.transform.Source;</div><div class="FixedLine">import javax.xml.transform.Transformer; <span id="ITerm35">
                      
                      
                      
                    </span></div><div class="FixedLine">import javax.xml.transform.</div><div class="FixedLine">       TransformerConfigurationException;</div><div class="FixedLine">import javax.xml.transform.TransformerException;</div><div class="FixedLine">import javax.xml.transform.TransformerFactory;</div><div class="FixedLine">import javax.xml.transform.</div><div class="FixedLine">       TransformerFactoryConfigurationError;</div></div><div class="LineGroup"><div class="FixedLine">import javax.xml.transform.dom.DOMSource;</div></div><div class="LineGroup"><div class="FixedLine">import javax.xml.transform.stream.StreamResult;</div><div class="FixedLine">import javax.xml.transform.stream.StreamSource;</div></div><div class="LineGroup"><div class="FixedLine">import org.w3c.dom.Document;</div></div><div class="LineGroup"><div class="FixedLine">import org.xml.sax.SAXException;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class XSLTDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      try</div><div class="FixedLine">      {</div><div class="FixedLine">         DocumentBuilderFactory dbf =</div><div class="FixedLine">            DocumentBuilderFactory.newInstance();</div><div class="FixedLine">         DocumentBuilder db = dbf.newDocumentBuilder();</div><div class="FixedLine">         Document doc = db.parse(&quot;recipe.xml&quot;);</div><div class="FixedLine">         TransformerFactory tf =</div><div class="FixedLine">            TransformerFactory.newInstance();</div><div class="FixedLine">         FileReader fr = new FileReader(&quot;recipe.xsl&quot;);</div><div class="FixedLine">         StreamSource ssStyleSheet = new StreamSource(fr);</div><div class="FixedLine">         Transformer t = tf.newTransformer(ssStyleSheet);</div><div class="FixedLine">         t.setOutputProperty(OutputKeys.METHOD, &quot;html&quot;);</div><div class="FixedLine">         t.setOutputProperty(OutputKeys.INDENT, &quot;yes&quot;);</div><div class="FixedLine">         Source source = new DOMSource(doc);</div><div class="FixedLine">         Result result = new StreamResult(out);</div><div class="FixedLine">         t.transform(source, result);</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (IOException ioe) <span id="ITerm36">
                      
                      
                      
                    </span></div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;IOE: %s%n&quot;, ioe.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (FactoryConfigurationError fce)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;FCE: %s%n&quot;, fce.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (ParserConfigurationException pce)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;PCE: %s%n&quot;, pce.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (SAXException saxe)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;SAXE: %s%n&quot;, saxe.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (TransformerConfigurationException tce)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;TCE: %s%n&quot;, tce.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (TransformerException te) <span id="ITerm37">
                      
                      
                      
                    </span></div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;TE: %s%n&quot;, te.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (TransformerFactoryConfigurationError tfce)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.printf(&quot;TFCE: %s%n&quot;, tfce.toString());</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 6-3</span><p class="SimplePara">Transforming Recipe XML via a Stylesheet</p></div></div></div></div><div class="Para" id="Par41">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_6_Chapter.xhtml#PC12">6-3</a></span> is similar in structure to Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_6_Chapter.xhtml#PC7">6-1</a></span>. It reveals that the output <span id="ITerm38">method</span> is set to <span class="EmphasisFontCategoryNonProportional ">html</span>, and it also reveals that the resulting HTML should be indented. When run, this application generates the following output:<div class="ProgramCode" id="PC13"><div class="LineGroup"><div class="FixedLine">&lt;html&gt;</div><div class="FixedLine">    &lt;head&gt;</div><div class="FixedLine">        &lt;META http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;</div><div class="FixedLine">        &lt;title&gt;Recipes&lt;/title&gt;</div><div class="FixedLine">    &lt;/head&gt;</div><div class="FixedLine">    &lt;body&gt;</div><div class="FixedLine">        &lt;h2&gt;Grilled Cheese Sandwich&lt;/h2&gt;</div><div class="FixedLine">        &lt;h3&gt;Ingredients&lt;/h3&gt;</div><div class="FixedLine">        &lt;ul&gt;</div><div class="FixedLine">            &lt;li&gt;bread slice (2)&lt;/li&gt;</div><div class="FixedLine">            &lt;li&gt;cheese slice&lt;/li&gt;</div><div class="FixedLine">            &lt;li&gt;margarine pat (2)&lt;/li&gt;</div><div class="FixedLine">        &lt;/ul&gt;</div><div class="FixedLine">        &lt;h3&gt;Instructions&lt;/h3&gt;</div><div class="FixedLine">        Place frying pan on element and select medium heat. For each bread slice, smear one pat of margarine on one side of bread slice. Place cheese slice between bread slices with margarine-smeared sides away from the cheese. Place sandwich in frying pan with one margarine-smeared side in contact with pan. Fry for a couple of minutes and flip. Fry other side for a minute and serve.</div><div class="FixedLine">    &lt;/body&gt;</div><div class="FixedLine">&lt;/html&gt;</div></div></div></div><p class="Para" id="Par42"><span class="EmphasisFontCategoryNonProportional ">OutputKeys.INDENT</span> and its <span class="EmphasisFontCategoryNonProportional ">yes</span> value let you output the HTML across multiple lines as opposed to outputting the HTML on a single line. However, the <span id="ITerm39">XSLT processor</span> performs no additional indentation and ignores attempts to specify the number of spaces to indent via code such as <span class="EmphasisFontCategoryNonProportional ">t.setOutputProperty(&quot;{</span><span class="ExternalRef"><a href="http://xml.apache.org/xslt%257dindent-amount"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional ">http://xml.apache.org/xslt}indent-amount</span>
                </span></a></span><span class="EmphasisFontCategoryNonProportional ">&quot;, &quot;3&quot;);</span>.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar3"><h3 class="Heading">Note</h3><p class="Para" id="Par43">An XSLT processor outputs a <span class="EmphasisFontCategoryNonProportional ">&lt;META&gt;</span> tag when <span class="EmphasisFontCategoryNonProportional ">OutputKeys.METHOD</span> is set to <span class="EmphasisFontCategoryNonProportional ">html</span>.</p></div></section><section class="Section1 RenderAsSection1" id="Sec4"><h2 class="Heading">Going Beyond XSLT 1.0 and XPath 1.0</h2><div class="Para" id="Par44">Java 11鈥檚 XSLT <span id="ITerm40">implementation</span> is based on the Apache Xalan Project (<span class="ExternalRef"><a href="https://xalan.apache.org/"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional ">https://xalan.apache.org</span>
                </span></a></span>), which supports XSLT 1.0 and XPath 1.0. However, more recent versions of XSLT and XPath have been developed: 2.0, 3.0, and (for XPath) 3.1. The following list identifies some of their new features:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par45">XSLT 2.0 introduces string manipulation using regular expressions, as well as functions and operators for manipulating dates, times, and durations.</p></li><li><p class="Para" id="Par46">XPath 2.0 is built around the XQuery and XPath Data Model (<span class="ExternalRef"><a href="https://en.wikipedia.org/wiki/XQuery_and_XPath_Data_Model"><span class="RefSource">
                        <span class="EmphasisFontCategoryNonProportional ">https://en.wikipedia.org/wiki/XQuery_and_XPath_Data_Model</span>
                      </span></a></span>), which offers a much richer type system.</p></li><li><p class="Para" id="Par47">XSLT 3.0 supports streaming transformations (<span class="ExternalRef"><a href="http://www.w3.org/TR/xslt-30/"><span class="RefSource">
                        <span class="EmphasisFontCategoryNonProportional ">www.w3.org/TR/xslt-30/</span>
                      </span></a></span>), which is useful for processing documents that are too <span id="ITerm41">large</span> to fit in memory, or when transformations are chained in XML Pipelines (<span class="ExternalRef"><a href="https://en.wikipedia.org/wiki/XML_pipeline"><span class="RefSource">
                        <span class="EmphasisFontCategoryNonProportional ">https://en.wikipedia.org/wiki/XML_pipeline</span>
                      </span></a></span>).</p></li><li><p class="Para" id="Par48">XPath 3.0 supports functions as first-class values.</p></li><li><p class="Para" id="Par49">XPath 3.1 adds new map and array data types, largely to underpin support for JSON, which I introduce in the next chapter.</p></li></ul></div></div><p class="Para" id="Par50">You cannot use Java 11鈥檚 XSLT and XPath <span id="ITerm42">APIs</span> to explore these and other new features until you replace the Xalan implementation. One alternative is SAXON (<span class="ExternalRef"><a href="http://saxon.sourceforge.net/"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional ">http://saxon.sourceforge.net</span>
                </span></a></span>). This 鈥淴SLT and XQuery Processor鈥?supports XSLT 2.0/3.0 and XPath 2.0/3.1 (and more).</p><section class="Section2 RenderAsSection2" id="Sec5"><h3 class="Heading">Downloading and Testing SAXON-HE 9.9</h3><p class="Para" id="Par51">SAXON is available in home, professional, <span id="ITerm43">enterprise</span>, and JavaScript editions. The home edition is an open-source product available under the Mozilla Public License version 2.0. SAXON 9.9 is its most recent version at the time of writing and is the version we will download.</p><p class="Para" id="Par52">Download Saxon-HE 9.9 by clicking the 鈥淒ownload for Java (5.4 Mbytes)鈥?link on SAXON鈥檚 SourceForge home page (<span class="ExternalRef"><a href="http://saxon.sourceforge.net/"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://saxon.sourceforge.net</span>
                  </span></a></span>). On subsequent pages, click 鈥淪axon-HE鈥?followed by 鈥?.9鈥?followed by 鈥淪axonHE9-9-0-1J.zip.鈥?Save and unzip this file. I unzipped SAXON-HE 9.9 to my <span class="EmphasisFontCategoryNonProportional ">C:\unzipped\SaxonHE9-9-0-1J</span> directory, which I鈥檒l use as its home directory.</p><div class="Para" id="Par53">Saxonica (<span class="ExternalRef"><a href="http://saxonica.com/welcome/welcome.xml"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://saxonica.com/welcome/welcome.xml</span>
                  </span></a></span>) is the company behind <span id="ITerm44">SAXON</span>. Its 鈥淕etting started with Saxon on the Java platform鈥?documentation page (<span class="ExternalRef"><a href="http://www.saxonica.com/html/documentation/about/gettingstarted/gettingstartedjava.html"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">www.saxonica.com/html/documentation/about/gettingstarted/gettingstartedjava.html</span>
                  </span></a></span>) shows how to test that the software is working. At the command line, I enter the following command (spread across two lines for readability) to run a simple query:<div class="ProgramCode" id="PC14"><div class="LineGroup"><div class="FixedLine">java -cp c:\unzipped\SaxonHE9-9-0-1J\saxon9he.jar</div><div class="FixedLine">     net.sf.saxon.Query -t -qs:&quot;current-date()&quot;</div></div></div></div><div class="Para" id="Par54">I observed the following <span id="ITerm45">output</span> (the time and memory values will typically change from run to run):<div class="ProgramCode" id="PC15"><div class="LineGroup"><div class="FixedLine">Saxon-HE 9.9.0.1J from Saxonica</div><div class="FixedLine">Java version 11</div><div class="FixedLine">Analyzing query from {current-date()}</div><div class="FixedLine">Analysis time: 213.068628 milliseconds</div><div class="FixedLine">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;2018-10-08-05:00Execution time: 54.719965ms</div><div class="FixedLine">Memory used: 5837296</div></div></div></div></section><section class="Section2 RenderAsSection2" id="Sec6"><h3 class="Heading">Playing with SAXON-HE 9.9</h3><div class="Para" id="Par55">Let鈥檚 revisit the first <span class="EmphasisFontCategoryNonProportional ">XSLTDemo</span> application<span id="ITerm46">
                  
                  
                </span> presented in this chapter (Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_6_Chapter.xhtml#PC7">6-1</a></span>). We can tell this application to use SAXON by inserting the following <span id="ITerm47">
                  <span class="EmphasisFontCategoryNonProportional ">System.setProperty()</span>
                  
                </span> call at the beginning of the <span class="EmphasisFontCategoryNonProportional ">main()</span> method<span id="ITerm48">
                  
                </span>:<div class="ProgramCode" id="PC16"><div class="LineGroup"><div class="FixedLine">      System.setProperty(&quot;javax.xml.transform.TransformerFactory&quot;,</div><div class="FixedLine">                  &quot;net.sf.saxon.TransformerFactoryImpl&quot;);</div></div></div></div><div class="Para" id="Par56">To prove that SAXON is being used, we can also insert the following line after the <span class="EmphasisFontCategoryNonProportional ">Transformer t = tf.newTransformer();</span> line:<div class="ProgramCode" id="PC17"><div class="LineGroup"><div class="FixedLine">System.out.println(t);</div></div></div></div><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar4"><h3 class="Heading">Note</h3><p class="Para" id="Par57">These code fragments are excerpts from a third version of <span class="EmphasisFontCategoryNonProportional ">XSLTDemo</span> that鈥檚 located in the book鈥檚 code archive.</p></div><div class="Para" id="Par58">The source code would be compiled as previously shown. To run the application, you would need to include the <span class="EmphasisFontCategoryNonProportional ">saxon9he.jar</span> file in the <span id="ITerm49">CLASSPATH</span>, or else you would observe a <span class="EmphasisFontCategoryNonProportional ">TransformerFactoryConfigurationError</span>:<div class="ProgramCode" id="PC18"><div class="LineGroup"><div class="FixedLine">java -cp c:\unzipped\SaxonHE9-9-0-1J\saxon9he.jar;. XSLTDemo</div></div></div></div><div class="Para" id="Par59">If all goes well, you should then see the following output:<div class="ProgramCode" id="PC19"><div class="LineGroup"><div class="FixedLine">net.sf.saxon.jaxp.IdentityTransformer@8b96fde</div><div class="FixedLine">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</div><div class="FixedLine">&lt;movie&gt;</div><div class="FixedLine">   &lt;name&gt;Le Fabuleux Destin d&apos;Am茅lie Poulain&lt;/name&gt;</div><div class="FixedLine">   &lt;language&gt;fran莽ais&lt;/language&gt;</div><div class="FixedLine">&lt;/movie&gt;</div></div></div></div><p class="Para" id="Par60">You can start to move beyond XSLT 1.0. For example, you might want to check out <em class="EmphasisTypeItalic ">Beginning XSLT 2.0 From Novice to Professional</em> (<span class="ExternalRef"><a href="http://www.apress.com/9781590593240"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">www.apress.com/9781590593240</span>
                  </span></a></span>), an Apress book written by Jeni <span id="ITerm50">Tennison</span>. This book will get you comfortable with XSLT 2.0.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar5"><h3 class="Heading">Caution</h3><p class="Para" id="Par61">The SAXON Home Edition doesn鈥檛 include the following capabilities: schema processing and schema-aware XSLT and XQuery; support for higher-order functions; support for XPath 1.0 (and XSLT 1.0) backward compatibility mode, numerous SAXON extensions; calling out to Java methods; XQuery Update support; and various optimizations including join optimization, streamed processing, multi-threaded execution, and byte code generation.</p></div><div class="FormalPara FormalParaRenderingStyle3 ParaTypeOverview" id="FPar6"><h3 class="Heading">Exercises</h3><div class="Para" id="Par62">The following exercises are designed to test your understanding of Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_6_Chapter.xhtml"><span class="RefSource">6</span></a></span>鈥檚 content:<div class="OrderedList"><ol><li class="ListItem"><span class="ItemNumber">1.</span><div class="ItemContent"><p class="Para" id="Par63">Define XSLT.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">2.</span><div class="ItemContent"><p class="Para" id="Par64">How does XSLT accomplish its work?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">3.</span><div class="ItemContent"><p class="Para" id="Par65">True or false: Call <span class="EmphasisFontCategoryNonProportional ">TransformerFactory</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">void transform(Source xmlSource, Result outputTarget)</span> method to transform a source to a result.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">4.</span><div class="ItemContent"><p class="Para" id="Par66">Create a <span class="EmphasisFontCategoryNonProportional ">books.xsl</span> stylesheet file and a <span class="EmphasisFontCategoryNonProportional ">MakeHTML</span> application with a similar structure to the application that processes Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_6_Chapter.xhtml#PC11">6-2</a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">recipe.xsl</span> stylesheet. <span class="EmphasisFontCategoryNonProportional ">MakeHTML</span> uses <span class="EmphasisFontCategoryNonProportional ">books.xsl</span> to convert Exercise 1-21鈥檚 <span class="EmphasisFontCategoryNonProportional ">books.xml</span> content to HTML. When viewed in a web browser, the HTML should result in a web page that鈥檚 similar to the page shown in Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_6_Chapter.xhtml#Fig2">6-2</a></span>.</p></div><div class="ClearBoth"> </div></li></ol></div><figure class="Figure" id="Fig2"><div class="MediaObject" id="MO2"><img alt="../images/394211_2_En_6_Chapter/394211_2_En_6_Fig2_HTML.jpg" data-mfp-src="/library/view/java-xml-and/9781484243305/images/394211_2_En_6_Chapter/394211_2_En_6_Fig2_HTML.jpg" height="1313" src="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/images/394211_2_En_6_Chapter/394211_2_En_6_Fig2_HTML.jpg" style="height:32.82em" width="1000"/></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 6-2</span><p class="SimplePara">Exercise 1-21鈥檚 <em class="EmphasisTypeItalic EmphasisFontCategoryNonProportional ">books.xml</em> content is presented via a web page</p></div></figcaption></figure></div></div></section></section><section class="Section1 RenderAsSection1" id="Sec7"><h2 class="Heading">Summary</h2><p class="Para" id="Par67">XSL is a family of languages for transforming and formatting XML documents. XSLT is the XSL language for transforming XML documents to other formats, such as HTML (for presenting an XML document鈥檚 content via a web browser).</p><p class="Para" id="Par68">XSLT accomplishes its work by using XSLT processors and stylesheets. An XSLT processor applies an XSLT stylesheet to an input document (without modifying the document) and copies the transformed result to a result tree, which can be output to a file or output stream or even piped into another XSLT processor for additional transformations.</p><p class="Para" id="Par69">Java implements XSLT through the types in the <span class="EmphasisFontCategoryNonProportional ">javax.xml.transform</span>, <span class="EmphasisFontCategoryNonProportional ">javax.xml.transform.dom</span>, <span class="EmphasisFontCategoryNonProportional ">javax.xml.transform.sax</span>, <span class="EmphasisFontCategoryNonProportional ">javax.xml.transform.stax</span>, and <span class="EmphasisFontCategoryNonProportional ">javax.xml.transform.stream</span> packages. The <span class="EmphasisFontCategoryNonProportional ">javax.xml.transform</span> package defines the generic APIs for processing transformation instructions and for performing a transformation from a source (where the XSLT processor鈥檚 input originates) to a result (where the processor鈥檚 output is sent). The remaining packages define the APIs for obtaining different kinds of sources and results.</p><p class="Para" id="Par70">Java 11鈥檚 XSLT implementation is based on the Apache Xalan Project, which supports XSLT 1.0 and XPath 1.0. Because you cannot use Java 11鈥檚 XSLT and XPath APIs to explore XSLT 2.0/3.0 and XPath 2.0/3.x, you must replace the Xalan implementation. One alternative is SAXON. This 鈥淴SLT and XQuery Processor鈥?supports XSLT 2.0/3.0 and XPath 2.0/3.1 (and more).</p><p class="Para" id="Par71">Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_7_Chapter.xhtml"><span class="RefSource">7</span></a></span> introduces you to JSON, a less-verbose alternative to XML.</p></section></div><div class="annotator-outer annotator-viewer viewer annotator-hide"> </div></div></div>
    </section>
  </div>
</div>

<hr/>

<!--if IE]><![endif]--><!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/java-xml-and/9781484243305/html/Part_2.xhtml"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="3866890"
  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"
  data-username="levinxccai"
  data-account-type="B2B"
  
  data-activated-trial-date="11/06/2017"


  data-archive="9781484243305"
  data-publishers="Apress"



  data-htmlfile-name="Part_2.xhtml"
  data-epub-title="Java XML and JSON: Document Processing for Java SE" data-debug=0 data-testing=0><![endif]--><!--if gt IE 8]><!--><!--![endif]-->



<a name="8_"></a>

<div class="application" id="container" style="height: auto;">
  <div class="js-toc">
    <section role="document">
      <div id="sbo-rt-content" style="max-width:72.5em; transform: none;"><div class="annotator-wrapper"><h1><span class="PartNumber">Part II</span><span class="PartTitle" lang="en">Exploring JSON</span></h1><div class="annotator-outer annotator-viewer viewer annotator-hide"> </div></div></div>
    </section>
  </div>
</div>
<div class="font-flyout"> </div>
<hr/>

<!--if IE]><![endif]--><!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/java-xml-and/9781484243305/html/394211_2_En_7_Chapter.xhtml"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="3866890"
  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"
  data-username="levinxccai"
  data-account-type="B2B"
  
  data-activated-trial-date="11/06/2017"


  data-archive="9781484243305"
  data-publishers="Apress"



  data-htmlfile-name="394211_2_En_7_Chapter.xhtml"
  data-epub-title="Java XML and JSON: Document Processing for Java SE" data-debug=0 data-testing=0><![endif]--><!--if gt IE 8]><!--><!--![endif]-->



<a name="9_"></a>

<div class="application" id="container" style="height: auto;">
  <div class="js-toc">
    <section role="document">
      <div id="sbo-rt-content" style="max-width:72.5em; transform: none;"><div class="annotator-wrapper"><!--egin Abstract--><div class="MainTitleSection"><h1 class="ChapterTitle" lang="en">7. Introducing JSON</h1></div><div class="AuthorGroup"><div class="AuthorNames"><span class="Author"><span class="AuthorName">Jeff Friesen</span><sup><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_7_Chapter.xhtml#Aff2">1</a> <span class="ContactIcon"></span></sup></span></div><div class="Affiliations"><div class="Affiliation" id="Aff2"><span class="AffiliationNumber">(1)</span><div class="AffiliationText">Dauphin, MB, Canada</div></div><div class="ClearBoth"> </div></div></div><!--nd Abstract--><div class="Fulltext"><p class="Para" id="Par2">Many applications communicate by exchanging JSON objects instead of XML documents. Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_7_Chapter.xhtml"><span class="RefSource">7</span></a></span> introduces JSON, tours its syntax, demonstrates JSON in a JavaScript context, and shows how to validate JSON objects in the context of JSON Schema.</p><section class="Section1 RenderAsSection1" id="Sec1"><h2 class="Heading">What Is JSON?</h2><p class="Para" id="Par3"><em class="EmphasisTypeItalic ">JSON</em> (<em class="EmphasisTypeItalic ">JavaScript Object Notation</em>) is a language-independent data format that expresses JSON <span id="ITerm1">objects</span> as human-readable lists of <em class="EmphasisTypeItalic ">properties</em> (name/value pairs). Although derived from a nonstrict subset of JavaScript, code to parse JSON objects into equivalent language-dependent objects is available in many programming languages.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar1"><h3 class="Heading">Note</h3><p class="Para" id="Par4">JSON allows the Unicode <span class="EmphasisFontCategoryNonProportional ">U+2028</span> line separator and <span class="EmphasisFontCategoryNonProportional ">U+2029</span> paragraph separator to appear unescaped in quoted strings. Because JavaScript doesn鈥檛 support this capability, JSON isn鈥檛 a proper subset of JavaScript.</p></div><p class="Para" id="Par5">JSON is commonly used in asynchronous browser/server communication via AJAX (<span class="ExternalRef"><a href="https://en.wikipedia.org/wiki/Ajax_(programming)"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional ">https://en.wikipedia.org/wiki/Ajax_(programming)</span>
                </span></a></span>). JSON is also used with NoSQL database management systems such as <span id="ITerm2">MongoDb</span> and <span id="ITerm3">CouchDb</span>; with apps from social media websites such as Twitter, Facebook, LinkedIn, and Flickr; and even with the popular Google Maps API.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar2"><h3 class="Heading">Note</h3><p class="Para" id="Par6">Many developers prefer JSON to XML because they see JSON as being less verbose and easier to read. Check out 鈥淛SON: The Fat-Free Alternative to XML鈥?(<span class="ExternalRef"><a href="http://www.json.org/xml.html"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">www.json.org/xml.html</span>
                  </span></a></span>) for more information.</p></div></section><section class="Section1 RenderAsSection1" id="Sec2"><h2 class="Heading">JSON Syntax Tour</h2><div class="Para" id="Par7">The JSON data format presents a JSON <span id="ITerm4">object</span> as a brace-delimited and comma-separated list of properties (a comma doesn鈥檛 appear after the final property):<div class="ProgramCode" id="PC1"><div class="LineGroup"><div class="FixedLine">{</div><div class="FixedLine">   <em class="EmphasisTypeItalic ">property1</em> ,</div><div class="FixedLine">   <em class="EmphasisTypeItalic ">property2</em> ,</div><div class="FixedLine">   ...</div><div class="FixedLine">   <em class="EmphasisTypeItalic ">propertyN</em></div><div class="FixedLine">}</div></div></div></div><p class="Para" id="Par8">For each property, the name is expressed as a string that鈥檚 typically quoted (and by a pair of double quotes). The name string is followed by a colon <span id="ITerm5">character</span>, which is followed by a value of a specific type. Examples include <span class="EmphasisFontCategoryNonProportional ">name&quot;: &quot;JSON</span> and <span class="EmphasisFontCategoryNonProportional ">&quot;age&quot;: 25</span>.</p><div class="Para" id="Par9">JSON supports the following six <span id="ITerm6">types</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par10"><em class="EmphasisTypeItalic ">Number</em>: a signed decimal number that may contain a fractional part and may use exponential (E) notation. JSON doesn鈥檛 permit nonnumbers (such as NaN), nor does it make any distinction between integer and floating-point. Furthermore, JSON doesn鈥檛 recognize the octal and hexadecimal formats. (Although JavaScript uses a double precision floating-point format for all numeric values, other languages implementing JSON may encode numbers differently.)</p></li><li><p class="Para" id="Par11"><em class="EmphasisTypeItalic ">String</em>: a sequence of <span id="ITerm7">zero</span> or more Unicode characters. Strings are delimited with double quotes and support a backslash escaping syntax.</p></li><li><p class="Para" id="Par12"><em class="EmphasisTypeItalic ">Boolean</em>: either of the values <span class="EmphasisFontCategoryNonProportional ">true</span> or <span class="EmphasisFontCategoryNonProportional ">false</span>.</p></li><li><p class="Para" id="Par13"><em class="EmphasisTypeItalic ">Array</em>: an ordered list of zero or more values, each of which may be of any type. Arrays use square bracket notation with elements being comma-separated.</p></li><li><p class="Para" id="Par14"><em class="EmphasisTypeItalic ">Object</em>: an unordered collection of <span id="ITerm8">properties</span> where the names (also called <em class="EmphasisTypeItalic ">keys</em>) are strings. Because objects are intended to represent associative arrays, it鈥檚 recommended, although not required, that each key be unique within an object. Objects are delimited with braces and use commas to separate each property. Within each property the colon character separates the key from its value.</p></li><li><p class="Para" id="Par15"><em class="EmphasisTypeItalic ">Null</em>: an empty value, using the keyword <span class="EmphasisFontCategoryNonProportional ">null</span>.</p></li></ul></div></div><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar3"><h3 class="Heading">Note</h3><p class="Para" id="Par16">JSON Schema (discussed later) recognizes a seventh type: integer. This type doesn鈥檛 include a fraction or exponent and is a subset of number.</p></div><p class="Para" id="Par17">Whitespace is allowed and ignored around or between syntactic elements (values and punctuation). Four specific characters are considered whitespace for this purpose: space, horizontal tab, line feed, and carriage return. Also, JSON doesn鈥檛 support comments.</p><div class="Para" id="Par18">Using this data format, you can specify a JSON <span id="ITerm9">object</span> such as the following anonymous object (excerpted from Wikipedia鈥檚 JSON page [<span class="ExternalRef"><a href="https://en.wikipedia.org/wiki/JSON"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional ">https://en.wikipedia.org/wiki/JSON</span>
                </span></a></span>]) for describing a person in terms of first name, last name, and other data items:<div class="ProgramCode" id="PC2"><div class="LineGroup"><div class="FixedLine">{</div><div class="FixedLine">   &quot;firstName&quot;: &quot;John&quot;,</div><div class="FixedLine">   &quot;lastName&quot;: &quot;Smith&quot;,</div><div class="FixedLine">   &quot;isAlive&quot;: true,</div><div class="FixedLine">   &quot;age&quot;: 25,</div><div class="FixedLine">   &quot;address&quot;:</div><div class="FixedLine">   {<span id="ITerm10">
                      
                      
                    </span></div><div class="FixedLine">      &quot;streetAddress&quot;: &quot;21 2nd Street&quot;,</div><div class="FixedLine">      &quot;city&quot;: &quot;New York&quot;,</div><div class="FixedLine">      &quot;state&quot;: &quot;NY&quot;,</div><div class="FixedLine">      &quot;postalCode&quot;: &quot;10021-3100&quot;</div><div class="FixedLine">   },</div><div class="FixedLine">   &quot;phoneNumbers&quot;:</div><div class="FixedLine">   [</div><div class="FixedLine">      {</div><div class="FixedLine">         &quot;type&quot;: &quot;home&quot;,</div><div class="FixedLine">         &quot;number&quot;: &quot;212 555-1234&quot;</div><div class="FixedLine">      },</div><div class="FixedLine">      {</div><div class="FixedLine">         &quot;type&quot;: &quot;office&quot;,</div><div class="FixedLine">         &quot;number&quot;: &quot;646 555-4567&quot;</div><div class="FixedLine">      }</div><div class="FixedLine">   ],</div><div class="FixedLine">   &quot;children&quot;: [],</div><div class="FixedLine">   &quot;spouse&quot;: null</div><div class="FixedLine">}</div></div></div></div><div class="Para" id="Par19">In this example, the anonymous object consists of eight <span id="ITerm11">properties</span> with the following <span id="ITerm12">keys</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par20"><span class="EmphasisFontCategoryNonProportional ">firstName</span> identifies a person鈥檚 first name and is of type string.</p></li><li><p class="Para" id="Par21"><span class="EmphasisFontCategoryNonProportional ">lastName</span> identifies a person鈥檚 last name and is of type string.</p></li><li><p class="Para" id="Par22"><span class="EmphasisFontCategoryNonProportional ">isAlive</span> identifies a person鈥檚 alive status and is of type Boolean.</p></li><li><p class="Para" id="Par23"><span class="EmphasisFontCategoryNonProportional ">age</span> identifies how old a person is and is of type number.</p></li><li><p class="Para" id="Par24"><span class="EmphasisFontCategoryNonProportional ">address</span> identifies a person鈥檚 location and is of type object. Within this object are four properties (of type string): <span class="EmphasisFontCategoryNonProportional ">streetAddress</span><span id="ITerm13">
                      
                      
                    </span>, <span class="EmphasisFontCategoryNonProportional ">city</span>, <span class="EmphasisFontCategoryNonProportional ">state</span>, and <span class="EmphasisFontCategoryNonProportional ">postalCode</span>.</p></li><li><p class="Para" id="Par25"><span class="EmphasisFontCategoryNonProportional ">phoneNumbers</span> identifies a person鈥檚 phone numbers and is of type <span id="ITerm14">array</span>. Within the array are two objects; each object consists of <span class="EmphasisFontCategoryNonProportional ">type</span> and <span class="EmphasisFontCategoryNonProportional ">number</span> properties (of type string).</p></li><li><p class="Para" id="Par26"><span class="EmphasisFontCategoryNonProportional ">children</span> identifies a person鈥檚 children (if any) and is of type array.</p></li><li><p class="Para" id="Par27"><span class="EmphasisFontCategoryNonProportional ">spouse</span> identifies a person鈥檚 partner and is empty.</p></li></ul></div></div><p class="Para" id="Par28">The previous <span id="ITerm15">example</span> shows that objects and arrays can be nested, for example, objects placed within arrays that are placed within objects.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar4"><h3 class="Heading">Note</h3><p class="Para" id="Par29">By convention, JSON objects are stored in files with the <span class="EmphasisFontCategoryNonProportional ">.json</span> file extension.</p></div></section><section class="Section1 RenderAsSection1" id="Sec3"><h2 class="Heading">Demonstrating JSON with JavaScript</h2><p class="Para" id="Par30">Ideally, I鈥檇 demonstrate <span id="ITerm16">JSON</span> with Java鈥檚 standard JSON API. However, Java doesn鈥檛 officially support JSON.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar5"><h3 class="Heading">Note</h3><p class="Para" id="Par31">In 2014, Oracle introduced a Java Enhancement Proposal (JEP) for adding a JSON API to Java. Although 鈥淛EP 198: Light-Weight JSON API鈥?(<span class="ExternalRef"><a href="http://openjdk.java.net/jeps/198"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://openjdk.java.net/jeps/198</span>
                  </span></a></span>) was updated in 2017, it will probably be several more years before this JSON API becomes part of Java.</p></div><div class="Para" id="Par32">I鈥檒l demonstrate JSON via JavaScript, but in a Java context via Java鈥檚 Scripting API. (If you鈥檙e new to Scripting, I鈥檒l explain just enough of this <span id="ITerm17">API</span> so that you can understand the code.) To get started, Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_7_Chapter.xhtml#PC3">7-1</a></span> presents the source code to an application for executing JavaScript <span id="ITerm18">code</span>.<div class="ProgramCode" id="PC3"><div class="LineGroup"><div class="FixedLine">import java.io.FileReader;</div><div class="FixedLine">import java.io.IOException;</div></div><div class="LineGroup"><div class="FixedLine">import javax.script.ScriptEngine;</div><div class="FixedLine">import javax.script.ScriptEngineManager;</div><div class="FixedLine">import javax.script.ScriptException;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class RunScript</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      if (args.length != 1)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.println(&quot;usage: java RunScript script&quot;);</div><div class="FixedLine">         return;</div><div class="FixedLine">      }</div><div class="FixedLine">      ScriptEngineManager manager =</div><div class="FixedLine">         new ScriptEngineManager();</div><div class="FixedLine">      ScriptEngine engine =</div><div class="FixedLine">         manager.getEngineByName(&quot;nashorn&quot;);</div><div class="FixedLine">      try</div><div class="FixedLine">      {</div><div class="FixedLine">         engine.eval(new FileReader(args[0]));</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (ScriptException se)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.println(se.getMessage());</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (IOException ioe)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.println(ioe.getMessage());</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 7-1</span><p class="SimplePara">Executing JavaScript Code with Assistance from Java</p></div></div></div></div><p class="Para" id="Par33">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_7_Chapter.xhtml#PC3">7-1</a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">main()</span> method<span id="ITerm19">
                
              </span><span id="ITerm20">
                
                
              </span> first verifies that exactly one command-line argument, which names a script <span id="ITerm21">file</span>, has been specified. If this isn鈥檛 the case, it displays usage information and terminates the application.</p><p class="Para" id="Par34">Assuming that a single command-line argument was specified, the <span class="EmphasisFontCategoryNonProportional ">javax.script.ScriptEngineManager</span> class is instantiated. <span class="EmphasisFontCategoryNonProportional ">ScriptEngineManager</span> serves as the entry point into the Scripting API.</p><p class="Para" id="Par35">Next, the <span class="EmphasisFontCategoryNonProportional ">ScriptEngineManager</span> object鈥檚 <span class="EmphasisFontCategoryNonProportional ">ScriptEngine getEngineByName(String shortName)</span> method is called to obtain a script engine corresponding to the desired <span class="EmphasisFontCategoryNonProportional ">shortName</span> value. Java 11 supports the <span class="EmphasisFontCategoryNonProportional ">nashorn</span> script engine (although it has been deprecated), which is returned as an object whose class implements the <span class="EmphasisFontCategoryNonProportional ">javax.script.ScriptEngine</span> interface.</p><p class="Para" id="Par36"><span class="EmphasisFontCategoryNonProportional ">ScriptEngine</span> declares several <span class="EmphasisFontCategoryNonProportional ">eval()</span> methods<span id="ITerm22">
                
              </span> for evaluating a script. <span class="EmphasisFontCategoryNonProportional ">main()</span> invokes the <span class="EmphasisFontCategoryNonProportional ">Object eval(Reader reader)</span> method to read the script from its <span class="EmphasisFontCategoryNonProportional ">java.io.FileReader</span> object argument and (assuming that <span class="EmphasisFontCategoryNonProportional ">java.io.IOException</span> isn鈥檛 thrown) then evaluate the script. This method returns any script return value, which I ignore. Also, this <span id="ITerm23">method</span> throws <span class="EmphasisFontCategoryNonProportional ">javax.script.ScriptException</span> when an error occurs in the script.</p><div class="Para" id="Par37">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_7_Chapter.xhtml#PC3">7-1</a></span> as follows:<div class="ProgramCode" id="PC4"><div class="LineGroup"><div class="FixedLine">javac RunScript.java</div></div></div></div><div class="Para" id="Par38">Before you can run this application, you need a suitable script file. Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_7_Chapter.xhtml#PC5">7-2</a></span> presents a script that declares and accesses a <span id="ITerm24">JSON object</span>.<div class="ProgramCode" id="PC5"><div class="LineGroup"><div class="FixedLine">var person =</div><div class="FixedLine">{</div><div class="FixedLine">   &quot;firstName&quot;: &quot;John&quot;,</div><div class="FixedLine">   &quot;lastName&quot;: &quot;Smith&quot;,</div><div class="FixedLine">   &quot;isAlive&quot;: true,</div><div class="FixedLine">   &quot;age&quot;: 25,</div><div class="FixedLine">   &quot;address&quot;:</div><div class="FixedLine">   {</div><div class="FixedLine">      &quot;streetAddress&quot;: &quot;21 2nd Street&quot;,</div><div class="FixedLine">      &quot;city&quot;: &quot;New York&quot;,</div><div class="FixedLine">      &quot;state&quot;: &quot;NY&quot;,</div><div class="FixedLine">      &quot;postalCode&quot;: &quot;10021-3100&quot;</div><div class="FixedLine">   },</div><div class="FixedLine">   &quot;phoneNumbers&quot;:</div><div class="FixedLine">   [</div><div class="FixedLine">      {</div><div class="FixedLine">         &quot;type&quot;: &quot;home&quot;,</div><div class="FixedLine">         &quot;number&quot;: &quot;212 555-1234&quot;</div><div class="FixedLine">      },</div><div class="FixedLine">      {</div><div class="FixedLine">         &quot;type&quot;: &quot;office&quot;,</div><div class="FixedLine">         &quot;number&quot;: &quot;646 555-4567&quot;</div><div class="FixedLine">      }</div><div class="FixedLine">   ],</div><div class="FixedLine">   &quot;children&quot;: [],</div><div class="FixedLine">   &quot;spouse&quot;: null</div><div class="FixedLine">};</div><div class="FixedLine">print(person.firstName);</div><div class="FixedLine">print(person.lastName);</div><div class="FixedLine">print(person.address.city);</div><div class="FixedLine">print(person.phoneNumbers[1].number);</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 7-2</span><p class="SimplePara">Declaring and Accessing a Person Object</p></div></div></div></div><div class="Para" id="Par39">Assuming that Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_7_Chapter.xhtml#PC5">7-2</a></span> is stored in <span class="EmphasisFontCategoryNonProportional ">person.js</span><span id="ITerm25">
                
                
              </span>, run the application as follows:<div class="ProgramCode" id="PC6"><div class="LineGroup"><div class="FixedLine">java RunScript person.js</div></div></div></div><div class="Para" id="Par40">You should observe the following <span id="ITerm26">output</span> (along with a warning message about Nashorn鈥檚 planned removal from a future JDK release):<div class="ProgramCode" id="PC7"><div class="LineGroup"><div class="FixedLine">John</div><div class="FixedLine">Smith</div><div class="FixedLine">New York</div><div class="FixedLine">646 555-4567</div></div></div></div><p class="Para" id="Par41">A JSON object exists as language-independent text. To convert the text to a language-dependent object, you need to parse the text. JavaScript provides a <span class="EmphasisFontCategoryNonProportional ">JSON</span> object<span id="ITerm27">
                
                
              </span> with a <span class="EmphasisFontCategoryNonProportional ">parse()</span> method<span id="ITerm28">
                
              </span> for this task. Pass the text to be parsed as an argument to <span class="EmphasisFontCategoryNonProportional ">parse()</span> and receive the resulting JavaScript-based object as this method鈥檚 return value. <span class="EmphasisFontCategoryNonProportional ">parse()</span> throws <span class="EmphasisFontCategoryNonProportional ">SyntaxError</span> when the text doesn鈥檛 conform to the JSON format.</p><div class="Para" id="Par42">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_7_Chapter.xhtml#PC8">7-3</a></span> presents a script that demonstrates <span class="EmphasisFontCategoryNonProportional ">parse()</span>.<div class="ProgramCode" id="PC8"><div class="LineGroup"><div class="FixedLine">var creditCardText =</div><div class="FixedLine">&quot;{ \&quot;number\&quot;: \&quot;1234567890123456\&quot;, &quot; +</div><div class="FixedLine">&quot;\&quot;expiry\&quot;: \&quot;04/20\&quot;, \&quot;type\&quot;: &quot; +</div><div class="FixedLine">&quot;\&quot;visa\&quot; }&quot;;</div><div class="FixedLine">var creditCard = JSON.parse(creditCardText);</div><div class="FixedLine">print(creditCard.number);</div><div class="FixedLine">print(creditCard.expiry);</div><div class="FixedLine">print(creditCard.type);</div></div><div class="LineGroup"><div class="FixedLine">var creditCardText2 = &quot;{ &apos;type&apos;: &apos;visa&apos; }&quot;;</div><div class="FixedLine">var creditCard2 = JSON.parse(creditCardText2);</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 7-3</span><p class="SimplePara">Parsing a <span id="ITerm29">JSON Object</span></p></div></div></div></div><div class="Para" id="Par43">Assuming that Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_7_Chapter.xhtml#PC8">7-3</a></span> is stored in <span class="EmphasisFontCategoryNonProportional ">cc.js</span>, run the application as follows:<div class="ProgramCode" id="PC9"><div class="LineGroup"><div class="FixedLine">java RunScript cc.js</div></div></div></div><div class="Para" id="Par44">You should observe the following output:<div class="ProgramCode" id="PC10"><div class="LineGroup"><div class="FixedLine">1234567890123456</div><div class="FixedLine">04/20</div><div class="FixedLine">visa</div><div class="FixedLine">SyntaxError: Invalid JSON: &lt;json&gt;:1:2 Expected , or } but found &apos;</div><div class="FixedLine">{ &apos;type&apos;: &apos;visa&apos; }</div><div class="FixedLine">  ^ in &lt;eval&gt; at line number 11</div></div></div></div><p class="Para" id="Par45">The syntax error shows that you cannot <span id="ITerm30">delimit</span> a name with single quotes (only double quotes are valid).</p><p class="Para" id="Par46">This is all I have to say about working with <span id="ITerm31">JSON</span> in a JavaScript context. Because this book is Java-focused, subsequent chapters will explore various third-party Java APIs for parsing JSON objects into Java-dependent objects and vice versa.</p></section><section class="Section1 RenderAsSection1" id="Sec4"><h2 class="Heading">Validating JSON Objects</h2><p class="Para" id="Par47">It鈥檚 often necessary for applications to validate JSON objects, to ensure that required properties are present and that additional constraints (such as a price never being less than <span class="EmphasisFontCategoryNonProportional ">1</span> dollar) are met. Validation is typically performed in the context of JSON Schema.</p><p class="Para" id="Par48"><em class="EmphasisTypeItalic ">JSON Schema</em> is a grammar <span id="ITerm32">language</span> for defining the structure, content, and (to some extent) semantics of JSON objects. It lets you specify <em class="EmphasisTypeItalic ">metadata</em> (data about data) about what an object鈥檚 properties mean and what values are valid for those <span id="ITerm33">properties</span>. The result of applying the grammar language is a <em class="EmphasisTypeItalic ">schema</em> (a blueprint) describing the set of JSON objects that are valid according to the schema.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar6"><h3 class="Heading">Note</h3><p class="Para" id="Par49">JSON Schema expresses a schema as a JSON object.</p></div><div class="Para" id="Par50">JSON <span id="ITerm34">Schema</span> is maintained at the JSON Schema website (<span class="ExternalRef"><a href="http://json-schema.org/"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional ">http://json-schema.org</span>
                </span></a></span>). This website reveals several advantages for JSON Schema:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par51">It describes your existing data format.</p></li><li><p class="Para" id="Par52">If offers clear, human-readable, and machine-readable documentation.</p></li><li><p class="Para" id="Par53">It provides complete structural validation, which is useful for automated testing and validating client-submitted data.</p></li></ul></div></div><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar7"><h3 class="Heading">Note</h3><p class="Para" id="Par54">The JSON Schema website focuses on draft version 7 of the JSON Schema specification. This specification is divided into four parts: JSON Schema Core, JSON Schema Validation, JSON Hyper-Schema, and Relative JSON Pointers.</p></div><div class="Para" id="Par55">To understand JSON <span id="ITerm35">Schema</span>, consider the following simple JSON object:<div class="ProgramCode" id="PC11"><div class="LineGroup"><div class="FixedLine">{</div><div class="FixedLine">   &quot;name&quot;: &quot;John Doe&quot;,</div><div class="FixedLine">   &quot;age&quot;: 35</div><div class="FixedLine">}</div></div></div></div><p class="Para" id="Par56">This object describes a person in terms of a <span class="EmphasisFontCategoryNonProportional ">name</span> and an <span class="EmphasisFontCategoryNonProportional ">age</span>. Assume that both of these properties must be present, <span class="EmphasisFontCategoryNonProportional ">name</span> must be of type string and <span class="EmphasisFontCategoryNonProportional ">age</span> must be of type number, and <span class="EmphasisFontCategoryNonProportional ">age</span>鈥檚 value must range from 18 through 64.</p><div class="Para" id="Par57">The following schema (based on draft version 7 of JSON Schema) provides the necessary constraints for this object:<div class="ProgramCode" id="PC12"><div class="LineGroup"><div class="FixedLine">{</div><div class="FixedLine">   &quot;$schema&quot;: &quot;http://json-schema.org/draft-07/schema#&quot;,</div><div class="FixedLine">   &quot;title&quot;: &quot;Person&quot;,</div><div class="FixedLine">   &quot;description&quot;: &quot;A person&quot;,</div><div class="FixedLine">   &quot;type&quot;: &quot;object&quot;,</div><div class="FixedLine">   &quot;properties&quot;:</div><div class="FixedLine">   {</div><div class="FixedLine">      &quot;name&quot;:</div><div class="FixedLine">      {</div><div class="FixedLine">         &quot;description&quot;: &quot;A person&apos;s name&quot;,</div><div class="FixedLine">         &quot;type&quot;: &quot;string&quot;</div><div class="FixedLine">      },</div><div class="FixedLine">      &quot;age&quot;:</div><div class="FixedLine">      {</div><div class="FixedLine">         &quot;description&quot;: &quot;A person&apos;s age&quot;,</div><div class="FixedLine">         &quot;type&quot;: &quot;number&quot;,</div><div class="FixedLine">         &quot;minimum&quot;: 18,</div><div class="FixedLine">         &quot;maximum&quot;: 64</div><div class="FixedLine">      }</div><div class="FixedLine">   },</div><div class="FixedLine">   &quot;required&quot;: [&quot;name&quot;, &quot;age&quot;]</div><div class="FixedLine">}</div></div></div></div><div class="Para" id="Par58">Reading from top to bottom, you would interpret this JSON-based schema as <span id="ITerm36">follows</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par59">The <span class="EmphasisFontCategoryNonProportional ">$schema</span> keyword states that this schema is written according to the draft version 7 specification.</p></li><li><p class="Para" id="Par60">The <span class="EmphasisFontCategoryNonProportional ">title</span> keyword identifies the JSON object being validated by this schema. In this case, a <span class="EmphasisFontCategoryNonProportional ">Person</span> object is being validated.</p></li><li><p class="Para" id="Par61">The <span class="EmphasisFontCategoryNonProportional ">description</span> keyword provides a description of the <span class="EmphasisFontCategoryNonProportional ">Person</span> object. As with <span class="EmphasisFontCategoryNonProportional ">title</span>, <span class="EmphasisFontCategoryNonProportional ">description</span> adds no constraint to the data being validated.</p></li><li><p class="Para" id="Par62">The <span class="EmphasisFontCategoryNonProportional ">type</span> keyword signifies that the containing object is a JSON object (via the <span class="EmphasisFontCategoryNonProportional ">object</span> value). Also, it identifies property types (such as <span class="EmphasisFontCategoryNonProportional ">string</span> and <span class="EmphasisFontCategoryNonProportional ">number</span>).</p></li><li><p class="Para" id="Par63">The <span class="EmphasisFontCategoryNonProportional ">properties</span> keyword introduces an array of the properties that can appear in the JSON object. These properties are identified as <span class="EmphasisFontCategoryNonProportional ">name</span> and <span class="EmphasisFontCategoryNonProportional ">age</span>. Each property is further described by an object that provides a <span class="EmphasisFontCategoryNonProportional ">description</span> keyword to describe the property and a <span class="EmphasisFontCategoryNonProportional ">type</span> keyword to identify the type of value that can be assigned to the property. This is a constraint: you must assign a string to <span class="EmphasisFontCategoryNonProportional ">name</span> and a number to <span class="EmphasisFontCategoryNonProportional ">age</span>. For the <span class="EmphasisFontCategoryNonProportional ">age</span> property, <span class="EmphasisFontCategoryNonProportional ">minimum</span> and <span class="EmphasisFontCategoryNonProportional ">maximum</span> keywords are specified to provide additional constraints: the number assigned to <span class="EmphasisFontCategoryNonProportional ">age</span> must range from <span class="EmphasisFontCategoryNonProportional ">18</span> through <span class="EmphasisFontCategoryNonProportional ">64</span>.</p></li><li><p class="Para" id="Par64">The <span class="EmphasisFontCategoryNonProportional ">required</span> keyword introduces an array that identifies those properties that must be present in the JSON object. In the example, both <span class="EmphasisFontCategoryNonProportional ">name</span> and <span class="EmphasisFontCategoryNonProportional ">age</span> are required properties.</p></li></ul></div></div><p class="Para" id="Par65">The JSON Schema website provides links to various validator implementations for different programming languages (see <span class="ExternalRef"><a href="http://json-schema.org/implementations.html"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional ">http://json-schema.org/implementations.html</span>
                </span></a></span>). You can download an implementation and integrate it into your application, subject to license requirements. For this chapter, I chose to use an online tool called <span id="ITerm37">JSON Schema Validator</span> (<span class="ExternalRef"><a href="http://www.jsonschemavalidator.net/"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional ">www.jsonschemavalidator.net</span>
                </span></a></span>) to demonstrate validation.</p><div class="Para" id="Par66">Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_7_Chapter.xhtml#Fig1">7-1</a></span> shows the previous JSON object and schema in the appropriate windows of the JSON Schema Validator online tool.<figure class="Figure" id="Fig1"><div class="MediaObject" id="MO1"><img alt="../images/394211_2_En_7_Chapter/394211_2_En_7_Fig1_HTML.jpg" data-mfp-src="/library/view/java-xml-and/9781484243305/images/394211_2_En_7_Chapter/394211_2_En_7_Fig1_HTML.jpg" height="1300" src="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/images/394211_2_En_7_Chapter/394211_2_En_7_Fig1_HTML.jpg" style="height:32.5em" width="1725"/></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 7-1</span><p class="SimplePara">The schema is valid and the JSON object conforms to this <span id="ITerm38">schema</span></p></div></figcaption></figure></div><div class="Para" id="Par67">Let鈥檚 make some changes to the JSON object so that it no longer conforms to the schema, and see how the JSON Schema Validator tool responds. First, we鈥檒l assign <span class="EmphasisFontCategoryNonProportional ">65</span> to <span class="EmphasisFontCategoryNonProportional ">age</span>, which exceeds the <span class="EmphasisFontCategoryNonProportional ">maximum</span> constraint for the <span class="EmphasisFontCategoryNonProportional ">age</span> property. Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_7_Chapter.xhtml#Fig2">7-2</a></span> shows the result.<figure class="Figure" id="Fig2"><div class="MediaObject" id="MO2"><img alt="../images/394211_2_En_7_Chapter/394211_2_En_7_Fig2_HTML.jpg" data-mfp-src="/library/view/java-xml-and/9781484243305/images/394211_2_En_7_Chapter/394211_2_En_7_Fig2_HTML.jpg" height="1299" src="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/images/394211_2_En_7_Chapter/394211_2_En_7_Fig2_HTML.jpg" style="height:32.48em" width="1725"/></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 7-2</span><p class="SimplePara">JSON Schema Validator changes its message color to red to signify an <span id="ITerm39">error</span> and also identifies the property and constraint that鈥檚 been violated</p></div></figcaption></figure></div><div class="Para" id="Par68">Next, we鈥檒l restore <span class="EmphasisFontCategoryNonProportional ">age</span>鈥檚 value to <span class="EmphasisFontCategoryNonProportional ">35</span>, but surround it with double quotes. This changes the type from number to string. See Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_7_Chapter.xhtml#Fig3">7-3</a></span> for the result.<figure class="Figure" id="Fig3"><div class="MediaObject" id="MO3"><img alt="../images/394211_2_En_7_Chapter/394211_2_En_7_Fig3_HTML.jpg" data-mfp-src="/library/view/java-xml-and/9781484243305/images/394211_2_En_7_Chapter/394211_2_En_7_Fig3_HTML.jpg" height="1299" src="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/images/394211_2_En_7_Chapter/394211_2_En_7_Fig3_HTML.jpg" style="height:32.48em" width="1725"/></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 7-3</span><p class="SimplePara">JSON Schema Validator reports that the <span class="EmphasisFontCategoryNonProportional ">age</span> property has the wrong <span id="ITerm40">type</span></p></div></figcaption></figure></div><div class="Para" id="Par69">Finally, we鈥檒l restore <span class="EmphasisFontCategoryNonProportional ">age</span>鈥檚 value to <span class="EmphasisFontCategoryNonProportional ">35</span>, but eliminate the <span class="EmphasisFontCategoryNonProportional ">name</span> property. Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_7_Chapter.xhtml#Fig4">7-4</a></span> shows JSON Schema Validator鈥檚 response.<figure class="Figure" id="Fig4"><div class="MediaObject" id="MO4"><img alt="../images/394211_2_En_7_Chapter/394211_2_En_7_Fig4_HTML.jpg" data-mfp-src="/library/view/java-xml-and/9781484243305/images/394211_2_En_7_Chapter/394211_2_En_7_Fig4_HTML.jpg" height="1299" src="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/images/394211_2_En_7_Chapter/394211_2_En_7_Fig4_HTML.jpg" style="height:32.48em" width="1725"/></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 7-4</span><p class="SimplePara">JSON Schema Validator reports that the <span class="EmphasisFontCategoryNonProportional ">name</span> property is <span id="ITerm41">required</span></p></div></figcaption></figure></div><p class="Para" id="Par70">Check out 鈥淛SON Schema: A Media Type for Describing JSON Documents鈥?(<span class="ExternalRef"><a href="https://datatracker.ietf.org/doc/draft-handrews-json-schema/"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional ">https://datatracker.ietf.org/doc/draft-handrews-json-schema/</span>
                </span></a></span>) and the other Internet-Draft documents accessible from the JSON Schema website (<span class="ExternalRef"><a href="http://json-schema.org/"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional ">http://json-schema.org</span>
                </span></a></span>) to learn more about JSON Schema.</p><div class="FormalPara FormalParaRenderingStyle3 ParaTypeOverview" id="FPar8"><h3 class="Heading">Exercises</h3><div class="Para" id="Par71">The following exercises are designed to test your understanding of Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_7_Chapter.xhtml"><span class="RefSource">7</span></a></span>鈥檚 content:<div class="OrderedList"><ol><li class="ListItem"><span class="ItemNumber">1.</span><div class="ItemContent"><p class="Para" id="Par72">Define JSON.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">2.</span><div class="ItemContent"><p class="Para" id="Par73">True or false: JSON is derived from a strict subset of JavaScript.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">3.</span><div class="ItemContent"><p class="Para" id="Par74">How does the JSON data format present a JSON object?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">4.</span><div class="ItemContent"><p class="Para" id="Par75">Identify the six types that JSON supports.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">5.</span><div class="ItemContent"><p class="Para" id="Par76">True or false: JSON doesn鈥檛 support comments.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">6.</span><div class="ItemContent"><p class="Para" id="Par77">How would you parse a JSON object into an equivalent JavaScript object?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">7.</span><div class="ItemContent"><p class="Para" id="Par78">Define JSON Schema.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">8.</span><div class="ItemContent"><p class="Para" id="Par79">When creating a schema, how do you identify those properties that must be present in those JSON objects that the schema validates?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">9.</span><div class="ItemContent"><p class="Para" id="Par80">Declare a JSON object for a product in terms of <span class="EmphasisFontCategoryNonProportional ">name</span> and <span class="EmphasisFontCategoryNonProportional ">price</span> properties. Set the <span class="EmphasisFontCategoryNonProportional ">name</span> to <span class="EmphasisFontCategoryNonProportional ">hammer</span> and the <span class="EmphasisFontCategoryNonProportional ">price</span> to <span class="EmphasisFontCategoryNonProportional ">20</span>.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">10.</span><div class="ItemContent"><p class="Para" id="Par81">Declare a schema for validating the previous JSON object. The schema should constrain <span class="EmphasisFontCategoryNonProportional ">name</span> to be a <span class="EmphasisFontCategoryNonProportional ">string</span>, <span class="EmphasisFontCategoryNonProportional ">price</span> to be a <span class="EmphasisFontCategoryNonProportional ">number</span>, <span class="EmphasisFontCategoryNonProportional ">price</span> to be at least <span class="EmphasisFontCategoryNonProportional ">1</span> dollar, and <span class="EmphasisFontCategoryNonProportional ">name</span> and <span class="EmphasisFontCategoryNonProportional ">price</span> to be present in the object. Use JSON Schema Validator to verify the schema and JSON object.</p></div><div class="ClearBoth"> </div></li></ol></div></div></div></section><section class="Section1 RenderAsSection1" id="Sec5"><h2 class="Heading">Summary</h2><p class="Para" id="Par82">JSON is a language-independent data format that expresses JSON objects as human-readable lists of properties. Although derived from JavaScript, code to parse JSON objects into equivalent language-dependent objects is available in many programming languages.</p><p class="Para" id="Par83">The JSON data format presents a JSON object as a brace-delimited and comma-separated list of properties. For each property, the name is expressed as a doubly quoted string. The name string is followed by a colon character, which is followed by a value of a specific JSON type.</p><p class="Para" id="Par84">JSON supports six types: number, string, Boolean, array, object, and null. JSON Schema also recognizes an integer type.</p><p class="Para" id="Par85">Whitespace is allowed and ignored around or between syntactic elements (values and punctuation). Four specific characters are considered whitespace for this purpose: space, horizontal tab, line feed, and carriage return. Also, JSON doesn鈥檛 support comments.</p><p class="Para" id="Par86">Java doesn鈥檛 provide a standard JSON API. One way to explore JSON in a Java context is to leverage Java鈥檚 Scripting API.</p><p class="Para" id="Par87">It鈥檚 often necessary for applications to validate JSON objects, to ensure that required properties are present and that additional constraints (such as a price never being less than <span class="EmphasisFontCategoryNonProportional ">1</span> dollar) are met. JSON Schema is a grammar language that lets you accomplish validation.</p><p class="Para" id="Par88">JSON Schema lets you define the structure, content, and (to some extent) semantics of JSON objects. Furthermore, it lets you specify metadata about what an object鈥檚 properties mean and what values are valid for those properties. The result of applying the grammar language is a schema that describes the set of JSON objects that are valid according to the schema.</p><p class="Para" id="Par89">Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_8_Chapter.xhtml"><span class="RefSource">8</span></a></span> introduces mJson for parsing and creating JSON objects.</p></section></div><div class="annotator-outer annotator-viewer viewer annotator-hide"> </div></div></div>
    </section>
  </div>
</div>

<hr/>

<!--if IE]><![endif]--><!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/java-xml-and/9781484243305/html/394211_2_En_8_Chapter.xhtml"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="3866890"
  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"
  data-username="levinxccai"
  data-account-type="B2B"
  
  data-activated-trial-date="11/06/2017"


  data-archive="9781484243305"
  data-publishers="Apress"



  data-htmlfile-name="394211_2_En_8_Chapter.xhtml"
  data-epub-title="Java XML and JSON: Document Processing for Java SE" data-debug=0 data-testing=0><![endif]--><!--if gt IE 8]><!--><!--![endif]-->



<a name="10_"></a>

<div class="application" id="container" style="height: auto;">
  <div class="js-toc">
    <section role="document">
      <div id="sbo-rt-content" style="max-width:72.5em; transform: none;"><div class="annotator-wrapper"><!--egin Abstract--><div class="MainTitleSection"><h1 class="ChapterTitle" lang="en">8. Parsing and Creating JSON Objects with mJson</h1></div><div class="AuthorGroup"><div class="AuthorNames"><span class="Author"><span class="AuthorName">Jeff Friesen</span><sup><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_8_Chapter.xhtml#Aff2">1</a> <span class="ContactIcon"></span></sup></span></div><div class="Affiliations"><div class="Affiliation" id="Aff2"><span class="AffiliationNumber">(1)</span><div class="AffiliationText">Dauphin, MB, Canada</div></div><div class="ClearBoth"> </div></div></div><!--nd Abstract--><div class="Fulltext"><p class="Para" id="Par2">Many third-party APIs are available for parsing and creating JSON objects. Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_8_Chapter.xhtml"><span class="RefSource">8</span></a></span> explores one of the simplest of these APIs: mJson.</p><section class="Section1 RenderAsSection1" id="Sec1"><h2 class="Heading">What Is mJson?</h2><div class="Para" id="Par3"><em class="EmphasisTypeItalic ">mJson</em> is a small Java JSON library (created by developer Borislav Lordanov) for parsing JSON objects into Java objects and vice versa. This library is documented on GitHub (<span class="ExternalRef"><a href="http://bolerio.github.io/mjson"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional ">http://bolerio.github.io/mjson</span>
                </span></a></span><span class="EmphasisFontCategoryNonProportional ">/</span>), which reveals the following <span id="ITerm1">features</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par4">Full support for JSON Schema Draft 4 validation</p></li><li><p class="Para" id="Par5">Single universal type鈥攅verything is a <span class="EmphasisFontCategoryNonProportional ">Json</span> object; there is no type casting</p></li><li><p class="Para" id="Par6">Single factory method for converting a Java object to a <span class="EmphasisFontCategoryNonProportional ">Json</span> object; just call <span class="EmphasisFontCategoryNonProportional ">Json.make(</span><em class="EmphasisTypeItalic EmphasisFontCategoryNonProportional ">any Java object here</em>)</p></li><li><p class="Para" id="Par7">Fast, hand-coded parsing</p></li><li><p class="Para" id="Par8">Designed as a general purpose data structure for use in Java</p></li><li><p class="Para" id="Par9">Parent pointers and <span class="EmphasisFontCategoryNonProportional ">up()</span> method to traverse the JSON structure</p></li><li><p class="Para" id="Par10">Concise methods to read (<span class="EmphasisFontCategoryNonProportional ">Json.at()</span>), modify (<span class="EmphasisFontCategoryNonProportional ">Json.set()</span>, <span class="EmphasisFontCategoryNonProportional ">Json.add()</span>), duplicate (<span class="EmphasisFontCategoryNonProportional ">Json.dup()</span>), and merge (<span class="EmphasisFontCategoryNonProportional ">Json.with()</span>)</p></li><li><p class="Para" id="Par11">Flexible merging of deep structures (<span class="ExternalRef"><a href="http://github.com/bolerio/mjson/wiki/Deep-Merging"><span class="RefSource">
                        <span class="EmphasisFontCategoryNonProportional ">http://github.com/bolerio/mjson/wiki/Deep-Merging</span>
                      </span></a></span>)</p></li><li><p class="Para" id="Par12">Methods for type-checking (e.g., <span class="EmphasisFontCategoryNonProportional ">Json.isString()</span>) and access to underlying Java value (e.g., <span class="EmphasisFontCategoryNonProportional ">Json.asString()</span>)</p></li><li><p class="Para" id="Par13">Method chaining</p></li><li><p class="Para" id="Par14">Pluggable factory to build your own support for arbitrary Java-Json mapping</p></li><li><p class="Para" id="Par15">Entire library located in one Java file鈥攏o external dependencies</p></li></ul></div></div><p class="Para" id="Par16">Unlike with other <span id="ITerm2">JSON</span> libraries, mJson focuses on manipulating JSON structures in Java without mapping them to strongly typed Java objects. As a result, mJson reduces verbosity and lets you work with JSON in Java as naturally as in JavaScript.</p><section class="Section2 RenderAsSection2" id="Sec2"><h3 class="Heading">Obtaining and Using mJson</h3><p class="Para" id="Par17">mJson is distributed as a single JAR file; <span class="EmphasisFontCategoryNonProportional ">mjson-1.4.0.jar</span> is the most recent JAR file at the time of <span id="ITerm3">writing</span>. To obtain this JAR file, point your browser to <span class="ExternalRef"><a href="http://repo1.maven.org/maven2/org/sharegov/mjson/1.4.0/mjson-1.4.0.jar"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://repo1.maven.org/maven2/org/sharegov/mjson/1.4.0/mjson-1.4.0.jar</span>
                  </span></a></span>.</p><p class="Para" id="Par18"><span class="EmphasisFontCategoryNonProportional ">mjson-1.4.0.jar</span> contains a <span class="EmphasisFontCategoryNonProportional ">Json</span> classfile and other classfiles that describe package-private classes nested within the <span class="EmphasisFontCategoryNonProportional ">Json</span> class. Furthermore, this JAR file reveals that <span class="EmphasisFontCategoryNonProportional ">Json</span> is located in the <span class="EmphasisFontCategoryNonProportional ">mjson</span> package.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar1"><h3 class="Heading">Note</h3><p class="Para" id="Par19">mJson is licensed according to Apache License Version 2.0 (<span class="ExternalRef"><a href="http://www.apache.org/licenses"><span class="RefSource">
                      <span class="EmphasisFontCategoryNonProportional ">www.apache.org/licenses</span>
                    </span></a></span><span class="EmphasisFontCategoryNonProportional ">/</span>).</p></div><div class="Para" id="Par20">It鈥檚 easy to work with <span class="EmphasisFontCategoryNonProportional ">mjson-1.4.0.jar</span>. Simply include it in the CLASSPATH when compiling source code or running an application, as follows:<div class="ProgramCode" id="PC1"><div class="LineGroup"><div class="FixedLine">javac -cp mjson-1.4.0.jar <em class="EmphasisTypeItalic ">source file</em></div><div class="FixedLine">java -cp mjson-1.4.0.jar;. <em class="EmphasisTypeItalic ">main classfile</em></div></div></div></div></section></section><section class="Section1 RenderAsSection1" id="Sec3"><h2 class="Heading">Exploring the Json Class</h2><p class="Para" id="Par21">The <span class="EmphasisFontCategoryNonProportional ">Json</span> class describes a JSON object or part of a JSON object. It contains <span class="EmphasisFontCategoryNonProportional ">Schema</span> and <span class="EmphasisFontCategoryNonProportional ">Factory</span> interfaces, more than 50 methods, and other members. This section explores many of these methods along with <span class="EmphasisFontCategoryNonProportional ">Schema</span> and <span class="EmphasisFontCategoryNonProportional ">Factory</span>.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar2"><h3 class="Heading">Note</h3><p class="Para" id="Par22">The API documentation for the <span class="EmphasisFontCategoryNonProportional ">Json</span> class is located at <span class="ExternalRef"><a href="http://bolerio.github.io/mjson/apidocs/index.html"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://bolerio.github.io/mjson/apidocs/index.html</span>
                  </span></a></span>.</p></div><section class="Section2 RenderAsSection2" id="Sec4"><h3 class="Heading">Creating Json Objects</h3><div class="Para" id="Par23"><span class="EmphasisFontCategoryNonProportional ">Json</span> declares several <span class="EmphasisFontCategoryNonProportional ">static</span> methods that <span id="ITerm4">create</span> and return <span class="EmphasisFontCategoryNonProportional ">Json</span> objects. Three of these methods read and <span id="ITerm5">parse</span> an external JSON object:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par24"><span class="EmphasisFontCategoryNonProportional ">Json read(String s)</span>: Read a JSON object from the string that was passed to <span class="EmphasisFontCategoryNonProportional ">s</span> (of type <span class="EmphasisFontCategoryNonProportional ">java.lang.String</span>) and parse this object.</p></li><li><p class="Para" id="Par25"><span class="ExternalRef"><a href="http://bolerio.github.io/mjson/apidocs/mjson/Json.html"><span class="RefSource">
                          <span class="EmphasisFontCategoryNonProportional ">Json</span>
                        </span></a></span>
<span class="EmphasisFontCategoryNonProportional ">read(URL url)</span>: Read a JSON object from the <span id="ITerm6">Uniform Resource Locator (URL)</span> passed to <span class="EmphasisFontCategoryNonProportional ">url</span> (of <span class="EmphasisFontCategoryNonProportional ">type java.net.URL</span>) and parse this object.</p></li><li><p class="Para" id="Par26"><span class="ExternalRef"><a href="http://bolerio.github.io/mjson/apidocs/mjson/Json.html"><span class="RefSource">
                          <span class="EmphasisFontCategoryNonProportional ">Json</span>
                        </span></a></span>
<span class="EmphasisFontCategoryNonProportional ">read(CharacterIterator ci)</span>: Read a JSON object from the character iterator passed to <span class="EmphasisFontCategoryNonProportional ">ci</span> (of type <span class="EmphasisFontCategoryNonProportional ">java.text.CharacterIterator</span>) and parse this object.</p></li></ul></div></div><p class="Para" id="Par27">Each method returns a <span class="EmphasisFontCategoryNonProportional ">Json</span> object that describes the parsed JSON object.</p><div class="Para" id="Par28">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_8_Chapter.xhtml#PC2">8-1</a></span> presents the source code to an application that demonstrates the <span class="EmphasisFontCategoryNonProportional ">read(String)</span> method.<div class="ProgramCode" id="PC2"><div class="LineGroup"><div class="FixedLine">import mjson.Json;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class mJsonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      String jsonStr =</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;\&quot;firstName\&quot;: \&quot;John\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;lastName\&quot;: \&quot;Smith\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;isAlive\&quot;: true,&quot; +</div><div class="FixedLine">      &quot;\&quot;age\&quot;: 25,&quot; +</div><div class="FixedLine">      &quot;\&quot;address\&quot;:&quot; +</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;\&quot;streetAddress\&quot;: \&quot;21 2nd Street\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;city\&quot;: \&quot;New York\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;state\&quot;: \&quot;NY\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;postalCode\&quot;: \&quot;10021-3100\&quot;&quot; +</div><div class="FixedLine">      &quot;},&quot; +</div><div class="FixedLine">      &quot;\&quot;phoneNumbers\&quot;:&quot; +</div><div class="FixedLine">      &quot;[&quot; +</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;\&quot;type\&quot;: \&quot;home\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;number\&quot;: \&quot;212 555-1234\&quot;&quot; +</div><div class="FixedLine">      &quot;},&quot; +</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;\&quot;type\&quot;: \&quot;office\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;number\&quot;: \&quot;646 555-4567\&quot;&quot; +</div><div class="FixedLine">      &quot;}&quot; +</div><div class="FixedLine">      &quot;],&quot; +</div><div class="FixedLine">      &quot;\&quot;children\&quot;: [],&quot; +</div><div class="FixedLine">      &quot;\&quot;spouse\&quot;: null&quot; +</div><div class="FixedLine">      &quot;}&quot;;</div><div class="FixedLine">      Json json = Json.read(jsonStr);</div><div class="FixedLine">      out.println(json);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-1</span><p class="SimplePara">Reading and Parsing a String-Based JSON Object</p></div></div></div></div><p class="Para" id="Par29">The <span class="EmphasisFontCategoryNonProportional ">main(String[])</span> method first declares a Java string-based JSON object. It then invokes <span class="EmphasisFontCategoryNonProportional ">Json.read()</span> to read and parse this object, and return the object as a <span class="EmphasisFontCategoryNonProportional ">Json</span> object. Finally, <span class="EmphasisFontCategoryNonProportional ">main()</span> outputs a string representation of the <span class="EmphasisFontCategoryNonProportional ">Json</span> object (<span class="EmphasisFontCategoryNonProportional ">Json</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">toString()</span> method is called behind the scenes to convert the <span class="EmphasisFontCategoryNonProportional ">Json</span> object to a Java string).</p><div class="Para" id="Par30">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_8_Chapter.xhtml#PC2">8-1</a></span> as follows:<div class="ProgramCode" id="PC3"><div class="LineGroup"><div class="FixedLine">javac -cp mjson-1.4.0.jar mJsonDemo.java</div></div></div></div><div class="Para" id="Par31">Run the resulting application as follows:<div class="ProgramCode" id="PC4"><div class="LineGroup"><div class="FixedLine">java -cp mjson-1.4.0.jar;. mJsonDemo</div></div></div></div><div class="Para" id="Par32">You should observe the following output:<div class="ProgramCode" id="PC5"><div class="LineGroup"><div class="FixedLine">{&quot;firstName&quot;:&quot;John&quot;,&quot;lastName&quot;:&quot;Smith&quot;,&quot;isAlive&quot;:true,&quot;address&quot;:{&quot;streetAddress&quot;:&quot;21 2nd Street&quot;,&quot;city&quot;:&quot;New York&quot;,&quot;postalCode&quot;:&quot;10021-3100&quot;,&quot;state&quot;:&quot;NY&quot;},&quot;children&quot;:[],&quot;age&quot;:25,&quot;phoneNumbers&quot;:[{&quot;number&quot;:&quot;212 555-1234&quot;,&quot;type&quot;:&quot;home&quot;},{&quot;number&quot;:&quot;646 555-4567&quot;,&quot;type&quot;:&quot;office&quot;}],&quot;spouse&quot;:null}</div></div></div></div><div class="Para" id="Par33">The <span class="EmphasisFontCategoryNonProportional ">read()</span> methods can also parse smaller JSON fragments, such as an array of different-typed values. See Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_8_Chapter.xhtml#PC6">8-2</a></span> for a demonstration.<div class="ProgramCode" id="PC6"><div class="LineGroup"><div class="FixedLine">import mjson.Json;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class mJsonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      Json json =</div><div class="FixedLine">         Json.read(&quot;[4, 5, {}, true, null, \&quot;ABC\&quot;, 6]&quot;);</div><div class="FixedLine">      out.println(json);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-2</span><p class="SimplePara">Reading and Parsing a JSON Fragment</p></div></div></div></div><div class="Para" id="Par34">When you run this application, you should observe the following output:<div class="ProgramCode" id="PC7"><div class="LineGroup"><div class="FixedLine">[4,5,{},true,null,&quot;ABC&quot;,6]</div></div></div></div><div class="Para" id="Par35">In addition to the reading and parsing methods, <span class="EmphasisFontCategoryNonProportional ">Json</span> provides <span class="EmphasisFontCategoryNonProportional ">static</span> methods<span id="ITerm7">
                  
                  
                  
                </span> for creating <span class="EmphasisFontCategoryNonProportional ">Json</span> objects:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par36"><span class="EmphasisFontCategoryNonProportional ">Json array()</span>: Return a <span class="EmphasisFontCategoryNonProportional ">Json</span> object representing an empty JSON array.</p></li><li><p class="Para" id="Par37"><span class="EmphasisFontCategoryNonProportional ">Json array(Object... args)</span>: Return a <span class="EmphasisFontCategoryNonProportional ">Json</span> object (representing a JSON array) filled with <span class="EmphasisFontCategoryNonProportional ">args</span>, a variable number of <span class="EmphasisFontCategoryNonProportional ">java.lang.Object</span>s.</p></li><li><p class="Para" id="Par38"><span class="EmphasisFontCategoryNonProportional ">Json make(Object anything)</span>: Return a <span class="EmphasisFontCategoryNonProportional ">Json</span> object filled with the contents of <span class="EmphasisFontCategoryNonProportional ">anything</span>, which is one of <span class="EmphasisFontCategoryNonProportional ">null</span>; a value of type <span class="EmphasisFontCategoryNonProportional ">Json</span>, <span class="EmphasisFontCategoryNonProportional ">String</span>, <span class="EmphasisFontCategoryNonProportional ">java.util.Collection&lt;?&gt;</span>, <span class="EmphasisFontCategoryNonProportional ">java.util.Map&lt;?, ?&gt;</span>, <span class="EmphasisFontCategoryNonProportional ">java.lang.Boolean</span>, <span class="EmphasisFontCategoryNonProportional ">java.lang.Number</span>; or an array of one of these types. Maps, collections, and arrays are recursively copied such that each of their elements is converted to a <span class="EmphasisFontCategoryNonProportional ">Json</span> object. A map鈥檚 keys are normally strings, but any object with a meaningful <span class="EmphasisFontCategoryNonProportional ">toString()</span> implementation will work. This method throws <span class="EmphasisFontCategoryNonProportional ">java.lang.IllegalArgumentException</span> when the concrete type of the argument passed to <span class="EmphasisFontCategoryNonProportional ">anything</span> is unknown.</p></li><li><p class="Para" id="Par39"><span class="EmphasisFontCategoryNonProportional ">Json nil()</span>: Return a <span class="EmphasisFontCategoryNonProportional ">Json</span> object that represents <span class="EmphasisFontCategoryNonProportional ">null</span>.</p></li><li><p class="Para" id="Par40"><span class="EmphasisFontCategoryNonProportional ">Json object()</span>: Return a <span class="EmphasisFontCategoryNonProportional ">Json</span> object representing an empty JSON object.</p></li><li><p class="Para" id="Par41"><span class="EmphasisFontCategoryNonProportional ">Json object(Object... args)</span>: Return a <span class="EmphasisFontCategoryNonProportional ">Json</span> object (representing a JSON object) filled with <span class="EmphasisFontCategoryNonProportional ">args</span>, a variable number of <span class="EmphasisFontCategoryNonProportional ">Object</span>s. These objects identify property names and values; the number of objects must be even, with even indexes identifying property names and odd indexes identifying property values. The names are normally of type <span class="EmphasisFontCategoryNonProportional ">String</span> but can be of any other type that has an appropriate <span class="EmphasisFontCategoryNonProportional ">toString()</span> method. Each value is first converted to a <span class="EmphasisFontCategoryNonProportional ">Json</span> object<span id="ITerm8">
                        
                        
                        
                      </span> by calling <span class="EmphasisFontCategoryNonProportional ">make(Object)</span>.</p></li></ul></div></div><div class="Para" id="Par42">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_8_Chapter.xhtml#PC8">8-3</a></span> presents the source code to an application that demonstrates most of these additional <span class="EmphasisFontCategoryNonProportional ">static</span> methods.<div class="ProgramCode" id="PC8"><div class="LineGroup"><div class="FixedLine">import mjson.Json;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class mJsonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      Json jsonAddress =</div><div class="FixedLine">         Json.object(&quot;streetAddress&quot;, &quot;21 2nd Street&quot;,</div><div class="FixedLine">                     &quot;city&quot;, &quot;New York&quot;,</div><div class="FixedLine">                     &quot;state&quot;, &quot;NY&quot;,</div><div class="FixedLine">                     &quot;postalCode&quot;, &quot;10021-3100&quot;);</div><div class="FixedLine">      Json jsonPhone1 =</div><div class="FixedLine">         Json.object(&quot;type&quot;, &quot;home&quot;,</div><div class="FixedLine">                     &quot;number&quot;, &quot;212 555-1234&quot;);</div><div class="FixedLine">      Json jsonPhone2 =</div><div class="FixedLine">         Json.object(&quot;type&quot;, &quot;office&quot;,</div><div class="FixedLine">                     &quot;number&quot;, &quot;646 555-4567&quot;);</div><div class="FixedLine">      Json jsonPerson =</div><div class="FixedLine">         Json.object(&quot;firstName&quot;, &quot;John&quot;,</div><div class="FixedLine">                     &quot;lastName&quot;, &quot;Smith&quot;,</div><div class="FixedLine">                     &quot;isAlive&quot;, true,</div><div class="FixedLine">                     &quot;age&quot;, 25,</div><div class="FixedLine">                     &quot;address&quot;, jsonAddress,</div><div class="FixedLine">                     &quot;phoneNumbers&quot;, Json.array(jsonPhone1,</div><div class="FixedLine">                                                jsonPhone2),</div><div class="FixedLine">                     &quot;children&quot;, Json.array(),</div><div class="FixedLine">                     &quot;spouse&quot;, Json.nil());</div><div class="FixedLine">      out.println(jsonPerson);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-3</span><p class="SimplePara">Creating a Person JSON Object</p></div></div></div></div><p class="Para" id="Par43">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_8_Chapter.xhtml#PC8">8-3</a></span> describes an application that creates the same JSON <span id="ITerm9">object</span> that鈥檚 read and parsed in Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_8_Chapter.xhtml#PC2">8-1</a></span>. Notice that you can pass <span class="EmphasisFontCategoryNonProportional ">Json</span> objects to <span class="EmphasisFontCategoryNonProportional ">array(Object...)</span> and <span class="EmphasisFontCategoryNonProportional ">object(Object...)</span>, which lets you build complete JSON objects from smaller fragments. If you run this application, you鈥檒l discover the same output as generated by the application described in Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_8_Chapter.xhtml#PC2">8-1</a></span>.</p><div class="Para" id="Par44">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_8_Chapter.xhtml#PC9">8-4</a></span> presents the source code to another application that uses <span class="EmphasisFontCategoryNonProportional ">make(Object)</span> with Java collections and maps.<div class="ProgramCode" id="PC9"><div class="LineGroup"><div class="FixedLine">import java.util.ArrayList;</div><div class="FixedLine">import java.util.Arrays;</div><div class="FixedLine">import java.util.HashMap;</div><div class="FixedLine">import java.util.List;</div><div class="FixedLine">import java.util.Map;</div></div><div class="LineGroup"><div class="FixedLine">import mjson.Json;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class mJsonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      List&lt;String&gt; weekdays =</div><div class="FixedLine">         Arrays.asList(&quot;Sunday&quot;, &quot;Monday&quot;, &quot;Tuesday&quot;,</div><div class="FixedLine">                       &quot;Wednesday&quot;, &quot;Thursday&quot;, &quot;Friday&quot;,</div><div class="FixedLine">                       &quot;Saturday&quot;);</div><div class="FixedLine">      out.println(Json.make(weekdays));</div></div><div class="LineGroup"><div class="FixedLine">      Map&lt;String, Number&gt; people = new HashMap&lt;&gt;();</div><div class="FixedLine">      people.put(&quot;John&quot;, 33);</div><div class="FixedLine">      people.put(&quot;Joan&quot;, 27);</div><div class="FixedLine">      out.println(Json.make(people));</div></div><div class="LineGroup"><div class="FixedLine">      Map&lt;String, String[]&gt; planets = new HashMap&lt;&gt;();</div><div class="FixedLine">      planets.put(&quot;Mercury&quot;, null);</div><div class="FixedLine">      planets.put(&quot;Earth&quot;, new String[] {&quot;Luna&quot;});</div><div class="FixedLine">      planets.put(&quot;Mars&quot;, new String[] {&quot;Phobos&quot;,</div><div class="FixedLine">                                        &quot;Deimos&quot;});</div><div class="FixedLine">      out.println(Json.make(planets)) <span id="ITerm10">
                        
                        
                        
                      </span>;</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-4</span><p class="SimplePara">Making JSON Objects from <span id="ITerm11">Java Collections and Maps</span></p></div></div></div></div><p class="Para" id="Par45"><span class="EmphasisFontCategoryNonProportional ">main(String[])</span> first creates a list of weekday names and then passes this object to <span class="EmphasisFontCategoryNonProportional ">make(Object)</span>, whose returned <span class="EmphasisFontCategoryNonProportional ">Json</span> object is output. Next, a map of people names and ages is created and subsequently passed to <span class="EmphasisFontCategoryNonProportional ">make(Object)</span>. The resulting JSON object is output. Finally, a map of planet names along with arrays of moon names is created. This map is converted into a more complex JSON object, which is output.</p><div class="Para" id="Par46">If you compile this source code and run the application, you鈥檒l discover the following output:<div class="ProgramCode" id="PC10"><div class="LineGroup"><div class="FixedLine">[&quot;Sunday&quot;,&quot;Monday&quot;,&quot;Tuesday&quot;,&quot;Wednesday&quot;,&quot;Thursday&quot;,&quot;Friday&quot;,&quot;Saturday&quot;]</div><div class="FixedLine">{&quot;Joan&quot;:27,&quot;John&quot;:33}</div><div class="FixedLine">{&quot;Earth&quot;:[&quot;Luna&quot;],&quot;Mars&quot;:[&quot;Phobos&quot;,&quot;Deimos&quot;],&quot;Mercury&quot;:null}</div></div></div></div></section><section class="Section2 RenderAsSection2" id="Sec5"><h3 class="Heading">Learning About Json Objects</h3><p class="Para" id="Par47"><span class="EmphasisFontCategoryNonProportional ">Json</span> offers several methods for <span id="ITerm12">learning</span> about the JSON entities described by <span class="EmphasisFontCategoryNonProportional ">Json</span> objects. For starters, you can call the <span class="EmphasisFontCategoryNonProportional ">Object getValue()</span> method to return the JSON value (as a Java object) of the <span class="EmphasisFontCategoryNonProportional ">Json</span> object. The returned value will be Java <span class="EmphasisFontCategoryNonProportional ">null</span> or have the Java <span class="EmphasisFontCategoryNonProportional ">Boolean</span>, <span class="EmphasisFontCategoryNonProportional ">String</span>, <span class="EmphasisFontCategoryNonProportional ">Number</span>, <span class="EmphasisFontCategoryNonProportional ">Map</span>, <span class="EmphasisFontCategoryNonProportional ">java.util.List</span>, or an array type. For objects and arrays, this method performs a deep copy of all nested elements.</p><div class="Para" id="Par48">To identify the JSON type of the JSON value, call one of the following <span id="ITerm13">methods</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par49"><span class="EmphasisFontCategoryNonProportional ">boolean isArray()</span>: Return <span class="EmphasisFontCategoryNonProportional ">true</span> for a JSON array value.</p></li><li><p class="Para" id="Par50"><span class="EmphasisFontCategoryNonProportional ">boolean isBoolean()</span>: Return <span class="EmphasisFontCategoryNonProportional ">true</span> for a JSON Boolean value.</p></li><li><p class="Para" id="Par51"><span class="EmphasisFontCategoryNonProportional ">boolean isNull()</span>: Return <span class="EmphasisFontCategoryNonProportional ">true</span> for the JSON <span class="EmphasisFontCategoryNonProportional ">null</span> value.</p></li><li><p class="Para" id="Par52"><span class="EmphasisFontCategoryNonProportional ">boolean isNumber()</span>: Return <span class="EmphasisFontCategoryNonProportional ">true</span> for a JSON number value.</p></li><li><p class="Para" id="Par53"><span class="EmphasisFontCategoryNonProportional ">boolean isObject()</span>: Return <span class="EmphasisFontCategoryNonProportional ">true</span> for a JSON object value.</p></li><li><p class="Para" id="Par54"><span class="EmphasisFontCategoryNonProportional ">boolean isPrimitive()</span>: Return <span class="EmphasisFontCategoryNonProportional ">true</span> for a JSON number, string, or Boolean value.</p></li><li><p class="Para" id="Par55"><span class="EmphasisFontCategoryNonProportional ">boolean isString()</span>: Return <span class="EmphasisFontCategoryNonProportional ">true</span> for a JSON string value.</p></li></ul></div></div><div class="Para" id="Par56">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_8_Chapter.xhtml#PC11">8-5</a></span> presents the source code to an application that demonstrates <span class="EmphasisFontCategoryNonProportional ">getValue()</span> and these JSON type-identification methods.<div class="ProgramCode" id="PC11"><div class="LineGroup"><div class="FixedLine">import mjson.Json;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class mJsonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      String jsonStr =</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;\&quot;firstName\&quot;: \&quot;John\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;lastName\&quot;: \&quot;Smith\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;isAlive\&quot;: true,&quot; +</div><div class="FixedLine">      &quot;\&quot;age\&quot;: 25,&quot; +</div><div class="FixedLine">      &quot;\&quot;address\&quot;:&quot; +</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;\&quot;streetAddress\&quot;: \&quot;21 2nd Street\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;city\&quot;: \&quot;New York\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;state\&quot;: \&quot;NY\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;postalCode\&quot;: \&quot;10021-3100\&quot;&quot; +</div><div class="FixedLine">      &quot;},&quot; +</div><div class="FixedLine">      &quot;\&quot;phoneNumbers\&quot;:&quot; +</div><div class="FixedLine">      &quot;[&quot; +</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;\&quot;type\&quot;: \&quot;home\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;number\&quot;: \&quot;212 555-1234\&quot;&quot; +</div><div class="FixedLine">      &quot;},&quot; +</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;\&quot;type\&quot;: \&quot;office\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;number\&quot;: \&quot;646 555-4567\&quot;&quot; +</div><div class="FixedLine">      &quot;}&quot; +</div><div class="FixedLine">      &quot;],&quot; +</div><div class="FixedLine">      &quot;\&quot;children\&quot;: [],&quot; +</div><div class="FixedLine">      &quot;\&quot;spouse\&quot;: null&quot; +</div><div class="FixedLine">      &quot;}&quot;;</div><div class="FixedLine">      Json json = Json.read(jsonStr);</div><div class="FixedLine">      out.println(&quot;Value = &quot; + json.getValue());</div><div class="FixedLine">      out.println();</div><div class="FixedLine">      classify(json);</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   static void classify(Json jsonObject)</div><div class="FixedLine">   {</div><div class="FixedLine">      if (jsonObject.isArray())</div><div class="FixedLine">         out.println(&quot;Array&quot;);</div><div class="FixedLine">      else</div><div class="FixedLine">      if (jsonObject.isBoolean())</div><div class="FixedLine">         out.println(&quot;Boolean&quot;);</div><div class="FixedLine">      else</div><div class="FixedLine">      if (jsonObject.isNull())</div><div class="FixedLine">         out.println(&quot;Null&quot;);</div><div class="FixedLine">      else</div><div class="FixedLine">      if (jsonObject.isNumber())</div><div class="FixedLine">         out.println(&quot;Number&quot;);</div><div class="FixedLine">      else</div><div class="FixedLine">      if (jsonObject.isObject())</div><div class="FixedLine">         out.println(&quot;Object&quot;);</div><div class="FixedLine">      else</div><div class="FixedLine">      if (jsonObject.isString())</div><div class="FixedLine">         out.println(&quot;String&quot;);</div><div class="FixedLine">      if (jsonObject.isPrimitive())</div><div class="FixedLine">         out.println(&quot;Primitive&quot;);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-5</span><p class="SimplePara">Obtaining a <span class="EmphasisFontCategoryNonProportional ">Json</span> Object鈥檚 <span id="ITerm14">Value</span> and Identifying Its JSON Type</p></div></div></div></div><div class="Para" id="Par57">Compile this source code and run the application, and you鈥檒l discover the following output:<div class="ProgramCode" id="PC12"><div class="LineGroup"><div class="FixedLine">Value = {firstName=John, lastName=Smith, isAlive=true, address={streetAddress=21 2nd Street, city=New York, postalCode=10021-3100, state=NY}, children=[], age=25, phoneNumbers=[{number=212 555-1234, type=home}, {number=646 555-4567, type=office}], spouse=null}</div></div><div class="LineGroup"><div class="FixedLine">Object</div></div></div></div><div class="Para" id="Par58">After verifying that a <span class="EmphasisFontCategoryNonProportional ">Json</span> object represents the expected JSON type, you can call one of <span class="EmphasisFontCategoryNonProportional ">Json</span>鈥檚 鈥?span class=&quot;EmphasisFontCategoryNonProportional &quot;&gt;as</span>鈥?methods to obtain the JSON value as a Java value of an equivalent <span id="ITerm15">Java type</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par59"><span class="EmphasisFontCategoryNonProportional ">boolean asBoolean()</span>: Return the JSON value as a Java Boolean.</p></li><li><p class="Para" id="Par60"><span class="EmphasisFontCategoryNonProportional ">byte asByte()</span>: Return the JSON value as a Java byte integer.</p></li><li><p class="Para" id="Par61"><span class="EmphasisFontCategoryNonProportional ">char asChar()</span>: Return the first character of the JSON string value as a Java character.</p></li><li><p class="Para" id="Par62"><span class="EmphasisFontCategoryNonProportional ">double asDouble()</span>: Return the JSON value as a Java double precision floating-point value.</p></li><li><p class="Para" id="Par63"><span class="EmphasisFontCategoryNonProportional ">float asFloat()</span>: Return the JSON value as a Java floating-point value.</p></li><li><p class="Para" id="Par64"><span class="EmphasisFontCategoryNonProportional ">int asInteger()</span>: Return the JSON value as a Java integer.</p></li><li><p class="Para" id="Par65"><span class="EmphasisFontCategoryNonProportional ">List&lt;Json&gt; asJsonList()</span>: Return the underlying list representation of a JSON array. The returned list is the actual array representation so any modifications to it are modifications to the <span class="EmphasisFontCategoryNonProportional ">Json</span> object鈥檚 list.</p></li><li><p class="Para" id="Par66"><span class="EmphasisFontCategoryNonProportional ">Map&lt;String, Json&gt; asJsonMap()</span>: Return the underlying map of properties of a JSON object. The returned map is the actual object representation so any modifications to it are modifications to the <span class="EmphasisFontCategoryNonProportional ">Json</span> object鈥檚 map.</p></li><li><p class="Para" id="Par67"><span class="EmphasisFontCategoryNonProportional ">List&lt;Object&gt; asList()</span>: Return a list of the elements of a <span class="EmphasisFontCategoryNonProportional ">Json</span> object that describes a JSON array. The returned list is a copy, and modifications to it don鈥檛 affect the <span class="EmphasisFontCategoryNonProportional ">Json</span> object.</p></li><li><p class="Para" id="Par68"><span class="EmphasisFontCategoryNonProportional ">long asLong()</span>: Return the JSON value as a Java long integer.</p></li><li><p class="Para" id="Par69"><span class="EmphasisFontCategoryNonProportional ">Map&lt;String, Object&gt; asMap()</span>: Return a map of the properties of a <span class="EmphasisFontCategoryNonProportional ">Json</span> object that describes a JSON object. The returned map is a copy, and modifications to it don鈥檛 affect the <span class="EmphasisFontCategoryNonProportional ">Json</span> object.</p></li><li><p class="Para" id="Par70"><span class="EmphasisFontCategoryNonProportional ">short asShort()</span>: Return the JSON value as a Java short integer.</p></li><li><p class="Para" id="Par71"><span class="EmphasisFontCategoryNonProportional ">String asString()</span>: Return the JSON <span id="ITerm16">value</span> as a Java string.</p></li></ul></div></div><div class="Para" id="Par72">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_8_Chapter.xhtml#PC13">8-6</a></span> presents the source code to an application that uses <span class="EmphasisFontCategoryNonProportional ">asMap()</span> to obtain a map of the <span class="EmphasisFontCategoryNonProportional ">Json</span>
<span id="ITerm17">object properties</span> describing a JSON object.<div class="ProgramCode" id="PC13"><div class="LineGroup"><div class="FixedLine">import java.util.Map;</div></div><div class="LineGroup"><div class="FixedLine">import mjson.Json;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class mJsonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      String jsonStr =</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;\&quot;firstName\&quot;: \&quot;John\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;lastName\&quot;: \&quot;Smith\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;isAlive\&quot;: true,&quot; +</div><div class="FixedLine">      &quot;\&quot;age\&quot;: 25,&quot; +</div><div class="FixedLine">      &quot;\&quot;address\&quot;:&quot; +</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;\&quot;streetAddress\&quot;: \&quot;21 2nd Street\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;city\&quot;: \&quot;New York\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;state\&quot;: \&quot;NY\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;postalCode\&quot;: \&quot;10021-3100\&quot;&quot; +</div><div class="FixedLine">      &quot;},&quot; +</div><div class="FixedLine">      &quot;\&quot;phoneNumbers\&quot;:&quot; +</div><div class="FixedLine">      &quot;[&quot; +</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;\&quot;type\&quot;: \&quot;home\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;number\&quot;: \&quot;212 555-1234\&quot;&quot; +</div><div class="FixedLine">      &quot;},&quot; +</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;\&quot;type\&quot;: \&quot;office\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;number\&quot;: \&quot;646 555-4567\&quot;&quot; +</div><div class="FixedLine">      &quot;}&quot; +</div><div class="FixedLine">      &quot;],&quot; +</div><div class="FixedLine">      &quot;\&quot;children\&quot;: [],&quot; +</div><div class="FixedLine">      &quot;\&quot;spouse\&quot;: null&quot; +</div><div class="FixedLine">      &quot;}&quot;;</div><div class="FixedLine">      Json json = Json.read(jsonStr);</div><div class="FixedLine">      if (json.isObject())</div><div class="FixedLine">      {</div><div class="FixedLine">         Map&lt;String, Object&gt; props = json.asMap();</div><div class="FixedLine">         for (Map.Entry&lt;String, Object&gt; propEntry:</div><div class="FixedLine">              props.entrySet())</div><div class="FixedLine">            out.println(propEntry.getKey() + &quot;: &quot; +</div><div class="FixedLine">                        propEntry.getValue());</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-6</span><p class="SimplePara">Iterating Over a <span class="EmphasisFontCategoryNonProportional ">Json</span> Object鈥檚 Properties to Learn About a JSON Object</p></div></div></div></div><p class="Para" id="Par73"><span class="EmphasisFontCategoryNonProportional ">main(String[])</span> declares the same JSON object as presented in Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_8_Chapter.xhtml#PC2">8-1</a></span>. It then reads and parses this object into a <span class="EmphasisFontCategoryNonProportional ">Json</span> object<span id="ITerm18">
                  
                  
                </span>. The <span class="EmphasisFontCategoryNonProportional ">isObject()</span> method<span id="ITerm19">
                  
                </span> is called to verify that the <span class="EmphasisFontCategoryNonProportional ">Json</span> object represents a JSON object. (It鈥檚 a good idea to verify first.) Because this should be the case, <span class="EmphasisFontCategoryNonProportional ">asMap()</span> is called to return a map of the <span class="EmphasisFontCategoryNonProportional ">Json</span> object鈥檚 properties, which are then iterated over and output.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar3"><h3 class="Heading">Caution</h3><p class="Para" id="Par74">If you replace <span class="EmphasisFontCategoryNonProportional ">Json json = Json.read(jsonStr);</span> with <span class="EmphasisFontCategoryNonProportional ">Json json = Json.make(jsonStr);</span>, you won鈥檛 see any output because the <span class="EmphasisFontCategoryNonProportional ">Json</span> object returned from <span class="EmphasisFontCategoryNonProportional ">make()</span> identifies the JSON string type and not the JSON object type.</p></div><div class="Para" id="Par75">After studying the source code, compile it and run the application. You鈥檒l discover the following output:<div class="ProgramCode" id="PC14"><div class="LineGroup"><div class="FixedLine">firstName: John</div><div class="FixedLine">lastName: Smith</div><div class="FixedLine">isAlive: true</div><div class="FixedLine">address: {streetAddress=21 2nd Street, city=New York, postalCode=10021-3100, state=NY}</div><div class="FixedLine">children: []</div><div class="FixedLine">age: 25</div><div class="FixedLine">phoneNumbers: [{number=212 555-1234, type=home}, {number=646 555-4567, type=office}]</div><div class="FixedLine">spouse: null<span id="ITerm20">
                        
                        
                      </span></div></div></div></div><div class="Para" id="Par76">You can access the contents of arrays and objects by calling the following <span class="EmphasisFontCategoryNonProportional ">at()</span> methods, which return <span class="EmphasisFontCategoryNonProportional ">Json</span> objects that describe <span id="ITerm21">array element values</span> or object property values:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par77"><span class="EmphasisFontCategoryNonProportional ">Json at(int index)</span>: Return the value (as a <span class="EmphasisFontCategoryNonProportional ">Json</span> object) of the array element at the specified <span class="EmphasisFontCategoryNonProportional ">index</span> in this <span class="EmphasisFontCategoryNonProportional ">Json</span> object鈥檚 array. This method applies to JSON arrays only. It throws <span class="EmphasisFontCategoryNonProportional ">java.lang.IndexOutOfBoundsException</span> when <span class="EmphasisFontCategoryNonProportional ">index</span> is out of bounds for the array.</p></li><li><p class="Para" id="Par78"><span class="EmphasisFontCategoryNonProportional ">Json at(String propName)</span>: Return the value (as a <span class="EmphasisFontCategoryNonProportional ">Json</span> object) of the object property whose name is identified by <span class="EmphasisFontCategoryNonProportional ">propName</span> in this <span class="EmphasisFontCategoryNonProportional ">Json</span> object鈥檚 map. Return <span class="EmphasisFontCategoryNonProportional ">null</span> when there鈥檚 no such property. This method applies to JSON objects only.</p></li><li><p class="Para" id="Par79"><span class="EmphasisFontCategoryNonProportional ">Json at(String propName, Json defValue)</span>: Return the value (as a <span class="EmphasisFontCategoryNonProportional ">Json</span> object) of the object property whose name is identified by <span class="EmphasisFontCategoryNonProportional ">propName</span> in this <span class="EmphasisFontCategoryNonProportional ">Json</span> object鈥檚 map. When there鈥檚 no such property, create a new property whose value is specified by <span class="EmphasisFontCategoryNonProportional ">defValue</span> and return <span class="EmphasisFontCategoryNonProportional ">defValue</span>. This method applies to JSON objects only.</p></li><li><p class="Para" id="Par80"><span class="EmphasisFontCategoryNonProportional ">Json at(String propName, Object defValue)</span>: Return the value (as a <span class="EmphasisFontCategoryNonProportional ">Json</span> object) of the object property whose name is identified by <span class="EmphasisFontCategoryNonProportional ">propName</span> in this <span class="EmphasisFontCategoryNonProportional ">Json</span> object鈥檚 map. When there鈥檚 no such property, create a new property whose value is specified by <span class="EmphasisFontCategoryNonProportional ">defValue</span> and return <span class="EmphasisFontCategoryNonProportional ">defValue</span>. This method applies to JSON objects only.</p></li></ul></div></div><div class="Para" id="Par81">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_8_Chapter.xhtml#PC15">8-7</a></span> presents the source code to an application that uses the first two <span class="EmphasisFontCategoryNonProportional ">at()</span> methods to access a JSON object鈥檚 property values.<div class="ProgramCode" id="PC15"><div class="LineGroup"><div class="FixedLine">import mjson.Json;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class mJsonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      String jsonStr =</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;\&quot;firstName\&quot;: \&quot;John\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;lastName\&quot;: \&quot;Smith\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;isAlive\&quot;: true,&quot; +</div><div class="FixedLine">      &quot;\&quot;age\&quot;: 25,&quot; +</div><div class="FixedLine">      &quot;\&quot;address\&quot;:&quot; +</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;\&quot;streetAddress\&quot;: \&quot;21 2nd Street\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;city\&quot;: \&quot;New York\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;state\&quot;: \&quot;NY\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;postalCode\&quot;: \&quot;10021-3100\&quot;&quot; +</div><div class="FixedLine">      &quot;},&quot; +</div><div class="FixedLine">      &quot;\&quot;phoneNumbers\&quot;:&quot; +</div><div class="FixedLine">      &quot;[&quot; +</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;\&quot;type\&quot;: \&quot;home\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;number\&quot;: \&quot;212 555-1234\&quot;&quot; +</div><div class="FixedLine">      &quot;},&quot; +</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;\&quot;type\&quot;: \&quot;office\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;number\&quot;: \&quot;646 555-4567\&quot;&quot; +</div><div class="FixedLine">      &quot;}&quot; +</div><div class="FixedLine">      &quot;],&quot; +</div><div class="FixedLine">      &quot;\&quot;children\&quot;: [],&quot; +</div><div class="FixedLine">      &quot;\&quot;spouse\&quot;: null&quot; +</div><div class="FixedLine">      &quot;}&quot;;</div><div class="FixedLine">      Json json = Json.read(jsonStr);</div><div class="FixedLine">      out.printf(&quot;First name = %s%n&quot;, json.at(&quot;firstName&quot;));</div><div class="FixedLine">      out.printf(&quot;Last name = %s%n&quot;, json.at(&quot;lastName&quot;));</div><div class="FixedLine">      out.printf(&quot;Is alive = %s%n&quot;, json.at(&quot;isAlive&quot;));</div><div class="FixedLine">      out.printf(&quot;Age = %d%n&quot;, json.at(&quot;age&quot;).asInteger());</div><div class="FixedLine">      out.println(&quot;Address&quot;);</div><div class="FixedLine">      Json jsonAddr = json.at(&quot;address&quot;);</div><div class="FixedLine">      out.printf(&quot;   Street address = %s%n&quot;, jsonAddr.at(&quot;streetAddress&quot;));</div><div class="FixedLine">      out.printf(&quot;   City = %s%n&quot;, jsonAddr.at(&quot;city&quot;));</div><div class="FixedLine">      out.printf(&quot;   State = %s%n&quot;, jsonAddr.at(&quot;state&quot;));</div><div class="FixedLine">      out.printf(&quot;   Postal code = %s%n&quot;, jsonAddr.at(&quot;postalCode&quot;));</div><div class="FixedLine">      out.println(&quot;Phone Numbers&quot;);</div><div class="FixedLine">      Json jsonPhone = json.at(&quot;phoneNumbers&quot;);</div><div class="FixedLine">      out.printf(&quot;   Type = %s%n&quot;, jsonPhone.at(0). at(&quot;type&quot;));</div><div class="FixedLine">      out.printf(&quot;   Number = %s%n&quot;, jsonPhone.at(0). at(&quot;number&quot;))<span id="ITerm22">
                        
                        
                      </span>;</div><div class="FixedLine">      out.println();</div><div class="FixedLine">      out.printf(&quot;   Type = %s%n&quot;, jsonPhone.at(1). at(&quot;type&quot;));</div><div class="FixedLine">      out.printf(&quot;   Number = %s%n&quot;, jsonPhone.at(1). at(&quot;number&quot;));</div><div class="FixedLine">      Json jsonChildren = json.at(&quot;children&quot;);</div><div class="FixedLine">      out.printf(&quot;Children = %s%n&quot;, jsonChildren);</div><div class="FixedLine">      out.printf(&quot;Spouse = %s%n&quot;, json.at(&quot;spouse&quot;));</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-7</span><p class="SimplePara">Obtaining and Outputting a JSON Object鈥檚 <span id="ITerm23">Property Values</span></p></div></div></div></div><p class="Para" id="Par82">Expression <span class="EmphasisFontCategoryNonProportional ">json.at(&quot;age&quot;)</span> returns a <span class="EmphasisFontCategoryNonProportional ">Json</span> object describing a JSON number; <span class="EmphasisFontCategoryNonProportional ">asInteger()</span> returns this value as a 32-bit Java integer.</p><div class="Para" id="Par83">Compile this source code and run the application. You鈥檒l discover the following output:<div class="ProgramCode" id="PC16"><div class="LineGroup"><div class="FixedLine">First name = &quot;John&quot;</div><div class="FixedLine">Last name = &quot;Smith&quot;</div><div class="FixedLine">Is alive = true</div><div class="FixedLine">Age = 25</div><div class="FixedLine">Address</div><div class="FixedLine">   Street address = &quot;21 2nd Street&quot;</div><div class="FixedLine">   City = &quot;New York&quot;</div><div class="FixedLine">   State = &quot;NY&quot;</div><div class="FixedLine">   Postal code = &quot;10021-3100&quot;</div><div class="FixedLine">Phone Numbers</div><div class="FixedLine">   Type = &quot;home&quot;</div><div class="FixedLine">   Number = &quot;212 555-1234&quot;</div></div><div class="LineGroup"><div class="FixedLine">   Type = &quot;office&quot;</div><div class="FixedLine">   Number = &quot;646 555-4567&quot;</div><div class="FixedLine">Children = []</div><div class="FixedLine">Spouse = null</div></div></div></div><div class="Para" id="Par84">You might be wondering how to detect the empty array that鈥檚 assigned to the <span class="EmphasisFontCategoryNonProportional ">children</span> property <span id="ITerm24">name</span>. You can accomplish this task by calling <span class="EmphasisFontCategoryNonProportional ">asList()</span> to return a <span class="EmphasisFontCategoryNonProportional ">List</span> implementation object, and then calling <span class="EmphasisFontCategoryNonProportional ">List</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">size()</span> method on this object, as follows:<div class="ProgramCode" id="PC17"><div class="LineGroup"><div class="FixedLine">System.out.printf(&quot;Array length = %d%n&quot;, jsonChildren.asList().size());</div></div></div></div><p class="Para" id="Par85">This code fragment will report an array length of zero elements.</p><div class="Para" id="Par86">Finally, <span class="EmphasisFontCategoryNonProportional ">Json</span> provides three methods for verifying that property names exist, and that property names or array elements exist with specified values:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par87"><span class="EmphasisFontCategoryNonProportional ">boolean has(String propName)</span>: Return <span class="EmphasisFontCategoryNonProportional ">true</span> when this <span class="EmphasisFontCategoryNonProportional ">Json</span> object describes a JSON object that has a property identified by <span class="EmphasisFontCategoryNonProportional ">propName</span>; otherwise, return <span class="EmphasisFontCategoryNonProportional ">false</span>.</p></li><li><p class="Para" id="Par88"><span class="EmphasisFontCategoryNonProportional ">boolean is(int index, Object value)</span>: Return <span class="EmphasisFontCategoryNonProportional ">true</span> when this <span class="EmphasisFontCategoryNonProportional ">Json</span> object describes a JSON array that has the specified <span class="EmphasisFontCategoryNonProportional ">value</span> at the specified <span class="EmphasisFontCategoryNonProportional ">index</span>; otherwise, return <span class="EmphasisFontCategoryNonProportional ">false</span>.</p></li><li><p class="Para" id="Par89"><span class="EmphasisFontCategoryNonProportional ">boolean is(String propName, Object value)</span>: Return <span class="EmphasisFontCategoryNonProportional ">true</span> when this <span class="EmphasisFontCategoryNonProportional ">Json</span> object describes a JSON object that has a property identified by <span class="EmphasisFontCategoryNonProportional ">propName</span> and this property has the value identified by <span class="EmphasisFontCategoryNonProportional ">value</span>; otherwise, return <span class="EmphasisFontCategoryNonProportional ">false</span>.</p></li></ul></div></div><p class="Para" id="Par90">For example, consider Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_8_Chapter.xhtml#PC15">8-7</a></span>. Expression <span class="EmphasisFontCategoryNonProportional ">json.has(&quot;firstName&quot;)</span> returns <span class="EmphasisFontCategoryNonProportional ">true</span>, whereas expression <span class="EmphasisFontCategoryNonProportional ">json.has(&quot;middleName&quot;)</span> returns <span class="EmphasisFontCategoryNonProportional ">false</span>.</p></section><section class="Section2 RenderAsSection2" id="Sec6"><h3 class="Heading">Navigating Json Object Hierarchies</h3><div class="Para" id="Par91">When one of the previously discussed <span class="EmphasisFontCategoryNonProportional ">at()</span> methods returns a <span class="EmphasisFontCategoryNonProportional ">Json</span> object describing a JSON object or JSON array, you can <span id="ITerm25">navigate</span> into the object or array by chaining another <span class="EmphasisFontCategoryNonProportional ">at()</span> method call to the expression. For example, I used this technique in the previous application to access a phone number:<div class="ProgramCode" id="PC18"><div class="LineGroup"><div class="FixedLine">System.out.printf(&quot;   Number = %s%n&quot;, jsonPhone.at(0).at(&quot;number&quot;));</div></div></div></div><p class="Para" id="Par92">Here, <span class="EmphasisFontCategoryNonProportional ">jsonPhone.at(0)</span> returns a <span class="EmphasisFontCategoryNonProportional ">Json</span> object that represents the first array entry in the <span class="EmphasisFontCategoryNonProportional ">phoneNumbers</span> JSON array. Because the array entry happens to be a JSON object, calling <span class="EmphasisFontCategoryNonProportional ">at(&quot;number&quot;)</span> on this <span class="EmphasisFontCategoryNonProportional ">Json</span> object causes <span class="EmphasisFontCategoryNonProportional ">Json</span> to return the value (as a <span class="EmphasisFontCategoryNonProportional ">Json</span> object) of the JSON object鈥檚 <span class="EmphasisFontCategoryNonProportional ">number</span> property.</p><div class="Para" id="Par93">Each <span class="EmphasisFontCategoryNonProportional ">Json</span> object that describes a JSON entity belonging to an array or an object holds a reference to its enclosing array- or object-based <span class="EmphasisFontCategoryNonProportional ">Json</span> object. You can call <span class="EmphasisFontCategoryNonProportional ">Json</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">Json up()</span> method to return this enclosing <span class="EmphasisFontCategoryNonProportional ">Json</span> object, which is demonstrated in Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_8_Chapter.xhtml#PC19">8-8</a></span>.<div class="ProgramCode" id="PC19"><div class="LineGroup"><div class="FixedLine">import mjson.Json;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class mJsonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      String jsonStr =</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;\&quot;propName\&quot;: \&quot;propValue\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;propArray\&quot;:&quot; +</div><div class="FixedLine">      &quot;[&quot; +</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;\&quot;element1\&quot;: \&quot;value1\&quot;&quot; +</div><div class="FixedLine">      &quot;},&quot; +</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;\&quot;element2\&quot;: \&quot;value2\&quot;&quot; +</div><div class="FixedLine">      &quot;}&quot; +</div><div class="FixedLine">      &quot;]&quot; +</div><div class="FixedLine">      &quot;}&quot;;</div><div class="FixedLine">      Json json = Json.read(jsonStr);</div><div class="FixedLine">      Json jsonElement1 = json.at(&quot;propArray&quot;).at(0);</div><div class="FixedLine">      out.println(jsonElement1);</div><div class="FixedLine">      out.println();</div><div class="FixedLine">      out.println(jsonElement1.up());</div><div class="FixedLine">      out.println();</div><div class="FixedLine">      out.println(jsonElement1.up().up());</div><div class="FixedLine">      out.println();</div><div class="FixedLine">      out.println(jsonElement1.up().up().up());</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-8</span><p class="SimplePara">Accessing Enclosing <span class="EmphasisFontCategoryNonProportional ">Json</span> Objects</p></div></div></div></div><div class="Para" id="Par94">Compile this source code and run the application, and you鈥檒l discover the following output:<div class="ProgramCode" id="PC20"><div class="LineGroup"><div class="FixedLine">{&quot;element1&quot;:&quot;value1&quot;}</div></div><div class="LineGroup"><div class="FixedLine">[{&quot;element1&quot;:&quot;value1&quot;},{&quot;element2&quot;:&quot;value2&quot;}]</div></div><div class="LineGroup"><div class="FixedLine">{&quot;propArray&quot;:[{&quot;element1&quot;:&quot;value1&quot;},{&quot;element2&quot;:&quot;value2&quot;}],&quot;propName&quot;:&quot;propValue&quot;}</div></div><div class="LineGroup"><div class="FixedLine">null</div></div></div></div><p class="Para" id="Par95">The first output line describes the first array element in the array assigned to the <span class="EmphasisFontCategoryNonProportional ">propArray</span> property. This element is an object consisting of a single <span class="EmphasisFontCategoryNonProportional ">element1</span> property.</p><p class="Para" id="Par96"><span class="EmphasisFontCategoryNonProportional ">jsonElement1.up()</span> returns a <span class="EmphasisFontCategoryNonProportional ">Json</span> object describing the array that encloses the JSON object that serves as the array鈥檚 first <span id="ITerm26">element</span>. <span class="EmphasisFontCategoryNonProportional ">jsonElement1.up().up()</span> returns a <span class="EmphasisFontCategoryNonProportional ">Json</span> object describing the JSON object that encloses the array. Finally, <span class="EmphasisFontCategoryNonProportional ">jsonElement1.up().up().up()</span> returns a <span class="EmphasisFontCategoryNonProportional ">Json</span> object describing the <span class="EmphasisFontCategoryNonProportional ">null</span> value; the JSON object has no parent.</p></section><section class="Section2 RenderAsSection2" id="Sec7"><h3 class="Heading">Modifying Json Objects</h3><p class="Para" id="Par97">You鈥檒l encounter situations where you鈥檒l want to modify existing <span class="EmphasisFontCategoryNonProportional ">Json</span> objects鈥?JSON values. For example, you might be creating and saving several similar JSON objects and would like to reuse existing <span class="EmphasisFontCategoryNonProportional ">Json</span> objects.</p><p class="Para" id="Par98"><span class="EmphasisFontCategoryNonProportional ">Json</span> lets you modify <span class="EmphasisFontCategoryNonProportional ">Json</span> objects that represent JSON arrays and objects. It doesn鈥檛 let you modify <span class="EmphasisFontCategoryNonProportional ">Json</span> objects that represent JSON Boolean, number, or string values because they鈥檙e regarded as immutable.</p><div class="Para" id="Par99"><span class="EmphasisFontCategoryNonProportional ">Json</span> declares the following <span class="EmphasisFontCategoryNonProportional ">set()</span> methods<span id="ITerm27">
                  
                </span><span id="ITerm28">
                  
                  
                </span> for modifying JSON array elements and JSON object properties:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par100"><span class="EmphasisFontCategoryNonProportional ">Json set(int index, Object value)</span>: Set the value of the JSON array element located at <span class="EmphasisFontCategoryNonProportional ">index</span> to <span class="EmphasisFontCategoryNonProportional ">value</span>.</p></li><li><p class="Para" id="Par101"><span class="EmphasisFontCategoryNonProportional ">Json set(String propName, Json value)</span>: Set the value of the JSON object property whose name is specified by <span class="EmphasisFontCategoryNonProportional ">propName</span> to <span class="EmphasisFontCategoryNonProportional ">value</span>.</p></li><li><p class="Para" id="Par102"><span class="EmphasisFontCategoryNonProportional ">Json set(String property, Object value)</span>: Set the value of the JSON object property whose name is specified by <span class="EmphasisFontCategoryNonProportional ">propName</span> to <span class="EmphasisFontCategoryNonProportional ">value</span>. This method calls <span class="EmphasisFontCategoryNonProportional ">make(Object)</span> to convert <span class="EmphasisFontCategoryNonProportional ">value</span> to a <span class="EmphasisFontCategoryNonProportional ">Json</span> object representing <span class="EmphasisFontCategoryNonProportional ">value</span> and then invokes <span class="EmphasisFontCategoryNonProportional ">set(String, Json)</span>.</p></li></ul></div></div><div class="Para" id="Par103">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_8_Chapter.xhtml#PC21">8-9</a></span> presents the source code to an application that uses the first and third <span class="EmphasisFontCategoryNonProportional ">set()</span> methods to set object property and array element values.<div class="ProgramCode" id="PC21"><div class="LineGroup"><div class="FixedLine">import mjson.Json;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class mJsonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      String jsonStr =</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;\&quot;name\&quot;: null,&quot; +</div><div class="FixedLine">      &quot;\&quot;courses\&quot;:&quot; +</div><div class="FixedLine">      &quot;[null]&quot; +</div><div class="FixedLine">      &quot;}&quot;;</div><div class="FixedLine">      Json json = Json.read(jsonStr);</div><div class="FixedLine">      out.println(json);</div><div class="FixedLine">      out.println();</div><div class="FixedLine">      json.set(&quot;name&quot;, &quot;John Doe&quot;);</div><div class="FixedLine">      Json jsonCourses = json.at(&quot;courses&quot;);</div><div class="FixedLine">      jsonCourses.set(0, &quot;English&quot;);</div><div class="FixedLine">      out.println(json);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-9</span><p class="SimplePara">Setting Object Property and Array Element <span id="ITerm29">Values</span></p></div></div></div></div><div class="Para" id="Par104">Compile this source code and run the application, and you鈥檒l discover the following output:<div class="ProgramCode" id="PC22"><div class="LineGroup"><div class="FixedLine">{&quot;courses&quot;:[null],&quot;name&quot;:null}</div></div><div class="LineGroup"><div class="FixedLine">{&quot;courses&quot;:[&quot;English&quot;],&quot;name&quot;:&quot;John Doe&quot;}</div></div></div></div><div class="Para" id="Par105">If you attempt to set a value for a property that doesn鈥檛 exist, <span class="EmphasisFontCategoryNonProportional ">Json</span> adds the property. However, if you attempt to set the value for a nonexistent array element, <span class="EmphasisFontCategoryNonProportional ">Json</span> throws <span class="EmphasisFontCategoryNonProportional ">IndexOutOfBoundsException</span>. For this reason, you might prefer to call one of the following <span class="EmphasisFontCategoryNonProportional ">add()</span> methods<span id="ITerm30">
                  
                  
                  
                </span> instead:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par106"><span class="EmphasisFontCategoryNonProportional ">Json add(Json element)</span>: Append the specified element to the array represented by this <span class="EmphasisFontCategoryNonProportional ">Json</span> object.</p></li><li><p class="Para" id="Par107"><span class="EmphasisFontCategoryNonProportional ">Json add(Object anything)</span>: Convert <span class="EmphasisFontCategoryNonProportional ">anything</span> to a <span class="EmphasisFontCategoryNonProportional ">Json</span> object by calling <span class="EmphasisFontCategoryNonProportional ">make(Object)</span> and append the result to the array represented by this <span class="EmphasisFontCategoryNonProportional ">Json</span> object.</p></li></ul></div></div><div class="Para" id="Par108">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_8_Chapter.xhtml#PC23">8-10</a></span> presents the source code to an application that uses the first <span class="EmphasisFontCategoryNonProportional ">add()</span> method<span id="ITerm31">
                  
                </span> to append two strings to the empty <span class="EmphasisFontCategoryNonProportional ">courses</span> array.<div class="ProgramCode" id="PC23"><div class="LineGroup"><div class="FixedLine">import mjson.Json;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class mJsonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      String jsonStr =</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;\&quot;name\&quot;: null,&quot; +</div><div class="FixedLine">      &quot;\&quot;courses\&quot;:&quot; +</div><div class="FixedLine">      &quot;[]&quot; +</div><div class="FixedLine">      &quot;}&quot;;</div><div class="FixedLine">      Json json = Json.read(jsonStr);</div><div class="FixedLine">      out.println(json);</div><div class="FixedLine">      out.println();</div><div class="FixedLine">      json.set(&quot;name&quot;, &quot;John Doe&quot;);</div><div class="FixedLine">      Json jsonCourses = json.at(&quot;courses&quot;);</div><div class="FixedLine">      jsonCourses.add(&quot;English&quot;);</div><div class="FixedLine">      jsonCourses.add(&quot;French&quot;);</div><div class="FixedLine">      out.println(json);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-10</span><p class="SimplePara">Appending <span id="ITerm32">Strings</span> to an Empty JSON Array</p></div></div></div></div><div class="Para" id="Par109">Compile this source code and run the application. It generates the output shown here:<div class="ProgramCode" id="PC24"><div class="LineGroup"><div class="FixedLine">{&quot;courses&quot;:[],&quot;name&quot;:null}</div></div><div class="LineGroup"><div class="FixedLine">{&quot;courses&quot;:[&quot;English&quot;,&quot;French&quot;],&quot;name&quot;:&quot;John Doe&quot;}</div></div></div></div><div class="Para" id="Par110"><span class="EmphasisFontCategoryNonProportional ">Json</span> provides a pair of array-oriented <span class="EmphasisFontCategoryNonProportional ">remove()</span> methods<span id="ITerm33">
                  
                  
                  
                </span> that take the same arguments as their <span class="EmphasisFontCategoryNonProportional ">add()</span> counterparts:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par111"><span class="EmphasisFontCategoryNonProportional ">Json remove(Json element)</span>: Remove the specified element from the array represented by this <span class="EmphasisFontCategoryNonProportional ">Json</span> object.</p></li><li><p class="Para" id="Par112"><span class="EmphasisFontCategoryNonProportional ">Json remove(Object anything)</span>: Convert <span class="EmphasisFontCategoryNonProportional ">anything</span> to a <span class="EmphasisFontCategoryNonProportional ">Json</span> object by calling <span class="EmphasisFontCategoryNonProportional ">make(Object)</span> and remove the result from the array represented by this <span class="EmphasisFontCategoryNonProportional ">Json</span> object.</p></li></ul></div></div><div class="Para" id="Par113">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_8_Chapter.xhtml#PC25">8-11</a></span> presents the source code to an application that uses the second <span class="EmphasisFontCategoryNonProportional ">remove()</span> method to remove the <span class="EmphasisFontCategoryNonProportional ">English</span> string from the <span class="EmphasisFontCategoryNonProportional ">courses</span> array.<div class="ProgramCode" id="PC25"><div class="LineGroup"><div class="FixedLine">import mjson.Json;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class mJsonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      String jsonStr =</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;\&quot;name\&quot;: null,&quot; +</div><div class="FixedLine">      &quot;\&quot;courses\&quot;:&quot; +</div><div class="FixedLine">      &quot;[]&quot; +</div><div class="FixedLine">      &quot;}&quot;;</div><div class="FixedLine">      Json json = Json.read(jsonStr);</div><div class="FixedLine">      out.println(json);</div><div class="FixedLine">      out.println();</div><div class="FixedLine">      json.set(&quot;name&quot;, &quot;John Doe&quot;);</div><div class="FixedLine">      Json jsonCourses = json.at(&quot;courses&quot;);</div><div class="FixedLine">      jsonCourses.add(&quot;English&quot;);</div><div class="FixedLine">      jsonCourses.add(&quot;French&quot;);</div><div class="FixedLine">      out.println(json);</div><div class="FixedLine">      out.println();</div><div class="FixedLine">      jsonCourses.remove(&quot;English&quot;);</div><div class="FixedLine">      out.println(json);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-11</span><p class="SimplePara">Removing a <span id="ITerm34">String</span> from a JSON Array</p></div></div></div></div><div class="Para" id="Par114">Compile this source code and run the application. It generates the output shown here:<div class="ProgramCode" id="PC26"><div class="LineGroup"><div class="FixedLine">{&quot;courses&quot;:[],&quot;name&quot;:null}</div></div><div class="LineGroup"><div class="FixedLine">{&quot;courses&quot;:[&quot;English&quot;,&quot;French&quot;],&quot;name&quot;:&quot;John Doe&quot;}</div></div><div class="LineGroup"><div class="FixedLine">{&quot;courses&quot;:[&quot;French&quot;],&quot;name&quot;:&quot;John Doe&quot;}</div></div></div></div><div class="Para" id="Par115">You can remove an element from an <span id="ITerm35">array</span> by index or remove a property from an object by name by calling the following methods:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par116"><span class="EmphasisFontCategoryNonProportional ">Json atDel(int index)</span>: Remove the element at the specified <span class="EmphasisFontCategoryNonProportional ">index</span> from this <span class="EmphasisFontCategoryNonProportional ">Json</span> object鈥檚 JSON array and return the element.</p></li><li><p class="Para" id="Par117"><span class="EmphasisFontCategoryNonProportional ">Json atDel(String propName)</span>: Remove the property identified by <span class="EmphasisFontCategoryNonProportional ">propName</span> from this <span class="EmphasisFontCategoryNonProportional ">Json</span> object鈥檚 JSON object and return the property value (or <span class="EmphasisFontCategoryNonProportional ">null</span> when the property doesn鈥檛 exist).</p></li><li><p class="Para" id="Par118"><span class="EmphasisFontCategoryNonProportional ">Json delAt(int index)</span>: Remove the element at the specified <span class="EmphasisFontCategoryNonProportional ">index</span> from this <span class="EmphasisFontCategoryNonProportional ">Json</span> object鈥檚 JSON array.</p></li><li><p class="Para" id="Par119"><span class="EmphasisFontCategoryNonProportional ">Json delAt(String propName)</span>: Remove the property identified by <span class="EmphasisFontCategoryNonProportional ">propName</span> from this <span class="EmphasisFontCategoryNonProportional ">Json</span> object鈥檚 JSON object.</p></li></ul></div></div><div class="Para" id="Par120">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_8_Chapter.xhtml#PC27">8-12</a></span> presents the source code to an application that uses the last two <span class="EmphasisFontCategoryNonProportional ">delAt()</span> methods<span id="ITerm36">
                  
                  
                  
                </span> to delete a property and an array element.<div class="ProgramCode" id="PC27"><div class="LineGroup"><div class="FixedLine">import mjson.Json;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class mJsonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      String jsonStr =</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;\&quot;firstName\&quot;: \&quot;John\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;lastName\&quot;: \&quot;Doe\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;courses\&quot;:&quot; +</div><div class="FixedLine">      &quot;[\&quot;English\&quot;, \&quot;French\&quot;, \&quot;Spanish\&quot;]&quot; +</div><div class="FixedLine">      &quot;}&quot;;</div><div class="FixedLine">      Json json = Json.read(jsonStr);</div><div class="FixedLine">      out.println(json);</div><div class="FixedLine">      out.println();</div><div class="FixedLine">      json.delAt(&quot;lastName&quot;);</div><div class="FixedLine">      out.println(json);</div><div class="FixedLine">      out.println();</div><div class="FixedLine">      json.at(&quot;courses&quot;).delAt(1);</div><div class="FixedLine">      out.println(json);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-12</span><p class="SimplePara">Removing the Last Name and One of the Courses Being Taken</p></div></div></div></div><div class="Para" id="Par121">To see the results of the <span class="EmphasisFontCategoryNonProportional ">delAt()</span> methods, compile this source code and run the application. Its output is shown here:<div class="ProgramCode" id="PC28"><div class="LineGroup"><div class="FixedLine">{&quot;firstName&quot;:&quot;John&quot;,&quot;lastName&quot;:&quot;Doe&quot;,&quot;courses&quot;:[&quot;English&quot;,&quot;French&quot;,&quot;Spanish&quot;]}</div></div><div class="LineGroup"><div class="FixedLine">{&quot;firstName&quot;:&quot;John&quot;,&quot;courses&quot;:[&quot;English&quot;,&quot;French&quot;,&quot;Spanish&quot;]}</div></div><div class="LineGroup"><div class="FixedLine">{&quot;firstName&quot;:&quot;John&quot;,&quot;courses&quot;:[&quot;English&quot;,&quot;Spanish&quot;]}</div></div></div></div><div class="Para" id="Par122"><span class="EmphasisFontCategoryNonProportional ">Json</span> provides an additional method for modifying a JSON object:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par123"><span class="EmphasisFontCategoryNonProportional ">Json with(Json objectorarray)</span>: Combine this <span class="EmphasisFontCategoryNonProportional ">Json</span> object鈥檚 JSON object or JSON array with the argument passed to <span class="EmphasisFontCategoryNonProportional ">objectorarray</span>. The JSON type of this <span class="EmphasisFontCategoryNonProportional ">Json</span> object and the JSON type of <span class="EmphasisFontCategoryNonProportional ">objectorarray</span> must match. If <span class="EmphasisFontCategoryNonProportional ">objectorarray</span> identifies a JSON object, all of its properties are appended to this <span class="EmphasisFontCategoryNonProportional ">Json</span> object鈥檚 object. If <span class="EmphasisFontCategoryNonProportional ">objectorarray</span> identifies a JSON array, all of its elements are appended to this <span class="EmphasisFontCategoryNonProportional ">Json</span> object鈥檚 array.</p></li></ul></div></div><div class="Para" id="Par124">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_8_Chapter.xhtml#PC29">8-13</a></span> presents the source code to an application that uses <span class="EmphasisFontCategoryNonProportional ">with(Json)</span> to append properties to an object and elements to an array.<div class="ProgramCode" id="PC29"><div class="LineGroup"><div class="FixedLine">import mjson.Json;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class mJsonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      String jsonStr =</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;\&quot;firstName\&quot;: \&quot;John\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;courses\&quot;:&quot; +</div><div class="FixedLine">      &quot;[\&quot;English\&quot;]&quot; +</div><div class="FixedLine">      &quot;}&quot;;</div><div class="FixedLine">      Json json = Json.read(jsonStr);</div><div class="FixedLine">      out.println(json);</div><div class="FixedLine">      out.println();</div><div class="FixedLine">      Json jsono =</div><div class="FixedLine">         Json.read(&quot;{\&quot;initial\&quot;: \&quot;P\&quot;, \&quot;lastName\&quot;: &quot; + &quot;\&quot;Doe\&quot;}&quot;);</div><div class="FixedLine">      Json jsona = Json.read(&quot;[\&quot;French\&quot;, \&quot;Spanish\&quot;]&quot;);</div><div class="FixedLine">      json.with(jsono);</div><div class="FixedLine">      out.println(json);</div><div class="FixedLine">      out.println();</div><div class="FixedLine">      json.at(&quot;courses&quot;).with(jsona);</div><div class="FixedLine">      out.println(json);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-13</span><p class="SimplePara"><span id="ITerm37">Appending Properties</span> to an Object and Elements to an Array</p></div></div></div></div><div class="Para" id="Par125">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_8_Chapter.xhtml#PC29">8-13</a></span> and run the application. Here is the application鈥檚 <span id="ITerm38">output</span>:<div class="ProgramCode" id="PC30"><div class="LineGroup"><div class="FixedLine">{&quot;firstName&quot;:&quot;John&quot;,&quot;courses&quot;:[&quot;English&quot;]}</div></div><div class="LineGroup"><div class="FixedLine">{&quot;firstName&quot;:&quot;John&quot;,&quot;courses&quot;:[&quot;English&quot;],&quot;lastName&quot;:&quot;Doe&quot;,&quot;initial&quot;:&quot;P&quot;}</div></div><div class="LineGroup"><div class="FixedLine">{&quot;firstName&quot;:&quot;John&quot;,&quot;courses&quot;:[&quot;English&quot;,&quot;French&quot;,&quot;Spanish&quot;],&quot;lastName&quot;:&quot;Doe&quot;,&quot;initial&quot;:&quot;P&quot;}</div></div></div></div><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar4"><h3 class="Heading">Note</h3><p class="Para" id="Par126">mJson 1.4.0 overloads <span class="EmphasisFontCategoryNonProportional ">with()</span> to customize this method鈥檚 behavior. See <span class="ExternalRef"><a href="http://github.com/bolerio/mjson/wiki/Deep-Merging"><span class="RefSource">
                      <span class="EmphasisFontCategoryNonProportional ">http://github.com/bolerio/mjson/wiki/Deep-Merging</span>
                    </span></a></span> for the details.</p></div></section><section class="Section2 RenderAsSection2" id="Sec8"><h3 class="Heading">Validation</h3><div class="Para" id="Par127"><span class="EmphasisFontCategoryNonProportional ">Json</span> supports <span id="ITerm39">JSON</span> Schema Draft 4 validation via its nested <span class="EmphasisFontCategoryNonProportional ">Schema</span>
<span id="ITerm40">interface</span> and the following <span class="EmphasisFontCategoryNonProportional ">static</span> methods:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par128"><span class="EmphasisFontCategoryNonProportional ">Json.Schema schema(Json jsonSchema)</span>: Return a <span class="EmphasisFontCategoryNonProportional ">Json.Schema</span> object that validates JSON documents according to the schema described by <span class="EmphasisFontCategoryNonProportional ">jsonSchema</span>.</p></li><li><p class="Para" id="Par129"><span class="EmphasisFontCategoryNonProportional ">Json.Schema schema(Json jsonSchema, URI uri)</span>: Return a <span class="EmphasisFontCategoryNonProportional ">Json.Schema</span> object that validates JSON documents according to the schema described by <span class="EmphasisFontCategoryNonProportional ">jsonSchema</span> and also located at the Uniform Resource Identifier (URI) passed to <span class="EmphasisFontCategoryNonProportional ">uri</span>, which is of type <span class="EmphasisFontCategoryNonProportional ">java.net.URI</span>.</p></li><li><p class="Para" id="Par130"><span class="EmphasisFontCategoryNonProportional ">Json.Schema schema(URI uri)</span>: Return a <span class="EmphasisFontCategoryNonProportional ">Json.Schema</span> object that validates JSON documents according to the schema located at <span class="EmphasisFontCategoryNonProportional ">uri</span>.</p></li></ul></div></div><p class="Para" id="Par131">Validation is performed by calling <span class="EmphasisFontCategoryNonProportional ">Schema</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">Json validate(Json document)</span> method, which attempts to validate a JSON <span class="EmphasisFontCategoryNonProportional ">document</span> according to this <span class="EmphasisFontCategoryNonProportional ">Schema</span> object. Validation attempts to proceed even when validation errors are detected. The return value is always a <span class="EmphasisFontCategoryNonProportional ">Json</span> object whose JSON object contains the Boolean property named <span class="EmphasisFontCategoryNonProportional ">ok</span>. When <span class="EmphasisFontCategoryNonProportional ">ok</span> is <span class="EmphasisFontCategoryNonProportional ">true</span>, there are no other properties. When it鈥檚 <span class="EmphasisFontCategoryNonProportional ">false</span>, the JSON object also contains a property named <span class="EmphasisFontCategoryNonProportional ">errors</span>, which is an array of error messages for all detected schema violations.</p><div class="Para" id="Par132">I鈥檝e created two sample applications that demonstrate validation. Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_8_Chapter.xhtml#PC31">8-14</a></span> is based on example code at the mJson GitHub 鈥淎 Tour of the API鈥?page (<span class="ExternalRef"><a href="http://github.com/bolerio/mjson/wiki/A-Tour-of-the-API"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://github.com/bolerio/mjson/wiki/A-Tour-of-the-API</span>
                  </span></a></span>).<div class="ProgramCode" id="PC31"><div class="LineGroup"><div class="FixedLine">import mjson.Json;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class mJsonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      // A simple schema that accepts only JSON objects</div><div class="FixedLine">      // with a mandatory property &apos;id&apos;.</div><div class="FixedLine">      Json.Schema schema =</div><div class="FixedLine">         Json.schema(Json.object(&quot;type&quot;, &quot;object&quot;,</div><div class="FixedLine">                                 &quot;required&quot;,</div><div class="FixedLine">                                 Json.array(&quot;id&quot;)));</div><div class="FixedLine">      out.println(schema.validate(Json.object(&quot;id&quot;, 666,</div><div class="FixedLine">                                              &quot;name&quot;,</div><div class="FixedLine">                                              &quot;Britlan&quot;)));</div><div class="FixedLine">      out.println(schema.validate(Json.object(&quot;ID&quot;, 666,</div><div class="FixedLine">                                              &quot;name&quot;,</div><div class="FixedLine">                                              &quot;Britlan&quot;)));</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-14</span><p class="SimplePara">Validating JSON Objects That Include the <span class="EmphasisFontCategoryNonProportional ">id</span> Property<span id="ITerm41">
                          
                          
                        </span></p></div></div></div></div><div class="Para" id="Par133">If you compile this source code and run the application, you鈥檒l discover the following <span id="ITerm42">output</span>:<div class="ProgramCode" id="PC32"><div class="LineGroup"><div class="FixedLine">{&quot;ok&quot;:true}</div><div class="FixedLine">{&quot;ok&quot;:false,&quot;errors&quot;:[&quot;Required property id missing from object {\&quot;name\&quot;:\&quot;Britlan\&quot;,\&quot;ID\&quot;:666}&quot;]}</div></div></div></div><div class="Para" id="Par134">In Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_7_Chapter.xhtml"><span class="RefSource">7</span></a></span>, I presented the following JSON object:<div class="ProgramCode" id="PC33"><div class="LineGroup"><div class="FixedLine">{</div><div class="FixedLine">   &quot;name&quot;: &quot;John Doe&quot;,</div><div class="FixedLine">   &quot;age&quot;: 35</div><div class="FixedLine">}</div></div></div></div><div class="Para" id="Par135">I also presented the following schema as a <span id="ITerm43">JSON object</span>:<div class="ProgramCode" id="PC34"><div class="LineGroup"><div class="FixedLine">{</div><div class="FixedLine">   &quot;$schema&quot;: &quot;http://json-schema.org/draft-07/schema#&quot;,</div><div class="FixedLine">   &quot;title&quot;: &quot;Person&quot;,</div><div class="FixedLine">   &quot;description&quot;: &quot;A person&quot;,</div><div class="FixedLine">   &quot;type&quot;: &quot;object&quot;,</div><div class="FixedLine">   &quot;properties&quot;:</div><div class="FixedLine">   {</div><div class="FixedLine">      &quot;name&quot;:</div><div class="FixedLine">      {</div><div class="FixedLine">         &quot;description&quot;: &quot;A person&apos;s name&quot;,</div><div class="FixedLine">         &quot;type&quot;: &quot;string&quot;</div><div class="FixedLine">      },</div><div class="FixedLine">      &quot;age&quot;:</div><div class="FixedLine">      {</div><div class="FixedLine">         &quot;description&quot;: &quot;A person&apos;s age&quot;,</div><div class="FixedLine">         &quot;type&quot;: &quot;number&quot;,</div><div class="FixedLine">         &quot;minimum&quot;: 18,</div><div class="FixedLine">         &quot;maximum&quot;: 64</div><div class="FixedLine">      }</div><div class="FixedLine">   },</div><div class="FixedLine">   &quot;required&quot;: [&quot;name&quot;, &quot;age&quot;]</div><div class="FixedLine">}</div></div></div></div><div class="Para" id="Par136">Suppose that I <span id="ITerm44">copy</span> this schema to a <span class="EmphasisFontCategoryNonProportional ">schema.json</span> file and store it on my website at <span class="ExternalRef"><a href="http://javajeff.ca/schema.json"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://javajeff.ca/schema.json</span>
                  </span></a></span>. Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_8_Chapter.xhtml#PC35">8-15</a></span> presents the source code to an application that uses <span class="EmphasisFontCategoryNonProportional ">Json.Schema schema(URI)</span> to obtain this schema for validating the previous JSON object.<div class="ProgramCode" id="PC35"><div class="LineGroup"><div class="FixedLine">import java.net.URI;</div><div class="FixedLine">import java.net.URISyntaxException;</div></div><div class="LineGroup"><div class="FixedLine">import mjson.Json;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class mJsonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   final static String SCHEMA_URI =</div><div class="FixedLine">      &quot;http://javajeff.ca/schema.json&quot;;</div></div><div class="LineGroup"><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">      throws URISyntaxException</div><div class="FixedLine">   {</div><div class="FixedLine">      Json.Schema schema = Json.schema(new URI(SCHEMA_URI));</div><div class="FixedLine">      Json json = Json.read(&quot;{\&quot;name\&quot;: \&quot;John Doe\&quot;, &quot; +</div><div class="FixedLine">                            &quot;\&quot;age\&quot;: 35}&quot;);</div><div class="FixedLine">      out.println(schema.validate(json));</div><div class="FixedLine">      json = Json.read(&quot;{\&quot;name\&quot;: \&quot;John Doe\&quot;, &quot; +</div><div class="FixedLine">                       &quot;\&quot;age\&quot;: 65}&quot;);</div><div class="FixedLine">      out.println(schema.validate(json));</div><div class="FixedLine">      json = Json.read(&quot;{\&quot;name\&quot;: \&quot;John Doe\&quot;, &quot; +</div><div class="FixedLine">                       &quot;\&quot;age\&quot;: \&quot;35\&quot;}&quot;);</div><div class="FixedLine">      out.println(schema.validate(json));</div><div class="FixedLine">      json = Json.read(&quot;{\&quot;age\&quot;: 35}&quot;);</div><div class="FixedLine">      out.println(schema.validate(json));</div><div class="FixedLine">   }</div><div class="FixedLine">}<span id="ITerm45">
                        
                        
                      </span></div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-15</span><p class="SimplePara">Validating JSON Objects via an <span id="ITerm46">External Schema</span></p></div></div></div></div><div class="Para" id="Par137">Compile this source code and run the application. You should discover the following output:<div class="ProgramCode" id="PC36"><div class="LineGroup"><div class="FixedLine">{&quot;ok&quot;:true}</div><div class="FixedLine">{&quot;ok&quot;:false,&quot;errors&quot;:[&quot;Number 65 is above allowed maximum 64.0&quot;]}</div><div class="FixedLine">{&quot;ok&quot;:false,&quot;errors&quot;:[&quot;Type mistmatch for \&quot;35\&quot;, allowed types: [\&quot;number\&quot;]&quot;]}</div><div class="FixedLine">{&quot;ok&quot;:false,&quot;errors&quot;:[&quot;Required property name missing from object {\&quot;age\&quot;:35}&quot;]}</div></div></div></div></section><section class="Section2 RenderAsSection2" id="Sec9"><h3 class="Heading">Customization via Factories</h3><div class="Para" id="Par138"><span class="EmphasisFontCategoryNonProportional ">Json</span> defers the creation of <span class="EmphasisFontCategoryNonProportional ">Json</span> objects to a <span id="ITerm47">factory</span>, which is an instance of a class that implements the <span class="EmphasisFontCategoryNonProportional ">Json.Factory</span> interface鈥檚 methods:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par139">
                      <span class="EmphasisFontCategoryNonProportional ">Json array()</span>
                    </p></li><li><p class="Para" id="Par140">
                      <span class="EmphasisFontCategoryNonProportional ">Json bool(boolean value)</span>
                    </p></li><li><p class="Para" id="Par141">
                      <span class="EmphasisFontCategoryNonProportional ">Json make(Object anything)</span>
                    </p></li><li><p class="Para" id="Par142">
                      <span class="EmphasisFontCategoryNonProportional ">Json nil()</span>
                    </p></li><li><p class="Para" id="Par143">
                      <span class="EmphasisFontCategoryNonProportional ">Json number(Number value)</span>
                    </p></li><li><p class="Para" id="Par144">
                      <span class="EmphasisFontCategoryNonProportional ">Json object()</span>
                    </p></li><li><p class="Para" id="Par145">
                      <span class="EmphasisFontCategoryNonProportional ">Json string(String value)</span>
                    </p></li></ul></div></div><p class="Para" id="Par146">The <span class="EmphasisFontCategoryNonProportional ">Json.DefaultFactory</span> class provides default implementations of these methods, but you can provide <span id="ITerm48">custom implementations</span> when necessary. To avoid implementing all of these methods, you can extend <span class="ExternalRef"><a href="http://bolerio.github.io/mjson/apidocs/mjson/Json.DefaultFactory.html"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">DefaultFactory</span>
                  </span></a></span> and override only those methods of interest.</p><div class="Para" id="Par147">After creating a custom <span class="EmphasisFontCategoryNonProportional ">Factory</span> class<span id="ITerm49">
                  
                  
                </span>, you would instantiate it and then install the object by calling one of the following <span class="EmphasisFontCategoryNonProportional ">static Json</span> methods:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par148">
                      <span class="EmphasisFontCategoryNonProportional ">void setGlobalFactory(Json.Factory factory)</span>
                    </p></li><li><p class="Para" id="Par149">
                      <span class="EmphasisFontCategoryNonProportional ">void attachFactory(Json.Factory factory)</span>
                    </p></li></ul></div></div><p class="Para" id="Par150">The first method installs the specified <span class="EmphasisFontCategoryNonProportional ">factory</span> as a global factory, which is used by all threads that don鈥檛 have a specific thread-local factory attached to them. The second method attaches the specified <span class="EmphasisFontCategoryNonProportional ">factory</span> to the invoking thread only, which lets you use different thread factories in the same classloader. You can remove a thread-local factory and revert to the global factory for a thread by calling the <span class="EmphasisFontCategoryNonProportional ">void dettachFactory()</span> method.</p><div class="Para" id="Par151">One of the customizations mentioned in the mJson documentation is case-insensitive string comparison. Basically, you customize <span class="EmphasisFontCategoryNonProportional ">Json</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">equals()</span> method<span id="ITerm50">
                  
                  
                </span> to perform <span id="ITerm51">case-insensitive string comparisons</span>. Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_8_Chapter.xhtml#PC37">8-16</a></span> presents the source code to an application that shows how this is done.<div class="ProgramCode" id="PC37"><div class="LineGroup"><div class="FixedLine">import java.util.List;</div></div><div class="LineGroup"><div class="FixedLine">import mjson.Json;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class mJsonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      class MyFactory extends Json.DefaultFactory</div><div class="FixedLine">      {</div><div class="FixedLine">         @Override</div><div class="FixedLine">         public Json string(String x)</div><div class="FixedLine">         {</div><div class="FixedLine">            // Obtain the StringJson instance.</div><div class="FixedLine">            final Json json = super.string(x);</div></div><div class="LineGroup"><div class="FixedLine">            class StringIJson extends Json</div><div class="FixedLine">            {</div><div class="FixedLine">               private static final long serialVersionUID</div><div class="FixedLine">                  = 1L;</div></div><div class="LineGroup"><div class="FixedLine">               String val;</div></div><div class="LineGroup"><div class="FixedLine">               StringIJson(String val)</div><div class="FixedLine">               {</div><div class="FixedLine">                  this.val = val;</div><div class="FixedLine">               }</div></div><div class="LineGroup"><div class="FixedLine">               @Override</div><div class="FixedLine">               public byte asByte()</div><div class="FixedLine">               {</div><div class="FixedLine">                  return json.asByte();</div><div class="FixedLine">               }</div></div><div class="LineGroup"><div class="FixedLine">               @Override</div><div class="FixedLine">               public char asChar()</div><div class="FixedLine">               {</div><div class="FixedLine">                  return json.asChar();</div><div class="FixedLine">               }</div></div><div class="LineGroup"><div class="FixedLine">               @Override</div><div class="FixedLine">               public double asDouble()</div><div class="FixedLine">               {</div><div class="FixedLine">                  return json.asDouble();</div><div class="FixedLine">               }</div></div><div class="LineGroup"><div class="FixedLine">               @Override<span id="ITerm52">
                        
                        
                      </span></div><div class="FixedLine">               public float asFloat()</div><div class="FixedLine">               {</div><div class="FixedLine">                  return json.asFloat();</div><div class="FixedLine">               }</div></div><div class="LineGroup"><div class="FixedLine">               @Override</div><div class="FixedLine">               public int asInteger()</div><div class="FixedLine">               {</div><div class="FixedLine">                  return json.asInteger();</div><div class="FixedLine">               }</div></div><div class="LineGroup"><div class="FixedLine">               @Override</div><div class="FixedLine">               public List&lt;Object&gt; asList()</div><div class="FixedLine">               {</div><div class="FixedLine">                  return json.asList();</div><div class="FixedLine">               }</div></div><div class="LineGroup"><div class="FixedLine">               @Override</div><div class="FixedLine">               public long asLong()</div><div class="FixedLine">               {</div><div class="FixedLine">                  return json.asLong();</div><div class="FixedLine">               }</div></div><div class="LineGroup"><div class="FixedLine">               @Override</div><div class="FixedLine">               public short asShort()</div><div class="FixedLine">               {</div><div class="FixedLine">                  return json.asShort();</div><div class="FixedLine">               }</div></div><div class="LineGroup"><div class="FixedLine">               @Override</div><div class="FixedLine">               public String asString()</div><div class="FixedLine">               {</div><div class="FixedLine">                  return json.asString();</div><div class="FixedLine">               }<span id="ITerm53">
                        
                        
                      </span></div></div><div class="LineGroup"><div class="FixedLine">               @Override</div><div class="FixedLine">               public Json dup()</div><div class="FixedLine">               {</div><div class="FixedLine">                  return json.dup();</div><div class="FixedLine">               }</div></div><div class="LineGroup"><div class="FixedLine">               @Override</div><div class="FixedLine">               public boolean equals(Object x)</div><div class="FixedLine">               {</div><div class="FixedLine">                  return x instanceof StringIJson &amp;&amp;</div><div class="FixedLine">                         ((StringIJson) x).</div><div class="FixedLine">                         val.equalsIgnoreCase(val);</div><div class="FixedLine">               }</div></div><div class="LineGroup"><div class="FixedLine">               @Override</div><div class="FixedLine">               public Object getValue()</div><div class="FixedLine">               {</div><div class="FixedLine">                  return json.getValue();</div><div class="FixedLine">               }</div></div><div class="LineGroup"><div class="FixedLine">               @Override</div><div class="FixedLine">               public int hashCode()</div><div class="FixedLine">               {</div><div class="FixedLine">                  return json.hashCode();</div><div class="FixedLine">               }</div></div><div class="LineGroup"><div class="FixedLine">               @Override</div><div class="FixedLine">               public boolean isString()</div><div class="FixedLine">               {</div><div class="FixedLine">                  return json.isString();</div><div class="FixedLine">               }<span id="ITerm54">
                        
                        
                      </span></div></div><div class="LineGroup"><div class="FixedLine">               @Override</div><div class="FixedLine">               public String toString()</div><div class="FixedLine">               {</div><div class="FixedLine">                  return json.toString();</div><div class="FixedLine">               }</div><div class="FixedLine">            }</div><div class="FixedLine">            return new StringIJson(x);</div><div class="FixedLine">         }</div><div class="FixedLine">      }</div></div><div class="LineGroup"><div class="FixedLine">      Json.setGlobalFactory(new MyFactory());</div><div class="FixedLine">      Json json1 = Json.read(&quot;\&quot;abc\&quot;&quot;);</div><div class="FixedLine">      Json json2 = Json.read(&quot;\&quot;abc\&quot;&quot;);</div><div class="FixedLine">      Json json3 = Json.read(&quot;\&quot;Abc\&quot;&quot;);</div><div class="FixedLine">      out.println(json1.equals(json2));</div><div class="FixedLine">      out.println(json1.equals(json3));</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 8-16</span><p class="SimplePara">Customizing <span class="EmphasisFontCategoryNonProportional ">Json</span> to Support Case-Insensitive String Comparisons</p></div></div></div></div><div class="Para" id="Par152">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_8_Chapter.xhtml#PC37">8-16</a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">mJsonDemo</span> class<span id="ITerm55">
                  
                </span> declares a nested <span class="EmphasisFontCategoryNonProportional ">MyFactory</span> class that extends <span class="EmphasisFontCategoryNonProportional ">Json.DefaultFactory</span>. The <span class="EmphasisFontCategoryNonProportional ">main()</span> method<span id="ITerm56">
                  
                  
                </span> instantiates this class and registers it with <span class="EmphasisFontCategoryNonProportional ">Json</span> via the following method call:<div class="ProgramCode" id="PC38"><div class="LineGroup"><div class="FixedLine">Json.setGlobalFactory(new MyFactory());</div></div></div></div><p class="Para" id="Par153"><span class="EmphasisFontCategoryNonProportional ">main()</span> proceeds to parse three JSON strings via <span class="EmphasisFontCategoryNonProportional ">read()</span> method calls and then perform equality operations on them, outputting the results.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar5"><h3 class="Heading">Note</h3><p class="Para" id="Par154">The <span class="EmphasisFontCategoryNonProportional ">equals()</span> method that鈥檚 called is not located in the <span class="EmphasisFontCategoryNonProportional ">Json</span> class. Instead, it鈥檚 located in a nested package-private class, such as <span class="EmphasisFontCategoryNonProportional ">StringJson</span>. In the listing, the objects assigned to <span class="EmphasisFontCategoryNonProportional ">json1</span>, <span class="EmphasisFontCategoryNonProportional ">json2</span>, and <span class="EmphasisFontCategoryNonProportional ">json3</span> have type <span class="EmphasisFontCategoryNonProportional ">StringJson</span> or (with the factory installed) <span class="EmphasisFontCategoryNonProportional ">StringIJson</span> (discussed shortly).</p></div><p class="Para" id="Par155"><span class="EmphasisFontCategoryNonProportional ">MyFactory</span> overrides the <span class="EmphasisFontCategoryNonProportional ">string(String)</span> method, which is responsible for creating <span class="EmphasisFontCategoryNonProportional ">Json</span> objects that represent JSON strings. In the <span class="EmphasisFontCategoryNonProportional ">Json.java</span> source code (which you can access from <span class="ExternalRef"><a href="http://bolerio.github.io/mjson/%25e2%2580%2594"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://bolerio.github.io/mjson/鈥?/span&gt;
                  </span></a></span>click the tar.gz or .zip folder link near the top of the page), <span class="EmphasisFontCategoryNonProportional ">string(String)</span> executes <span class="EmphasisFontCategoryNonProportional ">return new StringJson(x, null);</span>.</p><p class="Para" id="Par156"><span class="EmphasisFontCategoryNonProportional ">StringJson</span> is one of <span class="EmphasisFontCategoryNonProportional ">Json</span>鈥檚 nested package-private <span class="EmphasisFontCategoryNonProportional ">static</span> classes. Because it cannot be accessed from outside of the <span class="EmphasisFontCategoryNonProportional ">mjson</span> package, <span class="EmphasisFontCategoryNonProportional ">MyFactory</span>鈥檚 overriding <span class="EmphasisFontCategoryNonProportional ">string(String)</span> method<span id="ITerm57">
                  
                  
                </span> declares an equivalent <span class="EmphasisFontCategoryNonProportional ">StringIJson</span> class (the <span class="EmphasisFontCategoryNonProportional ">I</span> is for case-insensitive).</p><p class="Para" id="Par157">Rather than copy all of the code from <span class="EmphasisFontCategoryNonProportional ">StringJson</span> to <span class="EmphasisFontCategoryNonProportional ">StringIJson</span>, which is wasteful duplication and won鈥檛 work anyway because some of the code relies on other package-private types, I chose to use the adapter/wrapper design pattern (<span class="ExternalRef"><a href="http://en.wikipedia.org/wiki/Adapter_pattern"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://en.wikipedia.org/wiki/Adapter_pattern</span>
                  </span></a></span>).</p><p class="Para" id="Par158">The idea behind the adapter pattern is to have <span class="EmphasisFontCategoryNonProportional ">StringIJson</span> duplicate <span class="EmphasisFontCategoryNonProportional ">StringJson</span> methods in terms of their headers, and code the bodies to forward almost all method calls to the <span class="EmphasisFontCategoryNonProportional ">StringJson</span> equivalents. This is possible by having <span class="EmphasisFontCategoryNonProportional ">MyFactory</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">string(String)</span> method first invoke <span class="EmphasisFontCategoryNonProportional ">DefaultFactory</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">string(String)</span> method, which returns the <span class="EmphasisFontCategoryNonProportional ">StringJson</span> object. It鈥檚 then a simple matter of forwarding calls to this object.</p><p class="Para" id="Par159">The exception is the <span class="EmphasisFontCategoryNonProportional ">equals()</span> method<span id="ITerm58">
                  
                  
                </span>. <span class="EmphasisFontCategoryNonProportional ">StringIJson</span> codifies this method to be nearly identical to its <span class="EmphasisFontCategoryNonProportional ">StringJson</span> counterpart. The main difference is the call to <span class="EmphasisFontCategoryNonProportional ">String</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">equalsIgnoreCase()</span><span id="ITerm59">
                  
                  
                </span> method instead of its <span class="EmphasisFontCategoryNonProportional ">equals()</span> method. The result is a case-insensitive <span class="EmphasisFontCategoryNonProportional ">equals()</span> method.</p><div class="Para" id="Par160">Compile the source code and run the application, and you should observe the following output:<div class="ProgramCode" id="PC39"><div class="LineGroup"><div class="FixedLine">true</div><div class="FixedLine">true</div></div></div></div><p class="Para" id="Par161">The first output line shows that <span class="EmphasisFontCategoryNonProportional ">abc</span> equals <span class="EmphasisFontCategoryNonProportional ">abc</span>. The second output line proves that the factory was installed because it shows that <span class="EmphasisFontCategoryNonProportional ">abc</span> equals <span class="EmphasisFontCategoryNonProportional ">Abc</span>.</p><div class="FormalPara FormalParaRenderingStyle3 ParaTypeOverview" id="FPar6"><h3 class="Heading">Exercises</h3><div class="Para" id="Par162">The following exercises are designed to test your understanding of Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_8_Chapter.xhtml"><span class="RefSource">8</span></a></span>鈥檚 content:<div class="OrderedList"><ol><li class="ListItem"><span class="ItemNumber">1.</span><div class="ItemContent"><p class="Para" id="Par163">Define mJson.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">2.</span><div class="ItemContent"><p class="Para" id="Par164">Describe the <span class="EmphasisFontCategoryNonProportional ">Json</span> class.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">3.</span><div class="ItemContent"><p class="Para" id="Par165">Identify <span class="EmphasisFontCategoryNonProportional ">Json</span>鈥檚 methods for reading and parsing external JSON objects.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">4.</span><div class="ItemContent"><p class="Para" id="Par166">True or false: The <span class="EmphasisFontCategoryNonProportional ">read()</span> methods can also parse smaller JSON fragments, such as an array of different-typed values.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">5.</span><div class="ItemContent"><p class="Para" id="Par167">Identify the methods that <span class="EmphasisFontCategoryNonProportional ">Json</span> provides for creating JSON objects.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">6.</span><div class="ItemContent"><p class="Para" id="Par168">What does <span class="EmphasisFontCategoryNonProportional ">Json</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">boolean isPrimitive()</span> method accomplish?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">7.</span><div class="ItemContent"><p class="Para" id="Par169">How do you return a <span class="EmphasisFontCategoryNonProportional ">Json</span> object鈥檚 JSON array?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">8.</span><div class="ItemContent"><p class="Para" id="Par170">True or false: <span class="EmphasisFontCategoryNonProportional ">Json</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">Map&lt;String, Json&gt; asJsonMap()</span> method returns a map of the properties of a <span class="EmphasisFontCategoryNonProportional ">Json</span> object that describes a JSON object. The returned map is a copy, and modifications to it don鈥檛 affect the <span class="EmphasisFontCategoryNonProportional ">Json</span> object.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">9.</span><div class="ItemContent"><p class="Para" id="Par171">Which <span class="EmphasisFontCategoryNonProportional ">Json</span> methods let you access the contents of arrays and objects?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">10.</span><div class="ItemContent"><p class="Para" id="Par172">What does <span class="EmphasisFontCategoryNonProportional ">Json</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">boolean is(int index, Object value)</span> method accomplish?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">11.</span><div class="ItemContent"><p class="Para" id="Par173">What does <span class="EmphasisFontCategoryNonProportional ">Json</span> do when you attempt to set the value for a nonexistent array element?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">12.</span><div class="ItemContent"><p class="Para" id="Par174">What is the difference between <span class="EmphasisFontCategoryNonProportional ">Json</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">atDel()</span> and <span class="EmphasisFontCategoryNonProportional ">delAt()</span> methods?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">13.</span><div class="ItemContent"><p class="Para" id="Par175">What does <span class="EmphasisFontCategoryNonProportional ">Json</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">Json with(Json objectorarray)</span> method accomplish?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">14.</span><div class="ItemContent"><p class="Para" id="Par176">Identify <span class="EmphasisFontCategoryNonProportional ">Json</span>鈥檚 methods for obtaining a <span class="EmphasisFontCategoryNonProportional ">Json.Schema</span> object.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">15.</span><div class="ItemContent"><p class="Para" id="Par177">How do you validate a JSON document against a schema?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">16.</span><div class="ItemContent"><p class="Para" id="Par178">What is the difference between <span class="EmphasisFontCategoryNonProportional ">Json</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">setGlobalFactory()</span> and <span class="EmphasisFontCategoryNonProportional ">attachFactory()</span> methods?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">17.</span><div class="ItemContent"><p class="Para" id="Par179">Two <span class="EmphasisFontCategoryNonProportional ">Json</span> methods that were not discussed in this chapter are <span class="EmphasisFontCategoryNonProportional ">Json dup()</span> and <span class="EmphasisFontCategoryNonProportional ">String pad(String callback)</span>. What do they do?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">18.</span><div class="ItemContent"><p class="Para" id="Par180">Write an <span class="EmphasisFontCategoryNonProportional ">mJsonDemo</span> application that demonstrates <span class="EmphasisFontCategoryNonProportional ">dup()</span> and <span class="EmphasisFontCategoryNonProportional ">pad()</span>.</p></div><div class="ClearBoth"> </div></li></ol></div></div></div></section></section><section class="Section1 RenderAsSection1" id="Sec10"><h2 class="Heading">Summary</h2><p class="Para" id="Par181">mJson is a small Java JSON library for parsing JSON objects into Java objects and vice versa. It consists of a <span class="EmphasisFontCategoryNonProportional ">Json</span> class that describes a JSON object or part of a JSON object. <span class="EmphasisFontCategoryNonProportional ">Json</span> contains <span class="EmphasisFontCategoryNonProportional ">Schema</span> and <span class="EmphasisFontCategoryNonProportional ">Factory</span> interfaces, more than 50 methods, and other members.</p><p class="Para" id="Par182">After obtaining the mJson library, you learned how to use this library to create <span class="EmphasisFontCategoryNonProportional ">Json</span> objects, learn about <span class="EmphasisFontCategoryNonProportional ">Json</span> objects, navigate <span class="EmphasisFontCategoryNonProportional ">Json</span> object hierarchies, modify <span class="EmphasisFontCategoryNonProportional ">Json</span> objects, validate JSON documents against a schema, and customize <span class="EmphasisFontCategoryNonProportional ">Json</span> by installing nondefault factories.</p><p class="Para" id="Par183">Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml"><span class="RefSource">9</span></a></span> introduces Gson for parsing and creating JSON objects.</p></section></div><div class="annotator-outer annotator-viewer viewer annotator-hide"> </div></div></div>
    </section>
  </div>
</div>
<div class="font-flyout" style="top: 201.016px; left: 2474px;"> </div>
<hr/>

<!--if IE]><![endif]--><!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="3866890"
  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"
  data-username="levinxccai"
  data-account-type="B2B"
  
  data-activated-trial-date="11/06/2017"


  data-archive="9781484243305"
  data-publishers="Apress"



  data-htmlfile-name="394211_2_En_9_Chapter.xhtml"
  data-epub-title="Java XML and JSON: Document Processing for Java SE" data-debug=0 data-testing=0><![endif]--><!--if gt IE 8]><!--><!--![endif]-->



<a name="11_"></a>

<div class="application" id="container" style="height: auto;">
  <div class="js-toc">
    <section role="document">
      <div id="sbo-rt-content" style="max-width:72.5em; transform: none;"><div class="annotator-wrapper"><!--egin Abstract--><div class="MainTitleSection"><h1 class="ChapterTitle" lang="en">9. Parsing and Creating JSON Objects with Gson</h1></div><div class="AuthorGroup"><div class="AuthorNames"><span class="Author"><span class="AuthorName">Jeff Friesen</span><sup><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#Aff2">1</a> <span class="ContactIcon"></span></sup></span></div><div class="Affiliations"><div class="Affiliation" id="Aff2"><span class="AffiliationNumber">(1)</span><div class="AffiliationText">Dauphin, MB, Canada</div></div><div class="ClearBoth"> </div></div></div><!--nd Abstract--><div class="Fulltext"><p class="Para" id="Par2">Gson is another API for parsing and creating JSON objects. Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml"><span class="RefSource">9</span></a></span> explores the latest version of this open-source Google product.</p><section class="Section1 RenderAsSection1" id="Sec1"><h2 class="Heading">What Is Gson?</h2><p class="Para" id="Par3"><em class="EmphasisTypeItalic ">Gson</em> (also known as <em class="EmphasisTypeItalic ">Google Gson</em>) is a small Java-based library for parsing and creating JSON objects. Google developed Gson for its own projects, but later made Gson publicly available, starting with version 1.0. According to Wikipedia (<span class="ExternalRef"><a href="http://en.wikipedia.org/wiki/Gson"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional ">http://en.wikipedia.org/wiki/Gson</span>
                </span></a></span>), the latest version (at the time of writing) is 2.8.5.</p><div class="Para" id="Par4">Gson鈥檚 <span id="ITerm1">GitHub page</span> (<span class="ExternalRef"><a href="http://github.com/google/gson"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional ">http://github.com/google/gson</span>
                </span></a></span>) identifies five important design goals for <span id="ITerm2">Gson</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par5">Provide simple <span class="EmphasisFontCategoryNonProportional ">toJson()</span> and <span class="EmphasisFontCategoryNonProportional ">fromJson()</span> methods to convert Java objects to JSON objects and vice versa</p></li><li><p class="Para" id="Par6">Allow pre-existing unmodifiable objects to be converted to and from JSON</p></li><li><p class="Para" id="Par7">Provide extensive support for Java Generics</p></li><li><p class="Para" id="Par8">Allow custom representations of objects</p></li><li><p class="Para" id="Par9">Support arbitrarily complex objects (with deep inheritance hierarchies and extensive use of generic types)</p></li></ul></div></div><p class="Para" id="Par10">Gson parses JSON objects by deserializing JSON objects into Java objects. Similarly, it creates JSON objects by serializing Java objects into JSON objects. Gson relies on Java鈥檚 Reflection API to assist with serialization and <span id="ITerm3">deserialization</span>.</p><section class="Section2 RenderAsSection2" id="Sec2"><h3 class="Heading">Obtaining and Using Gson</h3><p class="Para" id="Par11">Gson is distributed as a single JAR file; <span class="EmphasisFontCategoryNonProportional ">gson-2.8.5.jar</span> is the most recent <span id="ITerm4">JAR file</span> at the time of writing. To obtain this JAR file, point your browser to <span class="ExternalRef"><a href="http://repo1.maven.org/maven2/org/sharegov/mjson/1.3/mjson-1.3.jar.%250dmjson-1.3.jar%2520contains"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://search.maven.org/#artifactdetails|com.google.code.gson|gson|2.8.5|jar</span>
                  </span></a></span>, click the downloads link and select 鈥渏ar鈥?from the drop-down list, and save the <span class="EmphasisFontCategoryNonProportional ">gson-2.8.5.jar</span> file when prompted to do so. Also, you might want to download <span class="EmphasisFontCategoryNonProportional ">gson-2.8.5-javadoc.jar</span>, which contains this API鈥檚 Javadoc.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar1"><h3 class="Heading">Note</h3><p class="Para" id="Par12">Gson is licensed according to Apache License Version 2.0 (<span class="ExternalRef"><a href="http://www.apache.org/licenses"><span class="RefSource">
                      <span class="EmphasisFontCategoryNonProportional ">www.apache.org/licenses</span>
                    </span></a></span><span class="EmphasisFontCategoryNonProportional ">/</span>).</p></div><div class="Para" id="Par13">It鈥檚 easy to work with <span class="EmphasisFontCategoryNonProportional ">gson-2.8.5.jar</span>. Simply include it in the CLASSPATH when compiling source code or running an application, as follows:<div class="ProgramCode" id="PC1"><div class="LineGroup"><div class="FixedLine">javac -cp gson-2.8.5.jar <em class="EmphasisTypeItalic ">source file</em></div><div class="FixedLine">java -cp gson-2.8.5.jar;. <em class="EmphasisTypeItalic ">main classfile</em><span id="ITerm5">
                        
                        
                      </span></div></div></div></div></section></section><section class="Section1 RenderAsSection1" id="Sec3"><h2 class="Heading">Exploring Gson</h2><div class="Para" id="Par14">Gson consists of more than 30 classes and interfaces distributed among four <span id="ITerm6">packages</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par15"><span class="EmphasisFontCategoryNonProportional ">com.google.gson</span>: This package provides access to <span class="EmphasisFontCategoryNonProportional ">Gson</span>, the main class for working with Gson.</p></li><li><p class="Para" id="Par16"><span class="EmphasisFontCategoryNonProportional ">com.google.gson.annotations</span>: This package provides annotation types for use with Gson.</p></li><li><p class="Para" id="Par17"><span class="EmphasisFontCategoryNonProportional ">com.google.gson.reflect</span>: This package provides a utility class for obtaining type information from a generic type.</p></li><li><p class="Para" id="Par18"><span class="EmphasisFontCategoryNonProportional ">com.google.gson.stream</span>: This package provides utility classes for reading and writing JSON-encoded values.</p></li></ul></div></div><p class="Para" id="Par19">In this section, I first introduce you to the <span class="EmphasisFontCategoryNonProportional ">Gson</span> class. Then, I focus on <span class="EmphasisFontCategoryNonProportional ">Gson</span> deserialization (parsing JSON objects), followed by <span class="EmphasisFontCategoryNonProportional ">Gson</span> serialization (creating JSON objects). I close by briefly discussing additional Gson features, such as annotations and type <span id="ITerm7">adapters</span>.</p><section class="Section2 RenderAsSection2" id="Sec4"><h3 class="Heading">Introducing the Gson Class</h3><div class="Para" id="Par20">The <span class="EmphasisFontCategoryNonProportional ">Gson</span>
<span id="ITerm8">class</span> handles the conversion between JSON and Java objects. You can instantiate this class by using the <span class="EmphasisFontCategoryNonProportional ">Gson()</span> constructor, or you can obtain a <span class="EmphasisFontCategoryNonProportional ">Gson</span> instance by working with the <span class="EmphasisFontCategoryNonProportional ">com.google.gson.GsonBuilder</span> class. The following code fragment demonstrates both approaches:<div class="ProgramCode" id="PC2"><div class="LineGroup"><div class="FixedLine">Gson gson1 = new Gson();</div><div class="FixedLine">Gson gson2 = new GsonBuilder()</div><div class="FixedLine">     .registerTypeAdapter(Id.class, new IdTypeAdapter())</div><div class="FixedLine">     .serializeNulls()</div><div class="FixedLine">     .setDateFormat(DateFormat.LONG)</div><div class="FixedLine">     .setFieldNamingPolicy(FieldNamingPolicy.UPPER_CAMEL_CASE)</div><div class="FixedLine">     .setPrettyPrinting()</div><div class="FixedLine">     .setVersion(1.0)</div><div class="FixedLine">     .create();<span id="ITerm9">
                        
                        
                      </span></div></div></div></div><p class="Para" id="Par21">Call <span class="EmphasisFontCategoryNonProportional ">Gson()</span> when you want to work with the default configuration, and use <span class="EmphasisFontCategoryNonProportional ">GsonBuilder</span> when you want to override the default configuration. Configuration <span id="ITerm10">method</span> calls are chained together, with <span class="EmphasisFontCategoryNonProportional ">GsonBuilder</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">Gson create()</span> method being called last to return the resulting <span class="EmphasisFontCategoryNonProportional ">Gson</span> object.</p><div class="Para" id="Par22"><span class="EmphasisFontCategoryNonProportional ">Gson</span> supports the following default configuration (the list isn鈥檛 complete; check the <span class="EmphasisFontCategoryNonProportional ">Gson</span> and <span class="EmphasisFontCategoryNonProportional ">GsonBuilder</span> documentation for more information):<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par23"><span class="EmphasisFontCategoryNonProportional ">Gson</span> provides default serialization and deserialization for <span class="EmphasisFontCategoryNonProportional ">java.lang.Enum</span>, <span class="EmphasisFontCategoryNonProportional ">java.util.</span><span class="ExternalRef"><a href="http://docs.oracle.com/javase/6/docs/api/java/util/Map.html?is-external=true"><span class="RefSource">
                          <span class="EmphasisFontCategoryNonProportional ">Map</span>
                        </span></a></span>, <span class="EmphasisFontCategoryNonProportional ">java.net.</span><span class="ExternalRef"><a href="http://docs.oracle.com/javase/6/docs/api/java/net/URL.html?is-external=true"><span class="RefSource">
                          <span class="EmphasisFontCategoryNonProportional ">URL</span>
                        </span></a></span>, <span class="EmphasisFontCategoryNonProportional ">java.net.</span><span class="ExternalRef"><a href="http://docs.oracle.com/javase/6/docs/api/java/net/URI.html?is-external=true"><span class="RefSource">
                          <span class="EmphasisFontCategoryNonProportional ">URI</span>
                        </span></a></span>, <span class="EmphasisFontCategoryNonProportional ">java.util.</span><span class="ExternalRef"><a href="http://docs.oracle.com/javase/6/docs/api/java/util/Locale.html?is-external=true"><span class="RefSource">
                          <span class="EmphasisFontCategoryNonProportional ">Locale</span>
                        </span></a></span>, <span class="EmphasisFontCategoryNonProportional ">java.util.</span><span class="ExternalRef"><a href="http://docs.oracle.com/javase/6/docs/api/java/util/Date.html?is-external=true"><span class="RefSource">
                          <span class="EmphasisFontCategoryNonProportional ">Date</span>
                        </span></a></span>, <span class="EmphasisFontCategoryNonProportional ">java.math.</span><span class="ExternalRef"><a href="http://docs.oracle.com/javase/6/docs/api/java/math/BigDecimal.html?is-external=true"><span class="RefSource">
                          <span class="EmphasisFontCategoryNonProportional ">BigDecimal</span>
                        </span></a></span>, and <span class="EmphasisFontCategoryNonProportional ">java.math.</span><span class="ExternalRef"><a href="http://docs.oracle.com/javase/6/docs/api/java/math/BigInteger.html?is-external=true"><span class="RefSource">
                          <span class="EmphasisFontCategoryNonProportional ">BigInteger</span>
                        </span></a></span> instances. You can change the default representation by registering a <em class="EmphasisTypeItalic ">type adapter</em> (discussed later) via <span class="EmphasisFontCategoryNonProportional ">GsonBuilder.registerTypeAdapter(Type, Object)</span>.</p></li><li><p class="Para" id="Par24">The generated JSON text omits all <span class="EmphasisFontCategoryNonProportional ">null</span> fields. However, it preserves <span class="EmphasisFontCategoryNonProportional ">null</span>s in arrays because an array is an ordered list. Also, if a field isn鈥檛 <span class="EmphasisFontCategoryNonProportional ">null</span>, but its generated JSON text is empty, the field is kept. You can configure <span class="EmphasisFontCategoryNonProportional ">Gson</span> to serialize <span class="EmphasisFontCategoryNonProportional ">null</span> values by calling <span class="EmphasisFontCategoryNonProportional ">GsonBuilder.serializeNulls()</span>.</p></li><li><p class="Para" id="Par25">The default <span class="EmphasisFontCategoryNonProportional ">Date</span> format is the same as <span class="EmphasisFontCategoryNonProportional ">java.text.DateFormat.DEFAULT</span>. This format ignores the millisecond portion of the date during serialization. You can change the default format by invoking <span class="EmphasisFontCategoryNonProportional ">GsonBuilder.setDateFormat(int)</span> or <span class="EmphasisFontCategoryNonProportional ">GsonBuilder.setDateFormat(String)</span><span id="ITerm11">
                        
                        
                      </span>.</p></li><li><p class="Para" id="Par26">The default field-naming policy for the output JSON text is the same as in Java. For example, a Java class field named <span class="EmphasisFontCategoryNonProportional ">versionNumber</span> will be output as <span class="EmphasisFontCategoryNonProportional ">versionNumber</span> in JSON. The same rules are applied for mapping incoming JSON to Java classes. You can change this policy by calling <span class="EmphasisFontCategoryNonProportional ">GsonBuilder.setFieldNamingPolicy(FieldNamingPolicy)</span>.</p></li><li><p class="Para" id="Par27">The JSON text that鈥檚 generated by the <span class="EmphasisFontCategoryNonProportional ">toJson()</span> methods is represented compactly: all unneeded whitespace is removed. You can change this behavior by calling <span class="EmphasisFontCategoryNonProportional ">GsonBuilder.setPrettyPrinting()</span>.</p></li><li><p class="Para" id="Par28">By default, <span class="EmphasisFontCategoryNonProportional ">Gson</span> ignores <span class="EmphasisFontCategoryNonProportional ">@Since</span> annotations. You can enable <span class="EmphasisFontCategoryNonProportional ">Gson</span> to use these annotations by calling <span class="EmphasisFontCategoryNonProportional ">GsonBuilder.setVersion(double)</span>.</p></li><li><p class="Para" id="Par29">By default, <span class="EmphasisFontCategoryNonProportional ">Gson</span> ignores <span class="EmphasisFontCategoryNonProportional ">@Expose</span> annotations. You can enable <span class="EmphasisFontCategoryNonProportional ">Gson</span> to serialize/deserialize only those fields marked with this annotation by calling <span class="EmphasisFontCategoryNonProportional ">GsonBuilder.excludeFieldsWithoutExposeAnnotation()</span>.</p></li><li><p class="Para" id="Par30">By default, <span class="EmphasisFontCategoryNonProportional ">Gson</span> excludes <span class="EmphasisFontCategoryNonProportional ">transient</span> or <span class="EmphasisFontCategoryNonProportional ">static</span> fields from consideration for serialization and deserialization. You can change this behavior by calling <span class="EmphasisFontCategoryNonProportional ">GsonBuilder.excludeFieldsWithModifiers(int...)</span><span id="ITerm12">
                        
                        
                      </span>.</p></li></ul></div></div><div class="Para" id="Par31">Once you have a <span class="EmphasisFontCategoryNonProportional ">Gson</span> object, you can call various <span class="EmphasisFontCategoryNonProportional ">fromJson()</span> and <span class="EmphasisFontCategoryNonProportional ">toJson()</span> methods to convert between JSON and Java <span id="ITerm13">objects</span>. For example, Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC3">9-1</a></span> presents a simple application that obtains a pair of <span class="EmphasisFontCategoryNonProportional ">Gson</span> objects and demonstrates JSON-Java object conversion in terms of JSON primitives.<div class="ProgramCode" id="PC3"><div class="LineGroup"><div class="FixedLine">import com.google.gson.Gson;</div><div class="FixedLine">import com.google.gson.GsonBuilder;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class GsonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      Gson gson = new Gson();</div><div class="FixedLine">      String name = gson.fromJson(&quot;\&quot;John Doe\&quot;&quot;,</div><div class="FixedLine">                                  String.class);</div><div class="FixedLine">      out.println(name);</div><div class="FixedLine">      gson.toJson(256, out);</div><div class="FixedLine">      out.println();</div><div class="FixedLine">      gson.toJson(&quot;&lt;html&gt;&quot;, out);</div><div class="FixedLine">      out.println();</div><div class="FixedLine">      gson = new GsonBuilder().disableHtmlEscaping().create();</div><div class="FixedLine">      gson.toJson(&quot;&lt;html&gt;&quot;, out);</div><div class="FixedLine">      out.println();<span id="ITerm14">
                        
                        
                      </span></div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 9-1</span><p class="SimplePara">Converting Between JSON Primitives and Their Java <span id="ITerm15">Equivalents</span></p></div></div></div></div><p class="Para" id="Par32">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC3">9-1</a></span> declares a <span class="EmphasisFontCategoryNonProportional ">GsonDemo</span> class whose <span class="EmphasisFontCategoryNonProportional ">main()</span> method first instantiates <span class="EmphasisFontCategoryNonProportional ">Gson</span>, keeping its default configuration. It then invokes <span class="EmphasisFontCategoryNonProportional ">Gson</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">&lt;T&gt; T fromJson(String json, Class&lt;T&gt; classOfT)</span> generic method to deserialize the specified <span class="EmphasisFontCategoryNonProportional ">java.lang.String</span>-based JSON text (in <span class="EmphasisFontCategoryNonProportional ">json</span>) into an object of the specified class (<span class="EmphasisFontCategoryNonProportional ">classOfT</span>), which happens to be <span class="EmphasisFontCategoryNonProportional ">String</span>.</p><p class="Para" id="Par33">JSON string <span class="EmphasisFontCategoryNonProportional ">John Doe</span> (the double quotes are mandatory), which is expressed as a Java <span class="EmphasisFontCategoryNonProportional ">String</span> object, is converted (minus the double quotes) to a Java <span class="EmphasisFontCategoryNonProportional ">String</span> object. A reference to this object is assigned to <span class="EmphasisFontCategoryNonProportional ">name</span>.</p><p class="Para" id="Par34">After outputting the returned name, <span class="EmphasisFontCategoryNonProportional ">main()</span> calls <span class="EmphasisFontCategoryNonProportional ">Gson</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">void toJson(Object src, Appendable writer)</span> method to convert autoboxed integer <span class="EmphasisFontCategoryNonProportional ">256</span> (stored by the compiler in a <span class="EmphasisFontCategoryNonProportional ">java.lang.Integer</span> object) into a JSON integer and output the result to the standard output stream.</p><p class="Para" id="Par35"><span class="EmphasisFontCategoryNonProportional ">main()</span> reinvokes <span class="EmphasisFontCategoryNonProportional ">toJson()</span> to output a Java string containing <span class="EmphasisFontCategoryNonProportional ">&lt;html&gt;</span>. By default, <span class="EmphasisFontCategoryNonProportional ">Gson</span> escapes the HTML <span class="EmphasisFontCategoryNonProportional ">&lt;</span> and <span class="EmphasisFontCategoryNonProportional ">&gt;</span> characters, and so these characters are not output. To prevent this escaping, it鈥檚 necessary to obtain a <span class="EmphasisFontCategoryNonProportional ">Gson</span> object via <span class="EmphasisFontCategoryNonProportional ">GsonBuilder</span>, invoking <span class="EmphasisFontCategoryNonProportional ">GsonBuilder</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">GsonBuilder disableHtmlEscaping()</span> method<span id="ITerm16">
                  
                </span>, which <span class="EmphasisFontCategoryNonProportional ">main()</span> does next. A second attempt to output <span class="EmphasisFontCategoryNonProportional ">&lt;html&gt;</span> reveals no escaping.</p><div class="Para" id="Par36">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC3">9-1</a></span> as follows:<div class="ProgramCode" id="PC4"><div class="LineGroup"><div class="FixedLine">javac -cp gson-2.8.5.jar GsonDemo.java</div></div></div></div><div class="Para" id="Par37">Run the resulting application as follows:<div class="ProgramCode" id="PC5"><div class="LineGroup"><div class="FixedLine">java -cp gson-2.8.5.jar;. GsonDemo</div></div></div></div><div class="Para" id="Par38">You should observe the following output:<div class="ProgramCode" id="PC6"><div class="LineGroup"><div class="FixedLine">John Doe</div><div class="FixedLine">256</div><div class="FixedLine">\u003chtml\u003e</div><div class="FixedLine">&lt;html&gt;</div></div></div></div><p class="Para" id="Par39">The output isn鈥檛 impressive, but it鈥檚 a start. In the next two sections, you鈥檒l see more useful examples of deserialization and serialization.</p></section><section class="Section2 RenderAsSection2" id="Sec5"><h3 class="Heading">Parsing JSON Objects Through Deserialization</h3><div class="Para" id="Par40">Apart from parsing JSON <span id="ITerm17">primitives</span> (such as numbers or strings) into their Java equivalents, <span class="EmphasisFontCategoryNonProportional ">Gson</span><span id="ITerm18">
                  
                </span> lets you parse JSON objects into Java objects. For example, suppose you have the following JSON object, which describes a person:<div class="ProgramCode" id="PC7"><div class="LineGroup"><div class="FixedLine">{ &quot;name&quot;: &quot;John Doe&quot;, &quot;age&quot;: 45 }</div></div></div></div><div class="Para" id="Par41">Also, suppose you have the following Java class:<div class="ProgramCode" id="PC8"><div class="LineGroup"><div class="FixedLine">class Person</div><div class="FixedLine">{</div><div class="FixedLine">   String name;</div><div class="FixedLine">   int age;</div><div class="FixedLine">}</div></div></div></div><div class="Para" id="Par42">You can use the previous <span class="EmphasisFontCategoryNonProportional ">fromJson()</span> method to parse the JSON object into an instance of the <span class="EmphasisFontCategoryNonProportional ">Person</span> class, which I demonstrate in Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC9">9-2</a></span>.<div class="ProgramCode" id="PC9"><div class="LineGroup"><div class="FixedLine">import com.google.gson.Gson;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class GsonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   static class Person</div><div class="FixedLine">   {</div><div class="FixedLine">      String name;</div><div class="FixedLine">      int age;</div></div><div class="LineGroup"><div class="FixedLine">      Person(String name, int age)</div><div class="FixedLine">      {</div><div class="FixedLine">         this.name = name;</div><div class="FixedLine">         this.age = age;</div><div class="FixedLine">      }</div></div><div class="LineGroup"><div class="FixedLine">      @Override</div><div class="FixedLine">      public String toString()</div><div class="FixedLine">      {</div><div class="FixedLine">         return name + &quot;: &quot; + age;</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      Gson gson = new Gson();</div><div class="FixedLine">      String json = &quot;{ name: \&quot;John Doe\&quot;, age: 45 }&quot;;</div><div class="FixedLine">      Person person = gson.fromJson(json, Person.class);</div><div class="FixedLine">      out.println(person);</div><div class="FixedLine">   }</div><div class="FixedLine">}<span id="ITerm19">
                        
                        
                      </span></div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 9-2</span><p class="SimplePara">Parsing a JSON Object into a <span id="ITerm20">Java Object</span></p></div></div></div></div><p class="Para" id="Par43">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC9">9-2</a></span> declares a <span class="EmphasisFontCategoryNonProportional ">GsonDemo</span> class with a nested <span class="EmphasisFontCategoryNonProportional ">Person</span> class that describes a person in terms of a name and an age.</p><p class="Para" id="Par44"><span class="EmphasisFontCategoryNonProportional ">GsonDemo</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">main()</span> method first instantiates <span class="EmphasisFontCategoryNonProportional ">Gson</span>, keeping its default configuration. It then constructs a <span class="EmphasisFontCategoryNonProportional ">String</span>-based JSON object representing a person and passes this object along with <span class="EmphasisFontCategoryNonProportional ">Person.class</span> to <span class="EmphasisFontCategoryNonProportional ">fromJson(String json, Class&lt;T&gt; classOfT)</span>. <span class="EmphasisFontCategoryNonProportional ">fromJson()</span> parses the name and age stored in the string passed to <span class="EmphasisFontCategoryNonProportional ">json</span> and uses <span class="EmphasisFontCategoryNonProportional ">Person.class</span> along with the Reflection API to create a <span class="EmphasisFontCategoryNonProportional ">Person</span> object and populate it with the name and age. A reference to the <span class="EmphasisFontCategoryNonProportional ">Person</span> object is returned and stored in the <span class="EmphasisFontCategoryNonProportional ">person</span> variable, and subsequently passed to <span class="EmphasisFontCategoryNonProportional ">System.out.println()</span>. This method ultimately invokes <span class="EmphasisFontCategoryNonProportional ">Person</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">toString()</span> method to return a string representation of the <span class="EmphasisFontCategoryNonProportional ">Person</span> object, and then writes this string to the standard output <span id="ITerm21">stream</span>.</p><div class="Para" id="Par45">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC9">9-2</a></span> and run the resulting application. You should observe the following output:<div class="ProgramCode" id="PC10"><div class="LineGroup"><div class="FixedLine">John Doe: 45</div></div></div></div><p class="Para" id="Par46">Another method that you can use to parse a JSON object into an instance of the <span class="EmphasisFontCategoryNonProportional ">Person</span> class is <span class="EmphasisFontCategoryNonProportional ">&lt;T&gt; T fromJson(JsonElement json, java.lang.Class&lt;T&gt; classOfT)</span>. This method differs from the previous <span class="EmphasisFontCategoryNonProportional ">fromJson()</span> method<span id="ITerm22">
                  
                </span> in that the <span class="EmphasisFontCategoryNonProportional ">json</span> text is specified as a tree of <span class="EmphasisFontCategoryNonProportional ">com.google.gson.JsonElement</span>s (numbers, arrays, etc.)<span id="ITerm23">
                  
                  
                </span>.</p><div class="FormalPara FormalParaRenderingStyle3 ParaTypeOverview" id="FPar2"><h3 class="Heading">About JsonElement</h3><p class="Para" id="Par47">The <span class="EmphasisFontCategoryNonProportional ">JsonElement</span> class represents a JSON element (such as a number, a Boolean value, or an array). It provides various methods for obtaining an element value, such as <span class="EmphasisFontCategoryNonProportional ">double getAsDouble()</span>, <span class="EmphasisFontCategoryNonProportional ">boolean getAsBoolean()</span>, and <span class="EmphasisFontCategoryNonProportional ">JsonArray getAsJsonArray()</span>.</p><div class="Para" id="Par48"><span id="ITerm24">
                    <span class="EmphasisFontCategoryNonProportional ">JsonElement</span>
                    
                  </span> is an abstract class that serves as the superclass for the following JSON element classes (in the <span class="EmphasisFontCategoryNonProportional ">com.google.gson</span> package):<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par49"><span id="ITerm25">
                          <span class="EmphasisFontCategoryNonProportional ">JsonArray</span>
                          
                        </span>: A concrete class that represents JSON鈥檚 array type. An array is a list of <span class="EmphasisFontCategoryNonProportional ">JsonElement</span>s, each of which can be of a different type. This is an ordered list, meaning that the order in which elements are added is preserved.</p></li><li><p class="Para" id="Par50"><span id="ITerm26">
                          <span class="EmphasisFontCategoryNonProportional ">JsonNull</span>
                          
                        </span>: A concrete class that represents a JSON <span class="EmphasisFontCategoryNonProportional ">null</span> value.</p></li><li><p class="Para" id="Par51"><span id="ITerm27">
                          <span class="EmphasisFontCategoryNonProportional ">JsonObject</span>
                          
                        </span>: A concrete class that represents JSON鈥檚 object type. An object consists of name/value pairs, where names are strings and values are any other type of <span class="EmphasisFontCategoryNonProportional ">JsonElement</span>, which leads to a tree of <span class="EmphasisFontCategoryNonProportional ">JsonElement</span>s. The member elements of this object are maintained in the order they were added.</p></li><li><p class="Para" id="Par52"><span id="ITerm28">
                          <span class="EmphasisFontCategoryNonProportional ">JsonPrimitive</span>
                          
                        </span>: A concrete class that represents one of JSON鈥檚 number, string, or Boolean types (expressed via their Java types).</p></li></ul></div></div><p class="Para" id="Par53">Except for <span class="EmphasisFontCategoryNonProportional ">JsonNull</span>, each of these subclasses provides various methods for obtaining element values.</p></div><div class="Para" id="Par54">Of course, you need a <span class="EmphasisFontCategoryNonProportional ">JsonElement</span> tree before you can call this method. One way to accomplish this task is to invoke <span class="EmphasisFontCategoryNonProportional ">Gson</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">JsonElement toJsonTree(Object o)</span> method, which serializes Java object <span class="EmphasisFontCategoryNonProportional ">o</span> to the equivalent <span class="EmphasisFontCategoryNonProportional ">JsonElement</span> tree. Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC11">9-3</a></span> provides an example.<div class="ProgramCode" id="PC11"><div class="LineGroup"><div class="FixedLine">import com.google.gson.Gson;</div><div class="FixedLine">import com.google.gson.GsonBuilder;</div><div class="FixedLine">import com.google.gson.JsonElement;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">class Address</div><div class="FixedLine">{</div><div class="FixedLine">   private String street;</div><div class="FixedLine">   private String city;</div><div class="FixedLine">   private String state;</div><div class="FixedLine">   private int zipcode;</div></div><div class="LineGroup"><div class="FixedLine">   Address(String street, String city, String state,</div><div class="FixedLine">           int zipcode)</div><div class="FixedLine">   {</div><div class="FixedLine">      this.street = street;</div><div class="FixedLine">      this.city = city;</div><div class="FixedLine">      this.state = state;</div><div class="FixedLine">      this.zipcode = zipcode;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public String toString()</div><div class="FixedLine">   {</div><div class="FixedLine">      return street + &quot; &quot; + city + &quot; &quot; + state + &quot; &quot; +</div><div class="FixedLine">             zipcode;</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">public class GsonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args) <span id="ITerm29">
                        
                        
                      </span></div><div class="FixedLine">   {</div><div class="FixedLine">      Gson gson = new Gson();</div><div class="FixedLine">      Address address = new Address(null, &quot;Beverly Hills&quot;,</div><div class="FixedLine">                                    &quot;CA&quot;, 90210);</div><div class="FixedLine">      JsonElement tree = gson.toJsonTree(address);</div><div class="FixedLine">      out.println(tree);</div><div class="FixedLine">      out.println(gson.fromJson(tree, Address.class));</div><div class="FixedLine">      gson = new GsonBuilder().serializeNulls().create();</div><div class="FixedLine">      tree = gson.toJsonTree(address);</div><div class="FixedLine">      out.println(tree);</div><div class="FixedLine">      out.println(gson.fromJson(tree, Address.class));</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 9-3</span><p class="SimplePara">Parsing a JSON Object into a <span id="ITerm30">Java Object Redux</span></p></div></div></div></div><p class="Para" id="Par55">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC11">9-3</a></span> declares <span class="EmphasisFontCategoryNonProportional ">Address</span> and <span class="EmphasisFontCategoryNonProportional ">GsonDemo</span> classes. <span class="EmphasisFontCategoryNonProportional ">Address</span> describes a US address in terms of <span class="EmphasisFontCategoryNonProportional ">street</span>, <span class="EmphasisFontCategoryNonProportional ">city</span>, <span class="EmphasisFontCategoryNonProportional ">state</span>, and <span class="EmphasisFontCategoryNonProportional ">zipcode</span> fields. <span class="EmphasisFontCategoryNonProportional ">GsonDemo</span> is the main <span id="ITerm31">class</span>.</p><p class="Para" id="Par56"><span class="EmphasisFontCategoryNonProportional ">GsonDemo</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">main()</span> method first creates a <span class="EmphasisFontCategoryNonProportional ">Gson</span> object and then creates an <span class="EmphasisFontCategoryNonProportional ">Address</span> object with a <span class="EmphasisFontCategoryNonProportional ">null street</span> field. It subsequently invokes <span class="EmphasisFontCategoryNonProportional ">Gson</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">toJsonTree()</span> method<span id="ITerm32">
                  
                </span> to serialize the <span class="EmphasisFontCategoryNonProportional ">Address</span> object into an equivalent tree of <span class="EmphasisFontCategoryNonProportional ">JsonElement</span>s, which is subsequently output.</p><p class="Para" id="Par57"><span class="EmphasisFontCategoryNonProportional ">main()</span> now invokes <span class="EmphasisFontCategoryNonProportional ">fromJson(JsonElement json, Class&lt;T&gt; classofT)</span> to deserialize the <span class="EmphasisFontCategoryNonProportional ">JsonElement</span> tree into an <span class="EmphasisFontCategoryNonProportional ">Address</span> object, which is subsequently output (with assistance from <span class="EmphasisFontCategoryNonProportional ">Address</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">toString()</span> method).</p><p class="Para" id="Par58">By default, a <span class="EmphasisFontCategoryNonProportional ">null</span> field (such as <span class="EmphasisFontCategoryNonProportional ">street</span>) isn鈥檛 serialized. To serialize a <span class="EmphasisFontCategoryNonProportional ">null</span> field, it鈥檚 necessary to work with <span class="EmphasisFontCategoryNonProportional ">GsonBuilder</span> and invoke its <span class="EmphasisFontCategoryNonProportional ">GsonBuilder serializeNulls()</span> method, which is what <span class="EmphasisFontCategoryNonProportional ">main()</span> does next. <span class="EmphasisFontCategoryNonProportional ">main()</span> then repeats its <span class="EmphasisFontCategoryNonProportional ">fromJson()</span> and <span class="EmphasisFontCategoryNonProportional ">toJson()</span> calls, outputting the results.</p><div class="Para" id="Par59">Compile the source code and run the application, and you should observe the following output:<div class="ProgramCode" id="PC12"><div class="LineGroup"><div class="FixedLine">{&quot;city&quot;:&quot;Beverly Hills&quot;,&quot;state&quot;:&quot;CA&quot;,&quot;zipcode&quot;:90210}</div><div class="FixedLine">null Beverly Hills CA 90210</div><div class="FixedLine">{&quot;street&quot;:null,&quot;city&quot;:&quot;Beverly Hills&quot;,&quot;state&quot;:&quot;CA&quot;,&quot;zipcode&quot;:90210}</div><div class="FixedLine">null Beverly Hills CA 90210</div></div></div></div><section class="Section3 RenderAsSection3" id="Sec6"><h4 class="Heading">Customized JSON Object Parsing</h4><p class="Para" id="Par60">The <span class="EmphasisFontCategoryNonProportional ">gson.fromJson(json, Person.class)</span> and <span class="EmphasisFontCategoryNonProportional ">gson.fromJson(json, Address.class)</span> method calls rely on <span class="EmphasisFontCategoryNonProportional ">Gson</span>鈥檚 default deserialization mechanism to parse JSON objects. You will often encounter scenarios where you need to parse complex JSON objects into Java objects whose classes don鈥檛 have the same structure as the JSON objects to be parsed. You can perform this parsing with a custom deserializer, which controls how JSON objects map to <span id="ITerm33">Java objects</span>.</p><p class="Para" id="Par61">The <span class="EmphasisFontCategoryNonProportional ">com.google.gson.JsonDeserializer&lt;T&gt;</span> interface describes a custom deserializer. The argument passed to <span class="EmphasisFontCategoryNonProportional ">T</span> identifies the type for which the deserializer is being used. For example, you might pass <span class="EmphasisFontCategoryNonProportional ">Person</span> to <span class="EmphasisFontCategoryNonProportional ">T</span> when needing to parse JSON objects with a somewhat different structure.</p><div class="Para" id="Par62"><span class="EmphasisFontCategoryNonProportional ">JsonDeserializer</span> declares a single method for handling the deserialization (JSON object parsing):<div class="ProgramCode" id="PC13"><div class="LineGroup"><div class="FixedLine">T deserialize(JsonElement json,Type typeOfT,</div><div class="FixedLine">              JsonDeserializationContext context)</div></div></div></div><div class="Para" id="Par63"><span class="EmphasisFontCategoryNonProportional ">deserialize()</span> is a callback method that <span class="EmphasisFontCategoryNonProportional ">Gson</span> calls during deserialization. This method is called with the following <span id="ITerm34">arguments</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par64"><span class="EmphasisFontCategoryNonProportional ">json</span> identifies the JSON element being deserialized.</p></li><li><p class="Para" id="Par65"><span class="EmphasisFontCategoryNonProportional ">typeOfT</span> identifies the type of the Java object in which to deserialize <span class="EmphasisFontCategoryNonProportional ">json</span>.</p></li><li><p class="Para" id="Par66"><span class="EmphasisFontCategoryNonProportional ">context</span> identifies a context in which to perform the deserialization. (I鈥檒l have more to say about contexts later.)</p></li></ul></div></div><p class="Para" id="Par67"><span class="EmphasisFontCategoryNonProportional ">deserialize()</span> throws <span class="EmphasisFontCategoryNonProportional ">com.google.gson.JsonParseException</span> when the JSON element passed to <span class="EmphasisFontCategoryNonProportional ">json</span> isn鈥檛 compatible with the type passed to <span class="EmphasisFontCategoryNonProportional ">typeOfT</span>. Because <span class="EmphasisFontCategoryNonProportional ">JsonParseException</span> extends <span class="ExternalRef"><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/RuntimeException.html?is-external=true"><span class="RefSource">
                      <span class="EmphasisFontCategoryNonProportional ">java.lang.RuntimeException</span>
                    </span></a></span>, you don鈥檛 have to append a <span class="EmphasisFontCategoryNonProportional ">throws</span> clause.</p><div class="Para" id="Par68">After creating a <span class="EmphasisFontCategoryNonProportional ">JsonDeserializer</span> object, you need to register it with <span class="EmphasisFontCategoryNonProportional ">Gson</span>. Accomplish this task by calling the following <span class="EmphasisFontCategoryNonProportional ">GsonBuilder</span> method:<div class="ProgramCode" id="PC14"><div class="LineGroup"><div class="FixedLine">GsonBuilder registerTypeAdapter(Type type, Object typeAdapter)</div></div></div></div><p class="Para" id="Par69">The object passed to <span class="EmphasisFontCategoryNonProportional ">type</span> identifies the type of the deserializer and the object passed to <span class="EmphasisFontCategoryNonProportional ">typeAdapter</span> identifies the deserializer. Because <span class="EmphasisFontCategoryNonProportional ">registerTypeAdapter(Type, Object)</span> returns a <span class="EmphasisFontCategoryNonProportional ">GsonBuilder</span> object, you can only use this method in a <span class="EmphasisFontCategoryNonProportional ">GsonBuilder</span> context.</p><div class="Para" id="Par70">To demonstrate customized JSON object parsing, consider an expanded version of the previous JSON object: <span id="ITerm35">
                    
                    
                    
                  </span><div class="ProgramCode" id="PC15"><div class="LineGroup"><div class="FixedLine">{ &quot;first-name&quot;: &quot;John&quot;, &quot;last-name&quot;: &quot;Doe&quot;, &quot;age&quot;: 45, &quot;address&quot;: &quot;Box 1 &quot; }</div></div></div></div><div class="Para" id="Par71">This JSON object differs significantly from the previous JSON object, which consisted of <span class="EmphasisFontCategoryNonProportional ">name</span> and <span class="EmphasisFontCategoryNonProportional ">age</span> fields:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par72">The <span class="EmphasisFontCategoryNonProportional ">name</span> field has been refactored into <span class="EmphasisFontCategoryNonProportional ">first-name</span> and <span class="EmphasisFontCategoryNonProportional ">last-name</span> fields. Note that the hyphen (<span class="EmphasisFontCategoryNonProportional ">-</span>) isn鈥檛 a legal character for a Java identifier.</p></li><li><p class="Para" id="Par73">An <span class="EmphasisFontCategoryNonProportional ">address</span> field has been added.</p></li></ul></div></div><div class="Para" id="Par74">If you modify Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC9">9-2</a></span> by replacing the object assigned to <span class="EmphasisFontCategoryNonProportional ">json</span> with this new object, you shouldn鈥檛 be surprised by the following output:<div class="ProgramCode" id="PC16"><div class="LineGroup"><div class="FixedLine">null: 45</div></div></div></div><div class="Para" id="Par75">The parsing is completely messed up. However, we can fix this problem by introducing the following custom deserializer:<div class="ProgramCode" id="PC17"><div class="LineGroup"><div class="FixedLine">class PersonDeserializer</div><div class="FixedLine">   implements JsonDeserializer&lt;Person&gt;</div><div class="FixedLine">{</div><div class="FixedLine">   @Override</div><div class="FixedLine">   public Person</div><div class="FixedLine">      deserialize(JsonElement json, Type typeOfT,</div><div class="FixedLine">                  JsonDeserializationContext context)</div><div class="FixedLine">   {</div><div class="FixedLine">      JsonObject jsonObject = json.getAsJsonObject();</div><div class="FixedLine">      String firstName = jsonObject.get(&quot;first-name&quot;).</div><div class="FixedLine">                                    getAsString();</div><div class="FixedLine">      String lastName = jsonObject.get(&quot;last-name&quot;).</div><div class="FixedLine">                                   getAsString();</div><div class="FixedLine">      int age = jsonObject.getAsJsonPrimitive(&quot;age&quot;).</div><div class="FixedLine">                           getAsInt();</div><div class="FixedLine">      String address = jsonObject.get(&quot;address&quot;).</div><div class="FixedLine">                                  getAsString();</div><div class="FixedLine">      return new Person(firstName + &quot; &quot; + lastName,</div><div class="FixedLine">                        45); <span id="ITerm36">
                          
                          
                          
                        </span></div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div></div></div><p class="Para" id="Par76">When the <span id="ITerm37">custom deserializer</span> is used with the previous JSON object, <span class="EmphasisFontCategoryNonProportional ">deserialize()</span> is called only once, and with an object of type <span class="EmphasisFontCategoryNonProportional ">JsonObject</span> being passed to <span class="EmphasisFontCategoryNonProportional ">json</span>. You could cast this value to a <span class="EmphasisFontCategoryNonProportional ">JsonObject</span>, as in <span class="EmphasisFontCategoryNonProportional ">JsonObject jsonObject = (JsonObject) json;</span>. Alternatively, you can call <span class="EmphasisFontCategoryNonProportional ">JsonElement</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">JsonObject getAsJsonObject()</span> method to obtain the <span class="EmphasisFontCategoryNonProportional ">JsonObject</span> reference, which is what <span class="EmphasisFontCategoryNonProportional ">deserialize()</span> first accomplishes.</p><p class="Para" id="Par77">After obtaining the <span class="EmphasisFontCategoryNonProportional ">JsonObject</span> reference, <span class="EmphasisFontCategoryNonProportional ">deserialize()</span> calls its <span class="EmphasisFontCategoryNonProportional ">JsonElement get(</span><span class="ExternalRef"><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true"><span class="RefSource">
                      <span class="EmphasisFontCategoryNonProportional ">String</span>
                    </span></a></span>
<span class="EmphasisFontCategoryNonProportional ">memberName)</span> method to return a <span class="EmphasisFontCategoryNonProportional ">JsonElement</span> for the desired <span class="EmphasisFontCategoryNonProportional ">memberName</span> value. The first call passes <span class="EmphasisFontCategoryNonProportional ">first-name</span> to <span class="EmphasisFontCategoryNonProportional ">get()</span>; we want to obtain the value of this JSON field. Because a <span class="EmphasisFontCategoryNonProportional ">JsonPrimitive</span> is returned in place of <span class="EmphasisFontCategoryNonProportional ">JsonElement</span>, a call to <span class="EmphasisFontCategoryNonProportional ">JsonPrimitive</span>鈥檚 <span class="ExternalRef"><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true"><span class="RefSource">
                      <span class="EmphasisFontCategoryNonProportional ">String</span>
                    </span></a></span>
<span class="EmphasisFontCategoryNonProportional ">getAsString()</span> method is chained to the <span class="EmphasisFontCategoryNonProportional ">JsonPrimitive</span> reference, and <span class="EmphasisFontCategoryNonProportional ">first-name</span>鈥檚 value is obtained. This pattern is followed to obtain the values for the <span class="EmphasisFontCategoryNonProportional ">last-name</span> and <span class="EmphasisFontCategoryNonProportional ">address</span> fields.</p><p class="Para" id="Par78">For variety, I decided to do something different with the <span class="EmphasisFontCategoryNonProportional ">age</span> field. I call <span class="EmphasisFontCategoryNonProportional ">JsonObject&apos;</span>s <span class="EmphasisFontCategoryNonProportional ">JsonPrimitive getAsJsonPrimitive(</span><span class="ExternalRef"><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true"><span class="RefSource">
                      <span class="EmphasisFontCategoryNonProportional ">String</span>
                    </span></a></span>
<span class="EmphasisFontCategoryNonProportional ">memberName)</span> method to return a <span class="EmphasisFontCategoryNonProportional ">JsonPrimitive</span> reference corresponding to <span class="EmphasisFontCategoryNonProportional ">age</span>. Then, I call <span class="EmphasisFontCategoryNonProportional ">JsonPrimitive</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">int getAsInt()</span> method to return the integer value.</p><p class="Para" id="Par79">After obtaining all field values, a <span class="EmphasisFontCategoryNonProportional ">Person</span> object is created and then returned. Because I鈥檓 reusing the <span class="EmphasisFontCategoryNonProportional ">Person</span> class shown in Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC9">9-2</a></span>, and because there is no <span class="EmphasisFontCategoryNonProportional ">address</span> field in this class, I throw <span class="EmphasisFontCategoryNonProportional ">address</span>鈥檚 value away. You might want to modify <span class="EmphasisFontCategoryNonProportional ">Person</span> to include this field.</p><div class="Para" id="Par80">The following code fragment shows how you would instantiate <span id="ITerm38">
                    <span class="EmphasisFontCategoryNonProportional ">PersonDeserializer</span>
                    
                  </span> and register it with a <span class="EmphasisFontCategoryNonProportional ">GsonBuilder</span> instance, which is also used to obtain a <span class="EmphasisFontCategoryNonProportional ">Gson</span> instance in order to call <span class="EmphasisFontCategoryNonProportional ">fromJson()</span>, to parse the previous JSON object via the person deserializer:<div class="ProgramCode" id="PC18"><div class="LineGroup"><div class="FixedLine">GsonBuilder gsonBuilder = new GsonBuilder();</div><div class="FixedLine">gsonBuilder.</div><div class="FixedLine">   registerTypeAdapter(Person.class,</div><div class="FixedLine">                       new PersonDeserializer());</div><div class="FixedLine">Gson gson = gsonBuilder.create();</div></div></div></div><div class="Para" id="Par81">I鈥檝e combined these code fragments into a working application. Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC19">9-4</a></span> presents the application鈥檚 source code.<div class="ProgramCode" id="PC19"><div class="LineGroup"><div class="FixedLine">import java.lang.reflect.Type;</div></div><div class="LineGroup"><div class="FixedLine">import com.google.gson.Gson;</div><div class="FixedLine">import com.google.gson.GsonBuilder;</div><div class="FixedLine">import com.google.gson.JsonDeserializationContext;</div><div class="FixedLine">import com.google.gson.JsonDeserializer;</div><div class="FixedLine">import com.google.gson.JsonElement;</div><div class="FixedLine">import com.google.gson.JsonObject;</div><div class="FixedLine">import com.google.gson.JsonParseException;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class GsonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   static class Person</div><div class="FixedLine">   {</div><div class="FixedLine">      String name;</div><div class="FixedLine">      int age;</div></div><div class="LineGroup"><div class="FixedLine">      Person(String name, int age)</div><div class="FixedLine">      {</div><div class="FixedLine">         this.name = name;</div><div class="FixedLine">         this.age = age;</div><div class="FixedLine">      }</div></div><div class="LineGroup"><div class="FixedLine">      @Override</div><div class="FixedLine">      public String toString()</div><div class="FixedLine">      {</div><div class="FixedLine">         return name + &quot;: &quot; + age;</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      class PersonDeserializer</div><div class="FixedLine">         implements JsonDeserializer&lt;Person&gt;</div><div class="FixedLine">      {</div><div class="FixedLine">         @Override</div><div class="FixedLine">         public Person</div><div class="FixedLine">            deserialize(JsonElement json, Type typeOfT,</div><div class="FixedLine">                        JsonDeserializationContext context)</div><div class="FixedLine">         {</div><div class="FixedLine">            JsonObject jsonObject = json.getAsJsonObject();</div><div class="FixedLine">            String firstName = jsonObject.get(&quot;first-name&quot;).</div><div class="FixedLine">                                          getAsString();</div><div class="FixedLine">            String lastName = jsonObject.get(&quot;last-name&quot;).</div><div class="FixedLine">                                         getAsString();</div><div class="FixedLine">            int age = jsonObject.getAsJsonPrimitive(&quot;age&quot;).</div><div class="FixedLine">                                 getAsInt();</div><div class="FixedLine">            String address = jsonObject.get(&quot;address&quot;).</div><div class="FixedLine">                                        getAsString();</div><div class="FixedLine">            return new Person(firstName + &quot; &quot; + lastName,</div><div class="FixedLine">                              45);</div><div class="FixedLine">         }</div><div class="FixedLine">      }</div><div class="FixedLine">      GsonBuilder gsonBuilder = new GsonBuilder();</div><div class="FixedLine">      gsonBuilder.</div><div class="FixedLine">         registerTypeAdapter(Person.class,</div><div class="FixedLine">                             new PersonDeserializer());</div><div class="FixedLine">      Gson gson = gsonBuilder.create();</div><div class="FixedLine">      String json = &quot;{ first-name: \&quot;John\&quot;, &quot; +</div><div class="FixedLine">                    &quot;last-name: \&quot;Doe\&quot;, age: 45, &quot; +</div><div class="FixedLine">                    &quot;address: \&quot;Box 1\&quot; }&quot;;</div><div class="FixedLine">      Person person = gson.fromJson(json, Person.class);</div><div class="FixedLine">      out.println(person); <span id="ITerm39">
                          
                          
                          
                        </span></div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 9-4</span><p class="SimplePara">Parsing a JSON Object into a Java Object via a Custom <span id="ITerm40">Deserializer</span></p></div></div></div></div><div class="Para" id="Par82">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC19">9-4</a></span> and run the resulting application. You should observe the following output:<div class="ProgramCode" id="PC20"><div class="LineGroup"><div class="FixedLine">John Doe: 45</div></div></div></div></section></section><section class="Section2 RenderAsSection2" id="Sec7"><h3 class="Heading">Creating JSON Objects Through Serialization</h3><div class="Para" id="Par83"><span class="EmphasisFontCategoryNonProportional ">Gson</span> lets you create JSON <span id="ITerm41">objects</span> from Java objects by calling one of <span class="EmphasisFontCategoryNonProportional ">Gson</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">toJson()</span> methods. Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC21">9-5</a></span> provides a simple demonstration.<div class="ProgramCode" id="PC21"><div class="LineGroup"><div class="FixedLine">import com.google.gson.Gson;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class GsonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   static class Person</div><div class="FixedLine">   {</div><div class="FixedLine">      String name;</div><div class="FixedLine">      int age;</div></div><div class="LineGroup"><div class="FixedLine">      Person(String name, int age)</div><div class="FixedLine">      {</div><div class="FixedLine">         this.name = name;</div><div class="FixedLine">         this.age = age;</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      Person p = new Person(&quot;Jane Doe&quot;, 59);</div><div class="FixedLine">      Gson gson = new Gson();</div><div class="FixedLine">      String json = gson.toJson(p);</div><div class="FixedLine">      out.println(json);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 9-5</span><p class="SimplePara">Creating a JSON Object from a <span id="ITerm42">Java Object</span></p></div></div></div></div><p class="Para" id="Par84">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC21">9-5</a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">main()</span> method first creates a <span class="EmphasisFontCategoryNonProportional ">Person</span> object from the nested <span class="EmphasisFontCategoryNonProportional ">Person</span> class. It then creates a <span class="EmphasisFontCategoryNonProportional ">Gson</span> object<span id="ITerm43">
                  
                  
                </span> and invokes this object鈥檚 <span class="ExternalRef"><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">String</span>
                  </span></a></span>
<span class="EmphasisFontCategoryNonProportional ">toJson(</span><span class="ExternalRef"><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">Object</span>
                  </span></a></span>
<span class="EmphasisFontCategoryNonProportional ">src)</span> method to serialize the <span class="EmphasisFontCategoryNonProportional ">Person</span> object into its equivalent JSON string representation, which <span class="EmphasisFontCategoryNonProportional ">toJson(Object)</span> returns.</p><div class="Para" id="Par85">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC21">9-5</a></span> and run the resulting application. You should observe the following output:<div class="ProgramCode" id="PC22"><div class="LineGroup"><div class="FixedLine">{&quot;name&quot;:&quot;Jane Doe&quot;,&quot;age&quot;:59}</div></div></div></div><div class="Para" id="Par86">If you prefer to write the JSON object to a file, a string buffer, or some other <span class="EmphasisFontCategoryNonProportional ">java.lang.Appendable</span>, you can call <span class="EmphasisFontCategoryNonProportional ">void toJson(Object src, Appendable writer)</span> to accomplish this task. This <span class="EmphasisFontCategoryNonProportional ">toJson()</span> variant sends its output to the specified <span class="EmphasisFontCategoryNonProportional ">writer</span>, as demonstrated in Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC23">9-6</a></span>.<div class="ProgramCode" id="PC23"><div class="LineGroup"><div class="FixedLine">import java.io.FileWriter;</div><div class="FixedLine">import java.io.IOException;</div></div><div class="LineGroup"><div class="FixedLine">import com.google.gson.Gson;</div></div><div class="LineGroup"><div class="FixedLine">public class GsonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   static class Student</div><div class="FixedLine">   {</div><div class="FixedLine">      String name;</div><div class="FixedLine">      int id;</div><div class="FixedLine">      int[] grades;</div></div><div class="LineGroup"><div class="FixedLine">      Student(String name, int id, int... grades)</div><div class="FixedLine">      {</div><div class="FixedLine">         this.name = name;</div><div class="FixedLine">         this.id = id;</div><div class="FixedLine">         this.grades = grades;</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public static void main(String[] args) throws IOException</div><div class="FixedLine">   {</div><div class="FixedLine">      Student s = new Student(&quot;John Doe&quot;, 820787, 89, 78,</div><div class="FixedLine">                              97, 65);</div><div class="FixedLine">      Gson gson = new Gson();</div><div class="FixedLine">      FileWriter fw = new FileWriter(&quot;student.json&quot;);</div><div class="FixedLine">      gson.toJson(s, fw);</div><div class="FixedLine">      fw.close();<span id="ITerm44">
                        
                        
                      </span></div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 9-6</span><p class="SimplePara">Creating a JSON Object from a Java Object and Writing the JSON Object to a <span id="ITerm45">File</span></p></div></div></div></div><p class="Para" id="Par87">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC23">9-6</a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">main()</span> method first creates a <span class="EmphasisFontCategoryNonProportional ">Student</span> object from the nested <span class="EmphasisFontCategoryNonProportional ">Student</span> class. It then creates <span class="EmphasisFontCategoryNonProportional ">Gson</span> and <span class="EmphasisFontCategoryNonProportional ">java.io.FileWriter</span> objects and invokes the <span class="EmphasisFontCategoryNonProportional ">Gson</span> object鈥檚 <span class="EmphasisFontCategoryNonProportional ">toJson(</span><span class="ExternalRef"><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">Object</span>
                  </span></a></span><span class="EmphasisFontCategoryNonProportional ">, Appendable)</span> method to serialize the <span class="EmphasisFontCategoryNonProportional ">Student</span> object into its equivalent JSON string representation and write the result to <span class="EmphasisFontCategoryNonProportional ">student.json</span>. The file writer is then closed so that buffered content can be written to the file (you could specify <span class="EmphasisFontCategoryNonProportional ">fw.flush();</span> instead).</p><div class="Para" id="Par88">If you run this application, you won鈥檛 observe any output. However, you should observe a <span class="EmphasisFontCategoryNonProportional ">student.json</span> file with the following <span id="ITerm46">content</span>:<div class="ProgramCode" id="PC24"><div class="LineGroup"><div class="FixedLine">{&quot;name&quot;:&quot;John Doe&quot;,&quot;id&quot;:820787,&quot;grades&quot;:[89,78,97,65]}</div></div></div></div><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar3"><h3 class="Heading">Note</h3><p class="Para" id="Par89"><span class="EmphasisFontCategoryNonProportional ">void toJson(Object src, Appendable writer)</span> throws the unchecked <span class="EmphasisFontCategoryNonProportional ">com.google.gson.JsonIOException</span> when an I/O error arises.</p></div><section class="Section3 RenderAsSection3" id="Sec8"><h4 class="Heading">Customized JSON Object Creation</h4><p class="Para" id="Par90">The previous <span class="EmphasisFontCategoryNonProportional ">gson.toJson(p)</span> and <span class="EmphasisFontCategoryNonProportional ">gson.toJson(s, fw)</span> method calls rely on <span class="EmphasisFontCategoryNonProportional ">Gson</span>鈥檚 default serialization mechanism to create JSON objects. You will often encounter scenarios where you need to create JSON objects from Java objects whose classes don鈥檛 have the same structure as the JSON objects to be created. You can perform this creation with a custom serializer, which controls how Java objects map to JSON objects.</p><p class="Para" id="Par91">The <span class="EmphasisFontCategoryNonProportional ">com.google.gson.JsonSerializer&lt;T&gt;</span> interface describes a custom serializer. The argument passed to <span class="EmphasisFontCategoryNonProportional ">T</span> identifies the type for which the serializer is being used. For example, you might pass <span class="EmphasisFontCategoryNonProportional ">Person</span> to <span class="EmphasisFontCategoryNonProportional ">T</span> when needing to create JSON objects with a somewhat different structure.</p><div class="Para" id="Par92"><span class="EmphasisFontCategoryNonProportional ">JsonSerializer</span> declares a single method for handling the serialization (JSON object creation):<div class="ProgramCode" id="PC25"><div class="LineGroup"><div class="FixedLine">JsonElement serialize(T src, Type typeOfSrc,</div><div class="FixedLine">                      JsonSerializationContext context)</div></div></div></div><div class="Para" id="Par93"><span class="EmphasisFontCategoryNonProportional ">serialize()</span> is a callback method that <span class="EmphasisFontCategoryNonProportional ">Gson</span> calls during serialization. This method is called with the following <span id="ITerm47">arguments</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par94"><span class="EmphasisFontCategoryNonProportional ">src</span> identifies the Java object that needs to be serialized.</p></li><li><p class="Para" id="Par95"><span class="EmphasisFontCategoryNonProportional ">typeOfSrc</span> identifies the actual type of the Java object, specified by <span class="EmphasisFontCategoryNonProportional ">src</span>, to be serialized.</p></li><li><p class="Para" id="Par96"><span class="EmphasisFontCategoryNonProportional ">context</span> identifies a context in which to perform the serialization. (I鈥檒l have more to say about contexts later.)</p></li></ul></div></div><div class="Para" id="Par97">After creating a <span class="EmphasisFontCategoryNonProportional ">JsonSerializer</span> object, you need to register it with <span class="EmphasisFontCategoryNonProportional ">Gson</span>. Accomplish this task by calling the following <span class="EmphasisFontCategoryNonProportional ">GsonBuilder</span> method:<div class="ProgramCode" id="PC26"><div class="LineGroup"><div class="FixedLine">GsonBuilder registerTypeAdapter(Type type, Object typeAdapter)</div></div></div></div><p class="Para" id="Par98">The object passed to <span class="EmphasisFontCategoryNonProportional ">type</span> identifies the type of the serializer and the object passed to <span class="EmphasisFontCategoryNonProportional ">typeAdapter</span> identifies the serializer. Because <span class="EmphasisFontCategoryNonProportional ">registerTypeAdapter(Type, Object)</span> returns a <span class="EmphasisFontCategoryNonProportional ">GsonBuilder</span> object, you can only use this method in a <span class="EmphasisFontCategoryNonProportional ">GsonBuilder</span> context.</p><div class="Para" id="Par99">To demonstrate customized JSON object creation, consider the <span class="EmphasisFontCategoryNonProportional ">Book</span> class that鈥檚 presented in Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC27">9-7</a></span><span id="ITerm48">
                    
                    
                    
                  </span>.<div class="ProgramCode" id="PC27"><div class="LineGroup"><div class="FixedLine">public class Book</div><div class="FixedLine">{</div><div class="FixedLine">   private String title;</div><div class="FixedLine">   private String[] authors;</div><div class="FixedLine">   private String isbn10;</div><div class="FixedLine">   private String isbn13;</div></div><div class="LineGroup"><div class="FixedLine">   public Book(String title, String[] authors,</div><div class="FixedLine">               String isbn10, String isbn13)</div><div class="FixedLine">   {</div><div class="FixedLine">      this.title = title;</div><div class="FixedLine">      this.authors = authors;</div><div class="FixedLine">      this.isbn10 = isbn10;</div><div class="FixedLine">      this.isbn13 = isbn13;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public String getTitle()</div><div class="FixedLine">   {</div><div class="FixedLine">      return title;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public String[] getAuthors()</div><div class="FixedLine">   {</div><div class="FixedLine">      return authors;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public String getIsbn10()</div><div class="FixedLine">   {</div><div class="FixedLine">      return isbn10;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public String getIsbn13()</div><div class="FixedLine">   {</div><div class="FixedLine">      return isbn13;</div><div class="FixedLine">   }</div><div class="FixedLine">}<span id="ITerm49">
                          
                          
                          
                        </span></div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 9-7</span><p class="SimplePara">Describing a Book as a Title, List of Authors, and ISBN Numbers</p></div></div></div></div><div class="Para" id="Par100">Continuing, suppose that <span class="EmphasisFontCategoryNonProportional ">Book</span> objects are to be serialized to JSON objects that have the following format:<div class="ProgramCode" id="PC28"><div class="LineGroup"><div class="FixedLine">{</div><div class="FixedLine">   &quot;title&quot;: <em class="EmphasisTypeItalic ">title</em></div><div class="FixedLine">   &quot;lead-author&quot;: <em class="EmphasisTypeItalic ">author0</em></div><div class="FixedLine">   &quot;other-authors&quot;: [ <em class="EmphasisTypeItalic ">author1</em>, <em class="EmphasisTypeItalic ">author2</em>, ... ]</div><div class="FixedLine">   &quot;isbn-10&quot;: <em class="EmphasisTypeItalic ">isbn10</em></div><div class="FixedLine">   &quot;isbn-13&quot;: <em class="EmphasisTypeItalic ">isbn13</em></div><div class="FixedLine">}<span id="ITerm50">
                          
                          
                          
                        </span></div></div></div></div><div class="Para" id="Par101">You cannot use default serialization because the <span class="EmphasisFontCategoryNonProportional ">Book</span> class doesn鈥檛 declare <span class="EmphasisFontCategoryNonProportional ">lead-author</span>, <span class="EmphasisFontCategoryNonProportional ">other-authors</span>, <span class="EmphasisFontCategoryNonProportional ">isbn-10</span>, and <span class="EmphasisFontCategoryNonProportional ">isbn-13</span> fields. In any case, default serialization creates JSON property names that match a Java class鈥檚 field names (and the hyphen character is illegal for Java identifiers). To prove that you cannot obtain the desired JSON object with default serialization, suppose you attempt to execute the following <span id="ITerm51">code fragment</span>:<div class="ProgramCode" id="PC29"><div class="LineGroup"><div class="FixedLine">Book book =</div><div class="FixedLine">   new Book(&quot;PHP and MySQL Web Development, &quot; +</div><div class="FixedLine">            &quot;Second Edition&quot;,</div><div class="FixedLine">            new String[] { &quot;Luke Welling&quot;,</div><div class="FixedLine">                           &quot;Laura Thomson&quot; },</div><div class="FixedLine">            &quot;067232525X&quot;, &quot;075-2063325254&quot;);</div><div class="FixedLine">Gson gson = new Gson();</div><div class="FixedLine">System.out.println(gson.toJson(book));</div></div></div></div><div class="Para" id="Par102">This code fragment generates the following output:<div class="ProgramCode" id="PC30"><div class="LineGroup"><div class="FixedLine">{&quot;title&quot;:&quot;PHP and MySQL Web Development, Second Edition&quot;,&quot;authors&quot;:[&quot;Luke Welling&quot;,&quot;Laura Thomson&quot;],&quot;isbn10&quot;:&quot;067232525X&quot;,&quot;isbn13&quot;:&quot;075-2063325254&quot;}</div></div></div></div><div class="Para" id="Par103">The output doesn鈥檛 match the expected JSON object. However, you can fix this problem by introducing the following custom serializer:<div class="ProgramCode" id="PC31"><div class="LineGroup"><div class="FixedLine">class BookSerializer implements JsonSerializer&lt;Book&gt;</div><div class="FixedLine">{</div><div class="FixedLine">   @Override</div><div class="FixedLine">   public JsonElement</div><div class="FixedLine">      serialize(Book src, Type typeOfSrc, <span id="ITerm52">
                          
                          
                          
                        </span></div><div class="FixedLine">                JsonSerializationContext context)</div><div class="FixedLine">   {</div><div class="FixedLine">      JsonObject jsonObject = new JsonObject();</div><div class="FixedLine">      jsonObject.addProperty(&quot;title&quot;, src.getTitle());</div><div class="FixedLine">      jsonObject.addProperty(&quot;lead-author&quot;,</div><div class="FixedLine">                             src.getAuthors()[0]);</div><div class="FixedLine">      JsonArray jsonOtherAuthors = new JsonArray();</div><div class="FixedLine">      for (int i = 1; i &lt; src.getAuthors().length;</div><div class="FixedLine">           i++)</div><div class="FixedLine">      {</div><div class="FixedLine">         JsonPrimitive jsonAuthor =</div><div class="FixedLine">            new JsonPrimitive(src.getAuthors()[i]);</div><div class="FixedLine">         jsonOtherAuthors.add(jsonAuthor);</div><div class="FixedLine">      }</div><div class="FixedLine">      jsonObject.add(&quot;other-authors&quot;,</div><div class="FixedLine">                     jsonOtherAuthors);</div><div class="FixedLine">      jsonObject.addProperty(&quot;isbn-10&quot;,</div><div class="FixedLine">                             src.getIsbn10());</div><div class="FixedLine">      jsonObject.addProperty(&quot;isbn-13&quot;,</div><div class="FixedLine">                             src.getIsbn13());</div><div class="FixedLine">      return jsonObject;</div><div class="FixedLine">   }</div><div class="FixedLine">}<span id="ITerm53">
                          
                          
                          
                        </span></div></div></div></div><p class="Para" id="Par104">When the custom serializer is used with the previous Java <span class="EmphasisFontCategoryNonProportional ">Book</span> object, <span class="EmphasisFontCategoryNonProportional ">serialize()</span> is called only once with the <span class="EmphasisFontCategoryNonProportional ">Book</span> object being passed to <span class="EmphasisFontCategoryNonProportional ">src</span>. Because a JSON object is desired as the result of this method, <span class="EmphasisFontCategoryNonProportional ">serialize()</span> first creates a <span class="EmphasisFontCategoryNonProportional ">JsonObject</span> instance.</p><p class="Para" id="Par105"><span class="EmphasisFontCategoryNonProportional ">JsonObject</span> declares several <span class="EmphasisFontCategoryNonProportional ">addProperty()</span> methods for adding properties to the JSON object that a <span class="EmphasisFontCategoryNonProportional ">JsonObject</span> instance represents. <span class="EmphasisFontCategoryNonProportional ">serialize()</span> invokes the <span class="EmphasisFontCategoryNonProportional ">void addProperty(</span><span class="ExternalRef"><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true"><span class="RefSource">
                      <span class="EmphasisFontCategoryNonProportional ">String</span>
                    </span></a></span>
<span class="EmphasisFontCategoryNonProportional ">property,</span>
<span class="ExternalRef"><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true"><span class="RefSource">
                      <span class="EmphasisFontCategoryNonProportional ">String</span>
                    </span></a></span>
<span class="EmphasisFontCategoryNonProportional ">value)</span> method to add the <span class="EmphasisFontCategoryNonProportional ">title</span>, <span class="EmphasisFontCategoryNonProportional ">lead-author</span>, <span class="EmphasisFontCategoryNonProportional ">isbn-10</span>, and <span class="EmphasisFontCategoryNonProportional ">isbn-13</span> properties.</p><p class="Para" id="Par106">The <span class="EmphasisFontCategoryNonProportional ">other-authors</span> property is handled differently. First, <span class="EmphasisFontCategoryNonProportional ">serialize()</span> creates a <span class="EmphasisFontCategoryNonProportional ">JsonArray</span> instance and populates it with all authors except for the first author. Then, it invokes <span class="EmphasisFontCategoryNonProportional ">JsonObject</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">void add(</span><span class="ExternalRef"><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true"><span class="RefSource">
                      <span class="EmphasisFontCategoryNonProportional ">String</span>
                    </span></a></span>
<span class="EmphasisFontCategoryNonProportional ">property, JsonElement value)</span> method to add the <span class="EmphasisFontCategoryNonProportional ">JsonArray</span> object to the <span class="EmphasisFontCategoryNonProportional ">JsonObject</span>.</p><p class="Para" id="Par107">When serialization finishes, <span class="EmphasisFontCategoryNonProportional ">serialize()</span> returns the created and populated <span class="EmphasisFontCategoryNonProportional ">JsonObject</span>.</p><div class="Para" id="Par108">The following code fragment shows how you would instantiate <span class="EmphasisFontCategoryNonProportional ">BookSerializer</span> and register it with a <span class="EmphasisFontCategoryNonProportional ">GsonBuilder</span> instance, which is also used to obtain a <span class="EmphasisFontCategoryNonProportional ">Gson</span> instance in order to call <span class="EmphasisFontCategoryNonProportional ">toJson()</span>, to create the desired JSON object via the book <span id="ITerm54">serializer</span>:<div class="ProgramCode" id="PC32"><div class="LineGroup"><div class="FixedLine">GsonBuilder gsonBuilder = new GsonBuilder();</div><div class="FixedLine">gsonBuilder.registerTypeAdapter(Book.class,</div><div class="FixedLine">                                new BookSerializer());</div><div class="FixedLine">Gson gson = gsonBuilder.create();</div></div></div></div><div class="Para" id="Par109">I鈥檝e combined these code fragments into a working application. Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC33">9-8</a></span> presents the application鈥檚 source code.<div class="ProgramCode" id="PC33"><div class="LineGroup"><div class="FixedLine">import java.lang.reflect.Type;</div></div><div class="LineGroup"><div class="FixedLine">import com.google.gson.Gson;</div><div class="FixedLine">import com.google.gson.GsonBuilder;</div><div class="FixedLine">import com.google.gson.JsonArray;</div><div class="FixedLine">import com.google.gson.JsonElement;</div><div class="FixedLine">import com.google.gson.JsonObject;</div><div class="FixedLine">import com.google.gson.JsonPrimitive;</div><div class="FixedLine">import com.google.gson.JsonSerializationContext;</div><div class="FixedLine">import com.google.gson.JsonSerializer;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class GsonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      class BookSerializer implements JsonSerializer&lt;Book&gt;</div><div class="FixedLine">      {</div><div class="FixedLine">         @Override</div><div class="FixedLine">         public JsonElement</div><div class="FixedLine">            serialize(Book src, Type typeOfSrc,</div><div class="FixedLine">                      JsonSerializationContext context)</div><div class="FixedLine">         {</div><div class="FixedLine">            JsonObject jsonObject = new JsonObject();</div><div class="FixedLine">            jsonObject.addProperty(&quot;title&quot;, src.getTitle());</div><div class="FixedLine">            jsonObject.addProperty(&quot;lead-author&quot;,</div><div class="FixedLine">                                   src.getAuthors()[0]);</div><div class="FixedLine">            JsonArray jsonOtherAuthors = new JsonArray();</div><div class="FixedLine">            for (int i = 1; i &lt; src.getAuthors().length;</div><div class="FixedLine">                 i++)</div><div class="FixedLine">            {</div><div class="FixedLine">               JsonPrimitive jsonAuthor =</div><div class="FixedLine">                  new JsonPrimitive(src.getAuthors()[i]);</div><div class="FixedLine">               jsonOtherAuthors.add(jsonAuthor);</div><div class="FixedLine">            }</div><div class="FixedLine">            jsonObject.add(&quot;other-authors&quot;,</div><div class="FixedLine">                           jsonOtherAuthors);</div><div class="FixedLine">            jsonObject.addProperty(&quot;isbn-10&quot;,</div><div class="FixedLine">                                   src.getIsbn10());</div><div class="FixedLine">            jsonObject.addProperty(&quot;isbn-13&quot;,</div><div class="FixedLine">                                   src.getIsbn13());</div><div class="FixedLine">            return jsonObject;</div><div class="FixedLine">         }</div><div class="FixedLine">      }<span id="ITerm55">
                          
                          
                          
                        </span></div><div class="FixedLine">      GsonBuilder gsonBuilder = new GsonBuilder();</div><div class="FixedLine">      gsonBuilder.registerTypeAdapter(Book.class,</div><div class="FixedLine">                                      new BookSerializer());</div><div class="FixedLine">      Gson gson = gsonBuilder.setPrettyPrinting().create();</div><div class="FixedLine">      Book book =</div><div class="FixedLine">         new Book(&quot;PHP and MySQL Web Development, &quot; +</div><div class="FixedLine">                  &quot;Second Edition&quot;,</div><div class="FixedLine">                  new String[] { &quot;Luke Welling&quot;,</div><div class="FixedLine">                  &quot;Laura Thomson&quot; },</div><div class="FixedLine">                  &quot;067232525X&quot;, &quot;075-2063325254&quot;);</div><div class="FixedLine">      out.println(gson.toJson(book));</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 9-8</span><p class="SimplePara">Creating a JSON Object from a Java Object via a Custom <span id="ITerm56">Serializer</span></p></div></div></div></div><div class="Para" id="Par110">Compile Listings <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC27">9-7</a></span> and <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC33">9-8</a></span>, and run the resulting application. You should observe the following output, which has been pretty-printed (via the <span class="EmphasisFontCategoryNonProportional ">setPrettyPrinting()</span> method call on the <span class="EmphasisFontCategoryNonProportional ">GsonBuilder</span> object) to make the output clearer:<div class="ProgramCode" id="PC34"><div class="LineGroup"><div class="FixedLine">{</div><div class="FixedLine">  &quot;title&quot;: &quot;PHP and MySQL Web Development, Second Edition&quot;,</div><div class="FixedLine">  &quot;lead-author&quot;: &quot;Luke Welling&quot;,</div><div class="FixedLine">  &quot;other-authors&quot;: [</div><div class="FixedLine">    &quot;Laura Thomson&quot;</div><div class="FixedLine">  ],</div><div class="FixedLine">  &quot;isbn-10&quot;: &quot;067232525X&quot;,</div><div class="FixedLine">  &quot;isbn-13&quot;: &quot;075-2063325254&quot;</div><div class="FixedLine">}<span id="ITerm57">
                          
                          
                          
                        </span></div></div></div></div></section></section><section class="Section2 RenderAsSection2" id="Sec9"><h3 class="Heading">Learning More About Gson</h3><p class="Para" id="Par111">Now that you have a fairly good understanding of Gson library basics, you鈥檒l probably want to learn about other features that this library offers. In this section, I introduce you to annotation types, contexts, Gson鈥檚 support for generics, and type adapters.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar4"><h3 class="Heading">Note</h3><p class="Para" id="Par112">My coverage of additional Gson features isn鈥檛 exhaustive. Check out the 鈥淕son User Guide鈥?(<span class="ExternalRef"><a href="http://github.com/google/gson/blob/master/UserGuide.md"><span class="RefSource">
                      <span class="EmphasisFontCategoryNonProportional ">http://github.com/google/gson/blob/master/UserGuide.md</span>
                    </span></a></span>) to learn about topics that I haven鈥檛 covered, for example, instance creators.</p></div><section class="Section3 RenderAsSection3" id="Sec10"><h4 class="Heading">Annotation Types</h4><div class="Para" id="Par113">Gson offers several <span id="ITerm58">annotation types</span><span id="ITerm59">
                    
                  </span> (in the <span class="EmphasisFontCategoryNonProportional ">com.google.gson.annotations</span> package) for simplifying serialization and deserialization:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par114"><span class="EmphasisFontCategoryNonProportional ">Expose</span>: Exposes the annotated field to or hides it from Gson鈥檚 serialization and/or deserialization mechanisms.</p></li><li><p class="Para" id="Par115"><span id="ITerm60">
                          <span class="EmphasisFontCategoryNonProportional ">JsonAdapter</span>
                          
                        </span>: Identifies the type adapter to use with a class or field. (I鈥檒l discuss this annotation type later when I focus on type adapters.)</p></li><li><p class="Para" id="Par116"><span class="EmphasisFontCategoryNonProportional ">SerializedName</span>: Indicates that the annotated field or method should be serialized to JSON with the provided name value as its name.</p></li><li><p class="Para" id="Par117"><span class="EmphasisFontCategoryNonProportional ">Since</span>: Identifies the starting version number for serializing a field or type. If a <span class="EmphasisFontCategoryNonProportional ">Gson</span> object is created with a version number that is less than the value in the <span class="EmphasisFontCategoryNonProportional ">@Since</span> annotation, the annotated field/type will not be serialized.</p></li><li><p class="Para" id="Par118"><span class="EmphasisFontCategoryNonProportional ">Until</span>: Identifies the ending version number for serializing a field or type. If a <span class="EmphasisFontCategoryNonProportional ">Gson</span> object is created with a version number that equals or exceeds the value in the <span class="EmphasisFontCategoryNonProportional ">@Until</span> annotation, the annotated field/type will not be serialized.</p></li></ul></div></div><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar5"><h3 class="Heading">Note</h3><p class="Para" id="Par119">According to the Gson documentation, <span class="EmphasisFontCategoryNonProportional ">Since</span> and <span class="EmphasisFontCategoryNonProportional ">Until</span> are useful for managing the versioning of JSON classes in a web service context.</p></div><section class="Section4 RenderAsSection4" id="Sec11"><h5 class="Heading">Exposing and Hiding Fields</h5><p class="Para" id="Par120">By default, <span class="EmphasisFontCategoryNonProportional ">Gson</span> will not serialize and deserialize <span id="ITerm61">fields</span> that are marked <span class="EmphasisFontCategoryNonProportional ">transient</span> (or <span class="EmphasisFontCategoryNonProportional ">static</span>). You can call <span class="EmphasisFontCategoryNonProportional ">GsonBuilder</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">GsonBuilder excludeFieldsWithModifiers(int... modifiers)</span> method to change this behavior. Also, <span class="EmphasisFontCategoryNonProportional ">Gson</span> lets you selectively determine which non-<span class="EmphasisFontCategoryNonProportional ">transient</span> fields to serialize and/or deserialize by annotating these fields with instances of the <span class="EmphasisFontCategoryNonProportional ">Expose</span> annotation type.</p><div class="Para" id="Par121"><span class="EmphasisFontCategoryNonProportional ">Expose</span> offers the following elements for determining whether a field can be serialized and whether it can be deserialized:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par122"><span class="EmphasisFontCategoryNonProportional ">serialize</span>: When <span class="EmphasisFontCategoryNonProportional ">true</span>, the field marked with this <span class="EmphasisFontCategoryNonProportional ">@Expose</span> annotation is serialized to JSON text; otherwise, the field isn鈥檛 serialized. The default value is <span class="EmphasisFontCategoryNonProportional ">true</span>.</p></li><li><p class="Para" id="Par123"><span class="EmphasisFontCategoryNonProportional ">deserialize</span>: When <span class="EmphasisFontCategoryNonProportional ">true</span>, the field marked with this <span class="EmphasisFontCategoryNonProportional ">@Expose</span> annotation is deserialized from JSON text; otherwise, the field isn鈥檛 deserialized. The default value is <span class="EmphasisFontCategoryNonProportional ">true</span>.</p></li></ul></div></div><div class="Para" id="Par124">The following code fragment shows how to use <span class="EmphasisFontCategoryNonProportional ">Expose</span> and these elements so that a field named <span class="EmphasisFontCategoryNonProportional ">someField</span> will be serialized and not deserialized:<div class="ProgramCode" id="PC35"><div class="LineGroup"><div class="FixedLine">@Expose(serialize = true, deserialize = false)</div><div class="FixedLine">int someField;</div></div></div></div><div class="Para" id="Par125">By default, <span class="EmphasisFontCategoryNonProportional ">Gson</span> ignores <span class="EmphasisFontCategoryNonProportional ">Expose</span>. You must configure <span class="EmphasisFontCategoryNonProportional ">Gson</span> to expose/hide fields that are annotated with <span class="EmphasisFontCategoryNonProportional ">@Expose</span> by calling the following <span class="EmphasisFontCategoryNonProportional ">GsonBuilder</span> method:<div class="ProgramCode" id="PC36"><div class="LineGroup"><div class="FixedLine">GsonBuilder excludeFieldsWithoutExposeAnnotation()</div></div></div></div><div class="Para" id="Par126">Create a <span class="EmphasisFontCategoryNonProportional ">GsonBuilder</span> object and then call <span class="EmphasisFontCategoryNonProportional ">GsonBuilder</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">excludeFieldsWithoutExposeAnnotation()</span> method<span id="ITerm62">
                      
                    </span> followed by its <span class="EmphasisFontCategoryNonProportional ">Gson create()</span> method<span id="ITerm63">
                      
                    </span> on this object to return a configured <span class="EmphasisFontCategoryNonProportional ">Gson</span> object:<div class="ProgramCode" id="PC37"><div class="LineGroup"><div class="FixedLine">GsonBuilder gsonb = new GsonBuilder();</div><div class="FixedLine">gsonb.excludeFieldsWithoutExposeAnnotation()<span id="ITerm64">
                            
                            
                          </span>;</div><div class="FixedLine">Gson gson = gsonb.create();</div></div></div></div><div class="Para" id="Par127">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC38">9-9</a></span> describes an application that demonstrates the <span class="EmphasisFontCategoryNonProportional ">Expose</span> annotation type.<div class="ProgramCode" id="PC38"><div class="LineGroup"><div class="FixedLine">import com.google.gson.Gson;</div><div class="FixedLine">import com.google.gson.GsonBuilder;</div></div><div class="LineGroup"><div class="FixedLine">import com.google.gson.annotations.Expose;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class GsonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   static class SomeClass</div><div class="FixedLine">   {</div><div class="FixedLine">      transient int id;</div><div class="FixedLine">      @Expose(serialize = true, deserialize = true)</div><div class="FixedLine">      transient String password;</div><div class="FixedLine">      @Expose(serialize = false, deserialize = false)</div><div class="FixedLine">      int field1;</div><div class="FixedLine">      @Expose(serialize = false, deserialize = true)</div><div class="FixedLine">      int field2;</div><div class="FixedLine">      @Expose(serialize = true, deserialize = false)</div><div class="FixedLine">      int field3;</div><div class="FixedLine">      @Expose(serialize = true, deserialize = true)</div><div class="FixedLine">      int field4;</div><div class="FixedLine">      @Expose(serialize = true, deserialize = true)</div><div class="FixedLine">      static int field5;</div><div class="FixedLine">      static int field6;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      SomeClass sc = new SomeClass();</div><div class="FixedLine">      sc.id = 1;</div><div class="FixedLine">      sc.password = &quot;abc&quot;;</div><div class="FixedLine">      sc.field1 = 2;</div><div class="FixedLine">      sc.field2 = 3;</div><div class="FixedLine">      sc.field3 = 4;</div><div class="FixedLine">      sc.field4 = 5;</div><div class="FixedLine">      sc.field5 = 6;</div><div class="FixedLine">      sc.field6 = 7;</div><div class="FixedLine">      GsonBuilder gsonb = new GsonBuilder();</div><div class="FixedLine">      gsonb.excludeFieldsWithoutExposeAnnotation();</div><div class="FixedLine">      Gson gson = gsonb.create();</div><div class="FixedLine">      String json = gson.toJson(sc) <span id="ITerm65">
                            
                            
                          </span>;</div><div class="FixedLine">      out.println(json);</div><div class="FixedLine">      SomeClass sc2 = gson.fromJson(json, SomeClass.class);</div><div class="FixedLine">      out.printf(&quot;id = %d%n&quot;, sc2.id);</div><div class="FixedLine">      out.printf(&quot;password = %s%n&quot;, sc2.password);</div><div class="FixedLine">      out.printf(&quot;field1 = %d%n&quot;, sc2.field1);</div><div class="FixedLine">      out.printf(&quot;field2 = %d%n&quot;, sc2.field2);</div><div class="FixedLine">      out.printf(&quot;field3 = %d%n&quot;, sc2.field3);</div><div class="FixedLine">      out.printf(&quot;field4 = %d%n&quot;, sc2.field4);</div><div class="FixedLine">      out.printf(&quot;field5 = %d%n&quot;, sc2.field5);</div><div class="FixedLine">      out.printf(&quot;field6 = %d%n&quot;, sc2.field6);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 9-9</span><p class="SimplePara">Exposing and Hiding Fields to and from Serialization and <span id="ITerm66">Deserialization</span></p></div></div></div></div><p class="Para" id="Par128">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC38">9-9</a></span> demonstrates <span class="EmphasisFontCategoryNonProportional ">Expose</span> with <span class="EmphasisFontCategoryNonProportional ">transient</span> instance fields along with non-<span class="EmphasisFontCategoryNonProportional ">transient</span> instance fields and <span class="EmphasisFontCategoryNonProportional ">static</span> fields.</p><div class="Para" id="Par129">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC38">9-9</a></span> and run the resulting application. You should observe the following output:<div class="ProgramCode" id="PC39"><div class="LineGroup"><div class="FixedLine">{&quot;field3&quot;:4,&quot;field4&quot;:5}</div><div class="FixedLine">id = 0</div><div class="FixedLine">password = null</div><div class="FixedLine">field1 = 0</div><div class="FixedLine">field2 = 0</div><div class="FixedLine">field3 = 0</div><div class="FixedLine">field4 = 5</div><div class="FixedLine">field5 = 6</div><div class="FixedLine">field6 = 7<span id="ITerm67">
                            
                            
                          </span></div></div></div></div><p class="Para" id="Par130">The first output line shows that only <span class="EmphasisFontCategoryNonProportional ">field3</span> and <span class="EmphasisFontCategoryNonProportional ">field4</span> are serialized. The other fields are not serialized.</p><p class="Para" id="Par131">The second and third lines show that the <span class="EmphasisFontCategoryNonProportional ">transient id</span> and <span class="EmphasisFontCategoryNonProportional ">password</span> fields receive default values. <span class="EmphasisFontCategoryNonProportional ">transient</span> fields are not serialized/deserialized.</p><p class="Para" id="Par132">The fourth, fifth, and sixth lines show that default <span class="EmphasisFontCategoryNonProportional ">0</span> values are assigned to <span class="EmphasisFontCategoryNonProportional ">field1</span>, <span class="EmphasisFontCategoryNonProportional ">field2</span>, and <span class="EmphasisFontCategoryNonProportional ">field3</span>. For <span class="EmphasisFontCategoryNonProportional ">field1</span> and <span class="EmphasisFontCategoryNonProportional ">field3</span>, <span class="EmphasisFontCategoryNonProportional ">deserialize</span> is assigned <span class="EmphasisFontCategoryNonProportional ">false</span> so only default values can be assigned to these fields. Because <span class="EmphasisFontCategoryNonProportional ">field2</span> wasn鈥檛 serialized, the only value that can be assigned to it is <span class="EmphasisFontCategoryNonProportional ">0</span>.</p><p class="Para" id="Par133">The seventh line shows that <span class="EmphasisFontCategoryNonProportional ">5</span> is assigned to <span class="EmphasisFontCategoryNonProportional ">field4</span>. This makes sense because the <span class="EmphasisFontCategoryNonProportional ">serialize</span> and <span class="EmphasisFontCategoryNonProportional ">deserialize</span> elements are assigned <span class="EmphasisFontCategoryNonProportional ">true</span>.</p><p class="Para" id="Par134">Because <span class="EmphasisFontCategoryNonProportional ">static</span> fields aren鈥檛 serialized or deserialized, they keep their initial values, as shown in the eighth and ninth lines (for <span class="EmphasisFontCategoryNonProportional ">field5</span> and <span class="EmphasisFontCategoryNonProportional ">field6</span>)<span id="ITerm68">
                      
                      
                    </span>.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar6"><h3 class="Heading">Note</h3><p class="Para" id="Par135">Even if <span class="EmphasisFontCategoryNonProportional ">Gson</span> serialized <span class="EmphasisFontCategoryNonProportional ">static</span> fields, <span class="EmphasisFontCategoryNonProportional ">field6</span> wouldn鈥檛 be serialized because it isn鈥檛 annotated with <span class="EmphasisFontCategoryNonProportional ">@Expose</span>, and also because of the <span class="EmphasisFontCategoryNonProportional ">gsonb.excludeFieldsWithoutExposeAnnotation()</span> method call, which causes <span class="EmphasisFontCategoryNonProportional ">Gson</span> to bypass fields not annotated with <span class="EmphasisFontCategoryNonProportional ">@Expose</span>.</p></div></section><section class="Section4 RenderAsSection4" id="Sec12"><h5 class="Heading">Changing Field Names</h5><div class="Para" id="Par136">You don鈥檛 have to use <span class="EmphasisFontCategoryNonProportional ">JsonSerializer&lt;T&gt;</span> and <span class="EmphasisFontCategoryNonProportional ">JsonDeserializer&lt;T&gt;</span> when you only want to change field and/or method <span id="ITerm69">names</span> during serialization and deserialization; for example, changing <span class="EmphasisFontCategoryNonProportional ">isbn10</span> to <span class="EmphasisFontCategoryNonProportional ">isbn-10</span> and <span class="EmphasisFontCategoryNonProportional ">isbn13</span> to <span class="EmphasisFontCategoryNonProportional ">isbn-13</span>. You can use <span class="EmphasisFontCategoryNonProportional ">SerializedName</span> instead, as shown here:<div class="ProgramCode" id="PC40"><div class="LineGroup"><div class="FixedLine">@SerializedName(&quot;isbn-10&quot;)</div><div class="FixedLine">String isbn10;</div><div class="FixedLine">@SerializedName(&quot;isbn-13&quot;)</div><div class="FixedLine">String isbn13;</div></div></div></div><p class="Para" id="Par137">The JSON object will present <span class="EmphasisFontCategoryNonProportional ">isbn-10</span> and <span class="EmphasisFontCategoryNonProportional ">isbn-13</span> property names, whereas the Java class presents <span class="EmphasisFontCategoryNonProportional ">isbn10</span> and <span class="EmphasisFontCategoryNonProportional ">isbn13</span> field names.</p><div class="Para" id="Par138">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC41">9-10</a></span> describes an application that demonstrates the <span class="EmphasisFontCategoryNonProportional ">SerializedName</span> annotation type.<div class="ProgramCode" id="PC41"><div class="LineGroup"><div class="FixedLine">import com.google.gson.Gson;</div></div><div class="LineGroup"><div class="FixedLine">import com.google.gson.annotations.SerializedName;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class GsonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   static class Book</div><div class="FixedLine">   {</div><div class="FixedLine">      String title;</div><div class="FixedLine">      @SerializedName(&quot;isbn-10&quot;)</div><div class="FixedLine">      String isbn10;</div><div class="FixedLine">      @SerializedName(&quot;isbn-13&quot;)</div><div class="FixedLine">      String isbn13;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      Book book = new Book();</div><div class="FixedLine">      book.title = &quot;PHP and MySQL Web Development, &quot; +</div><div class="FixedLine">                   &quot;Second Edition&quot;;</div><div class="FixedLine">      book.isbn10 = &quot;067232525X&quot;;</div><div class="FixedLine">      book.isbn13 = &quot;075-2063325254&quot;;</div><div class="FixedLine">      Gson gson = new Gson();</div><div class="FixedLine">      String json = gson.toJson(book);</div><div class="FixedLine">      out.println(json);</div><div class="FixedLine">      Book book2 = gson.fromJson(json, Book.class);</div><div class="FixedLine">      out.printf(&quot;title = %s%n&quot;, book2.title);</div><div class="FixedLine">      out.printf(&quot;isbn10 = %s%n&quot;, book2.isbn10);</div><div class="FixedLine">      out.printf(&quot;isbn13 = %s%n&quot;, book2.isbn13);</div><div class="FixedLine">   }</div><div class="FixedLine">}<span id="ITerm70">
                            
                            
                          </span></div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 9-10</span><p class="SimplePara">Changing <span id="ITerm71">Names</span></p></div></div></div></div><div class="Para" id="Par139">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC41">9-10</a></span> (and Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC27">9-7</a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">Book</span> class) and run the resulting application. You should observe the following output:<div class="ProgramCode" id="PC42"><div class="LineGroup"><div class="FixedLine">{&quot;title&quot;:&quot;PHP and MySQL Web Development, Second Edition&quot;,&quot;isbn-10&quot;:&quot;067232525X&quot;,&quot;isbn-13&quot;:&quot;075-2063325254&quot;}</div><div class="FixedLine">title = PHP and MySQL Web Development, Second Edition</div><div class="FixedLine">isbn10 = 067232525X</div><div class="FixedLine">isbn13 = 075-2063325254<span id="ITerm72">
                            
                            
                          </span></div></div></div></div></section><section class="Section4 RenderAsSection4" id="Sec13"><h5 class="Heading">Versioning</h5><p class="Para" id="Par140"><span class="EmphasisFontCategoryNonProportional ">Since</span> and <span class="EmphasisFontCategoryNonProportional ">Until</span> are useful for <span id="ITerm73">versioning</span><span id="ITerm74">
                      
                    </span> your classes. Using these annotation types, you can determine which fields and/or types are serialized to JSON objects.</p><div class="Para" id="Par141">Each <span class="EmphasisFontCategoryNonProportional ">@Since</span> and <span class="EmphasisFontCategoryNonProportional ">@Until</span> annotation receives a double precision floating-point value as its argument. This value specifies a version number, as demonstrated here:<div class="ProgramCode" id="PC43"><div class="LineGroup"><div class="FixedLine">@Since(1.0) private String userID;</div><div class="FixedLine">@Since(1.0) private String password;</div><div class="FixedLine">@Until(1.1) private String emailAddress;</div></div></div></div><p class="Para" id="Par142"><span class="EmphasisFontCategoryNonProportional ">@Since(1.0)</span> indicates that the field it annotates is to be serialized for all versions greater than or equal to <span class="EmphasisFontCategoryNonProportional ">1.0</span>. Similarly, <span class="EmphasisFontCategoryNonProportional ">@Until(1.1)</span> indicates that the field it annotates is to be serialized for all versions less than <span class="EmphasisFontCategoryNonProportional ">1.1</span>.</p><div class="Para" id="Par143">The version number that鈥檚 compared to the <span class="EmphasisFontCategoryNonProportional ">@Since</span> or <span class="EmphasisFontCategoryNonProportional ">@Until</span> version argument is specified by the following <span class="EmphasisFontCategoryNonProportional ">GsonBuilder</span> method:<div class="ProgramCode" id="PC44"><div class="LineGroup"><div class="FixedLine">GsonBuilder setVersion(double ignoreVersionsAfter)</div></div></div></div><div class="Para" id="Par144">As with <span class="EmphasisFontCategoryNonProportional ">Expose</span>, you would first create a <span class="EmphasisFontCategoryNonProportional ">GsonBuilder</span> object, then call this method with the desired version number on that object, and finally call <span class="EmphasisFontCategoryNonProportional ">create()</span> on the <span class="EmphasisFontCategoryNonProportional ">GsonBuilder</span> object to return a newly created <span class="EmphasisFontCategoryNonProportional ">Gson</span> object:<div class="ProgramCode" id="PC45"><div class="LineGroup"><div class="FixedLine">GsonBuilder gsonb = new GsonBuilder();</div><div class="FixedLine">gsonb.setVersion(2.0);</div><div class="FixedLine">Gson gson = gsonb.create();</div></div></div></div><div class="Para" id="Par145">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC46">9-11</a></span> describes an application that demonstrates the <span class="EmphasisFontCategoryNonProportional ">Since</span> and <span class="EmphasisFontCategoryNonProportional ">Until</span>
<span id="ITerm75">annotation types</span>.<div class="ProgramCode" id="PC46"><div class="LineGroup"><div class="FixedLine">import com.google.gson.Gson;</div><div class="FixedLine">import com.google.gson.GsonBuilder;</div></div><div class="LineGroup"><div class="FixedLine">import com.google.gson.annotations.Since;</div><div class="FixedLine">import com.google.gson.annotations.Until;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class GsonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   @Since(1.0)</div><div class="FixedLine">   @Until(2.5)</div><div class="FixedLine">   static class SomeClass</div><div class="FixedLine">   {</div><div class="FixedLine">      @Since(1.1)</div><div class="FixedLine">      @Until(1.5)</div><div class="FixedLine">      int field;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      SomeClass sc = new SomeClass();</div><div class="FixedLine">      sc.field = 1;</div><div class="FixedLine">      GsonBuilder gsonb = new GsonBuilder();</div><div class="FixedLine">      gsonb.setVersion(0.9);</div><div class="FixedLine">      Gson gson = gsonb.create();</div><div class="FixedLine">      out.printf(&quot;%s%n%n&quot;, gson.toJson(sc));</div><div class="FixedLine">      gsonb.setVersion(1.0);</div><div class="FixedLine">      gson = gsonb.create();</div><div class="FixedLine">      out.printf(&quot;%s%n%n&quot;, gson.toJson(sc));</div><div class="FixedLine">      gsonb.setVersion(1.1);</div><div class="FixedLine">      gson = gsonb.create();</div><div class="FixedLine">      out.printf(&quot;%s%n%n&quot;, gson.toJson(sc));</div><div class="FixedLine">      gsonb.setVersion(1.5);</div><div class="FixedLine">      gson = gsonb.create();</div><div class="FixedLine">      out.printf(&quot;%s%n%n&quot;, gson.toJson(sc));</div><div class="FixedLine">      gsonb.setVersion(2.5);</div><div class="FixedLine">      gson = gsonb.create();</div><div class="FixedLine">      out.printf(&quot;%s%n&quot;, gson.toJson(sc));</div><div class="FixedLine">   }</div><div class="FixedLine">}<span id="ITerm76">
                            
                            
                          </span></div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 9-11</span><p class="SimplePara">Versioning a Class and Its Fields</p></div></div></div></div><p class="Para" id="Par146">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC46">9-11</a></span> presents a nested <span class="EmphasisFontCategoryNonProportional ">SomeClass</span> that will be serialized as long as the version number passed to <span class="EmphasisFontCategoryNonProportional ">setVersion()</span> ranges from <span class="EmphasisFontCategoryNonProportional ">1.0</span> to almost <span class="EmphasisFontCategoryNonProportional ">2.5</span>. This class presents a field named <span class="EmphasisFontCategoryNonProportional ">field</span> that will be serialized as long as the version number passed to <span class="EmphasisFontCategoryNonProportional ">setVersion()</span> ranges from <span class="EmphasisFontCategoryNonProportional ">1.1</span> to almost <span class="EmphasisFontCategoryNonProportional ">1.5</span>.</p><div class="Para" id="Par147">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC46">9-11</a></span> and run the resulting application. You should observe the following output:<div class="ProgramCode" id="PC47"><div class="LineGroup"><div class="FixedLine">null</div></div><div class="LineGroup"><div class="FixedLine">{}</div></div><div class="LineGroup"><div class="FixedLine">{&quot;field&quot;:1}</div></div><div class="LineGroup"><div class="FixedLine">{}</div></div><div class="LineGroup"><div class="FixedLine">null<span id="ITerm77">
                            
                            
                          </span></div></div></div></div></section></section><section class="Section3 RenderAsSection3" id="Sec14"><h4 class="Heading">Contexts</h4><p class="Para" id="Par148">The <span class="EmphasisFontCategoryNonProportional ">serialize()</span> and <span class="EmphasisFontCategoryNonProportional ">deserialize()</span> methods<span id="ITerm78">
                    
                    
                  </span><span id="ITerm79">
                    
                    
                  </span> that are declared by the <span class="EmphasisFontCategoryNonProportional ">JsonSerializer</span> and <span class="EmphasisFontCategoryNonProportional ">JsonDeserializer</span> interfaces are called with <span class="EmphasisFontCategoryNonProportional ">com.google.gson.JsonSerializationContext</span> and <span class="EmphasisFontCategoryNonProportional ">com.google.gson.JsonDeserializationContext</span> objects, respectively, as their final arguments. These objects provide <span class="EmphasisFontCategoryNonProportional ">serialize()</span> and <span class="EmphasisFontCategoryNonProportional ">deserialize()</span> methods for performing default serialization and default deserialization on specific Java objects. You鈥檒l find them handy when working with nested Java objects that don鈥檛 require special treatment.</p><div class="Para" id="Par149">Suppose you have the following <span class="EmphasisFontCategoryNonProportional ">Date</span> and <span class="EmphasisFontCategoryNonProportional ">Employee</span> classes:<div class="ProgramCode" id="PC48"><div class="LineGroup"><div class="FixedLine">class Date</div><div class="FixedLine">{</div><div class="FixedLine">   int year;</div><div class="FixedLine">   int month;</div><div class="FixedLine">   int day;</div></div><div class="LineGroup"><div class="FixedLine">   Date(int year, int month, int day)</div><div class="FixedLine">   {</div><div class="FixedLine">      this.year = year;</div><div class="FixedLine">      this.month = month;</div><div class="FixedLine">      this.day = day; <span id="ITerm80">
                          
                          
                        </span></div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">class Employee</div><div class="FixedLine">{</div><div class="FixedLine">   String name;</div><div class="FixedLine">   Date hireDate;</div><div class="FixedLine">}</div></div></div></div><p class="Para" id="Par150">Now, suppose that you decide to create a custom serializer to add <span class="EmphasisFontCategoryNonProportional ">emp-name</span> and <span class="EmphasisFontCategoryNonProportional ">hire-date</span> properties (instead of <span class="EmphasisFontCategoryNonProportional ">name</span> and <span class="EmphasisFontCategoryNonProportional ">hireDate</span> properties) to the resulting JSON object. Because you鈥檙e not changing the names or the order of <span class="EmphasisFontCategoryNonProportional ">Date</span>鈥檚 fields during serialization, you can leverage the <em class="EmphasisTypeItalic ">context</em> passed to <span class="EmphasisFontCategoryNonProportional ">JsonSerializer</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">serialize()</span> method to handle that part of the serialization for you.</p><div class="Para" id="Par151">The following code fragment presents a serializer that serializes <span class="EmphasisFontCategoryNonProportional ">Employee</span> objects and their nested <span class="EmphasisFontCategoryNonProportional ">Date</span> objects<span id="ITerm81">
                    
                    
                  </span>:<div class="ProgramCode" id="PC49"><div class="LineGroup"><div class="FixedLine">class EmployeeSerializer</div><div class="FixedLine">   implements JsonSerializer&lt;Employee&gt;</div><div class="FixedLine">{</div><div class="FixedLine">   @Override</div><div class="FixedLine">   public JsonElement</div><div class="FixedLine">      serialize(Employee emp, Type typeOfSrc,</div><div class="FixedLine">                JsonSerializationContext context)</div><div class="FixedLine">   {</div><div class="FixedLine">      JsonObject jo = new JsonObject();</div><div class="FixedLine">      jo.addProperty(&quot;emp-name&quot;, emp.name);</div><div class="FixedLine">      jo.add(&quot;hire-date&quot;,</div><div class="FixedLine">             context.serialize(emp.hireDate));</div><div class="FixedLine">      return jo;</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div></div></div><p class="Para" id="Par152"><span class="EmphasisFontCategoryNonProportional ">serialize()</span> first creates a <span class="EmphasisFontCategoryNonProportional ">JsonObject</span> to describe the serialized JSON object. It then adds an <span class="EmphasisFontCategoryNonProportional ">emp-name</span> property with the employee name as the value to this <span class="EmphasisFontCategoryNonProportional ">JsonObject</span>. Because default serialization can serialize the <span class="EmphasisFontCategoryNonProportional ">hireDate</span> field, <span class="EmphasisFontCategoryNonProportional ">serialize()</span> calls <span class="EmphasisFontCategoryNonProportional ">context.serialize(emp.hireDate)</span> to generate a property value. This value and the <span class="EmphasisFontCategoryNonProportional ">hire-date</span> property name are added to the <span class="EmphasisFontCategoryNonProportional ">JsonObject</span>, which is returned from the method.</p><div class="Para" id="Par153">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC50">9-12</a></span> presents the source code to an application that demonstrates this <span class="EmphasisFontCategoryNonProportional ">serialize()</span> method<span id="ITerm82">
                    
                    
                  </span>.<div class="ProgramCode" id="PC50"><div class="LineGroup"><div class="FixedLine">import java.lang.reflect.Type;</div></div><div class="LineGroup"><div class="FixedLine">import com.google.gson.Gson;</div><div class="FixedLine">import com.google.gson.GsonBuilder;</div><div class="FixedLine">import com.google.gson.JsonElement;</div><div class="FixedLine">import com.google.gson.JsonObject;</div><div class="FixedLine">import com.google.gson.JsonSerializationContext;</div><div class="FixedLine">import com.google.gson.JsonSerializer;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class GsonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   static class Date</div><div class="FixedLine">   {</div><div class="FixedLine">      int year;</div><div class="FixedLine">      int month;</div><div class="FixedLine">      int day;</div></div><div class="LineGroup"><div class="FixedLine">      Date(int year, int month, int day)</div><div class="FixedLine">      {</div><div class="FixedLine">         this.year = year;</div><div class="FixedLine">         this.month = month;</div><div class="FixedLine">         this.day = day;</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   static class Employee</div><div class="FixedLine">   {</div><div class="FixedLine">      String name;</div><div class="FixedLine">      Date hireDate; <span id="ITerm83">
                          
                          
                          
                        </span></div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      Employee e = new Employee();</div><div class="FixedLine">      e.name = &quot;John Doe&quot;;</div><div class="FixedLine">      e.hireDate = new Date(1982, 10, 12);</div><div class="FixedLine">      GsonBuilder gb = new GsonBuilder();</div><div class="FixedLine">      class EmployeeSerializer</div><div class="FixedLine">         implements JsonSerializer&lt;Employee&gt;</div><div class="FixedLine">      {</div><div class="FixedLine">         @Override</div><div class="FixedLine">         public JsonElement</div><div class="FixedLine">            serialize(Employee emp, Type typeOfSrc,</div><div class="FixedLine">                      JsonSerializationContext context)</div><div class="FixedLine">         {</div><div class="FixedLine">            JsonObject jo = new JsonObject();</div><div class="FixedLine">            jo.addProperty(&quot;emp-name&quot;, emp.name);</div><div class="FixedLine">            jo.add(&quot;hire-date&quot;,</div><div class="FixedLine">                   context.serialize(emp.hireDate));</div><div class="FixedLine">            return jo;</div><div class="FixedLine">         }</div><div class="FixedLine">      }</div><div class="FixedLine">      gb.registerTypeAdapter(Employee.class,</div><div class="FixedLine">                             new EmployeeSerializer());</div><div class="FixedLine">      Gson gson = gb.create();</div><div class="FixedLine">      out.printf(&quot;%s%n%n&quot;, gson.toJson(e));</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 9-12</span><p class="SimplePara">Leveraging a Context to Serialize a <span id="ITerm84">Date</span></p></div></div></div></div><div class="Para" id="Par154">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC50">9-12</a></span> and run the resulting application. You should observe the following output (on one line):<div class="ProgramCode" id="PC51"><div class="LineGroup"><div class="FixedLine">{&quot;emp-name&quot;:&quot;John Doe&quot;,&quot;hire-date&quot;:{&quot;year&quot;:1982,&quot;month&quot;:10,&quot;day&quot;:12}}<span id="ITerm85">
                          
                          
                          
                        </span><span id="ITerm86">
                          
                          
                        </span></div></div></div></div></section><section class="Section3 RenderAsSection3" id="Sec15"><h4 class="Heading">Generics Support</h4><div class="Para" id="Par155">When you <span id="ITerm87">call</span>
<span class="ExternalRef"><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true"><span class="RefSource">
                      <span class="EmphasisFontCategoryNonProportional ">String</span>
                    </span></a></span>
<span class="EmphasisFontCategoryNonProportional ">toJson(</span><span class="ExternalRef"><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Object.html?is-external=true"><span class="RefSource">
                      <span class="EmphasisFontCategoryNonProportional ">Object</span>
                    </span></a></span>
<span class="EmphasisFontCategoryNonProportional ">src)</span> or <span class="EmphasisFontCategoryNonProportional ">void toJson(Object src, Appendable writer)</span>, <span class="EmphasisFontCategoryNonProportional ">Gson</span> calls <span class="EmphasisFontCategoryNonProportional ">src.getClass()</span> to get <span class="EmphasisFontCategoryNonProportional ">src</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">java.lang.Class</span> object so that it can reflectively learn about the fields to serialize. Similarly, when you call a deserialization method such as <span class="EmphasisFontCategoryNonProportional ">&lt;T&gt; T fromJson(</span><span class="ExternalRef"><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true"><span class="RefSource">
                      <span class="EmphasisFontCategoryNonProportional ">String</span>
                    </span></a></span>
<span class="EmphasisFontCategoryNonProportional ">json,</span>
<span class="ExternalRef"><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Class.html?is-external=true"><span class="RefSource">
                      <span class="EmphasisFontCategoryNonProportional ">Class</span>
                    </span></a></span><span class="EmphasisFontCategoryNonProportional ">&lt;T&gt; classOfT)</span>, <span class="EmphasisFontCategoryNonProportional ">Gson</span> uses the <span class="EmphasisFontCategoryNonProportional ">Class</span> object passed to <span class="EmphasisFontCategoryNonProportional ">classOfT</span> to help it reflectively build a result Java object. These operations work properly for objects instantiated from nongeneric types. However, when an object is created from a generic type, problems can occur because the generic type information is lost due to <em class="EmphasisTypeItalic ">type erasure</em>. Consider the following <span id="ITerm88">code fragment</span>:<div class="ProgramCode" id="PC52"><div class="LineGroup"><div class="FixedLine">List&lt;String&gt; weekdays =</div><div class="FixedLine">   Arrays.asList(&quot;Sun&quot;, &quot;Mon&quot;, &quot;Tue&quot;, &quot;Wed&quot;, &quot;Thu&quot;,</div><div class="FixedLine">                 &quot;Fri&quot;, &quot;Sat&quot;);</div><div class="FixedLine">String json = gson.toJson(weekdays);</div><div class="FixedLine">System.out.printf(&quot;%s%n%n&quot;, json);</div><div class="FixedLine">System.out.printf(&quot;%s%n%n&quot;,</div><div class="FixedLine">                  gson.fromJson(json, weekdays.getClass()));</div></div></div></div><div class="Para" id="Par156">Variable <span class="EmphasisFontCategoryNonProportional ">weekdays</span> is an object with generic type <span class="EmphasisFontCategoryNonProportional ">java.util.List&lt;String&gt;</span>. The <span class="EmphasisFontCategoryNonProportional ">toJson()</span> method calls <span class="EmphasisFontCategoryNonProportional ">weekdays.getClass()</span> and discovers, instead, <span class="EmphasisFontCategoryNonProportional ">List</span> as the type. However, it still successfully serializes <span class="EmphasisFontCategoryNonProportional ">weekdays</span> to the following JSON object:<div class="ProgramCode" id="PC53"><div class="LineGroup"><div class="FixedLine">[&quot;Sun&quot;,&quot;Mon&quot;,&quot;Tue&quot;,&quot;Wed&quot;,&quot;Thu&quot;,&quot;Fri&quot;,&quot;Sat&quot;]<span id="ITerm89">
                          
                          
                        </span></div></div></div></div><p class="Para" id="Par157">Deserialization isn鈥檛 successful. When <span class="EmphasisFontCategoryNonProportional ">gson.fromJson(json, weekdays.getClass())</span> is called, this method throws an instance of the <span class="EmphasisFontCategoryNonProportional ">java.lang.ClassCastException</span> class. Internally, it attempts to cast <span class="EmphasisFontCategoryNonProportional ">java.util.ArrayList</span> to <span class="EmphasisFontCategoryNonProportional ">java.util.Arrays$ArrayList</span>, which doesn鈥檛 work.</p><p class="Para" id="Par158">The solution to this problem is to specify the correct <span class="EmphasisFontCategoryNonProportional ">List&lt;String&gt;</span>
<em class="EmphasisTypeItalic ">parameterized type</em> (generic type instance) instead of the raw <span class="EmphasisFontCategoryNonProportional ">List</span> type that鈥檚 returned from <span class="EmphasisFontCategoryNonProportional ">weekdays.getClass()</span>. You use the <span class="EmphasisFontCategoryNonProportional ">com.google.gson.reflect.TypeToken&lt;T&gt;</span> class for this purpose.</p><div class="Para" id="Par159"><span class="EmphasisFontCategoryNonProportional ">TypeToken&lt;T&gt;</span> represents a generic type <span class="EmphasisFontCategoryNonProportional ">T</span> and enables the retrieval of type information at runtime, which <span class="EmphasisFontCategoryNonProportional ">Gson</span> requires. You would instantiate <span class="EmphasisFontCategoryNonProportional ">TypeToken</span> using an expression such as the following:<div class="ProgramCode" id="PC54"><div class="LineGroup"><div class="FixedLine">Type listType = new TypeToken&lt;List&lt;String&gt;&gt;() {}.getType();</div></div></div></div><div class="Para" id="Par160">This idiom defines an anonymous local inner class whose inherited <span class="EmphasisFontCategoryNonProportional ">getType()</span> method returns the fully parameterized type as a <span class="EmphasisFontCategoryNonProportional ">java.lang.reflect.Type</span> object. In this code fragment, the following type is returned:<div class="ProgramCode" id="PC55"><div class="LineGroup"><div class="FixedLine">java.util.List&lt;java.lang.String&gt;</div></div></div></div><div class="Para" id="Par161">Pass the resulting <span class="EmphasisFontCategoryNonProportional ">Type</span> object to the <span class="EmphasisFontCategoryNonProportional ">&lt;T&gt; T fromJson(</span><span class="ExternalRef"><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true"><span class="RefSource">
                      <span class="EmphasisFontCategoryNonProportional ">String</span>
                    </span></a></span>
<span class="EmphasisFontCategoryNonProportional ">json,</span>
<span class="ExternalRef"><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/reflect/Type.html?is-external=true"><span class="RefSource">
                      <span class="EmphasisFontCategoryNonProportional ">Type</span>
                    </span></a></span>
<span class="EmphasisFontCategoryNonProportional ">typeOfT)</span> method, as follows:<div class="ProgramCode" id="PC56"><div class="LineGroup"><div class="FixedLine">gson.fromJson(json, listType)</div></div></div></div><p class="Para" id="Par162">This method call parses and returns the JSON object as a <span class="EmphasisFontCategoryNonProportional ">List&lt;String&gt;</span>.</p><div class="Para" id="Par163">You might want to output the result using an expression such as the following:<div class="ProgramCode" id="PC57"><div class="LineGroup"><div class="FixedLine">System.out.printf(&quot;%s%n%n&quot;, gson.fromJson(json, listType));</div></div></div></div><div class="Para" id="Par164">However, you would receive a thrown <span class="EmphasisFontCategoryNonProportional ">ClassCastException</span> stating that you cannot cast <span class="EmphasisFontCategoryNonProportional ">ArrayList</span> to <span class="EmphasisFontCategoryNonProportional ">java.lang.Object[]</span> instead of observing output. The solution to the problem is to introduce a cast to <span class="EmphasisFontCategoryNonProportional ">List</span>, as follows:<div class="ProgramCode" id="PC58"><div class="LineGroup"><div class="FixedLine">System.out.printf(&quot;%s%n%n&quot;,</div><div class="FixedLine">                  (List) gson.fromJson(json, listType));</div></div></div></div><div class="Para" id="Par165">After making this change, you would observe the following output:<div class="ProgramCode" id="PC59"><div class="LineGroup"><div class="FixedLine">[Sun, Mon, Tue, Wed, Thu, Fri, Sat] <span id="ITerm90">
                          
                          
                        </span></div></div></div></div><div class="Para" id="Par166">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC60">9-13</a></span> presents the source code to an application that demonstrates this problem along with other generic-oriented serialization/deserialization problems, and how to solve them.<div class="ProgramCode" id="PC60"><div class="LineGroup"><div class="FixedLine">import java.lang.reflect.Type;</div></div><div class="LineGroup"><div class="FixedLine">import java.util.ArrayList;</div><div class="FixedLine">import java.util.List;</div><div class="FixedLine">import java.util.Map;</div><div class="FixedLine">import java.util.HashMap;</div></div><div class="LineGroup"><div class="FixedLine">import com.google.gson.Gson;</div></div><div class="LineGroup"><div class="FixedLine">import com.google.gson.reflect.TypeToken;</div></div><div class="LineGroup"><div class="FixedLine">import java.util.Arrays;</div><div class="FixedLine">import java.util.List;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class GsonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   static</div><div class="FixedLine">   class Vehicle&lt;T&gt;</div><div class="FixedLine">   {</div><div class="FixedLine">      T vehicle;</div></div><div class="LineGroup"><div class="FixedLine">      T get()</div><div class="FixedLine">      {</div><div class="FixedLine">         return vehicle;</div><div class="FixedLine">      }</div></div><div class="LineGroup"><div class="FixedLine">      void set(T vehicle)</div><div class="FixedLine">      {</div><div class="FixedLine">         this.vehicle = vehicle;</div><div class="FixedLine">      }</div></div><div class="LineGroup"><div class="FixedLine">      @Override</div><div class="FixedLine">      public String toString()</div><div class="FixedLine">      {</div><div class="FixedLine">         out.printf(&quot;Class of vehicle: %s%n&quot;,</div><div class="FixedLine">                    vehicle.getClass());</div><div class="FixedLine">         return &quot;Vehicle: &quot; + vehicle.toString();</div><div class="FixedLine">      }</div><div class="FixedLine">   }<span id="ITerm91">
                          
                          
                        </span></div></div><div class="LineGroup"><div class="FixedLine">   static</div><div class="FixedLine">   class Truck</div><div class="FixedLine">   {</div><div class="FixedLine">      String make;</div><div class="FixedLine">      String model;</div></div><div class="LineGroup"><div class="FixedLine">      Truck(String make, String model)</div><div class="FixedLine">      {</div><div class="FixedLine">         this.make = make;</div><div class="FixedLine">         this.model = model;</div><div class="FixedLine">      }</div></div><div class="LineGroup"><div class="FixedLine">      @Override</div><div class="FixedLine">      public String toString()</div><div class="FixedLine">      {</div><div class="FixedLine">         return &quot;Make: &quot; + make + &quot; Model: &quot; + model;</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      Gson gson = new Gson();</div></div><div class="LineGroup"><div class="FixedLine">      // ...</div></div><div class="LineGroup"><div class="FixedLine">      out.printf(&quot;PART 1%n&quot;);</div><div class="FixedLine">      out.printf(&quot;------%n%n&quot;);</div></div><div class="LineGroup"><div class="FixedLine">      List&lt;String&gt; weekdays =</div><div class="FixedLine">         Arrays.asList(&quot;Sun&quot;, &quot;Mon&quot;, &quot;Tue&quot;, &quot;Wed&quot;, &quot;Thu&quot;,</div><div class="FixedLine">                       &quot;Fri&quot;, &quot;Sat&quot;);</div><div class="FixedLine">      String json = gson.toJson(weekdays);</div><div class="FixedLine">      out.printf(&quot;%s%n%n&quot;, json);</div><div class="FixedLine">      try</div><div class="FixedLine">      {</div><div class="FixedLine">         out.printf(&quot;%s%n%n&quot;,</div><div class="FixedLine">                    gson.fromJson(json,</div><div class="FixedLine">                                  weekdays.getClass()));</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (ClassCastException cce) <span id="ITerm92">
                          
                          
                        </span></div><div class="FixedLine">      {</div><div class="FixedLine">         cce.printStackTrace();</div><div class="FixedLine">         out.println();</div><div class="FixedLine">      }</div><div class="FixedLine">      Type listType =</div><div class="FixedLine">         new TypeToken&lt;List&lt;String&gt;&gt;() {}.getType();</div><div class="FixedLine">      out.printf(&quot;Type = %s%n%n&quot;, listType);</div><div class="FixedLine">      try</div><div class="FixedLine">      {</div><div class="FixedLine">         out.printf(&quot;%s%n%n&quot;, gson.fromJson(json,</div><div class="FixedLine">                                            listType));</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (ClassCastException cce)</div><div class="FixedLine">      {</div><div class="FixedLine">         cce.printStackTrace();</div><div class="FixedLine">         out.println();</div><div class="FixedLine">      }</div><div class="FixedLine">      out.printf(&quot;%s%n%n&quot;, (List) gson.fromJson(json,</div><div class="FixedLine">                                                listType));</div></div><div class="LineGroup"><div class="FixedLine">      // ...</div></div><div class="LineGroup"><div class="FixedLine">      out.printf(&quot;PART 2%n&quot;);</div><div class="FixedLine">      out.printf(&quot;------%n%n&quot;);</div></div><div class="LineGroup"><div class="FixedLine">      Truck truck = new Truck(&quot;Ford&quot;, &quot;F150&quot;);</div><div class="FixedLine">      Vehicle&lt;Truck&gt; vehicle = new Vehicle&lt;&gt;();</div><div class="FixedLine">      vehicle.set(truck);</div></div><div class="LineGroup"><div class="FixedLine">      json = gson.toJson(vehicle);</div><div class="FixedLine">      out.printf(&quot;%s%n%n&quot;, json);</div><div class="FixedLine">      out.printf(&quot;%s%n%n&quot;,</div><div class="FixedLine">                 gson.fromJson(json, vehicle.getClass()));</div></div><div class="LineGroup"><div class="FixedLine">      // ...</div></div><div class="LineGroup"><div class="FixedLine">      out.printf(&quot;PART 3%n&quot;);</div><div class="FixedLine">      out.printf(&quot;------%n%n&quot;);</div></div><div class="LineGroup"><div class="FixedLine">      Map&lt;String, String&gt; map =</div><div class="FixedLine">         new HashMap&lt;String, String&gt;()<span id="ITerm93">
                          
                          
                        </span></div><div class="FixedLine">      {</div><div class="FixedLine">         {</div><div class="FixedLine">            put(&quot;key&quot;, &quot;value&quot;);</div><div class="FixedLine">         }</div><div class="FixedLine">      };</div><div class="FixedLine">      out.printf(&quot;Map = %s%n%n&quot;, map);</div><div class="FixedLine">      out.printf(&quot;%s%n%n&quot;, gson.toJson(map));</div><div class="FixedLine">      out.printf(&quot;%s%n%n&quot;, gson.fromJson(gson.toJson(map),</div><div class="FixedLine">                                         map.getClass()));</div></div><div class="LineGroup"><div class="FixedLine">      // ...</div></div><div class="LineGroup"><div class="FixedLine">      out.printf(&quot;PART 4%n&quot;);</div><div class="FixedLine">      out.printf(&quot;------%n%n&quot;);</div></div><div class="LineGroup"><div class="FixedLine">      Type vehicleType =</div><div class="FixedLine">         new TypeToken&lt;Vehicle&lt;Truck&gt;&gt;() {}.getType();</div><div class="FixedLine">      json = gson.toJson(vehicle, vehicleType);</div><div class="FixedLine">      out.printf(&quot;%s%n%n&quot;, json);</div><div class="FixedLine">      out.printf(&quot;%s%n%n&quot;, (Vehicle)</div><div class="FixedLine">                           gson.fromJson(json,</div><div class="FixedLine">                                         vehicleType));</div></div><div class="LineGroup"><div class="FixedLine">      Type mapType =</div><div class="FixedLine">         new TypeToken&lt;Map&lt;String,String&gt;&gt;() {}.getType();</div><div class="FixedLine">      out.printf(&quot;%s%n%n&quot;, gson.toJson(map, mapType));</div><div class="FixedLine">      out.printf(&quot;%s%n%n&quot;, (Map)</div><div class="FixedLine">                 gson.fromJson(gson.toJson(map, mapType),</div><div class="FixedLine">                               mapType)) <span id="ITerm94">
                          
                          
                        </span>;</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 9-13</span><p class="SimplePara">Serializing and Deserializing Objects Based on Generic <span id="ITerm95">Types</span></p></div></div></div></div><div class="Para" id="Par167">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC60">9-13</a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">GsonDemo</span> class is organized into nested <span class="EmphasisFontCategoryNonProportional ">Vehicle</span> and <span class="EmphasisFontCategoryNonProportional ">Truck static</span> classes followed by the <span class="EmphasisFontCategoryNonProportional ">main()</span> entry-point <span id="ITerm96">method</span>. This method is organized into four sections that demonstrate problems and solutions. Here is the output, which I鈥檒l refer to during my discussion of <span class="EmphasisFontCategoryNonProportional ">main()</span>:<div class="ProgramCode" id="PC61"><div class="LineGroup"><div class="FixedLine">PART 1</div><div class="FixedLine">------</div></div><div class="LineGroup"><div class="FixedLine">[&quot;Sun&quot;,&quot;Mon&quot;,&quot;Tue&quot;,&quot;Wed&quot;,&quot;Thu&quot;,&quot;Fri&quot;,&quot;Sat&quot;]</div></div><div class="LineGroup"><div class="FixedLine">java.lang.ClassCastException: Cannot cast java.util.ArrayList to java.util.Arrays$ArrayList</div><div class="FixedLine">      at java.base/java.lang.Class.cast(Class.java:3606)</div><div class="FixedLine">      at com.google.gson.Gson.fromJson(Gson.java:814)</div><div class="FixedLine">      at GsonDemo.main(GsonDemo.java:79)</div></div><div class="LineGroup"><div class="FixedLine">Type = java.util.List&lt;java.lang.String&gt;</div></div><div class="LineGroup"><div class="FixedLine">java.lang.ClassCastException: class java.util.ArrayList cannot be cast to class [Ljava.lang.Object; (java.util.ArrayList and [Ljava.lang.Object; are in module java.base of loader &apos;bootstrap&apos;)</div><div class="FixedLine">      at GsonDemo.main(GsonDemo.java:92)</div></div><div class="LineGroup"><div class="FixedLine">[Sun, Mon, Tue, Wed, Thu, Fri, Sat]</div></div><div class="LineGroup"><div class="FixedLine">PART 2</div><div class="FixedLine">------</div></div><div class="LineGroup"><div class="FixedLine">{&quot;vehicle&quot;:{&quot;make&quot;:&quot;Ford&quot;,&quot;model&quot;:&quot;F150&quot;}}</div></div><div class="LineGroup"><div class="FixedLine">Class of vehicle: class com.google.gson.internal.LinkedTreeMap</div><div class="FixedLine">Vehicle: {make=Ford, model=F150}</div></div><div class="LineGroup"><div class="FixedLine">PART 3</div><div class="FixedLine">------</div></div><div class="LineGroup"><div class="FixedLine">Map = {key=value}</div></div><div class="LineGroup"><div class="FixedLine">null</div></div><div class="LineGroup"><div class="FixedLine">null</div></div><div class="LineGroup"><div class="FixedLine">PART 4</div><div class="FixedLine">------</div></div><div class="LineGroup"><div class="FixedLine">{&quot;vehicle&quot;:{&quot;make&quot;:&quot;Ford&quot;,&quot;model&quot;:&quot;F150&quot;}}</div></div><div class="LineGroup"><div class="FixedLine">Class of vehicle: class GsonDemo$Truck<span id="ITerm97">
                          
                          
                        </span></div><div class="FixedLine">Vehicle: Make: Ford Model: F150</div></div><div class="LineGroup"><div class="FixedLine">{&quot;key&quot;:&quot;value&quot;}</div></div><div class="LineGroup"><div class="FixedLine">{key=value}</div></div></div></div><p class="Para" id="Par168">Part 1 focuses on the previously discussed <span class="EmphasisFontCategoryNonProportional ">List&lt;String&gt;</span> example. The output shows successful serialization via <span class="EmphasisFontCategoryNonProportional ">toJson()</span>, followed by unsuccessful deserialization via <span class="EmphasisFontCategoryNonProportional ">gson.fromJson(json, weekdays.getClass()</span>), followed by the type stored in the first created <span class="EmphasisFontCategoryNonProportional ">TypeToken</span> instance, followed by successful deserialization with a cast problem, followed by successful deserialization with no cast <span id="ITerm98">problem</span>.</p><p class="Para" id="Par169">Part 2 focuses on the serialization and deserialization of a <span class="EmphasisFontCategoryNonProportional ">Vehicle&lt;Truck&gt;</span> object named <span class="EmphasisFontCategoryNonProportional ">vehicle</span>. This generic object is successfully serialized via a <span class="EmphasisFontCategoryNonProportional ">gson.toJson(vehicle)</span> call. Although you can often pass generic objects to <span class="EmphasisFontCategoryNonProportional ">toJson(Object src)</span> successfully, this method occasionally fails, as I will show. A subsequent call to <span class="EmphasisFontCategoryNonProportional ">gson.fromJson(json, vehicle.getClass())</span> attempts to deserialize the output, but there is a problem: you observe <span class="EmphasisFontCategoryNonProportional ">Vehicle: {make=Ford, model=F150}</span> instead of <span class="EmphasisFontCategoryNonProportional ">Vehicle: Make: Ford Model: F150</span>. Because <span class="EmphasisFontCategoryNonProportional ">Vehicle</span> is specified instead of the full <span class="EmphasisFontCategoryNonProportional ">Vehicle&lt;Truck&gt;</span> generic type, the <span class="EmphasisFontCategoryNonProportional ">vehicle</span> field in the <span class="EmphasisFontCategoryNonProportional ">Vehicle</span> class is assigned <span class="EmphasisFontCategoryNonProportional ">com.google.gson.internal.LinkedTreeMap</span> instead of <span class="EmphasisFontCategoryNonProportional ">Truck</span> as its type.</p><p class="Para" id="Par170">Part 3 attempts to serialize and deserialize a map based on an anonymous subclass of <span class="EmphasisFontCategoryNonProportional ">java.util.HashMap</span>. The first <span class="EmphasisFontCategoryNonProportional ">null</span> value shows that <span class="EmphasisFontCategoryNonProportional ">toJson()</span> wasn鈥檛 successful: <span class="EmphasisFontCategoryNonProportional ">toJson()</span>鈥檚 internal <span class="EmphasisFontCategoryNonProportional ">map.getClass()</span> call returns a <span class="EmphasisFontCategoryNonProportional ">GsonDemo$2</span> reference, which offers no insight into the object to be serialized. The second <span class="EmphasisFontCategoryNonProportional ">null</span> value results from passing <span class="EmphasisFontCategoryNonProportional ">null</span> to <span class="EmphasisFontCategoryNonProportional ">json</span> in <span class="EmphasisFontCategoryNonProportional ">fromJson(</span><span class="ExternalRef"><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true"><span class="RefSource">
                      <span class="EmphasisFontCategoryNonProportional ">String</span>
                    </span></a></span>
<span class="EmphasisFontCategoryNonProportional ">json,</span>
<span class="ExternalRef"><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Class.html?is-external=true"><span class="RefSource">
                      <span class="EmphasisFontCategoryNonProportional ">Class</span>
                    </span></a></span><span class="EmphasisFontCategoryNonProportional ">&lt;T&gt; classOfT)</span><span id="ITerm99">
                    
                    
                  </span>.</p><p class="Para" id="Par171">Part 4 shows how to fix the problems in Parts 2 and 3. This section creates <span class="EmphasisFontCategoryNonProportional ">TypeToken&lt;Vehicle&lt;Truck&gt;&gt;</span> and <span class="EmphasisFontCategoryNonProportional ">TypeToken&lt;Map&lt;String,String&gt;&gt;</span> objects to store the <span class="EmphasisFontCategoryNonProportional ">Vehicle&lt;Truck&gt;</span> and <span class="EmphasisFontCategoryNonProportional ">Map&lt;String, String&gt;</span> parameterized types. These objects are then passed to the <span class="EmphasisFontCategoryNonProportional ">type</span> parameter of the <span class="EmphasisFontCategoryNonProportional ">String toJson(Object src,</span>
<span class="ExternalRef"><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/reflect/Type.html?is-external=true"><span class="RefSource">
                      <span class="EmphasisFontCategoryNonProportional ">Type</span>
                    </span></a></span>
<span class="EmphasisFontCategoryNonProportional ">typeOfSrc)</span> and <span class="EmphasisFontCategoryNonProportional ">&lt;T&gt; T fromJson(</span><span class="ExternalRef"><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true"><span class="RefSource">
                      <span class="EmphasisFontCategoryNonProportional ">String</span>
                    </span></a></span>
<span class="EmphasisFontCategoryNonProportional ">json,</span>
<span class="ExternalRef"><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/reflect/Type.html?is-external=true"><span class="RefSource">
                      <span class="EmphasisFontCategoryNonProportional ">Type</span>
                    </span></a></span>
<span class="EmphasisFontCategoryNonProportional ">typeOfT)</span> methods. (Although <span class="EmphasisFontCategoryNonProportional ">gson.toJson(vehicle, vehicleType)</span> isn鈥檛 necessary because serialization works with <span class="EmphasisFontCategoryNonProportional ">gson.toJson(vehicle)</span>, you should get into the habit of passing a <span class="EmphasisFontCategoryNonProportional ">Type</span> object based on a <span class="EmphasisFontCategoryNonProportional ">TypeToken</span> instance as a second argument, just to be safe.) <span id="ITerm100">
                    
                    
                  </span></p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar7"><h3 class="Heading">Note</h3><p class="Para" id="Par172">Each of <span class="EmphasisFontCategoryNonProportional ">toJson(Object src)</span>, <span class="EmphasisFontCategoryNonProportional ">&lt;T&gt; T fromJson(</span><span class="ExternalRef"><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true"><span class="RefSource">
                        <span class="EmphasisFontCategoryNonProportional ">String</span>
                      </span></a></span>
<span class="EmphasisFontCategoryNonProportional ">json,</span>
<span class="ExternalRef"><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Class.html?is-external=true"><span class="RefSource">
                        <span class="EmphasisFontCategoryNonProportional ">Class</span>
                      </span></a></span><span class="EmphasisFontCategoryNonProportional ">&lt;T&gt; classOfT)</span>, and similar methods works properly when any of the fields of the specified object (<span class="EmphasisFontCategoryNonProportional ">src</span> and object derived from <span class="EmphasisFontCategoryNonProportional ">classOfT</span>) are based on generic types. The only stipulation is that the specified object should not be generic.</p></div></section><section class="Section3 RenderAsSection3" id="Sec16"><h4 class="Heading">Type Adapters</h4><p class="Para" id="Par173">Previously in this chapter, I showed you how to use <span class="EmphasisFontCategoryNonProportional ">JsonSerializer</span><span id="ITerm101">
                    
                    
                  </span> and <span class="EmphasisFontCategoryNonProportional ">JsonDeserializer</span> to (respectively) serialize Java objects to JSON strings and vice versa. These interfaces simplify the translation between Java objects and JSON strings, but add an intermediate layer of processing.</p><p class="Para" id="Par174">The intermediate layer consists of code that converts Java objects and JSON strings to <span class="EmphasisFontCategoryNonProportional ">JsonElement</span>s. This conversion mitigates the risk of parsing or creating invalid JSON strings, but does take time that can impact performance. You can avoid the intermediate layer and create more efficient code by working with the <span class="EmphasisFontCategoryNonProportional ">com.google.gson.TypeAdapter&lt;T&gt;</span> class, where <span class="EmphasisFontCategoryNonProportional ">T</span> identifies the Java class serialization source and deserialization target.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar8"><h3 class="Heading">Note</h3><p class="Para" id="Par175">You should prefer the more efficient <span class="EmphasisFontCategoryNonProportional ">TypeAdapter</span> to the less efficient <span class="EmphasisFontCategoryNonProportional ">JsonSerializer</span> and <span class="EmphasisFontCategoryNonProportional ">JsonDeserializer</span>. In fact, <span class="EmphasisFontCategoryNonProportional ">Gson</span> uses an internal <span class="EmphasisFontCategoryNonProportional ">TypeAdapter</span> implementation to handle conversions between Java objects and JSON strings.</p></div><div class="Para" id="Par176"><span class="EmphasisFontCategoryNonProportional ">TypeAdapter</span> is an abstract class that declares several concrete methods along with the following pair of <span id="ITerm102">abstract methods</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par177"><span class="EmphasisFontCategoryNonProportional ">T read(JsonReader in)</span>: Read a JSON value (array, object, string, number, Boolean, or <span class="EmphasisFontCategoryNonProportional ">null</span>) and convert it to a Java object, which is returned. The return value may be <span class="EmphasisFontCategoryNonProportional ">null</span>.</p></li><li><p class="Para" id="Par178"><span class="EmphasisFontCategoryNonProportional ">void write(JsonWriter out, T value)</span>: Write a JSON value (array, object, string, number, Boolean, or <span class="EmphasisFontCategoryNonProportional ">null</span>), which is passed to <span class="EmphasisFontCategoryNonProportional ">value</span><span id="ITerm103">
                          
                          
                        </span>.</p></li></ul></div></div><p class="Para" id="Par179">Each method throws <span class="EmphasisFontCategoryNonProportional ">java.io.IOException</span> when an I/O problem occurs.</p><div class="Para" id="Par180">The <span class="EmphasisFontCategoryNonProportional ">read()</span> and <span class="EmphasisFontCategoryNonProportional ">write()</span> methods read a sequence of JSON <em class="EmphasisTypeItalic ">tokens</em> and write a sequence of JSON tokens, respectively. For <span class="EmphasisFontCategoryNonProportional ">read()</span>, the source of these tokens is an instance of the concrete <span class="EmphasisFontCategoryNonProportional ">com.google.gson.stream.JsonReader</span> class. For <span class="EmphasisFontCategoryNonProportional ">write()</span>, the destination of these tokens is the concrete <span class="EmphasisFontCategoryNonProportional ">com.google.gson.stream.JsonWriter</span> class. Tokens are described by the <span class="EmphasisFontCategoryNonProportional ">com.google.gson.stream.JsonToken</span> enum (such as <span class="EmphasisFontCategoryNonProportional ">BEGIN_ARRAY</span> for open square bracket). They are read and written by calling <span class="EmphasisFontCategoryNonProportional ">JsonReader</span> and <span class="EmphasisFontCategoryNonProportional ">JsonWriter</span> methods, such as the <span id="ITerm104">following</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par181"><span id="ITerm105">
                          <span class="EmphasisFontCategoryNonProportional ">void beginObject()</span>
                          
                        </span>: This <span class="EmphasisFontCategoryNonProportional ">JsonReader</span> method consumes the next token from the JSON stream and asserts that it鈥檚 the beginning of a new object. A companion <span class="EmphasisFontCategoryNonProportional ">void endObject()</span> method consumes the next token from the JSON stream and asserts that it鈥檚 the end of the current object. Either method throws <span class="EmphasisFontCategoryNonProportional ">IOException</span> when an I/O problem occurs.</p></li><li><p class="Para" id="Par182"><span id="ITerm106">
                          <span class="EmphasisFontCategoryNonProportional ">JsonWriter name</span>
                          
                        </span><span class="EmphasisFontCategoryNonProportional ">(String name)</span>: This <span class="EmphasisFontCategoryNonProportional ">JsonWriter</span> method encodes the property name, which cannot be <span class="EmphasisFontCategoryNonProportional ">null</span>. <span class="EmphasisFontCategoryNonProportional ">IOException</span> is thrown when an I/O problem occurs.</p></li></ul></div></div><p class="Para" id="Par183">After creating a <span class="EmphasisFontCategoryNonProportional ">TypeAdapter</span> subclass, you instantiate it and register the instance with <span class="EmphasisFontCategoryNonProportional ">Gson</span> by calling the <span class="EmphasisFontCategoryNonProportional ">GsonBuilder registerTypeAdapter(Type type, Object typeAdapter)</span> method, which I previously presented. The object that鈥檚 passed to <span class="EmphasisFontCategoryNonProportional ">type</span> represents the class whose objects are serialized or deserialized. The object that鈥檚 passed to <span class="EmphasisFontCategoryNonProportional ">typeAdapter</span> is the type adapter <span id="ITerm107">instance</span>.</p><div class="Para" id="Par184">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC62">9-14</a></span> presents the source code to an application that demonstrates a type adapter.<div class="ProgramCode" id="PC62"><div class="LineGroup"><div class="FixedLine">import java.io.IOException;</div></div><div class="LineGroup"><div class="FixedLine">import java.util.ArrayList;</div><div class="FixedLine">import java.util.List;</div></div><div class="LineGroup"><div class="FixedLine">import com.google.gson.Gson;</div><div class="FixedLine">import com.google.gson.GsonBuilder;</div><div class="FixedLine">import com.google.gson.TypeAdapter;</div></div><div class="LineGroup"><div class="FixedLine">import com.google.gson.stream.JsonReader;</div><div class="FixedLine">import com.google.gson.stream.JsonWriter;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class GsonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   static</div><div class="FixedLine">   class Country</div><div class="FixedLine">   {</div><div class="FixedLine">      String name;</div><div class="FixedLine">      int population; <span id="ITerm108">
                          
                          
                        </span></div><div class="FixedLine">      String[] cities;</div></div><div class="LineGroup"><div class="FixedLine">      Country() {}</div></div><div class="LineGroup"><div class="FixedLine">      Country(String name, int population, String... cities)</div><div class="FixedLine">      {</div><div class="FixedLine">         this.name = name;</div><div class="FixedLine">         this.population = population;</div><div class="FixedLine">         this.cities = cities;</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      class CountryAdapter extends TypeAdapter&lt;Country&gt;</div><div class="FixedLine">      {</div><div class="FixedLine">         @Override</div><div class="FixedLine">         public Country read(JsonReader in)</div><div class="FixedLine">            throws IOException</div><div class="FixedLine">         {</div><div class="FixedLine">            Country c = new Country();</div><div class="FixedLine">            List&lt;String&gt; cities = new ArrayList&lt;&gt;();</div><div class="FixedLine">            in.beginObject();</div><div class="FixedLine">            while (in.hasNext())</div><div class="FixedLine">               switch (in.nextName())</div><div class="FixedLine">               {</div><div class="FixedLine">                  case &quot;name&quot;:</div><div class="FixedLine">                     c.name = in.nextString();</div><div class="FixedLine">                              break;</div></div><div class="LineGroup"><div class="FixedLine">                  case &quot;population&quot;:</div><div class="FixedLine">                     c.population = in.nextInt();</div><div class="FixedLine">                     break;</div></div><div class="LineGroup"><div class="FixedLine">                  case &quot;cities&quot;:</div><div class="FixedLine">                     in.beginArray();</div><div class="FixedLine">                     while (in.hasNext())</div><div class="FixedLine">                        cities.add(in.nextString());</div><div class="FixedLine">                     in.endArray();</div><div class="FixedLine">                     c.cities = <span id="ITerm109">
                          
                          
                        </span></div><div class="FixedLine">                        cities.toArray(new String[0]);</div><div class="FixedLine">               }</div><div class="FixedLine">            in.endObject();</div><div class="FixedLine">            return c;</div><div class="FixedLine">         }</div></div><div class="LineGroup"><div class="FixedLine">         @Override</div><div class="FixedLine">         public void write(JsonWriter out, Country c)</div><div class="FixedLine">            throws IOException</div><div class="FixedLine">         {</div><div class="FixedLine">            out.beginObject();</div><div class="FixedLine">            out.name(&quot;name&quot;).value(c.name);</div><div class="FixedLine">            out.name(&quot;population&quot;).value(c.population);</div><div class="FixedLine">            out.name(&quot;cities&quot;);</div><div class="FixedLine">            out.beginArray();</div><div class="FixedLine">            for (int i = 0; i &lt; c.cities.length; i++)</div><div class="FixedLine">               out.value(c.cities[i]);</div><div class="FixedLine">            out.endArray();</div><div class="FixedLine">            out.endObject();</div><div class="FixedLine">         }</div><div class="FixedLine">      }</div><div class="FixedLine">      Gson gson =</div><div class="FixedLine">         new GsonBuilder().</div><div class="FixedLine">             registerTypeAdapter(Country.class,</div><div class="FixedLine">                                 new CountryAdapter()).</div><div class="FixedLine">             create();</div></div><div class="LineGroup"><div class="FixedLine">      Country c =</div><div class="FixedLine">         new Country(&quot;England&quot;, 53012456 /* 2011 census */,</div><div class="FixedLine">                     &quot;London&quot;, &quot;Birmingham&quot;, &quot;Cambridge&quot;);</div><div class="FixedLine">      String json = gson.toJson(c);</div><div class="FixedLine">      out.println(json);</div><div class="FixedLine">      c = gson.fromJson(json, c.getClass());</div><div class="FixedLine">      out.printf(&quot;Name = %s%n&quot;, c.name);</div><div class="FixedLine">      out.printf(&quot;Population = %d%n&quot;, c.population);</div><div class="FixedLine">      out.print(&quot;Cities = &quot;);</div><div class="FixedLine">      for (String city: c.cities)</div><div class="FixedLine">         out.print(city + &quot; &quot;);</div><div class="FixedLine">      out.println()<span id="ITerm110">
                          
                          
                        </span>;</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 9-14</span><p class="SimplePara">Serializing and Deserializing a <span class="EmphasisFontCategoryNonProportional ">Country</span> Object via a Type <span id="ITerm111">Adapter</span></p></div></div></div></div><p class="Para" id="Par185">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC62">9-14</a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">GsonDemo</span> class nests a <span class="EmphasisFontCategoryNonProportional ">Country</span> class (which describes a country as a name, a population count, and an array of city names) and also presents a <span class="EmphasisFontCategoryNonProportional ">main()</span> entry-point method.</p><p class="Para" id="Par186">The <span class="EmphasisFontCategoryNonProportional ">main()</span> method first declares a local <span class="EmphasisFontCategoryNonProportional ">CountryAdapter</span> class that extends <span class="EmphasisFontCategoryNonProportional ">TypeAdapter&lt;Country&gt;</span>. <span class="EmphasisFontCategoryNonProportional ">CountryAdapter</span> overrides the <span class="EmphasisFontCategoryNonProportional ">read()</span> and <span class="EmphasisFontCategoryNonProportional ">write()</span> methods to handle the serialization and deserialization tasks.</p><p class="Para" id="Par187">The <span class="EmphasisFontCategoryNonProportional ">read()</span> method first creates a new <span class="EmphasisFontCategoryNonProportional ">Country</span> object, which will store the values being read from the JSON object being deserialized (and accessed from the <span class="EmphasisFontCategoryNonProportional ">JsonReader</span> argument).</p><p class="Para" id="Par188">After creating a list to store the array of city names that it will be reading, <span class="EmphasisFontCategoryNonProportional ">read()</span> calls <span class="EmphasisFontCategoryNonProportional ">beginObject()</span> to assert that the next token read from the token stream is the beginning of a JSON object.</p><p class="Para" id="Par189">At this point, <span class="EmphasisFontCategoryNonProportional ">read()</span> enters a <span class="EmphasisFontCategoryNonProportional ">while</span> loop. This loop continues while <span class="EmphasisFontCategoryNonProportional ">JsonReader</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">boolean hasNext()</span> method returns <span class="EmphasisFontCategoryNonProportional ">true</span>: there is another object <span id="ITerm112">element</span>.</p><p class="Para" id="Par190">Each <span class="EmphasisFontCategoryNonProportional ">while</span> loop iteration executes a <span class="EmphasisFontCategoryNonProportional ">switch</span> statement that calls <span class="EmphasisFontCategoryNonProportional ">JsonReader</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">String nextName()</span> method to return the next token, which is a property name in the JSON object. It then compares the token to the three possibilities, <span class="EmphasisFontCategoryNonProportional ">name</span>, <span class="EmphasisFontCategoryNonProportional ">population</span>, or <span class="EmphasisFontCategoryNonProportional ">cities</span>, and executes the associated code to retrieve the property value and assign the value to the appropriate field in the previously created <span class="EmphasisFontCategoryNonProportional ">Country</span> object.</p><p class="Para" id="Par191">If the property is <span class="EmphasisFontCategoryNonProportional ">name</span>, <span class="EmphasisFontCategoryNonProportional ">JsonReader</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">String nextString()</span> method is called to return the string value of the next token. If the property is population, <span class="EmphasisFontCategoryNonProportional ">JsonReader</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">int nextInt()</span> method is called to return the token鈥檚 <span class="EmphasisFontCategoryNonProportional ">int</span> value.</p><div class="Para" id="Par192">Processing the <span class="EmphasisFontCategoryNonProportional ">cities</span> property is more involved because its value is an <span id="ITerm113">array</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par193"><span class="EmphasisFontCategoryNonProportional ">JsonReader</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">void beginArray()</span> method<span id="ITerm114">
                          
                        </span> is called to signify that a new array has been detected and to consume the open square bracket token.</p></li><li><p class="Para" id="Par194">A <span class="EmphasisFontCategoryNonProportional ">while</span> loop is entered to repeatedly obtain the next array string value and add it to the previously created <span class="EmphasisFontCategoryNonProportional ">cities</span> list.</p></li><li><p class="Para" id="Par195"><span class="EmphasisFontCategoryNonProportional ">JsonReader</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">void endArray()</span> method<span id="ITerm115">
                          
                        </span> is called to signify the end of the current array and to consume the close square bracket token.</p></li><li><p class="Para" id="Par196">The <span class="EmphasisFontCategoryNonProportional ">cities</span> list is converted to a Java array, which is assigned to the <span class="EmphasisFontCategoryNonProportional ">Country</span> object鈥檚 <span class="EmphasisFontCategoryNonProportional ">cities</span> member<span id="ITerm116">
                          
                          
                        </span>.</p></li></ul></div></div><p class="Para" id="Par197">After the outer <span class="EmphasisFontCategoryNonProportional ">while</span> loop ends, <span class="EmphasisFontCategoryNonProportional ">read()</span> calls <span class="EmphasisFontCategoryNonProportional ">endObject()</span> to assert that the next token read from the token stream is the end of the current JSON object, and then returns the <span class="EmphasisFontCategoryNonProportional ">Country</span> object.</p><p class="Para" id="Par198">The <span class="EmphasisFontCategoryNonProportional ">write()</span> method is somewhat similar to <span class="EmphasisFontCategoryNonProportional ">read()</span>. It calls <span class="EmphasisFontCategoryNonProportional ">JsonWriter</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">JsonWriter name(String name)</span> method to encode the property name specified by <span class="EmphasisFontCategoryNonProportional ">name</span> to a JSON property name. Also, it calls <span class="EmphasisFontCategoryNonProportional ">JsonWriter</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">JsonWriter value(long value)</span> and <span class="EmphasisFontCategoryNonProportional ">JsonWriter value(String value)</span> methods to encode <span class="EmphasisFontCategoryNonProportional ">value</span> as a JSON number or a JSON string.</p><p class="Para" id="Par199">The <span class="EmphasisFontCategoryNonProportional ">main()</span> method proceeds to create a <span class="EmphasisFontCategoryNonProportional ">Gson</span> object from a <span class="EmphasisFontCategoryNonProportional ">GsonBuilder</span> object, which executes <span class="EmphasisFontCategoryNonProportional ">registerTypeAdapter(Country.class, new CountryAdapter())</span> to instantiate and register <span class="EmphasisFontCategoryNonProportional ">CountryAdapter</span> with the <span class="EmphasisFontCategoryNonProportional ">Gson</span> object that will be returned. <span class="EmphasisFontCategoryNonProportional ">Country.class</span> indicates that <span class="EmphasisFontCategoryNonProportional ">Country</span> objects will be serialized and deserialized.</p><p class="Para" id="Par200">Finally, a <span class="EmphasisFontCategoryNonProportional ">Country</span> object is created, serialized to a string, and deserialized to a new <span class="EmphasisFontCategoryNonProportional ">Country</span> object.</p><div class="Para" id="Par201">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC62">9-14</a></span> and run the resulting application. You should observe the following output:<div class="ProgramCode" id="PC63"><div class="LineGroup"><div class="FixedLine">{&quot;name&quot;:&quot;England&quot;,&quot;population&quot;:53012456,&quot;cities&quot;:[&quot;London&quot;,&quot;Birmingham&quot;,&quot;Cambridge&quot;]}</div><div class="FixedLine">Name = England</div><div class="FixedLine">Population = 53012456</div><div class="FixedLine">Cities = London Birmingham Cambridge</div></div></div></div><section class="Section4 RenderAsSection4" id="Sec17"><h5 class="Heading">Conveniently Associating Type Adapters with Classes and Fields</h5><p class="Para" id="Par202">The <span class="EmphasisFontCategoryNonProportional ">JsonAdapter</span> annotation <span id="ITerm117">type</span> is used with a <span class="EmphasisFontCategoryNonProportional ">TypeAdapter Class</span> object argument to associate the <span class="EmphasisFontCategoryNonProportional ">TypeAdapter</span> instance to use with a class or field. After doing so, you don鈥檛 need to register the <span class="EmphasisFontCategoryNonProportional ">TypeAdapter</span> with <span class="EmphasisFontCategoryNonProportional ">Gson</span>, which makes for a bit less coding.</p><div class="Para" id="Par203">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC64">9-15</a></span> refactors Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC62">9-14</a></span> to demonstrate <span class="EmphasisFontCategoryNonProportional ">JsonAdapter</span>.<div class="ProgramCode" id="PC64"><div class="LineGroup"><div class="FixedLine">import java.io.IOException;</div></div><div class="LineGroup"><div class="FixedLine">import java.util.ArrayList;</div><div class="FixedLine">import java.util.List;</div></div><div class="LineGroup"><div class="FixedLine">import com.google.gson.Gson;</div><div class="FixedLine">import com.google.gson.TypeAdapter;</div></div><div class="LineGroup"><div class="FixedLine">import com.google.gson.annotations.JsonAdapter;</div></div><div class="LineGroup"><div class="FixedLine">import com.google.gson.stream.JsonReader;</div><div class="FixedLine">import com.google.gson.stream.JsonWriter;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class GsonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   <strong class="EmphasisTypeBold ">@JsonAdapter(CountryAdapter.class)</strong></div><div class="FixedLine">   static</div><div class="FixedLine">   class Country</div><div class="FixedLine">   {</div><div class="FixedLine">      String name;</div><div class="FixedLine">      int population;</div><div class="FixedLine">      String[] cities;</div></div><div class="LineGroup"><div class="FixedLine">      Country() {}</div></div><div class="LineGroup"><div class="FixedLine">      Country(String name, int population, String... cities)</div><div class="FixedLine">      {</div><div class="FixedLine">         this.name = name;</div><div class="FixedLine">         this.population = population;</div><div class="FixedLine">         this.cities = cities;</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   static</div><div class="FixedLine">   class CountryAdapter extends TypeAdapter&lt;Country&gt;</div><div class="FixedLine">   {</div><div class="FixedLine">      @Override</div><div class="FixedLine">      public Country read(JsonReader in) throws IOException</div><div class="FixedLine">      {</div><div class="FixedLine">         out.println(&quot;read() called&quot;);</div><div class="FixedLine">         Country c = new Country();</div><div class="FixedLine">         List&lt;String&gt; cities = new ArrayList&lt;&gt;();</div><div class="FixedLine">         in.beginObject();</div><div class="FixedLine">         while (in.hasNext())</div><div class="FixedLine">            switch (in.nextName())</div><div class="FixedLine">            {</div><div class="FixedLine">               case &quot;name&quot;:</div><div class="FixedLine">                  c.name = in.nextString();</div><div class="FixedLine">                           break;</div></div><div class="LineGroup"><div class="FixedLine">               case &quot;population&quot;:</div><div class="FixedLine">                  c.population = in.nextInt()<span id="ITerm118">
                            
                            
                          </span>;</div><div class="FixedLine">                  break;</div></div><div class="LineGroup"><div class="FixedLine">               case &quot;cities&quot;:</div><div class="FixedLine">                  in.beginArray();</div><div class="FixedLine">                  while (in.hasNext())</div><div class="FixedLine">                     cities.add(in.nextString());</div><div class="FixedLine">                  in.endArray();</div><div class="FixedLine">                  c.cities = cities.toArray(new String[0]) <span id="ITerm119">
                            
                            
                          </span>;</div><div class="FixedLine">            }</div><div class="FixedLine">         in.endObject();</div><div class="FixedLine">         return c;</div><div class="FixedLine">      }</div></div><div class="LineGroup"><div class="FixedLine">      @Override</div><div class="FixedLine">      public void write(JsonWriter out, Country c)</div><div class="FixedLine">         throws IOException</div><div class="FixedLine">      {</div><div class="FixedLine">         System.out.println(&quot;write() called&quot;);</div><div class="FixedLine">         out.beginObject();</div><div class="FixedLine">         out.name(&quot;name&quot;).value(c.name);</div><div class="FixedLine">         out.name(&quot;population&quot;).value(c.population);</div><div class="FixedLine">         out.name(&quot;cities&quot;);</div><div class="FixedLine">         out.beginArray();</div><div class="FixedLine">         for (int i = 0; i &lt; c.cities.length; i++)</div><div class="FixedLine">            out.value(c.cities[i]);</div><div class="FixedLine">         out.endArray();</div><div class="FixedLine">         out.endObject();</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public static void main(String[] args) <span id="ITerm120">
                            
                            
                          </span></div><div class="FixedLine">   {</div><div class="FixedLine">      <strong class="EmphasisTypeBold ">Gson gson = new Gson();</strong></div><div class="FixedLine">      Country c =</div><div class="FixedLine">         new Country(&quot;England&quot;, 53012456 /* 2011 census */,</div><div class="FixedLine">                     &quot;London&quot;, &quot;Birmingham&quot;, &quot;Cambridge&quot;);</div><div class="FixedLine">      String json = gson.toJson(c);</div><div class="FixedLine">      out.println(json);</div><div class="FixedLine">      c = gson.fromJson(json, c.getClass());</div><div class="FixedLine">      out.printf(&quot;Name = %s%n&quot;, c.name);</div><div class="FixedLine">      out.printf(&quot;Population = %d%n&quot;, c.population);</div><div class="FixedLine">      out.print(&quot;Cities = &quot;);</div><div class="FixedLine">      for (String city: c.cities)</div><div class="FixedLine">         out.print(city + &quot; &quot;);<span id="ITerm121">
                            
                            
                          </span></div><div class="FixedLine">      out.println();</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 9-15</span><p class="SimplePara">Serializing and Deserializing a <span class="EmphasisFontCategoryNonProportional ">Country</span> Object Annotated with a Type <span id="ITerm122">Adapter</span></p></div></div></div></div><p class="Para" id="Par204">In Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC64">9-15</a></span>, I鈥檝e bolded the two essential differences from Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC62">9-14</a></span>: the <span class="EmphasisFontCategoryNonProportional ">Country</span> type adapter class is annotated <span class="EmphasisFontCategoryNonProportional ">@JsonAdapter(CountryAdapter.class)</span>, and <span class="EmphasisFontCategoryNonProportional ">Gson gson = new Gson();</span> is specified instead of using a <span class="EmphasisFontCategoryNonProportional ">GsonBuilder</span> object and its <span class="EmphasisFontCategoryNonProportional ">create()</span> method.</p><div class="Para" id="Par205">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC64">9-15</a></span> and run the resulting application. You should observe the following output: <span id="ITerm123">
                      
                      
                    </span><div class="ProgramCode" id="PC65"><div class="LineGroup"><div class="FixedLine">write() called</div><div class="FixedLine">{&quot;name&quot;:&quot;England&quot;,&quot;population&quot;:53012456,&quot;cities&quot;:[&quot;London&quot;,&quot;Birmingham&quot;,&quot;Cambridge&quot;]}</div><div class="FixedLine">read() called</div><div class="FixedLine">Name = England</div><div class="FixedLine">Population = 53012456</div><div class="FixedLine">Cities = London Birmingham Cambridge</div></div></div></div><p class="Para" id="Par206">The <span class="EmphasisFontCategoryNonProportional ">read() called</span> and <span class="EmphasisFontCategoryNonProportional ">write() called</span> output lines prove that <span class="EmphasisFontCategoryNonProportional ">Gson</span> uses the custom type adapter instead of its internal type <span id="ITerm124">adapter</span>.</p><div class="FormalPara FormalParaRenderingStyle3 ParaTypeOverview" id="FPar9"><h3 class="Heading">Exercises</h3><div class="Para" id="Par207">The following exercises are designed to test your understanding of Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml"><span class="RefSource">9</span></a></span>鈥檚 content:<div class="OrderedList"><ol><li class="ListItem"><span class="ItemNumber">1.</span><div class="ItemContent"><p class="Para" id="Par208">Define Gson.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">2.</span><div class="ItemContent"><p class="Para" id="Par209">Identify and describe Gson鈥檚 packages.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">3.</span><div class="ItemContent"><p class="Para" id="Par210">What are the two ways to obtain a <span class="EmphasisFontCategoryNonProportional ">Gson</span> object?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">4.</span><div class="ItemContent"><p class="Para" id="Par211">Identify the types for which <span class="EmphasisFontCategoryNonProportional ">Gson</span> provides default serialization and deserialization.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">5.</span><div class="ItemContent"><p class="Para" id="Par212">How would you enable pretty-printing?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">6.</span><div class="ItemContent"><p class="Para" id="Par213">True or false: By default, <span class="EmphasisFontCategoryNonProportional ">Gson</span> excludes <span class="EmphasisFontCategoryNonProportional ">transient</span> or <span class="EmphasisFontCategoryNonProportional ">static</span> fields from consideration for serialization and deserialization.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">7.</span><div class="ItemContent"><p class="Para" id="Par214">Once you have a <span class="EmphasisFontCategoryNonProportional ">Gson</span> object, what methods can you call to convert between JSON and Java objects?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">8.</span><div class="ItemContent"><p class="Para" id="Par215">How do you use Gson to customize JSON object parsing?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">9.</span><div class="ItemContent"><p class="Para" id="Par216">Describe the <span class="EmphasisFontCategoryNonProportional ">JsonElement</span> class.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">10.</span><div class="ItemContent"><p class="Para" id="Par217">Identify the <span class="EmphasisFontCategoryNonProportional ">JsonElement</span> subclasses.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">11.</span><div class="ItemContent"><p class="Para" id="Par218">What <span class="EmphasisFontCategoryNonProportional ">GsonBuilder</span> method do you call to register a serializer or deserializer with a <span class="EmphasisFontCategoryNonProportional ">Gson</span> object?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">12.</span><div class="ItemContent"><p class="Para" id="Par219">What method does <span class="EmphasisFontCategoryNonProportional ">JsonSerializer</span> provide to serialize a Java object to a JSON object?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">13.</span><div class="ItemContent"><p class="Para" id="Par220">What annotation types does Gson provide to simplify serialization and deserialization?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">14.</span><div class="ItemContent"><p class="Para" id="Par221">True or false: To use <span class="EmphasisFontCategoryNonProportional ">Expose</span>, it鈥檚 enough to annotate a field, as in <span class="EmphasisFontCategoryNonProportional ">@Expose(serialize = true, deserialize = false)</span>.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">15.</span><div class="ItemContent"><p class="Para" id="Par222">What do <span class="EmphasisFontCategoryNonProportional ">JsonSerializationContext</span> and <span class="EmphasisFontCategoryNonProportional ">JsonDeserializationContext</span> provide?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">16.</span><div class="ItemContent"><p class="Para" id="Par223">True or false: You can call <span class="EmphasisFontCategoryNonProportional ">&lt;T&gt; T fromJson(</span><span class="ExternalRef"><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true"><span class="RefSource">
                                  <span class="EmphasisFontCategoryNonProportional ">String</span>
                                </span></a></span>
<span class="EmphasisFontCategoryNonProportional ">json,</span>
<span class="ExternalRef"><a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Class.html?is-external=true"><span class="RefSource">
                                  <span class="EmphasisFontCategoryNonProportional ">Class</span>
                                </span></a></span><span class="EmphasisFontCategoryNonProportional ">&lt;T&gt; classOfT)</span> to deserialize any kind of object.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">17.</span><div class="ItemContent"><p class="Para" id="Par224">Why should you prefer <span class="EmphasisFontCategoryNonProportional ">TypeAdapter</span> to <span class="EmphasisFontCategoryNonProportional ">JsonSerializer</span> and <span class="EmphasisFontCategoryNonProportional ">JsonDeserializer</span>?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">18.</span><div class="ItemContent"><p class="Para" id="Par225">Modify Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml#PC38">9-9</a></span> so that the <span class="EmphasisFontCategoryNonProportional ">static</span> field named <span class="EmphasisFontCategoryNonProportional ">field5</span> is also serialized and deserialized.</p></div><div class="ClearBoth"> </div></li></ol></div></div></div></section></section></section></section><section class="Section1 RenderAsSection1" id="Sec18"><h2 class="Heading">Summary</h2><p class="Para" id="Par226">Gson is a small Java-based library for parsing and creating JSON objects. Google developed Gson for its own projects, but later made Gson publicly available, starting with version 1.0.</p><p class="Para" id="Par227">Gson parses JSON objects by deserializing JSON objects into Java objects. Similarly, it creates JSON objects by serializing Java objects into JSON objects. Gson relies on Java鈥檚 Reflection API to assist with these tasks.</p><p class="Para" id="Par228">Gson consists of more than 30 classes and interfaces distributed among four packages: <span class="EmphasisFontCategoryNonProportional ">com.google.gson</span> (provides access to <span class="EmphasisFontCategoryNonProportional ">Gson</span>, the main class), <span class="EmphasisFontCategoryNonProportional ">com.google.gson.annotations</span> (provides annotation types for use with Gson), <span class="EmphasisFontCategoryNonProportional ">com.google.gson.reflect</span> (provides a utility class for obtaining type information from a generic type), and <span class="EmphasisFontCategoryNonProportional ">com.google.gson.stream</span> (provides utility classes for reading and writing JSON-encoded values).</p><p class="Para" id="Par229">The <span class="EmphasisFontCategoryNonProportional ">Gson</span> class handles the conversion between JSON and Java objects. You can instantiate this class by using the <span class="EmphasisFontCategoryNonProportional ">Gson()</span> constructor, or you can obtain a <span class="EmphasisFontCategoryNonProportional ">Gson</span> instance by working with the <span class="EmphasisFontCategoryNonProportional ">GsonBuilder</span> class.</p><p class="Para" id="Par230">Once you have a <span class="EmphasisFontCategoryNonProportional ">Gson</span> object, you can call various <span class="EmphasisFontCategoryNonProportional ">fromJson()</span> and <span class="EmphasisFontCategoryNonProportional ">toJson()</span> methods to convert between JSON and Java objects. These methods rely on Gson鈥檚 default deserialization and serialization mechanisms, respectively, but you can customize deserialization and serialization by working with the <span class="EmphasisFontCategoryNonProportional ">JsonDeserializer&lt;T&gt;</span> and <span class="EmphasisFontCategoryNonProportional ">JsonSerializer&lt;T&gt;</span> interfaces.</p><p class="Para" id="Par231">Gson offers additional useful features, including annotation types (<span class="EmphasisFontCategoryNonProportional ">Expose</span>, <span class="EmphasisFontCategoryNonProportional ">JsonAdapter</span>, <span class="EmphasisFontCategoryNonProportional ">SerializedName</span>, <span class="EmphasisFontCategoryNonProportional ">Since</span>, and <span class="EmphasisFontCategoryNonProportional ">Until</span>) for simplifying serialization and deserialization, contexts for automating the serialization of nested objects and arrays, support for generics, and type adapters.</p><p class="Para" id="Par232">Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_10_Chapter.xhtml"><span class="RefSource">10</span></a></span> introduces JsonPath for extracting JSON values.</p></section></div><div class="annotator-outer annotator-viewer viewer annotator-hide"> </div></div></div>
    </section>
  </div>
</div>
<div class="font-flyout" style="top: 201.003px; left: 2474px;"> </div>
<hr/>

<!--if IE]><![endif]--><!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/java-xml-and/9781484243305/html/394211_2_En_10_Chapter.xhtml"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="3866890"
  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"
  data-username="levinxccai"
  data-account-type="B2B"
  
  data-activated-trial-date="11/06/2017"


  data-archive="9781484243305"
  data-publishers="Apress"



  data-htmlfile-name="394211_2_En_10_Chapter.xhtml"
  data-epub-title="Java XML and JSON: Document Processing for Java SE" data-debug=0 data-testing=0><![endif]--><!--if gt IE 8]><!--><!--![endif]-->



<a name="12_"></a>

<div class="application" id="container" style="height: auto;">
  <div class="js-toc">
    <section role="document">
      <div id="sbo-rt-content" style="max-width:72.5em; transform: none;"><div class="annotator-wrapper"><!--egin Abstract--><div class="MainTitleSection"><h1 class="ChapterTitle" lang="en">10. Extracting JSON Values with JsonPath</h1></div><div class="AuthorGroup"><div class="AuthorNames"><span class="Author"><span class="AuthorName">Jeff Friesen</span><sup><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_10_Chapter.xhtml#Aff2">1</a> <span class="ContactIcon"></span></sup></span></div><div class="Affiliations"><div class="Affiliation" id="Aff2"><span class="AffiliationNumber">(1)</span><div class="AffiliationText">Dauphin, MB, Canada</div></div><div class="ClearBoth"> </div></div></div><!--nd Abstract--><div class="Fulltext"><p class="Para" id="Par2">XPath is used to extract values from XML documents. JsonPath performs this task for JSON documents. Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_10_Chapter.xhtml"><span class="RefSource">10</span></a></span> introduces you to JsonPath.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar1"><h3 class="Heading">Note</h3><p class="Para" id="Par3">If you鈥檙e unfamiliar with XPath, I recommend that you read Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_5_Chapter.xhtml"><span class="RefSource">5</span></a></span> before reading this chapter. JsonPath was derived from XPath.</p></div><section class="Section1 RenderAsSection1" id="Sec1"><h2 class="Heading">What Is JsonPath?</h2><p class="Para" id="Par4"><em class="EmphasisTypeItalic ">JsonPath</em> is a declarative query <span id="ITerm1">language</span> (also known as a path-expression-syntax) for selecting and extracting a JSON document鈥檚 property <span id="ITerm2">values</span>. For example, you can use JsonPath to locate <span class="EmphasisFontCategoryNonProportional ">John</span> in <span class="EmphasisFontCategoryNonProportional ">{&quot;firstName&quot;: &quot;John&quot;}</span> and return this value. JsonPath is based on XPath 1.0.</p><p class="Para" id="Par5">JsonPath was created by Stefan Goessner (<span class="ExternalRef"><a href="http://goessner.net/"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional ">http://goessner.net</span>
                </span></a></span>). Goessner also created JavaScript-based and PHP-based implementations of JsonPath. For complete documentation, check out Goessner鈥檚 website (<span class="ExternalRef"><a href="http://goessner.net/articles/JsonPath/index.html"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional ">http://goessner.net/articles/JsonPath/index.html</span>
                </span></a></span>).</p><p class="Para" id="Par6">Swedish software company Jayway (<span class="ExternalRef"><a href="http://www.jayway.com/"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional ">www.jayway.com</span>
                </span></a></span>) subsequently adapted JsonPath to Java. Their Java version of JsonPath is the focus of this chapter. You will find complete documentation on Jayway鈥檚 implementation of JsonPath at <span class="ExternalRef"><a href="http://github.com/jayway/JsonPath"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional ">http://github.com/jayway/JsonPath</span>
                </span></a></span>.</p></section><section class="Section1 RenderAsSection1" id="Sec2"><h2 class="Heading">Learning the JsonPath Language</h2><p class="Para" id="Par7">JsonPath is a simple language with various <span id="ITerm3">features</span> that are similar to their <span id="ITerm4">XPath counterparts</span>. This language is used to construct path expressions.</p><div class="Para" id="Par8">A JsonPath expression begins with the dollar sign (<span class="EmphasisFontCategoryNonProportional ">$</span>) character, which refers to the root element of a query. The dollar sign is followed by a sequence of child elements, which are separated via dot (<span class="EmphasisFontCategoryNonProportional ">.</span>) notation or via square bracket (<span class="EmphasisFontCategoryNonProportional ">[]</span>) notation. For example, consider the following JSON object:<div class="ProgramCode" id="PC1"><div class="LineGroup"><div class="FixedLine">{</div><div class="FixedLine">   &quot;firstName&quot;: &quot;John&quot;,</div><div class="FixedLine">   &quot;lastName&quot;: &quot;Smith&quot;,</div><div class="FixedLine">   &quot;age&quot;: 25,</div><div class="FixedLine">   &quot;address&quot;:</div><div class="FixedLine">   {</div><div class="FixedLine">      &quot;streetAddress&quot;: &quot;21 2nd Street&quot;,</div><div class="FixedLine">      &quot;city&quot;: &quot;New York&quot;,</div><div class="FixedLine">      &quot;state&quot;: &quot;NY&quot;,</div><div class="FixedLine">      &quot;postalCode&quot;: &quot;10021-3100&quot;</div><div class="FixedLine">   },</div><div class="FixedLine">   &quot;phoneNumbers&quot;:</div><div class="FixedLine">   [</div><div class="FixedLine">      {</div><div class="FixedLine">         &quot;type&quot;: &quot;home&quot;,</div><div class="FixedLine">         &quot;number&quot;: &quot;212 555-1234&quot;</div><div class="FixedLine">      },</div><div class="FixedLine">      {</div><div class="FixedLine">         &quot;type&quot;: &quot;office&quot;,</div><div class="FixedLine">         &quot;number&quot;: &quot;646 555-4567&quot;</div><div class="FixedLine">      }</div><div class="FixedLine">   ]</div><div class="FixedLine">}</div></div></div></div><div class="Para" id="Par9">The following dot notation-based JsonPath expression extracts, from the previous anonymous JSON object, the phone number (<span class="EmphasisFontCategoryNonProportional ">212 555-1234</span>) that鈥檚 assigned to the <span class="EmphasisFontCategoryNonProportional ">number</span> field in the anonymous JSON object, which is assigned to the first element in the <span class="EmphasisFontCategoryNonProportional ">phoneNumbers</span> array:<div class="ProgramCode" id="PC2"><div class="LineGroup"><div class="FixedLine">$.phoneNumbers[0].number</div></div></div></div><p class="Para" id="Par10">The <span class="EmphasisFontCategoryNonProportional ">$</span> character represents the anonymous root JSON object. The leftmost dot character separates the object root from the <span class="EmphasisFontCategoryNonProportional ">phoneNumbers</span> property name. The <span class="EmphasisFontCategoryNonProportional ">[0]</span> syntax identifies the first element in the array assigned to <span class="EmphasisFontCategoryNonProportional ">phoneNumbers</span>.</p><p class="Para" id="Par11">The first array element stores an anonymous object consisting of <span class="EmphasisFontCategoryNonProportional ">type&quot;: &quot;home</span> and <span class="EmphasisFontCategoryNonProportional ">number&quot;: &quot;212 555-1234</span> properties. The rightmost dot character accesses this object鈥檚 <span class="EmphasisFontCategoryNonProportional ">number</span> child property name, which is assigned the value <span class="EmphasisFontCategoryNonProportional ">212 555-1234</span>. This value is returned from the expression.</p><div class="Para" id="Par12">Alternatively, I could specify the following square bracket notation to extract the same phone number:<div class="ProgramCode" id="PC3"><div class="LineGroup"><div class="FixedLine">$[&apos;phoneNumbers&apos;][0][&apos;number&apos;]</div></div></div></div><div class="Para" id="Par13">The Jayway documentation identifies <span class="EmphasisFontCategoryNonProportional ">$</span> as an operator and also identifies several other basic operators. Table <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_10_Chapter.xhtml#Tab1">10-1</a></span> describes these operators.<div class="Table" id="Tab1"><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Table 10-1</span><p class="SimplePara">JsonPath Basic <span id="ITerm5">Operators</span></p></div></div><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="tcol1 align-left"><col class="tcol2 align-left"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Operator</p></th><th style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Description</p></th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional ">$</span>
                        </p></td><td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">The root element to query. This operator starts all path expressions. It鈥檚 equivalent to XPath鈥檚 / symbol.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional ">@</span>
                        </p></td><td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">The current node being processed by a filter predicate. It鈥檚 equivalent to XPath鈥檚 <span class="EmphasisFontCategoryNonProportional ">.</span> symbol.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional ">*</span>
                        </p></td><td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Wildcard. Available anywhere a name or numeric value is required.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional ">..</span>
                        </p></td><td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Deep scan (also known as recursive descent). Available anywhere a name is required. It鈥檚 equivalent to XPath鈥檚 <span class="EmphasisFontCategoryNonProportional ">//</span> symbol.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional ">.</span>
                          <em class="EmphasisTypeItalic ">name</em>
                        </p></td><td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Dot-notated child. The dot is equivalent to XPath鈥檚 <span class="EmphasisFontCategoryNonProportional ">/</span> symbol.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional ">[&apos;</span>
                          <em class="EmphasisTypeItalic ">name</em>
                          <span class="EmphasisFontCategoryNonProportional "> (, </span>
                          <em class="EmphasisTypeItalic ">name</em>
                          <span class="EmphasisFontCategoryNonProportional ">&apos;)]</span>
                        </p></td><td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Bracket-notated child or children.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional ">[</span>
                          <em class="EmphasisTypeItalic ">number</em>
                          <span class="EmphasisFontCategoryNonProportional ">(,</span>
                          <em class="EmphasisTypeItalic ">number</em>
                          <span class="EmphasisFontCategoryNonProportional ">)]</span>
                        </p></td><td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Array index or indexes.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional ">[</span>
                          <em class="EmphasisTypeItalic ">start</em>
                          <span class="EmphasisFontCategoryNonProportional ">:</span>
                          <em class="EmphasisTypeItalic ">end</em>
                          <span class="EmphasisFontCategoryNonProportional ">]</span>
                        </p></td><td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Array slice operator.</p></td></tr><tr><td style="border-right: 0.5pt solid ; text-align: left;"><p class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional ">[?(</span>
                          <em class="EmphasisTypeItalic ">expression</em>
                          <span class="EmphasisFontCategoryNonProportional ">)]</span>
                        </p></td><td style="text-align: left;"><p class="SimplePara">Filter operator. The <em class="EmphasisTypeItalic ">expression</em> must evaluate to a Boolean value. In other words, it鈥檚 a <em class="EmphasisTypeItalic ">predicate</em>.</p></td></tr></tbody></table></div></div><div class="Para" id="Par14">The Jayway documentation also identifies several functions that can be invoked at the tail end of a path鈥攖he input to a function is the output of the path expression; the function output is dictated by the function itself. Table <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_10_Chapter.xhtml#Tab2">10-2</a></span> describes these functions.<div class="Table" id="Tab2"><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Table 10-2</span><p class="SimplePara">JsonPath <span id="ITerm6">Functions</span></p></div></div><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="tcol1 align-left"><col class="tcol2 align-left"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Function</p></th><th style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Description</p></th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional ">min()</span>
                        </p></td><td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Return the minimum value (as a <span class="EmphasisFontCategoryNonProportional ">double</span>) in an array of numbers.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional ">max()</span>
                        </p></td><td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Return the maximum value (as a <span class="EmphasisFontCategoryNonProportional ">double</span>) in an array of numbers.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional ">avg()</span>
                        </p></td><td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Return the average value (as a <span class="EmphasisFontCategoryNonProportional ">double</span>) of an array of numbers.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional ">stddev()</span>
                        </p></td><td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Return the standard deviation value (as a <span class="EmphasisFontCategoryNonProportional ">double</span>) of an array of numbers.</p></td></tr><tr><td style="border-right: 0.5pt solid ; text-align: left;"><p class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional ">length()</span>
                        </p></td><td style="text-align: left;"><p class="SimplePara">Return the length (as an <span class="EmphasisFontCategoryNonProportional ">int</span>) of an array.</p></td></tr></tbody></table></div></div><div class="Para" id="Par15">Finally, the Jayway documentation identifies various operators for <em class="EmphasisTypeItalic ">filters</em>, which use predicates (Boolean expressions) to restrict returned lists of <span id="ITerm7">items</span>. Predicates can use the filter operators in Table <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_10_Chapter.xhtml#Tab3">10-3</a></span> to determine equality, match regular expressions, and test for inclusion.<div class="Table" id="Tab3"><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Table 10-3</span><p class="SimplePara">JsonPath <span id="ITerm8">Filter Operators</span></p></div></div><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="tcol1 align-left"><col class="tcol2 align-left"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Operator</p></th><th style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Description</p></th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional ">==</span>
                        </p></td><td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Return <span class="EmphasisFontCategoryNonProportional ">true</span> when the left operand equals the right operand. Note that <span class="EmphasisFontCategoryNonProportional ">1</span> is not equal to <span class="EmphasisFontCategoryNonProportional ">1</span> (i.e., number <span class="EmphasisFontCategoryNonProportional ">1</span> and string <span class="EmphasisFontCategoryNonProportional ">1</span> are two different things).</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional ">!=</span>
                        </p></td><td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Return <span class="EmphasisFontCategoryNonProportional ">true</span> when the left operand doesn鈥檛 equal the right operand.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional ">&lt;</span>
                        </p></td><td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Return <span class="EmphasisFontCategoryNonProportional ">true</span> when the left operand is less than the right operand.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional ">&lt;=</span>
                        </p></td><td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Return <span class="EmphasisFontCategoryNonProportional ">true</span> when the left operand is less than or equal to the right operand.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional ">&gt;</span>
                        </p></td><td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Return <span class="EmphasisFontCategoryNonProportional ">true</span> when the left operand is greater than the right operand.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional ">&gt;=</span>
                        </p></td><td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Return <span class="EmphasisFontCategoryNonProportional ">true</span> when the left operand is greater than or equal to the right operand.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional ">=~</span>
                        </p></td><td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Return <span class="EmphasisFontCategoryNonProportional ">true</span> when the left operand matches the regular expression specified by the right operand; for example, <span class="EmphasisFontCategoryNonProportional ">[?(@.name =~ /foo.*?/i)]</span>.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional ">in</span>
                        </p></td><td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Return <span class="EmphasisFontCategoryNonProportional ">true</span> when the left operand exists in the right operand; for example, <span class="EmphasisFontCategoryNonProportional ">[?(@.grade in [&apos;A&apos;, &apos;B&apos;])]</span>.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional ">nin</span>
                        </p></td><td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Return <span class="EmphasisFontCategoryNonProportional ">true</span> when the left operand doesn鈥檛 exist in the right operand.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional ">subsetof</span>
                        </p></td><td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Return <span class="EmphasisFontCategoryNonProportional ">true</span> when the left operand (an array) is a subset of the right operand (an array); for example, <span class="EmphasisFontCategoryNonProportional ">[?(@.sizes subsetof [&apos;S&apos;, &apos;M&apos;, &apos;L&apos;])]</span>.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional ">size</span>
                        </p></td><td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Return <span class="EmphasisFontCategoryNonProportional ">true</span> when the size of the left operand (an array or string) matches the right operand (an integer).</p></td></tr><tr><td style="border-right: 0.5pt solid ; text-align: left;"><p class="SimplePara">
                          <span class="EmphasisFontCategoryNonProportional ">empty</span>
                        </p></td><td style="text-align: left;"><p class="SimplePara">Return <span class="EmphasisFontCategoryNonProportional ">true</span> when the left operand (an array or string) is empty and the right operand is <span class="EmphasisFontCategoryNonProportional ">true</span><span id="ITerm9">
                            
                            
                          </span>, or return <span class="EmphasisFontCategoryNonProportional ">true</span> when the left operand is not empty and the right operand is <span class="EmphasisFontCategoryNonProportional ">false</span>.</p></td></tr></tbody></table></div></div><div class="Para" id="Par16">This table reveals <span class="EmphasisFontCategoryNonProportional ">@.name =~ /foo.*?/i</span> and additional simple predicates. You can create more complex predicates by using the logical AND operator (<span class="EmphasisFontCategoryNonProportional ">&amp;&amp;</span>) and the logical OR operator (<span class="EmphasisFontCategoryNonProportional ">||</span>). Consider the following example:<div class="ProgramCode" id="PC4"><div class="LineGroup"><div class="FixedLine">([?(@.color == &apos;blue&apos;)] || [?(@.color == &quot;red&quot;)])</div></div></div></div><div class="Para" id="Par17">You can also use the logical NEGATE operator (<span class="EmphasisFontCategoryNonProportional ">!</span>) to negate a predicate:<div class="ProgramCode" id="PC5"><div class="LineGroup"><div class="FixedLine">[?(!(@.price &lt; 10 &amp;&amp; @.category == &apos;fiction&apos;))]</div></div></div></div><p class="Para" id="Par18">Within a predicate, you must enclose any string <span id="ITerm10">literals</span> with single or double quotes, which both examples demonstrate.</p></section><section class="Section1 RenderAsSection1" id="Sec3"><h2 class="Heading">Obtaining and Using the JsonPath Library</h2><p class="Para" id="Par19">As with Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_8_Chapter.xhtml"><span class="RefSource">8</span></a></span>鈥檚 mJson and Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml"><span class="RefSource">9</span></a></span>鈥檚 Gson, you can obtain <span id="ITerm11">JsonPath</span> from the Central Maven Repository (<span class="ExternalRef"><a href="http://search.maven.org/"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional ">http://search.maven.org</span>
                </span></a></span>).</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar2"><h3 class="Heading">Note</h3><p class="Para" id="Par20">If you鈥檙e unfamiliar with Maven, think of it as a build tool for Java projects, although Maven developers think of Maven as more than just a build tool鈥攕ee <span class="ExternalRef"><a href="http://maven.apache.org/background/philosophy-of-maven.html"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://maven.apache.org/background/philosophy-of-maven.html</span>
                  </span></a></span>.</p></div><div class="Para" id="Par21">If you鈥檙e familiar with Maven, add the following XML fragment to the Project Object <span id="ITerm12">Model</span> (POM) files for your Maven project(s) that will be dependent on <span id="ITerm13">JsonPath</span>, and you will be good to go! (To learn about POM, check out <span class="ExternalRef"><a href="http://maven.apache.org/pom.html#What_is_the_POM"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional ">http://maven.apache.org/pom.html#What_is_the_POM</span>
                </span></a></span>.)<div class="ProgramCode" id="PC6"><div class="LineGroup"><div class="FixedLine">&lt;dependency&gt;</div><div class="FixedLine">    &lt;groupId&gt;com.jayway.jsonpath&lt;/groupId&gt;</div><div class="FixedLine">    &lt;artifactId&gt;json-path&lt;/artifactId&gt;</div><div class="FixedLine">    &lt;version&gt;2.4.0&lt;/version&gt;</div><div class="FixedLine">&lt;/dependency&gt;</div></div></div></div><p class="Para" id="Par22">This XML fragment reveals 2.4.0 as the version of Jayway鈥檚 JsonPath library that I鈥檓 using in this chapter.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar3"><h3 class="Heading">Note</h3><p class="Para" id="Par23">It鈥檚 common for Maven projects to be dependent on other projects. For example, the mJson project (<span class="ExternalRef"><a href="http://search.maven.org/artifact/org.sharegov/mjson/1.4.0/bundle"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://search.maven.org/artifact/org.sharegov/mjson/1.4.0/bundle</span>
                  </span></a></span>) that I discussed in Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_8_Chapter.xhtml"><span class="RefSource">8</span></a></span> and the Gson project (<span class="ExternalRef"><a href="http://search.maven.org/artifact/com.google.code.gson/gson/2.8.5/jar"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://search.maven.org/artifact/com.google.code.gson/gson/2.8.5/jar</span>
                  </span></a></span>) that I discussed in Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml"><span class="RefSource">9</span></a></span> are dependent on JUnit (<span class="ExternalRef"><a href="http://en.wikipedia.org/wiki/JUnit"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://en.wikipedia.org/wiki/JUnit</span>
                  </span></a></span>). I didn鈥檛 mention or discuss downloading JUnit in either chapter because this library isn鈥檛 required for normal use.</p></div><p class="Para" id="Par24">Because I鈥檓 not currently using Maven, I downloaded the JsonPath JAR file and all of the JAR files on which JsonPath normally depends and then added all of these JAR files to my <span id="ITerm14">CLASSPATH</span>. The easiest way for me to accomplish the download task was to point my browser to <span class="ExternalRef"><a href="https://jar-download.com/artifacts/com.jayway.jsonpath/json-path/2.4.0/source-code"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional ">https://jar-download.com/artifacts/com.jayway.jsonpath/json-path/2.4.0/source-code</span>
                </span></a></span> and click the 鈥淒ownload json-path (2.4.0)鈥?button link.</p><div class="Para" id="Par25">After unarchiving the <span id="ITerm15">ZIP file</span>, I discovered a <span class="EmphasisFontCategoryNonProportional ">jar_files</span> directory with the following files:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par26">
                    <span class="EmphasisFontCategoryNonProportional ">accessors-smart-1.2.jar</span>
                  </p></li><li><p class="Para" id="Par27">
                    <span class="EmphasisFontCategoryNonProportional ">asm-5.0.4.jar</span>
                  </p></li><li><p class="Para" id="Par28">
                    <span class="EmphasisFontCategoryNonProportional ">json-path-2.4.0.jar</span>
                  </p></li><li><p class="Para" id="Par29">
                    <span class="EmphasisFontCategoryNonProportional ">json-smart-2.3.jar</span>
                  </p></li><li><p class="Para" id="Par30">
                    <span class="EmphasisFontCategoryNonProportional ">slf4j-api-1.7.25.jar</span>
                  </p></li></ul></div></div><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar4"><h3 class="Heading">Note</h3><p class="Para" id="Par31">Jayway JsonPath is licensed according to Apache License Version 2.0 (<span class="ExternalRef"><a href="http://www.apache.org/licenses/"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">www.apache.org/licenses/</span>
                  </span></a></span>).</p></div><div class="Para" id="Par32">For compiling Java source code that accesses JsonPath, only <span class="EmphasisFontCategoryNonProportional ">json-path-2.4.0.jar</span> needs to be included in the CLASSPATH:<div class="ProgramCode" id="PC7"><div class="LineGroup"><div class="FixedLine">javac -cp json-path-2.4.0.jar <em class="EmphasisTypeItalic ">source file</em></div></div></div></div><div class="Para" id="Par33">For running applications that access JsonPath, I use the following command line:<div class="ProgramCode" id="PC8"><div class="LineGroup"><div class="FixedLine">java -cp accessors-smart-1.2.jar;asm-5.0.4.jar;json-path-2.4.0.jar;json-smart-2.3.jar;slf4j-api-1.7.25.jar;. <em class="EmphasisTypeItalic ">main classfile</em></div></div></div></div><p class="Para" id="Par34"><em class="EmphasisTypeItalic ">These command lines assume that the JAR files are located in the current directory.</em> To facilitate working with the command <span id="ITerm16">lines</span>, place them in a pair of batch files on Windows platforms (substitute <span class="EmphasisFontCategoryNonProportional ">%1</span> for <em class="EmphasisTypeItalic EmphasisFontCategoryNonProportional ">source file</em> or <em class="EmphasisTypeItalic EmphasisFontCategoryNonProportional ">main classfile</em>) or their counterparts on other platforms.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar5"><h3 class="Heading">Note</h3><p class="Para" id="Par35">JsonPath 2.4.0鈥檚 API reference is available online at <span class="ExternalRef"><a href="http://www.javadoc.io/doc/com.jayway.jsonpath/json-path/2.4.0"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">www.javadoc.io/doc/com.jayway.jsonpath/json-path/2.4.0</span>
                  </span></a></span>.</p></div></section><section class="Section1 RenderAsSection1" id="Sec4"><h2 class="Heading">Exploring the JsonPath Library</h2><p class="Para" id="Par36">The JsonPath library is organized into several packages. You will typically interact with the <span class="EmphasisFontCategoryNonProportional ">com.jayway.jsonpath</span> package and its types. In this section, I focus exclusively on this package while showing you how to extract values from JSON objects and use predicates to filter items.</p><section class="Section2 RenderAsSection2" id="Sec5"><h3 class="Heading">Extracting Values from JSON Objects</h3><div class="Para" id="Par37">The <span class="EmphasisFontCategoryNonProportional ">com.jayway.jsonpath</span> package provides the <span class="EmphasisFontCategoryNonProportional ">JsonPath</span> class as the entry point into using the <span id="ITerm17">JsonPath library</span>. Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_10_Chapter.xhtml#PC9">10-1</a></span> introduces this class.<div class="ProgramCode" id="PC9"><div class="LineGroup"><div class="FixedLine">import java.util.HashMap;</div><div class="FixedLine">import java.util.List;</div></div><div class="LineGroup"><div class="FixedLine">import com.jayway.jsonpath.JsonPath;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class JsonPathDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      String json =</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;   \&quot;store\&quot;:&quot; +</div><div class="FixedLine">      &quot;   {&quot; +</div><div class="FixedLine">      &quot;      \&quot;book\&quot;:&quot; +</div><div class="FixedLine">      &quot;      [&quot; +</div><div class="FixedLine">      &quot;         {&quot; +</div><div class="FixedLine">      &quot;            \&quot;category\&quot;: \&quot;reference\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;author\&quot;: \&quot;Nigel Rees\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;title\&quot;: \&quot;Sayings of the Century\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;price\&quot;: 8.95&quot; +</div><div class="FixedLine">      &quot;         },&quot; +</div><div class="FixedLine">      &quot;         {&quot; +<span id="ITerm18">
                        
                        
                      </span></div><div class="FixedLine">      &quot;            \&quot;category\&quot;: \&quot;fiction\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;author\&quot;: \&quot;Evelyn Waugh\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;title\&quot;: \&quot;Sword of Honour\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;price\&quot;: 12.99&quot; +</div><div class="FixedLine">      &quot;         }&quot; +</div><div class="FixedLine">      &quot;      ],&quot; +</div><div class="FixedLine">      &quot;      \&quot;bicycle\&quot;:&quot; +</div><div class="FixedLine">      &quot;      {&quot; +</div><div class="FixedLine">      &quot;         \&quot;color\&quot;: \&quot;red\&quot;,&quot; +</div><div class="FixedLine">      &quot;         \&quot;price\&quot;: 19.95&quot; +</div><div class="FixedLine">      &quot;      }&quot; +</div><div class="FixedLine">      &quot;   }&quot; +</div><div class="FixedLine">      &quot;}&quot;;</div></div><div class="LineGroup"><div class="FixedLine">      JsonPath path = JsonPath.compile(&quot;$.store.book[1]&quot;);</div><div class="FixedLine">      HashMap books = path.read(json);</div><div class="FixedLine">      out.println(books);</div><div class="FixedLine">      List&lt;Object&gt; authors =</div><div class="FixedLine">         JsonPath.read(json, &quot;$.store.book[*].author&quot;);</div><div class="FixedLine">      out.println(authors);</div><div class="FixedLine">      String author =</div><div class="FixedLine">         JsonPath.read(json, &quot;$.store.book[1].author&quot;);</div><div class="FixedLine">      out.println(author);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 10-1</span><p class="SimplePara">A First Taste of JsonPath</p></div></div></div></div><div class="Para" id="Par38">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_10_Chapter.xhtml#PC9">10-1</a></span> provides a <span class="EmphasisFontCategoryNonProportional ">JsonPathDemo</span> class whose <span class="EmphasisFontCategoryNonProportional ">main()</span> method<span id="ITerm19">
                  
                </span> uses the <span class="EmphasisFontCategoryNonProportional ">JsonPath</span> class to extract values from JSON objects. <span class="EmphasisFontCategoryNonProportional ">main()</span> first declares a string-based JSON object and assigns its reference to variable <span class="EmphasisFontCategoryNonProportional ">json</span>. It then invokes the following <span class="EmphasisFontCategoryNonProportional ">static JsonPath</span> method<span id="ITerm20">
                  
                </span><span id="ITerm21">
                  
                  
                </span> to compile a JsonPath expression (to improve performance) and return the compiled result as a <span class="EmphasisFontCategoryNonProportional ">JsonPath</span> object:<div class="ProgramCode" id="PC10"><div class="LineGroup"><div class="FixedLine">JsonPath compile(String jsonPath, Predicate... filters)</div></div></div></div><p class="Para" id="Par39">The <span class="EmphasisFontCategoryNonProportional ">Predicate</span> varargs list lets you specify an array of filter predicates to match filter predicate place holders (identified as <span class="EmphasisFontCategoryNonProportional ">?</span> characters) in the <span class="EmphasisFontCategoryNonProportional ">jsonPath</span> string. I鈥檒l demonstrate <span class="EmphasisFontCategoryNonProportional ">Predicate</span> and related types later in this chapter.</p><div class="Para" id="Par40">After compiling the <span class="EmphasisFontCategoryNonProportional ">$.store.book[1]</span> JsonPath expression, which identifies the anonymous object in the second element of the array assigned to the <span class="EmphasisFontCategoryNonProportional ">book</span> property of the anonymous object assigned to the <span class="EmphasisFontCategoryNonProportional ">store</span> property, <span class="EmphasisFontCategoryNonProportional ">main()</span> passes this expression to the following <span class="EmphasisFontCategoryNonProportional ">JsonPath</span> method:<div class="ProgramCode" id="PC11"><div class="LineGroup"><div class="FixedLine">&lt;T&gt; T read(String json)</div></div></div></div><p class="Para" id="Par41">This generic method is called on the previously compiled <span class="EmphasisFontCategoryNonProportional ">JsonPath</span> instance. It receives the string-based JSON object (assigned to <span class="EmphasisFontCategoryNonProportional ">json</span>) as its argument and applies the JsonPath expression in the compiled <span class="EmphasisFontCategoryNonProportional ">JsonPath</span> instance to this argument. The result is the JSON object identified by <span class="EmphasisFontCategoryNonProportional ">$.store.book[1]</span>.</p><p class="Para" id="Par42">The <span class="EmphasisFontCategoryNonProportional ">read()</span> method<span id="ITerm22">
                  
                </span> is generic because it can return one of several <span id="ITerm23">types</span>. In this example, it returns an instance of the <span class="EmphasisFontCategoryNonProportional ">java.util.LinkedHashMap</span> class (a subclass of <span class="EmphasisFontCategoryNonProportional ">java.util.Hashmap</span>) for storing JSON object property names and their values.</p><div class="Para" id="Par43">When you intend to reuse JsonPath expressions, it鈥檚 good to compile them, which improves performance. Because I don鈥檛 reuse <span class="EmphasisFontCategoryNonProportional ">$.store.book[1]</span>, I could have used one of <span class="EmphasisFontCategoryNonProportional ">JsonPath</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">static read()</span> methods instead. For example, <span class="EmphasisFontCategoryNonProportional ">main()</span> next demonstrates the following <span class="EmphasisFontCategoryNonProportional ">read()</span> method:<div class="ProgramCode" id="PC12"><div class="LineGroup"><div class="FixedLine">&lt;T&gt; T read(String json, String jsonPath, Predicate... filters)</div></div></div></div><p class="Para" id="Par44">This method creates a new <span class="EmphasisFontCategoryNonProportional ">JsonPath</span> object<span id="ITerm24">
                  
                  
                </span> for the <span class="EmphasisFontCategoryNonProportional ">jsonPath</span> argument and applies it to the <span class="EmphasisFontCategoryNonProportional ">json</span> string. I ignore <span class="EmphasisFontCategoryNonProportional ">filters</span> in the example.</p><p class="Para" id="Par45">The JsonPath expression passed to <span class="EmphasisFontCategoryNonProportional ">jsonPath</span> is <span class="EmphasisFontCategoryNonProportional ">$.store.book[*].author</span>. This expression includes the <span class="EmphasisFontCategoryNonProportional ">*</span> wildcard to match all elements in the <span class="EmphasisFontCategoryNonProportional ">book</span> array. It returns the value of the <span class="EmphasisFontCategoryNonProportional ">author</span> property for each element in this array.</p><p class="Para" id="Par46"><span class="EmphasisFontCategoryNonProportional ">read()</span> returns this value as an instance of the <span class="EmphasisFontCategoryNonProportional ">net.minidev.json.JSONArray</span> class, which is stored in the <span class="EmphasisFontCategoryNonProportional ">json-smart-2.3.jar</span> file that you must include in the CLASSPATH. Because <span class="EmphasisFontCategoryNonProportional ">JSONArray</span> extends <span class="EmphasisFontCategoryNonProportional ">java.util.ArrayList&lt;Object&gt;</span>, it鈥檚 legal to cast the returned object to <span class="EmphasisFontCategoryNonProportional ">List&lt;Object&gt;</span>.</p><p class="Para" id="Par47">To further demonstrate <span class="EmphasisFontCategoryNonProportional ">read()</span>, <span class="EmphasisFontCategoryNonProportional ">main()</span> lastly invokes this method with JsonPath <span id="ITerm25">expression</span>
<span class="EmphasisFontCategoryNonProportional ">$.store.book[1].author</span>, which returns the value of the <span class="EmphasisFontCategoryNonProportional ">author</span> property in the anonymous object stored in the second element of the <span class="EmphasisFontCategoryNonProportional ">book</span> array. This time, <span class="EmphasisFontCategoryNonProportional ">read()</span> returns a <span class="EmphasisFontCategoryNonProportional ">java.lang.String</span> object.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar6"><h3 class="Heading">Note</h3><p class="Para" id="Par48">Regarding the generic <span class="EmphasisFontCategoryNonProportional ">read()</span> methods, <span class="EmphasisFontCategoryNonProportional ">JsonPath</span> automatically attempts to cast the result to the type that the method鈥檚 invoker expects, such as a hashmap for a JSON object, a list of objects for a JSON array, and a string for a JSON string.</p></div><div class="Para" id="Par49">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_10_Chapter.xhtml#PC9">10-1</a></span> as follows:<div class="ProgramCode" id="PC13"><div class="LineGroup"><div class="FixedLine">javac -cp json-path-2.4.0.jar JsonPathDemo.java</div></div></div></div><div class="Para" id="Par50">Run the resulting application as follows:<div class="ProgramCode" id="PC14"><div class="LineGroup"><div class="FixedLine">java -cp accessors-smart-1.2.jar;asm-5.0.4.jar;json-path-2.4.0.jar;json-smart-2.3.jar;slf4j-api-1.7.25.jar;. JsonPathDemo</div></div></div></div><div class="Para" id="Par51">You should observe the following output:<div class="ProgramCode" id="PC15"><div class="LineGroup"><div class="FixedLine">{category=fiction, author=Evelyn Waugh, title=Sword of Honour, price=12.99}</div><div class="FixedLine">[&quot;Nigel Rees&quot;,&quot;Evelyn Waugh&quot;]</div><div class="FixedLine">Evelyn Waugh</div></div></div></div><p class="Para" id="Par52">You鈥檒l probably also observe some <span id="ITerm26">messages</span> about <span id="ITerm27">SLF4J</span> (Simple Logging Facade for Java) not being able to load the <span class="EmphasisFontCategoryNonProportional ">StaticLoggerBinder</span> class and defaulting to a no-operation logger implementation. You can safely ignore these messages.</p></section><section class="Section2 RenderAsSection2" id="Sec6"><h3 class="Heading">Using Predicates to Filter Items</h3><p class="Para" id="Par53">JsonPath supports <em class="EmphasisTypeItalic ">filters</em> for restricting the nodes that are extracted from a JSON document to those that match the criteria specified by predicates (Boolean expressions). You can work with inline predicates, filter predicates, or custom predicates.</p><section class="Section3 RenderAsSection3" id="Sec7"><h4 class="Heading">Inline Predicates</h4><div class="Para" id="Par54">An <em class="EmphasisTypeItalic ">inline predicate</em><span id="ITerm28">
                    
                    
                  </span> is a string-based <span id="ITerm29">predicate</span>. Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_10_Chapter.xhtml#PC16">10-2</a></span> presents the source code to an application that demonstrates several inline predicates.<div class="ProgramCode" id="PC16"><div class="LineGroup"><div class="FixedLine">import java.util.List;</div></div><div class="LineGroup"><div class="FixedLine">import com.jayway.jsonpath.JsonPath;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class JsonPathDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      String json =</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;   \&quot;store\&quot;:&quot; +</div><div class="FixedLine">      &quot;   {&quot; +</div><div class="FixedLine">      &quot;      \&quot;book\&quot;:&quot; +</div><div class="FixedLine">      &quot;      [&quot; +</div><div class="FixedLine">      &quot;         {&quot; +</div><div class="FixedLine">      &quot;            \&quot;category\&quot;: \&quot;reference\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;author\&quot;: \&quot;Nigel Rees\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;title\&quot;: \&quot;Sayings of the Century\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;price\&quot;: 8.95&quot; +</div><div class="FixedLine">      &quot;         },&quot; +</div><div class="FixedLine">      &quot;         {&quot; +</div><div class="FixedLine">      &quot;            \&quot;category\&quot;: \&quot;fiction\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;author\&quot;: \&quot;Evelyn Waugh\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;title\&quot;: \&quot;Sword of Honour\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;price\&quot;: 12.99&quot; +</div><div class="FixedLine">      &quot;         },&quot; +<span id="ITerm30">
                          
                        </span></div><div class="FixedLine">      &quot;         {&quot; +</div><div class="FixedLine">      &quot;            \&quot;category\&quot;: \&quot;fiction\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;author\&quot;: \&quot;J. R. R. Tolkien\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;title\&quot;: \&quot;The Lord of the Rings\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;isbn\&quot;: \&quot;0-395-19395-8\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;price\&quot;: 22.99&quot; +</div><div class="FixedLine">      &quot;         },&quot; +</div><div class="FixedLine">      &quot;         {&quot; +</div><div class="FixedLine">      &quot;            \&quot;category\&quot;: \&quot;\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;author\&quot;: \&quot;some author\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;title\&quot;: \&quot;some title\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;isbn\&quot;: \&quot;some isbn\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;price\&quot;: 0&quot; +</div><div class="FixedLine">      &quot;         }&quot; +</div><div class="FixedLine">      &quot;      ],&quot; +</div><div class="FixedLine">      &quot;      \&quot;bicycle\&quot;:&quot; +</div><div class="FixedLine">      &quot;      [&quot; +</div><div class="FixedLine">      &quot;         {&quot; +</div><div class="FixedLine">      &quot;            \&quot;color\&quot;: \&quot;red\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;accessories\&quot;: [\&quot;horn\&quot;, &quot; +</div><div class="FixedLine">      &quot;            \&quot;bottle\&quot;],&quot; +</div><div class="FixedLine">      &quot;            \&quot;price\&quot;: 619.95&quot; +</div><div class="FixedLine">      &quot;         },&quot; +</div><div class="FixedLine">      &quot;         {&quot; +</div><div class="FixedLine">      &quot;            \&quot;color\&quot;: \&quot;green\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;accessories\&quot;: [\&quot;horn\&quot;, &quot; +</div><div class="FixedLine">      &quot;            \&quot;light\&quot;],&quot; +</div><div class="FixedLine">      &quot;            \&quot;price\&quot;: 639.95&quot; +</div><div class="FixedLine">      &quot;         },&quot; +<span id="ITerm31">
                          
                        </span></div><div class="FixedLine">      &quot;         {&quot; +</div><div class="FixedLine">      &quot;            \&quot;color\&quot;: \&quot;blue\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;accessories\&quot;: [],&quot; +</div><div class="FixedLine">      &quot;            \&quot;price\&quot;: 599.95&quot; +</div><div class="FixedLine">      &quot;         }&quot; +</div><div class="FixedLine">      &quot;      ]&quot; +</div><div class="FixedLine">      &quot;   }&quot; +</div><div class="FixedLine">      &quot;}&quot;;</div></div><div class="LineGroup"><div class="FixedLine">      String expr = &quot;$.store.book[?(@.isbn)].title&quot;;</div><div class="FixedLine">      List&lt;Object&gt; titles = JsonPath.read(json, expr);</div><div class="FixedLine">      out.println(titles); <span id="ITerm32">
                          
                        </span></div><div class="FixedLine">      expr =</div><div class="FixedLine">         &quot;$.store.book[?(@.category == &apos;fiction&apos;)].title&quot;;</div><div class="FixedLine">      titles = JsonPath.read(json, expr);</div><div class="FixedLine">      out.println(titles);</div><div class="FixedLine">      expr = &quot;$..book[?(@.author =~ /.*REES/i)].title&quot;;</div><div class="FixedLine">      titles = JsonPath.read(json, expr);</div><div class="FixedLine">      out.println(titles); <span id="ITerm33">
                          
                        </span></div><div class="FixedLine">      expr =</div><div class="FixedLine">         &quot;$..book[?(@.price &gt; 10 &amp;&amp; @.price &lt; 20)].title&quot;;</div><div class="FixedLine">      titles = JsonPath.read(json, expr);</div><div class="FixedLine">      out.println(titles);</div><div class="FixedLine">      expr = &quot;$..book[?(@.author in [&apos;Nigel Rees&apos;])].title&quot;;</div><div class="FixedLine">      titles = JsonPath.read(json, expr);</div><div class="FixedLine">      out.println(titles);</div><div class="FixedLine">      expr =</div><div class="FixedLine">         &quot;$..book[?(@.author nin [&apos;Nigel Rees&apos;])].title&quot;;</div><div class="FixedLine">      titles = JsonPath.read(json, expr);</div><div class="FixedLine">      out.println(titles);</div><div class="FixedLine">      expr = &quot;$.store.bicycle[?(@.accessories &quot; +</div><div class="FixedLine">             &quot;subsetof [&apos;horn&apos;, &apos;bottle&apos;, &apos;light&apos;])].price&quot;;</div><div class="FixedLine">      List&lt;Object&gt; prices = JsonPath.read(json, expr);</div><div class="FixedLine">      out.println(prices);</div><div class="FixedLine">      expr = &quot;$.store.bicycle[?(@.accessories &quot; +</div><div class="FixedLine">             &quot;subsetof [&apos;horn&apos;, &apos;bottle&apos;])].price&quot;;</div><div class="FixedLine">      prices = JsonPath.read(json, expr);</div><div class="FixedLine">      out.println(prices);</div><div class="FixedLine">      expr = &quot;$..book[?(@.author size 12)].title&quot;;</div><div class="FixedLine">      titles = JsonPath.read(json, expr);</div><div class="FixedLine">      out.println(titles);</div><div class="FixedLine">      expr = &quot;$..book[?(@.author size 13)].title&quot;;</div><div class="FixedLine">      titles = JsonPath.read(json, expr);</div><div class="FixedLine">      out.println(titles); <span id="ITerm34">
                          
                        </span></div><div class="FixedLine">      expr =</div><div class="FixedLine">         &quot;$..bicycle[?(@.accessories empty true)].price&quot;;</div><div class="FixedLine">      titles = JsonPath.read(json, expr);</div><div class="FixedLine">      out.println(titles);</div><div class="FixedLine">      expr =</div><div class="FixedLine">         &quot;$..bicycle[?(@.accessories empty false)].price&quot;;</div><div class="FixedLine">      titles = JsonPath.read(json, expr);</div><div class="FixedLine">      out.println(titles);</div><div class="FixedLine">      expr = &quot;$..book[?(@.category empty true)].title&quot;;</div><div class="FixedLine">      titles = JsonPath.read(json, expr);</div><div class="FixedLine">      out.println(titles);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 10-2</span><p class="SimplePara">Demonstrating Inline Predicates</p></div></div></div></div><div class="Para" id="Par55">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_10_Chapter.xhtml#PC16">10-2</a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">main()</span> method uses the following JsonPath expressions to narrow the list of returned book title <span id="ITerm35">strings</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par56"><span class="EmphasisFontCategoryNonProportional ">$.store.book[?(@.isbn)].title</span>: returns the <span class="EmphasisFontCategoryNonProportional ">title</span> values for all <span class="EmphasisFontCategoryNonProportional ">book</span> elements that contain an <span class="EmphasisFontCategoryNonProportional ">isbn</span> property</p></li><li><p class="Para" id="Par57"><span class="EmphasisFontCategoryNonProportional ">$.store.book[?(@.category == &apos;fiction&apos;)].title</span>: returns the <span class="EmphasisFontCategoryNonProportional ">title</span> values for all <span class="EmphasisFontCategoryNonProportional ">book</span> elements whose <span class="EmphasisFontCategoryNonProportional ">category</span> property is assigned the string value <span class="EmphasisFontCategoryNonProportional ">fiction</span></p></li><li><p class="Para" id="Par58"><span class="EmphasisFontCategoryNonProportional ">$..book[?(@.author =~ /.*REES/i)].title</span>: returns the <span class="EmphasisFontCategoryNonProportional ">title</span> values for all <span class="EmphasisFontCategoryNonProportional ">book</span> elements whose <span class="EmphasisFontCategoryNonProportional ">author</span> property value ends with <span class="EmphasisFontCategoryNonProportional ">rees</span> (case is insignificant)</p></li><li><p class="Para" id="Par59"><span class="EmphasisFontCategoryNonProportional ">$..book[?(@.price &gt;= 10 &amp;&amp; @.price &lt;= 20)].title</span>: returns the <span class="EmphasisFontCategoryNonProportional ">title</span> values for all <span class="EmphasisFontCategoryNonProportional ">book</span> elements whose <span class="EmphasisFontCategoryNonProportional ">price</span> property value lies between <span class="EmphasisFontCategoryNonProportional ">10</span> and <span class="EmphasisFontCategoryNonProportional ">20</span></p></li><li><p class="Para" id="Par60"><span class="EmphasisFontCategoryNonProportional ">$..book[?(@.author in [&apos;Nigel Rees&apos;])].title</span>: returns the <span class="EmphasisFontCategoryNonProportional ">title</span> values for all <span class="EmphasisFontCategoryNonProportional ">book</span> elements whose <span class="EmphasisFontCategoryNonProportional ">author</span> property value matches <span class="EmphasisFontCategoryNonProportional ">Nigel Rees</span></p></li><li><p class="Para" id="Par61"><span class="EmphasisFontCategoryNonProportional ">$..book[?(@.author nin [&apos;Nigel Rees&apos;])].title</span>: returns the <span class="EmphasisFontCategoryNonProportional ">title</span> values for all <span class="EmphasisFontCategoryNonProportional ">book</span> elements whose <span class="EmphasisFontCategoryNonProportional ">author</span> property <span id="ITerm36">value</span> doesn鈥檛 match <span class="EmphasisFontCategoryNonProportional ">Nigel Rees</span></p></li><li><p class="Para" id="Par62"><span class="EmphasisFontCategoryNonProportional ">$.store.bicycle[?(@.accessories subsetof [&apos;horn&apos;, &apos;bottle&apos;, &apos;light&apos;])].price</span>: returns the <span class="EmphasisFontCategoryNonProportional ">price</span> values for all <span class="EmphasisFontCategoryNonProportional ">bicycle</span> elements whose <span class="EmphasisFontCategoryNonProportional ">accessories</span> property value (an array) is a subset of the <span class="EmphasisFontCategoryNonProportional ">[&apos;horn&apos;, &apos;bottle&apos;, &apos;light&apos;]</span> array</p></li><li><p class="Para" id="Par63"><span class="EmphasisFontCategoryNonProportional ">$.store.bicycle[?(@.accessories subsetof [&apos;horn&apos;, &apos;bottle&apos;])].price</span>: returns the <span class="EmphasisFontCategoryNonProportional ">price</span> values for all <span class="EmphasisFontCategoryNonProportional ">bicycle</span> elements whose <span class="EmphasisFontCategoryNonProportional ">accessories</span> property<span id="ITerm37">
                          
                        </span> value (an array) is a subset of the <span class="EmphasisFontCategoryNonProportional ">[&apos;horn&apos;, &apos;bottle&apos;]</span> array</p></li><li><p class="Para" id="Par64"><span class="EmphasisFontCategoryNonProportional ">$..book[?(@.author size 12)].title</span>: returns the <span class="EmphasisFontCategoryNonProportional ">title</span> values for all <span class="EmphasisFontCategoryNonProportional ">book</span> elements whose <span class="EmphasisFontCategoryNonProportional ">author</span> property value (a string) is exactly 12 characters long</p></li><li><p class="Para" id="Par65"><span class="EmphasisFontCategoryNonProportional ">$..book[?(@.author size 13)].title</span>: returns the <span class="EmphasisFontCategoryNonProportional ">title</span> values for all <span class="EmphasisFontCategoryNonProportional ">book</span> elements whose <span class="EmphasisFontCategoryNonProportional ">author</span> property value (a string) is exactly 13 characters long</p></li><li><p class="Para" id="Par66"><span class="EmphasisFontCategoryNonProportional ">$..bicycle[?(@.accessories empty true)].price</span>: returns the <span class="EmphasisFontCategoryNonProportional ">price</span> values for all <span class="EmphasisFontCategoryNonProportional ">bicycle</span> elements whose <span class="EmphasisFontCategoryNonProportional ">accessories</span> property <span id="ITerm38">value</span> (an array) is empty</p></li><li><p class="Para" id="Par67"><span class="EmphasisFontCategoryNonProportional ">$..bicycle[?(@.accessories empty false)].price</span>: returns the <span class="EmphasisFontCategoryNonProportional ">price</span> values for all <span class="EmphasisFontCategoryNonProportional ">bicycle</span> elements whose <span class="EmphasisFontCategoryNonProportional ">accessories</span> property value (an array) is not empty</p></li><li><p class="Para" id="Par68"><span class="EmphasisFontCategoryNonProportional ">$..book[?(@.category empty true)].title</span>: returns the <span class="EmphasisFontCategoryNonProportional ">title</span> values for all <span class="EmphasisFontCategoryNonProportional ">book</span> elements whose <span class="EmphasisFontCategoryNonProportional ">category</span> property value (a string) has zero length</p></li></ul></div></div><div class="Para" id="Par69">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_10_Chapter.xhtml#PC16">10-2</a></span> and run the resulting application. You should discover the following <span id="ITerm39">output</span>:<div class="ProgramCode" id="PC17"><div class="LineGroup"><div class="FixedLine">[&quot;The Lord of the Rings&quot;,&quot;some title&quot;]</div><div class="FixedLine">[&quot;Sword of Honour&quot;,&quot;The Lord of the Rings&quot;]</div><div class="FixedLine">[&quot;Sayings of the Century&quot;]</div><div class="FixedLine">[&quot;Sword of Honour&quot;]</div><div class="FixedLine">[&quot;Sayings of the Century&quot;]</div><div class="FixedLine">[&quot;Sword of Honour&quot;,&quot;The Lord of the Rings&quot;,&quot;some title&quot;]</div><div class="FixedLine">[619.95,639.95,599.95]</div><div class="FixedLine">[619.95,599.95]</div><div class="FixedLine">[&quot;Sword of Honour&quot;]</div><div class="FixedLine">[]</div><div class="FixedLine">[599.95]</div><div class="FixedLine">[619.95,639.95]</div><div class="FixedLine">[&quot;some title&quot;]</div></div></div></div></section><section class="Section3 RenderAsSection3" id="Sec8"><h4 class="Heading">Filter Predicates</h4><p class="Para" id="Par70">A <em class="EmphasisTypeItalic ">filter predicate</em> is a <span id="ITerm40">predicate</span><span id="ITerm41">
                    
                    
                  </span> expressed as an instance of the abstract <span class="EmphasisFontCategoryNonProportional ">Filter</span> class, which implements the <span class="EmphasisFontCategoryNonProportional ">Predicate</span> interface.</p><div class="Para" id="Par71">To create a filter predicate, you typically chain together invocations of various fluent methods (<span class="ExternalRef"><a href="http://en.wikipedia.org/wiki/Fluent_interface"><span class="RefSource">
                      <span class="EmphasisFontCategoryNonProportional ">http://en.wikipedia.org/wiki/Fluent_interface</span>
                    </span></a></span>) located in the <span class="EmphasisFontCategoryNonProportional ">Criteria</span> class, which also implements <span class="EmphasisFontCategoryNonProportional ">Predicate</span>, and pass the result to <span class="EmphasisFontCategoryNonProportional ">Filter</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">Filter filter(Predicate predicate) static</span> method.<div class="ProgramCode" id="PC18"><div class="LineGroup"><div class="FixedLine">Filter filter = Filter.filter(Criteria.where(&quot;price&quot;).lt(20.00));</div></div></div></div><p class="Para" id="Par72"><span class="EmphasisFontCategoryNonProportional ">Criteria</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">Criteria where(String key) static</span> method returns a <span class="EmphasisFontCategoryNonProportional ">Criteria</span> object that stores the provided <span class="EmphasisFontCategoryNonProportional ">key</span>, which is <span class="EmphasisFontCategoryNonProportional ">price</span> in this example. Its <span class="EmphasisFontCategoryNonProportional ">Criteria lt(Object o)</span> method<span id="ITerm42">
                    
                  </span> returns a <span class="EmphasisFontCategoryNonProportional ">Criteria</span> object for the <span class="EmphasisFontCategoryNonProportional ">&lt;</span> operator that identifies the value that鈥檚 compared to the value of the <span class="EmphasisFontCategoryNonProportional ">key</span>.</p><div class="Para" id="Par73">To use the filter predicate, first insert a <span class="EmphasisFontCategoryNonProportional ">?</span> placeholder for the filter predicate into the path:<div class="ProgramCode" id="PC19"><div class="LineGroup"><div class="FixedLine">String expr = &quot;$[&apos;store&apos;][&apos;book&apos;][?].title&quot;;</div></div></div></div><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar7"><h3 class="Heading">Note</h3><p class="Para" id="Par74">When multiple filter predicates are provided, they are applied in left-to-right order of the placeholders where the number of placeholders must match the number of provided filter predicates. You can specify multiple predicate placeholders in one filter operation <span class="EmphasisFontCategoryNonProportional ">[?, ?]</span>; both predicates must match.</p></div><div class="Para" id="Par75">Next, because <span class="EmphasisFontCategoryNonProportional ">Filter</span> implements <span class="EmphasisFontCategoryNonProportional ">Predicate</span><span id="ITerm43">
                    
                  </span>, you pass the filter predicate to a <span class="EmphasisFontCategoryNonProportional ">read()</span> method that takes a <span class="EmphasisFontCategoryNonProportional ">Predicate</span> argument:<div class="ProgramCode" id="PC20"><div class="LineGroup"><div class="FixedLine">List&lt;Object&gt; titles = JsonPath.read(json, expr, filter);</div></div></div></div><p class="Para" id="Par76">For each <span class="EmphasisFontCategoryNonProportional ">book</span> element, the <span class="EmphasisFontCategoryNonProportional ">read()</span> method executes the filter predicate when it detects the <span class="EmphasisFontCategoryNonProportional ">?</span> placeholder in the JsonPath expression.</p><div class="Para" id="Par77">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_10_Chapter.xhtml#PC21">10-3</a></span> presents the source code to an application that demonstrates the previous filter predicate code fragments.<div class="ProgramCode" id="PC21"><div class="LineGroup"><div class="FixedLine">import java.util.List;</div></div><div class="LineGroup"><div class="FixedLine">import com.jayway.jsonpath.Criteria;</div><div class="FixedLine">import com.jayway.jsonpath.Filter;</div><div class="FixedLine">import com.jayway.jsonpath.JsonPath;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class JsonPathDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      String json =</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;   \&quot;store\&quot;:&quot; +</div><div class="FixedLine">      &quot;   {&quot; +</div><div class="FixedLine">      &quot;      \&quot;book\&quot;:&quot; +</div><div class="FixedLine">      &quot;      [&quot; +</div><div class="FixedLine">      &quot;         {&quot; +</div><div class="FixedLine">      &quot;            \&quot;category\&quot;: \&quot;reference\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;author\&quot;: \&quot;Nigel Rees\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;title\&quot;: \&quot;Sayings of the Century\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;price\&quot;: 8.95&quot; +</div><div class="FixedLine">      &quot;         },&quot; +</div><div class="FixedLine">      &quot;         {&quot; +</div><div class="FixedLine">      &quot;            \&quot;category\&quot;: \&quot;fiction\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;author\&quot;: \&quot;Evelyn Waugh\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;title\&quot;: \&quot;Sword of Honour\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;price\&quot;: 12.99&quot; +</div><div class="FixedLine">      &quot;         },&quot; +<span id="ITerm44">
                          
                        </span></div><div class="FixedLine">      &quot;         {&quot; +</div><div class="FixedLine">      &quot;            \&quot;category\&quot;: \&quot;fiction\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;author\&quot;: \&quot;J. R. R. Tolkien\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;title\&quot;: \&quot;The Lord of the Rings\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;isbn\&quot;: \&quot;0-395-19395-8\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;price\&quot;: 22.99&quot; +</div><div class="FixedLine">      &quot;         }&quot; +</div><div class="FixedLine">      &quot;      ],&quot; +</div><div class="FixedLine">      &quot;      \&quot;bicycle\&quot;:&quot; +</div><div class="FixedLine">      &quot;      {&quot; +</div><div class="FixedLine">      &quot;         \&quot;color\&quot;: \&quot;red\&quot;,&quot; +</div><div class="FixedLine">      &quot;         \&quot;price\&quot;: 19.95&quot; +</div><div class="FixedLine">      &quot;      }&quot; +</div><div class="FixedLine">      &quot;   }&quot; +<span id="ITerm45">
                          
                        </span></div><div class="FixedLine">      &quot;}&quot;;</div></div><div class="LineGroup"><div class="FixedLine">      Filter filter =</div><div class="FixedLine">         Filter.filter(Criteria.where(&quot;price&quot;).lt(20.00));</div><div class="FixedLine">      String expr = &quot;$[&apos;store&apos;][&apos;book&apos;][?].title&quot;;</div><div class="FixedLine">      List&lt;Object&gt; titles = JsonPath.read(json, expr,</div><div class="FixedLine">                                          filter);</div><div class="FixedLine">      out.println(titles);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 10-3</span><p class="SimplePara">Demonstrating <span id="ITerm46">Filter Predicates</span></p></div></div></div></div><div class="Para" id="Par78">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_10_Chapter.xhtml#PC21">10-3</a></span> and run the resulting application. You should discover the following <span id="ITerm47">output</span> (both books have prices less than <span class="EmphasisFontCategoryNonProportional ">20</span> dollars):<div class="ProgramCode" id="PC22"><div class="LineGroup"><div class="FixedLine">[&quot;Sayings of the Century&quot;,&quot;Sword of Honour&quot;]</div></div></div></div></section><section class="Section3 RenderAsSection3" id="Sec9"><h4 class="Heading">Custom Predicates</h4><p class="Para" id="Par79">A <em class="EmphasisTypeItalic ">custom predicate</em> is a <span id="ITerm48">predicate</span><span id="ITerm49">
                    
                    
                  </span> created from a class that implements the <span class="EmphasisFontCategoryNonProportional ">Predicate</span> interface.</p><div class="Para" id="Par80">To create a custom predicate, instantiate a class that implements <span class="EmphasisFontCategoryNonProportional ">Predicate</span> and overrides the following method:<div class="ProgramCode" id="PC23"><div class="LineGroup"><div class="FixedLine">boolean apply(Predicate.PredicateContext ctx)</div></div></div></div><p class="Para" id="Par81"><span class="EmphasisFontCategoryNonProportional ">PredicateContext</span> is a nested interface whose methods provide information about the context in which <span class="EmphasisFontCategoryNonProportional ">apply()</span> is called. For example, <span class="EmphasisFontCategoryNonProportional ">Object root()</span> returns a reference to the entire JSON document, and <span class="EmphasisFontCategoryNonProportional ">Object item()</span> returns the current item being evaluated by this predicate.</p><p class="Para" id="Par82"><span class="EmphasisFontCategoryNonProportional ">apply()</span> returns the predicate value: <span class="EmphasisFontCategoryNonProportional ">true</span> (item is accepted) or <span class="EmphasisFontCategoryNonProportional ">false</span> (item is rejected).</p><div class="Para" id="Par83">The following code fragment creates a custom predicate for returning <span class="EmphasisFontCategoryNonProportional ">Book</span> elements containing a <span class="EmphasisFontCategoryNonProportional ">price</span> property whose value exceeds <span class="EmphasisFontCategoryNonProportional ">20</span> dollars:<div class="ProgramCode" id="PC24"><div class="LineGroup"><div class="FixedLine">Predicate expensiveBooks =</div><div class="FixedLine">   new Predicate()</div><div class="FixedLine">   {</div><div class="FixedLine">      @Override</div><div class="FixedLine">      public boolean apply(PredicateContext ctx)</div><div class="FixedLine">      {</div><div class="FixedLine">         String value = ctx.item(Map.class).</div><div class="FixedLine">                        get(&quot;price&quot;).toString();</div><div class="FixedLine">         return Float.valueOf(value) &gt; 20.00;</div><div class="FixedLine">      }</div><div class="FixedLine">   };</div></div></div></div><p class="Para" id="Par84"><span class="EmphasisFontCategoryNonProportional ">PredicateContext</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">&lt;T&gt; T item(java.lang.Class&lt;T&gt; clazz)</span> generic method maps the JSON object in the <span class="EmphasisFontCategoryNonProportional ">Book</span> element to a <span class="EmphasisFontCategoryNonProportional ">java.util.Map</span>.</p><div class="Para" id="Par85">To use the custom <span id="ITerm50">predicate</span>, first insert a <span class="EmphasisFontCategoryNonProportional ">?</span> placeholder for the custom predicate into the path:<div class="ProgramCode" id="PC25"><div class="LineGroup"><div class="FixedLine">String expr = &quot;$.store.book[?]&quot;;</div></div></div></div><div class="Para" id="Par86">Next, pass the custom predicate to a <span class="EmphasisFontCategoryNonProportional ">read()</span> method that takes a <span class="EmphasisFontCategoryNonProportional ">Predicate</span> argument:<div class="ProgramCode" id="PC26"><div class="LineGroup"><div class="FixedLine">List&lt;Map&lt;String, Object&gt;&gt; titles =</div><div class="FixedLine">   JsonPath.read(json, expr, expensiveBooks);</div></div></div></div><p class="Para" id="Par87">For each <span class="EmphasisFontCategoryNonProportional ">book</span> element, <span class="EmphasisFontCategoryNonProportional ">read()</span> executes the custom predicate associated with the <span class="EmphasisFontCategoryNonProportional ">?</span> and returns a list of maps (one map per accepted item).</p><div class="Para" id="Par88">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_10_Chapter.xhtml#PC27">10-4</a></span> presents the source code to an application that demonstrates the previous custom predicate code fragments.<div class="ProgramCode" id="PC27"><div class="LineGroup"><div class="FixedLine">import java.util.List;</div><div class="FixedLine">import java.util.Map;</div></div><div class="LineGroup"><div class="FixedLine">import com.jayway.jsonpath.JsonPath;</div><div class="FixedLine">import com.jayway.jsonpath.Predicate;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class JsonPathDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      String json =</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;   \&quot;store\&quot;:&quot; +</div><div class="FixedLine">      &quot;   {&quot; +</div><div class="FixedLine">      &quot;      \&quot;book\&quot;:&quot; +</div><div class="FixedLine">      &quot;      [&quot; +</div><div class="FixedLine">      &quot;         {&quot; +</div><div class="FixedLine">      &quot;            \&quot;category\&quot;: \&quot;reference\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;author\&quot;: \&quot;Nigel Rees\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;title\&quot;: \&quot;Sayings of the Century\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;price\&quot;: 8.95&quot; +</div><div class="FixedLine">      &quot;         },&quot; +</div><div class="FixedLine">      &quot;         {&quot; +</div><div class="FixedLine">      &quot;            \&quot;category\&quot;: \&quot;fiction\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;author\&quot;: \&quot;Evelyn Waugh\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;title\&quot;: \&quot;Sword of Honour\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;price\&quot;: 12.99&quot; +</div><div class="FixedLine">      &quot;         },&quot; +</div><div class="FixedLine">      &quot;         {&quot; +</div><div class="FixedLine">      &quot;            \&quot;category\&quot;: \&quot;fiction\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;author\&quot;: \&quot;J. R. R. Tolkien\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;title\&quot;: \&quot;The Lord of the Rings\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;isbn\&quot;: \&quot;0-395-19395-8\&quot;,&quot; +</div><div class="FixedLine">      &quot;            \&quot;price\&quot;: 22.99&quot; +</div><div class="FixedLine">      &quot;         }&quot; +<span id="ITerm51">
                          
                        </span></div><div class="FixedLine">      &quot;      ],&quot; +</div><div class="FixedLine">      &quot;      \&quot;bicycle\&quot;:&quot; +</div><div class="FixedLine">      &quot;      {&quot; +</div><div class="FixedLine">      &quot;         \&quot;color\&quot;: \&quot;red\&quot;,&quot; +</div><div class="FixedLine">      &quot;         \&quot;price\&quot;: 19.95&quot; +</div><div class="FixedLine">      &quot;      }&quot; +</div><div class="FixedLine">      &quot;   }&quot; +</div><div class="FixedLine">      &quot;}&quot;;</div></div><div class="LineGroup"><div class="FixedLine">      Predicate expensiveBooks =</div><div class="FixedLine">         new Predicate()</div><div class="FixedLine">         {</div><div class="FixedLine">            @Override</div><div class="FixedLine">            public boolean apply(PredicateContext ctx)</div><div class="FixedLine">            {</div><div class="FixedLine">               String value = ctx.item(Map.class).</div><div class="FixedLine">                              get(&quot;price&quot;).toString();</div><div class="FixedLine">               return Float.valueOf(value) &gt; 20.00;</div><div class="FixedLine">            }<span id="ITerm52">
                          
                        </span></div><div class="FixedLine">         };</div><div class="FixedLine">      String expr = &quot;$.store.book[?]&quot;;</div><div class="FixedLine">      List&lt;Map&lt;String, Object&gt;&gt; titles =</div><div class="FixedLine">         JsonPath.read(json, expr, expensiveBooks);</div><div class="FixedLine">      out.println(titles);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 10-4</span><p class="SimplePara">Demonstrating <span id="ITerm53">Custom Predicates</span></p></div></div></div></div><div class="Para" id="Par89">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_10_Chapter.xhtml#PC27">10-4</a></span> and run the resulting <span id="ITerm54">application</span>. You should discover the following output (one book has a price greater than <span class="EmphasisFontCategoryNonProportional ">20</span> dollars):<div class="ProgramCode" id="PC28"><div class="LineGroup"><div class="FixedLine">[{&quot;category&quot;:&quot;fiction&quot;,&quot;author&quot;:&quot;J. R. R. Tolkien&quot;,&quot;title&quot;:&quot;The Lord of the Rings&quot;,&quot;isbn&quot;:&quot;0-395-19395-8&quot;,&quot;price&quot;:22.99}]</div></div></div></div><div class="FormalPara FormalParaRenderingStyle3 ParaTypeOverview" id="FPar8"><h3 class="Heading">Exercises</h3><div class="Para" id="Par90">The following exercises are designed to test your understanding of Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_10_Chapter.xhtml"><span class="RefSource">10</span></a></span>鈥檚 content:<div class="OrderedList"><ol><li class="ListItem"><span class="ItemNumber">1.</span><div class="ItemContent"><p class="Para" id="Par91">Define JsonPath.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">2.</span><div class="ItemContent"><p class="Para" id="Par92">True or false: JsonPath is based on XPath 2.0.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">3.</span><div class="ItemContent"><p class="Para" id="Par93">Identify the operator that represents the root JSON object.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">4.</span><div class="ItemContent"><p class="Para" id="Par94">In what notations can you specify JsonPath expressions?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">5.</span><div class="ItemContent"><p class="Para" id="Par95">What operator represents the current node being processed by a filter predicate?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">6.</span><div class="ItemContent"><p class="Para" id="Par96">True or false: JsonPath鈥檚 deep scan operator (<span class="EmphasisFontCategoryNonProportional ">..</span>) is equivalent to XPath鈥檚 <span class="EmphasisFontCategoryNonProportional ">/</span> symbol.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">7.</span><div class="ItemContent"><p class="Para" id="Par97">What does <span class="EmphasisFontCategoryNonProportional ">JsonPath</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">JsonPath compile(String jsonPath, Predicate... filters) static</span> method accomplish?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">8.</span><div class="ItemContent"><p class="Para" id="Par98">What is the return type of the <span class="EmphasisFontCategoryNonProportional ">&lt;T&gt; T read(String json)</span> generic method that returns JSON object property names and their values?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">9.</span><div class="ItemContent"><p class="Para" id="Par99">Identify the three predicate categories.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">10.</span><div class="ItemContent"><p class="Para" id="Par100">Given JSON object <span class="EmphasisFontCategoryNonProportional ">{ &quot;number&quot;: [10, 20, 25, 30] }</span>, write a <span class="EmphasisFontCategoryNonProportional ">JsonPathDemo</span> application that extracts and outputs the maximum (<span class="EmphasisFontCategoryNonProportional ">30</span>), minimum (<span class="EmphasisFontCategoryNonProportional ">10</span>), and average (<span class="EmphasisFontCategoryNonProportional ">21.25</span>) values.</p></div><div class="ClearBoth"> </div></li></ol></div></div></div></section></section></section><section class="Section1 RenderAsSection1" id="Sec10"><h2 class="Heading">Summary</h2><p class="Para" id="Par101">JsonPath is a declarative query language (also known as a path-expression-syntax) for selecting and extracting a JSON document鈥檚 property values.</p><p class="Para" id="Par102">JsonPath is a simple language with various features that are similar to their XPath counterparts. This language is used to construct path expressions. Each expression begins with the <span class="EmphasisFontCategoryNonProportional ">$</span> operator, which identifies the root element of the query and which corresponds to the XPath <span class="EmphasisFontCategoryNonProportional ">/</span> symbol.</p><p class="Para" id="Par103">As with Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_8_Chapter.xhtml"><span class="RefSource">8</span></a></span>鈥檚 mJson and Chapter <span class="ExternalRef"><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_9_Chapter.xhtml"><span class="RefSource">9</span></a></span>鈥檚 Gson, you can obtain JsonPath from the Central Maven Repository. Alternatively, if you鈥檙e not using Maven, you can download the JsonPath JAR file and all of the JAR files on which JsonPath normally depends and then add all of these JAR files to your CLASSPATH.</p><p class="Para" id="Par104">The JsonPath library is organized into several packages. You will typically interact with the <span class="EmphasisFontCategoryNonProportional ">com.jayway.jsonpath</span> package and its types. In this chapter, you focused exclusively on this package while learning how to extract values from JSON objects and use predicates to filter items.</p><p class="Para" id="Par105">Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml"><span class="RefSource">11</span></a></span> introduces Jackson for parsing and generating JSON content.</p></section></div><div class="annotator-outer annotator-viewer viewer annotator-hide"> </div></div></div>
    </section>
  </div>
</div>

<hr/>

<!--if IE]><![endif]--><!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="3866890"
  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"
  data-username="levinxccai"
  data-account-type="B2B"
  
  data-activated-trial-date="11/06/2017"


  data-archive="9781484243305"
  data-publishers="Apress"



  data-htmlfile-name="394211_2_En_11_Chapter.xhtml"
  data-epub-title="Java XML and JSON: Document Processing for Java SE" data-debug=0 data-testing=0><![endif]--><!--if gt IE 8]><!--><!--![endif]-->



<a name="13_"></a>

<div class="application" id="container" style="height: auto;">
  <div class="js-toc">
    <section role="document">
      <div id="sbo-rt-content" style="max-width:72.5em; transform: none;"><div class="annotator-wrapper"><!--egin Abstract--><div class="MainTitleSection"><h1 class="ChapterTitle" lang="en">11. Processing JSON with Jackson</h1></div><div class="AuthorGroup"><div class="AuthorNames"><span class="Author"><span class="AuthorName">Jeff Friesen</span><sup><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#Aff2">1</a> <span class="ContactIcon"></span></sup></span></div><div class="Affiliations"><div class="Affiliation" id="Aff2"><span class="AffiliationNumber">(1)</span><div class="AffiliationText">Dauphin, MB, Canada</div></div><div class="ClearBoth"> </div></div></div><!--nd Abstract--><div class="Fulltext"><p class="Para" id="Par2">Jackson is a popular suite of APIs for parsing and creating JSON objects (and more). Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml"><span class="RefSource">11</span></a></span> explores the latest version of this 鈥渂est JSON parser for Java.鈥?/p&gt;<section class="Section1 RenderAsSection1" id="Sec1"><h2 class="Heading">What Is Jackson?</h2><p class="Para" id="Par3"><em class="EmphasisTypeItalic ">Jackson</em> is a suite of data-processing tools for Java. These tools include a streaming JSON parser/generator library, a matching data-binding library (for converting Plain Old Java Objects <span id="ITerm1">[POJOs]</span> to and from JSON), and additional data format modules for processing data encoded in XML and other formats.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar1"><h3 class="Heading">Note</h3><p class="Para" id="Par4">Jackson was created and is being maintained by Tatu Saloranta (<span class="ExternalRef"><a href="http://www.linkedin.com/in/tatu-saloranta-b2b36/"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">www.linkedin.com/in/tatu-saloranta-b2b36/</span>
                  </span></a></span>), who was inspired by the quality and variety of XML tooling available for the Java platform and decided to create something similar for JSON. In 2008, Saloranta founded the company FasterXML (<span class="ExternalRef"><a href="http://fasterxml.com/"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://fasterxml.com</span>
                  </span></a></span>), which distributed Jackson along with other key XML-oriented products. Jackson is currently distributed on GitHub (<span class="ExternalRef"><a href="http://github.com/FasterXML/jackson"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://github.com/FasterXML/jackson</span>
                  </span></a></span>).</p></div><div class="Para" id="Par5">Jackson consists of a core package and two other packages that depend on the <span id="ITerm2">core package</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par6"><span id="ITerm3">
                      <em class="EmphasisTypeItalic ">Jackson Core</em>
                      
                    </span>: The core package supports a StAX-like streaming API for reading and writing JSON via sequences of discrete events. This package鈥檚 name is <span class="EmphasisFontCategoryNonProportional ">com.fasterxml.jackson.core</span>. Key classes are <span class="EmphasisFontCategoryNonProportional ">JsonParser</span> for reading JSON content and <span class="EmphasisFontCategoryNonProportional ">JsonGenerator</span> for writing JSON content.</p></li><li><p class="Para" id="Par7"><span id="ITerm4">
                      <em class="EmphasisTypeItalic ">Jackson Databind</em>
                      
                    </span>: The databind package supports a DOM-like tree model that provides a mutable in-memory tree representation of a JSON document. It also supports reading/writing JSON from/to POJOs. This package鈥檚 name is <span class="EmphasisFontCategoryNonProportional ">com.fasterxml.jackson.databind</span>. Key classes are <span class="EmphasisFontCategoryNonProportional ">ObjectMapper</span> for reading/writing JSON content from/to tree models or POJOs and <span class="EmphasisFontCategoryNonProportional ">JsonNode</span>, which is the base class for all tree model nodes.</p></li><li><p class="Para" id="Par8"><span id="ITerm5">
                      <em class="EmphasisTypeItalic ">Jackson Annotations</em>
                      
                    </span>: The annotations package provides public core annotation types, most of which are used to configure how data binding (mapping) works. This package鈥檚 name is <span class="EmphasisFontCategoryNonProportional ">com.fasterxml.jackson.annotation</span>. Jackson Databind also depends on Jackson Annotations.</p></li></ul></div></div><p class="Para" id="Par9">Simple and full POJO-oriented data binding are supported. Simple data binding focuses on converting to and from <span class="EmphasisFontCategoryNonProportional ">java.util.Maps, java.util.Lists, java.lang.Strings, java.lang.Numbers, java.lang.Booleans</span>, and the null reference. Full data binding includes simple data binding but also supports converting to and from any Java Beans (<span class="ExternalRef"><a href="http://en.wikipedia.org/wiki/JavaBeans"><span class="RefSource">
                  <span class="EmphasisFontCategoryNonProportional ">http://en.wikipedia.org/wiki/JavaBeans</span>
                </span></a></span>) bean type. Conversions are based on property accessor conventions or annotations.</p><p class="Para" id="Par10">The streaming API performs better than the tree model or POJO-oriented data binding鈥攂oth APIs leverage the streaming API. However, data binding is the most convenient and the tree model offers the most <span id="ITerm6">flexibility</span>.</p><section class="Section2 RenderAsSection2" id="Sec2"><h3 class="Heading">Obtaining and Using Jackson</h3><p class="Para" id="Par11">The Jackson Core, Jackson Databind, and Jackson Annotations packages can be obtained from Maven (<span class="ExternalRef"><a href="https://search.maven.org/search?q=jackson-core"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">https://search.maven.org/search?q=jackson-core</span>
                  </span></a></span>). Version 2.9.7 is the latest version at the time of writing.</p><div class="Para" id="Par12">For each of the <em class="EmphasisTypeItalic ">jackson-core</em>, <em class="EmphasisTypeItalic ">jackson-databind</em>, and <em class="EmphasisTypeItalic ">jackson-annotations</em> artifact IDs, click the 鈥渏ar鈥?and 鈥渏avadoc.jar鈥?menu items in the associated drop-down Download menu, and download their referenced JAR files. You should end up with the following JAR file <span id="ITerm7">collection</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par13">
                      <span class="EmphasisFontCategoryNonProportional ">jackson-annotations-2.9.7.jar</span>
                    </p></li><li><p class="Para" id="Par14">
                      <span class="EmphasisFontCategoryNonProportional ">jackson-annotations-2.9.7-javadoc.jar</span>
                    </p></li><li><p class="Para" id="Par15">
                      <span class="EmphasisFontCategoryNonProportional ">jackson-core-2.9.7.jar</span>
                    </p></li><li><p class="Para" id="Par16">
                      <span class="EmphasisFontCategoryNonProportional ">jackson-core-2.9.7-javadoc.jar</span>
                    </p></li><li><p class="Para" id="Par17">
                      <span class="EmphasisFontCategoryNonProportional ">jackson-databind-2.9.7.jar</span>
                    </p></li><li><p class="Para" id="Par18">
                      <span class="EmphasisFontCategoryNonProportional ">jackson-databind-2.9.7-javadoc.jar</span>
                    </p></li></ul></div></div><div class="Para" id="Par19">I鈥檝e found it convenient to add all three nonJavadoc JAR files to my CLASSPATH when compiling and running code that uses a combination of Java Core, Java Databind, and Java Annotations:<div class="ProgramCode" id="PC1"><div class="LineGroup"><div class="FixedLine">javac -cp jackson-core-2.9.7.jar;jackson-databind-2.9.7.jar;jackson-annotations-2.9.7.jar <em class="EmphasisTypeItalic ">source file</em></div></div><div class="LineGroup"><div class="FixedLine">java -cp jackson-core-2.9.7.jar;jackson-databind-2.9.7.jar;jackson-annotations-2.9.7.jar;. <em class="EmphasisTypeItalic ">main classfile</em><span id="ITerm8">
                        
                        
                      </span></div></div></div></div></section></section><section class="Section1 RenderAsSection1" id="Sec3"><h2 class="Heading">Working with Jackson鈥檚 Basic Features</h2><p class="Para" id="Par20">The Jackson Core and Jackson <span id="ITerm9">Databind</span> APIs support the consumption and creation of JSON documents. This section introduces various types related to streaming, the tree model, and POJO-oriented data binding.</p><section class="Section2 RenderAsSection2" id="Sec4"><h3 class="Heading">Streaming</h3><p class="Para" id="Par21"><span id="ITerm10">
                  <em class="EmphasisTypeItalic ">Streaming</em>
                  
                </span> (also known as <span id="ITerm11">
                  <em class="EmphasisTypeItalic ">Incremental Processing</em>
                  
                </span>) deserializes (reads) and serializes (writes) JSON content as discrete events. Reading is performed by a <em class="EmphasisTypeItalic ">parser</em> that tokenizes JSON content into tokens and associated data; writing is performed by a <em class="EmphasisTypeItalic ">generator</em> that constructs JSON content based on a sequence of calls that output JSON tokens.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar2"><h3 class="Heading">Note</h3><p class="Para" id="Par22">Streaming has the lowest memory and processing overhead, making it the most efficient way to process JSON content. It鈥檚 used mainly by middleware and frameworks because it鈥檚 harder to use than the tree model or data binding.</p></div><div class="Para" id="Par23">Streaming methods throw <span class="EmphasisFontCategoryNonProportional ">java.io.IOException</span> when an I/O error occurs. When a non-I/O problem is encountered while parsing or generating JSON content, a method throws <span class="EmphasisFontCategoryNonProportional ">JsonProcessingException</span> (an <span class="EmphasisFontCategoryNonProportional ">IOException</span> subclass in the <span class="EmphasisFontCategoryNonProportional ">com.fasterxml.jackson.core</span> package) or one of its subclasses:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par24">
                      <span class="EmphasisFontCategoryNonProportional ">com.fasterxml.jackson.core.JsonParseException</span>
                    </p></li><li><p class="Para">
                      <span class="EmphasisFontCategoryNonProportional ">com.fasterxml.jackson.core.JsonGenerationException</span>
                    </p></li></ul></div></div><section class="Section3 RenderAsSection3" id="Sec5"><h4 class="Heading">Stream-Based Parsing</h4><p class="Para" id="Par26">The <span id="ITerm12">abstract</span><span id="ITerm13">
                    
                  </span>
<span class="EmphasisFontCategoryNonProportional ">com.fasterxml.jackson.core.JsonParser</span> class describes a low-level JSON parser. It鈥檚 obtained by calling one of the <span class="EmphasisFontCategoryNonProportional ">com.fasterxml.jackson.core.JsonFactory</span> class鈥檚 overloaded <span class="EmphasisFontCategoryNonProportional ">createParser()</span> methods, which take the JSON content鈥檚 origin into account.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar3"><h3 class="Heading">Note</h3><p class="Para" id="Par27">Parsers can be created to parse content from external sources (such as files or HTTP request streams) or buffered data (such as strings or byte arrays/buffers).</p></div><div class="Para" id="Par28">For example, <span class="EmphasisFontCategoryNonProportional ">JsonFactory</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">JsonParser createParser(String content)</span> method creates a parser for parsing the JSON content from the string passed to <span class="EmphasisFontCategoryNonProportional ">content</span>. This method is demonstrated as follows:<div class="ProgramCode" id="PC3"><div class="LineGroup"><div class="FixedLine">String truckJSON = &quot;{ \&quot;brand\&quot; : \&quot;Ford F-150\&quot;,</div><div class="FixedLine">                      \&quot;doors\&quot; : 4 }&quot;;</div><div class="FixedLine">JsonFactory factory = new JsonFactory();</div><div class="FixedLine">JsonParser parser = factory.createParser(truckJSON);</div></div></div></div><div class="Para" id="Par29">After creating a factory and obtaining a parser from the factory, a Java program typically enters a loop that returns a token and does something with it per iteration. This activity continues until the parser is closed:<div class="ProgramCode" id="PC4"><div class="LineGroup"><div class="FixedLine">while (!parser.isClosed())</div><div class="FixedLine">{</div><div class="FixedLine">   JsonToken token = parser.nextToken();</div><div class="FixedLine">   System.out.printf(&quot;token = %s%n&quot;, token);</div><div class="FixedLine">}</div></div></div></div><p class="Para" id="Par30"><span class="EmphasisFontCategoryNonProportional ">JsonParser</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">boolean isClosed()</span> method<span id="ITerm14">
                    
                  </span> returns <span class="EmphasisFontCategoryNonProportional ">true</span> when the parser has been closed, perhaps by invoking <span class="EmphasisFontCategoryNonProportional ">JsonParser</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">void close()</span> method.</p><p class="Para" id="Par31"><span class="EmphasisFontCategoryNonProportional ">JsonParser</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">JsonToken nextToken()</span> method<span id="ITerm15">
                    
                  </span> advances the stream enough to determine the type of the next token, returning it as a <span class="EmphasisFontCategoryNonProportional ">com.fasterxml.jackson.core.JsonToken</span> instance. When no tokens remain, <span class="EmphasisFontCategoryNonProportional ">null</span> is <span id="ITerm16">returned</span><span id="ITerm17">
                    
                  </span>.</p><p class="Para" id="Par32"><span class="EmphasisFontCategoryNonProportional ">JsonToken</span> is an enum that identifies the basic token types used for returning the results of parsing JSON content. Examples of its various constants are <span class="EmphasisFontCategoryNonProportional ">START_OBJECT</span> (<span class="EmphasisFontCategoryNonProportional ">{</span> was seen) and <span class="EmphasisFontCategoryNonProportional ">END_ARRAY</span> (<span class="EmphasisFontCategoryNonProportional ">]</span> was seen).</p><p class="Para" id="Par33"><span id="ITerm18">
                    <span class="EmphasisFontCategoryNonProportional ">JsonToken</span>
                    
                  </span> also provides various token classification and conversion methods. For example, <span class="EmphasisFontCategoryNonProportional ">boolean isBoolean()</span> returns <span class="EmphasisFontCategoryNonProportional ">true</span> when the token describes a Boolean value, and <span class="EmphasisFontCategoryNonProportional ">boolean isNumeric()</span> returns <span class="EmphasisFontCategoryNonProportional ">true</span> when the token describes a number. Also, <span class="EmphasisFontCategoryNonProportional ">String asString()</span> returns a string representation of the token (e.g., <span class="EmphasisFontCategoryNonProportional ">{</span> for <span class="EmphasisFontCategoryNonProportional ">START_OBJECT</span>) or <span class="EmphasisFontCategoryNonProportional ">null</span> when there is no representation (e.g., <span class="EmphasisFontCategoryNonProportional ">null</span> for <span class="EmphasisFontCategoryNonProportional ">FIELD_NAME</span>鈥攁n object鈥檚 field name has been encountered).</p><p class="Para" id="Par34"><span id="ITerm19">
                    <span class="EmphasisFontCategoryNonProportional ">JsonParser</span>
                    
                  </span> provides various <span class="EmphasisFontCategoryNonProportional ">getValueAs</span> methods for converting a token鈥檚 value to the method鈥檚 return type and returning that value. If conversion fails, <span class="EmphasisFontCategoryNonProportional ">null</span> is returned. For example, <span class="EmphasisFontCategoryNonProportional ">String getValueAsString()</span> tries to convert the current token鈥檚 value to a Java <span class="EmphasisFontCategoryNonProportional ">String</span>, returning <span class="EmphasisFontCategoryNonProportional ">null</span> when the conversion isn鈥檛 possible. The companion <span class="EmphasisFontCategoryNonProportional ">String getValueAsString(String def)</span> method returns a more meaningful <span class="EmphasisFontCategoryNonProportional ">def</span>ault value when conversion fails.</p><div class="Para" id="Par35">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC5">11-1</a></span> presents the source code to an application that demonstrates <span class="EmphasisFontCategoryNonProportional ">JsonParser</span> and <span class="EmphasisFontCategoryNonProportional ">JsonToken</span><span id="ITerm20">
                    
                    
                    
                  </span><span id="ITerm21">
                    
                  </span>.<div class="ProgramCode" id="PC5"><div class="LineGroup"><div class="FixedLine">import java.io.File;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.core.JsonFactory;</div><div class="FixedLine">import com.fasterxml.jackson.core.JsonParser;</div><div class="FixedLine">import com.fasterxml.jackson.core.JsonToken;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class JacksonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args) throws Exception</div><div class="FixedLine">   {</div><div class="FixedLine">      JsonFactory factory = new JsonFactory();</div><div class="FixedLine">      JsonParser parser =</div><div class="FixedLine">         factory.createParser(new File(&quot;person.json&quot;));</div><div class="FixedLine">      while (!parser.isClosed())</div><div class="FixedLine">      {</div><div class="FixedLine">         JsonToken jsonToken = parser.nextToken();</div><div class="FixedLine">         if (jsonToken == null)</div><div class="FixedLine">            break;</div><div class="FixedLine">         out.printf(&quot;jsonToken = %s [%s] [%b] [%s]%n&quot;,</div><div class="FixedLine">                    jsonToken, jsonToken.asString(),</div><div class="FixedLine">                    jsonToken.isNumeric(),</div><div class="FixedLine">                    parser.getValueAsString());</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 11-1</span><p class="SimplePara">Learning How to Use <span class="EmphasisFontCategoryNonProportional ">JsonParser</span> and <span id="ITerm22">
                            <span class="EmphasisFontCategoryNonProportional ">JsonToken</span>
                            
                          </span><span id="ITerm23">
                            
                          </span></p></div></div></div></div><p class="Para" id="Par36">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC5">11-1</a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">main()</span> method first creates a factory and then uses it to create a parser for parsing a file named <span class="EmphasisFontCategoryNonProportional ">person.json</span>. It then enters the previously described loop to obtain and output tokens.</p><div class="Para" id="Par37">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC6">11-2</a></span> presents the JSON document that鈥檚 stored in <span class="EmphasisFontCategoryNonProportional ">person.json</span><span id="ITerm24">
                    
                    
                    
                  </span><span id="ITerm25">
                    
                  </span>.<div class="ProgramCode" id="PC6"><div class="LineGroup"><div class="FixedLine">{</div><div class="FixedLine">   &quot;firstName&quot;: &quot;John&quot;,</div><div class="FixedLine">   &quot;lastName&quot;: &quot;Doe&quot;,</div><div class="FixedLine">   &quot;age&quot;: 42,</div><div class="FixedLine">   &quot;address&quot;:</div><div class="FixedLine">   {</div><div class="FixedLine">      &quot;street&quot;: &quot;400 Some Street&quot;,</div><div class="FixedLine">      &quot;city&quot;: &quot;Beverly Hills&quot;,</div><div class="FixedLine">      &quot;state&quot;: &quot;CA&quot;,</div><div class="FixedLine">      &quot;zipcode&quot;: 90210</div><div class="FixedLine">   },</div><div class="FixedLine">   &quot;phoneNumbers&quot;:</div><div class="FixedLine">   [</div><div class="FixedLine">      {</div><div class="FixedLine">         &quot;type&quot;: &quot;home&quot;,</div><div class="FixedLine">         &quot;number&quot;: &quot;310 555-1234&quot;</div><div class="FixedLine">      },</div><div class="FixedLine">      {</div><div class="FixedLine">         &quot;type&quot;: &quot;fax&quot;,</div><div class="FixedLine">         &quot;number&quot;: &quot;310 555-4567&quot;</div><div class="FixedLine">      }</div><div class="FixedLine">   ]</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 11-2</span><p class="SimplePara">Describing a Person in <span id="ITerm26">JSON</span></p></div></div></div></div><div class="Para" id="Par38">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC5">11-1</a></span> as follows:<div class="ProgramCode" id="PC7"><div class="LineGroup"><div class="FixedLine">javac -cp jackson-core-2.9.7.jar;jackson-databind-2.9.7.jar;jackson-annotations-2.9.7.jar JacksonDemo.java</div></div></div></div><div class="Para" id="Par39">Run the resulting application as follows:<div class="ProgramCode" id="PC8"><div class="LineGroup"><div class="FixedLine">java -cp jackson-core-2.9.7.jar;jackson-databind-2.9.7.jar;jackson-annotations-2.9.7.jar;. JacksonDemo</div></div></div></div><div class="Para" id="Par40">You should observe the following output:<div class="ProgramCode" id="PC9"><div class="LineGroup"><div class="FixedLine">jsonToken = START_OBJECT [{] [false] [null]</div><div class="FixedLine">jsonToken = FIELD_NAME [null] [false] [firstName]</div><div class="FixedLine">jsonToken = VALUE_STRING [null] [false] [John]</div><div class="FixedLine">jsonToken = FIELD_NAME [null] [false] [lastName]</div><div class="FixedLine">jsonToken = VALUE_STRING [null] [false] [Doe]</div><div class="FixedLine">jsonToken = FIELD_NAME [null] [false] [age]</div><div class="FixedLine">jsonToken = VALUE_NUMBER_INT [null] [true] [42]</div><div class="FixedLine">jsonToken = FIELD_NAME [null] [false] [address]</div><div class="FixedLine">jsonToken = START_OBJECT [{] [false] [null]</div><div class="FixedLine">jsonToken = FIELD_NAME [null] [false] [street]</div><div class="FixedLine">jsonToken = VALUE_STRING [null] [false] [400 Some Street]</div><div class="FixedLine">jsonToken = FIELD_NAME [null] [false] [city]</div><div class="FixedLine">jsonToken = VALUE_STRING [null] [false] [Beverly Hills]</div><div class="FixedLine">jsonToken = FIELD_NAME [null] [false] [state]</div><div class="FixedLine">jsonToken = VALUE_STRING [null] [false] [CA]</div><div class="FixedLine">jsonToken = FIELD_NAME [null] [false] [zipcode] <span id="ITerm27">
                          
                          
                          
                        </span><span id="ITerm28">
                          
                        </span></div><div class="FixedLine">jsonToken = VALUE_NUMBER_INT [null] [true] [90210]</div><div class="FixedLine">jsonToken = END_OBJECT [}] [false] [null]</div><div class="FixedLine">jsonToken = FIELD_NAME [null] [false] [phoneNumbers]</div><div class="FixedLine">jsonToken = START_ARRAY [[] [false] [null]</div><div class="FixedLine">jsonToken = START_OBJECT [{] [false] [null]</div><div class="FixedLine">jsonToken = FIELD_NAME [null] [false] [type]</div><div class="FixedLine">jsonToken = VALUE_STRING [null] [false] [home]</div><div class="FixedLine">jsonToken = FIELD_NAME [null] [false] [number]</div><div class="FixedLine">jsonToken = VALUE_STRING [null] [false] [310 555-1234]</div><div class="FixedLine">jsonToken = END_OBJECT [}] [false] [null]</div><div class="FixedLine">jsonToken = START_OBJECT [{] [false] [null]</div><div class="FixedLine">jsonToken = FIELD_NAME [null] [false] [type]</div><div class="FixedLine">jsonToken = VALUE_STRING [null] [false] [fax]</div><div class="FixedLine">jsonToken = FIELD_NAME [null] [false] [number]</div><div class="FixedLine">jsonToken = VALUE_STRING [null] [false] [310 555-4567]</div><div class="FixedLine">jsonToken = END_OBJECT [}] [false] [null]</div><div class="FixedLine">jsonToken = END_ARRAY []] [false] [null]</div><div class="FixedLine">jsonToken = END_OBJECT [}] [false] [null] <span id="ITerm29">
                          
                          
                        </span><span id="ITerm30">
                          
                          
                          
                        </span><span id="ITerm31">
                          
                        </span></div></div></div></div></section><section class="Section3 RenderAsSection3" id="Sec6"><h4 class="Heading">Stream-Based Generation</h4><p class="Para" id="Par41">The <span id="ITerm32">abstract</span><span id="ITerm33">
                    
                  </span>
<span class="EmphasisFontCategoryNonProportional ">com.fasterxml.jackson.core.JsonGenerator</span> class describes a low-level JSON generator. It鈥檚 obtained by calling one of the <span class="EmphasisFontCategoryNonProportional ">JsonFactory</span> class鈥檚 overloaded <span class="EmphasisFontCategoryNonProportional ">createGenerator()</span> methods<span id="ITerm34">
                    
                  </span>, which take the JSON content鈥檚 destination into account.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar4"><h3 class="Heading">Note</h3><p class="Para" id="Par42">Generators can be created to generate content to external destinations, such as files or networks. Content is sent via output streams or writers.</p></div><div class="Para" id="Par43">For example, <span class="EmphasisFontCategoryNonProportional ">JsonFactory</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">JsonGenerator createGenerator(File file, JsonEncoding enc)</span> method creates a generator for writing JSON content to the specified <span class="EmphasisFontCategoryNonProportional ">file</span>, overwriting any existing content (or creating the file when it doesn鈥檛 exist). The value passed to <span class="EmphasisFontCategoryNonProportional ">enc</span> determines how the written JSON content is encoded and is one of the constants defined by the <span class="EmphasisFontCategoryNonProportional ">com.fasterxml.jackson.core.JsonEncoding</span> enum; for example, <span class="EmphasisFontCategoryNonProportional ">JsonEncoding.UTF8</span>. This method is demonstrated as follows:<div class="ProgramCode" id="PC10"><div class="LineGroup"><div class="FixedLine">JsonFactory factory = new JsonFactory();</div><div class="FixedLine">JsonGenerator generator =</div><div class="FixedLine">   factory.createGenerator(new File(&quot;out.json&quot;),</div><div class="FixedLine">                           JsonEncoding.UTF8);</div></div></div></div><p class="Para" id="Par44"><span class="EmphasisFontCategoryNonProportional ">JsonGenerator</span> declares various methods for writing JSON content. For example, <span class="EmphasisFontCategoryNonProportional ">void writeStartObject()</span> writes the starting marker (<span class="EmphasisFontCategoryNonProportional ">{</span>) for an object.</p><div class="Para" id="Par45">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC11">11-3</a></span> presents the source code to an application that demonstrates <span id="ITerm35">
                    <span class="EmphasisFontCategoryNonProportional ">JsonGenerator</span>
                    
                    
                  </span> and methods for writing JSON <span id="ITerm36">content</span><span id="ITerm37">
                    
                  </span>.<div class="ProgramCode" id="PC11"><div class="LineGroup"><div class="FixedLine">import java.io.File;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.core.JsonEncoding;</div><div class="FixedLine">import com.fasterxml.jackson.core.JsonFactory;</div><div class="FixedLine">import com.fasterxml.jackson.core.JsonGenerator;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class JacksonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args) throws Exception</div><div class="FixedLine">   {</div><div class="FixedLine">      JsonFactory factory = new JsonFactory();</div><div class="FixedLine">      JsonGenerator generator =</div><div class="FixedLine">      factory.createGenerator(new File(&quot;person.json&quot;),</div><div class="FixedLine">                              JsonEncoding.UTF8);</div><div class="FixedLine">      generator.writeStartObject();</div><div class="FixedLine">      generator.writeStringField(&quot;firstname&quot;, &quot;John&quot;);</div><div class="FixedLine">      generator.writeStringField(&quot;lastName&quot;, &quot;Doe&quot;);</div><div class="FixedLine">      generator.writeNumberField(&quot;age&quot;, 42);</div><div class="FixedLine">      generator.writeFieldName(&quot;address&quot;);</div><div class="FixedLine">      generator.writeStartObject();</div><div class="FixedLine">      generator.writeStringField(&quot;street&quot;,</div><div class="FixedLine">                                 &quot;400 Some Street&quot;);</div><div class="FixedLine">      generator.writeStringField(&quot;city&quot;, &quot;Beverly Hills&quot;);</div><div class="FixedLine">      generator.writeStringField(&quot;state&quot;, &quot;CA&quot;);</div><div class="FixedLine">      generator.writeNumberField(&quot;zipcode&quot;, 90210);</div><div class="FixedLine">      generator.writeEndObject();</div><div class="FixedLine">      generator.writeFieldName(&quot;phoneNumbers&quot;);</div><div class="FixedLine">      generator.writeStartArray();</div><div class="FixedLine">      generator.writeStartObject();</div><div class="FixedLine">      generator.writeStringField(&quot;type&quot;, &quot;home&quot;);</div><div class="FixedLine">      generator.writeStringField(&quot;number&quot;, &quot;310 555-1234&quot;);</div><div class="FixedLine">      generator.writeEndObject();</div><div class="FixedLine">      generator.writeStartObject();</div><div class="FixedLine">      generator.writeStringField(&quot;type&quot;, &quot;fax&quot;);</div><div class="FixedLine">      generator.writeStringField(&quot;number&quot;, &quot;310 555-4567&quot;);</div><div class="FixedLine">      generator.writeEndObject();<span id="ITerm38">
                          
                          
                          
                        </span><span id="ITerm39">
                          
                        </span></div><div class="FixedLine">      generator.writeEndArray();</div><div class="FixedLine">      generator.writeEndObject();</div><div class="FixedLine">      generator.close();</div><div class="FixedLine">      out.println(&quot;person.json successfully generated&quot;);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 11-3</span><p class="SimplePara">Learning How to Use <span class="EmphasisFontCategoryNonProportional ">JsonGenerator</span> and Its <span id="ITerm40">Methods</span></p></div></div></div></div><p class="Para" id="Par46"><span class="EmphasisFontCategoryNonProportional ">writeStartObject()</span> is paired with <span class="EmphasisFontCategoryNonProportional ">writeEndObject()</span>, which writes the end-of-object marker (<span class="EmphasisFontCategoryNonProportional ">}</span>).</p><p class="Para" id="Par47">The <span class="EmphasisFontCategoryNonProportional ">void writeStringField(String fieldName, String value)</span> method writes the specified <span class="EmphasisFontCategoryNonProportional ">fieldName</span> and its value. It鈥檚 equivalent to calling the <span class="EmphasisFontCategoryNonProportional ">void writeFieldName(String value)</span> method followed by the <span class="EmphasisFontCategoryNonProportional ">void writeString(String text)</span> method. The <span class="EmphasisFontCategoryNonProportional ">writeNumberField(String fileName, int value)</span> method is similar to <span class="EmphasisFontCategoryNonProportional ">writeStringField(String fieldName, String value)</span>, but writes an integer value instead. It鈥檚 equivalent to calling <span class="EmphasisFontCategoryNonProportional ">writeFieldName(String value)</span> followed by the <span class="EmphasisFontCategoryNonProportional ">void writeNumber(int value)</span> method.</p><p class="Para" id="Par48">The <span class="EmphasisFontCategoryNonProportional ">void writeStartArray()</span> method<span id="ITerm41">
                    
                  </span> writes the start-of-array marker (<span class="EmphasisFontCategoryNonProportional ">[</span>). Its companion <span class="EmphasisFontCategoryNonProportional ">void writeEndArray()</span> method writes the end-of-array marker (<span class="EmphasisFontCategoryNonProportional ">]</span>).</p><p class="Para" id="Par49">When no more content needs to be written, the generator is closed by calling its <span class="EmphasisFontCategoryNonProportional ">void close()</span> method. The underlying destination is also closed when only the generator has access to the destination.</p><div class="Para" id="Par50">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC11">11-3</a></span> and run the application. You should observe the following output:<div class="ProgramCode" id="PC12"><div class="LineGroup"><div class="FixedLine">person.json successfully generated<span id="ITerm42">
                          
                          
                          
                        </span><span id="ITerm43">
                          
                        </span></div></div></div></div><div class="Para" id="Par51">The generated <span class="EmphasisFontCategoryNonProportional ">person.json</span> file contains the following content:<div class="ProgramCode" id="PC13"><div class="LineGroup"><div class="FixedLine">{&quot;firstname&quot;:&quot;John&quot;,&quot;lastName&quot;:&quot;Doe&quot;,&quot;age&quot;:42,&quot;address&quot;:{&quot;street&quot;:&quot;400 Some Street&quot;,&quot;city&quot;:&quot;Beverly Hills&quot;,&quot;state&quot;:&quot;CA&quot;,&quot;zipcode&quot;:90210},&quot;phoneNumbers&quot;:[{&quot;type&quot;:&quot;home&quot;,&quot;number&quot;:&quot;310 555-1234&quot;},{&quot;type&quot;:&quot;fax&quot;,&quot;number&quot;:&quot;310 555-4567&quot;}]}</div></div></div></div><div class="Para" id="Par52">The output is hard to read but can be improved by installing a pretty printer on the generator. A <em class="EmphasisTypeItalic ">pretty printer</em> is an instance of a class that implements the <span class="EmphasisFontCategoryNonProportional ">com.fasterxml.jackson.core.PrettyPrinter</span> interface and that formats output to make it easier to read. One such class is <span class="EmphasisFontCategoryNonProportional ">com.fasterxml.jackson.core.util.DefaultPrettyPrinter</span>, which employs 2-space indentation with platform-default line feeds. An instance of this class is installed on the generator by invoking <span class="EmphasisFontCategoryNonProportional ">JsonGenerator</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">JsonGenerator useDefaultPrettyPrinter()</span> method<span id="ITerm44">
                    
                  </span>, as follows:<div class="ProgramCode" id="PC14"><div class="LineGroup"><div class="FixedLine">generator.useDefaultPrettyPrinter();</div></div></div></div><div class="Para" id="Par53">I excerpted this code fragment from a third version of the <span class="EmphasisFontCategoryNonProportional ">JacksonDemo</span> application, included in this book鈥檚 code archive. When run, that application generates a <span class="EmphasisFontCategoryNonProportional ">person.json</span> file with the following content:<div class="ProgramCode" id="PC15"><div class="LineGroup"><div class="FixedLine">{</div><div class="FixedLine">  &quot;firstname&quot; : &quot;John&quot;,</div><div class="FixedLine">  &quot;lastName&quot; : &quot;Doe&quot;,</div><div class="FixedLine">  &quot;age&quot; : 42,</div><div class="FixedLine">  &quot;address&quot; : {</div><div class="FixedLine">    &quot;street&quot; : &quot;400 Some Street&quot;,</div><div class="FixedLine">    &quot;city&quot; : &quot;Beverly Hills&quot;,</div><div class="FixedLine">    &quot;state&quot; : &quot;CA&quot;,</div><div class="FixedLine">    &quot;zipcode&quot; : 90210</div><div class="FixedLine">  },</div><div class="FixedLine">  &quot;phoneNumbers&quot; : [ {</div><div class="FixedLine">    &quot;type&quot; : &quot;home&quot;,</div><div class="FixedLine">    &quot;number&quot; : &quot;310 555-1234&quot;</div><div class="FixedLine">  }, {</div><div class="FixedLine">    &quot;type&quot; : &quot;fax&quot;,</div><div class="FixedLine">    &quot;number&quot; : &quot;310 555-4567&quot;</div><div class="FixedLine">  } ] <span id="ITerm45">
                          
                          
                          
                        </span><span id="ITerm46">
                          
                        </span></div><div class="FixedLine">}</div></div></div></div></section></section><section class="Section2 RenderAsSection2" id="Sec7"><h3 class="Heading">Tree Model</h3><p class="Para" id="Par54">The <span id="ITerm47">tree model</span> provides a mutable in-memory tree representation of a JSON document. The <span class="EmphasisFontCategoryNonProportional ">com.fasterxml.jackson.databind.ObjectMapper</span> class is used to build a tree, whose nodes are instances of classes that descend from the abstract <span class="EmphasisFontCategoryNonProportional ">com.fasterxml.jackson.databind.JsonNode</span> class.</p><div class="Para" id="Par55"><span class="EmphasisFontCategoryNonProportional ">ObjectMapper</span> declares several constructors for initializing an object mapper. The noargument <span class="EmphasisFontCategoryNonProportional ">ObjectMapper()</span> constructor<span id="ITerm48">
                  
                </span> is the easiest to use:<div class="ProgramCode" id="PC16"><div class="LineGroup"><div class="FixedLine">ObjectMapper mapper = new ObjectMapper();</div></div></div></div><p class="Para" id="Par56">Once you have an object mapper, you can use it to read a JSON document into a tree, or create a tree and write it to a JSON document.</p><section class="Section3 RenderAsSection3" id="Sec8"><h4 class="Heading">Reading a JSON Document into a Tree</h4><div class="Para" id="Par57">After obtaining an <span class="EmphasisFontCategoryNonProportional ">ObjectMapper</span><span id="ITerm49">
                    
                    
                    
                  </span> instance, an application can invoke one of its overloaded <span class="EmphasisFontCategoryNonProportional ">readTree()</span> methods to read a JSON document into an in-memory tree:<div class="ProgramCode" id="PC17"><div class="LineGroup"><div class="FixedLine">JsonNode rootNode = mapper.readTree(new File(&quot;person.json&quot;));</div></div></div></div><p class="Para" id="Par58">The <span class="EmphasisFontCategoryNonProportional ">JsonNode readTree(File file)</span> method deserializes JSON content from the specified <span class="EmphasisFontCategoryNonProportional ">file</span> into a tree expressed as set of <span class="EmphasisFontCategoryNonProportional ">JsonNode</span> instances. The root node of this tree is returned.</p><div class="Para" id="Par59"><span class="EmphasisFontCategoryNonProportional ">JsonNode</span> provides various methods for accessing tree nodes. Separate methods exist for basic traversal of JSON objects and arrays. Objects are indexed by field name and arrays are indexed by element index. Additionally, it鈥檚 possible to use 鈥渟afe鈥?methods that return dummy <span class="EmphasisFontCategoryNonProportional ">com.fasterxml.jackson.databind.node.MissingNode</span> instances instead of the null reference when an object or array doesn鈥檛 contain an indicated value. Traversal methods include the <span id="ITerm50">following</span><span id="ITerm51">
                    
                    
                    
                  </span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par60"><span class="EmphasisFontCategoryNonProportional ">JsonNode get(int index)</span>: for arrays, returns child element at <span class="EmphasisFontCategoryNonProportional ">index</span> (which is 0-based) when the child element exists. If <span class="EmphasisFontCategoryNonProportional ">index</span> is less than 0 or greater than or equal to the array size, or if the node is not a <span class="EmphasisFontCategoryNonProportional ">com.fasterxml.jackson.databind.node.ArrayNode</span>, <span class="EmphasisFontCategoryNonProportional ">null</span> is returned. Note that JSON null values are of type <span class="EmphasisFontCategoryNonProportional ">com.fasterxml.jackson.databind.node.NullNode</span> and are not represented as the null reference because null indicates that a value doesn鈥檛 exist.</p></li><li><p class="Para" id="Par61"><span class="EmphasisFontCategoryNonProportional ">JsonNode get(String fieldName)</span>: for objects, returns <span class="EmphasisFontCategoryNonProportional ">fieldName</span>鈥檚 value when it exists. If no such field exists or the node is not a <span class="EmphasisFontCategoryNonProportional ">com.fasterxml.jackson.databind.node.ObjectNode</span>, <span class="EmphasisFontCategoryNonProportional ">null</span> is returned. Note that JSON null values are of type <span class="EmphasisFontCategoryNonProportional ">NullNode</span> and are not represented as the null reference because null indicates that a value doesn鈥檛 exist.</p></li><li><p class="Para" id="Par62"><span class="EmphasisFontCategoryNonProportional ">JsonNode path(int index)</span> and <span class="EmphasisFontCategoryNonProportional ">JsonNode path(String fieldName)</span>: These methods are similar to the <span class="EmphasisFontCategoryNonProportional ">get(int)</span> and <span class="EmphasisFontCategoryNonProportional ">get(String)</span> methods. However, instead of returning a Java null reference for missing values, they return a <span class="EmphasisFontCategoryNonProportional ">MissingNode</span> reference. <span class="EmphasisFontCategoryNonProportional ">MissingNode</span> is beneficial in that it implements all <span class="EmphasisFontCategoryNonProportional ">JsonNode</span> methods as expected: it never has any value but can be further traversed (resulting always in a <span class="EmphasisFontCategoryNonProportional ">MissingNode</span>). It鈥檚 very useful for safe traversal: if data is there, it will be traversed; if not, it will eventually result in missing data. This can be considered similar to the SQL <span class="EmphasisFontCategoryNonProportional ">NULL</span> value<span id="ITerm52">
                          
                          
                          
                        </span>.</p></li><li><p class="Para" id="Par63"><span class="EmphasisFontCategoryNonProportional ">JsonNode with(String propertyName)</span> and <span class="EmphasisFontCategoryNonProportional ">JsonNode withArray(String propertyName)</span>: The first method is called on object nodes to access a property that has an object value or, when no such property exists, to create, add, and return the created object node. The second method is called on object nodes to access a property that has an array value or, when no such property exists, to create, add, and return the created array node. These methods are very useful for safe modifications: subtrees can be materialized as <span id="ITerm53">necessary</span>.</p></li></ul></div></div><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar5"><h3 class="Heading">Note</h3><p class="Para" id="Par64"><span class="EmphasisFontCategoryNonProportional ">ArrayNode</span> provides an <span class="EmphasisFontCategoryNonProportional ">int size()</span> method that returns the number of elements in an array. <span class="EmphasisFontCategoryNonProportional ">ObjectNode</span> provides an <span class="EmphasisFontCategoryNonProportional ">int size()</span> method that returns the number of properties in an object.</p></div><div class="Para" id="Par65">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC18">11-4</a></span> presents the source code to an application that demonstrates <span class="EmphasisFontCategoryNonProportional ">readTree()</span> and associated methods.<div class="ProgramCode" id="PC18"><div class="LineGroup"><div class="FixedLine">import java.io.File;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.databind.JsonNode;</div><div class="FixedLine">import com.fasterxml.jackson.databind.ObjectMapper;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class JacksonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args) throws Exception</div><div class="FixedLine">   {</div><div class="FixedLine">      ObjectMapper mapper = new ObjectMapper();</div><div class="FixedLine">      JsonNode rootNode =</div><div class="FixedLine">         mapper.readTree(new File(&quot;person.json&quot;));</div><div class="FixedLine">      out.printf(&quot;firstName = %s%n&quot;,</div><div class="FixedLine">                 rootNode.get(&quot;firstName&quot;));</div><div class="FixedLine">      out.printf(&quot;lastName = %s%n&quot;,</div><div class="FixedLine">                 rootNode.get(&quot;lastName&quot;));</div><div class="FixedLine">      out.printf(&quot;age = %s%n&quot;, rootNode.get(&quot;age&quot;));</div><div class="FixedLine">      JsonNode address = rootNode.get(&quot;address&quot;);</div><div class="FixedLine">      out.println(&quot;address&quot;);</div><div class="FixedLine">      out.printf(&quot;   street = %s%n&quot;, address.get(&quot;street&quot;));</div><div class="FixedLine">      out.printf(&quot;   city = %s%n&quot;, address.get(&quot;city&quot;));</div><div class="FixedLine">      out.printf(&quot;   state = %s%n&quot;, address.get(&quot;state&quot;));</div><div class="FixedLine">      out.printf(&quot;   zipcode = %s%n&quot;,</div><div class="FixedLine">                 address.get(&quot;zipcode&quot;));</div><div class="FixedLine">      JsonNode phoneNumbers = rootNode.get(&quot;phoneNumbers&quot;);</div><div class="FixedLine">      out.println(&quot;phoneNumbers&quot;);</div><div class="FixedLine">      for (int i = 0; i &lt; phoneNumbers.size(); i++)</div><div class="FixedLine">      {</div><div class="FixedLine">         out.printf(&quot;   %d: &quot;, i);</div><div class="FixedLine">         JsonNode phoneNumber = phoneNumbers.get(i);</div><div class="FixedLine">         out.printf(&quot;type = %s, number = %s%n&quot;,</div><div class="FixedLine">                    phoneNumber.get(&quot;type&quot;),</div><div class="FixedLine">                    phoneNumber.get(&quot;number&quot;));</div><div class="FixedLine">      }</div><div class="FixedLine">      out.println();</div><div class="FixedLine">      out.printf(&quot;%s%n&quot;, rootNode.with(&quot;address&quot;).</div><div class="FixedLine">                                  get(&quot;street&quot;));</div><div class="FixedLine">      out.printf(&quot;%s%n&quot;, rootNode.withArray(&quot;phoneNumbers&quot;).</div><div class="FixedLine">                                  get(1).get(&quot;type&quot;));</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 11-4</span><p class="SimplePara">Reading a JSON Document into a Tree and Traversing the <span id="ITerm54">Tree</span></p></div></div></div></div><div class="Para" id="Par66">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC18">11-4</a></span> and run the application. Assuming that the current directory also contains Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC6">11-2</a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">person.json</span> file, you should observe the following output:<div class="ProgramCode" id="PC19"><div class="LineGroup"><div class="FixedLine">firstName = &quot;John&quot;</div><div class="FixedLine">lastName = &quot;Doe&quot;</div><div class="FixedLine">age = 42</div><div class="FixedLine">address</div><div class="FixedLine">   street = &quot;400 Some Street&quot;</div><div class="FixedLine">   city = &quot;Beverly Hills&quot;</div><div class="FixedLine">   state = &quot;CA&quot;</div><div class="FixedLine">   zipcode = 90210<span id="ITerm55">
                          
                          
                          
                        </span></div><div class="FixedLine">phoneNumbers</div><div class="FixedLine">   0: type = &quot;home&quot;, number = &quot;310 555-1234&quot;</div><div class="FixedLine">   1: type = &quot;fax&quot;, number = &quot;310 555-4567&quot;</div></div><div class="LineGroup"><div class="FixedLine">400 Some Street</div><div class="FixedLine">fax<span id="ITerm56">
                          
                          
                          
                        </span></div></div></div></div></section><section class="Section3 RenderAsSection3" id="Sec9"><h4 class="Heading">Creating a Tree and Writing It to a JSON Document</h4><div class="Para" id="Par67">An application can invoke the following <span class="EmphasisFontCategoryNonProportional ">ObjectMapper</span> methods to begin construction of a <span id="ITerm57">tree</span>:<div class="ProgramCode" id="PC20"><div class="LineGroup"><div class="FixedLine">ArrayNode createArrayNode()</div><div class="FixedLine">ObjectNode createObjectNode()</div></div></div></div><div class="Para" id="Par68"><span class="EmphasisFontCategoryNonProportional ">JsonNode</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">ArrayNode</span> and <span class="EmphasisFontCategoryNonProportional ">ObjectNode</span> descendants also provide methods for constructing a <span id="ITerm58">tree</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par69"><span class="EmphasisFontCategoryNonProportional ">ArrayNode</span> provides several overloaded <span class="EmphasisFontCategoryNonProportional ">add()</span> methods for appending data to an array. For example, <span class="EmphasisFontCategoryNonProportional ">ArrayNode add(int v)</span> appends an object containing <span class="EmphasisFontCategoryNonProportional ">v</span> to an array. It also provides several overloaded <span class="EmphasisFontCategoryNonProportional ">insert()</span> methods for inserting data into an array. For example, <span class="EmphasisFontCategoryNonProportional ">ArrayNode insert(int index, int v)</span> inserts an object containing <span class="EmphasisFontCategoryNonProportional ">v</span> at the specified <span class="EmphasisFontCategoryNonProportional ">index</span> position in the array.</p></li><li><p class="Para" id="Par70"><span class="EmphasisFontCategoryNonProportional ">ObjectNode</span><span id="ITerm59">
                          
                          
                        </span> provides several overloaded <span class="EmphasisFontCategoryNonProportional ">put()</span> methods for updating a property. For example, <span class="EmphasisFontCategoryNonProportional ">ObjectNode put(String fieldName, int v)</span> sets <span class="EmphasisFontCategoryNonProportional ">fieldName</span>鈥檚 value to an object containing <span class="EmphasisFontCategoryNonProportional ">v</span><span id="ITerm60">
                          
                          
                          
                        </span>.</p></li></ul></div></div><div class="Para" id="Par71">Once the tree has been constructed, it can be written to a JSON document by invoking one of <span class="EmphasisFontCategoryNonProportional ">ObjectMapper</span>鈥檚 overloaded <span class="EmphasisFontCategoryNonProportional ">writeTree()</span> methods:<div class="ProgramCode" id="PC21"><div class="LineGroup"><div class="FixedLine">mapper.writeTree(generator, rootNode);</div></div></div></div><p class="Para" id="Par72">The <span class="EmphasisFontCategoryNonProportional ">void writeTree(JsonGenerator gen, JsonNode rootNode)</span> method serializes the <span class="EmphasisFontCategoryNonProportional ">rootNode</span>-anchored tree to a destination via generator <span class="EmphasisFontCategoryNonProportional ">gen</span>.</p><div class="Para" id="Par73">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC22">11-5</a></span> presents the source code to an application that demonstrates <span class="EmphasisFontCategoryNonProportional ">writeTree()</span> and associated methods.<div class="ProgramCode" id="PC22"><div class="LineGroup"><div class="FixedLine">import java.io.File;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.core.JsonEncoding;</div><div class="FixedLine">import com.fasterxml.jackson.core.JsonFactory;</div><div class="FixedLine">import com.fasterxml.jackson.core.JsonGenerator;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.databind.JsonNode;</div><div class="FixedLine">import com.fasterxml.jackson.databind.ObjectMapper;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.databind.node.ArrayNode;</div><div class="FixedLine">import com.fasterxml.jackson.databind.node.ObjectNode;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class JacksonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args) throws Exception</div><div class="FixedLine">   {</div><div class="FixedLine">      ObjectMapper mapper = new ObjectMapper();</div><div class="FixedLine">      JsonNode rootNode = mapper.createObjectNode();</div><div class="FixedLine">      ObjectNode objectNode = (ObjectNode) rootNode;</div><div class="FixedLine">      objectNode.put(&quot;firstName&quot;, &quot;John&quot;);</div><div class="FixedLine">      objectNode.put(&quot;lastName&quot;, &quot;Doe&quot;);</div><div class="FixedLine">      objectNode.put(&quot;age&quot;, 42);</div><div class="FixedLine">      ObjectNode addressNode = mapper.createObjectNode();</div><div class="FixedLine">      addressNode.put(&quot;street&quot;, &quot;400 Some Street&quot;);</div><div class="FixedLine">      addressNode.put(&quot;city&quot;, &quot;Beverly Hills&quot;);</div><div class="FixedLine">      addressNode.put(&quot;state&quot;, &quot;CA&quot;);</div><div class="FixedLine">      addressNode.put(&quot;zipcode&quot;, 90210);</div><div class="FixedLine">      objectNode.set(&quot;address&quot;, addressNode);</div><div class="FixedLine">      ArrayNode phoneNumbersNode = mapper.createArrayNode();</div><div class="FixedLine">      ObjectNode phoneNumberNode =</div><div class="FixedLine">         mapper.createObjectNode();</div><div class="FixedLine">      phoneNumberNode.put(&quot;type&quot;, &quot;home&quot;);</div><div class="FixedLine">      phoneNumberNode.put(&quot;number&quot;, &quot;310 555-1234&quot;);</div><div class="FixedLine">      phoneNumbersNode.add(phoneNumberNode);</div><div class="FixedLine">      phoneNumberNode = mapper.createObjectNode();</div><div class="FixedLine">      phoneNumberNode.put(&quot;type&quot;, &quot;fax&quot;);</div><div class="FixedLine">      phoneNumberNode.put(&quot;number&quot;, &quot;310 555-4567&quot;);</div><div class="FixedLine">      phoneNumbersNode.add(phoneNumberNode);</div><div class="FixedLine">      objectNode.set(&quot;phoneNumbers&quot;, phoneNumbersNode);</div><div class="FixedLine">      JsonFactory factory = new JsonFactory();</div><div class="FixedLine">      JsonGenerator generator =</div><div class="FixedLine">         factory.createGenerator(new File(&quot;person.json&quot;),</div><div class="FixedLine">                                 JsonEncoding.UTF8);</div><div class="FixedLine">      generator.useDefaultPrettyPrinter();</div><div class="FixedLine">      mapper.writeTree(generator, rootNode);</div><div class="FixedLine">      out.println(&quot;person.json successfully generated&quot;)<span id="ITerm61">
                          
                          
                          
                        </span>;</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 11-5</span><p class="SimplePara">Creating a Tree and Writing Its Nodes to a JSON <span id="ITerm62">Document</span></p></div></div></div></div><div class="Para" id="Par74">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC22">11-5</a></span> and run the application. You should observe the following output, along with a generated <span class="EmphasisFontCategoryNonProportional ">person.json</span> file containing pretty-printed content:<div class="ProgramCode" id="PC23"><div class="LineGroup"><div class="FixedLine">person.json successfully generated<span id="ITerm63">
                          
                          
                          
                        </span></div></div></div></div></section></section><section class="Section2 RenderAsSection2" id="Sec10"><h3 class="Heading">Data Binding</h3><p class="Para" id="Par75">The <span class="EmphasisFontCategoryNonProportional ">ObjectMapper</span> class supports <span id="ITerm64">
                  <em class="EmphasisTypeItalic ">data binding</em>
                  
                </span> in which JSON content is parsed to and from Java objects such as POJOs. JSON content is <em class="EmphasisTypeItalic ">deserialized</em> into Java objects, and Java objects are <em class="EmphasisTypeItalic ">serialized</em> into JSON content.</p><div class="Para" id="Par76">Deserialization is achieved by calling one of <span class="EmphasisFontCategoryNonProportional ">ObjectMapper</span>鈥檚 overloaded <span class="EmphasisFontCategoryNonProportional ">readValue()</span> generic <span id="ITerm65">methods</span>, which support deserialization from different sources. For example, the following method deserializes from a file into the given Java type:<div class="ProgramCode" id="PC24"><div class="LineGroup"><div class="FixedLine">&lt;T&gt; T readValue(File src, Class&lt;T&gt; valueType)</div></div></div></div><div class="Para" id="Par77">This method doesn鈥檛 support generic types because of type erasure (<span class="ExternalRef"><a href="http://en.wikipedia.org/wiki/Type_erasure"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://en.wikipedia.org/wiki/Type_erasure</span>
                  </span></a></span>). In contrast, the following method uses the <span class="EmphasisFontCategoryNonProportional ">com.fasterxml.jackson.core.type.TypeReference&lt;T&gt;</span> type to support generic types:<div class="ProgramCode" id="PC25"><div class="LineGroup"><div class="FixedLine">&lt;T&gt; T readValue(File src, TypeReference valueTypeRef)</div></div></div></div><p class="Para" id="Par78"><span class="EmphasisFontCategoryNonProportional ">TypeReference</span> is a generic abstract class that鈥檚 used to obtain full generic type information via subclassing. I鈥檒l show an example shortly.</p><div class="Para" id="Par79">Serialization is achieved by calling one of <span class="EmphasisFontCategoryNonProportional ">ObjectMapper</span>鈥檚 overloaded <span class="EmphasisFontCategoryNonProportional ">writeValue()</span> methods, which support serialization to different destinations. For example, the following method serializes a Java object to a file:<div class="ProgramCode" id="PC26"><div class="LineGroup"><div class="FixedLine">writeValue(File resultFile, Object value)</div></div></div></div><p class="Para" id="Par80">Jackson supports simple data binding and full data binding.</p><section class="Section3 RenderAsSection3" id="Sec11"><h4 class="Heading">Simple Data Binding</h4><div class="Para" id="Par81"><span id="ITerm66">
                    <em class="EmphasisTypeItalic ">Simple data binding</em>
                    
                  </span> converts to and from a limited number of core JDK <span id="ITerm67">types</span>. Table <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#Tab1">11-1</a></span> reveals the JSON types and the core JDK types to which they are mapped.<div class="Table" id="Tab1"><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Table 11-1</span><p class="SimplePara">Mapping JSON <span id="ITerm68">Types</span> to Java Types</p></div></div><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="tcol1 align-left"><col class="tcol2 align-left"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">JSON Type</p></th><th style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Java Type</p></th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">object</p></td><td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">
                              <span class="EmphasisFontCategoryNonProportional ">java.util.LinkedHashMap&lt;String,Object&gt;</span>
                            </p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">array</p></td><td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">
                              <span class="EmphasisFontCategoryNonProportional ">java.util.ArrayList&lt;Object&gt;</span>
                            </p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">string</p></td><td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">
                              <span class="EmphasisFontCategoryNonProportional ">java.lang.String</span>
                            </p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">number (no fraction)</p></td><td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">java.lang.Integer</span>, <span class="EmphasisFontCategoryNonProportional ">java.lang.Long</span>, or <span class="EmphasisFontCategoryNonProportional ">java.math.BigInteger</span> (smallest applicable)</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">number (fraction)</p></td><td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara"><span class="EmphasisFontCategoryNonProportional ">java.lang.Double</span> (configurable to use <span class="EmphasisFontCategoryNonProportional ">java.math.BigDecimal</span>)</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">true|false</p></td><td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">
                              <span class="EmphasisFontCategoryNonProportional ">java.lang.Boolean</span>
                            </p></td></tr><tr><td style="border-right: 0.5pt solid ; text-align: left;"><p class="SimplePara">null</p></td><td style="text-align: left;"><p class="SimplePara">null reference</p></td></tr></tbody></table></div></div><div class="Para" id="Par82">The following example invokes <span class="EmphasisFontCategoryNonProportional ">readValue()</span> to read a JSON object into a Java map:<div class="ProgramCode" id="PC27"><div class="LineGroup"><div class="FixedLine">Map&lt;?,?&gt; rootAsMap = mapper.readValue(src, Map.class);</div></div></div></div><div class="Para" id="Par83">The <span class="EmphasisFontCategoryNonProportional ">&lt;?,?&gt;</span> syntax indicates an untyped map. To bind data into a generic map, such as <span class="EmphasisFontCategoryNonProportional ">Map&lt;String,User&gt;</span>, I would need to specify <span class="EmphasisFontCategoryNonProportional ">TypeReference</span> as follows:<div class="ProgramCode" id="PC28"><div class="LineGroup"><div class="FixedLine">Map&lt;String,User&gt; rootAsMap =</div><div class="FixedLine">   mapper.readValue(src,</div><div class="FixedLine">                    new TypeReference&lt;Map&lt;String,User&gt;&gt;(){});</div></div></div></div><p class="Para" id="Par84"><span class="EmphasisFontCategoryNonProportional ">TypeReference</span> is needed only to pass a generic type definition (via an anonymous inner class in this case). What鈥檚 important is <span class="EmphasisFontCategoryNonProportional ">&lt;Map&lt;String,User&gt;&gt;</span>, which defines the type to bind <span id="ITerm69">to</span>.</p><div class="Para" id="Par85">Because the range of value types is limited to a few core JDK types, the deserialization type (at the root or lower level) can be defined as <span class="EmphasisFontCategoryNonProportional ">Object.class</span>. Any value declared to be of <span class="EmphasisFontCategoryNonProportional ">java.lang.Object</span> type uses simple data binding:<div class="ProgramCode" id="PC29"><div class="LineGroup"><div class="FixedLine">Object root = mapper.readValue(src, Object.class);</div></div></div></div><div class="Para" id="Par86">After creating the Java object, it can be serialized to a file or other destination by invoking <span class="EmphasisFontCategoryNonProportional ">writeValue()</span>, which is demonstrated as follows:<div class="ProgramCode" id="PC30"><div class="LineGroup"><div class="FixedLine">mapper.writeValue(new File(&quot;file.json&quot;), rootAsMap);</div></div></div></div><div class="Para" id="Par87">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC31">11-6</a></span> presents the source code to an application that demonstrates simple data binding via these code fragments.<div class="ProgramCode" id="PC31"><div class="LineGroup"><div class="FixedLine">import java.io.File;</div></div><div class="LineGroup"><div class="FixedLine">import java.util.List;</div><div class="FixedLine">import java.util.Map;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.core.type.TypeReference;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.databind.ObjectMapper;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class JacksonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args) throws Exception</div><div class="FixedLine">   {</div><div class="FixedLine">      ObjectMapper mapper = new ObjectMapper();</div><div class="FixedLine">      String ageJson = &quot;65&quot;;</div><div class="FixedLine">      out.println(mapper.readValue(ageJson, Integer.class));</div><div class="FixedLine">      String planetsJson = &quot;[\&quot;Mercury\&quot;, \&quot;Venus\&quot;, &quot; +</div><div class="FixedLine">                           &quot;\&quot;Earth\&quot;, \&quot;Mars\&quot;]&quot;;</div><div class="FixedLine">      List&lt;?&gt; list1 = mapper.readValue(planetsJson,</div><div class="FixedLine">                                       List.class);</div><div class="FixedLine">      out.println(list1);</div><div class="FixedLine">//      list1.add(&quot;Jupiter&quot;)<span id="ITerm70">
                          
                          
                          
                        </span>;</div><div class="FixedLine">      List&lt;String&gt; list2 =</div><div class="FixedLine">         mapper.readValue(planetsJson,</div><div class="FixedLine">                          new</div><div class="FixedLine">                          TypeReference&lt;List&lt;String&gt;&gt;(){});</div><div class="FixedLine">      out.println(list2);</div><div class="FixedLine">      list2.add(&quot;Jupiter&quot;);</div><div class="FixedLine">      out.println(list2);</div><div class="FixedLine">      String gradesJson = &quot;{\&quot;John\&quot;: 86, \&quot;Jane\&quot;: 92}&quot;;</div><div class="FixedLine">      Map&lt;?,?&gt; map = mapper.readValue(gradesJson,</div><div class="FixedLine">                                      Map.class);</div><div class="FixedLine">      out.println(map);</div><div class="FixedLine">      mapper.writeValue(new File(&quot;grades.json&quot;), map);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 11-6</span><p class="SimplePara">A Simple <span id="ITerm71">Data-Binding</span> Demonstration</p></div></div></div></div><p class="Para" id="Par88">After creating an <span class="EmphasisFontCategoryNonProportional ">ObjectMapper</span> instance, Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC31">11-6</a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">main()</span> method maps a JSON number to a Java <span class="EmphasisFontCategoryNonProportional ">Integer</span>, which is output.</p><p class="Para" id="Par89"><span class="EmphasisFontCategoryNonProportional ">main()</span> now maps a string-based JSON array to a <span class="EmphasisFontCategoryNonProportional ">List</span>. Because the resulting <span class="EmphasisFontCategoryNonProportional ">list1</span> object has <span class="EmphasisFontCategoryNonProportional ">List&lt;?&gt;</span> type, the compiler will not compile <span class="EmphasisFontCategoryNonProportional ">list1.add(&quot;Jupiter&quot;);</span>. There鈥檚 no <span class="EmphasisFontCategoryNonProportional ">add(String)</span> method when the unbounded wildcard type is specified. Although this problem could be solved by specifying <span class="EmphasisFontCategoryNonProportional ">List list1</span> (giving <span class="EmphasisFontCategoryNonProportional ">list1</span> the raw <span class="EmphasisFontCategoryNonProportional ">List</span> type), any Java object could be stored in the <span class="EmphasisFontCategoryNonProportional ">List</span>, which would violate type safety. Generics must be used to solve this <span id="ITerm72">problem</span>.</p><p class="Para" id="Par90">The <span class="EmphasisFontCategoryNonProportional ">main()</span> method next creates a list of strings and uses <span class="EmphasisFontCategoryNonProportional ">TypeReference</span> to pass <span class="EmphasisFontCategoryNonProportional ">String</span> to <span class="EmphasisFontCategoryNonProportional ">readValue()</span>. The compiler is able to compile <span class="EmphasisFontCategoryNonProportional ">list1.add(&quot;Jupiter&quot;);</span> because <span class="EmphasisFontCategoryNonProportional ">List&lt;String&gt;</span> has an <span class="EmphasisFontCategoryNonProportional ">add(String)</span> method.</p><p class="Para" id="Par91"><span class="EmphasisFontCategoryNonProportional ">main()</span> now switches focus to working with <span class="EmphasisFontCategoryNonProportional ">Map</span>. After creating a grades-oriented map, it outputs the map and uses <span class="EmphasisFontCategoryNonProportional ">writeValue()</span> to write the map鈥檚 content to a file named <span class="EmphasisFontCategoryNonProportional ">grades.json</span>.</p><div class="Para" id="Par92">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC31">11-6</a></span> and run the application. You should observe the following output:<div class="ProgramCode" id="PC32"><div class="LineGroup"><div class="FixedLine">65</div><div class="FixedLine">[Mercury, Venus, Earth, Mars]</div><div class="FixedLine">[Mercury, Venus, Earth, Mars]</div><div class="FixedLine">[Mercury, Venus, Earth, Mars, Jupiter]</div><div class="FixedLine">{John=86, Jane=92}</div></div></div></div><div class="Para" id="Par93">Furthermore, you should observe a <span class="EmphasisFontCategoryNonProportional ">grades.json</span> file in the current directory. This file should contain the following content:<div class="ProgramCode" id="PC33"><div class="LineGroup"><div class="FixedLine">{&quot;John&quot;:86,&quot;Jane&quot;:92}<span id="ITerm73">
                          
                          
                          
                        </span></div></div></div></div></section><section class="Section3 RenderAsSection3" id="Sec12"><h4 class="Heading">Full Data Binding</h4><div class="Para" id="Par94"><span id="ITerm74">
                    <em class="EmphasisTypeItalic ">Full data binding</em>
                    
                  </span> converts to and from any Java bean <span id="ITerm75">type</span> in addition to <span class="EmphasisFontCategoryNonProportional ">Map</span>s, <span class="EmphasisFontCategoryNonProportional ">List</span>s, <span class="EmphasisFontCategoryNonProportional ">String</span>s, <span class="EmphasisFontCategoryNonProportional ">Number</span>s, <span class="EmphasisFontCategoryNonProportional ">Boolean</span>s, and the null reference. Consider Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC34">11-7</a></span>.<div class="ProgramCode" id="PC34"><div class="LineGroup"><div class="FixedLine">/*</div><div class="FixedLine">{</div><div class="FixedLine">   &quot;firstName&quot;: &quot;John&quot;,</div><div class="FixedLine">   &quot;lastName&quot;: &quot;Doe&quot;,</div><div class="FixedLine">   &quot;age&quot;: 42,</div><div class="FixedLine">   &quot;address&quot;:</div><div class="FixedLine">   {</div><div class="FixedLine">      &quot;street&quot;: &quot;400 Some Street&quot;,</div><div class="FixedLine">      &quot;city&quot;: &quot;Beverly Hills&quot;,</div><div class="FixedLine">      &quot;state&quot;: &quot;CA&quot;,</div><div class="FixedLine">      &quot;zipcode&quot;: 90210</div><div class="FixedLine">   },</div><div class="FixedLine">   &quot;phoneNumbers&quot;:</div><div class="FixedLine">   [</div><div class="FixedLine">      {</div><div class="FixedLine">         &quot;type&quot;: &quot;home&quot;,</div><div class="FixedLine">         &quot;number&quot;: &quot;310 555-1234&quot;</div><div class="FixedLine">      },</div><div class="FixedLine">      {</div><div class="FixedLine">         &quot;type&quot;: &quot;fax&quot;,</div><div class="FixedLine">         &quot;number&quot;: &quot;310 555-4567&quot;</div><div class="FixedLine">      }</div><div class="FixedLine">   ]</div><div class="FixedLine">}</div><div class="FixedLine">*/</div></div><div class="LineGroup"><div class="FixedLine">public class Person<span id="ITerm76">
                          
                          
                          
                        </span></div><div class="FixedLine">{</div><div class="FixedLine">   private String firstName;</div><div class="FixedLine">   private String lastName;</div><div class="FixedLine">   private int age;</div></div><div class="LineGroup"><div class="FixedLine">   public static class Address</div><div class="FixedLine">   {</div><div class="FixedLine">      private String street, city, state;</div><div class="FixedLine">      private int zipcode;</div></div><div class="LineGroup"><div class="FixedLine">      public String getStreet()</div><div class="FixedLine">      {</div><div class="FixedLine">         return street;</div><div class="FixedLine">      }</div></div><div class="LineGroup"><div class="FixedLine">      public String getCity()</div><div class="FixedLine">      {</div><div class="FixedLine">         return city;</div><div class="FixedLine">      }</div></div><div class="LineGroup"><div class="FixedLine">      public String getState()</div><div class="FixedLine">      {</div><div class="FixedLine">         return state;</div><div class="FixedLine">      }</div></div><div class="LineGroup"><div class="FixedLine">      public int getZipcode()</div><div class="FixedLine">      {</div><div class="FixedLine">         return zipcode;</div><div class="FixedLine">      }</div></div><div class="LineGroup"><div class="FixedLine">      public void setStreet(String street)</div><div class="FixedLine">      {</div><div class="FixedLine">         this.street = street;</div><div class="FixedLine">      }</div></div><div class="LineGroup"><div class="FixedLine">      public void setCity(String city)</div><div class="FixedLine">      {</div><div class="FixedLine">         this.city = city;</div><div class="FixedLine">      }</div></div><div class="LineGroup"><div class="FixedLine">      public void setState(String state)</div><div class="FixedLine">      {</div><div class="FixedLine">         this.state = state<span id="ITerm77">
                          
                          
                          
                        </span>;</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   private Address address;</div></div><div class="LineGroup"><div class="FixedLine">   public static class PhoneNumber</div><div class="FixedLine">   {</div><div class="FixedLine">      private String type, number;</div></div><div class="LineGroup"><div class="FixedLine">      public String getType()</div><div class="FixedLine">      {</div><div class="FixedLine">         return type;</div><div class="FixedLine">      }</div></div><div class="LineGroup"><div class="FixedLine">      public String getNumber()</div><div class="FixedLine">      {</div><div class="FixedLine">         return number;</div><div class="FixedLine">      }</div></div><div class="LineGroup"><div class="FixedLine">      public void setType(String type)</div><div class="FixedLine">      {</div><div class="FixedLine">         this.type = type;</div><div class="FixedLine">      }</div></div><div class="LineGroup"><div class="FixedLine">      public void setNumber(String number)</div><div class="FixedLine">      {</div><div class="FixedLine">         this.number = number;</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   private PhoneNumber[] phoneNumbers;</div></div><div class="LineGroup"><div class="FixedLine">   public String getFirstName()</div><div class="FixedLine">   {</div><div class="FixedLine">      return firstName;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public String getLastName()</div><div class="FixedLine">   {</div><div class="FixedLine">      return lastName;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public int getAge()</div><div class="FixedLine">   {</div><div class="FixedLine">      return age;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public Address getAddress()</div><div class="FixedLine">   {</div><div class="FixedLine">      return address; <span id="ITerm78">
                          
                          
                          
                        </span></div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public PhoneNumber[] getPhoneNumbers()</div><div class="FixedLine">   {</div><div class="FixedLine">      return phoneNumbers;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public void setFirstName(String firstName)</div><div class="FixedLine">   {</div><div class="FixedLine">      this.firstName = firstName;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public void setLastName(String lastName)</div><div class="FixedLine">   {</div><div class="FixedLine">      this.lastName = lastName;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public void setAge(int age)</div><div class="FixedLine">   {</div><div class="FixedLine">      this.age = age;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public void setAddress(Address address)</div><div class="FixedLine">   {</div><div class="FixedLine">      this.address = address;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public void setPhoneNumbers(PhoneNumber[] phoneNumbers)</div><div class="FixedLine">   {</div><div class="FixedLine">      this.phoneNumbers = phoneNumbers;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public String toString()<span id="ITerm79">
                          
                          
                          
                        </span></div><div class="FixedLine">   {</div><div class="FixedLine">      StringBuffer sb = new StringBuffer();</div><div class="FixedLine">      sb.append(&quot;firstName = &quot; + firstName + &quot;\n&quot;);</div><div class="FixedLine">      sb.append(&quot;lastName = &quot; + lastName + &quot;\n&quot;);</div><div class="FixedLine">      sb.append(&quot;age = &quot; + age + &quot;\n&quot;);</div><div class="FixedLine">      sb.append(&quot;address\n&quot;);</div><div class="FixedLine">      sb.append(&quot;   street = &quot; + address.getStreet() +</div><div class="FixedLine">                &quot;\n&quot;);</div><div class="FixedLine">      sb.append(&quot;   city = &quot; + address.getCity() + &quot;\n&quot;);</div><div class="FixedLine">      sb.append(&quot;   state = &quot; + address.getState() + &quot;\n&quot;);</div><div class="FixedLine">      sb.append(&quot;   zipcode = &quot; + address.getZipcode() +</div><div class="FixedLine">                &quot;\n&quot;);</div><div class="FixedLine">      sb.append(&quot;phoneNumbers\n&quot;);</div><div class="FixedLine">      for (int i = 0; i &lt; phoneNumbers.length; i++)</div><div class="FixedLine">      {</div><div class="FixedLine">         sb.append(&quot;   type = &quot; +</div><div class="FixedLine">                   phoneNumbers[i].getType() + &quot;\n&quot;);</div><div class="FixedLine">         sb.append(&quot;   number = &quot; +</div><div class="FixedLine">                   phoneNumbers[i].getNumber() + &quot;\n&quot;);</div><div class="FixedLine">      }</div><div class="FixedLine">      return sb.toString();</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 11-7</span><p class="SimplePara">A Person Bean</p></div></div></div></div><p class="Para" id="Par95">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC34">11-7</a></span> describes a <span class="EmphasisFontCategoryNonProportional ">Person</span> class that corresponds to Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC6">11-2</a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">person.json</span> content. This class adheres to the Java Beans getter/setter method naming conventions.</p><p class="Para" id="Par96">By default, Jackson maps the fields of a JSON object to fields in a Java object by matching the names of the JSON fields to the getter and setter methods in the Java object. Jackson removes the <span class="EmphasisFontCategoryNonProportional ">get</span> and <span class="EmphasisFontCategoryNonProportional ">set</span> parts of the names of the getter and setter methods and converts the first character of the remaining name to lowercase. For example, in Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC34">11-7</a></span>, the JSON <span class="EmphasisFontCategoryNonProportional ">firstName</span> field matches the Java <span class="EmphasisFontCategoryNonProportional ">getFirstName()</span> and <span class="EmphasisFontCategoryNonProportional ">setFirstName()</span> getter and setter <span id="ITerm80">methods</span>.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar6"><h3 class="Heading">Note</h3><p class="Para" id="Par97">A getter method makes a non-<span class="EmphasisFontCategoryNonProportional ">public</span> field serializable and deserializable (once a field has a getter method, it鈥檚 considered to be a property). In contrast, a setter method makes a non-<span class="EmphasisFontCategoryNonProportional ">public</span> field deserializable only. For example, in Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC34">11-7</a></span>, commenting out <span class="EmphasisFontCategoryNonProportional ">setAge()</span> only doesn鈥檛 affect <span class="EmphasisFontCategoryNonProportional ">age</span>鈥檚 serializability/deserializability. However, commenting out <span class="EmphasisFontCategoryNonProportional ">getAge()</span> only prevents <span class="EmphasisFontCategoryNonProportional ">age</span> from being serialized (e.g., via one of <span class="EmphasisFontCategoryNonProportional ">ObjectMapper</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">writeValue()</span> methods).</p></div><div class="Para" id="Par98">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC35">11-8</a></span> presents the source code to an application that demonstrates full data binding with assistance from the <span class="EmphasisFontCategoryNonProportional ">Person</span> class.<div class="ProgramCode" id="PC35"><div class="LineGroup"><div class="FixedLine">import java.io.File;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.databind.ObjectMapper;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.* <span id="ITerm81">
                          
                          
                          
                        </span>;</div></div><div class="LineGroup"><div class="FixedLine">public class JacksonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args) throws Exception</div><div class="FixedLine">   {</div><div class="FixedLine">      ObjectMapper mapper = new ObjectMapper();</div><div class="FixedLine">      Person person =</div><div class="FixedLine">         mapper.readValue(new File(&quot;person.json&quot;),</div><div class="FixedLine">                          Person.class);</div><div class="FixedLine">      out.println(person);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 11-8</span><p class="SimplePara">A Full Data-Binding Demonstration</p></div></div></div></div><p class="Para" id="Par99">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC35">11-8</a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">main()</span> method first instantiates <span class="EmphasisFontCategoryNonProportional ">ObjectMapper</span>. Next, it invokes the mapper鈥檚 <span class="EmphasisFontCategoryNonProportional ">readValue()</span> method to read the contents of <span class="EmphasisFontCategoryNonProportional ">person.json</span> into a <span class="EmphasisFontCategoryNonProportional ">Person</span> object, which is then <span id="ITerm82">printed</span>.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar7"><h3 class="Heading">Note</h3><p class="Para" id="Par100">When using full data binding, the deserialization type must be fully specified as something other than <span class="EmphasisFontCategoryNonProportional ">Object.class</span>, which implies simple data binding. In Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC35">11-8</a></span>, <span class="EmphasisFontCategoryNonProportional ">Person.class</span> is passed to <span class="EmphasisFontCategoryNonProportional ">readValue()</span> as the deserialization type.</p></div><div class="Para" id="Par101">Compile Listings <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC34">11-7</a></span> and <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC35">11-8</a></span> and run the application. Assuming that the current directory also contains Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC6">11-2</a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">person.json</span> file, you should observe the following output:<div class="ProgramCode" id="PC36"><div class="LineGroup"><div class="FixedLine">firstName = John</div><div class="FixedLine">lastName = Doe</div><div class="FixedLine">age = 42</div><div class="FixedLine">address</div><div class="FixedLine">   street = 400 Some Street</div><div class="FixedLine">   city = Beverly Hills</div><div class="FixedLine">   state = CA</div><div class="FixedLine">   zipcode = 90210</div><div class="FixedLine">phoneNumbers</div><div class="FixedLine">   type = home</div><div class="FixedLine">   number = 310 555-1234</div><div class="FixedLine">   type = fax</div><div class="FixedLine">   number = 310 555-4567<span id="ITerm83">
                          
                          
                          
                        </span></div></div></div></div></section></section></section><section class="Section1 RenderAsSection1" id="Sec13"><h2 class="Heading">Working with Jackson鈥檚 Advanced Features</h2><p class="Para" id="Par102">Jackson provides various advanced <span id="ITerm84">features</span>, which focus largely on customization. This section introduces annotation types; custom pretty printers; and factory, parser, and generator features.</p><section class="Section2 RenderAsSection2" id="Sec14"><h3 class="Heading">Annotation Types</h3><p class="Para" id="Par103">The Jackson Annotations and <span id="ITerm85">Jackson</span> Databind packages provide annotation types for influencing how JSON is read into Java objects or what JSON is generated from Java objects. Annotation types are read-only, write-only, or read-write.</p><section class="Section3 RenderAsSection3" id="Sec15"><h4 class="Heading">Read-Only Annotation Types</h4><div class="Para" id="Par104">Read-only annotation <span id="ITerm86">types</span> affect how Jackson deserializes (parses) JSON content into Java objects (i.e., they affect how Jackson reads JSON content). Jackson supports the following read-only annotation types:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par105">
                        <span class="EmphasisFontCategoryNonProportional ">JsonSetter</span>
                      </p></li><li><p class="Para" id="Par106">
                        <span class="EmphasisFontCategoryNonProportional ">JsonAnySetter</span>
                      </p></li><li><p class="Para" id="Par107">
                        <span class="EmphasisFontCategoryNonProportional ">JsonCreator and JsonProperty</span>
                      </p></li><li><p class="Para" id="Par108">
                        <span class="EmphasisFontCategoryNonProportional ">JacksonInject</span>
                      </p></li><li><p class="Para" id="Par109">
                        <span class="EmphasisFontCategoryNonProportional ">JsonDeserialize</span>
                      </p></li></ul></div></div><section class="Section4 RenderAsSection4" id="Sec16"><h5 class="Heading">JsonSetter</h5><p class="Para" id="Par110">Match the annotated <span id="ITerm87">setter</span> method鈥檚 name to a JSON property name when reading JSON content into Java objects. This annotation type is useful when a Java class鈥檚 internal property names don鈥檛 match the JSON document鈥檚 property names.</p><div class="Para" id="Par111">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC37">11-9</a></span> shows <span class="EmphasisFontCategoryNonProportional ">JsonSetter</span> annotating a setter method in a <span class="EmphasisFontCategoryNonProportional ">Person</span> class. Because this method isn鈥檛 present in <span class="EmphasisFontCategoryNonProportional ">Person2</span>, <span class="EmphasisFontCategoryNonProportional ">JsonSetter</span> annotates the field instead.<div class="ProgramCode" id="PC37"><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.annotation.JsonSetter;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.databind.ObjectMapper;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class JacksonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args) throws Exception</div><div class="FixedLine">   {</div><div class="FixedLine">      String jsonContent =</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;   \&quot;id\&quot;: 820787,&quot; +</div><div class="FixedLine">      &quot;   \&quot;firstName\&quot;: \&quot;Pierre\&quot;&quot; +</div><div class="FixedLine">      &quot;}&quot;;</div><div class="FixedLine">      ObjectMapper mapper = new ObjectMapper();</div><div class="FixedLine">      Person person = mapper.readValue(jsonContent,</div><div class="FixedLine">                                       Person.class);</div><div class="FixedLine">      out.println(person);</div><div class="FixedLine">      Person2 person2 = mapper.readValue(jsonContent,</div><div class="FixedLine">                                         Person2.class);</div><div class="FixedLine">      out.println(person2);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">class Person</div><div class="FixedLine">{</div><div class="FixedLine">   private int personID = 0;</div><div class="FixedLine">   private String firstName = null;</div></div><div class="LineGroup"><div class="FixedLine">   public int getPersonID()</div><div class="FixedLine">   {</div><div class="FixedLine">      return personID<span id="ITerm88">
                            
                            
                            
                          </span>;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @JsonSetter(&quot;id&quot;)</div><div class="FixedLine">   public void setPersonID(int personID)</div><div class="FixedLine">   {</div><div class="FixedLine">      this.personID = personID;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public String getFirstName()</div><div class="FixedLine">   {</div><div class="FixedLine">      return firstName;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public void setFirstName(String firstName)</div><div class="FixedLine">   {</div><div class="FixedLine">      this.firstName = firstName;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public String toString()</div><div class="FixedLine">   {</div><div class="FixedLine">      return personID + &quot;: &quot; + firstName;</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">class Person2</div><div class="FixedLine">{</div><div class="FixedLine">   @JsonSetter(&quot;id&quot;)</div><div class="FixedLine">   private int personID = 0;</div><div class="FixedLine">   private String firstName = null;</div></div><div class="LineGroup"><div class="FixedLine">   public int getPersonID()</div><div class="FixedLine">   {</div><div class="FixedLine">      return personID<span id="ITerm89">
                            
                            
                            
                          </span>;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public String getFirstName()</div><div class="FixedLine">   {</div><div class="FixedLine">      return firstName;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public void setFirstName(String firstName)</div><div class="FixedLine">   {</div><div class="FixedLine">      this.firstName = firstName;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public String toString()</div><div class="FixedLine">   {</div><div class="FixedLine">      return personID + &quot;: &quot; + firstName<span id="ITerm90">
                            
                            
                            
                          </span>;</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 11-9</span><p class="SimplePara">Using <span id="ITerm91">
                              <span class="EmphasisFontCategoryNonProportional ">JsonSetter</span>
                              
                            </span> to Match Java Class and JSON Document Property Names</p></div></div></div></div><p class="Para" id="Par112">The value passed to the <span class="EmphasisFontCategoryNonProportional ">@JsonSetter</span> annotation is the name of the JSON field to match to this setter method. Here, the name is <span class="EmphasisFontCategoryNonProportional ">id</span> because that鈥檚 the name of the field in the JSON object to be mapped to the <span class="EmphasisFontCategoryNonProportional ">setPersonID()</span> setter <span id="ITerm92">method</span>.</p><p class="Para" id="Par113"><span class="EmphasisFontCategoryNonProportional ">Person2</span> doesn鈥檛 have a <span class="EmphasisFontCategoryNonProportional ">setPersonID()</span> setter, but this isn鈥檛 a problem because <span class="EmphasisFontCategoryNonProportional ">Person2</span> contains a <span class="EmphasisFontCategoryNonProportional ">getPersonID()</span> getter, making <span class="EmphasisFontCategoryNonProportional ">personID</span> deserializable (via an implicit setter) and serializable (via <span class="EmphasisFontCategoryNonProportional ">getPersonID()</span>).</p><div class="Para" id="Par114">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC37">11-9</a></span> and run the application. You should observe the following output:<div class="ProgramCode" id="PC38"><div class="LineGroup"><div class="FixedLine">820787: Pierre</div><div class="FixedLine">820787: Pierre<span id="ITerm93">
                            
                            
                            
                          </span></div></div></div></div></section><section class="Section4 RenderAsSection4" id="Sec17"><h5 class="Heading">JsonAnySetter</h5><p class="Para" id="Par115">Call the same setter <span id="ITerm94">method</span> for all unrecognized fields in the JSON object. An unrecognized field is one that isn鈥檛 already mapped to a property or setter method in the Java object.</p><div class="Para" id="Par116">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC39">11-10</a></span> shows <span id="ITerm95">
                      <span class="EmphasisFontCategoryNonProportional ">JsonAnySetter</span>
                      
                    </span> annotating a setter method in a <span class="EmphasisFontCategoryNonProportional ">PropContainer</span> class. Without the annotation, the code would fail at runtime.<div class="ProgramCode" id="PC39"><div class="LineGroup"><div class="FixedLine">import java.util.HashMap;</div><div class="FixedLine">import java.util.Iterator;</div><div class="FixedLine">import java.util.Map;</div><div class="FixedLine">import java.util.Map.Entry;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.annotation.JsonAnySetter;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.databind.ObjectMapper;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class JacksonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args) throws Exception</div><div class="FixedLine">   {</div><div class="FixedLine">      String jsonContent =</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;   \&quot;id\&quot;: 820787,&quot; +</div><div class="FixedLine">      &quot;   \&quot;firstName\&quot;: \&quot;Pierre\&quot;,&quot; +</div><div class="FixedLine">      &quot;   \&quot;lastName\&quot;: \&quot;Francois\&quot;&quot; +</div><div class="FixedLine">      &quot;}&quot;;</div><div class="FixedLine">      ObjectMapper mapper = new ObjectMapper();</div><div class="FixedLine">      PropContainer pc =</div><div class="FixedLine">         mapper.readValue(jsonContent, PropContainer.class);</div><div class="FixedLine">      Iterator&lt;Map.Entry&lt;String, Object&gt;&gt; iter =</div><div class="FixedLine">         pc.iterator();</div><div class="FixedLine">      while (iter.hasNext())</div><div class="FixedLine">      {</div><div class="FixedLine">         Map.Entry&lt;String, Object&gt; entry = iter.next();</div><div class="FixedLine">         out.printf(&quot;Key: %s, Value: %s%n&quot;, entry.getKey(),</div><div class="FixedLine">                    entry.getValue());</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">class PropContainer</div><div class="FixedLine">{</div><div class="FixedLine">   // public String lastName;</div></div><div class="LineGroup"><div class="FixedLine">   private Map&lt;String, Object&gt; properties<span id="ITerm96">
                            
                            
                            
                          </span>;</div></div><div class="LineGroup"><div class="FixedLine">   PropContainer()</div><div class="FixedLine">   {</div><div class="FixedLine">      properties = new HashMap&lt;&gt;();</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @JsonAnySetter</div><div class="FixedLine">   void addProperty(String fieldName, Object value)</div><div class="FixedLine">   {</div><div class="FixedLine">      properties.put(fieldName, value);</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   Iterator&lt;Map.Entry&lt;String, Object&gt;&gt; iterator()</div><div class="FixedLine">   {</div><div class="FixedLine">      return properties.entrySet().iterator();</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 11-10</span><p class="SimplePara">Using <span class="EmphasisFontCategoryNonProportional ">JsonAnySetter</span> to Install a Setter Method for Unrecognized JSON Object <span id="ITerm97">Fields</span></p></div></div></div></div><p class="Para" id="Par117">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC39">11-10</a></span> introduces a small JSON object with <span class="EmphasisFontCategoryNonProportional ">id</span>, <span class="EmphasisFontCategoryNonProportional ">firstName</span>, and <span class="EmphasisFontCategoryNonProportional ">lastName</span> fields. It also introduces a <span class="EmphasisFontCategoryNonProportional ">PropContainer</span> class for storing these property names and their values.</p><p class="Para" id="Par118">While parsing these fields from the JSON object into the <span class="EmphasisFontCategoryNonProportional ">PropContainer</span> object, Jackson would look for <span class="EmphasisFontCategoryNonProportional ">setID()</span>, <span class="EmphasisFontCategoryNonProportional ">setFirstName()</span>, and <span class="EmphasisFontCategoryNonProportional ">setLastName()</span> methods. Because these methods don鈥檛 exist and there are no <span class="EmphasisFontCategoryNonProportional ">public id</span>, <span class="EmphasisFontCategoryNonProportional ">firstName</span>, and <span class="EmphasisFontCategoryNonProportional ">lastName</span> fields, Jackson would normally output an error message at runtime. However, the presence of <span class="EmphasisFontCategoryNonProportional ">addProperty()</span> with its <span class="EmphasisFontCategoryNonProportional ">@JsonAnySetter</span> annotation causes Jackson to invoke this method for all three <span id="ITerm98">fields</span>.</p><div class="Para" id="Par119">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC39">11-10</a></span> and run the application. You should observe the following output:<div class="ProgramCode" id="PC40"><div class="LineGroup"><div class="FixedLine">Key: firstName, Value: Pierre</div><div class="FixedLine">Key: lastName, Value: Francois</div><div class="FixedLine">Key: id, Value: 820787</div></div></div></div><div class="Para" id="Par120">Uncomment the line <span class="EmphasisFontCategoryNonProportional ">public String lastName;</span>, recompile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC39">11-10</a></span>, and rerun the application. You should now observe the following output:<div class="ProgramCode" id="PC41"><div class="LineGroup"><div class="FixedLine">Key: firstName, Value: Pierre</div><div class="FixedLine">Key: id, Value: 820787</div></div></div></div><p class="Para" id="Par121">This time, <span class="EmphasisFontCategoryNonProportional ">Key: lastName, Value: Francois</span> doesn鈥檛 appear, because <span class="EmphasisFontCategoryNonProportional ">lastName</span> is no longer an unrecognized property鈥攊t now exists as a property in <span class="EmphasisFontCategoryNonProportional ">PropContainer</span><span id="ITerm99">
                      
                      
                      
                    </span>.</p></section><section class="Section4 RenderAsSection4" id="Sec18"><h5 class="Heading">JsonCreator and JsonProperty</h5><div class="Para" id="Par122"><span id="ITerm100">
                      <span class="EmphasisFontCategoryNonProportional ">JsonCreator</span>
                      
                    </span><span id="ITerm101">
                      
                      
                      
                    </span><span id="ITerm102">
                      
                      
                      
                    </span> tells Jackson that the Java object has a constructor (a 鈥渃reator鈥? that can match, with help from <span id="ITerm103">
                      <span class="EmphasisFontCategoryNonProportional ">JsonProperty</span>
                      
                    </span>, the JSON object鈥檚 fields to the fields of the Java object. These annotation types are useful where it鈥檚 not possible to use the <span class="EmphasisFontCategoryNonProportional ">@JsonSetter</span> annotation. For example, immutable objects cannot have setter methods, so their initial values must be specified in the constructor, which Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC42">11-11</a></span> demonstrates.<div class="ProgramCode" id="PC42"><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.annotation.JsonCreator;</div><div class="FixedLine">import com.fasterxml.jackson.annotation.JsonProperty;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.databind.ObjectMapper;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.* <span id="ITerm104">
                            
                            
                            
                          </span><span id="ITerm105">
                            
                            
                            
                          </span>;</div></div><div class="LineGroup"><div class="FixedLine">public class JacksonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args) throws Exception</div><div class="FixedLine">   {</div><div class="FixedLine">      String jsonContent =</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;   \&quot;make\&quot;: \&quot;Ford\&quot;,&quot; +</div><div class="FixedLine">      &quot;   \&quot;model\&quot;: \&quot;F150\&quot;,&quot; +</div><div class="FixedLine">      &quot;   \&quot;year\&quot;: 2008&quot; +</div><div class="FixedLine">      &quot;}&quot;;</div><div class="FixedLine">      ObjectMapper mapper = new ObjectMapper();</div><div class="FixedLine">      Vehicle vehicle = mapper.readValue(jsonContent,</div><div class="FixedLine">                                         Vehicle.class);</div><div class="FixedLine">      out.printf(&quot;Make %s, Model %s, Year %d%n&quot;,</div><div class="FixedLine">                 vehicle.getMake(), vehicle.getModel(),</div><div class="FixedLine">                 vehicle.getYear());</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">class Vehicle</div><div class="FixedLine">{</div><div class="FixedLine">   private String make, model;</div></div><div class="LineGroup"><div class="FixedLine">   private int year<span id="ITerm106">
                            
                            
                            
                          </span><span id="ITerm107">
                            
                            
                            
                          </span>;</div></div><div class="LineGroup"><div class="FixedLine">   @JsonCreator</div><div class="FixedLine">   Vehicle(@JsonProperty(&quot;make&quot;) String make,</div><div class="FixedLine">           @JsonProperty(&quot;model&quot;) String model,</div><div class="FixedLine">           @JsonProperty(&quot;year&quot;) int year)</div><div class="FixedLine">   {</div><div class="FixedLine">      this.make = make;</div><div class="FixedLine">      this.model = model;</div><div class="FixedLine">      this.year = year;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   String getMake()</div><div class="FixedLine">   {</div><div class="FixedLine">      return make;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   String getModel()</div><div class="FixedLine">   {</div><div class="FixedLine">      return model;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   int getYear()</div><div class="FixedLine">   {</div><div class="FixedLine">      return year;</div><div class="FixedLine">   }</div><div class="FixedLine">}<span id="ITerm108">
                            
                            
                            
                          </span><span id="ITerm109">
                            
                            
                            
                          </span></div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 11-11</span><p class="SimplePara">Using <span class="EmphasisFontCategoryNonProportional ">JsonCreator</span> and <span class="EmphasisFontCategoryNonProportional ">JsonProperty</span> to Call a Constructor When Parsing JSON Text</p></div></div></div></div><p class="Para" id="Par123"><span class="EmphasisFontCategoryNonProportional ">Vehicle</span>鈥檚 constructor is annotated <span class="EmphasisFontCategoryNonProportional ">@JsonCreator</span> to tell Jackson that it should call the constructor when parsing JSON content into a Java object. Furthermore, the constructor鈥檚 parameters are annotated <span class="EmphasisFontCategoryNonProportional ">@JsonProperty</span> to tell Jackson which JSON object fields to pass to which constructor parameters. Note that <span class="EmphasisFontCategoryNonProportional ">@JsonProperty</span> receives a single string argument that identifies the JSON object field name.</p><div class="Para" id="Par124">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC42">11-11</a></span> and run the application. You should observe the following output:<div class="ProgramCode" id="PC43"><div class="LineGroup"><div class="FixedLine">Make Ford, Model F150, Year 2008<span id="ITerm110">
                            
                            
                            
                          </span><span id="ITerm111">
                            
                            
                            
                          </span></div></div></div></div></section><section class="Section4 RenderAsSection4" id="Sec19"><h5 class="Heading">JacksonInject</h5><div class="Para" id="Par125"><em class="EmphasisTypeItalic ">Inject</em><span id="ITerm112">
                      
                    </span><span id="ITerm113">
                      
                      
                      
                    </span> (i.e., set based on an <span class="EmphasisFontCategoryNonProportional ">ObjectMapper</span>-configured value) values into the parsed objects instead of reading those values from the JSON content. For example, suppose I add a <span class="EmphasisFontCategoryNonProportional ">String webURL</span> field to the previous example鈥檚 <span class="EmphasisFontCategoryNonProportional ">Vehicle</span> class. I can tell Jackson to inject the URL of the vehicle鈥檚 manufacturer鈥檚 website into a <span class="EmphasisFontCategoryNonProportional ">Vehicle</span> object by performing the following steps:<div class="OrderedList"><ol><li class="ListItem"><span class="ItemNumber">1.</span><div class="ItemContent"><p class="Para" id="Par126">Annotate <span class="EmphasisFontCategoryNonProportional ">webURL @JacksonInject</span>.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">2.</span><div class="ItemContent"><p class="Para" id="Par127">Instantiate <span class="EmphasisFontCategoryNonProportional ">com.fasterxml.jackson.databind.InjectableValues.Std()</span> and invoke its <span class="EmphasisFontCategoryNonProportional ">addValue(Class&lt;?&gt; classKey, Object value)</span> method to add the string-based URL to an injectable values object.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">3.</span><div class="ItemContent"><p class="Para" id="Par128">Instantiate <span class="EmphasisFontCategoryNonProportional ">ObjectMapper</span>.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">4.</span><div class="ItemContent"><p class="Para" id="Par129">On the <span class="EmphasisFontCategoryNonProportional ">ObjectMapper</span> instance, invoke <span class="EmphasisFontCategoryNonProportional ">ObjectMapper</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">ObjectReader reader(InjectableValues injectableValues)</span> method to construct a <span class="EmphasisFontCategoryNonProportional ">com.fasterxml.jackson.databind.ObjectReader</span> object that will use the specified injectable <span id="ITerm114">values</span>.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">5.</span><div class="ItemContent"><p class="Para" id="Par130">On the <span class="EmphasisFontCategoryNonProportional ">ObjectReader</span> instance, invoke <span class="EmphasisFontCategoryNonProportional ">ObjectReader</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">ObjectReader forType(Class&lt;?&gt; valueType)</span> method to construct a new reader instance that鈥檚 configured to data bind into the specified <span class="EmphasisFontCategoryNonProportional ">valueType</span>.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">6.</span><div class="ItemContent"><p class="Para" id="Par131">On the <span class="EmphasisFontCategoryNonProportional ">ObjectReader</span> instance that <span class="EmphasisFontCategoryNonProportional ">forType()</span> returns, invoke <span class="EmphasisFontCategoryNonProportional ">ObjectReader</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">readValue(String src)</span> method (or a similar <span class="EmphasisFontCategoryNonProportional ">readValue()</span> method) to read the source and perform the injection.</p></div><div class="ClearBoth"> </div></li></ol></div></div><div class="Para" id="Par132">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC44">11-12</a></span> presents the source code to an application that accomplishes these <span id="ITerm115">tasks</span>.<div class="ProgramCode" id="PC44"><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.annotation.JacksonInject;</div><div class="FixedLine">import com.fasterxml.jackson.annotation.JsonCreator;</div><div class="FixedLine">import com.fasterxml.jackson.annotation.JsonProperty;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.databind.InjectableValues;</div><div class="FixedLine">import com.fasterxml.jackson.databind.ObjectMapper;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class JacksonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args) throws Exception</div><div class="FixedLine">   {</div><div class="FixedLine">      String jsonContent =</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;   \&quot;make\&quot;: \&quot;Ford\&quot;,&quot; +</div><div class="FixedLine">      &quot;   \&quot;model\&quot;: \&quot;F150\&quot;,&quot; +</div><div class="FixedLine">      &quot;   \&quot;year\&quot;: 2008&quot; +<span id="ITerm116">
                            
                            
                            
                          </span></div><div class="FixedLine">      &quot;}&quot;;</div><div class="FixedLine">      InjectableValues inject =</div><div class="FixedLine">         new InjectableValues.Std()</div><div class="FixedLine">                             .addValue(String.class,</div><div class="FixedLine">                                       &quot;ford.com&quot;);</div><div class="FixedLine">      Vehicle vehicle =</div><div class="FixedLine">         new ObjectMapper().reader(inject)</div><div class="FixedLine">                           .forType(Vehicle.class)</div><div class="FixedLine">                           .readValue(jsonContent);</div><div class="FixedLine">      out.printf(&quot;Make %s, Model %s, Year %d, URL %s%n&quot;,</div><div class="FixedLine">                 vehicle.getMake(), vehicle.getModel(),</div><div class="FixedLine">                 vehicle.getYear(), vehicle.webURL);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">class Vehicle</div><div class="FixedLine">{</div><div class="FixedLine">   private String make, model;</div></div><div class="LineGroup"><div class="FixedLine">   private int year<span id="ITerm117">
                            
                            
                            
                          </span>;</div></div><div class="LineGroup"><div class="FixedLine">   @JsonCreator</div><div class="FixedLine">   Vehicle(@JsonProperty(&quot;make&quot;) String make,</div><div class="FixedLine">           @JsonProperty(&quot;model&quot;) String model,</div><div class="FixedLine">           @JsonProperty(&quot;year&quot;) int year)</div><div class="FixedLine">   {</div><div class="FixedLine">      this.make = make;</div><div class="FixedLine">      this.model = model;</div><div class="FixedLine">      this.year = year;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   String getMake()</div><div class="FixedLine">   {</div><div class="FixedLine">      return make;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   String getModel()</div><div class="FixedLine">   {</div><div class="FixedLine">      return model;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   int getYear()</div><div class="FixedLine">   {</div><div class="FixedLine">      return year;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @JacksonInject</div><div class="FixedLine">   String webURL;</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 11-12</span><p class="SimplePara">Using <span class="EmphasisFontCategoryNonProportional ">JsonInject</span> to Inject a URL into a Parsed <span class="EmphasisFontCategoryNonProportional ">Vehicle</span> Object</p></div></div></div></div><div class="Para" id="Par133">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC44">11-12</a></span> and run the application. You should observe the following output:<div class="ProgramCode" id="PC45"><div class="LineGroup"><div class="FixedLine">Make Ford, Model F150, Year 2008, URL ford.com<span id="ITerm118">
                            
                            
                            
                          </span></div></div></div></div></section><section class="Section4 RenderAsSection4" id="Sec20"><h5 class="Heading">JsonDeserialize</h5><p class="Para" id="Par134">Specify a custom <span id="ITerm119">deserializer</span><span id="ITerm120">
                      
                      
                      
                    </span> class for a given field in a Java object. For example, suppose a JSON document contains a <span class="EmphasisFontCategoryNonProportional ">color</span> field with a string-based value such as <span class="EmphasisFontCategoryNonProportional ">black</span> or <span class="EmphasisFontCategoryNonProportional ">red</span>. This document is to be deserialized into a <span class="EmphasisFontCategoryNonProportional ">Canvas</span> class that declares a <span class="EmphasisFontCategoryNonProportional ">color</span> field of a <span class="EmphasisFontCategoryNonProportional ">Color</span> enum type. Jackson cannot deserialize this value without help, because it cannot convert a string to an enum instance.</p><p class="Para" id="Par135">The 鈥渉elp鈥?that Jackson requires starts by adding annotation <span class="EmphasisFontCategoryNonProportional ">@JsonDeserialize</span> to the <span class="EmphasisFontCategoryNonProportional ">color</span> field. This annotation type鈥檚 <span class="EmphasisFontCategoryNonProportional ">using</span> parameter is assigned the <span class="EmphasisFontCategoryNonProportional ">java.lang.Class</span> object of the class being used to perform the custom deserialization. Furthermore, that class must subclass the abstract <span class="EmphasisFontCategoryNonProportional ">com.fasterxml.jackson.databind.JsonDeserializer&lt;T&gt;</span> class, where <span class="EmphasisFontCategoryNonProportional ">T</span> is the type of the annotated <span id="ITerm121">field</span>.</p><p class="Para" id="Par136"><span class="EmphasisFontCategoryNonProportional ">JsonDeserializer</span> declares an abstract <span class="EmphasisFontCategoryNonProportional ">T deserialize(JsonParser p, DeserializationContext ctxt)</span> method that Jackson calls to deserialize JSON content into the value type that this deserializer handles. The <span class="EmphasisFontCategoryNonProportional ">JsonParser</span> argument identifies the parser of the JSON content, and the <span class="EmphasisFontCategoryNonProportional ">com.fasterxml.jackson.databind.DeserializationContext</span> argument is used to pass in configuration settings.</p><div class="Para" id="Par137">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC46">11-13</a></span> presents the source code to an application that implements and demonstrates this custom deserialization example.<div class="ProgramCode" id="PC46"><div class="LineGroup"><div class="FixedLine">import java.io.IOException;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.core.JsonParser;</div><div class="FixedLine">import com.fasterxml.jackson.core.JsonProcessingException;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.databind.annotation.</div><div class="FixedLine">       JsonDeserialize;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.databind.</div><div class="FixedLine">       DeserializationContext;</div><div class="FixedLine">import com.fasterxml.jackson.databind.JsonDeserializer;</div><div class="FixedLine">import com.fasterxml.jackson.databind.ObjectMapper;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class JacksonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args) throws Exception</div><div class="FixedLine">   {</div><div class="FixedLine">      String jsonContent =</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;   \&quot;color\&quot;: \&quot;black\&quot;&quot; +</div><div class="FixedLine">      &quot;}&quot;;</div></div><div class="LineGroup"><div class="FixedLine">      Canvas canvas =</div><div class="FixedLine">         new ObjectMapper().readerFor(Canvas.class)</div><div class="FixedLine">                           .readValue(jsonContent); <span id="ITerm122">
                            
                            
                            
                          </span></div><div class="FixedLine">      System.out.printf(&quot;Color = %s%n&quot;, canvas.color);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">enum Color</div><div class="FixedLine">{</div><div class="FixedLine">   BLACK, UNKNOWN</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">class Canvas</div><div class="FixedLine">{</div><div class="FixedLine">   @JsonDeserialize(using = ColorDeserializer.class)</div><div class="FixedLine">   public Color color;</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">class ColorDeserializer extends JsonDeserializer&lt;Color&gt;</div><div class="FixedLine">{</div><div class="FixedLine">   @Override</div><div class="FixedLine">   public Color deserialize(JsonParser jsonParser,</div><div class="FixedLine">                            DeserializationContext</div><div class="FixedLine">                            deserializationContext)</div><div class="FixedLine">      throws IOException, JsonProcessingException</div><div class="FixedLine">   {</div><div class="FixedLine">      switch (jsonParser.getText().toLowerCase())<span id="ITerm123">
                            
                            
                            
                          </span></div><div class="FixedLine">      {</div><div class="FixedLine">         case &quot;black&quot;:</div><div class="FixedLine">            return Color.BLACK;</div></div><div class="LineGroup"><div class="FixedLine">         default:</div><div class="FixedLine">            return Color.UNKNOWN;</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 11-13</span><p class="SimplePara">Using <span class="EmphasisFontCategoryNonProportional ">JsonDeserialize</span> to Deserialize a Color String into a Color Enum <span id="ITerm124">Constant</span></p></div></div></div></div><div class="Para" id="Par138">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC46">11-13</a></span> and run the application. You should observe the following output:<div class="ProgramCode" id="PC47"><div class="LineGroup"><div class="FixedLine">Color = BLACK<span id="ITerm125">
                            
                            
                            
                          </span></div></div></div></div></section></section><section class="Section3 RenderAsSection3" id="Sec21"><h4 class="Heading">Write-Only Annotation Types</h4><div class="Para" id="Par139"><span id="ITerm126">Write-only annotation</span> types affect how Jackson serializes (generates) Java objects into JSON content (i.e., they affect how Jackson writes JSON content). Jackson supports the following write-only annotation types:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par140">
                        <span class="EmphasisFontCategoryNonProportional ">JsonInclude</span>
                      </p></li><li><p class="Para" id="Par141">
                        <span class="EmphasisFontCategoryNonProportional ">JsonGetter</span>
                      </p></li><li><p class="Para" id="Par142">
                        <span class="EmphasisFontCategoryNonProportional ">JsonAnyGetter</span>
                      </p></li><li><p class="Para" id="Par143">
                        <span class="EmphasisFontCategoryNonProportional ">JsonPropertyOrder</span>
                      </p></li><li><p class="Para" id="Par144">
                        <span class="EmphasisFontCategoryNonProportional ">JsonRawValue</span>
                      </p></li><li><p class="Para" id="Par145">
                        <span class="EmphasisFontCategoryNonProportional ">JsonValue</span>
                      </p></li><li><p class="Para" id="Par146">
                        <span class="EmphasisFontCategoryNonProportional ">JsonSerialize</span>
                      </p></li></ul></div></div><section class="Section4 RenderAsSection4" id="Sec22"><h5 class="Heading">JsonInclude</h5><p class="Para" id="Par147">Include properties for <span id="ITerm127">serialization</span> only under certain circumstances. For example, a <span class="EmphasisFontCategoryNonProportional ">String</span> property may be included only if its value isn鈥檛 the null reference.</p><p class="Para" id="Par148"><span id="ITerm128">
                      <span class="EmphasisFontCategoryNonProportional ">JsonInclude</span>
                      
                    </span> can be used to annotate a field, a method parameter, a constructor parameter, or an entire class. When a class is annotated, all properties are checked against the annotation鈥檚 value to see if they can be serialized or not.</p><div class="Para" id="Par149"><span class="EmphasisFontCategoryNonProportional ">JsonInclude</span>鈥檚 value is specified by assigning one of the <span class="EmphasisFontCategoryNonProportional ">JsonInclude.Include</span> enum鈥檚 constants to its <span class="EmphasisFontCategoryNonProportional ">value</span> parameter. Here are three examples:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par150"><span class="EmphasisFontCategoryNonProportional ">ALWAYS</span>: The property is to be included independent of its value. Jackson includes all properties by default (i.e., when <span class="EmphasisFontCategoryNonProportional ">JsonInclude</span> isn鈥檛 used).</p></li><li><p class="Para" id="Par151"><span class="EmphasisFontCategoryNonProportional ">NON_EMPTY</span>: Properties with <span class="EmphasisFontCategoryNonProportional ">null</span> values or what are otherwise considered to be empty (e.g., a string has zero length or a <span class="EmphasisFontCategoryNonProportional ">Map</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">isEmpty()</span> method returns <span class="EmphasisFontCategoryNonProportional ">true</span>) are not included.</p></li><li><p class="Para" id="Par152"><span class="EmphasisFontCategoryNonProportional ">NON_NULL</span>: Properties with <span class="EmphasisFontCategoryNonProportional ">null</span> values are not <span id="ITerm129">included</span>.</p></li></ul></div></div><div class="Para" id="Par153">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC48">11-14</a></span> presents the source code to an application that demonstrates <span class="EmphasisFontCategoryNonProportional ">JsonInclude</span> with these three enum constants.<div class="ProgramCode" id="PC48"><div class="LineGroup"><div class="FixedLine">import java.util.ArrayList;</div><div class="FixedLine">import java.util.List;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.annotation.JsonInclude;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.core.JsonGenerator;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.databind.ObjectMapper;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class JacksonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args) throws Exception</div><div class="FixedLine">   {</div><div class="FixedLine">      ObjectMapper mapper = new ObjectMapper();</div><div class="FixedLine">      mapper.disable(JsonGenerator.Feature.</div><div class="FixedLine">                     AUTO_CLOSE_TARGET);</div><div class="FixedLine">      Person1 person1 = new Person1();</div><div class="FixedLine">      mapper.writeValue(out, person1) <span id="ITerm130">
                            
                            
                            
                          </span>;</div><div class="FixedLine">      out.println();</div><div class="FixedLine">      Person2 person2 = new Person2();</div><div class="FixedLine">      mapper.writeValue(out, person2);</div><div class="FixedLine">      out.println();</div><div class="FixedLine">      Person3 person3 = new Person3();</div><div class="FixedLine">      mapper.writeValue(out, person3);</div><div class="FixedLine">      out.println();</div><div class="FixedLine">      Person4 person4 = new Person4();</div><div class="FixedLine">      mapper.writeValue(out, person4);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">class Person1</div><div class="FixedLine">{</div><div class="FixedLine">   public int personID = 0;</div><div class="FixedLine">   public String firstName = null;</div><div class="FixedLine">   public String lastName = &quot;Doe&quot;;</div><div class="FixedLine">   public List&lt;String&gt; phoneNumbers = new ArrayList&lt;&gt;();</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">@JsonInclude(JsonInclude.Include.ALWAYS)</div><div class="FixedLine">class Person2</div><div class="FixedLine">{</div><div class="FixedLine">   public int personID = 0;</div><div class="FixedLine">   public String firstName = null;</div><div class="FixedLine">   public String lastName = &quot;Doe&quot;;</div><div class="FixedLine">   public List&lt;String&gt; phoneNumbers = new ArrayList&lt;&gt;();</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">@JsonInclude(JsonInclude.Include.NON_EMPTY)</div><div class="FixedLine">class Person3<span id="ITerm131">
                            
                            
                            
                          </span></div><div class="FixedLine">{</div><div class="FixedLine">   public int personID = 0;</div><div class="FixedLine">   public String firstName = null;</div><div class="FixedLine">   public String lastName = &quot;Doe&quot;;</div><div class="FixedLine">   public List&lt;String&gt; phoneNumbers = new ArrayList&lt;&gt;();</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">@JsonInclude(JsonInclude.Include.NON_NULL)</div><div class="FixedLine">class Person4</div><div class="FixedLine">{</div><div class="FixedLine">   public int personID = 0;</div><div class="FixedLine">   public String firstName = null;</div><div class="FixedLine">   public String lastName = &quot;Doe&quot;;</div><div class="FixedLine">   public List&lt;String&gt; phoneNumbers = new ArrayList&lt;&gt;();</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 11-14</span><p class="SimplePara">Using <span class="EmphasisFontCategoryNonProportional ">JsonInclude</span> to Skip or Serialize Empty or Null Properties</p></div></div></div></div><p class="Para" id="Par154"><span class="EmphasisFontCategoryNonProportional ">mapper.disable(JsonGenerator.Feature.AUTO_CLOSE_TARGET);</span> prevents the <span class="EmphasisFontCategoryNonProportional ">System.out</span> stream from being closed after <span class="EmphasisFontCategoryNonProportional ">mapper.writeValue()</span>.</p><div class="Para" id="Par155">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC48">11-14</a></span> and run the application. You should observe the following output:<div class="ProgramCode" id="PC49"><div class="LineGroup"><div class="FixedLine">{&quot;personID&quot;:0,&quot;firstName&quot;:null,&quot;lastName&quot;:&quot;Doe&quot;,&quot;phoneNumbers&quot;:[]}</div><div class="FixedLine">{&quot;personID&quot;:0,&quot;firstName&quot;:null,&quot;lastName&quot;:&quot;Doe&quot;,&quot;phoneNumbers&quot;:[]}</div><div class="FixedLine">{&quot;personID&quot;:0,&quot;lastName&quot;:&quot;Doe&quot;}</div><div class="FixedLine">{&quot;personID&quot;:0,&quot;lastName&quot;:&quot;Doe&quot;,&quot;phoneNumbers&quot;:[]}<span id="ITerm132">
                            
                            
                            
                          </span></div></div></div></div></section><section class="Section4 RenderAsSection4" id="Sec23"><h5 class="Heading">JsonGetter</h5><p class="Para" id="Par156">When serializing a class <span id="ITerm133">instance</span><span id="ITerm134">
                      
                      
                      
                    </span>, call the <span class="EmphasisFontCategoryNonProportional ">@JsonGetter</span>-annotated method and serialize the return value as the property鈥檚 value.</p><div class="Para" id="Par157">This annotation type is useful for Java classes that follow the jQuery (<span class="ExternalRef"><a href="http://en.wikipedia.org/wiki/JQuery"><span class="RefSource">
                        <span class="EmphasisFontCategoryNonProportional ">http://en.wikipedia.org/wiki/JQuery</span>
                      </span></a></span>) style for getter and setter names (such as <span class="EmphasisFontCategoryNonProportional ">numDoors()</span> instead of <span class="EmphasisFontCategoryNonProportional ">getNumDoors()</span>). Consider Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC50">11-15</a></span>.<div class="ProgramCode" id="PC50"><div class="LineGroup"><div class="FixedLine">import java.io.File;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.annotation.JsonGetter;</div><div class="FixedLine">import com.fasterxml.jackson.annotation.JsonSetter;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.databind.ObjectMapper;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.* <span id="ITerm135">
                            
                            
                            
                          </span>;</div></div><div class="LineGroup"><div class="FixedLine">public class JacksonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args) throws Exception</div><div class="FixedLine">   {</div><div class="FixedLine">      String jsonContent =</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;   \&quot;id\&quot;: 820787,&quot; +</div><div class="FixedLine">      &quot;   \&quot;firstName\&quot;: \&quot;Pierre\&quot;&quot; +</div><div class="FixedLine">      &quot;}&quot;;</div><div class="FixedLine">      ObjectMapper mapper = new ObjectMapper();</div><div class="FixedLine">      Person person = mapper.readValue(jsonContent,</div><div class="FixedLine">                                       Person.class);</div><div class="FixedLine">      out.println(person);</div><div class="FixedLine">      mapper.writeValue(new File(&quot;pierre.json&quot;), person);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">class Person</div><div class="FixedLine">{</div><div class="FixedLine">   private int personID = 0;</div><div class="FixedLine">   private String firstName = null;</div></div><div class="LineGroup"><div class="FixedLine">   @JsonGetter(&quot;id&quot;)</div><div class="FixedLine">   public int personID()</div><div class="FixedLine">   {</div><div class="FixedLine">      return personID;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public void setPersonID(int personID)</div><div class="FixedLine">   {</div><div class="FixedLine">      this.personID = personID;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @JsonGetter(&quot;firstName&quot;)</div><div class="FixedLine">   public String firstName()</div><div class="FixedLine">   {</div><div class="FixedLine">      return firstName;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public void setFirstName(String firstName)</div><div class="FixedLine">   {</div><div class="FixedLine">      this.firstName = firstName<span id="ITerm136">
                            
                            
                            
                          </span>;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public String toString()</div><div class="FixedLine">   {</div><div class="FixedLine">      return personID + &quot;: &quot; + firstName;</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 11-15</span><p class="SimplePara">Using <span class="EmphasisFontCategoryNonProportional ">JSonGetter</span> to Serialize jQuery-Style Properties</p></div></div></div></div><p class="Para" id="Par158">The <span class="EmphasisFontCategoryNonProportional ">personId()</span> and <span class="EmphasisFontCategoryNonProportional ">firstName()</span> jQuery-style <span id="ITerm137">methods</span> are annotated <span class="EmphasisFontCategoryNonProportional ">@JsonGetter</span>. The value set on each <span class="EmphasisFontCategoryNonProportional ">@JsonGetter</span> annotation is the property name that Jackson will write to the JSON document.</p><p class="Para" id="Par159">If <span class="EmphasisFontCategoryNonProportional ">@JsonGetter(&quot;id&quot;)</span> is removed from <span class="EmphasisFontCategoryNonProportional ">personID()</span>, Jackson will throw a runtime exception. It will do so because it cannot map the JSON <span class="EmphasisFontCategoryNonProportional ">id</span> property to the Java <span class="EmphasisFontCategoryNonProportional ">personID</span> property鈥?span class=&quot;EmphasisFontCategoryNonProportional &quot;&gt;personID</span> would have to be renamed <span class="EmphasisFontCategoryNonProportional ">getId,</span> and <span class="EmphasisFontCategoryNonProportional ">setPersonID</span> would have to be renamed <span class="EmphasisFontCategoryNonProportional ">setId</span> to remove the exception. If <span class="EmphasisFontCategoryNonProportional ">@JsonGetter(&quot;firstName&quot;)</span> is removed from <span class="EmphasisFontCategoryNonProportional ">firstName()</span>, Jackson won鈥檛 serialize the Java <span class="EmphasisFontCategoryNonProportional ">firstName</span> property to JSON.</p><p class="Para" id="Par160">It isn鈥檛 necessary to annotate <span class="EmphasisFontCategoryNonProportional ">setPersonID() @JsonSetter(&quot;id&quot;)</span>, which was done in Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC37">11-9</a></span>, because the presence of <span class="EmphasisFontCategoryNonProportional ">personID()</span> with its <span class="EmphasisFontCategoryNonProportional ">@JsonGetter(&quot;id&quot;)</span> annotation makes <span class="EmphasisFontCategoryNonProportional ">personID</span> deserializable and serializable.</p><div class="Para" id="Par161">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC50">11-15</a></span> and run the application. You should observe the following output:<div class="ProgramCode" id="PC51"><div class="LineGroup"><div class="FixedLine">820787: Pierre</div></div></div></div><div class="Para" id="Par162">Furthermore, you should observe a <span class="EmphasisFontCategoryNonProportional ">pierre.json</span> file with the following content:<div class="ProgramCode" id="PC52"><div class="LineGroup"><div class="FixedLine">{&quot;id&quot;:820787,&quot;firstName&quot;:&quot;Pierre&quot;}<span id="ITerm138">
                            
                            
                            
                          </span></div></div></div></div></section><section class="Section4 RenderAsSection4" id="Sec24"><h5 class="Heading">JsonAnyGetter</h5><p class="Para" id="Par163">Identify a non-<span class="EmphasisFontCategoryNonProportional ">static</span>, noargument <span id="ITerm139">method</span> that returns a <span class="EmphasisFontCategoryNonProportional ">map</span> of <span id="ITerm140">properties</span> to be serialized to JSON. Each of the map鈥檚 key/value pairs is serialized along with regular properties. This annotation type is the counterpart to <span class="EmphasisFontCategoryNonProportional ">JsonAnySetter</span>.</p><div class="Para" id="Par164">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC53">11-16</a></span> presents an application that demonstrates <span class="EmphasisFontCategoryNonProportional ">JsonAnyGetter</span>. This application extends Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC39">11-10</a></span>, which also demonstrates <span class="EmphasisFontCategoryNonProportional ">JsonAnySetter</span>.<div class="ProgramCode" id="PC53"><div class="LineGroup"><div class="FixedLine">import java.io.File;</div></div><div class="LineGroup"><div class="FixedLine">import java.util.HashMap;</div><div class="FixedLine">import java.util.Iterator;</div><div class="FixedLine">import java.util.Map;</div><div class="FixedLine">import java.util.Map.Entry;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.annotation.JsonAnyGetter;</div><div class="FixedLine">import com.fasterxml.jackson.annotation.JsonAnySetter;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.databind.ObjectMapper;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.* <span id="ITerm141">
                            
                            
                            
                          </span>;</div></div><div class="LineGroup"><div class="FixedLine">public class JacksonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args) throws Exception</div><div class="FixedLine">   {</div><div class="FixedLine">      String jsonContent =</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;   \&quot;id\&quot;: 820787,&quot; +</div><div class="FixedLine">      &quot;   \&quot;firstName\&quot;: \&quot;Pierre\&quot;,&quot; +</div><div class="FixedLine">      &quot;   \&quot;lastName\&quot;: \&quot;Francois\&quot;&quot; +</div><div class="FixedLine">      &quot;}&quot;;</div><div class="FixedLine">      ObjectMapper mapper = new ObjectMapper();</div><div class="FixedLine">      PropContainer pc =</div><div class="FixedLine">         mapper.readValue(jsonContent, PropContainer.class);</div><div class="FixedLine">      Iterator&lt;Map.Entry&lt;String, Object&gt;&gt; iter =</div><div class="FixedLine">         pc.iterator();</div><div class="FixedLine">      while (iter.hasNext())</div><div class="FixedLine">      {</div><div class="FixedLine">         Map.Entry&lt;String, Object&gt; entry = iter.next();</div><div class="FixedLine">         out.printf(&quot;Key: %s, Value: %s%n&quot;, entry.getKey(),</div><div class="FixedLine">                    entry.getValue());</div><div class="FixedLine">      }</div><div class="FixedLine">      mapper.writeValue(new File(&quot;pierre.json&quot;), pc) <span id="ITerm142">
                            
                            
                            
                          </span>;</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">class PropContainer</div><div class="FixedLine">{</div><div class="FixedLine">   public String lastName;</div></div><div class="LineGroup"><div class="FixedLine">   private Map&lt;String, Object&gt; properties;</div></div><div class="LineGroup"><div class="FixedLine">   PropContainer()</div><div class="FixedLine">   {</div><div class="FixedLine">      properties = new HashMap&lt;&gt;();</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @JsonAnySetter</div><div class="FixedLine">   void addProperty(String fieldName, Object value)</div><div class="FixedLine">   {</div><div class="FixedLine">      properties.put(fieldName, value);</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   Iterator&lt;Map.Entry&lt;String, Object&gt;&gt; iterator()</div><div class="FixedLine">   {</div><div class="FixedLine">      return properties.entrySet().iterator();</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @JsonAnyGetter</div><div class="FixedLine">   public Map&lt;String, Object&gt; properties()</div><div class="FixedLine">   {</div><div class="FixedLine">      return properties<span id="ITerm143">
                            
                            
                            
                          </span>;</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 11-16</span><p class="SimplePara">Using <span class="EmphasisFontCategoryNonProportional ">JSonAnyGetter</span> to Serialize a Map of Properties</p></div></div></div></div><div class="Para" id="Par165">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC53">11-16</a></span> and run the application. You should observe the following output:<div class="ProgramCode" id="PC54"><div class="LineGroup"><div class="FixedLine">Key: firstName, Value: Pierre</div><div class="FixedLine">Key: id, Value: 820787</div></div></div></div><p class="Para" id="Par166">Jackson鈥檚 deserialization mechanism doesn鈥檛 add JSON鈥檚 <span class="EmphasisFontCategoryNonProportional ">lastName</span> property to the map because it detects a <span class="EmphasisFontCategoryNonProportional ">lastName</span> property of the <span class="EmphasisFontCategoryNonProportional ">PropContainer</span> class. It updates <span class="EmphasisFontCategoryNonProportional ">lastName</span> instead.</p><div class="Para" id="Par167">You should also observe a <span class="EmphasisFontCategoryNonProportional ">pierre.json</span> file with the following content:<div class="ProgramCode" id="PC55"><div class="LineGroup"><div class="FixedLine">{&quot;lastName&quot;:&quot;Francois&quot;,&quot;firstName&quot;:&quot;Pierre&quot;,&quot;id&quot;:820787}</div></div></div></div><p class="Para" id="Par168">Jackson鈥檚 serialization mechanism first writes <span class="EmphasisFontCategoryNonProportional ">PropContainer</span>鈥檚 regular properties (only <span class="EmphasisFontCategoryNonProportional ">lastName</span> in this case) and then outputs the properties that are stored in the <span id="ITerm144">map</span>.</p></section><section class="Section4 RenderAsSection4" id="Sec25"><h5 class="Heading">JsonPropertyOrder</h5><div class="Para" id="Par169">Specify the order in which a Java object鈥檚 <span id="ITerm145">fields</span><span id="ITerm146">
                      
                      
                      
                    </span> should be serialized to JSON content. This annotation type makes it possible to override the default top-down order with a different order. Consider Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC56">11-17</a></span>.<div class="ProgramCode" id="PC56"><div class="LineGroup"><div class="FixedLine">import java.io.File;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.annotation.JsonPropertyOrder;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.databind.ObjectMapper;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class JacksonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args) throws Exception</div><div class="FixedLine">   {</div><div class="FixedLine">      ObjectMapper mapper = new ObjectMapper();</div><div class="FixedLine">      SomeClass1 sc1 = new SomeClass1();<span id="ITerm147">
                            
                            
                            
                          </span></div><div class="FixedLine">      mapper.writeValue(new File(&quot;order1.json&quot;), sc1);</div><div class="FixedLine">      SomeClass2 sc2 = new SomeClass2();</div><div class="FixedLine">      mapper.writeValue(new File(&quot;order2.json&quot;), sc2);</div><div class="FixedLine">      out.println(&quot;serialization successful&quot;);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">class SomeClass1</div><div class="FixedLine">{</div><div class="FixedLine">   public int a = 1, b = 2, c = 3, d = 4;</div><div class="FixedLine">   public String e = &quot;e&quot;;</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">@JsonPropertyOrder({&quot;e&quot;,&quot;d&quot;,&quot;c&quot;,&quot;b&quot;,&quot;a&quot;})</div><div class="FixedLine">class SomeClass2</div><div class="FixedLine">{</div><div class="FixedLine">   public int a = 1, b = 2, c = 3, d = 4;</div><div class="FixedLine">   public String e = &quot;e&quot;;</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 11-17</span><p class="SimplePara">Using <span class="EmphasisFontCategoryNonProportional ">JSonPropertyOrder</span> to Serialize <span class="EmphasisFontCategoryNonProportional ">SomeClass2</span>鈥檚 Properties in Reverse Order</p></div></div></div></div><p class="Para" id="Par170">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC56">11-17</a></span> declares <span class="EmphasisFontCategoryNonProportional ">SomeClass1</span>, which isn鈥檛 annotated with <span class="EmphasisFontCategoryNonProportional ">JsonPropertyOrder</span>. Therefore, its fields are serialized in top-down order. In contrast, <span class="EmphasisFontCategoryNonProportional ">SomeClass2</span> is annotated so that its fields are serialized in reverse order.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar8"><h3 class="Heading">Note</h3><p class="Para" id="Par171">The <span class="EmphasisFontCategoryNonProportional ">@JsonProperty</span> annotation receives an array of quoted field names whose left-to-right order corresponds to the serialized top-to-bottom order.</p></div><div class="Para" id="Par172">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC56">11-17</a></span> and run the application. You should observe the following output:<div class="ProgramCode" id="PC57"><div class="LineGroup"><div class="FixedLine">serialization successful<span id="ITerm148">
                            
                            
                            
                          </span></div></div></div></div><div class="Para" id="Par173">The generated <span class="EmphasisFontCategoryNonProportional ">order1.json</span> file contains the following content:<div class="ProgramCode" id="PC58"><div class="LineGroup"><div class="FixedLine">{&quot;a&quot;:1,&quot;b&quot;:2,&quot;c&quot;:3,&quot;d&quot;:4,&quot;e&quot;:&quot;e&quot;}</div></div></div></div><div class="Para" id="Par174">The generated <span class="EmphasisFontCategoryNonProportional ">order2.json</span> file contains the following content:<div class="ProgramCode" id="PC59"><div class="LineGroup"><div class="FixedLine">{&quot;e&quot;:&quot;e&quot;,&quot;d&quot;:4,&quot;c&quot;:3,&quot;b&quot;:2,&quot;a&quot;:1}<span id="ITerm149">
                            
                            
                            
                          </span></div></div></div></div></section><section class="Section4 RenderAsSection4" id="Sec26"><h5 class="Heading">JsonRawValue</h5><div class="Para" id="Par175">Tell Jackson that the annotated Java <span id="ITerm150">method</span><span id="ITerm151">
                      
                    </span> or field should be serialized as is. A string property鈥檚 value is serialized without the surrounding quote characters. Consider Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC60">11-18</a></span>.<div class="ProgramCode" id="PC60"><div class="LineGroup"><div class="FixedLine">import java.io.File;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.annotation.JsonRawValue;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.databind.ObjectMapper;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class JacksonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args) throws Exception</div><div class="FixedLine">   {</div><div class="FixedLine">      ObjectMapper mapper = new ObjectMapper()<span id="ITerm152">
                            
                            
                            
                          </span>;</div><div class="FixedLine">      Driver1 d1 = new Driver1();</div><div class="FixedLine">      mapper.writeValue(new File(&quot;driver1.json&quot;), d1);</div><div class="FixedLine">      Driver2 d2 = new Driver2();</div><div class="FixedLine">      mapper.writeValue(new File(&quot;driver2.json&quot;), d2);</div><div class="FixedLine">      out.println(&quot;serialization successful&quot;);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">class Driver1</div><div class="FixedLine">{</div><div class="FixedLine">   public String name = &quot;John Doe&quot;;</div><div class="FixedLine">   public String vehicle = &quot;{ \&quot;make\&quot;: \&quot;Ford\&quot;, &quot; +</div><div class="FixedLine">                           &quot;\&quot;model\&quot;: \&quot;F150\&quot;, &quot; +</div><div class="FixedLine">                           &quot;\&quot;year\&quot;: 2008&quot;;</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">class Driver2</div><div class="FixedLine">{</div><div class="FixedLine">   public String name = &quot;John Doe&quot;;</div><div class="FixedLine">   @JsonRawValue</div><div class="FixedLine">   public String vehicle = &quot;{ \&quot;make\&quot;: \&quot;Ford\&quot;, &quot; +</div><div class="FixedLine">                           &quot;\&quot;model\&quot;: \&quot;F150\&quot;, &quot; +</div><div class="FixedLine">                           &quot;\&quot;year\&quot;: 2008&quot;;</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 11-18</span><p class="SimplePara">Using <span class="EmphasisFontCategoryNonProportional ">JSonRawValue</span> to Serialize a <span class="EmphasisFontCategoryNonProportional ">Vehicle</span> Field As Is</p></div></div></div></div><div class="Para" id="Par176">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC60">11-18</a></span> and run the application. You should observe the following output:<div class="ProgramCode" id="PC61"><div class="LineGroup"><div class="FixedLine">serialization successful<span id="ITerm153">
                            
                            
                            
                          </span></div></div></div></div><div class="Para" id="Par177">The generated <span class="EmphasisFontCategoryNonProportional ">driver1.json</span> file contains the following content:<div class="ProgramCode" id="PC62"><div class="LineGroup"><div class="FixedLine">{&quot;name&quot;:&quot;John Doe&quot;,&quot;vehicle&quot;:&quot;{ \&quot;make\&quot;: \&quot;Ford\&quot;, \&quot;model\&quot;: \&quot;F150\&quot;, \&quot;year\&quot;: 2008&quot;}</div></div></div></div><div class="Para" id="Par178">The generated <span class="EmphasisFontCategoryNonProportional ">driver2.json</span> file contains the following content:<div class="ProgramCode" id="PC63"><div class="LineGroup"><div class="FixedLine">{&quot;name&quot;:&quot;John Doe&quot;,&quot;vehicle&quot;:{ &quot;make&quot;: &quot;Ford&quot;, &quot;model&quot;: &quot;F150&quot;, &quot;year&quot;: 2008}</div></div></div></div><p class="Para" id="Par179">Unlike the previous output, this output reveals that the value of <span class="EmphasisFontCategoryNonProportional ">Driver2</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">vehicle</span> property is serialized as part of the JSON object structure. It鈥檚 not serialized to a string in the JSON object鈥檚 <span class="EmphasisFontCategoryNonProportional ">vehicle</span> field, as the previous output <span id="ITerm154">shows</span>.</p></section><section class="Section4 RenderAsSection4" id="Sec27"><h5 class="Heading">JsonValue</h5><p class="Para" id="Par180">Delegate the <span id="ITerm155">serialization</span><span id="ITerm156">
                      
                      
                      
                    </span> of a Java object to one of its methods, which must take no arguments and which must return a value of a scalar type (such as <span class="EmphasisFontCategoryNonProportional ">String</span> or <span class="EmphasisFontCategoryNonProportional ">java.lang.Number</span>) or any serializable type (such as <span class="EmphasisFontCategoryNonProportional ">java.util.Collection</span> or <span class="EmphasisFontCategoryNonProportional ">Map</span>).</p><p class="Para" id="Par181">For a noargument method with a <span class="EmphasisFontCategoryNonProportional ">String</span> return type, Jackson escapes any double quotation marks inside the returned <span class="EmphasisFontCategoryNonProportional ">String</span>, making it impossible to return a full JSON object. However, that task can be accomplished by using <span class="EmphasisFontCategoryNonProportional ">@JsonRawValue</span>.</p><div class="Para" id="Par182">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC64">11-19</a></span> demonstrates <span class="EmphasisFontCategoryNonProportional ">JsonValue</span>.<div class="ProgramCode" id="PC64"><div class="LineGroup"><div class="FixedLine">import java.io.File;</div></div><div class="LineGroup"><div class="FixedLine">import java.util.HashMap;</div><div class="FixedLine">import java.util.Map<span id="ITerm157">
                            
                            
                            
                          </span>;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.annotation.JsonValue;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.databind.ObjectMapper;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class JacksonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args) throws Exception</div><div class="FixedLine">   {</div><div class="FixedLine">      ObjectMapper mapper = new ObjectMapper();</div><div class="FixedLine">      Props1 p1 = new Props1();</div><div class="FixedLine">      mapper.writeValue(new File(&quot;props1.json&quot;), p1);</div><div class="FixedLine">      Props2 p2 = new Props2();</div><div class="FixedLine">      mapper.writeValue(new File(&quot;props2.json&quot;), p2);</div><div class="FixedLine">      out.println(&quot;serialization successful&quot;);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">class Props1</div><div class="FixedLine">{</div><div class="FixedLine">   public String a = &quot;A&quot;;</div><div class="FixedLine">   public String b = &quot;B&quot;;</div></div><div class="LineGroup"><div class="FixedLine">   @JsonValue</div><div class="FixedLine">   public String toJSON()<span id="ITerm158">
                            
                            
                            
                          </span></div><div class="FixedLine">   {</div><div class="FixedLine">      return a + &quot;\&quot;-\&quot;&quot; + b;</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">class Props2</div><div class="FixedLine">{</div><div class="FixedLine">   private Map&lt;String, String&gt; props = new HashMap&lt;&gt;();</div></div><div class="LineGroup"><div class="FixedLine">   Props2()</div><div class="FixedLine">   {</div><div class="FixedLine">      props.put(&quot;a&quot;, &quot;A&apos;A&apos;\&quot;A\&quot;&quot;);</div><div class="FixedLine">      props.put(&quot;b&quot;, &quot;B&apos;B&apos;\&quot;B\&quot;&quot;);</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @JsonValue</div><div class="FixedLine">   public Map&lt;String, String&gt; toJSON()</div><div class="FixedLine">   {</div><div class="FixedLine">      return props;</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 11-19</span><p class="SimplePara">Using <span class="EmphasisFontCategoryNonProportional ">JSonValue</span> to Serialize <span class="EmphasisFontCategoryNonProportional ">Props1</span> and <span class="EmphasisFontCategoryNonProportional ">Props2</span> Objects via Their <span class="EmphasisFontCategoryNonProportional ">toJson()</span> Methods</p></div></div></div></div><div class="Para" id="Par183">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC64">11-19</a></span> and run the application. You should observe the following output:<div class="ProgramCode" id="PC65"><div class="LineGroup"><div class="FixedLine">serialization successful</div></div></div></div><div class="Para" id="Par184">The generated <span class="EmphasisFontCategoryNonProportional ">props1.json</span> file contains the following content:<div class="ProgramCode" id="PC66"><div class="LineGroup"><div class="FixedLine">A\&quot;-\&quot;B</div></div></div></div><div class="Para" id="Par185">The generated <span class="EmphasisFontCategoryNonProportional ">props2.json</span> file contains the following content:<div class="ProgramCode" id="PC67"><div class="LineGroup"><div class="FixedLine">{&quot;a&quot;:&quot;A&apos;A&apos;\&quot;A\&quot;&quot;,&quot;b&quot;:&quot;B&apos;B&apos;\&quot;B\&quot;&quot;}</div></div></div></div><p class="Para" id="Par186">This output reveals that double quotation marks are escaped even in noargument methods with return types other than <span class="EmphasisFontCategoryNonProportional ">String</span><span id="ITerm159">
                      
                      
                      
                    </span>.</p></section><section class="Section4 RenderAsSection4" id="Sec28"><h5 class="Heading">JsonSerialize</h5><p class="Para" id="Par187">Specify a custom <span id="ITerm160">serializer</span><span id="ITerm161">
                      
                    </span> class for a given field in a Java object. For example, suppose a Java object contains a <span class="EmphasisFontCategoryNonProportional ">color</span> field whose value is an enum instance such as <span class="EmphasisFontCategoryNonProportional ">Color.BLACK</span>. This object is to be serialized to a JSON document whose <span class="EmphasisFontCategoryNonProportional ">color</span> field is associated with a string-based value such as <span class="EmphasisFontCategoryNonProportional ">black</span> or <span class="EmphasisFontCategoryNonProportional ">red</span>. Jackson cannot serialize this value without help, because it cannot convert an enum instance to a string.</p><p class="Para" id="Par188">The 鈥渉elp鈥?that Jackson requires starts by adding a <span class="EmphasisFontCategoryNonProportional ">@JsonSerialize</span> annotation to the <span class="EmphasisFontCategoryNonProportional ">color</span> field. This annotation type鈥檚 <span class="EmphasisFontCategoryNonProportional ">using</span> parameter is assigned the <span class="EmphasisFontCategoryNonProportional ">Class</span> object of the class being used to perform the custom serialization. Furthermore, that class must subclass the abstract <span class="EmphasisFontCategoryNonProportional ">com.fasterxml.jackson.databind.JsonSerializer&lt;T&gt;</span> class, where <span class="EmphasisFontCategoryNonProportional ">T</span> is the type of the annotated field.</p><p class="Para" id="Par189"><span class="EmphasisFontCategoryNonProportional ">JsonSerializer</span> declares an abstract <span class="EmphasisFontCategoryNonProportional ">void serialize(T value, JsonGenerator gen, SerializerProvider serializers)</span> method that Jackson calls to serialize the value type that this serializer handles to JSON content. The <span class="EmphasisFontCategoryNonProportional ">JsonGenerator</span> argument identifies the generator of the JSON content, and the <span class="EmphasisFontCategoryNonProportional ">com.fasterxml.jackson.databind.SerializerProvider</span> argument is used when serializing complex object <span id="ITerm162">graphs</span>.</p><div class="Para" id="Par190">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC68">11-20</a></span> presents the source code to an application that refactors Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC46">11-13</a></span> to implement and demonstrate this custom serialization example.<div class="ProgramCode" id="PC68"><div class="LineGroup"><div class="FixedLine">import java.io.File;</div><div class="FixedLine">import java.io.IOException;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.core.JsonGenerator;</div><div class="FixedLine">import com.fasterxml.jackson.core.JsonParser;</div><div class="FixedLine">import com.fasterxml.jackson.core.JsonProcessingException;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.databind.annotation.JsonDeserialize;</div><div class="FixedLine">import com.fasterxml.jackson.databind.annotation.JsonSerialize;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.databind.DeserializationContext;</div><div class="FixedLine">import com.fasterxml.jackson.databind.JsonDeserializer;</div><div class="FixedLine">import com.fasterxml.jackson.databind.JsonSerializer;</div><div class="FixedLine">import com.fasterxml.jackson.databind.ObjectMapper;</div><div class="FixedLine">import com.fasterxml.jackson.databind.SerializerProvider;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class JacksonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args) throws Exception</div><div class="FixedLine">   {</div><div class="FixedLine">      String jsonContent =</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;   \&quot;color\&quot;: \&quot;black\&quot;&quot; +</div><div class="FixedLine">      &quot;}&quot;;</div></div><div class="LineGroup"><div class="FixedLine">      Canvas canvas =</div><div class="FixedLine">         new ObjectMapper().readerFor(Canvas.class)</div><div class="FixedLine">                           .readValue(jsonContent);</div><div class="FixedLine">      out.printf(&quot;Color = %s%n&quot;, canvas.color);</div><div class="FixedLine">      new ObjectMapper().writeValue(new File(&quot;color.json&quot;),</div><div class="FixedLine">                                    canvas);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">enum Color</div><div class="FixedLine">{</div><div class="FixedLine">   BLACK, UNKNOWN<span id="ITerm163">
                            
                            
                            
                          </span></div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">class Canvas</div><div class="FixedLine">{</div><div class="FixedLine">   @JsonDeserialize(using = ColorDeserializer.class)</div><div class="FixedLine">   @JsonSerialize(using = ColorSerializer.class)</div><div class="FixedLine">   public Color color;</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">class ColorDeserializer extends JsonDeserializer&lt;Color&gt;</div><div class="FixedLine">{</div><div class="FixedLine">   @Override</div><div class="FixedLine">   public Color deserialize(JsonParser jsonParser,</div><div class="FixedLine">                            DeserializationContext</div><div class="FixedLine">                            deserializationContext)</div><div class="FixedLine">      throws IOException, JsonProcessingException</div><div class="FixedLine">   {</div><div class="FixedLine">      switch (jsonParser.getText().toLowerCase())</div><div class="FixedLine">      {</div><div class="FixedLine">         case &quot;black&quot;:</div><div class="FixedLine">            return Color.BLACK;</div></div><div class="LineGroup"><div class="FixedLine">         default:</div><div class="FixedLine">            return Color.UNKNOWN;</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">class ColorSerializer extends JsonSerializer&lt;Color&gt;</div><div class="FixedLine">{</div><div class="FixedLine">   @Override</div><div class="FixedLine">   public void serialize(Color color,</div><div class="FixedLine">                         JsonGenerator jsonGenerator,</div><div class="FixedLine">                         SerializerProvider</div><div class="FixedLine">                         serializerProvider)</div><div class="FixedLine">      throws IOException, JsonProcessingException</div><div class="FixedLine">   {</div><div class="FixedLine">      switch (color)</div><div class="FixedLine">      {</div><div class="FixedLine">         case BLACK:</div><div class="FixedLine">            jsonGenerator.writeString(&quot;black&quot;);</div><div class="FixedLine">            break; <span id="ITerm164">
                            
                            
                            
                          </span></div></div><div class="LineGroup"><div class="FixedLine">         default:</div><div class="FixedLine">            jsonGenerator.writeString(&quot;unknown&quot;);</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 11-20</span><p class="SimplePara">Using <span class="EmphasisFontCategoryNonProportional ">JsonSerialize</span> to Serialize a Color Enum Constant to a Color <span id="ITerm165">String</span></p></div></div></div></div><div class="Para" id="Par191">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC68">11-20</a></span> and run the application. You should observe the following output:<div class="ProgramCode" id="PC69"><div class="LineGroup"><div class="FixedLine">Color = BLACK</div></div></div></div><div class="Para" id="Par192">Furthermore, you should observe a generated <span class="EmphasisFontCategoryNonProportional ">color.json</span> file with the following content:<div class="ProgramCode" id="PC70"><div class="LineGroup"><div class="FixedLine">{&quot;color&quot;:&quot;black&quot;}<span id="ITerm166">
                            
                            
                            
                          </span></div></div></div></div></section></section><section class="Section3 RenderAsSection3" id="Sec29"><h4 class="Heading">Read-Write Annotation Types</h4><div class="Para" id="Par193"><span id="ITerm167">Read-write annotation</span> types affect the reading of Java objects from JSON content, as well as the writing of Java objects to JSON content. The following read-write annotation types are supported by Jackson:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par194">
                        <span class="EmphasisFontCategoryNonProportional ">JsonIgnore and JsonIgnoreProperties</span>
                      </p></li><li><p class="Para" id="Par195">
                        <span class="EmphasisFontCategoryNonProportional ">JsonIgnoreType</span>
                      </p></li><li><p class="Para" id="Par196">
                        <span class="EmphasisFontCategoryNonProportional ">JsonAutoDetect</span>
                      </p></li></ul></div></div><section class="Section4 RenderAsSection4" id="Sec30"><h5 class="Heading">JsonIgnore and JsonIgnoreProperties</h5><div class="Para" id="Par197"><span id="ITerm168">
                      <span class="EmphasisFontCategoryNonProportional ">JsonIgnore</span>
                      
                      
                      
                    </span><span id="ITerm169">
                      
                      
                      
                    </span><span id="ITerm170">
                      
                    </span><span id="ITerm171">
                      
                    </span> tells Jackson to ignore a certain property (field) of a Java object. The property is ignored when reading JSON content to Java objects and when writing Java objects to JSON content. <span class="EmphasisFontCategoryNonProportional ">JsonIgnoreProperties</span> tells Jackson to ignore a list of properties of a Java class. The <span class="EmphasisFontCategoryNonProportional ">@JsonIgnoreProperties</span> annotation is placed above the class declaration instead of above each property (field) to be ignored. These closely related annotation types are demonstrated in Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC71">11-21</a></span>.<div class="ProgramCode" id="PC71"><div class="LineGroup"><div class="FixedLine">import java.io.File;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.annotation.JsonIgnore;</div><div class="FixedLine">import com.fasterxml.jackson.annotation.</div><div class="FixedLine">       JsonIgnoreProperties;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.databind.ObjectMapper;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class JacksonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args) throws Exception</div><div class="FixedLine">   {</div><div class="FixedLine">      ObjectMapper mapper = new ObjectMapper();</div><div class="FixedLine">      SavingsAccount1 sa1 =</div><div class="FixedLine">         new SavingsAccount1(&quot;101&quot;, &quot;John Doe&quot;, 50000);</div><div class="FixedLine">      mapper.writeValue(new File(&quot;sa1.json&quot;), sa1);</div><div class="FixedLine">      SavingsAccount2 sa2 =</div><div class="FixedLine">         new SavingsAccount2(&quot;101&quot;, &quot;John Doe&quot;, 50000);</div><div class="FixedLine">      mapper.writeValue(new File(&quot;sa2.json&quot;), sa2);</div><div class="FixedLine">      SavingsAccount3 sa3 =</div><div class="FixedLine">         new SavingsAccount3(&quot;101&quot;, &quot;John Doe&quot;, 50000);</div><div class="FixedLine">      mapper.writeValue(new File(&quot;sa3.json&quot;), sa3);</div><div class="FixedLine">      sa1 = mapper.readValue(new File(&quot;sa1.json&quot;),</div><div class="FixedLine">                             SavingsAccount1.class);</div><div class="FixedLine">      out.printf(&quot;bankID = %s%n&quot;, sa1.bankID);</div><div class="FixedLine">      out.printf(&quot;accountOwnerName = %s%n&quot;,</div><div class="FixedLine">                 sa1.accountOwnerName);</div><div class="FixedLine">      out.printf(&quot;balanceInCents = %d%n&quot;,<span id="ITerm172">
                            
                            
                            
                          </span><span id="ITerm173">
                            
                            
                            
                          </span></div><div class="FixedLine">                 sa1.balanceInCents);</div><div class="FixedLine">      sa2 = mapper.readValue(new File(&quot;sa1.json&quot;),</div><div class="FixedLine">                             SavingsAccount2.class);</div><div class="FixedLine">      out.printf(&quot;bankID = %s%n&quot;, sa2.bankID);</div><div class="FixedLine">      out.printf(&quot;accountOwnerName = %s%n&quot;,</div><div class="FixedLine">                 sa2.accountOwnerName);</div><div class="FixedLine">      out.printf(&quot;balanceInCents = %d%n&quot;,</div><div class="FixedLine">                 sa2.balanceInCents);</div><div class="FixedLine">      sa3 = mapper.readValue(new File(&quot;sa1.json&quot;),</div><div class="FixedLine">                             SavingsAccount3.class);</div><div class="FixedLine">      out.printf(&quot;bankID = %s%n&quot;, sa3.bankID);</div><div class="FixedLine">      out.printf(&quot;accountOwnerName = %s%n&quot;,</div><div class="FixedLine">                 sa3.accountOwnerName);</div><div class="FixedLine">      out.printf(&quot;balanceInCents = %d%n&quot;,</div><div class="FixedLine">                 sa3.balanceInCents);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">class SavingsAccount1</div><div class="FixedLine">{</div><div class="FixedLine">   public String bankID;</div><div class="FixedLine">   public String accountOwnerName;</div><div class="FixedLine">   public long balanceInCents;</div></div><div class="LineGroup"><div class="FixedLine">   SavingsAccount1()</div><div class="FixedLine">   {</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   SavingsAccount1(String bankID, String accountOwnerName,</div><div class="FixedLine">                   long balanceInCents)</div><div class="FixedLine">   {</div><div class="FixedLine">      this.bankID = bankID;</div><div class="FixedLine">      this.accountOwnerName = accountOwnerName;</div><div class="FixedLine">      this.balanceInCents = balanceInCents;</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">class SavingsAccount2</div><div class="FixedLine">{</div><div class="FixedLine">   @JsonIgnore</div><div class="FixedLine">   public String bankID;</div><div class="FixedLine">   public String accountOwnerName;</div><div class="FixedLine">   public long balanceInCents<span id="ITerm174">
                            
                            
                            
                          </span><span id="ITerm175">
                            
                            
                            
                          </span>;</div></div><div class="LineGroup"><div class="FixedLine">   SavingsAccount2()</div><div class="FixedLine">   {</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   SavingsAccount2(String bankID, String accountOwnerName,</div><div class="FixedLine">                   long balanceInCents)</div><div class="FixedLine">   {</div><div class="FixedLine">      this.bankID = bankID;</div><div class="FixedLine">      this.accountOwnerName = accountOwnerName;</div><div class="FixedLine">      this.balanceInCents = balanceInCents;</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">@JsonIgnoreProperties({&quot;bankID&quot;, &quot;accountOwnerName&quot;})</div><div class="FixedLine">class SavingsAccount3</div><div class="FixedLine">{</div><div class="FixedLine">   public String bankID;</div><div class="FixedLine">   public String accountOwnerName;</div><div class="FixedLine">   public long balanceInCents;</div></div><div class="LineGroup"><div class="FixedLine">   SavingsAccount3()</div><div class="FixedLine">   {</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   SavingsAccount3(String bankID, String accountOwnerName,</div><div class="FixedLine">                   long balanceInCents)</div><div class="FixedLine">   {</div><div class="FixedLine">      this.bankID = bankID;</div><div class="FixedLine">      this.accountOwnerName = accountOwnerName;</div><div class="FixedLine">      this.balanceInCents = balanceInCents;</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 11-21</span><p class="SimplePara">Using <span class="EmphasisFontCategoryNonProportional ">JsonIgnore</span> and <span class="EmphasisFontCategoryNonProportional ">JsonIgnoreProperties</span> to Ignore One or More Properties</p></div></div></div></div><p class="Para" id="Par198">The noargument and empty constructors in <span class="EmphasisFontCategoryNonProportional ">SavingsAccount1</span>, <span class="EmphasisFontCategoryNonProportional ">SavingsAccount2</span>, and <span class="EmphasisFontCategoryNonProportional ">SavingsAccount3</span> are needed to avoid a runtime exception during <span id="ITerm176">deserialization</span><span id="ITerm177">
                      
                      
                      
                    </span>.</p><div class="Para" id="Par199">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC71">11-21</a></span> and run the application. You should observe the following output:<div class="ProgramCode" id="PC72"><div class="LineGroup"><div class="FixedLine">bankID = 101</div><div class="FixedLine">accountOwnerName = John Doe</div><div class="FixedLine">balanceInCents = 50000</div><div class="FixedLine">bankID = null</div><div class="FixedLine">accountOwnerName = John Doe</div><div class="FixedLine">balanceInCents = 50000</div><div class="FixedLine">bankID = null</div><div class="FixedLine">accountOwnerName = null</div><div class="FixedLine">balanceInCents = 50000</div></div></div></div><p class="Para" id="Par200">The <span class="EmphasisFontCategoryNonProportional ">null</span> values are the result of <span class="EmphasisFontCategoryNonProportional ">bankID</span> and <span class="EmphasisFontCategoryNonProportional ">accountOwnerName</span> being set to <span class="EmphasisFontCategoryNonProportional ">null</span> because of <span class="EmphasisFontCategoryNonProportional ">@JsonIgnore</span> and <span class="EmphasisFontCategoryNonProportional ">@jsonIgnoreProperties</span>, even though this information is stored in <span class="EmphasisFontCategoryNonProportional ">sa1.json</span>.</p><div class="Para" id="Par201">The generated <span class="EmphasisFontCategoryNonProportional ">sa1.json</span> file contains the following content:<div class="ProgramCode" id="PC73"><div class="LineGroup"><div class="FixedLine">{&quot;bankID&quot;:&quot;101&quot;,&quot;accountOwnerName&quot;:&quot;John Doe&quot;,&quot;balanceInCents&quot;:50000}</div></div></div></div><div class="Para" id="Par202">The generated <span class="EmphasisFontCategoryNonProportional ">sa2.json</span> file contains the following content:<div class="ProgramCode" id="PC74"><div class="LineGroup"><div class="FixedLine">{&quot;accountOwnerName&quot;:&quot;John Doe&quot;,&quot;balanceInCents&quot;:50000}</div></div></div></div><div class="Para" id="Par203">The generated <span class="EmphasisFontCategoryNonProportional ">sa3.json</span> file contains the following content:<div class="ProgramCode" id="PC75"><div class="LineGroup"><div class="FixedLine">{&quot;balanceInCents&quot;:50000}<span id="ITerm178">
                            
                            
                            
                          </span><span id="ITerm179">
                            
                            
                            
                          </span></div></div></div></div></section><section class="Section4 RenderAsSection4" id="Sec31"><h5 class="Heading">JsonIgnoreType</h5><div class="Para" id="Par204">All <span id="ITerm180">properties</span><span id="ITerm181">
                      
                    </span> of an annotated type are to be ignored during serialization and deserialization. This annotation type is demonstrated in Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC76">11-22</a></span>, where it鈥檚 used to prevent <span class="EmphasisFontCategoryNonProportional ">Address</span> properties from being serialized/deserialized.<div class="ProgramCode" id="PC76"><div class="LineGroup"><div class="FixedLine">import java.io.File;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.annotation.JsonIgnoreType;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.databind.ObjectMapper;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class JacksonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args) throws Exception</div><div class="FixedLine">   {</div><div class="FixedLine">      ObjectMapper mapper = new ObjectMapper();</div><div class="FixedLine">      Person1 person1 = new Person1();</div><div class="FixedLine">      person1.name = &quot;John Doe&quot;;</div><div class="FixedLine">      person1.address = new Person1.Address();</div><div class="FixedLine">      person1.address.street = &quot;100 Smith Street&quot;;</div><div class="FixedLine">      person1.address.city = &quot;SomeCity&quot;;</div><div class="FixedLine">      mapper.writeValue(new File(&quot;person1.json&quot;), person1);</div><div class="FixedLine">      Person2 person2 = new Person2();</div><div class="FixedLine">      person2.name = &quot;John Doe&quot;;</div><div class="FixedLine">      person2.address = new Person2.Address();</div><div class="FixedLine">      person2.address.street = &quot;100 Smith Street&quot;;</div><div class="FixedLine">      person2.address.city = &quot;SomeCity&quot;;</div><div class="FixedLine">      mapper.writeValue(new File(&quot;person2.json&quot;), person2);</div><div class="FixedLine">      person1 = mapper.readValue(new File(&quot;person1.json&quot;),</div><div class="FixedLine">                                 Person1.class);</div><div class="FixedLine">      out.printf(&quot;name = %s%n&quot;, person1.name);</div><div class="FixedLine">      out.printf(&quot;street = %s%n&quot;, person1.address.street);</div><div class="FixedLine">      out.printf(&quot;city = %s%n&quot;, person1.address.city);</div><div class="FixedLine">      person2 = mapper.readValue(new File(&quot;person1.json&quot;),</div><div class="FixedLine">                                 Person2.class);</div><div class="FixedLine">      out.printf(&quot;name = %s%n&quot;, person2.name);</div><div class="FixedLine">      out.printf(&quot;street = %s%n&quot;, person2.address.street);</div><div class="FixedLine">      out.printf(&quot;city = %s%n&quot;, person2.address.city);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">class Person1<span id="ITerm182">
                            
                            
                            
                          </span></div><div class="FixedLine">{</div><div class="FixedLine">   public String name;</div></div><div class="LineGroup"><div class="FixedLine">   public static class Address</div><div class="FixedLine">   {</div><div class="FixedLine">      public String street;</div><div class="FixedLine">      public String city;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public Address address;</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">class Person2</div><div class="FixedLine">{</div><div class="FixedLine">   public String name;</div></div><div class="LineGroup"><div class="FixedLine">   @JsonIgnoreType</div><div class="FixedLine">   public static class Address</div><div class="FixedLine">   {</div><div class="FixedLine">      public String street;</div><div class="FixedLine">      public String city;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public Address address;</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 11-22</span><p class="SimplePara">Using <span class="EmphasisFontCategoryNonProportional ">JsonIgnoreType</span> to Ignore <span class="EmphasisFontCategoryNonProportional ">Address</span> Properties</p></div></div></div></div><div class="Para" id="Par205">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC76">11-22</a></span> and run the application. You should observe the following output:<div class="ProgramCode" id="PC77"><div class="LineGroup"><div class="FixedLine">name = John Doe</div><div class="FixedLine">street = 100 Smith Street</div><div class="FixedLine">city = SomeCity</div><div class="FixedLine">name = John Doe</div><div class="FixedLine">Exception in thread &quot;main&quot; java.lang.NullPointerException</div><div class="FixedLine">      at JacksonDemo.main(JacksonDemo.java:34) <span id="ITerm183">
                            
                            
                            
                          </span></div></div></div></div><p class="Para" id="Par206">The exception is the result of <span class="EmphasisFontCategoryNonProportional ">address</span> being set to <span class="EmphasisFontCategoryNonProportional ">null</span> because of <span class="EmphasisFontCategoryNonProportional ">@JsonIgnoreType</span>, even though the address information is stored in <span class="EmphasisFontCategoryNonProportional ">person1.json</span>.</p><div class="Para" id="Par207">The generated <span class="EmphasisFontCategoryNonProportional ">person1.json</span> file contains the following content:<div class="ProgramCode" id="PC78"><div class="LineGroup"><div class="FixedLine">{&quot;name&quot;:&quot;John Doe&quot;,&quot;address&quot;:{&quot;street&quot;:&quot;100 Smith Street&quot;,&quot;city&quot;:&quot;SomeCity&quot;}}</div></div></div></div><div class="Para" id="Par208">The generated <span class="EmphasisFontCategoryNonProportional ">person2.json</span> file contains the following content:<div class="ProgramCode" id="PC79"><div class="LineGroup"><div class="FixedLine">{&quot;name&quot;:&quot;John Doe&quot;}<span id="ITerm184">
                            
                            
                            
                          </span></div></div></div></div></section><section class="Section4 RenderAsSection4" id="Sec32"><h5 class="Heading">JsonAutoDetect</h5><p class="Para" id="Par209">Tell <span id="ITerm185">Jackson</span><span id="ITerm186">
                      
                    </span> to include non-<span class="EmphasisFontCategoryNonProportional ">public</span> properties when reading and writing Java objects.</p><p class="Para" id="Par210">This annotation type declares various visibility elements for determining the minimum visibility level (such as <span class="EmphasisFontCategoryNonProportional ">public</span> or <span class="EmphasisFontCategoryNonProportional ">protected</span>) for auto-detection. For example, <span class="EmphasisFontCategoryNonProportional ">fieldVisibility</span> specifies the minimum visibility required for auto-detecting member fields. One of the <span class="EmphasisFontCategoryNonProportional ">JsonAutoDetect.Visibility</span> enum constants is assigned to this element. This enum enumerates possible visibility thresholds (minimum visibility) that can be used to limit which methods (and fields) are auto-detected.</p><div class="Para" id="Par211">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC80">11-23</a></span> demonstrates <span class="EmphasisFontCategoryNonProportional ">JsonAutoDetect</span> and its nested <span class="EmphasisFontCategoryNonProportional ">Visibility</span> enum.<div class="ProgramCode" id="PC80"><div class="LineGroup"><div class="FixedLine">import java.io.File;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.annotation.JsonAutoDetect;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.databind.ObjectMapper;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class JacksonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args) throws Exception</div><div class="FixedLine">   {</div><div class="FixedLine">      ObjectMapper mapper = new ObjectMapper();</div><div class="FixedLine">      SomeClass1 sc1 = new SomeClass1(1, 2, 3);</div><div class="FixedLine">      mapper.writeValue(new File(&quot;sc1.json&quot;), sc1);</div><div class="FixedLine">      SomeClass2 sc2 = new SomeClass2(1, 2, 3);</div><div class="FixedLine">      mapper.writeValue(new File(&quot;sc2.json&quot;), sc2);</div><div class="FixedLine">      SomeClass3 sc3 = new SomeClass3(1, 2, 3);</div><div class="FixedLine">      mapper.writeValue(new File(&quot;sc3.json&quot;), sc3);</div><div class="FixedLine">      sc1 = mapper.readValue(new File(&quot;sc1.json&quot;),</div><div class="FixedLine">                             SomeClass1.class);</div><div class="FixedLine">      sc1.print();</div><div class="FixedLine">      sc2 = mapper.readValue(new File(&quot;sc2.json&quot;),</div><div class="FixedLine">                             SomeClass2.class);</div><div class="FixedLine">      sc2.print();</div><div class="FixedLine">      sc3 = mapper.readValue(new File(&quot;sc3.json&quot;),</div><div class="FixedLine">                             SomeClass3.class);</div><div class="FixedLine">      sc3.print()<span id="ITerm187">
                            
                            
                            
                          </span>;</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">class SomeClass1</div><div class="FixedLine">{</div><div class="FixedLine">   public int a;</div><div class="FixedLine">   private int b;</div><div class="FixedLine">   protected int c;</div></div><div class="LineGroup"><div class="FixedLine">   SomeClass1()</div><div class="FixedLine">   {</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   SomeClass1(int a, int b, int c)</div><div class="FixedLine">   {</div><div class="FixedLine">      this.a = a;</div><div class="FixedLine">      this.b = b;</div><div class="FixedLine">      this.c = c;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public void print()</div><div class="FixedLine">   {</div><div class="FixedLine">      out.printf(&quot;a = %d, b = %d, c = %d%n&quot;, a, b, c);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">@JsonAutoDetect(fieldVisibility = JsonAutoDetect.Visibility</div><div class="FixedLine">                                  .PROTECTED_AND_PUBLIC)</div><div class="FixedLine">class SomeClass2</div><div class="FixedLine">{</div><div class="FixedLine">   public int a;</div><div class="FixedLine">   private int b;</div><div class="FixedLine">   protected int c;</div></div><div class="LineGroup"><div class="FixedLine">   SomeClass2()</div><div class="FixedLine">   {</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   SomeClass2(int a, int b, int c)</div><div class="FixedLine">   {</div><div class="FixedLine">      this.a = a;</div><div class="FixedLine">      this.b = b;</div><div class="FixedLine">      this.c = c<span id="ITerm188">
                            
                            
                            
                          </span>;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public void print()</div><div class="FixedLine">   {</div><div class="FixedLine">      out.printf(&quot;a = %d, b = %d, c = %d%n&quot;, a, b, c);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">@JsonAutoDetect(fieldVisibility = JsonAutoDetect.Visibility</div><div class="FixedLine">                                  .ANY)</div><div class="FixedLine">class SomeClass3</div><div class="FixedLine">{</div><div class="FixedLine">   public int a;</div><div class="FixedLine">   private int b;</div><div class="FixedLine">   protected int c;</div></div><div class="LineGroup"><div class="FixedLine">   SomeClass3()</div><div class="FixedLine">   {</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   SomeClass3(int a, int b, int c)</div><div class="FixedLine">   {</div><div class="FixedLine">      this.a = a;</div><div class="FixedLine">      this.b = b;</div><div class="FixedLine">      this.c = c;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   public void print()</div><div class="FixedLine">   {</div><div class="FixedLine">      out.printf(&quot;a = %d, b = %d, c = %d%n&quot;, a, b, c);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 11-23</span><p class="SimplePara">Using <span class="EmphasisFontCategoryNonProportional ">JsonAutoDetect</span> to Auto-Detect Various Fields</p></div></div></div></div><p class="Para" id="Par212">With <span class="EmphasisFontCategoryNonProportional ">Visiblity.PROTECTED_AND_PUBLIC</span>, only access modifiers <span class="EmphasisFontCategoryNonProportional ">protected</span> and <span class="EmphasisFontCategoryNonProportional ">public</span> are auto-detectable. With <span class="EmphasisFontCategoryNonProportional ">Visibility.ANY</span>, <span class="EmphasisFontCategoryNonProportional ">protected</span>, <span class="EmphasisFontCategoryNonProportional ">public</span>, <span class="EmphasisFontCategoryNonProportional ">private</span>, and package access are auto-detectable.</p><div class="Para" id="Par213">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC80">11-23</a></span> and run the application. You should observe the following <span id="ITerm189">output</span>:<div class="ProgramCode" id="PC81"><div class="LineGroup"><div class="FixedLine">a = 1, b = 0, c = 0</div><div class="FixedLine">a = 1, b = 0, c = 3</div><div class="FixedLine">a = 1, b = 2, c = 3</div></div></div></div><div class="Para" id="Par214">The generated <span class="EmphasisFontCategoryNonProportional ">sc1.json</span> file contains the following content:<div class="ProgramCode" id="PC82"><div class="LineGroup"><div class="FixedLine">{&quot;a&quot;:1}</div></div></div></div><div class="Para" id="Par215">The generated <span class="EmphasisFontCategoryNonProportional ">sc2.json</span> file contains the following content:<div class="ProgramCode" id="PC83"><div class="LineGroup"><div class="FixedLine">{&quot;a&quot;:1,&quot;c&quot;:3}</div></div></div></div><div class="Para" id="Par216">The generated <span class="EmphasisFontCategoryNonProportional ">sc3.json</span> file contains the following content:<div class="ProgramCode" id="PC84"><div class="LineGroup"><div class="FixedLine">{&quot;a&quot;:1,&quot;b&quot;:2,&quot;c&quot;:3}<span id="ITerm190">
                            
                            
                            
                          </span></div></div></div></div></section></section></section><section class="Section2 RenderAsSection2" id="Sec33"><h3 class="Heading">Custom Pretty Printers</h3><div class="Para" id="Par217">Jackson<span id="ITerm191">
                  
                  
                </span> supports <span id="ITerm192">
                  <em class="EmphasisTypeItalic ">pretty printers</em>
                  
                </span> to improve the appearance of generated output (making it easier to read). A pretty printer class must implement the <span class="EmphasisFontCategoryNonProportional ">PrettyPrinter</span> interface in terms of the following methods:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par218">
                      <span class="EmphasisFontCategoryNonProportional ">void beforeArrayValues(JsonGenerator gen)</span>
                    </p></li><li><p class="Para" id="Par219">
                      <span class="EmphasisFontCategoryNonProportional ">void beforeObjectEntries(JsonGenerator gen)</span>
                    </p></li><li><p class="Para" id="Par220">
                      <span class="EmphasisFontCategoryNonProportional ">void writeArrayValueSeparator(JsonGenerator gen)</span>
                    </p></li><li><p class="Para" id="Par221">
                      <span class="EmphasisFontCategoryNonProportional ">void writeEndArray(JsonGenerator gen, int nrOfValues)</span>
                    </p></li><li><p class="Para" id="Par222">
                      <span class="EmphasisFontCategoryNonProportional ">void writeEndObject(JsonGenerator gen, int nrOfEntries)</span>
                    </p></li><li><p class="Para" id="Par223">
                      <span class="EmphasisFontCategoryNonProportional ">void writeObjectEntrySeparator(JsonGenerator gen)</span>
                    </p></li><li><p class="Para" id="Par224">
                      <span class="EmphasisFontCategoryNonProportional ">void writeObjectFieldValueSeparator(JsonGenerator gen)</span>
                    </p></li><li><p class="Para" id="Par225">
                      <span class="EmphasisFontCategoryNonProportional ">void writeRootValueSeparator(JsonGenerator gen)</span>
                    </p></li><li><p class="Para" id="Par226">
                      <span class="EmphasisFontCategoryNonProportional ">void writeStartArray(JsonGenerator gen)</span>
                    </p></li><li><p class="Para" id="Par227">
                      <span class="EmphasisFontCategoryNonProportional ">void writeStartObject(JsonGenerator gen)</span>
                    </p></li></ul></div></div><p class="Para" id="Par228">Furthermore, since Jackson 2.1, a stateful implementation of <span class="EmphasisFontCategoryNonProportional ">PrettyPrinter</span> must implement the <span class="EmphasisFontCategoryNonProportional ">com.fasterxml.jackson.core.util.Instantiatable&lt;T&gt;</span> interface, to allow for the construction of per-generation instances in order to avoid state corruption when sharing the pretty printer instance among threads. <span class="EmphasisFontCategoryNonProportional ">Instantiatable</span> declares a <span class="EmphasisFontCategoryNonProportional ">T createInstance()</span> method that returns a newly created stateful pretty printer <span id="ITerm193">object</span>.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar9"><h3 class="Heading">Note</h3><p class="Para" id="Par229">A stateless pretty printer class doesn鈥檛 need to implement <span class="EmphasisFontCategoryNonProportional ">Instantiatable</span>. However, if it implements this interface, its <span class="EmphasisFontCategoryNonProportional ">createInstance()</span> method should return <span class="EmphasisFontCategoryNonProportional ">this</span> to signify the current object.</p></div><div class="Para" id="Par230">Earlier in this chapter, I showed the following pretty-printed output:<div class="ProgramCode" id="PC85"><div class="LineGroup"><div class="FixedLine">{</div><div class="FixedLine">  &quot;firstname&quot; : &quot;John&quot;,</div><div class="FixedLine">  &quot;lastName&quot; : &quot;Doe&quot;,</div><div class="FixedLine">  &quot;age&quot; : 42,</div><div class="FixedLine">  &quot;address&quot; : {</div><div class="FixedLine">    &quot;street&quot; : &quot;400 Some Street&quot;,</div><div class="FixedLine">    &quot;city&quot; : &quot;Beverly Hills&quot;,</div><div class="FixedLine">    &quot;state&quot; : &quot;CA&quot;,</div><div class="FixedLine">    &quot;zipcode&quot; : 90210</div><div class="FixedLine">  },</div><div class="FixedLine">  &quot;phoneNumbers&quot; : [ {</div><div class="FixedLine">    &quot;type&quot; : &quot;home&quot;,</div><div class="FixedLine">    &quot;number&quot; : &quot;310 555-1234&quot;</div><div class="FixedLine">  }, {</div><div class="FixedLine">    &quot;type&quot; : &quot;fax&quot;,</div><div class="FixedLine">    &quot;number&quot; : &quot;310 555-4567&quot;</div><div class="FixedLine">  } ]</div><div class="FixedLine">}</div></div></div></div><div class="Para" id="Par231">I鈥檇 like to reformat the output to look like this:<div class="ProgramCode" id="PC86"><div class="LineGroup"><div class="FixedLine">{</div><div class="FixedLine">  &quot;firstname&quot; : &quot;John&quot;<span id="ITerm194">
                        
                        
                      </span>,</div><div class="FixedLine">  &quot;lastName&quot; : &quot;Doe&quot;,</div><div class="FixedLine">  &quot;age&quot; : 42,</div><div class="FixedLine">  &quot;address&quot; :</div><div class="FixedLine">  {</div><div class="FixedLine">    &quot;street&quot; : &quot;400 Some Street&quot;,</div><div class="FixedLine">    &quot;city&quot; : &quot;Beverly Hills&quot;,</div><div class="FixedLine">    &quot;state&quot; : &quot;CA&quot;,</div><div class="FixedLine">    &quot;zipcode&quot; : 90210</div><div class="FixedLine">  },</div><div class="FixedLine">  &quot;phoneNumbers&quot; :</div><div class="FixedLine">  [</div><div class="FixedLine">    {</div><div class="FixedLine">      &quot;type&quot; : &quot;home&quot;,</div><div class="FixedLine">      &quot;number&quot; : &quot;310 555-1234&quot;</div><div class="FixedLine">    },</div><div class="FixedLine">    {</div><div class="FixedLine">      &quot;type&quot; : &quot;fax&quot;,</div><div class="FixedLine">      &quot;number&quot; : &quot;310 555-4567&quot;</div><div class="FixedLine">    }</div><div class="FixedLine">  ]</div><div class="FixedLine">}</div></div></div></div><div class="Para" id="Par232">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC87">11-24</a></span> provides the source code to an application with a custom <span class="EmphasisFontCategoryNonProportional ">MyPrettyPrinter</span> class that formats the output as shown in the preceding text.<div class="ProgramCode" id="PC87"><div class="LineGroup"><div class="FixedLine">import java.io.IOException<span id="ITerm195">
                        
                        
                      </span>;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.core.JsonEncoding;</div><div class="FixedLine">import com.fasterxml.jackson.core.JsonFactory;</div><div class="FixedLine">import com.fasterxml.jackson.core.JsonGenerator;</div><div class="FixedLine">import com.fasterxml.jackson.core.PrettyPrinter;</div></div><div class="LineGroup"><div class="FixedLine">import com.fasterxml.jackson.core.util.Instantiatable;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class JacksonDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args) throws Exception</div><div class="FixedLine">   {</div><div class="FixedLine">      JsonFactory factory = new JsonFactory();</div><div class="FixedLine">      JsonGenerator generator =</div><div class="FixedLine">      factory.createGenerator(out, JsonEncoding.UTF8);</div><div class="FixedLine">      generator.setPrettyPrinter(new MyPrettyPrinter());</div><div class="FixedLine">      generator.writeStartObject();</div><div class="FixedLine">      generator.writeStringField(&quot;firstname&quot;, &quot;John&quot;);</div><div class="FixedLine">      generator.writeStringField(&quot;lastName&quot;, &quot;Doe&quot;);</div><div class="FixedLine">      generator.writeNumberField(&quot;age&quot;, 42);</div><div class="FixedLine">      generator.writeFieldName(&quot;address&quot;);</div><div class="FixedLine">      generator.writeStartObject();</div><div class="FixedLine">      generator.writeStringField(&quot;street&quot;,</div><div class="FixedLine">                                 &quot;400 Some Street&quot;);</div><div class="FixedLine">      generator.writeStringField(&quot;city&quot;, &quot;Beverly Hills&quot;);</div><div class="FixedLine">      generator.writeStringField(&quot;state&quot;, &quot;CA&quot;);</div><div class="FixedLine">      generator.writeNumberField(&quot;zipcode&quot;, 90210);</div><div class="FixedLine">      generator.writeEndObject();</div><div class="FixedLine">      generator.writeFieldName(&quot;phoneNumbers&quot;);</div><div class="FixedLine">      generator.writeStartArray();</div><div class="FixedLine">      generator.writeStartObject();</div><div class="FixedLine">      generator.writeStringField(&quot;type&quot;, &quot;home&quot;);</div><div class="FixedLine">      generator.writeStringField(&quot;number&quot;, &quot;310 555-1234&quot;);</div><div class="FixedLine">      generator.writeEndObject();</div><div class="FixedLine">      generator.writeStartObject();</div><div class="FixedLine">      generator.writeStringField(&quot;type&quot;, &quot;fax&quot;);</div><div class="FixedLine">      generator.writeStringField(&quot;number&quot;, &quot;310 555-4567&quot;);</div><div class="FixedLine">      generator.writeEndObject();</div><div class="FixedLine">      generator.writeEndArray();</div><div class="FixedLine">      generator.writeEndObject()<span id="ITerm196">
                        
                        
                      </span>;</div><div class="FixedLine">      generator.close();</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">class MyPrettyPrinter</div><div class="FixedLine">   implements PrettyPrinter, Instantiatable&lt;MyPrettyPrinter&gt;</div><div class="FixedLine">{</div><div class="FixedLine">   private final String LINE_SEP =</div><div class="FixedLine">      getProperty(&quot;line.separator&quot;);</div></div><div class="LineGroup"><div class="FixedLine">   private int indent = 0;</div><div class="FixedLine">   private boolean isNewline = true;</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public MyPrettyPrinter createInstance()</div><div class="FixedLine">   {</div><div class="FixedLine">      return new MyPrettyPrinter();</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public void writeStartObject(JsonGenerator jg)</div><div class="FixedLine">      throws IOException</div><div class="FixedLine">   {</div><div class="FixedLine">      if (!isNewline)</div><div class="FixedLine">         newline(jg);</div><div class="FixedLine">      jg.writeRaw(&apos;{&apos;);</div><div class="FixedLine">      ++indent;</div><div class="FixedLine">      isNewline = false;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public void beforeObjectEntries(JsonGenerator jg)</div><div class="FixedLine">      throws IOException</div><div class="FixedLine">   {</div><div class="FixedLine">      newline(jg) <span id="ITerm197">
                        
                        
                      </span>;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public void</div><div class="FixedLine">      writeObjectFieldValueSeparator(JsonGenerator jg)</div><div class="FixedLine">      throws IOException</div><div class="FixedLine">   {</div><div class="FixedLine">      jg.writeRaw(&quot; : &quot;);</div><div class="FixedLine">      isNewline = false;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public void writeObjectEntrySeparator(JsonGenerator jg)</div><div class="FixedLine">      throws IOException</div><div class="FixedLine">   {</div><div class="FixedLine">      jg.writeRaw(&quot;,&quot;);</div><div class="FixedLine">      newline(jg);</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public void writeEndObject(JsonGenerator jg,</div><div class="FixedLine">                              int nrOfEntries)</div><div class="FixedLine">      throws IOException</div><div class="FixedLine">   {</div><div class="FixedLine">      --indent;</div><div class="FixedLine">      newline(jg);</div><div class="FixedLine">      jg.writeRaw(&apos;}&apos;);</div><div class="FixedLine">      isNewline = indent == 0;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public void writeStartArray(JsonGenerator jg)</div><div class="FixedLine">      throws IOException</div><div class="FixedLine">   {</div><div class="FixedLine">      newline(jg);</div><div class="FixedLine">      jg.writeRaw(&quot;[&quot;);</div><div class="FixedLine">      ++indent;</div><div class="FixedLine">      isNewline = false<span id="ITerm198">
                        
                        
                      </span>;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public void beforeArrayValues(JsonGenerator jg)</div><div class="FixedLine">      throws IOException</div><div class="FixedLine">   {</div><div class="FixedLine">      newline(jg);</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public void writeArrayValueSeparator(JsonGenerator jg)</div><div class="FixedLine">      throws IOException</div><div class="FixedLine">   {</div><div class="FixedLine">      jg.writeRaw(&quot;, &quot;);</div><div class="FixedLine">      isNewline = false;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public void writeEndArray(JsonGenerator jg,</div><div class="FixedLine">                             int nrOfValues)</div><div class="FixedLine">      throws IOException</div><div class="FixedLine">   {</div><div class="FixedLine">      --indent;</div><div class="FixedLine">      newline(jg);</div><div class="FixedLine">      jg.writeRaw(&apos;]&apos;);</div><div class="FixedLine">      isNewline = false;</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   @Override</div><div class="FixedLine">   public void writeRootValueSeparator(JsonGenerator jg)</div><div class="FixedLine">      throws IOException</div><div class="FixedLine">   {</div><div class="FixedLine">      jg.writeRaw(&apos; &apos;);</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   private void newline(JsonGenerator jg) throws IOException</div><div class="FixedLine">   {</div><div class="FixedLine">      jg.writeRaw(LINE_SEP);</div><div class="FixedLine">      for (int i = 0; i &lt; indent; ++i)</div><div class="FixedLine">         jg.writeRaw(&quot;  &quot;);</div><div class="FixedLine">      isNewline = true;</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 11-24</span><p class="SimplePara">Reformatting Output with a Pretty Printer</p></div></div></div></div><div class="Para" id="Par233"><span class="EmphasisFontCategoryNonProportional ">DefaultPrettyPrinter</span> is paired with <span class="EmphasisFontCategoryNonProportional ">JsonGenerator</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">useDefaultPrettyPrinter()</span> method<span id="ITerm199">
                  
                </span>, which instantiates <span class="EmphasisFontCategoryNonProportional ">DefaultPrettyPrinter</span> and installs the instance on the generator. All other pretty printer classes must be instantiated explicitly, and these instances must be installed on their generators by using <span class="EmphasisFontCategoryNonProportional ">JsonGenerator</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">JsonGenerator setPrettyPrinter(PrettyPrinter pp)</span> method, which Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC87">11-24</a></span> accomplishes as follows:<div class="ProgramCode" id="PC88"><div class="LineGroup"><div class="FixedLine">generator.setPrettyPrinter(new MyPrettyPrinter());</div></div></div></div><p class="Para" id="Par234">Although there鈥檚 no need to do so, it鈥檚 possible to explicitly instantiate <span class="EmphasisFontCategoryNonProportional ">DefaultPrettyPrinter</span> and pass the instance to <span class="EmphasisFontCategoryNonProportional ">JsonGenerator</span> by calling <span class="EmphasisFontCategoryNonProportional ">setPrettyPrinter()</span><span id="ITerm200">
                  
                  
                </span>.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar10"><h3 class="Heading">Note</h3><p class="Para" id="Par235">MyPrettyPrinter鈥檚 content is based on code found in GitHub issue 鈥淧rettyPrinter Indenter: Ability to insert eol before object and array entries #724鈥?(<span class="ExternalRef"><a href="http://github.com/FasterXML/jackson-databind/issues/724"><span class="RefSource">
                      <span class="EmphasisFontCategoryNonProportional ">http://github.com/FasterXML/jackson-databind/issues/724</span>
                    </span></a></span>).</p></div><div class="Para" id="Par236">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC87">11-24</a></span> and run the application. You should observe the following output:<div class="ProgramCode" id="PC89"><div class="LineGroup"><div class="FixedLine">{</div><div class="FixedLine">  &quot;firstname&quot; : &quot;John&quot;,</div><div class="FixedLine">  &quot;lastName&quot; : &quot;Doe&quot;,</div><div class="FixedLine">  &quot;age&quot; : 42,</div><div class="FixedLine">  &quot;address&quot; :</div><div class="FixedLine">  {</div><div class="FixedLine">    &quot;street&quot; : &quot;400 Some Street&quot;,</div><div class="FixedLine">    &quot;city&quot; : &quot;Beverly Hills&quot;,</div><div class="FixedLine">    &quot;state&quot; : &quot;CA&quot;,</div><div class="FixedLine">    &quot;zipcode&quot; : 90210</div><div class="FixedLine">  },</div><div class="FixedLine">  &quot;phoneNumbers&quot; :</div><div class="FixedLine">  [</div><div class="FixedLine">    {</div><div class="FixedLine">      &quot;type&quot; : &quot;home&quot;,</div><div class="FixedLine">      &quot;number&quot; : &quot;310 555-1234&quot;</div><div class="FixedLine">    },</div><div class="FixedLine">    {</div><div class="FixedLine">      &quot;type&quot; : &quot;fax&quot;,</div><div class="FixedLine">      &quot;number&quot; : &quot;310 555-4567&quot;</div><div class="FixedLine">    }</div><div class="FixedLine">  ]</div><div class="FixedLine">}</div></div></div></div><p class="Para" id="Par237">For some custom pretty printers, Jackson鈥檚 <span class="EmphasisFontCategoryNonProportional ">com.fasterxml.jackson.core.util.MinimalPrettyPrinter</span> class, which adds no indentation but implements everything necessary for value output to work as expected, might be easier to <span id="ITerm201">use</span>.</p></section><section class="Section2 RenderAsSection2" id="Sec34"><h3 class="Heading">Factory, Parser, and Generator Features</h3><p class="Para" id="Par238"><span id="ITerm202">
                  <span class="EmphasisFontCategoryNonProportional ">JsonFactory</span>
                  
                </span><span id="ITerm203">
                  
                  
                </span><span id="ITerm204">
                  
                  
                </span><span id="ITerm205">
                  
                  
                </span>, <span class="EmphasisFontCategoryNonProportional ">JsonFactory</span>, and <span id="ITerm206">
                  <span class="EmphasisFontCategoryNonProportional ">JsonGenerator</span>
                  
                </span> instances can be customized by enabling various <em class="EmphasisTypeItalic ">features</em>, which are constants declared by nested <span class="EmphasisFontCategoryNonProportional ">Feature</span> enums.</p><div class="Para" id="Par239"><span class="EmphasisFontCategoryNonProportional ">JsonFactory.Feature</span> offers the following factory-oriented features (check out the Javadoc for descriptions):<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par240">
                      <span class="EmphasisFontCategoryNonProportional ">CANONICALIZE_FIELD_NAMES</span>
                    </p></li><li><p class="Para" id="Par241">
                      <span class="EmphasisFontCategoryNonProportional ">FAIL_ON_SYMBOL_HASH_OVERFLOW</span>
                    </p></li><li><p class="Para" id="Par242">
                      <span class="EmphasisFontCategoryNonProportional ">INTERN_FIELD_NAMES</span>
                    </p></li><li><p class="Para" id="Par243">
                      <span class="EmphasisFontCategoryNonProportional ">USE_THREAD_LOCAL_FOR_BUFFER_RECYCLING</span>
                    </p></li></ul></div></div><div class="Para" id="Par244"><span class="EmphasisFontCategoryNonProportional ">JsonFactory</span> provides four methods to enable, disable, and interrogate the state of these features:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par245">
                      <span class="EmphasisFontCategoryNonProportional ">JsonFactory configure(JsonFactory.Feature f, boolean state)</span>
                    </p></li><li><p class="Para" id="Par246">
                      <span class="EmphasisFontCategoryNonProportional ">JsonFactory disable(JsonFactory.Feature f)</span>
                    </p></li><li><p class="Para" id="Par247">
                      <span class="EmphasisFontCategoryNonProportional ">JsonFactory enable(JsonFactory.Feature f)</span>
                    </p></li><li><p class="Para" id="Par248">
                      <span class="EmphasisFontCategoryNonProportional ">boolean isEnabled(JsonFactory.Feature f)</span>
                    </p></li></ul></div></div><div class="Para" id="Par249"><span id="ITerm207">
                  <span class="EmphasisFontCategoryNonProportional ">JsonParser.Feature</span>
                  
                </span><span id="ITerm208">
                  
                </span> offers the following parser-oriented features (check out the Javadoc for descriptions):<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par250">
                      <span class="EmphasisFontCategoryNonProportional ">ALLOW_BACKSLASH_ESCAPING_ANY_CHARACTER</span>
                    </p></li><li><p class="Para" id="Par251">
                      <span class="EmphasisFontCategoryNonProportional ">ALLOW_COMMENTS</span>
                    </p></li><li><p class="Para" id="Par252">
                      <span class="EmphasisFontCategoryNonProportional ">ALLOW_MISSING_VALUES</span>
                    </p></li><li><p class="Para" id="Par253">
                      <span class="EmphasisFontCategoryNonProportional ">ALLOW_NON_NUMERIC_NUMBERS</span>
                    </p></li><li><p class="Para" id="Par254">
                      <span class="EmphasisFontCategoryNonProportional ">ALLOW_NUMERIC_LEADING_ZEROS</span>
                    </p></li><li><p class="Para" id="Par255">
                      <span class="EmphasisFontCategoryNonProportional ">ALLOW_SINGLE_QUOTES</span>
                    </p></li><li><p class="Para" id="Par256">
                      <span class="EmphasisFontCategoryNonProportional ">ALLOW_TRAILING_COMMA</span>
                    </p></li><li><p class="Para" id="Par257">
                      <span class="EmphasisFontCategoryNonProportional ">ALLOW_UNQUOTED_CONTROL_CHARS</span>
                    </p></li><li><p class="Para" id="Par258">
                      <span class="EmphasisFontCategoryNonProportional ">ALLOW_UNQUOTED_FIELD_NAMES</span>
                    </p></li><li><p class="Para" id="Par259">
                      <span class="EmphasisFontCategoryNonProportional ">ALLOW_YAML_COMMENTS</span>
                    </p></li><li><p class="Para" id="Par260">
                      <span class="EmphasisFontCategoryNonProportional ">AUTO_CLOSE_SOURCE</span>
                    </p></li><li><p class="Para" id="Par261">
                      <span class="EmphasisFontCategoryNonProportional ">IGNORE_UNDEFINED</span>
                    </p></li><li><p class="Para" id="Par262">
                      <span class="EmphasisFontCategoryNonProportional ">INCLUDE_SOURCE_IN_LOCATION</span>
                      <span id="ITerm209">
                        
                        
                      </span>
                      <span id="ITerm210">
                        
                        
                      </span>
                      <span id="ITerm211">
                        
                        
                      </span>
                    </p></li><li><p class="Para" id="Par263">
                      <span class="EmphasisFontCategoryNonProportional ">STRICT_DUPLICATE_DETECTION</span>
                    </p></li></ul></div></div><div class="Para" id="Par264"><span class="EmphasisFontCategoryNonProportional ">JsonParser</span> provides four methods to enable, disable, and interrogate the state of these features:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par265">
                      <span class="EmphasisFontCategoryNonProportional ">JsonParser configure(JsonParser.Feature f, boolean state)</span>
                    </p></li><li><p class="Para" id="Par266">
                      <span class="EmphasisFontCategoryNonProportional ">JsonParser disable(JsonParser.Feature f)</span>
                    </p></li><li><p class="Para" id="Par267">
                      <span class="EmphasisFontCategoryNonProportional ">JsonParser enable(JsonParser.Feature f)</span>
                    </p></li><li><p class="Para" id="Par268">
                      <span class="EmphasisFontCategoryNonProportional ">boolean isEnabled(JsonParser.Feature f)</span>
                    </p></li></ul></div></div><div class="Para" id="Par269"><span id="ITerm212">
                  <span class="EmphasisFontCategoryNonProportional ">JsonGenerator.Feature</span>
                  
                </span> offers the following generator-oriented features (check out the Javadoc for descriptions):<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par270">
                      <span class="EmphasisFontCategoryNonProportional ">AUTO_CLOSE_JSON_CONTENT</span>
                    </p></li><li><p class="Para" id="Par271">
                      <span class="EmphasisFontCategoryNonProportional ">AUTO_CLOSE_TARGET</span>
                    </p></li><li><p class="Para" id="Par272">
                      <span class="EmphasisFontCategoryNonProportional ">ESCAPE_NON_ASCII</span>
                    </p></li><li><p class="Para" id="Par273">
                      <span class="EmphasisFontCategoryNonProportional ">FLUSH_PASSED_TO_STREAM</span>
                    </p></li><li><p class="Para" id="Par274">
                      <span class="EmphasisFontCategoryNonProportional ">IGNORE_UNKNOWN</span>
                    </p></li><li><p class="Para" id="Par275">
                      <span class="EmphasisFontCategoryNonProportional ">QUOTE_FIELD_NAMES</span>
                    </p></li><li><p class="Para" id="Par276">
                      <span class="EmphasisFontCategoryNonProportional ">QUOTE_NON_NUMERIC_NUMBERS</span>
                    </p></li><li><p class="Para" id="Par277">
                      <span class="EmphasisFontCategoryNonProportional ">STRICT_DUPLICATE_DETECTION</span>
                      <span id="ITerm213">
                        
                        
                      </span>
                      <span id="ITerm214">
                        
                        
                      </span>
                      <span id="ITerm215">
                        
                        
                      </span>
                    </p></li><li><p class="Para" id="Par278">
                      <span class="EmphasisFontCategoryNonProportional ">WRITE_BIGDECIMAL_AS_PLAIN</span>
                    </p></li><li><p class="Para" id="Par279">
                      <span class="EmphasisFontCategoryNonProportional ">WRITE_NUMBERS_AS_STRINGS</span>
                    </p></li></ul></div></div><div class="Para" id="Par280"><span class="EmphasisFontCategoryNonProportional ">JsonGenerator</span> provides four methods to enable, disable, and interrogate the state of these features:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par281">
                      <span class="EmphasisFontCategoryNonProportional ">JsonGenerator configure(JsonGenerator.Feature f, boolean state)</span>
                    </p></li><li><p class="Para" id="Par282">
                      <span class="EmphasisFontCategoryNonProportional ">JsonGenerator disable(JsonGenerator.Feature f)</span>
                    </p></li><li><p class="Para" id="Par283">
                      <span class="EmphasisFontCategoryNonProportional ">JsonGenerator enable(JsonGenerator.Feature f)</span>
                    </p></li><li><p class="Para" id="Par284">
                      <span class="EmphasisFontCategoryNonProportional ">boolean isEnabled(JsonGenerator.Feature f)</span>
                    </p></li></ul></div></div><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar11"><h3 class="Heading">Note</h3><p class="Para" id="Par285">For convenience, <span class="EmphasisFontCategoryNonProportional ">JsonFactory</span> duplicates <span class="EmphasisFontCategoryNonProportional ">JsonParser</span>鈥檚 and <span class="EmphasisFontCategoryNonProportional ">JsonGenerator</span>鈥檚 feature methods, which return, where applicable, <span class="EmphasisFontCategoryNonProportional ">JsonFactory</span> instead of <span class="EmphasisFontCategoryNonProportional ">JsonParser</span> or <span class="EmphasisFontCategoryNonProportional ">JsonGenerator</span>.</p></div><div class="Para" id="Par286">Finally, <span class="EmphasisFontCategoryNonProportional ">ObjectMapper</span> supports the customization of its <span class="EmphasisFontCategoryNonProportional ">JsonParser</span> and <span class="EmphasisFontCategoryNonProportional ">JsonGenerator</span> objects by providing the following convenience <span id="ITerm216">methods</span><span id="ITerm217">
                  
                  
                </span><span id="ITerm218">
                  
                  
                </span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par287">
                      <span class="EmphasisFontCategoryNonProportional ">ObjectMapper configure(JsonGenerator.Feature f, boolean state)</span>
                    </p></li><li><p class="Para" id="Par288">
                      <span class="EmphasisFontCategoryNonProportional ">ObjectMapper configure(JsonParser.Feature f, boolean state)</span>
                    </p></li><li><p class="Para" id="Par289">
                      <span class="EmphasisFontCategoryNonProportional ">ObjectMapper disable(JsonGenerator.Feature... features)</span>
                    </p></li><li><p class="Para" id="Par290">
                      <span class="EmphasisFontCategoryNonProportional ">ObjectMapper disable(JsonParser.Feature... features)</span>
                    </p></li><li><p class="Para" id="Par291">
                      <span class="EmphasisFontCategoryNonProportional ">ObjectMapper enable(JsonGenerator.Feature... features)</span>
                    </p></li><li><p class="Para" id="Par292">
                      <span class="EmphasisFontCategoryNonProportional ">ObjectMapper enable(JsonParser.Feature... features)</span>
                    </p></li><li><p class="Para" id="Par293">
                      <span class="EmphasisFontCategoryNonProportional ">boolean isEnabled(JsonFactory.Feature f)</span>
                    </p></li><li><p class="Para" id="Par294">
                      <span class="EmphasisFontCategoryNonProportional ">boolean isEnabled(JsonGenerator.Feature f)</span>
                    </p></li><li><p class="Para" id="Par295">
                      <span class="EmphasisFontCategoryNonProportional ">boolean isEnabled(JsonParser.Feature f)</span>
                    </p></li></ul></div></div><div class="Para" id="Par296">In Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC48">11-14</a></span>, I disabled <span class="EmphasisFontCategoryNonProportional ">JsonGenerator</span>&apos;s <span class="EmphasisFontCategoryNonProportional ">AUTO_CLOSE_TARGET</span> feature via an <span class="EmphasisFontCategoryNonProportional ">ObjectMapper</span> instance by using the following code fragment:<div class="ProgramCode" id="PC90"><div class="LineGroup"><div class="FixedLine">mapper.disable(JsonGenerator.Feature.AUTO_CLOSE_TARGET);</div></div></div></div><p class="Para" id="Par297">If you recall, I disabled this feature to prevent <span class="EmphasisFontCategoryNonProportional ">mapper.writeValue()</span> from closing the <span class="EmphasisFontCategoryNonProportional ">System.out</span> stream<span id="ITerm219">
                  
                  
                </span><span id="ITerm220">
                  
                  
                </span><span id="ITerm221">
                  
                  
                </span>.</p><div class="FormalPara FormalParaRenderingStyle3 ParaTypeOverview" id="FPar12"><h3 class="Heading">Exercises</h3><div class="Para" id="Par298">The following exercises are designed to test your understanding of Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml"><span class="RefSource">11</span></a></span>鈥檚 content:<div class="OrderedList"><ol><li class="ListItem"><span class="ItemNumber">1.</span><div class="ItemContent"><p class="Para" id="Par299">Define Jackson.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">2.</span><div class="ItemContent"><p class="Para" id="Par300">Identify Jackson鈥檚 packages.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">3.</span><div class="ItemContent"><p class="Para" id="Par301">True or false: Jackson supports only full data binding and POJO data binding.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">4.</span><div class="ItemContent"><p class="Para" id="Par302">How does streaming in Jackson work?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">5.</span><div class="ItemContent"><p class="Para" id="Par303">True or false: Streaming is the least efficient way to process JSON content.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">6.</span><div class="ItemContent"><p class="Para" id="Par304">How do you create a stream-based parser?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">7.</span><div class="ItemContent"><p class="Para" id="Par305">After you obtain a parser, how do use the parser to parse JSON content?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">8.</span><div class="ItemContent"><p class="Para" id="Par306">How do you create a stream-based generator?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">9.</span><div class="ItemContent"><p class="Para" id="Par307">After you obtain a generator, how do you use the generator to generate JSON content?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">10.</span><div class="ItemContent"><p class="Para" id="Par308">True or false: The tree model provides a mutable in-memory tree representation of a JSON document.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">11.</span><div class="ItemContent"><p class="Para" id="Par309">What class is used to start building a tree?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">12.</span><div class="ItemContent"><p class="Para" id="Par310">How do you read a JSON document into an in-memory tree?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">13.</span><div class="ItemContent"><p class="Para" id="Par311">What is the difference between <span class="EmphasisFontCategoryNonProportional ">JsonNode get(int index)</span> and <span class="EmphasisFontCategoryNonProportional ">JsonNode path(int index)</span>?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">14.</span><div class="ItemContent"><p class="Para" id="Par312">How do you write a tree to a JSON document?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">15.</span><div class="ItemContent"><p class="Para" id="Par313">Define data binding in Jackson.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">16.</span><div class="ItemContent"><p class="Para" id="Par314">What is the purpose of the <span class="EmphasisFontCategoryNonProportional ">TypeReference</span> class?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">17.</span><div class="ItemContent"><p class="Para" id="Par315">How does simple data binding differ from full data binding?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">18.</span><div class="ItemContent"><p class="Para" id="Par316">By default, how does Jackson map the fields of a JSON object to fields in a Java object?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">19.</span><div class="ItemContent"><p class="Para" id="Par317">True or false: A getter method makes a non-<span class="EmphasisFontCategoryNonProportional ">public</span> field serializable only.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">20.</span><div class="ItemContent"><p class="Para" id="Par318">List Jackson鈥檚 read-only annotation types.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">21.</span><div class="ItemContent"><p class="Para" id="Par319">What does the <span class="EmphasisFontCategoryNonProportional ">JsonPropertyOrder</span> annotation type accomplish?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">22.</span><div class="ItemContent"><p class="Para" id="Par320">What鈥檚 the difference between a stateful and a stateless pretty printer class?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">23.</span><div class="ItemContent"><p class="Para" id="Par321">How do you prevent <span class="EmphasisFontCategoryNonProportional ">ObjectMapper</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">writeValue()</span> methods from closing the <span class="EmphasisFontCategoryNonProportional ">System.out</span> stream?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">24.</span><div class="ItemContent"><p class="Para" id="Par322">Modify Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_11_Chapter.xhtml#PC11">11-3</a></span> so that numbers are written out as strings.</p></div><div class="ClearBoth"> </div></li></ol></div></div></div></section></section><section class="Section1 RenderAsSection1" id="Sec35"><h2 class="Heading">Summary</h2><p class="Para" id="Par323">Jackson is a suite of data-processing tools for Java. These tools include a streaming JSON parser/generator library, a matching data-binding library (for converting Plain Old Java Objects鈥擯OJOs鈥攖o and from JSON), and additional data format modules for processing data encoded in XML and other formats.</p><p class="Para" id="Par324">Jackson consists of core, databind, and annotations packages. The core package supports a StAX-like streaming API for reading and writing JSON via sequences of discrete events. The databind package supports a DOM-like tree model that provides a mutable in-memory tree representation of a JSON document. The annotations package provides public core annotation types, most of which are used to configure how data binding (mapping) works.</p><p class="Para" id="Par325">The Jackson Core and Jackson Databind packages support the consumption and creation of JSON documents. They offer various types related to streaming, the tree model, and POJO-oriented data binding.</p><p class="Para" id="Par326">Jackson provides various advanced features, which focus largely on customization in terms of annotation types; custom pretty printers; and factory, parser, and generator features.</p><p class="Para" id="Par327">The annotation types influence how JSON is read into Java objects or what JSON is generated from Java objects. Annotation types are read-only, write-only, or read-write.</p><p class="Para" id="Par328">Jackson supports pretty printers to improve the appearance of generated output (making it easier to read). A custom pretty printer class implements the <span class="EmphasisFontCategoryNonProportional ">PrettyPrinter</span> interface.</p><p class="Para" id="Par329"><span class="EmphasisFontCategoryNonProportional ">JsonFactory</span>, <span class="EmphasisFontCategoryNonProportional ">JsonParser</span>, and <span class="EmphasisFontCategoryNonProportional ">JsonGenerator</span> instances can be customized by enabling various features, which are constants declared by nested <span class="EmphasisFontCategoryNonProportional ">Feature</span> enums. Each class provides <span class="EmphasisFontCategoryNonProportional ">configure()</span>, <span class="EmphasisFontCategoryNonProportional ">enable()</span>, <span class="EmphasisFontCategoryNonProportional ">disable()</span>, and <span class="EmphasisFontCategoryNonProportional ">isEnabled()</span> methods to enable/disable a feature or learn if a feature is enabled.</p><p class="Para" id="Par330">Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml"><span class="RefSource">12</span></a></span> introduces JSON-P for parsing and generating JSON content.</p></section></div><div class="annotator-outer annotator-viewer viewer annotator-hide"> </div></div></div>
    </section>
  </div>
</div>

<hr/>

<!--if IE]><![endif]--><!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="3866890"
  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"
  data-username="levinxccai"
  data-account-type="B2B"
  
  data-activated-trial-date="11/06/2017"


  data-archive="9781484243305"
  data-publishers="Apress"



  data-htmlfile-name="394211_2_En_12_Chapter.xhtml"
  data-epub-title="Java XML and JSON: Document Processing for Java SE" data-debug=0 data-testing=0><![endif]--><!--if gt IE 8]><!--><!--![endif]-->



<a name="14_"></a>

<div class="application" id="container" style="height: auto;">
  <div class="js-toc">
    <section role="document">
      <div id="sbo-rt-content" style="max-width:72.5em; transform: none;"><div class="annotator-wrapper"><!--egin Abstract--><div class="MainTitleSection"><h1 class="ChapterTitle" lang="en">12. Processing JSON with JSON-P</h1></div><div class="AuthorGroup"><div class="AuthorNames"><span class="Author"><span class="AuthorName">Jeff Friesen</span><sup><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#Aff2">1</a> <span class="ContactIcon"></span></sup></span></div><div class="Affiliations"><div class="Affiliation" id="Aff2"><span class="AffiliationNumber">(1)</span><div class="AffiliationText">Dauphin, MB, Canada</div></div><div class="ClearBoth"> </div></div></div><!--nd Abstract--><div class="Fulltext"><p class="Para" id="Par2">JSON-P is an intriguing API because it was originally considered for inclusion in Java SE, but was made available to Java EE instead. Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml"><span class="RefSource">12</span></a></span> explores JSON-P.</p><section class="Section1 RenderAsSection1" id="Sec1"><h2 class="Heading">What Is JSON-P?</h2><p class="Para" id="Par3"><em class="EmphasisTypeItalic ">JSON Processing (JSON-P)</em> is a Java API for processing (i.e., parsing, generating, querying, and transforming) JSON content.</p><section class="Section2 RenderAsSection2" id="Sec2"><h3 class="Heading">JSON-P 1.0</h3><p class="Para" id="Par4"><span id="ITerm1">JSON-P 1.0</span> processes JSON content via an object model or a streaming model. The object model lets JSON-P build a tree of objects for JSON text via API classes similarly to Java鈥檚 DOM API for XML. The streaming model lets JSON-P produce and consume JSON text similarly to Java鈥檚 StAX API for XML.</p><p class="Para" id="Par5">JSON-P 1.0 began as 鈥?span id=&quot;ITerm2&quot;&gt;Java Specification Request (JSR)</span> 353: Java API for JSON Processing鈥?(<span class="ExternalRef"><a href="http://jcp.org/en/jsr/detail?id=353"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://jcp.org/en/jsr/detail?id=353</span>
                  </span></a></span>). It was officially released in May 2013, but only for Java EE 7 and higher. However, it also can be used in a Java SE 6 and higher context.</p><p class="Para" id="Par6">JSON-P 1.0 consists of 25 types located in package <span class="EmphasisFontCategoryNonProportional ">javax.json</span>, along with the support packages <span class="EmphasisFontCategoryNonProportional ">javax.json.spi</span> and <span class="EmphasisFontCategoryNonProportional ">javax.json.stream</span>. The <span class="EmphasisFontCategoryNonProportional ">javax.json</span> package mainly contains types that support the object model, the <span class="EmphasisFontCategoryNonProportional ">javax.json.spi</span> package contains a single type that describes a service provider for JSON processing objects, and the <span class="EmphasisFontCategoryNonProportional ">javax.json.stream</span> package contains types that support the streaming model. Both models are discussed later.</p><div class="Para" id="Par7">The <span class="EmphasisFontCategoryNonProportional ">javax.json</span> package provides the entry-point <span class="EmphasisFontCategoryNonProportional ">Json</span> factory class for creating JSON processing objects, such as array builders, object builders, readers, writers, parsers, and generators, and additional types that collectively define an object model API for processing JSON <span id="ITerm3">text</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par8"><span id="ITerm4">
                        <span class="EmphasisFontCategoryNonProportional ">JsonArray</span>
                        
                      </span>: an interface that represents an immutable JSON array (an ordered sequence of zero or more values)</p></li><li><p class="Para" id="Par9"><span id="ITerm5">
                        <span class="EmphasisFontCategoryNonProportional ">JsonArrayBuilder</span>
                        
                      </span>: an interface that describes a builder for creating <span class="EmphasisFontCategoryNonProportional ">JsonArray</span> models from scratch</p></li><li><p class="Para" id="Par10"><span id="ITerm6">
                        <span class="EmphasisFontCategoryNonProportional ">JsonBuilderFactory</span>
                        
                      </span>: an interface that describes a factory for creating <span class="EmphasisFontCategoryNonProportional ">JsonArrayBuilder</span> and <span class="EmphasisFontCategoryNonProportional ">JsonObjectBuilder</span> objects</p></li><li><p class="Para" id="Par11"><span id="ITerm7">
                        <span class="EmphasisFontCategoryNonProportional ">JsonNumber</span>
                        
                      </span>: an interface that represents an immutable JSON number value</p></li><li><p class="Para" id="Par12"><span id="ITerm8">
                        <span class="EmphasisFontCategoryNonProportional ">JsonObject</span>
                        
                      </span>: an interface that represents an immutable JSON object value (an unordered collection of zero or more name/value pairs)</p></li><li><p class="Para" id="Par13"><span id="ITerm9">
                        <span class="EmphasisFontCategoryNonProportional ">JsonObjectBuilder</span>
                        
                      </span>: an interface that describes a builder for creating <span class="EmphasisFontCategoryNonProportional ">JsonObject</span> models from scratch</p></li><li><p class="Para" id="Par14"><span id="ITerm10">
                        <span class="EmphasisFontCategoryNonProportional ">JsonReader</span>
                        
                      </span>: an interface that describes a way to read a JSON object or an array structure from an input source</p></li><li><p class="Para" id="Par15"><span id="ITerm11">
                        <span class="EmphasisFontCategoryNonProportional ">JsonReaderFactory</span>
                        
                      </span>: an interface that describes a factory for creating <span class="EmphasisFontCategoryNonProportional ">JsonReader</span> objects</p></li><li><p class="Para" id="Par16"><span id="ITerm12">
                        <span class="EmphasisFontCategoryNonProportional ">JsonString</span>
                        
                      </span>: an interface that represents an immutable JSON string</p></li><li><p class="Para" id="Par17"><span id="ITerm13">
                        <span class="EmphasisFontCategoryNonProportional ">JsonStructure</span>
                        
                      </span>: an interface that serves as the direct supertype of <span class="EmphasisFontCategoryNonProportional ">JsonArray</span> and <span class="EmphasisFontCategoryNonProportional ">JsonObject</span></p></li><li><p class="Para" id="Par18"><span id="ITerm14">
                        <span class="EmphasisFontCategoryNonProportional ">JsonValue</span>
                        
                      </span>: an interface that represents an immutable JSON value, and is also the direct supertype of <span class="EmphasisFontCategoryNonProportional ">JsonNumber</span>, <span class="EmphasisFontCategoryNonProportional ">JsonString</span>, and <span class="EmphasisFontCategoryNonProportional ">JsonStructure</span></p></li><li><p class="Para" id="Par19"><span id="ITerm15">
                        <span class="EmphasisFontCategoryNonProportional ">JsonWriter</span>
                        
                      </span>: an interface that describes a way to write a JSON object or an array structure to an output destination</p></li><li><p class="Para" id="Par20"><span id="ITerm16">
                        <span class="EmphasisFontCategoryNonProportional ">JsonWriterFactory</span>
                        
                      </span>: an interface that describes a factory for creating <span class="EmphasisFontCategoryNonProportional ">JsonWriter</span> objects</p></li><li><p class="Para" id="Par21"><span id="ITerm17">
                        <span class="EmphasisFontCategoryNonProportional ">JsonValue.ValueType</span>
                        
                      </span>: an enum of <span class="EmphasisFontCategoryNonProportional ">JsonValue</span> type constants</p></li><li><p class="Para" id="Par22"><span id="ITerm18">
                        <span class="EmphasisFontCategoryNonProportional ">JsonException</span>
                        
                      </span>: an exception that identifies some kind of failure during JSON <span id="ITerm19">processing</span></p></li></ul></div></div><div class="FormalPara FormalParaRenderingStyle3 ParaTypeOverview" id="FPar1"><h3 class="Heading">Json Value Hierarchy</h3><div class="Para" id="Par23"><span class="EmphasisFontCategoryNonProportional ">JsonValue</span> is the superinterface of interface types that represent immutable JSON values. Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#Fig1">12-1</a></span> shows their hierarchical relationship.<figure class="Figure" id="Fig1"><div class="MediaObject" id="MO1"><img alt="../images/394211_2_En_12_Chapter/394211_2_En_12_Fig1_HTML.png" data-mfp-src="/library/view/java-xml-and/9781484243305/images/394211_2_En_12_Chapter/394211_2_En_12_Fig1_HTML.png" height="750" src="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/images/394211_2_En_12_Chapter/394211_2_En_12_Fig1_HTML.png" style="height:18.75em" width="1392"/></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 12-1</span><p class="SimplePara">Relating JSON <span id="ITerm20">value types</span></p></div></figcaption></figure></div><p class="Para" id="Par24">JSON鈥檚 Boolean and null types exist as <span class="EmphasisFontCategoryNonProportional ">TRUE</span>, <span class="EmphasisFontCategoryNonProportional ">FALSE</span>, and <span class="EmphasisFontCategoryNonProportional ">NULL</span> constants in <span class="EmphasisFontCategoryNonProportional ">JsonValue</span>.</p></div><div class="Para" id="Par25">The <span class="EmphasisFontCategoryNonProportional ">javax.json.spi</span> service provider interface package provides a single type for plugging in JSON processing <span id="ITerm21">object implementations</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par26"><span id="ITerm22">
                        <span class="EmphasisFontCategoryNonProportional ">JsonProvider</span>
                        
                      </span>: an abstract class that serves as a service provider for JSON processing objects. The JSON-P libraries include a default Glassfish (<span class="ExternalRef"><a href="http://en.wikipedia.org/wiki/GlassFish"><span class="RefSource">
                          <span class="EmphasisFontCategoryNonProportional ">http://en.wikipedia.org/wiki/GlassFish</span>
                        </span></a></span>) <span class="EmphasisFontCategoryNonProportional ">JsonProvider</span> implementation.</p></li></ul></div></div><div class="Para" id="Par27">Finally, the <span class="EmphasisFontCategoryNonProportional ">javax.json.stream</span> package provides several types that collectively define a streaming API for parsing and generating JSON <span id="ITerm23">text</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par28"><span id="ITerm24">
                        <span class="EmphasisFontCategoryNonProportional ">JsonGenerator</span>
                        
                      </span>: an interface that describes a way to write JSON data to an output destination in a streaming manner</p></li><li><p class="Para" id="Par29"><span id="ITerm25">
                        <span class="EmphasisFontCategoryNonProportional ">JsonGeneratorFactory</span>
                        
                      </span>: an interface that describes a factory for creating <span class="EmphasisFontCategoryNonProportional ">JsonGenerator</span> objects</p></li><li><p class="Para" id="Par30"><span id="ITerm26">
                        <span class="EmphasisFontCategoryNonProportional ">JsonLocation</span>
                        
                      </span>: an interface that describes a way to obtain the location information (e.g., column and line numbers) of a JSON event in an input source</p></li><li><p class="Para" id="Par31"><span id="ITerm27">
                        <span class="EmphasisFontCategoryNonProportional ">JsonParser</span>
                        
                      </span>: an interface that describes a way to read JSON data from an input source in a streaming (and read-only) manner</p></li><li><p class="Para" id="Par32"><span id="ITerm28">
                        <span class="EmphasisFontCategoryNonProportional ">JsonParserFactory</span>
                        
                      </span>: an interface that describes a factory for creating <span class="EmphasisFontCategoryNonProportional ">JsonParser</span> objects</p></li><li><p class="Para" id="Par33"><span id="ITerm29">
                        <span class="EmphasisFontCategoryNonProportional ">JsonParser.EVENT</span>
                        
                      </span>: an enum of event types</p></li><li><p class="Para" id="Par34"><span id="ITerm30">
                        <span class="EmphasisFontCategoryNonProportional ">JsonGenerationException</span>
                        
                      </span>: an exception indicating that an incorrect JSON document is being generated</p></li><li><p class="Para" id="Par35"><span id="ITerm31">
                        <span class="EmphasisFontCategoryNonProportional ">JsonParsingException</span>
                        
                      </span>: an exception indicating that an incorrect JSON document is being <span id="ITerm32">parsed</span></p></li></ul></div></div><p class="Para" id="Par36">A complete API reference is available by pointing the browser to JSR 353鈥檚 鈥淛SR-000353 Java API for JSON Processing 1.0 Final Release for Evaluation鈥?(<span class="ExternalRef"><a href="http://download.oracle.com/otndocs/jcp/json-1_0-fr-eval-spec/index.html"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://download.oracle.com/otndocs/jcp/json-1_0-fr-eval-spec/index.html</span>
                  </span></a></span>) page, accepting the license agreement, downloading <span class="EmphasisFontCategoryNonProportional ">javax.json-api-1.0-javadoc.zip</span>, unzipping this archive, and executing <span class="EmphasisFontCategoryNonProportional ">jar xvf javax.json-api-1.0-javadoc.jar</span> on the resulting <span class="EmphasisFontCategoryNonProportional ">javax.json-api-1.0-javadoc.jar</span> file. Point the web browser to the unzipped <span class="EmphasisFontCategoryNonProportional ">index.html</span> file to access the API <span id="ITerm33">reference</span>.</p></section><section class="Section2 RenderAsSection2" id="Sec3"><h3 class="Heading">JSON-P 1.1</h3><p class="Para" id="Par37"><span id="ITerm34">JSON-P 1.1</span> also supports JSON Pointer, JSON Patch, and JSON Merge Patch. Additionally, the new version introduces editing/transformation operations to JSON array and object builders and updates the API to better support Java SE 8 stream operations (including JSON-specific collectors).</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar2"><h3 class="Heading">Note</h3><p class="Para" id="Par38">After JSON-P 1.0 was released, JSON Pointer, JSON Patch, and JSON Merge Patch specifications were released. <em class="EmphasisTypeItalic ">JSON Pointer</em> defines a string-syntax for identifying a specific value in a JSON document. <em class="EmphasisTypeItalic ">JSON Patch</em> defines a JSON document structure for expressing a sequence of operations to apply to another JSON document (and also makes use of JSON Pointer). <em class="EmphasisTypeItalic ">JSON Merge Patch</em> is similar to JSON Patch in that it鈥檚 also used to change another JSON document鈥檚 structure. However, the syntax of the JSON Merge Patch JSON document more closely mimics the syntax of the JSON document that鈥檚 being changed.</p></div><p class="Para" id="Par39">JSON-P 1.1 began as 鈥淛SR 374: Java API for JSON Processing 1.1鈥?(<span class="ExternalRef"><a href="http://jcp.org/en/jsr/detail?id=374"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://jcp.org/en/jsr/detail?id=374</span>
                  </span></a></span>). It was officially released in May 2017, but only for Java EE 8 and higher. However, it also can be used in a Java SE 8 and higher context.</p><div class="Para" id="Par40">JSON-P 1.1 consists of 31 types that are located in the main package <span class="EmphasisFontCategoryNonProportional ">javax.json</span>, along with the support packages <span class="EmphasisFontCategoryNonProportional ">javax.json.spi</span> and <span class="EmphasisFontCategoryNonProportional ">javax.json.stream</span>. (No new packages have been added.) The following new types have been added to <span id="ITerm35">
                  <span class="EmphasisFontCategoryNonProportional ">javax.json</span>
                  
                  
                </span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par41"><span id="ITerm36">
                        <span class="EmphasisFontCategoryNonProportional ">JsonMergePatch</span>
                        
                      </span>: an interface that represents an implementation of a JSON Merge Patch as defined by RFC 7386 (<span class="ExternalRef"><a href="http://tools.ietf.org/html/rfc7386"><span class="RefSource">
                          <span class="EmphasisFontCategoryNonProportional ">http://tools.ietf.org/html/rfc7386</span>
                        </span></a></span>)</p></li><li><p class="Para" id="Par42"><span id="ITerm37">
                        <span class="EmphasisFontCategoryNonProportional ">JsonPatch</span>
                        
                      </span>: an interface that represents an immutable implementation of a JSON Patch as defined by RFC 6902 (<span class="ExternalRef"><a href="http://tools.ietf.org/html/rfc6902"><span class="RefSource">
                          <span class="EmphasisFontCategoryNonProportional ">http://tools.ietf.org/html/rfc6902</span>
                        </span></a></span>)</p></li><li><p class="Para" id="Par43"><span id="ITerm38">
                        <span class="EmphasisFontCategoryNonProportional ">JsonPatchBuilder</span>
                        
                      </span>: an interface that describes a builder for constructing a JSON Patch by adding JSON Patch operations incrementally</p></li><li><p class="Para" id="Par44"><span id="ITerm39">
                        <span class="EmphasisFontCategoryNonProportional ">JsonPointer</span>
                        
                      </span>: an interface that represents an immutable implementation of a JSON Pointer as defined by RFC 6901 (<span class="ExternalRef"><a href="http://tools.ietf.org/html/rfc6901"><span class="RefSource">
                          <span class="EmphasisFontCategoryNonProportional ">http://tools.ietf.org/html/rfc6901</span>
                        </span></a></span>)</p></li><li><p class="Para" id="Par45"><span id="ITerm40">
                        <span class="EmphasisFontCategoryNonProportional ">JsonPatch.Operation</span>
                        
                      </span>: an enum of valid RFC 6902 JSON Patch operations</p></li></ul></div></div><div class="Para" id="Par46">The following new type is located in <span class="EmphasisFontCategoryNonProportional ">javax.json.stream</span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par47"><span id="ITerm41">
                        <span class="EmphasisFontCategoryNonProportional ">JsonCollectors</span>
                        
                      </span>: a class with <span class="EmphasisFontCategoryNonProportional ">java.util.stream.Collector</span> implementations for accumulating <span class="EmphasisFontCategoryNonProportional ">JsonValue</span>s into <span class="EmphasisFontCategoryNonProportional ">JsonArray</span>s and <span class="EmphasisFontCategoryNonProportional ">JsonObject</span>s<span id="ITerm42">
                        
                        
                      </span></p></li></ul></div></div><p class="Para" id="Par48">Additional changes in the form of new methods have been made to existing classes.</p><p class="Para" id="Par49">A complete API reference is available by pointing the browser to JSR 374鈥檚 鈥淛SR-000374 Java API for JSON Processing 1.1 Specification Final Release for Evaluation鈥?(<span class="ExternalRef"><a href="http://download.oracle.com/otndocs/jcp/json_p-1_1-final-eval-spec/index.html"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://download.oracle.com/otndocs/jcp/json_p-1_1-final-eval-spec/index.html</span>
                  </span></a></span>) page, accepting the license agreement, downloading <span class="EmphasisFontCategoryNonProportional ">javax.json-api-1.1-javadoc.jar</span>, and executing <span class="EmphasisFontCategoryNonProportional ">jar xvf javax.json-api-1.1-javadoc.jar</span>. Point the web browser to the unzipped <span class="EmphasisFontCategoryNonProportional ">index.html</span> file to access the API reference.</p></section><section class="Section2 RenderAsSection2" id="Sec4"><h3 class="Heading">Obtaining and Using JSON-P</h3><p class="Para" id="Par50">The latest updates of the JSON-P 1.0 and 1.1 libraries can be obtained from the Maven Repository (<span class="ExternalRef"><a href="http://mvnrepository.com/"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://mvnrepository.com</span>
                  </span></a></span>). At the time of writing, 1.0.4 is the latest update of JSON-P 1.0, and 1.1.3 is the latest update of JSON-P 1.1.</p><div class="Para" id="Par51">Obtain version 1.0.4 by pointing your browser to 鈥淛SR 374 (JSON Processing) Default Provider 禄 1.0.4鈥?(<span class="ExternalRef"><a href="http://mvnrepository.com/artifact/org.glassfish/javax.json/1.0.4"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://mvnrepository.com/artifact/org.glassfish/javax.json/1.0.4</span>
                  </span></a></span>) and clicking the 鈥渂undle (83 KB)鈥?link on the Files line. The resulting <span class="EmphasisFontCategoryNonProportional ">javax.json-1.0.4.jar</span> file contains all of the JSON-P 1.0 classfiles along with the Glassfish default provider classfiles. Add this JAR file to your CLASSPATH when compiling and running code that uses this library:<div class="ProgramCode" id="PC1"><div class="LineGroup"><div class="FixedLine">javac -cp javax.json-1.0.4.jar <em class="EmphasisTypeItalic ">source file</em></div></div><div class="LineGroup"><div class="FixedLine">java -cp javax.json-1.0.4.jar;. <em class="EmphasisTypeItalic ">main classfile</em></div></div></div></div><div class="Para" id="Par52">Follow these steps to <span id="ITerm43">obtain version 1.1.3:</span><div class="OrderedList"><ol><li class="ListItem"><span class="ItemNumber">1.</span><div class="ItemContent"><p class="Para" id="Par53">Point your browser to 鈥淛SR 374 (JSON Processing) API 禄 1.1.3鈥?(<span class="ExternalRef"><a href="http://mvnrepository.com/artifact/javax.json/javax.json-api/1.1.3"><span class="RefSource">
                            <span class="EmphasisFontCategoryNonProportional ">http://mvnrepository.com/artifact/javax.json/javax.json-api/1.1.3</span>
                          </span></a></span>) and click the 鈥渂undle (30 KB)鈥?link on the Files line.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">2.</span><div class="ItemContent"><p class="Para" id="Par54">Because the resulting <span class="EmphasisFontCategoryNonProportional ">javax.json-api-1.1.3.jar</span> file doesn鈥檛 contain the Glassfish default provider, point your browser to 鈥淛SR 374 (JSON Processing) Default Provider 禄 1.1.3鈥?(<span class="ExternalRef"><a href="http://mvnrepository.com/artifact/org.glassfish/javax.json/1.1.3"><span class="RefSource">
                            <span class="EmphasisFontCategoryNonProportional ">http://mvnrepository.com/artifact/org.glassfish/javax.json/1.1.3</span>
                          </span></a></span>) and click the 鈥渂undle (99 KB)鈥?link on the Files line. You should observe a <span class="EmphasisFontCategoryNonProportional ">javax.json-1.1.3.jar</span> file.</p></div><div class="ClearBoth"> </div></li></ol></div></div><div class="Para" id="Par55"><span class="EmphasisFontCategoryNonProportional ">javax.json-api-1.1.3.jar</span> contains only the JSON-P 1.1 class files, and <span class="EmphasisFontCategoryNonProportional ">javax.json-1.1.3.jar</span> contains only the Glassfish class files. Add these JAR files to your CLASSPATH when compiling and running code that uses these libraries:<div class="ProgramCode" id="PC2"><div class="LineGroup"><div class="FixedLine">javac -cp javax.json-api-1.1.3.jar;javax.json-1.1.3.jar;. <em class="EmphasisTypeItalic ">source file</em></div></div><div class="LineGroup"><div class="FixedLine">java -cp javax.json-api-1.1.3.jar;javax.json-1.1.3.jar;. <em class="EmphasisTypeItalic ">main classfile</em><span id="ITerm44">
                        
                        
                      </span></div></div></div></div></section></section><section class="Section1 RenderAsSection1" id="Sec5"><h2 class="Heading">Working with JSON-P 1.0</h2><p class="Para" id="Par56">JSON-P 1.0 provides object model and streaming model APIs to process JSON text. The object model API represents JSON text in memory via a tree-like structure, which can be navigated and queried in a random-access fashion. The streaming model API represents JSON text as a sequence of events; a parser delivers the next event to an application upon request (the event is 鈥減ulled鈥?from the parser). The application can process or discard the event.</p><p class="Para" id="Par57">The object model is more flexible than the streaming model in that it enables processing that requires random access to the complete content of the tree. However, it鈥檚 often not as efficient as the streaming model and requires more memory.</p><section class="Section2 RenderAsSection2" id="Sec6"><h3 class="Heading">Working with the Object Model API</h3><p class="Para" id="Par58">The object model <span id="ITerm45">API</span> is similar to Java鈥檚 DOM API for XML. It鈥檚 a high-level API that provides immutable object models for JSON object and array structures. These JSON structures are represented as object models using <span class="EmphasisFontCategoryNonProportional ">JsonObject</span> and <span class="EmphasisFontCategoryNonProportional ">JsonArray</span>, respectively.</p><p class="Para" id="Par59"><span class="EmphasisFontCategoryNonProportional ">JsonObject</span> provides a <span class="EmphasisFontCategoryNonProportional ">java.util.Map</span> view for accessing an object model鈥檚 unordered collection of zero or more name/value pairs. Similarly, <span class="EmphasisFontCategoryNonProportional ">JsonArray</span> provides a <span class="EmphasisFontCategoryNonProportional ">java.util.List</span> view for accessing an object model鈥檚 ordered sequence of zero or more values.</p><p class="Para" id="Par60"><span class="EmphasisFontCategoryNonProportional ">JsonObject</span> and <span class="EmphasisFontCategoryNonProportional ">JsonArray</span> are joined by <span class="EmphasisFontCategoryNonProportional ">JsonString</span> and <span class="EmphasisFontCategoryNonProportional ">JsonNumber</span> to represent most of JSON鈥檚 data types. Collectively, they subclass <span class="EmphasisFontCategoryNonProportional ">JsonValue</span>, which also defines <span class="EmphasisFontCategoryNonProportional ">TRUE</span>, <span class="EmphasisFontCategoryNonProportional ">FALSE</span>, and <span class="EmphasisFontCategoryNonProportional ">NULL</span> constants for JSON鈥檚 Boolean and null data types.</p><p class="Para" id="Par61">Builder patterns are used to create object models from scratch. Applications use interface <span class="EmphasisFontCategoryNonProportional ">JsonObjectBuilder</span> to create models that represent JSON objects. The resulting model is of type <span class="EmphasisFontCategoryNonProportional ">JsonObject</span>. Similarly, they use interface <span class="EmphasisFontCategoryNonProportional ">JsonArrayBuilder</span> to create models that represent JSON arrays. The resulting model is of type <span class="EmphasisFontCategoryNonProportional ">JsonArray</span><span id="ITerm46">
                  
                  
                </span>.</p><div class="Para" id="Par62">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC3">12-1</a></span> presents the source code to an application that demonstrates the builder approach to creating an object model.<div class="ProgramCode" id="PC3"><div class="LineGroup"><div class="FixedLine">import javax.json.Json;</div><div class="FixedLine">import javax.json.JsonArray;</div><div class="FixedLine">import javax.json.JsonObject;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class JSONPDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      JsonObject person =</div><div class="FixedLine">         Json.createObjectBuilder()</div><div class="FixedLine">             .add(&quot;firstName&quot;, &quot;John&quot;)</div><div class="FixedLine">             .add(&quot;lastName&quot;, &quot;Doe&quot;)</div><div class="FixedLine">             .add(&quot;age&quot;, 42)</div><div class="FixedLine">             .add(&quot;address&quot;, Json.createObjectBuilder()</div><div class="FixedLine">                                 .add(&quot;street&quot;,</div><div class="FixedLine">                                      &quot;400 Some Street&quot;)</div><div class="FixedLine">                                 .add(&quot;city&quot;,</div><div class="FixedLine">                                      &quot;Beverly Hills&quot;)</div><div class="FixedLine">                                 .add(&quot;state&quot;, &quot;CA&quot;)</div><div class="FixedLine">             .add(&quot;zipcode&quot;, 90210))</div><div class="FixedLine">             .add(&quot;phoneNumbers&quot;,<span id="ITerm47">
                        
                        
                      </span></div><div class="FixedLine">                  Json.createArrayBuilder()</div><div class="FixedLine">                      .add(Json.createObjectBuilder()</div><div class="FixedLine">                               .add(&quot;type&quot;, &quot;home&quot;)</div><div class="FixedLine">                               .add(&quot;number&quot;,</div><div class="FixedLine">                                    &quot;310 555-1234&quot;))</div><div class="FixedLine">                             .add(Json.createObjectBuilder()</div><div class="FixedLine">                                      .add(&quot;type&quot;, &quot;fax&quot;)</div><div class="FixedLine">                                      .add(&quot;number&quot;,</div><div class="FixedLine">                                           &quot;310 555-4567&quot;)))</div><div class="FixedLine">             .build();</div><div class="FixedLine">      out.printf(&quot;First name: %s%n&quot;,</div><div class="FixedLine">                 person.getString(&quot;firstName&quot;));</div><div class="FixedLine">      out.printf(&quot;Last name: %s%n&quot;,</div><div class="FixedLine">                 person.getString(&quot;lastName&quot;));</div><div class="FixedLine">      out.printf(&quot;Age: %d%n&quot;, person.getInt(&quot;age&quot;));</div><div class="FixedLine">      out.println(&quot;Address&quot;);</div><div class="FixedLine">      out.println(&quot;-------&quot;);</div><div class="FixedLine">      JsonObject address = person.getJsonObject(&quot;address&quot;);</div><div class="FixedLine">      out.printf(&quot;   Street: %s%n&quot;,</div><div class="FixedLine">                 address.getString(&quot;street&quot;));</div><div class="FixedLine">      out.printf(&quot;   City: %s%n&quot;,</div><div class="FixedLine">                 address.getString(&quot;city&quot;));</div><div class="FixedLine">      out.printf(&quot;   State: %s%n&quot;,</div><div class="FixedLine">                 address.getString(&quot;state&quot;));</div><div class="FixedLine">      out.printf(&quot;   Zipcode: %d%n&quot;,</div><div class="FixedLine">                 address.getInt(&quot;zipcode&quot;));</div><div class="FixedLine">      out.println(&quot;Phone Numbers&quot;);</div><div class="FixedLine">      out.println(&quot;-------------&quot;);</div><div class="FixedLine">      JsonArray phoneNumbers =</div><div class="FixedLine">         person.getJsonArray(&quot;phoneNumbers&quot;);</div><div class="FixedLine">      for (JsonObject phoneNumber:</div><div class="FixedLine">           phoneNumbers.getValuesAs(JsonObject.class)) <span id="ITerm48">
                        
                        
                      </span></div><div class="FixedLine">      {</div><div class="FixedLine">         out.printf(&quot;   Type: %s%n&quot;,</div><div class="FixedLine">                    phoneNumber.getString(&quot;type&quot;));</div><div class="FixedLine">         out.printf(&quot;   Number: %s%n&quot;,</div><div class="FixedLine">                    phoneNumber.getString(&quot;number&quot;));</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 12-1</span><p class="SimplePara">Using a Builder to Create an Object Model</p></div></div></div></div><p class="Para" id="Par63">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC3">12-1</a></span> describes a Java application whose <span class="EmphasisFontCategoryNonProportional ">main()</span> method constructs a <span class="EmphasisFontCategoryNonProportional ">JsonObject</span> describing a person. It first invokes <span class="EmphasisFontCategoryNonProportional ">Json</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">JsonObjectBuilder createObjectBuilder()</span> method<span id="ITerm49">
                  
                </span> followed by various <span class="EmphasisFontCategoryNonProportional ">JsonObjectBuilder add()</span> methods to populate the <span class="EmphasisFontCategoryNonProportional ">JsonObject</span>, followed by <span class="EmphasisFontCategoryNonProportional ">JsonObjectBuilder</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">build()</span> method to return the <span class="EmphasisFontCategoryNonProportional ">JsonObject</span>.</p><p class="Para" id="Par64">Constructing the <span class="EmphasisFontCategoryNonProportional ">JsonObject</span> requires the use of <span class="EmphasisFontCategoryNonProportional ">Json</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">JsonArrayBuilder createArrayBuilder()</span> method<span id="ITerm50">
                  
                </span>, followed by <span class="EmphasisFontCategoryNonProportional ">JsonArrayBuilder</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">JsonArrayBuilder add(JsonObjectBuilder builder)</span> method to construct the phone numbers <span class="EmphasisFontCategoryNonProportional ">JsonArray</span> portion of the <span class="EmphasisFontCategoryNonProportional ">JsonObject</span>.</p><p class="Para" id="Par65">After returning the <span class="EmphasisFontCategoryNonProportional ">JsonObject</span>, <span class="EmphasisFontCategoryNonProportional ">main()</span> invokes various methods to interrogate the object and output object details.</p><div class="Para" id="Par66">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC3">12-1</a></span> as follows: <span id="ITerm51">
                  
                  
                </span><div class="ProgramCode" id="PC4"><div class="LineGroup"><div class="FixedLine">javac -cp javax.json-1.0.4.jar JSONPDemo.java</div></div></div></div><div class="Para" id="Par67">Run the resulting application as follows:<div class="ProgramCode" id="PC5"><div class="LineGroup"><div class="FixedLine">java -cp javax.json-1.0.4.jar;. JSONPDemo</div></div></div></div><div class="Para" id="Par68">You should observe the following output:<div class="ProgramCode" id="PC6"><div class="LineGroup"><div class="FixedLine">First name: John</div><div class="FixedLine">Last name: Doe</div><div class="FixedLine">Age: 42</div><div class="FixedLine">Address</div><div class="FixedLine">-------</div><div class="FixedLine">   Street: 400 Some Street</div><div class="FixedLine">   City: Beverly Hills</div><div class="FixedLine">   State: CA</div><div class="FixedLine">   Zipcode: 90210</div><div class="FixedLine">Phone Numbers</div><div class="FixedLine">-------------</div><div class="FixedLine">   Type: home</div><div class="FixedLine">   Number: 310 555-1234</div><div class="FixedLine">   Type: fax</div><div class="FixedLine">   Number: 310 555-4567<span id="ITerm52">
                        
                        
                      </span></div></div></div></div><p class="Para" id="Par69">Object models also can be created from an input source (such as <span class="EmphasisFontCategoryNonProportional ">java.io.InputStream</span> or <span class="EmphasisFontCategoryNonProportional ">java.io.Reader</span>) by using interface <span class="EmphasisFontCategoryNonProportional ">JsonReader</span>. Similarly, object models can be written to an output destination (such as <span class="EmphasisFontCategoryNonProportional ">java.io.OutputStream</span> or <span class="EmphasisFontCategoryNonProportional ">java.io.Writer</span>) by using interface <span class="EmphasisFontCategoryNonProportional ">JsonWriter</span>.</p><div class="Para" id="Par70">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC7">12-2</a></span> presents the source code to an application that demonstrates the reader approach to creating an object model and also writing this model.<div class="ProgramCode" id="PC7"><div class="LineGroup"><div class="FixedLine">import java.io.File;</div><div class="FixedLine">import java.io.FileNotFoundException;</div><div class="FixedLine">import java.io.FileReader;</div><div class="FixedLine">import java.io.FileWriter;</div><div class="FixedLine">import java.io.IOException;</div><div class="FixedLine">import java.io.StringReader;</div></div><div class="LineGroup"><div class="FixedLine">import javax.json.Json;</div><div class="FixedLine">import javax.json.JsonArray;</div><div class="FixedLine">import javax.json.JsonObject;</div><div class="FixedLine">import javax.json.JsonReader;</div><div class="FixedLine">import javax.json.JsonWriter;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class JSONPDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">      throws FileNotFoundException</div><div class="FixedLine">   {</div><div class="FixedLine">      String json =</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;   \&quot;firstName\&quot;: \&quot;John\&quot;,&quot; +</div><div class="FixedLine">      &quot;   \&quot;lastName\&quot;: \&quot;Doe\&quot;,&quot; +</div><div class="FixedLine">      &quot;   \&quot;age\&quot;: 42,&quot; +</div><div class="FixedLine">      &quot;   \&quot;address\&quot;:&quot; +</div><div class="FixedLine">      &quot;   {&quot; +</div><div class="FixedLine">      &quot;      \&quot;street\&quot;: \&quot;400 Some Street\&quot;,&quot; +</div><div class="FixedLine">      &quot;      \&quot;city\&quot;: \&quot;Beverly Hills\&quot;,&quot; +</div><div class="FixedLine">      &quot;      \&quot;state\&quot;: \&quot;CA\&quot;,&quot; +</div><div class="FixedLine">      &quot;      \&quot;zipcode\&quot;: 90210&quot; +</div><div class="FixedLine">      &quot;   },&quot; +</div><div class="FixedLine">      &quot;   \&quot;phoneNumbers\&quot;:&quot; +</div><div class="FixedLine">      &quot;   [&quot; +</div><div class="FixedLine">      &quot;      {&quot; +</div><div class="FixedLine">      &quot;         \&quot;type\&quot;: \&quot;home\&quot;,&quot; +</div><div class="FixedLine">      &quot;         \&quot;number\&quot;: \&quot;310 555-1234\&quot;&quot; +</div><div class="FixedLine">      &quot;      },&quot; +</div><div class="FixedLine">      &quot;      {&quot; +</div><div class="FixedLine">      &quot;         \&quot;type\&quot;: \&quot;fax\&quot;,&quot; +</div><div class="FixedLine">      &quot;         \&quot;number\&quot;: \&quot;310 555-4567\&quot;&quot; +</div><div class="FixedLine">      &quot;      }&quot; +</div><div class="FixedLine">      &quot;   ]&quot; +</div><div class="FixedLine">      &quot;}&quot;;</div><div class="FixedLine">      File file = new File(&quot;person.json&quot;)<span id="ITerm53">
                        
                        
                      </span>;</div><div class="FixedLine">      JsonReader reader =</div><div class="FixedLine">         Json.createReader(file.exists() ?</div><div class="FixedLine">                           new FileReader(&quot;person.json&quot;) :</div><div class="FixedLine">                           new StringReader(json));</div><div class="FixedLine">      JsonObject person = reader.readObject();</div><div class="FixedLine">      out.printf(&quot;First name: %s%n&quot;,</div><div class="FixedLine">                 person.getString(&quot;firstName&quot;));</div><div class="FixedLine">      out.printf(&quot;Last name: %s%n&quot;,</div><div class="FixedLine">                 person.getString(&quot;lastName&quot;));</div><div class="FixedLine">      out.printf(&quot;Age: %d%n&quot;, person.getInt(&quot;age&quot;));</div><div class="FixedLine">      out.println(&quot;Address&quot;);</div><div class="FixedLine">      out.println(&quot;-------&quot;);</div><div class="FixedLine">      JsonObject address = person.getJsonObject(&quot;address&quot;);</div><div class="FixedLine">      out.printf(&quot;   Street: %s%n&quot;,</div><div class="FixedLine">                 address.getString(&quot;street&quot;));</div><div class="FixedLine">      out.printf(&quot;   City: %s%n&quot;,</div><div class="FixedLine">                 address.getString(&quot;city&quot;));</div><div class="FixedLine">      out.printf(&quot;   State: %s%n&quot;,</div><div class="FixedLine">                 address.getString(&quot;state&quot;));</div><div class="FixedLine">      out.printf(&quot;   Zipcode: %d%n&quot;,</div><div class="FixedLine">                 address.getInt(&quot;zipcode&quot;))<span id="ITerm54">
                        
                        
                      </span>;</div><div class="FixedLine">      out.println(&quot;Phone Numbers&quot;);</div><div class="FixedLine">      out.println(&quot;-------------&quot;);</div><div class="FixedLine">      JsonArray phoneNumbers =</div><div class="FixedLine">         person.getJsonArray(&quot;phoneNumbers&quot;);</div><div class="FixedLine">      for (JsonObject phoneNumber:</div><div class="FixedLine">           phoneNumbers.getValuesAs(JsonObject.class))</div><div class="FixedLine">      {</div><div class="FixedLine">         out.printf(&quot;   Type: %s%n&quot;,</div><div class="FixedLine">                    phoneNumber.getString(&quot;type&quot;));</div><div class="FixedLine">         out.printf(&quot;   Number: %s%n&quot;,</div><div class="FixedLine">                    phoneNumber.getString(&quot;number&quot;));</div><div class="FixedLine">      }</div><div class="FixedLine">      try (var fw = new FileWriter(&quot;person.json&quot;))</div><div class="FixedLine">      {</div><div class="FixedLine">         JsonWriter writer = Json.createWriter(fw);</div><div class="FixedLine">         writer.writeObject(person);</div><div class="FixedLine">         writer.close();</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (IOException ioe)</div><div class="FixedLine">      {</div><div class="FixedLine">         out.printf(&quot;I/O error: %s%n&quot;, ioe.getMessage());</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div><div class="FixedLine">}<span id="ITerm55">
                        
                        
                      </span></div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 12-2</span><p class="SimplePara">Using a Reader to Create an Object Model and a Writer to Write This <span id="ITerm56">Model</span></p></div></div></div></div><p class="Para" id="Par71">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC7">12-2</a></span> describes a Java application whose <span class="EmphasisFontCategoryNonProportional ">main()</span> method first constructs a <span class="EmphasisFontCategoryNonProportional ">JsonReader</span> object by invoking <span class="EmphasisFontCategoryNonProportional ">Json</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">JsonReader createReader(Reader reader)</span> method with either a <span class="EmphasisFontCategoryNonProportional ">java.io.FileReader</span> object to read from a <span class="EmphasisFontCategoryNonProportional ">person.json</span> file or a <span class="EmphasisFontCategoryNonProportional ">java.io.StringReader</span> object to read from a string when this file doesn鈥檛 exist. It then creates a <span class="EmphasisFontCategoryNonProportional ">JsonObject</span> by invoking <span class="EmphasisFontCategoryNonProportional ">JsonReader</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">JsonObject readObject()</span> method<span id="ITerm57">
                  
                </span>.</p><p class="Para" id="Par72"><span class="EmphasisFontCategoryNonProportional ">main()</span> subsequently invokes various methods to interrogate the object and output object details and then uses <span class="EmphasisFontCategoryNonProportional ">JsonWriter</span> to write the object to a file named <span class="EmphasisFontCategoryNonProportional ">person.json</span>.</p><p class="Para" id="Par73">Compile and run the application as previously shown, and you should observe the same output (and a <span class="EmphasisFontCategoryNonProportional ">person.json</span> file should be created) <span id="ITerm58">
                  
                  
                </span>.</p></section><section class="Section2 RenderAsSection2" id="Sec7"><h3 class="Heading">Working with the Streaming Model API</h3><p class="Para" id="Par74">The streaming model <span id="ITerm59">API</span> is similar to Java鈥檚 StAX API for XML. It鈥檚 a high-level API that provides a stream of events during JSON text parsing, which is represented by interface <span class="EmphasisFontCategoryNonProportional ">JsonParser</span>. This interface provides <span class="EmphasisFontCategoryNonProportional ">boolean hasNext()</span> and <span class="EmphasisFontCategoryNonProportional ">Event next()</span> methods for parsing JSON text from an input source.</p><div class="Para" id="Par75">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC8">12-3</a></span> presents the source code to an application that demonstrates parsing JSON text.<div class="ProgramCode" id="PC8"><div class="LineGroup"><div class="FixedLine">import java.io.StringReader;</div></div><div class="LineGroup"><div class="FixedLine">import javax.json.Json;</div></div><div class="LineGroup"><div class="FixedLine">import javax.json.stream.JsonParser;</div></div><div class="LineGroup"><div class="FixedLine">import static javax.json.stream.JsonParser.Event;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class JSONPDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      String json =</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;   \&quot;firstName\&quot;: \&quot;John\&quot;,&quot; +</div><div class="FixedLine">      &quot;   \&quot;lastName\&quot;: \&quot;Doe\&quot;,&quot; +</div><div class="FixedLine">      &quot;   \&quot;age\&quot;: 42,&quot; +</div><div class="FixedLine">      &quot;   \&quot;address\&quot;:&quot; +</div><div class="FixedLine">      &quot;   {&quot; +</div><div class="FixedLine">      &quot;      \&quot;street\&quot;: \&quot;400 Some Street\&quot;,&quot; +</div><div class="FixedLine">      &quot;      \&quot;city\&quot;: \&quot;Beverly Hills\&quot;,&quot; +</div><div class="FixedLine">      &quot;      \&quot;state\&quot;: \&quot;CA\&quot;,&quot; +</div><div class="FixedLine">      &quot;      \&quot;zipcode\&quot;: 90210&quot; +</div><div class="FixedLine">      &quot;   },&quot; +</div><div class="FixedLine">      &quot;   \&quot;phoneNumbers\&quot;:&quot; +<span id="ITerm60">
                        
                        
                      </span></div><div class="FixedLine">      &quot;   [&quot; +</div><div class="FixedLine">      &quot;      {&quot; +</div><div class="FixedLine">      &quot;         \&quot;type\&quot;: \&quot;home\&quot;,&quot; +</div><div class="FixedLine">      &quot;         \&quot;number\&quot;: \&quot;310 555-1234\&quot;&quot; +</div><div class="FixedLine">      &quot;      },&quot; +</div><div class="FixedLine">      &quot;      {&quot; +</div><div class="FixedLine">      &quot;         \&quot;type\&quot;: \&quot;fax\&quot;,&quot; +</div><div class="FixedLine">      &quot;         \&quot;number\&quot;: \&quot;310 555-4567\&quot;&quot; +</div><div class="FixedLine">      &quot;      }&quot; +</div><div class="FixedLine">      &quot;   ]&quot; +</div><div class="FixedLine">      &quot;}&quot;;</div><div class="FixedLine">      JsonParser parser =</div><div class="FixedLine">         Json.createParser(new StringReader(json));</div><div class="FixedLine">      while (parser.hasNext())</div><div class="FixedLine">      {</div><div class="FixedLine">         Event event = parser.next();</div><div class="FixedLine">         if (event == Event.KEY_NAME)</div><div class="FixedLine">            switch (parser.getString())</div><div class="FixedLine">            {</div><div class="FixedLine">               case &quot;firstName&quot;:</div><div class="FixedLine">                  parser.next();</div><div class="FixedLine">                  out.printf(&quot;First name: %s%n&quot;,</div><div class="FixedLine">                             parser.getString());</div><div class="FixedLine">                  break;</div></div><div class="LineGroup"><div class="FixedLine">               case &quot;lastName&quot;:</div><div class="FixedLine">                  parser.next();</div><div class="FixedLine">                  out.printf(&quot;Last name: %s%n&quot;,</div><div class="FixedLine">                             parser.getString());</div><div class="FixedLine">                  break;</div></div><div class="LineGroup"><div class="FixedLine">               case &quot;age&quot;:</div><div class="FixedLine">                  parser.next();</div><div class="FixedLine">                  out.printf(&quot;Age: %d%n&quot;, parser.getInt());</div><div class="FixedLine">                  break;</div></div><div class="LineGroup"><div class="FixedLine">               case &quot;address&quot;:</div><div class="FixedLine">                  parser.next();</div><div class="FixedLine">                  out.println(&quot;Address&quot;);<span id="ITerm61">
                        
                        
                      </span></div><div class="FixedLine">                  out.println(&quot;-------&quot;);</div><div class="FixedLine">                  break;</div></div><div class="LineGroup"><div class="FixedLine">               case &quot;street&quot;:</div><div class="FixedLine">                  parser.next();</div><div class="FixedLine">                  out.printf(&quot;   Street: %s%n&quot;,</div><div class="FixedLine">                             parser.getString());</div><div class="FixedLine">                  break;</div></div><div class="LineGroup"><div class="FixedLine">               case &quot;city&quot;:</div><div class="FixedLine">                  parser.next();</div><div class="FixedLine">                  out.printf(&quot;   City: %s%n&quot;,</div><div class="FixedLine">                             parser.getString());</div><div class="FixedLine">                  break;</div></div><div class="LineGroup"><div class="FixedLine">               case &quot;state&quot;:</div><div class="FixedLine">                  parser.next();</div><div class="FixedLine">                  out.printf(&quot;   State: %s%n&quot;,</div><div class="FixedLine">                             parser.getString());</div><div class="FixedLine">                  break;</div></div><div class="LineGroup"><div class="FixedLine">               case &quot;zipcode&quot;:</div><div class="FixedLine">                  parser.next();</div><div class="FixedLine">                  out.printf(&quot;   Zipcode: %d%n&quot;,</div><div class="FixedLine">                             parser.getInt());</div><div class="FixedLine">                  break;</div></div><div class="LineGroup"><div class="FixedLine">               case &quot;phoneNumbers&quot;:</div><div class="FixedLine">                  parser.next();</div><div class="FixedLine">                  out.println(&quot;Phone Numbers&quot;);</div><div class="FixedLine">                  out.println(&quot;-------------&quot;);</div><div class="FixedLine">                  break;</div></div><div class="LineGroup"><div class="FixedLine">               case &quot;type&quot;:</div><div class="FixedLine">                  parser.next();</div><div class="FixedLine">                  out.printf(&quot;   Type: %s%n&quot;,<span id="ITerm62">
                        
                        
                      </span></div><div class="FixedLine">                             parser.getString());</div><div class="FixedLine">                  parser.next();</div><div class="FixedLine">                  parser.next();</div><div class="FixedLine">                  out.printf(&quot;   Number: %s%n&quot;,</div><div class="FixedLine">                             parser.getString());</div><div class="FixedLine">                  break;</div><div class="FixedLine">            }</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 12-3</span><p class="SimplePara">Using the Streaming Model to Parse JSON Text</p></div></div></div></div><p class="Para" id="Par76">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC8">12-3</a></span> describes a Java application that constructs a parser by invoking <span class="EmphasisFontCategoryNonProportional ">Json</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">JsonParser createParser(Reader reader)</span> method with a <span class="EmphasisFontCategoryNonProportional ">StringReader</span> object describing string-based JSON text. It repeatedly invokes <span class="EmphasisFontCategoryNonProportional ">JsonParser</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">hasNext()</span> and <span class="EmphasisFontCategoryNonProportional ">next()</span> methods to respectively test for another event (returning <span class="EmphasisFontCategoryNonProportional ">true</span> for an event or <span class="EmphasisFontCategoryNonProportional ">false</span> when there are no more events) and return the event.</p><p class="Para" id="Par77"><span class="EmphasisFontCategoryNonProportional ">next()</span> returns the next event as a <span class="EmphasisFontCategoryNonProportional ">JsonParser.Event</span> enum constant. The only event of interest is the name of an object鈥檚 key, which is signified by <span class="EmphasisFontCategoryNonProportional ">Event.KEY_NAME</span>. This name is returned by invoking <span class="EmphasisFontCategoryNonProportional ">JsonParser</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">String getString()</span> method. Once a match is detected, <span class="EmphasisFontCategoryNonProportional ">parser.next();</span> is executed to skip past this name and get to the next event, typically to return a key鈥檚 associated value.</p><p class="Para" id="Par78">Compile and run the application as previously shown, and you should observe the same output.</p><p class="Para" id="Par79">The streaming model API also supports JSON content generation, which is represented by interface <span class="EmphasisFontCategoryNonProportional ">JsonGenerator</span>. This interface provides <span class="EmphasisFontCategoryNonProportional ">write</span>-prefixed methods for generating JSON text to an output destination.</p><div class="Para" id="Par80">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC9">12-4</a></span> presents the source code to an application that shows how to generate JSON <span id="ITerm63">text</span>.<div class="ProgramCode" id="PC9"><div class="LineGroup"><div class="FixedLine">import java.io.FileWriter;</div><div class="FixedLine">import java.io.IOException;</div></div><div class="LineGroup"><div class="FixedLine">import javax.json.Json;</div></div><div class="LineGroup"><div class="FixedLine">import javax.json.stream.JsonGenerator;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class JSONPDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      try (var fw = new FileWriter(&quot;person.json&quot;))</div><div class="FixedLine">      {</div><div class="FixedLine">         JsonGenerator generator = Json.createGenerator(fw);</div><div class="FixedLine">         generator.writeStartObject()</div><div class="FixedLine">                     .write(&quot;firstName&quot;, &quot;John&quot;)</div><div class="FixedLine">                     .write(&quot;lastName&quot;, &quot;Doe&quot;)</div><div class="FixedLine">                     .write(&quot;age&quot;, 42)</div><div class="FixedLine">                     .writeStartObject(&quot;address&quot;)</div><div class="FixedLine">                        .write(&quot;street&quot;, &quot;400 Some Street&quot;)</div><div class="FixedLine">                        .write(&quot;city&quot;, &quot;Beverly Hills&quot;)</div><div class="FixedLine">                        .write(&quot;state&quot;, &quot;CA&quot;)</div><div class="FixedLine">                        .write(&quot;zipcode&quot;, 90210)</div><div class="FixedLine">                     .writeEnd()</div><div class="FixedLine">                     .writeStartArray(&quot;phoneNumbers&quot;)</div><div class="FixedLine">                        .writeStartObject()</div><div class="FixedLine">                           .write(&quot;type&quot;, &quot;home&quot;)</div><div class="FixedLine">                           .write(&quot;number&quot;, &quot;310 555-1234&quot;)</div><div class="FixedLine">                        .writeEnd()</div><div class="FixedLine">                        .writeStartObject()</div><div class="FixedLine">                           .write(&quot;type&quot;, &quot;fax&quot;)</div><div class="FixedLine">                           .write(&quot;number&quot;, &quot;310 555-4567&quot;)</div><div class="FixedLine">                        .writeEnd()</div><div class="FixedLine">                     .writeEnd()</div><div class="FixedLine">                  .writeEnd();</div><div class="FixedLine">         generator.close();</div><div class="FixedLine">      }</div><div class="FixedLine">      catch (IOException ioe)</div><div class="FixedLine">      {</div><div class="FixedLine">         out.printf(&quot;I/O error: %s%n&quot;, ioe.getMessage());<span id="ITerm64">
                        
                        
                      </span></div><div class="FixedLine">      }</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 12-4</span><p class="SimplePara">Using the Streaming Model to Generate JSON <span id="ITerm65">Text</span></p></div></div></div></div><p class="Para" id="Par81">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC9">12-4</a></span> describes a Java application whose <span class="EmphasisFontCategoryNonProportional ">main()</span> method constructs a generator by invoking <span class="EmphasisFontCategoryNonProportional ">Json</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">JsonGenerator createGenerator(Writer write)</span> method with a <span class="EmphasisFontCategoryNonProportional ">FileWriter</span> object describing a file-based destination (<span class="EmphasisFontCategoryNonProportional ">person.json</span>). It invokes <span class="EmphasisFontCategoryNonProportional ">JsonGenerator</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">JsonGenerator writeStartObject()</span> method<span id="ITerm66">
                  
                </span> to begin the process of writing the object.</p><p class="Para" id="Par82">Various <span class="EmphasisFontCategoryNonProportional ">write()</span>, <span class="EmphasisFontCategoryNonProportional ">writeStartObject()</span>, <span class="EmphasisFontCategoryNonProportional ">writeStartArray()</span>, and <span class="EmphasisFontCategoryNonProportional ">writeEnd()</span> method calls are chained to the initial <span class="EmphasisFontCategoryNonProportional ">writeStartObject()</span> call. Following this sequence, <span class="EmphasisFontCategoryNonProportional ">JsonGenerator</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">close()</span> method is called to close the generator.</p><p class="Para" id="Par83">Compile and run the application as previously shown, and you should observe no output (although a <span class="EmphasisFontCategoryNonProportional ">person.json</span> file is generated) <span id="ITerm67">
                  
                  
                </span>.</p></section></section><section class="Section1 RenderAsSection1" id="Sec8"><h2 class="Heading">Working with JSON-P 1.1鈥檚 Advanced Features</h2><p class="Para" id="Par84">JSON-P 1.1 builds on JSON-P 1.0 mainly by supporting JSON Pointer, JSON Patch, and JSON Merge Patch; by including editing/transformation operations; and by updating the API to support Java SE 8.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar3"><h3 class="Heading">Note</h3><p class="Para" id="Par85">The previous demos work unchanged under JSON-P 1.1. Simply replace <span class="EmphasisFontCategoryNonProportional ">javax.json-1.0.4.jar</span> with <span class="EmphasisFontCategoryNonProportional ">javax.json-api-1.1.3.jar;javax.json-1.1.3.jar</span> in the CLASSPATH.</p></div><section class="Section2 RenderAsSection2" id="Sec9"><h3 class="Heading">JSON Pointer</h3><p class="Para" id="Par86"><span id="ITerm68">
                  <em class="EmphasisTypeItalic ">JSON Pointer</em>
                  
                </span><span id="ITerm69">
                  
                  
                  
                </span><span id="ITerm70">
                  
                  
                </span> (<span class="ExternalRef"><a href="http://tools.ietf.org/html/rfc6901"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://tools.ietf.org/html/rfc6901</span>
                  </span></a></span>) defines a Unicode-string-syntax for identifying a specific value in a JSON document. Essentially, the string contains a sequence of zero or more <span class="EmphasisFontCategoryNonProportional ">/-</span>prefixed <em class="EmphasisTypeItalic ">reference tokens</em> (JSON document keys or values).</p><div class="Para" id="Par87">A JSON Pointer must conform to the following ABNF (<span class="ExternalRef"><a href="http://en.wikipedia.org/wiki/Augmented_Backus-Naur_form"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://en.wikipedia.org/wiki/Augmented_Backus-Naur_form</span>
                  </span></a></span>) syntax, or the pointer isn鈥檛 valid:<div class="ProgramCode" id="PC10"><div class="LineGroup"><div class="FixedLine">json-pointer    = *( &quot;/&quot; reference-token )</div><div class="FixedLine">reference-token = *( unescaped / escaped )</div><div class="FixedLine">unescaped       = %x00-2E / %x30-7D / %x7F-10FFFF</div><div class="FixedLine">                  ; %x2F (&apos;/&apos;) and %x7E (&apos;~&apos;) are excluded from &apos;unescaped&apos;</div><div class="FixedLine">escaped         = &quot;~&quot; ( &quot;0&quot; / &quot;1&quot; )</div><div class="FixedLine">                  ; representing &apos;~&apos; and &apos;/&apos;, respectively</div></div></div></div><p class="Para" id="Par88">The characters <span class="EmphasisFontCategoryNonProportional ">~</span> (<span class="EmphasisFontCategoryNonProportional ">0x7E</span>) and <span class="EmphasisFontCategoryNonProportional ">/</span> (<span class="EmphasisFontCategoryNonProportional ">0x2F</span>) have special meanings in JSON Pointer. Therefore, <span class="EmphasisFontCategoryNonProportional ">~</span> needs to be encoded as <span class="EmphasisFontCategoryNonProportional ">~0</span> and <span class="EmphasisFontCategoryNonProportional ">/</span> needs to be encoded as <span class="EmphasisFontCategoryNonProportional ">~1</span> when these characters appear in a reference token.</p><div class="Para" id="Par89">Consider the following JSON <span id="ITerm71">document</span><span id="ITerm72">
                  
                  
                </span>:<div class="ProgramCode" id="PC11"><div class="LineGroup"><div class="FixedLine">{</div><div class="FixedLine">   &quot;name&quot;: &quot;Duke&quot;,</div><div class="FixedLine">   &quot;hobbies&quot;:</div><div class="FixedLine">   [</div><div class="FixedLine">      &quot;reading&quot;,</div><div class="FixedLine">      &quot;surfing&quot;,</div><div class="FixedLine">      &quot;eating pizza&quot;</div><div class="FixedLine">   ]</div><div class="FixedLine">}</div></div></div></div><div class="Para" id="Par90">The following list presents four example JSON Pointers for use with this document and (in round brackets) the values of these pointers:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par91"><span class="EmphasisFontCategoryNonProportional "></span> (the whole document)</p></li><li><p class="Para" id="Par92"><span class="EmphasisFontCategoryNonProportional ">/name</span> (<span class="EmphasisFontCategoryNonProportional ">Duke</span>)</p></li><li><p class="Para" id="Par93"><span class="EmphasisFontCategoryNonProportional ">/hobbies</span> (<span class="EmphasisFontCategoryNonProportional ">[&quot;reading&quot;,&quot;surfing&quot;,&quot;eating pizza&quot;]</span>)</p></li><li><p class="Para" id="Par94"><span class="EmphasisFontCategoryNonProportional ">/hobbies/0</span> (<span class="EmphasisFontCategoryNonProportional ">reading</span>)</p></li></ul></div></div><p class="Para" id="Par95">Array entries are referenced via zero-based digit sequences, where <span class="EmphasisFontCategoryNonProportional ">/0</span> references the first entry, <span class="EmphasisFontCategoryNonProportional ">/1</span> references the second entry, and so <span id="ITerm73">on</span><span id="ITerm74">
                  
                  
                </span>.</p><p class="Para" id="Par96">JSON-P represents a JSON Pointer via the <span class="EmphasisFontCategoryNonProportional ">JsonPointer</span> interface. An instance of a class that implements this interface is obtained by executing <span class="EmphasisFontCategoryNonProportional ">Json</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">JsonPointer createPointer(String jsonPointer) static</span> method.</p><div class="Para" id="Par97">Assuming that the previous JSON document has been created in memory (and assigned to <span class="EmphasisFontCategoryNonProportional ">duke</span>), the following code fragment creates a JSON Pointer to the <span class="EmphasisFontCategoryNonProportional ">name</span> reference token:<div class="ProgramCode" id="PC12"><div class="LineGroup"><div class="FixedLine">JsonPointer pointer = Json.createPointer(&quot;/name&quot;);</div></div></div></div><div class="Para" id="Par98">After a <span class="EmphasisFontCategoryNonProportional ">JsonPointer</span> instance has been returned, invoking its <span class="EmphasisFontCategoryNonProportional ">JsonValue getValue(JsonStructure target)</span> method returns the value at the referenced location in the specified <span class="EmphasisFontCategoryNonProportional ">target</span>:<div class="ProgramCode" id="PC13"><div class="LineGroup"><div class="FixedLine">System.out.printf(&quot;%s%n%n&quot;,<span id="ITerm75">
                        
                        
                        
                      </span><span id="ITerm76">
                        
                        
                      </span></div><div class="FixedLine">                  pointer.getValue(duke)); // output: &quot;Duke&quot;</div></div></div></div><div class="Para" id="Par99"><span class="EmphasisFontCategoryNonProportional ">JsonPointer</span> can be used to add items to, remove items from, and replace items in a JSON document. This interface provides the following methods for this purpose: <span id="ITerm77">
                  
                  
                  
                </span><div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par100">
                      <span class="EmphasisFontCategoryNonProportional ">&lt;T extends JsonStructure&gt; T add(T target, JsonValue value)</span>
                    </p></li><li><p class="Para" id="Par101">
                      <span class="EmphasisFontCategoryNonProportional ">&lt;T extends JsonStructure&gt; T remove(T target)</span>
                    </p></li><li><p class="Para" id="Par102">
                      <span class="EmphasisFontCategoryNonProportional ">&lt;T extends JsonStructure&gt; T replace(T target, JsonValue value)</span>
                    </p></li></ul></div></div><div class="Para" id="Par103">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC14">12-5</a></span> presents the source code to an application that demonstrates creating <span class="EmphasisFontCategoryNonProportional ">JsonPointer</span>s along with all of the previous <span class="EmphasisFontCategoryNonProportional ">JsonPointer</span> methods.<div class="ProgramCode" id="PC14"><div class="LineGroup"><div class="FixedLine">import javax.json.Json;</div><div class="FixedLine">import javax.json.JsonArray;</div><div class="FixedLine">import javax.json.JsonObject;</div><div class="FixedLine">import javax.json.JsonPointer;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*; <span id="ITerm78">
                        
                        
                        
                      </span></div></div><div class="LineGroup"><div class="FixedLine">/*</div><div class="FixedLine">   JsonPointer Demonstration:</div></div><div class="LineGroup"><div class="FixedLine">   1) Create the following JSON document:</div></div><div class="LineGroup"><div class="FixedLine">   {</div><div class="FixedLine">      &quot;firstName&quot;: &quot;John&quot;,</div><div class="FixedLine">      &quot;lastName&quot;: &quot;Doe&quot;,</div><div class="FixedLine">      &quot;age&quot;: 42,</div><div class="FixedLine">      &quot;address&quot;:</div><div class="FixedLine">      {</div><div class="FixedLine">         &quot;streetAddress&quot;: &quot;400 Some Street&quot;,</div><div class="FixedLine">         &quot;city&quot;: &quot;Beverly Hills&quot;,</div><div class="FixedLine">         &quot;state&quot;: &quot;CA&quot;,</div><div class="FixedLine">         &quot;zipcode&quot;: 90210</div><div class="FixedLine">      },</div><div class="FixedLine">      &quot;phoneNumbers&quot;:</div><div class="FixedLine">      [</div><div class="FixedLine">         {</div><div class="FixedLine">            &quot;type&quot;: &quot;home&quot;,</div><div class="FixedLine">            &quot;number&quot;: &quot;310 555-1234&quot;</div><div class="FixedLine">         },</div><div class="FixedLine">         {</div><div class="FixedLine">            &quot;type&quot;: &quot;fax&quot;,</div><div class="FixedLine">            &quot;number&quot;: &quot;310 555-4567&quot;<span id="ITerm79">
                        
                        
                        
                      </span></div><div class="FixedLine">         }</div><div class="FixedLine">      ]</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   2) Use JsonPointer to convert the previous JSON document</div><div class="FixedLine">      to the following JSON document<span id="ITerm80">
                        
                        
                        
                      </span><span id="ITerm81">
                        
                        
                        
                      </span>:</div></div><div class="LineGroup"><div class="FixedLine">   {</div><div class="FixedLine">      &quot;firstName&quot;: &quot;John&quot;,</div><div class="FixedLine">      &quot;lastName&quot;: &quot;Doe&quot;,</div><div class="FixedLine">      &quot;age&quot;: 30,</div><div class="FixedLine">      &quot;address&quot;:</div><div class="FixedLine">      {</div><div class="FixedLine">         &quot;streetAddress&quot;: &quot;400 Some Street&quot;,</div><div class="FixedLine">         &quot;city&quot;: &quot;Beverly Hills&quot;,</div><div class="FixedLine">         &quot;state&quot;: &quot;CA&quot;,</div><div class="FixedLine">         &quot;zipcode&quot;: 90210</div><div class="FixedLine">      },</div><div class="FixedLine">      &quot;phoneNumbers&quot;:</div><div class="FixedLine">      [</div><div class="FixedLine">         {</div><div class="FixedLine">            &quot;type&quot;: &quot;fax&quot;,</div><div class="FixedLine">            &quot;number&quot;: &quot;310 555-4567&quot;</div><div class="FixedLine">         },</div><div class="FixedLine">         {</div><div class="FixedLine">            &quot;type&quot;: &quot;cell&quot;,</div><div class="FixedLine">            &quot;number&quot;: &quot;123 456-7890&quot;</div><div class="FixedLine">         }</div><div class="FixedLine">      ]</div><div class="FixedLine">   }</div><div class="FixedLine">*/</div></div><div class="LineGroup"><div class="FixedLine">public class JSONPDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args) <span id="ITerm82">
                        
                        
                        
                      </span></div><div class="FixedLine">   {</div><div class="FixedLine">      JsonObject person;</div><div class="FixedLine">      person =</div><div class="FixedLine">         Json.createObjectBuilder()</div><div class="FixedLine">             .add(&quot;firstName&quot;, &quot;John&quot;)</div><div class="FixedLine">             .add(&quot;lastName&quot;, &quot;Doe&quot;)</div><div class="FixedLine">             .add(&quot;age&quot;, 42)</div><div class="FixedLine">             .add(&quot;address&quot;, Json.createObjectBuilder()</div><div class="FixedLine">                                 .add(&quot;street&quot;,</div><div class="FixedLine">                                      &quot;400 Some Street&quot;)</div><div class="FixedLine">                                 .add(&quot;city&quot;,</div><div class="FixedLine">                                      &quot;Beverly Hills&quot;)</div><div class="FixedLine">                                 .add(&quot;state&quot;, &quot;CA&quot;)</div><div class="FixedLine">                                 .add(&quot;zipcode&quot;, 90210))</div><div class="FixedLine">             .add(&quot;phoneNumbers&quot;,</div><div class="FixedLine">                  Json.createArrayBuilder()</div><div class="FixedLine">                      .add(Json.createObjectBuilder()</div><div class="FixedLine">                               .add(&quot;type&quot;, &quot;home&quot;)</div><div class="FixedLine">                               .add(&quot;number&quot;,<span id="ITerm83">
                        
                        
                        
                      </span></div><div class="FixedLine">                                    &quot;310 555-1234&quot;))</div><div class="FixedLine">                      .add(Json.createObjectBuilder()</div><div class="FixedLine">                               .add(&quot;type&quot;, &quot;fax&quot;)</div><div class="FixedLine">                               .add(&quot;number&quot;,</div><div class="FixedLine">                                    &quot;310 555-4567&quot;)))</div><div class="FixedLine">             .build();</div><div class="FixedLine">      JsonPointer pointer = Json.createPointer(&quot;/age&quot;);</div><div class="FixedLine">      person = pointer.replace(person,</div><div class="FixedLine">                               Json.createValue(30));</div><div class="FixedLine">      pointer = Json.createPointer(&quot;/phoneNumbers/-&quot;);<span id="ITerm84">
                        
                        
                        
                      </span></div><div class="FixedLine">      person =</div><div class="FixedLine">         pointer.add(person,</div><div class="FixedLine">                     Json.createObjectBuilder()</div><div class="FixedLine">                         .add(&quot;type&quot;, &quot;cell&quot;)</div><div class="FixedLine">                         .add(&quot;number&quot;,</div><div class="FixedLine">                              &quot;123 456-7890&quot;).build());</div><div class="FixedLine">      pointer = Json.createPointer(&quot;/phoneNumbers/0&quot;);</div><div class="FixedLine">      person = pointer.remove(person);</div><div class="FixedLine">      out.printf(&quot;First name: %s%n&quot;,</div><div class="FixedLine">                 person.getString(&quot;firstName&quot;));</div><div class="FixedLine">      out.printf(&quot;Last name: %s%n&quot;,</div><div class="FixedLine">                 person.getString(&quot;lastName&quot;));</div><div class="FixedLine">      out.printf(&quot;Age: %d%n&quot;, person.getInt(&quot;age&quot;));</div><div class="FixedLine">      out.println(&quot;Address&quot;);</div><div class="FixedLine">      out.println(&quot;-------&quot;);</div><div class="FixedLine">      JsonObject address = person.getJsonObject(&quot;address&quot;);</div><div class="FixedLine">      out.printf(&quot;   Street: %s%n&quot;,</div><div class="FixedLine">                 address.getString(&quot;street&quot;));</div><div class="FixedLine">      out.printf(&quot;   City: %s%n&quot;,</div><div class="FixedLine">                 address.getString(&quot;city&quot;));</div><div class="FixedLine">      out.printf(&quot;   State: %s%n&quot;,</div><div class="FixedLine">                 address.getString(&quot;state&quot;));</div><div class="FixedLine">      out.printf(&quot;   Zipcode: %d%n&quot;,</div><div class="FixedLine">                 address.getInt(&quot;zipcode&quot;));</div><div class="FixedLine">      out.println(&quot;Phone Numbers&quot;);<span id="ITerm85">
                        
                        
                        
                      </span></div><div class="FixedLine">      out.println(&quot;-------------&quot;);</div><div class="FixedLine">      JsonArray phoneNumbers =</div><div class="FixedLine">         person.getJsonArray(&quot;phoneNumbers&quot;);<span id="ITerm86">
                        
                        
                        
                      </span></div><div class="FixedLine">      for (JsonObject phoneNumber:</div><div class="FixedLine">           phoneNumbers.getValuesAs(JsonObject.class))</div><div class="FixedLine">      {</div><div class="FixedLine">         out.printf(&quot;   Type: %s%n&quot;,</div><div class="FixedLine">                    phoneNumber.getString(&quot;type&quot;));</div><div class="FixedLine">         out.printf(&quot;   Number: %s%n&quot;,</div><div class="FixedLine">                    phoneNumber.getString(&quot;number&quot;));</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div><div class="FixedLine">}<span id="ITerm87">
                        
                        
                        
                      </span></div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 12-5</span><p class="SimplePara">Demonstrating JSON <span id="ITerm88">Pointer</span></p></div></div></div></div><p class="Para" id="Par104">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC14">12-5</a></span> includes expression <span class="EmphasisFontCategoryNonProportional ">Json.createValue(30)</span> for conveniently converting an <span class="EmphasisFontCategoryNonProportional ">int</span> to a <span class="EmphasisFontCategoryNonProportional ">JsonNumber</span>, which is the appropriate <span class="EmphasisFontCategoryNonProportional ">JsonValue</span> subtype to be passed as the second argument to <span class="EmphasisFontCategoryNonProportional ">JsonPointer</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">replace()</span> method. The <span class="EmphasisFontCategoryNonProportional ">JsonNumber createValue(int value)</span> method is one of six overloaded <span class="EmphasisFontCategoryNonProportional ">static</span> methods added in JSON-P 1.1 for conveniently converting <span class="EmphasisFontCategoryNonProportional ">double</span>s, <span class="EmphasisFontCategoryNonProportional ">int</span>s, <span class="EmphasisFontCategoryNonProportional ">long</span>s, <span class="EmphasisFontCategoryNonProportional ">java.lang.String</span>s, <span class="EmphasisFontCategoryNonProportional ">java.math.BigDecimal</span>s, and <span class="EmphasisFontCategoryNonProportional ">java.math.BigInteger</span>s to their JSON-P equivalents.</p><div class="Para" id="Par105">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC14">12-5</a></span> as follows: <span id="ITerm89">
                  
                  
                  
                </span><div class="ProgramCode" id="PC15"><div class="LineGroup"><div class="FixedLine">javac -cp javax.json-api-1.1.3.jar;javax.json-1.1.3.jar JSONPDemo.java</div></div></div></div><div class="Para" id="Par106">Run the resulting application as follows:<div class="ProgramCode" id="PC16"><div class="LineGroup"><div class="FixedLine">java -cp javax.json-api-1.1.3.jar;javax.json-1.1.3.jar;. JSONPDemo</div></div></div></div><div class="Para" id="Par107">You should observe the following output:<div class="ProgramCode" id="PC17"><div class="LineGroup"><div class="FixedLine">First name: John</div><div class="FixedLine">Last name: Doe</div><div class="FixedLine">Age: 30</div><div class="FixedLine">Address<span id="ITerm90">
                        
                        
                        
                      </span></div><div class="FixedLine">-------</div><div class="FixedLine">   Street: 400 Some Street</div><div class="FixedLine">   City: Beverly Hills</div><div class="FixedLine">   State: CA</div><div class="FixedLine">   Zipcode: 90210</div><div class="FixedLine">Phone Numbers</div><div class="FixedLine">-------------</div><div class="FixedLine">   Type: fax</div><div class="FixedLine">   Number: 310 555-4567</div><div class="FixedLine">   Type: cell</div><div class="FixedLine">   Number: 123 456-7890</div></div></div></div><div class="Para" id="Par108">The <span class="EmphasisFontCategoryNonProportional ">Json</span> class provides a pair of <span class="EmphasisFontCategoryNonProportional ">static</span> methods for encoding (escaping) a JSON pointer string and for decoding (unescaping) an encoded pointer string: <span id="ITerm91">
                  
                  
                  
                </span><div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par109">
                      <span class="EmphasisFontCategoryNonProportional ">String encodePointer(String pointer)</span>
                    </p></li><li><p class="Para" id="Par110">
                      <span class="EmphasisFontCategoryNonProportional ">String decodePointer(String encPointer)</span>
                    </p></li></ul></div></div><div class="Para" id="Par111"><span class="EmphasisFontCategoryNonProportional ">encodePointer()</span> encodes <span class="EmphasisFontCategoryNonProportional ">~</span> as <span class="EmphasisFontCategoryNonProportional ">~0</span> and <span class="EmphasisFontCategoryNonProportional ">/</span> as <span class="EmphasisFontCategoryNonProportional ">~1</span>. <span class="EmphasisFontCategoryNonProportional ">decodePointer()</span> performs the opposite conversion. Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC18">12-6</a></span> demonstrates both methods.<div class="ProgramCode" id="PC18"><div class="LineGroup"><div class="FixedLine">import javax.json.Json;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class JSONPDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      if (args.length != 1)</div><div class="FixedLine">      {</div><div class="FixedLine">         err.println(&quot;usage: java JSONPDemo pointer&quot;);</div><div class="FixedLine">         return;</div><div class="FixedLine">      }</div><div class="FixedLine">      String encPointer = Json.encodePointer(args[0]);</div><div class="FixedLine">      out.printf(&quot;Encoded pointer: %s%n\n&quot;, encPointer);</div><div class="FixedLine">      out.printf(&quot;Decoded pointer: %s%n\n&quot;,</div><div class="FixedLine">                 Json.decodePointer(encPointer)); <span id="ITerm92">
                        
                        
                        
                      </span><span id="ITerm93">
                        
                        
                        
                      </span></div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 12-6</span><p class="SimplePara">Demonstrating JSON Pointer <span id="ITerm94">Encoding and Decoding</span></p></div></div></div></div><div class="Para" id="Par112">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC18">12-6</a></span> and then run the application as follows:<div class="ProgramCode" id="PC19"><div class="LineGroup"><div class="FixedLine">java -cp javax.json-1.1.3.jar;javax.json-api-1.1.3.jar;. JSONPDemo /a/b/c~d</div></div></div></div><div class="Para" id="Par113">You should observe the following output:<div class="ProgramCode" id="PC20"><div class="LineGroup"><div class="FixedLine">Encoded pointer: ~1a~1b~1c~0d</div></div><div class="LineGroup"><div class="FixedLine">Decoded pointer: /a/b/c~d<span id="ITerm95">
                        
                        
                        
                      </span><span id="ITerm96">
                        
                        
                        
                      </span></div></div></div></div></section><section class="Section2 RenderAsSection2" id="Sec10"><h3 class="Heading">JSON Patch</h3><p class="Para" id="Par114"><span id="ITerm97">
                  <em class="EmphasisTypeItalic ">JSON Patch</em>
                  
                </span><span id="ITerm98">
                  
                  
                  
                </span><span id="ITerm99">
                  
                  
                </span> (<span class="ExternalRef"><a href="http://tools.ietf.org/html/rfc6902"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://tools.ietf.org/html/rfc6902</span>
                  </span></a></span>) defines a JSON document structure for expressing a sequence of operations to apply to a target JSON document. It鈥檚 often used with <em class="EmphasisTypeItalic ">HTTP PATCH</em> (<span class="ExternalRef"><a href="http://en.wikipedia.org/wiki/Patch_verb"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://en.wikipedia.org/wiki/Patch_verb</span>
                  </span></a></span>), an HTTP request method for making partial changes to an existing resource.</p><div class="Para" id="Par115">The JSON Patch document consists of an array of objects where each object denotes a single operation. Consider the following example, for use with JSON document <span class="EmphasisFontCategoryNonProportional ">{&quot;a&quot;: {&quot;b&quot;: {&quot;c&quot;: &quot;val&quot;, &quot;d&quot;: &quot;val&quot;, &quot;e&quot;: &quot;val&quot;}}}</span>:<div class="ProgramCode" id="PC21"><div class="LineGroup"><div class="FixedLine">[</div><div class="FixedLine">  { &quot;op&quot;: &quot;test&quot;, &quot;path&quot;: &quot;/a/b/c&quot;, &quot;value&quot;: &quot;foo&quot; },</div><div class="FixedLine">  { &quot;op&quot;: &quot;remove&quot;, &quot;path&quot;: &quot;/a/b/c&quot; },</div><div class="FixedLine">  { &quot;op&quot;: &quot;add&quot;, &quot;path&quot;: &quot;/a/b/c&quot;,</div><div class="FixedLine">    &quot;value&quot;: [ &quot;foo&quot;, &quot;bar&quot; ] },</div><div class="FixedLine">  { &quot;op&quot;: &quot;replace&quot;, &quot;path&quot;: &quot;/a/b/c&quot;, &quot;value&quot;: 42 },</div><div class="FixedLine">  { &quot;op&quot;: &quot;move&quot;, &quot;from&quot;: &quot;/a/b/c&quot;, &quot;path&quot;: &quot;/a/b/d&quot; },</div><div class="FixedLine">  { &quot;op&quot;: &quot;copy&quot;, &quot;from&quot;: &quot;/a/b/d&quot;, &quot;path&quot;: &quot;/a/b/e&quot; }</div><div class="FixedLine">]</div></div></div></div><p class="Para" id="Par116">Each object has an <span class="EmphasisFontCategoryNonProportional ">op</span> field that identifies the operation to be performed. Each object also has a <span class="EmphasisFontCategoryNonProportional ">path</span> field, which is a JSON Pointer that references a location in the target <span id="ITerm100">document</span>.</p><div class="Para" id="Par117">There are six operations: <span class="EmphasisFontCategoryNonProportional ">test</span>, <span class="EmphasisFontCategoryNonProportional ">remove</span>, <span class="EmphasisFontCategoryNonProportional ">add</span>, <span class="EmphasisFontCategoryNonProportional ">replace</span>, <span class="EmphasisFontCategoryNonProportional ">move</span>, and <span class="EmphasisFontCategoryNonProportional ">copy</span><span id="ITerm101">
                  
                  
                  
                </span>:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par118"><span class="EmphasisFontCategoryNonProportional ">test</span>: Test that the value at the <span class="EmphasisFontCategoryNonProportional ">path</span> location is equal to the value assigned to the <span class="EmphasisFontCategoryNonProportional ">value</span> field.</p></li><li><p class="Para" id="Par119"><span class="EmphasisFontCategoryNonProportional ">remove</span>: Remove the value at the <span class="EmphasisFontCategoryNonProportional ">path</span> location.</p></li><li><p class="Para" id="Par120"><span class="EmphasisFontCategoryNonProportional ">add</span>: Add a new element to an array or a new field to an object, or replace an existing object field鈥檚 value.</p></li><li><p class="Para" id="Par121"><span class="EmphasisFontCategoryNonProportional ">replace</span>: Replace the value at the <span class="EmphasisFontCategoryNonProportional ">path</span> location with a new value.</p></li><li><p class="Para" id="Par122"><span class="EmphasisFontCategoryNonProportional ">move</span>: Remove the value at the <span class="EmphasisFontCategoryNonProportional ">from</span> location and add it to the <span class="EmphasisFontCategoryNonProportional ">path</span> location.</p></li><li><p class="Para" id="Par123"><span class="EmphasisFontCategoryNonProportional ">copy</span>: Copy the value at the <span class="EmphasisFontCategoryNonProportional ">from</span> location to the <span class="EmphasisFontCategoryNonProportional ">path</span> location.</p></li></ul></div></div><div class="Para" id="Par124">JSON-P鈥檚 <span class="EmphasisFontCategoryNonProportional ">JsonPatch</span> interface represents a JSON Patch. Obtain an instance of a class that implements this interface by executing <span class="EmphasisFontCategoryNonProportional ">Json</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">JsonPatch createPatch(JsonArray patchArray) static</span> method: <span id="ITerm102">
                  
                  
                  
                </span><div class="ProgramCode" id="PC22"><div class="LineGroup"><div class="FixedLine">JsonArray patchops = ...  ;</div><div class="FixedLine">JsonPatch patch = Json.createPatch(patchops); <span id="ITerm103">
                        
                        
                        
                      </span></div></div></div></div><div class="Para" id="Par125">After obtaining a <span class="EmphasisFontCategoryNonProportional ">JsonPatch</span> instance, invoke its <span class="EmphasisFontCategoryNonProportional ">&lt;T extends JsonStructure&gt; T apply(t target)</span> generic method to apply the specified patch operations to <span class="EmphasisFontCategoryNonProportional ">target</span>:<div class="ProgramCode" id="PC23"><div class="LineGroup"><div class="FixedLine">JsonArray result = jsonpatch.apply(target);</div></div></div></div><div class="Para" id="Par126">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC24">12-7</a></span> presents the source code to an application that demonstrates creating a <span class="EmphasisFontCategoryNonProportional ">JsonPatch</span> object and applying its operations to a <span class="EmphasisFontCategoryNonProportional ">JsonObject</span>, to make the same document changes as demonstrated in Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC14">12-5</a></span>.<div class="ProgramCode" id="PC24"><div class="LineGroup"><div class="FixedLine">import java.io.StringReader; <span id="ITerm104">
                        
                        
                        
                      </span></div></div><div class="LineGroup"><div class="FixedLine">import javax.json.Json;</div><div class="FixedLine">import javax.json.JsonArray;</div><div class="FixedLine">import javax.json.JsonObject;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">/*</div><div class="FixedLine">   JsonPatch Demonstration:</div></div><div class="LineGroup"><div class="FixedLine">   1) Create the following JSON document:</div></div><div class="LineGroup"><div class="FixedLine">   {</div><div class="FixedLine">      &quot;firstName&quot;: &quot;John&quot;,</div><div class="FixedLine">      &quot;lastName&quot;: &quot;Doe&quot;,</div><div class="FixedLine">      &quot;age&quot;: 42,</div><div class="FixedLine">      &quot;address&quot;:</div><div class="FixedLine">      {</div><div class="FixedLine">         &quot;streetAddress&quot;: &quot;400 Some Street&quot;,</div><div class="FixedLine">         &quot;city&quot;: &quot;Beverly Hills&quot;,</div><div class="FixedLine">         &quot;state&quot;: &quot;CA&quot;,</div><div class="FixedLine">         &quot;zipcode&quot;: 90210</div><div class="FixedLine">      },</div><div class="FixedLine">      &quot;phoneNumbers&quot;:</div><div class="FixedLine">      [</div><div class="FixedLine">         {</div><div class="FixedLine">            &quot;type&quot;: &quot;home&quot;,</div><div class="FixedLine">            &quot;number&quot;: &quot;310 555-1234&quot;</div><div class="FixedLine">         },</div><div class="FixedLine">         {</div><div class="FixedLine">            &quot;type&quot;: &quot;fax&quot;,</div><div class="FixedLine">            &quot;number&quot;: &quot;310 555-4567&quot;<span id="ITerm105">
                        
                        
                        
                      </span></div><div class="FixedLine">         }</div><div class="FixedLine">      ]</div><div class="FixedLine">   }</div></div><div class="LineGroup"><div class="FixedLine">   2) Use JsonPatch to convert the previous JSON document</div><div class="FixedLine">      to the following JSON document: <span id="ITerm106">
                        
                        
                        
                      </span><span id="ITerm107">
                        
                        
                        
                      </span></div></div><div class="LineGroup"><div class="FixedLine">   {</div><div class="FixedLine">      &quot;firstName&quot;: &quot;John&quot;,</div><div class="FixedLine">      &quot;lastName&quot;: &quot;Doe&quot;,</div><div class="FixedLine">      &quot;age&quot;: 30,</div><div class="FixedLine">      &quot;address&quot;:</div><div class="FixedLine">      {</div><div class="FixedLine">         &quot;streetAddress&quot;: &quot;400 Some Street&quot;,</div><div class="FixedLine">         &quot;city&quot;: &quot;Beverly Hills&quot;,</div><div class="FixedLine">         &quot;state&quot;: &quot;CA&quot;,</div><div class="FixedLine">         &quot;zipcode&quot;: 90210</div><div class="FixedLine">      },</div><div class="FixedLine">      &quot;phoneNumbers&quot;:</div><div class="FixedLine">      [</div><div class="FixedLine">         {</div><div class="FixedLine">            &quot;type&quot;: &quot;fax&quot;,</div><div class="FixedLine">            &quot;number&quot;: &quot;310 555-4567&quot;</div><div class="FixedLine">         },</div><div class="FixedLine">         {</div><div class="FixedLine">            &quot;type&quot;: &quot;cell&quot;,</div><div class="FixedLine">            &quot;number&quot;: &quot;123 456-7890&quot;</div><div class="FixedLine">         }</div><div class="FixedLine">      ]</div><div class="FixedLine">   }</div><div class="FixedLine">*/</div></div><div class="LineGroup"><div class="FixedLine">public class JSONPDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      JsonObject person;</div><div class="FixedLine">      person = <span id="ITerm108">
                        
                        
                        
                      </span></div><div class="FixedLine">         Json.createObjectBuilder()</div><div class="FixedLine">             .add(&quot;firstName&quot;, &quot;John&quot;)</div><div class="FixedLine">             .add(&quot;lastName&quot;, &quot;Doe&quot;)</div><div class="FixedLine">             .add(&quot;age&quot;, 42)</div><div class="FixedLine">             .add(&quot;address&quot;, Json.createObjectBuilder()</div><div class="FixedLine">                                 .add(&quot;street&quot;,</div><div class="FixedLine">                                      &quot;400 Some Street&quot;)</div><div class="FixedLine">                                 .add(&quot;city&quot;,</div><div class="FixedLine">                                      &quot;Beverly Hills&quot;)</div><div class="FixedLine">                                 .add(&quot;state&quot;, &quot;CA&quot;)</div><div class="FixedLine">                                 .add(&quot;zipcode&quot;, 90210))</div><div class="FixedLine">             .add(&quot;phoneNumbers&quot;,</div><div class="FixedLine">                  Json.createArrayBuilder()</div><div class="FixedLine">                      .add(Json.createObjectBuilder()</div><div class="FixedLine">                               .add(&quot;type&quot;, &quot;home&quot;)</div><div class="FixedLine">                               .add(&quot;number&quot;,</div><div class="FixedLine">                                    &quot;310 555-1234&quot;))</div><div class="FixedLine">                      .add(Json.createObjectBuilder()</div><div class="FixedLine">                               .add(&quot;type&quot;, &quot;fax&quot;)</div><div class="FixedLine">                               .add(&quot;number&quot;,</div><div class="FixedLine">                                    &quot;310 555-4567&quot;)))</div><div class="FixedLine">             .build();<span id="ITerm109">
                        
                        
                        
                      </span></div><div class="FixedLine">      String patch =</div><div class="FixedLine">      &quot;[&quot; +</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;\&quot;op\&quot;: \&quot;replace\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;path\&quot;: \&quot;/age\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;value\&quot;: 30&quot; +</div><div class="FixedLine">      &quot;},&quot; +</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;\&quot;op\&quot;: \&quot;add\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;path\&quot;: \&quot;/phoneNumbers/-\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;value\&quot;: &quot; +</div><div class="FixedLine">      &quot;{&quot; +</div><div class="FixedLine">      &quot;\&quot;type\&quot;: \&quot;cell\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;number\&quot;: \&quot;123 456-7890\&quot;&quot; +</div><div class="FixedLine">      &quot;}&quot; +</div><div class="FixedLine">      &quot;},&quot; +</div><div class="FixedLine">      &quot;{&quot; +<span id="ITerm110">
                        
                        
                        
                      </span></div><div class="FixedLine">      &quot;\&quot;op\&quot;: \&quot;remove\&quot;,&quot; +</div><div class="FixedLine">      &quot;\&quot;path\&quot;: \&quot;/phoneNumbers/0\&quot;&quot; +</div><div class="FixedLine">      &quot;}&quot; +</div><div class="FixedLine">      &quot;]&quot;;</div><div class="FixedLine">      JsonArray patchArray =</div><div class="FixedLine">         Json.createReader(new StringReader(patch))</div><div class="FixedLine">             .readArray();</div><div class="FixedLine">      person = Json.createPatch(patchArray).apply(person);</div><div class="FixedLine">      out.printf(&quot;First name: %s%n&quot;,</div><div class="FixedLine">                 person.getString(&quot;firstName&quot;));</div><div class="FixedLine">      out.printf(&quot;Last name: %s%n&quot;,</div><div class="FixedLine">                 person.getString(&quot;lastName&quot;));</div><div class="FixedLine">      out.printf(&quot;Age: %d%n&quot;, person.getInt(&quot;age&quot;));<span id="ITerm111">
                        
                        
                        
                      </span><span id="ITerm112">
                        
                        
                        
                      </span></div><div class="FixedLine">      out.println(&quot;Address&quot;);</div><div class="FixedLine">      out.println(&quot;-------&quot;);</div><div class="FixedLine">      JsonObject address = person.getJsonObject(&quot;address&quot;);</div><div class="FixedLine">      out.printf(&quot;   Street: %s%n&quot;,</div><div class="FixedLine">                 address.getString(&quot;street&quot;));</div><div class="FixedLine">      out.printf(&quot;   City: %s%n&quot;,</div><div class="FixedLine">                 address.getString(&quot;city&quot;));</div><div class="FixedLine">      out.printf(&quot;   State: %s%n&quot;,</div><div class="FixedLine">                 address.getString(&quot;state&quot;));</div><div class="FixedLine">      out.printf(&quot;   Zipcode: %d%n&quot;,</div><div class="FixedLine">                 address.getInt(&quot;zipcode&quot;));</div><div class="FixedLine">      out.println(&quot;Phone Numbers&quot;);</div><div class="FixedLine">      out.println(&quot;-------------&quot;);</div><div class="FixedLine">      JsonArray phoneNumbers =</div><div class="FixedLine">         person.getJsonArray(&quot;phoneNumbers&quot;);</div><div class="FixedLine">      for (JsonObject phoneNumber:</div><div class="FixedLine">           phoneNumbers.getValuesAs(JsonObject.class))</div><div class="FixedLine">      {</div><div class="FixedLine">         out.printf(&quot;   Type: %s%n&quot;,</div><div class="FixedLine">                    phoneNumber.getString(&quot;type&quot;));</div><div class="FixedLine">         out.printf(&quot;   Number: %s%n&quot;,</div><div class="FixedLine">                    phoneNumber.getString(&quot;number&quot;));</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div><div class="FixedLine">}<span id="ITerm113">
                        
                        
                        
                      </span><span id="ITerm114">
                        
                        
                        
                      </span></div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 12-7</span><p class="SimplePara">Demonstrating JSON <span id="ITerm115">Patch</span></p></div></div></div></div><div class="Para" id="Par127">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC24">12-7</a></span> and run the application. You should observe the following output:<div class="ProgramCode" id="PC25"><div class="LineGroup"><div class="FixedLine">First name: John</div><div class="FixedLine">Last name: Doe</div><div class="FixedLine">Age: 30</div><div class="FixedLine">Address</div><div class="FixedLine">-------</div><div class="FixedLine">   Street: 400 Some Street</div><div class="FixedLine">   City: Beverly Hills</div><div class="FixedLine">   State: CA</div><div class="FixedLine">   Zipcode: 90210</div><div class="FixedLine">Phone Numbers</div><div class="FixedLine">-------------</div><div class="FixedLine">   Type: fax</div><div class="FixedLine">   Number: 310 555-4567</div><div class="FixedLine">   Type: cell</div><div class="FixedLine">   Number: 123 456-7890</div></div></div></div><div class="Para" id="Par128">It can be tedious to specify all patch operations literally, which is why JSON-P also provides the <span class="EmphasisFontCategoryNonProportional ">JsonPatchBuilder</span> interface for constructing a JSON Patch by adding JSON Patch operations incrementally. An instance of a class that implements this interface is obtained by executing either of <span class="EmphasisFontCategoryNonProportional ">Json</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">createPatchBuilder()</span> method<span id="ITerm116">
                  
                </span>s. The builder鈥檚 <span class="EmphasisFontCategoryNonProportional ">add()</span>, <span class="EmphasisFontCategoryNonProportional ">remove()</span>, and other methods are called to add patch operations. The <span class="EmphasisFontCategoryNonProportional ">build()</span> method returns the resulting <span class="EmphasisFontCategoryNonProportional ">JsonPatch</span>: <span id="ITerm117">
                  
                  
                  
                </span><div class="ProgramCode" id="PC26"><div class="LineGroup"><div class="FixedLine">JsonPatchBuilder builder = Json.createPatchBuilder();</div><div class="FixedLine">JsonPatch patch = builder.replace(&quot;/a/b/c&quot;, 42)</div><div class="FixedLine">                         .copy(&quot;/a/b/e&quot;, &quot;/a/b/d&quot;)</div><div class="FixedLine">                         .build();</div></div></div></div><div class="Para" id="Par129">JSON-P provides a third way to obtain a JSON Patch. <span class="EmphasisFontCategoryNonProportional ">Json</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">JsonPatch createDiff(JsonStructure source, JsonStructure target) static</span> method generates a JSON Patch whose operations describe how to convert from <span class="EmphasisFontCategoryNonProportional ">source</span> to <span class="EmphasisFontCategoryNonProportional ">target</span>. Note that <span class="EmphasisFontCategoryNonProportional ">source</span> and <span class="EmphasisFontCategoryNonProportional ">target</span> must have the same types. In other words, they must both be <span class="EmphasisFontCategoryNonProportional ">JsonArray</span>s or <span class="EmphasisFontCategoryNonProportional ">JsonObject</span>s. The <span class="EmphasisFontCategoryNonProportional ">createDiff()</span> method is demonstrated in Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC27">12-8</a></span>. <span id="ITerm118">
                  
                  
                  
                </span><div class="ProgramCode" id="PC27"><div class="LineGroup"><div class="FixedLine">import javax.json.Json;</div><div class="FixedLine">import javax.json.JsonObject;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class JSONPDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      JsonObject person1;</div><div class="FixedLine">      person1 =</div><div class="FixedLine">         Json.createObjectBuilder()</div><div class="FixedLine">             .add(&quot;firstName&quot;, &quot;John&quot;)</div><div class="FixedLine">             .add(&quot;lastName&quot;, &quot;Doe&quot;)</div><div class="FixedLine">             .add(&quot;age&quot;, 42)</div><div class="FixedLine">             .add(&quot;address&quot;, Json.createObjectBuilder()</div><div class="FixedLine">                                 .add(&quot;street&quot;,</div><div class="FixedLine">                                      &quot;400 Some Street&quot;)</div><div class="FixedLine">                                 .add(&quot;city&quot;,</div><div class="FixedLine">                                      &quot;Beverly Hills&quot;)</div><div class="FixedLine">                                 .add(&quot;state&quot;, &quot;CA&quot;)</div><div class="FixedLine">                                 .add(&quot;zipcode&quot;, 90210))</div><div class="FixedLine">             .add(&quot;phoneNumbers&quot;,</div><div class="FixedLine">                  Json.createArrayBuilder()</div><div class="FixedLine">                      .add(Json.createObjectBuilder()</div><div class="FixedLine">                               .add(&quot;type&quot;, &quot;home&quot;)</div><div class="FixedLine">                               .add(&quot;number&quot;,</div><div class="FixedLine">                                    &quot;310 555-1234&quot;))</div><div class="FixedLine">                      .add(Json.createObjectBuilder()</div><div class="FixedLine">                               .add(&quot;type&quot;, &quot;fax&quot;)</div><div class="FixedLine">                               .add(&quot;number&quot;,</div><div class="FixedLine">                                    &quot;310 555-4567&quot;)))</div><div class="FixedLine">             .build();</div><div class="FixedLine">      JsonObject person2; <span id="ITerm119">
                        
                        
                        
                      </span></div><div class="FixedLine">      person2 =</div><div class="FixedLine">         Json.createObjectBuilder()</div><div class="FixedLine">             .add(&quot;firstName&quot;, &quot;John&quot;)</div><div class="FixedLine">             .add(&quot;lastName&quot;, &quot;Doe&quot;)</div><div class="FixedLine">             .add(&quot;age&quot;, 30)</div><div class="FixedLine">             .add(&quot;address&quot;, Json.createObjectBuilder()</div><div class="FixedLine">                                 .add(&quot;street&quot;,</div><div class="FixedLine">                                      &quot;400 Some Street&quot;)</div><div class="FixedLine">                                 .add(&quot;city&quot;,</div><div class="FixedLine">                                      &quot;Beverly Hills&quot;)</div><div class="FixedLine">                                 .add(&quot;state&quot;, &quot;CA&quot;)</div><div class="FixedLine">                                 .add(&quot;zipcode&quot;, 90210))</div><div class="FixedLine">             .add(&quot;phoneNumbers&quot;,</div><div class="FixedLine">                  Json.createArrayBuilder()</div><div class="FixedLine">                      .add(Json.createObjectBuilder()</div><div class="FixedLine">                               .add(&quot;type&quot;, &quot;fax&quot;)</div><div class="FixedLine">                               .add(&quot;number&quot;,</div><div class="FixedLine">                                    &quot;310 555-4567&quot;))<span id="ITerm120">
                        
                        
                        
                      </span></div><div class="FixedLine">                      .add(Json.createObjectBuilder()</div><div class="FixedLine">                               .add(&quot;type&quot;, &quot;cell&quot;)</div><div class="FixedLine">                               .add(&quot;number&quot;,</div><div class="FixedLine">                                    &quot;123 456-7890&quot;)))</div><div class="FixedLine">             .build();</div><div class="FixedLine">      out.println(Json.createDiff(person1, person2));</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 12-8</span><p class="SimplePara">Creating a JSON Patch Based on Differences Between a Source and a <span id="ITerm121">Target</span></p></div></div></div></div><div class="Para" id="Par130">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC27">12-8</a></span> and run the application. You should observe the following output:<div class="ProgramCode" id="PC28"><div class="LineGroup"><div class="FixedLine">[{&quot;op&quot;:&quot;replace&quot;,&quot;path&quot;:&quot;/age&quot;,&quot;value&quot;:30},{&quot;op&quot;:&quot;remove&quot;,&quot;path&quot;:&quot;/phoneNumbers/0&quot;},{&quot;op&quot;:&quot;add&quot;,&quot;path&quot;:&quot;/phoneNumbers/1&quot;,&quot;value&quot;:{&quot;type&quot;:&quot;cell&quot;,&quot;number&quot;:&quot;123 456-7890&quot;}}]<span id="ITerm122">
                        
                        
                        
                      </span><span id="ITerm123">
                        
                        
                        
                      </span></div></div></div></div></section><section class="Section2 RenderAsSection2" id="Sec11"><h3 class="Heading">JSON Merge Patch</h3><p class="Para" id="Par131"><span id="ITerm124">
                  <em class="EmphasisTypeItalic ">JSON Merge Patch</em>
                  
                </span><span id="ITerm125">
                  
                  
                  
                </span><span id="ITerm126">
                  
                  
                </span> (<span class="ExternalRef"><a href="http://tools.ietf.org/html/rfc7386"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://tools.ietf.org/html/rfc7386</span>
                  </span></a></span>) defines a JSON document structure for expressing a sequence of changes to be made to a target JSON document via a syntax that closely mimics that document. Recipients of a JSON Merge Patch document determine the exact set of changes being requested by comparing the content of the provided patch against the current content of the target document. If the patch contains members that don鈥檛 appear in the target, those members are added. If the target does contain the member, the value is replaced. Null values in the merge patch are given special meaning to indicate the removal of existing values in the target. As with JSON Patch, JSON Merge Patch is often used with HTTP PATCH (<span class="ExternalRef"><a href="http://en.wikipedia.org/wiki/Patch_verb"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">http://en.wikipedia.org/wiki/Patch_verb</span>
                  </span></a></span>).</p><div class="Para" id="Par132">For example, consider the following JSON <span id="ITerm127">document</span>:<div class="ProgramCode" id="PC29"><div class="LineGroup"><div class="FixedLine">{</div><div class="FixedLine">   &quot;a&quot;: &quot;b&quot;,</div><div class="FixedLine">   &quot;c&quot;:</div><div class="FixedLine">   {</div><div class="FixedLine">      &quot;d&quot;: &quot;e&quot;,</div><div class="FixedLine">      &quot;f&quot;: &quot;g&quot;</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div></div></div><div class="Para" id="Par133">The following JSON Merge Patch document specifies a change to <span class="EmphasisFontCategoryNonProportional ">a</span>鈥檚 value and the removal of <span class="EmphasisFontCategoryNonProportional ">f</span><span id="ITerm128">
                  
                  
                  
                </span>:<div class="ProgramCode" id="PC30"><div class="LineGroup"><div class="FixedLine">{</div><div class="FixedLine">   &quot;a&quot;:&quot;z&quot;,</div><div class="FixedLine">   &quot;c&quot;:</div><div class="FixedLine">   {</div><div class="FixedLine">      &quot;f&quot;: null</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div></div></div><div class="Para" id="Par134">JSON-P鈥檚 <span class="EmphasisFontCategoryNonProportional ">JsonMergePatch</span> interface represents a JSON Merge Patch. Obtain an instance of a class that implements this interface by executing <span class="EmphasisFontCategoryNonProportional ">Json</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">JsonMergePatch createMergePatch(JsonValue patchArray) static</span> method:<div class="ProgramCode" id="PC31"><div class="LineGroup"><div class="FixedLine">JsonValue patch = ...;</div><div class="FixedLine">JsonMergePatch mergePatch = Json.createMergePatch(patch) <span id="ITerm129">
                        
                        
                        
                      </span>;</div></div></div></div><div class="Para" id="Par135">After obtaining a <span class="EmphasisFontCategoryNonProportional ">JsonMergePatch</span> instance, invoke its <span class="EmphasisFontCategoryNonProportional ">JsonValue apply(JsonValue target)</span> method to apply the specified patch to <span class="EmphasisFontCategoryNonProportional ">target</span>:<div class="ProgramCode" id="PC32"><div class="LineGroup"><div class="FixedLine">JsonValue result = mergePatch.apply(target);</div></div></div></div><div class="Para" id="Par136">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC33">12-9</a></span> presents the source code to an application that demonstrates creating a <span class="EmphasisFontCategoryNonProportional ">JsonMergePatch</span> object and applying it to a <span class="EmphasisFontCategoryNonProportional ">JsonObject</span>, to make the same document changes as demonstrated in Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC14">12-5</a></span>.<div class="ProgramCode" id="PC33"><div class="LineGroup"><div class="FixedLine">import javax.json.Json;</div><div class="FixedLine">import javax.json.JsonArray;</div><div class="FixedLine">import javax.json.JsonMergePatch;</div><div class="FixedLine">import javax.json.JsonObject; <span id="ITerm130">
                        
                        
                        
                      </span></div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class JSONPDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      JsonObject person;</div><div class="FixedLine">      person =</div><div class="FixedLine">         Json.createObjectBuilder()</div><div class="FixedLine">             .add(&quot;firstName&quot;, &quot;John&quot;)</div><div class="FixedLine">             .add(&quot;lastName&quot;, &quot;Doe&quot;)</div><div class="FixedLine">             .add(&quot;age&quot;, 42)</div><div class="FixedLine">             .add(&quot;address&quot;, Json.createObjectBuilder()</div><div class="FixedLine">                                 .add(&quot;street&quot;,</div><div class="FixedLine">                                      &quot;400 Some Street&quot;)</div><div class="FixedLine">                                 .add(&quot;city&quot;,</div><div class="FixedLine">                                      &quot;Beverly Hills&quot;)</div><div class="FixedLine">                                 .add(&quot;state&quot;, &quot;CA&quot;)<span id="ITerm131">
                        
                        
                        
                      </span></div><div class="FixedLine">                                 .add(&quot;zipcode&quot;, 90210))</div><div class="FixedLine">             .add(&quot;phoneNumbers&quot;,</div><div class="FixedLine">                  Json.createArrayBuilder()</div><div class="FixedLine">                      .add(Json.createObjectBuilder()</div><div class="FixedLine">                               .add(&quot;type&quot;, &quot;home&quot;)</div><div class="FixedLine">                               .add(&quot;number&quot;,</div><div class="FixedLine">                                    &quot;310 555-1234&quot;))</div><div class="FixedLine">                      .add(Json.createObjectBuilder()</div><div class="FixedLine">                               .add(&quot;type&quot;, &quot;fax&quot;)</div><div class="FixedLine">                               .add(&quot;number&quot;,</div><div class="FixedLine">                                    &quot;310 555-4567&quot;)))</div><div class="FixedLine">             .build();</div><div class="FixedLine">      JsonObject patch =</div><div class="FixedLine">         Json.createObjectBuilder()</div><div class="FixedLine">             .add(&quot;age&quot;, 30)</div><div class="FixedLine">             .add(&quot;phoneNumbers&quot;,</div><div class="FixedLine">                  Json.createArrayBuilder()</div><div class="FixedLine">                      .add(Json.createObjectBuilder()<span id="ITerm132">
                        
                        
                        
                      </span></div><div class="FixedLine">                               .add(&quot;type&quot;, &quot;fax&quot;)</div><div class="FixedLine">                               .add(&quot;number&quot;,</div><div class="FixedLine">                                    &quot;310 555-4567&quot;))</div><div class="FixedLine">                             .add(Json.createObjectBuilder()</div><div class="FixedLine">                                      .add(&quot;type&quot;, &quot;cell&quot;)</div><div class="FixedLine">                                      .add(&quot;number&quot;,</div><div class="FixedLine">                                           &quot;123 456-7890&quot;)))</div><div class="FixedLine">                  .build();</div><div class="FixedLine">      JsonMergePatch mergePatch =</div><div class="FixedLine">         Json.createMergePatch(patch);</div><div class="FixedLine">      person = (JsonObject) mergePatch.apply(person);</div><div class="FixedLine">      out.printf(&quot;First name: %s%n&quot;,</div><div class="FixedLine">                 person.getString(&quot;firstName&quot;));</div><div class="FixedLine">      out.printf(&quot;Last name: %s%n&quot;,</div><div class="FixedLine">                 person.getString(&quot;lastName&quot;));</div><div class="FixedLine">      out.printf(&quot;Age: %d%n&quot;, person.getInt(&quot;age&quot;));<span id="ITerm133">
                        
                        
                        
                      </span></div><div class="FixedLine">      out.println(&quot;Address&quot;);</div><div class="FixedLine">      out.println(&quot;-------&quot;);</div><div class="FixedLine">      JsonObject address = person.getJsonObject(&quot;address&quot;);</div><div class="FixedLine">      out.printf(&quot;   Street: %s%n&quot;,</div><div class="FixedLine">                 address.getString(&quot;street&quot;));</div><div class="FixedLine">      out.printf(&quot;   City: %s%n&quot;,</div><div class="FixedLine">                 address.getString(&quot;city&quot;));</div><div class="FixedLine">      out.printf(&quot;   State: %s%n&quot;,</div><div class="FixedLine">                 address.getString(&quot;state&quot;));</div><div class="FixedLine">      out.printf(&quot;   Zipcode: %d%n&quot;,</div><div class="FixedLine">                 address.getInt(&quot;zipcode&quot;));</div><div class="FixedLine">      out.println(&quot;Phone Numbers&quot;);</div><div class="FixedLine">      out.println(&quot;-------------&quot;);</div><div class="FixedLine">      JsonArray phoneNumbers =</div><div class="FixedLine">         person.getJsonArray(&quot;phoneNumbers&quot;);</div><div class="FixedLine">      for (JsonObject phoneNumber:</div><div class="FixedLine">           phoneNumbers.getValuesAs(JsonObject.class))</div><div class="FixedLine">      {</div><div class="FixedLine">         out.printf(&quot;   Type: %s%n&quot;,</div><div class="FixedLine">                    phoneNumber.getString(&quot;type&quot;));</div><div class="FixedLine">         out.printf(&quot;   Number: %s%n&quot;,</div><div class="FixedLine">                    phoneNumber.getString(&quot;number&quot;));</div><div class="FixedLine">      }</div><div class="FixedLine">   }</div><div class="FixedLine">}<span id="ITerm134">
                        
                        
                        
                      </span><span id="ITerm135">
                        
                        
                        
                      </span></div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 12-9</span><p class="SimplePara">Demonstrating JSON <span id="ITerm136">Merge Patch</span></p></div></div></div></div><p class="Para" id="Par137">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC33">12-9</a></span> reveals that an array cannot be manipulated by merge patches. To add an element to an array, or to mutate any of its elements, the entire resulting array must be specified.</p><p class="Para" id="Par138">It鈥檚 necessary to cast <span class="EmphasisFontCategoryNonProportional ">mergePatch.apply(person)</span> to <span class="EmphasisFontCategoryNonProportional ">JsonObject</span> in order to avoid an incompatible-type error: <span class="EmphasisFontCategoryNonProportional ">JsonValue</span> cannot be converted to <span class="EmphasisFontCategoryNonProportional ">JsonObject</span>.</p><div class="Para" id="Par139">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC33">12-9</a></span> and run the application. You should observe the following output: <span id="ITerm137">
                  
                  
                  
                </span><div class="ProgramCode" id="PC34"><div class="LineGroup"><div class="FixedLine">First name: John</div><div class="FixedLine">Last name: Doe</div><div class="FixedLine">Age: 30</div><div class="FixedLine">Address</div><div class="FixedLine">-------</div><div class="FixedLine">   Street: 400 Some Street</div><div class="FixedLine">   City: Beverly Hills</div><div class="FixedLine">   State: CA</div><div class="FixedLine">   Zipcode: 90210</div><div class="FixedLine">Phone Numbers</div><div class="FixedLine">-------------</div><div class="FixedLine">   Type: fax</div><div class="FixedLine">   Number: 310 555-4567</div><div class="FixedLine">   Type: cell</div><div class="FixedLine">   Number: 123 456-7890</div></div></div></div><div class="Para" id="Par140">JSON-P provides another way to obtain a JSON Merge Patch. <span class="EmphasisFontCategoryNonProportional ">Json</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">JsonMergePatch createMergeDiff(JsonValue source, JsonValue target) static</span> method generates a JSON Merge Patch from the <span class="EmphasisFontCategoryNonProportional ">source</span> and the <span class="EmphasisFontCategoryNonProportional ">target</span>, which yields the <span class="EmphasisFontCategoryNonProportional ">target</span> when applied to the <span class="EmphasisFontCategoryNonProportional ">source鈥攕ource</span> and <span class="EmphasisFontCategoryNonProportional ">target</span> don鈥檛 have to have the same <span class="EmphasisFontCategoryNonProportional ">JsonValue</span> subtype. The <span class="EmphasisFontCategoryNonProportional ">createMergeDiff()</span> method<span id="ITerm138">
                  
                </span> is demonstrated in Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC35">12-10</a></span><span id="ITerm139">
                  
                  
                  
                </span>.<div class="ProgramCode" id="PC35"><div class="LineGroup"><div class="FixedLine">import javax.json.Json;</div><div class="FixedLine">import javax.json.JsonObject;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class JSONPDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      JsonObject person1;</div><div class="FixedLine">      person1 =</div><div class="FixedLine">         Json.createObjectBuilder()</div><div class="FixedLine">             .add(&quot;firstName&quot;, &quot;John&quot;)</div><div class="FixedLine">             .add(&quot;lastName&quot;, &quot;Doe&quot;)</div><div class="FixedLine">             .add(&quot;age&quot;, 42)</div><div class="FixedLine">             .add(&quot;address&quot;, Json.createObjectBuilder()</div><div class="FixedLine">                                 .add(&quot;street&quot;,</div><div class="FixedLine">                                      &quot;400 Some Street&quot;)<span id="ITerm140">
                        
                        
                        
                      </span></div><div class="FixedLine">                                 .add(&quot;city&quot;,</div><div class="FixedLine">                                      &quot;Beverly Hills&quot;)</div><div class="FixedLine">                                 .add(&quot;state&quot;, &quot;CA&quot;)</div><div class="FixedLine">                                 .add(&quot;zipcode&quot;, 90210))</div><div class="FixedLine">             .add(&quot;phoneNumbers&quot;,</div><div class="FixedLine">                  Json.createArrayBuilder()</div><div class="FixedLine">                      .add(Json.createObjectBuilder()</div><div class="FixedLine">                               .add(&quot;type&quot;, &quot;home&quot;)</div><div class="FixedLine">                               .add(&quot;number&quot;,</div><div class="FixedLine">                                    &quot;310 555-1234&quot;))</div><div class="FixedLine">                      .add(Json.createObjectBuilder()</div><div class="FixedLine">                               .add(&quot;type&quot;, &quot;fax&quot;)</div><div class="FixedLine">                               .add(&quot;number&quot;,</div><div class="FixedLine">                                    &quot;310 555-4567&quot;)))</div><div class="FixedLine">             .build();</div><div class="FixedLine">      JsonObject person2;</div><div class="FixedLine">      person2 =</div><div class="FixedLine">         Json.createObjectBuilder()</div><div class="FixedLine">             .add(&quot;firstName&quot;, &quot;John&quot;)</div><div class="FixedLine">             .add(&quot;lastName&quot;, &quot;Doe&quot;)</div><div class="FixedLine">             .add(&quot;age&quot;, 30)</div><div class="FixedLine">             .add(&quot;address&quot;, Json.createObjectBuilder()</div><div class="FixedLine">                                 .add(&quot;street&quot;,</div><div class="FixedLine">                                      &quot;400 Some Street&quot;)</div><div class="FixedLine">                                 .add(&quot;city&quot;,</div><div class="FixedLine">                                      &quot;Beverly Hills&quot;)<span id="ITerm141">
                        
                        
                        
                      </span></div><div class="FixedLine">                                 .add(&quot;state&quot;, &quot;CA&quot;)</div><div class="FixedLine">                                 .add(&quot;zipcode&quot;, 90210)) <span id="ITerm142">
                        
                        
                        
                      </span></div><div class="FixedLine">             .add(&quot;phoneNumbers&quot;,</div><div class="FixedLine">                  Json.createArrayBuilder()</div><div class="FixedLine">                      .add(Json.createObjectBuilder()</div><div class="FixedLine">                               .add(&quot;type&quot;, &quot;fax&quot;)</div><div class="FixedLine">                               .add(&quot;number&quot;,</div><div class="FixedLine">                                    &quot;310 555-4567&quot;))</div><div class="FixedLine">                      .add(Json.createObjectBuilder()</div><div class="FixedLine">                               .add(&quot;type&quot;, &quot;cell&quot;)</div><div class="FixedLine">                               .add(&quot;number&quot;,</div><div class="FixedLine">                                    &quot;123 456-7890&quot;)))</div><div class="FixedLine">             .build();</div><div class="FixedLine">      out.println(Json.createMergeDiff(person1, person2)</div><div class="FixedLine">                      .toJsonValue());<span id="ITerm143">
                        
                        
                        
                      </span><span id="ITerm144">
                        
                        
                        
                      </span></div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 12-10</span><p class="SimplePara">Creating a JSON Merge Patch Based on Differences Between a Source and a <span id="ITerm145">Target</span><span id="ITerm146">
                          
                          
                          
                        </span></p></div></div></div></div><p class="Para" id="Par141">It鈥檚 necessary to invoke <span class="EmphasisFontCategoryNonProportional ">toJsonValue()</span> on the <span class="EmphasisFontCategoryNonProportional ">JsonMergePatch</span> returned from <span class="EmphasisFontCategoryNonProportional ">createMergeDiff()</span> in order to see a JSON document as the output.</p><div class="Para" id="Par142">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC35">12-10</a></span> and run the application. You should observe the following output:<div class="ProgramCode" id="PC36"><div class="LineGroup"><div class="FixedLine">{&quot;age&quot;:30,&quot;phoneNumbers&quot;:[{&quot;type&quot;:&quot;fax&quot;,&quot;number&quot;:&quot;310 555-4567&quot;},{&quot;type&quot;:&quot;cell&quot;,&quot;number&quot;:&quot;123 456-7890&quot;}]}<span id="ITerm147">
                        
                        
                        
                      </span></div></div></div></div></section><section class="Section2 RenderAsSection2" id="Sec12"><h3 class="Heading">Editing/Transformation Operations</h3><p class="Para" id="Par143">The JSON object model supports immutable JSON <span id="ITerm148">objects</span> and arrays, which makes these entities thread-safe. Because you cannot modify them, you would manually copy each of the properties of the JSON object/array into a <span class="EmphasisFontCategoryNonProportional ">JsonObjectBuilder</span> or <span class="EmphasisFontCategoryNonProportional ">JsonArrayBuilder</span> and then modify the entity, which is a rather tedious task. Thankfully, JSON-P 1.1 alleviates the tedium by adding editing/transformation operations to <span class="EmphasisFontCategoryNonProportional ">JsonArrayBuilder</span> and <span class="EmphasisFontCategoryNonProportional ">JsonObjectBuilder</span>.</p><div class="Para" id="Par144"><span class="EmphasisFontCategoryNonProportional ">JsonArrayBuilder</span> has received several <span class="EmphasisFontCategoryNonProportional ">add(int index, ...)</span> methods for adding a value between array elements, several <span class="EmphasisFontCategoryNonProportional ">set(int index, ...)</span> methods for updating an existing element, and a <span class="EmphasisFontCategoryNonProportional ">remove()</span> method for removing an element. <span class="EmphasisFontCategoryNonProportional ">JsonObjectBuilder</span> has received a <span class="EmphasisFontCategoryNonProportional ">remove()</span> method for removing a name/value pair. Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC37">12-11</a></span> presents the source code to an application that demonstrates some of these <span id="ITerm149">methods</span>.<div class="ProgramCode" id="PC37"><div class="LineGroup"><div class="FixedLine">import java.util.ArrayList;</div><div class="FixedLine">import java.util.Arrays;</div><div class="FixedLine">import java.util.HashMap;</div><div class="FixedLine">import java.util.List;</div><div class="FixedLine">import java.util.Map;</div></div><div class="LineGroup"><div class="FixedLine">import javax.json.Json;</div><div class="FixedLine">import javax.json.JsonObject;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class JSONPDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      List&lt;String&gt; planets =</div><div class="FixedLine">         Arrays.asList(&quot;Mercury&quot;, &quot;Venus&quot;, &quot;Terra&quot;, &quot;Mars&quot;,</div><div class="FixedLine">                       &quot;Jupiter&quot;, &quot;Saturn&quot;, &quot;Uranus&quot;,</div><div class="FixedLine">                       &quot;Pluto&quot;);</div><div class="FixedLine">      out.println(Json.createArrayBuilder(planets)</div><div class="FixedLine">                      .remove(7)</div><div class="FixedLine">                      .set(2, &quot;Earth&quot;)</div><div class="FixedLine">                      .add(&quot;Neptune&quot;)</div><div class="FixedLine">                      .build());</div></div><div class="LineGroup"><div class="FixedLine">      Map&lt;String, Object&gt; employees = new HashMap&lt;&gt;()<span id="ITerm150">
                        
                        
                        
                      </span>;</div><div class="FixedLine">      employees.put(&quot;John Doe&quot;, 42);</div><div class="FixedLine">      employees.put(&quot;Jill Smith&quot;, 38);</div><div class="FixedLine">      employees.put(&quot;Bonnie Barnes&quot;, 26);</div><div class="FixedLine">      JsonObject employees_ =</div><div class="FixedLine">         Json.createObjectBuilder(employees)</div><div class="FixedLine">             .remove(&quot;Jill Smith&quot;)</div><div class="FixedLine">             .build();</div><div class="FixedLine">      out.println(employees_);</div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 12-11</span><p class="SimplePara">Demonstrating Assorted <span id="ITerm151">Editing/Transformation Operations</span></p></div></div></div></div><p class="Para" id="Par145">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC37">12-11</a></span> first demonstrates editing/transformation in an array builder context. A list of planet names is constructed, and this list is passed to <span class="EmphasisFontCategoryNonProportional ">Json</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">JsonArrayBuilder createArrayBuilder(Collection&lt;?&gt; collection) static</span> method. Various editing/transformation method calls are chained to <span class="EmphasisFontCategoryNonProportional ">createArrayBuilder()</span> to remove <span class="EmphasisFontCategoryNonProportional ">Pluto</span> (which is no longer officially a planet), change <span class="EmphasisFontCategoryNonProportional ">Terra</span> to <span class="EmphasisFontCategoryNonProportional ">Earth</span>, and add <span class="EmphasisFontCategoryNonProportional ">Neptune</span>. The <span class="EmphasisFontCategoryNonProportional ">build()</span> call returns a <span class="EmphasisFontCategoryNonProportional ">JsonArray</span>, which is printed to standard output.</p><p class="Para" id="Par146">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC37">12-11</a></span> next demonstrates editing/transformation in an object builder context. A map of employee names and ages is constructed, and this map is passed to <span class="EmphasisFontCategoryNonProportional ">Json</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">JsonObjectBuilder createObjectBuilder(Map&lt;String, Object&gt; map) static</span> method. A <span class="EmphasisFontCategoryNonProportional ">remove()</span> method call is chained to <span class="EmphasisFontCategoryNonProportional ">createObjectBuilder()</span> to remove <span class="EmphasisFontCategoryNonProportional ">Jill Smith</span>. The <span class="EmphasisFontCategoryNonProportional ">build()</span> call returns a <span class="EmphasisFontCategoryNonProportional ">JsonObject</span>, which is printed to standard output.</p><div class="Para" id="Par147">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC37">12-11</a></span> and run the application. You should observe the following output:<div class="ProgramCode" id="PC38"><div class="LineGroup"><div class="FixedLine">[&quot;Mercury&quot;,&quot;Venus&quot;,&quot;Earth&quot;,&quot;Mars&quot;,&quot;Jupiter&quot;,&quot;Saturn&quot;,&quot;Uranus&quot;,&quot;Neptune&quot;]</div><div class="FixedLine">{&quot;John Doe&quot;:42,&quot;Bonnie Barnes&quot;:26}<span id="ITerm152">
                        
                        
                        
                      </span></div></div></div></div></section><section class="Section2 RenderAsSection2" id="Sec13"><h3 class="Heading">Java SE 8 Support</h3><div class="Para" id="Par148">Queries on a JSON object <span id="ITerm153">model</span><span id="ITerm154">
                  
                  
                </span> are currently possible via Java SE 8鈥檚 stream operations and lambda expressions. To make them truly useful and convenient, JSON-P 1.1 introduced a <span class="EmphasisFontCategoryNonProportional ">JsonCollectors</span> class whose <span class="EmphasisFontCategoryNonProportional ">static</span> collector methods return <span class="EmphasisFontCategoryNonProportional ">JSONObject</span>s or <span class="EmphasisFontCategoryNonProportional ">JsonArray</span>s instead of <span class="EmphasisFontCategoryNonProportional ">Map</span>s or <span class="EmphasisFontCategoryNonProportional ">List</span>s. For example, consider the following collector method:<div class="ProgramCode" id="PC39"><div class="LineGroup"><div class="FixedLine">Collector&lt;JsonValue,JsonObjectBuilder,JsonObject&gt;</div><div class="FixedLine">   toJsonObject(Function&lt;jsonValue,String&gt; keyMapper,</div><div class="FixedLine">                Function&lt;JsonValue,JsonValue&gt; valueMapper)</div></div></div></div><p class="Para" id="Par149">This <span class="EmphasisFontCategoryNonProportional ">toJsonObject()</span> collector <span id="ITerm155">method</span> constructs a <span class="EmphasisFontCategoryNonProportional ">java.util.stream.Collector</span> that accumulates the input <span class="EmphasisFontCategoryNonProportional ">JsonValue</span> elements into a <span class="EmphasisFontCategoryNonProportional ">JsonObject</span>. The name/value pairs of the <span class="EmphasisFontCategoryNonProportional ">JsonObject</span> are computed by applying the provided <span class="EmphasisFontCategoryNonProportional ">keyMapper</span> and <span class="EmphasisFontCategoryNonProportional ">valueMapper</span> mapping functions.</p><div class="Para" id="Par150">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC40">12-12</a></span> presents the source code to an application that demonstrates this collector method.<div class="ProgramCode" id="PC40"><div class="LineGroup"><div class="FixedLine">import javax.json.Json;</div><div class="FixedLine">import javax.json.JsonArray;</div><div class="FixedLine">import javax.json.JsonObject;</div></div><div class="LineGroup"><div class="FixedLine">import javax.json.stream.JsonCollectors;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class JSONPDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">   {</div><div class="FixedLine">      JsonArray employees;</div><div class="FixedLine">      employees = Json.createArrayBuilder()</div><div class="FixedLine">                      .add(Json.createObjectBuilder()</div><div class="FixedLine">                               .add(&quot;name&quot;, &quot;John&quot;)</div><div class="FixedLine">                               .add(&quot;age&quot;, 42))</div><div class="FixedLine">                      .add(Json.createObjectBuilder()</div><div class="FixedLine">                               .add(&quot;name&quot;, &quot;Joan&quot;)</div><div class="FixedLine">                               .add(&quot;age&quot;, 28))</div><div class="FixedLine">                      .add(Json.createObjectBuilder()</div><div class="FixedLine">                               .add(&quot;name&quot;, &quot;Trevor&quot;)</div><div class="FixedLine">                               .add(&quot;age&quot;, 35))</div><div class="FixedLine">                      .add(Json.createObjectBuilder()</div><div class="FixedLine">                               .add(&quot;name&quot;, &quot;Sally&quot;)</div><div class="FixedLine">                               .add(&quot;age&quot;, 49))</div><div class="FixedLine">                      .add(Json.createObjectBuilder()</div><div class="FixedLine">                               .add(&quot;name&quot;, &quot;Frank&quot;)</div><div class="FixedLine">                               .add(&quot;age&quot;, 26))</div><div class="FixedLine">                      .build();<span id="ITerm156">
                        
                        
                      </span></div><div class="FixedLine">      out.println(employees);</div><div class="FixedLine">      out.println();</div><div class="FixedLine">      JsonObject result =</div><div class="FixedLine">      employees.getValuesAs(JsonObject.class)</div><div class="FixedLine">               .stream()</div><div class="FixedLine">               .filter(x -&gt; x.getInt(&quot;age&quot;) &gt; 40)</div><div class="FixedLine">               .collect(JsonCollectors.</div><div class="FixedLine">                        toJsonObject(x -&gt;</div><div class="FixedLine">                                     x.asJsonObject()</div><div class="FixedLine">                                      .getString(&quot;name&quot;),</div><div class="FixedLine">                                     x -&gt;</div><div class="FixedLine">                                     x.asJsonObject()</div><div class="FixedLine">                                      .get(&quot;age&quot;)));</div><div class="FixedLine">      out.println(result); <span id="ITerm157">
                        
                        
                        
                      </span><span id="ITerm158">
                        
                        
                        
                      </span></div><div class="FixedLine">   }</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 12-12</span><p class="SimplePara">Demonstrating a JSON-P <span id="ITerm159">Collector</span><span id="ITerm160">
                          
                          
                          
                        </span></p></div></div></div></div><p class="Para" id="Par151">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC40">12-12</a></span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">main()</span> method first creates a JSON array of employee objects where each object consists of a name and an age. After outputting the array, it returns a list view of the array, obtains a stream with the list view as the source, installs (on the stream) a filter that accepts only those entries whose age exceeds 40, and installs (on the stream) a collector that accumulates results into a JSON object. The results are accumulated and <span id="ITerm161">output</span><span id="ITerm162">
                  
                  
                </span>.</p><p class="Para" id="Par152"><span class="EmphasisFontCategoryNonProportional ">asJsonObject()</span> is a <span class="EmphasisFontCategoryNonProportional ">JsonValue</span> method that returns the invoking <span class="EmphasisFontCategoryNonProportional ">JsonValue</span> as a <span class="EmphasisFontCategoryNonProportional ">JsonObject</span>. Although it鈥檚 possible to invoke <span class="EmphasisFontCategoryNonProportional ">getString(&quot;name&quot;)</span> on the <span class="EmphasisFontCategoryNonProportional ">JsonObject</span>, it鈥檚 not possible to invoke <span class="EmphasisFontCategoryNonProportional ">getInt(&quot;age&quot;)</span> because <span class="EmphasisFontCategoryNonProportional ">getInt()</span> returns a primitive <span class="EmphasisFontCategoryNonProportional ">int</span> value instead of an <span class="EmphasisFontCategoryNonProportional ">Integer</span> object. For this reason, the code invokes <span class="EmphasisFontCategoryNonProportional ">JsonObject</span>鈥檚 inherited <span class="EmphasisFontCategoryNonProportional ">get()</span> method from the <span class="EmphasisFontCategoryNonProportional ">Map</span> ancestor type.</p><div class="FormalPara FormalParaRenderingStyle1 ParaTypeImportant" id="FPar4"><h3 class="Heading">Note</h3><p class="Para" id="Par153"><span class="EmphasisFontCategoryNonProportional ">JsonValue</span> also conveniently provides an <span class="EmphasisFontCategoryNonProportional ">asJsonArray()</span> method that returns the invoking <span class="EmphasisFontCategoryNonProportional ">JsonValue</span> as a <span class="EmphasisFontCategoryNonProportional ">JsonArray</span>.</p></div><div class="Para" id="Par154">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC40">12-12</a></span> and run the application. You should observe the following output:<div class="ProgramCode" id="PC41"><div class="LineGroup"><div class="FixedLine">[{&quot;name&quot;:&quot;John&quot;,&quot;age&quot;:42},{&quot;name&quot;:&quot;Joan&quot;,&quot;age&quot;:28},{&quot;name&quot;:&quot;Trevor&quot;,&quot;age&quot;:35},{&quot;name&quot;:&quot;Sally&quot;,&quot;age&quot;:49},{&quot;name&quot;:&quot;Frank&quot;,&quot;age&quot;:26}]</div></div><div class="LineGroup"><div class="FixedLine">{&quot;John&quot;:42,&quot;Sally&quot;:49}<span id="ITerm163">
                        
                        
                      </span></div></div></div></div><p class="Para" id="Par155">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC40">12-12</a></span> reveals <span class="EmphasisFontCategoryNonProportional ">JsonArray</span>鈥檚 <span class="EmphasisFontCategoryNonProportional ">&lt;T extends JsonValue&gt; List&lt;T&gt; getValuesAs(Class&lt;T&gt; clazz)</span> method, which returns a list view of the specified type for the array. This method has been present since JSON-P 1.0. However, JSON-P 1.1 introduced the more functional <span class="EmphasisFontCategoryNonProportional ">&lt;T,K extends JsonValue&gt; List&lt;T&gt; getValuesAs(Function&lt;K,T&gt; func)</span> default method, which can accept a lambda or method reference argument鈥擩ava SE 8 introduced default <span id="ITerm164">methods</span>.</p><p class="Para" id="Par156">JSON-P 1.1鈥檚 <span class="EmphasisFontCategoryNonProportional ">JsonParser</span> class has been upgraded to support Java SE 8 by including the <span class="EmphasisFontCategoryNonProportional ">Stream&lt;JsonValue&gt; getArrayStream()</span> and <span class="EmphasisFontCategoryNonProportional ">Stream&lt;Map.Entry&lt;String,JsonValue&gt;&gt; getObjectStream()</span> default methods. When called, <span class="EmphasisFontCategoryNonProportional ">getArrayStream()</span> returns a stream of <span class="EmphasisFontCategoryNonProportional ">JsonArray</span> elements, and <span class="EmphasisFontCategoryNonProportional ">getObjectStream()</span> returns a stream of <span class="EmphasisFontCategoryNonProportional ">JsonObject</span> name/value pairs.</p><div class="Para" id="Par157">The combination of <span class="EmphasisFontCategoryNonProportional ">JsonParser</span>鈥檚 parsing methods along with <span class="EmphasisFontCategoryNonProportional ">getArrayStream()</span> or <span class="EmphasisFontCategoryNonProportional ">getObjectStream()</span> offers an efficient alternative to attempting to read a very large JSON document into memory (which might not fit). For example, suppose a public library contains a JSON document that itemizes all of its books in terms of ISBN, title, and state (available or loaned). Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC42">12-13</a></span> presents a sample <span id="ITerm165">document</span><span id="ITerm166">
                  
                  
                </span>.<div class="ProgramCode" id="PC42"><div class="LineGroup"><div class="FixedLine">[</div><div class="FixedLine">   {</div><div class="FixedLine">      &quot;isbn&quot;: &quot;1234567890&quot;,</div><div class="FixedLine">      &quot;title&quot;: &quot;Sample Book 1&quot;,</div><div class="FixedLine">      &quot;state&quot;: &quot;avail&quot;</div><div class="FixedLine">   },</div><div class="FixedLine">   {</div><div class="FixedLine">      &quot;isbn&quot;: &quot;2342340324&quot;,</div><div class="FixedLine">      &quot;title&quot;: &quot;Sample Book 2&quot;,</div><div class="FixedLine">      &quot;state&quot;: &quot;loaned&quot;</div><div class="FixedLine">   },</div><div class="FixedLine">   {</div><div class="FixedLine">      &quot;isbn&quot;: &quot;2342069340&quot;,</div><div class="FixedLine">      &quot;title&quot;: &quot;Sample Book 3&quot;,</div><div class="FixedLine">      &quot;state&quot;: &quot;avail&quot;</div><div class="FixedLine">   },</div><div class="FixedLine">   {</div><div class="FixedLine">      &quot;isbn&quot;: &quot;5940045033&quot;,</div><div class="FixedLine">      &quot;title&quot;: &quot;Sample Book 4&quot;,</div><div class="FixedLine">      &quot;state&quot;: &quot;avail&quot;</div><div class="FixedLine">   },</div><div class="FixedLine">   {</div><div class="FixedLine">      &quot;isbn&quot;: &quot;2394094699&quot;,</div><div class="FixedLine">      &quot;title&quot;: &quot;Sample Book 5&quot;,</div><div class="FixedLine">      &quot;state&quot;: &quot;loaned&quot;</div><div class="FixedLine">   },</div><div class="FixedLine">   {</div><div class="FixedLine">      &quot;isbn&quot;: &quot;3566433454&quot;,</div><div class="FixedLine">      &quot;title&quot;: &quot;Sample Book 6&quot;,</div><div class="FixedLine">      &quot;state&quot;: &quot;avail&quot;</div><div class="FixedLine">   },</div><div class="FixedLine">   {</div><div class="FixedLine">      &quot;isbn&quot;: &quot;6990349039&quot;,</div><div class="FixedLine">      &quot;title&quot;: &quot;Sample Book 7&quot;,</div><div class="FixedLine">      &quot;state&quot;: &quot;avail&quot;</div><div class="FixedLine">   },</div><div class="FixedLine">   {</div><div class="FixedLine">      &quot;isbn&quot;: &quot;5695695690&quot;,</div><div class="FixedLine">      &quot;title&quot;: &quot;Sample Book 8&quot;,</div><div class="FixedLine">      &quot;state&quot;: &quot;avail&quot;</div><div class="FixedLine">   }</div><div class="FixedLine">]</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 12-13</span><p class="SimplePara">A Sample Library JSON <span id="ITerm167">Document</span></p></div></div></div></div><div class="Para" id="Par158">Suppose it鈥檚 necessary to print the first five books whose state is avail(able). The entire document, which could grow very large, doesn鈥檛 need to be read into memory. It鈥檚 only necessary to read book objects one by one until the first five available books have been printed. Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC43">12-14</a></span> presents the source code to an application that uses <span class="EmphasisFontCategoryNonProportional ">JsonParser</span> along with <span class="EmphasisFontCategoryNonProportional ">getArrayStream()</span> and various stream operations to accomplish this task. <span id="ITerm168">
                  
                  
                  
                </span><span id="ITerm169">
                  
                  
                </span><span id="ITerm170">
                  
                  
                  
                </span><div class="ProgramCode" id="PC43"><div class="LineGroup"><div class="FixedLine">import java.io.FileReader;</div><div class="FixedLine">import java.io.FileNotFoundException;</div></div><div class="LineGroup"><div class="FixedLine">import javax.json.Json;</div></div><div class="LineGroup"><div class="FixedLine">import javax.json.stream.JsonParser;</div></div><div class="LineGroup"><div class="FixedLine">import static java.lang.System.*;</div></div><div class="LineGroup"><div class="FixedLine">public class JSONPDemo</div><div class="FixedLine">{</div><div class="FixedLine">   public static void main(String[] args)</div><div class="FixedLine">      throws FileNotFoundException</div><div class="FixedLine">   {</div><div class="FixedLine">      if (args.length != 1) <span id="ITerm171">
                        
                        
                        
                      </span></div><div class="FixedLine">      {</div><div class="FixedLine">         err.println(&quot;usage: java JSONPDemo filespec&quot;);</div><div class="FixedLine">         return;</div><div class="FixedLine">      }</div><div class="FixedLine">      JsonParser parser =</div><div class="FixedLine">         Json.createParser(new FileReader(args[0]));</div><div class="FixedLine">      while (parser.hasNext())</div><div class="FixedLine">         if (parser.next() == JsonParser.Event.START_ARRAY)</div><div class="FixedLine">         {</div><div class="FixedLine">            parser.getArrayStream()</div><div class="FixedLine">                  // convert to Stream&lt;JsonObject&gt;</div><div class="FixedLine">                  .map(v -&gt; v.asJsonObject())</div><div class="FixedLine">                  .filter(obj -&gt; obj.getString(&quot;state&quot;)</div><div class="FixedLine">                                    .equals(&quot;avail&quot;))</div><div class="FixedLine">                  .limit(5)</div><div class="FixedLine">                  .forEach(obj -&gt;</div><div class="FixedLine">                           out.printf(&quot;ISBN: %s, &quot; +</div><div class="FixedLine">                                      &quot;TITLE: %s%n%n&quot;,</div><div class="FixedLine">                                      obj.getString(&quot;isbn&quot;),</div><div class="FixedLine">                                   obj.getString(&quot;title&quot;)));</div></div><div class="LineGroup"><div class="FixedLine">            // skip the rest of the JsonArray<span id="ITerm172">
                        
                        
                      </span></div></div><div class="LineGroup"><div class="FixedLine">            parser.skipArray();</div><div class="FixedLine">         }</div><div class="FixedLine">   }</div><div class="FixedLine">}<span id="ITerm173">
                        
                        
                        
                      </span></div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 12-14</span><p class="SimplePara">Efficiently Processing a Potentially Large JSON <span id="ITerm174">Document</span></p></div></div></div></div><p class="Para" id="Par159"><span class="EmphasisFontCategoryNonProportional ">JsonParser</span> offers <span class="EmphasisFontCategoryNonProportional ">void skipArray()</span> and <span class="EmphasisFontCategoryNonProportional ">void skipObject()</span> methods that skip tokens and advance the parser to <span class="EmphasisFontCategoryNonProportional ">END_ARRAY</span> or <span class="EmphasisFontCategoryNonProportional ">END_OBJECT</span>, respectively.</p><div class="Para" id="Par160">Compile Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml#PC43">12-14</a></span> and run the application. You should observe the following output:<div class="ProgramCode" id="PC44"><div class="LineGroup"><div class="FixedLine">ISBN: 1234567890, TITLE: Sample Book 1</div></div><div class="LineGroup"><div class="FixedLine">ISBN: 2342069340, TITLE: Sample Book 3</div></div><div class="LineGroup"><div class="FixedLine">ISBN: 5940045033, TITLE: Sample Book 4</div></div><div class="LineGroup"><div class="FixedLine">ISBN: 3566433454, TITLE: Sample Book 6</div></div><div class="LineGroup"><div class="FixedLine">ISBN: 6990349039, TITLE: Sample Book 7<span id="ITerm175">
                        
                        
                        
                      </span><span id="ITerm176">
                        
                        
                      </span></div></div></div></div><div class="FormalPara FormalParaRenderingStyle3 ParaTypeOverview" id="FPar5"><h3 class="Heading">Exercises</h3><div class="Para" id="Par161">The following exercises are designed to test your understanding of Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/java-xml-and/9781484243305/html/394211_2_En_12_Chapter.xhtml"><span class="RefSource">12</span></a></span>鈥檚 content:<div class="OrderedList"><ol><li class="ListItem"><span class="ItemNumber">1.</span><div class="ItemContent"><p class="Para" id="Par162">Define JSON-P.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">2.</span><div class="ItemContent"><p class="Para" id="Par163">Describe JSON-P 1.0鈥檚 package structure.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">3.</span><div class="ItemContent"><p class="Para" id="Par164">Identify the types for creating <span class="EmphasisFontCategoryNonProportional ">JsonArray</span> and <span class="EmphasisFontCategoryNonProportional ">JsonObject</span> models.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">4.</span><div class="ItemContent"><p class="Para" id="Par165">Which type is the superinterface of interface types that represent immutable JSON values?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">5.</span><div class="ItemContent"><p class="Para" id="Par166">In what ways does JSON-P 1.1 differ from JSON-P 1.0?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">6.</span><div class="ItemContent"><p class="Para" id="Par167">True or false: JSON-P 1.0鈥檚 streaming model is more flexible than its object model.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">7.</span><div class="ItemContent"><p class="Para" id="Par168">How do you construct a <span class="EmphasisFontCategoryNonProportional ">JsonObject</span> model?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">8.</span><div class="ItemContent"><p class="Para" id="Par169">What types does the streaming model provide to read and write JSON content?</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">9.</span><div class="ItemContent"><p class="Para" id="Par170">Describe JSON Merge Patch.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">10.</span><div class="ItemContent"><p class="Para" id="Par171">Identify the editing/transformation operations that have been added to <span class="EmphasisFontCategoryNonProportional ">JsonArrayBuilder</span> and <span class="EmphasisFontCategoryNonProportional ">JsonObjectBuilder</span>.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">11.</span><div class="ItemContent"><p class="Para" id="Par172">True or false: JSON-P 1.1 introduced a <span class="EmphasisFontCategoryNonProportional ">JsonCollectors</span> class whose <span class="EmphasisFontCategoryNonProportional ">static</span> collector methods return <span class="EmphasisFontCategoryNonProportional ">JSONObject</span>s or <span class="EmphasisFontCategoryNonProportional ">JsonArray</span>s instead of <span class="EmphasisFontCategoryNonProportional ">Map</span>s or <span class="EmphasisFontCategoryNonProportional ">List</span>s.</p></div><div class="ClearBoth"> </div></li><li class="ListItem"><span class="ItemNumber">12.</span><div class="ItemContent"><p class="Para" id="Par173">Write a <span class="EmphasisFontCategoryNonProportional ">JSONPDemo</span> application that takes two command-line arguments: the name of a JSON document file and a JSON Pointer. The application should read the file into a <span class="EmphasisFontCategoryNonProportional ">JsonObject</span> model (assume that every JSON document file defines an object). The application should then create a <span class="EmphasisFontCategoryNonProportional ">JsonPointer</span> for the JSON Pointer argument and apply the <span class="EmphasisFontCategoryNonProportional ">JsonPointer</span> instance to the <span class="EmphasisFontCategoryNonProportional ">JsonObject</span>, outputting the result. Hint: Refer to the 鈥淛SON Pointer鈥?section for an example JSON document and sample JSON Pointers that access different document members.</p></div><div class="ClearBoth"> </div></li></ol></div></div></div></section></section><section class="Section1 RenderAsSection1" id="Sec14"><h2 class="Heading">Summary</h2><p class="Para" id="Par174">JSON Processing (JSON-P) is a Java API for processing (i.e., parsing, generating, querying, and transforming) JSON content.</p><p class="Para" id="Par175">JSON-P 1.0 processes JSON content via an object model or a streaming model. The object model lets JSON-P build a tree of objects for JSON text via API classes similarly to Java鈥檚 DOM API for XML. The streaming model lets JSON-P produce and consume JSON text similarly to Java鈥檚 StAX API for XML.</p><p class="Para" id="Par176">JSON-P 1.0 consists of 25 types located in package <span class="EmphasisFontCategoryNonProportional ">javax.json</span>, along with the support packages <span class="EmphasisFontCategoryNonProportional ">javax.json.spi</span> and <span class="EmphasisFontCategoryNonProportional ">javax.json.stream</span>. The <span class="EmphasisFontCategoryNonProportional ">javax.json</span> package mainly contains types that support the object model, the <span class="EmphasisFontCategoryNonProportional ">javax.json.spi</span> package contains a single type that describes a service provider for JSON processing objects, and the <span class="EmphasisFontCategoryNonProportional ">javax.json.stream</span> package contains types that support the streaming model.</p><p class="Para" id="Par177">JSON-P 1.1 also supports JSON Pointer, JSON Patch, and JSON Merge Patch. Additionally, the new version introduces editing/transformation operations to JSON array and object builders and updates the API to better support Java SE 8 stream operations (including JSON-specific collectors).</p><p class="Para" id="Par178">JSON-P 1.1 consists of the same packages as JSON-P 1.0 but increases the number of types to 31.</p><p class="Para" id="Par179">JSON Pointer defines a Unicode-string-syntax for identifying a specific value in a JSON document. JSON Patch defines a JSON document structure for expressing a sequence of operations to apply to another JSON document (and also makes use of JSON Pointer). JSON Merge Patch is similar to JSON Patch in that it鈥檚 also used to change another JSON document鈥檚 structure. However, the syntax of the JSON Merge Patch JSON document more closely mimics the syntax of the JSON document that鈥檚 being changed.</p><p class="Para" id="Par180">Several editing/transformation operations have been introduced to <span class="EmphasisFontCategoryNonProportional ">JsonArrayBuilder</span> and <span class="EmphasisFontCategoryNonProportional ">JsonObjectBuilder</span>. <span class="EmphasisFontCategoryNonProportional ">JsonArrayBuilder</span> has received several <span class="EmphasisFontCategoryNonProportional ">add(int index, ...)</span> methods for adding a value between array elements, several <span class="EmphasisFontCategoryNonProportional ">set(int index, ...)</span> methods for updating an existing element, and a <span class="EmphasisFontCategoryNonProportional ">remove()</span> method for removing an element. <span class="EmphasisFontCategoryNonProportional ">JsonObjectBuilder</span> has received a <span class="EmphasisFontCategoryNonProportional ">remove()</span> method for removing a name/value pair.</p><p class="Para" id="Par181">Queries on a JSON object model are currently possible via Java SE 8鈥檚 stream operations and lambda expressions. To make them truly useful and convenient, JSON-P 1.1 introduced a <span class="EmphasisFontCategoryNonProportional ">JsonCollectors</span> class whose <span class="EmphasisFontCategoryNonProportional ">static</span> collector methods return <span class="EmphasisFontCategoryNonProportional ">JSONObject</span>s or <span class="EmphasisFontCategoryNonProportional ">JsonArray</span>s instead of <span class="EmphasisFontCategoryNonProportional ">Map</span>s or <span class="EmphasisFontCategoryNonProportional ">List</span>s.</p><p class="Para" id="Par182">Appendix A presents the answers to each chapter鈥檚 exercises.</p></section></div><div class="annotator-outer annotator-viewer viewer annotator-hide"> </div></div></div>
    </section>
  </div>
</div>
<iframe allowtransparency="true" frameborder="0" scrolling="no" src="cid:frame-251B1CF282FDD06D65BC31C1471018D8@mhtml.blink" style="display: none;" title="Twitter settings iframe"></iframe></body></html>
