<!--if IE]><![endif]--><!DOCTYPE html><!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/java-in-a/9781492037248/part01.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="3866890"
  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"
  data-username="levinxccai"
  data-account-type="B2B"
  
  data-activated-trial-date="11/06/2017"


  data-archive="9781492037248"
  data-publishers="O&#39;Reilly Media, Inc."



  data-htmlfile-name="part01.html"
  data-epub-title="Java in a Nutshell, 7th Edition" data-debug=0 data-testing=0><![endif]--><!--if gt IE 8]><!--><html class="js flexbox flexboxlegacy no-touch websqldatabase indexeddb history csscolumns csstransforms localstorage sessionstorage applicationcache svg inlinesvg zoom fa-events-icons-ready gr__learning_oreilly_com" data-account-type="B2B" data-activated-trial-date="11/06/2017" data-archive="9781492037248" data-csrf-cookie="csrfsafari" data-debug="0" data-epub-title="Java in a Nutshell, 7th Edition" data-highlight-privacy="" data-htmlfile-name="part01.html" data-login-url="/accounts/login/" data-offline-url="/" data-publishers="O&apos;Reilly Media, Inc." data-testing="0" data-url="/library/view/java-in-a/9781492037248/part01.html" data-user-id="3866890" data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca" data-username="levinxccai" itemscope="" itemtype="http://schema.org/Book http://schema.org/ItemPage" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#" style=""><!--![endif]--><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><link href="cid:css-766d06d7-1258-40a0-b203-221f3a2235dc@mhtml.blink" rel="stylesheet" type="text/css"/><link href="cid:css-38a6c455-7c8c-412b-8be9-891330760f60@mhtml.blink" rel="stylesheet" type="text/css"/><link href="cid:css-1b7273f0-9f4b-445c-8f97-57db77d2a909@mhtml.blink" rel="stylesheet" type="text/css"/><link href="cid:css-f0614c37-f249-4f24-b31d-25e2edbbac73@mhtml.blink" rel="stylesheet" type="text/css"/><link href="cid:css-10f13fd2-7493-4a4f-80f7-459e20f9b39a@mhtml.blink" rel="stylesheet" type="text/css"/><link href="cid:css-43e19ce4-481f-444f-8d40-ee62195e2768@mhtml.blink" rel="stylesheet" type="text/css"/><link href="cid:css-4e4a1bb6-5c21-4b87-b075-ffd5aeceb868@mhtml.blink" rel="stylesheet" type="text/css"/><link href="cid:css-20354fc4-3496-4af5-84db-8014f8e7e08b@mhtml.blink" rel="stylesheet" type="text/css"/><link href="cid:css-cd3a2938-978b-4e03-b503-a3d4690a505b@mhtml.blink" rel="stylesheet" type="text/css"/><link href="cid:css-fd9a5471-d58a-4d4a-a48a-3f36630707d0@mhtml.blink" rel="stylesheet" type="text/css"/><link href="cid:css-8ff843ca-dd36-49be-9fdb-81aae00fe5db@mhtml.blink" rel="stylesheet" type="text/css"/><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"/><meta content="Safari Books Online" name="author"/><meta content="telephone=no" name="format-detection"/><meta content="on" http-equiv="cleartype"/><meta content="True" name="HandheldFriendly"/><meta content="320" name="MobileOptimized"/><meta content="app-id=881697395, app-argument=safaridetail://9781492037248" name="apple-itunes-app"/><meta content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0" name="viewport"/><meta content="4503599627559754" property="twitter:account_id"/><link href="https://learning.oreilly.com/static/images/apple-touch-icon.0c29511d2d72.png" rel="apple-touch-icon"/><link href="https://learning.oreilly.com/favicon.ico" rel="shortcut icon" type="image/x-icon"/><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900,200italic,300italic,400italic,600italic,700italic,900italic" rel="stylesheet" type="text/css"/><title>ch007-part01</title><link href="https://learning.oreilly.com/static/CACHE/css/output.8054605313ed.css" rel="stylesheet" type="text/css"/><link href="https://learning.oreilly.com/static/css/annotator.e3b0c44298fc.css" rel="stylesheet" type="text/css"/><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet"/><link href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/part01.html" rel="canonical"/><meta content=" Part I. Introducing Java Part I is an introduction to the Java language and the Java platform. These chapters provide enough information for you to get started using Java right ... " name="description"/><meta content="I. Introducing Java" property="og:title"/><meta content="/library/view/java-in-a/9781492037248/" itemprop="isPartOf"/><meta content="I. Introducing Java" itemprop="name"/><meta content="https://learning.oreilly.com/library/view/java-in-a/9781492037248/part01.html" itemprop="url" property="og:url"/><meta content="Safari" property="og:site_name"/><meta content="https://learning.oreilly.com/library/cover/9781492037248/" itemprop="thumbnailUrl" property="og:image"/><meta content=" Part I. Introducing Java Part I is an introduction to the Java language and the Java platform. These chapters provide enough information for you to get started using Java right ... " itemprop="description" property="og:description"/><meta content="en" itemprop="inLanguage"/><meta content="O&apos;Reilly Media, Inc." itemprop="publisher"/><meta content="book" property="og:type"/><meta content="9781492037255" itemprop="isbn" property="og:book:isbn"/><meta content="David Flanagan" itemprop="author" property="og:book:author"/><meta content="Ben Evans" itemprop="author" property="og:book:author"/><meta content="summary" name="twitter:card"/><meta content="@safari" name="twitter:site"/><link href="https://use.fontawesome.com/840a321d95.css" media="all" rel="stylesheet"/></head>


<body class="reading sidenav nav-collapsed  scalefonts day-mode library" data-gr-c-s-loaded="true">
<a name="1_"></a>

<div class="application" id="container" style="height: auto;">
  <div class="js-toc">
    <section role="document">
      <div id="sbo-rt-content" style="max-width:72.5em; transform: none;"><div class="annotator-wrapper"><div class="pagenumrestart" data-pdf-bookmark="Part I. Introducing Java" data-type="part" epub:type="part" id="javanut-PART-1">
<h1><span class="label">Part I. </span>Introducing Java</h1>


<p>Part I is an introduction to the Java language and the Java platform.
These chapters provide enough information for you to get started using
Java right away:</p>
<ul class="simplelist">
   <li><a data-type="xref" data-xrefstyle="chap-num-title" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch01.html#javanut7-CHP-1">Chapter 1, <em>Introduction to the Java Environment</em></a></li>
   <li><a data-type="xref" data-xrefstyle="chap-num-title" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2">Chapter 2, <em>Java Syntax from the Ground Up</em></a></li>
   <li><a data-type="xref" data-xrefstyle="chap-num-title" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3">Chapter 3, <em>Object-Oriented Programming <span class="keep-together">in Java</span></em></a></li>
   <li><a data-type="xref" data-xrefstyle="chap-num-title" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4">Chapter 4, <em>The Java Type System</em></a></li>
   <li><a data-type="xref" data-xrefstyle="chap-num-title" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch05.html#javanut7-CHP-5">Chapter 5, <em>Introduction to Object-Oriented Design in Java</em></a></li>
   <li><a data-type="xref" data-xrefstyle="chap-num-title" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch06.html#javanut7-CHP-6">Chapter 6, <em>Java鈥檚 Approach to Memory <span class="keep-together">and Concurrency</span></em></a></li>
</ul>
      </div>
      </div></div>
    </section>
  </div>
</div>
<div class="font-flyout"> </div>
<hr/>

<!--if IE]><![endif]--><!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/java-in-a/9781492037248/ch01.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="3866890"
  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"
  data-username="levinxccai"
  data-account-type="B2B"
  
  data-activated-trial-date="11/06/2017"


  data-archive="9781492037248"
  data-publishers="O&#39;Reilly Media, Inc."



  data-htmlfile-name="ch01.html"
  data-epub-title="Java in a Nutshell, 7th Edition" data-debug=0 data-testing=0><![endif]--><!--if gt IE 8]><!--><!--![endif]-->



<a name="2_"></a>
<div id="MathJax_Message" style="display: none;"></div>
<div class="application" id="container" style="height: auto;">
  <div class="js-toc">
    <section role="document">
      <div id="sbo-rt-content" style="max-width:72.5em; transform: none;"><div class="annotator-wrapper"><section data-nutshell-tab="Introduction" data-pdf-bookmark="Chapter 1. Introduction to the Java Environment" data-type="chapter" epub:type="chapter"><div class="chapter" id="javanut7-CHP-1">
<h1><span class="label">Chapter 1. </span>Introduction to the Java Environment</h1>


<p><a data-primary="Java programming environment" data-type="indexterm" id="2_ix_ch01-asciidoc0"></a>Welcome to Java 11.</p>

<p>That version number probably surprises you as much as it does us.
It seems like only yesterday that Java 5 was the new thing, and yet here we are, 14 years and 6 major versions later.</p>

<p>You may be coming to the Java ecosystem from another language, or maybe this is your first programming language.
Whatever road you may have traveled to get here, welcome鈥攚e鈥檙e glad you鈥檝e arrived.</p>

<p>Java is a powerful, general-purpose programming environment. It is one
of the most widely used programming languages in the world, and has been
exceptionally successful in business and enterprise computing.</p>

<p>In this chapter, we鈥檒l set the scene by describing the Java language
(which programmers write their applications in), the Java Virtual
Machine (which executes those applications), and the Java ecosystem
(which provides a lot of the value of the programming environment to
development teams).</p>

<p>We鈥檒l briefly cover the history of the Java language and virtual
machine, before moving on to discuss the lifecycle of a Java program and
clear up some common questions about the differences between Java and
other environments.</p>

<p>At the end of the chapter, we鈥檒l introduce Java security, and discuss
some of the aspects of Java that relate to secure coding.</p>






<section data-pdf-bookmark="The Language, the JVM, and the Ecosystem" data-type="sect1"><div class="sect1" id="idm45941151548920">
<h1>The Language, the JVM, and the Ecosystem</h1>

<p><a data-primary="Java programming environment" data-secondary="as open ecosystem" data-type="indexterm" id="2_idm45941151547352"></a>The Java programming environment has been around since the late 1990s.
It comprises the Java language, and the supporting runtime, otherwise
known as the Java Virtual Machine (JVM).</p>

<p>At the time that Java was initially developed, this split was considered
novel, but recent trends in software development have made it more
commonplace. Notably, Microsoft鈥檚 .NET environment, announced a few
years after Java, adopted a very similar approach to platform
architecture.</p>

<p>One important difference between Microsoft鈥檚 .NET platform and Java is that Java was always conceived as a relatively open ecosystem of multiple vendors, albeit led by a steward who owns the technology.
Throughout Java鈥檚 history, these vendors have both cooperated and competed on aspects of Java technology.</p>

<p>One of the main reasons for the success of Java is that this ecosystem
is a standardized environment. This means there are specifications for
the technologies that comprise the environment. These standards give the
developer and consumer confidence that the technology will be compatible
with other components, even if they come from a different technology
vendor.</p>

<p><a data-primary="Oracle Corporation" data-secondary="Java and" data-type="indexterm" id="2_idm45941151976472"></a>The current steward of Java is Oracle Corporation (who acquired Sun
Microsystems, the originator of Java). Other corporations, such as Red
Hat, IBM, Amazon, AliBaba, SAP, Azul Systems, and Fujitsu are also heavily
involved in producing implementations of standardized Java technologies.</p>
<div data-type="tip"><h6>Tip</h6>
<p><a data-primary="Java 11" data-secondary="OpenJDK and" data-type="indexterm" id="2_idm45941151974216"></a>As of Java 11, the primary reference implementation of Java is the open source OpenJDK, which many of these companies collaborate on and base their shipping products upon.</p>
</div>

<p>Java actually comprises several different but related environments and specifications, such as Java Mobile Edition (Java ME),<sup><a class="totri-footnote" data-type="noteref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch01.html#idm45941151972264" id="idm45941151972264-marker">1</a></sup> Java Standard Edition
(Java SE), and Java Enterprise Edition (Java EE).<sup><a class="totri-footnote" data-type="noteref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch01.html#idm45941151971384" id="idm45941151971384-marker">2</a></sup> In this book, we鈥檒l only cover Java SE, version 11, with some historical notes related to when certain features were introduced into the platform.</p>

<p>We will have more to say about standardization later, so let鈥檚 move on
to discuss the Java language and JVM as separate but related concepts.</p>








<section data-pdf-bookmark="What Is the Java Language?" data-type="sect2"><div class="sect2" id="idm45941151969768">
<h2>What Is the Java Language?</h2>

<p><a data-primary="Java programming environment" data-secondary="Java language and" data-type="indexterm" id="2_idm45941151968360"></a>Java programs are written as source code in the Java language. This is
a human-readable programming language, which is strictly class based and object oriented.
<a data-primary="C/C++" data-secondary="as model for Java language" data-type="indexterm" id="2_idm45941151967016"></a>The language syntax is deliberately modeled on that of C and C++ and it was explicitly intended to be familiar to programmers coming from those languages.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Although the source code is similar to C++, in practice Java includes features and a managed runtime that has more in common with more dynamic languages such as Smalltalk.</p>
</div>

<p>Java is considered to be relatively easy to read and write (if occasionally a bit verbose).
It has a rigid grammar and simple program structure, and is intended to be easy to learn and to teach.
It builds on industry experience with languages like C++ and tries to remove complex features as well as preserving 鈥渨hat works鈥?from previous programming languages.</p>

<p>Overall, Java is intended to provide a stable, solid base for companies
to develop business-critical applications.
As a programming language, it has a relatively conservative design and a
slow rate of change. These properties are a conscious attempt to serve
the goal of protecting the investment that organizations have made in Java
technology.</p>

<p>The language has undergone gradual revision (but no complete rewrites)
since its inception in 1996. This does mean that some of Java鈥檚 original
design choices, which were expedient in the late 1990s, are still
affecting the language today鈥攕ee Chapters <a class="totri-footnote" data-type="xref" data-xrefstyle="select:labelnumber" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2">2</a>
and <a class="totri-footnote" data-type="xref" data-xrefstyle="select:labelnumber" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3">3</a> for more details.</p>

<p><a data-primary="Java 8" data-secondary="language changes in" data-type="indexterm" id="2_idm45941151959368"></a>Java 8 added the most radical changes seen in the language for almost a decade (some would say since the birth of Java).
Features like lambda expressions and the overhaul of the core Collections code were enormously popular and changed forever the way that Java developers write code.
Since then, the platform has produced a release (Java 9) that adds a major (and long-delayed) feature: the platform modules system (JPMS).</p>

<p>With that release, the project has transitioned to a new, much faster release model where new Java versions are released every six months鈥攂ringing us up to Java 11.
<a data-primary="Java Language Specification (JLS)" data-type="indexterm" id="2_idm45941151957272"></a>The Java language is governed by the Java Language Specification
(JLS), which defines how a conforming implementation must behave.</p>
</div></section>













<section data-pdf-bookmark="What Is the JVM?" data-type="sect2"><div class="sect2" id="idm45941151956152">
<h2>What Is the JVM?</h2>

<p><a data-primary="Java programming environment" data-secondary="JVM" data-type="indexterm" id="2_ix_ch01-asciidoc1"></a><a data-primary="Java Virtual Machine (JVM)" data-secondary="Java programming environment and" data-type="indexterm" id="2_ix_ch01-asciidoc2"></a>The JVM is a program that provides the runtime environment necessary
for Java programs to execute. Java programs cannot run unless there is a
JVM available for the appropriate hardware and OS platform we wish to
execute on.</p>

<p>Fortunately, the JVM has been ported to run on a large number of
environments鈥攁nything from a set-top box or Blu-ray player to a huge
mainframe will probably have a JVM available for it.</p>

<p>Java programs are typically started from a command line like this:</p>
<pre data-code-language="java" data-type="programlisting"><code class="n">java</code><code> </code><code class="o">&lt;</code><em><code class="n">arguments</code></em><code class="o">&gt;</code><code> </code><code class="o">&lt;</code><em><code class="n">program</code><code> </code><code class="n">name</code></em><code class="o">&gt;</code><code>
</code></pre>

<p>This brings up the JVM as an operating system process that provides the
Java runtime environment, and then executes our program in the context
of the freshly started (and empty) virtual machine.</p>

<p>It is important to understand that when the JVM takes in a Java program
for execution, the program is not provided as Java language source code.
Instead, the Java language source must have been converted (or compiled)
into a form known as <a data-primary="bytecode" data-secondary="class files and" data-type="indexterm" id="2_idm45941151471112"></a><a data-primary="class files" data-type="indexterm" id="2_idm45941151470264"></a>Java bytecode. Java bytecode must be supplied to
the JVM in a format called class files (which always have a <em>.class</em>
extension).</p>

<p><a data-primary="execution environment, JVM as" data-type="indexterm" id="2_idm45941151468760"></a>The JVM provides an <em>execution environment</em> for the program.
It starts an interpreter for the bytecode form of the program that steps
through one bytecode instruction at a time. However, production JVMs also provide a runtime compiler that will accelerate the important parts of the program by replacing them with equivalent compiled machine code.</p>

<p>You should also be aware that both the JVM and the user program are capable of spawning additional threads of execution, so that a user program may have many different functions running simultaneously.</p>

<p>The design of the JVM built on many years of experience with earlier
programming environments, notably C and C++, so we can think of it as
having several different goals鈥攚hich are all intended to make life
easier for the programmer:</p>

<ul>
<li>
<p>Comprise a container for application code to run inside</p>
</li>
<li>
<p>Provide a secure and reliable execution environment as compared to C/C++</p>
</li>
<li>
<p>Take memory management out of the hands of developers</p>
</li>
<li>
<p>Provide a cross-platform execution environment</p>
</li>
</ul>

<p>These objectives are often mentioned together in discussions of the
platform.</p>

<p>We鈥檝e already mentioned the first of these goals, when we discussed the
JVM and its bytecode interpreter鈥攊t functions as the container for
application code.</p>

<p>We鈥檒l discuss the second and third goals in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch06.html#javanut7-CHP-6">Chapter 6</a>, when we talk about how the Java environment deals with memory
management.</p>

<p><a data-primary="write once, run anywhere (WORA)" data-type="indexterm" id="2_idm45941151694344"></a>The fourth goal, sometimes called 鈥渨rite once, run anywhere鈥?(WORA), is
the property that Java class files can be moved from one execution
platform to another, and they will run unaltered provided a JVM is
available.</p>

<p>This means that a Java program can be developed (and converted to class
files) on a machine running macOS, and then the class files
can be moved to Linux or Microsoft Windows (or other platforms) and the
Java program will run without any further work needed.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The Java environment has been very widely ported, including to platforms
that are very different from mainstream platforms like Linux, macOS, and
Windows. In this book, we use the phrase 鈥渕ost implementations鈥?to
indicate those platforms that the majority of developers are likely to
encounter; macOS, Windows, Linux, BSD Unix, and the like are
all considered 鈥渕ainstream platforms鈥?and count within 鈥渕ost
implementations.鈥?/p&gt;
</div>

<p>In addition to these four primary goals, there is another aspect of the
JVM鈥檚 design that is not always recognized or discussed鈥攊t makes use of
runtime information to self-manage.</p>

<p>Software research in the 1970s and 1980s revealed that the runtime
behavior of programs has a large amount of interesting and useful
patterns that cannot be deduced at compile time. The JVM was the first
truly mainstream platform to make use of this research.</p>

<p>It collects runtime information to make better decisions about how to
execute code. That means that the JVM can monitor and optimize a program
running on it in a manner not possible for platforms without this
capability.</p>

<p>A key example is the runtime fact that not all parts of a Java program
are equally likely to be called during the lifetime of the program鈥攕ome
portions will be called far, far more often than others. The Java
platform takes advantage of this fact with a technology called
just-in-time (JIT) compilation.</p>

<p><a data-primary="HotSpot JVM" data-type="indexterm" id="2_idm45941151687992"></a>In the HotSpot JVM (which was the JVM that Sun first shipped as part of
Java 1.3, and is still in use today), the JVM first identifies which
parts of the program are called most often鈥攖he 鈥渉ot methods.鈥?Then, the
JVM compiles these hot methods directly into machine code, bypassing the
JVM interpreter.</p>

<p>The JVM uses the available runtime information to deliver higher
performance than was possible from purely interpreted execution. In
fact, the optimizations that the JVM uses now in many cases produce
performance that surpasses compiled C and C++ code.</p>

<p>The standard that describes how a properly functioning JVM must behave
is called the JVM Specification.<a data-startref="ix_ch01-asciidoc2" data-type="indexterm" id="2_idm45941151431784"></a><a data-startref="ix_ch01-asciidoc1" data-type="indexterm" id="2_idm45941151431080"></a></p>
</div></section>













<section data-pdf-bookmark="What Is the Java Ecosystem?" data-type="sect2"><div class="sect2" id="idm45941151955240">
<h2>What Is the Java Ecosystem?</h2>

<p><a data-primary="ecosystem, Java" data-type="indexterm" id="2_idm45941151429384"></a><a data-primary="Java ecosystem" data-type="indexterm" id="2_idm45941151428680"></a><a data-primary="Java programming environment" data-secondary="Java ecosystem" data-type="indexterm" id="2_idm45941151428008"></a>The Java language is easy to learn and contains relatively few
abstractions, compared to other programming languages. The JVM provides
a solid, portable, high-performance base for Java (or other languages)
to execute on. Taken together, these two connected technologies provide
a foundation that businesses can feel confident about when choosing
where to base their development efforts.</p>

<p>The benefits of Java do not end there, however. Since Java鈥檚 inception,
an extremely large ecosystem of third-party libraries and components
has grown up. This means that a development team can benefit hugely from
the existence of connectors and drivers for practically every technology
imaginable鈥攂oth proprietary and open source.</p>

<p>In the modern technology ecosystem it is now rare indeed to find a technology component that does <em>not</em> offer a Java connector.
From traditional relational databases, to NoSQL, to every type of enterprise monitoring system, to messaging systems, to Internet of Things (IoT)鈥攅verything integrates with Java.</p>

<p>It is this fact that has been a major driver of adoption of Java
technologies by enterprises and larger companies. Development teams have
been able to unlock their potential by making use of preexisting
libraries and components. This has promoted developer choice and
encouraged open, best-of-breed architectures with Java technology cores.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><a data-primary="Android" data-type="indexterm" id="2_idm45941151423016"></a>Google鈥檚 Android environment is sometimes thought of as being 鈥渂ased on Java.鈥?However, the picture is actually more complicated. Android code is written in Java but originally used a different implementation of Java鈥檚 class libraries along with a cross compiler to convert to a different file format for a non-Java virtual machine.</p>
</div>

<p>The combination of a rich ecosystem and a first-rate virtual machine with an open standard for program binaries makes the Java platform a very attractive execution target.
In fact, there are a large number of non-Java languages that target the JVM and also interoperate with Java (which allows them to piggy-back off the platform鈥檚 success).
These languages include Kotlin, Scala, Groovy, and many others. While all of them are small compared to Java, they have distinct niches within the Java world, and provide a source of innovation and healthy competition to Java.</p>
</div></section>





</div></section>













<section data-pdf-bookmark="A Brief History of Java and the JVM" data-type="sect1"><div class="sect1" id="idm45941151548424">
<h1>A Brief History of Java and the JVM</h1>
<dl>
<dt>Java 1.0 (1996)</dt>
<dd>
<p><a data-primary="Java (generally)" data-secondary="history" data-type="indexterm" id="2_ix_ch01-asciidoc3"></a><a data-primary="Java (generally)" data-secondary="overview of versions 1.0 through 11" data-type="indexterm" id="2_ix_ch01-asciidoc4"></a><a data-primary="Java programming environment" data-secondary="Java/JVM history" data-type="indexterm" id="2_ix_ch01-asciidoc5"></a><a data-primary="Java Virtual Machine (JVM)" data-secondary="history" data-type="indexterm" id="2_ix_ch01-asciidoc6"></a>This was the first public version of Java. It contained just 212
classes organized in eight packages. The Java platform has always had
an emphasis on backward compatibility, and code written with Java
1.0 will still run today on Java 11 without modification or
recompilation.</p>
</dd>
<dt>Java 1.1 (1997)</dt>
<dd>
<p>This release of Java more than doubled the size of the Java platform.
This release introduced 鈥渋nner classes鈥?and the first version of the
Reflection API.</p>
</dd>
<dt>Java 1.2 (1998)</dt>
<dd>
<p>This was a very significant release of Java; it tripled the size of
the Java platform. This release marked the first appearance of the
Java Collections API (with sets, maps, and lists). The many new
features in the 1.2 release led Sun to rebrand the platform as 鈥渢he
Java 2 Platform.鈥?The term 鈥淛ava 2鈥?was simply a trademark, however,
and not an actual version number for the release.</p>
</dd>
<dt>Java 1.3 (2000)</dt>
<dd>
<p>This was primarily a maintenance release, focused on bug fixes,
stability, and performance improvements. This release also brought in
the HotSpot Java Virtual Machine, which is still in use today
(although heavily modified and improved since then).</p>
</dd>
<dt>Java 1.4 (2002)</dt>
<dd>
<p>This was another fairly big release, adding important new
functionality such as a higher-performance, low-level I/O API; regular
expressions for text handling; XML and XSLT libraries; SSL support; a
logging API; and cryptography <span class="keep-together">support</span>.</p>
</dd>
<dt>Java 5 (2004)</dt>
<dd>
<p>This large release of Java introduced a number of changes to the core
language itself including generic types, enumerated types (enums),
annotations, varargs methods, autoboxing, and a new <code>for</code> loop. These
changes were considered significant enough to change the major version
number, and to start numbering as major releases. This release
included 3,562 classes and interfaces in 166 packages. Notable
additions included utilities for concurrent programming, a remote
management framework, and classes for the remote management and
instrumentation of the Java VM itself.</p>
</dd>
<dt>Java 6 (2006)</dt>
<dd>
<p>This release was also largely a maintenance and performance release.
It introduced the Compiler API, expanded the usage and scope of
annotations, and provided bindings to allow scripting languages to
interoperate with Java. There were also a large number of internal
bug fixes and improvements to the JVM and the Swing GUI technology.</p>
</dd>
<dt>Java 7 (2011)</dt>
<dd>
<p>The first release of Java under Oracle鈥檚 stewardship included a number
of major upgrades to the language and platform. The introduction of
<code>try</code>-with-resources and the NIO.2 API enabled developers to write
much safer and less error-prone code for handling resources and I/O.
The Method Handles API provided a simpler and safer alternative to
reflection; in addition, it opened the door for <code>invoke<span class="keep-together">dynamic</span></code> (the first new
bytecode since version 1.0 of Java).</p>
</dd>
<dt>Java 8 (2014) (LTS)</dt>
<dd>
<p><a data-primary="Java 8" data-secondary="updates in" data-type="indexterm" id="2_idm45941143355320"></a>This was a huge release鈥攑otentially the most significant changes to the language since Java 5 (or possibly ever).
The introduction of lambda expressions provided the ability to
significantly enhance the productivity of developers, the Collections
were updated to make use of lambdas, and the machinery required
to achieve this marked a fundamental change in Java鈥檚 approach to
object orientation. Other major updates include a new date and time API, and major updates to the concurrency libraries.</p>
</dd>
<dt>Java 9 (2017)</dt>
<dd>
<p>Significantly delayed, this release introduced the new platform modularity
feature, which allows Java applications to be packaged into deployment units
and modularize the platform runtime. Other changes include a new default
garbage collection algorithm, a new API for handling processes, and some
changes to the way that frameworks can access the internals.</p>
</dd>
<dt>Java 10 (March 2018)</dt>
<dd>
<p>This marks the first release under the new release cycle. This release contained a relatively small amount of new features (due to its six-month development lifetime). New syntax for type inference was introduced, along with some internal changes (including GC tweaks and an experimental new compiler).</p>
</dd>
<dt>Java 11 (September 2018) (LTS)  </dt>
<dd>
<p><a data-primary="Java 11" data-secondary="new features" data-type="indexterm" id="2_idm45941143312264"></a>The current version, also developed over a short six-month window, this release is the first modular Java to be considered as a <a data-primary="long-term support (LTS) release" data-type="indexterm" id="2_idm45941143311016"></a>long-term support (LTS) release.
It adds relatively few new features that are directly visible to the developer鈥攑rimarily Flight Recorder and the new HTTP/2 API.
There are some additional internal changes, but this release is primarily for stabilization.</p>
</dd>
</dl>

<p>As it stands, the only current production versions are Java 8 and 11鈥攖he LTS releases.
Due to the highly significant changes that are introduced by modules, Java 8 has been grandfathered in as an LTS release to provide extra time for teams and applications to migrate to a supported modular Java.<a data-startref="ix_ch01-asciidoc6" data-type="indexterm" id="2_idm45941143309720"></a><a data-startref="ix_ch01-asciidoc5" data-type="indexterm" id="2_idm45941143309048"></a><a data-startref="ix_ch01-asciidoc4" data-type="indexterm" id="2_idm45941143308376"></a><a data-startref="ix_ch01-asciidoc3" data-type="indexterm" id="2_idm45941143307704"></a></p>
</div></section>













<section data-pdf-bookmark="The Lifecycle of a Java Program" data-type="sect1"><div class="sect1" id="idm45941143306776">
<h1>The Lifecycle of a Java Program</h1>

<p><a data-primary="Java programming environment" data-secondary="lifecycle of Java program" data-type="indexterm" id="2_ix_ch01-asciidoc7"></a><a data-primary="Java programs" data-secondary="lifecycle of" data-type="indexterm" id="2_ix_ch01-asciidoc8"></a><a data-primary="lifecycle, of Java program" data-type="indexterm" id="2_ix_ch01-asciidoc9"></a>To better understand how Java code is compiled and executed, and the
difference between Java and other types of programming environments,
consider the pipeline in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch01.html#javanut7-CHP-1-FIG-1">Figure 1-1</a>.</p>

<figure><div class="figure" id="javanut7-CHP-1-FIG-1">
<img alt="JN7 0101" data-mfp-src="/library/view/java-in-a/9781492037248/assets/jns7_0101.png" height="544" src="https://learning.oreilly.com/library/view/java-in-a/9781492037248/assets/jns7_0101.png" width="1313"/>
<h6><span class="label">Figure 1-1. </span>How Java code is compiled and loaded</h6>
</div></figure>

<p>This starts wth Java source, and passes it through the <code>javac</code> program
to produce class files鈥攚hich contain the source code compiled to Java
bytecode. The class file is the smallest unit of functionality the
platform will deal with, and the only way to get new code into a running
program.</p>

<p>New class files are onboarded via the classloading mechanism (see
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch10.html#javanut7-CHP-10">Chapter 10</a> for a lot more detail on how
classloading works). This makes the new type available to the
interpreter for execution.</p>








<section data-pdf-bookmark="Frequently Asked Questions" data-type="sect2"><div class="sect2" id="idm45941143296440">
<h2>Frequently Asked Questions</h2>

<p>In this section, we鈥檒l discuss some of the most frequently asked
questions about Java and the lifecycle of programs written in the Java
environment.</p>










<section data-pdf-bookmark="What is bytecode?" data-type="sect3"><div class="sect3" id="idm45941143294648">
<h3>What is bytecode?</h3>

<p><a data-primary="bytecode" data-secondary="defined" data-type="indexterm" id="2_idm45941143293448"></a>When developers are first introduced to the JVM, they sometimes think
of it as 鈥渁 computer inside a computer.鈥?It鈥檚 then easy to imagine
bytecode as 鈥渕achine code for the CPU of the internal computer鈥?or
鈥渕achine code for a made-up processor.鈥?/p&gt;

<p>In fact, bytecode is not actually very similar to machine code that would run on a real hardware processor.
<a data-primary="intermediate representation, bytecode as" data-type="indexterm" id="2_idm45941143291560"></a>Instead, computer scientists would call bytecode a type of <em>intermediate representation</em>鈥攁 halfway house between source code and machine code.</p>

<p>The whole aim of bytecode is to be a format that can be executed
efficiently by the JVM鈥檚 interpreter.</p>
</div></section>













<section data-pdf-bookmark="Is javac a compiler?" data-type="sect3"><div class="sect3" id="idm45941143289608">
<h3>Is javac a compiler?</h3>

<p><a data-primary="compilers" data-secondary="javac鈥檚 similarity to" data-type="indexterm" id="2_idm45941143288168"></a><a data-primary="javac" data-secondary="similarity to compiler" data-type="indexterm" id="2_idm45941143287192"></a>Compilers usually produce machine code, but <code>javac</code> produces bytecode,
which is not that similar to machine code. However, class files are a
bit like object files (like Windows <em>.dll</em> files, or Unix <em>.so</em>
files)鈥攁nd they are certainly not human readable.</p>

<p>In theoretical computer science terms, <code>javac</code> is most similar to the
<em>front half</em> of a compiler鈥攊t creates the intermediate representation
that can then be used later to produce (emit) machine code.</p>

<p>However, because creation of class files is a separate build-time step
that resembles compilation in C/C++, many developers consider running
<code>javac</code> to be compilation. In this book, we will use the terms 鈥渟ource
code compiler鈥?or &quot;<code>javac</code> compiler鈥?to mean the production of class files
by <code>javac</code>.</p>

<p>We will reserve 鈥渃ompilation鈥?as a standalone term to mean JIT
compilation鈥攁s it鈥檚 JIT compilation that actually produces machine code.</p>
</div></section>













<section data-pdf-bookmark="Why is it called 鈥渂ytecode鈥?" data-type="sect3"><div class="sect3" id="idm45941143280696">
<h3>Why is it called 鈥渂ytecode鈥?</h3>

<p><a data-primary="bytecode" data-secondary="as terminology" data-type="indexterm" id="2_idm45941143279592"></a>The instruction code (opcode) is just a single byte (some operations
also have parameters that follow them in the bytestream), so there are
only 256 possible instructions. In practice, some are unused鈥攁bout 200
are in use, but some of them aren鈥檛 emitted by recent versions of <code>javac</code>.</p>
</div></section>













<section data-pdf-bookmark="Is bytecode optimized?" data-type="sect3"><div class="sect3" id="idm45941143277544">
<h3>Is bytecode optimized?</h3>

<p><a data-primary="bytecode" data-secondary="optimization and" data-type="indexterm" id="2_idm45941143276312"></a><a data-primary="javac" data-secondary="optimized bytecode" data-type="indexterm" id="2_idm45941143275336"></a><a data-primary="optimization, bytecode and" data-type="indexterm" id="2_idm45941143274392"></a>In the early days of the platform, <code>javac</code> produced heavily optimized
bytecode. This turned out to be a mistake. With the advent of JIT
compilation, the important methods are going to be compiled to very fast
machine code. It鈥檚 therefore very important to make the job of the JIT
compiler easier鈥攁s there are much bigger gains available from JIT
compilation than there are from optimizing bytecode, which will still
have to be interpreted.</p>
</div></section>













<section data-pdf-bookmark="Is bytecode really machine independent? What about things like endianness?" data-type="sect3"><div class="sect3" id="idm45941143272472">
<h3>Is bytecode really machine independent? What about things like endianness?</h3>

<p><a data-primary="bytecode" data-secondary="endianness" data-type="indexterm" id="2_idm45941143271304"></a><a data-primary="bytecode" data-secondary="machine-independence of" data-type="indexterm" id="2_idm45941143270328"></a><a data-primary="endianness, bytecode and" data-type="indexterm" id="2_idm45941143269384"></a>The format of bytecode is always the same, regardless of what type of
machine it was created on. This includes the byte ordering (sometimes
called 鈥渆ndianness鈥? of the machine. For readers who are interested in
the details, bytecode is always big-endian.</p>
</div></section>













<section data-pdf-bookmark="Is Java an interpreted language?" data-type="sect3"><div class="sect3" id="idm45941143267992">
<h3>Is Java an interpreted language?</h3>

<p><a data-primary="interpreted languages" data-type="indexterm" id="2_idm45941143266856"></a><a data-primary="Java (generally)" data-secondary="interpreted languages and" data-type="indexterm" id="2_idm45941143266152"></a>The JVM is basically an interpreter (with JIT compilation to give it
a big performance boost). However, most interpreted languages (such as
PHP, Perl, Ruby, and Python) directly interpret programs from source
form (usually by constructing an abstract syntax tree from the input
source file). The JVM interpreter, on the other hand, requires class
files鈥攚hich, of course, require a separate source code compilation step
with <code>javac</code>.</p>
</div></section>













<section data-pdf-bookmark="Can other languages run on the JVM?" data-type="sect3"><div class="sect3" id="idm45941143263928">
<h3>Can other languages run on the JVM?</h3>

<p><a data-primary="Java Virtual Machine (JVM)" data-secondary="running non-Java languages on" data-type="indexterm" id="2_idm45941143262728"></a>Yes. The JVM can run any valid class file, so this means that non-Java
languages can run on the JVM in one of two ways. First, they could
have a source code compiler (similar to <code>javac</code>) that produces class
files, which would run on the JVM just like Java code (this is the
approach taken by languages like Scala).</p>

<p>Alternatively, a non-Java language could implement an interpreter and runtime in Java, and then interpret the source form of their language directly.
This second option is the approach taken by languages like JRuby (but JRuby has a very sophisticated runtime that is capable of <em>secondary JIT compilation</em> in some circumstances).<a data-startref="ix_ch01-asciidoc9" data-type="indexterm" id="2_idm45941143259656"></a><a data-startref="ix_ch01-asciidoc8" data-type="indexterm" id="2_idm45941143258984"></a><a data-startref="ix_ch01-asciidoc7" data-type="indexterm" id="2_idm45941143258312"></a></p>
</div></section>



</div></section>





</div></section>













<section data-pdf-bookmark="Java Security" data-type="sect1"><div class="sect1" id="idm45941143257384">
<h1>Java Security</h1>

<p><a data-primary="Java (generally)" data-secondary="security" data-type="indexterm" id="2_idm45941143256136"></a><a data-primary="security" data-type="indexterm" id="2_idm45941143255272"></a>Java has been designed from the ground up with security in mind; this
gives it a great advantage over many other existing systems and
platforms. The Java security architecture was designed by security
experts and has been studied and probed by many other security experts
since the inception of the platform. The consensus is that the
architecture itself is strong and robust, without any security holes in
the design (at least none that have been discovered yet).</p>

<p><a data-primary="bytecode" data-secondary="security and" data-type="indexterm" id="2_idm45941143253736"></a>Fundamental to the design of the security model is that bytecode is
heavily restricted in what it can express鈥攖here is no way, for example,
to directly address memory. This cuts out entire classes of security
problems that have plagued languages like C and C++. <a data-primary="bytecode" data-secondary="verification" data-type="indexterm" id="2_idm45941143252344"></a>Furthermore, the VM
goes through a process known as <em>bytecode</em> <em>verification</em> whenever it
loads an untrusted class, which removes a further large class of
problems (see <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch10.html#javanut7-CHP-10">Chapter 10</a> for more about
bytecode verification).</p>

<p>Despite all this, however, no system can guarantee 100% security, and
Java is no exception.</p>

<p>While the design is still theoretically robust, the implementation of
the security architecture is another matter, and there is a long history
of security flaws being found and patched in particular implementations
of Java.</p>

<p><a data-primary="Java 8" data-secondary="security issues" data-type="indexterm" id="2_idm45941143248008"></a>In particular, the release of Java 8 was delayed, at least partly, due
to the discovery of a number of security problems that required
considerable effort to fix.</p>

<p>In all likelihood, security flaws will continue to be discovered (and
patched) in Java VM implementations.
For practical server-side coding, Java remains perhaps the most secure general-purpose platform currently available, especially when kept patched up to date.</p>
</div></section>













<section data-pdf-bookmark="Comparing Java to Other Languages" data-type="sect1"><div class="sect1" id="idm45941143245928">
<h1>Comparing Java to Other Languages</h1>

<p><a data-primary="Java (generally)" data-secondary="other programming languages compared to" data-type="indexterm" id="2_idm45941143244520"></a>In this section, we鈥檒l briefly highlight some differences between the
Java platform and other programming environments you may be familiar
with.</p>








<section data-pdf-bookmark="Java Compared to C" data-type="sect2"><div class="sect2" id="idm45941143243064">
<h2>Java Compared to C</h2>

<ul>
<li>
<p><a data-primary="C/C++" data-secondary="Java compared to" data-type="indexterm" id="2_idm45941143241032"></a>Java is object oriented; C is procedural.</p>
</li>
<li>
<p>Java is portable as class files; C needs to be recompiled.</p>
</li>
<li>
<p>Java provides extensive instrumentation as part of the runtime.</p>
</li>
<li>
<p>Java has no pointers and no equivalent of pointer arithmetic.</p>
</li>
<li>
<p>Java provides automatic memory management via garbage collection.</p>
</li>
<li>
<p>Java has no ability to lay out memory at a low level (no structs).</p>
</li>
<li>
<p>Java has no preprocessor.</p>
</li>
</ul>
</div></section>













<section data-pdf-bookmark="Java Compared to C++" data-type="sect2"><div class="sect2" id="idm45941143234152">
<h2>Java Compared to C++</h2>

<ul>
<li>
<p><a data-primary="C/C++" data-secondary="Java compared to" data-type="indexterm" id="2_idm45941143232088"></a>Java has a simplified object model compared to C++.</p>
</li>
<li>
<p>Java鈥檚 dispatch is virtual by default.</p>
</li>
<li>
<p>Java is always pass-by-value (but one of the possibilities for Java鈥檚
values is object references).</p>
</li>
<li>
<p>Java does not support full multiple inheritance.</p>
</li>
<li>
<p>Java鈥檚 generics are less powerful (but also less dangerous) than C++
templates.</p>
</li>
<li>
<p>Java has no operator overloading.</p>
</li>
</ul>
</div></section>













<section data-pdf-bookmark="Java Compared to Python" data-type="sect2"><div class="sect2" id="idm45941143226200">
<h2>Java Compared to Python</h2>

<ul>
<li>
<p><a data-primary="Python, Java compared to" data-type="indexterm" id="2_idm45941143224264"></a>Java is statically typed; Python is dynamically typed.</p>
</li>
<li>
<p>Java is multithreaded; Python only allows one thread to execute Python at once.</p>
</li>
<li>
<p>Java has a JIT; the main implementation of Python does not.</p>
</li>
<li>
<p>Java鈥檚 bytecode has extensive static checks; Python鈥檚 bytecode does not.</p>
</li>
</ul>
</div></section>













<section data-pdf-bookmark="Java Compared to JavaScript" data-type="sect2"><div class="sect2" id="javanut7-CHP-1-SECT-5.4">
<h2>Java Compared to JavaScript</h2>

<ul>
<li>
<p><a data-primary="JavaScript" data-secondary="Java compared to" data-type="indexterm" id="2_idm45941143217864"></a>Java is statically typed; JavaScript is dynamically typed.</p>
</li>
<li>
<p>Java uses class-based objects; JavaScript is prototype based.</p>
</li>
<li>
<p>Java provides good object encapsulation; JavaScript does not.</p>
</li>
<li>
<p>Java has namespaces; JavaScript does not.</p>
</li>
<li>
<p>Java is multithreaded; JavaScript is not.</p>
</li>
</ul>
</div></section>





</div></section>













<section data-pdf-bookmark="Answering Some Criticisms of Java" data-type="sect1"><div class="sect1" id="idm45941143212712">
<h1>Answering Some Criticisms of Java</h1>

<p><a data-primary="Java (generally)" data-secondary="answering criticisms of" data-type="indexterm" id="2_ix_ch01-asciidoc10"></a>Java has had a long history in the public eye and, as a result, has
attracted its fair share of criticism over the years. Some of this
negative press can be attributed to some technical shortcomings combined
with rather overzealous marketing in the first versions of Java.</p>

<p>Some criticisms have, however, entered technical folklore despite no
longer being very accurate. In this section, we鈥檒l look at some common
grumbles and the extent to which they鈥檙e true for modern versions of the
platform.</p>








<section data-pdf-bookmark="Overly Verbose" data-type="sect2"><div class="sect2" id="idm45941143209000">
<h2>Overly Verbose</h2>

<p><a data-primary="Java (generally)" data-secondary="verbosity of" data-type="indexterm" id="2_idm45941151366264"></a>The Java core language has sometimes been criticized as overly
verbose. Even simple Java statements such as <code>Object o = new Object();</code>
seem to be repetitious鈥攖he type <code>Object</code> appears on both the left and
right side of the assignment. Critics point out that this is essentially
redundant, that other languages do not need this duplication of type
information, and that many languages support features (e.g., type inference) that
remove it.</p>

<p>The counterpoint to this argument is that Java was designed from the
start to be easy to read (code is read more often than written) and that
many programmers, especially novices, find the extra type information
helpful when reading code.</p>

<p>Java is widely used in enterprise environments, which often have
separate dev and ops teams. The extra verbosity can often be a blessing
when you are responding to an outage call, or when you need to maintain and patch
code that was written by developers who have long since moved on.</p>

<p>In recent versions of Java, the language designers have attempted to respond to some of these points, by finding places where the syntax can become less verbose and by making better use of type information.
For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Files helper methods</code>
<code class="kt">byte</code><code class="o">[]</code> <code class="n">contents</code> <code class="o">=</code>
  <code class="n">Files</code><code class="o">.</code><code class="na">readAllBytes</code><code class="o">(</code><code class="n">Paths</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">/home/ben/myFile.bin</code><code class="o">));</code>

<code class="c1">// Diamond syntax for repeated type information</code>
<code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">l</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;&gt;();</code>

<code class="c1">// Local variables can be type inferred</code>
<code class="n">var</code> <code class="n">threadPool</code> <code class="o">=</code> <code class="n">Executors</code><code class="o">.</code><code class="na">newScheduledThreadPool</code><code class="o">(</code><code class="mi">2</code><code class="o">);</code>
<code class="c1">// Lambda expressions simplify Runnables</code>
<code class="n">threadPool</code><code class="o">.</code><code class="na">submit</code><code class="o">(()</code> <code class="o">-&gt;</code> <code class="o">{</code> <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">On Threadpool</code><code class="o">);</code> <code class="o">});</code></pre>

<p>However, Java鈥檚 overall philosophy is to make changes to the language
only very slowly and carefully, so the pace of these changes may not
satisfy detractors <span class="keep-together">completely</span>.</p>
</div></section>













<section data-pdf-bookmark="Slow to Change" data-type="sect2"><div class="sect2" id="idm45941151201352">
<h2>Slow to Change</h2>

<p><a data-primary="Java (generally)" data-secondary="pace of change" data-type="indexterm" id="2_idm45941151199976"></a>The original Java language is now well over 20 years old, and has not
undergone a complete revision in that time. Many other languages
(e.g., Microsoft鈥檚 C#) have released backward-incompatible versions in
the same period, and some developers criticize Java for not doing
likewise.</p>

<p>Furthermore, in recent years, the Java language has come under fire for
being slow to adopt language features that are now commonplace in other
languages.</p>

<p>The conservative approach to language design that Sun (and now Oracle)
has taken is an attempt to avoid imposing the costs and
externalities of misfeatures on a very large user base. Many Java shops
have made major investments in the technology, and the language
designers have taken seriously the responsibility of not disrupting the
existing user and install base.</p>

<p>Each new language feature needs to be very carefully thought about鈥攏ot
only in isolation, but in terms of how it will interact with all the
existing features of the language. New features can sometimes have
impacts beyond their immediate scope鈥攁nd Java is widely used in very
large codebases, where there are more potential places for an unexpected
interaction to manifest.</p>

<p>It is almost impossible to remove a feature that turns out to be
incorrect after it has shipped. Java has a couple of misfeatures (such as
the finalization mechanism) that it has never been possible to remove safely without impacting the install base. The language designers
have taken the view that extreme caution is required when evolving the
language.</p>

<p>Having said that, the new language features that have arrived in recent versions are a significant step toward addressing the most common complaints about missing features, and should cover many of the idioms that developers
have been asking for.</p>
</div></section>













<section data-pdf-bookmark="Performance Problems" data-type="sect2"><div class="sect2" id="idm45941151198872">
<h2>Performance Problems</h2>

<p><a data-primary="Java (generally)" data-secondary="performance problems" data-type="indexterm" id="2_idm45941151320840"></a>The Java platform is still sometimes criticized as being slow鈥攂ut of
all the criticisms that are leveled at the platform, this is probably
the one that is least justified. It is a genuine myth about the platform.</p>

<p><a data-primary="HotSpot JVM" data-secondary="introduction of" data-type="indexterm" id="2_idm45941151319368"></a>Release 1.3 of Java brought in the HotSpot Virtual Machine and its JIT
compiler. Since then, there has been over 15 years of continual
innovation and improvement in the virtual machine and its performance.
The Java platform is now blazingly fast, regularly winning performance
benchmarks on popular frameworks, and even beating native-compiled C and
C++.</p>

<p>Criticism in this area appears to be largely caused by a folk memory
that Java was slow at some point in the past. Some of the larger
and more sprawling architectures that Java has been used within may also
have contributed to this impression.</p>

<p>The truth is that any large architecture will require benchmarking,
analysis, and performance tuning to get the best out of it鈥攁nd Java is
no exception.</p>

<p>The core of the platform鈥攍anguage and JVM鈥攚as and remains one of the
fastest general-use environments available to the developer.</p>
</div></section>













<section data-pdf-bookmark="Insecure" data-type="sect2"><div class="sect2" id="idm45941151315976">
<h2>Insecure</h2>

<p><a data-primary="Java (generally)" data-secondary="security vulnerabilities" data-type="indexterm" id="2_idm45941151314776"></a><a data-primary="Java 8" data-secondary="security issues" data-type="indexterm" id="2_idm45941151313832"></a><a data-primary="security" data-type="indexterm" id="2_idm45941151312888"></a>During 2013 there were a number of security vulnerabilities in the
Java platform, which caused the release date of Java 8 to be pushed
back. Even before this, some people had criticized Java鈥檚 record of
security vulnerabilities.</p>

<p>Many of these vulnerabilities involved the desktop and GUI components of
the Java system, and wouldn鈥檛 affect websites or other server-side code
written in Java.</p>

<p>All programming platforms have security issues at times, and many other
languages have a comparable history of security vulnerabilities that
have been significantly less well publicized.</p>
</div></section>













<section data-pdf-bookmark="Too Corporate" data-type="sect2"><div class="sect2" id="idm45941151310408">
<h2>Too Corporate</h2>

<p><a data-primary="Java (generally)" data-secondary="corporateness of" data-type="indexterm" id="2_idm45941151309208"></a>Java is a platform that is extensively used by corporate and
enterprise developers. The perception that it is too corporate is
therefore an unsurprising one鈥擩ava has often been perceived as lacking
the 鈥渇ree-wheeling鈥?style of languages that are deemed to be more
community oriented.</p>

<p>In truth, Java has always been, and remains, a very widely used language
for community and free or open source software development. It is one of
the most popular languages for projects hosted on GitHub and other
project hosting sites.</p>

<p>Finally, the most widely used implementation of the language itself is
based on OpenJDK鈥攚hich is itself an open source project with a vibrant
and growing <span class="keep-together">community</span><a data-startref="ix_ch01-asciidoc10" data-type="indexterm" id="2_idm45941151305672"></a>.<a data-startref="ix_ch01-asciidoc0" data-type="indexterm" id="2_idm45941151304840"></a><a data-primary="AsynchronousFileChannel" data-see="async I/O" data-type="indexterm" id="2_idm45941151304136"></a><a data-primary="class(es)" data-secondary="hiding data within" data-see="encapsulation" data-type="indexterm" id="2_idm45941151303192"></a><a data-primary="collections" data-secondary="Java Streams and" data-see="Java Streams" data-type="indexterm" id="2_idm45941151301976"></a><a data-primary="data encapsulation" data-see="encapsulation" data-type="indexterm" id="2_idm45941151300760"></a><a data-primary="data hiding" data-see="encapsulation" data-type="indexterm" id="2_idm45941151299816"></a><a data-primary="documentation" data-see="conventions, programming/documentation" data-type="indexterm" id="2_idm45941151298872"></a><a data-primary="documentation" data-see="javadoc" data-type="indexterm" id="2_idm45941151297960"></a><a data-primary="inner classes" data-see="nested types" data-type="indexterm" id="2_idm45941151297016"></a><a data-primary="heap" data-see="HotSpot heap" data-type="indexterm" id="2_idm45941151296072"></a><a data-primary="introspection" data-see="Method Handles" data-type="indexterm" id="2_idm45941151295128"></a><a data-primary="introspection" data-see="Reflection" data-type="indexterm" id="2_idm45941151294184"></a><a data-primary="Java (generally)" data-secondary="syntax" data-see="syntax, Java" data-type="indexterm" id="2_idm45941151293240"></a><a data-primary="Java 8" data-secondary="lamdba expressions" data-see="lambda expressions" data-type="indexterm" id="2_idm45941151292024"></a><a data-primary="Java 8" data-secondary="Nashorn" data-see="Nashorn" data-type="indexterm" id="2_idm45941151290808"></a><a data-primary="Java Collections" data-see="collections" data-type="indexterm" id="2_idm45941151289592"></a><a data-primary="Java generics" data-see="generics" data-type="indexterm" id="2_idm45941151288648"></a><a data-primary="Java language" data-see="syntax, Java" data-type="indexterm" id="2_idm45941151287704"></a><a data-primary="multithreading" data-see="concurrency" data-type="indexterm" id="2_idm45941151286760"></a><a data-primary="naming conventions" data-see="conventions, programming/documentation" data-type="indexterm" id="2_idm45941151285816"></a><a data-primary="programming conventions" data-see="conventions" data-type="indexterm" id="2_idm45941151284904"></a><a data-primary="shell" data-see="jjs command; JShell" data-type="indexterm" id="2_idm45941151283960"></a><a data-primary="Streams API" data-see="Java Streams" data-type="indexterm" id="2_idm45941151283016"></a></p>
</div></section>





</div></section>







<div data-type="footnotes"><p data-type="footnote" id="idm45941151972264"><sup><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch01.html#idm45941151972264-marker">1</a></sup> Java ME is an older standard for smartphones and feature phones. Android and iOS are much more common on phones today, but Java ME is still a large market for embedded devices.</p><p data-type="footnote" id="idm45941151971384"><sup><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch01.html#idm45941151971384-marker">2</a></sup> Java EE has now been transferred to the Eclipse Foundation, where it continues its life as the Jakarta EE project.</p></div></div></section><div class="annotator-outer annotator-viewer viewer annotator-hide"> </div></div></div>
    </section>
  </div>
</div><iframe src="cid:frame-41F5F80981DED03E4CE7FB20D0E162B7@mhtml.blink" style="display: none;"></iframe><div style="display: none; visibility: hidden;"></div><iframe allowtransparency="true" frameborder="0" scrolling="no" src="cid:frame-E15184ED1A7674FC75F736F02B759B4A@mhtml.blink" style="display: none;" title="Twitter settings iframe"></iframe><span><div id="KampyleAnimationContainer" style="z-index: 2147483000; border: 0px; position: fixed; display: block; width: 0px; height: 0px;"></div></span>
<hr/>

<!--if IE]><![endif]--><!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/java-in-a/9781492037248/ch02.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="3866890"
  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"
  data-username="levinxccai"
  data-account-type="B2B"
  
  data-activated-trial-date="11/06/2017"


  data-archive="9781492037248"
  data-publishers="O&#39;Reilly Media, Inc."



  data-htmlfile-name="ch02.html"
  data-epub-title="Java in a Nutshell, 7th Edition" data-debug=0 data-testing=0><![endif]--><!--if gt IE 8]><!--><!--![endif]-->



<a name="3_"></a>
<div id="MathJax_Message" style="display: none;"></div>
<div class="application" id="container" style="height: auto;">
  <div class="js-toc">
    <section role="document">
      <div id="sbo-rt-content" style="max-width:72.5em; transform: none;"><div class="annotator-wrapper"><section data-nutshell-tab="Java Syntax" data-pdf-bookmark="Chapter 2. Java Syntax from the Ground Up" data-type="chapter" epub:type="chapter"><div class="chapter" id="javanut7-CHP-2">
<h1><span class="label">Chapter 2. </span>Java Syntax from the Ground Up</h1>


<p><a data-primary="syntax, Java" data-type="indexterm" id="3_ix_ch02-asciidoc0"></a>This chapter is fairly dense but should provide a comprehensive introduction to Java syntax.
It is written primarily for readers who are new to the language but have
some previous programming experience. Determined novices with no prior
programming experience may also find it useful. If you already know
Java, you should find it a useful language reference. The chapter
includes some comparisons of Java to C and C++ for the benefit of
programmers coming from those languages.</p>

<p>This chapter documents the syntax of Java programs by starting at the
very lowest level of Java syntax and building from there, moving on to
increasingly higher orders of structure. It covers:</p>

<ul>
<li>
<p>The characters used to write Java programs and the encoding of those <span class="keep-together">characters</span>.</p>
</li>
<li>
<p>Literal values, identifiers, and other tokens that comprise a Java program.</p>
</li>
<li>
<p>The data types that Java can manipulate.</p>
</li>
<li>
<p>The operators used in Java to group individual tokens into larger expressions.</p>
</li>
<li>
<p>Statements, which group expressions and other statements to form logical chunks of Java code.</p>
</li>
<li>
<p>Methods, which are named collections of Java statements that can be invoked by other Java code.</p>
</li>
<li>
<p>Classes, which are collections of methods and fields. Classes are the central program element in Java and form the basis for object-oriented programming. <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3">Chapter 3</a> is devoted entirely to a discussion of classes and objects.</p>
</li>
<li>
<p>Packages, which are collections of related classes.</p>
</li>
<li>
<p>Java programs, which consist of one or more interacting classes that may be drawn from one or more packages.</p>
</li>
</ul>

<p>The syntax of most programming languages is complex, and Java is no
exception. In general, it is not possible to document all elements of a
language without referring to other elements that have not yet been
discussed. For example, it is not really possible to explain in a
meaningful way the operators and statements supported by Java without
referring to objects. But it is also not possible to document objects
thoroughly without referring to the operators and statements of the
language. The process of learning Java, or any language, is therefore an
iterative one.</p>






<section data-pdf-bookmark="Java Programs from the Top Down" data-type="sect1"><div class="sect1" id="idm45941151266360">
<h1>Java Programs from the Top Down</h1>

<p><a data-primary="Java programs" data-secondary="contents of" data-type="indexterm" id="3_idm45941151264952"></a><a data-primary="syntax, Java" data-secondary="overview of Java program" data-type="indexterm" id="3_idm45941151263816"></a>Before we begin our bottom-up exploration of Java syntax, let鈥檚 take a
moment for a top-down overview of a Java program. Java programs consist
of one or more files, or <em>compilation units</em>, of Java source code. Near
the end of the chapter, we describe the structure of a Java file and
explain how to compile and run a Java program. <a data-primary="import declarations" data-type="indexterm" id="3_idm45941151261992"></a><a data-primary="package declarations" data-type="indexterm" id="3_idm45941151261288"></a>Each compilation unit
begins with an optional <code>package</code> declaration followed by zero or more
<code>import</code> declarations. <a data-primary="compilation units" data-type="indexterm" id="3_idm45941151259624"></a>These declarations specify the namespace within
which the compilation unit will define names, and the namespaces from
which the compilation unit imports names. We鈥檒l see <code>package</code> and
<code>import</code> again later in this chapter in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2-SECT-10">鈥淧ackages and the Java Namespace鈥?/a&gt;.</p>

<p><a data-primary="reference types" data-type="indexterm" id="3_idm45941151256696"></a>The optional <code>package</code> and <code>import</code> declarations are followed by zero or
more reference type definitions. We will meet the full variety of
possible reference types in Chapters <a class="totri-footnote" data-type="xref" data-xrefstyle="select:labelnumber" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3">3</a> and
<a class="totri-footnote" data-type="xref" data-xrefstyle="select:labelnumber" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4">4</a>, but for now, we should note that these are most often either <code>class</code> or <code>interface</code> definitions.</p>

<p>Within the definition of a reference type, we will encounter <em>members</em>
such as <em>fields</em>, <em>methods</em>, and <em>constructors</em>. Methods are the most
important kind of member. <a data-primary="statements" data-type="indexterm" id="3_idm45941144081384"></a>Methods are blocks of Java code composed of
<em>statements</em>.</p>

<p>With these basic terms defined, let鈥檚 start by approaching a Java
program from the bottom up by examining the basic units of syntax鈥攐ften
referred to as <em>lexical tokens</em>.</p>
</div></section>













<section data-pdf-bookmark="Lexical Structure" data-type="sect1"><div class="sect1" id="idm45941144079064">
<h1>Lexical Structure</h1>

<p><a data-primary="Java programs" data-secondary="lexical structure of" data-type="indexterm" id="3_ix_ch02-asciidoc1"></a><a data-primary="lexical structure" data-secondary="of Java program" data-type="indexterm" id="3_ix_ch02-asciidoc2"></a><a data-primary="syntax, Java" data-secondary="lexical structure of Java program" data-type="indexterm" id="3_ix_ch02-asciidoc3"></a>This section explains the lexical structure of a Java program. It
starts with a discussion of the Unicode character set in which Java
programs are written. It then covers the tokens that comprise a Java
program, explaining comments, identifiers, reserved words, literals, and
so on.</p>








<section data-pdf-bookmark="The Unicode Character Set" data-type="sect2"><div class="sect2" id="idm45941144073384">
<h2>The Unicode Character Set</h2>

<p><a data-primary="character sets" data-type="indexterm" id="3_idm45941144072248"></a><a data-primary="lexical structure" data-secondary="Unicode character set" data-type="indexterm" id="3_idm45941144071544"></a><a data-primary="syntax, Java" data-secondary="Unicode character set" data-type="indexterm" id="3_idm45941144070600"></a><a data-primary="Unicode character set" data-type="indexterm" id="3_idm45941144069656"></a>Java programs are written using Unicode. You can use Unicode
characters anywhere in a Java program, including comments and
identifiers such as variable names. Unlike the 7-bit ASCII character
set, which is useful only for English, and the 8-bit ISO Latin-1
character set, which is useful only for major Western European
languages, the Unicode character set can represent virtually every
written language in common use on the planet.</p>
<div data-type="tip"><h6>Tip</h6>
<p>If you do not use a Unicode-enabled text editor, or if you do not want
to force other programmers who view or edit your code to use a
Unicode-enabled editor, you can embed Unicode characters into your Java
programs using the special <a data-primary="escape sequences" data-secondary="Unicode characters" data-type="indexterm" id="3_idm45941144067176"></a>Unicode escape sequence <code>\u<em>xxxx</em></code>鈥攖hat is, a backslash and a lowercase u, followed by four hexadecimal
characters. For example, <code>\u0020</code> is the space character, and <code>\u03c0</code>
is the character 蟺.</p>
</div>

<p>Java has invested a large amount of time and engineering effort in
ensuring that its Unicode support is first class. If your business
application needs to deal with global users, especially in non-Western
markets, then the Java platform is a great choice.
Java also has support for multiple encodings and character sets, in case applications need to interact with non-Java applications that do not speak Unicode.</p>
</div></section>













<section data-pdf-bookmark="Case Sensitivity and Whitespace" data-type="sect2"><div class="sect2" id="idm45941144063192">
<h2>Case Sensitivity and Whitespace</h2>

<p><a data-primary="case sensitivity" data-type="indexterm" id="3_idm45941144062024"></a><a data-primary="lexical structure" data-secondary="case sensitivity" data-type="indexterm" id="3_idm45941144061160"></a><a data-primary="lexical structure" data-secondary="whitespace" data-type="indexterm" id="3_idm45941144060216"></a><a data-primary="syntax, Java" data-secondary="case sensitivity" data-type="indexterm" id="3_idm45941144059272"></a><a data-primary="syntax, Java" data-secondary="whitespace" data-type="indexterm" id="3_idm45941144058328"></a><a data-primary="whitespace" data-type="indexterm" id="3_idm45941144057384"></a>Java is a case-sensitive language. Its keywords are written in
lowercase and must always be used that way. That is, <code>While</code> and <code>WHILE</code>
are not the same as the <code>while</code> keyword. Similarly, if you declare a
variable named <code>i</code> in your program, you may not refer to it as <code>I</code>.</p>
<div data-type="tip"><h6>Tip</h6>
<p>In general, relying on case sensitivity to distinguish identifiers is a
terrible idea. Do not use it in your own code, and in particular never
give an identifier the same name as a keyword but differently cased.</p>
</div>

<p>Java ignores spaces, tabs, newlines, and other whitespace, except when
it appears within quoted characters and string literals. Programmers
typically use whitespace to format and indent their code for easy
readability, and you will see common indentation conventions in this book鈥檚 code
examples.</p>
</div></section>













<section data-pdf-bookmark="Comments" data-type="sect2"><div class="sect2" id="idm45941144051992">
<h2>Comments</h2>

<p><a data-primary="comments, in Java programs" data-type="indexterm" id="3_idm45941144050552"></a><a data-primary="lexical structure" data-secondary="comments" data-type="indexterm" id="3_idm45941144049832"></a><a data-primary="syntax, Java" data-secondary="comments" data-type="indexterm" id="3_idm45941144048888"></a>Comments are natural-language text intended for human readers of a
program. They are ignored by the Java compiler. Java supports three
types of comments. <a data-primary="/ (slash)" data-secondary="// in single-line comments" data-type="indexterm" id="3_idm45941144047640"></a>The first type is a single-line comment, which
begins with the characters <code>//</code> and continues until the end of the
current line. For example:</p>

<pre class="pre " data-code-language="java" data-type="programlisting"><code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code>   <code class="c1">// Initialize the loop variable</code></pre>

<p><a data-primary="* (asterisk)" data-secondary="in multiline comments" data-type="indexterm" id="3_idm45941144038568"></a><a data-primary="/ (slash)" data-secondary="/* */ in multiline comments" data-type="indexterm" id="3_idm45941144037496"></a>The second kind of comment is a multiline comment. It begins with the
characters <code>/*</code> and continues, over any number of lines, until the
characters <code>*/</code>. Any text between the <code>/*</code> and the <code>*/</code> is ignored by
<code>javac</code>. Although this style of comment is typically used for multiline
comments, it can also be used for single-line comments. This type of
comment cannot be nested (i.e., one <code>/* */</code> comment cannot appear within
another). When writing multiline comments, programmers often use extra
<code>*</code> characters to make the comments stand out. Here is a typical
multiline comment:</p>

<pre data-code-language="java" data-type="programlisting"><code class="cm">/*</code>
<code class="cm"> * First, establish a connection to the server.</code>
<code class="cm"> * If the connection attempt fails, quit right away.</code>
<code class="cm"> */</code></pre>

<p>The third type of comment is a special case of the second. <a data-primary="/ (slash)" data-secondary="/** */ in doc comments" data-type="indexterm" id="3_idm45941144026904"></a><a data-primary="doc comments" data-type="indexterm" id="3_idm45941144026056"></a>If a comment
begins with <code>/**</code>, it is regarded as a special <em>doc comment</em>. Like
regular multiline comments, doc comments end with <code>*/</code> and cannot be
nested. When you write a Java class you expect other programmers to use,
provide doc comments to embed documentation about the class and each of its
methods directly into the source code. <a data-primary="javadoc" data-type="indexterm" id="3_idm45941143985352"></a>A program named <code>javadoc</code>
extracts these comments and processes them to create online
documentation for your class. A doc comment can contain HTML tags and
can use additional syntax understood by <code>javadoc</code>. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="cm">/**</code>
<code class="cm"> * Upload a file to a web server.</code>
<code class="cm"> *</code>
<code class="cm"> * @param file The file to upload.</code>
<code class="cm"> * @return &lt;tt&gt;true&lt;/tt&gt; on success,</code>
<code class="cm"> *         &lt;tt&gt;false&lt;/tt&gt; on failure.</code>
<code class="cm"> * @author David Flanagan</code>
<code class="cm"> */</code></pre>

<p>See <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch07.html#javanut7-CHP-7">Chapter 7</a> for more information on the doc comment syntax and <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch13.html#javanut7-CHP-13">Chapter 13</a> for more information on the <code>javadoc</code> program.</p>

<p>Comments may appear between any tokens of a Java program, but may not
appear within a token. In particular, comments may not appear within
double-quoted string literals. A comment within a string literal simply
becomes a literal part of that string.</p>
</div></section>













<section data-pdf-bookmark="Reserved Words" data-type="sect2"><div class="sect2" id="idm45941143994296">
<h2>Reserved Words</h2>

<p><a data-primary="lexical structure" data-secondary="reserved words" data-type="indexterm" id="3_idm45941143992856"></a><a data-primary="reserved words" data-type="indexterm" id="3_idm45941143991880"></a><a data-primary="syntax, Java" data-secondary="reserved words" data-type="indexterm" id="3_idm45941143991208"></a>The following words are reserved in Java (they are part of the syntax
of the language and may not be used to name variables, classes, and so
forth):</p>

<pre data-type="programlisting">abstract   const      final        int         public        throw
assert     continue   finally      interface   return        throws
boolean    default    float        long        short         transient
break      do         for          native      static        true
byte       double     goto         new         strictfp      try
case       else       if           null        super         void
catch      enum       implements   package     switch        volatile
char       extends    import       private     synchronized  while
class      false      instanceof   protected   this</pre>

<p>Of these, <code>true</code>, <code>false,</code> and <code>null</code> are technically literals.
The sequence <code>var</code> is not a keyword, but instead indicates that the type of a local variable should be type-inferred.
<a data-primary="_ (underscore)" data-type="indexterm" id="3_idm45941143959880"></a>The character sequence consisting of a single underscore, <code>_</code>, is also disallowed as an identifier.
<a data-primary="restricted keywords" data-type="indexterm" id="3_idm45941143958664"></a>There are also 10 <em>restricted keywords</em> which are only considered keywords within the context of declaring a Java platform module.</p>

<p>We鈥檒l meet each of these reserved words again later in this book. Some
of them are the names of primitive types and others are the names of
Java statements, both of which are discussed later in this chapter.
Still others are used to define classes and their members (see
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3">Chapter 3</a>).</p>

<p>Note that <code>const</code> and <code>goto</code> are reserved but aren鈥檛 actually used in
the language, and that <code>interface</code> has an additional variant
form鈥?code&gt;@interface</code>, which is used when defining types known as
annotations. Some of the reserved words (notably <code>final</code> and <code>default</code>)
have a variety of meanings depending on context.</p>
</div></section>













<section data-pdf-bookmark="Identifiers" data-type="sect2"><div class="sect2" id="idm45941143952552">
<h2>Identifiers</h2>

<p><a data-primary="identifiers" data-type="indexterm" id="3_idm45941143951080"></a><a data-primary="lexical structure" data-secondary="identifiers" data-type="indexterm" id="3_idm45941143950376"></a><a data-primary="syntax, Java" data-secondary="identifiers" data-type="indexterm" id="3_idm45941143949432"></a>An <em>identifier</em> is simply a name given to some part of a Java program,
such as a class, a method within a class, or a variable declared within
a method. Identifiers may be of any length and may contain letters and
digits drawn from the entire Unicode character set. An identifier may
not begin with a digit.</p>

<p>In general, identifiers may not contain punctuation characters.
Exceptions include the dollar sign (<code>$</code>) as well as other Unicode currency symbols such as <code>拢</code> and <code>楼</code>.</p>

<p>The ASCII underscore (<code>_</code>) also deserves special mention.
Originally, the underscore could be freely used as an identifier, or part of one.
However, in recent versions of Java, including Java 11, the underscore may not be used as an identifier.</p>

<p>The underscore character can still appear in a Java identifier, but it is no longer legal as a complete identifier by itself.
This is to support an expected forthcoming language feature whereby the underscore will acquire a special new syntactic meaning.</p>
<div data-type="tip"><h6>Tip</h6>
<p><a data-primary="currency symbols in identifiers" data-type="indexterm" id="3_idm45941143925176"></a>Currency symbols are intended for use in automatically generated source
code, such as code produced by <code>javac</code>. By avoiding the use of currency
symbols in your own identifiers, you don鈥檛 have to worry about
collisions with automatically generated identifiers.</p>
</div>

<p><a data-primary="camel case" data-type="indexterm" id="3_idm45941143923256"></a>The usual Java convention is to name variables using <em>camel case</em>.
This means that the first letter of a variable should be lowerase, but that the first letter of any other words in the identifier should be uppercase.</p>

<p><a data-primary="isJavaIdentifierPart(): Character" data-type="indexterm" id="3_idm45941143921512"></a><a data-primary="isJavaIdentifierStart(): Character" data-type="indexterm" id="3_idm45941143920792"></a>Formally, the characters allowed at the beginning of and within an
identifier are defined by the methods <code>isJavaIdentifierStart()</code> and
<code>isJavaIdentifierPart()</code> of the class <code>java.lang.Character</code>.</p>

<p>The following are examples of legal identifiers:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">i</code>    <code class="n">x1</code>    <code class="n">theCurrentTime</code>    <code class="n">current</code>    <code class="err">鐛?/code&gt;</pre>

<p><a data-primary="Kanji character (in Java identifier)" data-type="indexterm" id="3_idm45941143914312"></a>Note in particular the example of a UTF-8 identifier, <code>鐛?/code&gt;. This is the
Kanji character for 鈥渙tter鈥?and is perfectly legal as a Java identifier.
The usage of non-ASCII identifiers is unusual in programs predominantly
written by Westerners, but is sometimes seen.</p>
</div></section>













<section data-pdf-bookmark="Literals" data-type="sect2"><div class="sect2" id="idm45941143951928">
<h2>Literals</h2>

<p><a data-primary="lexical structure" data-secondary="literals" data-type="indexterm" id="3_idm45941143889768"></a><a data-primary="literals" data-type="indexterm" id="3_idm45941143888600"></a><a data-primary="syntax, Java" data-secondary="literals" data-type="indexterm" id="3_idm45941143887928"></a><a data-primary="UTF-8 identifier" data-type="indexterm" id="3_idm45941143911400"></a>Literals are sequences of source characters that directly represent constant values that appear as-is in Java source code.
They include integer and floating-point numbers, single characters within
single quotes, strings of characters within double quotes, and the
reserved words <code>true</code>, <code>false</code>, and <code>null</code>. <a data-primary='&quot; (quotes, double)' data-secondary="literals in" data-type="indexterm" id="3_idm45941143909032"></a><a data-primary="&apos; (quotes, single)" data-secondary="literals in" data-type="indexterm" id="3_idm45941143908024"></a>For example, the following are all literals:</p>

<pre data-code-language="java" data-type="programlisting"><code class="mi">1</code>    <code class="mf">1.0</code>    <code class="sc">1</code>    <code class="mi">1L</code>    <code class="s">one</code>    <code class="kc">true</code>    <code class="kc">false</code>    <code class="kc">null</code></pre>

<p>The syntax for expressing numeric, character, and string literals is
detailed in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2-SECT-3">鈥淧rimitive Data Types鈥?/a&gt;.</p>
</div></section>













<section data-pdf-bookmark="Punctuation" data-type="sect2"><div class="sect2" id="idm45941143899560">
<h2>Punctuation</h2>

<p><a data-primary="lexical structure" data-secondary="punctuation" data-type="indexterm" id="3_idm45941143896568"></a><a data-primary="punctuation characters as tokens" data-type="indexterm" id="3_idm45941143895432"></a><a data-primary="syntax, Java" data-secondary="punctuation" data-type="indexterm" id="3_idm45941143894760"></a>Java also uses a number of punctuation characters as tokens. The Java
Language Specification divides these characters (somewhat arbitrarily) into two categories, separators and operators. <a data-primary=", (comma) separators (tokens)" data-type="indexterm" id="3_idm45941143863352"></a><a data-primary="; (semicolon)" data-secondary="separators (tokens)" data-type="indexterm" id="3_idm45941143862712"></a><a data-primary=":: (colons) separators (tokens)" data-type="indexterm" id="3_idm45941143861768"></a><a data-primary=". (dot)" data-secondary="separators (tokens)" data-type="indexterm" id="3_idm45941143861128"></a><a data-primary="鈥?(ellipses)" data-secondary="separators (tokens)" data-type="indexterm" id="3_idm45941143860184"></a><a data-primary="( ) (parentheses)" data-secondary="separators (tokens)" data-type="indexterm" id="3_idm45941143859240"></a><a data-primary="@ (at sign)" data-secondary="separators (tokens)" data-type="indexterm" id="3_idm45941143858296"></a><a data-primary="{ } (curly braces)" data-secondary="separators (tokens)" data-type="indexterm" id="3_idm45941143857352"></a><a data-primary="separators" data-type="indexterm" id="3_idm45941143856408"></a>The 12
separators are:</p>

<pre data-code-language="java" data-type="programlisting"><code class="o">(</code>   <code class="o">)</code>   <code class="o">{</code>   <code class="o">}</code>   <code class="o">[</code>   <code class="o">]</code>

<code class="o">...</code> <code class="err">@</code> <code class="o">::</code>

<code class="o">;</code>  <code class="o">,</code>   <code class="o">.</code></pre>

<p><a data-primary="operators" data-type="indexterm" id="3_idm45941143802296"></a>The operators are:</p>

<pre data-code-language="java" data-type="programlisting"><code class="o">+</code>   <code class="err">鈥?/code&gt;   <code class="o">*</code>    <code class="o">/</code>    <code class="o">%</code>    <code class="o">&amp;</code>   <code class="o">|</code>    <code class="o">^</code>    <code class="o">&lt;&lt;</code>   <code class="o">&gt;&gt;</code>   <code class="o">&gt;&gt;&gt;</code>
<code class="o">+=</code>   <code class="o">-=</code>   <code class="o">*=</code>   <code class="o">/=</code>   <code class="o">%=</code>   <code class="o">&amp;=</code>  <code class="o">|=</code>   <code class="o">^=</code>   <code class="o">&lt;&lt;=</code>  <code class="o">&gt;&gt;=</code>  <code class="o">&gt;&gt;&gt;=</code>
<code class="o">=</code>    <code class="o">==</code>   <code class="o">!=</code>   <code class="o">&lt;</code>    <code class="o">&lt;=</code>   <code class="o">&gt;</code>    <code class="o">&gt;=</code>
<code class="o">!</code>    <code class="o">~</code>    <code class="o">&amp;&amp;</code>  <code class="o">||</code>   <code class="o">++</code>   <code class="o">--</code>   <code class="o">?</code>    <code class="o">:</code>   <code class="o">-&gt;</code></pre>

<p>We鈥檒l see separators throughout the book, and will cover each operator
individually in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2-SECT-4">鈥淓xpressions and Operators鈥?/a&gt;.<a data-startref="ix_ch02-asciidoc3" data-type="indexterm" id="3_idm45941143745192"></a><a data-startref="ix_ch02-asciidoc2" data-type="indexterm" id="3_idm45941143744520"></a><a data-startref="ix_ch02-asciidoc1" data-type="indexterm" id="3_idm45941143743848"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Primitive Data Types" data-type="sect1"><div class="sect1" id="javanut7-CHP-2-SECT-3">
<h1>Primitive Data Types</h1>

<p><a data-primary="data types" data-secondary="primitive" data-type="indexterm" id="3_ix_ch02-asciidoc4"></a><a data-primary="primitive types" data-type="indexterm" id="3_ix_ch02-asciidoc5"></a><a data-primary="syntax, Java" data-secondary="primitive data types" data-type="indexterm" id="3_ix_ch02-asciidoc6"></a>Java supports eight basic data types known as <em>primitive types</em> as
described in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2-TABLE-1">Table 2-1</a>. The primitive
types include a Boolean type, a character type, four integer types, and
two floating-point types. The four integer types and the two
floating-point types differ in the number of bits that represent them
and therefore in the range of numbers they can represent.</p>
<table id="javanut7-CHP-2-TABLE-1">
<caption><span class="label">Table 2-1. </span>Java primitive data types</caption>
<thead>
<tr>
<th>Type</th>
<th>Contains</th>
<th>Default</th>
<th>Size</th>
<th>Range</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><code>boolean</code></p></td>
<td><p><code>true</code> or <code>false</code></p></td>
<td><p><code>false</code></p></td>
<td><p>1 bit</p></td>
<td><p>NA</p></td>
</tr>
<tr>
<td><p><code>char</code></p></td>
<td><p>Unicode character</p></td>
<td><p><code>\u0000</code></p></td>
<td><p>16 bits</p></td>
<td><p><code>\u0000</code> to <code>\uFFFF</code></p></td>
</tr>
<tr>
<td><p><code>byte</code></p></td>
<td><p>Signed integer</p></td>
<td><p>0</p></td>
<td><p>8 bits</p></td>
<td><p>鈥?28 to 127</p></td>
</tr>
<tr>
<td><p><code>short</code></p></td>
<td><p>Signed integer</p></td>
<td><p>0</p></td>
<td><p>16 bits</p></td>
<td><p>鈥?2768 to 32767</p></td>
</tr>
<tr>
<td><p><code>int</code></p></td>
<td><p>Signed integer</p></td>
<td><p>0</p></td>
<td><p>32 bits</p></td>
<td><p>鈥?147483648 to 2147483647</p></td>
</tr>
<tr>
<td><p><code>long</code></p></td>
<td><p>Signed integer</p></td>
<td><p>0</p></td>
<td><p>64 bits</p></td>
<td><p>鈥?223372036854775808 to
9223372036854775807</p></td>
</tr>
<tr>
<td><p><code>float</code></p></td>
<td><p>IEEE 754 floating point</p></td>
<td><p>0.0</p></td>
<td><p>32 bits</p></td>
<td><p>1.4E鈥?5 to
3.4028235E+38</p></td>
</tr>
<tr>
<td><p><code>double</code></p></td>
<td><p>IEEE 754 floating point</p></td>
<td><p>0.0</p></td>
<td><p>64 bits</p></td>
<td><p>4.9E鈥?24 to
1.7976931348623157E+308</p></td>
</tr>
</tbody>
</table>

<p>The next section summarizes these primitive data types. In addition to
these primitive types, Java supports nonprimitive data types known as
reference types, which are introduced in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2-SECT-9">鈥淩eference Types鈥?/a&gt;.</p>








<section data-pdf-bookmark="The boolean Type" data-type="sect2"><div class="sect2" id="idm45941143681400">
<h2>The boolean Type</h2>

<p><a data-primary="boolean type" data-type="indexterm" id="3_idm45941143679960"></a><a data-primary="data types" data-secondary="boolean types" data-type="indexterm" id="3_idm45941143679256"></a><a data-primary="primitive types" data-secondary="boolean" data-type="indexterm" id="3_idm45941143678312"></a>The <code>boolean</code> type represents truth values. This type has only two
possible values, representing the two Boolean states: on or off, yes or
no, true or false. Java reserves the words <code>true</code> and <code>false</code> to
represent these two Boolean values.</p>

<p>Programmers coming to Java from other languages (especially JavaScript and C) should note that Java is much stricter about its Boolean values than
other languages; in particular, a <code>boolean</code> is neither an integral nor an
object type, and incompatible values cannot be used in place of a
<code>boolean</code>. In other words, you cannot take shortcuts such as the
following in Java:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Object</code> <code class="n">o</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Object</code><code class="o">();</code>
<code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">1</code><code class="o">;</code>

<code class="k">if</code> <code class="o">(</code><code class="n">o</code><code class="o">)</code> <code class="o">{</code>
  <code class="k">while</code><code class="o">(</code><code class="n">i</code><code class="o">)</code> <code class="o">{</code>
    <code class="c1">//...</code>
  <code class="o">}</code>
<code class="o">}</code></pre>

<p>Instead, Java forces you to write cleaner code by explicitly stating the
comparisons you want:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">if</code> <code class="o">(</code><code class="n">o</code> <code class="o">!=</code> <code class="kc">null</code><code class="o">)</code> <code class="o">{</code>
  <code class="k">while</code><code class="o">(</code><code class="n">i</code> <code class="o">!=</code> <code class="mi">0</code><code class="o">)</code> <code class="o">{</code>
    <code class="c1">// ...</code>
  <code class="o">}</code>
<code class="o">}</code></pre>
</div></section>













<section data-pdf-bookmark="The char Type" data-type="sect2"><div class="sect2" id="idm45941143632616">
<h2>The char Type</h2>

<p><a data-primary="char type" data-type="indexterm" id="3_idm45941143638184"></a><a data-primary="data types" data-secondary="char types" data-type="indexterm" id="3_idm45941143637256"></a><a data-primary="primitive types" data-secondary="char" data-type="indexterm" id="3_idm45941143595816"></a><a data-primary="Unicode character set" data-type="indexterm" id="3_idm45941143594872"></a>The <code>char</code> type represents Unicode characters. Java has a slightly
unique approach to representing characters鈥?code&gt;javac</code> accepts identifiers
and literals as UTF-8 (a variable-width encoding) in input.
<a data-primary="Latin-1 character set" data-type="indexterm" id="3_idm45941143593128"></a>However, internally, Java represents chars in a fixed-width encoding鈥攅ither a 16-bit encoding (before Java 9) or as ISO-8859-1 (an 8-bit encoding, used for Western European languages, also called Latin-1) if possible (Java 9 and later).</p>

<p>This distinction between external and internal representation does not normally need to concern the developer. <a data-primary="&apos; (quotes, single)" data-secondary="enclosing character literals" data-type="indexterm" id="3_idm45941143591656"></a>In most cases, all that is required is to remember the rule that to include a character literal in a Java program, simply place it between single quotes (apostrophes):</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">char</code> <code class="n">c</code> <code class="o">=</code> <code class="sc">A</code><code class="o">;</code></pre>

<p><a data-primary="\ (backslash)" data-secondary="in escape sequences" data-type="indexterm" id="3_idm45941143587736"></a><a data-primary="ASCII escape sequences" data-type="indexterm" id="3_idm45941143586888"></a>You can, of course, use any Unicode character as a character literal,
and you can use the <code>\u</code> Unicode escape sequence. In addition, Java
supports a number of other escape sequences that make it easy both to
represent commonly used nonprinting ASCII characters, such as <code>newline,</code>
and to escape certain punctuation characters that have special meaning
in Java. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">char</code> <code class="n">tab</code> <code class="o">=</code> <code class="sc">\t</code><code class="o">,</code> <code class="n">nul</code> <code class="o">=</code> <code class="err">&apos;\</code><code class="mi">000</code><code class="err">&apos;</code><code class="o">,</code> <code class="n">aleph</code> <code class="o">=</code> <code class="sc">\u05D0</code><code class="o">,</code> <code class="n">slash</code> <code class="o">=</code> <code class="sc">\\</code><code class="o">;</code></pre>

<p><a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2-TABLE-2">Table 2-2</a> lists the escape characters that can be used in <code>char</code> literals. <a data-primary='&quot; (quotes, double)' data-secondary="escaping in char literals" data-type="indexterm" id="3_idm45941143551544"></a><a data-primary="&apos; (quotes, single)" data-secondary="escaping in char literals" data-type="indexterm" id="3_idm45941143511448"></a><a data-primary="\\ (backslash)" data-secondary="\\ escape sequence in char literals" data-type="indexterm" id="3_idm45941143510536"></a><a data-primary="\b (escape sequence for backspace)" data-primary-sortas="b (escape sequence for backspace)" data-type="indexterm" id="3_idm45941143509624"></a><a data-primary="\f (form feed) escape sequence" data-primary-sortas="f (form feed) escape sequence" data-type="indexterm" id="3_idm45941143508648"></a><a data-primary="\n (newlines, escaping)" data-primary-sortas="n (newlines, escaping)" data-type="indexterm" id="3_idm45941143507672"></a><a data-primary="\r (carriage return) escape sequence" data-primary-sortas="r (carriage return) escape sequence" data-type="indexterm" id="3_idm45941143506728"></a><a data-primary="\t (tab)" data-primary-sortas="t (tab)" data-type="indexterm" id="3_idm45941143505752"></a><a data-primary="char type" data-secondary="escape characters in char literals" data-type="indexterm" id="3_idm45941143504808"></a><a data-primary="escape sequences" data-secondary="in char literals" data-type="indexterm" id="3_idm45941143503848"></a><a data-primary="Unicode character set" data-secondary="escaping in char literals" data-type="indexterm" id="3_idm45941143502904"></a><a data-primary="Unicode character set" data-secondary="supplementary characters" data-type="indexterm" id="3_idm45941143501944"></a>These characters can also be used in string literals, which are covered in the next section.</p>
<table id="javanut7-CHP-2-TABLE-2">
<caption><span class="label">Table 2-2. </span>Java escape characters</caption>
<thead>
<tr>
<th>Escape sequence</th>
<th>Character value</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><code>\b</code></p></td>
<td><p>Backspace</p></td>
</tr>
<tr>
<td><p><code>\t</code></p></td>
<td><p>Horizontal tab</p></td>
</tr>
<tr>
<td><p><code>\n</code></p></td>
<td><p>Newline</p></td>
</tr>
<tr>
<td><p><code>\f</code></p></td>
<td><p>Form feed</p></td>
</tr>
<tr>
<td><p><code>\r</code></p></td>
<td><p>Carriage return</p></td>
</tr>
<tr>
<td><p><code>\</code>&quot;</p></td>
<td><p>Double quote</p></td>
</tr>
<tr>
<td><p><code>\</code>&apos;</p></td>
<td><p>Single quote</p></td>
</tr>
<tr>
<td><p><code>\\</code></p></td>
<td><p>Backslash</p></td>
</tr>
<tr>
<td><p><code>\<em>xxx</em></code></p></td>
<td><p>The Latin-1 character with the encoding <em><code>xxx</code></em>, where <em><code>xxx</code></em> is an octal (base 8) number between 000 and 377. The forms <em><code>x</code></em> and <code>\<em>xx</em></code> are also legal, as in <em><code>\0</code></em>, but are not recommended because they can cause difficulties in string constants where the escape sequence is followed by a regular digit. This form is generally discouraged in favor of the <code>\uXXXX</code> form.</p></td>
</tr>
<tr>
<td><p><code>\u<em>xxxx</em></code></p></td>
<td><p>The Unicode character with encoding <em><code>xxxx</code></em>, where
<em><code>xxxx</code></em> is four hexadecimal digits. Unicode escapes can appear anywhere
in a Java program, not only in character and string literals.</p></td>
</tr>
</tbody>
</table>

<p><a data-primary="char type" data-secondary="conversion to other primitive types" data-type="indexterm" id="3_idm45941143460280"></a><code>char</code> values can be converted to and from the various integral types,
and the <code>char</code> data type is a 16-bit integral type. Unlike <code>byte</code>,
<code>short</code>, <code>int</code>, and <code>long</code>, however, <code>char</code> is an unsigned type. <a data-primary="char type" data-secondary="Character class, static method" data-type="indexterm" id="3_idm45941143455864"></a>The
<code>Character</code> class defines a number of useful <code>static</code> methods for
working with characters, including <code>isDigit()</code>, <code>isJavaLetter()</code>,
<code>isLowerCase()</code>, and <code>toUpperCase()</code>.</p>

<p>The Java language and its <code>char</code> type were designed with Unicode in
mind. The Unicode standard is evolving, however, and each new version of
Java adopts a new version of Unicode. Java 7 uses Unicode 6.0 and Java 8
uses Unicode 6.2.</p>

<p>Recent releases of Unicode include characters whose encodings, or
<em>codepoints</em>, do not fit in 16 bits. These supplementary characters,
which are mostly infrequently used Han (Chinese) ideographs, occupy 21
bits and cannot be represented in a single <code>char</code> value. Instead, you
must use an <code>int</code> value to hold the codepoint of a supplementary
character, or <a data-primary="char type" data-secondary="surrogate pair, Unicode supplementary characters" data-type="indexterm" id="3_idm45941143449224"></a><a data-primary="surrogate pairs (Unicode supplementary characters)" data-type="indexterm" id="3_idm45941143448264"></a>you must encode it into a so-called 鈥渟urrogate pair鈥?of
two <code>char</code> values.</p>

<p>Unless you commonly write programs that use Asian languages, you are
unlikely to encounter any supplementary characters. If you do anticipate
having to process characters that do not fit into a <code>char</code>, methods have
been added to the <code>Character</code>, <code>String</code>, and related classes for working
with text using <code>int</code> codepoints.</p>










<section data-pdf-bookmark="String literals" data-type="sect3"><div class="sect3" id="idm45941143444696">
<h3>String literals</h3>

<p><a data-primary="primitive types" data-secondary="String literals" data-type="indexterm" id="3_idm45941143443464"></a><a data-primary="string literals" data-type="indexterm" id="3_idm45941143442296"></a><a data-primary="strings" data-type="indexterm" id="3_idm45941143441624"></a>In addition to the <code>char</code> type, Java also has a data type for working
with strings of text (usually simply called <em>strings</em>). <a data-primary="String type, String literals vs." data-type="indexterm" id="3_idm45941143439880"></a><a data-primary="strings" data-secondary="String class" data-type="indexterm" id="3_idm45941143439176"></a>The <code>String</code>
type is a class, however, and is not one of the primitive types of the
language. Because strings are so commonly used, though, Java does have a
syntax for including string values literally in a program. <a data-primary='&quot; (quotes, double)' data-secondary="enclosing string literals" data-type="indexterm" id="3_idm45941143437464"></a><a data-primary="&apos; (quotes, single)" data-secondary="in string literals" data-type="indexterm" id="3_idm45941143436472"></a>A <code>String</code>
literal consists of arbitrary text within double quotes (as opposed to
the single quotes for <code>char</code> literals). For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="s">Hello World</code>
<code class="s">&apos;This&apos; is a string!</code></pre>

<p><a data-primary="escape sequences" data-secondary="in string literals" data-type="indexterm" id="3_idm45941143432280"></a>String literals can contain any of the escape sequences that can appear
as <code>char</code> literals (see <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2-TABLE-2">Table 2-2</a>). Use
the <code>\</code>&quot; sequence to include a double quote within a <code>String</code> literal.
Because <code>String</code> is a reference type, string literals are described in
more detail later in this chapter in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2-SECT-7.4">鈥淥bject Literals鈥?/a&gt;.
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch09.html#javanut7-CHP-9">Chapter 9</a> contains more details on some of the
ways you can work with <code>String</code> objects in Java.</p>
</div></section>



</div></section>













<section data-pdf-bookmark="Integer Types" data-type="sect2"><div class="sect2" id="idm45941143639064">
<h2>Integer Types</h2>

<p><a data-primary="byte type" data-type="indexterm" id="3_idm45941143401848"></a><a data-primary="data types" data-secondary="integer types" data-type="indexterm" id="3_idm45941143400984"></a><a data-primary="int type" data-type="indexterm" id="3_idm45941143400040"></a><a data-primary="integer types" data-type="indexterm" id="3_idm45941143399368"></a><a data-primary="long type" data-type="indexterm" id="3_idm45941143398696"></a><a data-primary="primitive types" data-secondary="integer types" data-type="indexterm" id="3_idm45941143398024"></a><a data-primary="short type" data-type="indexterm" id="3_idm45941143428184"></a>The integer types in Java are <code>byte</code>, <code>short</code>, <code>int</code>, and <code>long</code>. As
shown in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2-TABLE-1">Table 2-1</a>, these four types
differ only in the number of bits and, therefore, in the range of
numbers each type can represent. All integral types represent signed
numbers; there is no <code>unsigned</code> keyword as there is in C and C++.</p>

<p>Literals for each of these types are written exactly as you would
expect: as a sequence of decimal digits, optionally preceded by a minus
sign.<sup><a class="totri-footnote" data-type="noteref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#idm45941143423768" id="idm45941143423768-marker">1</a></sup> Here are some legal
integer literals:</p>

<pre data-code-language="java" data-type="programlisting"><code class="mi">0</code>
<code class="mi">1</code>
<code class="mi">123</code>
<code class="o">-</code><code class="mi">42000</code></pre>

<p><a data-primary="int type" data-secondary="32-bit int values" data-type="indexterm" id="3_idm45941143420056"></a><a data-primary="integer literals" data-type="indexterm" id="3_idm45941143419096"></a><a data-primary="long type" data-secondary="64-bit long values" data-type="indexterm" id="3_idm45941143418456"></a>Integer literals are 32-bit values (and so are taken to be the Java type <code>int</code>) unless they end with the character <code>L</code> or <code>l</code>, in which case they are 64-bit values (and are understood to be the Java type <code>long</code>):</p>

<pre data-code-language="java" data-type="programlisting"><code class="mi">1234</code>        <code class="c1">// An int value</code>
<code class="mi">1234L</code>       <code class="c1">// A long value</code>
<code class="mh">0xff</code><code class="n">L</code>       <code class="c1">// Another long value</code></pre>

<p>Integer literals can also be expressed in hexadecimal, binary, or octal
notation. A literal that begins with <code>0x</code> or <code>0X</code> is taken as a
hexadecimal number, using the letters <code>A</code> to <code>F</code> (or <code>a</code> to <code>f</code>) as the
additional digits required for base-16 numbers.</p>

<p>Integer binary literals start with <code>0b</code> and may, of course, only feature
the digits 1 or 0. As binary literals can be very long, underscores are
often used as part of a binary literal. The underscore character is
ignored whenever it is encountered in any numerical literal鈥攊t鈥檚 allowed
purely to help with readability of literals.</p>

<p>Java also supports octal (base-8) integer literals. These literals begin
with a leading <code>0</code> and cannot include the digits 8 or 9. They are not
often used and should be avoided unless needed. Legal hexadecimal,
binary, and octal literals include:</p>

<pre data-code-language="java" data-type="programlisting"><code class="mh">0xff</code>              <code class="c1">// Decimal 255, expressed in hexadecimal</code>
<code class="mi">0377</code>              <code class="c1">// The same number, expressed in octal (base 8)</code>
<code class="mi">0</code><code class="n">b0010_1111</code>       <code class="c1">// Decimal 47, expressed in binary</code>
<code class="mh">0xCAFEBABE</code>        <code class="c1">// A magic number used to identify Java class files</code></pre>

<p><a data-primary="integer types" data-secondary="integer arithmetic" data-type="indexterm" id="3_idm45941148491528"></a><a data-primary="integer types" data-secondary="integer overflow" data-type="indexterm" id="3_idm45941148490680"></a><a data-primary="overflow, integer arithmetic and" data-type="indexterm" id="3_idm45941148507192"></a><a data-primary="underflow, integer arithmetic and" data-type="indexterm" id="3_idm45941148506552"></a>Integer arithmetic in Java never produces an overflow or an underflow
when you exceed the range of a given integer type. Instead, numbers just
wrap around. For example, let鈥檚 look at an overflow:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">byte</code> <code class="n">b1</code> <code class="o">=</code> <code class="mi">127</code><code class="o">,</code> <code class="n">b2</code> <code class="o">=</code> <code class="mi">1</code><code class="o">;</code>        <code class="c1">// Largest byte is 127</code>
<code class="kt">byte</code> <code class="n">sum</code> <code class="o">=</code> <code class="o">(</code><code class="kt">byte</code><code class="o">)(</code><code class="n">b1</code> <code class="o">+</code> <code class="n">b2</code><code class="o">);</code>   <code class="c1">// Sum wraps to -128, the smallest byte</code></pre>

<p>and the corresponding underflow behavior:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">byte</code> <code class="n">b3</code> <code class="o">=</code> <code class="o">-</code><code class="mi">128</code><code class="o">,</code> <code class="n">b4</code> <code class="o">=</code> <code class="mi">5</code><code class="o">;</code>        <code class="c1">// Smallest byte is -128</code>
<code class="kt">byte</code> <code class="n">sum2</code> <code class="o">=</code> <code class="o">(</code><code class="kt">byte</code><code class="o">)(</code><code class="n">b3</code> <code class="o">-</code> <code class="n">b4</code><code class="o">);</code>   <code class="c1">// Sum wraps to a large byte value, 123</code></pre>

<p>Neither the Java compiler nor the Java interpreter warns you in any way
when this occurs. When doing integer arithmetic, you simply must ensure
that the type you are using has a sufficient range for the purposes you
intend. <a data-primary="ArithmeticException" data-type="indexterm" id="3_idm45941148424632"></a><a data-primary="byte type" data-secondary="Byte class" data-type="indexterm" id="3_idm45941148380840"></a><a data-primary="int type" data-secondary="Integer class" data-type="indexterm" id="3_idm45941148379960"></a><a data-primary="integer types" data-secondary="wrapper classes" data-type="indexterm" id="3_idm45941148379016"></a><a data-primary="long type" data-secondary="Long class" data-type="indexterm" id="3_idm45941148378072"></a><a data-primary="short type" data-type="indexterm" id="3_idm45941148377128"></a>Integer division by zero and modulo by zero are illegal and cause an <code>ArithmeticException</code> to be thrown.</p>

<p><a data-primary="floating-point types" data-secondary="wrapper classes" data-type="indexterm" id="3_idm45941148375624"></a>Each integer type has a corresponding wrapper class: <code>Byte</code>, <code>Short</code>,
<code>Integer</code>, and <code>Long</code>. <a data-primary="MAX_VALUE constant" data-secondary="integer type wrapper classes" data-type="indexterm" id="3_idm45941148372392"></a><a data-primary="MIN_VALUE constant" data-secondary="integer type wrapper classes" data-type="indexterm" id="3_idm45941148371416"></a>Each of these classes defines <code>MIN_VALUE</code> and
<code>MAX_VALUE</code> constants that describe the range of the type. <a data-primary="strings" data-secondary="converting to integer values" data-type="indexterm" id="3_idm45941148369544"></a>The classes
also define useful static methods, such as <code>Byte.parseByte()</code> and
<code>Integer.parseInt()</code>, for converting strings to integer <span class="keep-together">values</span>.</p>
</div></section>













<section data-pdf-bookmark="Floating-Point Types" data-type="sect2"><div class="sect2" id="idm45941143402824">
<h2>Floating-Point Types</h2>

<p><a data-primary="data types" data-secondary="floating-point types" data-type="indexterm" id="3_ix_ch02-asciidoc7"></a><a data-primary="floating-point types" data-type="indexterm" id="3_ix_ch02-asciidoc8"></a><a data-primary="primitive types" data-secondary="floating-point types" data-type="indexterm" id="3_ix_ch02-asciidoc9"></a>Real numbers in Java are represented by the <code>float</code> <a data-primary="double type" data-type="indexterm" id="3_idm45941148360984"></a><a data-primary="floating-point types" data-secondary="double type" data-type="indexterm" id="3_idm45941148360248"></a><a data-primary="floating-point types" data-secondary="float type" data-type="indexterm" id="3_idm45941148359304"></a>and <code>double</code> data
types. As shown in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2-TABLE-1">Table 2-1</a>, <code>float</code> is
a 32-bit, single-precision floating-point value, and <code>double</code> is a
64-bit, double-precision floating-point value. Both types adhere to
the IEEE 754-1985 standard, which specifies both the format of the
numbers and the behavior of arithmetic for the numbers.</p>

<p>Floating-point values can be included literally in a Java program as an
optional string of digits, followed by a decimal point and another
string of digits. Here are some examples:</p>

<pre data-code-language="java" data-type="programlisting"><code class="mf">123.45</code>
<code class="mf">0.0</code>
<code class="o">.</code><code class="mi">01</code></pre>

<p>Floating-point literals can also use exponential, or scientific,
notation, in which a number is followed by the letter <code>e</code> or <code>E</code> (for
exponent) and another number. This second number represents the power of
10 by which the first number is multiplied. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="mf">1.2345E02</code>    <code class="c1">// 1.2345 * 10^2 or 123.45</code>
<code class="mi">1</code><code class="n">e</code><code class="o">-</code><code class="mi">6</code>         <code class="c1">// 1 * 10^-6 or 0.000001</code>
<code class="mf">6.02e23</code>      <code class="c1">// Avogadro&apos;s Number: 6.02 * 10^23</code></pre>

<p>Floating-point literals are <code>double</code> values by default. To include a
<code>float</code> value literally in a program, follow the number with <code>f</code> or <code>F</code>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">double</code> <code class="n">d</code> <code class="o">=</code> <code class="mf">6.02E23</code><code class="o">;</code>
<code class="kt">float</code> <code class="n">f</code> <code class="o">=</code> <code class="mf">6.02e23f</code><code class="o">;</code></pre>

<p>Floating-point literals cannot be expressed in hexadecimal, binary, or
octal notation.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45941148284440">
<h5>Floating-Point Representations</h5>
<p><a data-primary="floating-point types" data-secondary="as approximations" data-type="indexterm" id="3_idm45941148283432"></a>Most real numbers, by their very nature, cannot be represented exactly
in any finite number of bits. Thus, it is important to remember that
<code>float</code> and <code>double</code> values are only approximations of the numbers they
are meant to represent. A <code>float</code> is a 32-bit approximation, which
results in at least six significant decimal digits, and a <code>double</code> is a
64-bit approximation, which results in at least 15 significant digits.
In <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch09.html#javanut7-CHP-9">Chapter 9</a>, we will cover floating-point
representations in more detail.</p>
</div></aside>

<p><a data-primary="0 (zero)" data-secondary="represented by float and double types" data-type="indexterm" id="3_idm45941148251784"></a><a data-primary="exponential notation" data-type="indexterm" id="3_idm45941148250616"></a><a data-primary="floating-point types" data-secondary="floating-point literals" data-type="indexterm" id="3_idm45941148249944"></a><a data-primary="infinity" data-secondary="positive and negative" data-type="indexterm" id="3_idm45941148249000"></a><a data-primary="negative infinity" data-type="indexterm" id="3_idm45941148248056"></a><a data-primary="positive infinity" data-type="indexterm" id="3_idm45941148247384"></a><a data-primary="scientific notation" data-type="indexterm" id="3_idm45941148246712"></a><a data-primary="zero (0)" data-secondary="represented by float and double types" data-type="indexterm" id="3_idm45941148246040"></a>In addition to representing ordinary numbers, the <code>float</code> and <code>double</code>
types can also represent four special values: positive and negative
infinity, zero, and NaN. The infinity values result when a
floating-point computation produces a value that overflows the
representable range of a <code>float</code> or <code>double</code>.</p>

<p>When a floating-point computation underflows the representable range of a <code>float</code> or a <code>double</code>, a zero value results.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>We can imagine repeatedly dividing the double value <code>1.0</code> by <code>2.0</code> (e.g., in a <code>while</code> loop). In mathematics, no matter how often we perform the division, the result will never become equal to zero. However, in a floating-point representation, after enough divisions, the result will eventually be so small as to be indistinguishable from zero.</p>
</div>

<p><a data-primary="0 (zero)" data-secondary="negative and positive zero" data-type="indexterm" id="3_idm45941148238840"></a><a data-primary="negative zero" data-type="indexterm" id="3_idm45941148237896"></a><a data-primary="positive zero" data-type="indexterm" id="3_idm45941148220440"></a><a data-primary="zero (0)" data-secondary="positive and negative zero" data-type="indexterm" id="3_idm45941148219768"></a>The Java floating-point types make a distinction between positive
zero and negative zero, depending on the direction from which the
underflow occurred. In practice, positive and negative zero behave
pretty much the same. <a data-primary="NaN (Not a number)" data-type="indexterm" id="3_idm45941148218488"></a>Finally, the last special floating-point value is
NaN, which stands for 鈥淣ot-a-Number.鈥?The NaN value results when an
illegal floating-point operation, such as 0.0/0.0, is performed. Here
are examples of statements that result in these special values:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">double</code> <code class="n">inf</code> <code class="o">=</code> <code class="mf">1.0</code><code class="o">/</code><code class="mf">0.0</code><code class="o">;</code>             <code class="c1">// Infinity</code>
<code class="kt">double</code> <code class="n">neginf</code> <code class="o">=</code> <code class="o">-</code><code class="mf">1.0</code><code class="o">/</code><code class="mf">0.0</code><code class="o">;</code>         <code class="c1">// Negative infinity</code>
<code class="kt">double</code> <code class="n">negzero</code> <code class="o">=</code> <code class="o">-</code><code class="mf">1.0</code><code class="o">/</code><code class="n">inf</code><code class="o">;</code>        <code class="c1">// Negative zero</code>
<code class="kt">double</code> <code class="n">NaN</code> <code class="o">=</code> <code class="mf">0.0</code><code class="o">/</code><code class="mf">0.0</code><code class="o">;</code>             <code class="c1">// Not a Number</code></pre>

<p><a data-primary="double type" data-secondary="conversions" data-type="indexterm" id="3_idm45941148141976"></a><a data-primary="double type" data-secondary="Double class" data-type="indexterm" id="3_idm45941148182248"></a><a data-primary="floating-point types" data-secondary="Double class" data-type="indexterm" id="3_idm45941148181336"></a><a data-primary="floating-point types" data-secondary="Float class" data-type="indexterm" id="3_idm45941148180392"></a><a data-primary="MAX_VALUE constant" data-secondary="Float and Double classes" data-type="indexterm" id="3_idm45941148179448"></a><a data-primary="MIN_VALUE constant" data-secondary="Float and Double classes" data-type="indexterm" id="3_idm45941148178536"></a><a data-primary="NEGATIVE_INFINITY constant, Float and Double classes" data-type="indexterm" id="3_idm45941148177624"></a><a data-primary="POSITIVE_INFINITY constant, Float and Double classes" data-type="indexterm" id="3_idm45941148176920"></a>The <code>float</code> and <code>double</code> primitive types have corresponding classes,
named <code>Float</code> and <code>Double</code>. Each of these classes defines the
following useful constants: <code>MIN_VALUE</code>, <code>MAX_VALUE</code>,
<code>NEGATIVE_INFINITY</code>, <code>POSITIVE_INFINITY</code>, and <code>NaN</code>.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Java floating-point types can handle overflow to infinity and underflow to zero and have a special NaN value. <a data-primary="floating-point types" data-secondary="floating-point arithmetic" data-type="indexterm" id="3_idm45941148171272"></a>This means floating-point arithmetic never throws exceptions, even when performing illegal operations, like dividing zero by zero or taking the square root of a negative number.</p>
</div>

<p>The infinite floating-point values behave as you would expect. Adding
or subtracting any finite value to or from infinity, for example, yields
infinity. <a data-primary="equality operator (==)" data-type="indexterm" id="3_idm45941148169096"></a>Negative zero behaves almost identically to positive zero,
and, in fact, the <code>==</code> equality operator reports that negative zero is
equal to positive zero. One way to distinguish negative zero from
positive, or regular, zero is to divide by it: <code>1.0/0.0</code> yields positive
infinity, but <code>1.0</code> divided by negative zero yields negative infinity.
Finally, because NaN is Not a Number, the <code>==</code> operator says that it is
not equal to any other number, including itself!</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">double</code> <code class="n">NaN</code> <code class="o">=</code> <code class="mf">0.0</code><code class="o">/</code><code class="mf">0.0</code><code class="o">;</code>             <code class="c1">// Not a Number</code>
<code class="n">NaN</code> <code class="o">==</code> <code class="n">NaN</code><code class="o">;</code>                       <code class="c1">// false</code>
<code class="n">Double</code><code class="o">.</code><code class="na">isNaN</code><code class="o">(</code><code class="n">NaN</code><code class="o">);</code>                <code class="c1">// true</code></pre>

<p>To check whether a <code>float</code> or <code>double</code> value is NaN, you must use the <code>Float.isNaN()</code> and <code>Double.isNaN()</code> methods.<a data-startref="ix_ch02-asciidoc9" data-type="indexterm" id="3_idm45941148150440"></a><a data-startref="ix_ch02-asciidoc8" data-type="indexterm" id="3_idm45941148149704"></a><a data-startref="ix_ch02-asciidoc7" data-type="indexterm" id="3_idm45941148149032"></a></p>
</div></section>













<section data-pdf-bookmark="Primitive Type Conversions" data-type="sect2"><div class="sect2" id="idm45941148366008">
<h2>Primitive Type Conversions</h2>

<p><a data-primary="data types" data-secondary="conversions" data-type="indexterm" id="3_idm45941148112808"></a><a data-primary="floating-point types" data-secondary="conversions" data-type="indexterm" id="3_idm45941148111720"></a><a data-primary="int type" data-secondary="conversions to other primitive types" data-type="indexterm" id="3_idm45941148110776"></a><a data-primary="integer types" data-secondary="conversions" data-type="indexterm" id="3_idm45941148109864"></a><a data-primary="primitive types" data-secondary="conversions between" data-type="indexterm" id="3_idm45941148108920"></a><a data-primary="syntax, Java" data-secondary="primitive type conversions" data-type="indexterm" id="3_idm45941148107976"></a>Java allows conversions between integer values and floating-point
values. <a data-primary="char type" data-secondary="conversion to and from integer and floating-point types" data-type="indexterm" id="3_idm45941148106936"></a>In addition, because every character corresponds to a number in
the Unicode encoding, <code>char</code> values can be converted to and from the
integer and floating-point types. In <a data-primary="boolean type" data-secondary="no conversions to other primitive types" data-type="indexterm" id="3_idm45941148105512"></a>fact, <code>boolean</code> is the only
primitive type that cannot be converted to or from another primitive
type in Java.</p>

<p><a data-primary="widening conversions" data-type="indexterm" id="3_idm45941148103752"></a>There are two basic types of conversions. A <em>widening conversion</em>
occurs when a value of one type is converted to a wider type鈥攐ne that
has a larger range of legal values. For example, Java performs widening
conversions automatically when you assign an <code>int</code> literal to a
<code>double</code> variable or a <code>char</code> literal to an <code>int</code> variable.</p>

<p><a data-primary="narrowing conversions" data-type="indexterm" id="3_idm45941148100152"></a>Narrowing conversions are another matter, however. A <em>narrowing
conversion</em> occurs when a value is converted to a type that is not wider
than it is. <a data-primary="byte type" data-secondary="conversions to other primitive types" data-type="indexterm" id="3_idm45941148098648"></a>Narrowing conversions are not always safe: it is reasonable
to convert the integer value 13 to a <code>byte</code>, for example, but it is not
reasonable to convert 13,000 to a <code>byte</code>, because <code>byte</code> can hold only
numbers between 鈥?28 and 127. Because you can lose data in a narrowing
conversion, the Java compiler complains when you attempt any narrowing
conversion, even if the value being converted would in fact fit in the
narrower range of the specified type:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">13</code><code class="o">;</code>
<code class="c1">// byte b = i;    // Incompatible types: possible lossy conversion</code>
                  <code class="c1">// from int to byte</code></pre>

<p>The one exception to this rule is that you can assign an integer literal
(an <code>int</code> value) to a <code>byte</code> or <code>short</code> variable if the literal falls
within the range of the variable.</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">byte</code> <code class="n">b</code> <code class="o">=</code> <code class="mi">13</code><code class="o">;</code></pre>

<p>If you need to perform a narrowing conversion and are confident you can
do so without losing data or precision, you can force Java to perform
the conversion using a language construct known as a <em>cast</em>. Perform a
cast by placing the name of the desired type in parentheses before the
value to be converted. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">13</code><code class="o">;</code>
<code class="kt">byte</code> <code class="n">b</code> <code class="o">=</code> <code class="o">(</code><code class="kt">byte</code><code class="o">)</code> <code class="n">i</code><code class="o">;</code>   <code class="c1">// Force the int to be converted to a byte</code>
<code class="n">i</code> <code class="o">=</code> <code class="o">(</code><code class="kt">int</code><code class="o">)</code> <code class="mf">13.456</code><code class="o">;</code>    <code class="c1">// Force this double literal to the int 13</code></pre>

<p><a data-primary="casts" data-type="indexterm" id="3_idm45941148009784"></a><a data-primary="casts" data-secondary="of primitive types" data-type="indexterm" id="3_idm45941148012040"></a><a data-primary="floating-point types" data-secondary="conversions" data-type="indexterm" id="3_idm45941148011128"></a><a data-primary="long type" data-secondary="conversions between char values and" data-type="indexterm" id="3_idm45941148010184"></a>Casts of primitive types are most often used to convert floating-point
values to integers. <a data-primary="rounding numbers" data-type="indexterm" id="3_idm45941147990280"></a>When you do this, the fractional part of the
floating-point value is simply truncated (i.e., the floating-point value
is rounded toward zero, not toward the nearest integer). <a data-primary="Math class" data-secondary="static methods for rounding" data-type="indexterm" id="3_idm45941147989288"></a>The static
methods <code>Math.round()</code>, <code>Math.floor()</code>, and <code>Math.ceil()</code> perform other
types of rounding.</p>

<p>The <code>char</code> type acts like an integer type in most ways, so a <code>char</code>
value can be used anywhere an <code>int</code> or <code>long</code> value is required. Recall, however, that the <code>char</code> type is <em>unsigned</em>, so it behaves
differently than the <code>short</code> type, even though both are 16 bits wide:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">short</code> <code class="n">s</code> <code class="o">=</code> <code class="o">(</code><code class="kt">short</code><code class="o">)</code> <code class="mh">0xffff</code><code class="o">;</code> <code class="c1">// These bits represent the number -1</code>
<code class="kt">char</code> <code class="n">c</code> <code class="o">=</code> <code class="sc">\uffff</code><code class="o">;</code>        <code class="c1">// The same bits, as a Unicode character</code>
<code class="kt">int</code> <code class="n">i1</code> <code class="o">=</code> <code class="n">s</code><code class="o">;</code>               <code class="c1">// Converting the short to an int yields -1</code>
<code class="kt">int</code> <code class="n">i2</code> <code class="o">=</code> <code class="n">c</code><code class="o">;</code>               <code class="c1">// Converting the char to an int yields 65535</code></pre>

<p><a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2-TABLE-3">Table 2-3</a> shows which primitive types can
be converted to which other types and how the conversion is performed.
The letter N in the table means that the conversion cannot be performed.
<a data-primary="widening conversions" data-type="indexterm" id="3_idm45941147927272"></a>The letter Y means that the conversion is a widening conversion and is
therefore performed automatically and implicitly by Java. The letter C
means that the conversion is a narrowing conversion and requires an
explicit cast.</p>

<p>Finally, the notation Y* means that the conversion is an automatic
widening conversion, but that some of the least significant digits of
the value may be lost in the conversion. This can happen when you are converting
an <code>int</code> or <code>long</code> to a floating-point type鈥攕ee the table for details.
The floating-point types have a larger range than the integer types, so
any <code>int</code> or <code>long</code> can be represented by a <code>float</code> or <code>double</code>.
However, the floating-point types are approximations of numbers and
cannot always hold as many significant digits as the integer types (see
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch09.html#javanut7-CHP-9">Chapter 9</a> for some more detail about floating-point numbers).<a data-startref="ix_ch02-asciidoc6" data-type="indexterm" id="3_idm45941147921624"></a><a data-startref="ix_ch02-asciidoc5" data-type="indexterm" id="3_idm45941147920952"></a><a data-startref="ix_ch02-asciidoc4" data-type="indexterm" id="3_idm45941147920280"></a></p>
<table class="pagebreak-before" id="javanut7-CHP-2-TABLE-3">
	<caption><span class="label">Table 2-3. </span>Java primitive type conversions</caption>
	<thead>
		<tr>
			<th> </th>
			<th>Convert to:</th>
			<th> </th>
			<th> </th>
			<th> </th>
			<th> </th>
			<th> </th>
			<th> </th>
			<th> </th>
		</tr>
		<tr>
			<th>Convert from:</th>
			<th><code>boolean</code></th>
			<th><code>byte</code></th>
			<th><code>short</code></th>
			<th><code>char</code></th>
			<th><code>int</code></th>
			<th><code>long</code></th>
			<th><code>float</code></th>
			<th><code>double</code></th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>
			<p><code>boolean</code></p>
			</td>
			<td>
			<p>-</p>
			</td>
			<td>
			<p>N</p>
			</td>
			<td>
			<p>N</p>
			</td>
			<td>
			<p>N</p>
			</td>
			<td>
			<p>N</p>
			</td>
			<td>
			<p>N</p>
			</td>
			<td>
			<p>N</p>
			</td>
			<td>
			<p>N</p>
			</td>
		</tr>
		<tr>
			<td>
			<p><code>byte</code></p>
			</td>
			<td>
			<p>N</p>
			</td>
			<td>
			<p>-</p>
			</td>
			<td>
			<p>Y</p>
			</td>
			<td>
			<p>C</p>
			</td>
			<td>
			<p>Y</p>
			</td>
			<td>
			<p>Y</p>
			</td>
			<td>
			<p>Y</p>
			</td>
			<td>
			<p>Y</p>
			</td>
		</tr>
		<tr>
			<td>
			<p><code>short</code></p>
			</td>
			<td>
			<p>N</p>
			</td>
			<td>
			<p>C</p>
			</td>
			<td>
			<p>-</p>
			</td>
			<td>
			<p>C</p>
			</td>
			<td>
			<p>Y</p>
			</td>
			<td>
			<p>Y</p>
			</td>
			<td>
			<p>Y</p>
			</td>
			<td>
			<p>Y</p>
			</td>
		</tr>
		<tr>
			<td>
			<p><code>char</code></p>
			</td>
			<td>
			<p>N</p>
			</td>
			<td>
			<p>C</p>
			</td>
			<td>
			<p>C</p>
			</td>
			<td>
			<p>-</p>
			</td>
			<td>
			<p>Y</p>
			</td>
			<td>
			<p>Y</p>
			</td>
			<td>
			<p>Y</p>
			</td>
			<td>
			<p>Y</p>
			</td>
		</tr>
		<tr>
			<td>
			<p><code>int</code></p>
			</td>
			<td>
			<p>N</p>
			</td>
			<td>
			<p>C</p>
			</td>
			<td>
			<p>C</p>
			</td>
			<td>
			<p>C</p>
			</td>
			<td>
			<p>-</p>
			</td>
			<td>
			<p>Y</p>
			</td>
			<td>
			<p>Y*</p>
			</td>
			<td>
			<p>Y</p>
			</td>
		</tr>
		<tr>
			<td>
			<p><code>long</code></p>
			</td>
			<td>
			<p>N</p>
			</td>
			<td>
			<p>C</p>
			</td>
			<td>
			<p>C</p>
			</td>
			<td>
			<p>C</p>
			</td>
			<td>
			<p>C</p>
			</td>
			<td>
			<p>-</p>
			</td>
			<td>
			<p>Y*</p>
			</td>
			<td>
			<p>Y*</p>
			</td>
		</tr>
		<tr>
			<td>
			<p><code>float</code></p>
			</td>
			<td>
			<p>N</p>
			</td>
			<td>
			<p>C</p>
			</td>
			<td>
			<p>C</p>
			</td>
			<td>
			<p>C</p>
			</td>
			<td>
			<p>C</p>
			</td>
			<td>
			<p>C</p>
			</td>
			<td>
			<p>-</p>
			</td>
			<td>
			<p>Y</p>
			</td>
		</tr>
		<tr>
			<td><code>double</code></td>
			<td>N</td>
			<td>C</td>
			<td>C</td>
			<td>C</td>
			<td>C</td>
			<td>C</td>
			<td>C</td>
			<td>-</td>
		</tr>
	</tbody>
</table>
</div></section>





</div></section>













<section data-pdf-bookmark="Expressions and Operators" data-type="sect1"><div class="sect1" id="javanut7-CHP-2-SECT-4">
<h1>Expressions and Operators</h1>

<p><a data-primary="expressions" data-secondary="operators and" data-type="indexterm" id="3_ix_ch02-asciidoc10"></a><a data-primary="operators" data-type="indexterm" id="3_ix_ch02-asciidoc11"></a><a data-primary="syntax, Java" data-secondary="expressions and operators" data-type="indexterm" id="3_ix_ch02-asciidoc12"></a><a data-primary="syntax, Java" data-secondary="operators" data-type="indexterm" id="3_ix_ch02-asciidoc13"></a>So far in this chapter, we鈥檝e learned about the primitive types that
Java programs can manipulate and seen how to include primitive values as
<em>literals</em> in a Java program. We鈥檝e also used <em>variables</em> as symbolic
names that represent, or hold, values. These literals and variables are
the tokens out of which Java programs are built.</p>

<p><a data-primary="expressions" data-type="indexterm" id="3_idm45941147802792"></a><a data-primary="expressions" data-secondary="defined" data-type="indexterm" id="3_idm45941147801896"></a>An <em>expression</em> is the next higher level of structure in a Java
program. The Java interpreter <em>evaluates</em> an expression to compute its
value. <a data-primary="literals" data-type="indexterm" id="3_idm45941147799992"></a><a data-primary="primary expressions" data-type="indexterm" id="3_idm45941147799288"></a>The very simplest expressions are called <em>primary expressions</em>
and consist of literals and variables. So, for example, the following
are all expressions:</p>

<pre data-code-language="java" data-type="programlisting"><code class="mf">1.7</code>         <code class="c1">// A floating-point literal</code>
<code class="kc">true</code>        <code class="c1">// A Boolean literal</code>
<code class="n">sum</code>         <code class="c1">// A variable</code></pre>

<p>When the Java interpreter evaluates a literal expression, the resulting
value is the literal itself. When the interpreter evaluates a variable
expression, the resulting value is the value stored in the variable.</p>

<p>Primary expressions are not very interesting. More complex expressions
are made by using <em>operators</em> to combine primary expressions. For
example, the following expression uses the assignment operator to
combine two primary expressions鈥攁 variable and a floating-point
literal鈥攊nto an assignment expression:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">sum</code> <code class="o">=</code> <code class="mf">1.7</code></pre>

<p>But operators are used not only with primary expressions; they can also
be used with expressions at any level of complexity. The following are
all legal expressions:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">sum</code> <code class="o">=</code> <code class="mi">1</code> <code class="o">+</code> <code class="mi">2</code> <code class="o">+</code> <code class="mi">3</code> <code class="o">*</code> <code class="mf">1.2</code> <code class="o">+</code> <code class="o">(</code><code class="mi">4</code> <code class="o">+</code> <code class="mi">8</code><code class="o">)/</code><code class="mf">3.0</code>
<code class="n">sum</code><code class="o">/</code><code class="n">Math</code><code class="o">.</code><code class="na">sqrt</code><code class="o">(</code><code class="mf">3.0</code> <code class="o">*</code> <code class="mf">1.234</code><code class="o">)</code>
<code class="o">(</code><code class="kt">int</code><code class="o">)(</code><code class="n">sum</code> <code class="o">+</code> <code class="mi">33</code><code class="o">)</code></pre>








<section data-pdf-bookmark="Operator Summary" data-type="sect2"><div class="sect2" id="idm45941147720808">
<h2>Operator Summary</h2>

<p>The kinds of expressions you can write in a programming language depend
entirely on the set of operators available to you. Java has a wealth of
operators, but to work effectively with them, you must understand two important
concepts: <em>precedence</em> and <em>associativity</em>.
These concepts鈥攁nd the operators themselves鈥攁re explained in more detail
in the following sections.</p>










<section data-pdf-bookmark="Precedence" data-type="sect3"><div class="sect3" id="idm45941147697752">
<h3>Precedence</h3>

<p><a data-primary="C/C++" data-secondary="operator precedence" data-type="indexterm" id="3_idm45941147696312"></a><a data-primary="operators" data-secondary="precedence of" data-type="indexterm" id="3_idm45941147695336"></a><a data-primary="precedence, operator" data-type="indexterm" id="3_idm45941147694392"></a>The P column of <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2-TABLE-4">Table 2-4</a> specifies the <em>precedence</em> of each operator. Precedence specifies the order in which
operations are performed. Operations that have higher precedence are
performed before those with lower precedence. For example, consider this
expression:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">a</code> <code class="o">+</code> <code class="n">b</code> <code class="o">*</code> <code class="n">c</code></pre>

<p>The multiplication operator has higher precedence than the addition
operator, so <code>a</code> is added to the product of <code>b</code> and <code>c</code>, just as we
expect from elementary mathematics. Operator precedence can be thought
of as a measure of how tightly operators bind to their operands. The
higher the number, the more tightly they bind.</p>

<p><a data-primary="( ) (parentheses)" data-secondary="overriding operator precedence" data-type="indexterm" id="3_idm45941147665432"></a>Default operator precedence can be overridden through the use of
parentheses that explicitly specify the order of operations. The
previous expression can be rewritten to specify that the addition should
be performed before the multiplication:</p>

<pre data-code-language="java" data-type="programlisting"><code class="o">(</code><code class="n">a</code> <code class="o">+</code> <code class="n">b</code><code class="o">)</code> <code class="o">*</code> <code class="n">c</code></pre>

<p>The default operator precedence in Java was chosen for compatibility
with C; the designers of C chose this precedence so that most
expressions can be written naturally without parentheses. There are only
a few common Java idioms for which parentheses are required. Examples
include:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Class cast combined with member access</code>
<code class="o">((</code><code class="n">Integer</code><code class="o">)</code> <code class="n">o</code><code class="o">).</code><code class="na">intValue</code><code class="o">();</code>

<code class="c1">// Assignment combined with comparison</code>
<code class="k">while</code><code class="o">((</code><code class="n">line</code> <code class="o">=</code> <code class="n">in</code><code class="o">.</code><code class="na">readLine</code><code class="o">())</code> <code class="o">!=</code> <code class="kc">null</code><code class="o">)</code> <code class="o">{</code> <code class="o">...</code> <code class="o">}</code>

<code class="c1">// Bitwise operators combined with comparison</code>
<code class="k">if</code> <code class="o">((</code><code class="n">flags</code> <code class="o">&amp;</code> <code class="o">(</code><code class="n">PUBLIC</code> <code class="o">|</code> <code class="n">PROTECTED</code><code class="o">))</code> <code class="o">!=</code> <code class="mi">0</code><code class="o">)</code> <code class="o">{</code> <code class="o">...</code> <code class="o">}</code></pre>
</div></section>













<section data-pdf-bookmark="Associativity" data-type="sect3"><div class="sect3" id="idm45941147629736">
<h3>Associativity</h3>

<p><a data-primary="associativity" data-type="indexterm" id="3_idm45941147574840"></a><a data-primary="operators" data-secondary="associativity" data-type="indexterm" id="3_idm45941147574136"></a>Associativity is a property of operators that defines how to evaluate
expressions that would otherwise be ambiguous. This is particularly
important when an expression involves several operators that have the
same precedence.</p>

<p>Most operators are left-to-right associative, which means that the
operations are performed from left to right. <a data-primary="assignment operators" data-secondary="associativity" data-type="indexterm" id="3_idm45941147572312"></a><a data-primary="unary operators" data-secondary="associativity" data-type="indexterm" id="3_idm45941147571336"></a>The assignment and unary
operators, however, have right-to-left associativity. The A column of
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2-TABLE-4">Table 2-4</a> specifies the associativity of
each operator or group of operators. The value L means left to right,
and R means right to left.</p>

<p>The additive operators are all left-to-right associative, so the
expression <code>a+b-c</code> is evaluated from left to right: <code>(a+b)-c</code>. Unary
operators and assignment operators are evaluated from right to left.
Consider this complex expression:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">a</code> <code class="o">=</code> <code class="n">b</code> <code class="o">+=</code> <code class="n">c</code> <code class="o">=</code> <code class="o">-~</code><code class="n">d</code></pre>

<p>This is evaluated as follows:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">a</code> <code class="o">=</code> <code class="o">(</code><code class="n">b</code> <code class="o">+=</code> <code class="o">(</code><code class="n">c</code> <code class="o">=</code> <code class="o">-(~</code><code class="n">d</code><code class="o">)))</code></pre>

<p>As with operator precedence, operator associativity establishes a
default order of evaluation for an expression. This default order can be
overridden through the use of parentheses. However, the default operator
associativity in Java has been chosen to yield a natural expression
syntax, and you should rarely need to alter it.</p>
</div></section>













<section data-pdf-bookmark="Operator summary table" data-type="sect3"><div class="sect3" id="idm45941147548168">
<h3>Operator summary table</h3>

<p><a data-primary="- (minus sign)" data-secondary="-- (decrement) operator" data-type="indexterm" id="3_idm45941147547096"></a><a data-primary="- (minus sign)" data-secondary="-= (subtract assignment) operator" data-type="indexterm" id="3_idm45941147545464"></a><a data-primary="- (minus sign)" data-secondary="subtraction operator" data-type="indexterm" id="3_idm45941147544552"></a><a data-primary="- (minus sign)" data-secondary="unary minus operator" data-type="indexterm" id="3_idm45941147488296"></a><a data-primary="! (exclamation point)" data-secondary="!= (not equal to) operator" data-type="indexterm" id="3_idm45941147487352"></a><a data-primary="! (exclamation point)" data-secondary="boolean NOT operator" data-type="indexterm" id="3_idm45941147486440"></a><a data-primary="? (question mark)" data-secondary="? : (conditional) operator" data-type="indexterm" id="3_idm45941147485496"></a><a data-primary=". (dot)" data-secondary="object member access operator" data-type="indexterm" id="3_idm45941147484584"></a><a data-primary="( ) (parentheses)" data-secondary="cast operator" data-type="indexterm" id="3_idm45941147483672"></a><a data-primary="( ) (parentheses)" data-secondary="method invocation operator" data-type="indexterm" id="3_idm45941147482728"></a><a data-primary="[ ] (brackets)" data-secondary="array access operator" data-type="indexterm" id="3_idm45941147481816"></a><a data-primary="* (asterisk)" data-secondary="*= (multiply assignment) operator" data-type="indexterm" id="3_idm45941147480872"></a><a data-primary="* (asterisk)" data-secondary="multiplication operator" data-type="indexterm" id="3_idm45941147479960"></a><a data-primary="/ (slash)" data-secondary="/= (divide assignment) operator" data-type="indexterm" id="3_idm45941147479016"></a><a data-primary="/ (slash)" data-secondary="division operator" data-type="indexterm" id="3_idm45941147478104"></a><a data-primary="% (percent sign)" data-secondary="%= (modulo assignment) operator" data-type="indexterm" id="3_idm45941147477160"></a><a data-primary="% (percent sign)" data-secondary="modulo operator" data-type="indexterm" id="3_idm45941147476200"></a><a data-primary="&amp; (ampersand)" data-secondary="&amp;&amp; (conditional AND) operator" data-type="indexterm" id="3_idm45941147475256"></a><a data-primary="&amp; (ampersand)" data-secondary="&amp;= (bitwise AND assignment) operator" data-type="indexterm" id="3_idm45941147474296"></a><a data-primary="&amp; (ampersand)" data-secondary="bitwise AND operator" data-type="indexterm" id="3_idm45941147473336"></a><a data-primary="&amp; (ampersand)" data-secondary="boolean AND operator" data-type="indexterm" id="3_idm45941147472392"></a><a data-primary="&lt; &gt; (angle brackets)" data-secondary="&lt; (less than) operator" data-type="indexterm" id="3_idm45941147454952"></a><a data-primary="&lt; &gt; (angle brackets)" data-secondary="&lt;&lt; (signed left shift) operator" data-type="indexterm" id="3_idm45941147454008"></a><a data-primary="&lt; &gt; (angle brackets)" data-secondary="&lt;&lt;= (left shift assignment) operator" data-type="indexterm" id="3_idm45941147453048"></a><a data-primary="&lt; &gt; (angle brackets)" data-secondary="&lt;= (less than or equal to) operator" data-type="indexterm" id="3_idm45941147452088"></a><a data-primary="&lt; &gt; (angle brackets)" data-secondary="&gt; (greater than) operator" data-type="indexterm" id="3_idm45941147451128"></a><a data-primary="&lt; &gt; (angle brackets)" data-secondary="&gt;&gt; (signed right shift) operator" data-type="indexterm" id="3_idm45941147450168"></a><a data-primary="&lt; &gt; (angle brackets)" data-secondary="&gt;&gt;&gt; (unsigned right shift) operator" data-type="indexterm" id="3_idm45941147449208"></a><a data-primary="&lt; &gt; (angle brackets)" data-secondary="&gt;&gt;&gt;= (unsigned right shift assignment) operator" data-type="indexterm" id="3_idm45941147448248"></a><a data-primary="&lt; &gt; (angle brackets)" data-secondary="&gt;&gt;= (right shift assignment) operator" data-type="indexterm" id="3_idm45941147447336"></a><a data-primary="&lt; &gt; (angle brackets)" data-secondary="&gt;= (greater than or equal to) operator" data-type="indexterm" id="3_idm45941147446376"></a><a data-primary="鈫?(lambda arrow) operator" data-type="indexterm" id="3_idm45941147445416"></a><a data-primary="鈥?(caret)" data-secondary="鈥? (bitwise XOR assignment) operator" data-type="indexterm" id="3_idm45941147444728"></a><a data-primary="鈥?(caret)" data-secondary="bitwise XOR operator" data-type="indexterm" id="3_idm45941147443768"></a><a data-primary="鈥?(caret)" data-secondary="boolean XOR operator" data-type="indexterm" id="3_idm45941147442824"></a><a data-primary="+ (plus sign)" data-secondary="++ (increment) operator" data-type="indexterm" id="3_idm45941147441880"></a><a data-primary="+ (plus sign)" data-secondary="+= (add assignment) operator" data-type="indexterm" id="3_idm45941147440936"></a><a data-primary="+ (plus sign)" data-secondary="addition operator" data-type="indexterm" id="3_idm45941147439976"></a><a data-primary="+ (plus sign)" data-secondary="string concatenation operator" data-type="indexterm" id="3_idm45941147439032"></a><a data-primary="+ (plus sign)" data-secondary="unary plus operator" data-type="indexterm" id="3_idm45941147438072"></a><a data-primary="= (equals sign)" data-secondary="== (equal to) operator" data-type="indexterm" id="3_idm45941147437128"></a><a data-primary="= (equals sign)" data-secondary="assignment operator" data-type="indexterm" id="3_idm45941147436184"></a><a data-primary="| (vertical bar)" data-secondary="|= (bitwise OR assignment) operator" data-type="indexterm" id="3_idm45941147435240"></a><a data-primary="| (vertical bar)" data-secondary="|| (conditional OR) operator" data-type="indexterm" id="3_idm45941147434280"></a><a data-primary="| (vertical bar)" data-secondary="bitwise OR operator" data-type="indexterm" id="3_idm45941147433320"></a><a data-primary="| (vertical bar)" data-secondary="boolean OR operator" data-type="indexterm" id="3_idm45941147432376"></a><a data-primary="~ (tilde), bitwise complement operator" data-type="indexterm" id="3_idm45941147431432"></a><a data-primary="instanceof operator" data-type="indexterm" id="3_idm45941147430744"></a><a data-primary="new operator" data-type="indexterm" id="3_idm45941147430072"></a><a data-primary="operators" data-secondary="summary table" data-type="indexterm" id="3_idm45941147429400"></a><a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2-TABLE-4">Table 2-4</a> summarizes the operators available in Java. The P and A columns of the table specify the precedence and associativity of each group of related operators, respectively. You should use this table as a quick reference for operators (especially their precedence) when required.</p>
<table id="javanut7-CHP-2-TABLE-4">
<caption><span class="label">Table 2-4. </span>Java operators</caption>
<thead>
<tr>
<th>P</th>
<th>A</th>
<th>Operator</th>
<th>Operand type(s)</th>
<th>Operation performed</th>
</tr>
</thead>
<tbody>
<tr>
<td><p>16</p></td>
<td><p>L</p></td>
<td><p>.</p></td>
<td><p>object, member</p></td>
<td><p>Object member access</p></td>
</tr>
<tr>
<td></td>
<td></td>
<td><p><code>[ ]</code></p></td>
<td><p>array, int</p></td>
<td><p>Array element access</p></td>
</tr>
<tr>
<td></td>
<td></td>
<td><p><code>( <em>args</em> )</code></p></td>
<td><p>method, arglist</p></td>
<td><p>Method invocation</p></td>
</tr>
<tr>
<td></td>
<td></td>
<td><p><code>++</code>, <code>--</code></p></td>
<td><p>variable</p></td>
<td><p>Post-increment, post-decrement</p></td>
</tr>
<tr>
<td><p>15</p></td>
<td><p>R</p></td>
<td><p><code>++</code>, <code>--</code></p></td>
<td><p>variable</p></td>
<td><p>Pre-increment, pre-decrement</p></td>
</tr>
<tr>
<td></td>
<td></td>
<td><p><code>+</code>, <code>-</code></p></td>
<td><p>number</p></td>
<td><p>Unary plus, unary minus</p></td>
</tr>
<tr>
<td></td>
<td></td>
<td><p><code>~</code></p></td>
<td><p>integer</p></td>
<td><p>Bitwise complement</p></td>
</tr>
<tr>
<td></td>
<td></td>
<td><p><code>!</code></p></td>
<td><p>boolean</p></td>
<td><p>Boolean NOT</p></td>
</tr>
<tr>
<td><p>14</p></td>
<td><p>R</p></td>
<td><p><code>new</code></p></td>
<td><p>class, arglist</p></td>
<td><p>Object creation</p></td>
</tr>
<tr>
<td></td>
<td></td>
<td><p><code>( <em>type</em> )</code></p></td>
<td><p>type, any</p></td>
<td><p>Cast (type conversion)</p></td>
</tr>
<tr>
<td><p>13</p></td>
<td><p>L</p></td>
<td><p><code>*</code>, <code>/</code>, <code>%</code></p></td>
<td><p>number, number</p></td>
<td><p>Multiplication, division, remainder</p></td>
</tr>
<tr>
<td><p>12</p></td>
<td><p>L</p></td>
<td><p><code>+</code>, <code>-</code></p></td>
<td><p>number, number</p></td>
<td><p>Addition, subtraction</p></td>
</tr>
<tr>
<td></td>
<td></td>
<td><p><code>+</code></p></td>
<td><p>string, any</p></td>
<td><p>String concatenation</p></td>
</tr>
<tr>
<td><p>11</p></td>
<td><p>L</p></td>
<td><p><code>&lt;&lt;</code></p></td>
<td><p>integer, integer</p></td>
<td><p>Left shift</p></td>
</tr>
<tr>
<td></td>
<td></td>
<td><p><code>&gt;&gt;</code></p></td>
<td><p>integer, integer</p></td>
<td><p>Right shift with sign extension</p></td>
</tr>
<tr>
<td></td>
<td></td>
<td><p><code>&gt;&gt;&gt;</code></p></td>
<td><p>integer, integer</p></td>
<td><p>Right shift with zero extension</p></td>
</tr>
<tr>
<td><p>10</p></td>
<td><p>L</p></td>
<td><p><code>&lt;</code>, <code>&lt;=</code></p></td>
<td><p>number, number</p></td>
<td><p>Less than, less than or equal</p></td>
</tr>
<tr>
<td></td>
<td></td>
<td><p><code>&gt;</code>, <code>&gt;=</code></p></td>
<td><p>number, number</p></td>
<td><p>Greater than, greater than or equal</p></td>
</tr>
<tr>
<td></td>
<td></td>
<td><p><code>instanceof</code></p></td>
<td><p>reference, type</p></td>
<td><p>Type comparison</p></td>
</tr>
<tr>
<td><p>9</p></td>
<td><p>L</p></td>
<td><p><code>==</code></p></td>
<td><p>primitive, primitive</p></td>
<td><p>Equal (have identical values)</p></td>
</tr>
<tr>
<td></td>
<td></td>
<td><p><code>!=</code></p></td>
<td><p>primitive, primitive</p></td>
<td><p>Not equal (have different values)</p></td>
</tr>
<tr>
<td></td>
<td></td>
<td><p><code>==</code></p></td>
<td><p>reference, reference</p></td>
<td><p>Equal (refer to same object)</p></td>
</tr>
<tr>
<td></td>
<td></td>
<td><p><code>!=</code></p></td>
<td><p>reference, reference</p></td>
<td><p>Not equal (refer to different objects)</p></td>
</tr>
<tr>
<td><p>8</p></td>
<td><p>L</p></td>
<td><p><code>&amp;</code></p></td>
<td><p>integer, integer</p></td>
<td><p>Bitwise AND</p></td>
</tr>
<tr>
<td></td>
<td></td>
<td><p><code>&amp;</code></p></td>
<td><p>boolean, boolean</p></td>
<td><p>Boolean AND</p></td>
</tr>
<tr>
<td><p>7</p></td>
<td><p>L</p></td>
<td><p><code>^</code></p></td>
<td><p>integer, integer</p></td>
<td><p>Bitwise XOR</p></td>
</tr>
<tr>
<td></td>
<td></td>
<td><p><code>^</code></p></td>
<td><p>boolean, boolean</p></td>
<td><p>Boolean XOR</p></td>
</tr>
<tr>
<td><p>6</p></td>
<td><p>L</p></td>
<td><p><code>莯</code></p></td>
<td><p>integer, integer</p></td>
<td><p>Bitwise OR</p></td>
</tr>
<tr>
<td></td>
<td></td>
<td><p><code>莯</code></p></td>
<td><p>boolean, boolean</p></td>
<td><p>Boolean OR</p></td>
</tr>
<tr>
<td><p>5</p></td>
<td><p>L</p></td>
<td><p><code>&amp;&amp;</code></p></td>
<td><p>boolean, boolean</p></td>
<td><p>Conditional AND</p></td>
</tr>
<tr>
<td><p>4</p></td>
<td><p>L</p></td>
<td><p><code>莯莯</code></p></td>
<td><p>boolean, boolean</p></td>
<td><p>Conditional OR</p></td>
</tr>
<tr>
<td><p>3</p></td>
<td><p>R</p></td>
<td><p><code>? :</code></p></td>
<td><p>boolean, any</p></td>
<td><p>Conditional (ternary) operator</p></td>
</tr>
<tr>
<td><p>2</p></td>
<td><p>R</p></td>
<td><p><code>=</code></p></td>
<td><p>variable, any</p></td>
<td><p>Assignment</p></td>
</tr>
<tr>
<td></td>
<td></td>
<td><p><code>*=</code>, <code>/=</code>, <code>%=</code>,</p></td>
<td><p>variable, any</p></td>
<td><p>Assignment with operation</p></td>
</tr>
<tr>
<td></td>
<td></td>
<td><p><code>+=</code>, <code>-=</code>, <code>&lt;&lt;=</code>,</p></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td><p><code>&gt;&gt;=</code>, <code>&gt;&gt;&gt;=</code>,</p></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td><p><code>&amp;=</code>, <code>^=</code>, <code>莯=</code></p></td>
<td></td>
<td></td>
</tr>
<tr>
<td><p>1</p></td>
<td><p>R</p></td>
<td><p><code>鈫?/code&gt;</p></td>
<td><p>arglist, method body</p></td>
<td><p>lambda expression</p></td>
</tr>
</tbody>
</table>
</div></section>













<section data-pdf-bookmark="Operand number and type" data-type="sect3"><div class="sect3" id="idm45941147422456">
<h3>Operand number and type</h3>

<p><a data-primary="operand, number and type of" data-type="indexterm" id="3_idm45941147293608"></a><a data-primary="operators" data-secondary="operand number and type" data-type="indexterm" id="3_idm45941147292840"></a>The fourth column of <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2-TABLE-4">Table 2-4</a> specifies
the number and type of the operands expected by each operator.<a data-primary="unary operators" data-type="indexterm" id="3_idm45941147290936"></a> Some
operators operate on only one operand; these are called unary operators.
<a data-primary="- (minus sign)" data-secondary="subtraction operator" data-type="indexterm" id="3_idm45941147290136"></a><a data-primary="- (minus sign)" data-secondary="unary minus operator" data-type="indexterm" id="3_idm45941147289192"></a>For example, the unary minus operator changes the sign of a single
number:</p>

<pre data-code-language="java" data-type="programlisting"><code class="o">-</code><code class="n">n</code>             <code class="c1">// The unary minus operator</code></pre>

<p><a data-primary="binary operators" data-type="indexterm" id="3_idm45941147285496"></a>Most operators, however, are binary operators that operate on two
operand values. The <code>鈥?/code&gt; operator actually comes in both forms:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">a</code> <code class="err">鈥?/code&gt; <code class="n">b</code>          <code class="c1">// The subtraction operator is a binary operator</code></pre>

<p><a data-primary="? (question mark)" data-secondary="? : (conditional) operator" data-type="indexterm" id="3_idm45941147274280"></a>Java also defines one ternary operator, often called the conditional
operator. It is like an <code>if</code> statement inside an expression. Its three
operands are separated by a question mark and a colon; the second and
third operands must be convertible to the same type:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">x</code> <code class="o">&gt;</code> <code class="n">y</code> <code class="o">?</code> <code class="n">x</code> <code class="o">:</code> <code class="n">y</code>  <code class="c1">// Ternary expression; evaluates to larger of x and y</code></pre>

<p><a data-primary="data types" data-secondary="of operands" data-type="indexterm" id="3_idm45941147268232"></a>In addition to expecting a certain number of operands, each operator
also expects particular types of operands. The fourth column of the
table lists the operand types. Some of the codes used in that column
require further explanation:</p>
<dl>
<dt>Number</dt>
<dd>
<p>An integer, floating-point value, or character (i.e., any primitive
type except <code>boolean</code>). Auto-unboxing (see
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2-SECT-9.4">鈥淏oxing and Unboxing Conversions鈥?/a&gt;) means that
the wrapper classes (such as <code>Character</code>, <code>Integer</code>, and <code>Double</code>) for
these types can be used in this context as well.</p>
</dd>
<dt>Integer</dt>
<dd>
<p>A <code>byte</code>, <code>short</code>, <code>int</code>, <code>long</code>, or <code>char</code> value (<code>long</code> values are
not allowed for the array access operator <code>[ ]</code>). With auto-unboxing,
<code>Byte</code>, <code>Short</code>, <code>Integer</code>, <code>Long</code>, and <code>Character</code> values are also
allowed.</p>
</dd>
<dt>Reference</dt>
<dd>
<p>An object or array.</p>
</dd>
<dt>Variable</dt>
<dd>
<p>A variable or anything else, such as an array element, to which a
value can be assigned.</p>
</dd>
</dl>
</div></section>













<section data-pdf-bookmark="Return type" data-type="sect3"><div class="sect3" id="idm45941147209496">
<h3>Return type</h3>

<p><a data-primary="operators" data-secondary="return type" data-type="indexterm" id="3_idm45941147208296"></a><a data-primary="return types" data-secondary="for operators" data-type="indexterm" id="3_idm45941147206920"></a>Just as every operator expects its operands to be of specific types,
each operator produces a value of a specific type. <a data-primary="double type" data-secondary="return type for operators" data-type="indexterm" id="3_idm45941147205704"></a><a data-primary="floating-point types" data-secondary="double type" data-type="indexterm" id="3_idm45941147204792"></a><a data-primary="floating-point types" data-secondary="float type" data-type="indexterm" id="3_idm45941147203848"></a><a data-primary="floating-point types" data-secondary="return type for operators" data-type="indexterm" id="3_idm45941147202904"></a>The arithmetic,
increment and decrement, bitwise, and shift operators return a <code>double</code>
if at least one of the operands is a <code>double</code>. They return a <code>float</code>
if at least one of the operands is a <code>float</code>. <a data-primary="long type" data-secondary="return type for operators" data-type="indexterm" id="3_idm45941147183704"></a>They return a <code>long</code> if
at least one of the operands is a <code>long</code>. <a data-primary="byte type" data-type="indexterm" id="3_idm45941147181768"></a><a data-primary="char type" data-type="indexterm" id="3_idm45941147181032"></a><a data-primary="int type" data-secondary="return type for operators" data-type="indexterm" id="3_idm45941147180360"></a><a data-primary="short type" data-type="indexterm" id="3_idm45941147179352"></a>Otherwise, they return an
<code>int</code>, even if both operands are <code>byte</code>, <code>short</code>, or <code>char</code> types that
are narrower than <code>int</code>.</p>

<p><a data-primary="boolean type" data-secondary="operator return values" data-type="indexterm" id="3_idm45941147176344"></a>The comparison, equality, and Boolean operators always return <code>boolean</code>
values. Each assignment operator returns whatever value it assigned,
which is of a type compatible with the variable on the left side of the
expression. The conditional operator returns the value of its second or
third argument (which must both be of the same type).</p>
</div></section>













<section data-pdf-bookmark="Side effects" data-type="sect3"><div class="sect3" id="idm45941147174312">
<h3>Side effects</h3>

<p><a data-primary="operators" data-secondary="side effects" data-type="indexterm" id="3_idm45941147173112"></a><a data-primary="side effects" data-secondary="operators" data-type="indexterm" id="3_idm45941147172136"></a><a data-primary="side effects" data-secondary="of operators" data-type="indexterm" id="3_idm45941147171192"></a>Every operator computes a value based on one or more operand values.
Some operators, however, have <em>side effects</em> in addition to their basic
evaluation. If an expression contains side effects, evaluating it
changes the state of a Java program in such a way that evaluating the
expression again may yield a different result.</p>

<p><a data-primary="+ (plus sign)" data-secondary="++ (increment) operator" data-type="indexterm" id="3_idm45941147169112"></a><a data-primary="increment operator (++)" data-type="indexterm" id="3_idm45941147167944"></a>For example, the <code>++</code> increment operator has the side effect of
incrementing a variable. The expression <code>++a</code> increments the variable
<code>a</code> and returns the newly incremented value. If this expression is
evaluated again, the value will be different. The various assignment
operators also have side effects. For example, the expression <code>a*=2</code> can
also be written as <code>a=a*2</code>. The value of the expression is the value of
<code>a</code> multiplied by 2, but the expression has the side effect of storing
that value back into <code>a</code>.</p>

<p><a data-primary="( ) (parentheses)" data-secondary="method invocation operator" data-type="indexterm" id="3_idm45941147163656"></a><a data-primary="method invocation operator (( ))" data-type="indexterm" id="3_idm45941147162488"></a>The method invocation operator <code>()</code> has side effects if the invoked
method has side effects. Some methods, such as <code>Math.sqrt()</code>, simply
compute and return a value without side effects of any kind. Typically,
however, methods do have side effects. <a data-primary="new operator" data-type="indexterm" id="3_idm45941147160728"></a>Finally, the <code>new</code> operator has
the profound side effect of creating a new object.</p>
</div></section>













<section data-pdf-bookmark="Order of evaluation" data-type="sect3"><div class="sect3" id="idm45941147159352">
<h3>Order of evaluation</h3>

<p><a data-primary="evaluation of expressions" data-secondary="order of evaluation" data-type="indexterm" id="3_idm45941147158152"></a><a data-primary="operators" data-secondary="order of evaluation" data-type="indexterm" id="3_idm45941147156984"></a>When the Java interpreter evaluates an expression, it performs the
various operations in an order specified by the parentheses in the
expression, the precedence of the operators, and the associativity of
the operators. Before any operation is performed, however, the
interpreter first evaluates the operands of the operator. <a data-primary="? (question mark)" data-secondary="? : (conditional) operator" data-type="indexterm" id="3_idm45941147155576"></a><a data-primary="&amp; (ampersand)" data-secondary="&amp;&amp; (conditional AND) operator" data-type="indexterm" id="3_idm45941147154616"></a><a data-primary="| (vertical bar)" data-secondary="|| (conditional OR) operator" data-type="indexterm" id="3_idm45941147153656"></a>(The
exceptions are the <code>&amp;&amp;</code>, <code>||</code>, and <code>?</code>: operators, which do not
always evaluate all their operands.) The interpreter always evaluates
operands in order from left to right. This matters if any of the
operands are expressions that contain side effects. Consider this code,
for example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">int</code> <code class="n">a</code> <code class="o">=</code> <code class="mi">2</code><code class="o">;</code>
<code class="kt">int</code> <code class="n">v</code> <code class="o">=</code> <code class="o">++</code><code class="n">a</code> <code class="o">+</code> <code class="o">++</code><code class="n">a</code> <code class="o">*</code> <code class="o">++</code><code class="n">a</code><code class="o">;</code></pre>

<p>Although the multiplication is performed before the addition, the
operands of the <code>+</code> operator are evaluated first. As the operand of <code>\</code>
are both <code>++a</code>, these are evaluated to <code>3</code> and <code>4</code>, and so the expression
evaluates to <code>3 + 4 * 5</code>, or <code>23</code>.</p>
</div></section>



</div></section>













<section data-pdf-bookmark="Arithmetic Operators" data-type="sect2"><div class="sect2" id="idm45941147134568">
<h2>Arithmetic Operators</h2>

<p><a data-primary="arithmetic operators" data-type="indexterm" id="3_idm45941147133336"></a><a data-primary="integer types" data-secondary="integer arithmetic" data-type="indexterm" id="3_idm45941147132632"></a><a data-primary="operators" data-secondary="arithmetic" data-type="indexterm" id="3_idm45941147131688"></a>The arithmetic operators can be used with integers, floating-point
numbers, and even characters (i.e., they can be used with any primitive
type other than <code>boolean</code>). If either of the operands is a
floating-point number, floating-point arithmetic is used; otherwise,
integer arithmetic is used. This matters because integer arithmetic and
floating-point arithmetic differ in the way division is performed and in
the way underflows and overflows are handled, for example. The
arithmetic operators are:</p>
<dl>
<dt><em>Addition</em> (<code>+</code>)</dt>
<dd>
<p><a data-primary="+ (plus sign)" data-secondary="addition operator" data-type="indexterm" id="3_idm45941147126184"></a><a data-primary="addition operator (+)" data-type="indexterm" id="3_idm45941147125208"></a>The <code>+</code> operator adds two numbers. As we鈥檒l see shortly, the <code>+</code> operator can also be used to concatenate strings. If either operand of <code>+</code> is a string, the other one is converted to a string as well. Be sure to use parentheses when you want to combine addition with concatenation. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Total: </code> <code class="o">+</code> <code class="mi">3</code> <code class="o">+</code> <code class="mi">4</code><code class="o">);</code>    <code class="c1">// Prints &quot;Total: 34&quot;, not 7!</code></pre>
</dd>
<dt><em>Subtraction</em> (<code>-</code>)</dt>
<dd>
<p><a data-primary="- (minus sign)" data-secondary="subtraction operator" data-type="indexterm" id="3_idm45941147075416"></a><a data-primary="subtraction operator (-)" data-type="indexterm" id="3_idm45941147120856"></a>When the <code>-</code> operator is used as a binary operator, it subtracts its second operand from its first. For example, <code>7-3</code> evaluates to <code>4</code>. The <code>-</code> operator can also perform unary negation.</p>
</dd>
<dt><em>Multiplication</em> (<code>*</code>)</dt>
<dd>
<p><a data-primary="* (asterisk)" data-secondary="multiplication operator" data-type="indexterm" id="3_idm45941147046760"></a><a data-primary="multiplication operator (*)" data-type="indexterm" id="3_idm45941147045784"></a>The <code>*</code> operator multiplies its two operands. For example, <code>7*3</code> evaluates to <code>21</code>.</p>
</dd>
<dt><em>Division</em> (<code>/</code>)</dt>
<dd>
<p><a data-primary="/ (slash)" data-secondary="division operator" data-type="indexterm" id="3_idm45941147041784"></a><a data-primary="division operator" data-type="indexterm" id="3_idm45941147040584"></a>The <code>/</code> operator divides its first operand by its second. If both operands are integers, the result is an integer, and any remainder is lost. <a data-primary="floating-point types" data-secondary="floating-point arithmetic" data-type="indexterm" id="3_idm45941147039224"></a>If either operand is a floating-point value, however, the result is a floating-point value. <a data-primary="0 (zero)" data-secondary="division by zero" data-type="indexterm" id="3_idm45941147038040"></a><a data-primary="floating-point types" data-secondary="division by zero" data-type="indexterm" id="3_idm45941147037096"></a>When you divide two integers, division by zero throws an <code>ArithmeticException</code>. <a data-primary="infinity" data-secondary="positive infinity, division by zero in floating-point arithmetic" data-type="indexterm" id="3_idm45941147070952"></a><a data-primary="NaN (Not-a-number)" data-secondary="floating-point calculations, division by zero" data-type="indexterm" id="3_idm45941147069976"></a><a data-primary="positive infinity" data-type="indexterm" id="3_idm45941147068936"></a><a data-primary="zero (0)" data-secondary="division by zero" data-type="indexterm" id="3_idm45941147068264"></a>For floating-point calculations, however, division by zero simply yields an infinite result or <code>NaN</code>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="mi">7</code><code class="o">/</code><code class="mi">3</code>          <code class="c1">// Evaluates to 2</code>
<code class="mi">7</code><code class="o">/</code><code class="mf">3.0f</code>       <code class="c1">// Evaluates to 2.333333f</code>
<code class="mi">7</code><code class="o">/</code><code class="mi">0</code>          <code class="c1">// Throws an ArithmeticException</code>
<code class="mi">7</code><code class="o">/</code><code class="mf">0.0</code>        <code class="c1">// Evaluates to positive infinity</code>
<code class="mf">0.0</code><code class="o">/</code><code class="mf">0.0</code>      <code class="c1">// Evaluates to NaN</code></pre>
</dd>
<dt><em>Modulo</em> (<code>%</code>)</dt>
<dd>
<p><a data-primary="% (percent sign)" data-secondary="modulo operator" data-type="indexterm" id="3_idm45941150989448"></a><a data-primary="modulo operator (%)" data-type="indexterm" id="3_idm45941150988072"></a>The <code>%</code> operator computes the first operand modulo the second operand (i.e., it returns the remainder when the first operand is divided by the second operand an integral number of times). For example, <code>7%3</code> is <code>1</code>. The sign of the result is the same as the sign of the first operand. While the modulo operator is typically used with integer operands, it also works for floating-point values. For example, <code>4.3%2.1</code> evaluates to <code>0.1</code>. When you are operating with integers, trying to compute a value modulo zero causes an <code>ArithmeticException</code>. <a data-primary="infinity" data-secondary="modulo operator (%) and" data-type="indexterm" id="3_idm45941150984184"></a><a data-primary="NaN (Not-a-number)" data-secondary="modulo operator (%) and" data-type="indexterm" id="3_idm45941150983176"></a>When you are working with floating-point values, anything modulo <code>0.0</code> evaluates to <code>NaN</code>, as does infinity modulo anything.</p>
</dd>
<dt><em>Unary minus</em> (<code>-</code>)</dt>
<dd>
<p><a data-primary="- (minus sign)" data-secondary="unary minus operator" data-type="indexterm" id="3_idm45941150979736"></a><a data-primary="unary operators" data-secondary="unary minus (-) operator" data-type="indexterm" id="3_idm45941150978760"></a>When the <code>-</code> operator is used as a unary operator鈥攖hat is, before a single operand鈥攊t performs unary negation. In other words, it converts a positive value to an equivalently negative value, and vice versa.</p>
</dd>
</dl>
</div></section>













<section data-pdf-bookmark="String Concatenation Operator" data-type="sect2"><div class="sect2" id="idm45941150976840">
<h2>String Concatenation Operator</h2>

<p><a data-primary="+ (plus sign)" data-secondary="+= (add assignment) operator" data-type="indexterm" id="3_idm45941150975432"></a><a data-primary="+ (plus sign)" data-secondary="string concatenation operator" data-type="indexterm" id="3_idm45941150974264"></a><a data-primary="operators" data-secondary="string concatenation" data-type="indexterm" id="3_idm45941150973304"></a><a data-primary="string concatenation operator (+)" data-type="indexterm" id="3_idm45941150972360"></a>In addition to adding numbers, the <code>+</code> operator (and the related <code>+=</code>
operator) also concatenates, or joins, strings. If either of the
operands to <code>+</code> is a string, the operator converts the other operand to
a string. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Prints &quot;Quotient: 2.3333333&quot;</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Quotient: </code> <code class="o">+</code> <code class="mi">7</code><code class="o">/</code><code class="mf">3.0f</code><code class="o">);</code></pre>

<p>As a result, you must be careful to put any addition expressions in
parentheses when combining them with string concatenation. If you do
not, the addition operator is interpreted as a concatenation operator.</p>

<p><a data-primary="primitive types" data-secondary="conversions to strings" data-type="indexterm" id="3_idm45941150936552"></a><a data-primary="strings" data-secondary="conversions for all primitive types" data-type="indexterm" id="3_idm45941150935704"></a><a data-primary="toString()" data-type="indexterm" id="3_idm45941150934792"></a>Java has built-in string conversions for all primitive types. An object is converted to a string by invoking its <code>toString()</code> method. Some classes define custom <code>toString()</code> methods so that objects of that class can easily be converted to strings in this way.
An array is converted to a string by invoking the built-in <code>toString()</code> method, which, unfortunately, does not return a useful string representation of the array contents.</p>
</div></section>













<section data-pdf-bookmark="Increment and Decrement Operators" data-type="sect2"><div class="sect2" id="idm45941150932152">
<h2>Increment and Decrement Operators</h2>

<p><a data-primary="+ (plus sign)" data-secondary="++ (increment) operator" data-type="indexterm" id="3_idm45941150930584"></a><a data-primary="decrement operator (--)" data-type="indexterm" id="3_idm45941150929384"></a><a data-primary="increment operator (++)" data-type="indexterm" id="3_idm45941150928712"></a><a data-primary="operators" data-secondary="increment/decrement" data-type="indexterm" id="3_idm45941150928040"></a>The <code>++</code> operator increments its single operand, which must be a
variable, an element of an array, or a field of an object, by 1. The
behavior of this operator depends on its position relative to the
operand. <a data-primary="pre-decrement operator (--)" data-type="indexterm" id="3_idm45941150925160"></a><a data-primary="pre-increment operator (++)" data-type="indexterm" id="3_idm45941150924488"></a>When used before the operand, where it is known as the
<em>pre-increment</em> operator, it increments the operand and evaluates to
the incremented value of that operand. <a data-primary="post-decrement operator (--)" data-type="indexterm" id="3_idm45941150923224"></a><a data-primary="post-increment operator (++)" data-type="indexterm" id="3_idm45941150922552"></a>When used after the operand,
where it is known as the <em>post-increment</em> operator, it increments its
operand, but evaluates to the value of that operand before it was
incremented.</p>

<p>For example, the following code sets both <code>i</code> and <code>j</code> to 2:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">i</code> <code class="o">=</code> <code class="mi">1</code><code class="o">;</code>
<code class="n">j</code> <code class="o">=</code> <code class="o">++</code><code class="n">i</code><code class="o">;</code></pre>

<p>But these lines set <code>i</code> to 2 and <code>j</code> to 1:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">i</code> <code class="o">=</code> <code class="mi">1</code><code class="o">;</code>
<code class="n">j</code> <code class="o">=</code> <code class="n">i</code><code class="o">++;</code></pre>

<p><a data-primary="- (minus sign)" data-secondary="-- (decrement) operator" data-type="indexterm" id="3_idm45941150888568"></a><a data-primary="arrays" data-secondary="as operand type" data-type="indexterm" id="3_idm45941150887496"></a><a data-primary="decrement operator (--)" data-type="indexterm" id="3_idm45941150886552"></a><a data-primary="objects" data-secondary="as operand type" data-type="indexterm" id="3_idm45941150880536"></a>Similarly, the <code>--</code> operator decrements its single numeric operand,
which must be a variable, an element of an array, or a field of an
object, by one. Like the <code>++</code> operator, the behavior of <code>--</code> depends on
its position relative to the operand. When used before the operand, it
decrements the operand and returns the decremented value. When used
after the operand, it decrements the operand, but returns the
<em>undecremented</em> value.</p>

<p>The expressions <code>x++</code> and <code>x--</code> are equivalent to <code>x=x+1</code> and <code>x=x-1</code>,
respectively, except that when you are using the increment and decrement
operators, <code>x</code> is only evaluated once. If <code>x</code> is itself an expression
with side effects, this makes a big difference. For example, these two
expressions are not equivalent:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">a</code><code class="o">[</code><code class="n">i</code><code class="o">++]++;</code>             <code class="c1">// Increments an element of an array</code>

<code class="c1">// Adds 1 to an array element and stores new value in another element</code>
<code class="n">a</code><code class="o">[</code><code class="n">i</code><code class="o">++]</code> <code class="o">=</code> <code class="n">a</code><code class="o">[</code><code class="n">i</code><code class="o">++]</code> <code class="o">+</code> <code class="mi">1</code><code class="o">;</code></pre>

<p>These operators, in both prefix and postfix forms, are most commonly
used to increment or decrement the counter that controls a loop.</p>
</div></section>













<section data-pdf-bookmark="Comparison Operators" data-type="sect2"><div class="sect2" id="idm45941150931528">
<h2>Comparison Operators</h2>

<p><a data-primary="comparison operators" data-type="indexterm" id="3_idm45941150806152"></a><a data-primary="operators" data-secondary="comparison" data-type="indexterm" id="3_idm45941150805224"></a>The comparison operators consist of the equality operators that test
values for equality or inequality and the <a data-primary="&lt; &gt; (angle brackets)" data-secondary="&lt; (less than) operator" data-type="indexterm" id="3_idm45941150804024"></a><a data-primary="less than operator (&lt;)" data-type="indexterm" id="3_idm45941150803080"></a><a data-primary="relational operators" data-type="indexterm" id="3_idm45941150802408"></a>relational operators used
with ordered types (numbers and characters) to test for greater than and
less than relationships. <a data-primary="boolean type" data-secondary="operator return values" data-type="indexterm" id="3_idm45941150801464"></a><a data-primary="for statements" data-secondary="comparison operators in" data-type="indexterm" id="3_idm45941150800520"></a><a data-primary="while statements" data-secondary="comparison operators in" data-type="indexterm" id="3_idm45941150799576"></a>Both types of operators yield a <code>boolean</code>
result, so they are typically used with <code>if</code> statements and <code>while</code> and
<code>for</code> loops to make branching and looping decisions. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">if</code> <code class="o">(</code><code class="n">o</code> <code class="o">!=</code> <code class="kc">null</code><code class="o">)</code> <code class="o">...;</code>           <code class="c1">// The not equals operator</code>
<code class="k">while</code><code class="o">(</code><code class="n">i</code> <code class="o">&lt;</code> <code class="n">a</code><code class="o">.</code><code class="na">length</code><code class="o">)</code> <code class="o">...;</code>      <code class="c1">// The less than operator</code></pre>

<p>Java provides the following equality operators:</p>
<dl>
<dt><em>Equals</em> (<code>==</code>)</dt>
<dd>
<p><a data-primary="= (equals sign)" data-secondary="== (equal to) operator" data-type="indexterm" id="3_idm45941150787112"></a><a data-primary="equality operator (==)" data-type="indexterm" id="3_idm45941150785944"></a><a data-primary="reference types" data-secondary="operands of, testing with == operator" data-type="indexterm" id="3_idm45941150785272"></a>The <code>==</code> operator evaluates to <code>true</code> if its two operands are equal and <code>false</code> otherwise. <a data-primary="primitive types" data-secondary="equals operator (==), testing operand values" data-type="indexterm" id="3_idm45941150744024"></a>With primitive operands, it tests whether the operand values themselves are identical. For operands of reference types, however, it tests whether the operands refer to the same object or array. In other words, it does not test the equality of two distinct objects or arrays. In particular, note that you cannot test two distinct strings for equality with this operator.</p>

<p>If <code>==</code> is used to compare two numeric or character operands that are
not of the same type, the narrower operand is converted to the type of
the wider operand before the comparison is done. For example, when you are
comparing a <code>short</code> to a <code>float</code>, the <code>short</code> is first converted to a
<code>float</code> before the comparison is performed. For floating-point
numbers, the special negative zero value tests equal to the regular,
positive zero value. Also, the special <code>NaN</code> (Not a Number) value is
not equal to any other number, including itself. <a data-primary="floating-point types" data-secondary="testing if value is NaN" data-type="indexterm" id="3_idm45941150738824"></a><a data-primary="isNan()" data-type="indexterm" id="3_idm45941150737848"></a><a data-primary="NaN (Not-a-number)" data-secondary="equality tests of" data-type="indexterm" id="3_idm45941150737176"></a>To test whether a
floating-point value is <code>NaN</code>, use the <code>Float.isNan()</code> or
<code>Double.isNan()</code> method.</p>
</dd>
<dt><em>Not equals</em> (<code>!=</code>)</dt>
<dd>
<p><a data-primary="! (exclamation point)" data-secondary="!= (not equal to) operator" data-type="indexterm" id="3_idm45941150733352"></a><a data-primary="not equals operator (!=)" data-type="indexterm" id="3_idm45941150732216"></a>The <code>!=</code> operator is exactly the opposite of the <code>==</code> operator. It evaluates to <code>true</code> if its two primitive operands have different values or if its two reference operands refer to different objects or arrays. Otherwise, it evaluates to <code>false</code>.</p>

<p><a data-primary="relational operators" data-type="indexterm" id="3_idm45941150729432"></a>The relational operators can be used with numbers and characters, but not with <code>boolean</code> values, objects, or arrays because those types are not ordered.</p>
</dd>
</dl>

<p>Java provides the following relational operators:</p>
<dl>
<dt><em>Less than</em> (<code>&lt;</code>)</dt>
<dd>
<p>Evaluates to <code>true</code> if the first operand is less than the second.</p>
</dd>
<dt><em>Less than or equal</em> (<code>&lt;=</code>)</dt>
<dd>
<p><a data-primary="&lt; &gt; (angle brackets)" data-secondary="&lt;= (less than or equal to) operator" data-type="indexterm" id="3_idm45941150705192"></a><a data-primary="&lt; &gt; (angle brackets)" data-secondary="&gt; (greater than) operator" data-type="indexterm" id="3_idm45941150704248"></a><a data-primary="greater than operator (&gt;)" data-type="indexterm" id="3_idm45941150703288"></a><a data-primary="less than or equal to operator (&lt;=)" data-type="indexterm" id="3_idm45941150702600"></a>Evaluates to <code>true</code> if the first operand is less than or equal to the second.</p>
</dd>
<dt><em>Greater than</em> (<code>&gt;</code>)</dt>
<dd>
<p>Evaluates to <code>true</code> if the first operand is greater than the second.</p>
</dd>
<dt><em>Greater than or equal</em> (<code>&gt;=</code>)</dt>
<dd>
<p><a data-primary="&lt; &gt; (angle brackets)" data-secondary="&gt;= (greater than or equal to) operator" data-type="indexterm" id="3_idm45941150696888"></a><a data-primary="greater than or equal to operator (&gt;=)" data-type="indexterm" id="3_idm45941150695896"></a>Evaluates to <code>true</code> if the first operand is greater than or equal to the second.</p>
</dd>
</dl>
</div></section>













<section data-pdf-bookmark="Boolean Operators" data-type="sect2"><div class="sect2" id="idm45941150694408">
<h2>Boolean Operators</h2>

<p><a data-primary="Boolean operators" data-type="indexterm" id="3_ix_ch02-asciidoc14"></a><a data-primary="logical operators" data-type="indexterm" id="3_ix_ch02-asciidoc15"></a><a data-primary="operators" data-secondary="Boolean" data-type="indexterm" id="3_ix_ch02-asciidoc16"></a>As we鈥檝e just seen, the comparison operators compare their operands
and yield a <code>boolean</code> result, which is often used in branching and
looping statements. In order to make branching and looping decisions
based on conditions more interesting than a single comparison, you can
use the Boolean (or logical) operators to combine multiple comparison
expressions into a single, more complex expression. The Boolean
operators require their operands to be <code>boolean</code> values and they
evaluate to <code>boolean</code> values. The operators are:</p>
<dl>
<dt><em>Conditional AND</em> (<code>&amp;&amp;</code>)</dt>
<dd>
<p><a data-primary="&amp; (ampersand)" data-secondary="&amp;&amp; (conditional AND) operator" data-type="indexterm" id="3_idm45941150685640"></a><a data-primary="conditional AND operator (&amp;&amp;)" data-type="indexterm" id="3_idm45941150684472"></a> This operator performs a Boolean AND operation on its operands. It evaluates to <code>true</code> if and only if both its operands are <code>true</code>. If either or both operands are <code>false</code>, it evaluates to <code>false</code>. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">if</code> <code class="o">(</code><code class="n">x</code> <code class="o">&lt;</code> <code class="mi">10</code> <code class="o">&amp;&amp;</code> <code class="n">y</code> <code class="o">&gt;</code> <code class="mi">3</code><code class="o">)</code> <code class="o">...</code> <code class="c1">// If both comparisons are true</code></pre>

<p>This operator (and all the Boolean operators except the unary <code>!</code>
operator) have a lower precedence than the comparison operators. Thus,
it is perfectly legal to write a line of code like the one just shown.
However, some programmers prefer to use parentheses to make the order
of evaluation explicit:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">if</code> <code class="o">((</code><code class="n">x</code> <code class="o">&lt;</code> <code class="mi">10</code><code class="o">)</code> <code class="o">&amp;&amp;</code> <code class="o">(</code><code class="n">y</code> <code class="o">&gt;</code> <code class="mi">3</code><code class="o">))</code> <code class="o">...</code></pre>

<p>You should use whichever style you find easier to read.</p>

<p>This operator is called a conditional AND because it conditionally
evaluates its second operand. If the first operand evaluates to
<code>false</code>, the value of the expression is <code>false</code>, regardless of the
value of the second operand. <a data-primary="evaluation of expressions" data-secondary="shortcutting" data-type="indexterm" id="3_idm45941150667144"></a>Therefore, to increase efficiency, the
Java interpreter takes a shortcut and skips the second operand. The
second operand is not guaranteed to be evaluated, so you must use
caution when using this operator with expressions that have side
effects. On the other hand, the conditional nature of this operator
allows us to write Java expressions such as the following:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">if</code> <code class="o">(</code><code class="n">data</code> <code class="o">!=</code> <code class="kc">null</code> <code class="o">&amp;&amp;</code> <code class="n">i</code> <code class="o">&lt;</code> <code class="n">data</code><code class="o">.</code><code class="na">length</code> <code class="o">&amp;&amp;</code> <code class="n">data</code><code class="o">[</code><code class="n">i</code><code class="o">]</code> <code class="o">!=</code> <code class="o">-</code><code class="mi">1</code><code class="o">)</code>
    <code class="o">...</code></pre>

<p>The second and third comparisons in this expression would cause errors
if the first or second comparisons evaluated to <code>false</code>. Fortunately,
we don鈥檛 have to worry about this because of the conditional behavior
of the <code>&amp;&amp;</code> operator.</p>
</dd>
<dt><em>Conditional OR</em> (<code>||</code>)</dt>
<dd>
<p><a data-primary="| (vertical bar)" data-secondary="|| (conditional OR) operator" data-type="indexterm" id="3_idm45941150580504"></a>This operator performs a Boolean OR operation on its two <code>boolean</code> operands. It evaluates to <code>true</code> if either or both of its operands are <code>true</code>. If both operands are <code>false</code>, it evaluates to <code>false</code>. Like the <code>&amp;&amp;</code> operator, <code>||</code> does not always evaluate its second operand. If the first operand evaluates to <code>true</code>, the value of the expression is <code>true</code>, regardless of the value of the second operand. Thus, the operator simply skips the second operand in that case.</p>
</dd>
<dt><em>Boolean NOT</em> (<code>!</code>)</dt>
<dd>
<p><a data-primary="! (exclamation point)" data-secondary="boolean NOT operator" data-type="indexterm" id="3_idm45941150573448"></a><a data-primary="NOT operator" data-secondary="boolean NOT (!)" data-type="indexterm" id="3_idm45941150572248"></a>This unary operator changes the <code>boolean</code> value of its operand. If applied to a <code>true</code> value, it evaluates to <code>false</code>, and if applied to a <code>false</code> value, it evaluates to <code>true</code>. It is useful in expressions like these:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">if</code> <code class="o">(!</code><code class="n">found</code><code class="o">)</code> <code class="o">...</code>          <code class="c1">// found is a boolean declared somewhere</code>
<code class="k">while</code> <code class="o">(!</code><code class="n">c</code><code class="o">.</code><code class="na">isEmpty</code><code class="o">())</code> <code class="o">...</code> <code class="c1">// The isEmpty() method returns a boolean</code></pre>

<p>Because <code>!</code> is a unary operator, it has a high precedence and often
must be used with parentheses:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">if</code> <code class="o">(!(</code><code class="n">x</code> <code class="o">&gt;</code> <code class="n">y</code> <code class="o">&amp;&amp;</code> <code class="n">y</code> <code class="o">&gt;</code> <code class="n">z</code><code class="o">))</code></pre>
</dd>
<dt><em>Boolean AND</em> (<code>&amp;</code>)</dt>
<dd>
<p><a data-primary="&amp; (ampersand)" data-secondary="boolean AND operator" data-type="indexterm" id="3_idm45941150520376"></a>When used with <code>boolean</code> operands, the <code>&amp;</code> operator behaves like the <code>&amp;&amp;</code> operator, except that it always evaluates both operands, regardless of the value of the first operand. This operator is almost always used as a bitwise operator with integer operands, however, and many Java programmers would not even recognize its use with <code>boolean</code> operands as legal Java code.</p>
</dd>
<dt><em>Boolean OR</em> (<code>|</code>)</dt>
<dd>
<p><a data-primary="| (vertical bar)" data-secondary="boolean OR operator" data-type="indexterm" id="3_idm45941150515496"></a>This operator performs a Boolean OR operation on its two <code>boolean</code> operands. It is like the <code>||</code> operator, except that it always evaluates both operands, even if the first one is <code>true</code>. The <code>|</code> operator is almost always used as a bitwise operator on integer operands; its use with <code>boolean</code> operands is very rare.</p>
</dd>
<dt><em>Boolean XOR</em> (<code>^</code>)</dt>
<dd>
<p><a data-primary="鈥?(caret)" data-secondary="boolean XOR operator" data-type="indexterm" id="3_idm45941150480568"></a><a data-primary="XOR operator" data-secondary="boolean XOR (鈥?" data-type="indexterm" id="3_idm45941150479192"></a>When used with <code>boolean</code> operands, this operator computes the exclusive OR (XOR) of its operands. It evaluates to <code>true</code> if exactly one of the two operands is <code>true</code>. In other words, it evaluates to <code>false</code> if both operands are <code>false</code> or if both operands are <code>true</code>. Unlike the <code>&amp;&amp;</code> and <code>||</code> operators, this one must always evaluate both operands. The <code>^</code> operator is much more commonly used as a bitwise operator on integer operands. With <code>boolean</code> operands, this operator is equivalent to the <code>!=</code> operator.<a data-startref="ix_ch02-asciidoc16" data-type="indexterm" id="3_idm45941150473336"></a><a data-startref="ix_ch02-asciidoc15" data-type="indexterm" id="3_idm45941150472600"></a><a data-startref="ix_ch02-asciidoc14" data-type="indexterm" id="3_idm45941150471928"></a></p>
</dd>
</dl>
</div></section>













<section data-pdf-bookmark="Bitwise and Shift Operators" data-type="sect2"><div class="sect2" id="idm45941150687608">
<h2>Bitwise and Shift Operators</h2>

<p><a data-primary="bitwise operators" data-type="indexterm" id="3_idm45941150453992"></a><a data-primary="operators" data-secondary="bitwise" data-type="indexterm" id="3_idm45941150453288"></a><a data-primary="operators" data-secondary="shift" data-type="indexterm" id="3_idm45941150452344"></a>The bitwise and shift operators are low-level operators that
manipulate the individual bits that make up an integer value. The
bitwise operators are not commonly used in modern Java except for
low-level work (e.g., network programming). They are used for testing
and setting individual flag bits in a value. In order to understand
their behavior, you must understand binary (base-2) numbers and the
two鈥檚 complement format used to represent negative integers.</p>

<p>You cannot use these operators with floating-point, <code>boolean</code>, array, or
object operands. When used with <code>boolean</code> operands, the <code>&amp;</code>, <code>|</code>, and
<code>^</code> operators perform a different operation, as described in the
previous section.</p>

<p>If either of the arguments to a bitwise operator is a <code>long</code>, the result
is a <code>long</code>. Otherwise, the result is an <code>int</code>. If the left operand of a
shift operator is a <code>long</code>, the result is a <code>long</code>; otherwise, the
result is an <code>int</code>. The operators are:</p>
<dl>
<dt><em>Bitwise complement</em> (<code>~</code>)</dt>
<dd>
<p><a data-primary="~ (tilde), bitwise complement operator" data-type="indexterm" id="3_idm45941150442360"></a><a data-primary="NOT operator" data-secondary="bitwise NOT ()" data-type="indexterm" id="3_idm45941150441688"></a>The unary <code>~</code> operator is known as the bitwise complement, or bitwise NOT, operator. It inverts each bit of its single operand, converting 1s to 0s and 0s to 1s. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">byte</code> <code class="n">b</code> <code class="o">=</code> <code class="o">~</code><code class="mi">12</code><code class="o">;</code>           <code class="c1">// ~00001100 =  =&gt; 11110011 or -13 decimal</code>
<code class="n">flags</code> <code class="o">=</code> <code class="n">flags</code> <code class="o">&amp;</code> <code class="o">~</code><code class="n">f</code><code class="o">;</code>     <code class="c1">// Clear flag f in a set of flags</code></pre>
</dd>
<dt><em>Bitwise AND</em> (<code>&amp;</code>)</dt>
<dd>
<p><a data-primary="&amp; (ampersand)" data-secondary="bitwise AND operator" data-type="indexterm" id="3_idm45941150420488"></a>This operator combines its two integer operands by performing a Boolean AND operation on their individual bits. The result has a bit set only if the corresponding bit is set in both operands. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="mi">10</code> <code class="o">&amp;</code> <code class="mi">7</code>                   <code class="c1">// 00001010 &amp; 00000111 =  =&gt; 00000010 or 2</code>
<code class="k">if</code> <code class="o">((</code><code class="n">flags</code> <code class="o">&amp;</code> <code class="n">f</code><code class="o">)</code> <code class="o">!=</code> <code class="mi">0</code><code class="o">)</code>    <code class="c1">// Test whether flag f is set</code></pre>

<p>When used with <code>boolean</code> operands, <code>&amp;</code> is the infrequently used
Boolean AND operator described earlier.</p>
</dd>
<dt><em>Bitwise OR</em> (<code>|</code>)</dt>
<dd>
<p><a data-primary="| (vertical bar)" data-secondary="bitwise OR operator" data-type="indexterm" id="3_idm45941150411752"></a><a data-primary="bitwise OR operator" data-type="indexterm" id="3_idm45941150410776"></a>This operator combines its two integer operands by performing a Boolean OR operation on their individual bits. The result has a bit set if the corresponding bit is set in either or both of the operands. It has a zero bit only where both corresponding operand bits are zero. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="mi">10</code> <code class="o">|</code> <code class="mi">7</code>                   <code class="c1">// 00001010 | 00000111 =  =&gt; 00001111 or 15</code>
<code class="n">flags</code> <code class="o">=</code> <code class="n">flags</code> <code class="o">|</code> <code class="n">f</code><code class="o">;</code>       <code class="c1">// Set flag f</code></pre>

<p>When used with <code>boolean</code> operands, <code>|</code> is the infrequently used
Boolean OR operator described earlier.</p>
</dd>
<dt><em>Bitwise XOR</em> (<code>^</code>)</dt>
<dd>
<p><a data-primary="鈥?(caret)" data-secondary="bitwise XOR operator" data-type="indexterm" id="3_idm45941150325720"></a><a data-primary="XOR operator" data-secondary="bitwise XOR (鈥?" data-type="indexterm" id="3_idm45941150324744"></a>This operator combines its two integer operands by performing a Boolean XOR (exclusive OR) operation on their individual bits. The result has a bit set if the corresponding bits in the two operands are different. If the corresponding operand bits are both 1s or both 0s, the result bit is a 0. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="mi">10</code> <code class="o">^</code> <code class="mi">7</code>               <code class="c1">// 00001010 ^ 00000111 =  =&gt; 00001101 or 13</code></pre>

<p>When used with <code>boolean</code> operands, <code>^</code> is the seldom used Boolean
XOR <span class="keep-together">operator</span>.</p>
</dd>
<dt><em>Left shift</em> (<code>&lt;&lt;</code>)</dt>
<dd>
<p><a data-primary="&lt; &gt; (angle brackets)" data-secondary="&lt;&lt; (left shift) operator" data-type="indexterm" id="3_idm45941150370792"></a><a data-primary="left shift operator (&lt;&lt;)" data-type="indexterm" id="3_idm45941150369768"></a><a data-primary="operators" data-secondary="shift" data-type="indexterm" id="3_idm45941150369128"></a><a data-primary="shift operators" data-type="indexterm" id="3_idm45941150368184"></a>The <code>&lt;&lt;</code> operator shifts the bits of the left operand left by the number of places specified by the right operand. High-order bits of the left operand are lost, and zero bits are shifted in from the right. Shifting an integer left by <em>n</em> places is equivalent to multiplying that number by 2<sup><em>n</em></sup>. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="mi">10</code> <code class="o">&lt;&lt;</code> <code class="mi">1</code>    <code class="c1">// 0b00001010 &lt;&lt; 1 = 00010100 = 20 = 10*2</code>
<code class="mi">7</code> <code class="o">&lt;&lt;</code> <code class="mi">3</code>     <code class="c1">// 0b00000111 &lt;&lt; 3 = 00111000 = 56 = 7*8</code>
<code class="o">-</code><code class="mi">1</code> <code class="o">&lt;&lt;</code> <code class="mi">2</code>    <code class="c1">// 0xFFFFFFFF &lt;&lt; 2 = 0xFFFFFFFC = -4 = -1*4</code>
           <code class="c1">// 0xFFFF_FFFC == 0b1111_1111_1111_1111_1111_1111_1111_1100</code></pre>

<p>If the left operand is a <code>long</code>, the right operand should be between 0
and 63. Otherwise, the left operand is taken to be an <code>int</code>, and the
right operand should be between 0 and 31.</p>
</dd>
<dt><em>Signed right shift</em> (<code>&gt;&gt;</code>)</dt>
<dd>
<p><a data-primary="&lt; &gt; (angle brackets)" data-secondary="&gt;&gt; (signed right shift) operator" data-type="indexterm" id="3_idm45941150287224"></a><a data-primary="right shift operators" data-type="indexterm" id="3_idm45941150286280"></a>The <code>&gt;&gt;</code> operator shifts the bits of the left operand to the right by the number of places specified by the right operand. The low-order bits of the left operand are shifted away and are lost. The high-order bits shifted in are the same as the original high-order bit of the left operand. In other words, if the left operand is positive, 0s are shifted into the high-order bits. If the left operand is negative, 1s are shifted in instead. This technique is known as <em>sign extension</em>; it is used to preserve the sign of the left operand. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="mi">10</code> <code class="o">&gt;&gt;</code> <code class="mi">1</code>      <code class="c1">// 00001010 &gt;&gt; 1 = 00000101 = 5 = 10/2</code>
<code class="mi">27</code> <code class="o">&gt;&gt;</code> <code class="mi">3</code>      <code class="c1">// 00011011 &gt;&gt; 3 = 00000011 = 3 = 27/8</code>
<code class="o">-</code><code class="mi">50</code> <code class="o">&gt;&gt;</code> <code class="mi">2</code>     <code class="c1">// 11001110 &gt;&gt; 2 = 11110011 = -13 != -50/4</code></pre>

<p>If the left operand is positive and the right operand is <em>n</em>, the <code>&gt;&gt;</code>
operator is the same as integer division by 2<sup><em>n</em></sup>.</p>
</dd>
<dt><em>Unsigned right shift</em> (<code>&gt;&gt;&gt;</code>)</dt>
<dd>
<p><a data-primary="&lt; &gt; (angle brackets)" data-secondary="&gt;&gt;&gt; (unsigned right shift) operator" data-type="indexterm" id="3_idm45941150247688"></a><a data-primary="zero extension" data-type="indexterm" id="3_idm45941150246744"></a>This operator is like the <code>&gt;&gt;</code> operator, except that it always shifts zeros into the high-order bits of the result, regardless of the sign of the lefthand operand. This technique is called <em>zero extension</em>; it is appropriate when the left operand is being treated as an unsigned value (despite the fact that Java integer types are all signed). These are examples:</p>

<pre data-code-language="java" data-type="programlisting"><code class="mh">0xff</code> <code class="o">&gt;&gt;&gt;</code> <code class="mi">4</code>    <code class="c1">// 11111111 &gt;&gt;&gt; 4 = 00001111 = 15  = 255/16</code>
<code class="o">-</code><code class="mi">50</code> <code class="o">&gt;&gt;&gt;</code> <code class="mi">2</code>     <code class="c1">// 0xFFFFFFCE &gt;&gt;&gt; 2 = 0x3FFFFFF3 = 1073741811</code></pre>
</dd>
</dl>
</div></section>













<section data-pdf-bookmark="Assignment Operators" data-type="sect2"><div class="sect2" id="idm45941150444104">
<h2>Assignment Operators</h2>

<p><a data-primary="assignment operators" data-type="indexterm" id="3_idm45941145161944"></a><a data-primary="operators" data-secondary="assignment" data-type="indexterm" id="3_idm45941145161240"></a><a data-primary="storage location" data-type="indexterm" id="3_idm45941145160296"></a>The assignment operators store, or assign, a value into a piece of the computer鈥檚 memory鈥攐ften referred to as a <em>storage location</em>.
The left operand must evaluate to an appropriate local variable, array element, or object field.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The <a data-primary="lvalue" data-type="indexterm" id="3_idm45941145157864"></a>lefthand side of an assignment expression is sometimes called an <code><em>lvalue</em></code>. In Java it must refer to some assignable storage (i.e., memory that can be written to).</p>
</div>

<p><a data-primary="rvalue" data-type="indexterm" id="3_idm45941145136712"></a>The righthand side (the <code><em>rvalue</em></code>) can be any value of a type compatible with the variable.
An assignment expression evaluates to the value that is assigned to the variable.
More importantly, however, the expression has the side effect of actually performing the assignment鈥攕toring the <code>rvalue</code> in the <code>lvalue</code>.</p>
<div data-type="tip"><h6>Tip</h6>
<p>Unlike all other binary operators, the assignment operators are right-associative, which means that the assignments in <code>a=b=c</code> are performed right to left, as follows:
<code>a=(b=c)</code>.</p>
</div>

<p><a data-primary="= (equals sign)" data-secondary="= (assignment) operator, confusion with == (equal to) operator" data-type="indexterm" id="3_idm45941145131784"></a><a data-primary="= (equals sign)" data-secondary="assignment operator" data-type="indexterm" id="3_idm45941145130840"></a><a data-primary="equality operator (==)" data-secondary="confusion with = (assignment) operator" data-type="indexterm" id="3_idm45941145129896"></a>The basic assignment operator is <code>=</code>. Do not confuse it with the
equality operator, <code>==</code>. In order to keep these two operators distinct,
we recommend that you read <code>=</code> as 鈥渋s assigned the value.鈥?/p&gt;

<p><a data-primary="assignment operators" data-secondary="combined with arithmetic, bitwise, and shift operators" data-type="indexterm" id="3_idm45941145127288"></a>In addition to this simple assignment operator, Java also defines 11
other operators that combine assignment with the 5 arithmetic operators
and the 6 bitwise and shift operators. <a data-primary="+ (plus sign)" data-secondary="+= (add assignment) operator" data-type="indexterm" id="3_idm45941145125672"></a>For example, the <code>+=</code> operator reads the value of the left variable, adds the value of the right
operand to it, stores the sum back into the left variable as a side
effect, and returns the sum as the value of the expression. Thus, the
expression <code>x+=2</code> is almost the same as <code>x=x+2</code>. The difference between
these two expressions is that when you use the <code>+=</code> operator, the left
operand is evaluated only once. This makes a difference when that
operand has a side effect. Consider the following two expressions, which
are not equivalent:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">a</code><code class="o">[</code><code class="n">i</code><code class="o">++]</code> <code class="o">+=</code> <code class="mi">2</code><code class="o">;</code>
<code class="n">a</code><code class="o">[</code><code class="n">i</code><code class="o">++]</code> <code class="o">=</code> <code class="n">a</code><code class="o">[</code><code class="n">i</code><code class="o">++]</code> <code class="o">+</code> <code class="mi">2</code><code class="o">;</code></pre>

<p>The general form of these combination assignment operators is:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">lvalue</code> <code class="n">op</code><code class="o">=</code> <code class="n">rvalue</code></pre>

<p>This is equivalent (unless there are side effects in <code>lvalue</code>) to:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">lvalue</code> <code class="o">=</code> <code class="n">lvalue</code> <code class="n">op</code> <code class="n">rvalue</code></pre>

<p><a data-primary="- (minus sign)" data-secondary="-= (subtract assignment) operator" data-type="indexterm" id="3_idm45941145062776"></a><a data-primary="* (asterisk)" data-secondary="*= (multiply assignment) operator" data-type="indexterm" id="3_idm45941145034248"></a><a data-primary="/ (slash)" data-secondary="/= (divide assignment) operator" data-type="indexterm" id="3_idm45941145033368"></a><a data-primary="% (percent sign)" data-secondary="%= (modulo assignment) operator" data-type="indexterm" id="3_idm45941145032456"></a><a data-primary="&amp; (ampersand)" data-secondary="&amp;= (bitwise AND assignment) operator" data-type="indexterm" id="3_idm45941145080552"></a><a data-primary="&lt; &gt; (angle brackets)" data-secondary="&lt;&lt;= (left shift assignment) operator" data-type="indexterm" id="3_idm45941145079592"></a><a data-primary="&lt; &gt; (angle brackets)" data-secondary="&gt;&gt;&gt;= (unsigned right shift assignment) operator" data-type="indexterm" id="3_idm45941145078632"></a><a data-primary="&lt; &gt; (angle brackets)" data-secondary="&gt;&gt;= (right shift assignment) operator" data-type="indexterm" id="3_idm45941145072104"></a><a data-primary="鈥?(caret)" data-secondary="鈥? (bitwise XOR assignment) operator" data-type="indexterm" id="3_idm45941145071144"></a><a data-primary="| (vertical bar)" data-secondary="|= (bitwise OR assignment) operator" data-type="indexterm" id="3_idm45941145070184"></a>The available operators are:</p>

<pre data-code-language="java" data-type="programlisting"><code class="o">+=</code>    <code class="o">-=</code>    <code class="o">*=</code>    <code class="o">/=</code>    <code class="o">%=</code>    <code class="c1">// Arithmetic operators plus assignment</code>

<code class="o">&amp;=</code>    <code class="o">|=</code>    <code class="o">^=</code>                <code class="c1">// Bitwise operators plus assignment</code>

<code class="o">&lt;&lt;=</code>   <code class="o">&gt;&gt;=</code>   <code class="o">&gt;&gt;&gt;=</code>              <code class="c1">// Shift operators plus assignment</code></pre>

<p><a data-primary="boolean type" data-secondary="using +=, -=, &amp;=, and |= to work with boolean flags" data-type="indexterm" id="3_idm45941144981688"></a>The most commonly used operators are <code>+=</code> and <code>-=</code>, although <code>&amp;=</code>
and <code>|=</code> can also be useful when you are working with <code>boolean</code> flags. For
example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">i</code> <code class="o">+=</code> <code class="mi">2</code><code class="o">;</code>          <code class="c1">// Increment a loop counter by 2</code>
<code class="n">c</code> <code class="o">-=</code> <code class="mi">5</code><code class="o">;</code>          <code class="c1">// Decrement a counter by 5</code>
<code class="n">flags</code> <code class="o">|=</code> <code class="n">f</code><code class="o">;</code>      <code class="c1">// Set a flag f in an integer set of flags</code>
<code class="n">flags</code> <code class="o">&amp;=</code> <code class="o">~</code><code class="n">f</code><code class="o">;</code>     <code class="c1">// Clear a flag f in an integer set of flags</code></pre>
</div></section>













<section data-pdf-bookmark="The Conditional Operator" data-type="sect2"><div class="sect2" id="idm45941144972616">
<h2>The Conditional Operator</h2>

<p><a data-primary="? (question mark)" data-secondary="? : (conditional) operator" data-type="indexterm" id="3_idm45941144957592"></a><a data-primary="conditional operator (? :)" data-type="indexterm" id="3_idm45941144956456"></a><a data-primary="operators" data-secondary="conditional" data-type="indexterm" id="3_idm45941144955768"></a>The conditional operator <code>?</code>: is a somewhat obscure ternary
(three-operand) operator inherited from C. It allows you to embed a
conditional within an expression. <a data-primary="if/else statements" data-secondary="conditional operator (? :) as version of" data-type="indexterm" id="3_idm45941144935496"></a>You can think of it as the operator
version of the <code>if/else</code> statement. The first and second operands of
the conditional operator are separated by a question mark (<code>?</code>), while
the second and third operands are separated by a colon (:). The first
operand must evaluate to a <code>boolean</code> value. The second and third
operands can be of any type, but they must be convertible to the same
type.</p>

<p>The conditional operator starts by evaluating its first operand. If it
is <code>true</code>, the operator evaluates its second operand and uses that as
the value of the expression. On the other hand, if the first operand is
<code>false</code>, the conditional operator evaluates and returns its third
operand. The conditional operator never evaluates both its second and
third operand, so be careful when using expressions with side effects
with this operator. Examples of this operator are:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">int</code> <code class="n">max</code> <code class="o">=</code> <code class="o">(</code><code class="n">x</code> <code class="o">&gt;</code> <code class="n">y</code><code class="o">)</code> <code class="o">?</code> <code class="n">x</code> <code class="o">:</code> <code class="n">y</code><code class="o">;</code>
<code class="n">String</code> <code class="n">name</code> <code class="o">=</code> <code class="o">(</code><code class="n">name</code> <code class="o">!=</code> <code class="kc">null</code><code class="o">)</code> <code class="o">?</code> <code class="n">name</code> <code class="o">:</code> <code class="s">unknown</code><code class="o">;</code></pre>

<p>Note that the <code>?</code>: operator has lower precedence than all other
operators except the assignment operators, so parentheses are not
usually necessary around the operands of this operator. Many programmers
find conditional expressions easier to read if the first operand is
placed within parentheses, however. This is especially true because the
conditional <code>if</code> statement always has its conditional expression written
within parentheses.</p>
</div></section>













<section data-pdf-bookmark="The instanceof Operator" data-type="sect2"><div class="sect2" id="idm45941144873896">
<h2>The instanceof Operator</h2>

<p><a data-primary="data types" data-secondary="instanceof operator" data-type="indexterm" id="3_idm45941144872520"></a><a data-primary="instanceof operator" data-type="indexterm" id="3_idm45941144871544"></a><a data-primary="operators" data-secondary="instanceof" data-type="indexterm" id="3_idm45941144870872"></a>The <code>instanceof</code> operator is intimately bound up with objects and the
operation of the Java type system. If this is your first look at Java,
it may be preferable to skim this definition and return to this section
after you have a decent grasp of Java鈥檚 objects.</p>

<p><a data-primary="arrays" data-secondary="as operand type" data-type="indexterm" id="3_idm45941144868840"></a><a data-primary="objects" data-secondary="as operand type" data-type="indexterm" id="3_idm45941144867464"></a><a data-primary="reference types" data-secondary="as operand type" data-type="indexterm" id="3_idm45941144866520"></a><code>instanceof</code> requires an object or array value as its left operand and
the name of a reference type as its right operand. It evaluates to
<code>true</code> if the object or array is an <em>instance</em> of the specified type; it
returns <code>false</code> otherwise. If the left operand is <code>null</code>, <code>instanceof</code>
always evaluates to <code>false</code>. If an <code>instanceof</code> expression evaluates to
<code>true</code>, it means that you can safely cast and assign the left operand to
a variable of the type of the right operand.</p>

<p>The <code>instanceof</code> operator can be used only with reference types and
objects, not primitive types and values. Examples of <code>instanceof</code> are:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// True: all strings are instances of String</code>
<code class="s">string</code> <code class="k">instanceof</code> <code class="n">String</code>
<code class="c1">// True: strings are also instances of Object</code>
<code class="s"></code> <code class="k">instanceof</code> <code class="n">Object</code>
<code class="c1">// False: null is never an instance of anything</code>
<code class="kc">null</code> <code class="k">instanceof</code> <code class="n">String</code>

<code class="n">Object</code> <code class="n">o</code> <code class="o">=</code> <code class="k">new</code> <code class="kt">int</code><code class="o">[]</code> <code class="o">{</code><code class="mi">1</code><code class="o">,</code><code class="mi">2</code><code class="o">,</code><code class="mi">3</code><code class="o">};</code>
<code class="n">o</code> <code class="k">instanceof</code> <code class="kt">int</code><code class="o">[]</code>   <code class="c1">// True: the array value is an int array</code>
<code class="n">o</code> <code class="k">instanceof</code> <code class="kt">byte</code><code class="o">[]</code>  <code class="c1">// False: the array value is not a byte array</code>
<code class="n">o</code> <code class="k">instanceof</code> <code class="n">Object</code>  <code class="c1">// True: all arrays are instances of Object</code>

<code class="c1">// Use instanceof to make sure that it is safe to cast an object</code>
<code class="k">if</code> <code class="o">(</code><code class="n">object</code> <code class="k">instanceof</code> <code class="n">Point</code><code class="o">)</code> <code class="o">{</code>
   <code class="n">Point</code> <code class="n">p</code> <code class="o">=</code> <code class="o">(</code><code class="n">Point</code><code class="o">)</code> <code class="n">object</code><code class="o">;</code>
<code class="o">}</code></pre>

<p>In general, the use of <code>instanceof</code> is discouraged among Java programmers.
It is often a sign of questionable program design.
Under normal circumstances, the usage of <code>instanceof</code> can be avoided; it is only needed on rare occasions (but note that there are some cases where it is needed).</p>
</div></section>













<section data-pdf-bookmark="Special Operators" data-type="sect2"><div class="sect2" id="idm45941144772040">
<h2>Special Operators</h2>

<p><a data-primary="operators" data-secondary="special" data-type="indexterm" id="3_ix_ch02-asciidoc17"></a><a data-primary="special operators (language constructs)" data-type="indexterm" id="3_ix_ch02-asciidoc18"></a>Java has six language constructs that are sometimes considered
operators and sometimes considered simply part of the basic language
syntax. These 鈥渙perators鈥?were included in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2-TABLE-4">Table 2-4</a> in order to show their
precedence relative to the other true operators. The use of these
language constructs is detailed elsewhere in this book, but is described
briefly here so that you can recognize them in code examples:</p>
<dl>
<dt><em>Member access</em> (<code>.</code>)</dt>
<dd>
<p><a data-primary=". (dot)" data-secondary="member access operator" data-type="indexterm" id="3_idm45941144764920"></a><a data-primary="member access operator (.)" data-type="indexterm" id="3_idm45941144763752"></a>An <em>object</em> is a collection of data and methods that operate on that data; the data fields and methods of an object are called its members. The dot (.) operator accesses these members. If <code>o</code> is an expression that evaluates to an object reference (or a class name), and <code>f</code> is the name of a field of the class, <code>o.f</code> evaluates to the value contained in that field. If <code>m</code> is the name of a method, <code>o.m</code> refers to that method and allows it to be invoked using the <code>()</code> operator shown later.</p>
</dd>
<dt><em>Array element access</em> (<code>[]</code>)</dt>
<dd>
<p><a data-primary="[ ] (brackets)" data-secondary="accessing array elements" data-type="indexterm" id="3_idm45941144758056"></a><a data-primary="arrays" data-secondary="accessing elements" data-type="indexterm" id="3_idm45941144756664"></a>An <em>array</em> is a numbered list of values. Each element of an array can be referred to by its number, or <em>index</em>. The <code>[ ]</code> operator allows you to refer to the individual elements of an array. If <code>a</code> is an array, and <code>i</code> is an expression that evaluates to an <code>int</code>, <code>a[i]</code> refers to one of the elements of <code>a</code>. Unlike other operators that work with integer values, this operator restricts array index values to be of type <code>int</code> or narrower.</p>
</dd>
<dt><em>Method invocation</em> (<code>()</code>)</dt>
<dd>
<p><a data-primary="( ) (parentheses)" data-secondary="method invocation operator" data-type="indexterm" id="3_idm45941144749896"></a><a data-primary="method invocation operator (( ))" data-type="indexterm" id="3_idm45941144748456"></a>A <em>method</em> is a named collection of Java code that can be run, or <em>invoked</em>, by following the name of the method with zero or more comma-separated expressions contained within parentheses. The values of these expressions are the <em>arguments</em> to the method. The method processes the arguments and optionally returns a value that becomes the value of the method invocation expression. If <code>o.m</code> is a method that expects no arguments, the method can be invoked with <code>o.m()</code>. If the method expects three arguments, for example, it can be invoked with an expression such as <code>o.m(x,y,z)</code>. o is referred to as the <a data-primary="receiver object" data-type="indexterm" id="3_idm45941144744696"></a><a data-primary="receiver of a method" data-type="indexterm" id="3_idm45941144743992"></a><em>receiver</em> of the method鈥攊f <code>o</code> is an object, then it is said to be the <em>receiver object</em>. Before the Java interpreter invokes a method, it evaluates each of the arguments to be passed to the method. These expressions are guaranteed to be evaluated in order from left to right (which matters if any of the arguments have side effects).</p>
</dd>
<dt><em>Lambda expression</em> (<code>-&gt;</code>)</dt>
<dd>
<p><a data-primary="鈫?(lambda arrow) operator" data-type="indexterm" id="3_idm45941144740152"></a><a data-primary="lambda expressions" data-type="indexterm" id="3_idm45941144739384"></a><a data-primary="{ } (curly braces)" data-secondary="optional for small lambda expressions" data-type="indexterm" id="3_idm45941144738712"></a>A <em>lambda expression</em> is an anonymous collection of executable Java code, essentially a method body. It consists of a method argument list (zero or more comma-separated expressions contained within parentheses) followed by the lambda <em>arrow</em> operator followed by a block of Java code. If the block of code comprises just a single statement, then the usual curly braces to denote block boundaries can be omitted. If the lambda takes only a single argument, the parentheses around the argument can be omitted.</p>
</dd>
<dt><em>Object creation</em> (<code>new</code>)</dt>
<dd>
<p><a data-primary="new operator" data-type="indexterm" id="3_idm45941144734360"></a><a data-primary="new operator" data-secondary="creating new objects" data-type="indexterm" id="3_idm45941144733656"></a><a data-primary="objects" data-secondary="creation with new operator" data-type="indexterm" id="3_idm45941144732712"></a>In Java, objects are created with the <code>new</code> operator, which is followed by the type of the object to be created and a parenthesized list of arguments to be passed to the object <em>constructor</em>. <a data-primary="constructors" data-type="indexterm" id="3_idm45941144730680"></a>A constructor is a special block of code that initializes a newly created object, so the object creation syntax is similar to the Java method invocation syntax. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;();</code>
<code class="k">new</code> <code class="nf">Point</code><code class="o">(</code><code class="mi">1</code><code class="o">,</code><code class="mi">2</code><code class="o">)</code></pre>
</dd>
<dt><em>Array creation</em> (<code>new</code>)</dt>
<dd>
<p><a data-primary="arrays" data-secondary="creation with new operator" data-type="indexterm" id="3_idm45941144681608"></a><a data-primary="new operator" data-secondary="creating arrays" data-type="indexterm" id="3_idm45941144680440"></a>Arrays are a special case of objects and they too are created with the <code>new</code> operator, with a slightly different syntax. <a data-primary="[ ] (brackets)" data-secondary="after array element type" data-type="indexterm" id="3_idm45941144671112"></a>The keyword is followed by the type of the array to be created and the size of the array encased in square brackets鈥攆or example, as <code>new int[5]</code>. <a data-primary="array literal" data-type="indexterm" id="3_idm45941144669512"></a>In some circumstances arrays can also be created using the <em>array literal</em> syntax.</p>
</dd>
<dt><em>Type conversion or casting</em> (<code>()</code>)</dt>
<dd>
<p><a data-primary="( ) (parentheses)" data-secondary="cast operator" data-type="indexterm" id="3_idm45941144666472"></a><a data-primary="casts" data-secondary="( ) (cast) operator" data-type="indexterm" id="3_idm45941144665272"></a><a data-primary="data types" data-secondary="type conversion or casting with ( )" data-type="indexterm" id="3_idm45941144664328"></a><a data-primary="type conversion or casting operator (( ))" data-type="indexterm" id="3_idm45941144663416"></a>As we鈥檝e already seen, parentheses can also be used as an operator to perform narrowing type conversions, or casts. The first operand of this operator is the type to be converted to; it is placed between the parentheses. The second operand is the value to be converted; it follows the parentheses. For example<a data-startref="ix_ch02-asciidoc18" data-type="indexterm" id="3_idm45941144662264"></a><a data-startref="ix_ch02-asciidoc17" data-type="indexterm" id="3_idm45941144661592"></a>:<a data-startref="ix_ch02-asciidoc13" data-type="indexterm" id="3_idm45941144660792"></a><a data-startref="ix_ch02-asciidoc12" data-type="indexterm" id="3_idm45941144660088"></a><a data-startref="ix_ch02-asciidoc11" data-type="indexterm" id="3_idm45941144659416"></a><a data-startref="ix_ch02-asciidoc10" data-type="indexterm" id="3_idm45941144658744"></a></p>

<pre data-code-language="java" data-type="programlisting"><code class="o">(</code><code class="kt">byte</code><code class="o">)</code> <code class="mi">28</code>          <code class="c1">// An integer literal cast to a byte type</code>
<code class="o">(</code><code class="kt">int</code><code class="o">)</code> <code class="o">(</code><code class="n">x</code> <code class="o">+</code> <code class="mf">3.14f</code><code class="o">)</code>  <code class="c1">// A floating-point sum value cast to an integer</code>
<code class="o">(</code><code class="n">String</code><code class="o">)</code><code class="n">h</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="n">k</code><code class="o">)</code>   <code class="c1">// A generic object cast to a string</code></pre>
</dd>
</dl>
</div></section>





</div></section>













<section data-pdf-bookmark="Statements" data-type="sect1"><div class="sect1" id="idm45941147810040">
<h1>Statements</h1>

<p><a data-primary="statements" data-type="indexterm" id="3_ix_ch02-asciidoc19"></a><a data-primary="syntax, Java" data-secondary="statements" data-type="indexterm" id="3_ix_ch02-asciidoc20"></a>A <em>statement</em> is a basic unit of execution in the Java language鈥攊t
expresses a single piece of intent by the programmer. <a data-primary="expressions" data-secondary="statements vs." data-type="indexterm" id="3_idm45941144615704"></a><a data-primary="statements" data-secondary="expressions vs." data-type="indexterm" id="3_idm45941144614728"></a>Unlike
expressions, Java statements do not have a value. <a data-primary="operators" data-secondary="in statements" data-type="indexterm" id="3_idm45941144613656"></a>Statements also
typically contain expressions and operators (especially assignment
operators) and are frequently executed for the side effects that they
cause.</p>

<p><a data-primary="flow-control statements" data-type="indexterm" id="3_idm45941144612152"></a>Many of the statements defined by Java are flow-control statements,
such as conditionals and loops, that can alter the default, linear order
of execution in well-defined ways. <a data-primary="statements" data-secondary="defined by Java, summary of" data-type="indexterm" id="3_idm45941144611128"></a><a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2-TABLE-5">Table 2-5</a> summarizes the statements defined by Java.</p>
<table id="javanut7-CHP-2-TABLE-5">
<caption><span class="label">Table 2-5. </span>Java statements</caption>
<thead>
<tr>
<th>Statement</th>
<th>Purpose</th>
<th>Syntax</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><em>expression</em></p></td>
<td><p>side effects</p></td>
<td><p><em><code>variable</code></em> <code>=</code> <em><code>expr</code></em> <code>;</code> <em><code>expr</code></em> <code>++;</code>
<em><code>method</code></em> <code>();</code> <code>new</code> <em><code>Type</code></em> <code>( );</code></p></td>
</tr>
<tr>
<td><p><em>compound</em></p></td>
<td><p>group statements</p></td>
<td><p><code>{</code> <em><code>statements</code></em> <code>}</code></p></td>
</tr>
<tr>
<td><p><em>empty</em></p></td>
<td><p>do nothing</p></td>
<td><p><code>;</code></p></td>
</tr>
<tr>
<td><p><em>labeled</em></p></td>
<td><p>name a statement</p></td>
<td><p><em><code>label</code></em> : <em><code>statement</code></em></p></td>
</tr>
<tr>
<td><p><em>variable</em></p></td>
<td><p>declare a variable</p></td>
<td><p><code>[final]</code> <em><code>type</code></em> <em><code>name</code></em> <code>[=</code>
<em><code>value</code></em> <code>]</code> <code>[</code>, <em><code>name</code></em> <code>[=</code> <em><code>value</code></em> <code>]] 鈥?</code></p></td>
</tr>
<tr>
<td><p><code>if</code></p></td>
<td><p>conditional</p></td>
<td><p><code>if (</code> <em><code>expr</code></em> <code>)</code> <em><code>statement</code></em> <code>[ else</code>
<em><code>statement</code></em> <code>]</code></p></td>
</tr>
<tr>
<td><p><code>switch</code></p></td>
<td><p>conditional</p></td>
<td><p><code>switch (</code> <em><code>expr</code></em> <code>) {</code> <code>[ case</code> <em><code>expr</code></em> :
<em><code>statements</code></em> <code>] 鈥?/code&gt; <code>[ default</code>: <em><code>statements</code></em> <code>]</code> <code>}</code></p></td>
</tr>
<tr>
<td><p><code>while</code></p></td>
<td><p>loop</p></td>
<td><p><code>while (</code> <em><code>expr</code></em> <code>)</code> <em><code>statement</code></em></p></td>
</tr>
<tr>
<td><p><code>do</code></p></td>
<td><p>loop</p></td>
<td><p><code>do</code> <em><code>statement</code></em> <code>while (</code> <em><code>expr</code></em> <code>);</code></p></td>
</tr>
<tr>
<td><p><code>for</code></p></td>
<td><p>simplified loop</p></td>
<td><p><code>for (</code> <em><code>init</code></em> <code>;</code> <em><code>test</code></em> <code>;</code> <em><code>increment</code></em>
<code>)</code> <em><code>statement</code></em></p></td>
</tr>
<tr>
<td><p><em>foreach</em></p></td>
<td><p>collection iteration</p></td>
<td><p><code>for (</code> <em><code>variable</code></em> : <em><code>iterable</code></em>
<code>)</code> <em><code>statement</code></em></p></td>
</tr>
<tr>
<td><p><code>break</code></p></td>
<td><p>exit block</p></td>
<td><p><code>break [</code> <em><code>label</code></em> <code>] ;</code></p></td>
</tr>
<tr>
<td><p><code>continue</code></p></td>
<td><p>restart loop</p></td>
<td><p><code>continue [</code> <em><code>label</code></em> <code>] ;</code></p></td>
</tr>
<tr>
<td><p><code>return</code></p></td>
<td><p>end method</p></td>
<td><p><code>return [</code> <em><code>expr</code></em> <code>] ;</code></p></td>
</tr>
<tr>
<td><p><code>synchronized</code></p></td>
<td><p>critical section</p></td>
<td><p><code>synchronized (</code> <em><code>expr</code></em> <code>) {</code>
<em><code>statements</code></em> <code>}</code></p></td>
</tr>
<tr>
<td><p><code>throw</code></p></td>
<td><p>throw exception</p></td>
<td><p><code>throw</code> <em><code>expr</code></em> <code>;</code></p></td>
</tr>
<tr>
<td><p><code>try</code></p></td>
<td><p>handle exception</p></td>
<td><p><code>try {</code> <em><code>statements</code></em> <code>}</code> <code>[ catch (</code>
<em><code>type</code></em> <em><code>name</code></em> <code>) {</code> <em><code>statements</code></em> <code>} ] 鈥?/code&gt; <code>[ finally {</code>
<em><code>statements</code></em> <code>} ]</code></p></td>
</tr>
<tr>
<td><p><code>assert</code></p></td>
<td><p>verify invariant</p></td>
<td><p><code>assert</code> <em><code>invariant</code></em> <code>[</code> <em><code>error</code></em> ];</p></td>
</tr>
</tbody>
</table>








<section data-pdf-bookmark="Expression Statements" data-type="sect2"><div class="sect2" id="idm45941144605064">
<h2>Expression Statements</h2>

<p><a data-primary="expression statement" data-type="indexterm" id="3_idm45941144487560"></a><a data-primary="side effects" data-secondary="expressions having" data-type="indexterm" id="3_idm45941144486856"></a><a data-primary="statements" data-secondary="expression" data-type="indexterm" id="3_idm45941144485912"></a><a data-primary="statements" data-secondary="expression statements" data-type="indexterm" id="3_idm45941144484968"></a>As we saw earlier in the chapter, certain types of Java expressions
have side effects. In other words, they do not simply evaluate to some
value; they also change the program state in some way. You can use any expression
with side effects as a statement simply by following it with
a semicolon. The legal types of expression statements are assignments,
increments and decrements, method calls, and object creation. For
example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">a</code> <code class="o">=</code> <code class="mi">1</code><code class="o">;</code>                             <code class="c1">// Assignment</code>
<code class="n">x</code> <code class="o">*=</code> <code class="mi">2</code><code class="o">;</code>                            <code class="c1">// Assignment with operation</code>
<code class="n">i</code><code class="o">++;</code>                               <code class="c1">// Post-increment</code>
<code class="o">--</code><code class="n">c</code><code class="o">;</code>                               <code class="c1">// Pre-decrement</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">statement</code><code class="o">);</code>   <code class="c1">// Method invocation</code></pre>
</div></section>













<section data-pdf-bookmark="Compound Statements" data-type="sect2"><div class="sect2" id="idm45941144482168">
<h2>Compound Statements</h2>

<p><a data-primary="compound statement" data-type="indexterm" id="3_idm45941144463768"></a><a data-primary="statements" data-secondary="compound" data-type="indexterm" id="3_idm45941144461112"></a>A <em>compound statement</em> is any number and kind of statements grouped
together within curly braces. You can use a compound statement anywhere
a statement is required by Java syntax:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">for</code><code class="o">(</code><code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code> <code class="n">i</code> <code class="o">&lt;</code> <code class="mi">10</code><code class="o">;</code> <code class="n">i</code><code class="o">++)</code> <code class="o">{</code>
   <code class="n">a</code><code class="o">[</code><code class="n">i</code><code class="o">]++;</code>           <code class="c1">// Body of this loop is a compound statement.</code>
   <code class="n">b</code><code class="o">[</code><code class="n">i</code><code class="o">]--;</code>           <code class="c1">// It consists of two expression statements</code>
<code class="o">}</code>                    <code class="c1">// within curly braces.</code></pre>
</div></section>













<section data-pdf-bookmark="The Empty Statement" data-type="sect2"><div class="sect2" id="idm45941144454296">
<h2>The Empty Statement</h2>

<p><a data-primary="; (semicolon)" data-secondary="for empty statements" data-type="indexterm" id="3_idm45941144398904"></a><a data-primary="empty statements" data-type="indexterm" id="3_idm45941144397928"></a><a data-primary="statements" data-secondary="empty" data-type="indexterm" id="3_idm45941144397256"></a>An <em>empty statement</em> in Java is written as a single semicolon. The
empty statement doesn鈥檛 do anything, but the syntax is occasionally
useful. For example, you can use it to indicate an empty loop body in a
<code>for</code> loop:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">for</code><code class="o">(</code><code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code> <code class="n">i</code> <code class="o">&lt;</code> <code class="mi">10</code><code class="o">;</code> <code class="n">a</code><code class="o">[</code><code class="n">i</code><code class="o">++]++)</code>  <code class="c1">// Increment array elements</code>
     <code class="cm">/* empty */</code><code class="o">;</code>                 <code class="c1">// Loop body is empty statement</code></pre>
</div></section>













<section data-pdf-bookmark="Labeled Statements" data-type="sect2"><div class="sect2" id="idm45941144377064">
<h2>Labeled Statements</h2>

<p><a data-primary="labeled statements" data-type="indexterm" id="3_idm45941144384680"></a><a data-primary="statements" data-secondary="labeled" data-type="indexterm" id="3_idm45941144383752"></a>A <em>labeled statement</em> is simply a statement that you have given a name
by prepending an identifier and a colon to it. <a data-primary="break statements" data-secondary="labels, use of" data-type="indexterm" id="3_idm45941144343000"></a><a data-primary="continue statements" data-type="indexterm" id="3_idm45941144342024"></a>Labels are used by the
<code>break</code> and <code>continue</code> statements. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="nl">rowLoop:</code> <code class="k">for</code><code class="o">(</code><code class="kt">int</code> <code class="n">r</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code> <code class="n">r</code> <code class="o">&lt;</code> <code class="n">rows</code><code class="o">.</code><code class="na">length</code><code class="o">;</code> <code class="n">r</code><code class="o">++)</code> <code class="o">{</code>        <code class="c1">// Labeled loop</code>
   <code class="nl">colLoop:</code> <code class="k">for</code><code class="o">(</code><code class="kt">int</code> <code class="n">c</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code> <code class="n">c</code> <code class="o">&lt;</code> <code class="n">columns</code><code class="o">.</code><code class="na">length</code><code class="o">;</code> <code class="n">c</code><code class="o">++)</code> <code class="o">{</code>  <code class="c1">// Another one</code>
     <code class="k">break</code> <code class="n">rowLoop</code><code class="o">;</code>                                    <code class="c1">// Use a label</code>
   <code class="o">}</code>
<code class="o">}</code></pre>
</div></section>













<section data-pdf-bookmark="Local Variable Declaration Statements" data-type="sect2"><div class="sect2" id="idm45941144292168">
<h2>Local Variable Declaration Statements</h2>

<p><a data-primary="local variable declaration statements" data-type="indexterm" id="3_idm45941144262280"></a><a data-primary="local variables" data-type="indexterm" id="3_idm45941144261640"></a><a data-primary="statements" data-secondary="local variable declaration" data-type="indexterm" id="3_idm45941144260968"></a><a data-primary="variable declaration statement" data-type="indexterm" id="3_idm45941144260056"></a><a data-primary="variables" data-secondary="declaring" data-type="indexterm" id="3_idm45941144259368"></a><a data-primary="variables" data-secondary="local variable declaration statements" data-type="indexterm" id="3_idm45941144258424"></a>A <em>local variable</em>, often simply called a variable, is a symbolic
name for a location to store a value that is defined within a method or
compound statement. All variables must be declared before they can be
used; this is done with a variable declaration statement. Because Java
is a statically typed language, a variable declaration specifies the
type of the variable, and only values of that type can be stored in the
variable.</p>

<p>In its simplest form, a variable declaration specifies a variable鈥檚 type
and name:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">int</code> <code class="n">counter</code><code class="o">;</code>
<code class="n">String</code> <code class="n">s</code><code class="o">;</code></pre>

<p>A variable declaration can also include an <em>initializer</em>: an expression
that specifies an initial value for the variable. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code>
<code class="n">String</code> <code class="n">s</code> <code class="o">=</code> <code class="n">readLine</code><code class="o">();</code>
<code class="kt">int</code><code class="o">[]</code> <code class="n">data</code> <code class="o">=</code> <code class="o">{</code><code class="n">x</code><code class="o">+</code><code class="mi">1</code><code class="o">,</code> <code class="n">x</code><code class="o">+</code><code class="mi">2</code><code class="o">,</code> <code class="n">x</code><code class="o">+</code><code class="mi">3</code><code class="o">};</code> <code class="c1">// Array initializers are discussed later</code></pre>

<p>The Java compiler does not allow you to use a local variable that has
not been initialized, so it is usually convenient to combine variable
declaration and initialization into a single statement. <a data-primary="initializers" data-secondary="in variable declarations" data-type="indexterm" id="3_idm45941144226136"></a>The initializer
expression need not be a literal value or a constant expression that can
be evaluated by the compiler; it can be an arbitrarily complex
expression whose value is computed when the program is run.</p>

<p>If a variable has an initializer then the programmer can use a special syntax to ask the compiler to automatically work out the type, if it is possible to do so:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">var</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code> <code class="c1">// type of i inferred as int</code>
<code class="n">var</code> <code class="n">s</code> <code class="o">=</code> <code class="n">readLine</code><code class="o">();</code> <code class="c1">// type of s inferred as String</code></pre>

<p>This can be a useful syntax, but when learning the Java language it is probably better to avoid it at first while you become familiar with the Java type system.</p>

<p>A single variable declaration statement can declare and initialize more
than one variable, but all variables must be of the same explicitly declared type.
Variable names and optional initializers are separated from each other with commas:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">int</code> <code class="n">i</code><code class="o">,</code> <code class="n">j</code><code class="o">,</code> <code class="n">k</code><code class="o">;</code>
<code class="kt">float</code> <code class="n">x</code> <code class="o">=</code> <code class="mf">1.0f</code><code class="o">,</code> <code class="n">y</code> <code class="o">=</code> <code class="mf">1.0f</code><code class="o">;</code>
<code class="n">String</code> <code class="n">question</code> <code class="o">=</code> <code class="s">Really Quit?</code><code class="o">,</code> <code class="n">response</code><code class="o">;</code></pre>

<p><a data-primary="final modifier" data-secondary="in variable declaration statements" data-type="indexterm" id="3_idm45941144117672"></a>Variable declaration statements can begin with the <code>final</code> keyword.
This modifier specifies that once an initial value is defined for the
variable, that value is never allowed to change:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">final</code> <code class="n">String</code> <code class="n">greeting</code> <code class="o">=</code> <code class="n">getLocalLanguageGreeting</code><code class="o">();</code></pre>

<p>We will have more to say about the <code>final</code> keyword later on, especially
when talking about the immutable style of programming.</p>

<p>Java variable declaration statements can
appear anywhere in Java code; they are not restricted to the beginning
of a method or block of code. Local variable declarations can also be
integrated with the <em>initialize</em> portion of a <code>for</code> loop, as we鈥檒l
discuss shortly.</p>

<p><a data-primary="scope, of local variables" data-type="indexterm" id="3_idm45941150193496"></a>Local variables can be used only within the method or block of code in
which they are defined. This is called their <em>scope</em> or <em>lexical
scope</em>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">void</code> <code class="nf">method</code><code class="o">()</code> <code class="o">{</code>            <code class="c1">// A method definition</code>
   <code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code>              <code class="c1">// Declare variable i</code>
   <code class="k">while</code> <code class="o">(</code><code class="n">i</code> <code class="o">&lt;</code> <code class="mi">10</code><code class="o">)</code> <code class="o">{</code>        <code class="c1">// i is in scope here</code>
     <code class="kt">int</code> <code class="n">j</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code>            <code class="c1">// Declare j; the scope of j begins here</code>
     <code class="n">i</code><code class="o">++;</code>                  <code class="c1">// i is in scope here; increment it</code>
   <code class="o">}</code>                       <code class="c1">// j is no longer in scope;</code>
   <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">i</code><code class="o">);</code>  <code class="c1">// i is still in scope here</code>
<code class="o">}</code>                          <code class="c1">// The scope of i ends here</code></pre>
</div></section>













<section data-pdf-bookmark="The if/else Statement" data-type="sect2"><div class="sect2" id="idm45941144263128">
<h2>The if/else Statement</h2>

<p><a data-primary="if/else statements" data-type="indexterm" id="3_ix_ch02-asciidoc21"></a><a data-primary="statements" data-secondary="if/else" data-type="indexterm" id="3_ix_ch02-asciidoc22"></a>The <code>if</code> statement is a fundamental control statement that allows Java
to make decisions or, more precisely, to execute statements
conditionally. <a data-primary="expressions" data-secondary="in if statements" data-type="indexterm" id="3_idm45941150097608"></a><a data-primary="if statements" data-type="indexterm" id="3_idm45941150096632"></a>The <code>if</code> statement has an associated expression and
statement. If the expression evaluates to <code>true</code>, the interpreter
executes the statement. If the expression evaluates to <code>false</code>, the
interpreter skips the statement.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><a data-primary="boolean type" data-secondary="Boolean class" data-type="indexterm" id="3_idm45941150093832"></a>Java allows the expression to be of the wrapper type <code>Boolean</code> instead
of the primitive type <code>boolean</code>. In this case, the wrapper object is
automatically unboxed.</p>
</div>

<p>Here is an example <code>if</code> statement:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">if</code> <code class="o">(</code><code class="n">username</code> <code class="o">==</code> <code class="kc">null</code><code class="o">)</code>         <code class="c1">// If username is null,</code>
   <code class="n">username</code> <code class="o">=</code> <code class="s">John Doe</code><code class="o">;</code>     <code class="c1">// use a default value</code></pre>

<p><a data-primary="( ) (parentheses)" data-secondary="enclosing expressions in if statements" data-type="indexterm" id="3_idm45941150024888"></a>Although they look extraneous, the parentheses around the expression are
a required part of the syntax for the <code>if</code> statement. As we already
saw, a block of statements enclosed in curly braces is itself a
statement, so we can write <code>if</code> statements that look like this as well:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">if</code> <code class="o">((</code><code class="n">address</code> <code class="o">==</code> <code class="kc">null</code><code class="o">)</code> <code class="o">||</code> <code class="o">(</code><code class="n">address</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="s"></code><code class="o">)))</code> <code class="o">{</code>
   <code class="n">address</code> <code class="o">=</code> <code class="s">[undefined]</code><code class="o">;</code>
   <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">WARNING: no address specified.</code><code class="o">);</code>
<code class="o">}</code></pre>

<p><a data-primary="else clause" data-type="indexterm" id="3_idm45941150083176"></a><a data-primary="if/else statements" data-secondary="else clause" data-type="indexterm" id="3_idm45941150003256"></a>An <code>if</code> statement can include an optional <code>else</code> keyword that is
followed by a second statement. In this form of the statement, the
expression is evaluated, and, if it is <code>true</code>, the first statement is
executed. Otherwise, the second statement is executed. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">if</code> <code class="o">(</code><code class="n">username</code> <code class="o">!=</code> <code class="kc">null</code><code class="o">)</code>
   <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Hello </code> <code class="o">+</code> <code class="n">username</code><code class="o">);</code>
<code class="k">else</code> <code class="o">{</code>
   <code class="n">username</code> <code class="o">=</code> <code class="n">askQuestion</code><code class="o">(</code><code class="s">What is your name?</code><code class="o">);</code>
   <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Hello </code> <code class="o">+</code> <code class="n">username</code> <code class="o">+</code> <code class="s">. Welcome!</code><code class="o">);</code>
<code class="o">}</code></pre>

<p><a data-primary="if/else statements" data-secondary="nested" data-type="indexterm" id="3_idm45941149889128"></a>When you use nested <code>if/else</code> statements, some caution is required to
ensure that the <code>else</code> clause goes with the appropriate <code>if</code> statement.
Consider the following lines:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">if</code> <code class="o">(</code><code class="n">i</code> <code class="o">==</code> <code class="n">j</code><code class="o">)</code>
   <code class="k">if</code> <code class="o">(</code><code class="n">j</code> <code class="o">==</code> <code class="n">k</code><code class="o">)</code>
     <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">i equals k</code><code class="o">);</code>
<code class="k">else</code>
   <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">i doesn&apos;t equal j</code><code class="o">);</code>    <code class="c1">// WRONG!!</code></pre>

<p>In this example, the inner <code>if</code> statement forms the single statement
allowed by the syntax of the outer <code>if</code> statement. Unfortunately, it is
not clear (except from the hint given by the indentation) which <code>if</code> the
<code>else</code> goes with. And in this example, the indentation hint is wrong.
The rule is that an <code>else</code> clause like this is associated with the
nearest <code>if</code> statement. Properly indented, this code looks like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">if</code> <code class="o">(</code><code class="n">i</code> <code class="o">==</code> <code class="n">j</code><code class="o">)</code>
   <code class="k">if</code> <code class="o">(</code><code class="n">j</code> <code class="o">==</code> <code class="n">k</code><code class="o">)</code>
     <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">i equals k</code><code class="o">);</code>
   <code class="k">else</code>
     <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">i doesn&apos;t equal j</code><code class="o">);</code>    <code class="c1">// WRONG!!</code></pre>

<p>This is legal code, but it is clearly not what the programmer had in
mind. <a data-primary="{ } (curly braces)" data-secondary="in nested if/else statements" data-type="indexterm" id="3_idm45941149912808"></a>When working with nested <code>if</code> statements, you should use curly
braces to make your code easier to read. Here is a better way to write
the code:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">if</code> <code class="o">(</code><code class="n">i</code> <code class="o">==</code> <code class="n">j</code><code class="o">)</code> <code class="o">{</code>
   <code class="k">if</code> <code class="o">(</code><code class="n">j</code> <code class="o">==</code> <code class="n">k</code><code class="o">)</code>
     <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">i equals k</code><code class="o">);</code>
<code class="o">}</code>
<code class="k">else</code> <code class="o">{</code>
   <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">i doesn&apos;t equal j</code><code class="o">);</code>
<code class="o">}</code></pre>










<section data-pdf-bookmark="The else if clause" data-type="sect3"><div class="sect3" id="idm45941149808936">
<h3>The else if clause</h3>

<p><a data-primary="else if clause" data-type="indexterm" id="3_idm45941149785528"></a><a data-primary="if/else statements" data-secondary="else if clause" data-type="indexterm" id="3_idm45941149784600"></a>The <code>if/else</code> statement is useful for testing a condition and choosing
between two statements or blocks of code to execute. But what about when
you need to choose between several blocks of code? This is typically
done with an <code>else</code> <code>if</code> clause, which is not really new syntax, but a
common idiomatic usage of the standard <code>if/else</code> statement. It looks
like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">if</code> <code class="o">(</code><code class="n">n</code> <code class="o">==</code> <code class="mi">1</code><code class="o">)</code> <code class="o">{</code>
    <code class="c1">// Execute code block #1</code>
<code class="o">}</code>
<code class="k">else</code> <code class="nf">if</code> <code class="o">(</code><code class="n">n</code> <code class="o">==</code> <code class="mi">2</code><code class="o">)</code> <code class="o">{</code>
    <code class="c1">// Execute code block #2</code>
<code class="o">}</code>
<code class="k">else</code> <code class="nf">if</code> <code class="o">(</code><code class="n">n</code> <code class="o">==</code> <code class="mi">3</code><code class="o">)</code> <code class="o">{</code>
    <code class="c1">// Execute code block #3</code>
<code class="o">}</code>
<code class="k">else</code> <code class="o">{</code>
    <code class="c1">// If all else fails, execute block #4</code>
<code class="o">}</code></pre>

<p>There is nothing special about this code. It is just a series of <code>if</code>
statements, where each <code>if</code> is part of the <code>else</code> clause of the previous
statement. Using the <code>else</code> <code>if</code> idiom is preferable to, and more
legible than, writing these statements out in their fully nested form:<a data-startref="ix_ch02-asciidoc22" data-type="indexterm" id="3_idm45941149674360"></a><a data-startref="ix_ch02-asciidoc21" data-type="indexterm" id="3_idm45941149673656"></a></p>

<pre data-code-language="java" data-type="programlisting"><code class="k">if</code> <code class="o">(</code><code class="n">n</code> <code class="o">==</code> <code class="mi">1</code><code class="o">)</code> <code class="o">{</code>
   <code class="c1">// Execute code block #1</code>
<code class="o">}</code>
<code class="k">else</code> <code class="o">{</code>
   <code class="k">if</code> <code class="o">(</code><code class="n">n</code> <code class="o">==</code> <code class="mi">2</code><code class="o">)</code> <code class="o">{</code>
     <code class="c1">// Execute code block #2</code>
   <code class="o">}</code>
   <code class="k">else</code> <code class="o">{</code>
     <code class="k">if</code> <code class="o">(</code><code class="n">n</code> <code class="o">==</code> <code class="mi">3</code><code class="o">)</code> <code class="o">{</code>
       <code class="c1">// Execute code block #3</code>
     <code class="o">}</code>
     <code class="k">else</code> <code class="o">{</code>
       <code class="c1">// If all else fails, execute block #4</code>
     <code class="o">}</code>
   <code class="o">}</code>
<code class="o">}</code></pre>
</div></section>



</div></section>













<section data-pdf-bookmark="The switch Statement" data-type="sect2"><div class="sect2" id="idm45941150101160">
<h2>The switch Statement</h2>

<p><a data-primary="statements" data-secondary="switch" data-type="indexterm" id="3_ix_ch02-asciidoc23"></a><a data-primary="switch statements" data-type="indexterm" id="3_ix_ch02-asciidoc24"></a>An <code>if</code> statement causes a branch in the flow of a program鈥檚 execution.
You can use multiple <code>if</code> statements, as shown in the previous section,
to perform a multiway branch. This is not always the best solution,
however, especially when all of the branches depend on the value of a
single variable.</p>

<p>In this case, the repeated <code>if</code> statements may seriously hamper readability, especially if the code has been refactored over time or features multiple levels of nested <code>if</code>.</p>

<p><a data-primary="C/C++" data-secondary="switch statement" data-type="indexterm" id="3_idm45941149603992"></a>A better solution is to use a <code>switch</code> statement, which is inherited
from the C programming language. Note, however, that the syntax of this statement is not nearly as elegant as other parts of Java,
and the failure to revisit the design of the feature is widely regarded as a mistake.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><a data-primary="expressions" data-secondary="in switch statements" data-type="indexterm" id="3_idm45941149601320"></a>A <code>switch</code> statement starts with an expression whose type is an <code>int</code>,
<code>short</code>, <code>char</code>, <code>byte</code> (or their wrapper type), <code>String</code>, or an enum
(see <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4">Chapter 4</a> for more on enumerated types).</p>
</div>

<p><a data-primary="{ } (curly braces)" data-secondary="in switch statements" data-type="indexterm" id="3_idm45941149596248"></a>This expression is followed by a block of code in curly braces that
contains various entry points that correspond to possible values for the
expression. For example, the following <code>switch</code> statement is equivalent
to the repeated <code>if</code> and <code>else/if</code> statements shown in the previous
section:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">switch</code><code class="o">(</code><code class="n">n</code><code class="o">)</code> <code class="o">{</code>
   <code class="k">case</code> <code class="mi">1</code><code class="o">:</code>                         <code class="c1">// Start here if n == 1</code>
     <code class="c1">// Execute code block #1</code>
     <code class="k">break</code><code class="o">;</code>                        <code class="c1">// Stop here</code>
   <code class="k">case</code> <code class="mi">2</code><code class="o">:</code>                         <code class="c1">// Start here if n == 2</code>
     <code class="c1">// Execute code block #2</code>
     <code class="k">break</code><code class="o">;</code>                        <code class="c1">// Stop here</code>
   <code class="k">case</code> <code class="mi">3</code><code class="o">:</code>                         <code class="c1">// Start here if n == 3</code>
     <code class="c1">// Execute code block #3</code>
     <code class="k">break</code><code class="o">;</code>                        <code class="c1">// Stop here</code>
   <code class="k">default</code><code class="o">:</code>                        <code class="c1">// If all else fails...</code>
     <code class="c1">// Execute code block #4</code>
     <code class="k">break</code><code class="o">;</code>                        <code class="c1">// Stop here</code>
<code class="o">}</code></pre>

<p><a data-primary="case labels (switch statements)" data-type="indexterm" id="3_idm45941149526952"></a>As you can see from the example, the various entry points into a
<code>switch</code> statement are labeled either with the keyword <code>case</code>,
followed by an integer value and a colon, or with the special <code>default</code>
keyword, followed by a colon. When a <code>switch</code> statement executes, the
interpreter computes the value of the expression in parentheses and then
looks for a <code>case</code> label that matches that value. If it finds one, the
interpreter starts executing the block of code at the first statement
following the <code>case</code> label. <a data-primary="default: label" data-type="indexterm" id="3_idm45941149497272"></a><a data-primary="switch statements" data-secondary="default: label" data-type="indexterm" id="3_idm45941149496536"></a>If it does not find a <code>case</code> label with a
matching value, the interpreter starts execution at the first statement
following a special-case <code>default</code>: label. Or, if there is no
<code>default</code>: label, the interpreter skips the body of the <code>switch</code>
statement altogether.</p>

<p><a data-primary="break statements" data-secondary="specifying end of case clauses in switch statements" data-type="indexterm" id="3_idm45941149493560"></a><a data-primary="break statements" data-secondary="stopping switch statements" data-type="indexterm" id="3_idm45941149492264"></a>Note the use of the <code>break</code> keyword at the end of each <code>case</code> in the
previous code. The <code>break</code> statement is described later in this chapter,
but, in this example, it causes the interpreter to exit the body of the
<code>switch</code> statement. The <code>case</code> clauses in a <code>switch</code> statement specify
only the starting point of the desired code. The individual <code>cases</code> are
not independent blocks of code, and they do not have any implicit ending
point.</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>You must explicitly specify the end of each <code>case</code> with a <code>break</code> or related statement. In the absence of <code>break</code> statements, a <code>switch</code> statement begins executing code at the first statement after the matching <code>case</code> label and continues executing statements until it reaches the end of the block. <a data-primary="fall-through" data-type="indexterm" id="3_idm45941149484728"></a>The control flow will <em>fall through</em> into the next <code>case</code> label and continue executing, rather than exit the block.</p>
</div>

<p>On rare occasions, it is useful to write
code like this that falls through from one <code>case</code> label to the next, but
99% of the time you should be careful to end every <code>case</code> and <code>default</code>
section with a statement that causes the <code>switch</code> statement to stop
executing. <a data-primary="return statements" data-type="indexterm" id="3_idm45941149480632"></a><a data-primary="throw statements" data-secondary="stopping switch statements" data-type="indexterm" id="3_idm45941149479928"></a>Normally you use a <code>break</code> statement, but <code>return</code> and
<code>throw</code> also work.</p>

<p><a data-primary="default fall-through" data-type="indexterm" id="3_idm45941149477336"></a>As a consequence of this default fall-through, a <code>switch</code> statement can have more than one <code>case</code> clause labeling the same statement. Consider the <code>switch</code> statement in the following method:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">boolean</code> <code class="nf">parseYesOrNoResponse</code><code class="o">(</code><code class="kt">char</code> <code class="n">response</code><code class="o">)</code> <code class="o">{</code>
   <code class="k">switch</code><code class="o">(</code><code class="n">response</code><code class="o">)</code> <code class="o">{</code>
     <code class="k">case</code> <code class="sc">y</code><code class="o">:</code>
     <code class="k">case</code> <code class="sc">Y</code><code class="o">:</code> <code class="k">return</code> <code class="kc">true</code><code class="o">;</code>
     <code class="k">case</code> <code class="sc">n</code><code class="o">:</code>
     <code class="k">case</code> <code class="sc">N</code><code class="o">:</code> <code class="k">return</code> <code class="kc">false</code><code class="o">;</code>
     <code class="k">default</code><code class="o">:</code>
       <code class="k">throw</code> <code class="k">new</code> <code class="nf">IllegalArgumentException</code><code class="o">(</code><code class="s">Response must be Y or N</code><code class="o">);</code>
   <code class="o">}</code>
<code class="o">}</code></pre>

<p><a data-primary="switch statements" data-secondary="restrictions on" data-type="indexterm" id="3_idm45941149427128"></a>The <code>switch</code> statement and its <code>case</code> labels have some important
restrictions. First, the expression associated with a <code>switch</code>
statement must have an appropriate type鈥攅ither <code>byte</code>, <code>char</code>, <code>short</code>,
<code>int</code> (or their wrappers), or an enum type or a <code>String</code>. <a data-primary="long type" data-type="indexterm" id="3_idm45941149394232"></a>The
floating-point and <code>boolean</code> types are not supported, and neither is
<code>long</code>, even though <code>long</code> is an integer type. Second, the value
associated with each <code>case</code> label must be a constant value or a constant
expression the compiler can evaluate. A <code>case</code> label cannot contain a
runtime expression involving variables or method calls, for example.
<a data-primary="data types" data-secondary="expressions in switch statements" data-type="indexterm" id="3_idm45941149391080"></a><a data-primary="switch statements" data-secondary="case labels" data-type="indexterm" id="3_idm45941149390136"></a><a data-primary="switch statements" data-secondary="data type of expression in" data-type="indexterm" id="3_idm45941149389192"></a>Third, the <code>case</code> label values must be within the range of the data type
used for the <code>switch</code> expression. And finally, it is not legal to have
two or more <code>case</code> labels with the same value or more than one <code>default</code>
label.<a data-startref="ix_ch02-asciidoc24" data-type="indexterm" id="3_idm45941149386424"></a><a data-startref="ix_ch02-asciidoc23" data-type="indexterm" id="3_idm45941149385688"></a></p>
</div></section>













<section data-pdf-bookmark="The while Statement" data-type="sect2"><div class="sect2" id="idm45941149609640">
<h2>The while Statement</h2>

<p><a data-primary="looping" data-secondary="while statements" data-type="indexterm" id="3_idm45941149384248"></a><a data-primary="statements" data-secondary="do/while" data-type="indexterm" id="3_idm45941149383272"></a><a data-primary="statements" data-secondary="while" data-type="indexterm" id="3_idm45941149382328"></a><a data-primary="while statements" data-type="indexterm" id="3_idm45941149381384"></a>The <code>while</code> statement is a basic statement that allows Java to perform
repetitive actions鈥攐r, to put it another way, it is one of Java鈥檚
primary <em>looping constructs</em>. It has the following syntax:</p>
<pre data-code-language="java" data-type="programlisting"><code class="k">while</code><code> </code><code class="o">(</code><em><code class="n">expression</code></em><code class="o">)</code><code>
</code><code>  </code><em><code class="n">statement</code></em><code>
</code><code>  </code></pre>

<p><a data-primary="+ (plus sign)" data-secondary="++ (increment) operator" data-type="indexterm" id="3_idm45941144254232"></a><a data-primary="expressions" data-secondary="in while statements" data-type="indexterm" id="3_idm45941149367480"></a><a data-primary="while statements" data-secondary="data type of expression in" data-type="indexterm" id="3_idm45941149366536"></a>The <code>while</code> statement works by first evaluating the <em><code>expression</code></em>,
which must result in a <code>boolean</code> or <code>Boolean</code> value. If the value is
<code>false</code>, the interpreter skips the <em><code>statement</code></em> associated with the
loop and moves to the next statement in the program. If it is <code>true</code>,
however, the <em><code>statement</code></em> that forms the body of the loop is executed,
and the <em><code>expression</code></em> is reevaluated. Again, if the value of
<em><code>expression</code></em> is <code>false</code>, the interpreter moves on to the next
statement in the program; otherwise, it executes the <em><code>statement</code></em>
again. This cycle continues while the <em><code>expression</code></em> remains <code>true</code>
(i.e., until it evaluates to <code>false</code>), at which point the <code>while</code>
statement ends, and the interpreter moves on to the next statement. <a data-primary="infinite loops" data-secondary="creating with syntax while(true)" data-type="indexterm" id="3_idm45941149325240"></a>You
can create an infinite loop with the syntax <code>while(true)</code>.</p>

<p>Here is an example <code>while</code> loop that prints the numbers 0 to 9:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">int</code> <code class="n">count</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code>
<code class="k">while</code> <code class="o">(</code><code class="n">count</code> <code class="o">&lt;</code> <code class="mi">10</code><code class="o">)</code> <code class="o">{</code>
   <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">count</code><code class="o">);</code>
   <code class="n">count</code><code class="o">++;</code>
<code class="o">}</code></pre>

<p>As you can see, the variable <code>count</code> starts off at 0 in this example and
is incremented each time the body of the loop runs. Once the loop has
executed 10 times, the expression becomes <code>false</code> (i.e., <code>count</code> is no
longer less than 10), the <code>while</code> statement finishes, and the Java
interpreter can move to the next statement in the program. <a data-primary="counters for loops, incrementing" data-type="indexterm" id="3_idm45941149295864"></a>Most loops
have a counter variable like <code>count</code>. The variable names <code>i</code>, <code>j</code>, and
<code>k</code> are commonly used as loop counters, although you should use more
descriptive names if it makes your code easier to understand.</p>
</div></section>













<section data-pdf-bookmark="The do Statement" data-type="sect2"><div class="sect2" id="idm45941149293128">
<h2>The do Statement</h2>

<p><a data-primary="do statements" data-type="indexterm" id="3_idm45941149291688"></a><a data-primary="statements" data-secondary="do" data-type="indexterm" id="3_idm45941149290984"></a><a data-primary="while statements" data-secondary="do statements vs." data-type="indexterm" id="3_idm45941149290040"></a>A <code>do</code> loop is much like a <code>while</code> loop, except that the loop
expression is tested at the bottom of the loop rather than at the top.
This means that the body of the loop is always executed at least once.
The syntax is:</p>
<pre data-code-language="java" data-type="programlisting"><code class="k">do</code><code>
</code><code>   </code><em><code class="n">statement</code></em><code>
</code><code class="nf">while</code><code> </code><code class="o">(</code><em><code class="n">expression</code></em><code class="o">)</code><code class="o">;</code><code>
</code></pre>

<p>Notice a couple of differences between the <code>do</code> loop and the more
ordinary <code>while</code> loop. First, the <code>do</code> loop requires both the <code>do</code>
keyword to mark the beginning of the loop and the <code>while</code> keyword to
mark the end and introduce the loop condition. <a data-primary="; (semicolon)" data-secondary="terminating do loops" data-type="indexterm" id="3_idm45941149244056"></a>Also, unlike the <code>while</code>
loop, the <code>do</code> loop is terminated with a semicolon. This is because the
<code>do</code> loop ends with the loop condition rather than simply ending with a
curly brace that marks the end of the loop body. The following <code>do</code> loop
prints the same output as the <code>while</code> loop just discussed:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">int</code> <code class="n">count</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code>
<code class="k">do</code> <code class="o">{</code>
   <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">count</code><code class="o">);</code>
   <code class="n">count</code><code class="o">++;</code>
<code class="o">}</code> <code class="k">while</code><code class="o">(</code><code class="n">count</code> <code class="o">&lt;</code> <code class="mi">10</code><code class="o">);</code></pre>

<p>The <code>do</code> loop is much less commonly used than its <code>while</code> cousin
because, in practice, it is unusual to encounter a situation where you
are sure you always want a loop to execute at least once.</p>
</div></section>













<section data-pdf-bookmark="The for Statement" data-type="sect2"><div class="sect2" id="idm45941149213176">
<h2>The for Statement</h2>

<p><a data-primary="for statements" data-type="indexterm" id="3_idm45941149204552"></a><a data-primary="looping" data-secondary="for statements" data-type="indexterm" id="3_idm45941149203624"></a><a data-primary="statements" data-secondary="for" data-type="indexterm" id="3_idm45941149202680"></a>The <code>for</code> statement provides a looping construct that is often more
convenient than the <code>while</code> and <code>do</code> loops. The <code>for</code> statement takes
advantage of a common looping pattern. Most loops have a counter, or
state variable of some kind, that is initialized before the loop starts,
tested to determine whether to execute the loop body, and then
incremented or updated somehow at the end of the loop body before the
test expression is evaluated again. The <em><code>initialize</code></em>, <em><code>test</code></em>, and <em><code>update</code></em>
steps are the three crucial manipulations of a loop variable, and the
<code>for</code> statement makes these three steps an explicit part of the loop
syntax:</p>
<pre data-code-language="java" data-type="programlisting"><code class="k">for</code><code class="o">(</code><em><code class="n">initialize</code></em><code class="o">;</code><code> </code><em><code class="n">test</code></em><code class="o">;</code><code> </code><em><code class="n">update</code></em><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>    </code><em><code class="n">statement</code></em><code>
</code><code class="o">}</code><code>
</code></pre>

<p>This <code>for</code> loop is basically equivalent to the following <code>while</code> loop:</p>
<pre data-code-language="java" data-type="programlisting"><em><code class="n">initialize</code></em><code class="o">;</code><code>
</code><code class="k">while</code><code> </code><code class="o">(</code><em><code class="n">test</code></em><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>   </code><em><code class="n">statement</code></em><code class="o">;</code><code>
</code><code>   </code><em><code class="n">update</code></em><code class="o">;</code><code>
</code><code class="o">}</code><code>
</code></pre>

<p><a data-primary="expressions" data-secondary="in for loops" data-type="indexterm" id="3_idm45941149139992"></a><a data-primary="for statements" data-secondary="initialize, test, and update expressions in" data-type="indexterm" id="3_idm45941149111320"></a><a data-primary="initialize expressions (for loops)" data-type="indexterm" id="3_idm45941149110408"></a><a data-primary="test expressions (for loops)" data-type="indexterm" id="3_idm45941149109768"></a><a data-primary="update expressions (for loops)" data-type="indexterm" id="3_idm45941149109128"></a>Placing the <em><code>initialize</code></em>, <em><code>test</code></em>, and <em><code>update</code></em> expressions at the top of a <code>for</code> loop makes it especially easy to understand what
the loop is doing, and it prevents mistakes such as forgetting to
initialize or update the loop variable. The interpreter discards the
values of the <em><code>initialize</code></em> and <em><code>update</code></em> expressions, so to be
useful, these expressions must have side effects. <em><code>initialize</code></em> is
typically an assignment expression, while <em><code>update</code></em> is usually an
increment, decrement, or some other assignment.</p>

<p>The following <code>for</code> loop prints the numbers 0 to 9, just as the previous
<code>while</code> and <code>do</code> loops have done:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">int</code> <code class="n">count</code><code class="o">;</code>
<code class="k">for</code><code class="o">(</code><code class="n">count</code> <code class="o">=</code> <code class="mi">0</code> <code class="o">;</code> <code class="n">count</code> <code class="o">&lt;</code> <code class="mi">10</code> <code class="o">;</code> <code class="n">count</code><code class="o">++)</code>
   <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">count</code><code class="o">);</code></pre>

<p>Notice how this syntax places all the important information about the
loop variable on a single line, making it very clear how the loop
executes. Placing the <em><code>update</code></em> expression in the <code>for</code> statement itself
also simplifies the body of the loop to a single statement; we don鈥檛
even need to use curly braces to produce a statement block.</p>

<p>The <code>for</code> loop supports some additional syntax that makes it even more
convenient to use. Because many loops use their loop variables only
within the loop, the <code>for</code> loop allows the <em><code>initialize</code></em> expression to
be a full variable declaration, so that the variable is scoped to the
body of the loop and is not visible outside of it. For <span class="keep-together">example</span>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">for</code><code class="o">(</code><code class="kt">int</code> <code class="n">count</code> <code class="o">=</code> <code class="mi">0</code> <code class="o">;</code> <code class="n">count</code> <code class="o">&lt;</code> <code class="mi">10</code> <code class="o">;</code> <code class="n">count</code><code class="o">++)</code>
   <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">count</code><code class="o">);</code></pre>

<p>Furthermore, the <code>for</code> loop syntax does not restrict you to writing
loops that use only a single variable. Both the <em><code>initialize</code></em> and
<em><code>update</code></em> expressions of a <code>for</code> loop can use a comma to separate
multiple initializations and update expressions. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">for</code><code class="o">(</code><code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">,</code> <code class="n">j</code> <code class="o">=</code> <code class="mi">10</code> <code class="o">;</code> <code class="n">i</code> <code class="o">&lt;</code> <code class="mi">10</code> <code class="o">;</code> <code class="n">i</code><code class="o">++,</code> <code class="n">j</code><code class="o">--)</code>
     <code class="n">sum</code> <code class="o">+=</code> <code class="n">i</code> <code class="o">*</code> <code class="n">j</code><code class="o">;</code></pre>

<p>Even though all the examples so far have counted numbers, <code>for</code> loops
are not restricted to loops that count numbers. <a data-primary="linked lists, iterating through, using for loop" data-type="indexterm" id="3_idm45941149006408"></a>For example, you might
use a <code>for</code> loop to iterate through the elements of a linked list:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">for</code><code class="o">(</code><code class="n">Node</code> <code class="n">n</code> <code class="o">=</code> <code class="n">listHead</code><code class="o">;</code> <code class="n">n</code> <code class="o">!=</code> <code class="kc">null</code><code class="o">;</code> <code class="n">n</code> <code class="o">=</code> <code class="n">n</code><code class="o">.</code><code class="na">nextNode</code><code class="o">())</code>
   <code class="n">process</code><code class="o">(</code><code class="n">n</code><code class="o">);</code></pre>

<p>The <em><code>initialize</code></em>, <em><code>test</code></em>, and <em><code>update</code></em> expressions of a <code>for</code> loop
are all optional; <a data-primary="; (semicolon)" data-secondary="in for loops" data-type="indexterm" id="3_idm45941148901016"></a>only the semicolons that separate the expressions are
required. If the <em><code>test</code></em> expression is omitted, it is assumed to be
<code>true</code>. <a data-primary="infinite loops" data-secondary="writing with for(;;)" data-type="indexterm" id="3_idm45941148898920"></a>Thus, you can write an infinite loop as <code>for(;;)</code>.</p>
</div></section>













<section data-pdf-bookmark="The foreach Statement" data-type="sect2"><div class="sect2" id="idm45941149212584">
<h2>The foreach Statement</h2>

<p><a data-primary="foreach statements" data-type="indexterm" id="3_idm45941148896024"></a><a data-primary="statements" data-secondary="foreach" data-type="indexterm" id="3_idm45941148895320"></a>Java鈥檚 <code>for</code> loop works well for primitive types, but it is needlessly
clunky for handling collections of objects. Instead, an alternative
syntax known as a <em>foreach</em> loop is used for handling collections of
objects that need to be looped over.</p>

<p>The foreach loop uses the keyword <code>for</code> followed by an opening
parenthesis, a variable declaration (without initializer), a colon, an
expression, a closing parenthesis, and finally the statement (or block)
that forms the body of the loop:</p>
<pre data-code-language="java" data-type="programlisting"><code class="k">for</code><code class="o">(</code><code> </code><em><code class="n">declaration</code></em><code> </code><code class="o">:</code><code> </code><em><code class="n">expression</code></em><code> </code><code class="o">)</code><code>
</code><code>     </code><em><code class="n">statement</code></em><code>
</code></pre>

<p>Despite its name, the foreach loop does not have a keyword
<code>foreach</code>鈥攊nstead, it is common to read the colon as 鈥渋n鈥濃€攁s in 鈥渇oreach
name in studentNames.鈥?/p&gt;

<p>For the <code>while</code>, <code>do</code>, and <code>for</code> loops, we鈥檝e shown an example that
prints 10 numbers. The foreach loop can do this too, but it needs a collection to iterate over. <a data-primary="arrays" data-secondary="iterating" data-type="indexterm" id="3_idm45941148851576"></a><a data-primary="collections" data-secondary="iterating over with foreach loops" data-type="indexterm" id="3_idm45941148850600"></a>In order to loop 10 times (to print out 10
numbers), we need an array or other collection with 10 elements. Here鈥檚
code we can use:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// These are the numbers we want to print</code>
<code class="kt">int</code><code class="o">[]</code> <code class="n">primes</code> <code class="o">=</code> <code class="k">new</code> <code class="kt">int</code><code class="o">[]</code> <code class="o">{</code> <code class="mi">2</code><code class="o">,</code> <code class="mi">3</code><code class="o">,</code> <code class="mi">5</code><code class="o">,</code> <code class="mi">7</code><code class="o">,</code> <code class="mi">11</code><code class="o">,</code> <code class="mi">13</code><code class="o">,</code> <code class="mi">17</code><code class="o">,</code> <code class="mi">19</code><code class="o">,</code> <code class="mi">23</code><code class="o">,</code> <code class="mi">29</code> <code class="o">};</code>
<code class="c1">// This is the loop that prints them</code>
<code class="k">for</code><code class="o">(</code><code class="kt">int</code> <code class="n">n</code> <code class="o">:</code> <code class="n">primes</code><code class="o">)</code>
     <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">n</code><code class="o">);</code></pre>










<section data-pdf-bookmark="What foreach cannot do" data-type="sect3"><div class="sect3" id="idm45941148746648">
<h3>What foreach cannot do</h3>

<p><a data-primary="foreach statements" data-secondary="limitations of" data-type="indexterm" id="3_idm45941148789768"></a><a data-primary="iteration" data-secondary="foreach and" data-type="indexterm" id="3_idm45941148788568"></a>The foreach is different from the <code>while</code>, <code>for</code>, or <code>do</code> loops, because it
hides the loop counter or <code>Iterator</code> from you. This is a very powerful
idea, as we鈥檒l see when we discuss lambda expressions, but there are
some algorithms that cannot be expressed very naturally with a foreach
loop.</p>

<p><a data-primary="lists" data-secondary="iterating through using foreach loop" data-type="indexterm" id="3_idm45941148785448"></a>For example, suppose you want to print the elements of an array as a
comma-separated list. To do this, you need to print a comma after every
element of the array except the last, or equivalently, before every
element of the array except the first. With a traditional <code>for</code> loop,
the code might look like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">for</code><code class="o">(</code><code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code> <code class="n">i</code> <code class="o">&lt;</code> <code class="n">words</code><code class="o">.</code><code class="na">length</code><code class="o">;</code> <code class="n">i</code><code class="o">++)</code> <code class="o">{</code>
     <code class="k">if</code> <code class="o">(</code><code class="n">i</code> <code class="o">&gt;</code> <code class="mi">0</code><code class="o">)</code> <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">print</code><code class="o">(</code><code class="s">, </code><code class="o">);</code>
     <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">print</code><code class="o">(</code><code class="n">words</code><code class="o">[</code><code class="n">i</code><code class="o">]);</code>
<code class="o">}</code></pre>

<p>This is a very straightforward task, but you simply cannot do it with
foreach without keeping track of additional state. The problem is that the foreach loop doesn鈥檛 give you a loop
counter or any other way to tell if you鈥檙e on the first iteration, the
last iteration, or somewhere in between.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><a data-primary="Iterator object, foreach loop and" data-type="indexterm" id="3_idm45941148704312"></a>A similar issue exists when you鈥檙e using foreach to iterate through the
elements of a collection. Just as a foreach loop over an array has no
way to obtain the array index of the current element, a foreach loop
over a collection has no way to obtain the <code>Iterator</code> object that is
being used to itemize the elements of the collection.</p>
</div>

<p>Here are some other things you cannot do with a foreach-style loop:</p>

<ul>
<li>
<p>Iterate backward through the elements of an array or <code>List</code>.</p>
</li>
<li>
<p>Use a single loop counter to access the same-numbered elements of two
distinct arrays.</p>
</li>
<li>
<p>Iterate through the elements of a <code>List</code> using calls to its <code>get()</code>
method rather than calls to its iterator.</p>
</li>
</ul>
</div></section>



</div></section>













<section data-pdf-bookmark="The break Statement" data-type="sect2"><div class="sect2" id="idm45941148697832">
<h2>The break Statement</h2>

<p><a data-primary="break statements" data-type="indexterm" id="3_idm45941148696392"></a><a data-primary="statements" data-secondary="break" data-type="indexterm" id="3_idm45941148695464"></a>A <code>break</code> statement causes the Java interpreter to skip immediately to
the end of a containing statement. We have already seen the <code>break</code>
statement used with the <code>switch</code> statement. <a data-primary="; (semicolon)" data-secondary="in break statements" data-type="indexterm" id="3_idm45941148693000"></a>The <code>break</code> statement is
most often written as simply the keyword <code>break</code> followed by a
semicolon:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">break</code><code class="o">;</code></pre>

<p><a data-primary="for statements" data-secondary="break statement in" data-type="indexterm" id="3_idm45941148667704"></a><a data-primary="labeled statements" data-type="indexterm" id="3_idm45941148689640"></a><a data-primary="while statements" data-secondary="continue statement in" data-type="indexterm" id="3_idm45941148689000"></a>When used in this form, it causes the Java interpreter to immediately
exit the innermost containing <code>while</code>, <code>do</code>, <code>for</code>, or <code>switch</code>
statement. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">for</code><code class="o">(</code><code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code> <code class="n">i</code> <code class="o">&lt;</code> <code class="n">data</code><code class="o">.</code><code class="na">length</code><code class="o">;</code> <code class="n">i</code><code class="o">++)</code> <code class="o">{</code>
    <code class="k">if</code> <code class="o">(</code><code class="n">data</code><code class="o">[</code><code class="n">i</code><code class="o">]</code> <code class="o">==</code> <code class="n">target</code><code class="o">)</code> <code class="o">{</code>  <code class="c1">// When we find what we&apos;re looking for,</code>
        <code class="n">index</code> <code class="o">=</code> <code class="n">i</code><code class="o">;</code>              <code class="c1">// remember where we found it</code>
        <code class="k">break</code><code class="o">;</code>                  <code class="c1">// and stop looking!</code>
    <code class="o">}</code>
<code class="o">}</code>   <code class="c1">// The Java interpreter goes here after executing break</code></pre>

<p>The <code>break</code> statement can also be followed by the name of a containing
labeled statement. When used in this form, <code>break</code> causes the Java
interpreter to immediately exit the named block, which can be any kind
of statement, not just a loop or <code>switch</code>. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="nl">TESTFORNULL:</code> <code class="k">if</code> <code class="o">(</code><code class="n">data</code> <code class="o">!=</code> <code class="kc">null</code><code class="o">)</code> <code class="o">{</code>
   <code class="k">for</code><code class="o">(</code><code class="kt">int</code> <code class="n">row</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code> <code class="n">row</code> <code class="o">&lt;</code> <code class="n">numrows</code><code class="o">;</code> <code class="n">row</code><code class="o">++)</code> <code class="o">{</code>
     <code class="k">for</code><code class="o">(</code><code class="kt">int</code> <code class="n">col</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code> <code class="n">col</code> <code class="o">&lt;</code> <code class="n">numcols</code><code class="o">;</code> <code class="n">col</code><code class="o">++)</code> <code class="o">{</code>
       <code class="k">if</code> <code class="o">(</code><code class="n">data</code><code class="o">[</code><code class="n">row</code><code class="o">][</code><code class="n">col</code><code class="o">]</code> <code class="o">==</code> <code class="kc">null</code><code class="o">)</code>
         <code class="k">break</code> <code class="n">TESTFORNULL</code><code class="o">;</code>           <code class="c1">// treat the array as undefined.</code>
     <code class="o">}</code>
   <code class="o">}</code>
<code class="o">}</code>  <code class="c1">// Java interpreter goes here after executing break TESTFORNULL</code></pre>
</div></section>













<section data-pdf-bookmark="The continue Statement" data-type="sect2"><div class="sect2" id="idm45941146995848">
<h2>The continue Statement</h2>

<p><a data-primary="continue statements" data-type="indexterm" id="3_idm45941146958792"></a><a data-primary="statements" data-secondary="continue" data-type="indexterm" id="3_idm45941146957864"></a>While a <code>break</code> statement exits a loop, a <code>continue</code> statement quits
the current iteration of a loop and starts the next one. <code>continue</code>, in
both its unlabeled and labeled forms, can be used only within a <code>while</code>,
<code>do</code>, or <code>for</code> loop. When used without a label, <code>continue</code> causes the
innermost loop to start a new iteration. When used with a label that is
the name of a containing loop, it causes the named loop to start a new
iteration. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">for</code><code class="o">(</code><code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code> <code class="n">i</code> <code class="o">&lt;</code> <code class="n">data</code><code class="o">.</code><code class="na">length</code><code class="o">;</code> <code class="n">i</code><code class="o">++)</code> <code class="o">{</code>  <code class="c1">// Loop through data.</code>
   <code class="k">if</code> <code class="o">(</code><code class="n">data</code><code class="o">[</code><code class="n">i</code><code class="o">]</code> <code class="o">==</code> <code class="o">-</code><code class="mi">1</code><code class="o">)</code>                   <code class="c1">// If a data value is missing,</code>
     <code class="k">continue</code><code class="o">;</code>                          <code class="c1">// skip to the next iteration.</code>
   <code class="n">process</code><code class="o">(</code><code class="n">data</code><code class="o">[</code><code class="n">i</code><code class="o">]);</code>                    <code class="c1">// Process the data value.</code>
<code class="o">}</code></pre>

<p><code>while</code>, <code>do</code>, and <code>for</code> loops differ slightly in the way that
<code>continue</code> starts a new <span class="keep-together">iteration</span>:</p>

<ul>
<li>
<p>With a <code>while</code> loop, the Java interpreter simply returns to the top of
the loop, tests the loop condition again, and, if it evaluates to
<code>true</code>, executes the body of the loop again.</p>
</li>
<li>
<p><a data-primary="do statements" data-type="indexterm" id="3_idm45941146863976"></a>With a <code>do</code> loop, the interpreter jumps to the bottom of the loop,
where it tests the loop condition to decide whether to perform another
iteration of the loop.</p>
</li>
<li>
<p><a data-primary="for statements" data-secondary="continue statement in" data-type="indexterm" id="3_idm45941146861832"></a>With a <code>for</code> loop, the interpreter jumps to the top of the loop,
where it first evaluates the <em><code>update</code></em> expression and then evaluates
the <em><code>test</code></em> expression to decide whether to loop again. As you can see
from the examples, the behavior of a <code>for</code> loop with a <code>continue</code>
statement is different from the behavior of the 鈥渂asically equivalent鈥?
<code>while</code> loop presented earlier; <em><code>update</code></em> gets evaluated in the <code>for</code>
loop but not in the equivalent <code>while</code> loop.</p>
</li>
</ul>
</div></section>













<section data-pdf-bookmark="The return Statement" data-type="sect2"><div class="sect2" id="idm45941146855912">
<h2>The return Statement</h2>

<p><a data-primary="return statements" data-type="indexterm" id="3_idm45941146854440"></a><a data-primary="statements" data-secondary="return" data-type="indexterm" id="3_idm45941146853736"></a>A <code>return</code> statement tells the Java interpreter to stop executing the
current method. <a data-primary="expressions" data-secondary="following return statements" data-type="indexterm" id="3_idm45941146852248"></a>If the method is declared to return a value, the
<code>return</code> statement must be followed by an expression. The value of the
expression becomes the return value of the method. For example, the
following method computes and returns the square of a number:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">double</code> <code class="nf">square</code><code class="o">(</code><code class="kt">double</code> <code class="n">x</code><code class="o">)</code> <code class="o">{</code>      <code class="c1">// A method to compute x squared</code>
   <code class="k">return</code> <code class="n">x</code> <code class="o">*</code> <code class="n">x</code><code class="o">;</code>               <code class="c1">// Compute and return a value</code>
<code class="o">}</code></pre>

<p><a data-primary="methods" data-secondary="void" data-type="indexterm" id="3_idm45941146849272"></a><a data-primary="void keyword" data-type="indexterm" id="3_idm45941146841384"></a>Some methods are declared <code>void</code> to indicate that they do not return
any value. The Java interpreter runs methods like this by executing
their statements one by one until it reaches the end of the method.
After executing the last statement, the interpreter returns implicitly.
Sometimes, however, a <code>void</code> method has to return explicitly before
reaching the last statement. In this case, it can use the <code>return</code>
statement by itself, without any expression. For example, the following
method prints, but does not return, the square root of its argument. If
the argument is a negative number, it returns without printing anything:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// A method to print square root of x</code>
<code class="kt">void</code> <code class="nf">printSquareRoot</code><code class="o">(</code><code class="kt">double</code> <code class="n">x</code><code class="o">)</code> <code class="o">{</code>
   <code class="k">if</code> <code class="o">(</code><code class="n">x</code> <code class="o">&lt;</code> <code class="mi">0</code><code class="o">)</code> <code class="k">return</code><code class="o">;</code>                <code class="c1">// If x is negative, return</code>
   <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">Math</code><code class="o">.</code><code class="na">sqrt</code><code class="o">(</code><code class="n">x</code><code class="o">));</code> <code class="c1">// Print the square root of x</code>
<code class="o">}</code>                                    <code class="c1">// Method end: return implicitly</code></pre>
</div></section>













<section data-pdf-bookmark="The synchronized Statement" data-type="sect2"><div class="sect2" id="idm45941146800632">
<h2>The synchronized Statement</h2>

<p><a data-primary="concurrency" data-secondary="synchronize statement" data-type="indexterm" id="3_idm45941146734968"></a><a data-primary="statements" data-secondary="synchronized" data-type="indexterm" id="3_idm45941146734056"></a><a data-primary="synchronized statements" data-type="indexterm" id="3_idm45941146733112"></a>Java has always provided support for multithreaded programming. We
cover this in some detail later on (especially in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch06.html#javanut7-CHP-6-SECT-5">鈥淛ava鈥檚 Support for Concurrency鈥?/a&gt;); however, be aware
that concurrency is difficult to get right, and has a number of
subtleties.</p>

<p>In particular, when working with multiple threads, you must often take
care to prevent multiple threads from modifying an object simultaneously
in a way that might corrupt the object鈥檚 state. <a data-primary="statements section, synchronize statement" data-type="indexterm" id="3_idm45941146730680"></a>Java provides the
<code>synchronized</code> statement to help the programmer prevent corruption. The
syntax is:</p>
<pre data-code-language="java" data-type="programlisting"><code class="kd">synchronized</code><code> </code><code class="o">(</code><code> </code><em><code class="n">expression</code></em><code> </code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>   </code><em><code class="n">statements</code></em><code>
</code><code class="o">}</code><code>
</code></pre>

<p><a data-primary="expressions" data-secondary="in synchronize statements" data-type="indexterm" id="3_idm45941146701064"></a><em><code>expression</code></em> is an expression that must evaluate to an object (including
arrays). <em><code>statements</code></em> constitute the code of the section that could
cause damage and must be enclosed in curly braces.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><a data-primary="concurrency primitives" data-type="indexterm" id="3_idm45941146698344"></a><a data-primary="object state" data-type="indexterm" id="3_idm45941146697640"></a>In Java, the protection of object state (i.e., data) is the primary concern of the concurrency primitives. This is unlike some other languages, where the exclusion of threads from <em>critical sections</em> (i.e., code) is the main focus.</p>
</div>

<p>Before executing the statement block, the Java interpreter first obtains
an exclusive lock on the object or array specified by <em><code>expression</code></em>. It
holds the lock until it is finished running the block, then releases it.
While a thread holds the lock on an object, no other thread can obtain
that lock.</p>

<p><a data-primary="synchronized keyword" data-type="indexterm" id="3_idm45941146694568"></a>As well as the block form, <code>synchronized</code> can also be used as a method modifier in Java.
When applied to a method, the keyword indicates that the entire method is treated as <code>synchronized</code>.</p>

<p><a data-primary="methods" data-secondary="synchronized" data-type="indexterm" id="3_idm45941146715304"></a>For a <code>synchronized</code> instance method, Java obtains an exclusive lock on the class instance. (Class and instance methods are discussed in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3">Chapter 3</a>.)
It can be thought of as a <code>synchronized (this) { ... }</code> block that covers the entire method.</p>

<p><a data-primary="class methods" data-secondary="static synchronized" data-type="indexterm" id="3_idm45941146712184"></a><a data-primary="static synchronized method" data-type="indexterm" id="3_idm45941146711208"></a>A <code>static synchronized</code> method (a class method) causes Java to obtain an exclusive lock on the class (technically the class object corresponding to the type) before executing the method.</p>
</div></section>













<section data-pdf-bookmark="The throw Statement" data-type="sect2"><div class="sect2" id="idm45941146735560">
<h2>The throw Statement</h2>

<p><a data-primary="exception handlers" data-type="indexterm" id="3_idm45941146708280"></a><a data-primary="exceptions" data-secondary="throwing" data-type="indexterm" id="3_idm45941146667976"></a><a data-primary="statements" data-secondary="throw" data-type="indexterm" id="3_idm45941146667032"></a><a data-primary="throw statements" data-type="indexterm" id="3_idm45941146666088"></a>An <em>exception</em> is a signal that indicates some sort of exceptional
condition or error has occurred. To <em>throw</em> an exception is to signal
an exceptional condition. To <em>catch</em> an exception is to handle it鈥攖o
take whatever actions are necessary to recover from it.</p>

<p>In Java, the <code>throw</code> statement is used to throw an exception:</p>
<pre data-code-language="java" data-type="programlisting"><code class="k">throw</code><code> </code><em><code class="n">expression</code></em><code class="o">;</code><code>
</code></pre>

<p><a data-primary="expressions" data-secondary="in throw statements" data-type="indexterm" id="3_idm45941146657368"></a>The <em><code>expression</code></em> must evaluate to an exception object that describes
the exception or error that has occurred. We鈥檒l talk more about types
of exceptions shortly; for now, all you need to know is that an exception:</p>

<ul>
<li>
<p>Is represented by an object</p>
</li>
<li>
<p>Has a type that is a subclass of <code>Exception</code></p>
</li>
<li>
<p>Has a slightly specialized role in Java鈥檚 syntax</p>
</li>
<li>
<p>Can be of two different types: <em>checked</em> or <em>unchecked</em></p>
</li>
</ul>

<p>Here is some example code that throws an exception:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">static</code> <code class="kt">double</code> <code class="nf">factorial</code><code class="o">(</code><code class="kt">int</code> <code class="n">x</code><code class="o">)</code> <code class="o">{</code>
   <code class="k">if</code> <code class="o">(</code><code class="n">x</code> <code class="o">&lt;</code> <code class="mi">0</code><code class="o">)</code>
     <code class="k">throw</code> <code class="k">new</code> <code class="nf">IllegalArgumentException</code><code class="o">(</code><code class="s">x must be &gt;= 0</code><code class="o">);</code>
   <code class="kt">double</code> <code class="n">fact</code><code class="o">;</code>
   <code class="k">for</code><code class="o">(</code><code class="n">fact</code><code class="o">=</code><code class="mf">1.0</code><code class="o">;</code> <code class="n">x</code> <code class="o">&gt;</code> <code class="mi">1</code><code class="o">;</code> <code class="n">fact</code> <code class="o">*=</code> <code class="n">x</code><code class="o">,</code> <code class="n">x</code><code class="o">--)</code>
     <code class="cm">/* empty */</code> <code class="o">;</code>          <code class="c1">// Note use of the empty statement</code>
   <code class="k">return</code> <code class="n">fact</code><code class="o">;</code>
<code class="o">}</code></pre>

<p>When the Java interpreter executes a <code>throw</code> statement, it immediately
stops normal program execution and starts looking for an exception
handler that can catch, or handle, the exception. Exception handlers
are written with the <code>try/catch/finally</code> statement, which is described
in the next section. The Java interpreter first looks at the enclosing
block of code to see if it has an associated exception handler. If so,
it exits that block of code and starts running the exception-handling
code associated with the block. After running the exception handler, the
interpreter continues execution at the statement immediately following
the handler code.</p>

<p>If the enclosing block of code does not have an appropriate exception
handler, the interpreter checks the next higher enclosing block of code
in the method. This continues until a handler is found. If the method
does not contain an exception handler that can handle the exception
thrown by the <code>throw</code> statement, the interpreter stops running the
current method and returns to the caller. Now the interpreter starts
looking for an exception handler in the blocks of code of the calling
method. In this way, exceptions propagate up through the lexical
structure of Java methods, up the call stack of the Java interpreter. <a data-primary="main()" data-type="indexterm" id="3_idm45941146581432"></a>If
the exception is never caught, it propagates all the way up to the
<code>main()</code> method of the program. If it is not handled in that method,
the Java interpreter prints an error message, prints a stack trace to
indicate where the exception occurred, and then exits.</p>
</div></section>













<section data-pdf-bookmark="The try/catch/finally Statement" data-type="sect2"><div class="sect2" id="idm45941146709256">
<h2>The try/catch/finally Statement</h2>

<p><a data-primary="statements" data-secondary="try/catch/finally" data-type="indexterm" id="3_ix_ch02-asciidoc25"></a><a data-primary="try/catch/finally statement" data-type="indexterm" id="3_ix_ch02-asciidoc26"></a>Java has two slightly different exception-handling mechanisms. The
classic form is the <code>try/catch/finally</code> statement. The <code>try</code> clause of
this statement establishes a block of code for exception handling. This
<code>try</code> block is followed by zero or more <code>catch</code> clauses, each of which
is a block of statements designed to handle specific exceptions. Each
<code>catch</code> block can handle more than one different exception鈥攖o indicate
that a <code>catch</code> block should handle multiple exceptions, we use the <code>|</code>
symbol to separate the different exceptions a <code>catch</code> block should handle.
The <code>catch</code> clauses are followed by an optional <code>finally</code> block that
contains cleanup code guaranteed to be executed regardless of what happens in the <code>try</code> block.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45941146578264">
<h5>try Block Syntax</h5>
<p><a data-primary="try block" data-type="indexterm" id="3_idm45941146570040"></a><a data-primary="try/catch/finally statement" data-secondary="try block syntax" data-type="indexterm" id="3_idm45941146569144"></a>Both the <code>catch</code> and <code>finally</code> clauses are optional, but every <code>try</code>
block must either declare some automatically managed resources (the <em>try-with-resources</em> construct) or be accompanied by one or the other (or both).
<a data-primary="{ } (curly braces)" data-secondary="in try/catch/finally statements" data-type="indexterm" id="3_idm45941146566408"></a>The <code>try</code>, <code>catch</code>, and <code>finally</code> blocks all begin and end with curly braces.
These are a required part of the syntax and cannot be omitted, even if
the clause contains only a single statement.</p>
</div></aside>

<p>The following code illustrates the syntax and purpose of the
<code>try/catch/finally</code> statement:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">try</code> <code class="o">{</code>
   <code class="c1">// Normally this code runs from the top of the block to the bottom</code>
   <code class="c1">// without problems. But it can sometimes throw an exception,</code>
   <code class="c1">// either directly with a throw statement or indirectly by calling</code>
   <code class="c1">// a method that throws an exception.</code>
<code class="o">}</code>
<code class="k">catch</code> <code class="o">(</code><code class="n">SomeException</code> <code class="n">e1</code><code class="o">)</code> <code class="o">{</code>
   <code class="c1">// This block contains statements that handle an exception object</code>
   <code class="c1">// of type SomeException or a subclass of that type. Statements in</code>
   <code class="c1">// this block can refer to that exception object by the name e1.</code>
<code class="o">}</code>
<code class="k">catch</code> <code class="o">(</code><code class="n">AnotherException</code> <code class="o">|</code> <code class="n">YetAnotherException</code> <code class="n">e2</code><code class="o">)</code> <code class="o">{</code>
   <code class="c1">// This block contains statements that handle an exception of</code>
   <code class="c1">// type AnotherException or YetAnotherException, or a subclass of</code>
   <code class="c1">// either of those types. Statements in this block refer to the</code>
   <code class="c1">// exception object they receive by the name e2.</code>
<code class="o">}</code>
<code class="k">finally</code> <code class="o">{</code>
   <code class="c1">// This block contains statements that are always executed</code>
   <code class="c1">// after we leave the try clause, regardless of whether we leave it:</code>
   <code class="c1">//   1) normally, after reaching the bottom of the block;</code>
   <code class="c1">//   2) because of a break, continue, or return statement;</code>
   <code class="c1">//   3) with an exception that is handled by a catch clause above;</code>
   <code class="c1">//   4) with an uncaught exception that has not been handled.</code>
   <code class="c1">// If the try clause calls System.exit(), however, the interpreter</code>
   <code class="c1">// exits before the finally clause can be run.</code>
<code class="o">}</code></pre>










<section data-pdf-bookmark="try" data-type="sect3"><div class="sect3" id="idm45941146562088">
<h3>try</h3>

<p><a data-primary="try clause" data-type="indexterm" id="3_idm45941146463144"></a><a data-primary="try/catch/finally statement" data-secondary="try clause" data-type="indexterm" id="3_idm45941146462216"></a>The <code>try</code> clause simply establishes a block of code that either has its
exceptions handled or needs special cleanup code to be run when it
terminates for any reason. The <code>try</code> clause by itself doesn鈥檛 do
anything interesting; it is the <code>catch</code> and <code>finally</code> clauses that do
the exception-handling and cleanup operations.</p>
</div></section>













<section data-pdf-bookmark="catch" data-type="sect3"><div class="sect3" id="idm45941146459176">
<h3>catch</h3>

<p><a data-primary="catch clause" data-type="indexterm" id="3_idm45941146457976"></a><a data-primary="try/catch/finally statement" data-secondary="catch clause" data-type="indexterm" id="3_idm45941146457048"></a>A <code>try</code> block can be followed by zero or more <code>catch</code> clauses that
specify code to handle various types of exceptions. Each <code>catch</code> clause
is declared with a single argument that specifies the types of
exceptions the clause can handle (possibly using the special <code>|</code> syntax
to indicate that the <code>catch</code> block can handle more than one type of
exception) and also provides a name the clause can use to refer to the
exception object it is currently handling. <a data-primary="Throwable class" data-type="indexterm" id="3_idm45941146453608"></a>Any type that a <code>catch</code> block
wishes to handle must be some subclass of <code>Throwable</code>.</p>

<p>When an exception is thrown, the Java interpreter looks for a <code>catch</code>
clause with an argument that matches the same type as the exception
object or a superclass of that type. The interpreter invokes the first
such <code>catch</code> clause it finds. The code within a <code>catch</code> block should
take whatever action is necessary to cope with the exceptional
condition. If the exception is a <code>java.io.FileNotFoundException</code>
exception, for example, you might handle it by asking the user to check
his spelling and try again.</p>

<p>It is not required to have a <code>catch</code> clause for every possible
exception; in some cases, the correct response is to allow the exception
to propagate up and be caught by the invoking method. In other cases,
such as a programming error signaled by <code>NullPointerException</code>, the
correct response is probably not to catch the exception at all, but
allow it to propagate and have the Java interpreter exit with a stack
trace and an error message.</p>
</div></section>













<section data-pdf-bookmark="finally" data-type="sect3"><div class="sect3" id="idm45941146447608">
<h3>finally</h3>

<p><a data-primary="finally clause (try/catch/finally)" data-type="indexterm" id="3_idm45941146446168"></a><a data-primary="try/catch/finally statement" data-secondary="finally clause" data-type="indexterm" id="3_idm45941146445096"></a><a data-primary="try/catch/finally statement" data-secondary="try/finally" data-type="indexterm" id="3_idm45941146444136"></a>The <code>finally</code> clause is generally used to clean up after the code in
the <code>try</code> clause (e.g., close files and shut down network connections).
The <code>finally</code> clause is useful because it is guaranteed to be executed
if any portion of the <code>try</code> block is executed, regardless of how the
code in the <code>try</code> block completes. <a data-primary="System.exit()" data-type="indexterm" id="3_idm45941146440808"></a>In fact, the only way a <code>try</code> clause
can exit without allowing the <code>finally</code> clause to be executed is by
invoking the <code>System.exit()</code> method, which causes the Java interpreter
to stop running.</p>

<p>In the normal case, control reaches the end of the <code>try</code> block and then
proceeds to the <code>finally</code> block, which performs any necessary cleanup.
<a data-primary="break statements" data-type="indexterm" id="3_idm45941146437384"></a><a data-primary="continue statements" data-type="indexterm" id="3_idm45941146436680"></a><a data-primary="return statements" data-type="indexterm" id="3_idm45941146436008"></a>If control leaves the <code>try</code> block because of a <code>return</code>, <code>continue</code>, or
<code>break</code> statement, the <code>finally</code> block is executed before control
transfers to its new destination.</p>

<p>If an exception occurs in the <code>try</code> block and there is an associated
<code>catch</code> block to handle the exception, control transfers first to the
<code>catch</code> block and then to the <code>finally</code> block. If there is no local
<code>catch</code> block to handle the exception, control transfers first to the
<code>finally</code> block, and then propagates up to the nearest containing
<code>catch</code> clause that can handle the exception.</p>

<p><a data-primary="throw statements" data-type="indexterm" id="3_idm45941146429016"></a>If a <code>finally</code> block itself transfers control with a <code>return</code>,
<code>continue</code>, <code>break</code>, or <code>throw</code> statement or by calling a method that
throws an exception, the pending control transfer is abandoned, and this
new transfer is processed. For example, if a <code>finally</code> clause throws an
exception, that exception replaces any exception that was in the process
of being thrown. If a <code>finally</code> clause issues a <code>return</code> statement, the
method returns normally, even if an exception has been thrown and has
not yet been <span class="keep-together">handled</span>.</p>

<p><code>try</code> and <code>finally</code> can be used together without exceptions or any
<code>catch</code> clauses. In this case, the <code>finally</code> block is simply cleanup
code that is guaranteed to be executed, regardless of any <code>break</code>,
<code>continue</code>, or <code>return</code> statements within the <code>try</code> clause.<a data-startref="ix_ch02-asciidoc26" data-type="indexterm" id="3_idm45941146419464"></a><a data-startref="ix_ch02-asciidoc25" data-type="indexterm" id="3_idm45941146418728"></a></p>
</div></section>



</div></section>













<section data-pdf-bookmark="The try-with-resources Statement" data-type="sect2"><div class="sect2" id="javanut7-CHP-2-SECT-5.18">
<h2>The try-with-resources Statement</h2>

<p><a data-primary="statements" data-secondary="try-with-resources" data-type="indexterm" id="3_idm45941146416440"></a><a data-primary="try-with-resources (TWR) statements" data-type="indexterm" id="3_idm45941146415464"></a>The standard form of a <code>try</code> block is very general, but there is a common set of circumstances that require developers to be very careful when writing <code>catch</code> and <code>finally</code> blocks.
These circumstances are when operating with resources that need to be cleaned up or closed when they are no longer needed.</p>

<p>Java provides a very useful mechanism for automatically closing resources that require cleanup.
This is known as <em>try-with-resources</em>, or TWR. We discuss TWR in detail in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch10.html#javanut7-CHP-10-SECT-1">鈥淐lassic Java I/O鈥?/a&gt;, but for completeness, let鈥檚 introduce the syntax now.
The following example shows how to open a file using the <code>FileInputStream</code> class (which results in an object that will require cleanup):</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">try</code> <code class="o">(</code><code class="n">InputStream</code> <code class="n">is</code> <code class="o">=</code> <code class="k">new</code> <code class="n">FileInputStream</code><code class="o">(</code><code class="s">/Users/ben/details.txt</code><code class="o">))</code> <code class="o">{</code>
  <code class="c1">// ... process the file</code>
<code class="o">}</code></pre>

<p>This new form of <code>try</code> takes parameters that are all objects that
require cleanup.<sup><a class="totri-footnote" data-type="noteref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#idm45941146386552" id="idm45941146386552-marker">2</a></sup> These objects are scoped to this <code>try</code> block,
and are then cleaned up automatically no matter how this block is
exited. The developer does not need to write any <code>catch</code> or <code>finally</code>
blocks鈥攖he Java compiler automatically inserts correct cleanup code.</p>

<p>All new code that deals with resources should be written in the TWR
style鈥攊t is considerably less error prone than manually writing <code>catch</code>
blocks, and does not suffer from the problems that plague techniques
such as finalization (see <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch06.html#javanut7-CHP-6-SECT-4">鈥淔inalization鈥?/a&gt; for
details).</p>
</div></section>













<section data-pdf-bookmark="The assert Statement" data-type="sect2"><div class="sect2" id="idm45941146371720">
<h2>The assert Statement</h2>

<p><a data-primary="assert statements" data-type="indexterm" id="3_ix_ch02-asciidoc27"></a><a data-primary="statements" data-secondary="assert" data-type="indexterm" id="3_ix_ch02-asciidoc28"></a>An <code>assert</code> statement is an attempt to provide a capability to verify
design assumptions in Java code. <a data-primary="assertions" data-type="indexterm" id="3_idm45941146367048"></a><a data-primary="expressions" data-secondary="in assert statements" data-type="indexterm" id="3_idm45941146366344"></a>An <em>assertion</em> consists of the
<code>assert</code> keyword followed by a boolean expression that the programmer
believes should always evaluate to <code>true</code>. By default, assertions are
not enabled, and the <code>assert</code> statement does not actually do anything.</p>

<p><a data-primary="debugging, using assertions" data-type="indexterm" id="3_idm45941146363304"></a>It is possible to enable assertions as a debugging tool, however; when
this is done, the <code>assert</code> statement evaluates the expression. If it is
indeed <code>true</code>, <code>assert</code> does nothing. <a data-primary="AssertionError" data-type="indexterm" id="3_idm45941146360920"></a>On the other hand, if the
expression evaluates to <code>false</code>, the assertion fails, and the <code>assert</code>
statement throws a <code>java.lang.AssertionError</code>.</p>
<div data-type="tip"><h6>Tip</h6>
<p>Outside of the core JDK libraries, the <code>assert</code> statement is <em>extremely</em>
rarely used. It turns out to be too inflexible for testing most
applications and is not often used by ordinary developers. <a data-primary="JUnit" data-type="indexterm" id="3_idm45941146356856"></a>Instead, developers use ordinary testing libraries, such as JUnit.</p>
</div>

<p>The <code>assert</code> statement may include an optional second expression,
separated from the first by a colon. When assertions are enabled and the
first expression evaluates to <code>false</code>, the value of the second
expression is taken as an error code or error message and is passed to
the <code>AssertionError()</code> constructor. The full syntax of the statement is:</p>
<pre data-code-language="java" data-type="programlisting"><code class="k">assert</code><code> </code><em><code class="n">assertion</code></em><code class="o">;</code><code>
</code></pre>

<p>or:</p>
<pre data-code-language="java" data-type="programlisting"><code class="k">assert</code><code> </code><em><code class="n">assertion</code></em><code> </code><code class="o">:</code><code> </code><em><code class="n">errorcode</code></em><code class="o">;</code><code>
</code></pre>

<p>To use assertions effectively, you must also be aware of a couple of
fine points. First, remember that your programs will normally run with
assertions disabled and only sometimes with assertions enabled. This
means that you should be careful not to write assertion expressions that
contain side effects.</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>You should never throw <code>AssertionError</code> from your own code, as it may
have unexpected results in future versions of the platform.</p>
</div>

<p>If an <code>AssertionError</code> is thrown, it indicates that one of the
programmer鈥檚 assumptions has not held up. This means that the code is
being used outside of the parameters for which it was designed, and it
cannot be expected to work correctly. In short, there is no plausible
way to recover from an <code>AssertionError</code>, and you should not attempt to
catch it (unless you catch it at the top level simply so that you can
display the error in a more user-friendly fashion).</p>










<section data-pdf-bookmark="Enabling assertions" data-type="sect3"><div class="sect3" id="idm45941146299016">
<h3>Enabling assertions</h3>

<p>For efficiency, it does not make sense to test assertions each time
code is executed鈥?code&gt;assert</code> statements encode assumptions that should
always be true. Thus, by default, assertions are disabled, and <code>assert</code>
statements have no effect. The assertion code remains compiled in the
class files, however, so it can always be enabled for diagnostic or
debugging purposes. You can enable assertions, either across the board
or selectively, with command-line arguments to the Java interpreter.</p>

<p>To enable assertions in all classes except for system classes, use the
<code>-ea</code> argument. To enable assertions in system classes, use <code>-esa</code>. To
enable assertions within a specific class, use <code>-ea</code> followed by a colon
and the class name:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">java</code> <code class="o">-</code><code class="nl">ea:</code><code class="n">com</code><code class="o">.</code><code class="na">example</code><code class="o">.</code><code class="na">sorters</code><code class="o">.</code><code class="na">MergeSort</code> <code class="n">com</code><code class="o">.</code><code class="na">example</code><code class="o">.</code><code class="na">sorters</code><code class="o">.</code><code class="na">Test</code></pre>

<p>To enable assertions for all classes in a package and in all of its
subpackages, follow the <code>-ea</code> argument with a colon, the package name,
and three dots:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">java</code> <code class="o">-</code><code class="nl">ea:</code><code class="n">com</code><code class="o">.</code><code class="na">example</code><code class="o">.</code><code class="na">sorters</code><code class="o">...</code> <code class="n">com</code><code class="o">.</code><code class="na">example</code><code class="o">.</code><code class="na">sorters</code><code class="o">.</code><code class="na">Test</code></pre>

<p>You can disable assertions in the same way, using the <code>-da</code> argument.
For example, to enable assertions throughout a package and then disable
them in a specific class or subpackage, use:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">java</code> <code class="o">-</code><code class="nl">ea:</code><code class="n">com</code><code class="o">.</code><code class="na">example</code><code class="o">.</code><code class="na">sorters</code><code class="o">...</code> <code class="o">-</code><code class="nl">da:</code><code class="n">com</code><code class="o">.</code><code class="na">example</code><code class="o">.</code><code class="na">sorters</code><code class="o">.</code><code class="na">QuickSort</code>
<code class="n">java</code> <code class="o">-</code><code class="nl">ea:</code><code class="n">com</code><code class="o">.</code><code class="na">example</code><code class="o">.</code><code class="na">sorters</code><code class="o">...</code> <code class="o">-</code><code class="nl">da:</code><code class="n">com</code><code class="o">.</code><code class="na">example</code><code class="o">.</code><code class="na">sorters</code><code class="o">.</code><code class="na">plugins</code><code class="o">..</code></pre>

<p>Finally, it is possible to control whether or not assertions are enabled
or disabled at classloading time.<a data-startref="ix_ch02-asciidoc28" data-type="indexterm" id="3_idm45941146173096"></a><a data-startref="ix_ch02-asciidoc27" data-type="indexterm" id="3_idm45941146160328"></a> If you use a custom classloader (see
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch11.html#javanut7-CHP-11">Chapter 11</a> for details on custom classloading) in
your program and want to turn on assertions, you may be interested in
these methods.<a data-startref="ix_ch02-asciidoc20" data-type="indexterm" id="3_idm45941146158648"></a><a data-startref="ix_ch02-asciidoc19" data-type="indexterm" id="3_idm45941146157976"></a></p>
</div></section>



</div></section>





</div></section>













<section data-pdf-bookmark="Methods" data-type="sect1"><div class="sect1" id="idm45941144627928">
<h1>Methods</h1>

<p><a data-primary="methods" data-type="indexterm" id="3_ix_ch02-asciidoc29"></a><a data-primary="syntax, Java" data-secondary="methods" data-type="indexterm" id="3_ix_ch02-asciidoc30"></a>A <em>method</em> is a named sequence of Java statements that can be invoked
by other Java code. When a method is invoked, it is passed zero or more
values known as <em>arguments</em>. The method performs some computations and,
optionally, returns a value. As described earlier in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2-SECT-4">鈥淓xpressions and Operators鈥?/a&gt;, a method invocation is an
expression that is evaluated by the Java interpreter. Because method
invocations can have side effects, however, they can also be used as
expression statements. This section does not discuss method invocation,
but instead describes how to define methods.</p>








<section data-pdf-bookmark="Defining Methods" data-type="sect2"><div class="sect2" id="idm45941146151720">
<h2>Defining Methods</h2>

<p><a data-primary="methods" data-secondary="defining" data-type="indexterm" id="3_ix_ch02-asciidoc31"></a>You<a data-primary="body" data-secondary="of a method" data-type="indexterm" id="3_idm45941146148232"></a><a data-primary="method body" data-type="indexterm" id="3_idm45941146147256"></a> already know how to define the body of a method; it is simply an
arbitrary sequence of statements enclosed within curly braces. <a data-primary="method signature" data-type="indexterm" id="3_ix_ch02-asciidoc32"></a><a data-primary="methods" data-secondary="signature" data-type="indexterm" id="3_ix_ch02-asciidoc33"></a><a data-primary="signature" data-secondary="of method" data-type="indexterm" id="3_ix_ch02-asciidoc34"></a><a data-primary="signature of a method" data-type="indexterm" id="3_ix_ch02-asciidoc35"></a>What is
more interesting about a method is its <em>signature</em>.<sup><a class="totri-footnote" data-type="noteref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#idm45941146141480" id="idm45941146141480-marker">3</a></sup> The signature specifies the following:</p>

<ul>
<li>
<p>The name of the method</p>
</li>
<li>
<p>The number, order, type, and name of the parameters used by the method</p>
</li>
<li>
<p>The type of the value returned by the method</p>
</li>
<li>
<p>The checked exceptions that the method can throw (the signature may
also list unchecked exceptions, but these are not required)</p>
</li>
<li>
<p>Various method modifiers that provide additional information about the
method</p>
</li>
</ul>

<p>A method signature defines everything you need to know about a method
before calling it. It is the method <em>specification</em> and defines the API
for the method. In order to use the Java platform鈥檚 online API
reference, you need to know how to read a method signature. And, in
order to write Java programs, you need to know how to define your own
methods, each of which begins with a method signature.</p>

<p>A method signature looks like this:</p>
<pre data-code-language="java" data-type="programlisting"><em><code class="n">modifiers</code><code> </code><code class="n">type</code><code> </code><code class="nf">name</code></em><code> </code><code class="o">(</code><em><code class="n">paramlist</code></em><code> </code><code class="o">)</code><code> </code><code class="o">[</code><code> </code><code class="kd">throws</code><code> </code><code class="n">exceptions</code><code> </code><code class="o">]</code><code>
</code></pre>

<p>The signature (the method specification) is followed by the method
body (the method implementation), which is simply a sequence of Java
statements enclosed in curly braces. If the method is <em>abstract</em> (see
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3">Chapter 3</a>), the implementation is omitted, and the
method body is replaced with a single semicolon.</p>

<p><a data-primary="generic methods" data-type="indexterm" id="3_idm45941146079352"></a>The signature of a method may also include type variable
declarations鈥攕uch methods are known as <em>generic methods</em>. Generic
methods and type variables are discussed in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4">Chapter 4</a>.</p>

<p>Here are some example method definitions, which begin with the signature
and are followed by the method body:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// This method is passed an array of strings and has no return value.</code>
<code class="c1">// All Java programs have an entry point with this name and signature.</code>
<code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="o">{</code>
     <code class="k">if</code> <code class="o">(</code><code class="n">args</code><code class="o">.</code><code class="na">length</code> <code class="o">&gt;</code> <code class="mi">0</code><code class="o">)</code> <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Hello </code> <code class="o">+</code> <code class="n">args</code><code class="o">[</code><code class="mi">0</code><code class="o">]);</code>
     <code class="k">else</code> <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Hello world</code><code class="o">);</code>
<code class="o">}</code>

<code class="c1">// This method is passed two double arguments and returns a double.</code>
<code class="kd">static</code> <code class="kt">double</code> <code class="nf">distanceFromOrigin</code><code class="o">(</code><code class="kt">double</code> <code class="n">x</code><code class="o">,</code> <code class="kt">double</code> <code class="n">y</code><code class="o">)</code> <code class="o">{</code>
     <code class="k">return</code> <code class="n">Math</code><code class="o">.</code><code class="na">sqrt</code><code class="o">(</code><code class="n">x</code><code class="o">*</code><code class="n">x</code> <code class="o">+</code> <code class="n">y</code><code class="o">*</code><code class="n">y</code><code class="o">);</code>
<code class="o">}</code>

<code class="c1">// This method is abstract which means it has no body.</code>
<code class="c1">// Note that it may throw exceptions when invoked.</code>
<code class="kd">protected</code> <code class="kd">abstract</code> <code class="n">String</code> <code class="nf">readText</code><code class="o">(</code><code class="n">File</code> <code class="n">f</code><code class="o">,</code> <code class="n">String</code> <code class="n">encoding</code><code class="o">)</code>
    <code class="kd">throws</code> <code class="n">FileNotFoundException</code><code class="o">,</code> <code class="n">UnsupportedEncodingException</code><code class="o">;</code></pre>

<p><a data-primary="modifiers" data-secondary="method" data-type="indexterm" id="3_idm45941146074648"></a><em><code>modifiers</code></em> is zero or more special modifier keywords, separated from
each other by spaces. A method might be declared with the <code>public</code> and
<code>static</code> modifiers, for example. The allowed modifiers and their
meanings are described in the next <span class="keep-together">section</span>.</p>

<p><a data-primary="return types" data-secondary="specified by type in method signature" data-type="indexterm" id="3_idm45941145969608"></a>The <em><code>type</code></em> in a method signature specifies the return type of the
method. <a data-primary="void keyword" data-type="indexterm" id="3_idm45941145967736"></a>If the method does not return a value, <em><code>type</code></em> must be <code>void</code>.
<a data-primary="return statements" data-type="indexterm" id="3_idm45941145965976"></a>If a method is declared with a non-<code>void</code> return type, it must include
a <code>return</code> statement that returns a value of (or is convertible to) the
declared type.</p>

<p><a data-primary="constructors" data-type="indexterm" id="3_idm45941145964104"></a>A <em>constructor</em> is a block of code, similar to a method, that is used to
initialize newly created objects. As we鈥檒l see in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3">Chapter 3</a>, constructors are defined in a very
similar way to methods, except that their signatures do not include this
<em><code>type</code></em> specification.</p>

<p><a data-primary="I/O (input/output)" data-secondary="method names" data-type="indexterm" id="3_idm45941145960936"></a><a data-primary="names" data-secondary="of methods" data-type="indexterm" id="3_idm45941145959960"></a>The <em><code>name</code></em> of a method follows the specification of its modifiers and
type. Method names, like variable names, are Java identifiers and,
like all Java identifiers, may contain letters in any language
represented by the Unicode character set. It is legal, and often quite
useful, to define more than one method with the same name, as long as
each version of the method has a different parameter list. <a data-primary="method overloading" data-type="indexterm" id="3_idm45941145957912"></a>Defining
multiple methods with the same name is called <em>method overloading</em>.</p>
<div data-type="tip"><h6>Tip</h6>
<p><a data-primary="lambda expressions" data-type="indexterm" id="3_idm45941145955816"></a>Unlike some other languages, Java does not have anonymous methods.
Instead, Java 8 introduces lambda expressions, which are similar to
anonymous methods, but which the Java runtime automatically converts to
a suitable named method鈥攕ee <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2-SECT-7.5">鈥淟ambda Expressions鈥?/a&gt;
for more details.</p>
</div>

<p><a data-primary="println()" data-type="indexterm" id="3_idm45941145953496"></a><a data-primary="System.out.println()" data-type="indexterm" id="3_idm45941145952792"></a>For example, the <code>System.out.println()</code> method we鈥檝e seen already is
an overloaded method. One method by this name prints a string and other
methods by the same name print the values of the various primitive
types. The Java compiler decides which method to call based on the type
of the argument passed to the method.</p>

<p><a data-primary="( ) (parentheses)" data-secondary="enclosing method parameter list" data-type="indexterm" id="3_idm45941145950984"></a><a data-primary="methods" data-secondary="parameter list" data-type="indexterm" id="3_idm45941145949992"></a>When you are defining a method, the name of the method is always
followed by the method鈥檚 parameter list, which must be enclosed in
parentheses. The parameter list defines zero or more arguments that are
passed to the method. The parameter specifications, if there are any,
each consist of a type and a name and are separated from each other by
commas (if there are multiple parameters). When a method is invoked, the
argument values it is passed must match the number, type, and order of
the parameters specified in this method signature line. The values
passed need not have exactly the same type as specified in the
signature, but they must be convertible to those types without casting.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>When a Java method expects no arguments, its parameter list is simply
<code>()</code>, not <code>(void)</code>. Java does not regard <code>void</code> as a type鈥擟 and C++
programmers in particular should pay heed.</p>
</div>

<p>Java allows the programmer to define and invoke methods that accept a
variable number of arguments, using a syntax known colloquially as
<em>varargs</em>. Varargs are covered in detail later in this chapter.</p>

<p><a data-primary="checked exceptions" data-secondary="in throws clause of method signature" data-type="indexterm" id="3_idm45941145944456"></a><a data-primary="exceptions" data-secondary="checked/unchecked" data-type="indexterm" id="3_idm45941145943464"></a><a data-primary="throws clause (method signature)" data-type="indexterm" id="3_idm45941145942520"></a>The final part of a method signature is the <code>throws</code> clause, which is
used to list the <em>checked exceptions</em> that a method can throw. Checked
exceptions are a category of exception classes that must be listed in
the <code>throws</code> clauses of methods that can throw them.</p>

<p><a data-primary="throw statements" data-secondary="methods using to throw checked exceptions" data-type="indexterm" id="3_idm45941145939944"></a>If a method uses the <code>throw</code> statement to throw a checked exception, the method must declare that it can throw that exception.
The method must also declare that it can throw in the case that it calls some other method that throws a checked exception, and the calling method does not explicitly catch that exception.</p>

<p>If a method can throw one or more checked exceptions, it specifies this by placing the <code>throws</code> keyword after the argument list and following it by the name of the exception class or classes it can throw.
If a method does not throw any exceptions, it does not use the
<code>throws</code> keyword. If a method throws more than one type of exception,
separate the names of the exception classes from each other with commas.
More on this in a bit<a data-startref="ix_ch02-asciidoc35" data-type="indexterm" id="3_idm45941145936184"></a><a data-startref="ix_ch02-asciidoc34" data-type="indexterm" id="3_idm45941145935480"></a><a data-startref="ix_ch02-asciidoc33" data-type="indexterm" id="3_idm45941145934808"></a><a data-startref="ix_ch02-asciidoc32" data-type="indexterm" id="3_idm45941145934136"></a>.<a data-startref="ix_ch02-asciidoc31" data-type="indexterm" id="3_idm45941145933336"></a></p>
</div></section>













<section data-pdf-bookmark="Method Modifiers" data-type="sect2"><div class="sect2" id="javanut7-CHP-2-SECT-6.2">
<h2>Method Modifiers</h2>

<p><a data-primary="methods" data-secondary="modifiers" data-type="indexterm" id="3_idm45941145931432"></a><a data-primary="modifiers" data-secondary="method" data-type="indexterm" id="3_idm45941145930456"></a>The modifiers of a method consist of zero or more modifier keywords
such as <code>public</code>, <code>static</code>, or <code>abstract</code>. Here is a list of allowed
modifiers and their meanings:</p>
<dl>
<dt><code>abstract</code></dt>
<dd>
<p><a data-primary="abstract classes" data-type="indexterm" id="3_idm45941145926376"></a><a data-primary="abstract methods" data-type="indexterm" id="3_idm45941145925448"></a>An <code>abstract</code> method is a specification without an implementation. <a data-primary="; (semicolon)" data-secondary="in abstract methods" data-type="indexterm" id="3_idm45941145924232"></a>The curly braces and Java statements that would normally comprise the body of the method are replaced with a single semicolon. A class that includes an <code>abstract</code> method must itself be declared <code>abstract</code>. Such a class is incomplete and cannot be instantiated (see <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3">Chapter 3</a>).</p>
</dd>
<dt><code>final</code></dt>
<dd>
<p><a data-primary="final modifier" data-secondary="methods" data-type="indexterm" id="3_idm45941145920136"></a>A <code>final</code> method may not be overridden or hidden by a subclass, which makes it amenable to compiler optimizations that are not possible for regular methods. All <code>private</code> methods are implicitly <code>final</code>, as are all methods of any class that is declared <code>final</code>.</p>
</dd>
<dt><code>native</code></dt>
<dd>
<p><a data-primary="methods" data-secondary="native" data-type="indexterm" id="3_idm45941145915848"></a><a data-primary="native methods" data-type="indexterm" id="3_idm45941145914872"></a>The <code>native</code> modifier specifies that the method implementation is written in some 鈥渘ative鈥?language such as C and is provided externally to the Java program. Like <code>abstract</code> methods, <code>native</code> methods have no body: the curly braces are replaced with a semicolon.</p>
</dd>
</dl>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45941145912360">
<h5>Implementing native Methods</h5>
<p><a data-primary="native methods" data-secondary="implementation" data-type="indexterm" id="3_idm45941145911112"></a>When Java was first released, <code>native</code> methods were sometimes used for
efficiency reasons. That is almost never necessary today. <a data-primary="C/C++" data-secondary="using native methods to interface Java code to C/C++ libraries" data-type="indexterm" id="3_idm45941145909320"></a>Instead,
<code>native</code> methods are used to interface Java code to existing libraries
written in C or C++. <code>native</code> methods are implicitly
platform-dependent, and the procedure for linking the implementation
with the Java class that declares the method is dependent on the
implementation of the Java virtual machine. <code>native</code> methods are not
covered in this book.</p>
</div></aside>
<dl>
<dt><code>public</code>, <code>protected</code>, <code>private</code></dt>
<dd>
<p><a data-primary="access modifiers" data-type="indexterm" id="3_idm45941145904024"></a><a data-primary="modifiers" data-secondary="access" data-type="indexterm" id="3_idm45941145903320"></a><a data-primary="private modifier" data-secondary="methods" data-type="indexterm" id="3_idm45941145902376"></a><a data-primary="protected modifier" data-secondary="methods" data-type="indexterm" id="3_idm45941145901432"></a><a data-primary="public modifier" data-secondary="methods" data-type="indexterm" id="3_idm45941145900488"></a>These access modifiers specify whether and where a method can be used outside of the class that defines it. These very important modifiers are explained in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3">Chapter 3</a>.</p>
</dd>
<dt><code>static</code></dt>
<dd>
<p><a data-primary="class methods" data-secondary="static modifier" data-type="indexterm" id="3_idm45941145897128"></a><a data-primary="static methods" data-type="indexterm" id="3_idm45941145896152"></a>A method declared <code>static</code> is a <em>class method</em> associated with the class itself rather than with an instance of the class (we cover this in more detail in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3">Chapter 3</a>).</p>
</dd>
<dt><code>strictfp</code></dt>
<dd>
<p><a data-primary="floating-point types" data-secondary="strictfp modifier for methods" data-type="indexterm" id="3_idm45941145892216"></a><a data-primary="strictfp modifier" data-type="indexterm" id="3_idm45941145891272"></a>The <code>fp</code> in this awkwardly named, rarely used modifier stands for 鈥渇loating point.鈥?Java normally takes advantage of any extended precision available to the runtime platform鈥檚 floating-point hardware. The use of this keyword forces Java to strictly obey the standard while running the <code>strictfp</code> method and only perform floating-point arithmetic using 32- or 64-bit floating-point formats, even if this makes the results less accurate.</p>
</dd>
<dt><code>synchronized</code></dt>
<dd>
<p><a data-primary="synchronized methods" data-type="indexterm" id="3_idm45941145847416"></a><a data-primary="class methods" data-secondary="synchronized modifier" data-type="indexterm" id="3_idm45941145846552"></a>The <code>synchronized</code> modifier makes a method threadsafe. Before a thread can invoke a <code>synchronized</code> method, it must obtain a lock on the method鈥檚 class (for <code>static</code> methods) or on the relevant instance of the class (for non-<code>static</code> methods). This prevents two threads from executing the method at the same time.</p>
</dd>
</dl>

<p>The <code>synchronized</code> modifier is an implementation detail (because methods
can make themselves threadsafe in other ways) and is not formally part
of the method specification or API. Good documentation specifies
explicitly whether a method is threadsafe; you should not rely on the
presence or absence of the <code>synchronized</code> keyword when working with
multithreaded programs.</p>
<div data-type="tip"><h6>Tip</h6>
<p>Annotations are an interesting special case (see
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4">Chapter 4</a> for more on annotations)鈥攖hey can be
thought of as a halfway house between a method modifier and additional
supplementary type information.</p>
</div>
</div></section>













<section data-pdf-bookmark="Checked and Unchecked Exceptions" data-type="sect2"><div class="sect2" id="javanut7-CHP-2-SECT-6.3">
<h2>Checked and Unchecked Exceptions</h2>

<p><a data-primary="checked exceptions" data-type="indexterm" id="3_ix_ch02-asciidoc36"></a><a data-primary="exceptions" data-secondary="checked/unchecked" data-type="indexterm" id="3_ix_ch02-asciidoc37"></a><a data-primary="methods" data-secondary="checked/unchecked exceptions" data-type="indexterm" id="3_ix_ch02-asciidoc38"></a>The Java exception-handling scheme distinguishes between two types of
exceptions, known as <em>checked</em> and <a data-primary="unchecked exceptions" data-type="indexterm" id="3_idm45941145833960"></a><em>unchecked</em> exceptions.</p>

<p>The distinction between checked and unchecked exceptions has to do with
the circumstances under which the exceptions could be thrown. Checked
exceptions arise in specific, well-defined circumstances, and very often
are conditions from which the application may be able to partially or
fully recover.</p>

<p>For example, consider some code that might find its configuration file
in one of several possible directories. If we attempt to open the file
from a directory it isn鈥檛 present in, then a <code>FileNotFoundException</code>
will be thrown. In our example, we want to catch this exception and move
on to try the next possible location for the file. In other words,
although the file not being present is an exceptional condition, it is
one from which we can recover, and it is an understood and anticipated
failure.</p>

<p>On the other hand, in the Java environment there are a set of failures
that cannot easily be predicted or anticipated, due to such things as
runtime conditions or abuse of library code. There is no good way to
predict an <code>OutOfMemoryError</code>, for example, and any method that uses
objects or arrays can throw a <code>NullPointerException</code> if it is passed an
invalid <code>null</code> argument.</p>

<p>These are the unchecked exceptions鈥攁nd practically any method can throw
an unchecked exception at essentially any time. They are the Java
environment鈥檚 version of Murphy鈥檚 law: 鈥淎nything that can go wrong, will
go wrong.鈥?Recovery from an unchecked exception is usually very
difficult, if not impossible鈥攕imply due to their sheer unpredictability.</p>

<p>To figure out whether an exception is checked or unchecked, remember
that <a data-primary="Error class" data-type="indexterm" id="3_idm45941145827512"></a><a data-primary="exceptions" data-secondary="Exception class" data-type="indexterm" id="3_idm45941145826424"></a><a data-primary="Throwable objects" data-type="indexterm" id="3_idm45941145825480"></a>exceptions are <code>Throwable</code> objects and that these fall into
two main categories, specified by the <code>Error</code> and <code>Exception</code>
subclasses. Any exception object that is an <code>Error</code> is unchecked. <a data-primary="RuntimeException" data-type="indexterm" id="3_idm45941145822984"></a>There
is also a subclass of <code>Exception</code> called <code>RuntimeException</code>鈥攁nd any
subclass of <code>RuntimeException</code> is also an unchecked exception. All other
exceptions are checked exceptions.</p>










<section data-pdf-bookmark="Working with checked exceptions" data-type="sect3"><div class="sect3" id="idm45941145827224">
<h3>Working with checked exceptions</h3>

<p><a data-primary="checked exceptions" data-secondary="working with" data-type="indexterm" id="3_idm45941145819592"></a>Java has different rules for working with checked and unchecked
exceptions. If you write a method that throws a checked exception, you
must use a <code>throws</code> clause to declare the exception in the method
signature. The Java compiler checks to make sure you have declared them
in method signatures and produces a compilation error if you have not
(that鈥檚 why they鈥檙e called 鈥渃hecked exceptions鈥?.</p>

<p><a data-primary="throws clause (method signature)" data-type="indexterm" id="3_idm45941145817400"></a>Even if you never throw a checked exception yourself, sometimes you must
use a <code>throws</code> clause to declare a checked exception. If your method
calls a method that can throw a checked exception, you must either
include exception-handling code to handle that exception or use <code>throws</code>
to declare that your method can also throw that exception.</p>

<p><a data-primary="URL class" data-type="indexterm" id="3_idm45941145815256"></a>For example, the following method tries to estimate the size of a web
page鈥攊t uses the standard <code>java.net</code> libraries, and the class <code>URL</code>
(we鈥檒l meet these in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch10.html#javanut7-CHP-10">Chapter 10</a>) to contact the
web page. <a data-primary="IOException objects" data-type="indexterm" id="3_idm45941145812392"></a><a data-primary="java.io.IOException objects" data-type="indexterm" id="3_idm45941145811720"></a>It uses methods and constructors that can throw various types of <code>java.io.IOException</code> objects, so it declares this fact with a
<code>throws</code> clause:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">static</code> <code class="nf">estimateHomepageSize</code><code class="o">(</code><code class="n">String</code> <code class="n">host</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>
    <code class="n">URL</code> <code class="n">url</code> <code class="o">=</code> <code class="k">new</code> <code class="n">URL</code><code class="o">(</code><code class="s">htp://</code><code class="o">+</code> <code class="n">host</code> <code class="o">+</code><code class="s">/</code><code class="o">);</code>
    <code class="k">try</code> <code class="o">(</code><code class="n">InputStream</code> <code class="n">in</code> <code class="o">=</code> <code class="n">url</code><code class="o">.</code><code class="na">openStream</code><code class="o">())</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">in</code><code class="o">.</code><code class="na">available</code><code class="o">();</code>
    <code class="o">}</code>
<code class="o">}</code></pre>

<p>In fact, the preceding code has a bug: we鈥檝e misspelled the protocol
specifier鈥攖here鈥檚 no such protocol as <em>htp://</em>. <a data-primary="MalformedURLException" data-type="indexterm" id="3_idm45941145766840"></a>So, the
<code>estimateHomepageSize()</code> method will always fail with a
<code>MalformedURLException</code>.</p>

<p>How do you know if the method you are calling can throw a checked
exception? You can look at its method signature to find out. Or, failing
that, the Java compiler will tell you (by reporting a compilation error)
if you鈥檝e called a method whose exceptions you must handle or declare.<a data-startref="ix_ch02-asciidoc38" data-type="indexterm" id="3_idm45941145764488"></a><a data-startref="ix_ch02-asciidoc37" data-type="indexterm" id="3_idm45941145763784"></a><a data-startref="ix_ch02-asciidoc36" data-type="indexterm" id="3_idm45941145763112"></a></p>
</div></section>



</div></section>













<section data-pdf-bookmark="Variable-Length Argument Lists" data-type="sect2"><div class="sect2" id="idm45941145762312">
<h2>Variable-Length Argument Lists</h2>

<p><a data-primary="methods" data-secondary="variable-length argument lists" data-type="indexterm" id="3_idm45941145760776"></a><a data-primary="varargs (variable-length argument) methods" data-type="indexterm" id="3_idm45941145759608"></a>Methods may be declared to accept, and may be invoked with, variable
numbers of arguments. Such methods are commonly known as <em>varargs</em>
methods. <a data-primary="format()" data-secondary="String class" data-type="indexterm" id="3_idm45941145758312"></a><a data-primary="java.lang.reflect" data-type="indexterm" id="3_idm45941145757304"></a><a data-primary="printf()" data-type="indexterm" id="3_idm45941145756632"></a><a data-primary="System.out.printf()" data-type="indexterm" id="3_idm45941145755960"></a>The 鈥減rint formatted鈥?method <code>System.out.printf()</code> as well
as the related <code>format()</code> methods of <code>String</code> use varargs, as do a
number of important methods from <a data-primary="Reflection API" data-type="indexterm" id="3_idm45941145753912"></a>the Reflection API of
<code>java.lang.reflect</code>.</p>

<p><a data-primary="鈥?(ellipses)" data-secondary="in variable-length argument lists" data-type="indexterm" id="3_idm45941145752472"></a>To declare a variable-length argument list, follow the type of the
last argument to the method with an ellipsis (<code>...</code>), indicating that
this last argument can be repeated zero or more times. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">static</code> <code class="kt">int</code> <code class="nf">max</code><code class="o">(</code><code class="kt">int</code> <code class="n">first</code><code class="o">,</code> <code class="kt">int</code><code class="o">...</code> <code class="n">rest</code><code class="o">)</code> <code class="o">{</code>
    <code class="cm">/* body omitted for now */</code>
<code class="o">}</code></pre>

<p>Varargs methods are handled purely by the compiler. They operate by
converting the variable number of arguments into an array. To the Java
runtime, the <code>max()</code> method is indistinguishable from this one:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">static</code> <code class="kt">int</code> <code class="nf">max</code><code class="o">(</code><code class="kt">int</code> <code class="n">first</code><code class="o">,</code> <code class="kt">int</code><code class="o">[]</code> <code class="n">rest</code><code class="o">)</code> <code class="o">{</code>
    <code class="cm">/* body omitted for now */</code>
<code class="o">}</code></pre>

<p>To convert a varargs signature to the 鈥渞eal鈥?signature, simply replace
<code>...</code> with <code>[ ]</code>. Remember that only one ellipsis can appear in a
parameter list, and it may only appear on the last parameter in the
list.</p>

<p>Let鈥檚 flesh out the <code>max()</code> example a little:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">static</code> <code class="kt">int</code> <code class="nf">max</code><code class="o">(</code><code class="kt">int</code> <code class="n">first</code><code class="o">,</code> <code class="kt">int</code><code class="o">...</code> <code class="n">rest</code><code class="o">)</code> <code class="o">{</code>
    <code class="kt">int</code> <code class="n">max</code> <code class="o">=</code> <code class="n">first</code><code class="o">;</code>
    <code class="k">for</code><code class="o">(</code><code class="kt">int</code> <code class="n">i</code> <code class="o">:</code> <code class="n">rest</code><code class="o">)</code> <code class="o">{</code> <code class="c1">// legal because rest is actually an array</code>
        <code class="k">if</code> <code class="o">(</code><code class="n">i</code> <code class="o">&gt;</code> <code class="n">max</code><code class="o">)</code> <code class="n">max</code> <code class="o">=</code> <code class="n">i</code><code class="o">;</code>
    <code class="o">}</code>
    <code class="k">return</code> <code class="n">max</code><code class="o">;</code>
<code class="o">}</code></pre>

<p>This <code>max()</code> method is declared with two arguments. The first is just a
regular <code>int</code> value. The second, however, may be repeated zero or more
times. All of the following are legal invocations of <code>max()</code>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">max</code><code class="o">(</code><code class="mi">0</code><code class="o">)</code>
<code class="n">max</code><code class="o">(</code><code class="mi">1</code><code class="o">,</code> <code class="mi">2</code><code class="o">)</code>
<code class="n">max</code><code class="o">(</code><code class="mi">16</code><code class="o">,</code> <code class="mi">8</code><code class="o">,</code> <code class="mi">4</code><code class="o">,</code> <code class="mi">2</code><code class="o">,</code> <code class="mi">1</code><code class="o">)</code></pre>

<p>Because varargs methods are compiled into methods that expect an array
of arguments, invocations of those methods are compiled to include code
that creates and initializes such an array. So the call <code>max(1,2,3)</code> is
compiled to this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">max</code><code class="o">(</code><code class="mi">1</code><code class="o">,</code> <code class="k">new</code> <code class="kt">int</code><code class="o">[]</code> <code class="o">{</code> <code class="mi">2</code><code class="o">,</code> <code class="mi">3</code> <code class="o">})</code></pre>

<p>In fact, if you already have method arguments stored in an array, it is
perfectly legal for you to pass them to the method that way, instead of
writing them out individually. You can treat any <code>...</code> argument as if it
were declared as an array. The converse is not true, however: you can
only use varargs method invocation syntax when the method is actually
declared as a varargs method using an ellipsis.<a data-startref="ix_ch02-asciidoc30" data-type="indexterm" id="3_idm45941145570392"></a><a data-startref="ix_ch02-asciidoc29" data-type="indexterm" id="3_idm45941145569784"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Introduction to Classes and Objects" data-type="sect1"><div class="sect1" id="idm45941145761720">
<h1>Introduction to Classes and Objects</h1>

<p><a data-primary="class(es)" data-type="indexterm" id="3_ix_ch02-asciidoc39"></a><a data-primary="objects" data-secondary="classes and" data-type="indexterm" id="3_ix_ch02-asciidoc40"></a><a data-primary="syntax, Java" data-secondary="classes and objects" data-type="indexterm" id="3_ix_ch02-asciidoc41"></a>Now that we have introduced operators, expressions, statements, and
methods, we can finally talk about classes. <a data-primary="class(es)" data-secondary="defined" data-type="indexterm" id="3_idm45941145563048"></a>A <em>class</em> is a named collection of fields that hold data values and methods that operate on
those values. Classes are just one of five reference types supported by
Java, but they are the most important type. Classes are thoroughly
documented in a chapter of their own (<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3">Chapter 3</a>).
We introduce them here, however, because they are the next higher level
of syntax after methods, and because the rest of this chapter requires a
basic familiarity with the concept of a class and the basic syntax for
defining a class, instantiating it, and using the resulting <em>object</em>.</p>

<p>The most important thing about classes is that they define new data
types. For example, you might define a class named <code>Point</code> to represent
a data point in the two-dimensional Cartesian coordinate system. This
class would define fields (each of type <code>double</code>) to hold the <em>x</em> and
<em>y</em> coordinates of a point and methods to manipulate and operate on the
point. The <code>Point</code> class is a new data type.</p>

<p>When discussing data types, it is important to distinguish between the
data type itself and the values the data type represents. <code>char</code> is a
data type: it represents Unicode characters. But a <code>char</code> value
represents a single specific character. A class is a data type; <a data-primary="objects" data-secondary="defined" data-type="indexterm" id="3_idm45941145484072"></a>a class
value is called an <em>object</em>. We use the name class because each class
defines a type (or kind, or species, or class) of objects. The <code>Point</code>
class is a data type that represents <em>x,y</em> points, while a <code>Point</code>
object represents a single specific <em>x,y</em> point. As you might imagine,
classes and their objects are closely linked. In the sections that
follow, we will discuss both.</p>








<section data-pdf-bookmark="Defining a Class" data-type="sect2"><div class="sect2" id="idm45941145480616">
<h2>Defining a Class</h2>

<p><a data-primary="class(es)" data-secondary="defining a class" data-type="indexterm" id="3_idm45941145479176"></a>Here is a possible definition of the <code>Point</code> class we have been
discussing:</p>

<pre data-code-language="java" data-type="programlisting"><code class="cm">/** Represents a Cartesian (x,y) point */</code>
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">Point</code> <code class="o">{</code>
     <code class="c1">// The coordinates of the point</code>
     <code class="kd">public</code> <code class="kt">double</code> <code class="n">x</code><code class="o">,</code> <code class="n">y</code><code class="o">;</code>
     <code class="kd">public</code> <code class="nf">Point</code><code class="o">(</code><code class="kt">double</code> <code class="n">x</code><code class="o">,</code> <code class="kt">double</code> <code class="n">y</code><code class="o">)</code> <code class="o">{</code>     <code class="c1">// A constructor that</code>
         <code class="k">this</code><code class="o">.</code><code class="na">x</code> <code class="o">=</code> <code class="n">x</code><code class="o">;</code> <code class="k">this</code><code class="o">.</code><code class="na">y</code> <code class="o">=</code> <code class="n">y</code><code class="o">;</code>            <code class="c1">// initializes the fields</code>
     <code class="o">}</code>

     <code class="kd">public</code> <code class="kt">double</code> <code class="nf">distanceFromOrigin</code><code class="o">()</code> <code class="o">{</code>   <code class="c1">// A method that operates</code>
         <code class="k">return</code> <code class="n">Math</code><code class="o">.</code><code class="na">sqrt</code><code class="o">(</code><code class="n">x</code><code class="o">*</code><code class="n">x</code> <code class="o">+</code> <code class="n">y</code><code class="o">*</code><code class="n">y</code><code class="o">);</code>       <code class="c1">// on the x and y fields</code>
     <code class="o">}</code>
<code class="o">}</code></pre>

<p>This class definition is stored in a file named <em>Point.java</em> and
compiled to a file named <em>Point.class</em>, where it is available for use by
Java programs and other classes. This class definition is provided here
for completeness and to provide context, but don鈥檛 expect to understand
all the details just yet; most of <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3">Chapter 3</a> is
devoted to the topic of defining classes.</p>

<p>Keep in mind that you don鈥檛 have to define every class you want to use
in a Java program. The Java platform includes thousands of predefined
classes that are guaranteed to be available on every computer that runs
Java.</p>
</div></section>













<section data-pdf-bookmark="Creating an Object" data-type="sect2"><div class="sect2" id="idm45941145457592">
<h2>Creating an Object</h2>

<p><a data-primary="objects" data-secondary="creating" data-type="indexterm" id="3_idm45941145397496"></a>Now that we have defined the <code>Point</code> class as a new data type, we can
use the following line to declare a variable that holds a <code>Point</code>
object:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Point</code> <code class="n">p</code><code class="o">;</code></pre>

<p>Declaring a variable to hold a <code>Point</code> object does not create the object
itself, however. To actually create an object, you must use the <code>new</code>
operator. This keyword is followed by the object鈥檚 class (i.e., its
type) and an optional argument list in parentheses. These arguments are
passed to the constructor for the class, which initializes internal
fields in the new object:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Create a Point object representing (2,-3.5).</code>
<code class="c1">// Declare a variable p and store a reference to the new Point object</code>
<code class="n">Point</code> <code class="n">p</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Point</code><code class="o">(</code><code class="mf">2.0</code><code class="o">,</code> <code class="o">-</code><code class="mf">3.5</code><code class="o">);</code>

<code class="c1">// Create some other objects as well</code>
<code class="c1">// An object that represents the current time</code>
<code class="n">LocalDateTime</code> <code class="n">d</code> <code class="o">=</code> <code class="k">new</code> <code class="n">LocalDateTime</code><code class="o">();</code>
<code class="c1">// A HashSet object to hold a set of strings</code>
<code class="n">Set</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">words</code> <code class="o">=</code> <code class="k">new</code> <code class="n">HashSet</code><code class="o">&lt;&gt;();</code></pre>

<p><a data-primary="new operator" data-secondary="creating new objects" data-type="indexterm" id="3_idm45941145388200"></a>The <code>new</code> keyword is by far the most common way to create objects in
Java. A few other ways are also worth mentioning. First, classes that
meet certain criteria are so important that Java defines special literal
syntax for creating objects of those types (as we discuss later in this
section). Second, Java supports a dynamic loading mechanism that allows
programs to load classes and create instances of those classes
dynamically. See <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch11.html#javanut7-CHP-11">Chapter 11</a> for more details.
Finally, objects can also be created by deserializing them. <a data-primary="java.io.ObjectInputStream class" data-type="indexterm" id="3_idm45941145282632"></a><a data-primary="ObjectInputStream class" data-type="indexterm" id="3_idm45941145281992"></a>An object
that has had its state saved, or serialized, usually to a file, can be
re-created using the <code>java.io.ObjectInputStream</code> class.</p>
</div></section>













<section data-pdf-bookmark="Using an Object" data-type="sect2"><div class="sect2" id="idm45941145280696">
<h2>Using an Object</h2>

<p><a data-primary="objects" data-secondary="using" data-type="indexterm" id="3_idm45941145279608"></a>Now that we鈥檝e seen how to define classes and instantiate them by
creating objects, we need to look at the Java syntax that allows us to
use those objects. Recall that a class defines a collection of fields
and methods. Each object has its own copies of those fields and has
access to those methods. We use the dot character (.) to access the
named fields and methods of an object. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Point</code> <code class="n">p</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Point</code><code class="o">(</code><code class="mi">2</code><code class="o">,</code> <code class="mi">3</code><code class="o">);</code>         <code class="c1">// Create an object</code>
<code class="kt">double</code> <code class="n">x</code> <code class="o">=</code> <code class="n">p</code><code class="o">.</code><code class="na">x</code><code class="o">;</code>                    <code class="c1">// Read a field of the object</code>
<code class="n">p</code><code class="o">.</code><code class="na">y</code> <code class="o">=</code> <code class="n">p</code><code class="o">.</code><code class="na">x</code> <code class="o">*</code> <code class="n">p</code><code class="o">.</code><code class="na">x</code><code class="o">;</code>                   <code class="c1">// Set the value of a field</code>
<code class="kt">double</code> <code class="n">d</code> <code class="o">=</code> <code class="n">p</code><code class="o">.</code><code class="na">distanceFromOrigin</code><code class="o">();</code> <code class="c1">// Access a method of the object</code></pre>

<p>This syntax is very common when programming in object-oriented
languages, and Java is no exception, frequently. Note, in particular, the expressions <code>p.distance</code> <span class="keep-together"><code>FromOrigin()</code></span>. This tells the Java
compiler to look up a method named <code>distance</code> <span class="keep-together"><code>FromOrigin()</code></span> (which is
defined by the class <code>Point</code>) and use that method to perform a
computation on the fields of the object <code>p</code>. We鈥檒l cover the details of
this operation in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3">Chapter 3</a>.</p>
</div></section>













<section data-pdf-bookmark="Object Literals" data-type="sect2"><div class="sect2" id="javanut7-CHP-2-SECT-7.4">
<h2>Object Literals</h2>

<p><a data-primary="objects" data-secondary="literals" data-type="indexterm" id="3_idm45941145228664"></a>In our discussion of primitive types, we saw that each primitive type
has a literal syntax for including values of the type literally into the
text of a program. Java also defines a literal syntax for a few special
reference types, as described next.</p>










<section data-pdf-bookmark="String literals" data-type="sect3"><div class="sect3" id="idm45941145227160">
<h3>String literals</h3>

<p><a data-primary="string literals" data-type="indexterm" id="3_idm45941145225752"></a>The <code>String</code> class represents text as a string of characters. Because
programs usually communicate with their users through the written word,
the ability to manipulate strings of text is quite important in any
programming language. <a data-primary="strings" data-secondary="String class" data-type="indexterm" id="3_idm45941145224264"></a>In Java, strings are objects; the data type used
to represent text is the <code>String</code> class. Modern Java programs usually
use more string data than anything else.</p>

<p><a data-primary='&quot; (quotes, double)' data-secondary="in string literals" data-type="indexterm" id="3_idm45941145222488"></a><a data-primary="string concatenation operator (+)" data-type="indexterm" id="3_idm45941145221512"></a>Accordingly, because strings are such a fundamental data type, Java
allows you to include text literally in programs by placing it between
double-quote (<code>&quot;</code>) characters. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">String</code> <code class="n">name</code> <code class="o">=</code> <code class="s">David</code><code class="o">;</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Hello, </code> <code class="o">+</code> <code class="n">name</code><code class="o">);</code></pre>

<p><a data-primary="&apos; (quotes, single)" data-secondary="in char literals" data-type="indexterm" id="3_idm45941145193720"></a>Don鈥檛 confuse the double-quote characters that surround string literals
with the single-quote (or apostrophe) characters that surround <code>char</code>
literals. String literals can contain any of the escape sequences
<code>char</code> literals can (see <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2-TABLE-2">Table 2-2</a>).
<a data-primary="escape sequences" data-secondary="in string literals" data-type="indexterm" id="3_idm45941145203160"></a>Escape sequences are particularly useful for embedding double-quote
characters within double-quoted string literals. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">String</code> <code class="n">story</code> <code class="o">=</code> <code class="s">\t\&quot;How can you stand it?\&quot; he asked sarcastically.\n</code><code class="o">;</code></pre>

<p>String literals cannot contain comments and may consist of only a single
line. Java does not support any kind of continuation-character syntax
that allows two separate lines to be treated as a single line. <a data-primary="+ (plus sign)" data-secondary="string concatenation operator" data-type="indexterm" id="3_idm45941145194744"></a>If you
need to represent a long string of text that does not fit on a single
line, break it into independent string literals and use the <code>+</code>
operator to concatenate the literals. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// This is illegal; string  literals cannot be broken across lines.</code>
<code class="n">String</code> <code class="n">x</code> <code class="o">=</code> <code class="s">&quot;This is a test of the</code>
<code class="s">            emergency broadcast system&quot;</code><code class="o">;</code>

<code class="n">String</code> <code class="n">s</code> <code class="o">=</code> <code class="s">This is a test of the </code> <code class="o">+</code>     <code class="c1">// Do this instead</code>
           <code class="s">emergency broadcast system</code><code class="o">;</code></pre>

<p>The literals are concatenated when your program is compiled,
not when it is run, so you do not need to worry about any kind of
performance penalty.</p>
</div></section>













<section data-pdf-bookmark="Type literals" data-type="sect3"><div class="sect3" id="idm45941134148712">
<h3>Type literals</h3>

<p><a data-primary="Class class" data-type="indexterm" id="3_idm45941134147784"></a><a data-primary="Class object" data-secondary="type literals" data-type="indexterm" id="3_idm45941134146856"></a><a data-primary="type literals" data-type="indexterm" id="3_idm45941134145912"></a>The second type that supports its own special object literal syntax is
the class named <code>Class</code>. Instances of the <code>Class</code> class represent a
Java data type, and contain metadata about the type that is referred to.
To include a <code>Class</code> object literally in a Java program, follow the name
of any data type with <code>.class</code>. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Class</code><code class="o">&lt;?&gt;</code> <code class="n">typeInt</code> <code class="o">=</code> <code class="kt">int</code><code class="o">.</code><code class="na">class</code><code class="o">;</code>
<code class="n">Class</code><code class="o">&lt;?&gt;</code> <code class="n">typeIntArray</code> <code class="o">=</code> <code class="kt">int</code><code class="o">[].</code><code class="na">class</code><code class="o">;</code>
<code class="n">Class</code><code class="o">&lt;?&gt;</code> <code class="n">typePoint</code> <code class="o">=</code> <code class="n">Point</code><code class="o">.</code><code class="na">class</code><code class="o">;</code></pre>
</div></section>













<section data-pdf-bookmark="The null reference" data-type="sect3"><div class="sect3" id="idm45941134138552">
<h3>The null reference</h3>

<p><a data-primary="null reference" data-type="indexterm" id="3_idm45941134125240"></a><a data-primary="reference types" data-secondary="null" data-type="indexterm" id="3_idm45941134124536"></a>The <code>null</code> keyword is a special literal value that is a reference to
nothing, or an absence of a reference. The <code>null</code> value is unique
because it is a member of every reference type. You can assign <code>null</code>
to variables of any reference type. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">String</code> <code class="n">s</code> <code class="o">=</code> <code class="kc">null</code><code class="o">;</code>
<code class="n">Point</code> <code class="n">p</code> <code class="o">=</code> <code class="kc">null</code><code class="o">;</code></pre>
</div></section>



</div></section>













<section data-pdf-bookmark="Lambda Expressions" data-type="sect2"><div class="sect2" id="javanut7-CHP-2-SECT-7.5">
<h2>Lambda Expressions</h2>

<p><a data-primary="lambda expressions" data-type="indexterm" id="3_idm45941134094520"></a><a data-primary="syntax, Java" data-secondary="lambda expressions" data-type="indexterm" id="3_idm45941134093816"></a>In Java 8, a major new feature was introduced鈥?em&gt;lambda expressions</em>. <a data-primary="functional programming" data-secondary="languages" data-type="indexterm" id="3_idm45941134092360"></a>These are a very common programming language construct, and in
particular are extremely widely used in the family of languages known as <em>functional programming languages</em> (e.g., Lisp, Haskell, and OCaml).
The power and flexibility of lambdas goes far beyond just functional
languages, and they can be found in almost all modern programming
languages.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45941134090360">
<h5>Definition of a Lambda Expression</h5>
<p><a data-primary="lambda expressions" data-secondary="defined" data-type="indexterm" id="3_idm45941134089224"></a>A lambda expression is essentially a function that does not have a
name, and can be treated as a value in the language. As Java does not
allow code to run around on its own outside of classes, in Java, this
means that a lambda is an anonymous method that is defined on some class
(that is possibly unknown to the developer).</p>
</div></aside>

<p>The syntax for a lambda expression looks like this:</p>
<pre data-code-language="java" data-type="programlisting"><code class="o">(</code><code> </code><em><code class="n">paramlist</code></em><code> </code><code class="o">)</code><code> </code><code class="o">-</code><code class="o">&gt;</code><code> </code><code class="o">{</code><code> </code><em><code class="n">statements</code></em><code> </code><code class="o">}</code><code>
</code></pre>

<p>One simple, very traditional example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Runnable</code> <code class="n">r</code> <code class="o">=</code> <code class="o">()</code> <code class="o">-&gt;</code> <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Hello World</code><code class="o">);</code></pre>

<p><a data-primary="type inference" data-type="indexterm" id="3_idm45941134008616"></a>When a lambda expression is used as a value, it is automatically
converted to a new object of the correct type for the variable that it
is being placed into. This auto-conversion and <em>type inference</em> is essential to Java鈥檚 approach to lambda expressions. Unfortunately, it
relies on a proper understanding of Java鈥檚 type system as a whole.
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4-SECT-5">鈥淣ested Types鈥?/a&gt; provides a more detailed
explanation of lambda expressions鈥攕o for now, it suffices to simply
recognize the syntax for lambdas.</p>

<p>A slightly more complex example:<a data-startref="ix_ch02-asciidoc41" data-type="indexterm" id="3_idm45941133986648"></a><a data-startref="ix_ch02-asciidoc40" data-type="indexterm" id="3_idm45941133985944"></a><a data-startref="ix_ch02-asciidoc39" data-type="indexterm" id="3_idm45941133985272"></a></p>

<pre data-code-language="java" data-type="programlisting"><code class="n">ActionListener</code> <code class="n">listener</code> <code class="o">=</code> <code class="o">(</code><code class="n">e</code><code class="o">)</code> <code class="o">-&gt;</code> <code class="o">{</code>
  <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Event fired at: </code><code class="o">+</code> <code class="n">e</code><code class="o">.</code><code class="na">getWhen</code><code class="o">());</code>
  <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Event command: </code><code class="o">+</code> <code class="n">e</code><code class="o">.</code><code class="na">getActionCommand</code><code class="o">());</code>
<code class="o">};</code></pre>
</div></section>





</div></section>













<section data-pdf-bookmark="Arrays" data-type="sect1"><div class="sect1" id="idm45941134097224">
<h1>Arrays</h1>

<p><a data-primary="arrays" data-type="indexterm" id="3_ix_ch02-asciidoc42"></a><a data-primary="objects" data-secondary="arrays as" data-type="indexterm" id="3_ix_ch02-asciidoc43"></a><a data-primary="syntax, Java" data-secondary="arrays" data-type="indexterm" id="3_ix_ch02-asciidoc44"></a>An <em>array</em> is a special kind of object that holds zero or more
primitive values or references. <a data-primary="indexes" data-secondary="array" data-type="indexterm" id="3_idm45941133915016"></a>These values are held in the <em>elements</em>
of the array, which are unnamed variables referred to by their position
or <em>index</em>. The type of an array is characterized by its <em>element
type</em>, and all elements of the array must be of that type.</p>

<p>Array elements are numbered starting with zero, and valid indexes range
from zero to the number of elements minus one. The array element with
index 1, for example, is the <em>second</em> element in the array. <a data-primary="length field" data-type="indexterm" id="3_idm45941133911800"></a><a data-primary="length of arrays" data-type="indexterm" id="3_idm45941133911064"></a>The number
of elements in an array is its <em>length</em>. The length of an array is
specified when the array is created, and it never changes.</p>

<p>The element type of an array may be any valid Java type, including array
types. This means that Java supports arrays of arrays, which provide a
kind of multidimensional array capability. Java does not support the
matrix-style multidimensional arrays found in some languages.</p>








<section data-pdf-bookmark="Array Types" data-type="sect2"><div class="sect2" id="idm45941133908984">
<h2>Array Types</h2>

<p><a data-primary="arrays" data-secondary="array types" data-type="indexterm" id="3_ix_ch02-asciidoc45"></a><a data-primary="arrays" data-secondary="types" data-type="indexterm" id="3_ix_ch02-asciidoc46"></a><a data-primary="data types" data-secondary="array types" data-type="indexterm" id="3_ix_ch02-asciidoc47"></a>Array types are <a data-primary="reference types" data-secondary="array types" data-type="indexterm" id="3_idm45941133903512"></a>reference types, just as classes are. Instances of
arrays are objects, just as the instances of a class are.<sup><a class="totri-footnote" data-type="noteref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#idm45941133902280" id="idm45941133902280-marker">4</a></sup> <a data-primary="[ ] (brackets)" data-secondary="after array element type" data-type="indexterm" id="3_idm45941133901336"></a><a data-primary="data types" data-secondary="array elements" data-type="indexterm" id="3_idm45941133900392"></a>Unlike classes, array types do not
have to be defined. Simply place square brackets after the element
type. For example, the following code declares three variables of array
type:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">byte</code> <code class="n">b</code><code class="o">;</code>                        <code class="c1">// byte is a primitive type</code>
<code class="kt">byte</code><code class="o">[]</code> <code class="n">arrayOfBytes</code><code class="o">;</code>           <code class="c1">// byte[] is an array of byte values</code>
<code class="kt">byte</code><code class="o">[][]</code> <code class="n">arrayOfArrayOfBytes</code><code class="o">;</code>  <code class="c1">// byte[][] is an array of byte[]</code>
<code class="n">String</code><code class="o">[]</code> <code class="n">points</code><code class="o">;</code>               <code class="c1">// String[] is an array of strings</code></pre>

<p>The length of an array is not part of the array type. It is not
possible, for example, to declare a method that expects an array of
exactly four <code>int</code> values. If a method parameter is of type
<code>int[]</code>, a caller can pass an array with any number (including zero) of
elements.</p>

<p><a data-primary="java.lang.Object" data-type="indexterm" id="3_idm45941133847320"></a>Array types are not classes, but array instances are objects. This
means that arrays inherit the methods of <code>java.lang.Object</code>. <a data-primary="clone()" data-type="indexterm" id="3_idm45941133845736"></a><a data-primary="Cloneable interface" data-type="indexterm" id="3_idm45941133845000"></a><a data-primary="CloneNotSupportedException" data-type="indexterm" id="3_idm45941133844328"></a>Arrays
implement the <code>Cloneable</code> interface and override the <code>clone()</code> method
to guarantee that an array can always be cloned and that <code>clone()</code> never
throws a <code>CloneNotSupportedException</code>. Arrays also implement
<code>Serializable</code> so that any array can be serialized if its element type
can be serialized. Finally, all arrays have a <code>public final int</code> field
named <code>length</code> that specifies the number of elements in the array.</p>










<section data-pdf-bookmark="Array type widening conversions" data-type="sect3"><div class="sect3" id="idm45941133846936">
<h3>Array type widening conversions</h3>

<p><a data-primary="arrays" data-secondary="type widening conversions" data-type="indexterm" id="3_idm45941133839208"></a><a data-primary="Object class" data-type="indexterm" id="3_idm45941133837768"></a><a data-primary="Serializable interface" data-type="indexterm" id="3_idm45941133837096"></a><a data-primary="widening conversions" data-secondary="array types" data-type="indexterm" id="3_idm45941133836424"></a><a data-primary="widening conversions" data-secondary="arrays" data-type="indexterm" id="3_idm45941133835480"></a>Because arrays extend <code>Object</code> and implement the <code>Cloneable</code> and
<code>Serializable</code> interfaces, any array type can be widened to any of these
three types. But certain array types can also be widened to other array
types. If the element type of an array is a reference type <code>T</code>, and <code>T</code>
is assignable to a type <code>S</code>, the array type <code>T[]</code> is assignable to the
array type <code>S[]</code>. Note that there are no widening conversions of this
sort for arrays of a given primitive type. As examples, the following
lines of code show legal array widening conversions:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">String</code><code class="o">[]</code> <code class="n">arrayOfStrings</code><code class="o">;</code>      <code class="c1">// Created elsewhere</code>
<code class="kt">int</code><code class="o">[][]</code> <code class="n">arrayOfArraysOfInt</code><code class="o">;</code>   <code class="c1">// Created elsewhere</code>
<code class="c1">// String is assignable to Object,</code>
<code class="c1">// so String[] is assignable to Object[]</code>
<code class="n">Object</code><code class="o">[]</code> <code class="n">oa</code> <code class="o">=</code> <code class="n">arrayOfStrings</code><code class="o">;</code>
<code class="c1">// String implements Comparable, so a String[] can</code>
<code class="c1">// be considered a Comparable[]</code>
<code class="n">Comparable</code><code class="o">[]</code> <code class="n">ca</code> <code class="o">=</code> <code class="n">arrayOfStrings</code><code class="o">;</code>
<code class="c1">// An int[] is an Object, so int[][] is assignable to Object[]</code>
<code class="n">Object</code><code class="o">[]</code> <code class="n">oa2</code> <code class="o">=</code> <code class="n">arrayOfArraysOfInt</code><code class="o">;</code>
<code class="c1">// All arrays are cloneable, serializable Objects</code>
<code class="n">Object</code> <code class="n">o</code> <code class="o">=</code> <code class="n">arrayOfStrings</code><code class="o">;</code>
<code class="n">Cloneable</code> <code class="n">c</code> <code class="o">=</code> <code class="n">arrayOfArraysOfInt</code><code class="o">;</code>
<code class="n">Serializable</code> <code class="n">s</code> <code class="o">=</code> <code class="n">arrayOfArraysOfInt</code><code class="o">[</code><code class="mi">0</code><code class="o">];</code></pre>

<p>This ability to widen an array type to another array type means that the
compile-time type of an array is not always the same as its runtime
type.</p>
<div data-type="tip"><h6>Tip</h6>
<p><a data-primary="array covariance" data-type="indexterm" id="3_idm45941133802328"></a>This widening is known as <em>array covariance</em>, and as we shall see in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4-SECT-2.5">鈥淏ounded Type Parameters鈥?/a&gt;, it is regarded by modern
standards as a historical artifact and a misfeature, because of the
mismatch between compile and runtime typing that it exposes.</p>
</div>

<p>The compiler must usually insert runtime checks before any operation
that stores a reference value into an array element to ensure that the
runtime type of the value matches the runtime type of the array element.
<a data-primary="ArrayStoreException" data-type="indexterm" id="3_idm45941133753816"></a>An <code>ArrayStoreException</code> is thrown if the runtime check fails.</p>
</div></section>













<section data-pdf-bookmark="C compatibility syntax" data-type="sect3"><div class="sect3" id="idm45941133752440">
<h3>C compatibility syntax</h3>

<p><a data-primary="arrays" data-secondary="C compatibility syntax" data-type="indexterm" id="3_idm45941133751240"></a><a data-primary="C/C++" data-secondary="array compatibility syntax" data-type="indexterm" id="3_idm45941133750264"></a><a data-primary="C/C++" data-secondary="compatibility syntax in variable declarations" data-type="indexterm" id="3_idm45941133749304"></a><a data-primary="variables" data-secondary="declaring" data-type="indexterm" id="3_idm45941133748264"></a>As we鈥檝e seen, you write an array type simply by placing brackets after
the element type. For compatibility with C and C++, however, Java
supports an alternative syntax in variable declarations: brackets may
be placed after the name of the variable instead of, or in addition to,
the element type. This applies to local variables, fields, and method
parameters. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// This line declares local variables of type int, int[] and int[][]</code>
<code class="kt">int</code> <code class="n">justOne</code><code class="o">,</code> <code class="n">arrayOfThem</code><code class="o">[],</code> <code class="n">arrayOfArrays</code><code class="o">[][];</code>

<code class="c1">// These three lines declare fields of the same array type:</code>
<code class="kd">public</code> <code class="n">String</code><code class="o">[][]</code> <code class="n">aas1</code><code class="o">;</code>   <code class="c1">// Preferred Java syntax</code>
<code class="kd">public</code> <code class="n">String</code> <code class="n">aas2</code><code class="o">[][];</code>   <code class="c1">// C syntax</code>
<code class="kd">public</code> <code class="n">String</code><code class="o">[]</code> <code class="n">aas3</code><code class="o">[];</code>   <code class="c1">// Confusing hybrid syntax</code>

<code class="c1">// This method signature includes two parameters with the same type</code>
<code class="kd">public</code> <code class="kd">static</code> <code class="kt">double</code> <code class="nf">dotProduct</code><code class="o">(</code><code class="kt">double</code><code class="o">[]</code> <code class="n">x</code><code class="o">,</code> <code class="kt">double</code> <code class="n">y</code><code class="o">[])</code> <code class="o">{</code> <code class="o">...</code> <code class="o">}</code></pre>
<div data-type="tip"><h6>Tip</h6>
<p>This compatibility syntax is extremely uncommon, and you should not use
it.<a data-startref="ix_ch02-asciidoc47" data-type="indexterm" id="3_idm45941133666632"></a><a data-startref="ix_ch02-asciidoc46" data-type="indexterm" id="3_idm45941133666024"></a><a data-startref="ix_ch02-asciidoc45" data-type="indexterm" id="3_idm45941133665352"></a></p>
</div>
</div></section>



</div></section>













<section data-pdf-bookmark="Creating and Initializing Arrays" data-type="sect2"><div class="sect2" id="idm45941133664296">
<h2>Creating and Initializing Arrays</h2>

<p><a data-primary="arrays" data-secondary="creating and initializing" data-type="indexterm" id="3_idm45941133662920"></a>To create an array value in Java, you use the <code>new</code> keyword, just as
you do to create an object. <a data-primary="length of arrays" data-type="indexterm" id="3_idm45941133661464"></a>Array types don鈥檛 have constructors, but you
are required to specify a length whenever you create an array. Specify
the desired size of your array as a nonnegative integer between square
brackets:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Create a new array to hold 1024 bytes</code>
<code class="kt">byte</code><code class="o">[]</code> <code class="n">buffer</code> <code class="o">=</code> <code class="k">new</code> <code class="kt">byte</code><code class="o">[</code><code class="mi">1024</code><code class="o">];</code>
<code class="c1">// Create an array of 50 references to strings</code>
<code class="n">String</code><code class="o">[]</code> <code class="n">lines</code> <code class="o">=</code> <code class="k">new</code> <code class="n">String</code><code class="o">[</code><code class="mi">50</code><code class="o">];</code></pre>

<p>When you create an array with this syntax, each of the array elements is
automatically initialized to the same default value that is used for the
fields of a class: <code>false</code> for <code>boolean</code> elements, <code>\u0000</code> for <code>char</code>
elements, <code>0</code> for integer elements, <code>0.0</code> for floating-point elements, and
<code>null</code> for elements of reference type.</p>

<p><a data-primary="expressions" data-secondary="array creation" data-type="indexterm" id="3_idm45941133638600"></a>Array creation expressions can also be used to create and initialize a
multidimensional array of arrays. This syntax is somewhat more
complicated and is explained later in this section.</p>










<section data-pdf-bookmark="Array initializers" data-type="sect3"><div class="sect3" id="idm45941133654136">
<h3>Array initializers</h3>

<p><a data-primary="arrays" data-secondary="initializers" data-type="indexterm" id="3_idm45941133652568"></a><a data-primary="initializers" data-secondary="array" data-type="indexterm" id="3_idm45941133651592"></a>To create an array and initialize its elements in a single expression, omit the array length and follow the square brackets with a
comma-separated list of expressions within curly braces. The type of
each expression must be assignable to the element type of the array, of
course. The length of the array that is created is equal to the number
of expressions. It is legal, but not necessary, to include a trailing
comma following the last expression in the list. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">String</code><code class="o">[]</code> <code class="n">greetings</code> <code class="o">=</code> <code class="k">new</code> <code class="n">String</code><code class="o">[]</code> <code class="o">{</code> <code class="s">Hello</code><code class="o">,</code> <code class="s">Hi</code><code class="o">,</code> <code class="s">Howdy</code> <code class="o">};</code>
<code class="kt">int</code><code class="o">[]</code> <code class="n">smallPrimes</code> <code class="o">=</code> <code class="k">new</code> <code class="kt">int</code><code class="o">[]</code> <code class="o">{</code> <code class="mi">2</code><code class="o">,</code> <code class="mi">3</code><code class="o">,</code> <code class="mi">5</code><code class="o">,</code> <code class="mi">7</code><code class="o">,</code> <code class="mi">11</code><code class="o">,</code> <code class="mi">13</code><code class="o">,</code> <code class="mi">17</code><code class="o">,</code> <code class="mi">19</code><code class="o">,</code> <code class="o">};</code></pre>

<p>Note that this syntax allows arrays to be created, initialized, and used
without ever being assigned to a variable. In a sense, these array
creation expressions are anonymous array literals. Here are examples:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Call a method, passing an anonymous array literal that</code>
<code class="c1">// contains two strings</code>
<code class="n">String</code> <code class="n">response</code> <code class="o">=</code> <code class="n">askQuestion</code><code class="o">(</code><code class="s">Do you want to quit?</code><code class="o">,</code>
                               <code class="k">new</code> <code class="n">String</code><code class="o">[]</code> <code class="o">{</code><code class="s">Yes</code><code class="o">,</code> <code class="s">No</code><code class="o">});</code>

<code class="c1">// Call another method with an anonymous array (of anonymous objects)</code>
<code class="kt">double</code> <code class="n">d</code> <code class="o">=</code> <code class="n">computeAreaOfTriangle</code><code class="o">(</code><code class="k">new</code> <code class="n">Point</code><code class="o">[]</code> <code class="o">{</code> <code class="k">new</code> <code class="n">Point</code><code class="o">(</code><code class="mi">1</code><code class="o">,</code><code class="mi">2</code><code class="o">),</code>
                                               <code class="k">new</code> <code class="nf">Point</code><code class="o">(</code><code class="mi">3</code><code class="o">,</code><code class="mi">4</code><code class="o">),</code>
                                               <code class="k">new</code> <code class="nf">Point</code><code class="o">(</code><code class="mi">3</code><code class="o">,</code><code class="mi">2</code><code class="o">)</code> <code class="o">});</code></pre>

<p><a data-primary="new operator" data-secondary="creating arrays" data-type="indexterm" id="3_idm45941133520072"></a>When an array initializer is part of a variable declaration, you may
omit the <code>new</code> keyword and element type and list the desired array
elements within curly braces:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">String</code><code class="o">[]</code> <code class="n">greetings</code> <code class="o">=</code> <code class="o">{</code> <code class="s">Hello</code><code class="o">,</code> <code class="s">Hi</code><code class="o">,</code> <code class="s">Howdy</code> <code class="o">};</code>
<code class="kt">int</code><code class="o">[]</code> <code class="n">powersOfTwo</code> <code class="o">=</code> <code class="o">{</code><code class="mi">1</code><code class="o">,</code> <code class="mi">2</code><code class="o">,</code> <code class="mi">4</code><code class="o">,</code> <code class="mi">8</code><code class="o">,</code> <code class="mi">16</code><code class="o">,</code> <code class="mi">32</code><code class="o">,</code> <code class="mi">64</code><code class="o">,</code> <code class="mi">128</code><code class="o">};</code></pre>

<p>Array literals are created and initialized when the program is run, not
when the program is compiled. Consider the following array literal:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">int</code><code class="o">[]</code> <code class="n">perfectNumbers</code> <code class="o">=</code> <code class="o">{</code><code class="mi">6</code><code class="o">,</code> <code class="mi">28</code><code class="o">};</code></pre>

<p>This is compiled into Java byte codes that are equivalent to:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">int</code><code class="o">[]</code> <code class="n">perfectNumbers</code> <code class="o">=</code> <code class="k">new</code> <code class="kt">int</code><code class="o">[</code><code class="mi">2</code><code class="o">];</code>
<code class="n">perfectNumbers</code><code class="o">[</code><code class="mi">0</code><code class="o">]</code> <code class="o">=</code> <code class="mi">6</code><code class="o">;</code>
<code class="n">perfectNumbers</code><code class="o">[</code><code class="mi">1</code><code class="o">]</code> <code class="o">=</code> <code class="mi">28</code><code class="o">;</code></pre>

<p>The fact that Java does all array initialization at runtime has an
important corollary. It means that the expressions in an array
initializer may be computed at runtime and need not be compile-time
constants. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Point</code><code class="o">[]</code> <code class="n">points</code> <code class="o">=</code> <code class="o">{</code> <code class="n">circle1</code><code class="o">.</code><code class="na">getCenterPoint</code><code class="o">(),</code> <code class="n">circle2</code><code class="o">.</code><code class="na">getCenterPoint</code><code class="o">()</code> <code class="o">};</code></pre>
</div></section>



</div></section>













<section data-pdf-bookmark="Using Arrays" data-type="sect2"><div class="sect2" id="idm45941133653672">
<h2>Using Arrays</h2>

<p><a data-primary="arrays" data-secondary="using" data-type="indexterm" id="3_ix_ch02-asciidoc48"></a>Once an array has been created, you are ready to start using it. The
following sections explain basic access to the elements of an array and
cover common idioms of array usage, such as iterating through the
elements of an array and copying an array or part of an array.</p>










<section data-pdf-bookmark="Accessing array elements" data-type="sect3"><div class="sect3" id="idm45941133297256">
<h3>Accessing array elements</h3>

<p><a data-primary="arrays" data-secondary="accessing elements" data-type="indexterm" id="3_idm45941133296120"></a>The elements of an array are variables. When an array element appears
in an expression, it evaluates to the value held in the element. And
when an array element appears on the lefthand side of an assignment
operator, a new value is stored into that element. Unlike a normal
variable, however, an array element has no name, only a number. <a data-primary="[ ] (brackets)" data-secondary="accessing array elements" data-type="indexterm" id="3_idm45941133251672"></a><a data-primary="arrays" data-secondary="accessing elements" data-type="indexterm" id="3_idm45941133250760"></a>Array
elements are accessed using a square bracket notation. If <code>a</code> is an
expression that evaluates to an array reference, you index that array
and refer to a specific element with <code>a[i]</code>, where <code>i</code> is an integer
literal or an expression that evaluates to an <code>int</code>. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Create an array of two strings</code>
<code class="n">String</code><code class="o">[]</code> <code class="n">responses</code> <code class="o">=</code> <code class="k">new</code> <code class="n">String</code><code class="o">[</code><code class="mi">2</code><code class="o">];</code>
<code class="n">responses</code><code class="o">[</code><code class="mi">0</code><code class="o">]</code> <code class="o">=</code> <code class="s">Yes</code><code class="o">;</code>  <code class="c1">// Set the first element of the array</code>
<code class="n">responses</code><code class="o">[</code><code class="mi">1</code><code class="o">]</code> <code class="o">=</code> <code class="s">No</code><code class="o">;</code>   <code class="c1">// Set the second element of the array</code>

<code class="c1">// Now read these array elements</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">question</code> <code class="o">+</code> <code class="s"> (</code> <code class="o">+</code> <code class="n">responses</code><code class="o">[</code><code class="mi">0</code><code class="o">]</code> <code class="o">+</code> <code class="s">/</code> <code class="o">+</code>
                   <code class="n">responses</code><code class="o">[</code><code class="mi">1</code><code class="o">]</code> <code class="o">+</code> <code class="s"> ): </code><code class="o">);</code>

<code class="c1">// Both the array reference and the array index may be more complex</code>
<code class="kt">double</code> <code class="n">datum</code> <code class="o">=</code> <code class="n">data</code><code class="o">.</code><code class="na">getMatrix</code><code class="o">()[</code><code class="n">data</code><code class="o">.</code><code class="na">row</code><code class="o">()</code> <code class="o">*</code> <code class="n">data</code><code class="o">.</code><code class="na">numColumns</code><code class="o">()</code> <code class="o">+</code>
                   <code class="n">data</code><code class="o">.</code><code class="na">column</code><code class="o">()];</code></pre>

<p>The array index expression must be of type <code>int</code>, or a type that can be
widened to an <code>int</code>: <code>byte</code>, <code>short</code>, or even <code>char</code>. It is obviously
not legal to index an array with a <code>boolean</code>, <code>float</code>, or <code>double</code>
value. Remember that the <code>length</code> field of an array is an <code>int</code> and that
arrays may not have more than <code>Integer.MAX_VALUE</code> elements. Indexing an
array with an expression of type <code>long</code> generates a compile-time error,
even if the value of that expression at runtime would be within the
range of an <code>int</code>.</p>
</div></section>













<section data-pdf-bookmark="Array bounds" data-type="sect3"><div class="sect3" id="idm45941133147688">
<h3>Array bounds</h3>

<p><a data-primary="arrays" data-secondary="array bounds" data-type="indexterm" id="3_idm45941133146568"></a><a data-primary="arrays" data-secondary="bounds" data-type="indexterm" id="3_idm45941133145624"></a>Remember that the first element of an array <code>a</code> is <code>a[0]</code> , the second element is <code>a[1]</code>, and the last is <code>a[a.length-1]</code>.</p>

<p><a data-primary="indexes" data-secondary="array" data-type="indexterm" id="3_idm45941133142600"></a>A common bug involving arrays is use of an index that is too small (a
negative index) or too large (greater than or equal to the array
<code>length</code>). In languages like C or C++, accessing elements before the
beginning or after the end of an array yields unpredictable behavior
that can vary from invocation to invocation and platform to platform.
Such bugs may not always be caught, and if a failure occurs, it may be
at some later time. While it is just as easy to write faulty array
indexing code in Java, Java guarantees predictable results by checking
every array access at runtime. <a data-primary="ArrayIndexOutOfBoundsException" data-type="indexterm" id="3_idm45941133140504"></a>If an array index is too small or too
large, Java immediately throws an <code>ArrayIndexOutOfBoundsException</code>.</p>
</div></section>













<section data-pdf-bookmark="Iterating arrays" data-type="sect3"><div class="sect3" id="idm45941133139064">
<h3>Iterating arrays</h3>

<p><a data-primary="arrays" data-secondary="iterating" data-type="indexterm" id="3_idm45941133137624"></a><a data-primary="data types" data-secondary="array index expressions" data-type="indexterm" id="3_idm45941133136648"></a><a data-primary="for statements" data-secondary="iterating arrays" data-type="indexterm" id="3_idm45941133135704"></a><a data-primary="iteration" data-secondary="arrays" data-type="indexterm" id="3_idm45941133134760"></a>It is common to write loops that iterate through each of the elements
of an array in order to perform some operation on it. This is typically
done with a <code>for</code> loop. The following code, for example, computes the
sum of an array of integers:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">int</code><code class="o">[]</code> <code class="n">primes</code> <code class="o">=</code> <code class="o">{</code> <code class="mi">2</code><code class="o">,</code> <code class="mi">3</code><code class="o">,</code> <code class="mi">5</code><code class="o">,</code> <code class="mi">7</code><code class="o">,</code> <code class="mi">11</code><code class="o">,</code> <code class="mi">13</code><code class="o">,</code> <code class="mi">17</code><code class="o">,</code> <code class="mi">19</code><code class="o">,</code> <code class="mi">23</code> <code class="o">};</code>
<code class="kt">int</code> <code class="n">sumOfPrimes</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code>
<code class="k">for</code><code class="o">(</code><code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code> <code class="n">i</code> <code class="o">&lt;</code> <code class="n">primes</code><code class="o">.</code><code class="na">length</code><code class="o">;</code> <code class="n">i</code><code class="o">++)</code>
    <code class="n">sumOfPrimes</code> <code class="o">+=</code> <code class="n">primes</code><code class="o">[</code><code class="n">i</code><code class="o">];</code></pre>

<p>The structure of this <code>for</code> loop is idiomatic, and you鈥檒l see it
frequently. <a data-primary="foreach statements" data-secondary="iterating arrays" data-type="indexterm" id="3_idm45941133092552"></a>Java also has the foreach syntax that we鈥檝e already met. The summing code could be rewritten succinctly as follows:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">for</code><code class="o">(</code><code class="kt">int</code> <code class="n">p</code> <code class="o">:</code> <code class="n">primes</code><code class="o">)</code> <code class="n">sumOfPrimes</code> <code class="o">+=</code> <code class="n">p</code><code class="o">;</code></pre>
</div></section>













<section data-pdf-bookmark="Copying arrays" data-type="sect3"><div class="sect3" id="idm45941133138728">
<h3>Copying arrays</h3>

<p><a data-primary="arrays" data-secondary="copying" data-type="indexterm" id="3_idm45941133033880"></a><a data-primary="clone()" data-type="indexterm" id="3_idm45941133032680"></a><a data-primary="Cloneable interface" data-type="indexterm" id="3_idm45941133032008"></a>All array types implement the <code>Cloneable</code> interface, and any array can
be copied by invoking its <code>clone()</code> method. Note that a cast is
required to convert the return value to the appropriate array type, but the <code>clone()</code> method of arrays is guaranteed not to throw
<code>CloneNotSupportedException</code>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">int</code><code class="o">[]</code> <code class="n">data</code> <code class="o">=</code> <code class="o">{</code> <code class="mi">1</code><code class="o">,</code> <code class="mi">2</code><code class="o">,</code> <code class="mi">3</code> <code class="o">};</code>
<code class="kt">int</code><code class="o">[]</code> <code class="n">copy</code> <code class="o">=</code> <code class="o">(</code><code class="kt">int</code><code class="o">[])</code> <code class="n">data</code><code class="o">.</code><code class="na">clone</code><code class="o">();</code></pre>

<p>The <code>clone()</code> method makes a shallow copy. If the element type of the
array is a reference type, only the references are copied, not the
referenced objects themselves. Because the copy is shallow, any array
can be cloned, even if the element type is not itself <code>Cloneable</code>.</p>

<p><a data-primary="arrayCopy()" data-type="indexterm" id="3_idm45941132941464"></a><a data-primary="System.arraycopy()" data-type="indexterm" id="3_idm45941132940872"></a>Sometimes you simply want to copy elements from one existing array to
another existing array. The <code>System.arraycopy()</code> method is designed to
do this efficiently, and you can assume that Java VM implementations
perform this method using high-speed block copy operations on the
underlying hardware.</p>

<p><code>arraycopy()</code> is a straightforward function that is difficult to use
only because it has five arguments to remember. First, pass the source
array from which elements are to be copied. Second, pass the index of
the start element in that array. Pass the destination array and the
destination index as the third and fourth arguments. Finally, as the
fifth argument, specify the number of elements to be copied.</p>

<p><code>arraycopy()</code> works correctly even for overlapping copies within the
same array. For example, if you鈥檝e 鈥渄eleted鈥?the element at index <code>0</code>
from array <code>a</code> and want to shift the elements between indexes <code>1</code> and
<code>n</code> down one so that they occupy indexes <code>0</code> through <code>n-1,</code> you could do
this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">System</code><code class="o">.</code><code class="na">arraycopy</code><code class="o">(</code><code class="n">a</code><code class="o">,</code> <code class="mi">1</code><code class="o">,</code> <code class="n">a</code><code class="o">,</code> <code class="mi">0</code><code class="o">,</code> <code class="n">n</code><code class="o">);</code></pre>
</div></section>













<section data-pdf-bookmark="Array utilities" data-type="sect3"><div class="sect3" id="idm45941133025592">
<h3>Array utilities</h3>

<p><a data-primary="arrays" data-secondary="utility methods for working with" data-type="indexterm" id="3_idm45941132923544"></a><a data-primary="Arrays class" data-type="indexterm" id="3_idm45941132894760"></a><a data-primary="java.util.Arrays class" data-type="indexterm" id="3_idm45941132894088"></a>The <code>java.util.Arrays</code> class contains a number of static utility
methods for working with arrays. Most of these methods are heavily
overloaded, with versions for arrays of each primitive type and another
version for arrays of objects. The <code>sort()</code> and <code>binarySearch()</code> methods
are particularly useful for sorting and searching arrays. The <code>equals()</code>
method allows you to compare the content of two arrays. The
<code>Arrays.toString()</code> method is useful when you want to convert array
content to a string, such as for debugging or logging output.</p>

<p>The <code>Arrays</code> class also includes <code>deepEquals()</code>, <code>deepHashCode()</code>, and
<code>deepToString()</code> methods that work correctly for multidimensional
arrays.<a data-startref="ix_ch02-asciidoc48" data-type="indexterm" id="3_idm45941132888728"></a></p>
</div></section>



</div></section>













<section data-pdf-bookmark="Multidimensional Arrays" data-type="sect2"><div class="sect2" id="idm45941132887768">
<h2>Multidimensional Arrays</h2>

<p><a data-primary="arrays" data-secondary="multidimensional" data-type="indexterm" id="3_idm45941132885880"></a><a data-primary="multidimensional arrays" data-type="indexterm" id="3_idm45941132884680"></a>As we鈥檝e seen, an array type is written as the element type followed
by a pair of square brackets. An array of <code>char</code> is <code>char[]</code>, and an
array of arrays of <code>char</code> is <code>char[][]</code>. When the elements of an array
are themselves arrays, we say that the array is <em>multidimensional</em>. In
order to work with multidimensional arrays, you need to understand a few
additional details.</p>

<p>Imagine that you want to use a multidimensional array to represent a
multiplication table:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">int</code><code class="o">[][]</code> <code class="n">products</code><code class="o">;</code>      <code class="c1">// A multiplication table</code></pre>

<p>Each of the pairs of square brackets represents one dimension, so this
is a two-dimensional array. To access a single <code>int</code> element of this
two-dimensional array, you must specify two index values, one for each
dimension. Assuming that this array was actually initialized as a
multiplication table, the <code>int</code> value stored at any given element would
be the product of the two indexes. That is, <code>products[2][4]</code> would be 8,
and <code>products[3][7]</code> would be 21.</p>

<p>To create a new multidimensional array, use the <code>new</code> keyword and
specify the size of both dimensions of the array. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">int</code><code class="o">[][]</code> <code class="n">products</code> <code class="o">=</code> <code class="k">new</code> <code class="kt">int</code><code class="o">[</code><code class="mi">10</code><code class="o">][</code><code class="mi">10</code><code class="o">];</code></pre>

<p>In some languages, an array like this would be created as a single block
of 100 <code>int</code> values. Java does not work this way. This line of code does
three things:</p>

<ul>
<li>
<p>Declares a variable named <code>products</code> to hold an array of arrays of
<code>int</code>.</p>
</li>
<li>
<p>Creates a 10-element array to hold 10 arrays of <code>int</code>.</p>
</li>
<li>
<p>Creates 10 more arrays, each of which is a 10-element array of <code>int</code>.
It assigns each of these 10 new arrays to the elements of the initial
array. The default value of every <code>int</code> element of each of these 10 new
arrays is 0.</p>
</li>
</ul>

<p>To put this another way, the previous single line of code is equivalent
to the following code:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">int</code><code class="o">[][]</code> <code class="n">products</code> <code class="o">=</code> <code class="k">new</code> <code class="kt">int</code><code class="o">[</code><code class="mi">10</code><code class="o">][];</code> <code class="c1">// An array to hold 10 int[] values</code>
<code class="k">for</code><code class="o">(</code><code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code> <code class="n">i</code> <code class="o">&lt;</code> <code class="mi">10</code><code class="o">;</code> <code class="n">i</code><code class="o">++)</code>      <code class="c1">// Loop 10 times...</code>
    <code class="n">products</code><code class="o">[</code><code class="n">i</code><code class="o">]</code> <code class="o">=</code> <code class="k">new</code> <code class="kt">int</code><code class="o">[</code><code class="mi">10</code><code class="o">];</code>   <code class="c1">// ...and create 10 arrays</code></pre>

<p><a data-primary="new operator" data-secondary="creating arrays" data-type="indexterm" id="3_idm45941132819400"></a>The <code>new</code> keyword performs this additional initialization automatically
for you. It works with arrays with more than two dimensions as well:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">float</code><code class="o">[][][]</code> <code class="n">globalTemperatureData</code> <code class="o">=</code> <code class="k">new</code> <code class="kt">float</code><code class="o">[</code><code class="mi">360</code><code class="o">][</code><code class="mi">180</code><code class="o">][</code><code class="mi">100</code><code class="o">];</code></pre>

<p>When using <code>new</code> with multidimensional arrays, you do not have to
specify a size for all dimensions of the array, only the leftmost
dimension or dimensions. For example, the following two lines are legal:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">float</code><code class="o">[][][]</code> <code class="n">globalTemperatureData</code> <code class="o">=</code> <code class="k">new</code> <code class="kt">float</code><code class="o">[</code><code class="mi">360</code><code class="o">][][];</code>
<code class="kt">float</code><code class="o">[][][]</code> <code class="n">globalTemperatureData</code> <code class="o">=</code> <code class="k">new</code> <code class="kt">float</code><code class="o">[</code><code class="mi">360</code><code class="o">][</code><code class="mi">180</code><code class="o">][];</code></pre>

<p>The first line creates a single-dimensional array, where each element of
the array can hold a <code>float[][]</code>. The second line creates a
two-dimensional array, where each element of the array is a <code>float[]</code>.
If you specify a size for only some of the dimensions of an array,
however, those dimensions must be the leftmost ones. The following lines
are not legal:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">float</code><code class="o">[][][]</code> <code class="n">globalTemperatureData</code> <code class="o">=</code> <code class="k">new</code> <code class="kt">float</code><code class="o">[</code><code class="mi">360</code><code class="o">][][</code><code class="mi">100</code><code class="o">];</code>  <code class="c1">// Error!</code>
<code class="kt">float</code><code class="o">[][][]</code> <code class="n">globalTemperatureData</code> <code class="o">=</code> <code class="k">new</code> <code class="kt">float</code><code class="o">[][</code><code class="mi">180</code><code class="o">][</code><code class="mi">100</code><code class="o">];</code>  <code class="c1">// Error!</code></pre>

<p>Like a one-dimensional array, a multidimensional array can be
initialized using an array initializer. Simply use nested sets of curly
braces to nest arrays within arrays. For example, we can declare,
create, and initialize a 5 脳 5 multiplication table like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">int</code><code class="o">[][]</code> <code class="n">products</code> <code class="o">=</code> <code class="o">{</code> <code class="o">{</code><code class="mi">0</code><code class="o">,</code> <code class="mi">0</code><code class="o">,</code> <code class="mi">0</code><code class="o">,</code> <code class="mi">0</code><code class="o">,</code> <code class="mi">0</code><code class="o">},</code>
                     <code class="o">{</code><code class="mi">0</code><code class="o">,</code> <code class="mi">1</code><code class="o">,</code> <code class="mi">2</code><code class="o">,</code> <code class="mi">3</code><code class="o">,</code> <code class="mi">4</code><code class="o">},</code>
                     <code class="o">{</code><code class="mi">0</code><code class="o">,</code> <code class="mi">2</code><code class="o">,</code> <code class="mi">4</code><code class="o">,</code> <code class="mi">6</code><code class="o">,</code> <code class="mi">8</code><code class="o">},</code>
                     <code class="o">{</code><code class="mi">0</code><code class="o">,</code> <code class="mi">3</code><code class="o">,</code> <code class="mi">6</code><code class="o">,</code> <code class="mi">9</code><code class="o">,</code> <code class="mi">12</code><code class="o">},</code>
                     <code class="o">{</code><code class="mi">0</code><code class="o">,</code> <code class="mi">4</code><code class="o">,</code> <code class="mi">8</code><code class="o">,</code> <code class="mi">12</code><code class="o">,</code> <code class="mi">16</code><code class="o">}</code> <code class="o">};</code></pre>

<p>Or, if you want to use a multidimensional array without declaring a
variable, you can use the anonymous initializer syntax:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">boolean</code> <code class="n">response</code> <code class="o">=</code> <code class="n">bilingualQuestion</code><code class="o">(</code><code class="n">question</code><code class="o">,</code> <code class="k">new</code> <code class="n">String</code><code class="o">[][]</code> <code class="o">{</code>
                                                   <code class="o">{</code> <code class="s">Yes</code><code class="o">,</code> <code class="s">No</code> <code class="o">},</code>
                                                   <code class="o">{</code> <code class="s">Oui</code><code class="o">,</code> <code class="s">Non</code> <code class="o">}});</code></pre>

<p><a data-primary="rectangular arrays" data-type="indexterm" id="3_idm45941132514296"></a>When you create a multidimensional array using the <code>new</code> keyword, it is
usually good practice to only use <em>rectangular</em> arrays: one in which
all the array values for a given dimension have the same size.<a data-startref="ix_ch02-asciidoc44" data-type="indexterm" id="3_idm45941132502840"></a><a data-startref="ix_ch02-asciidoc43" data-type="indexterm" id="3_idm45941132502168"></a><a data-startref="ix_ch02-asciidoc42" data-type="indexterm" id="3_idm45941132501496"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Reference Types" data-type="sect1"><div class="sect1" id="javanut7-CHP-2-SECT-9">
<h1>Reference Types</h1>

<p><a data-primary="data types" data-secondary="reference" data-type="indexterm" id="3_ix_ch02-asciidoc49"></a><a data-primary="reference types" data-type="indexterm" id="3_ix_ch02-asciidoc50"></a><a data-primary="syntax, Java" data-secondary="reference types" data-type="indexterm" id="3_ix_ch02-asciidoc51"></a>Now that we鈥檝e covered arrays and introduced classes and objects, we
can turn to a more general description of <em>reference types</em>. Classes and
arrays are two of Java鈥檚 five kinds of reference types. Classes were
introduced earlier and are covered in complete detail, along with
<em>interfaces</em>, in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3">Chapter 3</a>. Enumerated types and
annotation types are reference types introduced in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4">Chapter 4</a>.</p>

<p>This section does not cover specific syntax for any particular reference
type, but instead explains the general behavior of reference types and
illustrates how they differ from Java鈥檚 primitive types. In this
section, the term <em>object</em> refers to a value or instance of any
reference type, including arrays.</p>








<section data-pdf-bookmark="Reference Versus Primitive Types" data-type="sect2"><div class="sect2" id="idm45941132483848">
<h2>Reference Versus Primitive Types</h2>

<p><a data-primary="primitive types" data-secondary="reference types vs." data-type="indexterm" id="3_idm45941132482440"></a><a data-primary="reference types" data-secondary="primitive types vs." data-type="indexterm" id="3_idm45941132481464"></a>Reference types and objects differ substantially from primitive types
and their primitive values:</p>

<ul>
<li>
<p>Eight primitive types are defined by the Java language, and the
programmer cannot define new primitive types. Reference types are
user-defined, so there is an unlimited number of them. For example, a
program might define a class named <code>Point</code> and use objects of this newly
defined type to store and manipulate <em>x,y</em> points in a Cartesian
coordinate system.</p>
</li>
<li>
<p>Primitive types represent single values. Reference types are aggregate
types that hold zero or more primitive values or objects. Our
hypothetical <code>Point</code> class, for example, might hold two <code>double</code> values
to represent the <em>x</em> and <em>y</em> coordinates of the points. The <code>char[]</code> and
<code>Point[]</code> array types are aggregate types because they hold a sequence
of primitive <code>char</code> values or <code>Point</code> objects.</p>
</li>
<li>
<p><a data-primary="memory, primitive and reference types requirements" data-type="indexterm" id="3_idm45941132472856"></a><a data-primary="objects" data-secondary="memory requirements for storing" data-type="indexterm" id="3_idm45941132472120"></a>Primitive types require between one and eight bytes of memory. When a
primitive value is stored in a variable or passed to a method, the
computer makes a copy of the bytes that hold the value. Objects, on the
other hand, may require substantially more memory. Memory to store an
object is dynamically allocated on the heap when the object is created
and this memory is automatically 鈥済arbage collected鈥?when the object is
no longer needed.</p>
</li>
</ul>
<div data-type="tip"><h6>Tip</h6>
<p>When an object is assigned to a variable or passed to a method, the
memory that represents the object is not copied. Instead, only a
reference to that memory is stored in the variable or passed to the
method.</p>
</div>

<p>References are completely opaque in Java and the representation of a
reference is an implementation detail of the Java runtime. If you are a
C programmer, however, you can safely imagine a reference as a pointer
or a memory address. Remember, though, that Java programs cannot
manipulate references in any way.</p>

<p><a data-primary="C/C++" data-secondary="pointers or memory addresses, references as" data-type="indexterm" id="3_idm45941132425256"></a><a data-primary="reference types" data-secondary="pointers in C/C++ vs." data-type="indexterm" id="3_idm45941132424408"></a>Unlike pointers in C and C++, references cannot be converted to or from
integers, and they cannot be incremented or decremented. C and C++
programmers should also note that Java does not support the <code>&amp;</code>
address-of operator or the <code>*</code> and <code>-&gt;</code> dereference operators.</p>
</div></section>













<section data-pdf-bookmark="Manipulating Objects and Reference Copies" data-type="sect2"><div class="sect2" id="idm45941132421816">
<h2>Manipulating Objects and Reference Copies</h2>

<p><a data-primary="objects" data-secondary="manipulating" data-type="indexterm" id="3_idm45941132420312"></a><a data-primary="reference types" data-secondary="manipulating objects and reference copies" data-type="indexterm" id="3_idm45941132419336"></a>The following code manipulates a primitive <code>int</code> value:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">int</code> <code class="n">x</code> <code class="o">=</code> <code class="mi">42</code><code class="o">;</code>
<code class="kt">int</code> <code class="n">y</code> <code class="o">=</code> <code class="n">x</code><code class="o">;</code></pre>

<p>After these lines execute, the variable <code>y</code> contains a copy of the value
held in the variable <code>x</code>. Inside the Java VM, there are two independent
copies of the 32-bit integer 42.</p>

<p>Now think about what happens if we run the same basic code but use a
reference type instead of a primitive type:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Point</code> <code class="n">p</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Point</code><code class="o">(</code><code class="mf">1.0</code><code class="o">,</code> <code class="mf">2.0</code><code class="o">);</code>
<code class="n">Point</code> <code class="n">q</code> <code class="o">=</code> <code class="n">p</code><code class="o">;</code></pre>

<p>After this code runs, the variable <code>q</code> holds a copy of the reference
held in the variable <code>p</code>. There is still only one copy of the <code>Point</code>
object in the VM, but there are now two copies of the reference to that
object. This has some important implications. Suppose the two previous
lines of code are followed by this code:</p>

<pre class="pre " data-code-language="java" data-type="programlisting"><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">p</code><code class="o">.</code><code class="na">x</code><code class="o">);</code>  <code class="c1">// Print out the x coordinate of p: 1.0</code>
<code class="n">q</code><code class="o">.</code><code class="na">x</code> <code class="o">=</code> <code class="mf">13.0</code><code class="o">;</code>               <code class="c1">// Now change the X coordinate of q</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">p</code><code class="o">.</code><code class="na">x</code><code class="o">);</code>  <code class="c1">// Print out p.x again; this time it is 13.0</code></pre>

<p>Because the variables <code>p</code> and <code>q</code> hold references to the same object,
either variable can be used to make changes to the object, and those
changes are visible through the other variable as well. As arrays are a
kind of object, the same thing happens with arrays, as illustrated
by the following code:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// greet holds an array reference</code>
<code class="kt">char</code><code class="o">[]</code> <code class="n">greet</code> <code class="o">=</code> <code class="o">{</code> <code class="sc">h</code><code class="o">,</code><code class="sc">e</code><code class="o">,</code><code class="sc">l</code><code class="o">,</code><code class="sc">l</code><code class="o">,</code><code class="sc">o</code> <code class="o">};</code>
<code class="kt">char</code><code class="o">[]</code> <code class="n">cuss</code> <code class="o">=</code> <code class="n">greet</code><code class="o">;</code>             <code class="c1">// cuss holds the same reference</code>
<code class="n">cuss</code><code class="o">[</code><code class="mi">4</code><code class="o">]</code> <code class="o">=</code> <code class="sc">!</code><code class="o">;</code>                   <code class="c1">// Use reference to change an element</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">greet</code><code class="o">);</code>       <code class="c1">// Prints &quot;hell!&quot;</code></pre>

<p>A similar difference in behavior between primitive types and reference
types occurs when arguments are passed to methods. Consider the
following method:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">void</code> <code class="nf">changePrimitive</code><code class="o">(</code><code class="kt">int</code> <code class="n">x</code><code class="o">)</code> <code class="o">{</code>
    <code class="k">while</code><code class="o">(</code><code class="n">x</code> <code class="o">&gt;</code> <code class="mi">0</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">x</code><code class="o">--);</code>
    <code class="o">}</code>
<code class="o">}</code></pre>

<p><a data-primary="methods" data-secondary="arguments passed to, primitive and reference types" data-type="indexterm" id="3_idm45941132171368"></a>When this method is invoked, the method is given a copy of the argument
used to invoke the method in the parameter <code>x</code>. The code in the method
uses <code>x</code> as a loop counter and decrements it to zero. Because <code>x</code> is a
primitive type, the method has its own private copy of this value, so
this is a perfectly reasonable thing to do.</p>

<p>On the other hand, consider what happens if we modify the method so that
the parameter is a reference type:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">void</code> <code class="nf">changeReference</code><code class="o">(</code><code class="n">Point</code> <code class="n">p</code><code class="o">)</code> <code class="o">{</code>
    <code class="k">while</code><code class="o">(</code><code class="n">p</code><code class="o">.</code><code class="na">x</code> <code class="o">&gt;</code> <code class="mi">0</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">p</code><code class="o">.</code><code class="na">x</code><code class="o">--);</code>
    <code class="o">}</code>
<code class="o">}</code></pre>

<p>When this method is invoked, it is passed a private copy of a reference
to a <code>Point</code> object and can use this reference to change the <code>Point</code>
object. For example, consider the following:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Point</code> <code class="n">q</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Point</code><code class="o">(</code><code class="mf">3.0</code><code class="o">,</code> <code class="mf">4.5</code><code class="o">);</code>  <code class="c1">// A point with an x coordinate of 3</code>
<code class="n">changeReference</code><code class="o">(</code><code class="n">q</code><code class="o">);</code>             <code class="c1">// Prints 3,2,1 and modifies the Point</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">q</code><code class="o">.</code><code class="na">x</code><code class="o">);</code>        <code class="c1">// The x coordinate of q is now 0!</code></pre>

<p>When the <code>changeReference()</code> method is invoked, it is passed a copy of
the reference held in variable <code>q</code>. Now both the variable <code>q</code> and the
method parameter <code>p</code> hold references to the same object. The method can
use its reference to change the contents of the object. Note, however,
that it cannot change the contents of the variable <code>q</code>. In other words,
the method can change the <code>Point</code> object beyond recognition, but it
cannot change the fact that the variable <code>q</code> refers to that object.</p>
</div></section>













<section data-pdf-bookmark="Comparing Objects" data-type="sect2"><div class="sect2" id="idm45941132421160">
<h2>Comparing Objects</h2>

<p><a data-primary="objects" data-secondary="comparing" data-type="indexterm" id="3_idm45941132075736"></a><a data-primary="primitive types" data-secondary="reference types vs." data-type="indexterm" id="3_idm45941132074760"></a><a data-primary="reference types" data-secondary="comparing objects" data-type="indexterm" id="3_idm45941132073816"></a>We鈥檝e seen that primitive types and reference types differ
significantly in the way they are assigned to variables, passed to
methods, and copied. The types also differ in the way they are compared
for equality. When used with primitive values, the equality operator
(<code>==</code>) simply tests whether two values are identical (i.e., whether
they have exactly the same bits). With reference types, however, <code>==</code>
compares references, not actual objects. In other words, <code>==</code> tests
whether two references refer to the same object; it does not test
whether two objects have the same content. Here鈥檚 an example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">String</code> <code class="n">letter</code> <code class="o">=</code> <code class="s">o</code><code class="o">;</code>
<code class="n">String</code> <code class="n">s</code> <code class="o">=</code> <code class="s">hello</code><code class="o">;</code>              <code class="c1">// These two String objects</code>
<code class="n">String</code> <code class="n">t</code> <code class="o">=</code> <code class="s">hell</code> <code class="o">+</code> <code class="n">letter</code><code class="o">;</code>      <code class="c1">// contain exactly the same text.</code>
<code class="k">if</code> <code class="o">(</code><code class="n">s</code> <code class="o">==</code> <code class="n">t</code><code class="o">)</code> <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">equal</code><code class="o">);</code> <code class="c1">// But they are not equal!</code>

<code class="kt">byte</code><code class="o">[]</code> <code class="n">a</code> <code class="o">=</code> <code class="o">{</code> <code class="mi">1</code><code class="o">,</code> <code class="mi">2</code><code class="o">,</code> <code class="mi">3</code> <code class="o">};</code>
<code class="c1">// A copy with identical content.</code>
<code class="kt">byte</code><code class="o">[]</code> <code class="n">b</code> <code class="o">=</code> <code class="o">(</code><code class="kt">byte</code><code class="o">[])</code> <code class="n">a</code><code class="o">.</code><code class="na">clone</code><code class="o">();</code>
<code class="k">if</code> <code class="o">(</code><code class="n">a</code> <code class="o">==</code> <code class="n">b</code><code class="o">)</code> <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">equal</code><code class="o">);</code> <code class="c1">// But they are not equal!</code></pre>

<p>When working with reference types, keep in mind there are two kinds of equality:
equality of reference and equality of object. It is important to
distinguish between these two kinds of equality. One way to do this is
to use the word 鈥渋dentical鈥?when talking about equality of references
and the word 鈥渆qual鈥?when talking about two distinct objects that have
the same content. To test two nonidentical objects for equality, pass
one of them to the <code>equals()</code> method of the other:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">String</code> <code class="n">letter</code> <code class="o">=</code> <code class="s">o</code><code class="o">;</code>
<code class="n">String</code> <code class="n">s</code> <code class="o">=</code> <code class="s">hello</code><code class="o">;</code>              <code class="c1">// These two String objects</code>
<code class="n">String</code> <code class="n">t</code> <code class="o">=</code> <code class="s">hell</code> <code class="o">+</code> <code class="n">letter</code><code class="o">;</code>      <code class="c1">// contain exactly the same text.</code>
<code class="k">if</code> <code class="o">(</code><code class="n">s</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">t</code><code class="o">))</code> <code class="o">{</code>               <code class="c1">// And the equals() method</code>
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">equal</code><code class="o">);</code> <code class="c1">// tells us so.</code>
<code class="o">}</code></pre>

<p><a data-primary="= (equals sign)" data-secondary="== (equal to) operator" data-type="indexterm" id="3_idm45941131857368"></a><a data-primary="equality operator (==)" data-secondary="comparing reference types" data-type="indexterm" id="3_idm45941131841224"></a><a data-primary="equals()" data-secondary="testing two nonidentical objects for equality" data-type="indexterm" id="3_idm45941131840344"></a>All objects inherit an <code>equals()</code> method (from <code>Object</code>), but the
default implementation simply uses <code>==</code> to test for identity of
references, not equality of content. A class that wants to allow objects
to be compared for equality can define its own version of the <code>equals()</code>
method. Our <code>Point</code> class does not do this, but the <code>String</code> class does,
as indicated in the code example. <a data-primary="equals()" data-secondary="Arrays class" data-type="indexterm" id="3_idm45941131921608"></a>You can call the <code>equals()</code> method on
an array, but it is the same as using the <code>==</code> operator, because arrays
always inherit the default <code>equals()</code> method that compares references
rather than array content. You can compare arrays for equality with the <code>java.util.Arrays.equals()</code> convenience method.</p>
</div></section>













<section data-pdf-bookmark="Boxing and Unboxing Conversions" data-type="sect2"><div class="sect2" id="javanut7-CHP-2-SECT-9.4">
<h2>Boxing and Unboxing Conversions</h2>

<p><a data-primary="boxing and unboxing conversions" data-type="indexterm" id="3_idm45941131917032"></a><a data-primary="boxing conversions" data-type="indexterm" id="3_idm45941131915960"></a><a data-primary="conversions" data-secondary="boxing/unboxing" data-type="indexterm" id="3_idm45941131915288"></a><a data-primary="data types" data-secondary="boxing and unboxing conversions" data-type="indexterm" id="3_idm45941131914344"></a><a data-primary="primitive types" data-secondary="boxing and unboxing conversions" data-type="indexterm" id="3_idm45941131913384"></a><a data-primary="reference types" data-secondary="boxing and unboxing conversions" data-type="indexterm" id="3_idm45941131912424"></a><a data-primary="reference types" data-secondary="boxing/unboxing conversions" data-type="indexterm" id="3_idm45941131911464"></a><a data-primary="unboxing conversions" data-type="indexterm" id="3_idm45941131910504"></a>Primitive types and reference types behave quite differently. It is
sometimes useful to treat primitive values as objects, and for this
reason, <a data-primary="primitive types" data-secondary="wrapper classes" data-type="indexterm" id="3_idm45941131909544"></a><a data-primary="wrapper classes" data-type="indexterm" id="3_idm45941131908600"></a>the Java platform includes <em>wrapper classes</em> for each of the primitive types. <code>Boolean</code>, <code>Byte</code>, <code>Short</code>, <code>Character</code>, <code>Integer</code>,
<code>Long</code>, <code>Float</code>, and <code>Double</code> are immutable, final classes whose
instances each hold a single primitive value. These wrapper classes are
usually used when you want to store primitive values in collections
such as <code>java.util.List</code>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Create a List-of-Integer collection</code>
<code class="n">List</code><code class="o">&lt;</code><code class="n">Integer</code><code class="o">&gt;</code> <code class="n">numbers</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;&gt;();</code>
<code class="c1">// Store a wrapped primitive</code>
<code class="n">numbers</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="k">new</code> <code class="n">Integer</code><code class="o">(-</code><code class="mi">1</code><code class="o">));</code>
<code class="c1">// Extract the primitive value</code>
<code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="n">numbers</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="mi">0</code><code class="o">).</code><code class="na">intValue</code><code class="o">();</code></pre>

<p>Java allows types of conversions known as boxing and unboxing conversions. Boxing conversions convert a primitive value to its
corresponding wrapper object and unboxing conversions do the opposite. You may explicitly specify a boxing or unboxing conversion with a cast,
but this is unnecessary, as these conversions are automatically
performed when you assign a value to a variable or pass a value to a
method. <a data-primary="autoboxing" data-type="indexterm" id="3_idm45941131786856"></a>Furthermore, unboxing conversions are also automatic if you use
a wrapper object when a Java operator or statement expects a primitive
value. Because Java performs boxing and unboxing automatically, this
language feature is often known as <em>autoboxing</em>.</p>

<p>Here are some examples of automatic boxing and unboxing conversions:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Integer</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code>   <code class="c1">// int literal 0 boxed to an Integer object</code>
<code class="n">Number</code> <code class="n">n</code> <code class="o">=</code> <code class="mf">0.0f</code><code class="o">;</code> <code class="c1">// float literal boxed to Float and widened to Number</code>
<code class="n">Integer</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">1</code><code class="o">;</code>   <code class="c1">// this is a boxing conversion</code>
<code class="kt">int</code> <code class="n">j</code> <code class="o">=</code> <code class="n">i</code><code class="o">;</code>       <code class="c1">// i is unboxed here</code>
<code class="n">i</code><code class="o">++;</code>             <code class="c1">// i is unboxed, incremented, and then boxed up again</code>
<code class="n">Integer</code> <code class="n">k</code> <code class="o">=</code> <code class="n">i</code><code class="o">+</code><code class="mi">2</code><code class="o">;</code> <code class="c1">// i is unboxed and the sum is boxed up again</code>
<code class="n">i</code> <code class="o">=</code> <code class="kc">null</code><code class="o">;</code>
<code class="n">j</code> <code class="o">=</code> <code class="n">i</code><code class="o">;</code>           <code class="c1">// unboxing here throws a NullPointerException</code></pre>

<p>Autoboxing makes dealing with collections much easier as well. Let鈥檚
look at an example that uses Java鈥檚 <em>generics</em> (a language feature we鈥檒l
meet properly in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4-SECT-2">鈥淛ava Generics鈥?/a&gt;) that allows
us to restrict what types can be put into lists and other collections:<a data-startref="ix_ch02-asciidoc51" data-type="indexterm" id="3_idm45941131724136"></a><a data-startref="ix_ch02-asciidoc50" data-type="indexterm" id="3_idm45941131723496"></a><a data-startref="ix_ch02-asciidoc49" data-type="indexterm" id="3_idm45941131722824"></a></p>

<pre data-code-language="java" data-type="programlisting"><code class="n">List</code><code class="o">&lt;</code><code class="n">Integer</code><code class="o">&gt;</code> <code class="n">numbers</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;&gt;();</code> <code class="c1">// Create a List of Integer</code>
<code class="n">numbers</code><code class="o">.</code><code class="na">add</code><code class="o">(-</code><code class="mi">1</code><code class="o">);</code>                           <code class="c1">// Box int to Integer</code>
<code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="n">numbers</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="mi">0</code><code class="o">);</code>                    <code class="c1">// Unbox Integer to int</code></pre>
</div></section>





</div></section>













<section data-pdf-bookmark="Packages and the Java Namespace" data-type="sect1"><div class="sect1" id="javanut7-CHP-2-SECT-10">
<h1>Packages and the Java Namespace</h1>

<p><a data-primary="packages" data-type="indexterm" id="3_ix_ch02-asciidoc52"></a><a data-primary="syntax, Java" data-secondary="packages" data-type="indexterm" id="3_ix_ch02-asciidoc53"></a><a data-primary="syntax, Java" data-secondary="packages and the Java namespace" data-type="indexterm" id="3_ix_ch02-asciidoc54"></a>A <em>package</em> is a named collection of classes, interfaces, and other
reference types. Packages serve to group related classes and define a
namespace for the classes they contain.</p>

<p><a data-primary="class(es)" data-secondary="core classes of Java platform" data-type="indexterm" id="3_idm45941131641048"></a>The core classes of the Java platform are in packages whose names
begin with <code>java</code>. For example, the most fundamental classes of the
language are in the package <code>java.lang</code>. Various utility classes are in
<code>java.util</code>. Classes for input and output are in <code>java.io</code>, and classes
for networking are in <code>java.net</code>. Some of these packages contain
subpackages, such as <code>java.lang.reflect</code> and <code>java.util.regex</code>.
<a data-primary="extensions, standard" data-type="indexterm" id="3_idm45941131636568"></a><a data-primary="javax., package names beginning with" data-type="indexterm" id="3_idm45941131635832"></a>Extensions to the Java platform that have been standardized by Oracle
(or originally Sun) typically have package names that begin with
<code>javax</code>. Some of these extensions, such as <code>javax.swing</code> and its myriad
subpackages, were later adopted into the core platform itself. <a data-primary="standards bodies, packages named for" data-type="indexterm" id="3_idm45941131634024"></a>Finally,
the Java platform also includes several 鈥渆ndorsed standards,鈥?which have
packages named after the standards body that created them, such as
<code>org.w3c</code> and <code>org.omg</code>.</p>

<p>Every class has both a simple name, which is the name given to it in its
definition, and a fully qualified name, which includes the name of the
package of which it is a part. <a data-primary="strings" data-secondary="String class" data-type="indexterm" id="3_idm45941131631800"></a>The <code>String</code> class, for example, is part
of the <code>java.lang</code> package, so its fully qualified name is
<code>java.lang.String</code>.</p>

<p>This section explains how to place your own classes and interfaces into
a package and how to choose a package name that won鈥檛 conflict with
anyone else鈥檚 package name. Next, it explains how to selectively import
type names or static members into the namespace so that you don鈥檛 have
to type the package name of every class or interface you use.</p>








<section data-pdf-bookmark="Package Declaration" data-type="sect2"><div class="sect2" id="idm45941131698008">
<h2>Package Declaration</h2>

<p><a data-primary="packages" data-secondary="declarations" data-type="indexterm" id="3_idm45941131696568"></a>To specify the package a class is to be part of, you use a <code>package</code>
declaration. <a data-primary="package keyword" data-type="indexterm" id="3_idm45941131695080"></a>The <code>package</code> keyword, if it appears, must be the first
token of Java code (i.e., the first thing other than comments and space)
in the Java file. The keyword should be <span class="keep-together">followed</span> by the name of the
desired package and a semicolon. Consider a Java file that begins with
this directive:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kn">package</code> <code class="n">org</code><code class="o">.</code><code class="na">apache</code><code class="o">.</code><code class="na">commons</code><code class="o">.</code><code class="na">net</code><code class="o">;</code></pre>

<p>All classes defined by this file are part of the package
<code>org.apache.commons.net</code>.</p>

<p>If no <code>package</code> directive appears in a Java file, all classes defined in
that file are part of an unnamed default package. In this case, the
qualified and unqualified names of a class are the same.</p>
<div data-type="tip"><h6>Tip</h6>
<p>The possibility of naming conflicts means that you should not use the
default package. As your project grows more complicated, conflicts
become almost inevitable鈥攎uch better to create packages right from the
start.</p>
</div>
</div></section>













<section data-pdf-bookmark="Globally Unique Package Names" data-type="sect2"><div class="sect2" id="idm45941131602696">
<h2>Globally Unique Package Names</h2>

<p><a data-primary="class(es)" data-secondary="name collisions, preventing" data-type="indexterm" id="3_idm45941131601528"></a><a data-primary="names" data-secondary="package-naming rules" data-type="indexterm" id="3_idm45941131600360"></a><a data-primary="namespaces" data-secondary="globally unique package names" data-type="indexterm" id="3_idm45941131599416"></a><a data-primary="packages" data-secondary="globally unique names" data-type="indexterm" id="3_idm45941131598504"></a>One of the important functions of packages is to partition the Java
namespace and prevent name collisions between classes. <a data-primary="lists" data-secondary="java.util.List and java.awt.List classes" data-type="indexterm" id="3_idm45941131590184"></a><a data-primary="lists" data-secondary="storing primitive values in" data-type="indexterm" id="3_idm45941131589272"></a>It is only
their package names that keep the <code>java.util.List</code> and <code>java.awt.List</code>
classes distinct, for example. In order for this to work, however,
package names must themselves be distinct. <a data-primary="Oracle Corporation" data-secondary="control of package names beginning with java, javax, and sun" data-type="indexterm" id="3_idm45941131587272"></a>As the developer of Java,
Oracle controls all package names that begin with <code>java</code>, <code>javax</code>, and
<code>sun</code>.</p>

<p><a data-primary="domain names in package names" data-type="indexterm" id="3_idm45941131584728"></a>One common scheme is to use your domain name, with its elements
reversed, as the prefix for all your package names. <a data-primary="Apache Commons project" data-type="indexterm" id="3_idm45941131583800"></a>For example, the
Apache Project produces a networking library as part of the Apache
Commons project. The Commons project can be found at
<a href="http://commons.apache.org/"><em>http://commons.apache.org/</em></a> and
accordingly, the package name used for the networking library is
<code>org.apache.commons.net</code>.</p>

<p>Note that these package-naming rules apply primarily to API developers.
If other programmers will be using classes that you develop along with
unknown other classes, it is important that your package name be
globally unique. On the other hand, if you are developing a Java
application and will not be releasing any of the classes for reuse by
others, you know the complete set of classes that your application will
be deployed with and do not have to worry about unforeseen naming
conflicts. In this case, you can choose a package naming scheme for your
own convenience rather than for global uniqueness. One common approach
is to use the application name as the main package name (it may have
subpackages beneath it).</p>
</div></section>













<section data-pdf-bookmark="Importing Types" data-type="sect2"><div class="sect2" id="idm45941131580264">
<h2>Importing Types</h2>

<p><a data-primary="class(es)" data-secondary="names, simple and fully qualified" data-type="indexterm" id="3_idm45941131578664"></a><a data-primary="packages" data-secondary="importing types" data-type="indexterm" id="3_idm45941131577512"></a>When referring to a class or interface in your Java code, you must,
by default, use the fully qualified name of the type, including the
package name. <a data-primary="File class" data-type="indexterm" id="3_idm45941131576280"></a>If you鈥檙e writing code to manipulate a file and need to
use the <code>File</code> class of the <code>java.io</code> package, you must type
<code>java.io.File</code>. This rule has three exceptions:</p>

<ul>
<li>
<p>Types from the package <code>java.lang</code> are so important and so commonly
used that they can always be referred to by their simple names.</p>
</li>
<li>
<p>The code in a type <code>p.T</code> may refer to other types defined in the
package <code>p</code> by their simple names.</p>
</li>
<li>
<p><a data-primary="import declarations" data-type="indexterm" id="3_idm45941131552648"></a><a data-primary="namespaces" data-secondary="importing types" data-type="indexterm" id="3_idm45941131551944"></a>Types that have been <em>imported</em> into the namespace with an <code>import</code>
declaration may be referred to by their simple names.</p>
</li>
</ul>

<p><a data-primary="automatic imports" data-type="indexterm" id="3_idm45941131549432"></a><a data-primary="java.lang package" data-type="indexterm" id="3_idm45941131548728"></a>The first two exceptions are known as 鈥渁utomatic imports.鈥?The types
from <code>java.lang</code> and the current package are 鈥渋mported鈥?into the
namespace so that they can be used without their package name. Typing
the package name of commonly used types that are not in <code>java.lang</code> or
the current package quickly becomes tedious, and so it is also possible
to explicitly import types from other packages into the namespace. This
is done with the <code>import</code> declaration.</p>

<p><code>import</code> declarations must appear at the start of a Java file,
immediately after the <code>package</code> declaration, if there is one, and before
any type definitions. You may use any number of <code>import</code> declarations in
a file. An <code>import</code> declaration applies to all type definitions in the
file (but not to any <code>import</code> declarations that follow it).</p>

<p>The <code>import</code> declaration has two forms. <a data-primary="import declarations" data-secondary="single type imports" data-type="indexterm" id="3_idm45941131542728"></a>To import a single type into the
namespace, follow the <code>import</code> keyword with the name of the type and a
semicolon:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kn">import</code> <code class="nn">java.io.File</code><code class="o">;</code>    <code class="c1">// Now we can type File instead of java.io.File</code></pre>

<p>This is known as the 鈥渟ingle type <code>import</code>&quot; declaration.</p>

<p><a data-primary="import declarations" data-secondary="on-demand imports" data-type="indexterm" id="3_idm45941131536808"></a>The other form of <code>import</code> declaration is the 鈥渙n-demand type <code>import</code>.鈥?In this form,
you specify the name of a package followed by the characters <code>.*</code> to indicate that any type from that package may be used without its package
name. Thus, if you want to use several other classes from the <code>java.io</code>
package in addition to the <code>File</code> class, you can simply import the
entire package:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kn">import</code> <code class="nn">java.io.*</code><code class="o">;</code>   <code class="c1">// Use simple names for all classes in java.io</code></pre>

<p>This on-demand <code>import</code> syntax does not apply to subpackages. If I
import the <code>java.util</code> package, I must still refer to the
<code>java.util.zip.ZipInputStream</code> class by its fully qualified name.</p>

<p>Using an on-demand type <code>import</code> declaration is not the same as explicitly
writing out a single type <code>import</code> declaration for every type in the
package. It is more like an explicit single type <code>import</code> for every type
in the package <em>that you actually use</em> in your code. This is the reason
it鈥檚 called 鈥渙n demand鈥? types are imported as you use them.</p>










<section data-pdf-bookmark="Naming conflicts and shadowing" data-type="sect3"><div class="sect3" id="idm45941131521608">
<h3>Naming conflicts and shadowing</h3>

<p><a data-primary="import declarations" data-secondary="naming conflicts and shadowing" data-type="indexterm" id="3_idm45941131519992"></a><a data-primary="naming conflicts" data-type="indexterm" id="3_idm45941131518840"></a><a data-primary="packages" data-secondary="naming conflicts and shadowing" data-type="indexterm" id="3_idm45941131518168"></a><code>import</code> declarations are invaluable to Java programming. They do
expose us to the possibility of naming conflicts, however. <a data-primary="java.awt.List" data-type="indexterm" id="3_idm45941131516696"></a><a data-primary="java.util.List" data-type="indexterm" id="3_idm45941131515992"></a><a data-primary="lists" data-secondary="java.util.List and java.awt.List classes" data-type="indexterm" id="3_idm45941131494024"></a>Consider the
packages <code>java.util</code> and <code>java.awt</code>. Both contain types named <code>List</code>.</p>

<p><code>java.util.List</code> is an important and commonly used interface. The
<code>java.awt</code> package contains a number of important types that are
commonly used in client-side applications, but <code>java.awt.List</code> has been
superseded and is not one of these important types. It is illegal to
import both <code>java.util.List</code> and <code>java.awt.List</code> in the same Java file.
The following single type <code>import</code> declarations produce a compilation
error:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kn">import</code> <code class="nn">java.util.List</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">java.awt.List</code><code class="o">;</code></pre>

<p>Using on-demand type imports for the two packages is legal:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kn">import</code> <code class="nn">java.util.*</code><code class="o">;</code>  <code class="c1">// For collections and other utilities.</code>
<code class="kn">import</code> <code class="nn">java.awt.*</code><code class="o">;</code>   <code class="c1">// For fonts, colors, and graphics.</code></pre>

<p>Difficulty arises, however, if you actually try to use the type <code>List</code>.
This type can be imported 鈥渙n demand鈥?from either package, and any
attempt to use <code>List</code> as an unqualified type name produces a compilation
error. The workaround, in this case, is to explicitly specify the
package name you want.</p>

<p>Because <code>java.util.List</code> is much more commonly used than
<code>java.awt.List</code>, it is useful to combine the two on-demand type <code>import</code>
declarations with a single type <code>import</code> declaration that serves to
disambiguate what we mean when we say <code>List</code>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kn">import</code> <code class="nn">java.util.*</code><code class="o">;</code>    <code class="c1">// For collections and other utilities.</code>
<code class="kn">import</code> <code class="nn">java.awt.*</code><code class="o">;</code>     <code class="c1">// For fonts, colors, and graphics.</code>
<code class="kn">import</code> <code class="nn">java.util.List</code><code class="o">;</code> <code class="c1">// To disambiguate from java.awt.List</code></pre>

<p>With these <code>import</code> declarations in place, we can use <code>List</code> to mean the
<code>java.util.List</code> interface. If we actually need to use the
<code>java.awt.List</code> class, we can still do so as long as we include its
package name. There are no other naming conflicts between <code>java.util</code>
and <code>java.awt</code>, and their types will be imported 鈥渙n demand鈥?when we use
them without a package name.</p>
</div></section>



</div></section>













<section data-pdf-bookmark="Importing Static Members" data-type="sect2"><div class="sect2" id="idm45941131579768">
<h2>Importing Static Members</h2>

<p><a data-primary="import static declarations" data-type="indexterm" id="3_idm45941131389624"></a><a data-primary="packages" data-secondary="importing static members" data-type="indexterm" id="3_idm45941131388552"></a><a data-primary="static import declarations" data-type="indexterm" id="3_idm45941131387592"></a><a data-primary="static members" data-type="indexterm" id="3_idm45941131386904"></a><a data-primary="types" data-secondary="importing static members" data-type="indexterm" id="3_idm45941131386232"></a>As well as types, you can import the static members of types using
the keywords <code>import static</code>. (Static members are explained in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3">Chapter 3</a>. If you are not already familiar with
them, you may want to come back to this section later.) Like type <code>import</code>
declarations, these static <code>import</code> declarations come in two forms:
single static member <code>import</code> and on-demand static member <code>import</code>. Suppose,
for example, that you are writing a text-based program that sends a lot
of output to <code>System.out</code>. In this case, you might use this single
static member <code>import</code> to save yourself typing:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kn">import</code> <code class="nn">static</code> <code class="n">java</code><code class="o">.</code><code class="na">lang</code><code class="o">.</code><code class="na">System</code><code class="o">.</code><code class="na">out</code><code class="o">;</code></pre>

<p><a data-primary="println()" data-secondary="out.println() instead of System.out.println()" data-type="indexterm" id="3_idm45941131374392"></a><a data-primary="System.out.println()" data-type="indexterm" id="3_idm45941131373544"></a>You can then use <code>out.println()</code> instead of
<code>System.out.println()</code>. <a data-primary="Math class" data-secondary="on-demand static import" data-type="indexterm" id="3_idm45941131371944"></a>Or suppose you are writing a program that uses
many of the trigonometric and other functions of the <code>Math</code> class. In a
program that is clearly focused on numerical methods like this, having
to repeatedly type the class name 鈥淢ath鈥?does not add clarity to your
code; it just gets in the way. In this case, an on-demand static member
<code>import</code> may be appropriate:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kn">import</code> <code class="nn">static</code> <code class="n">java</code><code class="o">.</code><code class="na">lang</code><code class="o">.</code><code class="na">Math</code><code class="o">.*</code></pre>

<p>With this <code>import</code> declaration, you are free to write concise expressions
like <code>sqrt(abs(sin(x)))</code> without having to prefix the name of each
static method with the class name <code>Math</code>.</p>

<p><a data-primary="constants" data-secondary="importing into code" data-type="indexterm" id="3_idm45941131342856"></a>Another important use of <code>import static</code> declarations is to import the
names of constants into your code. This works particularly well with
enumerated types (see <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4">Chapter 4</a>). Suppose, for
example, that you want to use the values of this enumerated type in code
you are writing:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kn">package</code> <code class="n">climate</code><code class="o">.</code><code class="na">temperate</code><code class="o">;</code>
<code class="kd">enum</code> <code class="n">Seasons</code> <code class="o">{</code> <code class="n">WINTER</code><code class="o">,</code> <code class="n">SPRING</code><code class="o">,</code> <code class="n">SUMMER</code><code class="o">,</code> <code class="n">AUTUMN</code> <code class="o">};</code></pre>

<p>You could import the type <code>climate.temperate.Seasons</code> and then prefix
the constants with the type name: <code>Seasons.SPRING</code>. For more concise
code, you could import the enumerated values themselves:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kn">import</code> <code class="nn">static</code> <code class="n">climate</code><code class="o">.</code><code class="na">temperate</code><code class="o">.</code><code class="na">Seasons</code><code class="o">.*;</code></pre>

<p>Using static member <code>import</code> declarations for constants is generally a better tech<span class="keep-together">nique</span> than implementing an interface that defines the constants.</p>










<section data-pdf-bookmark="Static member imports and overloaded methods" data-type="sect3"><div class="sect3" id="idm45941131300536">
<h3>Static member imports and overloaded methods</h3>

<p><a data-primary="import static declarations" data-type="indexterm" id="3_idm45941131299128"></a><a data-primary="method overloading" data-type="indexterm" id="3_idm45941131298264"></a><a data-primary="overloading, static member imports and" data-type="indexterm" id="3_idm45941131297592"></a><a data-primary="packages" data-secondary="importing static members" data-type="indexterm" id="3_idm45941131271288"></a><a data-primary="packages" data-secondary="static member imports and overloaded methods" data-type="indexterm" id="3_idm45941131270376"></a>A static <code>import</code> declaration imports a <em>name</em>, not any one specific
member with that name. Because Java allows method overloading and
allows a type to have fields and methods with the same name, a single
static member <code>import</code> declaration may actually import more than one
member. Consider this code:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kn">import</code> <code class="nn">static</code> <code class="n">java</code><code class="o">.</code><code class="na">util</code><code class="o">.</code><code class="na">Arrays</code><code class="o">.</code><code class="na">sort</code><code class="o">;</code></pre>

<p><a data-primary="namespaces" data-secondary="importing static members" data-type="indexterm" id="3_idm45941131226712"></a><a data-primary="sort()" data-secondary="static member imports and" data-type="indexterm" id="3_idm45941131225864"></a>This declaration imports the name 鈥渟ort鈥?into the namespace, not any one
of the 19 <code>sort()</code> methods defined by <code>java.util.Arrays</code>. If you use the
imported name <code>sort</code> to invoke a method, the compiler will look at the
types of the method arguments to determine which method you mean.</p>

<p>It is even legal to import static methods with the same name from two or
more different types as long as the methods all have different
signatures. Here is one natural example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kn">import</code> <code class="nn">static</code> <code class="n">java</code><code class="o">.</code><code class="na">util</code><code class="o">.</code><code class="na">Arrays</code><code class="o">.</code><code class="na">sort</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">static</code> <code class="n">java</code><code class="o">.</code><code class="na">util</code><code class="o">.</code><code class="na">Collections</code><code class="o">.</code><code class="na">sort</code><code class="o">;</code></pre>

<p>You might expect that this code would cause a syntax error. In fact, it
does not because the <code>sort()</code> methods defined by the <code>Collections</code> class
have different signatures than all of the <code>sort()</code> methods defined by
the <code>Arrays</code> class. When you use the name 鈥渟ort鈥?in your code, the
compiler looks at the types of the arguments to determine which of the
21 possible imported methods you mean.<a data-startref="ix_ch02-asciidoc54" data-type="indexterm" id="3_idm45941131153272"></a><a data-startref="ix_ch02-asciidoc53" data-type="indexterm" id="3_idm45941131152600"></a><a data-startref="ix_ch02-asciidoc52" data-type="indexterm" id="3_idm45941131151928"></a></p>
</div></section>



</div></section>





</div></section>













<section data-pdf-bookmark="Java Source File Structure" data-type="sect1"><div class="sect1" id="idm45941131646536">
<h1>Java Source File Structure</h1>

<p><a data-primary="file structure, Java" data-type="indexterm" id="3_idm45941131150184"></a><a data-primary="Java file structure" data-type="indexterm" id="3_idm45941131149480"></a><a data-primary="source file, Java" data-type="indexterm" id="3_idm45941131148808"></a><a data-primary="syntax, Java" data-secondary="Java file structure" data-type="indexterm" id="3_idm45941131148136"></a><a data-primary="syntax, Java" data-secondary="Java source file structure" data-type="indexterm" id="3_idm45941131147192"></a>This chapter has taken us from the smallest to the largest elements of
Java syntax, from individual characters and tokens to operators,
expressions, statements, and methods, and on up to classes and packages.
From a practical standpoint, the unit of Java program structure you will
be dealing with most often is the Java file. A Java file is the smallest
unit of Java code that can be compiled by the Java compiler. A Java file
consists of:</p>

<ul>
<li>
<p>An optional <code>package</code> directive</p>
</li>
<li>
<p>Zero or more <code>import</code> or <code>import static</code> directives</p>
</li>
<li>
<p>One or more type definitions</p>
</li>
</ul>

<p>These elements can be interspersed with comments, of course, but they
must appear in this order. This is all there is to a Java file. All Java
statements (except the <code>package</code> and <code>import</code> directives, which are not
true statements) must appear within methods, and all methods must appear
within a type definition.</p>

<p>Java files have a couple of other important restrictions. First, each
file can contain at most one top-level class that is declared <code>public</code>.
A <code>public</code> class is one that is designed for use by other classes in
other packages. A class can contain any number of nested or inner
classes that are <code>public</code>. We鈥檒l see more about the <code>public</code> modifier
and nested classes in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3">Chapter 3</a>.</p>

<p>The second restriction concerns the filename of a Java file. If a Java
file contains a <code>public</code> class, the name of the file must be the same as
the name of the class, with the extension <em>.java</em> appended. Therefore,
if <code>Point</code> is defined as a <code>public</code> class, its source code must appear
in a file named <em>Point.java</em>. Regardless of whether your classes are
<code>public</code> or not, it is good programming practice to define only one per
file and to give the file the same name as the class.</p>

<p>When a Java file is compiled, each of the classes it defines is compiled
into a separate <em>class</em> file that contains Java byte codes to be
executed by the Java Virtual Machine. A class file has the same name
as the class it defines, with the extension <em>.class</em> appended. Thus, if
the file <em>Point.java</em> defines a class named <code>Point</code>, a Java compiler
compiles it to a file named <em>Point.class</em>. On most systems, class files
are stored in directories that correspond to their package names. For example, the
class <code>com.davidflanagan.examples.Point</code> is defined by the class
file <em>com/davidflanagan/examples/Point.class</em>.</p>

<p>The Java runtime knows where the class files for the standard system
classes are located and can load them as needed. When the interpreter
runs a program that wants to use a class named
<code>com.davidflanagan.examples.Point</code>, it knows that the code for that
class is located in a directory named <em>com/davidflanagan/examples/</em> and,
by default, it 鈥渓ooks鈥?in the current directory for a subdirectory of
that name. In order to tell the interpreter to look in locations other
than the current directory, you must use the <code>-classpath</code> option when
invoking the interpreter or set the <code>CLASSPATH</code> environment variable.
For details, see the documentation for the Java executable, <em>java</em>, in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch13.html#javanut7-CHP-13">Chapter 13</a>.</p>
</div></section>













<section data-pdf-bookmark="Defining and Running Java Programs" data-type="sect1"><div class="sect1" id="idm45941131108744">
<h1>Defining and Running Java Programs</h1>

<p><a data-primary="Java programs" data-secondary="defining and running" data-type="indexterm" id="3_idm45941131107272"></a><a data-primary="main()" data-type="indexterm" id="3_idm45941131106296"></a><a data-primary="syntax, Java" data-secondary="defining and running Java programs" data-type="indexterm" id="3_idm45941131105624"></a><a data-primary="syntax, Java" data-secondary="defining/running Java programs" data-type="indexterm" id="3_idm45941131104712"></a>A Java program consists of a set of interacting class definitions. But
not every Java class or Java file defines a program. To create a
program, you must define a class that has a special method with the
following signature:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code></pre>

<p><a data-primary="Java interpreter" data-type="indexterm" id="3_idm45941131097160"></a><a data-primary="main()" data-type="indexterm" id="3_idm45941131096552"></a>This <code>main()</code> method is the main entry point for your program. It is
where the Java interpreter starts running. This method is passed an
array of strings and returns no value. When <code>main()</code> returns, the Java
interpreter exits (unless <code>main()</code> has created separate threads, in
which case the interpreter waits for all those threads to exit).</p>

<p>To run a Java program, you run the Java executable, <em>java</em>,
specifying the fully qualified name of the class that contains the
<code>main()</code> method. Note that you specify the name of the class, <em>not</em> the
name of the class file that contains the class. Any additional arguments
you specify on the command line are passed to the <code>main()</code> method as its
<code>String[]</code> parameter. You may also need to specify the <code>-classpath</code>
option (or <code>-cp</code>) to tell the interpreter where to look for the classes
needed by the program. Consider the following command:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">java</code> <code class="o">-</code><code class="n">classpath</code> <code class="o">/</code><code class="n">opt</code><code class="o">/</code><code class="n">Jude</code> <code class="n">com</code><code class="o">.</code><code class="na">davidflanagan</code><code class="o">.</code><code class="na">jude</code><code class="o">.</code><code class="na">Jude</code> <code class="n">datafile</code><code class="o">.</code><code class="na">jude</code></pre>

<p><a data-primary="java command" data-type="indexterm" id="3_idm45941131017064"></a><code>java</code> is the command to run the Java interpreter.
<code>-classpath /opt/Jude</code> tells the interpreter where to look for
<em>.class</em> files. <code>com.davidflanagan.jude.Jude</code> is the name of the program
to run (i.e., the name of the class that defines the <code>main()</code> method).
Finally, <code>datafile.jude</code> is a string that is passed to that <code>main()</code>
method as the single element of an array of <code>String</code> objects.</p>

<p>There is an easier way to run programs. <a data-primary="JAR (Java archive) files" data-type="indexterm" id="3_idm45941131072120"></a>If a program and all its
auxiliary classes (except those that are part of the Java platform) have
been properly bundled in a Java archive (JAR) file, you can run the
program simply by specifying the name of the JAR file. In the next
example, we show how to start up the Censum garbage collection log
analyzer:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">java</code> <code class="o">-</code><code class="n">jar</code> <code class="o">/</code><code class="n">usr</code><code class="o">/</code><code class="n">local</code><code class="o">/</code><code class="n">Censum</code><code class="o">/</code><code class="n">censum</code><code class="o">.</code><code class="na">jar</code></pre>

<p>Some operating systems make JAR files automatically executable. On those
systems, you can simply say:</p>

<pre data-code-language="java" data-type="programlisting"><code class="o">%</code> <code class="o">/</code><code class="n">usr</code><code class="o">/</code><code class="n">local</code><code class="o">/</code><code class="n">Censum</code><code class="o">/</code><code class="n">censum</code><code class="o">.</code><code class="na">jar</code></pre>

<p>See <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch13.html#javanut7-CHP-13">Chapter 13</a> for more details on how to execute
Java programs.</p>
</div></section>













<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="idm45941131108152">
<h1>Summary</h1>

<p>In this chapter, we鈥檝e introduced the basic syntax of the Java language.
Due to the interlocking nature of the syntax of programming languages,
it is perfectly fine if you don鈥檛 feel at this point that you have
completely grasped all of the syntax of the language. It is by practice
that we acquire proficiency in any language, human or computer.</p>

<p>It is also worth observing that some parts of syntax are far more
regularly used than others. For example, the <code>strictfp</code> and <code>assert</code>
keywords are almost never used. Rather than trying to grasp every aspect
of Java鈥檚 syntax, it is far better to begin to acquire facility in the
core aspects of Java and then return to any details of syntax that may
still be troubling you. With this in mind, let鈥檚 move to the next
chapter and begin to discuss the classes and objects that are so central
to Java and the basics of Java鈥檚 approach to object-oriented programming.<a data-startref="ix_ch02-asciidoc0" data-type="indexterm" id="3_idm45941130998280"></a></p>
</div></section>







<div data-type="footnotes"><p data-type="footnote" id="idm45941143423768"><sup><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#idm45941143423768-marker">1</a></sup> Technically, the minus sign is an operator that operates on the literal, but is not part of the literal itself.</p><p data-type="footnote" id="idm45941146386552"><sup><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#idm45941146386552-marker">2</a></sup> Technically, they must all implement the <code>AutoCloseable</code> interface.</p><p data-type="footnote" id="idm45941146141480"><sup><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#idm45941146141480-marker">3</a></sup> In the Java Language Specification, the term 鈥渟ignature鈥?has a technical meaning that is slightly different than that used here. This book uses a less formal definition of method signature.</p><p data-type="footnote" id="idm45941133902280"><sup><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#idm45941133902280-marker">4</a></sup> There is a terminology difficulty in discussions of arrays. Unlike with classes and their instances, we use the term 鈥渁rray鈥?for both the array type and the array instance. In practice, it is usually clear from context whether a type or a value is being discussed.</p></div></div></section><div class="annotator-outer annotator-viewer viewer annotator-hide"> </div></div></div>
    </section>
  </div>
</div>

<hr/>

<!--if IE]><![endif]--><!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/java-in-a/9781492037248/ch03.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="3866890"
  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"
  data-username="levinxccai"
  data-account-type="B2B"
  
  data-activated-trial-date="11/06/2017"


  data-archive="9781492037248"
  data-publishers="O&#39;Reilly Media, Inc."



  data-htmlfile-name="ch03.html"
  data-epub-title="Java in a Nutshell, 7th Edition" data-debug=0 data-testing=0><![endif]--><!--if gt IE 8]><!--><!--![endif]-->



<a name="4_"></a>
<div id="MathJax_Message" style="display: none;"></div>
<div class="application" id="container" style="height: auto;">
  <div class="js-toc">
    <section role="document">
      <div id="sbo-rt-content" style="max-width:72.5em; transform: none;"><div class="annotator-wrapper"><section data-nutshell-tab="OO Programming" data-pdf-bookmark="Chapter 3. Object-Oriented Programming in Java" data-type="chapter" epub:type="chapter"><div class="chapter" id="javanut7-CHP-3">
<h1><span class="label">Chapter 3. </span>Object-Oriented Programming <span class="keep-together">in Java</span></h1>


<p><a data-primary="object-oriented programming" data-type="indexterm" id="4_ix_ch03-asciidoc0"></a>Now that we鈥檝e covered fundamental Java syntax, we are ready to begin object-oriented programming in Java.
All Java programs use objects, and the type of an object is defined by its <em>class</em> or <em>interface</em>. Every Java program is defined as a class, and nontrivial programs include a number of classes and interface definitions.</p>

<p>This chapter explains how to define new classes and how to do object-oriented programming with them.
We also introduce the concept of an interface, but a full discussion of interfaces and Java鈥檚 type system is deferred until <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4">Chapter 4</a>.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>If you have experience with OO programming, however, be careful. The
term 鈥渙bject-oriented鈥?has different meanings in different languages. Don鈥檛 assume that Java works the same way as your favorite OO language.
(This is particularly true for C++ or Python programmers.)</p>
</div>

<p>This is a fairly lengthy chapter, so let鈥檚 begin with an overview and
some definitions.</p>






<section data-pdf-bookmark="Overview of Classes" data-type="sect1"><div class="sect1" id="javanut7-CHP-3-SECT-1">
<h1>Overview of Classes</h1>

<p><a data-primary="class(es)" data-secondary="in object-oriented programming" data-type="indexterm" id="4_ix_ch03-asciidoc1"></a><a data-primary="object-oriented programming" data-secondary="classes" data-type="indexterm" id="4_ix_ch03-asciidoc2"></a>Classes are the most fundamental structural element of all Java
programs. You cannot write Java code without defining a class. All Java
statements appear within classes, and all methods are implemented within
classes.</p>








<section data-pdf-bookmark="Basic OO Definitions" data-type="sect2"><div class="sect2" id="idm45941130951944">
<h2>Basic OO Definitions</h2>

<p><a data-primary="class(es)" data-secondary="basic object-oriented definitions" data-type="indexterm" id="4_idm45941130950376"></a>Here are a couple important definitions:</p>
<dl>
<dt>Class</dt>
<dd>
<p><a data-primary="class(es)" data-secondary="defined" data-type="indexterm" id="4_idm45941130947960"></a>A <em>class</em> is a collection of data fields that hold values and methods that operate on those values. A class defines a new reference type, such as the <code>Point</code> type defined in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2">Chapter 2</a>.</p>

<p><a data-primary="Point class" data-type="indexterm" id="4_idm45941130928312"></a>The <code>Point</code> class defines a type that is the set of all possible two-dimensional points.</p>
</dd>
<dt>Object</dt>
<dd>
<p><a data-primary="objects" data-secondary="defined" data-type="indexterm" id="4_idm45941130926168"></a>An <em>object</em> is an <em>instance</em> of a class.</p>

<p>A <code>Point</code> object is a value of that type: it represents a single two-dimensional point.</p>
</dd>
</dl>

<p>Objects are often created by <em>instantiating</em> a class with the <code>new</code>
keyword and a constructor invocation, as shown here:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Point</code> <code class="n">p</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Point</code><code class="o">(</code><code class="mf">1.0</code><code class="o">,</code> <code class="mf">2.0</code><code class="o">);</code></pre>

<p>Constructors are covered later in this chapter in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3-SECT-3">鈥淐reating and Initializing Objects鈥?/a&gt;.</p>

<p><a data-primary="body" data-secondary="in class definition" data-type="indexterm" id="4_idm45941130912120"></a><a data-primary="signature" data-secondary="in class definition" data-type="indexterm" id="4_idm45941130910920"></a>A class definition consists of a <em>signature</em> and a <em>body</em>. The class
signature defines the name of the class and may also specify other
important information. <a data-primary="{ } (curly braces)" data-secondary="members of a class in" data-type="indexterm" id="4_idm45941130903784"></a><a data-primary="members of a class" data-type="indexterm" id="4_idm45941130902808"></a>The body of a class is a set of <em>members</em>
enclosed in curly braces. The members of a class usually include fields
and methods, and may also include constructors, initializers, and nested
types.</p>

<p><a data-primary="nonstatic members" data-type="indexterm" id="4_idm45941130901288"></a><a data-primary="static members" data-type="indexterm" id="4_idm45941130900584"></a>Members can be <em>static</em> or nonstatic. A static member belongs to the
class itself, while a nonstatic member is associated with the instances
of a class (see <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3-SECT-2">鈥淔ields and Methods鈥?/a&gt;).</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>There are four very common kinds of members鈥攃lass fields, class
methods, instance fields, and instance methods. The majority of work
done with Java involves interacting with these kinds of members.</p>
</div>

<p>The signature of a class may declare that the class <em>extends</em> another
class. <a data-primary="subclasses" data-secondary="defined" data-type="indexterm" id="4_idm45941130895992"></a><a data-primary="superclasses" data-secondary="defined" data-type="indexterm" id="4_idm45941130894984"></a>The extended class is known as the <em>superclass</em> and the extension
is known as the <em>subclass</em>. A subclass <em>inherits</em> the members of its
superclass and may declare new members or <em>override</em> inherited methods
with new implementations.</p>

<p><a data-primary="access modifiers" data-type="indexterm" id="4_idm45941130892024"></a>The members of a class may have <em>access modifiers</em> <code>public</code>,
<code>protected</code>, or <code>private</code>.<sup><a class="totri-footnote" data-type="noteref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#idm45941130889240" id="idm45941130889240-marker">1</a></sup> These modifiers specify their
visibility and accessibility to clients and to subclasses. This allows
classes to control access to members that are not part of their public
API. <a data-primary="encapsulation" data-type="indexterm" id="4_idm45941130888328"></a>This ability to hide members enables an object-oriented design
technique known as <em>data encapsulation</em>, which we discuss in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3-SECT-5">鈥淒ata Hiding and Encapsulation鈥?/a&gt;.</p>
</div></section>













<section data-pdf-bookmark="Other Reference Types" data-type="sect2"><div class="sect2" id="idm45941130951352">
<h2>Other Reference Types</h2>

<p>The signature of a class may also declare that the class <em>implements</em>
one or more interfaces. <a data-primary="interfaces" data-secondary="definition of term" data-type="indexterm" id="4_idm45941130865832"></a>An <em>interface</em> is a reference type similar to
a class that defines method signatures but does not usually include
method bodies to implement the methods.</p>

<p><a data-primary="default keyword" data-type="indexterm" id="4_idm45941130863928"></a>However, from Java 8 onward, interfaces may use the keyword <code>default</code> to
indicate that a method specified in the interface is optional. If a
method is optional, the interface file must include a default
implementation (hence the choice of keyword), which will be used by all
implementing classes that do not provide an implementation of the
optional method.</p>

<p>A class that implements an interface is required to provide bodies for
the interface鈥檚 nondefault methods. Instances of a class that implement
an interface are also instances of the interface type.</p>

<p>Classes and interfaces are the most important of the five fundamental
reference types defined by Java. Arrays, enumerated types (or
鈥渆nums鈥?, and annotation types (usually just called 鈥渁nnotations鈥? are
the other three. Arrays are covered in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2">Chapter 2</a>.
Enums are a specialized kind of class and annotations are a specialized
kind of interface鈥攂oth are discussed later in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4">Chapter 4</a>, along with a full discussion of
interfaces.</p>
</div></section>













<section data-pdf-bookmark="Class Definition Syntax" data-type="sect2"><div class="sect2" id="idm45941130859128">
<h2>Class Definition Syntax</h2>

<p><a data-primary="class keyword" data-type="indexterm" id="4_idm45941130857816"></a><a data-primary="class(es)" data-secondary="definition syntax" data-type="indexterm" id="4_idm45941130856888"></a>At its simplest level, a class definition consists of the keyword
<code>class</code> followed by the name of the class and a set of class members
within curly braces. The <code>class</code> keyword may be preceded by modifier
keywords and annotations. If the class extends another class, the class
name is followed by the <code>extends</code> keyword and the name of the class
being extended. If the class implements one or more interfaces, then the
class name or the <code>extends</code> clause is followed by the <code>implements</code>
keyword and a comma-separated list of interface names. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">Integer</code> <code class="kd">extends</code> <code class="n">Number</code> <code class="kd">implements</code> <code class="n">Serializable</code><code class="o">,</code> <code class="n">Comparable</code> <code class="o">{</code>
    <code class="c1">// class members go here</code>
<code class="o">}</code></pre>

<p>A generic class may also have type parameters and wildcards as part of
its definition (see <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4">Chapter 4</a>).</p>

<p>Class declarations may include modifier keywords. In addition to the access control modifiers (<code>public</code>, <code>protected</code>, etc.), these include:</p>
<dl>
<dt><code>abstract</code></dt>
<dd>
<p><a data-primary="abstract classes" data-secondary="defined" data-type="indexterm" id="4_idm45941130843608"></a>An <code>abstract</code> class is one whose implementation is incomplete and cannot be instantiated. Any class with one or more <code>abstract</code> methods must be declared <code>abstract</code>. Abstract classes are discussed in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3-SECT-6">鈥淎bstract Classes and Methods鈥?/a&gt;.</p>
</dd>
<dt><code>final</code></dt>
<dd>
<p><a data-primary="final classes" data-type="indexterm" id="4_idm45941130829240"></a>The <code>final</code> modifier specifies that the class may not be extended. A class cannot be declared to be both <code>abstract</code> and <code>final</code>.</p>
</dd>
<dt><code>strictfp</code></dt>
<dd>
<p><a data-primary="strictfp modifier" data-type="indexterm" id="4_idm45941130825672"></a>If a class is declared <code>strictfp</code>, all its methods behave as if they were declared <code>strictfp</code>, and so exactly follow the formal semantics of the floating-point standard. This modifier is <em>extremely</em> rarely used.<a data-startref="ix_ch03-asciidoc2" data-type="indexterm" id="4_idm45941130823480"></a><a data-startref="ix_ch03-asciidoc1" data-type="indexterm" id="4_idm45941130822744"></a></p>
</dd>
</dl>
</div></section>





</div></section>













<section data-pdf-bookmark="Fields and Methods" data-type="sect1"><div class="sect1" id="javanut7-CHP-3-SECT-2">
<h1>Fields and Methods</h1>

<p><a data-primary="class(es)" data-secondary="fields and methods" data-type="indexterm" id="4_ix_ch03-asciidoc3"></a><a data-primary="fields" data-type="indexterm" id="4_ix_ch03-asciidoc4"></a><a data-primary="object-oriented programming" data-secondary="fields and methods" data-type="indexterm" id="4_ix_ch03-asciidoc5"></a>A class can be viewed as a collection of data (also referred to as
<code>state</code>) and code to operate on that state. The data is stored in
fields, and the code is organized into methods.</p>

<p>This section covers fields and methods, the two most important kinds of
class members. Fields and methods come in two distinct types: class
members (also known as static members) are associated with the class
itself, while instance members are associated with individual instances
of the class (i.e., with objects). This gives us four kinds of members:</p>

<ul>
<li>
<p>Class fields</p>
</li>
<li>
<p>Class methods</p>
</li>
<li>
<p>Instance fields</p>
</li>
<li>
<p>Instance methods</p>
</li>
</ul>

<p>The simple class definition for the class <code>Circle</code>, shown in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3-EX-1">Example 3-1</a>, contains all four types of
members.</p>
<div data-type="example" id="javanut7-CHP-3-EX-1">
<h5><span class="label">Example 3-1. </span>A simple class and its members</h5>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">Circle</code> <code class="o">{</code>
  <code class="c1">// A class field</code>
  <code class="kd">public</code> <code class="kd">static</code> <code class="kd">final</code> <code class="kt">double</code> <code class="n">PI</code><code class="o">=</code> <code class="mf">3.14159</code><code class="o">;</code>     <code class="c1">// A useful constant</code>

  <code class="c1">// A class method: just compute a value based on the arguments</code>
  <code class="kd">public</code> <code class="kd">static</code> <code class="kt">double</code> <code class="nf">radiansToDegrees</code><code class="o">(</code><code class="kt">double</code> <code class="n">radians</code><code class="o">)</code> <code class="o">{</code>
    <code class="k">return</code> <code class="n">radians</code> <code class="o">*</code> <code class="mi">180</code> <code class="o">/</code> <code class="n">PI</code><code class="o">;</code>
  <code class="o">}</code>

  <code class="c1">// An instance field</code>
  <code class="kd">public</code> <code class="kt">double</code> <code class="n">r</code><code class="o">;</code>                  <code class="c1">// The radius of the circle</code>

  <code class="c1">// Two instance methods: they operate on the instance fields of an object</code>
  <code class="kd">public</code> <code class="kt">double</code> <code class="nf">area</code><code class="o">()</code> <code class="o">{</code>            <code class="c1">// Compute the area of the circle</code>
    <code class="k">return</code> <code class="n">PI</code> <code class="o">*</code> <code class="n">r</code> <code class="o">*</code> <code class="n">r</code><code class="o">;</code>
  <code class="o">}</code>

  <code class="kd">public</code> <code class="kt">double</code> <code class="nf">circumference</code><code class="o">()</code> <code class="o">{</code>   <code class="c1">// Compute the circumference</code>
                                    <code class="c1">// of the circle</code>
    <code class="k">return</code> <code class="mi">2</code> <code class="o">*</code> <code class="n">PI</code> <code class="o">*</code> <code class="n">r</code><code class="o">;</code>
  <code class="o">}</code>
<code class="o">}</code></pre></div>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>It is not normally good practice to have a public field <code>r</code>鈥攊nstead, it
would be much more usual to have a private field <code>r</code> and a method
<code>radius()</code> to provide access to it. The reason for this will be
explained later, in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3-SECT-5">鈥淒ata Hiding and Encapsulation鈥?/a&gt;. For now,
we use a public field simply to give examples of how to work with
instance fields.</p>
</div>

<p>The following sections explain all four common kinds of members. First,
we cover the declaration syntax for fields. (The syntax for declaring
methods is covered later in this chapter in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3-SECT-5">鈥淒ata Hiding and Encapsulation鈥?/a&gt;.)</p>








<section data-pdf-bookmark="Field Declaration Syntax" data-type="sect2"><div class="sect2" id="javanut7-CHP-3-SECT-2.1">
<h2>Field Declaration Syntax</h2>

<p><a data-primary="fields" data-secondary="declaration syntax" data-type="indexterm" id="4_idm45941130703064"></a><a data-primary="syntax, Java" data-secondary="field declaration syntax" data-type="indexterm" id="4_idm45941130702088"></a>Field declaration syntax is much like the syntax for declaring local
variables (see <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2">Chapter 2</a>) except that field
definitions may also include modifiers. The simplest field declaration
consists of the field type followed by the field name.</p>

<p>The type may be
preceded by zero or more modifier keywords or annotations, and the name
may be followed by an equals sign and initializer expression that
provides the initial value of the field. If two or more fields share the
same type and modifiers, the type may be followed by a comma-separated
list of field names and initializers. Here are some valid field
declarations:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">int</code> <code class="n">x</code> <code class="o">=</code> <code class="mi">1</code><code class="o">;</code>
<code class="kd">private</code> <code class="n">String</code> <code class="n">name</code><code class="o">;</code>
<code class="kd">public</code> <code class="kd">static</code> <code class="kd">final</code> <code class="kt">int</code> <code class="n">DAYS_PER_WEEK</code> <code class="o">=</code> <code class="mi">7</code><code class="o">;</code>
<code class="n">String</code><code class="o">[]</code> <code class="n">daynames</code> <code class="o">=</code> <code class="k">new</code> <code class="n">String</code><code class="o">[</code><code class="n">DAYS_PER_WEEK</code><code class="o">];</code>
<code class="kd">private</code> <code class="kt">int</code> <code class="n">a</code> <code class="o">=</code> <code class="mi">17</code><code class="o">,</code> <code class="n">b</code> <code class="o">=</code> <code class="mi">37</code><code class="o">,</code> <code class="n">c</code> <code class="o">=</code> <code class="mi">53</code><code class="o">;</code></pre>

<p><a data-primary="fields" data-secondary="modifiers" data-type="indexterm" id="4_idm45941130697784"></a>Field modifier keywords comprise zero or more of the following
keywords:</p>
<dl>
<dt><code>public</code>, <code>protected</code>, <code>private</code></dt>
<dd>
<p><a data-primary="private modifier" data-type="indexterm" id="4_idm45941130592888"></a><a data-primary="protected modifier" data-type="indexterm" id="4_idm45941130592184"></a><a data-primary="public modifier" data-type="indexterm" id="4_idm45941130591512"></a>These access modifiers specify whether and where a field can be used outside of the class that defines it.</p>
</dd>
<dt><code>static</code></dt>
<dd>
<p><a data-primary="static modifier" data-type="indexterm" id="4_idm45941130589304"></a>If present, this modifier specifies that the field is associated with the defining class itself rather than with each instance of the class.</p>
</dd>
<dt><code>final</code></dt>
<dd>
<p><a data-primary="final modifier" data-type="indexterm" id="4_idm45941130587032"></a>This modifier specifies that once the field has been initialized, its value may never be changed. Fields that are both <code>static</code> and <code>final</code> are compile-time constants that <code>javac</code> may inline. <code>final</code> fields can also be used to create classes whose instances are immutable.</p>
</dd>
<dt><code>transient</code></dt>
<dd>
<p><a data-primary="transient modifier" data-type="indexterm" id="4_idm45941130583064"></a>This modifier specifies that a field is not part of the persistent state of an object and that it need not be serialized along with the rest of the object.</p>
</dd>
<dt><code>volatile</code></dt>
<dd>
<p><a data-primary="volatile keyword" data-type="indexterm" id="4_idm45941130580776"></a>This modifier indicates that the field has extra semantics for concurrent use by two or more threads. The <code>volatile</code> modifier says that the value of a field must always be read from and flushed to main memory, and that it may not be cached by a thread (in a register or CPU cache). See <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch06.html#javanut7-CHP-6">Chapter 6</a> for more details.</p>
</dd>
</dl>
</div></section>













<section data-pdf-bookmark="Class Fields" data-type="sect2"><div class="sect2" id="idm45941130594936">
<h2>Class Fields</h2>

<p><a data-primary="class field" data-type="indexterm" id="4_idm45941130668632"></a><a data-primary="fields" data-secondary="class" data-type="indexterm" id="4_idm45941130667928"></a>A <em>class field</em> is associated with the class in which it is defined
rather than with an instance of the class. The following line declares a
class field:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">static</code> <code class="kd">final</code> <code class="kt">double</code> <code class="n">PI</code> <code class="o">=</code> <code class="mf">3.14159</code><code class="o">;</code></pre>

<p>This line declares a field of type <code>double</code> named <code>PI</code> and assigns it a
value of <code>3.14159</code>.</p>

<p>The <code>static</code> modifier says that the field is a class field. Class
fields are sometimes called static fields because of this <code>static</code>
modifier. The <code>final</code> modifier says that the value of the field cannot be reassigned directly. Because the field <code>PI</code> represents a constant, we declare it <code>final</code> so that it cannot be changed.</p>

<p>It is a convention in Java (and many other languages) that constants are named with capital letters, which is why our field is named <code>PI</code>, not <code>pi</code>.
Defining constants like this is a common use for class fields, meaning that the <code>static</code> and <code>final</code> modifiers are often used together.
Not all class fields are constants, however.
In other words, a field can be declared <code>static</code> without being declared <code>final</code>.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The use of public fields that are not <code>final</code> is almost never a
good practice鈥攁s multiple threads could update the field and cause
behavior that is extremely hard to debug.</p>
</div>

<p>A public static field is essentially a global variable. The names of
class fields are qualified by the unique names of the classes that
contain them, however. Thus, Java does not suffer from the name
collisions that can affect other languages when different modules of
code define global variables with the same name.</p>

<p>The key point to understand about a static field is that there is only a
single copy of it. This field is associated with the class itself, not
with instances of the class. If you look at the various methods of the
<code>Circle</code> class, you鈥檒l see that they use this field. From inside the
<code>Circle</code> class, the field can be referred to simply as <code>PI</code>. Outside the
class, however, both class and field names are required to uniquely
specify the field. Methods that are not part of <code>Circle</code> access this
field as <code>Circle.PI</code>.</p>
</div></section>













<section data-pdf-bookmark="Class Methods" data-type="sect2"><div class="sect2" id="idm45941130542760">
<h2>Class Methods</h2>

<p><a data-primary="class methods" data-type="indexterm" id="4_idm45941130541128"></a><a data-primary="methods" data-secondary="class" data-type="indexterm" id="4_idm45941130540424"></a>As with class fields, <em>class methods</em> are declared with the <code>static</code>
modifier:</p>

<pre class="pre " data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">static</code> <code class="kt">double</code> <code class="nf">radiansToDegrees</code><code class="o">(</code><code class="kt">double</code> <code class="n">rads</code><code class="o">)</code> <code class="o">{</code>
  <code class="k">return</code> <code class="n">rads</code> <code class="o">*</code> <code class="mi">180</code> <code class="o">/</code> <code class="n">PI</code><code class="o">;</code>
<code class="o">}</code></pre>

<p>This line declares a class method named <code>radiansToDegrees()</code>. It has a
single parameter of type <code>double</code> and returns a <code>double</code> value.</p>

<p>Like class fields, class methods are associated with a class, rather
than with an object. When invoking a class method from code that exists
outside the class, you must specify both the name of the class and the
method. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// How many degrees is 2.0 radians?</code>
<code class="kt">double</code> <code class="n">d</code> <code class="o">=</code> <code class="n">Circle</code><code class="o">.</code><code class="na">radiansToDegrees</code><code class="o">(</code><code class="mf">2.0</code><code class="o">);</code></pre>

<p>If you want to invoke a class method from inside the class in which it
is defined, you don鈥檛 have to specify the class name. You can also
shorten the amount of typing required via the use of a static import (as
discussed in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2">Chapter 2</a>).</p>

<p>Note that the body of our <code>Circle.radiansToDegrees()</code> method uses the
class field <code>PI</code>. A class method can use any class fields and class
methods of its own class (or of any other class).</p>

<p>A class method cannot use any instance fields or instance methods
because class methods are not associated with an instance of the class.
In other words, although the <code>radiansToDegrees()</code> method is defined in
the <code>Circle</code> class, it cannot use the instance part of any <code>Circle</code>
objects.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>One way to think about this is that in any instance, we always have a reference鈥?code&gt;this</code>鈥攖o the current object.
This is passed as an implicit parameter to any instance method.
However, class methods are not associated with a specific instance, so have no <code>this</code> reference, and no access to instance fields.</p>
</div>

<p>As we discussed earlier, a class field is essentially a global variable.
In a similar way, a class method is a global method, or global
function. Although <code>radiansToDegrees()</code> does not operate on <code>Circle</code>
objects, it is defined within the <code>Circle</code> class because it is a utility
method that is sometimes useful when you鈥檙e working with circles, and so it
makes sense to package it along with the other functionality of the
<code>Circle</code> class.</p>
</div></section>













<section data-pdf-bookmark="Instance Fields" data-type="sect2"><div class="sect2" id="idm45941130542104">
<h2>Instance Fields</h2>

<p><a data-primary="fields" data-secondary="instance" data-type="indexterm" id="4_idm45941130447944"></a><a data-primary="instance fields" data-type="indexterm" id="4_idm45941130446968"></a>Any field declared without the <code>static</code> modifier is an <em>instance
field</em>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kt">double</code> <code class="n">r</code><code class="o">;</code>    <code class="c1">// The radius of the circle</code></pre>

<p>Instance fields are associated with instances of the class, so every
<code>Circle</code> object we create has its own copy of the <code>double</code> field <code>r</code>. In
our example, <code>r</code> represents the radius of a specific circle. Each
<code>Circle</code> object can have a radius independent of all other <code>Circle</code>
objects.</p>

<p>Inside a class definition, instance fields are referred to by name
alone. You can see an example of this if you look at the method body of
the <code>circumference()</code> instance method. In code outside the class, the
name of an instance method must be prefixed with a reference to the
object that contains it. For example, if the variable <code>c</code> holds a
reference to a <code>Circle</code> object, we use the expression <code>c.r</code> to refer to
the radius of that circle:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Circle</code> <code class="n">c</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Circle</code><code class="o">();</code> <code class="c1">// Create a Circle object; store a ref in c</code>
<code class="n">c</code><code class="o">.</code><code class="na">r</code> <code class="o">=</code> <code class="mf">2.0</code><code class="o">;</code>               <code class="c1">// Assign a value to its instance field r</code>
<code class="n">Circle</code> <code class="n">d</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Circle</code><code class="o">();</code> <code class="c1">// Create a different Circle object</code>
<code class="n">d</code><code class="o">.</code><code class="na">r</code> <code class="o">=</code> <code class="n">c</code><code class="o">.</code><code class="na">r</code> <code class="o">*</code> <code class="mi">2</code><code class="o">;</code>           <code class="c1">// Make this one twice as big</code></pre>

<p>Instance fields are key to object-oriented programming. Instance fields
hold the state of an object; the values of those fields make one object
distinct from another.</p>
</div></section>













<section data-pdf-bookmark="Instance Methods" data-type="sect2"><div class="sect2" id="idm45941130363336">
<h2>Instance Methods</h2>

<p><a data-primary="instance methods" data-type="indexterm" id="4_idm45941130362184"></a><a data-primary="methods" data-secondary="instance" data-type="indexterm" id="4_idm45941130361480"></a>An <em>instance</em> <em>method</em> operates on a specific instance of a class (an
object), and any method not declared with the <code>static</code> keyword is
automatically an instance method.</p>

<p>Instance methods are the feature that makes object-oriented programming
start to get interesting. The <code>Circle</code> class defined in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3-EX-1">Example 3-1</a> contains two instance methods,
<code>area()</code> and <code>circumference()</code>, that compute and return the area and
circumference of the circle represented by a given <code>Circle</code> object.</p>

<p>To use an instance method from outside the class in which it is defined,
we must prefix it with a reference to the instance that is to be
operated on. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Create a Circle object; store in variable c</code>
<code class="n">Circle</code> <code class="n">c</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Circle</code><code class="o">();</code>
<code class="n">c</code><code class="o">.</code><code class="na">r</code> <code class="o">=</code> <code class="mf">2.0</code><code class="o">;</code>                 <code class="c1">// Set an instance field of the object</code>
<code class="kt">double</code> <code class="n">a</code> <code class="o">=</code> <code class="n">c</code><code class="o">.</code><code class="na">area</code><code class="o">();</code>       <code class="c1">// Invoke an instance method of the object</code></pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>This is why it is called object-oriented programming; the object is the
focus here, not the function call.</p>
</div>

<p>From within an instance method, we naturally have access to all the
instance fields that belong to the object the method was called on.
Recall that an object is often best considered to be a bundle containing
state (represented as the fields of the object), and behavior (the
methods to act on that state).</p>

<p>All instance methods are implemented by using an implicit parameter not shown in the method signature.
The implicit argument is named <code>this</code>; it holds a reference to the object through which the method is invoked.
In our example, that object is a <code>Circle</code>.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The bodies of the <code>area()</code> and <code>circumference()</code> methods both use the
class field <code>PI</code>. We saw earlier that class methods can use only class
fields and class methods, not instance fields or methods. Instance
methods are not restricted in this way: they can use any member of a
class, whether it is declared <code>static</code> or not.</p>
</div>
</div></section>













<section data-pdf-bookmark="How the this Reference Works" data-type="sect2"><div class="sect2" id="idm45941130337336">
<h2>How the this Reference Works</h2>

<p><a data-primary="methods" data-secondary="this reference" data-type="indexterm" id="4_idm45941130335736"></a><a data-primary="this keyword" data-type="indexterm" id="4_idm45941130295688"></a>The implicit <code>this</code> parameter is not shown in method signatures
because it is usually not needed; whenever a Java method accesses the
instance fields in its class, it is implicit that it is accessing fields
in the object referred to by the <code>this</code> parameter. The same is true when
an instance method invokes another instance method in the same
class鈥攊t鈥檚 taken that this means 鈥渃all the instance method on the
current object.鈥?/p&gt;

<p>However, you can use the <code>this</code> keyword explicitly when you want to make
it clear that a method is accessing its own fields and/or methods. For
example, we can rewrite the <code>area()</code> method to use <code>this</code> explicitly to
refer to instance fields:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kt">double</code> <code class="nf">area</code><code class="o">()</code> <code class="o">{</code> <code class="k">return</code> <code class="n">Circle</code><code class="o">.</code><code class="na">PI</code> <code class="o">*</code> <code class="k">this</code><code class="o">.</code><code class="na">r</code> <code class="o">*</code> <code class="k">this</code><code class="o">.</code><code class="na">r</code><code class="o">;</code> <code class="o">}</code></pre>

<p>This code also uses the class name explicitly to refer to class field
<code>PI</code>. In a method this simple, it is not normally necessary to be quite
so explicit. In more complicated cases, however, you may sometimes find
that it increases the clarity of your code to use an explicit <code>this</code>
where it is not strictly required.</p>

<p>In some cases, the <code>this</code> keyword <em>is</em> required, however. For example,
when a method parameter or local variable in a method has the same name
as one of the fields of the class, you must use <code>this</code> to refer to the
field, because the field name used alone refers to the method parameter
or local variable.</p>

<p>For example, we can add the following method to the <code>Circle</code> class:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kt">void</code> <code class="nf">setRadius</code><code class="o">(</code><code class="kt">double</code> <code class="n">r</code><code class="o">)</code> <code class="o">{</code>
  <code class="k">this</code><code class="o">.</code><code class="na">r</code> <code class="o">=</code> <code class="n">r</code><code class="o">;</code>      <code class="c1">// Assign the argument (r) to the field (this.r)</code>
                   <code class="c1">// Note that we cannot just say r = r</code>
<code class="o">}</code></pre>

<p>Some developers will deliberately choose the names of their method arguments in such a way that they don鈥檛 clash with field names, so the use of <code>this</code> can largely be avoided.
However, accessor methods (setter) generated by any of the major Java IDEs will use the <code>this.x = x</code> style shown here.</p>

<p>Finally, note that while instance methods can use the <code>this</code> keyword,
class methods cannot. This is because class methods are not associated
with individual objects.<a data-startref="ix_ch03-asciidoc5" data-type="indexterm" id="4_idm45941130221208"></a><a data-startref="ix_ch03-asciidoc4" data-type="indexterm" id="4_idm45941130220504"></a><a data-startref="ix_ch03-asciidoc3" data-type="indexterm" id="4_idm45941130219832"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Creating and Initializing Objects" data-type="sect1"><div class="sect1" id="javanut7-CHP-3-SECT-3">
<h1>Creating and Initializing Objects</h1>

<p><a data-primary="object-oriented programming" data-secondary="creating/initializing objects" data-type="indexterm" id="4_ix_ch03-asciidoc6"></a><a data-primary="objects" data-secondary="creating" data-type="indexterm" id="4_ix_ch03-asciidoc7"></a><a data-primary="objects" data-secondary="initializing" data-type="indexterm" id="4_ix_ch03-asciidoc8"></a>Now that we鈥檝e covered fields and methods, let鈥檚 move on to other
important members of a class. In particular, we鈥檒l look at
constructors鈥攖hese are class members whose job is to initialize the
fields of a class as new instances of the class are created.</p>

<p>Take another look at how we鈥檝e been creating <code>Circle</code> objects:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Circle</code> <code class="n">c</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Circle</code><code class="o">();</code></pre>

<p>This can easily be read as creating a new instance of <code>Circle</code>,
by calling something that looks a bit like a method. In fact, <code>Circle()</code>
is an example of a <em>constructor</em>. This is a member of a class that has
the same name as the class, and has a body, like a method.</p>

<p>Here鈥檚 how a constructor works. The <code>new</code> operator indicates that we
need to create a new instance of the class. First of all, memory is
allocated to hold the new object instance. Then, the constructor body is
called, with any arguments that have been specified. The constructor
uses these arguments to do whatever initialization of the new object is
necessary.</p>

<p><a data-primary="constructors" data-secondary="purpose of" data-type="indexterm" id="4_idm45941130182632"></a>Every class in Java has at least one <em>constructor</em>, and their purpose is to perform any necessary initialization for a new object.
If the programmer does not explicitly define a constructor for a class, the <code>javac</code> compiler automatically creates a constructor (called the default constructor) that takes no arguments and performs no special initialization.
The <code>Circle</code> class seen in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3-EX-1">Example 3-1</a> used this mechanism to automatically delcare a constructor.</p>








<section data-pdf-bookmark="Defining a Constructor" data-type="sect2"><div class="sect2" id="idm45941130147896">
<h2>Defining a Constructor</h2>

<p><a data-primary="constructors" data-secondary="defining a single constructor" data-type="indexterm" id="4_idm45941130146488"></a><a data-primary="initializing objects" data-secondary="defining a constructor" data-type="indexterm" id="4_idm45941130145320"></a>There is some obvious initialization we could do for our <code>Circle</code>
objects, so let鈥檚 define a constructor.
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3-EX-2">Example 3-2</a> shows a new definition for
<code>Circle</code> that contains a constructor that lets us specify the radius of
a new <code>Circle</code> object. We鈥檝e also taken the opportunity to make the
field <code>r</code> protected (to prevent access to it from arbitary objects).</p>
<div data-type="example" id="javanut7-CHP-3-EX-2">
<h5><span class="label">Example 3-2. </span>A constructor for the Circle class</h5>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">Circle</code> <code class="o">{</code>
    <code class="kd">public</code> <code class="kd">static</code> <code class="kd">final</code> <code class="kt">double</code> <code class="n">PI</code> <code class="o">=</code> <code class="mf">3.14159</code><code class="o">;</code>  <code class="c1">// A constant</code>
    <code class="c1">// An instance field that holds the radius of the circle</code>
    <code class="kd">protected</code> <code class="kt">double</code> <code class="n">r</code><code class="o">;</code>

    <code class="c1">// The constructor: initialize the radius field</code>
    <code class="kd">public</code> <code class="nf">Circle</code><code class="o">(</code><code class="kt">double</code> <code class="n">r</code><code class="o">)</code> <code class="o">{</code> <code class="k">this</code><code class="o">.</code><code class="na">r</code> <code class="o">=</code> <code class="n">r</code><code class="o">;</code> <code class="o">}</code>

    <code class="c1">// The instance methods: compute values based on the radius</code>
    <code class="kd">public</code> <code class="kt">double</code> <code class="nf">circumference</code><code class="o">()</code> <code class="o">{</code> <code class="k">return</code> <code class="mi">2</code> <code class="o">*</code> <code class="n">PI</code> <code class="o">*</code> <code class="n">r</code><code class="o">;</code> <code class="o">}</code>
    <code class="kd">public</code> <code class="kt">double</code> <code class="nf">area</code><code class="o">()</code> <code class="o">{</code> <code class="k">return</code> <code class="n">PI</code> <code class="o">*</code> <code class="n">r</code><code class="o">*</code><code class="n">r</code><code class="o">;</code> <code class="o">}</code>
    <code class="kd">public</code> <code class="kt">double</code> <code class="nf">radius</code><code class="o">()</code> <code class="o">{</code> <code class="k">return</code> <code class="n">r</code><code class="o">;</code> <code class="o">}</code>
<code class="o">}</code></pre></div>

<p>When we relied on the default constructor supplied by the compiler, we
had to write code like this to initialize the radius explicitly:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Circle</code> <code class="n">c</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Circle</code><code class="o">();</code>
<code class="n">c</code><code class="o">.</code><code class="na">r</code> <code class="o">=</code> <code class="mf">0.25</code><code class="o">;</code></pre>

<p>With the new constructor, the initialization becomes part of the object
creation step:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Circle</code> <code class="n">c</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Circle</code><code class="o">(</code><code class="mf">0.25</code><code class="o">);</code></pre>

<p>Here are some basic facts regarding naming, declaring, and writing
constructors:</p>

<ul>
<li>
<p>The constructor name is always the same as the class name.</p>
</li>
<li>
<p>A constructor is declared without a return type (not even the <code>void</code> placeholder).</p>
</li>
<li>
<p>The body of a constructor is the code that initializes the object. You can think of this as setting up the contents of the <code>this</code> reference.</p>
</li>
<li>
<p>A constructor does not return <code>this</code> (or any other value).</p>
</li>
</ul>
</div></section>













<section data-pdf-bookmark="Defining Multiple Constructors" data-type="sect2"><div class="sect2" id="idm45941129981384">
<h2>Defining Multiple Constructors</h2>

<p><a data-primary="constructors" data-secondary="defining multiple constructors" data-type="indexterm" id="4_idm45941129979944"></a><a data-primary="initializing objects" data-secondary="defining multiple constructors" data-type="indexterm" id="4_idm45941129979000"></a>Sometimes you want to initialize an object in a number of different
ways, depending on what is most convenient in a particular circumstance.
For example, we might want to initialize the radius of a circle to a
specified value or a reasonable default value. Here鈥檚 how we can define
two constructors for <code>Circle</code>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="nf">Circle</code><code class="o">()</code> <code class="o">{</code> <code class="n">r</code> <code class="o">=</code> <code class="mf">1.0</code><code class="o">;</code> <code class="o">}</code>
<code class="kd">public</code> <code class="nf">Circle</code><code class="o">(</code><code class="kt">double</code> <code class="n">r</code><code class="o">)</code> <code class="o">{</code> <code class="k">this</code><code class="o">.</code><code class="na">r</code> <code class="o">=</code> <code class="n">r</code><code class="o">;</code> <code class="o">}</code></pre>

<p>Because our <code>Circle</code> class has only a single instance field, we can鈥檛
initialize it too many ways, of course. But in more complex classes, it
is often convenient to define a variety of constructors.</p>

<p>It is perfectly legal to define multiple constructors for a class, as
long as each constructor has a different parameter list. The compiler
determines which constructor you wish to use based on the number and
type of arguments you supply. This ability to define multiple
constructors is analogous to method overloading.</p>
</div></section>













<section data-pdf-bookmark="Invoking One Constructor from Another" data-type="sect2"><div class="sect2" id="idm45941130015912">
<h2>Invoking One Constructor from Another</h2>

<p><a data-primary="constructors" data-secondary="invoking one constructor from another" data-type="indexterm" id="4_idm45941129910632"></a><a data-primary="initializing objects" data-secondary="invoking one constructor from another" data-type="indexterm" id="4_idm45941129909688"></a><a data-primary="this keyword" data-type="indexterm" id="4_idm45941129908776"></a>A specialized use of the <code>this</code> keyword arises when a class has
multiple constructors; it can be used from a constructor to invoke one
of the other constructors of the same class. In other words, we can
rewrite the two previous <code>Circle</code> constructors as follows:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// This is the basic constructor: initialize the radius</code>
<code class="kd">public</code> <code class="nf">Circle</code><code class="o">(</code><code class="kt">double</code> <code class="n">r</code><code class="o">)</code> <code class="o">{</code> <code class="k">this</code><code class="o">.</code><code class="na">r</code> <code class="o">=</code> <code class="n">r</code><code class="o">;</code> <code class="o">}</code>
<code class="c1">// This constructor uses this() to invoke the constructor above</code>
<code class="kd">public</code> <code class="nf">Circle</code><code class="o">()</code> <code class="o">{</code> <code class="k">this</code><code class="o">(</code><code class="mf">1.0</code><code class="o">);</code> <code class="o">}</code></pre>

<p>This is a useful technique when a number of constructors share a
significant amount of initialization code, as it avoids repetition of
that code. In more complex cases, where the constructors do a lot more
initialization, this can be a very useful technique.</p>

<p>There is an important restriction on using <code>this()</code>: it can appear only
as the first statement in a constructor鈥攂ut the call may be followed by
any additional initialization a particular constructor needs to perform.
The reason for this restriction involves the automatic invocation of
superclass constructors, which we鈥檒l explore later in this chapter.</p>
</div></section>













<section data-pdf-bookmark="Field Defaults and Initializers" data-type="sect2"><div class="sect2" id="javanut7-CHP-3-SECT-3.4">
<h2>Field Defaults and Initializers</h2>

<p><a data-primary="fields" data-secondary="defaults and initializers" data-type="indexterm" id="4_ix_ch03-asciidoc9"></a><a data-primary="initializing objects" data-secondary="field defaults and initializers" data-type="indexterm" id="4_ix_ch03-asciidoc10"></a>The fields of a class do not necessarily require initialization. If their initial values are not specified, the fields are automatically initialized to the default value <code>false</code>, <code>\u0000</code>, <code>0</code>, <code>0.0</code>, or <code>null</code>, depending on their type (see <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2-TABLE-1">Table 2-1</a> for more details).
These default values are specified by the Java language specification and apply to both instance fields and class fields.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The default values are essentially the 鈥渘atural鈥?interpretation of the zero bit pattern for each type.</p>
</div>

<p>If the default field value is not appropriate for your field, you can instead explicitly provide a different initial value.
For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">static</code> <code class="kd">final</code> <code class="kt">double</code> <code class="n">PI</code> <code class="o">=</code> <code class="mf">3.14159</code><code class="o">;</code>
<code class="kd">public</code> <code class="kt">double</code> <code class="n">r</code> <code class="o">=</code> <code class="mf">1.0</code><code class="o">;</code></pre>

<p>Field declarations are not part of any method.
Instead, the Java compiler generates initialization code for the field automatically and puts it into all the constructors for the class.
The initialization code is inserted into a constructor in the order in which it appears in the source code, which means that a field initializer can use the initial values of any fields declared before it.</p>

<p>Consider the following code excerpt, which shows a constructor and two instance fields of a hypothetical class:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">SampleClass</code> <code class="o">{</code>
  <code class="kd">public</code> <code class="kt">int</code> <code class="n">len</code> <code class="o">=</code> <code class="mi">10</code><code class="o">;</code>
  <code class="kd">public</code> <code class="kt">int</code><code class="o">[]</code> <code class="n">table</code> <code class="o">=</code> <code class="k">new</code> <code class="kt">int</code><code class="o">[</code><code class="n">len</code><code class="o">];</code>

  <code class="kd">public</code> <code class="nf">SampleClass</code><code class="o">()</code> <code class="o">{</code>
    <code class="k">for</code><code class="o">(</code><code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code> <code class="n">i</code> <code class="o">&lt;</code> <code class="n">len</code><code class="o">;</code> <code class="n">i</code><code class="o">++)</code> <code class="n">table</code><code class="o">[</code><code class="n">i</code><code class="o">]</code> <code class="o">=</code> <code class="n">i</code><code class="o">;</code>
  <code class="o">}</code>

  <code class="c1">// The rest of the class is omitted...</code>
<code class="o">}</code></pre>

<p>In this case, the code generated by <code>javac</code> for the constructor is actually equivalent to the following:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="nf">SampleClass</code><code class="o">()</code> <code class="o">{</code>
  <code class="n">len</code> <code class="o">=</code> <code class="mi">10</code><code class="o">;</code>
  <code class="n">table</code> <code class="o">=</code> <code class="k">new</code> <code class="kt">int</code><code class="o">[</code><code class="n">len</code><code class="o">];</code>
  <code class="k">for</code><code class="o">(</code><code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code> <code class="n">i</code> <code class="o">&lt;</code> <code class="n">len</code><code class="o">;</code> <code class="n">i</code><code class="o">++)</code> <code class="n">table</code><code class="o">[</code><code class="n">i</code><code class="o">]</code> <code class="o">=</code> <code class="n">i</code><code class="o">;</code>
<code class="o">}</code></pre>

<p><a data-primary="this()" data-type="indexterm" id="4_idm45941129720616"></a>If a constructor begins with a <code>this()</code> call to another constructor, the
field initialization code does not appear in the first constructor.
Instead, the initialization is handled in the constructor invoked by the
<code>this()</code> call.</p>

<p>So, if instance fields are initialized in constructor, where are class fields initialized?
These fields are associated with the class, even if no instances of the class are ever created.
Logically, this means they need to be initialized even before a constructor is called.</p>

<p><a data-primary="javac" data-secondary="class initialization method generation" data-type="indexterm" id="4_idm45941129641448"></a>To support this, <code>javac</code> generates a class initialization method automatically for every class. Class fields are initialized in the body of this method, which is invoked exactly once before the class is first used (often when the class is first loaded by the Java VM).</p>

<p>As with instance field initialization, class field initialization expressions are inserted into the class initialization method in the order in which they appear in the source code.
This means that the initialization expression for a class field can use the class fields declared before it.</p>

<p>The class initialization method is an internal method that is hidden from Java programmers.
In the class file, it bears the name <code>&lt;clinit&gt;</code> (and you could see this method by, for example, examining the class file with <code>javap</code>鈥攕ee <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch13.html#javanut7-CHP-13">Chapter 13</a> for more details on how to use <code>javap</code> to do this).</p>










<section data-pdf-bookmark="Initializer blocks" data-type="sect3"><div class="sect3" id="idm45941129636216">
<h3>Initializer blocks</h3>

<p><a data-primary="class(es)" data-secondary="initializer blocks" data-type="indexterm" id="4_idm45941129634744"></a><a data-primary="fields" data-secondary="initializer blocks" data-type="indexterm" id="4_idm45941129633768"></a>So far, we鈥檝e seen that objects can be initialized through the initialization expressions for their fields and by arbitrary code in their constructors.
A class has a class initialization method (which is like a constructor), but we cannot explicitly define the body of this method in Java, although it is perfectly legal to do so in bytecode.</p>

<p><a data-primary="static initializer" data-type="indexterm" id="4_idm45941129632072"></a>Java does allow us to express class initialization, however, with a construct known as a <em>static initializer</em>.
A static initializer is simply the keyword <code>static</code> followed by a block of code in curly braces.
A static initializer can appear in a class definition <span class="keep-together">anywhere</span> a field or method definition can appear.
For example, consider the following code that performs some nontrivial initialization for two class fields:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// We can draw the outline of a circle using trigonometric functions</code>
<code class="c1">// Trigonometry is slow, though, so we precompute a bunch of values</code>
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">TrigCircle</code> <code class="o">{</code>
  <code class="c1">// Here are our static lookup tables and their own initializers</code>
  <code class="kd">private</code> <code class="kd">static</code> <code class="kd">final</code> <code class="kt">int</code> <code class="n">NUMPTS</code> <code class="o">=</code> <code class="mi">500</code><code class="o">;</code>
  <code class="kd">private</code> <code class="kd">static</code> <code class="kt">double</code> <code class="n">sines</code><code class="o">[]</code> <code class="o">=</code> <code class="k">new</code> <code class="kt">double</code><code class="o">[</code><code class="n">NUMPTS</code><code class="o">];</code>
  <code class="kd">private</code> <code class="kd">static</code> <code class="kt">double</code> <code class="n">cosines</code><code class="o">[]</code> <code class="o">=</code> <code class="k">new</code> <code class="kt">double</code><code class="o">[</code><code class="n">NUMPTS</code><code class="o">];</code>

  <code class="c1">// Here&apos;s a static initializer that fills in the arrays</code>
  <code class="kd">static</code> <code class="o">{</code>
    <code class="kt">double</code> <code class="n">x</code> <code class="o">=</code> <code class="mf">0.0</code><code class="o">;</code>
    <code class="kt">double</code> <code class="n">delta_x</code> <code class="o">=</code> <code class="o">(</code><code class="n">Circle</code><code class="o">.</code><code class="na">PI</code><code class="o">/</code><code class="mi">2</code><code class="o">)/(</code><code class="n">NUMPTS</code><code class="o">-</code><code class="mi">1</code><code class="o">);</code>
    <code class="k">for</code><code class="o">(</code><code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">,</code> <code class="n">x</code> <code class="o">=</code> <code class="mf">0.0</code><code class="o">;</code> <code class="n">i</code> <code class="o">&lt;</code> <code class="n">NUMPTS</code><code class="o">;</code> <code class="n">i</code><code class="o">++,</code> <code class="n">x</code> <code class="o">+=</code> <code class="n">delta_x</code><code class="o">)</code> <code class="o">{</code>
      <code class="n">sines</code><code class="o">[</code><code class="n">i</code><code class="o">]</code> <code class="o">=</code> <code class="n">Math</code><code class="o">.</code><code class="na">sin</code><code class="o">(</code><code class="n">x</code><code class="o">);</code>
      <code class="n">cosines</code><code class="o">[</code><code class="n">i</code><code class="o">]</code> <code class="o">=</code> <code class="n">Math</code><code class="o">.</code><code class="na">cos</code><code class="o">(</code><code class="n">x</code><code class="o">);</code>
    <code class="o">}</code>
  <code class="o">}</code>
  <code class="c1">// The rest of the class is omitted...</code>
<code class="o">}</code></pre>

<p>A class can have any number of static initializers. The body of each
initializer block is incorporated into the class initialization method,
along with any static field initialization expressions. A static
initializer is like a class method in that it cannot use the <code>this</code>
keyword or any instance fields or instance methods of the class<a data-startref="ix_ch03-asciidoc10" data-type="indexterm" id="4_idm45941129625992"></a><a data-startref="ix_ch03-asciidoc9" data-type="indexterm" id="4_idm45941129625496"></a>.<a data-startref="ix_ch03-asciidoc8" data-type="indexterm" id="4_idm45941129624728"></a><a data-startref="ix_ch03-asciidoc7" data-type="indexterm" id="4_idm45941129467896"></a><a data-startref="ix_ch03-asciidoc6" data-type="indexterm" id="4_idm45941129467224"></a></p>
</div></section>



</div></section>





</div></section>













<section data-pdf-bookmark="Subclasses and Inheritance" data-type="sect1"><div class="sect1" id="idm45941130218696">
<h1>Subclasses and Inheritance</h1>

<p><a data-primary="class(es)" data-secondary="subclasses and inheritance" data-type="indexterm" id="4_ix_ch03-asciidoc11"></a><a data-primary="object-oriented programming" data-secondary="subclasses and inheritance" data-type="indexterm" id="4_ix_ch03-asciidoc12"></a><a data-primary="subclasses" data-secondary="inheritance and" data-type="indexterm" id="4_ix_ch03-asciidoc13"></a>The <code>Circle</code> defined earlier is a simple class that distinguishes
circle objects only by their radii. Suppose, instead, that we want to
represent circles that have both a size and a position. For example, a
circle of radius 1.0 centered at point 0,0 in the Cartesian plane is
different from the circle of radius 1.0 centered at point 1,2. To do
this, we need a new class, which we鈥檒l call <code>PlaneCircle</code>.</p>

<p>We鈥檇 like to add the ability to represent the position of a circle
without losing any of the existing functionality of the <code>Circle</code> class.
We do this by defining <code>PlaneCircle</code> as a subclass of <code>Circle</code> so that
<code>PlaneCircle</code> inherits the fields and methods of its superclass,
<code>Circle</code>. The ability to add functionality to a class by subclassing, or
extending, is central to the object-oriented programming paradigm.</p>








<section data-pdf-bookmark="Extending a Class" data-type="sect2"><div class="sect2" id="idm45941129457240">
<h2>Extending a Class</h2>

<p><a data-primary="class(es)" data-secondary="extending" data-type="indexterm" id="4_ix_ch03-asciidoc14"></a><a data-primary="subclasses" data-secondary="extending a class" data-type="indexterm" id="4_ix_ch03-asciidoc15"></a>In <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3-EX-3">Example 3-3</a>, we show how we can implement
<code>PlaneCircle</code> as a subclass of the <code>Circle</code> class.</p>
<div data-type="example" id="javanut7-CHP-3-EX-3">
<h5><span class="label">Example 3-3. </span>Extending the Circle class</h5>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">PlaneCircle</code> <code class="kd">extends</code> <code class="n">Circle</code> <code class="o">{</code>
  <code class="c1">// We automatically inherit the fields and methods of Circle,</code>
  <code class="c1">// so we only have to put the new stuff here.</code>
  <code class="c1">// New instance fields that store the center point of the circle</code>
  <code class="kd">private</code> <code class="kd">final</code> <code class="kt">double</code> <code class="n">cx</code><code class="o">,</code> <code class="n">cy</code><code class="o">;</code>

  <code class="c1">// A new constructor to initialize the new fields</code>
  <code class="c1">// It uses a special syntax to invoke the Circle() constructor</code>
  <code class="kd">public</code> <code class="nf">PlaneCircle</code><code class="o">(</code><code class="kt">double</code> <code class="n">r</code><code class="o">,</code> <code class="kt">double</code> <code class="n">x</code><code class="o">,</code> <code class="kt">double</code> <code class="n">y</code><code class="o">)</code> <code class="o">{</code>
    <code class="kd">super</code><code class="o">(</code><code class="n">r</code><code class="o">);</code>       <code class="c1">// Invoke the constructor of the superclass, Circle()</code>
    <code class="k">this</code><code class="o">.</code><code class="na">cx</code> <code class="o">=</code> <code class="n">x</code><code class="o">;</code>    <code class="c1">// Initialize the instance field cx</code>
    <code class="k">this</code><code class="o">.</code><code class="na">cy</code> <code class="o">=</code> <code class="n">y</code><code class="o">;</code>    <code class="c1">// Initialize the instance field cy</code>
  <code class="o">}</code>

  <code class="kd">public</code> <code class="kt">double</code> <code class="nf">getCentreX</code><code class="o">()</code> <code class="o">{</code>
    <code class="k">return</code> <code class="n">cx</code><code class="o">;</code>
  <code class="o">}</code>

  <code class="kd">public</code> <code class="kt">double</code> <code class="nf">getCentreY</code><code class="o">()</code> <code class="o">{</code>
    <code class="k">return</code> <code class="n">cy</code><code class="o">;</code>
  <code class="o">}</code>

  <code class="c1">// The area() and circumference() methods are inherited from Circle</code>
  <code class="c1">// A new instance method that checks whether a point is inside the circle</code>
  <code class="c1">// Note that it uses the inherited instance field r</code>
  <code class="kd">public</code> <code class="kt">boolean</code> <code class="nf">isInside</code><code class="o">(</code><code class="kt">double</code> <code class="n">x</code><code class="o">,</code> <code class="kt">double</code> <code class="n">y</code><code class="o">)</code> <code class="o">{</code>
    <code class="kt">double</code> <code class="n">dx</code> <code class="o">=</code> <code class="n">x</code> <code class="o">-</code> <code class="n">cx</code><code class="o">,</code> <code class="n">dy</code> <code class="o">=</code> <code class="n">y</code> <code class="o">-</code> <code class="n">cy</code><code class="o">;</code>             <code class="c1">// Distance from center</code>
    <code class="kt">double</code> <code class="n">distance</code> <code class="o">=</code> <code class="n">Math</code><code class="o">.</code><code class="na">sqrt</code><code class="o">(</code><code class="n">dx</code><code class="o">*</code><code class="n">dx</code> <code class="o">+</code> <code class="n">dy</code><code class="o">*</code><code class="n">dy</code><code class="o">);</code>  <code class="c1">// Pythagorean theorem</code>
    <code class="k">return</code> <code class="o">(</code><code class="n">distance</code> <code class="o">&lt;</code> <code class="n">r</code><code class="o">);</code>                       <code class="c1">// Returns true or false</code>
  <code class="o">}</code>
<code class="o">}</code></pre></div>

<p>Note the use of the keyword <code>extends</code> in the first line of
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3-EX-3">Example 3-3</a>. This keyword tells Java that
<code>PlaneCircle</code> extends, or subclasses, <code>Circle</code>, meaning that it inherits
the fields and methods of that class.</p>

<p>The definition of the <code>isInside()</code> method shows field inheritance;
this method uses the field <code>r</code> (defined by the <code>Circle</code> class) as if it
were defined right in <code>PlaneCircle</code> itself. <code>PlaneCircle</code> also inherits
the methods of <code>Circle</code>. Therefore, if we have a <span class="keep-together"><code>PlaneCircle</code></span> object
referenced by variable <code>pc</code>, we can say:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">double</code> <code class="n">ratio</code> <code class="o">=</code> <code class="n">pc</code><code class="o">.</code><code class="na">circumference</code><code class="o">()</code> <code class="o">/</code> <code class="n">pc</code><code class="o">.</code><code class="na">area</code><code class="o">();</code></pre>

<p>This works just as if the <code>area()</code> and <code>circumference()</code> methods were
defined in <span class="keep-together"><code>PlaneCircle</code></span> itself.</p>

<p>Another feature of subclassing is that every <code>PlaneCircle</code> object is
also a perfectly legal <code>Circle</code> object. If <code>pc</code> refers to a
<code>PlaneCircle</code> object, we can assign it to a <code>Circle</code> variable and forget
all about its extra positioning capabilities:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Unit circle at the origin</code>
<code class="n">PlaneCircle</code> <code class="n">pc</code> <code class="o">=</code> <code class="k">new</code> <code class="n">PlaneCircle</code><code class="o">(</code><code class="mf">1.0</code><code class="o">,</code> <code class="mf">0.0</code><code class="o">,</code> <code class="mf">0.0</code><code class="o">);</code>
<code class="n">Circle</code> <code class="n">c</code> <code class="o">=</code> <code class="n">pc</code><code class="o">;</code>     <code class="c1">// Assigned to a Circle variable without casting</code></pre>

<p>This assignment of a <code>PlaneCircle</code> object to a <code>Circle</code> variable can be
done without a cast. As we discussed in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2">Chapter 2</a>,
a conversion like this is always legal. The value held in the <code>Circle</code>
variable <code>c</code> is still a valid <code>PlaneCircle</code> object, but the compiler
cannot know this for sure, so it doesn鈥檛 allow us to do the opposite
(narrowing) conversion without a cast:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Narrowing conversions require a cast (and a runtime check by the VM)</code>
<code class="n">PlaneCircle</code> <code class="n">pc2</code> <code class="o">=</code> <code class="o">(</code><code class="n">PlaneCircle</code><code class="o">)</code> <code class="n">c</code><code class="o">;</code>
<code class="kt">boolean</code> <code class="n">inside</code> <code class="o">=</code> <code class="o">((</code><code class="n">PlaneCircle</code><code class="o">)</code> <code class="n">c</code><code class="o">).</code><code class="na">isInside</code><code class="o">(</code><code class="mf">0.0</code><code class="o">,</code> <code class="mf">0.0</code><code class="o">);</code></pre>

<p>This distinction is covered in more detail in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4-SECT-5">鈥淣ested Types鈥?/a&gt;, where we talk about the
distinction between the compile and runtime type of an object.</p>










<section data-pdf-bookmark="Final classes" data-type="sect3"><div class="sect3" id="idm45941129212664">
<h3>Final classes</h3>

<p><a data-primary="class(es)" data-secondary="final" data-type="indexterm" id="4_idm45941129211560"></a><a data-primary="final classes" data-type="indexterm" id="4_idm45941129210184"></a><a data-primary="subclasses" data-secondary="final classes and" data-type="indexterm" id="4_idm45941129209512"></a>When a class is declared with the <code>final</code> modifier, it means that it cannot be extended or subclassed. <a data-primary="java.lang.String" data-type="indexterm" id="4_idm45941129208056"></a><code>java.lang.String</code> is an example of a <code>final</code> class.
Declaring a class <code>final</code> prevents unwanted extensions to the class: <a data-primary="String class" data-type="indexterm" id="4_idm45941129108904"></a>if you invoke a method on a <code>String</code> object, you know that the method is the one defined by the <code>String</code> class itself, even if the <code>String</code> is passed to you from some unknown outside source.</p>

<p>In general, many of the classes that Java developers create should be <code>final</code>.
Think carefully about whether it will make sense to allow other (possibly unknown) code to extend your classes鈥攊f it doesn鈥檛, then disallow the mechanism by declaring your classes <code>final</code>.<a data-startref="ix_ch03-asciidoc15" data-type="indexterm" id="4_idm45941129105624"></a><a data-startref="ix_ch03-asciidoc14" data-type="indexterm" id="4_idm45941129104888"></a></p>
</div></section>



</div></section>













<section data-pdf-bookmark="Superclasses, Object, and the Class Hierarchy" data-type="sect2"><div class="sect2" id="idm45941129456616">
<h2>Superclasses, Object, and the Class Hierarchy</h2>

<p><a data-primary="class hierarchy" data-type="indexterm" id="4_idm45941129102552"></a><a data-primary="class(es)" data-secondary="class hierarchy" data-type="indexterm" id="4_idm45941129101624"></a><a data-primary="class(es)" data-secondary="hierarchy" data-type="indexterm" id="4_idm45941129100680"></a><a data-primary="class(es)" data-secondary="superclasses" data-type="indexterm" id="4_idm45941129099736"></a><a data-primary="object-oriented programming" data-secondary="superclasses and class hierarchy" data-type="indexterm" id="4_idm45941129098792"></a><a data-primary="subclasses" data-secondary="superclasses and" data-type="indexterm" id="4_idm45941129097912"></a><a data-primary="superclasses" data-type="indexterm" id="4_idm45941129096968"></a>In our example, <code>PlaneCircle</code> is a subclass of <code>Circle</code>.
We can also say that <code>Circle</code> is the superclass of <code>PlaneCircle</code>.
The superclass of a class is specified in its <code>extends</code> clause, and a class may only have a single direct superclass:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">PlaneCircle</code> <code class="kd">extends</code> <code class="n">Circle</code> <code class="o">{</code> <code class="o">...</code> <code class="o">}</code></pre>

<p>Every class the programmer defines has a superclass.
If the superclass is not specified with an <code>extends</code> clause, then the superclass is taken to be the class <code>java.lang.Object</code>.</p>

<p>As a result, the <code>Object</code> class is special for a couple of reasons:</p>

<ul>
<li>
<p>It is the only class in Java that does not have a superclass.</p>
</li>
<li>
<p>All Java classes inherit (directly or indirectly) the methods of <code>Object</code>.</p>
</li>
</ul>

<p>Because every class (except <code>Object</code>) has a superclass, classes in Java
form a class hierarchy, which can be represented as a tree with
<code>Object</code> at its root.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><code>Object</code> has no superclass, but every other class has exactly one
superclass. A subclass cannot extend more than one superclass. See
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4">Chapter 4</a> for more information on how to achieve a
similar result.</p>
</div>

<p><a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3-FIG-1">Figure 3-1</a> shows a partial class hierarchy
diagram that includes our <code>Circle</code> and <span class="keep-together"><code>PlaneCircle</code></span> classes, as well as
some of the standard classes from the Java API.</p>

<figure><div class="figure" id="javanut7-CHP-3-FIG-1">
<img alt="JN7 0301" data-mfp-src="/library/view/java-in-a/9781492037248/assets/jns7_0301.png" height="612" src="https://learning.oreilly.com/library/view/java-in-a/9781492037248/assets/jns7_0301.png" width="1052"/>
<h6><span class="label">Figure 3-1. </span>A class hierarchy diagram</h6>
</div></figure>
</div></section>













<section data-pdf-bookmark="Subclass Constructors" data-type="sect2"><div class="sect2" id="idm45941129103496">
<h2>Subclass Constructors</h2>

<p><a data-primary="constructors" data-secondary="subclass" data-type="indexterm" id="4_idm45941129050536"></a><a data-primary="subclasses" data-secondary="constructors" data-type="indexterm" id="4_idm45941129049560"></a>Look again at the <code>PlaneCircle()</code> constructor from
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3-EX-3">Example 3-3</a>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="nf">PlaneCircle</code><code class="o">(</code><code class="kt">double</code> <code class="n">r</code><code class="o">,</code> <code class="kt">double</code> <code class="n">x</code><code class="o">,</code> <code class="kt">double</code> <code class="n">y</code><code class="o">)</code> <code class="o">{</code>
  <code class="kd">super</code><code class="o">(</code><code class="n">r</code><code class="o">);</code>       <code class="c1">// Invoke the constructor of the superclass, Circle()</code>
  <code class="k">this</code><code class="o">.</code><code class="na">cx</code> <code class="o">=</code> <code class="n">x</code><code class="o">;</code>    <code class="c1">// Initialize the instance field cx</code>
  <code class="k">this</code><code class="o">.</code><code class="na">cy</code> <code class="o">=</code> <code class="n">y</code><code class="o">;</code>    <code class="c1">// Initialize the instance field cy</code>
<code class="o">}</code></pre>

<p>Although this constructor explicitly initializes the <code>cx</code> and <code>cy</code>
fields newly defined by <code>PlaneCircle</code>, it relies on the superclass
<code>Circle()</code> constructor to initialize the inherited fields of the class.
<a data-primary="super()" data-type="indexterm" id="4_idm45941128990616"></a>To invoke the superclass constructor, our constructor calls <code>super()</code>.</p>

<p><a data-primary="super keyword" data-secondary="as reserved word" data-type="indexterm" id="4_idm45941128989208"></a><code>super</code> is a reserved word in Java.
One of its main uses is to invoke the constructor of a superclass from within a subclass constructor.
This use is analogous to the use of <code>this()</code> to invoke one constructor of a class from within another constructor of the same class.
Invoking a constructor using <code>super()</code> is subject to the same restrictions as is using <code>this()</code>:</p>

<ul>
<li>
<p><code>super()</code> can be used in this way only within a constructor.</p>
</li>
<li>
<p>The call to the superclass constructor must appear as the first
statement within the constructor, even before local variable
declarations.</p>
</li>
</ul>

<p>The arguments passed to <code>super()</code> must match the parameters of the superclass constructor.
If the superclass defines more than one constructor, <code>super()</code> can be used to invoke any one of them, depending on the arguments passed.</p>
</div></section>













<section data-pdf-bookmark="Constructor Chaining and the Default Constructor" data-type="sect2"><div class="sect2" id="idm45941128982008">
<h2>Constructor Chaining and the Default Constructor</h2>

<p><a data-primary="constructors" data-secondary="chaining" data-type="indexterm" id="4_idm45941128980600"></a><a data-primary="subclasses" data-secondary="constructor chaining" data-type="indexterm" id="4_idm45941128979624"></a>Java guarantees that the constructor of a class is called whenever an
instance of that class is created. It also guarantees that the
constructor is called whenever an instance of any subclass is created.
In order to guarantee this second point, Java must ensure that every
constructor calls its superclass constructor.</p>

<p>Thus, if the first statement in a constructor does not explicitly invoke
another constructor with <code>this()</code> or <code>super()</code>, the <code>javac</code> compiler
inserts the call <code>super()</code> (i.e., it calls the superclass constructor
with no arguments). If the superclass does not have a visible
constructor that takes no arguments, this implicit invocation causes a
compilation error.</p>

<p>Consider what happens when we create a new instance of the <code>PlaneCircle</code>
class:</p>
<ol>
<li>
<p>First, the <code>PlaneCircle</code> constructor is invoked.</p>
</li>
<li>
<p>This constructor explicitly calls <code>super(r)</code> to invoke a <code>Circle</code>
constructor.</p>
</li>
<li>
<p>That <code>Circle()</code> constructor implicitly calls <code>super()</code> to invoke the
constructor of its superclass, <code>Object</code> (<code>Object</code> only has one
constructor).</p>
</li>
<li>
<p>At this point, we鈥檝e reached the top of the hierarchy and constructors
start to run.</p>
</li>
<li>
<p>The body of the <code>Object</code> constructor runs first.</p>
</li>
<li>
<p>When it returns, the body of the <code>Circle()</code> constructor runs.</p>
</li>
<li>
<p>Finally, when the call to <code>super(r)</code> returns, the remaining statements
of the <code>PlaneCircle()</code> constructor are executed.</p>
</li>

</ol>

<p>What all this means is that constructor calls are chained; any time an
object is created, a sequence of constructors is invoked, from subclass
to superclass on up to <code>Object</code> at the root of the class hierarchy.</p>

<p>Because a superclass constructor is always invoked as the first
statement of its subclass constructor, the body of the <code>Object</code>
constructor always runs first, followed by the constructor of its
subclass and on down the class hierarchy to the class that is being
instantiated.</p>

<p>Whenever a constructor is invoked, it can count on the fields of its
superclass to be initialized by the time the constructor starts to run.</p>










<section data-pdf-bookmark="The default constructor" data-type="sect3"><div class="sect3" id="idm45941128960280">
<h3>The default constructor</h3>

<p><a data-primary="constructors" data-secondary="default" data-type="indexterm" id="4_idm45941128958840"></a><a data-primary="default constructor" data-type="indexterm" id="4_idm45941128957864"></a><a data-primary="subclasses" data-secondary="default constructor" data-type="indexterm" id="4_idm45941128957192"></a><a data-primary="superclasses" data-secondary="default constructor" data-type="indexterm" id="4_idm45941128956248"></a>There is one missing piece in the previous description of constructor
chaining. If a constructor does not invoke a superclass constructor,
Java does so implicitly.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>If a class is declared without a constructor, Java implicitly adds a constructor to the class. This default constructor does nothing but invoke the superclass constructor.</p>
</div>

<p>For example, if we don鈥檛 declare a constructor for the <code>PlaneCircle</code>
class, Java implicitly inserts this constructor:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="nf">PlaneCircle</code><code class="o">()</code> <code class="o">{</code> <code class="kd">super</code><code class="o">();</code> <code class="o">}</code></pre>

<p>In general, if a class does not define a no-argument constructor, all its subclasses must define constructors that explicitly invoke the superclass constructor with the necessary arguments.</p>

<p>If a class does not declare any constructors, it is given a no-argument
constructor by default. Classes declared <code>public</code> are given <code>public</code>
constructors. All other classes are given a default constructor that is
declared without any visibility modifier: such a constructor has default
visibility.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>If you are creating a <code>public</code> class that should not be publicly
instantiated, declare at least one non-<code>public</code> constructor
to prevent the insertion of a default <code>public</code> constructor.</p>
</div>

<p><a data-primary="private constructor" data-type="indexterm" id="4_idm45941128918536"></a>Classes that should never be instantiated (such as <code>java.lang.Math</code> or <code>java.lang.System</code>) should define a <code>private</code> constructor.
Such a constructor can never be invoked from outside of the class, but it prevents the automatic insertion of the default constructor.</p>
</div></section>



</div></section>













<section data-pdf-bookmark="Hiding Superclass Fields" data-type="sect2"><div class="sect2" id="idm45941128916136">
<h2>Hiding Superclass Fields</h2>

<p><a data-primary="fields" data-secondary="hiding superclass fields" data-type="indexterm" id="4_ix_ch03-asciidoc16"></a><a data-primary="superclasses" data-secondary="hiding superclass fields" data-type="indexterm" id="4_ix_ch03-asciidoc17"></a>For the sake of example, imagine that our <code>PlaneCircle</code> class needs
to know the distance between the center of the circle and the origin
(0,0). We can add another instance field to hold this value:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kt">double</code> <code class="n">r</code><code class="o">;</code></pre>

<p>Adding the following line to the constructor computes the value of the
field:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">this</code><code class="o">.</code><code class="na">r</code> <code class="o">=</code> <code class="n">Math</code><code class="o">.</code><code class="na">sqrt</code><code class="o">(</code><code class="n">cx</code><code class="o">*</code><code class="n">cx</code> <code class="o">+</code> <code class="n">cy</code><code class="o">*</code><code class="n">cy</code><code class="o">);</code>  <code class="c1">// Pythagorean theorem</code></pre>

<p>But wait; this new field <code>r</code> has the same name as the radius field <code>r</code>
in the <code>Circle</code> superclass. When this happens, we say that the field <code>r</code>
of <code>PlaneCircle</code> <em>hides</em> the field <code>r</code> of <code>Circle</code>. (This is a contrived
example, of course: the new field should really be called
<code>distanceFromOrigin</code>.)</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>In code that you write, you should avoid declaring fields with names
that hide superclass fields. It is almost always a sign of bad code.</p>
</div>

<p>With this new definition of <code>PlaneCircle</code>, the expressions <code>r</code> and
<code>this.r</code> both refer to the field of <code>PlaneCircle</code>. How, then, can we
refer to the field <code>r</code> of <code>Circle</code> that holds the radius of the circle?
A special syntax for this uses the <code>super</code> keyword:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">r</code>        <code class="c1">// Refers to the PlaneCircle field</code>
<code class="k">this</code><code class="o">.</code><code class="na">r</code>   <code class="c1">// Refers to the PlaneCircle field</code>
<code class="kd">super</code><code class="o">.</code><code class="na">r</code>  <code class="c1">// Refers to the Circle field</code></pre>

<p>Another way to refer to a hidden field is to cast <code>this</code> (or any
instance of the class) to the appropriate superclass and then access the
field:</p>

<pre data-code-language="java" data-type="programlisting"><code class="o">((</code><code class="n">Circle</code><code class="o">)</code> <code class="k">this</code><code class="o">).</code><code class="na">r</code>   <code class="c1">// Refers to field r of the Circle class</code></pre>

<p>This casting technique is particularly useful when you need to refer to
a hidden field defined in a class that is not the immediate superclass.
Suppose, for example, that classes <code>A</code>, <code>B</code>, and <code>C</code> all define a field
named <code>x</code> and that <code>C</code> is a subclass of <code>B</code>, which is a subclass of <code>A</code>.
Then, in the methods of class <code>C</code>, you can refer to these different
fields as follows:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">x</code>                <code class="c1">// Field x in class C</code>
<code class="k">this</code><code class="o">.</code><code class="na">x</code>           <code class="c1">// Field x in class C</code>
<code class="kd">super</code><code class="o">.</code><code class="na">x</code>          <code class="c1">// Field x in class B</code>
<code class="o">((</code><code class="n">B</code><code class="o">)</code><code class="k">this</code><code class="o">).</code><code class="na">x</code>      <code class="c1">// Field x in class B</code>
<code class="o">((</code><code class="n">A</code><code class="o">)</code><code class="k">this</code><code class="o">).</code><code class="na">x</code>      <code class="c1">// Field x in class A</code>
<code class="kd">super</code><code class="o">.</code><code class="na">super</code><code class="o">.</code><code class="na">x</code>    <code class="c1">// Illegal; does not refer to x in class A</code></pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>You cannot refer to a hidden field <code>x</code> in the superclass of a superclass
with <code>super.super.x</code>. This is not legal syntax.</p>
</div>

<p>Similarly, if you have an instance <code>c</code> of class <code>C</code>, you can refer to
the three fields named <code>x</code> like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">c</code><code class="o">.</code><code class="na">x</code>              <code class="c1">// Field x of class C</code>
<code class="o">((</code><code class="n">B</code><code class="o">)</code><code class="n">c</code><code class="o">).</code><code class="na">x</code>         <code class="c1">// Field x of class B</code>
<code class="o">((</code><code class="n">A</code><code class="o">)</code><code class="n">c</code><code class="o">).</code><code class="na">x</code>         <code class="c1">// Field x of class A</code></pre>

<p>So far, we鈥檝e been discussing instance fields. Class fields can also be
hidden. You can use the same <code>super</code> syntax to refer to the hidden value
of the field, but this is never necessary, as you can always refer to a
class field by prepending the name of the desired class. Suppose, for
example, that the implementer of <code>PlaneCircle</code> decides that the
<code>Circle.PI</code> field does not declare to enough decimal places. She can
define her own class field <code>PI</code>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">static</code> <code class="kd">final</code> <code class="kt">double</code> <code class="n">PI</code> <code class="o">=</code> <code class="mf">3.14159265358979323846</code><code class="o">;</code></pre>

<p>Now code in <code>PlaneCircle</code> can use this more accurate value with the
expressions <code>PI</code> or <code>PlaneCircle.PI</code>. It can also refer to the old, less
accurate value with the expressions <code>super.PI</code> and <code>Circle.PI</code>. However,
the <code>area()</code> and <code>circumference()</code> methods inherited by <code>PlaneCircle</code>
are defined in the <code>Circle</code> class, so they use the value <code>Circle.PI</code>,
even though that value is hidden now by <code>PlaneCircle.PI</code>.<a data-startref="ix_ch03-asciidoc17" data-type="indexterm" id="4_idm45941128617496"></a><a data-startref="ix_ch03-asciidoc16" data-type="indexterm" id="4_idm45941128616760"></a></p>
</div></section>













<section data-pdf-bookmark="Overriding Superclass Methods" data-type="sect2"><div class="sect2" id="idm45941128643384">
<h2>Overriding Superclass Methods</h2>

<p><a data-primary="methods" data-secondary="overriding superclass methods" data-type="indexterm" id="4_ix_ch03-asciidoc18"></a><a data-primary="superclasses" data-secondary="overriding superclass methods" data-type="indexterm" id="4_ix_ch03-asciidoc19"></a>When a class defines an instance method using the same name, return
type, and parameters as a method in its superclass, that method
<em>overrides</em> the method of the superclass. When the method is invoked for
an object of the class, it is the new definition of the method that is
called, not the old definition from the superclass.</p>
<div data-type="tip"><h6>Tip</h6>
<p><a data-primary="covariant return" data-type="indexterm" id="4_idm45941128691736"></a>The return type of the overriding method may be a subclass of the
return type of the original method (instead of being exactly the same
type). This is known as a <em>covariant return</em>.</p>
</div>

<p>Method overriding is an important and useful technique in object-oriented programming.
<code>PlaneCircle</code> does not override either of the methods defined by <code>Circle</code>, and in fact it is difficult to think of a good example where any of the methods defined by <code>Circle</code> could have a well-defined override.</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>Don鈥檛 be tempted to consider subclassing <code>Circle</code> with a class like <code>Ellipse</code>鈥攖his would actually violate a core principle of object-oriented development (the Liskov principle, which we will meet later in this chapter).</p>
</div>

<p>Instead, let鈥檚 look at a different example that does work with method overriding:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">Car</code> <code class="o">{</code>
    <code class="kd">public</code> <code class="kd">static</code> <code class="kd">final</code> <code class="kt">double</code> <code class="n">LITRE_PER_100KM</code> <code class="o">=</code> <code class="mf">8.9</code><code class="o">;</code>

    <code class="kd">protected</code> <code class="kt">double</code> <code class="n">topSpeed</code><code class="o">;</code>

    <code class="kd">protected</code> <code class="kt">double</code> <code class="n">fuelTankCapacity</code><code class="o">;</code>

    <code class="kd">private</code> <code class="kt">int</code> <code class="n">doors</code><code class="o">;</code>

    <code class="kd">public</code> <code class="nf">Car</code><code class="o">(</code><code class="kt">double</code> <code class="n">topSpeed</code><code class="o">,</code> <code class="kt">double</code> <code class="n">fuelTankCapacity</code><code class="o">,</code> <code class="kt">int</code> <code class="n">doors</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">this</code><code class="o">.</code><code class="na">topSpeed</code> <code class="o">=</code> <code class="n">topSpeed</code><code class="o">;</code>
        <code class="k">this</code><code class="o">.</code><code class="na">fuelTankCapacity</code> <code class="o">=</code> <code class="n">fuelTankCapacity</code><code class="o">;</code>
        <code class="k">this</code><code class="o">.</code><code class="na">doors</code> <code class="o">=</code> <code class="n">doors</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">double</code> <code class="nf">getTopSpeed</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">topSpeed</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">int</code> <code class="nf">getDoors</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">doors</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">double</code> <code class="nf">getFuelTankCapacity</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">fuelTankCapacity</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">double</code> <code class="nf">range</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="mi">100</code> <code class="o">*</code> <code class="n">fuelTankCapacity</code> <code class="o">/</code> <code class="n">LITRE_PER_100KM</code><code class="o">;</code>
    <code class="o">}</code>
<code class="o">}</code></pre>

<p>This is a bit more complex, but will illustrate the concepts behind overriding.
Along with the <code>Car</code> class, we also have a specialized class, <code>SportsCar</code>.
This has several differences: it has a fixed-size fuel tank and only comes in a two-door version.
It may also have a much higher top speed than the regular form, but if the top speed rises above 200 km/h then the fuel efficiency of the car suffers, and as a result the overall range of the car starts to decrease:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">SportsCar</code> <code class="kd">extends</code> <code class="n">Car</code> <code class="o">{</code>

    <code class="kd">private</code> <code class="kt">double</code> <code class="n">efficiency</code><code class="o">;</code>

    <code class="kd">public</code> <code class="nf">SportsCar</code><code class="o">(</code><code class="kt">double</code> <code class="n">topSpeed</code><code class="o">)</code> <code class="o">{</code>
        <code class="kd">super</code><code class="o">(</code><code class="n">topSpeed</code><code class="o">,</code> <code class="mf">50.0</code><code class="o">,</code> <code class="mi">2</code><code class="o">);</code>
        <code class="k">if</code> <code class="o">(</code><code class="n">topSpeed</code> <code class="o">&gt;</code> <code class="mf">200.0</code><code class="o">)</code> <code class="o">{</code>
            <code class="n">efficiency</code> <code class="o">=</code> <code class="mf">200.0</code> <code class="o">/</code> <code class="n">topSpeed</code><code class="o">;</code>
        <code class="o">}</code> <code class="k">else</code> <code class="o">{</code>
            <code class="n">efficiency</code> <code class="o">=</code> <code class="mf">1.0</code><code class="o">;</code>
        <code class="o">}</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">double</code> <code class="nf">getEfficiency</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">efficiency</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="nd">@Override</code>
    <code class="kd">public</code> <code class="kt">double</code> <code class="nf">range</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="mi">100</code> <code class="o">*</code> <code class="n">fuelTankCapacity</code> <code class="o">*</code> <code class="n">efficiency</code> <code class="o">/</code> <code class="n">LITRE_PER_100KM</code><code class="o">;</code>
    <code class="o">}</code>

<code class="o">}</code></pre>

<p>The upcoming discussion of method overriding considers only instance
methods. Class (aka static) methods behave quite differently, and they cannot be
overridden. Just like fields, class methods can be hidden by a subclass
but not overridden. As noted earlier in this chapter, it is good
programming style to always prefix a class method invocation with the
name of the class in which it is defined. If you consider the class name
part of the class method name, the two methods have different names, so
nothing is actually hidden at all.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The code example for the <code>SportsCar</code> includes the syntax construct <code>@Override</code>. This is known as an <em>annotation</em> and we shall meet this piece of Java syntax properly in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4">Chapter 4</a>.</p>
</div>

<p>Before we go any further with the discussion of method overriding, you
should understand the difference between method overriding and method
overloading. As we discussed in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2">Chapter 2</a>, method
overloading refers to the practice of defining multiple methods (in the
same class) that have the same name but different parameter lists. This
is very different from method overriding, so don鈥檛 get them confused.</p>










<section data-pdf-bookmark="Overriding is not hiding" data-type="sect3"><div class="sect3" id="idm45941128335736">
<h3>Overriding is not hiding</h3>

<p><a data-primary="field hiding, overriding vs." data-type="indexterm" id="4_idm45941128334360"></a><a data-primary="hidden fields, overriding vs. field hiding" data-type="indexterm" id="4_idm45941128333688"></a><a data-primary="methods" data-secondary="overriding vs. field hiding" data-type="indexterm" id="4_idm45941128333048"></a><a data-primary="overriding" data-secondary="field hiding vs." data-type="indexterm" id="4_idm45941128332136"></a>Although Java treats the fields and methods of a class analogously in
many ways, method overriding is not like field hiding at all. You can
refer to hidden fields simply by casting an object to an instance of the
appropriate superclass, but you cannot invoke overridden instance
methods with this technique. The following code illustrates this crucial
difference:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">class</code> <code class="nc">A</code> <code class="o">{</code>                          <code class="c1">// Define a class named A</code>
  <code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">1</code><code class="o">;</code>                       <code class="c1">// An instance field</code>
  <code class="kt">int</code> <code class="nf">f</code><code class="o">()</code> <code class="o">{</code> <code class="k">return</code> <code class="n">i</code><code class="o">;</code> <code class="o">}</code>            <code class="c1">// An instance method</code>
  <code class="kd">static</code> <code class="kt">char</code> <code class="nf">g</code><code class="o">()</code> <code class="o">{</code> <code class="k">return</code> <code class="sc">A</code><code class="o">;</code> <code class="o">}</code>  <code class="c1">// A class method</code>
<code class="o">}</code>

<code class="kd">class</code> <code class="nc">B</code> <code class="kd">extends</code> <code class="n">A</code> <code class="o">{</code>                <code class="c1">// Define a subclass of A</code>
  <code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">2</code><code class="o">;</code>                       <code class="c1">// Hides field i in class A</code>
  <code class="kt">int</code> <code class="nf">f</code><code class="o">()</code> <code class="o">{</code> <code class="k">return</code> <code class="o">-</code><code class="n">i</code><code class="o">;</code> <code class="o">}</code>           <code class="c1">// Overrides method f in class A</code>
  <code class="kd">static</code> <code class="kt">char</code> <code class="nf">g</code><code class="o">()</code> <code class="o">{</code> <code class="k">return</code> <code class="sc">B</code><code class="o">;</code> <code class="o">}</code>  <code class="c1">// Hides class method g() in class A</code>
<code class="o">}</code>

<code class="kd">public</code> <code class="kd">class</code> <code class="nc">OverrideTest</code> <code class="o">{</code>
  <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code> <code class="n">args</code><code class="o">[])</code> <code class="o">{</code>
    <code class="n">B</code> <code class="n">b</code> <code class="o">=</code> <code class="k">new</code> <code class="n">B</code><code class="o">();</code>               <code class="c1">// Creates a new object of type B</code>
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">b</code><code class="o">.</code><code class="na">i</code><code class="o">);</code>     <code class="c1">// Refers to B.i; prints 2</code>
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">b</code><code class="o">.</code><code class="na">f</code><code class="o">());</code>   <code class="c1">// Refers to B.f(); prints -2</code>
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">b</code><code class="o">.</code><code class="na">g</code><code class="o">());</code>   <code class="c1">// Refers to B.g(); prints B</code>
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">B</code><code class="o">.</code><code class="na">g</code><code class="o">());</code>   <code class="c1">// A better way to invoke B.g()</code>

    <code class="n">A</code> <code class="n">a</code> <code class="o">=</code> <code class="o">(</code><code class="n">A</code><code class="o">)</code> <code class="n">b</code><code class="o">;</code>                 <code class="c1">// Casts b to an instance of class A</code>
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">a</code><code class="o">.</code><code class="na">i</code><code class="o">);</code>     <code class="c1">// Now refers to A.i; prints 1</code>
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">a</code><code class="o">.</code><code class="na">f</code><code class="o">());</code>   <code class="c1">// Still refers to B.f(); prints -2</code>
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">a</code><code class="o">.</code><code class="na">g</code><code class="o">());</code>   <code class="c1">// Refers to A.g(); prints A</code>
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">A</code><code class="o">.</code><code class="na">g</code><code class="o">());</code>   <code class="c1">// A better way to invoke A.g()</code>
  <code class="o">}</code>
<code class="o">}</code></pre>

<p>While this difference between method overriding and field hiding may
seem surprising at first, a little thought makes the purpose clear.</p>

<p>Suppose we are manipulating a bunch of <code>Car</code> and <code>SportsCar</code> objects, and store them in an array of type <code>Car[]</code>. We can do this because <code>SportsCar</code> is a subclass of <code>Car</code>, so all <code>SportsCar</code> objects are legal <code>Car</code> objects.</p>

<p>When we loop through the elements of this array, we don鈥檛 have to know or care whether the element is actually a <code>Car</code> or a <code>SportsCar</code>.
What we do care about very much, however, is that the correct value is computed when we invoke the <code>range()</code> method of any element of the array.
In other words, we don鈥檛 want to use the formula for the range of a car when the object is actually a sports car!</p>

<p>All we really want is for the objects we鈥檙e computing the ranges of to 鈥渄o the right thing鈥濃€攖he <code>Car</code> objects to use their definition of how to compute their own range, and the <code>SportsCar</code> objects to use the definition that is correct for them.</p>

<p>Seen in this context, it is not surprising at all that method overriding is handled differently by Java than is field hiding.</p>
</div></section>













<section data-pdf-bookmark="Virtual method lookup" data-type="sect3"><div class="sect3" id="idm45941128074904">
<h3>Virtual method lookup</h3>

<p><a data-primary="methods" data-secondary="virtual lookup" data-type="indexterm" id="4_idm45941128073464"></a><a data-primary="virtual method lookup" data-type="indexterm" id="4_idm45941128072264"></a>If we have a <code>Car[]</code> array that holds <code>Car</code> and <code>SportsCar</code> objects, how does <code>javac</code> know whether to call the <code>range()</code> method of the <code>Car</code> class or the <code>SportsCar</code> class for any given item in the array?
In fact, the source code compiler cannot know this at compilation time.</p>

<p><a data-primary="javac" data-secondary="virtual method lookup" data-type="indexterm" id="4_idm45941128068104"></a>Instead, <code>javac</code> creates bytecode that uses <em>virtual</em> method lookup at runtime. When the interpreter runs the code, it looks up the appropriate <code>range()</code> method to call for each of the objects in the array.
That is, when the interpreter interprets the expression <code>o.range()</code>, it checks the actual runtime type of the object referred to by the variable <code>o</code> and then finds the <code>range()</code> method that is appropriate for that type.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><a data-primary="C/C++" data-secondary="virtual keyword" data-type="indexterm" id="4_idm45941128063256"></a>Some other languages (such as <code>C#</code> or C++) do not do virtual lookup by
default and instead have a <code>virtual</code> keyword that programmers must
explicitly use if they want to allow subclasses to be able to override a
method.</p>
</div>

<p>This is another way of approaching the concept of method overiding, which we discussed earlier. If the version of the <code>range()</code> method associated with the static type of <code>o</code> was used, without the runtime (aka virtual) lookup, then overriding would not work properly.</p>

<p>Virtual method lookup is the default for Java instance methods.
See <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4">Chapter 4</a> for more details about compile-time and runtime types and how they affect virtual method lookup.</p>
</div></section>













<section data-pdf-bookmark="Invoking an overridden method" data-type="sect3"><div class="sect3" id="idm45941128058056">
<h3>Invoking an overridden method</h3>

<p><a data-primary="methods" data-secondary="invoking an overridden method" data-type="indexterm" id="4_ix_ch03-asciidoc20"></a><a data-primary="overriding" data-secondary="invoking an overridden method" data-type="indexterm" id="4_ix_ch03-asciidoc21"></a><a data-primary="super keyword" data-secondary="invoking an overridden method" data-type="indexterm" id="4_ix_ch03-asciidoc22"></a>We鈥檝e seen the important differences between method overriding and
field hiding. Nevertheless, the Java syntax for invoking an overridden
method is quite similar to the syntax for accessing a hidden field: both
use the <code>super</code> keyword. The following code illustrates:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">class</code> <code class="nc">A</code> <code class="o">{</code>
  <code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">1</code><code class="o">;</code>            <code class="c1">// An instance field hidden by subclass B</code>
  <code class="kt">int</code> <code class="nf">f</code><code class="o">()</code> <code class="o">{</code> <code class="k">return</code> <code class="n">i</code><code class="o">;</code> <code class="o">}</code> <code class="c1">// An instance method overridden by subclass B</code>
<code class="o">}</code>

<code class="kd">class</code> <code class="nc">B</code> <code class="kd">extends</code> <code class="n">A</code> <code class="o">{</code>
  <code class="kt">int</code> <code class="n">i</code><code class="o">;</code>                    <code class="c1">// This field hides i in A</code>
  <code class="kt">int</code> <code class="nf">f</code><code class="o">()</code> <code class="o">{</code>                 <code class="c1">// This method overrides f() in A</code>
    <code class="n">i</code> <code class="o">=</code> <code class="kd">super</code><code class="o">.</code><code class="na">i</code> <code class="o">+</code> <code class="mi">1</code><code class="o">;</code>        <code class="c1">// It can retrieve A.i like this</code>
    <code class="k">return</code> <code class="kd">super</code><code class="o">.</code><code class="na">f</code><code class="o">()</code> <code class="o">+</code> <code class="n">i</code><code class="o">;</code>   <code class="c1">// It can invoke A.f() like this</code>
  <code class="o">}</code>
<code class="o">}</code></pre>

<p>Recall that when you use <code>super</code> to refer to a hidden field, it is the
same as casting <code>this</code> to the superclass type and accessing the field
through that. Using <code>super</code> to invoke an overridden method, however, is
not the same as casting the <code>this</code> reference. In other words, in the
previous code, the expression <code>super.f()</code> is not the same as
<code>((A)this).f()</code>.</p>

<p>When the interpreter invokes an instance method with the <code>super</code> syntax,
a modified form of virtual method lookup is performed. The first step,
as in regular virtual method lookup, is to determine the actual class of
the object through which the method is invoked. Normally, the runtime
search for an appropriate method definition would begin with this class.
When a method is invoked with the <code>super</code> syntax, however, the search
begins at the superclass of the class. If the superclass implements the
method directly, that version of the method is invoked. If the
superclass inherits the method, the inherited version of the method is
invoked.</p>

<p>Note that the <code>super</code> keyword invokes the most immediately overridden
version of a method. Suppose class <code>A</code> has a subclass <code>B</code> that has a
subclass <code>C</code> and that all three classes define the same method <code>f()</code>.
The method <code>C.f()</code> can invoke the method <code>B.f()</code>, which it overrides
directly, with <code>super.f()</code>. But there is no way for <code>C.f()</code> to invoke
<code>A.f()</code> directly: <code>super.super.f()</code> is not legal Java syntax. Of
course, if <code>C.f()</code> invokes <code>B.f()</code>, it is reasonable to suppose that
<code>B.f()</code> might also invoke <code>A.f()</code>.</p>

<p>This kind of chaining is relatively common with overridden
methods: it is a way of augmenting the behavior of a method without
replacing the method entirely.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><a data-primary="super keyword" data-secondary="super() vs." data-type="indexterm" id="4_idm45941127981272"></a><a data-primary="super()" data-type="indexterm" id="4_idm45941127980104"></a>Don鈥檛 confuse the use of <code>super</code> to invoke an overridden method with the
<code>super()</code> method call used in a constructor to invoke a superclass
constructor. Although they both use the same keyword, these are two
entirely different syntaxes. In particular, you can use <code>super</code> to
invoke an overridden method anywhere in the overriding class, while you
can use <code>super()</code> only to invoke a superclass constructor as the very
first statement of a constructor.</p>
</div>

<p>It is also important to remember that <code>super</code> can be used only to invoke an overridden method from within the class that overrides it.
Given a reference to a <code>SportsCar</code> object <code>e</code>, there is no way for a program that uses <code>e</code> to invoke the <code>range()</code> method defined by the <code>Car</code> class on<a data-startref="ix_ch03-asciidoc22" data-type="indexterm" id="4_idm45941127973832"></a><a data-startref="ix_ch03-asciidoc21" data-type="indexterm" id="4_idm45941127973096"></a><a data-startref="ix_ch03-asciidoc20" data-type="indexterm" id="4_idm45941127972424"></a> <code>e</code><a data-startref="ix_ch03-asciidoc19" data-type="indexterm" id="4_idm45941127971336"></a><a data-startref="ix_ch03-asciidoc18" data-type="indexterm" id="4_idm45941127970632"></a>.<a data-startref="ix_ch03-asciidoc13" data-type="indexterm" id="4_idm45941127969832"></a><a data-startref="ix_ch03-asciidoc12" data-type="indexterm" id="4_idm45941127969128"></a><a data-startref="ix_ch03-asciidoc11" data-type="indexterm" id="4_idm45941127968456"></a></p>
</div></section>



</div></section>





</div></section>













<section data-pdf-bookmark="Data Hiding and Encapsulation" data-type="sect1"><div class="sect1" id="javanut7-CHP-3-SECT-5">
<h1>Data Hiding and Encapsulation</h1>

<p><a data-primary="encapsulation" data-type="indexterm" id="4_ix_ch03-asciidoc23"></a><a data-primary="object-oriented programming" data-secondary="data hiding and encapsulation" data-type="indexterm" id="4_ix_ch03-asciidoc24"></a>We started this chapter by describing a class as a collection of data
and methods. One of the most important object-oriented techniques we
haven鈥檛 discussed so far is hiding the data within the class and making
it available only through the methods.</p>

<p>This technique is known as <em>encapsulation</em> because it seals the data (and internal methods) safely inside the 鈥渃apsule鈥?of the class, where it can be accessed only by trusted users (i.e., the methods of the class).</p>

<p>Why would you want to do this? The most important reason is to hide the
internal implementation details of your class. If you prevent
programmers from relying on those details, you can safely modify the
implementation without worrying that you will break existing code that
uses the class.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>You should always encapsulate your code. It is almost always impossible
to reason through and ensure the correctness of code that hasn鈥檛 been
well-encapsulated, especially in multithreaded environments (and
essentially all Java programs are multithreaded).</p>
</div>

<p>Another reason for encapsulation is to protect your class against
accidental or willful stupidity. A class often contains a number of
interdependent fields that must be in a consistent state. If you allow a
programmer (including yourself) to manipulate those fields directly, he
may change one field without changing important related fields, leaving
the class in an inconsistent state. If instead he has to call a method
to change the field, that method can be sure to do everything necessary
to keep the state consistent. Similarly, if a class defines certain
methods for internal use only, hiding these methods prevents users of
the class from calling them.</p>

<p>Here鈥檚 another way to think about encapsulation: when all the data for a
class is hidden, the methods define the only possible operations that
can be performed on objects of that class.</p>

<p>Once you have carefully tested and debugged your methods, you can be
confident that the class will work as expected. On the other hand, if
all the fields of the class can be directly manipulated, the number of
possibilities you have to test becomes unmanageable.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>This idea can be carried to a very powerful conclusion, as we will see
in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch05.html#javanut7-CHP-5-SECT-5">鈥淪afe Java Programming鈥?/a&gt; when we discuss the <em>safety</em>
of Java programs (which differs from the concept of <em>type safety</em> of the
Java programming language).</p>
</div>

<p>Other, secondary, reasons to hide fields and methods of a class include:</p>

<ul>
<li>
<p>Internal fields and methods that are visible outside the class just
clutter up the API. Keeping visible fields to a minimum keeps your class
tidy and therefore easier to use and understand.</p>
</li>
<li>
<p>If a method is visible to the users of your class, you have to
document it. Save yourself time and effort by hiding it instead.</p>
</li>
</ul>








<section data-pdf-bookmark="Access Control" data-type="sect2"><div class="sect2" id="idm45941127952184">
<h2>Access Control</h2>

<p><a data-primary="encapsulation" data-secondary="access control" data-type="indexterm" id="4_ix_ch03-asciidoc25"></a>Java defines access control rules that can restrict members of a class
from being used outside the class. In a number of examples in this
chapter, you鈥檝e seen the <code>public</code> modifier used in field and method
declarations. This <code>public</code> keyword, along with <code>protected</code> and
<code>private</code> (and one other, special one) are <em>access</em> <em>control</em>
<em>modifiers</em>; they specify the access rules for the field or method.</p>










<section data-pdf-bookmark="Access to modules" data-type="sect3"><div class="sect3" id="idm45941127881656">
<h3>Access to modules</h3>

<p><a data-primary="access control" data-secondary="for modules" data-type="indexterm" id="4_idm45941127880456"></a><a data-primary="Java 9" data-secondary="platform modules" data-type="indexterm" id="4_idm45941127879480"></a><a data-primary="modules" data-secondary="access control" data-type="indexterm" id="4_idm45941127878536"></a>One of the biggest changes in Java 9 was the arrival of Java platform modules.
These are a grouping of code that is larger than a single package, and which are intended as the future way to deploy code for reuse.
As Java is often used in large applications and environments, the arrival of modules should make it easier to build and manage enterprise codebases.</p>

<p>The modules technology is an advanced topic, and if Java is one of the first programming languages you have encountered, you should not try to learn it until you have gained some language proficiency.
An introductory treatment of modules is provided in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch12.html#javanut7-CHP-12">Chapter 12</a> and we defer discussing the access control impact of modules until then.</p>
</div></section>













<section data-pdf-bookmark="Access to packages" data-type="sect3"><div class="sect3" id="idm45941127875336">
<h3>Access to packages</h3>

<p><a data-primary="access control" data-secondary="for packages" data-type="indexterm" id="4_idm45941127874136"></a><a data-primary="packages" data-secondary="access control" data-type="indexterm" id="4_idm45941127873160"></a>Access control on a per-package basis is not directly part of the Java
language. Instead, access control is usually done at the level of
classes and members of classes.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>A package that has been loaded is always accessible to code defined
within the same package. Whether it is accessible to code from other
packages depends on the way the package is deployed on the host system.
When the class files that comprise a package are stored in a directory,
for example, a user must have read access to the directory and the files
within it in order to have access to the package.</p>
</div>
</div></section>













<section data-pdf-bookmark="Access to classes" data-type="sect3"><div class="sect3" id="idm45941127870024">
<h3>Access to classes</h3>

<p><a data-primary="access control" data-secondary="for classes" data-type="indexterm" id="4_idm45941127868824"></a><a data-primary="class(es)" data-secondary="access control" data-type="indexterm" id="4_ix_ch03-asciidoc27"></a>By default, top-level classes are accessible within the package in
which they are defined. However, if a top-level class is declared
<code>public</code>, it is accessible everywhere.</p>
<div data-type="tip"><h6>Tip</h6>
<p>In <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4">Chapter 4</a>, we鈥檒l meet nested classes.
These are classes that can be defined as members of other classes.
Because these inner classes are members of a class, they also obey the
member access-control rules.</p>
</div>
</div></section>













<section data-pdf-bookmark="Access to members" data-type="sect3"><div class="sect3" id="idm45941127863512">
<h3>Access to members</h3>

<p><a data-primary="access control" data-secondary="for members of a class" data-type="indexterm" id="4_ix_ch03-asciidoc26"></a><a data-primary="members of a class" data-type="indexterm" id="4_ix_ch03-asciidoc28"></a><a data-primary="package access" data-type="indexterm" id="4_ix_ch03-asciidoc29"></a>The members of a class are always accessible within the body of the
class. By default, members are also accessible throughout the package in
which the class is defined. This default level of access is often
called <em>package access</em>. It is only one of four possible levels of
access. The other three levels are defined by the <code>public</code>, <span class="keep-together"><code>protected</code></span>,
and <code>private</code> modifiers. Here is some example code that uses these
modifiers:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">Laundromat</code> <code class="o">{</code>    <code class="c1">// People can use this class.</code>
  <code class="kd">private</code> <code class="n">Laundry</code><code class="o">[]</code> <code class="n">dirty</code><code class="o">;</code>   <code class="c1">// They cannot use this internal field,</code>
  <code class="kd">public</code> <code class="kt">void</code> <code class="nf">wash</code><code class="o">()</code> <code class="o">{</code> <code class="o">...</code> <code class="o">}</code> <code class="c1">// but they can use these public methods</code>
  <code class="kd">public</code> <code class="kt">void</code> <code class="nf">dry</code><code class="o">()</code> <code class="o">{</code> <code class="o">...</code> <code class="o">}</code>  <code class="c1">// to manipulate the internal field.</code>
  <code class="c1">// A subclass might want to tweak this field</code>
  <code class="kd">protected</code> <code class="kt">int</code> <code class="n">temperature</code><code class="o">;</code>
<code class="o">}</code></pre>

<p>These access rules apply to members of a class:</p>

<ul>
<li>
<p>All the fields and methods of a class can always be used within the
body of the class itself.</p>
</li>
<li>
<p>If a member of a class is declared with the <code>public</code> modifier, it
means that the member is accessible anywhere the containing class is
accessible. This is the least restrictive type of access control.</p>
</li>
<li>
<p>If a member of a class is declared <code>private</code>, the member is never
accessible, except within the class itself. This is the most restrictive
type of access control.</p>
</li>
<li>
<p>If a member of a class is declared <code>protected</code>, it is accessible to
all classes within the package (the same as the default package
accessibility) and also accessible within the body of any subclass of
the class, regardless of the package in which that subclass is defined.</p>
</li>
<li>
<p><a data-primary="default access" data-type="indexterm" id="4_idm45941127811384"></a>If a member of a class is not declared with any of these modifiers, it
has <em>default</em> access (sometimes called <em>package</em> access) and it is
accessible to code within all classes that are defined in the same
package but inaccessible outside of the package.</p>
</li>
</ul>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><a data-primary="protected access" data-type="indexterm" id="4_idm45941127808600"></a>Default access is <em>more</em> restrictive than <code>protected</code>鈥攁s default access
does not allow access by subclasses outside the package.</p>
</div>

<p><code>protected</code> access requires more elaboration. Suppose class <code>A</code> declares
a <code>protected</code> field <code>x</code> and is extended by a class <code>B</code>, which is defined
in a different package (this last point is important). Class <code>B</code>
inherits the <code>protected</code> field <code>x</code>, and its code can access that field
in the current instance of <code>B</code> or in any other instances of <code>B</code> that the
code can refer to. This does not mean, however, that the code of class
<code>B</code> can start reading the protected fields of arbitrary instances of
<code>A</code>.</p>

<p>Let鈥檚 look at this language detail in code. Here鈥檚 the definition for
<code>A</code>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kn">package</code> <code class="n">javanut7</code><code class="o">.</code><code class="na">ch03</code><code class="o">;</code>

<code class="kd">public</code> <code class="kd">class</code> <code class="nc">A</code> <code class="o">{</code>
    <code class="kd">protected</code> <code class="kd">final</code> <code class="n">String</code> <code class="n">name</code><code class="o">;</code>

    <code class="kd">public</code> <code class="nf">A</code><code class="o">(</code><code class="n">String</code> <code class="n">named</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">name</code> <code class="o">=</code> <code class="n">named</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="n">String</code> <code class="nf">getName</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">name</code><code class="o">;</code>
    <code class="o">}</code>
<code class="o">}</code></pre>

<p>Here鈥檚 the definition for <code>B</code>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kn">package</code> <code class="n">javanut7</code><code class="o">.</code><code class="na">ch03</code><code class="o">.</code><code class="na">different</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">javanut7.ch03.A</code><code class="o">;</code>

<code class="kd">public</code> <code class="kd">class</code> <code class="nc">B</code> <code class="kd">extends</code> <code class="n">A</code> <code class="o">{</code>

    <code class="kd">public</code> <code class="nf">B</code><code class="o">(</code><code class="n">String</code> <code class="n">named</code><code class="o">)</code> <code class="o">{</code>
        <code class="kd">super</code><code class="o">(</code><code class="n">named</code><code class="o">);</code>
    <code class="o">}</code>

    <code class="nd">@Override</code>
    <code class="kd">public</code> <code class="n">String</code> <code class="nf">getName</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="s">B: </code> <code class="o">+</code> <code class="n">name</code><code class="o">;</code>
    <code class="o">}</code>
<code class="o">}</code></pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Java packages do not 鈥渘est,鈥?so <code>javanut7.ch03.different</code> is just a
different package than <code>javanut7.ch03</code>; it is not contained inside it or
related to it in any way.</p>
</div>

<p>However, if we try to add this new method to <code>B</code>, we will get a
compilation error, because instances of <code>B</code> do not have access to
arbitary instances of <code>A</code>:</p>

<pre data-code-language="java" data-type="programlisting">    <code class="kd">public</code> <code class="n">String</code> <code class="nf">examine</code><code class="o">(</code><code class="n">A</code> <code class="n">a</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">return</code> <code class="s">B sees: </code> <code class="o">+</code> <code class="n">a</code><code class="o">.</code><code class="na">name</code><code class="o">;</code>
    <code class="o">}</code></pre>

<p>If we change the method to this:</p>

<pre data-code-language="java" data-type="programlisting">    <code class="kd">public</code> <code class="n">String</code> <code class="nf">examine</code><code class="o">(</code><code class="n">B</code> <code class="n">b</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">return</code> <code class="s">B sees another B: </code> <code class="o">+</code> <code class="n">b</code><code class="o">.</code><code class="na">name</code><code class="o">;</code>
    <code class="o">}</code></pre>

<p>then the compiler is happy, because instances of the same exact type can
always see each other鈥檚 <code>protected</code> fields. Of course, if <code>B</code> was in the
same package as <code>A,</code> then any instance of <code>B</code> could read any protected
field of any instance of <code>A</code> because <code>protected</code> fields are visible to
every class in the same package.</p>
</div></section>













<section data-pdf-bookmark="Access control and inheritance" data-type="sect3"><div class="sect3" id="idm45941127623400">
<h3>Access control and inheritance</h3>

<p><a data-primary="access control" data-secondary="inheritance and" data-type="indexterm" id="4_idm45941127560488"></a><a data-primary="inheritance" data-secondary="access control and" data-type="indexterm" id="4_idm45941127559512"></a>The Java specification states that:</p>

<ul>
<li>
<p>A subclass inherits all the instance fields and instance methods of
its superclass accessible to it.</p>
</li>
<li>
<p>If the subclass is defined in the same package as the superclass, it
inherits all non-<code>private</code> instance fields and methods.</p>
</li>
<li>
<p>If the subclass is defined in a different package, it inherits all
<code>protected</code> and <code>public</code> instance fields and methods.</p>
</li>
<li>
<p><code>private</code> fields and methods are never inherited; neither are class
fields or class methods.</p>
</li>
<li>
<p>Constructors are not inherited (instead, they are chained, as
described earlier in this chapter).</p>
</li>
</ul>

<p><a data-primary="subclasses" data-secondary="access control" data-type="indexterm" id="4_idm45941127551528"></a>However, some programmers are confused by the statement that a subclass
does not inherit the inaccessible fields and methods of its superclass.
It could be taken to imply that when you create an instance of a
subclass, no memory is allocated for any <code>private</code> fields defined by the
superclass. This is not the intent of the statement, however.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Every instance of a subclass does, in fact, include a complete instance
of the superclass within it, including all inaccessible fields and
methods.</p>
</div>

<p>This existence of potentially inaccessible members seems to be in
conflict with the statement that the members of a class are always
accessible within the body of the class. To clear up this confusion, we
define 鈥渋nherited members鈥?to mean those superclass members that are
accessible.</p>

<p>Then the correct statement about member accessibility is: 鈥淎ll inherited
members and all members defined in this class are accessible.鈥?An
alternative way of saying this is:</p>

<ul>
<li>
<p>A class inherits <em>all</em> instance fields and instance methods (but not
constructors) of its superclass.</p>
</li>
<li>
<p>The body of a class can always access all the fields and methods it
declares itself. It can also access the <em>accessible</em> fields and members
it inherits from its superclass.</p>
</li>
</ul>
</div></section>













<section data-pdf-bookmark="Member access summary" data-type="sect3"><div class="sect3" id="idm45941127543656">
<h3>Member access summary</h3>

<p>We summarize the member access rules in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3-TABLE-1">Table 3-1</a>.</p>
<table id="javanut7-CHP-3-TABLE-1">
  <caption><span class="label">Table 3-1. </span>Class member accessibility</caption>
  <thead>
    <tr>
      <th> </th>
      <th>Member visibility</th>
      <th> </th>
      <th> </th>
      <th> </th>
    </tr>
    <tr>
      <th>Accessible to</th>
      <th>Public</th>
      <th>Protected</th>
      <th>Default</th>
      <th>Private</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
      <p>Defining class</p>
      </td>
      <td>
      <p>Yes</p>
      </td>
      <td>
      <p>Yes</p>
      </td>
      <td>
      <p>Yes</p>
      </td>
      <td>
      <p>Yes</p>
      </td>
    </tr>
    <tr>
      <td>
      <p>Class in same package</p>
      </td>
      <td>
      <p>Yes</p>
      </td>
      <td>
      <p>Yes</p>
      </td>
      <td>
      <p>Yes</p>
      </td>
      <td>
      <p>No</p>
      </td>
    </tr>
    <tr>
      <td>
      <p>Subclass in different package</p>
      </td>
      <td>
      <p>Yes</p>
      </td>
      <td>
      <p>Yes</p>
      </td>
      <td>
      <p>No</p>
      </td>
      <td>
      <p>No</p>
      </td>
    </tr>
    <tr>
      <td>
      <p>Nonsubclass different package</p>
      </td>
      <td>Yes</td>
      <td>No</td>
      <td>No</td>
      <td>No</td>
    </tr>
  </tbody>
</table>

<p>There are a few generally observed rules about what parts of a Java program should use each visibility modifier. It is important that even beginning Java programmers follow these rules:</p>

<ul>
<li>
<p><a data-primary="public modifier" data-secondary="rules governing" data-type="indexterm" id="4_idm45941127494824"></a>Use <code>public</code> only for methods and constants that form part of the
public API of the class. The only acceptable usage of <code>public</code> fields is
for constants or immutable objects, and they must be also declared
<code>final</code>.</p>
</li>
<li>
<p><a data-primary="protected modifier" data-secondary="rules governing" data-type="indexterm" id="4_idm45941127491480"></a>Use <code>protected</code> for fields and methods that aren鈥檛 required by most
programmers using the class but that may be of interest to anyone
creating a subclass as part of a different package.</p>
</li>
</ul>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><code>protected</code> members are technically part of the exported API of a class.
They must be documented and cannot be changed without potentially
breaking code that relies on them.</p>
</div>

<ul>
<li>
<p>Use the default package visibility for fields and methods that are
internal implementation details but are used by cooperating classes in
the same package.</p>
</li>
<li>
<p><a data-primary="private modifier" data-secondary="rules governing" data-type="indexterm" id="4_idm45941127485944"></a>Use <code>private</code> for fields and methods that are used only inside the
class and should be hidden everywhere else.</p>
</li>
</ul>

<p>If you are not sure whether to use <code>protected</code>, package, or <code>private</code>
accessibility, start with <code>private</code>. If this is overly restrictive, you
can always relax the access restrictions slightly (or provide accessor
methods, in the case of fields).</p>

<p>This is especially important for designing APIs because increasing
access restrictions is not a backward-compatible change and can break
code that relies on access to those members<a data-startref="ix_ch03-asciidoc29" data-type="indexterm" id="4_idm45941127481592"></a><a data-startref="ix_ch03-asciidoc28" data-type="indexterm" id="4_idm45941127480888"></a><a data-startref="ix_ch03-asciidoc27" data-type="indexterm" id="4_idm45941127480216"></a><a data-startref="ix_ch03-asciidoc26" data-type="indexterm" id="4_idm45941127479544"></a>.<a data-startref="ix_ch03-asciidoc25" data-type="indexterm" id="4_idm45941127478744"></a></p>
</div></section>



</div></section>













<section data-pdf-bookmark="Data Accessor Methods" data-type="sect2"><div class="sect2" id="idm45941127477912">
<h2>Data Accessor Methods</h2>

<p><a data-primary="access control" data-secondary="data accessor methods" data-type="indexterm" id="4_ix_ch03-asciidoc30"></a><a data-primary="encapsulation" data-secondary="data accessor methods" data-type="indexterm" id="4_ix_ch03-asciidoc31"></a><a data-primary="methods" data-secondary="data accessor methods" data-type="indexterm" id="4_ix_ch03-asciidoc32"></a>In the <code>Circle</code> example, we declared the circle radius to be a <code>public</code>
field. The <span class="keep-together"><code>Circle</code></span> class is one in which it may well be reasonable to
keep that field publicly accessible; it is a simple enough class, with
no dependencies between its fields. On the other hand, our current
implementation of the class allows a <code>Circle</code> object to have a negative
radius, and circles with negative radii should simply not exist. As long
as the radius is stored in a <code>public</code> field, however, any programmer can
set the field to any value she wants, no matter how unreasonable. The
only solution is to restrict the programmer鈥檚 direct access to the field
and define <code>public</code> methods that provide indirect access to the field.
Providing <code>public</code> methods to read and write a field is not the same as
making the field itself <code>public</code>. The crucial difference is that methods
can perform error checking.</p>

<p>We might, for example, want to prevent <code>Circle</code> objects with negative
radii鈥攖hese are obviously not sensible, but our current implementation
does not prohibit this. In <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3-EX-4">Example 3-4</a>, we
show how we might change the definition of <code>Circle</code> to prevent this.</p>

<p>This version of <code>Circle</code> declares the <code>r</code> field to be <code>protected</code> and
defines accessor methods named <code>getRadius()</code> and <code>setRadius()</code> to read
and write the field value while enforcing the restriction on negative
radius values. Because the <code>r</code> field is <span class="keep-together"><code>protected</code></span>, it is directly (and
more efficiently) accessible to subclasses.</p>
<div data-type="example" id="javanut7-CHP-3-EX-4">
<h5><span class="label">Example 3-4. </span>The Circle class using data hiding and encapsulation</h5>

<pre data-code-language="java" data-type="programlisting"><code class="kn">package</code> <code class="n">shapes</code><code class="o">;</code>           <code class="c1">// Specify a package for the class</code>

<code class="kd">public</code> <code class="kd">class</code> <code class="nc">Circle</code> <code class="o">{</code>     <code class="c1">// The class is still public</code>
  <code class="c1">// This is a generally useful constant, so we keep it public</code>
  <code class="kd">public</code> <code class="kd">static</code> <code class="kd">final</code> <code class="kt">double</code> <code class="n">PI</code> <code class="o">=</code> <code class="mf">3.14159</code><code class="o">;</code>

  <code class="kd">protected</code> <code class="kt">double</code> <code class="n">r</code><code class="o">;</code>     <code class="c1">// Radius is hidden but visible to subclasses</code>

  <code class="c1">// A method to enforce the restriction on the radius</code>
  <code class="c1">// This is an implementation detail that may be of interest to subclasses</code>
  <code class="kd">protected</code> <code class="kt">void</code> <code class="nf">checkRadius</code><code class="o">(</code><code class="kt">double</code> <code class="n">radius</code><code class="o">)</code> <code class="o">{</code>
    <code class="k">if</code> <code class="o">(</code><code class="n">radius</code> <code class="o">&lt;</code> <code class="mf">0.0</code><code class="o">)</code>
      <code class="k">throw</code> <code class="k">new</code> <code class="nf">IllegalArgumentException</code><code class="o">(</code><code class="s">radius may not be negative.</code><code class="o">);</code>
  <code class="o">}</code>

  <code class="c1">// The non-default constructor</code>
  <code class="kd">public</code> <code class="nf">Circle</code><code class="o">(</code><code class="kt">double</code> <code class="n">r</code><code class="o">)</code> <code class="o">{</code>
    <code class="n">checkRadius</code><code class="o">(</code><code class="n">r</code><code class="o">);</code>
    <code class="k">this</code><code class="o">.</code><code class="na">r</code> <code class="o">=</code> <code class="n">r</code><code class="o">;</code>
  <code class="o">}</code>

  <code class="c1">// Public data accessor methods</code>
  <code class="kd">public</code> <code class="kt">double</code> <code class="nf">getRadius</code><code class="o">()</code> <code class="o">{</code> <code class="k">return</code> <code class="n">r</code><code class="o">;</code> <code class="o">}</code>
  <code class="kd">public</code> <code class="kt">void</code> <code class="nf">setRadius</code><code class="o">(</code><code class="kt">double</code> <code class="n">r</code><code class="o">)</code> <code class="o">{</code>
    <code class="n">checkRadius</code><code class="o">(</code><code class="n">r</code><code class="o">);</code>
    <code class="k">this</code><code class="o">.</code><code class="na">r</code> <code class="o">=</code> <code class="n">r</code><code class="o">;</code>
  <code class="o">}</code>

  <code class="c1">// Methods to operate on the instance field</code>
  <code class="kd">public</code> <code class="kt">double</code> <code class="nf">area</code><code class="o">()</code> <code class="o">{</code> <code class="k">return</code> <code class="n">PI</code> <code class="o">*</code> <code class="n">r</code> <code class="o">*</code> <code class="n">r</code><code class="o">;</code> <code class="o">}</code>
  <code class="kd">public</code> <code class="kt">double</code> <code class="nf">circumference</code><code class="o">()</code> <code class="o">{</code> <code class="k">return</code> <code class="mi">2</code> <code class="o">*</code> <code class="n">PI</code> <code class="o">*</code> <code class="n">r</code><code class="o">;</code> <code class="o">}</code>
<code class="o">}</code></pre></div>

<p>We have defined the <code>Circle</code> class within a package named <code>shapes</code>; <code>r</code> is <code>protected</code> so any other classes in the <code>shapes</code> package
have direct access to that field and can set it however they like. The
assumption here is that all classes within the <code>shapes</code> package were
written by the same author or a closely cooperating group of authors, and
that the classes all trust each other not to abuse their privileged
level of access to each other鈥檚 implementation details.</p>

<p>Finally, the code that enforces the restriction against negative radius
values is itself placed within a <code>protected</code> method, <code>checkRadius()</code>.
Although users of the <code>Circle</code> class cannot call this method, subclasses
of the class can call it and even override it if they want to change the
restrictions on the radius.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>It is a common convention in Java that data accessor methods begin with
the prefixes 鈥済et鈥?and 鈥渟et.鈥?But if the field being accessed is of type
<code>boolean</code>, the <code>get()</code> method may be replaced with an equivalent method
that begins with 鈥渋s鈥濃€攖he accessor method for a <code>boolean</code>
field named <code>readable</code> is typically called <code>isReadable()</code> instead of
<code>getReadable()</code><a data-startref="ix_ch03-asciidoc32" data-type="indexterm" id="4_idm45941127319400"></a><a data-startref="ix_ch03-asciidoc31" data-type="indexterm" id="4_idm45941127318696"></a><a data-startref="ix_ch03-asciidoc30" data-type="indexterm" id="4_idm45941127318024"></a>.<a data-startref="ix_ch03-asciidoc24" data-type="indexterm" id="4_idm45941127317224"></a><a data-startref="ix_ch03-asciidoc23" data-type="indexterm" id="4_idm45941127316520"></a></p>
</div>
</div></section>





</div></section>













<section data-pdf-bookmark="Abstract Classes and Methods" data-type="sect1"><div class="sect1" id="javanut7-CHP-3-SECT-6">
<h1>Abstract Classes and Methods</h1>

<p><a data-primary="abstract classes" data-type="indexterm" id="4_ix_ch03-asciidoc33"></a><a data-primary="abstract methods" data-type="indexterm" id="4_ix_ch03-asciidoc34"></a><a data-primary="class(es)" data-secondary="abstract" data-type="indexterm" id="4_ix_ch03-asciidoc35"></a><a data-primary="methods" data-secondary="abstract" data-type="indexterm" id="4_ix_ch03-asciidoc36"></a><a data-primary="object-oriented programming" data-secondary="abstract classes and methods" data-type="indexterm" id="4_ix_ch03-asciidoc37"></a>In <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3-EX-4">Example 3-4</a>, we declared our <code>Circle</code>
class to be part of a package named <code>shapes</code>. Suppose we plan to
implement a number of shape classes: <code>Rectangle</code>, <code>Square</code>, <code>Hexagon</code>,
<code>Triangle</code>, and so on. We can give these shape classes our two basic
<code>area()</code> and <code>circumference()</code> methods. Now, to make it easy to work
with an array of shapes, it would be helpful if all our shape classes
had a common superclass, <code>Shape</code>. If we structure our class hierarchy
this way, every shape object, regardless of the actual type of shape it
represents, can be assigned to variables, fields, or array elements of
type <code>Shape</code>. We want the <code>Shape</code> class to encapsulate whatever features
all our shapes have in common (e.g., the <code>area()</code> and <code>circumference()</code>
methods). But our generic <code>Shape</code> class doesn鈥檛 represent any real kind
of shape, so it cannot define useful implementations of the methods.
Java handles this situation with <em>abstract methods</em>.</p>

<p>Java lets us define a method without implementing it by declaring the
method with the <code>abstract</code> modifier. An <code>abstract</code> method has no body;
it simply has a signature definition followed by a semicolon.<sup><a class="totri-footnote" data-type="noteref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#idm45941127298824" id="idm45941127298824-marker">2</a></sup> Here are the rules about <code>abstract</code> methods and the
<code>abstract</code> classes that contain them:</p>

<ul>
<li>
<p>Any class with an <code>abstract</code> method is automatically <code>abstract</code> itself
and must be declared as such. To fail to do so is a compilation error.</p>
</li>
<li>
<p>An <code>abstract</code> class cannot be instantiated.</p>
</li>
<li>
<p>A subclass of an <code>abstract</code> class can be instantiated only if it
overrides each of the <code>abstract</code> methods of its superclass and provides
an implementation (i.e., a method body) for all of them. Such a class is
often called a <em>concrete</em> subclass, to emphasize the fact that it is not
<code>abstract</code>.</p>
</li>
<li>
<p>If a subclass of an <code>abstract</code> class does not implement all the
<code>abstract</code> methods it inherits, that subclass is itself <code>abstract</code> and
must be declared as such.</p>
</li>
<li>
<p><code>static</code>, <code>private</code>, and <code>final</code> methods cannot be <code>abstract</code>, because
these types of methods cannot be overridden by a subclass. Similarly, a
<code>final</code> class cannot contain any <code>abstract</code> methods.</p>
</li>
<li>
<p>A class can be declared <code>abstract</code> even if it does not actually have
any <code>abstract</code> methods. Declaring such a class <code>abstract</code> indicates that
the implementation is somehow incomplete and is meant to serve as a
superclass for one or more subclasses that complete the implementation.
Such a class cannot be <span class="keep-together">instantiated</span>.</p>
</li>
</ul>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The <code>Classloader</code> class that we will meet in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch11.html#javanut7-CHP-11">Chapter 11</a> is a good example of an abstract class
that does not have any abstract methods.</p>
</div>

<p>Let鈥檚 look at an example of how these rules work. If we define the
<code>Shape</code> class to have <code>abstract</code> <code>area()</code> and <code>circumference()</code> methods,
any subclass of <code>Shape</code> is required to provide implementations of these
methods so that it can be instantiated. In other words, every <code>Shape</code>
object is guaranteed to have implementations of these methods defined.
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3-EX-5">Example 3-5</a> shows how this might work. It
defines an <code>abstract</code> <code>Shape</code> class and two concrete subclasses of it.</p>
<div data-type="example" id="javanut7-CHP-3-EX-5">
<h5><span class="label">Example 3-5. </span>An abstract class and concrete subclasses</h5>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">abstract</code> <code class="kd">class</code> <code class="nc">Shape</code> <code class="o">{</code>
  <code class="kd">public</code> <code class="kd">abstract</code> <code class="kt">double</code> <code class="nf">area</code><code class="o">();</code>            <code class="c1">// Abstract methods: note</code>
  <code class="kd">public</code> <code class="kd">abstract</code> <code class="kt">double</code> <code class="nf">circumference</code><code class="o">();</code>   <code class="c1">// semicolon instead of body.</code>
<code class="o">}</code>

<code class="kd">class</code> <code class="nc">Circle</code> <code class="kd">extends</code> <code class="n">Shape</code> <code class="o">{</code>
  <code class="kd">public</code> <code class="kd">static</code> <code class="kd">final</code> <code class="kt">double</code> <code class="n">PI</code> <code class="o">=</code> <code class="mf">3.14159265358979323846</code><code class="o">;</code>
  <code class="kd">protected</code> <code class="kt">double</code> <code class="n">r</code><code class="o">;</code>                              <code class="c1">// Instance data</code>
  <code class="kd">public</code> <code class="nf">Circle</code><code class="o">(</code><code class="kt">double</code> <code class="n">r</code><code class="o">)</code> <code class="o">{</code> <code class="k">this</code><code class="o">.</code><code class="na">r</code> <code class="o">=</code> <code class="n">r</code><code class="o">;</code> <code class="o">}</code>          <code class="c1">// Constructor</code>
  <code class="kd">public</code> <code class="kt">double</code> <code class="nf">getRadius</code><code class="o">()</code> <code class="o">{</code> <code class="k">return</code> <code class="n">r</code><code class="o">;</code> <code class="o">}</code>          <code class="c1">// Accessor</code>
  <code class="kd">public</code> <code class="kt">double</code> <code class="nf">area</code><code class="o">()</code> <code class="o">{</code> <code class="k">return</code> <code class="n">PI</code><code class="o">*</code><code class="n">r</code><code class="o">*</code><code class="n">r</code><code class="o">;</code> <code class="o">}</code>          <code class="c1">// Implementations of</code>
  <code class="kd">public</code> <code class="kt">double</code> <code class="nf">circumference</code><code class="o">()</code> <code class="o">{</code> <code class="k">return</code> <code class="mi">2</code><code class="o">*</code><code class="n">PI</code><code class="o">*</code><code class="n">r</code><code class="o">;</code> <code class="o">}</code> <code class="c1">// abstract methods.</code>
<code class="o">}</code>

<code class="kd">class</code> <code class="nc">Rectangle</code> <code class="kd">extends</code> <code class="n">Shape</code> <code class="o">{</code>
  <code class="kd">protected</code> <code class="kt">double</code> <code class="n">w</code><code class="o">,</code> <code class="n">h</code><code class="o">;</code>                               <code class="c1">// Instance data</code>
  <code class="kd">public</code> <code class="nf">Rectangle</code><code class="o">(</code><code class="kt">double</code> <code class="n">w</code><code class="o">,</code> <code class="kt">double</code> <code class="n">h</code><code class="o">)</code> <code class="o">{</code>               <code class="c1">// Constructor</code>
    <code class="k">this</code><code class="o">.</code><code class="na">w</code> <code class="o">=</code> <code class="n">w</code><code class="o">;</code>  <code class="k">this</code><code class="o">.</code><code class="na">h</code> <code class="o">=</code> <code class="n">h</code><code class="o">;</code>
  <code class="o">}</code>
  <code class="kd">public</code> <code class="kt">double</code> <code class="nf">getWidth</code><code class="o">()</code> <code class="o">{</code> <code class="k">return</code> <code class="n">w</code><code class="o">;</code> <code class="o">}</code>               <code class="c1">// Accessor method</code>
  <code class="kd">public</code> <code class="kt">double</code> <code class="nf">getHeight</code><code class="o">()</code> <code class="o">{</code> <code class="k">return</code> <code class="n">h</code><code class="o">;</code> <code class="o">}</code>              <code class="c1">// Another accessor</code>
  <code class="kd">public</code> <code class="kt">double</code> <code class="nf">area</code><code class="o">()</code> <code class="o">{</code> <code class="k">return</code> <code class="n">w</code><code class="o">*</code><code class="n">h</code><code class="o">;</code> <code class="o">}</code>                 <code class="c1">// Implementation of</code>
  <code class="kd">public</code> <code class="kt">double</code> <code class="nf">circumference</code><code class="o">()</code> <code class="o">{</code> <code class="k">return</code> <code class="mi">2</code><code class="o">*(</code><code class="n">w</code> <code class="o">+</code> <code class="n">h</code><code class="o">);</code> <code class="o">}</code>  <code class="c1">// abstract methods</code>
<code class="o">}</code></pre></div>

<p>Each <code>abstract</code> method in <code>Shape</code> has a semicolon right after its
parentheses. They have no curly braces, and no method body is defined.
Using the classes defined in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3-EX-5">Example 3-5</a>, we
can now write code such as:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Shape</code><code class="o">[]</code> <code class="n">shapes</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Shape</code><code class="o">[</code><code class="mi">3</code><code class="o">];</code>        <code class="c1">// Create an array to hold shapes</code>
<code class="n">shapes</code><code class="o">[</code><code class="mi">0</code><code class="o">]</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Circle</code><code class="o">(</code><code class="mf">2.0</code><code class="o">);</code>          <code class="c1">// Fill in the array</code>
<code class="n">shapes</code><code class="o">[</code><code class="mi">1</code><code class="o">]</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Rectangle</code><code class="o">(</code><code class="mf">1.0</code><code class="o">,</code> <code class="mf">3.0</code><code class="o">);</code>
<code class="n">shapes</code><code class="o">[</code><code class="mi">2</code><code class="o">]</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Rectangle</code><code class="o">(</code><code class="mf">4.0</code><code class="o">,</code> <code class="mf">2.0</code><code class="o">);</code>

<code class="kt">double</code> <code class="n">totalArea</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code>
<code class="k">for</code><code class="o">(</code><code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code> <code class="n">i</code> <code class="o">&lt;</code> <code class="n">shapes</code><code class="o">.</code><code class="na">length</code><code class="o">;</code> <code class="n">i</code><code class="o">++)</code>
    <code class="n">totalArea</code> <code class="o">+=</code> <code class="n">shapes</code><code class="o">[</code><code class="n">i</code><code class="o">].</code><code class="na">area</code><code class="o">();</code>   <code class="c1">// Compute the area of the shapes</code></pre>

<p>Notice two important points here:</p>

<ul>
<li>
<p>Subclasses of <code>Shape</code> can be assigned to elements of an array of
<code>Shape</code>. No cast is necessary. This is another example of a widening
reference type conversion (discussed in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2">Chapter 2</a>).</p>
</li>
<li>
<p>You can invoke the <code>area()</code> and <code>circumference()</code> methods for any
<code>Shape</code> object, even though the <code>Shape</code> class does not define a body for
these methods. When you do this, the method to be invoked is found using
virtual dispatch, which we met earlier.
In our case this means that the area of a circle is computed using the method defined by <code>Circle</code>, and the area of a rectangle is computed using the method defined by <code>Rectangle</code>.</p>
</li>
</ul>








<section data-pdf-bookmark="Reference Type Conversions" data-type="sect2"><div class="sect2" id="javanut7-CHP-3-SECT-6.1">
<h2>Reference Type Conversions</h2>

<p><a data-primary="conversions" data-secondary="reference types" data-type="indexterm" id="4_ix_ch03-asciidoc38"></a><a data-primary="object references" data-type="indexterm" id="4_ix_ch03-asciidoc39"></a><a data-primary="reference types" data-secondary="conversions" data-type="indexterm" id="4_ix_ch03-asciidoc40"></a>Object references can be converted between different reference types. As with primitive types, reference type conversions can be widening conversions
(allowed automatically by the compiler) or narrowing conversions that
require a cast (and possibly a runtime check). <a data-primary="class hierarchy" data-type="indexterm" id="4_idm45941126975048"></a>In order to understand
reference type conversions, you need to understand that reference types
form a hierarchy, usually called the <em>class hierarchy</em>.</p>

<p><a data-primary="superclasses" data-secondary="reference type conversions" data-type="indexterm" id="4_idm45941126973400"></a>Every Java reference type <em>extends</em> some other type, known as its
<em>superclass</em>. A type inherits the fields and methods of its superclass
and then defines its own additional fields and methods. <a data-primary="Object class" data-type="indexterm" id="4_idm45941126971144"></a>A special class named <code>Object</code> serves as the root of the class hierarchy in Java. All
Java classes extend <code>Object</code> directly or indirectly. The <code>Object</code> class
defines a number of special methods that are inherited (or overridden)
by all objects.</p>

<p><a data-primary="String class" data-secondary="reference type conversions and" data-type="indexterm" id="4_idm45941126968744"></a>The predefined <code>String</code> class and the <a data-primary="Point class" data-type="indexterm" id="4_idm45941126966808"></a><code>Point</code> class we discussed earlier
in this chapter both extend <code>Object</code>. Thus, we can say that all <code>String</code>
objects are also <code>Object</code> objects. We can also say that all <code>Point</code>
objects are <code>Object</code> objects. The opposite is not true, however. We
cannot say that every <code>Object</code> is a <code>String</code> because, as we鈥檝e just
seen, some <code>Object</code> objects are <code>Point</code> objects.</p>

<p>With this simple understanding of the class hierarchy, we can define the
rules of reference type conversion:</p>

<ul>
<li>
<p>An object reference cannot be converted to an unrelated type. The Java compiler does not allow you to convert a <code>String</code> to a <code>Point</code>, for example, even if you use a cast operator.</p>
</li>
<li>
<p>An object reference can be converted to the type of its superclass or of any ancestor class. This is a widening conversion, so no cast is required.
For example, a <code>String</code> value can be assigned to a variable of type
<code>Object</code> or passed to a method where an <code>Object</code> parameter is expected.</p>
</li>
</ul>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>No conversion is actually performed; the object is simply treated as if
it were an instance of the superclass. This is a simple form of
the Liskov substitution principle, after Barbara Liskov, the computer
scientist who first explicitly formulated it.</p>
</div>

<ul>
<li>
<p><a data-primary="casts" data-secondary="conversion rules and" data-type="indexterm" id="4_idm45941126954328"></a>An object reference can be converted to the type of a subclass, but this is a narrowing conversion and requires a cast. The Java compiler
provisionally allows this kind of conversion, but the Java interpreter
checks at runtime to make sure it is valid. Only cast a reference to the
type of a subclass if you are sure, based on the logic of your program,
that the object is actually an instance of the subclass. If it is not,
the interpreter throws a <code>ClassCastException</code>. For example, if we assign
a <code>String</code> reference to a variable of type <code>Object</code>, we can later cast the
value of that variable back to type <code>String</code>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Object</code> <code class="n">o</code> <code class="o">=</code> <code class="s">string</code><code class="o">;</code>    <code class="c1">// Widening conversion from String</code>
                        <code class="c1">// to Object later in the program...</code>
<code class="n">String</code> <code class="n">s</code> <code class="o">=</code> <code class="o">(</code><code class="n">String</code><code class="o">)</code> <code class="n">o</code><code class="o">;</code>  <code class="c1">// Narrowing conversion from Object</code>
                        <code class="c1">// to String</code></pre>
</li>
</ul>

<p><a data-primary="arrays" data-secondary="conversion rules" data-type="indexterm" id="4_idm45941126938792"></a>Arrays are objects and follow some conversion rules of their own.
First, any array can be converted to an <code>Object</code> value through a
widening conversion. A narrowing conversion with a cast can convert such
an object value back to an array. Here鈥檚 an example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Widening conversion from array to Object</code>
<code class="n">Object</code> <code class="n">o</code> <code class="o">=</code> <code class="k">new</code> <code class="kt">int</code><code class="o">[]</code> <code class="o">{</code><code class="mi">1</code><code class="o">,</code><code class="mi">2</code><code class="o">,</code><code class="mi">3</code><code class="o">};</code>
<code class="c1">// Later in the program...</code>

<code class="kt">int</code><code class="o">[]</code> <code class="n">a</code> <code class="o">=</code> <code class="o">(</code><code class="kt">int</code><code class="o">[])</code> <code class="n">o</code><code class="o">;</code>      <code class="c1">// Narrowing conversion back to array type</code></pre>

<p>In addition to converting an array to an object, we can convert an array to another type of array if the 鈥渂ase types鈥?of the two arrays
are reference types that can themselves be converted. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Here is an array of strings.</code>
<code class="n">String</code><code class="o">[]</code> <code class="n">strings</code> <code class="o">=</code> <code class="k">new</code> <code class="n">String</code><code class="o">[]</code> <code class="o">{</code> <code class="s">hi</code><code class="o">,</code> <code class="s">there</code> <code class="o">};</code>
<code class="c1">// A widening conversion to CharSequence[] is allowed because String</code>
<code class="c1">// can be widened to CharSequence</code>
<code class="n">CharSequence</code><code class="o">[]</code> <code class="n">sequences</code> <code class="o">=</code> <code class="n">strings</code><code class="o">;</code>
<code class="c1">// The narrowing conversion back to String[] requires a cast.</code>
<code class="n">strings</code> <code class="o">=</code> <code class="o">(</code><code class="n">String</code><code class="o">[])</code> <code class="n">sequences</code><code class="o">;</code>
<code class="c1">// This is an array of arrays of strings</code>
<code class="n">String</code><code class="o">[][]</code> <code class="n">s</code> <code class="o">=</code> <code class="k">new</code> <code class="n">String</code><code class="o">[][]</code> <code class="o">{</code> <code class="n">strings</code> <code class="o">};</code>
<code class="c1">// It cannot be converted to CharSequence[] because String[] cannot be</code>
<code class="c1">// converted to CharSequence: the number of dimensions don&apos;t match</code>

<code class="n">sequences</code> <code class="o">=</code> <code class="n">s</code><code class="o">;</code>  <code class="c1">// This line will not compile</code>
<code class="c1">// s can be converted to Object or Object[], because all array types</code>
<code class="c1">// (including String[] and String[][]) can be converted to Object.</code>
<code class="n">Object</code><code class="o">[]</code> <code class="n">objects</code> <code class="o">=</code> <code class="n">s</code><code class="o">;</code></pre>

<p>Note that these array conversion rules apply only to arrays of objects
and arrays of arrays. An array of primitive type cannot be converted to
any other array type, even if the primitive base types can be converted<a data-startref="ix_ch03-asciidoc40" data-type="indexterm" id="4_idm45941126661448"></a><a data-startref="ix_ch03-asciidoc39" data-type="indexterm" id="4_idm45941126660840"></a><a data-startref="ix_ch03-asciidoc38" data-type="indexterm" id="4_idm45941126628984"></a>:<a data-startref="ix_ch03-asciidoc37" data-type="indexterm" id="4_idm45941126628184"></a><a data-startref="ix_ch03-asciidoc36" data-type="indexterm" id="4_idm45941126627480"></a><a data-startref="ix_ch03-asciidoc35" data-type="indexterm" id="4_idm45941126626808"></a><a data-startref="ix_ch03-asciidoc34" data-type="indexterm" id="4_idm45941126626136"></a><a data-startref="ix_ch03-asciidoc33" data-type="indexterm" id="4_idm45941126625464"></a></p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Can&apos;t convert int[] to double[] even though</code>
<code class="c1">// int can be widened to double</code>
<code class="c1">// This line causes a compilation error</code>
<code class="kt">double</code><code class="o">[]</code> <code class="n">data</code> <code class="o">=</code> <code class="k">new</code> <code class="kt">int</code><code class="o">[]</code> <code class="o">{</code><code class="mi">1</code><code class="o">,</code><code class="mi">2</code><code class="o">,</code><code class="mi">3</code><code class="o">};</code>
<code class="c1">// This line is legal, however,</code>
<code class="c1">// because int[] can be converted to Object</code>
<code class="n">Object</code><code class="o">[]</code> <code class="n">objects</code> <code class="o">=</code> <code class="k">new</code> <code class="kt">int</code><code class="o">[][]</code> <code class="o">{{</code><code class="mi">1</code><code class="o">,</code><code class="mi">2</code><code class="o">},{</code><code class="mi">3</code><code class="o">,</code><code class="mi">4</code><code class="o">}};</code></pre>
</div></section>





</div></section>













<section data-pdf-bookmark="Modifier Summary" data-type="sect1"><div class="sect1" id="idm45941127315384">
<h1>Modifier Summary</h1>

<p class="pagebreak-after"><a data-primary="object-oriented programming" data-secondary="modifier summary" data-type="indexterm" id="4_idm45941126527688"></a>As we鈥檝e seen, classes, interfaces, and their members can be
declared with one or more <em>modifiers</em>鈥攌eywords such as <code>public</code>,
<code>static</code>, and <code>final</code>. Let鈥檚 conclude this chapter by listing the Java
modifiers, explaining what types of Java constructs they can modify,
and explaining what they do. <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3-TABLE-2">Table 3-2</a>
has the details; you can also refer back to
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3-SECT-1">鈥淥verview of Classes鈥?/a&gt; and
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3-SECT-2.1">鈥淔ield Declaration Syntax鈥?/a&gt;, as well as
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2-SECT-6.2">鈥淢ethod Modifiers鈥?/a&gt;.<a data-startref="ix_ch03-asciidoc0" data-type="indexterm" id="4_idm45941126598824"></a></p>
<table id="javanut7-CHP-3-TABLE-2">
<caption><span class="label">Table 3-2. </span>Java modifiers</caption>
<thead>
<tr>
<th>Modifier</th>
<th>Used on</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><code>abstract</code></p></td>
<td><p>Class</p></td>
<td><p>The class cannot be instantiated and may contain
unimplemented methods.</p></td>
</tr>
<tr>
<td></td>
<td><p>Interface</p></td>
<td><p>All interfaces are <code>abstract</code>. The modifier is optional
in interface declarations.</p></td>
</tr>
<tr>
<td></td>
<td><p>Method</p></td>
<td><p>No body is provided for the method; it is provided by a
subclass. The signature is followed by a semicolon. The enclosing class
must also be <code>abstract</code>.</p></td>
</tr>
<tr>
<td><p><code>default</code></p></td>
<td><p>Method</p></td>
<td><p>Implementation of this interface method is optional.
The interface provides a default implementation for classes that elect
not to implement it. See <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4">Chapter 4</a> for more
details.</p></td>
</tr>
<tr>
<td><p><code>final</code></p></td>
<td><p>Class</p></td>
<td><p>The class cannot be subclassed.</p></td>
</tr>
<tr>
<td></td>
<td><p>Method</p></td>
<td><p>The method cannot be overridden.</p></td>
</tr>
<tr>
<td></td>
<td><p>Field</p></td>
<td><p>The field cannot have its value changed. <code>static final</code>
fields are compile-time constants.</p></td>
</tr>
<tr>
<td></td>
<td><p>Variable</p></td>
<td><p>A local variable, method parameter, or exception parameter
cannot have its value changed.</p></td>
</tr>
<tr>
<td><p><code>native</code></p></td>
<td><p>Method</p></td>
<td><p>The method is implemented in some platform-dependent
way (often in C). No body is provided; the signature is followed by a
semicolon.</p></td>
</tr>
<tr>
<td><p>&lt;None&gt; (package)</p></td>
<td><p>Class</p></td>
<td><p>A non-<code>public</code> class is accessible only in its
package.</p></td>
</tr>
<tr>
<td></td>
<td><p>Interface</p></td>
<td><p>A non-<code>public</code> interface is accessible only in its
package.</p></td>
</tr>
<tr>
<td></td>
<td><p>Member</p></td>
<td><p>A member that is not <code>private</code>, <code>protected</code>, or <code>public</code> has
package visibility and is accessible only within its package.</p></td>
</tr>
<tr>
<td><p><code>private</code></p></td>
<td><p>Member</p></td>
<td><p>The member is accessible only within the class
that defines it.</p></td>
</tr>
<tr>
<td><p><code>protected</code></p></td>
<td><p>Member</p></td>
<td><p>The member is accessible only within the package
in which it is defined and within subclasses.</p></td>
</tr>
<tr>
<td><p><code>public</code></p></td>
<td><p>Class</p></td>
<td><p>The class is accessible anywhere its package is.</p></td>
</tr>
<tr>
<td></td>
<td><p>Interface</p></td>
<td><p>The interface is accessible anywhere its package is.</p></td>
</tr>
<tr>
<td></td>
<td><p>Member</p></td>
<td><p>The member is accessible anywhere its class is.</p></td>
</tr>
<tr>
<td><p><code>strictfp</code></p></td>
<td><p>Class</p></td>
<td><p>All methods of the class are implicitly <code>strictfp</code>.</p></td>
</tr>
<tr>
<td></td>
<td><p>Method</p></td>
<td><p>All floating-point computation done by the method must be
performed in a way that strictly conforms to the IEEE 754 standard. In
particular, all values, including intermediate results, must be
expressed as IEEE <code>float</code> or <code>double</code> values and cannot take advantage
of any extra precision or range offered by native platform
floating-point formats or hardware. This modifier is extremely rarely
used.</p></td>
</tr>
<tr>
<td><p><code>static</code></p></td>
<td><p>Class</p></td>
<td><p>An inner class declared <code>static</code> is a top-level
class, not associated with a member of the containing class. See
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4">Chapter 4</a> for more details.</p></td>
</tr>
<tr>
<td></td>
<td><p>Method</p></td>
<td><p>A <code>static</code> method is a class method. It is not passed an
implicit <code>this</code> object reference. It can be invoked through the class
name.</p></td>
</tr>
<tr>
<td></td>
<td><p>Field</p></td>
<td><p>A <code>static</code> field is a class field. There is only one instance
of the field, regardless of the number of class instances created. It
can be accessed through the class name.</p></td>
</tr>
<tr>
<td></td>
<td><p>Initializer</p></td>
<td><p>The initializer is run when the class is loaded rather
than when an instance is created.</p></td>
</tr>
<tr>
<td><p><code>synchronized</code></p></td>
<td><p>Method</p></td>
<td><p>The method makes nonatomic modifications to the
class or instance, so care must be taken to ensure that two threads
cannot modify the class or instance at the same time. For a <code>static</code>
method, a lock for the class is acquired before executing the method.
For a non-<code>static</code> method, a lock for the specific object instance is
acquired. See <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch05.html#javanut7-CHP-5">Chapter 5</a> for more details.</p></td>
</tr>
<tr>
<td><p><code>transient</code></p></td>
<td><p>Field</p></td>
<td><p>The field is not part of the persistent state of
the object and should not be serialized with the object. Used with
object serialization; see <code>java.io.ObjectOutputStream</code>.</p></td>
</tr>
<tr>
<td><p><code>volatile</code></p></td>
<td><p>Field</p></td>
<td><p>The field can be accessed by unsynchronized threads,
so certain optimizations must not be performed on it. This modifier can
sometimes be used as an alternative to <code>synchronized</code>. See
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch05.html#javanut7-CHP-5">Chapter 5</a> for more details.</p></td>
</tr>
</tbody>
</table>
</div></section>







<div data-type="footnotes"><p data-type="footnote" id="idm45941130889240"><sup><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#idm45941130889240-marker">1</a></sup> There is also the default, aka package, visibility that we will meet later.</p><p data-type="footnote" id="idm45941127298824"><sup><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#idm45941127298824-marker">2</a></sup> An <code>abstract</code> method in Java is something like a pure virtual function in C++ (i.e., a virtual function that is declared <code>= 0</code>). In C++, a class that contains a pure virtual function is called an abstract class and cannot be instantiated. The same is true of Java classes that contain <code>abstract</code> methods.</p></div></div></section><div class="annotator-outer annotator-viewer viewer annotator-hide"> </div></div></div>
    </section>
  </div>
</div>
<div class="font-flyout" style="top: 201.019px; left: 2474px;"> </div>
<hr/>

<!--if IE]><![endif]--><!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/java-in-a/9781492037248/ch04.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="3866890"
  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"
  data-username="levinxccai"
  data-account-type="B2B"
  
  data-activated-trial-date="11/06/2017"


  data-archive="9781492037248"
  data-publishers="O&#39;Reilly Media, Inc."



  data-htmlfile-name="ch04.html"
  data-epub-title="Java in a Nutshell, 7th Edition" data-debug=0 data-testing=0><![endif]--><!--if gt IE 8]><!--><!--![endif]-->



<a name="5_"></a>
<div id="MathJax_Message" style="display: none;"></div>
<div class="application" id="container" style="height: auto;">
  <div class="js-toc">
    <section role="document">
      <div id="sbo-rt-content" style="max-width:72.5em; transform: none;"><div class="annotator-wrapper"><section data-nutshell-tab="Type System" data-pdf-bookmark="Chapter 4. The Java Type System" data-type="chapter" epub:type="chapter"><div class="chapter" id="javanut7-CHP-4">
<h1><span class="label">Chapter 4. </span>The Java Type System</h1>


<p><a data-primary="type system" data-type="indexterm" id="5_ix_ch04-asciidoc0"></a>In this chapter, we move beyond basic object-oriented programming with classes and into the additional concepts required to work effectively with Java鈥檚 type system.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><a data-primary="statically typed language" data-type="indexterm" id="5_idm45941126456728"></a>A <em>statically typed</em> language is one in which variables have definite types, and where it is a compile-time error to assign a value of an incompatible type to a variable.
<a data-primary="dynamically typed language" data-type="indexterm" id="5_idm45941126455304"></a>Languages that only check type compatibility at runtime are called <em>dynamically typed</em>.</p>
</div>

<p>Java is a fairly classic example of a statically typed language. JavaScript is an example of a dynamically typed language that allows any variable to store any type of value.</p>

<p>The Java type system involves not only classes and primitive types, but also other kinds of reference type that are related to the basic concept of a class, but which differ in some way, and are usually treated in a special way by <code>javac</code> or the JVM.</p>

<p>We have already met arrays and classes, two of Java鈥檚 most widely used kinds of reference type. This chapter starts by discussing another very important kind of reference type鈥?em&gt;interfaces</em>.
We then move on to discuss Java鈥檚 <em>generics</em>, which have a major role to play in Java鈥檚 type system. With these topics under our belts, we can discuss the differences between compile-time and runtime types in Java.</p>

<p>To complete the full picture of Java鈥檚 reference types, we look at specialized kinds of classes and interfaces鈥攌nown as <em>enums</em> and <em>annotations</em>.
We conclude the chapter by looking at <em>lambda expressions</em> and <em>nested types</em>, and then reviewing how enhanced type inference has allowed Java鈥檚 <em>non-denotable types</em> to become usable by <span class="keep-together">programmers</span>.</p>

<p>Let鈥檚 get started by taking a look at interfaces鈥攑robably the most important of Java鈥檚 reference types after classes, and a key building block for the rest of Java鈥檚 type <span class="keep-together">system</span>.</p>






<section data-pdf-bookmark="Interfaces" data-type="sect1"><div class="sect1" id="idm45941126445368">
<h1>Interfaces</h1>

<p><a data-primary="interfaces" data-type="indexterm" id="5_ix_ch04-asciidoc1"></a><a data-primary="type system" data-secondary="interfaces" data-type="indexterm" id="5_ix_ch04-asciidoc2"></a>In <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3">Chapter 3</a>, we met the idea of inheritance. We also saw that a Java class can only inherit from a single class.
This is quite a big restriction on the kinds of object-oriented programs that we want to build.
The designers of Java knew this, but they also wanted to ensure that Java鈥檚 approach to object-oriented programming was less complex and error-prone than, for example, that of C++.</p>

<p>The solution that they chose was to introduce the concept of an interface to Java.
Like a class, an <em>interface</em> defines a new reference type.
As its name implies, an interface is intended to represent only an API鈥攕o it
provides a description of a type, and the methods (and signatures) that
classes that <em>implement</em> that API must provide.</p>

<p>In general, a Java interface does not provide any implementation code for the methods that it describes. These methods are considered <em>mandatory</em>鈥攁ny class that wishes to implement the interface must provide an implementation of these <span class="keep-together">methods</span>.</p>

<p>However, an interface may wish to mark that some API methods are optional, and that implementing classes do not need to implement them if they choose not to.
This is done with the <code>default</code> keyword鈥攁nd the interface must provide an implementation of these optional methods, which will be used by any implementating class that elects not to implement them.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><a data-primary="Java 8" data-secondary="interfaces in" data-type="indexterm" id="5_idm45941126434776"></a>The ability to have optional methods in interfaces was new in Java 8.
It is not available in any earlier version. See <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4-SECT-1.5">鈥淒efault Methods鈥?/a&gt; for a full description of how optional (also called default) methods work.</p>
</div>

<p>It is not possible to directly instantiate an interface and create a member of the interface type. Instead, a class must <em>implement</em> the interface to provide the necessary method bodies.</p>

<p>Any instances of the implementing class are <em>compatible with</em> both the type defined by the class and the type defined by the interface.
This means that the instances may be substituted at any point in the code that requires an instance of either the class type or the interface type.
This extends the Liskov principle as seen in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3-SECT-6.1">鈥淩eference Type Conversions鈥?/a&gt;.</p>

<p>Another way of saying this is that two objects that do not share the same class or superclass may still both be compatible with the same interface type if both objects are instances of classes that implement the interface.</p>








<section data-pdf-bookmark="Defining an Interface" data-type="sect2"><div class="sect2" id="idm45941126428824">
<h2>Defining an Interface</h2>

<p><a data-primary="interfaces" data-secondary="defining" data-type="indexterm" id="5_idm45941126427448"></a>An interface definition is much like a class definition in which all the (nondefault) methods are abstract and the keyword <code>class</code> has been replaced with <code>interface</code>.
For example, this code shows the definition of an interface named <span class="keep-together"><code>Centered</code></span> (a <code>Shape</code> class, such as those defined in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3">Chapter 3</a>, might implement this interface if it wants to allow the coordinates of its center to be set and queried):</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">interface</code> <code class="nc">Centered</code> <code class="o">{</code>
  <code class="kt">void</code> <code class="nf">setCenter</code><code class="o">(</code><code class="kt">double</code> <code class="n">x</code><code class="o">,</code> <code class="kt">double</code> <code class="n">y</code><code class="o">);</code>
  <code class="kt">double</code> <code class="nf">getCenterX</code><code class="o">();</code>
  <code class="kt">double</code> <code class="nf">getCenterY</code><code class="o">();</code>
<code class="o">}</code></pre>

<p><a data-primary="interfaces" data-secondary="restrictions on" data-type="indexterm" id="5_idm45941126403768"></a>A number of restrictions apply to the members of an interface:</p>

<ul>
<li>
<p>All mandatory methods of an interface are implicitly <code>abstract</code> and must have a semicolon in place of a method body. The <code>abstract</code> modifier is allowed, but by convention is usually omitted.</p>
</li>
<li>
<p>An interface defines a public API. By convention, members of an interface are implicitly <code>public</code> and it is conventional to omit the unnecessary <code>public</code> <span class="keep-together">modifier</span>.</p>
</li>
<li>
<p>An interface may not define any instance fields. Fields are an implementation detail, and an interface is a specification, not an implementation.
The only fields allowed in an interface definition are constants that are declared both <code>static</code> and <code>final</code>.</p>
</li>
<li>
<p>An interface cannot be instantiated, so it does not define a constructor.</p>
</li>
<li>
<p>Interfaces may contain nested types.
Any such types are implicitly <code>public</code> and <code>static</code>. See <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4-SECT-5">鈥淣ested Types鈥?/a&gt; for a full description of nested types.</p>
</li>
<li>
<p><a data-primary="Java 8" data-secondary="static methods" data-type="indexterm" id="5_idm45941126388584"></a>As of Java 8, an interface may contain static methods. Previous
versions of Java did not allow this, and this is widely believed to have
been a flaw in the design of the Java language.</p>
</li>
<li>
<p>As of Java 9, an interface may contain <code>private</code> methods.
These have limited use cases, but with the other changes to the interface construct, it seems arbitary to disallow them.
It is a compile-time error to try to define a <code>protected</code> method in an interface.</p>
</li>
</ul>
</div></section>













<section data-pdf-bookmark="Extending Interfaces" data-type="sect2"><div class="sect2" id="idm45941126385160">
<h2>Extending Interfaces</h2>

<p><a data-primary="extending interfaces" data-type="indexterm" id="5_idm45941126383960"></a><a data-primary="extends clause" data-type="indexterm" id="5_idm45941126383256"></a><a data-primary="interfaces" data-secondary="extending" data-type="indexterm" id="5_idm45941126382584"></a>Interfaces may extend other interfaces, and, like a class definition,
an interface definition indicates this by including an <code>extends</code> clause. When one interface extends another, it inherits all the methods and constants of its superinterface and can define new methods and constants.
Unlike classes, however, the <code>extends</code> clause of an interface definition may include more than one superinterface.
For example, here are some interfaces that extend other interfaces:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">interface</code> <code class="nc">Positionable</code> <code class="kd">extends</code> <code class="n">Centered</code> <code class="o">{</code>
  <code class="kt">void</code> <code class="nf">setUpperRightCorner</code><code class="o">(</code><code class="kt">double</code> <code class="n">x</code><code class="o">,</code> <code class="kt">double</code> <code class="n">y</code><code class="o">);</code>
  <code class="kt">double</code> <code class="nf">getUpperRightX</code><code class="o">();</code>
  <code class="kt">double</code> <code class="nf">getUpperRightY</code><code class="o">();</code>
<code class="o">}</code>
<code class="kd">interface</code> <code class="nc">Transformable</code> <code class="kd">extends</code> <code class="n">Scalable</code><code class="o">,</code> <code class="n">Translatable</code><code class="o">,</code> <code class="n">Rotatable</code> <code class="o">{}</code>
<code class="kd">interface</code> <code class="nc">SuperShape</code> <code class="kd">extends</code> <code class="n">Positionable</code><code class="o">,</code> <code class="n">Transformable</code> <code class="o">{}</code></pre>

<p>An interface that extends more than one interface inherits all the methods and constants from each of those interfaces and can define its own additional methods and constants. A class that implements such an interface must implement the abstract methods defined directly by the interface, as well as all the abstract methods inherited from all the superinterfaces.</p>
</div></section>













<section data-pdf-bookmark="Implementing an Interface" data-type="sect2"><div class="sect2" id="idm45941126314312">
<h2>Implementing an Interface</h2>

<p><a data-primary="interfaces" data-secondary="implementing" data-type="indexterm" id="5_ix_ch04-asciidoc3"></a>Just as a class uses <code>extends</code> to specify its superclass, it can use <code>implements</code> to name one or more interfaces it supports.
<a data-primary="implements keyword" data-type="indexterm" id="5_idm45941126310440"></a>The <code>implements</code> keyword can appear in a class declaration following the <code>extends</code> clause.
It should be followed by a comma-separated list of interfaces that the class implements.</p>

<p>When a class declares an interface in its <code>implements</code> clause, it is
saying that it provides an implementation (i.e., a body) for each
mandatory method of that interface. If a class implements an interface
but does not provide an implementation for every mandatory interface
method, it inherits those unimplemented <code>abstract</code> methods from the
interface and must itself be declared <code>abstract</code>. If a class implements
more than one interface, it must implement every mandatory method of
each interface it implements (or be declared <code>abstract</code>).</p>

<p>The following code shows how we can define a <code>CenteredRectangle</code> class
that extends the <code>Rectangle</code> class from
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3">Chapter 3</a> and implements our <code>Centered</code>
<span class="keep-together">interface</span>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">CenteredRectangle</code> <code class="kd">extends</code> <code class="n">Rectangle</code> <code class="kd">implements</code> <code class="n">Centered</code> <code class="o">{</code>
  <code class="c1">// New instance fields</code>
  <code class="kd">private</code> <code class="kt">double</code> <code class="n">cx</code><code class="o">,</code> <code class="n">cy</code><code class="o">;</code>

  <code class="c1">// A constructor</code>
  <code class="kd">public</code> <code class="nf">CenteredRectangle</code><code class="o">(</code><code class="kt">double</code> <code class="n">cx</code><code class="o">,</code> <code class="kt">double</code> <code class="n">cy</code><code class="o">,</code> <code class="kt">double</code> <code class="n">w</code><code class="o">,</code> <code class="kt">double</code> <code class="n">h</code><code class="o">)</code> <code class="o">{</code>
    <code class="kd">super</code><code class="o">(</code><code class="n">w</code><code class="o">,</code> <code class="n">h</code><code class="o">);</code>
    <code class="k">this</code><code class="o">.</code><code class="na">cx</code> <code class="o">=</code> <code class="n">cx</code><code class="o">;</code>
    <code class="k">this</code><code class="o">.</code><code class="na">cy</code> <code class="o">=</code> <code class="n">cy</code><code class="o">;</code>
  <code class="o">}</code>

  <code class="c1">// We inherit all the methods of Rectangle but must</code>
  <code class="c1">// provide implementations of all the Centered methods.</code>
  <code class="kd">public</code> <code class="kt">void</code> <code class="nf">setCenter</code><code class="o">(</code><code class="kt">double</code> <code class="n">x</code><code class="o">,</code> <code class="kt">double</code> <code class="n">y</code><code class="o">)</code> <code class="o">{</code> <code class="n">cx</code> <code class="o">=</code> <code class="n">x</code><code class="o">;</code> <code class="n">cy</code> <code class="o">=</code> <code class="n">y</code><code class="o">;</code> <code class="o">}</code>
  <code class="kd">public</code> <code class="kt">double</code> <code class="nf">getCenterX</code><code class="o">()</code> <code class="o">{</code> <code class="k">return</code> <code class="n">cx</code><code class="o">;</code> <code class="o">}</code>
  <code class="kd">public</code> <code class="kt">double</code> <code class="nf">getCenterY</code><code class="o">()</code> <code class="o">{</code> <code class="k">return</code> <code class="n">cy</code><code class="o">;</code> <code class="o">}</code>
<code class="o">}</code></pre>

<p>Suppose we implement <code>CenteredCircle</code> and <code>CenteredSquare</code> just as we
have implemented this <code>CenteredRectangle</code> class. Each class extends
<code>Shape</code>, so instances of the classes can be treated as instances of the
<code>Shape</code> class, as we saw earlier. Because each class implements the
<code>Centered</code> interface, instances can also be treated as instances of that
type. The following code demonstrates how objects can be members of
both a class type and an interface type:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Shape</code><code class="o">[]</code> <code class="n">shapes</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Shape</code><code class="o">[</code><code class="mi">3</code><code class="o">];</code>      <code class="c1">// Create an array to hold shapes</code>

<code class="c1">// Create some centered shapes, and store them in the Shape[]</code>
<code class="c1">// No cast necessary: these are all compatible assignments</code>
<code class="n">shapes</code><code class="o">[</code><code class="mi">0</code><code class="o">]</code> <code class="o">=</code> <code class="k">new</code> <code class="n">CenteredCircle</code><code class="o">(</code><code class="mf">1.0</code><code class="o">,</code> <code class="mf">1.0</code><code class="o">,</code> <code class="mf">1.0</code><code class="o">);</code>
<code class="n">shapes</code><code class="o">[</code><code class="mi">1</code><code class="o">]</code> <code class="o">=</code> <code class="k">new</code> <code class="n">CenteredSquare</code><code class="o">(</code><code class="mf">2.5</code><code class="o">,</code> <code class="mi">2</code><code class="o">,</code> <code class="mi">3</code><code class="o">);</code>
<code class="n">shapes</code><code class="o">[</code><code class="mi">2</code><code class="o">]</code> <code class="o">=</code> <code class="k">new</code> <code class="n">CenteredRectangle</code><code class="o">(</code><code class="mf">2.3</code><code class="o">,</code> <code class="mf">4.5</code><code class="o">,</code> <code class="mi">3</code><code class="o">,</code> <code class="mi">4</code><code class="o">);</code>

<code class="c1">// Compute average area of the shapes and</code>
<code class="c1">// average distance from the origin</code>
<code class="kt">double</code> <code class="n">totalArea</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code>
<code class="kt">double</code> <code class="n">totalDistance</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code>
<code class="k">for</code><code class="o">(</code><code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code> <code class="n">i</code> <code class="o">&lt;</code> <code class="n">shapes</code><code class="o">.</code><code class="na">length</code><code class="o">;</code> <code class="n">i</code><code class="o">++)</code> <code class="o">{</code>
  <code class="n">totalArea</code> <code class="o">+=</code> <code class="n">shapes</code><code class="o">[</code><code class="n">i</code><code class="o">].</code><code class="na">area</code><code class="o">();</code>   <code class="c1">// Compute the area of the shapes</code>

  <code class="c1">// Be careful, in general, the use of instanceof to determine the</code>
  <code class="c1">// runtime type of an object is quite often an indication of a</code>
  <code class="c1">// problem with the design</code>
  <code class="k">if</code> <code class="o">(</code><code class="n">shapes</code><code class="o">[</code><code class="n">i</code><code class="o">]</code> <code class="k">instanceof</code> <code class="n">Centered</code><code class="o">)</code> <code class="o">{</code> <code class="c1">// The shape is a Centered shape</code>
    <code class="c1">// Note the required cast from Shape to Centered (no cast would</code>
    <code class="c1">// be required to go from CenteredSquare to Centered, however).</code>
    <code class="n">Centered</code> <code class="n">c</code> <code class="o">=</code> <code class="o">(</code><code class="n">Centered</code><code class="o">)</code> <code class="n">shapes</code><code class="o">[</code><code class="n">i</code><code class="o">];</code>

    <code class="kt">double</code> <code class="n">cx</code> <code class="o">=</code> <code class="n">c</code><code class="o">.</code><code class="na">getCenterX</code><code class="o">();</code>    <code class="c1">// Get coordinates of the center</code>
    <code class="kt">double</code> <code class="n">cy</code> <code class="o">=</code> <code class="n">c</code><code class="o">.</code><code class="na">getCenterY</code><code class="o">();</code>    <code class="c1">// Compute distance from origin</code>
    <code class="n">totalDistance</code> <code class="o">+=</code> <code class="n">Math</code><code class="o">.</code><code class="na">sqrt</code><code class="o">(</code><code class="n">cx</code><code class="o">*</code><code class="n">cx</code> <code class="o">+</code> <code class="n">cy</code><code class="o">*</code><code class="n">cy</code><code class="o">);</code>
  <code class="o">}</code>
<code class="o">}</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Average area: </code> <code class="o">+</code> <code class="n">totalArea</code><code class="o">/</code><code class="n">shapes</code><code class="o">.</code><code class="na">length</code><code class="o">);</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Average distance: </code> <code class="o">+</code> <code class="n">totalDistance</code><code class="o">/</code><code class="n">shapes</code><code class="o">.</code><code class="na">length</code><code class="o">);</code></pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Interfaces are data types in Java, just like classes. When a class
implements an interface, instances of that class can be assigned to
variables of the interface type.</p>
</div>

<p>Don鈥檛 interpret this example to imply that you must assign a <code>CenteredRectangle</code> object to a <code>Centered</code> variable before you can invoke the <code>setCenter()</code> method or to a <code>Shape</code> variable before invoking the <code>area()</code> method. Instead, because the CenteredRectangle class defines <code>setCenter()</code> and inherits <code>area()</code> from its <code>Rectangle</code> superclass, you can always invoke these methods.</p>

<p>As we could see by examining the bytecode (e.g., by using the <code>javap</code> tool we will meet in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch13.html#javanut7-CHP-13">Chapter 13</a>), the JVM calls the <code>setCenter()</code> method slightly differently depending on whether the local variable holding the shape is of the type <code>CenteredRectangle</code> or <code>Centered</code>, but this is not a distinction that matters most of the time when you鈥檙e writing Java code.<a data-startref="ix_ch04-asciidoc3" data-type="indexterm" id="5_idm45941125939432"></a></p>
</div></section>













<section data-pdf-bookmark="Default Methods" data-type="sect2"><div class="sect2" id="javanut7-CHP-4-SECT-1.5">
<h2>Default Methods</h2>

<p><a data-primary="default methods" data-secondary="interfaces and" data-type="indexterm" id="5_ix_ch04-asciidoc4"></a><a data-primary="interfaces" data-secondary="default methods" data-type="indexterm" id="5_ix_ch04-asciidoc5"></a>From <a data-primary="Java 8" data-secondary="interfaces in" data-type="indexterm" id="5_idm45941125934648"></a>Java 8 onward, it is possible to declare methods in interfaces that include an implementation. In this section, we鈥檒l discuss these methods, which should be understood as optional methods in the API the interfaces represent鈥攖hey鈥檙e usually called <em>default methods</em>. Let鈥檚 start by looking at the reasons why we need the default mechanism in the first place.</p>










<section data-pdf-bookmark="Backward compatibility" data-type="sect3"><div class="sect3" id="idm45941125932648">
<h3>Backward compatibility</h3>

<p><a data-primary="backward compatibility, interfaces and" data-type="indexterm" id="5_idm45941125931208"></a><a data-primary="default methods" data-secondary="backward compatibility and" data-type="indexterm" id="5_idm45941125930440"></a><a data-primary="interfaces" data-secondary="backward compatibility" data-type="indexterm" id="5_idm45941125929480"></a>The Java platform has always been very concerned with backward
compatibility. This means that code that was written (or even compiled)
for an earlier version of the platform must continue to work
with later releases of the platform. This principle allows development
groups to have a high degree of confidence that an upgrade of their JDK
or JRE will not break currently working applications.</p>

<p>Backward compatibility is a great strength of the Java platform, but in
order to achieve it, some constraints are placed on the platform. One of
them is that interfaces may not have new mandatory methods added to them
in a new release of the <span class="keep-together">interface</span>.</p>

<p>For example, let鈥檚 suppose that we want to update the <code>Positionable</code>
interface with the ability to add a bottom-left bounding point as well:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">interface</code> <code class="nc">Positionable</code> <code class="kd">extends</code> <code class="n">Centered</code> <code class="o">{</code>
  <code class="kt">void</code> <code class="nf">setUpperRightCorner</code><code class="o">(</code><code class="kt">double</code> <code class="n">x</code><code class="o">,</code> <code class="kt">double</code> <code class="n">y</code><code class="o">);</code>
  <code class="kt">double</code> <code class="nf">getUpperRightX</code><code class="o">();</code>
  <code class="kt">double</code> <code class="nf">getUpperRightY</code><code class="o">();</code>
  <code class="kt">void</code> <code class="nf">setLowerLeftCorner</code><code class="o">(</code><code class="kt">double</code> <code class="n">x</code><code class="o">,</code> <code class="kt">double</code> <code class="n">y</code><code class="o">);</code>
  <code class="kt">double</code> <code class="nf">getLowerLeftX</code><code class="o">();</code>
  <code class="kt">double</code> <code class="nf">getLowerLeftY</code><code class="o">();</code>
<code class="o">}</code></pre>

<p>With this new definition, if we try to use this new interface with code
developed for the old, it just won鈥檛 work, as the existing code is
missing the mandatory methods <code>setLowerLeftCorner()</code>, <code>getLowerLeftX()</code>,
and <code>getLowerLeftY()</code>.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>You can see this effect quite easily in your own code. Compile a class
file that depends on an interface. Then add a new mandatory method to
the interface, and try to run the program with the new version of the
interface, together with your old class file. You should see the program
crash with a <code>NoClassDefError</code>.</p>
</div>

<p>This limitation was a concern for the designers of Java 8鈥攁s one of their goals was to be able to upgrade the core Java Collections libraries, and introduce methods that made use of lambda expressions.</p>

<p>To solve this problem, a new mechanism was needed, essentially to allow interfaces to evolve by allowing new methods to be added without breaking backward <span class="keep-together">compatibility</span>.</p>
</div></section>













<section data-pdf-bookmark="Implementation of default methods" data-type="sect3"><div class="sect3" id="idm45941125794232">
<h3>Implementation of default methods</h3>

<p><a data-primary="default methods" data-secondary="implementation of" data-type="indexterm" id="5_ix_ch04-asciidoc6"></a><a data-primary="interfaces" data-secondary="default implementation" data-type="indexterm" id="5_ix_ch04-asciidoc7"></a>Adding new methods to an interface without breaking backward
compatibility requires providing some implementation for the
older implementations of the interface so that they can continue to
work. This mechanism is a <code>default</code> method, and it was first added to
the platform in JDK 8.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>A default method (sometimes called an optional method) can be added to
any interface. <a data-primary="default implementation" data-type="indexterm" id="5_idm45941125896024"></a>This must include an implementation, called the <em>default
implementation</em>, which is written inline in the interface definition.</p>
</div>

<p>The basic behavior of default methods is:</p>

<ul>
<li>
<p>An implementing class may (but is not required to) implement the default method.</p>
</li>
<li>
<p>If an implementing class implements the default method, then the implementation in the class is used.</p>
</li>
<li>
<p>If no other implementation can be found, then the default implementation is used.</p>
</li>
</ul>

<p><a data-primary="java.util.List" data-secondary="sort() method" data-type="indexterm" id="5_idm45941125890824"></a><a data-primary="sort()" data-secondary="as default method" data-type="indexterm" id="5_idm45941125889848"></a>An example default method is the <code>sort()</code> method. It鈥檚 been added to
the interface <code>java.util.List</code> in JDK 8, and is defined as:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// The &lt;E&gt; syntax is Java&apos;s way of writing a generic type-see</code>
<code class="c1">// the next section for full details. If you aren&apos;t familiar with</code>
<code class="c1">// generics, just ignore that syntax for now.</code>
<code class="kd">interface</code> <code class="nc">List</code><code class="o">&lt;</code><code class="n">E</code><code class="o">&gt;</code> <code class="o">{</code>
  <code class="c1">// Other members omitted</code>

  <code class="kd">public</code> <code class="k">default</code> <code class="kt">void</code> <code class="nf">sort</code><code class="o">(</code><code class="n">Comparator</code><code class="o">&lt;?</code> <code class="kd">super</code> <code class="n">E</code><code class="o">&gt;</code> <code class="n">c</code><code class="o">)</code> <code class="o">{</code>
    <code class="n">Collections</code><code class="o">.&lt;</code><code class="n">E</code><code class="o">&gt;</code><code class="n">sort</code><code class="o">(</code><code class="k">this</code><code class="o">,</code> <code class="n">c</code><code class="o">);</code>
  <code class="o">}</code>
<code class="o">}</code></pre>

<p><a data-primary="Java 8" data-secondary="sort()" data-type="indexterm" id="5_idm45941125882920"></a>Thus, from Java 8 upward, any object that implements <code>List</code> has an instance method <code>sort()</code> that can be used to sort the list using a suitable <code>Comparator</code>.
As the return type is <code>void</code>, we might expect that this is an in-place sort, and this is indeed the case.</p>

<p>One consequence of default methods is that when implementing multiple interfaces, it鈥檚 possible that two or more interfaces may contain a default method with a completely identical name and signature.</p>

<p>For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">interface</code> <code class="nc">Vocal</code> <code class="o">{</code>
  <code class="k">default</code> <code class="kt">void</code> <code class="nf">call</code><code class="o">()</code> <code class="o">{</code>
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Hello!</code><code class="o">);</code>
  <code class="o">}</code>
<code class="o">}</code>

<code class="kd">interface</code> <code class="nc">Caller</code> <code class="o">{</code>
  <code class="k">default</code> <code class="kt">void</code> <code class="nf">call</code><code class="o">()</code> <code class="o">{</code>
    <code class="n">Switchboard</code><code class="o">.</code><code class="na">placeCall</code><code class="o">(</code><code class="k">this</code><code class="o">);</code>
  <code class="o">}</code>
<code class="o">}</code>

<code class="kd">public</code> <code class="kd">class</code> <code class="nc">Person</code> <code class="kd">implements</code> <code class="n">Vocal</code><code class="o">,</code> <code class="n">Caller</code> <code class="o">{</code>
  <code class="c1">// ... which default is used?</code>
<code class="o">}</code></pre>

<p><a data-primary="colliding default method" data-type="indexterm" id="5_idm45941125684472"></a>These two interfaces have very different default semantics for <code>call()</code> and could cause a potential implementation clash鈥攁 <em>colliding default method</em>.
In versions of Java prior to 8, this could not occur, as the language only permitted single inheritance of implementation.
<a data-primary="multiple inheritance" data-type="indexterm" id="5_idm45941125644040"></a>The introduction of default methods means that Java now permits a limited form of <em>multiple inheritance</em> (but only of method implementations).
Java still does not permit (and has no plans to add) multiple inheritance of object state.</p>
<div data-type="tip"><h6>Tip</h6>
<p><a data-primary="diamond inheritance" data-type="indexterm" id="5_idm45941125641928"></a>In some other languages, notably C++, this problem is known as <em>diamond inheritance</em>.</p>
</div>

<p>Default methods have a simple set of rules to help resolve any potential ambiguities:</p>

<ul>
<li>
<p>If a class implements multiple interfaces in such a way as to cause a potential clash of default method implementations, the implementing class must override the clashing method and provide a definition of what is to be done.</p>
</li>
<li>
<p>Syntax is provided to allow the implementing class to simply call one of the interface default methods if that is what is required:</p>
</li>
</ul>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">Person</code> <code class="kd">implements</code> <code class="n">Vocal</code><code class="o">,</code> <code class="n">Caller</code> <code class="o">{</code>

    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">call</code><code class="o">()</code> <code class="o">{</code>
        <code class="c1">// Can do our own thing</code>
        <code class="c1">// or delegate to either interface</code>
        <code class="c1">// e.g.,</code>
        <code class="c1">// Vocal.super.call();</code>
        <code class="c1">// or</code>
        <code class="c1">// Caller.super.call();</code>
    <code class="o">}</code>
<code class="o">}</code></pre>

<p>As a side effect of the design of default methods, there is a slight, unavoidable usage issue that may arise in the case of evolving interfaces with colliding methods.
Consider the case where a (version 7) class implements two interfaces <code>A</code> and <code>B</code> with versions <code>a.0</code> and <code>b.0</code>, respectively.
As defaults are not available in Java 7, this class will work correctly.
However, if at a later time either or both interfaces adopt a default implementation of a colliding method, then compile time breakage can occur.</p>

<p>For example, if version <code>a.1</code> introduces a default method in <code>A</code>, then the implementing class will pick up the implementation when run with the new version of the dependency.
If version <code>b.1</code> now introduces the same method, it causes a collision:</p>

<ul>
<li>
<p>If <code>B</code> introduces the method as a mandatory (i.e., abstract) method, then the implementing class continues to work鈥攂oth at compile time and at runtime.</p>
</li>
<li>
<p>If <code>B</code> introduces the method as a default method, then this is not safe and the implementing class will fail both at compile and at runtime.</p>
</li>
</ul>

<p>This minor issue is very much a corner case and in practice is a very small price to pay in order to have usable default methods in the language.</p>

<p>When working with default methods, we should be aware that there is a slightly restricted set of operations we can perform from within a default method:</p>

<ul>
<li>
<p>Call another method present in the interface鈥檚 public API (whether mandatory or optional); some implementation for such methods is guaranteed to be <span class="keep-together">available</span>.</p>
</li>
<li>
<p>Call a private method on the interface (Java 9 and up).</p>
</li>
<li>
<p>Call a static method, whether on the interface or defined elsewhere.</p>
</li>
<li>
<p>Use the <code>this</code> reference (e.g., as an argument to method calls).</p>
</li>
</ul>

<p>The biggest takeaway from these restrictions is that even with default methods, Java interfaces still lack meaningful state; we cannot alter or store state within the <span class="keep-together">interface</span>.</p>

<p>Default methods have had a profound impact on the way that Java practitioners approach object-oriented programming.
When combined with the rise of lambda expressions, they have upended many previous conventions of Java coding; we will discuss this in detail in the next chapter<a data-startref="ix_ch04-asciidoc7" data-type="indexterm" id="5_idm45941125561928"></a><a data-startref="ix_ch04-asciidoc6" data-type="indexterm" id="5_idm45941125561224"></a>.<a data-startref="ix_ch04-asciidoc5" data-type="indexterm" id="5_idm45941125560424"></a><a data-startref="ix_ch04-asciidoc4" data-type="indexterm" id="5_idm45941125559720"></a></p>
</div></section>



</div></section>













<section data-pdf-bookmark="Marker Interfaces" data-type="sect2"><div class="sect2" id="idm45941125793256">
<h2>Marker Interfaces</h2>

<p><a data-primary="interfaces" data-secondary="marker" data-type="indexterm" id="5_idm45941125557992"></a><a data-primary="marker interfaces" data-type="indexterm" id="5_idm45941125557016"></a>Occasionally it is useful to define an interface that is entirely empty.
A class can implement this interface simply by naming it in its <code>implements</code> clause without <span class="keep-together">having</span> to implement any methods.
In this case, any instances of the class become valid instances of the interface as well and can be cast to the type. Java code can check whether an object is an instance of the interface using the <code>instanceof</code> operator, so this technique is a useful way to provide additional information about an object. It can be thought of as providing additional, auxiliary type information about a class.</p>
<div data-type="tip"><h6>Tip</h6>
<p>Marker interfaces are much less widely used than they once were.
Java鈥檚 <em>annotations</em> (which we shall meet presently) have largely replaced them due to their much greater flexibility at conveying extended type information.</p>
</div>

<p><a data-primary="java.util.List" data-secondary="java.util.RandomAccess and" data-type="indexterm" id="5_idm45941125552104"></a><a data-primary="java.util.RandomAccess" data-type="indexterm" id="5_idm45941125550936"></a>The interface <code>java.util.RandomAccess</code> is an example of a marker interface: <code>java.util.List</code> implementations use this interface to advertise that they provide fast random access to the elements of the list.
For example, <code>ArrayList</code> implements <code>RandomAccess</code>, while <code>LinkedList</code> does not.
Algorithms that care about the performance of random-access operations can test for <code>RandomAccess</code> like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Before sorting the elements of a long arbitrary list, we may want</code>
<code class="c1">// to make sure that the list allows fast random access.  If not,</code>
<code class="c1">// it may be quicker to make a random-access copy of the list before</code>
<code class="c1">// sorting it. Note that this is not necessary when using</code>
<code class="c1">// java.util.Collections.sort().</code>
<code class="n">List</code> <code class="n">l</code> <code class="o">=</code> <code class="o">...;</code>  <code class="c1">// Some arbitrary list we&apos;re given</code>
<code class="k">if</code> <code class="o">(</code><code class="n">l</code><code class="o">.</code><code class="na">size</code><code class="o">()</code> <code class="o">&gt;</code> <code class="mi">2</code> <code class="o">&amp;&amp;</code> <code class="o">!(</code><code class="n">l</code> <code class="k">instanceof</code> <code class="n">RandomAccess</code><code class="o">))</code> <code class="o">{</code>
    <code class="n">l</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">(</code><code class="n">l</code><code class="o">);</code>
<code class="o">}</code>
<code class="n">sortListInPlace</code><code class="o">(</code><code class="n">l</code><code class="o">);</code></pre>

<p><a data-primary="nominal typing" data-type="indexterm" id="5_idm45941125440424"></a>As we will see later, Java鈥檚 type system is very tightly coupled to the names that types have鈥攁n approach called <em>nominal typing</em>.
A marker interface is a great example of this鈥攊t has nothing at all <em>except</em> a name.<a data-startref="ix_ch04-asciidoc2" data-type="indexterm" id="5_idm45941125483192"></a><a data-startref="ix_ch04-asciidoc1" data-type="indexterm" id="5_idm45941125482488"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Java Generics" data-type="sect1"><div class="sect1" id="javanut7-CHP-4-SECT-2">
<h1>Java Generics</h1>

<p><a data-primary="generics" data-type="indexterm" id="5_ix_ch04-asciidoc8"></a><a data-primary="type system" data-secondary="generics" data-type="indexterm" id="5_ix_ch04-asciidoc9"></a>One of the great strengths of the Java platform is the standard library that it ships.
It provides a great deal of useful functionality鈥攁nd in particular robust implementations of common data structures.
These implementations are relatively simple to develop with and are well
documented.
The libraries are known as the Java Collections, and we will spend a big chunk of <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch08.html#javanut7-CHP-8">Chapter 8</a> discussing them.
For a far more complete treatment, see the book <a class="orm:hideurl" href="http://shop.oreilly.com/product/9780596527754.do"><em>Java Generics and Collections</em></a> by Maurice Naftalin and Philip Wadler (O鈥橰eilly).</p>

<p>Although they were still very useful, the earliest versions of the collections had a fairly major limitation, however.
This limitation was that the data structure (sometimes called the <em>container</em>) essentially obscured the type of the data being stored in it.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Data hiding and encapsulation is a great principle of object-oriented
programming, but in this case, the opaque nature of the container caused
a lot of problems for the developer.</p>
</div>

<p>Let鈥檚 kick off the section by demonstrating the problem, and showing how the introduction of <em>generic types</em> solved it and made life much easier for Java developers.</p>








<section data-pdf-bookmark="Introduction to Generics" data-type="sect2"><div class="sect2" id="javanut7-CHP-4-SECT-2.1">
<h2>Introduction to Generics</h2>

<p><a data-primary="generics" data-secondary="basics" data-type="indexterm" id="5_idm45941125470200"></a><a data-primary="List interface" data-secondary="generics and" data-type="indexterm" id="5_idm45941125469224"></a>If we want to build a collection of <code>Shape</code> instances, we can use a
<code>List</code> to hold them, like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">List</code> <code class="n">shapes</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">();</code>   <code class="c1">// Create a List to hold shapes</code>

<code class="c1">// Create some centered shapes, and store them in the list</code>
<code class="n">shapes</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="k">new</code> <code class="n">CenteredCircle</code><code class="o">(</code><code class="mf">1.0</code><code class="o">,</code> <code class="mf">1.0</code><code class="o">,</code> <code class="mf">1.0</code><code class="o">));</code>
<code class="c1">// This is legal Java-but is a very bad design choice</code>
<code class="n">shapes</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="k">new</code> <code class="n">CenteredSquare</code><code class="o">(</code><code class="mf">2.5</code><code class="o">,</code> <code class="mi">2</code><code class="o">,</code> <code class="mi">3</code><code class="o">));</code>

<code class="c1">// List::get() returns Object, so to get back a</code>
<code class="c1">// CenteredCircle we must cast</code>
<code class="n">CenteredCircle</code> <code class="n">c</code> <code class="o">=</code> <code class="o">(</code><code class="n">CentredCircle</code><code class="o">)</code><code class="n">shapes</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="mi">0</code><code class="o">);</code>

<code class="c1">// Next line causes a runtime failure</code>
<code class="n">CenteredCircle</code> <code class="n">c</code> <code class="o">=</code> <code class="o">(</code><code class="n">CentredCircle</code><code class="o">)</code><code class="n">shapes</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="mi">1</code><code class="o">);</code></pre>

<p>A problem with this code stems from the requirement to perform a cast to get the shape objects back out in a usable form鈥攖he <code>List</code> doesn鈥檛 know what type of objects it contains.
Not only that, but it鈥檚 actually possible to put different types of objects into the same container鈥攁nd everything will work fine until an illegal cast is used, and the program crashes.</p>

<p>What we really want is a form of <code>List</code> that understands what type it contains.
Then, <code>javac</code> could detect when an illegal argument was passed to the methods of <code>List</code> and cause a compilation error, rather than deferring the issue to runtime.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><a data-primary="heterogeneous collections" data-type="indexterm" id="5_idm45941125356648"></a><a data-primary="homogeneous collections" data-type="indexterm" id="5_idm45941125355880"></a>Collections that have all elements of the same type are called <em>homogeneous</em>, while the collections that can have elements of potentially different types are called <em>heterogeneous</em> (or sometimes 鈥渕ystery meat collections鈥?.</p>
</div>

<p><a data-primary="&lt; &gt; (angle brackets)" data-secondary="homogeneous collections and" data-type="indexterm" id="5_idm45941125353688"></a><a data-primary="payload type" data-type="indexterm" id="5_idm45941125352696"></a>Java provides a simple syntax to cater for homogeneous collections鈥攖o indicate that a type is a container that holds instances of another reference type, we enclose the <em>payload</em> type that the container holds within angle brackets:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Create a List-of-CenteredCircle</code>
<code class="n">List</code><code class="o">&lt;</code><code class="n">CenteredCircle</code><code class="o">&gt;</code> <code class="n">shapes</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;</code><code class="n">CenteredCircle</code><code class="o">&gt;();</code>

<code class="c1">// Create some centered shapes, and store them in the list</code>
<code class="n">shapes</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="k">new</code> <code class="n">CenteredCircle</code><code class="o">(</code><code class="mf">1.0</code><code class="o">,</code> <code class="mf">1.0</code><code class="o">,</code> <code class="mf">1.0</code><code class="o">));</code>

<code class="c1">// Next line will cause a compilation error</code>
<code class="n">shapes</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="k">new</code> <code class="n">CenteredSquare</code><code class="o">(</code><code class="mf">2.5</code><code class="o">,</code> <code class="mi">2</code><code class="o">,</code> <code class="mi">3</code><code class="o">));</code>

<code class="c1">// List&lt;CenteredCircle&gt;::get() returns a CenteredCircle, no cast needed</code>
<code class="n">CenteredCircle</code> <code class="n">c</code> <code class="o">=</code> <code class="n">shapes</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="mi">0</code><code class="o">);</code></pre>

<p>This syntax ensures that a large class of unsafe code is caught by the compiler, before it gets anywhere near runtime.
This is, of course, the whole point of static type systems鈥攖o use compile-time knowledge to help eliminate runtime problems wherever possible.</p>

<p>The resulting types, which combine an enclosing container type and a payload type, are usually called <em>generic types</em>鈥攁nd they are declared like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">interface</code> <code class="nc">Box</code><code class="o">&lt;</code><code class="n">T</code><code class="o">&gt;</code> <code class="o">{</code>
  <code class="kt">void</code> <code class="nf">box</code><code class="o">(</code><code class="n">T</code> <code class="n">t</code><code class="o">);</code>
  <code class="n">T</code> <code class="nf">unbox</code><code class="o">();</code>
<code class="o">}</code></pre>

<p>This indicates that the <code>Box</code> interface is a general construct, which can hold any type of payload.
It isn鈥檛 really a complete interface by itself鈥攊t鈥檚 more like a general description of a whole family of interfaces, one for each type that can be used in place of <code>T</code>.</p>
</div></section>













<section data-pdf-bookmark="Generic Types and Type Parameters" data-type="sect2"><div class="sect2" id="javanut7-CHP-4-SECT-2.2">
<h2>Generic Types and Type Parameters</h2>

<p><a data-primary="generics" data-secondary="types/type parameters" data-type="indexterm" id="5_idm45941125263032"></a><a data-primary="type parameter" data-type="indexterm" id="5_idm45941125251176"></a><a data-primary="types" data-seealso="generics" data-type="indexterm" id="5_idm45941125250504"></a>We鈥檝e seen how to use a generic type, to provide enhanced program
safety, by using compile-time knowledge to prevent simple type errors.
In this section, let鈥檚 dig deeper into the properties of generic types.</p>

<p>The syntax <code>&lt;T&gt;</code> has a special name鈥攊t鈥檚 called a <em>type parameter</em>,
and <a data-primary="parameterized type" data-type="indexterm" id="5_idm45941125247736"></a>another name for a generic type is a <em>parameterized type</em>. This
should convey the sense that the container type (e.g., <code>List</code>) is
parameterized by another type (the payload type). When we write a type
like <code>Map&lt;String, Integer&gt;</code>, we are assigning concrete values to the
type parameters.</p>

<p>When we define a type that has parameters, we need to do so in a way
that does not make assumptions about the type parameters. So the <code>List</code>
type is declared in a generic way as <code>List&lt;E&gt;</code>, and the type parameter
<code>E</code> is used all the way through to stand as a placeholder for the actual
type that the programmer will use for the payload when she makes use of
the <code>List</code> data structure.</p>
<div data-type="tip"><h6>Tip</h6>
<p>Type parameters always stand in for reference types. It is not possible
to use a primitive type as a value for a type parameter.</p>
</div>

<p>The type parameter can be used in the signatures and bodies of methods
as though it is a real type, for example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">interface</code> <code class="nc">List</code><code class="o">&lt;</code><code class="n">E</code><code class="o">&gt;</code> <code class="kd">extends</code> <code class="n">Collection</code><code class="o">&lt;</code><code class="n">E</code><code class="o">&gt;</code> <code class="o">{</code>
  <code class="kt">boolean</code> <code class="nf">add</code><code class="o">(</code><code class="n">E</code> <code class="n">e</code><code class="o">);</code>
  <code class="n">E</code> <code class="nf">get</code><code class="o">(</code><code class="kt">int</code> <code class="n">index</code><code class="o">);</code>
  <code class="c1">// other methods omitted</code>
<code class="o">}</code></pre>

<p>Note how the type parameter <code>E</code> can be used as a parameter for both return types and method arguments.
We don鈥檛 assume that the payload type has any specific properties, and only make the basic assumption of consistency鈥攖hat the type we put in is the same type that we will later get back out.</p>

<p>This enhancement has effectively introduced a new kind of type to Java鈥檚 type system鈥攂y combining the container type with the value of the type parameter we are making new types.</p>
</div></section>













<section data-pdf-bookmark="Diamond Syntax" data-type="sect2"><div class="sect2" id="javanut7-CHP-4-SECT-2.3">
<h2>Diamond Syntax</h2>

<p><a data-primary="diamond syntax" data-type="indexterm" id="5_idm45941125157704"></a><a data-primary="generics" data-secondary="diamond syntax" data-type="indexterm" id="5_idm45941125157000"></a>When we create an instance of a generic type, the righthand side of the
assignment statement repeats the value of the type parameter. This is
usually unnecessary, as the compiler can infer the values of the type
parameters. In modern versions of Java, we can leave out the repeated
type values in what is called <em>diamond syntax</em>.</p>

<p>Let鈥檚 look at an example of how to use diamond syntax, by rewriting one
of our earlier examples:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Create a List-of-CenteredCircle using diamond syntax</code>
<code class="n">List</code><code class="o">&lt;</code><code class="n">CenteredCircle</code><code class="o">&gt;</code> <code class="n">shapes</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;&gt;();</code></pre>

<p>This is a small improvement in the verbosity of the assignment
statement鈥攚e鈥檝e managed to save a few characters of typing. We鈥檒l return
to the topic of type inference when we discuss lambda expressions
later on in this chapter.</p>
</div></section>













<section data-pdf-bookmark="Type Erasure" data-type="sect2"><div class="sect2" id="javanut7-CHP-4-SECT-2.4">
<h2>Type Erasure</h2>

<p><a data-primary="generics" data-secondary="type erasure" data-type="indexterm" id="5_idm45941125146328"></a><a data-primary="type erasure" data-type="indexterm" id="5_idm45941125145352"></a>In <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4-SECT-1.5">鈥淒efault Methods鈥?/a&gt;, we discussed the Java platform鈥檚 strong preference for backward compatibility.
The addition of generics in Java 5 was another example of where backward compatibility was an issue for a new language feature.</p>

<p>The central question was how to make a type system that allowed older, nongeneric collection classes to be used alongside with newer, generic collections.
The design decision was to achieve this by the use of casts:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">List</code> <code class="n">someThings</code> <code class="o">=</code> <code class="n">getSomeThings</code><code class="o">();</code>
<code class="c1">// Unsafe cast, but we know that the</code>
<code class="c1">// contents of someThings are really strings</code>
<code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">myStrings</code> <code class="o">=</code> <code class="o">(</code><code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;)</code><code class="n">someThings</code><code class="o">;</code></pre>

<p>This means that <code>List</code> and <code>List&lt;String&gt;</code> are compatible as types, at least at some level.
Java achieves this compatibility by <em>type erasure</em>. This means that generic type parameters are only visible at compile time鈥攖hey are stripped out by <code>javac</code> and are not reflected in the bytecode.<sup><a class="totri-footnote" data-type="noteref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#idm45941125072344" id="idm45941125072344-marker">1</a></sup></p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p><a data-primary="raw type" data-type="indexterm" id="5_idm45941125070936"></a>The nongeneric type <code>List</code> is usually called a <em>raw type</em>. It is still
perfectly legal Java to work with the raw form of types鈥攅ven for types that are now generic.
This is almost always a sign of poor-quality code, however.</p>
</div>

<p>The mechanism of type erasure gives rise to a difference in the type
system seen by <code>javac</code> and that seen by the JVM鈥攚e will discuss this
fully in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4-SECT-2.9">鈥淕eneric Methods鈥?/a&gt;.</p>

<p>Type erasure also prohibits some other definitions, which would
otherwise seem legal. In this code, we want to count the orders as
represented in two slightly different data structures:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Won&apos;t compile</code>
<code class="kd">interface</code> <code class="nc">OrderCounter</code> <code class="o">{</code>
  <code class="c1">// Name maps to list of order numbers</code>
  <code class="kt">int</code> <code class="nf">totalOrders</code><code class="o">(</code><code class="n">Map</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;&gt;</code> <code class="n">orders</code><code class="o">);</code>

  <code class="c1">// Name maps to total orders made so far</code>
  <code class="kt">int</code> <code class="nf">totalOrders</code><code class="o">(</code><code class="n">Map</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code> <code class="n">Integer</code><code class="o">&gt;</code> <code class="n">orders</code><code class="o">);</code>
<code class="o">}</code></pre>

<p>This seems like perfectly legal Java code, but it will not compile. The
issue is that although the two methods seem like normal overloads, after
type erasure, the signature of both methods becomes:</p>

<pre data-code-language="java" data-type="programlisting">  <code class="kt">int</code> <code class="nf">totalOrders</code><code class="o">(</code><code class="n">Map</code><code class="o">);</code></pre>

<p>All that is left after type erasure is the raw type of the container鈥攊n
this case, <code>Map</code>. The runtime would be unable to distinguish between the
methods by signature, and so the language specification makes this
syntax illegal.</p>
</div></section>













<section data-pdf-bookmark="Bounded Type Parameters" data-type="sect2"><div class="sect2" id="javanut7-CHP-4-SECT-2.5">
<h2>Bounded Type Parameters</h2>

<p><a data-primary="bounded type parameters" data-type="indexterm" id="5_ix_ch04-asciidoc10"></a><a data-primary="generics" data-secondary="bounded type parameters" data-type="indexterm" id="5_ix_ch04-asciidoc11"></a><a data-primary="type parameter" data-type="indexterm" id="5_ix_ch04-asciidoc12"></a>Consider a simple generic box:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">Box</code><code class="o">&lt;</code><code class="n">T</code><code class="o">&gt;</code> <code class="o">{</code>
    <code class="kd">protected</code> <code class="n">T</code> <code class="n">value</code><code class="o">;</code>

    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">box</code><code class="o">(</code><code class="n">T</code> <code class="n">t</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">value</code> <code class="o">=</code> <code class="n">t</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="n">T</code> <code class="nf">unbox</code><code class="o">()</code> <code class="o">{</code>
        <code class="n">T</code> <code class="n">t</code> <code class="o">=</code> <code class="n">value</code><code class="o">;</code>
        <code class="n">value</code> <code class="o">=</code> <code class="kc">null</code><code class="o">;</code>
        <code class="k">return</code> <code class="n">t</code><code class="o">;</code>
    <code class="o">}</code>
<code class="o">}</code></pre>

<p>This is a useful abstraction, but suppose we want to have a restricted form of box that only holds numbers.
Java allows us to achieve this by using a <em>bound</em> on the type parameter.
This is the ability to restrict the types that can be used as the value of a type parameter, for example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">NumberBox</code><code class="o">&lt;</code><code class="n">T</code> <code class="kd">extends</code> <code class="n">Number</code><code class="o">&gt;</code> <code class="kd">extends</code> <code class="n">Box</code><code class="o">&lt;</code><code class="n">T</code><code class="o">&gt;</code> <code class="o">{</code>
    <code class="kd">public</code> <code class="kt">int</code> <code class="nf">intValue</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">value</code><code class="o">.</code><code class="na">intValue</code><code class="o">();</code>
    <code class="o">}</code>
<code class="o">}</code></pre>

<p>The type bound <code>T extends Number</code> ensures that <code>T</code> can only be substituted with a type that is compatible with the type <code>Number</code>.
As a result of this, the compiler knows that <code>value</code> will definitely have a method <code>intValue()</code> available on it.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Notice that because the <code>value</code> field has protected access, it can be accessed directly in the subclass.</p>
</div>

<p>If we attempt to instantiate <code>NumberBox</code> with an invalid value for the type parameter, then the result will be a compilation error, as we can see:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">NumberBox</code><code class="o">&lt;</code><code class="n">Integer</code><code class="o">&gt;</code> <code class="n">ni</code> <code class="o">=</code> <code class="k">new</code> <code class="n">NumberBox</code><code class="o">&lt;&gt;();</code>
<code class="c1">// Won&apos;t compile</code>
<code class="n">NumberBox</code><code class="o">&lt;</code><code class="n">Object</code><code class="o">&gt;</code> <code class="n">no</code> <code class="o">=</code> <code class="k">new</code> <code class="n">NumberBox</code><code class="o">&lt;&gt;();</code></pre>

<p>You must take care with raw types when working with type bounds, as the type bound can be evaded, but in doing so, the code is left vulnerable to a runtime exception:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Compiles</code>
<code class="n">NumberBox</code> <code class="n">n</code> <code class="o">=</code> <code class="k">new</code> <code class="n">NumberBox</code><code class="o">();</code>
<code class="c1">// This is very dangerous</code>
<code class="n">n</code><code class="o">.</code><code class="na">box</code><code class="o">(</code><code class="k">new</code> <code class="n">Object</code><code class="o">());</code>
<code class="c1">// Runtime error</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">n</code><code class="o">.</code><code class="na">intValue</code><code class="o">());</code></pre>

<p>The call to <code>intValue()</code> fails with a <code>java.lang.ClassCastException</code>鈥攁s <code>javac</code> has inserted an unconditional cast of <code>value</code> to <code>Number</code> before calling the method.</p>

<p>In general, type bounds can be used to write better generic code and libraries.
With practice, some fairly complex constructions can be built, for example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">ComparingBox</code><code class="o">&lt;</code><code class="n">T</code> <code class="kd">extends</code> <code class="n">Comparable</code><code class="o">&lt;</code><code class="n">T</code><code class="o">&gt;&gt;</code> <code class="kd">extends</code> <code class="n">Box</code><code class="o">&lt;</code><code class="n">T</code><code class="o">&gt;</code>
                            <code class="kd">implements</code> <code class="n">Comparable</code><code class="o">&lt;</code><code class="n">ComparingBox</code><code class="o">&lt;</code><code class="n">T</code><code class="o">&gt;&gt;</code> <code class="o">{</code>
    <code class="nd">@Override</code>
    <code class="kd">public</code> <code class="kt">int</code> <code class="nf">compareTo</code><code class="o">(</code><code class="n">ComparingBox</code><code class="o">&lt;</code><code class="n">T</code><code class="o">&gt;</code> <code class="n">o</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">if</code> <code class="o">(</code><code class="n">value</code> <code class="o">==</code> <code class="kc">null</code><code class="o">)</code>
            <code class="k">return</code> <code class="n">o</code><code class="o">.</code><code class="na">value</code> <code class="o">==</code> <code class="kc">null</code> <code class="o">?</code> <code class="mi">0</code> <code class="o">:</code> <code class="o">-</code><code class="mi">1</code><code class="o">;</code>
        <code class="k">return</code> <code class="n">value</code><code class="o">.</code><code class="na">compareTo</code><code class="o">(</code><code class="n">o</code><code class="o">.</code><code class="na">value</code><code class="o">);</code>
    <code class="o">}</code>
<code class="o">}</code></pre>

<p>The definition might seem daunting, but the <code>ComparingBox</code> is really just a <code>Box</code> that contains a <code>Comparable</code> value. The type also extends the comparison operation to the <code>ComparingBox</code> type itself, by just comparing the contents of the two boxes.<a data-startref="ix_ch04-asciidoc12" data-type="indexterm" id="5_idm45941124633672"></a><a data-startref="ix_ch04-asciidoc11" data-type="indexterm" id="5_idm45941124633192"></a><a data-startref="ix_ch04-asciidoc10" data-type="indexterm" id="5_idm45941124632520"></a></p>
</div></section>













<section data-pdf-bookmark="Introducing Covariance" data-type="sect2"><div class="sect2" id="javanut7-CHP-4-SECT-2.6">
<h2>Introducing Covariance</h2>

<p><a data-primary="covariance, generics and" data-type="indexterm" id="5_ix_ch04-asciidoc13"></a><a data-primary="generics" data-secondary="covariance" data-type="indexterm" id="5_ix_ch04-asciidoc14"></a>The design of Java鈥檚 generics contains the solution to an old problem.
In the earliest versions of Java, before the collections libraries were
even introduced, the language had been forced to confront a deep-seated type system design issue.</p>

<p>Put simply, the question is this:</p>
<blockquote>
<p>Should an array of strings be compatible with a variable of type array-of-object?</p></blockquote>

<p>In other words, should this code be legal?</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">String</code><code class="o">[]</code> <code class="n">words</code> <code class="o">=</code> <code class="o">{</code><code class="s">Hello World!</code><code class="o">};</code>
<code class="n">Object</code><code class="o">[]</code> <code class="n">objects</code> <code class="o">=</code> <code class="n">words</code><code class="o">;</code></pre>

<p>Without this, then even simple methods like <code>Arrays::sort</code> would have been very difficult to write in a useful way, as this would not work as expected:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Arrays</code><code class="o">.</code><code class="na">sort</code><code class="o">(</code><code class="n">Object</code><code class="o">[]</code> <code class="n">a</code><code class="o">);</code></pre>

<p>The method declaration would only work for the type <code>Object[]</code> and not for any other array type. As a result of these complications, the very first version of the Java Language Standard determined that:</p>
<blockquote>
<p>If a value of type <code>C</code> can be assigned to a variable of type <code>P</code> then a value of type <code>C[]</code> can be assigned to a variable of type <code>P[]</code>.</p></blockquote>

<p>That is, arrays鈥?assignment syntax <em>varies with</em> the base type that they hold, or arrays are <em>covariant</em>.</p>

<p>This design decision is rather unfortunate, as it leads to immediate negative <span class="keep-together">consequences</span>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">String</code><code class="o">[]</code> <code class="n">words</code> <code class="o">=</code> <code class="o">{</code><code class="s">Hello</code><code class="o">,</code> <code class="s">World!</code><code class="o">};</code>
<code class="n">Object</code><code class="o">[]</code> <code class="n">objects</code> <code class="o">=</code> <code class="n">words</code><code class="o">;</code>

<code class="c1">// Oh, dear, runtime error</code>
<code class="n">objects</code><code class="o">[</code><code class="mi">0</code><code class="o">]</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Integer</code><code class="o">(</code><code class="mi">42</code><code class="o">);</code></pre>

<p>The assignment to <code>objects[0]</code> attempts to store an <code>Integer</code> into a piece of storage that is expecting to hold a <code>String</code>.
This obviously will not work, and will throw an <code>ArrayStoreException</code>.</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>The usefulness of covariant arrays led to them being seen as a necessary evil in the very early days of the platform, despite the hole in the static type system that the feature exposes.</p>
</div>

<p>However, more recent research on modern open source codebases indicates that array covariance is extremely rarely used and is a language misfeature.<sup><a class="totri-footnote" data-type="noteref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#idm45941124496440" id="idm45941124496440-marker">2</a></sup> You should avoid it when writing new code.</p>

<p>When considering the behavior of generics in the Java platform, a very similar question can be asked: 鈥淚s <code>List&lt;String&gt;</code> a subtype of <code>List&lt;Object&gt;</code>?鈥?That is, can we write this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Is this legal?</code>
<code class="n">List</code><code class="o">&lt;</code><code class="n">Object</code><code class="o">&gt;</code> <code class="n">objects</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;();</code></pre>

<p>At first glance, this seems entirely reasonable鈥?code&gt;String</code> is a subclass of <code>Object</code>, so we know that any <code>String</code> element in our collection is also a valid <code>Object</code>.</p>

<p>However, consider the following code (which is just the array covariance code translated to use <code>List</code>):</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Is this legal?</code>
<code class="n">List</code><code class="o">&lt;</code><code class="n">Object</code><code class="o">&gt;</code> <code class="n">objects</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;();</code>

<code class="c1">// What do we do about this?</code>
<code class="n">objects</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="k">new</code> <code class="n">Object</code><code class="o">());</code></pre>

<p>As the type of <code>objects</code> was declared to be <code>List&lt;Object&gt;</code>, then it should be legal to add an <code>Object</code> instance to it.
However, as the actual instance holds strings, then trying to add an <code>Object</code> would not be compatible, and so this would fail at runtime.</p>

<p>This would have changed nothing from the case of arrays, and so the resolution is to realize that although this is legal:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Object</code> <code class="n">o</code> <code class="o">=</code> <code class="k">new</code> <code class="n">String</code><code class="o">(</code><code class="s">X</code><code class="o">);</code></pre>

<p>that does not mean that the corresponding statement for generic container types is also true, and as a result:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Won&apos;t compile</code>
<code class="n">List</code><code class="o">&lt;</code><code class="n">Object</code><code class="o">&gt;</code> <code class="n">objects</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;();</code></pre>

<p>Another way of saying this is that <code>List&lt;String&gt;</code> is <em>not</em> a subtype of
<code>List&lt;Object&gt;</code> or that generic types are <em>invariant</em>, not <em>covariant</em>.
We will have more to say about this when we discuss bounded wildcards.<a data-startref="ix_ch04-asciidoc14" data-type="indexterm" id="5_idm45941124405784"></a><a data-startref="ix_ch04-asciidoc13" data-type="indexterm" id="5_idm45941124405080"></a></p>
</div></section>













<section data-pdf-bookmark="Wildcards" data-type="sect2"><div class="sect2" id="javanut7-CHP-4-SECT-2.7">
<h2>Wildcards</h2>

<p><a data-primary="generics" data-secondary="wildcards" data-type="indexterm" id="5_idm45941124339144"></a><a data-primary="types" data-secondary="wildcards" data-type="indexterm" id="5_idm45941124337944"></a><a data-primary="wildcard types" data-type="indexterm" id="5_idm45941124337000"></a>A parameterized type, such as <code>ArrayList&lt;T&gt;</code>, is not <em>instantiable</em>; we
cannot create instances of them. This is because <code>&lt;T&gt;</code> is just a type
parameter鈥攎erely a placeholder for a genuine type. It is only when we
provide a concrete value for the type parameter (e.g.,
<code>ArrayList&lt;String&gt;</code>) that the type becomes fully formed and we can
create objects of that type.</p>

<p>This poses a problem if the type that we want to work with is unknown at compile time.
Fortunately, the Java type system is able to accommodate this concept.
<a data-primary="unknown type" data-seealso="wildcard types" data-type="indexterm" id="5_idm45941124333912"></a>It does so by having an explicit concept of the <em>unknown type</em>鈥攚hich is represented as <code>&lt;?&gt;</code>. This is the simplest example of Java鈥檚 <em>wildcard types</em>.</p>

<p>We can write expressions that involve the unknown type:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">ArrayList</code><code class="o">&lt;?&gt;</code> <code class="n">mysteryList</code> <code class="o">=</code> <code class="n">unknownList</code><code class="o">();</code>
<code class="n">Object</code> <code class="n">o</code> <code class="o">=</code> <code class="n">mysteryList</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="mi">0</code><code class="o">);</code></pre>

<p>This is perfectly valid Java鈥?code&gt;ArrayList&lt;?&gt;</code> is a complete type that a variable can have, unlike <code>ArrayList&lt;T&gt;</code>.
We don鈥檛 know anything about <code>mysteryList</code>鈥檚 payload type, but that may not be a problem for our code.</p>

<p>For example, when we get an item out of <code>mysteryList</code>, it has a completely unknown type.
However, we can be sure that the object is assignable to <code>Object</code>鈥攂ecause all valid values of a generic type parameter are reference types and all reference values can be assigned to a variable of type <code>Object</code>.</p>

<p>On the other hand, when we鈥檙e working with the unknown type, there are some limitations on its use in user code.
For example, this code will not compile:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Won&apos;t compile</code>
<code class="n">mysteryList</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="k">new</code> <code class="n">Object</code><code class="o">());</code></pre>

<p>The reason for this is simple鈥攚e don鈥檛 know what the payload type of
<code>mysteryList</code> is! For example, if <code>mysteryList</code> was really a instance of
<code>ArrayList&lt;String&gt;</code>, then we wouldn鈥檛 expect to be able to put an
<code>Object</code> into it.</p>

<p>The only value that we know we can always insert into a container is
<code>null</code>鈥攁s we know that <code>null</code> is a possible value for any reference type.
This isn鈥檛 that useful, and for this reason, the Java language spec also
rules out instantiating a container object with the unknown type as
payload, for example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Won&apos;t compile</code>
<code class="n">List</code><code class="o">&lt;?&gt;</code> <code class="n">unknowns</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;?&gt;();</code></pre>

<p>The unknown type may seem to be of limited utility, but one very important use for it is as a starting point for resolving the covariance question.
We can use the unknown type if we want to have a subtyping relationship for
containers, like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Perfectly legal</code>
<code class="n">List</code><code class="o">&lt;?&gt;</code> <code class="n">objects</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;();</code></pre>

<p>This means that <code>List&lt;String&gt;</code> <em>is</em> a subtype of <code>List&lt;?&gt;</code>鈥攁lthough when we use an assignment like the preceding one, we have lost some type information.
For example, the return type of <code>get()</code> is now effectively <code>Object</code>.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><code>List&lt;?&gt;</code> is not a subtype of any <code>List&lt;T&gt;</code>, for any value of <code>T</code>.</p>
</div>

<p>The unknown type sometimes confuses developers鈥攑rovoking questions like,
鈥淲hy wouldn鈥檛 you just use <code>Object</code> instead of the unknown type?鈥?
However, as we鈥檝e seen, the need to have subtyping relationships between
generic types essentially requires us to have a notion of the unknown
type.</p>










<section data-pdf-bookmark="Bounded wildcards" data-type="sect3"><div class="sect3" id="javanut7-CHP-4-SECT-2.8">
<h3>Bounded wildcards</h3>

<p><a data-primary="bounded wildcards" data-type="indexterm" id="5_idm45941124212744"></a><a data-primary="generics" data-secondary="bounded wildcards" data-type="indexterm" id="5_idm45941124189224"></a><a data-primary="wildcard types" data-type="indexterm" id="5_idm45941124188280"></a>In fact, Java鈥檚 wildcard types extend beyond just the unknown type,
with the concept of <em>bounded wildcards</em>.</p>

<p>They are used to describe the inheritance hierarchy of a mostly unknown
type鈥攅ffectively making statements like, for example, 鈥淚 don鈥檛 know
anything about this type, except that it must implement <code>List</code>.鈥?/p&gt;

<p>This would be written as <code>? extends List</code> in the type parameter. This
provides a useful lifeline to the programmer鈥攊nstead of being restricted
to the totally unknown type, she knows that at least the capabilities of
the type bound are <span class="keep-together">available</span>.</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>The <code>extends</code> keyword is always used, regardless of whether the constraining type is a class or interface type.</p>
</div>

<p><a data-primary="type variance" data-type="indexterm" id="5_idm45941124182120"></a>This is an example of a concept called <em>type variance</em>, which is the
general theory of how inheritance between container types relates to the
inheritance of their payload types.</p>
<dl>
<dt>Type covariance</dt>
<dd>
<p>This means that the container types have the same relationship to
each other as the payload types do. This is expressed using the
<code>extends</code> keyword.</p>
</dd>
<dt>Type contravariance</dt>
<dd>
<p>This means that the container types have the inverse relationship to
each other as the payload types. This is expressed using the <code>super</code>
keyword.</p>
</dd>
</dl>

<p>These ideas tend to appear when discussing container types.
For example, if <code>Cat</code> extends <code>Pet</code>, then <code>List&lt;Cat&gt;</code> is a subtype of <code>List&lt;? extends Pet&gt;</code>, and so:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">List</code><code class="o">&lt;</code><code class="n">Cat</code><code class="o">&gt;</code> <code class="n">cats</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;</code><code class="n">Cat</code><code class="o">&gt;();</code>
<code class="n">List</code><code class="o">&lt;?</code> <code class="kd">extends</code> <code class="n">Pet</code><code class="o">&gt;</code> <code class="n">pets</code> <code class="o">=</code> <code class="n">cats</code><code class="o">;</code></pre>

<p>However, this differs from the array case, because type safety is maintained in the following way:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">pets</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="k">new</code> <code class="n">Cat</code><code class="o">());</code> <code class="c1">// won&apos;t compile</code>
<code class="n">pets</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="k">new</code> <code class="n">Pet</code><code class="o">());</code> <code class="c1">// won&apos;t compile</code>
<code class="n">cats</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="k">new</code> <code class="n">Cat</code><code class="o">());</code></pre>

<p>The compiler cannot prove that the storage pointed at by <code>pets</code> is capable of storing a <code>Cat</code> and so it rejects the call to <code>add()</code>.
However, as <code>cats</code> definitely points at a list of <code>Cat</code> objects, then it must be acceptable to add a new one to the list.</p>

<p>As a result, it is very commonplace to see these types of generic constructions with types that act as producers or consumers of payload types.</p>

<p>For example, when the <code>List</code> is acting as a <em>producer</em> of <code>Pet</code> objects, then the appropriate keyword is <code>extends</code>.</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Pet</code> <code class="n">p</code> <code class="o">=</code> <code class="n">pets</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="mi">0</code><code class="o">);</code></pre>

<p>Note that for the producer case, the payload type appears as the return type of the producer method.</p>

<p>For a container type that is acting purely as a <em>consumer</em> of instances
of a type, we would use the <code>super</code> keyword, and we would expect to see the payload type as the type of a method argument.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><a data-primary="Producer Extends, Consumer Super (PECS) principle" data-type="indexterm" id="5_idm45941124068264"></a>This is codified in the <em>Producer Extends, Consumer Super</em> (PECS)
principle coined by Joshua Bloch.</p>
</div>

<p>As discussed in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch08.html#javanut7-CHP-8">Chapter 8</a>, we see both covariance and contravariance throughout the Java Collections.
They largely exist to ensure that the generics just 鈥渄o the right thing鈥?and behave in a manner that should not surprise the developer.</p>
</div></section>



</div></section>













<section data-pdf-bookmark="Generic Methods" data-type="sect2"><div class="sect2" id="javanut7-CHP-4-SECT-2.9">
<h2>Generic Methods</h2>

<p><a data-primary="generic methods" data-type="indexterm" id="5_idm45941124064104"></a><a data-primary="generics" data-secondary="generic methods" data-type="indexterm" id="5_idm45941124063400"></a>A <em>generic method</em> is a method that is able to take instances of any reference type.</p>

<p>For example, this method emulates the behavior of the <code>,</code> (comma) operator from the <code>C</code> language, which is usually used to combine expressions with side effects together:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Note that this class is not generic</code>
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">Utils</code>
  <code class="kd">public</code> <code class="kd">static</code> <code class="o">&lt;</code><code class="n">T</code><code class="o">&gt;</code> <code class="n">T</code> <code class="n">comma</code><code class="o">(</code><code class="n">T</code> <code class="n">a</code><code class="o">,</code> <code class="n">T</code> <code class="n">b</code><code class="o">)</code> <code class="o">{</code>
    <code class="k">return</code> <code class="n">a</code><code class="o">;</code>
  <code class="o">}</code>
<code class="o">}</code></pre>

<p>Even though a type parameter is used in the definition of the method, the class it is defined in need not be generic鈥攊nstead, the syntax is used to indicate that the method can be used freely, and that the return type is the same as the argument.</p>

<p>Let鈥檚 look at another example, from the Java Collections library.
In the <code>ArrayList</code> class we can find a method to create a new array object from an arraylist instance:</p>

<pre data-code-language="java" data-type="programlisting"><code class="nd">@SuppressWarnings</code><code class="o">(</code><code class="s">unchecked</code><code class="o">)</code>
<code class="kd">public</code> <code class="o">&lt;</code><code class="n">T</code><code class="o">&gt;</code> <code class="n">T</code><code class="o">[]</code> <code class="n">toArray</code><code class="o">(</code><code class="n">T</code><code class="o">[]</code> <code class="n">a</code><code class="o">)</code> <code class="o">{</code>
    <code class="k">if</code> <code class="o">(</code><code class="n">a</code><code class="o">.</code><code class="na">length</code> <code class="o">&lt;</code> <code class="n">size</code><code class="o">)</code>
        <code class="c1">// Make a new array of a&apos;s runtime type, but my contents:</code>
        <code class="k">return</code> <code class="o">(</code><code class="n">T</code><code class="o">[])</code> <code class="n">Arrays</code><code class="o">.</code><code class="na">copyOf</code><code class="o">(</code><code class="n">elementData</code><code class="o">,</code> <code class="n">size</code><code class="o">,</code> <code class="n">a</code><code class="o">.</code><code class="na">getClass</code><code class="o">());</code>
    <code class="n">System</code><code class="o">.</code><code class="na">arraycopy</code><code class="o">(</code><code class="n">elementData</code><code class="o">,</code> <code class="mi">0</code><code class="o">,</code> <code class="n">a</code><code class="o">,</code> <code class="mi">0</code><code class="o">,</code> <code class="n">size</code><code class="o">);</code>
    <code class="k">if</code> <code class="o">(</code><code class="n">a</code><code class="o">.</code><code class="na">length</code> <code class="o">&gt;</code> <code class="n">size</code><code class="o">)</code>
        <code class="n">a</code><code class="o">[</code><code class="n">size</code><code class="o">]</code> <code class="o">=</code> <code class="kc">null</code><code class="o">;</code>
    <code class="k">return</code> <code class="n">a</code><code class="o">;</code>
<code class="o">}</code></pre>

<p>This method uses the low-level <code>arraycopy()</code> method to do the actual work.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>If we look at the class definition for <code>ArrayList</code> we can see that it is a generic class鈥攂ut the type parameter is <code>&lt;E&gt;</code>, not <code>&lt;T&gt;</code>, and the type parameter <code>&lt;E&gt;</code> does not appear at all in the definition of <code>toArray()</code>.</p>
</div>

<p>The <code>toArray()</code> method provides one half of a bridge API between the collections and Java鈥檚 original arrays.
The other half of the API鈥攎oving from arrays to collections鈥攊nvolves a few additional subtleties, as we will discuss in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch08.html#javanut7-CHP-8">Chapter 8</a>.</p>
</div></section>













<section data-pdf-bookmark="Compile and Runtime Typing" data-type="sect2"><div class="sect2" id="javanut7-CHP-4-SECT-2.10">
<h2>Compile and Runtime Typing</h2>

<p><a data-primary="compile-time typing" data-type="indexterm" id="5_idm45941123863000"></a><a data-primary="generics" data-secondary="compile-time/runtime typing" data-type="indexterm" id="5_idm45941123862296"></a><a data-primary="runtime typing" data-type="indexterm" id="5_idm45941123861288"></a>Consider an example piece of code:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">l</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;&gt;();</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">l</code><code class="o">);</code></pre>

<p>We can ask the following question: what is the type of <code>l</code>? The answer to that question depends on whether we consider <code>l</code> at compile time (i.e., the type seen by <code>javac</code>) or at runtime (as seen by the JVM).</p>

<p><code>javac</code> will see the type of <code>l</code> as <code>List-of-String</code>, and will use that type information to carefully check for syntax errors, such as an attempted <code>add()</code> of an illegal type.</p>

<p>Conversely, the JVM will see <code>l</code> as an object of type <code>ArrayList</code>鈥攁s we
can see from the <code>println()</code> statement. The runtime type of <code>l</code> is a
raw type due to type erasure.</p>

<p>The compile-time and runtime types are therefore slightly different from
each other. The slightly strange thing is that in some ways, the runtime
type is both more <em>and</em> less specific than the compile-time type.</p>

<p>The runtime type is less specific than the compile-time type, because
the type information about the payload type is gone鈥攊t has been erased,
and the resulting runtime type is just a raw type.</p>

<p>The compile-time type is less specific than the runtime type, because we
don鈥檛 know exactly what concrete type <code>l</code> will be鈥攁ll we know is that it
will be of a type compatible with <code>List</code>.</p>

<p>The differences between compile and runtime typing sometimes confuse new Java programmers, but the distinction quickly comes to be seen as a normal part of working in the language.</p>
</div></section>













<section data-pdf-bookmark="Using and Designing Generic Types" data-type="sect2"><div class="sect2" id="javanut7-CHP-4-SECT-2.11">
<h2>Using and Designing Generic Types</h2>

<p><a data-primary="generics" data-secondary="using and designing" data-type="indexterm" id="5_idm45941123832056"></a>When working with Java鈥檚 generics, it can sometimes be helpful to think
in terms of two different levels of understanding:</p>
<dl>
<dt>Practitioner</dt>
<dd>
<p>A practitioner needs to use existing generic libraries, and to build
some fairly simple generic classes. At this level, the developer
should also understand the basics of type erasure, as several Java
syntax features are confusing without at least an awareness of the
runtime handling of generics.</p>
</dd>
<dt>Designer</dt>
<dd>
<p>The designer of new libraries that use generics needs to understand
much more of the capabilities of generics. There are some nastier
parts of the spec鈥攊ncluding a full understanding of wildcards, and
advanced topics such as 鈥渃apture-of鈥?error messages.</p>
</dd>
</dl>

<p>Java generics are one of the most complex parts of the language
specification with a lot of potential corner cases, which not every
developer needs to fully understand, at least on a first encounter with
this part of Java鈥檚 type system.<a data-startref="ix_ch04-asciidoc9" data-type="indexterm" id="5_idm45941123826504"></a><a data-startref="ix_ch04-asciidoc8" data-type="indexterm" id="5_idm45941123825800"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Enums and Annotations" data-type="sect1"><div class="sect1" id="javanut7-CHP-4-SECT-3">
<h1>Enums and Annotations</h1>

<p>Java has specialized forms of classes and interfaces that are used to
fulfill specific roles in the type system. They are known as <em>enumerated
types</em> and <em>annotation types</em>, or normally just <em>enums</em> and <em>annotations</em>.</p>








<section data-pdf-bookmark="Enums" data-type="sect2"><div class="sect2" id="javanut7-CHP-4-SECT-3.1">
<h2>Enums</h2>

<p><a data-primary="class(es)" data-secondary="enums" data-type="indexterm" id="5_idm45941123819384"></a><a data-primary="enums (enumerated types)" data-type="indexterm" id="5_idm45941123818408"></a><a data-primary="type system" data-secondary="enums" data-type="indexterm" id="5_idm45941123775144"></a>Enums are a variation of classes that have limited functionality and
that have only a small number of possible values that the type permits.</p>

<p>For example, suppose we want to define a type to represent the primary
colors of red, green, and blue, and we want these to be the only
possible values of the type. We can do this by making use of the <code>enum</code>
keyword:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">enum</code> <code class="n">PrimaryColor</code> <code class="o">{</code>
  <code class="c1">// The ; is not required at the end of the list of instances</code>
  <code class="n">RED</code><code class="o">,</code> <code class="n">GREEN</code><code class="o">,</code> <code class="n">BLUE</code>
<code class="o">}</code></pre>

<p>Instances of the type <code>PrimaryColor</code> can then be referenced as though
they were static fields: <code>PrimaryColor.RED</code>, <code>PrimaryColor.GREEN</code>, and
<code>PrimaryColor.BLUE</code>.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><a data-primary="C/C++" data-secondary="enum types in" data-type="indexterm" id="5_idm45941123761272"></a>In other languages, such as C++, the role of enum types is fulfilled by using constant integers, but Java鈥檚 approach provides better type safety and more flexiblity.</p>
</div>

<p>As enums are specialized classes, enums can have member fields and methods.
If they do have a body (consisting of fields or methods), then the semicolon at the end of the list of instances is required, and the list of enum constants must precede the methods and fields.</p>

<p>For example, suppose that we want to have an enum that encompasses the
first few regular polygons (shapes with all sides and all angles equal),
and we want them to have some behavior (in the form of methods). We
could achieve this by using an enum that takes a value as a parameter,
like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">enum</code> <code class="n">RegularPolygon</code> <code class="o">{</code>
  <code class="c1">// The ; is mandatory for enums that have parameters</code>
  <code class="n">TRIANGLE</code><code class="o">(</code><code class="mi">3</code><code class="o">),</code> <code class="n">SQUARE</code><code class="o">(</code><code class="mi">4</code><code class="o">),</code> <code class="n">PENTAGON</code><code class="o">(</code><code class="mi">5</code><code class="o">),</code> <code class="n">HEXAGON</code><code class="o">(</code><code class="mi">6</code><code class="o">);</code>

  <code class="kd">private</code> <code class="n">Shape</code> <code class="n">shape</code><code class="o">;</code>

  <code class="kd">public</code> <code class="n">Shape</code> <code class="nf">getShape</code><code class="o">()</code> <code class="o">{</code>
    <code class="k">return</code> <code class="n">shape</code><code class="o">;</code>
  <code class="o">}</code>

  <code class="kd">private</code> <code class="nf">RegularPolygon</code><code class="o">(</code><code class="kt">int</code> <code class="n">sides</code><code class="o">)</code> <code class="o">{</code>
    <code class="k">switch</code> <code class="o">(</code><code class="n">sides</code><code class="o">)</code> <code class="o">{</code>
      <code class="k">case</code> <code class="mi">3</code><code class="o">:</code>
        <code class="c1">// We assume that we have some general constructors</code>
        <code class="c1">// for shapes that take the side length and</code>
        <code class="c1">// angles in degrees as parameters</code>
        <code class="n">shape</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Triangle</code><code class="o">(</code><code class="mi">1</code><code class="o">,</code><code class="mi">1</code><code class="o">,</code><code class="mi">1</code><code class="o">,</code><code class="mi">60</code><code class="o">,</code><code class="mi">60</code><code class="o">,</code><code class="mi">60</code><code class="o">);</code>
        <code class="k">break</code><code class="o">;</code>
      <code class="k">case</code> <code class="mi">4</code><code class="o">:</code>
        <code class="n">shape</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Rectangle</code><code class="o">(</code><code class="mi">1</code><code class="o">,</code><code class="mi">1</code><code class="o">);</code>
        <code class="k">break</code><code class="o">;</code>
      <code class="k">case</code> <code class="mi">5</code><code class="o">:</code>
        <code class="n">shape</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Pentagon</code><code class="o">(</code><code class="mi">1</code><code class="o">,</code><code class="mi">1</code><code class="o">,</code><code class="mi">1</code><code class="o">,</code><code class="mi">1</code><code class="o">,</code><code class="mi">1</code><code class="o">,</code><code class="mi">108</code><code class="o">,</code><code class="mi">108</code><code class="o">,</code><code class="mi">108</code><code class="o">,</code><code class="mi">108</code><code class="o">,</code><code class="mi">108</code><code class="o">);</code>
        <code class="k">break</code><code class="o">;</code>
      <code class="k">case</code> <code class="mi">6</code><code class="o">:</code>
        <code class="n">shape</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Hexagon</code><code class="o">(</code><code class="mi">1</code><code class="o">,</code><code class="mi">1</code><code class="o">,</code><code class="mi">1</code><code class="o">,</code><code class="mi">1</code><code class="o">,</code><code class="mi">1</code><code class="o">,</code><code class="mi">1</code><code class="o">,</code><code class="mi">120</code><code class="o">,</code><code class="mi">120</code><code class="o">,</code><code class="mi">120</code><code class="o">,</code><code class="mi">120</code><code class="o">,</code><code class="mi">120</code><code class="o">,</code><code class="mi">120</code><code class="o">);</code>
        <code class="k">break</code><code class="o">;</code>
    <code class="o">}</code>
  <code class="o">}</code>
<code class="o">}</code></pre>

<p>These parameters (only one of them in this example) are passed to the
constructor to create the individual enum instances. As the enum
instances are created by the Java runtime, and can鈥檛 be instantiated
from outside, the constructor is declared as private.</p>

<p>Enums have some special properties:</p>

<ul>
<li>
<p>All (implicitly) extend <code>java.lang.Enum</code></p>
</li>
<li>
<p>May not be generic</p>
</li>
<li>
<p>May implement interfaces</p>
</li>
<li>
<p>Cannot be extended</p>
</li>
<li>
<p>May only have abstract methods if all enum values provide an
implementation body</p>
</li>
<li>
<p>May not be directly instantiated by <code>new</code></p>
</li>
</ul>
</div></section>













<section data-pdf-bookmark="Annotations" data-type="sect2"><div class="sect2" id="javanut7-CHP-4-SECT-3.2">
<h2>Annotations</h2>

<p><a data-primary="annotations (annotated types)" data-type="indexterm" id="5_ix_ch04-asciidoc15"></a><a data-primary="interfaces" data-secondary="annotations" data-type="indexterm" id="5_ix_ch04-asciidoc16"></a><a data-primary="type system" data-secondary="annotations" data-type="indexterm" id="5_ix_ch04-asciidoc17"></a>Annotations are a specialized kind of interface that, as the name
suggests, annotate some part of a Java program.</p>

<p><a data-primary="@Override annotation" data-primary-sortas="Override annotation" data-type="indexterm" id="5_idm45941123568856"></a>For example, consider the <code>@Override</code> annotation. You may have seen it
on some methods in some of the earlier examples, and may have asked the
following question: what does it do?</p>

<p>The short, and perhaps surprising, answer is that it does nothing at
all.</p>

<p>The less short (and flippant) answer is that, like all annotations, it
has no direct effect, but instead acts as additional information about
the method that it annotates; in this case, it denotes that a method
overrides a superclass method.</p>

<p>This acts as a useful hint to compilers and integrated development
environments (IDEs)鈥攊f a developer has misspelled the name of a method
that she intended to be an override of a superclass method, then the
presence of the <code>@Override</code> annotation on the misspelled method (which
does not override anything) alerts the compiler to the fact that
something is not right.</p>

<p>Annotations, as originally conceived, were not supposed to alter program semantics; instead, they were to provide optional metadata.
In its strictest sense, this means that they should not affect program execution and instead should only provide information for compilers and other pre-execution phases.</p>

<p>In practice, modern Java applications make heavy use of annotations, and this now includes many use cases that essentially render the annotated classes useless without additional runtime support.</p>

<p>For example, classes bearing annotations such as <code>@Inject</code>, <code>@Test</code>, or <code>@Autowired</code> cannot realistically be used outside of a suitable container.
As a result, it is difficult to argue that such annotations do not violate the 鈥渘o semantic meaning鈥?rule.</p>

<p><a data-primary="java.lang.Object" data-secondary="annotations in" data-type="indexterm" id="5_idm45941123561336"></a>The platform defines a small number of basic annotations in
<code>java.lang</code>. The original set were <code>@Override</code>, <code>@Deprecated</code>, and
<code>@SuppressWarnings</code>鈥攚hich were used to indicate that a method was
overriden, deprecated, or that it generated some compiler warnings that
should be suppressed.</p>

<p><a data-primary="@FunctionalInterface annotation" data-primary-sortas="FunctionalInterface annotation" data-type="indexterm" id="5_idm45941123558088"></a>These were augmented by <code>@SafeVarargs</code> in Java 7 (which provides extended warning suppression for varargs methods) and <code>@FunctionalInterface</code> in Java 8.</p>

<p>This last annotation indicates an interface can be used as a target for a lambda expression鈥攊t is a useful marker annotation although not mandatory, as we will see.</p>

<p>Annotations have some special properties, compared to regular
interfaces:</p>

<ul>
<li>
<p>All (implicitly) extend <code>java.lang.annotation.Annotation</code></p>
</li>
<li>
<p>May not be generic</p>
</li>
<li>
<p>May not extend any other interface</p>
</li>
<li>
<p>May only define zero-arg methods</p>
</li>
<li>
<p>May not define methods that throw exceptions</p>
</li>
<li>
<p>Have restrictions on the return types of methods</p>
</li>
<li>
<p>Can have a default return value for methods</p>
</li>
</ul>

<p>In practice, annotations do not typically have a great deal of functionality and instead are a fairly simple language concept.</p>
</div></section>













<section data-pdf-bookmark="Defining Custom Annotations" data-type="sect2"><div class="sect2" id="javanut7-CHP-4-SECT-3.3">
<h2>Defining Custom Annotations</h2>

<p><a data-primary="annotations (annotated types)" data-secondary="defining custom types" data-type="indexterm" id="5_idm45941123545544"></a><a data-primary="custom annotations, defining" data-type="indexterm" id="5_idm45941123544552"></a>Defining custom annotation types for use in your own code is not that
hard. The <code>@interface</code> keyword allows the developer to define a new
annotation type, in much the same way that <code>class</code> or <code>interface</code> is
used.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><a data-primary="meta-annotations" data-type="indexterm" id="5_idm45941123541368"></a>The key to writing custom annotations is the use of 鈥渕eta-annotations.鈥?
These are special annotations that appear on the
definition of new (custom) annotation types.</p>
</div>

<p>The meta-annotations are defined in <code>java.lang.annotation</code> and allow
the developer to specify policy for where the new annotation type is to
be used, and how it will be treated by the compiler and runtime.</p>

<p>There are two primary meta-annotations that are both essentially
required when creating a new annotation type鈥?code&gt;@Target</code> and
<code>@Retention</code>. These both take values that are represented as enums.</p>

<p>The <code>@Target</code> meta-annotation indicates where the new custom annotation
can be legally placed within Java source code. The enum <code>ElementType</code>
has the possible values <code>TYPE</code>, <code>FIELD</code>, <code>METHOD</code>,
<code>PARAMETER</code>, <code>CONSTRUCTOR</code>, <code>LOCAL_VARIABLE</code>, <code>ANNOTATION_TYPE</code>,
<code>PACKAGE</code>, <code>TYPE_PARAMETER</code>, and <code>TYPE_USE</code>, and annotations can indicate that they intend to be used at one or more of these locations.</p>

<p>The other meta-annotation is <code>@Retention</code>, which indicates how <code>javac</code>
and the Java runtime should process the custom annotation type. It can
have one of three values, which are represented by the enum
<code>RetentionPolicy</code>:</p>
<dl>
<dt><code>SOURCE</code></dt>
<dd>
<p>Annotations with this retention policy are discarded by <code>javac</code> during <span class="keep-together">compilation</span>.</p>
</dd>
<dt><code>CLASS</code></dt>
<dd>
<p>This means that the annotation will be present in the class file, but
will not necessarily be accessible at runtime by the JVM. This is
rarely used, but is sometimes seen in tools that do offline analysis
of JVM bytecode.</p>
</dd>
<dt><code>RUNTIME</code></dt>
<dd>
<p>This indicates that the annotation will be available for user code to
access at runtime (by using reflection).</p>
</dd>
</dl>

<p>Let鈥檚 take a look at an example, a simple annotation called <code>@Nickname</code>,
which allows the developer to define a nickname for a method, which can
then be used to find the method reflectively at runtime:</p>

<pre data-code-language="java" data-type="programlisting"><code class="nd">@Target</code><code class="o">(</code><code class="n">ElementType</code><code class="o">.</code><code class="na">METHOD</code><code class="o">)</code>
<code class="nd">@Retention</code><code class="o">(</code><code class="n">RetentionPolicy</code><code class="o">.</code><code class="na">RUNTIME</code><code class="o">)</code>
<code class="kd">public</code> <code class="nd">@interface</code> <code class="n">Nickname</code> <code class="o">{</code>
    <code class="n">String</code><code class="o">[]</code> <code class="nf">value</code><code class="o">()</code> <code class="k">default</code> <code class="o">{};</code>
<code class="o">}</code></pre>

<p>This is all that鈥檚 required to define the annotation鈥攁 syntax element
where the annotation can appear, a retention policy, and the name of the
element. As we need to be able to supply the nickname we鈥檙e assigning to
the method, we also need to define a method on the annotation. Despite
this, defining new custom annotations is a remarkably compact
undertaking.</p>

<p>In addition to the two primary meta-annotations, there are also the
<code>@Inherited</code> and <code>@Documented</code> meta-annotations. These are much less
frequently encountered in practice, and details on them can be found in
the platform documentation.</p>
</div></section>













<section data-pdf-bookmark="Type Annotations" data-type="sect2"><div class="sect2" id="javanut7-CHP-4-SECT-3.4">
<h2>Type Annotations</h2>

<p><a data-primary="annotations (annotated types)" data-secondary="type annotations" data-type="indexterm" id="5_idm45941123505736"></a><a data-primary="Java 8" data-secondary="ElementType values" data-type="indexterm" id="5_idm45941123504792"></a>With the release of Java 8, two new values for <code>ElementType</code> were
added鈥?code&gt;TYPE_PARAMETER</code> and <code>TYPE_USE</code>. These new values allow the use of
annotations in places where they were previously not legal, such as at
any site where a type is used. This enables the developer to write code
such as:</p>

<pre data-code-language="java" data-type="programlisting"><code class="nd">@NotNull</code> <code class="n">String</code> <code class="n">safeString</code> <code class="o">=</code> <code class="n">getMyString</code><code class="o">();</code></pre>

<p>The extra type information conveyed by the <code>@NotNull</code> can then be used by a special type checker to detect problems (a possible <code>NullPointerException</code>, in this example) and to perform additional static analysis.
The basic Java 8 distribution ships with some basic pluggable type checkers, but also provides a framework for allowing developers and library authors to create their own.<a data-startref="ix_ch04-asciidoc17" data-type="indexterm" id="5_idm45941123493592"></a><a data-startref="ix_ch04-asciidoc16" data-type="indexterm" id="5_idm45941123492984"></a><a data-startref="ix_ch04-asciidoc15" data-type="indexterm" id="5_idm45941123492312"></a></p>

<p>In this section, we鈥檝e met Java鈥檚 enum and annotation types.
Let鈥檚 move on to consider the next important part of Java鈥檚 type system: lambda expressions.</p>
</div></section>





</div></section>













<section data-pdf-bookmark="Lambda Expressions" data-type="sect1"><div class="sect1" id="javanut7-CHP-4-SECT-4">
<h1>Lambda Expressions</h1>

<p><a data-primary="lambda expressions" data-type="indexterm" id="5_ix_ch04-asciidoc18"></a><a data-primary="type system" data-secondary="lambda expressions" data-type="indexterm" id="5_ix_ch04-asciidoc19"></a>One <a data-primary="lambda expressions" data-secondary="basics" data-type="indexterm" id="5_ix_ch04-asciidoc20"></a>of the most eagerly anticipated features of Java 8 was the introduction of lambda expressions (frequently referred to as just lambdas).</p>

<p>This was a major upgrade to the Java platform and was driven by five goals, in roughly descending order of priority:</p>

<ul>
<li>
<p>More expressive programming</p>
</li>
<li>
<p>Better libraries</p>
</li>
<li>
<p>Concise code</p>
</li>
<li>
<p>Improved programming safety</p>
</li>
<li>
<p>Potentially increased data parallelism</p>
</li>
</ul>

<p>Lambdas have three key aspects that help define the essential nature of the feature:</p>

<ul>
<li>
<p>They allow small bits of code to be written inline as literals in a program.</p>
</li>
<li>
<p>They relax the strict naming rules of Java code by using type inference.</p>
</li>
<li>
<p>They are intended to facilitate a more functional style of programming Java.</p>
</li>
</ul>

<p>As we saw in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2">Chapter 2</a>, the syntax for a lambda
expression is to take a list of parameters (the types of which are
typically inferred), and to attach that to a method body, like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="o">(</code><code class="n">p</code><code class="o">,</code> <code class="n">q</code><code class="o">)</code> <code class="o">-&gt;</code> <code class="o">{</code> <code class="cm">/* method body */</code> <code class="o">}</code></pre>

<p>This can provide a very compact way to represent what is effectively a single method.
It is also a major departure from earlier versions of Java鈥攗ntil now, we have always had to have a class declaration and then a complete method declaration, all of which adds to the verboseness of the code.</p>

<p><a data-primary="anonymous classes" data-type="indexterm" id="5_idm45941123348616"></a>In fact, before the arrival of lambdas, the only way to approximate this coding style was to use <em>anonymous classes</em>, which we will discuss later in this chapter.
However, since Java 8, lambdas have proved to be very popular with Java programmers and now have mostly taken over the role of anonymous classes wherever they are able to do so.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Despite the similarities between lambda expressions and anonymous classes, lambdas are <em>not</em> simply syntactic sugar over anonymous classes.
In fact, lambdas are implemented using method handles (which we will meet in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch11.html#javanut7-CHP-11">Chapter 11</a>) and a new, special JVM bytecode called <code>invokedynamic</code>.</p>
</div>

<p>Lambda expressions represent the creation of an object of a specific type.
The type of the instance that is created is known as the <em>target type</em> of the lambda.</p>

<p>Only certain types are eligible to be the target of a lamba.</p>

<p><a data-primary="functional interfaces" data-type="indexterm" id="5_idm45941123337832"></a>Target types are also called <em>functional interfaces</em> and they must:</p>

<ul>
<li>
<p>Be interfaces</p>
</li>
<li>
<p>Have only one nondefault method (but may have other methods that are default)</p>
</li>
</ul>

<p><a data-primary="single abstract method (SAM) type" data-type="indexterm" id="5_idm45941123334088"></a>Some developers also like to use the <em>single abstract method</em> (or SAM) type to refer to the interface type that the lambda is converted into.
This draws attention to the fact that to be usable by the lambda expression mechanism, an interface must have only a single nondefault method.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>A lambda expression has almost all of the component parts of a method, with the obvious exception that a lambda doesn鈥檛 have a name.
In fact, many developers like to think of lambdas as 鈥渁nonymous methods.鈥?/p&gt;
</div>

<p>As a result, this means that the single line of code:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Runnable</code> <code class="n">r</code>  <code class="o">=</code> <code class="o">()</code> <code class="o">-&gt;</code> <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Hello</code><code class="o">);</code></pre>

<p>actually represents the creation of an object, which is assigned to a variable <code>r</code>, of type <code>Runnable</code>.<a data-startref="ix_ch04-asciidoc20" data-type="indexterm" id="5_idm45941123328264"></a></p>








<section data-pdf-bookmark="Lambda Expression Conversion" data-type="sect2"><div class="sect2" id="javanut7-CHP-4-SECT-4.1">
<h2>Lambda Expression Conversion</h2>

<p><a data-primary="javac" data-secondary="lambda expression conversion" data-type="indexterm" id="5_idm45941123325464"></a><a data-primary="lambda expressions" data-secondary="conversion" data-type="indexterm" id="5_idm45941123324520"></a>When <code>javac</code> encounters a lambda expression, it interprets it as the
body of a method with a specific signature鈥攂ut which method?</p>

<p>To resolve this question, <code>javac</code> looks at the surrounding code. To be
legal Java code, the lambda expression must satisfy the following properties:</p>

<ul>
<li>
<p>The lambda must appear where an instance of an interface type is
expected.</p>
</li>
<li>
<p>The expected interface type should have exactly one mandatory method.</p>
</li>
<li>
<p>The expected interface method should have a signature that exactly matches that of the lambda expression.</p>
</li>
</ul>

<p>If this is the case, then an instance is created of a type that implements the expected interface, and uses the lambda body as the implementation for the mandatory method.</p>

<p>This slightly complex conversion approach comes from the desire to keep Java鈥檚
type system as purely <em>nominative</em> (based on names). The lambda expression
is said to be <em>converted</em> to an instance of the correct interface type.</p>

<p>From this discussion, we can see that although Java 8 has added lambda
expressions, they have been specifically designed to fit into Java鈥檚
existing type system鈥攚hich has a very strong emphasis on nominal types (rather than the other possible sorts of types that exist in some other programming languages).</p>

<p>Let鈥檚 consider an example of lambda conversion鈥攖he <code>list()</code> method of the <code>java.io.File</code> class.
This method lists the files in a directory. Before it returns the list, though, it passes the name of each file to a <code>FilenameFilter</code> object that the programmer must supply.
This <code>FilenameFilter</code> object accepts or rejects each file, and is a SAM type defined in the <code>java.io</code> package:</p>

<pre data-code-language="java" data-type="programlisting"><code class="nd">@FunctionalInterface</code>
<code class="kd">public</code> <code class="kd">interface</code> <code class="nc">FilenameFilter</code> <code class="o">{</code>
    <code class="kt">boolean</code> <code class="nf">accept</code><code class="o">(</code><code class="n">File</code> <code class="n">dir</code><code class="o">,</code> <code class="n">String</code> <code class="n">name</code><code class="o">);</code>
<code class="o">}</code></pre>

<p><a data-primary="@FunctionalInterface annotation" data-primary-sortas="FunctionalInterface annotation" data-type="indexterm" id="5_idm45941123240360"></a>The type <code>FilenameFilter</code> carries the <code>@FunctionalInterface</code> to indicate that it is a suitable type to be used as the target type for a lambda.
However, this annotation is not required and any type that meets the requirements (by being an interface and a SAM type) can be used as a target type.</p>

<p>This is because the JDK and the existing corpus of Java code already had a huge number of SAM types available before Java 8 was released.
To require potential target types to carry the annotation would have prevented lambdas from being retrofitted to existing code for no real benefit.</p>
<div data-type="tip"><h6>Tip</h6>
<p>In code that you write, you should always try to indicate when your types are usable as target types, which you can do by adding the <code>@FunctionalInterface</code> to them.
This aids readability and can help some automated tools as well.</p>
</div>

<p>Here鈥檚 how we can define a <code>FilenameFilter</code> class to list only those
files whose names end with <em>.java</em>, using a lambda:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">File</code> <code class="n">dir</code> <code class="o">=</code> <code class="k">new</code> <code class="n">File</code><code class="o">(</code><code class="s">/src</code><code class="o">);</code>      <code class="c1">// The directory to list</code>

<code class="n">String</code><code class="o">[]</code> <code class="n">filelist</code> <code class="o">=</code> <code class="n">dir</code><code class="o">.</code><code class="na">list</code><code class="o">((</code><code class="n">d</code><code class="o">,</code> <code class="n">fName</code><code class="o">)</code> <code class="o">-&gt;</code> <code class="n">fName</code><code class="o">.</code><code class="na">endsWith</code><code class="o">(</code><code class="s">.java</code><code class="o">));</code></pre>

<p>For each file in the list, the block of code in the lambda expression is
evaluated. If the method returns <code>true</code> (which happens if the filename
ends in <em>.java</em>), then the file is included in the output鈥攚hich ends up
in the array <code>filelist</code>.</p>

<p>This pattern, where a block of code is used to test if an element of a
container matches a condition, and to only return the elements that pass
the condition, is called a <em>filter idiom</em>鈥攁nd is one of the standard
techniques of functional programming, which we will discuss in more
depth presently.</p>
</div></section>













<section data-pdf-bookmark="Method References" data-type="sect2"><div class="sect2" id="javanut7-CHP-4-SECT-4.2">
<h2>Method References</h2>

<p><a data-primary="lambda expressions" data-secondary="method references and" data-type="indexterm" id="5_idm45941123174680"></a><a data-primary="method references" data-secondary="lambda expressions and" data-type="indexterm" id="5_idm45941123173704"></a>Recall that we can think of lambda expressions as objects representing methods that don鈥檛 have names.
Now, consider this lambda expression:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// In real code this would probably be</code>
<code class="c1">// shorter because of type inference</code>
<code class="o">(</code><code class="n">MyObject</code> <code class="n">myObj</code><code class="o">)</code> <code class="o">-&gt;</code> <code class="n">myObj</code><code class="o">.</code><code class="na">toString</code><code class="o">()</code></pre>

<p>This will be autoconverted to an implementation of a <code>@FunctionalInterface</code> type that has a single nondefault method that takes a single <code>MyObject</code> and returns a <code>String</code>鈥攕pecifically, the string obtained by calling <code>toString()</code> on the instance of <code>MyObject</code>.
However, this seems like excessive boilerplate, and so <a data-primary="Java 8" data-secondary="method references" data-type="indexterm" id="5_idm45941123163672"></a>Java 8 provides a syntax for making this easier to read and write:</p>

<pre data-code-language="java" data-type="programlisting"><code class="nl">MyObject:</code><code class="o">:</code><code class="n">toString</code></pre>

<p>This is a shorthand, known as a <em>method reference</em>, that uses an existing method as a lambda expression. The method reference syntax is completely equivalent to the previous form expressed as a lambda. It can be thought of as using an existing method, but ignoring the name of the method, so it can be used as a lambda and then autoconverted in the usual way. Java defines four types of method reference, which are equivalent to four slightly different lambda expression forms (see <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4-TABLE-1">Table 4-1</a>).</p>
<table id="javanut7-CHP-4-TABLE-1">
<caption><span class="label">Table 4-1. </span>Method references</caption>
<thead>
<tr>
<th>Name</th>
<th>Method reference</th>
<th>Equivalent lambda</th>
</tr>
</thead>
<tbody>
<tr>
<td><p>Unbound</p></td>
<td><p><code>Trade::getPrice</code></p></td>
<td><p><code>trade -&gt; trade.getPrice()</code></p></td>
</tr>
<tr>
<td><p>Bound</p></td>
<td><p><code>System.out::println</code></p></td>
<td><p><code>s -&gt; System.out.println(s)</code></p></td>
</tr>
<tr>
<td><p>Static</p></td>
<td><p><code>System::getProperty</code></p></td>
<td><p><code>key -&gt; System.getProperty(key)</code></p></td>
</tr>
<tr>
<td><p>Constructor</p></td>
<td><p><code>Trade::new</code></p></td>
<td><p><code>price -&gt; new Trade(price)</code></p></td>
</tr>
</tbody>
</table>

<p><a data-primary="unbound method reference" data-type="indexterm" id="5_idm45941123095704"></a>The form we originally introduced can be seen to be an <em>unbound method reference</em>.
When we use an unbound method reference, it is equivalent to a lambda that is expecting an instance of the type that contains the method reference鈥攊n <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4-TABLE-1">Table 4-1</a> that is a <code>Trade</code> object.</p>

<p>It is called an unbound method reference because the receiver object needs to be supplied (as the first argument to the lambda) when the method reference is used.
That is, we are going to call <code>getPrice()</code> on some <code>Trade</code> object, but the supplier of the method reference has not defined which one鈥攖hat is left up to the user of the reference.</p>

<p><a data-primary="bound method reference" data-type="indexterm" id="5_idm45941123091160"></a>By contrast, a <em>bound method reference</em> always includes the receiver as part of the instantiation of the method reference.
In <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4-TABLE-1">Table 4-1</a>, the receiver is <code>System.out</code>鈥攕o when the reference is used, the <code>println()</code> method will always be called on <code>System.out</code>, and all the parameters of the lambda will be used as method parameters to <code>println()</code>.</p>

<p>We will discuss use cases for method references versus lambda expressions in more detail in the next chapter.</p>
</div></section>













<section data-pdf-bookmark="Functional Programming" data-type="sect2"><div class="sect2" id="javanut7-CHP-4-SECT-4.3">
<h2>Functional Programming</h2>

<p><a data-primary="functional programming" data-secondary="lambda expressions and" data-type="indexterm" id="5_ix_ch04-asciidoc21"></a><a data-primary="lambda expressions" data-secondary="functional programming and" data-type="indexterm" id="5_ix_ch04-asciidoc22"></a>Java is fundamentally an object-oriented lanaguage. However, with the
arrival of lambda expressions, it becomes much easier to write code that
is closer to the functional approach.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>There鈥檚 no single definition of exactly what constitutes a <em>functional
language</em>鈥攂ut there is at least a consensus that it should at minimum
contain the ability to represent a function as a value that can be put
into a variable.</p>
</div>

<p>Java has always (since version 1.1) been able to represent functions via
inner classes, but the syntax was complex and lacking in clarity.
Lambda expressions greatly simplify that syntax, and so it is only
natural that more developers will be seeking to use aspects of
functional programming in their Java code.</p>

<p>The first taste of functional programming that Java developers are
likely to encounter are three basic idioms that are remarkably useful:</p>
<dl>
<dt><code>map()</code></dt>
<dd>
<p><a data-primary="map()" data-type="indexterm" id="5_idm45941123061176"></a>The map idiom is used with lists and list-like containers. The idea
is that a function is passed in that is applied to each element in the
collection, and a new collection is created鈥攃onsisting of the results
of applying the function to each element in turn. This means that a
map idiom converts a collection of one type to a collection of
potentially a different type.</p>
</dd>
<dt><code>filter()</code></dt>
<dd>
<p><a data-primary="filter()" data-type="indexterm" id="5_idm45941123058680"></a>We have already met an example of the filter idiom, when we discussed
how to replace an anonymous implementation of <code>FilenameFilter</code> with a
lambda. The filter idiom is used for producing a new subset of a
collection, based on some selection criteria.
Note that in functional programming, it is normal to produce a new collection, rather than modifying an existing one in-place.</p>
</dd>
<dt><code>reduce()</code></dt>
<dd>
<p><a data-primary="reduce()" data-type="indexterm" id="5_idm45941123055768"></a>The reduce idiom has several different guises. It is an aggregation
operation, which can be called <em>fold</em>, <em>accumulate</em>, or <em>aggregate</em>
as well as reduce. The basic idea is to take an initial value, and an
aggregation (or reduction) function, and apply the reduction function
to each element in turn, building up a final result for the whole
collection by making a series of intermediate results鈥攕imilar to a
鈥渞unning total鈥濃€攁s the reduce operation traverses the collection.</p>
</dd>
</dl>

<p>Java has full support for these key functional idioms (and several
others). The implementation is explained in some depth in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch08.html#javanut7-CHP-8">Chapter 8</a>, where we discuss Java鈥檚 data structures
and collections, and in particular the <em>stream</em> abstraction, which makes
all of this possible.</p>

<p>Let鈥檚 conclude this introduction with some words of caution. It鈥檚 worth
noting that Java is best regarded as having support for 鈥渟lightly
functional programming.鈥?It is not an especially functional language,
nor does it try to be. Some particular aspects of Java that militate
against any claims to being a functional language include the following:</p>

<ul>
<li>
<p>Java has no structural types, which means no 鈥渢rue鈥?function types.
Every lambda is automatically converted to the appropriate nominal target type.</p>
</li>
<li>
<p>Type erasure causes problems for functional programming鈥攖ype safety
can be lost for higher-order functions.</p>
</li>
<li>
<p>Java is inherently mutable (as we鈥檒l discuss in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch06.html#javanut7-CHP-6">Chapter 6</a>)鈥攎utability is often regarded as highly
undesirable for functional languages.</p>
</li>
<li>
<p>The Java collections are imperative, not functional. Collections must be converted to streams to use functional style.</p>
</li>
</ul>

<p>Despite this, easy access to the basics of functional programing鈥攁nd
especially idioms such as map, filter, and reduce鈥攊s a huge step forward
for the Java community. These idioms are so useful that a large majority
of Java developers will never need or miss the more advanced
capabilities provided by languages with a more thoroughbred functional
pedigree.</p>

<p>In truth, many of these techniques were possible using nested
types, via patterns like callbacks and handlers, but the syntax was
always quite cumbersome, especially given that you had to explicitly define
a completely new type even when you only needed to express a single line of
code in the callback.<a data-startref="ix_ch04-asciidoc22" data-type="indexterm" id="5_idm45941123043704"></a><a data-startref="ix_ch04-asciidoc21" data-type="indexterm" id="5_idm45941123043000"></a></p>
</div></section>













<section data-pdf-bookmark="Lexical Scoping and Local Variables" data-type="sect2"><div class="sect2" id="javanut7-CHP-4-SECT-4.4">
<h2>Lexical Scoping and Local Variables</h2>

<p><a data-primary="lambda expressions" data-secondary="lexical scoping and local variables" data-type="indexterm" id="5_ix_ch04-asciidoc23"></a><a data-primary="local variables" data-secondary="lambda expressions and" data-type="indexterm" id="5_ix_ch04-asciidoc24"></a>A local variable is defined within a block of code that defines its <em>scope</em>, and outside of that scope, a local variable cannot be accessed and ceases to exist.
<a data-primary="lexical scoping" data-type="indexterm" id="5_idm45941123037352"></a>Only code within the curly braces that define the boundaries of a block can use local variables defined in that block.
This type of scoping is known as <em>lexical scoping</em>, and just defines a section of source code within which a variable can be used.</p>

<p>It is common for programmers to think of such a scope as <em>temporal</em> instead鈥攖hat is, to think of a local variable as existing from the time the JVM begins executing the block until the time control exits the block.
This is usually a reasonable way to think about local variables and their scope.
However, lambda expressions (and anonymous and local classes, which we will meet later) have the ability to bend or break this intuition somewhat.</p>

<p>This can cause effects that some developers initially find surprising.
This is because lambdas can use local variables, and so they can contain copies of values from lexical scopes that no longer exist.
This can been seen in the following code:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">interface</code> <code class="nc">IntHolder</code> <code class="o">{</code>
    <code class="kd">public</code> <code class="kt">int</code> <code class="nf">getValue</code><code class="o">();</code>
<code class="o">}</code>

<code class="kd">public</code> <code class="kd">class</code> <code class="nc">Weird</code> <code class="o">{</code>
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">IntHolder</code><code class="o">[]</code> <code class="n">holders</code> <code class="o">=</code> <code class="k">new</code> <code class="n">IntHolder</code><code class="o">[</code><code class="mi">10</code><code class="o">];</code>
        <code class="k">for</code> <code class="o">(</code><code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code> <code class="n">i</code> <code class="o">&lt;</code> <code class="mi">10</code><code class="o">;</code> <code class="n">i</code><code class="o">++)</code> <code class="o">{</code>
            <code class="kd">final</code> <code class="kt">int</code> <code class="n">fi</code> <code class="o">=</code> <code class="n">i</code><code class="o">;</code>

            <code class="n">holders</code><code class="o">[</code><code class="n">i</code><code class="o">]</code> <code class="o">=</code> <code class="o">()</code> <code class="o">-&gt;</code> <code class="o">{</code>
                <code class="k">return</code> <code class="n">fi</code><code class="o">;</code>
            <code class="o">};</code>
        <code class="o">}</code>
  <code class="c1">// The lambda is now out of scope, but we have 10 valid instances</code>
  <code class="c1">// of the class the lambda has been converted to in our array.</code>
  <code class="c1">// The local variable fi is not in our scope here, but is still</code>
  <code class="c1">// in scope for the getValue() method of each of those 10 objects.</code>
  <code class="c1">// So call getValue() for each object and print it out.</code>
  <code class="c1">// This prints the digits 0 to 9.</code>
        <code class="k">for</code> <code class="o">(</code><code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code> <code class="n">i</code> <code class="o">&lt;</code> <code class="mi">10</code><code class="o">;</code> <code class="n">i</code><code class="o">++)</code> <code class="o">{</code>
            <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">holders</code><code class="o">[</code><code class="n">i</code><code class="o">].</code><code class="na">getValue</code><code class="o">());</code>
        <code class="o">}</code>
    <code class="o">}</code>
<code class="o">}</code></pre>

<p>Each instance of a lambda has an automatically created private copy of each of the final local variables it uses, so, in effect, it has its own private copy of the scope that existed when it was created.
<a data-primary="captured variable" data-type="indexterm" id="5_idm45941123031080"></a>This is sometimes referred to as a <em>captured</em> variable.</p>

<p><a data-primary="closures" data-type="indexterm" id="5_idm45941123029704"></a>Lambdas that capture variables like this are referred to as <em>closures</em>, and the variables are said to have been <em>closed over</em>.</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>Other programming languages may have a slightly different definition of a closure.
In fact, some theorists would dispute that Java鈥檚 mechanism counts as a closure because, technically, it is the contents of the variable (a value) and not the variable itself that is captured.</p>
</div>

<p>In practice, the preceding closure example is more verbose than it needs to be in two separate ways:</p>

<ul>
<li>
<p>The lambda has an explicit scope <code>{}</code> and <code>return</code> statement.</p>
</li>
<li>
<p>The variable <code>fi</code> is explicitly declared <code>final</code>.</p>
</li>
</ul>

<p><a data-primary="javac" data-secondary="lambda expression conversion" data-type="indexterm" id="5_idm45941122917416"></a>The compiler <code>javac</code> helps with both of these.</p>

<p>Lambdas that only return the value of a single expression need not include a scope or <code>return</code>; instead, the body of the lambda is just the expression without the need for curly braces.
In our example we have explicitly included the braces and <code>return</code> statement to spell out that the lambda is defining its own scope.</p>

<p>In early versions of Java there were two hard requirements when closing over a <span class="keep-together">variable</span>:</p>

<ul>
<li>
<p>The captures must not be modified after they have been captured (e.g., after the lambda)</p>
</li>
<li>
<p>The captured variables must be declared <code>final</code></p>
</li>
</ul>

<p>However, in recent Java versions, <code>javac</code> can analyze the code and detect whether the programmer attempts to modify the captured variable after the scope of the lambda.
<a data-primary="effectively final variable" data-type="indexterm" id="5_idm45941122909448"></a>If not, then the <code>final</code> qualifier on the captured variable can be omitted (such a variable is said to be <em>effectively final</em>).
If the <code>final</code> qualifier is omitted, then it is a compile-time error to attempt to modify a captured variable after the lambda鈥檚 scope.</p>

<p>The reason for this is that Java implements closures by copying the bit pattern of the contents of the variable into the scope created by the closure.
Further changes to the contents of the closed-over variable would not be reflected in the copy contained in closure scope, so the design decision was made to make such changes illegal, and a compile-time error.</p>

<p>These assists from <code>javac</code> mean that we can rewrite the inner loop of the preceding example to the very compact form:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">for</code> <code class="o">(</code><code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code> <code class="n">i</code> <code class="o">&lt;</code> <code class="mi">10</code><code class="o">;</code> <code class="n">i</code><code class="o">++)</code> <code class="o">{</code>
    <code class="kt">int</code> <code class="n">fi</code> <code class="o">=</code> <code class="n">i</code><code class="o">;</code>
    <code class="n">holders</code><code class="o">[</code><code class="n">i</code><code class="o">]</code> <code class="o">=</code> <code class="o">()</code> <code class="o">-&gt;</code> <code class="n">fi</code><code class="o">;</code>
<code class="o">}</code></pre>

<p>Closures are very useful in some styles of programming, and different programming languages define and implement closures in different ways.
Java implements closures as lambda expressions, but local classes and anonymous classes can also capture state鈥攁nd in fact this is how Java implemented closures before lambdas were available<a data-startref="ix_ch04-asciidoc24" data-type="indexterm" id="5_idm45941122881336"></a><a data-startref="ix_ch04-asciidoc23" data-type="indexterm" id="5_idm45941122880728"></a>.<a data-startref="ix_ch04-asciidoc19" data-type="indexterm" id="5_idm45941122879992"></a><a data-startref="ix_ch04-asciidoc18" data-type="indexterm" id="5_idm45941122879288"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Nested Types" data-type="sect1"><div class="sect1" id="javanut7-CHP-4-SECT-5">
<h1>Nested Types</h1>

<p><a data-primary="nested types" data-type="indexterm" id="5_ix_ch04-asciidoc25"></a><a data-primary="type system" data-secondary="nested types" data-type="indexterm" id="5_ix_ch04-asciidoc26"></a>The <a data-primary="top-level types" data-type="indexterm" id="5_idm45941122875384"></a>classes, interfaces, and enum types we have seen so far in this book have all been defined as <em>top-level types</em>.
This means that they are direct members of packages, defined independently of other types.
However, type definitions can also be nested within other type definitions. These <em>nested types</em>, commonly known as 鈥渋nner classes,鈥?are a powerful feature of the Java language.</p>

<p>In general, nested types are used for two separate purposes, both related to encapsulation.
First, a type may be nested because it needs especially intimate access to the internals of another type.
By being a nested type, it has access in the same way that member variables and methods do.
This means that nested types have privileged access and can be thought of as 鈥渟lightly bending the rules of encapsulation.鈥?/p&gt;

<p>Another way of thinking about this use case of nested types is that they are types that are somehow tied together with another type.
This means that they don鈥檛 really have a completely independent existence as an entity, and only coexist.</p>

<p>Alternatively, a type may be only required for a very specific reason, and in a very small section of code.
This means that it should be tightly localized, as it is really part of the implementation detail.</p>

<p>In older versions of Java, the only way to do this was with a nested type, such as an anonymous implementation of an interface.
In practice, with the advent of Java 8, this use case has substantially been taken over by lambda expressions. The use of anonymous types as closely localized types has dramatically declined, although it still persists for some cases.</p>

<p>Types can be nested within another type in four different ways:</p>
<dl>
<dt>Static member types</dt>
<dd>
<p>A static member type is any type defined as a <code>static</code> member of
another type. Nested interfaces, enums, and annotations are always
static (even if you don鈥檛 use the keyword).</p>
</dd>
<dt>Nonstatic member classes</dt>
<dd>
<p>A 鈥渘onstatic member type鈥?is simply a member type that is not declared
<code>static</code>. Only classes can be nonstatic member types.</p>
</dd>
<dt>Local classes</dt>
<dd>
<p>A local class is a class that is defined and only visible within a
block of Java code. Interfaces, enums, and annotations may not be
defined locally.</p>
</dd>
<dt>Anonymous classes</dt>
<dd>
<p>An anonymous class is a kind of local class that has no meaningful name that is useful to humans, merely an arbitary name assigned by the compiler, which programmers should not use directly.</p>
<pre>Interfaces, enums, and annotations cannot
be defined pass:[&lt;span class=&quot;keep-together&quot;&gt;anonymously&lt;/span&gt;].</pre>
</dd>
</dl>

<p>The term 鈥渘ested types,鈥?while a correct and precise usage, is not widely used by developers. Instead, most Java programmers use the much vaguer term 鈥渋nner class.鈥?Depending on the situation, this can refer to a nonstatic member class, local class, or anonymous class, but not a static member type, with no real way to distinguish between them.</p>

<p>Fortunately, although the terminology for describing nested types is not always clear, the syntax for working with them is, and it is usually apparent from context which kind of nested type is being discussed.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><a data-primary="Java 11" data-secondary="nested types" data-type="indexterm" id="5_idm45941122860120"></a>Until Java 11, nested types were implemented using a compiler trick. Experienced Java programmers should note that this detail has actually changed in Java 11, and it is no longer done in quite the same way as it used to be.</p>
</div>

<p>Let鈥檚 move on to describe each of the four kinds of nested types in greater detail.
Each section describes the features of the nested type, the restrictions on its use, and any special Java syntax used with the type.</p>








<section data-pdf-bookmark="Static Member Types" data-type="sect2"><div class="sect2" id="javanut7-CHP-4-SECT-5.1">
<h2>Static Member Types</h2>

<p><a data-primary="member classes" data-secondary="static" data-type="indexterm" id="5_ix_ch04-asciidoc27"></a><a data-primary="nested types" data-secondary="static member types" data-type="indexterm" id="5_ix_ch04-asciidoc28"></a><a data-primary="static member types" data-type="indexterm" id="5_ix_ch04-asciidoc29"></a>A <em>static member type</em> is much like a regular top-level type. For
convenience, however, it is nested within the namespace of another
type. Static member types have the following basic properties:</p>

<ul>
<li>
<p>A static member type is like the other static members of a class:
static fields and static methods.</p>
</li>
<li>
<p>A static member type is not associated with any instance of the
containing class (i.e., there is no <code>this</code> object).</p>
</li>
<li>
<p>A static member type can access (only) the <code>static</code> members of the
class that contains it.</p>
</li>
<li>
<p>A static member type has access to all the <code>static</code> members (including
any other static member types) of its containing type.</p>
</li>
<li>
<p>Nested interfaces, enums, and annotations are implicitly static,
whether or not the <code>static</code> keyword appears.</p>
</li>
<li>
<p>Any type nested within an interface or annotation is also implicitly
<code>static</code>.</p>
</li>
<li>
<p>Static member types may be defined within top-level types or nested to
any depth within other static member types.</p>
</li>
<li>
<p>A static member type may not be defined within any other kind of
nested type.</p>
</li>
</ul>

<p>Let鈥檚 look at a quick example of the syntax for static member types.
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4-EX-1">Example 4-1</a> shows a helper interface defined
as a static member of a containing class.</p>
<div data-type="example" id="javanut7-CHP-4-EX-1">
<h5><span class="label">Example 4-1. </span>Defining and using a static member interface</h5>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// A class that implements a stack as a linked list</code>
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">LinkedStack</code> <code class="o">{</code>

    <code class="c1">// This static member interface defines how objects are linked</code>
    <code class="c1">// The static keyword is optional: all nested interfaces are static</code>
    <code class="kd">static</code> <code class="kd">interface</code> <code class="nc">Linkable</code> <code class="o">{</code>
        <code class="kd">public</code> <code class="n">Linkable</code> <code class="nf">getNext</code><code class="o">();</code>
        <code class="kd">public</code> <code class="kt">void</code> <code class="nf">setNext</code><code class="o">(</code><code class="n">Linkable</code> <code class="n">node</code><code class="o">);</code>
    <code class="o">}</code>

    <code class="c1">// The head of the list is a Linkable object</code>
    <code class="n">Linkable</code> <code class="n">head</code><code class="o">;</code>

    <code class="c1">// Method bodies omitted</code>
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">push</code><code class="o">(</code><code class="n">Linkable</code> <code class="n">node</code><code class="o">)</code> <code class="o">{</code> <code class="o">...</code> <code class="o">}</code>

    <code class="kd">public</code> <code class="n">Object</code> <code class="nf">pop</code><code class="o">()</code> <code class="o">{</code> <code class="o">...</code> <code class="o">}</code>
<code class="o">}</code>

<code class="c1">// This class implements the static member interface</code>
<code class="kd">class</code> <code class="nc">LinkableInteger</code> <code class="kd">implements</code> <code class="n">LinkedStack</code><code class="o">.</code><code class="na">Linkable</code> <code class="o">{</code>
    <code class="c1">// Here&apos;s the node&apos;s data and constructor</code>
    <code class="kt">int</code> <code class="n">i</code><code class="o">;</code>
    <code class="kd">public</code> <code class="nf">LinkableInteger</code><code class="o">(</code><code class="kt">int</code> <code class="n">i</code><code class="o">)</code> <code class="o">{</code> <code class="k">this</code><code class="o">.</code><code class="na">i</code> <code class="o">=</code> <code class="n">i</code><code class="o">;</code> <code class="o">}</code>

    <code class="c1">// Here are the data and methods required to implement the interface</code>
    <code class="n">LinkedStack</code><code class="o">.</code><code class="na">Linkable</code> <code class="n">next</code><code class="o">;</code>

    <code class="kd">public</code> <code class="n">LinkedStack</code><code class="o">.</code><code class="na">Linkable</code> <code class="nf">getNext</code><code class="o">()</code> <code class="o">{</code> <code class="k">return</code> <code class="n">next</code><code class="o">;</code> <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">setNext</code><code class="o">(</code><code class="n">LinkedStack</code><code class="o">.</code><code class="na">Linkable</code> <code class="n">node</code><code class="o">)</code> <code class="o">{</code> <code class="n">next</code> <code class="o">=</code> <code class="n">node</code><code class="o">;</code> <code class="o">}</code>
<code class="o">}</code></pre></div>

<p>The example also shows how this interface is used both within the class that contains it and by external classes. Note the use of its hierarchical name in the external class.</p>










<section data-pdf-bookmark="Features of static member types" data-type="sect3"><div class="sect3" id="javanut7-CHP-4-SECT-5.1.1">
<h3>Features of static member types</h3>

<p>A static member type has access to all static members of its containing
type, including <code>private</code> members. The reverse is true as well: the
methods of the containing type have access to all members of a static
member type, including the <code>private</code> members. A static member type even
has access to all the members of any other static member types,
including the <code>private</code> members of those types. A static member type can
use any other static member without qualifying its name with the name of
the containing type.</p>

<p>Top-level types can be declared as either <code>public</code> or package-private
(if they鈥檙e declared without the <code>public</code> keyword). But declaring
top-level types as <code>private</code> and <code>protected</code> wouldn鈥檛 make a great deal
of sense鈥?code&gt;protected</code> would just mean the same as package-private and a
<code>private</code> top-level class would be unable to be accessed by any other
type.</p>

<p>Static member types, on the other hand, are members and so can use any
access control modifiers that other members of the containing type can.
These modifiers have the same meanings for static member types as they
do for other members of a type.</p>

<p>For example, in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4-EX-1">Example 4-1</a>, the <code>Linkable</code>
interface is declared <code>public</code>, so it can be implemented by any class
that is interested in being stored on a <code>LinkedStack</code>.</p>

<p>In code outside the containing class, a static member type is named by
combining the name of the outer type with that of the inner
(e.g., <code>LinkedStack.Linkable</code>).</p>

<p>Under most circumstances, this syntax provides a helpful reminder that
the inner class is interconnected with its containing type. However, the
Java language does permit you to use the <code>import</code> directive to
directly import a static member type:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kn">import</code> <code class="nn">pkg.LinkedStack.Linkable</code><code class="o">;</code>  <code class="c1">// Import a specific nested type</code>
<code class="c1">// Import all nested types of LinkedStack</code>
<code class="kn">import</code> <code class="nn">pkg.LinkedStack.*</code><code class="o">;</code></pre>

<p>You can then reference the nested type without including the name of its
enclosing type (e.g., just as <code>Linkable</code>).</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>You can also use the <code>import static</code> directive to import a static member
type. See <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2-SECT-10">鈥淧ackages and the Java Namespace鈥?/a&gt; in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2">Chapter 2</a> for details on <code>import</code> and
<code>import static</code>.</p>
</div>

<p>However, importing a nested type obscures the fact that that type is
closely associated with its containing type鈥攚hich is usually important
information鈥攁nd as a result it is not commonly done.<a data-startref="ix_ch04-asciidoc29" data-type="indexterm" id="5_idm45941122612200"></a><a data-startref="ix_ch04-asciidoc28" data-type="indexterm" id="5_idm45941122611496"></a><a data-startref="ix_ch04-asciidoc27" data-type="indexterm" id="5_idm45941122610824"></a></p>
</div></section>



</div></section>













<section data-pdf-bookmark="Nonstatic Member Classes" data-type="sect2"><div class="sect2" id="javanut7-CHP-4-SECT-5.2">
<h2>Nonstatic Member Classes</h2>

<p><a data-primary="member classes" data-secondary="nonstatic" data-type="indexterm" id="5_ix_ch04-asciidoc30"></a><a data-primary="nested types" data-secondary="nonstatic member class" data-type="indexterm" id="5_ix_ch04-asciidoc31"></a><a data-primary="nonstatic members" data-type="indexterm" id="5_ix_ch04-asciidoc32"></a>A <em>nonstatic member class</em> is a class that is declared as a member
of a containing class or enumerated type without the <code>static</code> keyword:</p>

<ul>
<li>
<p>If a static member type is analogous to a class field or class method,
a nonstatic member class is analogous to an instance field or instance
method.</p>
</li>
<li>
<p>Only classes can be nonstatic member types.</p>
</li>
<li>
<p>An instance of a nonstatic member class is always associated with an
instance of the enclosing type.</p>
</li>
<li>
<p>The code of a nonstatic member class has access to all the fields and
methods (both <code>static</code> and non-<code>static</code>) of its enclosing type.</p>
</li>
<li>
<p>Several features of Java syntax exist specifically to work with the
enclosing instance of a nonstatic member class.</p>
</li>
</ul>

<p><a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4-EX-2">Example 4-2</a> shows how a member class can be
defined and used. <a data-primary="java.util.Iterator" data-type="indexterm" id="5_idm45941122596744"></a>This example extends the previous <code>LinkedStack</code>
example to allow enumeration of the elements on the stack by defining an
<code>iterator()</code> method that returns an implementation of the
<code>java.util.Iterator</code> interface. The implementation of this interface is
defined as a member class.</p>
<div data-type="example" id="javanut7-CHP-4-EX-2">
<h5><span class="label">Example 4-2. </span>An iterator implemented as a member class</h5>

<pre data-code-language="java" data-type="programlisting"><code class="kn">import</code> <code class="nn">java.util.Iterator</code><code class="o">;</code>

<code class="kd">public</code> <code class="kd">class</code> <code class="nc">LinkedStack</code> <code class="o">{</code>

    <code class="c1">// Our static member interface</code>
    <code class="kd">public</code> <code class="kd">interface</code> <code class="nc">Linkable</code> <code class="o">{</code>
        <code class="kd">public</code> <code class="n">Linkable</code> <code class="nf">getNext</code><code class="o">();</code>
        <code class="kd">public</code> <code class="kt">void</code> <code class="nf">setNext</code><code class="o">(</code><code class="n">Linkable</code> <code class="n">node</code><code class="o">);</code>
    <code class="o">}</code>

    <code class="c1">// The head of the list</code>
    <code class="kd">private</code> <code class="n">Linkable</code> <code class="n">head</code><code class="o">;</code>

    <code class="c1">// Method bodies omitted here</code>
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">push</code><code class="o">(</code><code class="n">Linkable</code> <code class="n">node</code><code class="o">)</code> <code class="o">{</code> <code class="o">...</code> <code class="o">}</code>
    <code class="kd">public</code> <code class="n">Linkable</code> <code class="nf">pop</code><code class="o">()</code> <code class="o">{</code> <code class="o">...</code> <code class="o">}</code>

    <code class="c1">// This method returns an Iterator object for this LinkedStack</code>
    <code class="kd">public</code> <code class="n">Iterator</code><code class="o">&lt;</code><code class="n">Linkable</code><code class="o">&gt;</code> <code class="nf">iterator</code><code class="o">()</code> <code class="o">{</code> <code class="k">return</code> <code class="k">new</code> <code class="n">LinkedIterator</code><code class="o">();</code> <code class="o">}</code>

    <code class="c1">// Here is the implementation of the Iterator interface,</code>
    <code class="c1">// defined as a nonstatic member class.</code>
    <code class="kd">protected</code> <code class="kd">class</code> <code class="nc">LinkedIterator</code> <code class="kd">implements</code> <code class="n">Iterator</code><code class="o">&lt;</code><code class="n">Linkable</code><code class="o">&gt;</code> <code class="o">{</code>
        <code class="n">Linkable</code> <code class="n">current</code><code class="o">;</code>

        <code class="c1">// The constructor uses a private field of the containing class</code>
        <code class="kd">public</code> <code class="nf">LinkedIterator</code><code class="o">()</code> <code class="o">{</code> <code class="n">current</code> <code class="o">=</code> <code class="n">head</code><code class="o">;</code> <code class="o">}</code>

        <code class="c1">// The following three methods are defined</code>
        <code class="c1">// by the Iterator interface</code>
        <code class="kd">public</code> <code class="kt">boolean</code> <code class="nf">hasNext</code><code class="o">()</code> <code class="o">{</code>  <code class="k">return</code> <code class="n">current</code> <code class="o">!=</code> <code class="kc">null</code><code class="o">;</code> <code class="o">}</code>

        <code class="kd">public</code> <code class="n">Linkable</code> <code class="nf">next</code><code class="o">()</code> <code class="o">{</code>
            <code class="k">if</code> <code class="o">(</code><code class="n">current</code> <code class="o">==</code> <code class="kc">null</code><code class="o">)</code>
              <code class="k">throw</code> <code class="k">new</code> <code class="n">java</code><code class="o">.</code><code class="na">util</code><code class="o">.</code><code class="na">NoSuchElementException</code><code class="o">();</code>
            <code class="n">Linkable</code> <code class="n">value</code> <code class="o">=</code> <code class="n">current</code><code class="o">;</code>
            <code class="n">current</code> <code class="o">=</code> <code class="n">current</code><code class="o">.</code><code class="na">getNext</code><code class="o">();</code>
            <code class="k">return</code> <code class="n">value</code><code class="o">;</code>
        <code class="o">}</code>

        <code class="kd">public</code> <code class="kt">void</code> <code class="nf">remove</code><code class="o">()</code> <code class="o">{</code> <code class="k">throw</code> <code class="k">new</code> <code class="n">UnsupportedOperationException</code><code class="o">();</code> <code class="o">}</code>
    <code class="o">}</code>
<code class="o">}</code></pre></div>

<p>Notice how the <code>LinkedIterator</code> class is nested within the <code>LinkedStack</code>
class. Because <code>LinkedIterator</code> is a helper class used only within
<code>LinkedStack</code>, having it defined so close to where it is used by the
containing class makes for a clean design, just as we discussed when we
introduced nested types.</p>










<section data-pdf-bookmark="Features of member classes" data-type="sect3"><div class="sect3" id="javanut7-CHP-4-SECT-5.2.1">
<h3>Features of member classes</h3>

<p><a data-primary="member classes" data-secondary="features" data-type="indexterm" id="5_idm45941122335256"></a>Like instance fields and instance methods, every instance of a
nonstatic member class is associated with an instance of the class in
which it is defined. This means that the code of a member class has
access to all the instance fields and instance methods (as well as the
<code>static</code> members) of the containing instance, including any that are
declared <code>private</code>.</p>

<p>This crucial feature was already illustrated in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4-EX-2">Example 4-2</a>. Here is the
<code>LinkedStack.LinkedIterator()</code> constructor again:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="nf">LinkedIterator</code><code class="o">()</code> <code class="o">{</code> <code class="n">current</code> <code class="o">=</code> <code class="n">head</code><code class="o">;</code> <code class="o">}</code></pre>

<p>This single line of code sets the <code>current</code> field of the inner class to
the value of the <code>head</code> field of the containing class. The code works as
shown, even though <code>head</code> is declared as a <code>private</code> field in the
containing class.</p>

<p>A nonstatic member class, like any member of a class, can be assigned
one of the standard access control modifiers. In
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4-EX-2">Example 4-2</a>, the <code>LinkedIterator</code> class is
declared <code>protected</code>, so it is inaccessible to code (in a different
package) that uses the <code>LinkedStack</code> class but is accessible to any
class that subclasses <code>LinkedStack</code>.</p>

<p>Member classes have two important restrictions:</p>

<ul>
<li>
<p>A nonstatic member class cannot have the same name as any containing
class or package. This is an important rule, one that is <em>not</em> shared by
fields and <span class="keep-together">methods</span>.</p>
</li>
<li>
<p>Nonstatic member classes cannot contain any <code>static</code> fields, methods,
or types, except for constant fields declared both <code>static</code> and <code>final</code>.</p>
</li>
</ul>
</div></section>













<section data-pdf-bookmark="Syntax for member classes" data-type="sect3"><div class="sect3" id="javanut7-CHP-4-SECT-5.2.2">
<h3>Syntax for member classes</h3>

<p><a data-primary="member classes" data-secondary="syntax for" data-type="indexterm" id="5_idm45941122308776"></a>The most important feature of a member class is that it can access the
instance fields and methods in its containing object.</p>

<p>If we want to use explicit references, and make use of <code>this</code>, then we
have to use a special syntax for explicitly referring to the containing
instance of the <code>this</code> object. For example, if we want to be explicit in
our constructor, we can use the following syntax:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="nf">LinkedIterator</code><code class="o">()</code> <code class="o">{</code> <code class="k">this</code><code class="o">.</code><code class="na">current</code> <code class="o">=</code> <code class="n">LinkedStack</code><code class="o">.</code><code class="na">this</code><code class="o">.</code><code class="na">head</code><code class="o">;</code> <code class="o">}</code></pre>

<p>The general syntax is <em><code>classname.this</code></em>, where <em><code>classname</code></em> is the
name of a containing class. Note that member classes can themselves
contain member classes, nested to any depth.</p>

<p>However, no member class can have the same name as any containing class, so the use of the enclosing class name prepended to <code>this</code> is a perfectly general way to
refer to any containing instance.
Another way of saying this is that the syntax construction <code>EnclosingClass.this</code> is an unambiguous way of referring to the containing instance as an <em>uplevel reference</em>.
<a data-startref="ix_ch04-asciidoc32" data-type="indexterm" id="5_idm45941122272232"></a><a data-startref="ix_ch04-asciidoc31" data-type="indexterm" id="5_idm45941122259480"></a><a data-startref="ix_ch04-asciidoc30" data-type="indexterm" id="5_idm45941122258808"></a></p>
</div></section>



</div></section>













<section data-pdf-bookmark="Local Classes" data-type="sect2"><div class="sect2" id="javanut7-CHP-4-SECT-5.3">
<h2>Local Classes</h2>

<p><a data-primary="local classes" data-type="indexterm" id="5_ix_ch04-asciidoc33"></a><a data-primary="nested types" data-secondary="local classes" data-type="indexterm" id="5_ix_ch04-asciidoc34"></a>A <em>local class</em> is declared locally within a block of Java code
rather than as a member of a class. Only classes may be defined locally:
interfaces, enumerated types, and annotation types must be top-level or
static member types. Typically, a local class is defined within a
method, but it can also be defined within a static initializer or
instance initializer of a class.</p>

<p>Just as all blocks of Java code appear within class definitions, all
local classes are nested within containing blocks. For this reason,
local classes share many of the features of member classes. It is
usually more appropriate to think of them as an entirely separate kind
of nested type.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>See <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch05.html#javanut7-CHP-5">Chapter 5</a> for details as to when it鈥檚
appropriate to choose a local class versus a lambda expression.</p>
</div>

<p>The defining characteristic of a local class is that it is local to a
block of code. Like a local variable, a local class is valid only within
the scope defined by its enclosing block.
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4-EX-3">Example 4-3</a> illustrates how we can modify the
<code>iterator()</code> method of the <span class="keep-togther"><code>LinkedStack</code></span> class so it defines
<code>LinkedIterator</code> as a local class instead of a member class.</p>

<p>By doing this, we move the definition of the class even closer to where
it is used and hopefully improve the clarity of the code even further.
For brevity, <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4-EX-3">Example 4-3</a> shows only the
<code>iterator()</code> method, not the entire <code>LinkedStack</code> class that contains
it.</p>
<div data-type="example" id="javanut7-CHP-4-EX-3">
<h5><span class="label">Example 4-3. </span>Defining and using a local class</h5>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// This method returns an Iterator object for this LinkedStack</code>
<code class="kd">public</code> <code class="n">Iterator</code><code class="o">&lt;</code><code class="n">Linkable</code><code class="o">&gt;</code> <code class="nf">iterator</code><code class="o">()</code> <code class="o">{</code>
    <code class="c1">// Here&apos;s the definition of LinkedIterator as a local class</code>
    <code class="kd">class</code> <code class="nc">LinkedIterator</code> <code class="kd">implements</code> <code class="n">Iterator</code><code class="o">&lt;</code><code class="n">Linkable</code><code class="o">&gt;</code> <code class="o">{</code>
        <code class="n">Linkable</code> <code class="n">current</code><code class="o">;</code>

        <code class="c1">// The constructor uses a private field of the containing class</code>
        <code class="kd">public</code> <code class="nf">LinkedIterator</code><code class="o">()</code> <code class="o">{</code> <code class="n">current</code> <code class="o">=</code> <code class="n">head</code><code class="o">;</code> <code class="o">}</code>

        <code class="c1">// The following three methods are defined</code>
        <code class="c1">// by the Iterator interface</code>
        <code class="kd">public</code> <code class="kt">boolean</code> <code class="nf">hasNext</code><code class="o">()</code> <code class="o">{</code>  <code class="k">return</code> <code class="n">current</code> <code class="o">!=</code> <code class="kc">null</code><code class="o">;</code> <code class="o">}</code>

        <code class="kd">public</code> <code class="n">Linkable</code> <code class="nf">next</code><code class="o">()</code> <code class="o">{</code>
            <code class="k">if</code> <code class="o">(</code><code class="n">current</code> <code class="o">==</code> <code class="kc">null</code><code class="o">)</code>
              <code class="k">throw</code> <code class="k">new</code> <code class="n">java</code><code class="o">.</code><code class="na">util</code><code class="o">.</code><code class="na">NoSuchElementException</code><code class="o">();</code>
            <code class="n">Linkable</code> <code class="n">value</code> <code class="o">=</code> <code class="n">current</code><code class="o">;</code>
            <code class="n">current</code> <code class="o">=</code> <code class="n">current</code><code class="o">.</code><code class="na">getNext</code><code class="o">();</code>
            <code class="k">return</code> <code class="n">value</code><code class="o">;</code>
        <code class="o">}</code>

        <code class="kd">public</code> <code class="kt">void</code> <code class="nf">remove</code><code class="o">()</code> <code class="o">{</code> <code class="k">throw</code> <code class="k">new</code> <code class="n">UnsupportedOperationException</code><code class="o">();</code> <code class="o">}</code>
    <code class="o">}</code>

    <code class="c1">// Create and return an instance of the class we just defined</code>
    <code class="k">return</code> <code class="k">new</code> <code class="nf">LinkedIterator</code><code class="o">();</code>
<code class="o">}</code></pre></div>










<section data-pdf-bookmark="Features of local classes" data-type="sect3"><div class="sect3" id="javanut7-CHP-4-SECT-5.3.1">
<h3>Features of local classes</h3>

<p><a data-primary="local classes" data-secondary="features of" data-type="indexterm" id="5_idm45941122221192"></a>Local classes have the following interesting features:</p>

<ul>
<li>
<p>Like member classes, local classes are associated with a containing
instance and can access any members, including <code>private</code> members, of the
containing class.</p>
</li>
<li>
<p>In addition to accessing fields defined by the containing class, local
classes can access any local variables, method parameters, or exception
parameters that are in the scope of the local method definition and are
declared <code>final</code>.</p>
</li>
</ul>

<p>Local classes are subject to the following restrictions:</p>

<ul>
<li>
<p>The name of a local class is defined only within the block that
defines it; it can never be used outside that block. (Note, however,
that instances of a local class created within the scope of the class
can continue to exist outside of that scope. This situation is described
in more detail later in this section.)</p>
</li>
<li>
<p>Local classes cannot be declared <code>public</code>, <code>protected</code>, <code>private</code>, or
<code>static</code>.</p>
</li>
<li>
<p>Like member classes, and for the same reasons, local classes cannot
contain <code>static</code> fields, methods, or classes. The only exception is for
constants that are declared both <code>static</code> and <code>final</code>.</p>
</li>
<li>
<p>Interfaces, enumerated types, and annotation types cannot be defined
locally.</p>
</li>
<li>
<p>A local class, like a member class, cannot have the same name as any
of its enclosing classes.</p>
</li>
<li>
<p>As noted earlier, a local class can close over the local variables, method parameters, and even exception parameters that are in its scope but only if those variables or parameters are effectively <code>final</code>.</p>
</li>
</ul>
</div></section>













<section data-pdf-bookmark="Scope of a local class" data-type="sect3"><div class="sect3" id="javanut7-CHP-4-SECT-5.3.2">
<h3>Scope of a local class</h3>

<p><a data-primary="local classes" data-secondary="scope of" data-type="indexterm" id="5_idm45941122050712"></a>In discussing nonstatic member classes, we saw that a member class can access any members inherited from superclasses and any members defined by its containing classes.</p>

<p>The same is true for local classes, but local classes can also behave like lambdas and access effectively <code>final</code> local variables and parameters.
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4-EX-4">Example 4-4</a> illustrates the different kinds of fields and variables that may be accessible to a local class (or a lambda, for that matter):</p>
<div data-type="example" id="javanut7-CHP-4-EX-4">
<h5><span class="label">Example 4-4. </span>Fields and variables available to a local class</h5>

<pre data-code-language="java" data-type="programlisting"><code class="kd">class</code> <code class="nc">A</code> <code class="o">{</code> <code class="kd">protected</code> <code class="kt">char</code> <code class="n">a</code> <code class="o">=</code> <code class="sc">a</code><code class="o">;</code> <code class="o">}</code>
<code class="kd">class</code> <code class="nc">B</code> <code class="o">{</code> <code class="kd">protected</code> <code class="kt">char</code> <code class="n">b</code> <code class="o">=</code> <code class="sc">b</code><code class="o">;</code> <code class="o">}</code>

<code class="kd">public</code> <code class="kd">class</code> <code class="nc">C</code> <code class="kd">extends</code> <code class="n">A</code> <code class="o">{</code>
  <code class="kd">private</code> <code class="kt">char</code> <code class="n">c</code> <code class="o">=</code> <code class="sc">c</code><code class="o">;</code>         <code class="c1">// Private fields visible to local class</code>
  <code class="kd">public</code> <code class="kd">static</code> <code class="kt">char</code> <code class="n">d</code> <code class="o">=</code> <code class="sc">d</code><code class="o">;</code>
  <code class="kd">public</code> <code class="kt">void</code> <code class="nf">createLocalObject</code><code class="o">(</code><code class="kd">final</code> <code class="kt">char</code> <code class="n">e</code><code class="o">)</code>
  <code class="o">{</code>
    <code class="kd">final</code> <code class="kt">char</code> <code class="n">f</code> <code class="o">=</code> <code class="sc">f</code><code class="o">;</code>
    <code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code>                  <code class="c1">// i not final; not usable by local class</code>
    <code class="kd">class</code> <code class="nc">Local</code> <code class="kd">extends</code> <code class="n">B</code>
    <code class="o">{</code>
      <code class="kt">char</code> <code class="n">g</code> <code class="o">=</code> <code class="sc">g</code><code class="o">;</code>
      <code class="kd">public</code> <code class="kt">void</code> <code class="nf">printVars</code><code class="o">()</code>
      <code class="o">{</code>
        <code class="c1">// All of these fields and variables are accessible to this class</code>
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">g</code><code class="o">);</code>  <code class="c1">// (this.g) g is a field of this class</code>
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">f</code><code class="o">);</code>  <code class="c1">// f is a final local variable</code>
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">e</code><code class="o">);</code>  <code class="c1">// e is a final local parameter</code>
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">d</code><code class="o">);</code>  <code class="c1">// (C.this.d) d field of containing class</code>
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">c</code><code class="o">);</code>  <code class="c1">// (C.this.c) c field of containing class</code>
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">b</code><code class="o">);</code>  <code class="c1">// b is inherited by this class</code>
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">a</code><code class="o">);</code>  <code class="c1">// a is inherited by the containing class</code>
      <code class="o">}</code>
    <code class="o">}</code>
    <code class="n">Local</code> <code class="n">l</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Local</code><code class="o">();</code>      <code class="c1">// Create an instance of the local class</code>
    <code class="n">l</code><code class="o">.</code><code class="na">printVars</code><code class="o">();</code>              <code class="c1">// and call its printVars() method.</code>
  <code class="o">}</code>
<code class="o">}</code></pre></div>

<p>Local classes have quite a complex scoping structure, therefore. To see why, notice that instances of a local class can have a lifetime that extends past the time that the JVM exits the block where the local class is defined.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>In other words, if you create an instance of a local class, that
instance does not automatically go away when the JVM finishes executing
the block that defines the class. So, even though the definition of the
class was local, instances of that class can escape out of the place
they were defined.</p>
</div>

<p>Local classe, therefore, behave like lambdas in many regards, although the use case of local classes is more general than that of lambdas.
However, in practice the extra generality is rarely required, and lambdas are preferred wherever possible.<a data-startref="ix_ch04-asciidoc34" data-type="indexterm" id="5_idm45941121864776"></a><a data-startref="ix_ch04-asciidoc33" data-type="indexterm" id="5_idm45941121864184"></a></p>
</div></section>



</div></section>













<section data-pdf-bookmark="Anonymous Classes" data-type="sect2"><div class="sect2" id="javanut7-CHP-4-SECT-5.4">
<h2>Anonymous Classes</h2>

<p><a data-primary="anonymous classes" data-type="indexterm" id="5_ix_ch04-asciidoc35"></a><a data-primary="nested types" data-secondary="anonymous classes" data-type="indexterm" id="5_ix_ch04-asciidoc36"></a>An <em>anonymous class</em> is a local class without a name. It is defined and instantiated in a single expression using the <code>new</code> operator.
While a local class definition is a statement in a block of Java code, an anonymous class definition is an expression, which means that it can be included as part of a larger expression, such as a method
call.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><a data-primary="lambda expressions" data-secondary="anonymous classes and" data-type="indexterm" id="5_idm45941121857560"></a>For the sake of completeness, we cover anonymous classes here, but for most use cases, lambda expressions (see <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4-SECT-4">鈥淟ambda Expressions鈥?/a&gt;) have replaced anonymous classes.</p>
</div>

<p>Consider <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4-EX-5">Example 4-5</a>, which shows the
<code>LinkedIterator</code> class implemented as an anonymous class within the
<code>iterator()</code> method of the <span class="keep-together"><code>LinkedStack</code></span> class. Compare it with
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4-EX-4">Example 4-4</a>, which shows the same class
implemented as a local class.</p>
<div data-type="example" id="javanut7-CHP-4-EX-5">
<h5><span class="label">Example 4-5. </span>An enumeration implemented with an anonymous class</h5>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="n">Iterator</code><code class="o">&lt;</code><code class="n">Linkable</code><code class="o">&gt;</code> <code class="nf">iterator</code><code class="o">()</code> <code class="o">{</code>
    <code class="c1">// The anonymous class is defined as part of the return statement</code>
    <code class="k">return</code> <code class="k">new</code> <code class="n">Iterator</code><code class="o">&lt;</code><code class="n">Linkable</code><code class="o">&gt;()</code> <code class="o">{</code>
        <code class="n">Linkable</code> <code class="n">current</code><code class="o">;</code>
        <code class="c1">// Replace constructor with an instance initializer</code>
        <code class="o">{</code> <code class="n">current</code> <code class="o">=</code> <code class="n">head</code><code class="o">;</code> <code class="o">}</code>

        <code class="c1">// The following three methods are defined</code>
        <code class="c1">// by the Iterator interface</code>
        <code class="kd">public</code> <code class="kt">boolean</code> <code class="nf">hasNext</code><code class="o">()</code> <code class="o">{</code>  <code class="k">return</code> <code class="n">current</code> <code class="o">!=</code> <code class="kc">null</code><code class="o">;</code> <code class="o">}</code>
        <code class="kd">public</code> <code class="n">Linkable</code> <code class="nf">next</code><code class="o">()</code> <code class="o">{</code>
            <code class="k">if</code> <code class="o">(</code><code class="n">current</code> <code class="o">==</code> <code class="kc">null</code><code class="o">)</code>
              <code class="k">throw</code> <code class="k">new</code> <code class="n">java</code><code class="o">.</code><code class="na">util</code><code class="o">.</code><code class="na">NoSuchElementException</code><code class="o">();</code>
            <code class="n">Linkable</code> <code class="n">value</code> <code class="o">=</code> <code class="n">current</code><code class="o">;</code>
            <code class="n">current</code> <code class="o">=</code> <code class="n">current</code><code class="o">.</code><code class="na">getNext</code><code class="o">();</code>
            <code class="k">return</code> <code class="n">value</code><code class="o">;</code>
        <code class="o">}</code>
        <code class="kd">public</code> <code class="kt">void</code> <code class="nf">remove</code><code class="o">()</code> <code class="o">{</code> <code class="k">throw</code> <code class="k">new</code> <code class="n">UnsupportedOperationException</code><code class="o">();</code> <code class="o">}</code>
    <code class="o">};</code>  <code class="c1">// Note the required semicolon. It terminates the return statement</code>
<code class="o">}</code></pre></div>

<p>As you can see, the syntax for defining an anonymous class and creating
an instance of that class uses the <code>new</code> keyword, followed by the name
of a type and a class body definition in curly braces.
If the name following the <code>new</code> keyword is the name of a class, the anonymous class is a subclass of the named class.
If the name following <code>new</code> specifies an interface, as in the two previous examples, the anonymous class implements that interface and extends <code>Object</code>.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The syntax for anonymous classes does not include any way to specify an
<code>extends</code> clause, an <code>implements</code> clause, or a name for the class.</p>
</div>

<p>Because an anonymous class has no name, it is not possible to define a
constructor for it within the class body. This is one of the basic
restrictions on anonymous classes. Any arguments you specify between the
parentheses following the superclass name in an anonymous class
definition are implicitly passed to the superclass constructor.
Anonymous classes are commonly used to subclass simple classes that do
not take any constructor arguments, so the parentheses in the anonymous
class definition syntax are often empty.</p>

<p>Because an anonymous class is just a type of local class, anonymous
classes and local classes share the same restrictions. An anonymous
class cannot define any <code>static</code> fields, methods, or classes, except for
<code>static</code> <code>final</code> constants. Interfaces, enumerated types, and annotation
types cannot be defined anonymously. Also, like local classes,
anonymous classes cannot be <code>public</code>, <code>private</code>, <code>protected</code>, or
<code>static</code>.</p>

<p>The syntax for defining an anonymous class combines definition with instantiation, similar to a lambda expression.
Using an anonymous class instead of a local class is not appropriate if you need to create more than a single instance of the class each time the containing block is executed.</p>

<p>Because an anonymous class has no name, it is not possible to define a constructor for an anonymous class.
If your class requires a constructor, you must use a local class instead<a data-startref="ix_ch04-asciidoc36" data-type="indexterm" id="5_idm45941121798696"></a><a data-startref="ix_ch04-asciidoc35" data-type="indexterm" id="5_idm45941121797992"></a>.<a data-startref="ix_ch04-asciidoc26" data-type="indexterm" id="5_idm45941121797192"></a><a data-startref="ix_ch04-asciidoc25" data-type="indexterm" id="5_idm45941121796488"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Non-Denotable Types and var" data-type="sect1"><div class="sect1" id="javanut7-CHP-4-SECT-6">
<h1>Non-Denotable Types and var</h1>

<p><a data-primary="local variable type inference (var)" data-type="indexterm" id="5_idm45941121794120"></a><a data-primary="non-denotable types" data-type="indexterm" id="5_idm45941121793448"></a><a data-primary="type system" data-secondary="non-denotable types and var" data-type="indexterm" id="5_idm45941121792776"></a><a data-primary="var (local variable type inference)" data-type="indexterm" id="5_idm45941121791816"></a>One of the only new language features to arrive in Java 10 is <em>Local Variable Type Inference</em>, otherwise known as <code>var</code>.
This is an enhancement to Java鈥檚 type inference capabilities that may prove to be more significant than it first appears.
In the simplest case, it allows code such as:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">var</code> <code class="n">ls</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;();</code></pre>

<p>which moves the inference from the type of values to the type of variables.</p>

<p>The implementation in Java 10 achieves this by making <code>var</code> a reserved type name rather than a keyword.
This means that code can still use <code>var</code> as a variable, method, or package name without being affected by the new syntax.
However, code that has previously used <code>var</code> as the name of a type will have to be recompiled.</p>

<p>This simple case is designed to reduce verbosity and to make programmers coming to Java from other languages (especially Scala, .NET, and JavaScript) feel more comfortable.
However, it does carry the risk that overuse will potentially obscure the intent of the code being written, so it should be used sparingly.</p>

<p>As well as the simple cases, <code>var</code> actually permits programming constructs that were not possible before.
To see the differences, let鈥檚 consider that <code>javac</code> has always permitted a very limited form of type inference:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">Test</code> <code class="o">{</code>
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="o">{</code>
        <code class="o">(</code><code class="k">new</code> <code class="n">Object</code><code class="o">()</code> <code class="o">{</code>
            <code class="kd">public</code> <code class="kt">void</code> <code class="nf">bar</code><code class="o">()</code> <code class="o">{</code>
                <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">bar!</code><code class="o">);</code>
            <code class="o">}</code>
        <code class="o">}).</code><code class="na">bar</code><code class="o">();</code>
    <code class="o">}</code>
<code class="o">}</code></pre>

<p>The code will compile and run, printing out <code>bar!</code>.
This slightly counterintuitive result occurs because <code>javac</code> preserves enough type information about the anonymous class (i.e., that it has a <code>bar()</code> method) for just long enough that the compiler can conclude that the call to <code>bar()</code> is valid.</p>

<p>In fact, this edge case has been <a href="http://bit.ly/2SjJ734">known in the Java community</a> since at least 2009, long before the arrival of even Java 7.</p>

<p>The problem with this form of type inference is that it has no real practical applications鈥攖he type of 鈥淥bject-with-a-bar-method鈥?exists within the compiler, but the type is impossible to express as the type of a variable鈥攊t is not a <em>denotable type</em>.
This means that before Java 10 the existence of this type is restricted to a single expression and cannot be used in a larger scope.</p>

<p>With the arrival of Java 10, however, the type of variables does not always need to be made explicit.
Instead, we can use <code>var</code> to allow us to preserve the static type information by avoiding denoting the type.</p>

<p>This means we can now modify our example and write:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">var</code> <code class="n">o</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Object</code><code class="o">()</code> <code class="o">{</code>
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">bar</code><code class="o">()</code> <code class="o">{</code>
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">bar!</code><code class="o">);</code>
    <code class="o">}</code>
<code class="o">};</code>

<code class="n">o</code><code class="o">.</code><code class="na">bar</code><code class="o">();</code></pre>

<p>This has allowed us to preserve the true type of <code>o</code> beyond a single expression.
The type of <code>o</code> cannot be denoted, and so it cannot appear as the type of either a method parameter or return type.
This means that the type is still limited to only a single method, but it is still useful to express some constructions that would be awkward or impossible otherwise.</p>

<p>This use of <code>var</code> as a 鈥渕agic type鈥?allows the programmer to preserve type information for each distinct usage of <code>var</code>, in a way that is somewhat reminiscent of bounded wildcards from Java鈥檚 generics.</p>

<p>More advanced usages of <code>var</code> with non-denotable types <a href="http://bit.ly/2Au99sZ">are possible</a>.
While the feature is not able to satisfy every criticism of Java鈥檚 type system, it does represent a definite (if cautious) step forward.</p>
</div></section>













<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="javanut7-CHP-4-SECT-7">
<h1>Summary</h1>

<p>By examining Java鈥檚 type system, we have been able to build up a clear
picture of the worldview that the Java platform has about data types.
<a data-primary="type system" data-secondary="characteristics of" data-type="indexterm" id="5_idm45941121518616"></a>Java鈥檚 type system can be characterized as:</p>
<dl>
<dt>Static</dt>
<dd>
<p>All Java variables have types that are known at compile time.</p>
</dd>
<dt>Nominal</dt>
<dd>
<p>The name of a Java type is of paramount importance. Java does not
permit structural types and has only limited support for non-denotable
types.</p>
</dd>
<dt>Object/imperative</dt>
<dd>
<p>Java code is object-oriented, and all code must live inside methods,
which must live inside classes. However, Java鈥檚 primitive types
prevent full adoption of the 鈥渆verything is an object鈥?worldview.</p>
</dd>
<dt>Slightly functional</dt>
<dd>
<p>Java provides support for some of the more common functional idioms,
but more as a convenience to programmers than anything else.</p>
</dd>
<dt>Type-inferred</dt>
<dd>
<p>Java is optimized for readability (even by novice progammers) and
prefers to be explicit, but uses type inference to reduce boilerplate
where it does not impact the legibility of the code.</p>
</dd>
<dt>Strongly backward compatible</dt>
<dd>
<p>Java is primarily a business-focused language, and backward
compatibility and protection of existing codebases is a very high
priority.</p>
</dd>
<dt>Type erased</dt>
<dd>
<p>Java permits parameterized types, but this information is not
available at <span class="keep-together">runtime</span>.</p>
</dd>
</dl>

<p>Java鈥檚 type system has evolved (albeit slowly and cautiously) over the years鈥攁nd is now on par with the type systems of other mainstream programming languages.
Lambda expressions, along with default methods, represent the greatest transformation since the advent of Java 5, and the introduction of generics, annotations, and related innovations.</p>

<p>Default methods represent a major shift in Java鈥檚 approach to object-oriented programming鈥攑erhaps the biggest since the language鈥檚 inception.
From Java 8 onward, interfaces can contain implementation code.
This fundamentally changes Java鈥檚 nature鈥攑reviously a single-inherited language, Java is now multiply inherited (but only for behavior鈥攖here is still no multiple inheritance of state).</p>

<p>Despite all of these innovations, Java鈥檚 type system is not (and is not intended to be) equipped with the power of the type systems of languages such as Scala or Haskell.
Instead, Java鈥檚 type system is strongly biased in favor of simplicity, readability, and a simple learning curve for newcomers.</p>

<p>Java has also benefited enormously from the approaches to types developed in other languages over the last 10 years.
Scala鈥檚 example of a statically typed language that nevertheless achieves much of the feel of a dynamically typed language by the use of type inference has been a good source of ideas for features to add to Java, even though the languages have quite different design philosophies.</p>

<p>One remaining question is whether the modest support for functional idioms that lambda expressions provide in Java is sufficient for the majority of Java <span class="keep-together">programmers</span>.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The long-term direction of Java鈥檚 type system is being explored in research projects such as Valhalla, where concepts such as data classes, pattern matching, and sealed classes are being explored.</p>
</div>

<p>It remains to be seen whether the majority of ordinary Java programmers require the added power鈥攁nd attendant complexity鈥攖hat comes from an advanced (and much less nominal) type system such as Scala鈥檚, or whether the 鈥渟lightly functional programming鈥?introduced in Java 8 (e.g., <em>map</em>, <em>filter</em>, <em>reduce</em>, and their peers) will suffice for most developers鈥?needs.<a data-startref="ix_ch04-asciidoc0" data-type="indexterm" id="5_idm45941121458072"></a></p>
</div></section>







<div data-type="footnotes"><p data-type="footnote" id="idm45941125072344"><sup><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#idm45941125072344-marker">1</a></sup> Some small traces of generics remain, which can be seen at runtime via reflection.</p><p data-type="footnote" id="idm45941124496440"><sup><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#idm45941124496440-marker">2</a></sup> Raoul-Gabriel Urma and Janina Voigt, 鈥淯sing the OpenJDK to Investigate Covariance in Java,鈥?<em>Java Magazine</em> (May/June 2012): 44鈥?7.</p></div></div></section><div class="annotator-outer annotator-viewer viewer annotator-hide"> </div></div></div>
    </section>
  </div>
</div>

<hr/>

<!--if IE]><![endif]--><!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/java-in-a/9781492037248/ch05.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="3866890"
  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"
  data-username="levinxccai"
  data-account-type="B2B"
  
  data-activated-trial-date="11/06/2017"


  data-archive="9781492037248"
  data-publishers="O&#39;Reilly Media, Inc."



  data-htmlfile-name="ch05.html"
  data-epub-title="Java in a Nutshell, 7th Edition" data-debug=0 data-testing=0><![endif]--><!--if gt IE 8]><!--><!--![endif]-->



<a name="6_"></a>
<div id="MathJax_Message" style="display: none;"></div>
<div class="application" id="container" style="height: auto;">
  <div class="js-toc">
    <section role="document">
      <div id="sbo-rt-content" style="max-width:72.5em; transform: none;"><div class="annotator-wrapper"><section data-nutshell-tab="OO Design" data-pdf-bookmark="Chapter 5. Introduction to Object-Oriented Design in Java" data-type="chapter" epub:type="chapter"><div class="chapter" id="javanut7-CHP-5">
<h1><span class="label">Chapter 5. </span>Introduction to Object-Oriented Design in Java</h1>


<p><a data-primary="object-oriented design" data-type="indexterm" id="6_ix_ch05-asciidoc0"></a>In this chapter, we鈥檒l look at how to work with Java鈥檚 objects,
covering the key methods of <code>Object</code>, aspects of object-oriented design,
and implementing exception handling schemes. Throughout the chapter, we
will be introducing some <em>design patterns</em>鈥攅ssentially best practices
for solving some very common situations that arise in software design.
Toward the end of the chapter, we鈥檒l also consider the design of <em>safe</em>
programs鈥攖hose that are designed so as not to become inconsistent over
time. We鈥檒l get started by considering the subject of Java鈥檚 calling and
passing conventions and the nature of Java values.</p>






<section data-pdf-bookmark="Java Values" data-type="sect1"><div class="sect1" id="idm45941121427880">
<h1>Java Values</h1>

<p><a data-primary="object-oriented design" data-secondary="Java values" data-type="indexterm" id="6_idm45941121426344"></a>Java鈥檚 values, and their relationship to the type system, are quite straightforward. Java has two types of values鈥攑rimitives and object references.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>There are only eight different primitive types in Java and new primitive types cannot be defined by the programmer.</p>
</div>

<p>The key difference between primitive values and references is that
primitive values cannot be altered; the value <code>2</code> is always the same value.
By contrast, the contents of object references can usually be
changed鈥攐ften referred to as <em>mutation</em> of object contents.</p>

<p>Also note that variables can only contain values of the appropriate type.
In particular, variables of reference type always contain a reference to the memory location holding the object鈥攖hey do not contain the object contents directly.
This means that in Java there is no equivalent of a dereference operator or a <code>struct</code>.</p>

<p>Java tries to simplify a concept that often confused C++
programmers: the difference between 鈥渃ontents of an object鈥?and
鈥渞eference to an object.鈥?Unfortunately, it鈥檚 not possible to completely
hide the difference, and so it is necessary for the programmer to
understand how reference values work in the platform.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45941121420216">
<h5>Is Java 鈥淧ass by Reference鈥?</h5>
<p><a data-primary="object-oriented design" data-secondary="by reference vs. pass by reference" data-type="indexterm" id="6_idm45941121419048"></a>Java handles objects 鈥渂y reference,鈥?but we must not confuse this with
the phrase 鈥減ass by reference.鈥?鈥淧ass by reference鈥?is a term used to
describe the method-calling conventions of some programming languages.
<a data-primary="pass-by-reference language" data-type="indexterm" id="6_idm45941121417688"></a>In a pass-by-reference language, values鈥攅ven primitive values鈥攁re not
passed directly to methods. Instead, methods are always passed
references to values. Thus, if the method modifies its parameters, those
modifications are visible when the method returns, even for primitive
types.</p>

<p><a data-primary="pass-by-value language" data-type="indexterm" id="6_idm45941121416312"></a>Java does <em>not</em> do this; it is a 鈥減ass-by-value鈥?language. However,
when a reference type is involved, the value that is passed is a copy of
the reference (as a value). But this is not the same as pass by
reference. If Java were a pass-by-reference language, when a reference
type is passed to a method, it would be passed as a reference to the
reference.</p>
</div></aside>

<p>The fact that Java is pass by value can be demonstrated very simply. The
following code shows that even after the call to <code>manipulate()</code>, the
value contained in variable <code>c</code> is unaltered鈥攊t is still holding a
reference to a <code>Circle</code> object of radius 2. If Java was a
pass-by-reference language, it would instead be holding a reference to a
radius 3 <code>Circle</code>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kt">void</code> <code class="nf">manipulate</code><code class="o">(</code><code class="n">Circle</code> <code class="n">circle</code><code class="o">)</code> <code class="o">{</code>
    <code class="n">circle</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Circle</code><code class="o">(</code><code class="mi">3</code><code class="o">);</code>
<code class="o">}</code>

<code class="n">Circle</code> <code class="n">c</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Circle</code><code class="o">(</code><code class="mi">2</code><code class="o">);</code>
<code class="n">manipulate</code><code class="o">(</code><code class="n">c</code><code class="o">);</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Radius: </code><code class="o">+</code> <code class="n">c</code><code class="o">.</code><code class="na">getRadius</code><code class="o">());</code></pre>

<p>If we鈥檙e scrupulously careful about the distinction, and about referring
to object references as one of Java鈥檚 possible kinds of values, then
some otherwise surprising features of Java become obvious. Be
careful鈥攕ome older texts are ambiguous on this point. We will meet this
concept of Java鈥檚 values again when we discuss memory and garbage
collection in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch06.html#javanut7-CHP-6">Chapter 6</a>.</p>
</div></section>













<section data-pdf-bookmark="Important Methods of java.lang.Object" data-type="sect1"><div class="sect1" id="idm45941121427256">
<h1>Important Methods of java.lang.Object</h1>

<p><a data-primary="java.lang.Object" data-secondary="important methods of" data-type="indexterm" id="6_ix_ch05-asciidoc1"></a><a data-primary="methods" data-secondary="of java.lang.Object" data-type="indexterm" id="6_ix_ch05-asciidoc2"></a><a data-primary="object-oriented design" data-secondary="important methods of java.lang.Object" data-type="indexterm" id="6_ix_ch05-asciidoc3"></a>As we鈥檝e noted, all classes extend, directly or indirectly,
<code>java.lang.Object</code>. This class defines a number of useful methods that
were designed to be overridden by classes you write.
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch05.html#javanut7-CHP-5-EX-1">Example 5-1</a> shows a class that overrides
these methods. The sections that follow this example document the
default implementation of each method and explain why you might want to
override it.</p>

<p><a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch05.html#javanut7-CHP-5-EX-1">Example 5-1</a> uses a lot of the extended features of the type system that
we introduced in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4">Chapter 4</a>. First, this example implements a parameterized, or generic,
version of the <code>Comparable</code> interface. Second, it uses the
<code>@Override</code> annotation to emphasize (and have the compiler verify) that
certain methods override <code>Object</code>.</p>
<div data-type="example" id="javanut7-CHP-5-EX-1">
<h5><span class="label">Example 5-1. </span>A class that overrides important Object methods</h5>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// This class represents a circle with immutable position and radius.</code>
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">Circle</code> <code class="kd">implements</code> <code class="n">Comparable</code><code class="o">&lt;</code><code class="n">Circle</code><code class="o">&gt;</code> <code class="o">{</code>
    <code class="c1">// These fields hold the coordinates of the center and the radius.</code>
    <code class="c1">// They are private for data encapsulation and final for immutability</code>
    <code class="kd">private</code> <code class="kd">final</code> <code class="kt">int</code> <code class="n">x</code><code class="o">,</code> <code class="n">y</code><code class="o">,</code> <code class="n">r</code><code class="o">;</code>

    <code class="c1">// The basic constructor: initialize the fields to specified values</code>
    <code class="kd">public</code> <code class="nf">Circle</code><code class="o">(</code><code class="kt">int</code> <code class="n">x</code><code class="o">,</code> <code class="kt">int</code> <code class="n">y</code><code class="o">,</code> <code class="kt">int</code> <code class="n">r</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">if</code> <code class="o">(</code><code class="n">r</code> <code class="o">&lt;</code> <code class="mi">0</code><code class="o">)</code> <code class="k">throw</code> <code class="k">new</code> <code class="n">IllegalArgumentException</code><code class="o">(</code><code class="s">negative radius</code><code class="o">);</code>
        <code class="k">this</code><code class="o">.</code><code class="na">x</code> <code class="o">=</code> <code class="n">x</code><code class="o">;</code> <code class="k">this</code><code class="o">.</code><code class="na">y</code> <code class="o">=</code> <code class="n">y</code><code class="o">;</code> <code class="k">this</code><code class="o">.</code><code class="na">r</code> <code class="o">=</code> <code class="n">r</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="c1">// This is a &quot;copy constructor&quot;--a useful alternative to clone()</code>
    <code class="kd">public</code> <code class="nf">Circle</code><code class="o">(</code><code class="n">Circle</code> <code class="n">original</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">x</code> <code class="o">=</code> <code class="n">original</code><code class="o">.</code><code class="na">x</code><code class="o">;</code>   <code class="c1">// Just copy the fields from the original</code>
        <code class="n">y</code> <code class="o">=</code> <code class="n">original</code><code class="o">.</code><code class="na">y</code><code class="o">;</code>
        <code class="n">r</code> <code class="o">=</code> <code class="n">original</code><code class="o">.</code><code class="na">r</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="c1">// Public accessor methods for the private fields.</code>
    <code class="c1">// These are part of data encapsulation.</code>
    <code class="kd">public</code> <code class="kt">int</code> <code class="nf">getX</code><code class="o">()</code> <code class="o">{</code> <code class="k">return</code> <code class="n">x</code><code class="o">;</code> <code class="o">}</code>
    <code class="kd">public</code> <code class="kt">int</code> <code class="nf">getY</code><code class="o">()</code> <code class="o">{</code> <code class="k">return</code> <code class="n">y</code><code class="o">;</code> <code class="o">}</code>
    <code class="kd">public</code> <code class="kt">int</code> <code class="nf">getR</code><code class="o">()</code> <code class="o">{</code> <code class="k">return</code> <code class="n">r</code><code class="o">;</code> <code class="o">}</code>

    <code class="c1">// Return a string representation</code>
    <code class="nd">@Override</code> <code class="kd">public</code> <code class="n">String</code> <code class="n">toString</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">String</code><code class="o">.</code><code class="na">format</code><code class="o">(</code><code class="s">center=(%d,%d); radius=%d</code><code class="o">,</code> <code class="n">x</code><code class="o">,</code> <code class="n">y</code><code class="o">,</code> <code class="n">r</code><code class="o">);</code>
    <code class="o">}</code>

    <code class="c1">// Test for equality with another object</code>
    <code class="nd">@Override</code> <code class="kd">public</code> <code class="kt">boolean</code> <code class="n">equals</code><code class="o">(</code><code class="n">Object</code> <code class="n">o</code><code class="o">)</code> <code class="o">{</code>
        <code class="c1">// Identical references?</code>
        <code class="k">if</code> <code class="o">(</code><code class="n">o</code> <code class="o">==</code> <code class="k">this</code><code class="o">)</code> <code class="k">return</code> <code class="kc">true</code><code class="o">;</code>
        <code class="c1">// Correct type and non-null?</code>
        <code class="k">if</code> <code class="o">(!(</code><code class="n">o</code> <code class="k">instanceof</code> <code class="n">Circle</code><code class="o">))</code> <code class="k">return</code> <code class="kc">false</code><code class="o">;</code>
        <code class="n">Circle</code> <code class="n">that</code> <code class="o">=</code> <code class="o">(</code><code class="n">Circle</code><code class="o">)</code> <code class="n">o</code><code class="o">;</code>                 <code class="c1">// Cast to our type</code>
        <code class="k">if</code> <code class="o">(</code><code class="k">this</code><code class="o">.</code><code class="na">x</code> <code class="o">==</code> <code class="n">that</code><code class="o">.</code><code class="na">x</code> <code class="o">&amp;&amp;</code> <code class="k">this</code><code class="o">.</code><code class="na">y</code> <code class="o">==</code> <code class="n">that</code><code class="o">.</code><code class="na">y</code> <code class="o">&amp;&amp;</code> <code class="k">this</code><code class="o">.</code><code class="na">r</code> <code class="o">==</code> <code class="n">that</code><code class="o">.</code><code class="na">r</code><code class="o">)</code>
            <code class="k">return</code> <code class="kc">true</code><code class="o">;</code>                          <code class="c1">// If all fields match</code>
        <code class="k">else</code>
            <code class="k">return</code> <code class="kc">false</code><code class="o">;</code>                         <code class="c1">// If fields differ</code>
    <code class="o">}</code>

    <code class="c1">// A hash code allows an object to be used in a hash table.</code>
    <code class="c1">// Equal objects must have equal hash codes.  Unequal objects are</code>
    <code class="c1">// allowed to have equal hash codes as well, but we try to avoid that.</code>
    <code class="c1">// We must override this method because we also override equals().</code>
    <code class="nd">@Override</code> <code class="kd">public</code> <code class="kt">int</code> <code class="n">hashCode</code><code class="o">()</code> <code class="o">{</code>
        <code class="kt">int</code> <code class="n">result</code> <code class="o">=</code> <code class="mi">17</code><code class="o">;</code>          <code class="c1">// This hash code algorithm from the book</code>
        <code class="n">result</code> <code class="o">=</code> <code class="mi">37</code><code class="o">*</code><code class="n">result</code> <code class="o">+</code> <code class="n">x</code><code class="o">;</code>   <code class="c1">// Effective Java, by Joshua Bloch</code>
        <code class="n">result</code> <code class="o">=</code> <code class="mi">37</code><code class="o">*</code><code class="n">result</code> <code class="o">+</code> <code class="n">y</code><code class="o">;</code>
        <code class="n">result</code> <code class="o">=</code> <code class="mi">37</code><code class="o">*</code><code class="n">result</code> <code class="o">+</code> <code class="n">r</code><code class="o">;</code>
        <code class="k">return</code> <code class="n">result</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="c1">// This method is defined by the Comparable interface. Compare</code>
    <code class="c1">// this Circle to that Circle.  Return a value &lt; 0 if this &lt; that</code>
    <code class="c1">// Return 0 if this == that. Return a value &gt; 0 if this &gt; that.</code>
    <code class="c1">// Circles are ordered top to bottom, left to right, and then by radius</code>
    <code class="kd">public</code> <code class="kt">int</code> <code class="nf">compareTo</code><code class="o">(</code><code class="n">Circle</code> <code class="n">that</code><code class="o">)</code> <code class="o">{</code>
        <code class="c1">// Smaller circles have bigger y</code>
        <code class="kt">long</code> <code class="n">result</code> <code class="o">=</code> <code class="o">(</code><code class="kt">long</code><code class="o">)</code><code class="n">that</code><code class="o">.</code><code class="na">y</code> <code class="o">-</code> <code class="k">this</code><code class="o">.</code><code class="na">y</code><code class="o">;</code>
        <code class="c1">// If same compare l-to-r</code>
        <code class="k">if</code> <code class="o">(</code><code class="n">result</code><code class="o">==</code><code class="mi">0</code><code class="o">)</code> <code class="n">result</code> <code class="o">=</code> <code class="o">(</code><code class="kt">long</code><code class="o">)</code><code class="k">this</code><code class="o">.</code><code class="na">x</code> <code class="o">-</code> <code class="n">that</code><code class="o">.</code><code class="na">x</code><code class="o">;</code>
        <code class="c1">// If same compare radius</code>
        <code class="k">if</code> <code class="o">(</code><code class="n">result</code><code class="o">==</code><code class="mi">0</code><code class="o">)</code> <code class="n">result</code> <code class="o">=</code> <code class="o">(</code><code class="kt">long</code><code class="o">)</code><code class="k">this</code><code class="o">.</code><code class="na">r</code> <code class="o">-</code> <code class="n">that</code><code class="o">.</code><code class="na">r</code><code class="o">;</code>

        <code class="c1">// We have to use a long value for subtraction because the</code>
        <code class="c1">// differences between a large positive and large negative</code>
        <code class="c1">// value could overflow an int. But we can&apos;t return the long,</code>
        <code class="c1">// so return its sign as an int.</code>
        <code class="k">return</code> <code class="n">Long</code><code class="o">.</code><code class="na">signum</code><code class="o">(</code><code class="n">result</code><code class="o">);</code>
    <code class="o">}</code>
<code class="o">}</code></pre></div>








<section data-pdf-bookmark="toString()" data-type="sect2"><div class="sect2" id="idm45941121349032">
<h2>toString()</h2>

<p><a data-primary="java.lang.Object" data-secondary="toString() method" data-type="indexterm" id="6_idm45941121348024"></a><a data-primary="toString()" data-type="indexterm" id="6_idm45941121347080"></a>The purpose of the <code>toString()</code> method is to return a textual
representation of an object. The method is invoked automatically on
objects during string concatenation and by methods such as
<code>System.out.println()</code>. Giving objects a textual representation can be
quite helpful for debugging or logging output, and a well-crafted
<code>toString()</code> method can even help with tasks such as report generation.</p>

<p>The version of <code>toString()</code> inherited from <code>Object</code> returns a string
that includes the name of the class of the object as well as a
hexadecimal representation of the <code>hashCode()</code> value of the object
(discussed later in this chapter). This default implementation provides
basic type and identity information for an object but is not usually
very useful. The <code>toString()</code> method in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch05.html#javanut7-CHP-5-EX-1">Example 5-1</a> instead returns a human-readable
string that includes the value of each of the fields of the <code>Circle</code>
class.</p>
</div></section>













<section data-pdf-bookmark="equals()" data-type="sect2"><div class="sect2" id="idm45941120978216">
<h2>equals()</h2>

<p><a data-primary="equals()" data-type="indexterm" id="6_idm45941120976984"></a><a data-primary="java.lang.Object" data-secondary="equals() method" data-type="indexterm" id="6_idm45941120976056"></a>The <code>==</code> operator tests two references to see if they refer to the
same object. If you want to test whether two distinct objects are equal
to one another, you must use the <code>equals()</code> method instead. Any class
can define its own notion of equality by overriding <code>equals()</code>. The
<code>Object.equals()</code> method simply uses the <code>==</code> operator: this default
method considers two objects equal only if they are actually the very
same object.</p>

<p>The <code>equals()</code> method in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch05.html#javanut7-CHP-5-EX-1">Example 5-1</a>
considers two distinct <code>Circle</code> objects to be equal if their fields are
all equal. Note that it first does a quick identity test with <code>==</code> as an
optimization and then checks the type of the other object with
<code>instanceof</code>: a <code>Circle</code> can be equal only to another <code>Circle</code>, and it
is not acceptable for an <code>equals()</code> method to throw a
<code>ClassCastException</code>. Note that the <code>instanceof</code> test also rules out
<code>null</code> arguments: <code>instanceof</code> always evaluates to <code>false</code> if its
lefthand operand is <code>null</code>.</p>
</div></section>













<section data-pdf-bookmark="hashCode()" data-type="sect2"><div class="sect2" id="idm45941120971864">
<h2>hashCode()</h2>

<p><a data-primary="hashCode()" data-type="indexterm" id="6_idm45941120964488"></a><a data-primary="java.lang.Object" data-secondary="hashCode() method" data-type="indexterm" id="6_idm45941120963784"></a>Whenever you override <code>equals()</code>, you must also override <code>hashCode()</code>.
This method returns an integer for use by hash table data structures.
It is critical that two objects have the same hash code if they are
equal according to the <code>equals()</code> method.</p>

<p>It is important (for efficient
operation of hash tables) but not required that unequal objects have
unequal hash codes, or at least that unequal objects are unlikely to
share a hash code. This second criterion can lead to <code>hashCode()</code>
methods that involve mildly tricky arithmetic or bit manipulation.</p>

<p>The <code>Object.hashCode()</code> method works with the <code>Object.equals()</code> method
and returns a hash code based on object identity rather than object
equality. (If you ever need an identity-based hash code, you can access
the functionality of <code>Object.hashCode()</code> through the static method
<code>System.identityHashCode()</code>.)</p>
<div data-type="tip"><h6>Tip</h6>
<p>When you override <code>equals()</code>, you must always override <code>hashCode()</code> to
guarantee that equal objects have equal hash codes. Failing to do this
can cause subtle bugs in your programs.</p>
</div>

<p>Because the <code>equals()</code> method in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch05.html#javanut7-CHP-5-EX-1">Example 5-1</a>
bases object equality on the values of the three fields, the
<code>hashCode()</code> method computes its hash code based on these three fields
as well. It is clear from the code that if two <code>Circle</code> objects have the
same field values, they will have the same hash code.</p>

<p>Note that the <code>hashCode()</code> method in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch05.html#javanut7-CHP-5-EX-1">Example 5-1</a> does not simply add the three fields and return their sum. Such an
implementation would be legal but not efficient because two circles with
the same radius but whose <em>x</em> and <em>y</em> coordinates were reversed would
then have the same hash code. The repeated multiplication and addition
steps 鈥渟pread out鈥?the range of hash codes and dramatically reduce the
likelihood that two unequal <code>Circle</code> objects have the same code.</p>
<div data-type="tip"><h6>Tip</h6>
<p>In practice, modern Java programmers will typically autogenerate <code>hashCode()</code>, <code>equals()</code>, and <code>toString()</code> from within their IDE.</p>
</div>

<p><em>Effective Java</em> by Joshua Bloch (Addison Wesley) includes a helpful recipe for constructing efficient <code>hashCode()</code> methods, if the programmer chooses not to <span class="keep-together">autogenerate</span>.</p>
</div></section>













<section data-pdf-bookmark="Comparable::compareTo()" data-type="sect2"><div class="sect2" id="idm45941120944616">
<h2>Comparable::compareTo()</h2>

<p><a data-primary="compareTo()" data-type="indexterm" id="6_idm45941120943144"></a><a data-primary="java.lang.Object" data-secondary="compareTo() method" data-type="indexterm" id="6_idm45941120942040"></a><a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch05.html#javanut7-CHP-5-EX-1">Example 5-1</a> includes a <code>compareTo()</code>
method. This method is defined by the <code>java.lang.Comparable</code> interface
rather than by <code>Object</code>, but it is such a common method to implement
that we include it in this section. The purpose of <code>Comparable</code> and its
<code>compareTo()</code> method is to allow instances of a class to be compared to
each other in a similar way to how the <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, and <code>&gt;=</code> operators
compare numbers.
If a class implements <code>Comparable</code>, we can call methods to allow us to say that one instance is less than, greater than, or equal to another instance.
This also means that instances of a <code>Comparable</code> class can be sorted.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The method <code>compareTo()</code> sets up a <em>total ordering</em> of the objects of the type. <a data-primary="natural comparison method" data-type="indexterm" id="6_idm45941120933352"></a>This is referred to as the <em>natural order</em> of the type, and the method is called the <em>natural comparison method</em>.</p>
</div>

<p>Because <code>compareTo()</code> is not declared by the <code>Object</code> class, it is up to
each individual class to determine whether and how its instances should
be ordered and to include a <code>compareTo()</code> method that implements that
ordering.</p>

<p>The ordering defined by <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch05.html#javanut7-CHP-5-EX-1">Example 5-1</a>
compares <code>Circle</code> objects as if they were words on a page. Circles are
first ordered from top to bottom: circles with larger <em>y</em> coordinates
are less than circles with smaller <em>y</em> coordinates. If two circles have
the same <em>y</em> coordinate, they are ordered from left to right. A circle
with a smaller <em>x</em> coordinate is less than a circle with a larger <em>x</em>
coordinate. Finally, if two circles have the same <em>x</em> and <em>y</em>
coordinates, they are compared by radius. The circle with the smaller
radius is smaller. Notice that under this ordering, two circles are
equal only if all three of their fields are equal. This means that the
ordering defined by <code>compareTo()</code> is consistent with the equality
defined by <code>equals()</code>. This is very desirable (but not strictly
required).</p>

<p>The <code>compareTo()</code> method returns an <code>int</code> value that requires further
explanation. <code>compareTo()</code> should return a negative number if the <code>this</code>
object is less than the object passed to it. It should return 0 if the
two objects are equal. And <code>compareTo()</code> should return a positive number
if <code>this</code> is greater than the method argument.</p>
</div></section>













<section data-pdf-bookmark="clone()" data-type="sect2"><div class="sect2" id="idm45941120919928">
<h2>clone()</h2>

<p><a data-primary="java.lang.Object" data-secondary="clone() method" data-type="indexterm" id="6_idm45941120918488"></a><code>Object</code> defines a method named <code>clone()</code> whose purpose is to return
an object with fields set identically to those of the current object.
This is an unusual method for two reasons. First, it works only if the
class implements the <code>java.lang.Cloneable</code> interface. <code>Cloneable</code> does
not define any methods (it is a marker interface), so implementing it is
simply a matter of listing it in the <code>implements</code> clause of the class
signature. The other unusual feature of <code>clone()</code> is that it is declared
<code>protected</code>. Therefore, if you want your object to be cloneable by other
classes, you must implement <code>Cloneable</code> and override the <code>clone()</code>
method, making it <code>public</code>.</p>

<p>The <code>Circle</code> class of <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch05.html#javanut7-CHP-5-EX-1">Example 5-1</a> does not
implement <code>Cloneable</code>; instead it provides a <em>copy constructor</em> for
making copies of <code>Circle</code> objects:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Circle</code> <code class="n">original</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Circle</code><code class="o">(</code><code class="mi">1</code><code class="o">,</code> <code class="mi">2</code><code class="o">,</code> <code class="mi">3</code><code class="o">);</code>  <code class="c1">// regular constructor</code>
<code class="n">Circle</code> <code class="n">copy</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Circle</code><code class="o">(</code><code class="n">original</code><code class="o">);</code>     <code class="c1">// copy constructor</code></pre>

<p>It can be difficult to implement <code>clone()</code> correctly, and it is usually
easier and safer to provide a copy constructor.<a data-startref="ix_ch05-asciidoc3" data-type="indexterm" id="6_idm45941120892600"></a><a data-startref="ix_ch05-asciidoc2" data-type="indexterm" id="6_idm45941120891992"></a><a data-startref="ix_ch05-asciidoc1" data-type="indexterm" id="6_idm45941120891352"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Aspects of Object-Oriented Design" data-type="sect1"><div class="sect1" id="idm45941120890552">
<h1>Aspects of Object-Oriented Design</h1>

<p>In this section, we will consider several techniques relevant to
object-oriented design in Java. This is a very incomplete treatment and
merely intended to showcase some examples鈥攚e encourage you to
consult additional resources, such as the aforementioned <em>Effective
Java</em> by Joshua Bloch.</p>

<p>We start by considering good practices for defining constants in Java,
before moving on to discuss different approaches to using Java鈥檚
object-oriented capabilities for modeling and domain object design. At
the end of the section, we conclude by covering the implementation of
some common design patterns in Java.</p>








<section data-pdf-bookmark="Constants" data-type="sect2"><div class="sect2" id="idm45941120884488">
<h2>Constants</h2>

<p><a data-primary="constants" data-secondary="object-oriented design and" data-type="indexterm" id="6_idm45941120883048"></a><a data-primary="object-oriented design" data-secondary="constants" data-type="indexterm" id="6_idm45941120882104"></a>As noted earlier, constants can appear in an interface definition.
Any class that implements an interface inherits the constants it
defines and can use them as if they were defined directly in the class
itself. Importantly, there is no need to prefix the constants with the
name of the interface or provide any kind of implementation of the
constants.</p>

<p>When a set of constants is used by more than one class, it is tempting
to define the constants once in an interface and then have any classes
that require the constants implement the interface. This situation might
arise, for example, when client and server classes implement a network
protocol whose details (such as the port number to connect to and listen
on) are captured in a set of symbolic constants. As a concrete example,
consider the <code>java.io.ObjectStreamConstants</code> interface, which defines
constants for the object serialization protocol and is implemented by
both <code>ObjectInputStream</code> and <code>ObjectOutputStream</code>.</p>

<p>The primary benefit of inheriting constant definitions from an interface
is that it saves typing: you don鈥檛 need to specify the type that defines
the constants. Despite its use with <code>ObjectStreamConstants</code>, this is not
a recommended technique. The use of constants is an implementation
detail that is not appropriate to declare in the <code>implements</code> clause of
a class signature.</p>

<p>A better approach is to define constants in a class and use the
constants by typing the full class name and the constant name. You can
save typing by importing the constants from their defining class with
the <code>import static</code> declaration. See
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2-SECT-10">鈥淧ackages and the Java Namespace鈥?/a&gt; for details.</p>
</div></section>













<section data-pdf-bookmark="Interfaces Versus Abstract Classes" data-type="sect2"><div class="sect2" id="idm45941120874776">
<h2>Interfaces Versus Abstract Classes</h2>

<p><a data-primary="abstract classes" data-secondary="interfaces vs." data-type="indexterm" id="6_idm45941120873336"></a><a data-primary="interfaces" data-secondary="abstract classes vs." data-type="indexterm" id="6_idm45941120872360"></a><a data-primary="Java 8" data-secondary="interfaces in" data-type="indexterm" id="6_idm45941120871416"></a><a data-primary="object-oriented design" data-secondary="interfaces vs. abstract classes" data-type="indexterm" id="6_idm45941120870472"></a>The advent of Java 8 has fundamentally changed Java鈥檚 object-oriented
programming model. Before Java 8, interfaces were pure API specification
and contained no implementation. This could often lead to duplication of
code if the interface had many implementations.</p>

<p>In response, a coding pattern developed. This pattern takes advantage of
the fact that an abstract class does not need to be entirely abstract;
it can contain a partial implementation that subclasses can take
advantage of. In some cases, numerous subclasses can rely on method
implementations provided by an abstract superclass.</p>

<p>The pattern consists of an interface that contains the API spec for the
basic methods, paired with a primary implementation as an abstract
class. <a data-primary="java.util.AbstractList" data-type="indexterm" id="6_idm45941120867608"></a>A good example would be <code>java.util.List</code>, which is paired with
<code>java.util.AbstractList</code>. Two of the main implementations of <code>List</code>
that ship with the JDK (<code>ArrayList</code> and <span class="keep-together"><code>LinkedList</code></span>) are subclasses of
<code>AbstractList</code>. As another example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Here is a basic interface. It represents a shape that fits inside</code>
<code class="c1">// of a rectangular bounding box. Any class that wants to serve as a</code>
<code class="c1">// RectangularShape can implement these methods from scratch.</code>
<code class="kd">public</code> <code class="kd">interface</code> <code class="nc">RectangularShape</code> <code class="o">{</code>
    <code class="kt">void</code> <code class="nf">setSize</code><code class="o">(</code><code class="kt">double</code> <code class="n">width</code><code class="o">,</code> <code class="kt">double</code> <code class="n">height</code><code class="o">);</code>
    <code class="kt">void</code> <code class="nf">setPosition</code><code class="o">(</code><code class="kt">double</code> <code class="n">x</code><code class="o">,</code> <code class="kt">double</code> <code class="n">y</code><code class="o">);</code>
    <code class="kt">void</code> <code class="nf">translate</code><code class="o">(</code><code class="kt">double</code> <code class="n">dx</code><code class="o">,</code> <code class="kt">double</code> <code class="n">dy</code><code class="o">);</code>
    <code class="kt">double</code> <code class="nf">area</code><code class="o">();</code>
    <code class="kt">boolean</code> <code class="nf">isInside</code><code class="o">();</code>
<code class="o">}</code>

<code class="c1">// Here is a partial implementation of that interface. Many</code>
<code class="c1">// implementations may find this a useful starting point.</code>
<code class="kd">public</code> <code class="kd">abstract</code> <code class="kd">class</code> <code class="nc">AbstractRectangularShape</code>
                        <code class="kd">implements</code> <code class="n">RectangularShape</code> <code class="o">{</code>
    <code class="c1">// The position and size of the shape</code>
    <code class="kd">protected</code> <code class="kt">double</code> <code class="n">x</code><code class="o">,</code> <code class="n">y</code><code class="o">,</code> <code class="n">w</code><code class="o">,</code> <code class="n">h</code><code class="o">;</code>

    <code class="c1">// Default implementations of some of the interface methods</code>
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">setSize</code><code class="o">(</code><code class="kt">double</code> <code class="n">width</code><code class="o">,</code> <code class="kt">double</code> <code class="n">height</code><code class="o">)</code> <code class="o">{</code>
     <code class="n">w</code> <code class="o">=</code> <code class="n">width</code><code class="o">;</code> <code class="n">h</code> <code class="o">=</code> <code class="n">height</code><code class="o">;</code>
    <code class="o">}</code>
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">setPosition</code><code class="o">(</code><code class="kt">double</code> <code class="n">x</code><code class="o">,</code> <code class="kt">double</code> <code class="n">y</code><code class="o">)</code> <code class="o">{</code>
     <code class="k">this</code><code class="o">.</code><code class="na">x</code> <code class="o">=</code> <code class="n">x</code><code class="o">;</code> <code class="k">this</code><code class="o">.</code><code class="na">y</code> <code class="o">=</code> <code class="n">y</code><code class="o">;</code>
    <code class="o">}</code>
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">translate</code> <code class="o">(</code><code class="kt">double</code> <code class="n">dx</code><code class="o">,</code> <code class="kt">double</code> <code class="n">dy</code><code class="o">)</code> <code class="o">{</code> <code class="n">x</code> <code class="o">+=</code> <code class="n">dx</code><code class="o">;</code> <code class="n">y</code> <code class="o">+=</code> <code class="n">dy</code><code class="o">;</code> <code class="o">}</code>
<code class="o">}</code></pre>

<p>The arrival of default methods in Java 8 changes this picture considerably. Interfaces can now contain implementation code, as we saw in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4-SECT-1.5">鈥淒efault Methods鈥?/a&gt;.</p>

<p>This means that when defining an abstract type (e.g., <code>Shape</code>) that you expect to have many subtypes (e.g., <code>Circle</code>, <code>Rectangle</code>, <code>Square</code>), you are faced with a choice between interfaces and abstract classes.
As they now have potentially similar features, it is not always clear which to use.</p>

<p>Remember that a class that extends an abstract class cannot extend any other class, and that interfaces still cannot contain any nonconstant fields.
This means that there are still some restrictions on how we can use object orientation in our Java programs.</p>

<p>Another important difference between interfaces and abstract classes has
to do with compatibility. If you define an interface as part of a public
API and then later add a new mandatory method to the interface, you
break any classes that implemented the previous version of the
interface鈥攊n other words, any new interface methods must be declared as
default and an implementation provided. If you use an abstract class,
however, you can safely add nonabstract methods to that class without
requiring modifications to existing classes that extend the abstract
class.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>In both cases, adding new methods can cause a clash with subclass
methods of the same name and signature鈥攚ith the subclass methods always
winning. For this reason, think carefully when adding new
methods鈥攅specially when the method names are 鈥渙bvious鈥?for this type, or
where the method could have several possible meanings.</p>
</div>

<p>In general, the suggested approach is to prefer interfaces when an API
specification is needed. The mandatory methods of the interface are
nondefault, as they represent the part of the API that must be present
for an implementation to be considered valid. Default methods should be
used only if a method is truly optional, or if they are really only
intended to have a single possible implementation.</p>

<p>Finally, the older technique of documenting which methods of an
interface are considered 鈥渙ptional鈥?and throwing a
<code>java.lang.UnsupportedOperationException</code> if the programmer does not
want to implement them is fraught with problems, and should not be used
in new code.</p>
</div></section>













<section data-pdf-bookmark="Can Default Methods Be Used as Traits?" data-type="sect2"><div class="sect2" id="idm45941120874152">
<h2>Can Default Methods Be Used as Traits?</h2>

<p><a data-primary="default methods" data-secondary="traits and" data-type="indexterm" id="6_idm45941120494776"></a><a data-primary="object-oriented design" data-secondary="default methods and traits" data-type="indexterm" id="6_idm45941120493800"></a><a data-primary="traits, default methods and" data-type="indexterm" id="6_idm45941120492888"></a>Before Java 8, the strict single inheritance model was clear.
Every class, except <code>Object</code> had exactly one direct superclass, and method implementations could only either be defined in a class, or be inherited from the superclass hierarchy.</p>

<p>Default methods change this picture, because they allow method implementations to be inherited from multiple places鈥攅ither from the superclass hierarchy or from default implementation provided in interfaces.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>This is effectively the <em>Mixin</em> pattern from C++, and can be seen as a form of the <em>trait</em> language feature that appears in some languages.</p>
</div>

<p>In the Java case, any potential conflicts between different default methods from separate interfaces will result in a compile-time error.
This means that there is no possibility of conflicting multiple inheritance of implementation, as in any clash the programmer is required to manually disambiguate.
Not only that, but there is also no multiple inheritance of state.</p>

<p>However, the official view from Java鈥檚 language designers is that default methods fall short of being full traits.
<a data-primary="java.util.function" data-type="indexterm" id="6_idm45941120487416"></a>However, this view is somewhat undermined by the code that ships within the JDK鈥攅ven the interfaces within <code>java.util.function</code> (such as <code>Function</code> itself) behave as simple traits.</p>

<p>For example, consider this piece of code:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">interface</code> <code class="nc">IntFunc</code> <code class="o">{</code>
    <code class="kt">int</code> <code class="nf">apply</code><code class="o">(</code><code class="kt">int</code> <code class="n">x</code><code class="o">);</code>

    <code class="k">default</code> <code class="n">IntFunc</code> <code class="nf">compose</code><code class="o">(</code><code class="n">IntFunc</code> <code class="n">before</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">return</code> <code class="o">(</code><code class="kt">int</code> <code class="n">y</code><code class="o">)</code> <code class="o">-&gt;</code> <code class="n">apply</code><code class="o">(</code><code class="n">before</code><code class="o">.</code><code class="na">apply</code><code class="o">(</code><code class="n">y</code><code class="o">));</code>
    <code class="o">}</code>

    <code class="k">default</code> <code class="n">IntFunc</code> <code class="nf">andThen</code><code class="o">(</code><code class="n">IntFunc</code> <code class="n">after</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">return</code> <code class="o">(</code><code class="kt">int</code> <code class="n">z</code><code class="o">)</code> <code class="o">-&gt;</code> <code class="n">after</code><code class="o">.</code><code class="na">apply</code><code class="o">(</code><code class="n">apply</code><code class="o">(</code><code class="n">z</code><code class="o">));</code>
    <code class="o">}</code>

    <code class="kd">static</code> <code class="n">IntFunc</code> <code class="nf">id</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">x</code> <code class="o">-&gt;</code> <code class="n">x</code><code class="o">;</code>
    <code class="o">}</code>
<code class="o">}</code></pre>

<p>It is a simplified form of the function types present in <code>java.util.function</code>鈥攊t removes the generics and only deals with <code>int</code> as a data type.</p>

<p>This case shows an important point for the functional composition methods (compose() and andThen()) present: these functions will only ever be composed in the standard way, and it is highly implausible that any sane override of the default <code>compose()</code> method could exist.</p>

<p>This is, of course, also true for the function types present in <code>java.util.function</code>, and shows that within the limited domain provided, default methods can be treated as a form of stateless trait.</p>
</div></section>













<section data-pdf-bookmark="Instance Methods or Class Methods?" data-type="sect2"><div class="sect2" id="idm45941120495432">
<h2>Instance Methods or Class Methods?</h2>

<p><a data-primary="class methods" data-secondary="instance methods vs." data-type="indexterm" id="6_idm45941120335288"></a><a data-primary="instance methods" data-type="indexterm" id="6_idm45941120334312"></a><a data-primary="methods" data-secondary="instance methods vs. class methods" data-type="indexterm" id="6_idm45941120333640"></a><a data-primary="object-oriented design" data-secondary="instance methods vs. class methods" data-type="indexterm" id="6_idm45941120452280"></a>Instance methods are one of the key features of object-oriented
programming. That doesn鈥檛 mean, however, that you should shun class
methods. In many cases, it is perfectly reasonable to define class
methods.</p>
<div data-type="tip"><h6>Tip</h6>
<p><a data-primary="static keyword" data-type="indexterm" id="6_idm45941120450280"></a>Remember that in Java, class methods are declared with the <code>static</code>
keyword, and the terms <em>static method</em> and <em>class method</em> are used
interchangeably.</p>
</div>

<p>For example, when working with the <code>Circle</code> class you might find that
you often want to compute the area of a circle with a given radius but
don鈥檛 want to bother creating a <code>Circle</code> object to represent that
circle. In this case, a class method is more convenient:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">static</code> <code class="kt">double</code> <code class="nf">area</code><code class="o">(</code><code class="kt">double</code> <code class="n">r</code><code class="o">)</code> <code class="o">{</code> <code class="k">return</code> <code class="n">PI</code> <code class="o">*</code> <code class="n">r</code> <code class="o">*</code> <code class="n">r</code><code class="o">;</code> <code class="o">}</code></pre>

<p>It is perfectly legal for a class to define more than one method with
the same name, as long as the methods have different parameters. This
version of the <code>area()</code> method is a class method, so it does not have an
implicit <code>this</code> parameter and must have a parameter that specifies the
radius of the circle. This parameter keeps it distinct from the instance
method of the same name.</p>

<p>As another example of the choice between instance methods and class
methods, consider defining a method named <code>bigger()</code> that examines two
<code>Circle</code> objects and returns whichever has the larger radius. We can
write <code>bigger()</code> as an instance method as follows:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Compare the implicit &quot;this&quot; circle to the &quot;that&quot; circle passed</code>
<code class="c1">// explicitly as an argument and return the bigger one.</code>
<code class="kd">public</code> <code class="n">Circle</code> <code class="nf">bigger</code><code class="o">(</code><code class="n">Circle</code> <code class="n">that</code><code class="o">)</code> <code class="o">{</code>
  <code class="k">if</code> <code class="o">(</code><code class="k">this</code><code class="o">.</code><code class="na">r</code> <code class="o">&gt;</code> <code class="n">that</code><code class="o">.</code><code class="na">r</code><code class="o">)</code> <code class="k">return</code> <code class="k">this</code><code class="o">;</code>
  <code class="k">else</code> <code class="k">return</code> <code class="n">that</code><code class="o">;</code>
<code class="o">}</code></pre>

<p>We can also implement <code>bigger()</code> as a class method as follows:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Compare circles a and b and return the one with the larger radius</code>
<code class="kd">public</code> <code class="kd">static</code> <code class="n">Circle</code> <code class="nf">bigger</code><code class="o">(</code><code class="n">Circle</code> <code class="n">a</code><code class="o">,</code> <code class="n">Circle</code> <code class="n">b</code><code class="o">)</code> <code class="o">{</code>
  <code class="k">if</code> <code class="o">(</code><code class="n">a</code><code class="o">.</code><code class="na">r</code> <code class="o">&gt;</code> <code class="n">b</code><code class="o">.</code><code class="na">r</code><code class="o">)</code> <code class="k">return</code> <code class="n">a</code><code class="o">;</code>
  <code class="k">else</code> <code class="k">return</code> <code class="n">b</code><code class="o">;</code>
<code class="o">}</code></pre>

<p>Given two <code>Circle</code> objects, <code>x</code> and <code>y</code>, we can use either the instance
method or the class method to determine which is bigger. The invocation
syntax differs significantly for the two methods, however:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Instance method: also y.bigger(x)</code>
<code class="n">Circle</code> <code class="n">biggest</code> <code class="o">=</code> <code class="n">x</code><code class="o">.</code><code class="na">bigger</code><code class="o">(</code><code class="n">y</code><code class="o">);</code>
<code class="n">Circle</code> <code class="n">biggest</code> <code class="o">=</code> <code class="n">Circle</code><code class="o">.</code><code class="na">bigger</code><code class="o">(</code><code class="n">x</code><code class="o">,</code> <code class="n">y</code><code class="o">);</code>  <code class="c1">// Static method</code></pre>

<p>Both methods work well, and, from an object-oriented design standpoint,
neither of these methods is 鈥渕ore correct鈥?than the other. The instance
method is more formally object oriented, but its invocation syntax
suffers from a kind of asymmetry. In a case like this, the choice
between an instance method and a class method is simply a design
decision. Depending on the circumstances, one or the other will likely
be the more natural choice.</p>










<section data-pdf-bookmark="A word about System.out.println()" data-type="sect3"><div class="sect3" id="idm45941120220792">
<h3>A word about System.out.println()</h3>

<p><a data-primary="object-oriented design" data-secondary="System.out.println() and" data-type="indexterm" id="6_idm45941120219896"></a><a data-primary="println()" data-secondary="System.out.println() and" data-type="indexterm" id="6_idm45941120218792"></a><a data-primary="System.out.println()" data-type="indexterm" id="6_idm45941120217880"></a>We鈥檝e frequently encountered the method <code>System.out.println()</code>鈥攊t鈥檚
used to display output to the terminal window or console. We鈥檝e never
explained why this method has such a long, awkward name or what those
two periods are doing in it. Now that you understand class and instance
fields and class and instance methods, it is easier to understand what
is going on: <code>System</code> is a class. It has a public class field named
<code>out</code>. <a data-primary="java.io.PrintStream" data-type="indexterm" id="6_idm45941120215480"></a>This field is an object of type <code>java.io.PrintStream</code>, and it
has an instance method named <code>println()</code>.</p>

<p><a data-primary="java.lang.System.out" data-type="indexterm" id="6_idm45941120213576"></a>We can use static imports to make this a bit shorter with
<code>import static java.lang.System.out;</code>鈥攖his will enable us to refer to
the printing method as <code>out.println()</code> but as this is an instance
method, we cannot shorten it any further.</p>
</div></section>



</div></section>













<section data-pdf-bookmark="Composition Versus Inheritance" data-type="sect2"><div class="sect2" id="idm45941120336232">
<h2>Composition Versus Inheritance</h2>

<p><a data-primary="composition, inheritance vs." data-type="indexterm" id="6_ix_ch05-asciidoc4"></a><a data-primary="inheritance" data-secondary="composition vs." data-type="indexterm" id="6_ix_ch05-asciidoc5"></a><a data-primary="object-oriented design" data-secondary="composition vs. inheritance" data-type="indexterm" id="6_ix_ch05-asciidoc6"></a>Inheritance is not the only technique at our disposal in
object-oriented design. Objects can contain references to other objects,
so a larger conceptual unit can be aggregated out of smaller component
parts; this is known as <em>composition</em>. One important related technique
is <em>delegation</em>, where an object of a particular type holds a reference
to a secondary object of a compatible type, and forwards all operations
to the secondary object. This is frequently done using interface types,
as shown in this example where we model the employment structure of
software companies:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">interface</code> <code class="nc">Employee</code> <code class="o">{</code>
  <code class="kt">void</code> <code class="nf">work</code><code class="o">();</code>
<code class="o">}</code>

<code class="kd">public</code> <code class="kd">class</code> <code class="nc">Programmer</code> <code class="kd">implements</code> <code class="n">Employee</code> <code class="o">{</code>
  <code class="kd">public</code> <code class="kt">void</code> <code class="nf">work</code><code class="o">()</code> <code class="o">{</code> <code class="cm">/* program computer */</code> <code class="o">}</code>
<code class="o">}</code>

<code class="kd">public</code> <code class="kd">class</code> <code class="nc">Manager</code> <code class="kd">implements</code> <code class="n">Employee</code> <code class="o">{</code>
  <code class="kd">private</code> <code class="n">Employee</code> <code class="n">report</code><code class="o">;</code>

  <code class="kd">public</code> <code class="nf">Manager</code><code class="o">(</code><code class="n">Employee</code> <code class="n">staff</code><code class="o">)</code> <code class="o">{</code>
    <code class="n">report</code> <code class="o">=</code> <code class="n">staff</code><code class="o">;</code>
  <code class="o">}</code>

  <code class="kd">public</code> <code class="n">Employee</code> <code class="nf">setReport</code><code class="o">(</code><code class="n">Employee</code> <code class="n">staff</code><code class="o">)</code> <code class="o">{</code>
    <code class="n">report</code> <code class="o">=</code> <code class="n">staff</code><code class="o">;</code>
  <code class="o">}</code>

  <code class="kd">public</code> <code class="kt">void</code> <code class="nf">work</code><code class="o">()</code> <code class="o">{</code>
    <code class="n">report</code><code class="o">.</code><code class="na">work</code><code class="o">();</code>
  <code class="o">}</code>
<code class="o">}</code></pre>

<p>The <code>Manager</code> class is said to <em>delegate</em> the <code>work()</code> operation to
their direct report, and no actual work is performed by the <code>Manager</code>
object. Variations of this pattern involve some work being done in the
delegating class, with only some calls being forwarded to the delegate
object.</p>

<p><a data-primary="decorator pattern" data-type="indexterm" id="6_idm45941120053960"></a>Another useful, related technique is called the <em>decorator
pattern</em>. This provides the capability to extend objects with new
functionality, including at runtime. The slight overhead is some extra
work needed at design time. Let鈥檚 look at an example of the decorator
pattern as applied to modeling burritos for sale at a taqueria. To keep
things simple, we鈥檝e only modeled a single aspect to be decorated鈥攖he
price of the burrito:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// The basic interface for our burritos</code>
<code class="kd">interface</code> <code class="nc">Burrito</code> <code class="o">{</code>
  <code class="kt">double</code> <code class="nf">getPrice</code><code class="o">();</code>
<code class="o">}</code>

<code class="c1">// Concrete implementation-standard size burrito</code>
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">StandardBurrito</code> <code class="kd">implements</code> <code class="n">Burrito</code> <code class="o">{</code>
  <code class="kd">private</code> <code class="kd">static</code> <code class="kd">final</code> <code class="kt">double</code> <code class="n">BASE_PRICE</code> <code class="o">=</code> <code class="mf">5.99</code><code class="o">;</code>

  <code class="kd">public</code> <code class="kt">double</code> <code class="nf">getPrice</code><code class="o">()</code> <code class="o">{</code>
    <code class="k">return</code> <code class="n">BASE_PRICE</code><code class="o">;</code>
  <code class="o">}</code>
<code class="o">}</code>

<code class="c1">// Larger, super-size burrito</code>
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">SuperBurrito</code> <code class="kd">implements</code> <code class="n">Burrito</code> <code class="o">{</code>
  <code class="kd">private</code> <code class="kd">static</code> <code class="kd">final</code> <code class="kt">double</code> <code class="n">BASE_PRICE</code> <code class="o">=</code> <code class="mf">6.99</code><code class="o">;</code>

  <code class="kd">public</code> <code class="kt">double</code> <code class="nf">getPrice</code><code class="o">()</code> <code class="o">{</code>
    <code class="k">return</code> <code class="n">BASE_PRICE</code><code class="o">;</code>
  <code class="o">}</code>
<code class="o">}</code></pre>

<p>These cover the basic burritos that can be offered鈥攖wo different sizes,
at different prices. Let鈥檚 enhance this by adding some optional
extras鈥攋alape帽o chilies and guacamole. The key design point here is to
use an abstract base class that all of the optional decorating
components will subclass:</p>

<pre data-code-language="java" data-type="programlisting"><code class="cm">/*</code>
<code class="cm"> * This class is the Decorator for Burrito. It represents optional</code>
<code class="cm"> * extras that the burrito may or may not have.</code>
<code class="cm"> */</code>
<code class="kd">public</code> <code class="kd">abstract</code> <code class="kd">class</code> <code class="nc">BurritoOptionalExtra</code> <code class="kd">implements</code> <code class="n">Burrito</code> <code class="o">{</code>
    <code class="kd">private</code> <code class="kd">final</code> <code class="n">Burrito</code> <code class="n">burrito</code><code class="o">;</code>
    <code class="kd">private</code> <code class="kd">final</code> <code class="kt">double</code> <code class="n">price</code><code class="o">;</code>

    <code class="kd">protected</code> <code class="nf">BurritoOptionalExtra</code><code class="o">(</code><code class="n">Burrito</code> <code class="n">toDecorate</code><code class="o">,</code>
          <code class="kt">double</code> <code class="n">myPrice</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">burrito</code> <code class="o">=</code> <code class="n">toDecorate</code><code class="o">;</code>
        <code class="n">price</code> <code class="o">=</code> <code class="n">myPrice</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kd">final</code> <code class="kt">double</code> <code class="nf">getPrice</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="o">(</code><code class="n">burrito</code><code class="o">.</code><code class="na">getPrice</code><code class="o">()</code> <code class="o">+</code> <code class="n">price</code><code class="o">);</code>
    <code class="o">}</code>
<code class="o">}</code></pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Combining an <code>abstract</code> base, <code>BurritoOptionalExtra</code>, and a
<code>protected</code> constructor means that the only valid way to get a
<code>BurritoOptionalExtra</code> is to construct an instance of one of the
subclasses, as they have public constructors (which also hide the setup
of the price of the component from client code).</p>
</div>

<p>Let鈥檚 test the implementation out:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Burrito</code> <code class="n">lunch</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Jalapeno</code><code class="o">(</code><code class="k">new</code> <code class="n">Guacamole</code><code class="o">(</code><code class="k">new</code> <code class="n">SuperBurrito</code><code class="o">()));</code>
<code class="c1">// The overall cost of the burrito is the expected $8.09.</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Lunch cost: </code><code class="o">+</code> <code class="n">lunch</code><code class="o">.</code><code class="na">getPrice</code><code class="o">());</code></pre>

<p>The decorator pattern is very widely used鈥攏ot least in the JDK utility
classes. When we discuss Java I/O in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch10.html#javanut7-CHP-10">Chapter 10</a>,
we will see more examples of decorators in the wild.<a data-startref="ix_ch05-asciidoc6" data-type="indexterm" id="6_idm45941119748520"></a><a data-startref="ix_ch05-asciidoc5" data-type="indexterm" id="6_idm45941119747912"></a><a data-startref="ix_ch05-asciidoc4" data-type="indexterm" id="6_idm45941119838200"></a></p>
</div></section>













<section data-pdf-bookmark="Field Inheritance and Accessors" data-type="sect2"><div class="sect2" id="idm45941120211256">
<h2>Field Inheritance and Accessors</h2>

<p><a data-primary="accessor methods, field inheritance and" data-type="indexterm" id="6_ix_ch05-asciidoc7"></a><a data-primary="fields" data-secondary="inheritance" data-type="indexterm" id="6_ix_ch05-asciidoc8"></a><a data-primary="object-oriented design" data-secondary="field inheritance and accessors" data-type="indexterm" id="6_ix_ch05-asciidoc9"></a>Java offers multiple potential approaches to the design issue of the
inheritance of state. The programmer can choose to mark fields as
<code>protected</code> and allow them to be accessed directly by subclasses
(including writing to them). Alternatively, we can provide <em>accessor
methods</em> to read (and write, if desired) the actual object fields,
while retaining encapsulation and leaving the fields as <code>private</code>.</p>

<p>Let鈥檚 revisit our earlier <code>PlaneCircle</code> example from the end of
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3">Chapter 3</a> and explicitly show the field
inheritance:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">Circle</code> <code class="o">{</code>
  <code class="c1">// This is a generally useful constant, so we keep it public</code>
  <code class="kd">public</code> <code class="kd">static</code> <code class="kd">final</code> <code class="kt">double</code> <code class="n">PI</code> <code class="o">=</code> <code class="mf">3.14159</code><code class="o">;</code>

  <code class="kd">protected</code> <code class="kt">double</code> <code class="n">r</code><code class="o">;</code>     <code class="c1">// State inheritance via a protected field</code>

  <code class="c1">// A method to enforce the restriction on the radius</code>
  <code class="kd">protected</code> <code class="kt">void</code> <code class="nf">checkRadius</code><code class="o">(</code><code class="kt">double</code> <code class="n">radius</code><code class="o">)</code> <code class="o">{</code>
    <code class="k">if</code> <code class="o">(</code><code class="n">radius</code> <code class="o">&lt;</code> <code class="mf">0.0</code><code class="o">)</code>
      <code class="k">throw</code> <code class="k">new</code> <code class="nf">IllegalArgumentException</code><code class="o">(</code><code class="s">radius may not &lt; 0</code><code class="o">);</code>
  <code class="o">}</code>

  <code class="c1">// The non-default constructor</code>
  <code class="kd">public</code> <code class="nf">Circle</code><code class="o">(</code><code class="kt">double</code> <code class="n">r</code><code class="o">)</code> <code class="o">{</code>
    <code class="n">checkRadius</code><code class="o">(</code><code class="n">r</code><code class="o">);</code>
    <code class="k">this</code><code class="o">.</code><code class="na">r</code> <code class="o">=</code> <code class="n">r</code><code class="o">;</code>
  <code class="o">}</code>

  <code class="c1">// Public data accessor methods</code>
  <code class="kd">public</code> <code class="kt">double</code> <code class="nf">getRadius</code><code class="o">()</code> <code class="o">{</code> <code class="k">return</code> <code class="n">r</code><code class="o">;</code> <code class="o">}</code>
  <code class="kd">public</code> <code class="kt">void</code> <code class="nf">setRadius</code><code class="o">(</code><code class="kt">double</code> <code class="n">r</code><code class="o">)</code> <code class="o">{</code>
    <code class="n">checkRadius</code><code class="o">(</code><code class="n">r</code><code class="o">);</code>
    <code class="k">this</code><code class="o">.</code><code class="na">r</code> <code class="o">=</code> <code class="n">r</code><code class="o">;</code>
  <code class="o">}</code>

  <code class="c1">// Methods to operate on the instance field</code>
  <code class="kd">public</code> <code class="kt">double</code> <code class="nf">area</code><code class="o">()</code> <code class="o">{</code> <code class="k">return</code> <code class="n">PI</code> <code class="o">*</code> <code class="n">r</code> <code class="o">*</code> <code class="n">r</code><code class="o">;</code> <code class="o">}</code>
  <code class="kd">public</code> <code class="kt">double</code> <code class="nf">circumference</code><code class="o">()</code> <code class="o">{</code> <code class="k">return</code> <code class="mi">2</code> <code class="o">*</code> <code class="n">PI</code> <code class="o">*</code> <code class="n">r</code><code class="o">;</code> <code class="o">}</code>
<code class="o">}</code>

<code class="kd">public</code> <code class="kd">class</code> <code class="nc">PlaneCircle</code> <code class="kd">extends</code> <code class="n">Circle</code> <code class="o">{</code>
  <code class="c1">// We automatically inherit the fields and methods of Circle,</code>
  <code class="c1">// so we only have to put the new stuff here.</code>
  <code class="c1">// New instance fields that store the center point of the circle</code>
  <code class="kd">private</code> <code class="kd">final</code> <code class="kt">double</code> <code class="n">cx</code><code class="o">,</code> <code class="n">cy</code><code class="o">;</code>

  <code class="c1">// A new constructor to initialize the new fields</code>
  <code class="c1">// It uses a special syntax to invoke the Circle() constructor</code>
  <code class="kd">public</code> <code class="nf">PlaneCircle</code><code class="o">(</code><code class="kt">double</code> <code class="n">r</code><code class="o">,</code> <code class="kt">double</code> <code class="n">x</code><code class="o">,</code> <code class="kt">double</code> <code class="n">y</code><code class="o">)</code> <code class="o">{</code>
    <code class="kd">super</code><code class="o">(</code><code class="n">r</code><code class="o">);</code>       <code class="c1">// Invoke the constructor of the superclass</code>
    <code class="k">this</code><code class="o">.</code><code class="na">cx</code> <code class="o">=</code> <code class="n">x</code><code class="o">;</code>    <code class="c1">// Initialize the instance field cx</code>
    <code class="k">this</code><code class="o">.</code><code class="na">cy</code> <code class="o">=</code> <code class="n">y</code><code class="o">;</code>    <code class="c1">// Initialize the instance field cy</code>
  <code class="o">}</code>

  <code class="kd">public</code> <code class="kt">double</code> <code class="nf">getCentreX</code><code class="o">()</code> <code class="o">{</code>
    <code class="k">return</code> <code class="n">cx</code><code class="o">;</code>
  <code class="o">}</code>

  <code class="kd">public</code> <code class="kt">double</code> <code class="nf">getCentreY</code><code class="o">()</code> <code class="o">{</code>
    <code class="k">return</code> <code class="n">cy</code><code class="o">;</code>
  <code class="o">}</code>

  <code class="c1">// The area() and circumference() methods are inherited from Circle</code>
  <code class="c1">// A new instance method that checks whether a point is inside the</code>
  <code class="c1">// circle; note that it uses the inherited instance field r</code>
  <code class="kd">public</code> <code class="kt">boolean</code> <code class="nf">isInside</code><code class="o">(</code><code class="kt">double</code> <code class="n">x</code><code class="o">,</code> <code class="kt">double</code> <code class="n">y</code><code class="o">)</code> <code class="o">{</code>
    <code class="kt">double</code> <code class="n">dx</code> <code class="o">=</code> <code class="n">x</code> <code class="o">-</code> <code class="n">cx</code><code class="o">,</code> <code class="n">dy</code> <code class="o">=</code> <code class="n">y</code> <code class="o">-</code> <code class="n">cy</code><code class="o">;</code>
    <code class="c1">// Pythagorean theorem</code>
    <code class="kt">double</code> <code class="n">distance</code> <code class="o">=</code> <code class="n">Math</code><code class="o">.</code><code class="na">sqrt</code><code class="o">(</code><code class="n">dx</code><code class="o">*</code><code class="n">dx</code> <code class="o">+</code> <code class="n">dy</code><code class="o">*</code><code class="n">dy</code><code class="o">);</code>
    <code class="k">return</code> <code class="o">(</code><code class="n">distance</code> <code class="o">&lt;</code> <code class="n">r</code><code class="o">);</code>                   <code class="c1">// Returns true or false</code>
  <code class="o">}</code>
<code class="o">}</code></pre>

<p>Instead of the preceding code, we can rewrite <code>PlaneCircle</code> using
accessor methods, like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">PlaneCircle</code> <code class="kd">extends</code> <code class="n">Circle</code> <code class="o">{</code>
  <code class="c1">// Rest of class is the same as above; the field r in</code>
  <code class="c1">// the superclass Circle can be made private because</code>
  <code class="c1">// we no longer access it directly here</code>

  <code class="c1">// Note that we now use the accessor method getRadius()</code>
  <code class="kd">public</code> <code class="kt">boolean</code> <code class="nf">isInside</code><code class="o">(</code><code class="kt">double</code> <code class="n">x</code><code class="o">,</code> <code class="kt">double</code> <code class="n">y</code><code class="o">)</code> <code class="o">{</code>
    <code class="kt">double</code> <code class="n">dx</code> <code class="o">=</code> <code class="n">x</code> <code class="o">-</code> <code class="n">cx</code><code class="o">,</code> <code class="n">dy</code> <code class="o">=</code> <code class="n">y</code> <code class="o">-</code> <code class="n">cy</code><code class="o">;</code>            <code class="c1">// Distance from center</code>
    <code class="kt">double</code> <code class="n">distance</code> <code class="o">=</code> <code class="n">Math</code><code class="o">.</code><code class="na">sqrt</code><code class="o">(</code><code class="n">dx</code><code class="o">*</code><code class="n">dx</code> <code class="o">+</code> <code class="n">dy</code><code class="o">*</code><code class="n">dy</code><code class="o">);</code> <code class="c1">// Pythagorean theorem</code>
    <code class="k">return</code> <code class="o">(</code><code class="n">distance</code> <code class="o">&lt;</code> <code class="n">getRadius</code><code class="o">());</code>
  <code class="o">}</code>
<code class="o">}</code></pre>

<p>Both approaches are legal Java, but they have some differences. As we
discussed in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3-SECT-5">鈥淒ata Hiding and Encapsulation鈥?/a&gt;, fields that are
writable outside of the class are usually not a correct way to model
object state. In fact, as we will see in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch05.html#javanut7-CHP-5-SECT-5">鈥淪afe Java Programming鈥?/a&gt; and again in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch06.html#javanut7-CHP-6-SECT-5">鈥淛ava鈥檚 Support for Concurrency鈥?/a&gt;, they can damage the running
state of a program irreparably.</p>

<p><a data-primary="protected access" data-type="indexterm" id="6_idm45941119465016"></a>It is therefore unfortunate that the <code>protected</code> keyword in Java allows
access to fields (and methods) from both subclasses <em>and</em> classes in the
same packages as the declaring class. This, combined with the ability
for anyone to write a class that belongs to any given package (except
system packages), means that protected inheritance of state is
potentially flawed in Java.</p>
<div data-type="tip"><h6>Tip</h6>
<p>Java does not provide a mechanism for a member to be visible only in the
declaring class and its subclasses.</p>
</div>

<p>For all of these reasons, it is usually better to use accessor methods
(either public or protected) to provide access to state for
subclasses鈥攗nless the inherited state is declared <code>final</code>, in which case
protected inheritance of state is perfectly permissible.<a data-startref="ix_ch05-asciidoc9" data-type="indexterm" id="6_idm45941119460840"></a><a data-startref="ix_ch05-asciidoc8" data-type="indexterm" id="6_idm45941119460136"></a><a data-startref="ix_ch05-asciidoc7" data-type="indexterm" id="6_idm45941119459464"></a></p>
</div></section>













<section data-pdf-bookmark="Singleton" data-type="sect2"><div class="sect2" id="idm45941119836936">
<h2>Singleton</h2>

<p><a data-primary="object-oriented design" data-secondary="singleton pattern" data-type="indexterm" id="6_ix_ch05-asciidoc10"></a><a data-primary="singleton pattern" data-type="indexterm" id="6_ix_ch05-asciidoc11"></a>The <em>singleton pattern</em> is another well-known design pattern. It is
intended to solve the design issue where only a single instance of a
class is required or desired. Java provides a number of different
possible ways to implement the singleton pattern. In our discussion, we
will use a slightly more verbose form, which has the benefit of being
very explicit in what needs to happen for a safe singleton:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">Singleton</code> <code class="o">{</code>
  <code class="kd">private</code> <code class="kd">final</code> <code class="kd">static</code> <code class="n">Singleton</code> <code class="n">instance</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Singleton</code><code class="o">();</code>
  <code class="kd">private</code> <code class="kd">static</code> <code class="kt">boolean</code> <code class="n">initialized</code> <code class="o">=</code> <code class="kc">false</code><code class="o">;</code>

  <code class="c1">// Constructor</code>
  <code class="kd">private</code> <code class="nf">Singleton</code><code class="o">()</code> <code class="o">{</code>
    <code class="kd">super</code><code class="o">();</code>
  <code class="o">}</code>

  <code class="kd">private</code> <code class="kt">void</code> <code class="nf">init</code><code class="o">()</code> <code class="o">{</code>
    <code class="cm">/* Do initialization */</code>
  <code class="o">}</code>

  <code class="c1">// This method should be the only way to get a reference</code>
  <code class="c1">// to the instance</code>
  <code class="kd">public</code> <code class="kd">static</code> <code class="kd">synchronized</code> <code class="n">Singleton</code> <code class="nf">getInstance</code><code class="o">()</code> <code class="o">{</code>
    <code class="k">if</code> <code class="o">(</code><code class="n">initialized</code><code class="o">)</code> <code class="k">return</code> <code class="n">instance</code><code class="o">;</code>
    <code class="n">instance</code><code class="o">.</code><code class="na">init</code><code class="o">();</code>
    <code class="n">initialized</code> <code class="o">=</code> <code class="kc">true</code><code class="o">;</code>
    <code class="k">return</code> <code class="n">instance</code><code class="o">;</code>
  <code class="o">}</code>
<code class="o">}</code></pre>

<p>The crucial point is that for the singleton pattern to be effective, it
must be impossible to create more than one of them, and it must be
impossible to get a reference to the object in an uninitialized state
(see later in this chapter for more on this important point). To achieve
this, we require a <code>private</code> constructor, which is only called once. In
our version of <code>Singleton</code>, we only call the constructor when we
initialize the private static variable <code>instance</code>. We also separate out
the creation of the only <code>Singleton</code> object from its
initialization鈥攚hich occurs in the private method <code>init()</code>.</p>

<p><a data-primary="getInstance()" data-type="indexterm" id="6_idm45941119205080"></a>With this mechanism in place, the only way to get a reference to the
lone instance of <code>Singleton</code> is via the static helper method,
<code>getInstance()</code>. This method checks the flag <code>initialized</code> to see if the
object is already in an active state. If it is, then a reference to the
singleton object is returned. If not, then <code>getInstance()</code> calls
<code>init()</code> to activate the object, and flicks the flag to <code>true</code>, so that
next time a reference to the <code>Singleton</code> is requested, further
initialization will not occur.</p>

<p>Finally, we also note that <code>getInstance()</code> is a <code>synchronized</code> method.
See <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch06.html#javanut7-CHP-6">Chapter 6</a> for full details of what this means,
and why it is necessary, but for now, know that it is present to guard
against unintended consequences if <code>Singleton</code> is used in a
<span class="keep-together">multithreaded</span> program.</p>
<div data-type="tip"><h6>Tip</h6>
<p>Singleton, being one of the simplest patterns, is often overused. When
used correctly, it can be a useful technique, but too many singleton
classes in a program is a classic sign of badly engineered code.</p>
</div>

<p>The singleton pattern has some drawbacks鈥攊n particular, it can be hard
to test and to separate out from other classes. It also requires care
when used in mulithreaded code. Nevertheless, it is important that
developers are familiar with it, and do not accidentally reinvent it. The
singleton pattern is often used in configuration management, but modern
code will typically use a framework (often a <em>dependency injection</em>) to
provide the programmer with singletons automatically, rather than via an
explicit <code>Singleton</code> (or equivalent) class.<a data-startref="ix_ch05-asciidoc11" data-type="indexterm" id="6_idm45941119194584"></a><a data-startref="ix_ch05-asciidoc10" data-type="indexterm" id="6_idm45941119193848"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Object-Oriented Design with Lambdas" data-type="sect1"><div class="sect1" id="idm45941120887032">
<h1>Object-Oriented Design with Lambdas</h1>

<p><a data-primary="lambda expressions" data-secondary="object-oriented design and" data-type="indexterm" id="6_ix_ch05-asciidoc12"></a><a data-primary="object-oriented design" data-secondary="lambdas and" data-type="indexterm" id="6_ix_ch05-asciidoc13"></a>Consider this simple lambda expression:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Runnable</code> <code class="n">r</code> <code class="o">=</code> <code class="o">()</code> <code class="o">-&gt;</code> <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Hello World</code><code class="o">);</code></pre>

<p>The type of the <code>lvalue</code> is <code>Runnable</code>, which is an interface type.
For this statement to make sense, the <code>rvalue</code> must contain an instance of some class type (because interfaces cannot be instantiated) that implements <code>Runnable</code>.
The minimal implementation that satisfies these constraints is a class type (of inconsequential name) that directly extends <code>Object</code> and implements <code>Runnable</code>.</p>

<p>Recall that the intention of lambda expressions is to allow Java programmers to express a concept that is as close as possible to the anonymous or inline methods seen in other languages.</p>

<p>Furthermore, given that Java is a statically typed language, this leads directly to the design of lambdas as implemented.</p>
<div data-type="tip"><h6>Tip</h6>
<p>Lambdas are a shorthand for the construction of a new instance of a class type that is essentially <code>Object</code> enhanced by a single method.</p>
</div>

<p>A lambda鈥檚 single extra method has a signature provided by the interface type, and the compiler will check that the <code>rvalue</code> is consistent with this type signature.</p>








<section data-pdf-bookmark="Lambdas Versus Nested Classes" data-type="sect2"><div class="sect2" id="idm45941119174280">
<h2>Lambdas Versus Nested Classes</h2>

<p><a data-primary="lambda expressions" data-secondary="nested classes vs." data-type="indexterm" id="6_idm45941119169288"></a><a data-primary="nested classes, lambdas vs." data-type="indexterm" id="6_idm45941119168312"></a>The addition of lambdas to the language in Java 8 was relatively late, as compared to other programming languages.
As a consequence, the Java community had established patterns to work around the absence of lambdas.
This manifests in a heavy usage of nested (aka inner) classes to fill the niche that lambdas usually occupy.</p>

<p>In modern Java projects that are developed from scratch, developers will typically use lambdas wherever possible.
We also strongly suggest that, when refactoring old code, you take some time to convert inner classes to lambdas wherever possible.
Some IDEs even provide an automatic conversion facility.</p>

<p>However, this still leaves the design question of when to use lambdas and when nested classes are still the correct solution.</p>

<p>Some cases are obvious鈥攆or example, when extended from a default implementation (e.g., for a Visitor pattern), like this file reaper for deleting a whole subdirectory and everything in it:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">final</code> <code class="kd">class</code> <code class="nc">Reaper</code> <code class="kd">extends</code> <code class="n">SimpleFileVisitor</code><code class="o">&lt;</code><code class="n">Path</code><code class="o">&gt;</code> <code class="o">{</code>
    <code class="nd">@Override</code>
    <code class="kd">public</code> <code class="n">FileVisitResult</code> <code class="nf">visitFile</code><code class="o">(</code><code class="n">Path</code> <code class="n">p</code><code class="o">,</code> <code class="n">BasicFileAttributes</code> <code class="n">a</code><code class="o">)</code>
            <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>
        <code class="n">Files</code><code class="o">.</code><code class="na">delete</code><code class="o">(</code><code class="n">p</code><code class="o">);</code>
        <code class="k">return</code> <code class="n">FileVisitResult</code><code class="o">.</code><code class="na">CONTINUE</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="nd">@Override</code>
    <code class="kd">public</code> <code class="n">FileVisitResult</code> <code class="nf">visitFileFailed</code><code class="o">(</code><code class="n">Path</code> <code class="n">p</code><code class="o">,</code> <code class="n">IOException</code> <code class="n">x</code><code class="o">)</code>
            <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>
        <code class="n">Files</code><code class="o">.</code><code class="na">delete</code><code class="o">(</code><code class="n">p</code><code class="o">);</code>
        <code class="k">return</code> <code class="n">FileVisitResult</code><code class="o">.</code><code class="na">CONTINUE</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="nd">@Override</code>
    <code class="kd">public</code> <code class="n">FileVisitResult</code> <code class="nf">postVisitDirectory</code><code class="o">(</code><code class="n">Path</code> <code class="n">p</code><code class="o">,</code> <code class="n">IOException</code> <code class="n">x</code><code class="o">)</code>
            <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>
        <code class="k">if</code> <code class="o">(</code><code class="n">x</code> <code class="o">==</code> <code class="kc">null</code><code class="o">)</code> <code class="o">{</code>
            <code class="n">Files</code><code class="o">.</code><code class="na">delete</code><code class="o">(</code><code class="n">p</code><code class="o">);</code>
            <code class="k">return</code> <code class="n">FileVisitResult</code><code class="o">.</code><code class="na">CONTINUE</code><code class="o">;</code>
        <code class="o">}</code> <code class="k">else</code> <code class="o">{</code>
            <code class="k">throw</code> <code class="n">x</code><code class="o">;</code>
        <code class="o">}</code>
    <code class="o">}</code>
<code class="o">}</code></pre>

<p>This is an extension of an existing class鈥攁nd of course lambdas can only be used for interfaces, not for classes (even abstract classes with a single abstract method).
As a result, this is a clear use case for an inner class, not a lambda.</p>

<p>Another major use case to consider is that of stateful lambdas.
As there is nowhere to declare any fields, it would appear at first glance that lambdas cannot directly be used for anything that involves state鈥攖he syntax only gives the opportunity to declare a method body.</p>

<p>However, a lambda can refer to a variable defined in the scope that the lambda is created in, so we can create a closure, as discussed in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4">Chapter 4</a>, to fill the role of a stateful lambda.</p>
</div></section>













<section data-pdf-bookmark="Lambdas Versus Method References" data-type="sect2"><div class="sect2" id="idm45941119009416">
<h2>Lambdas Versus Method References</h2>

<p><a data-primary="lambda expressions" data-secondary="method references vs." data-type="indexterm" id="6_idm45941119008200"></a><a data-primary="method references" data-secondary="lambdas vs." data-type="indexterm" id="6_idm45941119007224"></a>The question of when to use a lambda and when to use a method reference is largely a matter of personal taste and style.
There are, of course, some circumstances where it is essential to create a lambda.
However, in many simple cases, a lambda can be replaced by a method reference.</p>

<p>One possible approach is to consider whether the lambda notation adds anything to the readability of the code.
For example, in the streams API, there is a potential benefit in using the lambda form, as it uses the <code>-&gt;</code> operator.
This provides a form of visual metaphor鈥攖he stream API is a lazy abstraction that can be visualized as data items 鈥渇lowing through a functional pipeline.鈥?
For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">List</code><code class="o">&lt;</code><code class="n">kathik</code><code class="o">.</code><code class="na">Person</code><code class="o">&gt;</code> <code class="n">ots</code> <code class="o">=</code> <code class="kc">null</code><code class="o">;</code>
<code class="kt">double</code> <code class="n">aveAge</code> <code class="o">=</code> <code class="n">ots</code><code class="o">.</code><code class="na">stream</code><code class="o">()</code>
        <code class="o">.</code><code class="na">mapToDouble</code><code class="o">(</code><code class="n">o</code> <code class="o">-&gt;</code> <code class="n">o</code><code class="o">.</code><code class="na">getAge</code><code class="o">())</code>
        <code class="o">.</code><code class="na">reduce</code><code class="o">(</code><code class="mi">0</code><code class="o">,</code> <code class="o">(</code><code class="n">x</code><code class="o">,</code> <code class="n">y</code><code class="o">)</code> <code class="o">-&gt;</code> <code class="n">x</code> <code class="o">+</code> <code class="n">y</code> <code class="o">)</code> <code class="o">/</code> <code class="n">ots</code><code class="o">.</code><code class="na">size</code><code class="o">();</code></pre>

<p>The idea that the <code>mapToDouble()</code> method has an aspect of motion, or transformation, is strongly implied by the usage of an explicit lambda.
For less experienced programmers, it also draws attention to the use of a functional API.</p>

<p>For other use cases (e.g., <em>dispatch tables</em>) method references may well be more appropriate. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">IntOps</code> <code class="o">{</code>
    <code class="kd">private</code> <code class="n">Map</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code> <code class="n">BinaryOperator</code><code class="o">&gt;</code> <code class="n">table</code> <code class="o">=</code>
        <code class="n">Map</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="s">add</code><code class="o">,</code> <code class="nl">IntOps:</code><code class="o">:</code><code class="n">add</code><code class="o">,</code> <code class="s">subtract</code><code class="o">,</code> <code class="nl">IntOps:</code><code class="o">:</code><code class="n">sub</code><code class="o">);</code>

    <code class="kd">private</code> <code class="kd">static</code> <code class="kt">int</code> <code class="nf">add</code><code class="o">(</code><code class="kt">int</code> <code class="n">x</code><code class="o">,</code> <code class="kt">int</code> <code class="n">y</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">x</code> <code class="o">+</code> <code class="n">y</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">private</code> <code class="kd">static</code> <code class="kt">int</code> <code class="nf">sub</code><code class="o">(</code><code class="kt">int</code> <code class="n">x</code><code class="o">,</code> <code class="kt">int</code> <code class="n">y</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">x</code> <code class="o">-</code> <code class="n">y</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">int</code> <code class="nf">eval</code><code class="o">(</code><code class="n">String</code> <code class="n">op</code><code class="o">,</code> <code class="kt">int</code> <code class="n">x</code><code class="o">,</code> <code class="kt">int</code> <code class="n">y</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">table</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="n">op</code><code class="o">).</code><code class="na">apply</code><code class="o">(</code><code class="n">x</code><code class="o">,</code> <code class="n">y</code><code class="o">);</code>
    <code class="o">}</code>
<code class="o">}</code></pre>

<p>In situations where either notation could be used, you will come to develop a preference that fits your individual style over time.
The key consideration is whether, when returning to reread code written several months (or years) ago, the choice of notation still makes sense and the code is easy to read.<a data-startref="ix_ch05-asciidoc13" data-type="indexterm" id="6_idm45941118972232"></a><a data-startref="ix_ch05-asciidoc12" data-type="indexterm" id="6_idm45941118770952"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Exceptions and Exception Handling" data-type="sect1"><div class="sect1" id="idm45941119192584">
<h1>Exceptions and Exception Handling</h1>

<p><a data-primary="exception handling" data-type="indexterm" id="6_idm45941118769208"></a><a data-primary="exceptions" data-secondary="object-oriented design and" data-type="indexterm" id="6_idm45941118768504"></a><a data-primary="object-oriented design" data-secondary="exception handling" data-type="indexterm" id="6_idm45941118767592"></a>We met checked and unchecked exceptions in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2-SECT-6.3">鈥淐hecked and Unchecked Exceptions鈥?/a&gt;. In this section, we
discuss some additional aspects of the design of exceptions, and how to
use them in your own code.</p>

<p><a data-primary="java.lang.Throwable" data-type="indexterm" id="6_idm45941118765352"></a><a data-primary="Throwable class" data-type="indexterm" id="6_idm45941118764488"></a>Recall that an exception in Java is an object. The type of this object
is <code>java.lang.Throwable</code>, or more commonly, some subclass of
<code>Throwable</code> that more specifically describes the type of exception that
occurred. <a data-primary="java.lang.Error" data-type="indexterm" id="6_idm45941118762888"></a><a data-primary="java.lang.Exception" data-type="indexterm" id="6_idm45941118762184"></a><code>Throwable</code> has two standard subclasses: <code>java.lang.Error</code> and
<code>java.lang.Exception</code>. Exceptions that are subclasses of <code>Error</code>
generally indicate unrecoverable problems: the virtual machine has run
out of memory, or a class file is corrupted and cannot be read, for
example. Exceptions of this sort can be caught and handled, but it is
rare to do so鈥攖hese are the unchecked exceptions previously mentioned.</p>

<p>Exceptions that are subclasses of <code>Exception</code>, on the other hand,
indicate less severe conditions. These exceptions can be reasonably
caught and handled. They include such exceptions as
<code>java.io.EOFException</code>, which signals the end of a file, and
<code>java.lang.ArrayIndexOutOfBoundsException</code>, which indicates that a
program has tried to read past the end of an array. These are the
checked exceptions from <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2">Chapter 2</a> (except for
subclasses of <code>RuntimeException</code>, which are also a form of unchecked
exception). In this book, we use the term 鈥渆xception鈥?to refer to any
exception object, regardless of whether the type of that exception is
<code>Exception</code> or <code>Error</code>.</p>

<p>Because an exception is an object, it can contain data, and its class
can define methods that operate on that data. The <code>Throwable</code> class and
all its subclasses include a <code>String</code> field that stores a human-readable
error message that describes the exceptional condition. It鈥檚 set when
the exception object is created and can be read from the exception with
the <code>getMessage()</code> method. Most exceptions contain only this single
message, but a few add other data. The <code>java.io.InterruptedIOException</code>,
for example, adds a field named <code>bytesTransferred</code> that specifies how
much input or output was completed before the exceptional condition
interrupted it.</p>

<p>When designing your own exceptions, you should consider what other
additional modeling information is relevant to the exception object.
This is usually situation-specific information about the aborted
operation, and the exceptional circumstance that was encountered (as we
saw with <code>java.io.InterruptedIOException</code>).</p>

<p>There are some trade-offs in the use of exceptions in application
design. Using checked exceptions means that the compiler can enforce the
handling (or propagation up the call stack) of known conditions that
have the potential of recovery or retry. It also means that it鈥檚 more
difficult to forget to actually handle errors鈥攖hus reducing the risk
that a forgotten error condition causes a system to fail in <span class="keep-together">production</span>.</p>

<p>On the other hand, some applications will not be able to recover from
certain conditions鈥攅ven conditions that are theoretically modeled by
checked exceptions. For example, if an application requires a config
file to be placed at a specific place in the filesystem and can鈥檛
locate it at startup, it may have no option but to print an
error message and exit鈥攄espite the fact that
<code>java.io.FileNotFoundException</code> is a checked exception. Forcing
exceptions that cannot be recovered from to be either handled or
propagated is, in these circumstances, bordering on perverse.</p>

<p>When designing exception schemes, there are some good practices that
you should follow:</p>

<ul>
<li>
<p>Consider what additional state needs to be placed on the
exception鈥攔emember that it鈥檚 also an object like any other.</p>
</li>
<li>
<p><code>Exception</code> has four public constructors鈥攗nder normal circumstances,
custom exception classes should implement all of them鈥攖o initialize the
additional state or to customize messages.</p>
</li>
<li>
<p>Don鈥檛 create many fine-grained custom exception classes in your
APIs鈥攖he Java I/O and reflection APIs both suffer from this and it
needlessly complicates working with those packages.</p>
</li>
<li>
<p>Don鈥檛 overburden a single exception type with describing too many
conditions; for example, the Nashorn JavaScript implementation (new with
Java 8) originally had overly coarse-grained exceptions, although this
was fixed before release.</p>
</li>
</ul>

<p>Finally, two exception-handling antipatterns that you should avoid:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Never just swallow an exception</code>
<code class="k">try</code> <code class="o">{</code>
  <code class="n">someMethodThatMightThrow</code><code class="o">();</code>
<code class="o">}</code> <code class="k">catch</code><code class="o">(</code><code class="n">Exception</code> <code class="n">e</code><code class="o">){</code>
<code class="o">}</code>

<code class="c1">// Never catch, log, and rethrow an exception</code>
<code class="k">try</code> <code class="o">{</code>
  <code class="n">someMethodThatMightThrow</code><code class="o">();</code>
<code class="o">}</code> <code class="k">catch</code><code class="o">(</code><code class="n">SpecificException</code> <code class="n">e</code><code class="o">){</code>
  <code class="n">log</code><code class="o">(</code><code class="n">e</code><code class="o">);</code>
  <code class="k">throw</code> <code class="n">e</code><code class="o">;</code>
<code class="o">}</code></pre>

<p>The former of these two just ignores a condition that almost certainly
required some action (even if just a notification in a log). This
increases the likelihood of failure elsewhere in the system鈥攑otentially
far from the original, real source.</p>

<p>The second one just creates noise. We鈥檙e logging a message but not
actually doing anything about the issue; we still require some other code
higher up in the system to actually deal with the problem.</p>
</div></section>













<section data-pdf-bookmark="Safe Java Programming" data-type="sect1"><div class="sect1" id="javanut7-CHP-5-SECT-5">
<h1>Safe Java Programming</h1>

<p><a data-primary="object-oriented design" data-secondary="safe programming" data-type="indexterm" id="6_idm45941118706488"></a><a data-primary="safety" data-secondary="object-oriented design and" data-type="indexterm" id="6_idm45941118705512"></a><a data-primary="type safety" data-type="indexterm" id="6_idm45941118704600"></a>Programming languages are sometimes described as being <em>type
safe</em>; however, this term is used rather loosely by working
programmers. There are a number of different viewpoints on and definitions
for type safety, not all of which are mutually compatible.
The most useful view for our purposes is that <em>type safety</em> is the
property of a programming language that prevents the type of data being
incorrectly identified at runtime. This should be thought of as a
sliding scale鈥攊t is more helpful to think of languages as being more (or
less) type safe than each other, rather than a simple binary property of
safe/unsafe.</p>

<p>In Java, the static nature of the type system helps prevent a large
class of possible errors, by producing compilation errors if, for
example, the programmer attempts to assign an incompatible value to a
variable. However, Java is not perfectly type safe, as we can perform a
cast between any two reference types鈥攖his will fail at runtime with a
<code>ClassCastException</code> if the value is not compatible.</p>

<p>In this book, we prefer to think of safety as inseparable from the
broader topic of correctness. This means that we should think in terms
of programs, rather than languages. This emphasizes the point that safe
code is not guaranteed by any widely used language, and instead
considerable programmer effort (and adherence to rigorous coding
discipline) must be employed if the end result is to be truly safe and
correct.</p>

<p>We approach our view of safe programs by working with the state model
abstraction as shown in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch05.html#javanut7-CHP-5-FIG-1">Figure 5-1</a>. A <em>safe</em>
program is one in which:</p>

<ul>
<li>
<p>All objects start off in a legal state after creation</p>
</li>
<li>
<p>Externally accessible methods transition objects between legal states</p>
</li>
<li>
<p>Externally accessible methods must not return with objects in an
inconsistent state</p>
</li>
<li>
<p>Externally accessible methods must reset objects to a legal state
before <span class="keep-together">throwing</span></p>
</li>
</ul>

<p>In this context, 鈥渆xternally accessible鈥?means <code>public</code>,
package-private, or <span class="keep-together"><code>protected</code></span>. This defines a reasonable model for
safety of programs, and as it is bound up with defining our abstract
types in such a way that their methods ensure consistency of state, it鈥檚
reasonable to refer to a program satisfying these requirements as a
鈥渟afe program,鈥?regardless of the language in which such a program is
implemented.</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>Private methods do not have to start or end with objects in a legal
state, as they cannot be called by an external piece of code.</p>
</div>

<p>As you might imagine, actually engineering a substantial piece of code
so that we can be sure that the state model and methods respect these
properties can be quite an undertaking. In languages such as Java, in
which programmers have direct control over the creation of preemptively
multitasked execution threads, this problem is a great deal worse.<a data-startref="ix_ch05-asciidoc0" data-type="indexterm" id="6_idm45941118634264"></a></p>

<figure><div class="figure" id="javanut7-CHP-5-FIG-1">
<img alt="JN7 0501" data-mfp-src="/library/view/java-in-a/9781492037248/assets/jns7_0501.png" height="618" src="https://learning.oreilly.com/library/view/java-in-a/9781492037248/assets/jns7_0501.png" width="1094"/>
<h6><span class="label">Figure 5-1. </span>Program state transitions</h6>
</div></figure>

<p>Moving on from our introduction of object-oriented design, there is one
final aspect of the Java language and platform that needs to be
understood for a sound grounding. That is the nature of memory and
concurrency鈥攐ne of the most complex of the platform, but also one that
rewards careful study with large dividends. It is the subject of our
next chapter and concludes <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/part01.html#javanut-PART-1">Part I</a>.</p>
</div></section>







</div></section><div class="annotator-outer annotator-viewer viewer annotator-hide"> </div></div></div>
    </section>
  </div>
</div>

<hr/>

<!--if IE]><![endif]--><!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/java-in-a/9781492037248/ch06.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="3866890"
  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"
  data-username="levinxccai"
  data-account-type="B2B"
  
  data-activated-trial-date="11/06/2017"


  data-archive="9781492037248"
  data-publishers="O&#39;Reilly Media, Inc."



  data-htmlfile-name="ch06.html"
  data-epub-title="Java in a Nutshell, 7th Edition" data-debug=0 data-testing=0><![endif]--><!--if gt IE 8]><!--><!--![endif]-->



<a name="7_"></a>
<div id="MathJax_Message" style="display: none;"></div>
<div class="application" id="container" style="height: auto;">
  <div class="js-toc">
    <section role="document">
      <div id="sbo-rt-content" style="max-width:72.5em; transform: none;"><div class="annotator-wrapper"><section data-nutshell-tab="Memory and Concurrency" data-pdf-bookmark="Chapter 6. Java鈥檚 Approach to Memory and Concurrency" data-type="chapter" epub:type="chapter"><div class="chapter" id="javanut7-CHP-6">
<h1><span class="label">Chapter 6. </span>Java Approach to Memory <span class="keep-together">and Concurrency</span></h1>


<p><a data-primary="concurrency" data-seealso="memory management; threads" data-type="indexterm" id="7_idm45941118627576"></a>This chapter is an introduction to the handling of concurrency
(multithreading) and memory in the Java platform. These topics are
inherently intertwined, so it makes sense to treat them together. We
will cover:</p>

<ul>
<li>
<p>Introduction to Java鈥檚 memory management</p>
</li>
<li>
<p>The basic mark-and-sweep Garbage Collection (GC) algorithm</p>
</li>
<li>
<p>How the HotSpot JVM optimizes GC according to the lifetime of the object</p>
</li>
<li>
<p>Java鈥檚 concurrency primitives</p>
</li>
<li>
<p>Data visibility and mutability</p>
</li>
</ul>






<section data-pdf-bookmark="Basic Concepts of Java Memory Management" data-type="sect1"><div class="sect1" id="idm45941118621224">
<h1>Basic Concepts of Java Memory Management</h1>

<p><a data-primary="memory management" data-secondary="basic concepts" data-type="indexterm" id="7_ix_ch06-asciidoc0"></a><a data-primary="memory management" data-seealso="concurrency" data-type="indexterm" id="7_idm45941118618568"></a>In Java, the memory occupied by an object is automatically reclaimed
when the object is no longer needed. This is done through a process
known as <em>garbage collection</em> (or automatic memory management). Garbage
collection is a technique that has been around for years in languages
such as Lisp. It takes some getting used to for programmers accustomed
to languages such as C and C++, in which you must call the <code>free()</code>
function or the <code>delete</code> operator to reclaim memory.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The fact that you don鈥檛 need to remember to destroy every object you
create is one of the features that makes Java a pleasant language to
work with. It is also one of the features that makes programs written in
Java less prone to bugs than those written in languages that don鈥檛
support automatic garbage <span class="keep-together">collection</span>.</p>
</div>

<p>Different VM implementations handle garbage collection in different
ways, and the specifications do not impose very stringent restrictions
on how GC must be implemented. Later in this chapter, we will discuss
the HotSpot JVM (which is the basis of both the Oracle and OpenJDK
implementations of Java). Although this is not the only JVM that you may
encounter, it is the most common among server-side deployments, and
provides a good example of a modern production JVM.</p>








<section data-pdf-bookmark="Memory Leaks in Java" data-type="sect2"><div class="sect2" id="idm45941118594120">
<h2>Memory Leaks in Java</h2>

<p><a data-primary="memory leaks" data-type="indexterm" id="7_idm45941118592744"></a><a data-primary="memory management" data-secondary="memory leaks" data-type="indexterm" id="7_idm45941118592040"></a>The fact that Java supports garbage collection dramatically reduces the
incidence of <em>memory leaks</em>. A memory leak occurs when memory is
allocated and never reclaimed. At first glance, it might seem that
garbage collection prevents all memory leaks because it reclaims all
unused objects.</p>

<p>A memory leak can still occur in Java, however, if a valid (but unused)
reference to an unused object is left hanging around. For example, when
a method runs for a long time (or forever), the local variables in that
method can retain object references much longer than they are actually
required. The following code illustrates:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code> <code class="n">args</code><code class="o">[])</code> <code class="o">{</code>
  <code class="kt">int</code> <code class="n">bigArray</code><code class="o">[]</code> <code class="o">=</code> <code class="k">new</code> <code class="kt">int</code><code class="o">[</code><code class="mi">100000</code><code class="o">];</code>

  <code class="c1">// Do some computations with bigArray and get a result.</code>
  <code class="kt">int</code> <code class="n">result</code> <code class="o">=</code> <code class="n">compute</code><code class="o">(</code><code class="n">bigArray</code><code class="o">);</code>

  <code class="c1">// We no longer need bigArray. It will get garbage collected when</code>
  <code class="c1">// there are no more references to it. Because bigArray is a local</code>
  <code class="c1">// variable, it refers to the array until this method returns. But</code>
  <code class="c1">// this method doesn&apos;t return. So we&apos;ve got to explicitly get rid</code>
  <code class="c1">// of the reference ourselves, so the garbage collector knows it can</code>
  <code class="c1">// reclaim the array.</code>
  <code class="n">bigArray</code> <code class="o">=</code> <code class="kc">null</code><code class="o">;</code>

  <code class="c1">// Loop forever, handling the user&apos;s input</code>
  <code class="k">for</code><code class="o">(;;)</code> <code class="n">handle_input</code><code class="o">(</code><code class="n">result</code><code class="o">);</code>
<code class="o">}</code></pre>

<p>Memory leaks can also occur when you use a <code>HashMap</code> or similar data
structure to associate one object with another. Even when neither
object is required anymore, the association remains in the hash table,
preventing the objects from being reclaimed until the hash table itself
is reclaimed. If the hash table has a substantially longer lifetime than
the objects it holds, this can cause memory leaks.</p>
</div></section>













<section data-pdf-bookmark="Introducing Mark-and-Sweep" data-type="sect2"><div class="sect2" id="idm45941118544120">
<h2>Introducing Mark-and-Sweep</h2>

<p><a data-primary="mark-and-sweep algorithm" data-seealso="Concurrent Mark-and-Sweep (CMS)" data-type="indexterm" id="7_ix_ch06-asciidoc1"></a><a data-primary="memory management" data-secondary="mark-and-sweep algorithm" data-type="indexterm" id="7_ix_ch06-asciidoc2"></a>To explain a basic form of the mark-and-sweep algorithm that appears in the JVM, let鈥檚 assume that there are two basic data structures that the JVM maintains.
These are:</p>
<dl>
<dt>Allocation table</dt>
<dd>
<p><a data-primary="allocation table" data-type="indexterm" id="7_idm45941118538936"></a>Stores references to all objects (and arrays) that have been allocated and not yet collected</p>
</dd>
<dt>Free list</dt>
<dd>
<p><a data-primary="free list" data-type="indexterm" id="7_idm45941118536840"></a>Holds a list of blocks of memory that are free and available for allocation</p>
</dd>
</dl>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>This is a simplified mental model that is purely intended to help the newcomer start thinking about garbage collection. Real production collectors actually work somewhat differently.</p>
</div>

<p>With these definitions it is now obvious when GC must occur; it is required when a Java thread tries to allocate an object (via the <code>new</code> operator) and the free list does not contain a block of sufficient size.
Also note that the JVM keeps track of type information about all allocations and so can figure out which local variables in each stack frame refer to which objects and arrays in the heap.
By following references held by objects and arrays in the heap, the JVM can trace through and find all objects and arrays are still referred to, no matter how indirectly.</p>

<p>Thus, the runtime is able to determine when an allocated object is no
longer referred to by any other active object or variable. When the
interpreter finds such an object, it knows it can safely reclaim the
object鈥檚 memory and does so. Note that the garbage collector can also
detect and reclaim cycles of objects that refer to each other, but are
not referenced by any other active objects.</p>

<p><a data-primary="reachable object" data-type="indexterm" id="7_idm45941118531912"></a>We define a <em>reachable object</em> to be an object that can be reached by
starting from some local variable in one of the methods in the stack
trace of some application thread, and following references until we
reach the object. Objects of this type are also said to be <em>live</em>.<sup><a class="totri-footnote" data-type="noteref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch06.html#idm45941118529992" id="idm45941118529992-marker">1</a></sup></p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>There are a couple other possibilities for where the chain of
references can start, apart from local variables. The general name for
the root of a reference chain leading to a reachable object is a <em>GC
root</em>.</p>
</div>

<p>With these simple definitions, let鈥檚 look at a simple method for
performing garbage collection based on these principles.</p>
</div></section>













<section data-pdf-bookmark="The Basic Mark-and-Sweep Algorithm" data-type="sect2"><div class="sect2" id="idm45941118525640">
<h2>The Basic Mark-and-Sweep Algorithm</h2>

<p>The usual (and simplest) algorithm for the collection process is called
<em>mark-and-sweep</em>. This occurs in three phases:</p>
<ol>
<li>
<p>Iterate through the allocation table, marking each object as <em>dead</em>.</p>
</li>
<li>
<p>Starting from the local variables that point into the heap, follow all references from all objects we reach.
Every time we reach an object or array we haven鈥檛 seen yet, mark it as <em>live</em>.
Keep going until we鈥檝e fully explored all references we can reach from the local variables.</p>
</li>
<li>
<p>Sweep across the allocation table again. For each object not marked as live, reclaim the memory in heap and place it back on the free list.
Remove the object from the allocation table.</p>
</li>

</ol>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The form of mark-and-sweep just outlined is the usual simplest
theoretical form of the algorithm. As we will see in the following
sections, real garbage collectors do more work than this. Instead, this
description is grounded in basic theory and is designed for easy
understanding.</p>
</div>

<p>As all objects are allocated from the allocation table, GC will trigger
before the heap gets full. In this description of mark-and-sweep, GC
requires exclusive access to the entire heap. This is because
application code is constantly running, creating, and changing objects,
which could corrupt the results.</p>

<p>In a real JVM, there will very likely be different areas of heap memory and real programs will make use of all of them in normal operation. In <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch06.html#javanut7-CHP-6-FIG-1">Figure 6-1</a> we show a typical layout of the heap, with two threads (T1 and T2) holding references that point into the heap.</p>

<figure><div class="figure" id="javanut7-CHP-6-FIG-1">
<img alt="JN7 0601" data-mfp-src="/library/view/java-in-a/9781492037248/assets/jns7_0601.png" height="1372" src="https://learning.oreilly.com/library/view/java-in-a/9781492037248/assets/jns7_0601.png" width="1208"/>
<h6><span class="label">Figure 6-1. </span>Heap structure</h6>
</div></figure>

<p>This shows that it would be dangerous to move objects that application threads have references to while the program is running.</p>

<p><a data-primary="stop-the-world (STW) garbage collection" data-type="indexterm" id="7_idm45941118512584"></a>To avoid this, a simple GC like the one just shown will cause a
stop-the-world (STW) pause when it runs鈥攂ecause all application threads
are stopped, then GC occurs, and finally application threads are started
up again. <a data-primary="safepoint" data-type="indexterm" id="7_idm45941118511448"></a>The runtime takes care of this by halting application threads
as they reach a <em>safepoint</em>鈥攆or example, the start of a loop or just before a method call. At these execution points, the runtime knows
that it can stop an application thread without a problem.</p>

<p>These pauses sometimes worry developers, but for most mainstream usages,
Java is running on top of an operating system that is constantly
swapping processes on and off processor cores, so this slight additional
stoppage is usually not a concern. In the HotSpot case, a large amount
of work has been done to optimize GC and to reduce STW times, for those
cases where it is important to an application鈥檚 workload. We will
discuss some of those optimizations in the next section<a data-startref="ix_ch06-asciidoc2" data-type="indexterm" id="7_idm45941118509160"></a><a data-startref="ix_ch06-asciidoc1" data-type="indexterm" id="7_idm45941118508456"></a>.<a data-startref="ix_ch06-asciidoc0" data-type="indexterm" id="7_idm45941118507656"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="How the JVM Optimizes Garbage Collection" data-type="sect1"><div class="sect1" id="idm45941118525080">
<h1>How the JVM Optimizes Garbage Collection</h1>

<p><a data-primary="garbage collection (GC)" data-secondary="JVM&apos;s optimization of" data-type="indexterm" id="7_ix_ch06-asciidoc3"></a><a data-primary="Java Virtual Machine (JVM)" data-secondary="garbage collection optimization by" data-type="indexterm" id="7_ix_ch06-asciidoc4"></a><a data-primary="memory management" data-secondary="JVM&apos;s optimization of garbage collection" data-type="indexterm" id="7_ix_ch06-asciidoc5"></a>The <a data-primary="Young Generation" data-type="indexterm" id="7_idm45941118501608"></a><a data-primary="weak generational hypothesis (WGH)" data-type="indexterm" id="7_idm45941118500904"></a><em>weak generational hypothesis</em> (WGH) is a great example of one
of the runtime facts about software that we introduced in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch01.html#javanut7-CHP-1">Chapter 1</a>. Simply put, it is that objects tend to
have one of a small number of possible life expectancies (referred to
as <span class="keep-together"><em>generations</em></span>).</p>

<p><a data-primary="garbage collection (GC)" data-seealso="memory management" data-type="indexterm" id="7_idm45941118497864"></a>Usually objects are alive for a very short amount of time (sometimes
called transient objects), and then become eligible for garbage
collection. <a data-primary="working set" data-type="indexterm" id="7_idm45941118496600"></a>However, some small fraction of objects live for longer, and
are destined to become part of the longer-term state of the program
(sometimes referred to as the <em>working set</em> of the program). This can
be seen in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch06.html#javanut7-CHP-6-FIG-2">Figure 6-2</a> where we see volume of
memory (or number of objects created) plotted against expected lifetime.</p>

<figure><div class="figure" id="javanut7-CHP-6-FIG-2">
<img alt="JN7 0602" data-mfp-src="/library/view/java-in-a/9781492037248/assets/jns7_0602.png" height="635" src="https://learning.oreilly.com/library/view/java-in-a/9781492037248/assets/jns7_0602.png" width="979"/>
<h6><span class="label">Figure 6-2. </span>Weak generational hypothesis</h6>
</div></figure>

<p>This fact is not deducible from static analysis, and yet when we measure
the runtime behavior of software, we see that it is broadly true across
a wide range of workloads.</p>

<p>The HotSpot JVM has a garbage collection subsystem that is designed
specifically to take advantage of the weak generational hypothesis, and
in this section, we will discuss how these techniques apply to
short-lived objects (which is the majority case). This discussion is
directly applicable to HotSpot, but other server-class JVMs often employ
similar or related techniques.</p>

<p><a data-primary="generational garbage collector" data-type="indexterm" id="7_idm45941118455208"></a>In its simplest form, a <em>generational garbage collector</em> is simply one
that takes notice of the WGH. They take the position that some extra
bookkeeping to monitor memory will be more than paid for by gains
obtained by being friendly to the WGH. In the simplest forms of
generational collector, there are usually just two generations鈥攗sually
referred to as young and old generation.</p>








<section data-pdf-bookmark="Evacuation" data-type="sect2"><div class="sect2" id="idm45941118453416">
<h2>Evacuation</h2>

<p><a data-primary="evacuation" data-type="indexterm" id="7_idm45941118451912"></a><a data-primary="garbage collection (GC)" data-secondary="evacuation" data-type="indexterm" id="7_idm45941118451208"></a>In our original formulation of mark-and-sweep, during the cleanup phase,
we reclaimed individual objects, and returned their space to the free
list. However, if the WGH is true, and on any given GC cycle most
objects are dead, then it may make sense to use an alternative approach
to reclaiming space.</p>

<p>This works by dividing the heap up into separate memory spaces. Then,
on each GC run, we locate only the live objects and move them to a
different space, in a process called <em>evacuation</em>. <a data-primary="evacuating collectors" data-type="indexterm" id="7_idm45941118448824"></a>Collectors that do
this are referred to as <em>evacuating collectors</em>, and they have the property
that the entire memory space can be wiped at the end of the collection,
to be reused again and again.</p>

<p><a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch06.html#javanut7-CHP-6-FIG-3">Figure 6-3</a> shows an evacuating collector in action, with solid blocks representing surviving objects, and hatched boxes representing allocated, but now dead (and unreachable) objects.</p>

<figure><div class="figure" id="javanut7-CHP-6-FIG-3">
<img alt="JN7 0603" data-mfp-src="/library/view/java-in-a/9781492037248/assets/jns7_0603.png" height="659" src="https://learning.oreilly.com/library/view/java-in-a/9781492037248/assets/jns7_0603.png" width="1213"/>
<h6><span class="label">Figure 6-3. </span>Evacuating collectors</h6>
</div></figure>

<p>This is potentially much more efficient than the naive collection
approach, because the dead objects are never touched. GC cycle length is
proportional to the number of live objects, rather than the number of
allocated objects. The only downside is slightly more bookkeeping鈥攚e
have to pay the cost of copying the live objects, but this is almost
always a very small price compared to the huge gains realized by
evacuation strategies.</p>

<p><a data-primary="compacting collector" data-type="indexterm" id="7_idm45941118443000"></a>An alternative to an evacuating collector is a <em>compacting collector</em>.
The chief defining feature of these is that at the end of the collection cycle, allocated memory (i.e., surviving objects) is arranged as a single contiguous area within the collected region.</p>

<p>The normal case is that all the surviving objects have been 鈥渟huffled up鈥?within the memory pool (or region) usually to the start of the memory range and there is now a pointer indicating the start of empty space that is available for objects to be written into once application threads restart.</p>

<p>Compacting collectors will avoid memory fragmentation, but typically are much more expensive in terms of amount of CPU consumed than evacuating collectors.
There are design trade-offs between the two algorithms (the details of which are beyond the scope of this book), but both techniques are used in production collectors in Java (and in many other programming languages).</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>HotSpot manages the JVM heap itself, completely in user space, and does
not need to perform system calls to allocate or free memory. The area
where objects are initially created is usually called Eden or the
Nursery, and most production JVMs (at least in the SE/EE space) will use
an evacuating strategy when collecting Eden.</p>
</div>

<p><a data-primary="per-thread allocation" data-type="indexterm" id="7_idm45941118438216"></a>The use of an evacuating collector also allows the use of per-thread
allocation. This means that each application thread can be given a
<a data-primary="thread-local allocation buffer" data-type="indexterm" id="7_idm45941118437224"></a>contiguous chunk of memory (called a <em>thread-local allocation buffer</em>)
for its exclusive use when allocating new objects. When new objects are
allocated, this only involves bumping a pointer in the allocation
buffer, an extremely cheap operation.</p>

<p>If an object is created just before a collection starts, then it will
not have time to fulfill its purpose and die before the GC cycle starts.
In a collector with only two generations, this short-lived object will
be moved into the long-lived region, almost immediately die, and then
stay there until the next full collection. As these are a lot less
frequent (and typically a lot more expensive), this seems rather
wasteful.</p>

<p><a data-primary="survivor space" data-type="indexterm" id="7_idm45941118434616"></a>To mitigate this, HotSpot has a concept of a <em>survivor space_an area that is used to house objects that have survived from previous
collections of young objects. <a data-primary="tenuring threshold" data-type="indexterm" id="7_idm45941118433336"></a>A surviving object is copied by the
evacuating collector between survivor spaces until a _tenuring
threshold</em> is reached, when the object will be <em>promoted</em> to the old
generation.</p>

<p>A full discussion of survivor spaces and how to tune GC is outside the
scope of this book. For production applications, specialist material
should be consulted.<a data-startref="ix_ch06-asciidoc5" data-type="indexterm" id="7_idm45941118431224"></a><a data-startref="ix_ch06-asciidoc4" data-type="indexterm" id="7_idm45941118430520"></a><a data-startref="ix_ch06-asciidoc3" data-type="indexterm" id="7_idm45941118429848"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="The HotSpot Heap" data-type="sect1"><div class="sect1" id="idm45941118452824">
<h1>The HotSpot Heap</h1>

<p><a data-primary="HotSpot heap" data-type="indexterm" id="7_ix_ch06-asciidoc6"></a><a data-primary="memory management" data-secondary="HotSpot heap" data-type="indexterm" id="7_ix_ch06-asciidoc7"></a>The HotSpot JVM is a relatively complex piece of code, made up of an
interpreter and a just-in-time compiler, as well as a user-space memory
management subsystem. It is composed of a mixture of C, C++, and a
fairly large amount of platform-specific assembly code.</p>

<p>At this point, let鈥檚 summarize our description of the HotSpot heap, and
recap its basic features. The Java heap is a contiguous block of memory,
which is reserved at JVM startup, but only some of the heap is initially
allocated to the various memory pools. As the application runs, memory
pools are resized as needed. These resizes are performed by the GC
subsystem.</p>
<aside class="pagebreak-before" data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45941118424088">
<h5>Objects in the Heap</h5>
<p><a data-primary="HotSpot heap" data-secondary="objects in the heap" data-type="indexterm" id="7_idm45941118422776"></a><a data-primary="objects" data-secondary="in the heap" data-type="indexterm" id="7_idm45941118421800"></a>Objects are created in Eden by application threads, and are removed by
a nondeterministic garbage collection cycle. The GC cycle runs when
necessary (i.e., when memory is getting low). The heap is divided into
two generations, young and old. The young generation is made up of Eden and survivor spaces, whereas the old generation is just one memory space.</p>

<p>After surviving several GC cycles, objects get promoted to the old
generation. Collections that only collect the young generation are
usually very cheap (in terms of computation required). HotSpot uses a
more advanced form of mark-and-sweep than we have seen so far, and is
prepared to do extra bookkeeping to improve GC performance.</p>
</div></aside>

<p>When discussing garbage collectors, there is one other important terminology distinction that developers should know:</p>
<dl>
<dt>Parallel collector</dt>
<dd>
<p><a data-primary="parallel collector" data-type="indexterm" id="7_idm45941118417480"></a>A garbage collector that uses multiple threads to perform collection</p>
</dd>
<dt>Concurrent collector</dt>
<dd>
<p><a data-primary="concurrent collector" data-type="indexterm" id="7_idm45941118415416"></a>A garbage collector that can run at the same time as application
threads are still running</p>
</dd>
</dl>

<p>In the discussion so for, the collection algorithms we have been describing have implicitly all been parallel, but not concurrent, collectors.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>In modern approaches to GC there is a growing trend toward using partially concurrent algorithms.
These types of algorithms are much more elaborate and computationally expensive than STW algorithms and involve trade-offs.
However, they are believed to be a better path forward for today鈥檚 <span class="keep-together">applications</span>.</p>
</div>

<p>Not only that, but in Java version 8 and below, the heap has a simple structure: each memory pool (Eden, survivor spaces, and Tenured) is a contiguous block of memory.
The default collector for these older versions is called <em>Parallel</em>.
However, with the arrival of Java 9, a new collection algorithm known as <em>G1</em> becomes the default.</p>

<p><a data-primary="Garbage First (G1) collector" data-type="indexterm" id="7_idm45941118409704"></a>The Garbage First collector (known as G1) is a new garbage collector that was developed during the life of Java 7 (with some preliminary work done in Java 6).
<a data-primary="Java 8" data-secondary="G1 collector" data-type="indexterm" id="7_idm45941118408728"></a><a data-primary="Java 9" data-secondary="G1 collector" data-type="indexterm" id="7_idm45941118407784"></a>It became production quality and officially fully supported with the release of Java 8 Update 40, and is the default from Java 9 onward (although other collectors are still available as an alternative).</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>G1 uses a different version of the algorithm in each Java version and there are some important differences in terms of performance and other behavior between versions.
It is very important that, when upgrading from Java 8 to a latter version and adopting G1, you undertake a full performance retest.</p>
</div>

<p><a data-primary="region-based collector" data-type="indexterm" id="7_idm45941118404776"></a>G1 has a different heap layout and is an example of a <em>region-based collector</em>.
A region is an area of memory (usually 1M in size, but larger heaps may have regions of 2, 4, 8, 16, or 32M in size) where all the objects belong to the same memory pool.
However, in a regional collector, the different regions that make up a pool are not necessarily located next to each other in memory.
This is unlike the Java 8 heap, where each pool is contiguous, although in both cases the entire heap remains contiguous.</p>

<p>G1 focuses its attention on regions that are mostly garbage, as they have the best free memory recovery.
<a data-primary="incremental compaction" data-type="indexterm" id="7_idm45941118402504"></a>It is an evacuating collector, and does <em>incremental compaction</em> when evacuating individual regions.</p>

<p>G1 was orignally designed to take over from a previous collector, CMS, as the low-pause collector, <a data-primary="pause goals" data-type="indexterm" id="7_idm45941118400696"></a>and it allows the user to specify <em>pause goals</em> in terms of how long and how often to pause for when doing GC.</p>

<p>The JVM provides a command-line switch that controls how long the collector will aim to pause for: <code>-XX:MaxGCPauseMillis=200</code>.
This means that the default pause time goal is 200ms, but you can change this value depending on your needs.</p>

<p>There are, of course, limits to how far the collector can be pushed.
Java GC is driven by the rate at which new memory is allocated, which can be highly unpredictable for many Java applications.
This can limit G1鈥檚 ability to meet the user鈥檚 pause goals, and in practice, pause times under &lt;100ms are hard to achieve reliably.</p>

<p>As noted, G1 was origially intended to be a replacement low-pause collector.
However, the overall characteristics of its behavior have meant that it has actually evolved into a more general-purpose collector (which is why it has now become the default).</p>

<p>Note that the development of a new production-grade collector that is suitable for general use is not a quick process.
In the next section, let鈥檚 move on to discuss the alternative collectors that are provided by HotSpot (including the parallel collector of Java 8).</p>








<section data-pdf-bookmark="Other Collectors" data-type="sect2"><div class="sect2" id="idm45941118395976">
<h2>Other Collectors</h2>

<p>This section is completely HotSpot-specific, and a detailed treatment is
outside the scope of the book, but it is worth knowing about the
existence of alternate collectors. For non-HotSpot users, you should
consult your JVM鈥檚 documentation to see what options may be available
for you.</p>
</div></section>













<section data-pdf-bookmark="ParallelOld" data-type="sect2"><div class="sect2" id="idm45941118394088">
<h2>ParallelOld</h2>

<p><a data-primary="garbage collection (GC)" data-secondary="ParallelOld collector" data-type="indexterm" id="7_idm45941118392712"></a><a data-primary="HotSpot heap" data-secondary="ParallelOld collector" data-type="indexterm" id="7_idm45941118391736"></a><a data-primary="ParallelOld collector" data-type="indexterm" id="7_idm45941118390792"></a>By default, in Java 8 the collector for the old generation is a parallel (but not concurrent) mark-and-sweep collector.
It seems, at first glance, to be similar to the collector used for the young generation.
However, it differs in one very important respect: it is <em>not</em> an evacuating collector.
Instead, the old generation is compacted when collection occurs.
This is important so that the memory space does not become fragmented over the course of time.</p>

<p>The <code>ParallelOld</code> collector is very efficient, but it has two properties that make it less desirable for modern applications. It is:</p>

<ul>
<li>
<p>Fully STW</p>
</li>
<li>
<p>Linear in pause time with the size of the heap</p>
</li>
</ul>

<p>This means that once GC has started, it cannot be aborted early and the cycle must be allowed to finish.
As heap sizes increase, this makes <code>ParallelOld</code> a less attractive option than G1, which can keep a constant pause time regardless of heap size (assuming the allocation rate is manageable).</p>

<p>At the time of writing, G1 gives acceptable performance on a large majority of applications that previously used <code>ParallelOld</code>鈥攁nd in many cases will perform better.
The <code>ParallelOld</code> collector is still available as of Java 11, for those (hopefully few) apps that still need it, but the direction of the platform is clear鈥攁nd it is toward using G1 wherever possible.</p>










<section data-pdf-bookmark="Concurrent Mark-and-Sweep" data-type="sect3"><div class="sect3" id="idm45941118382824">
<h3>Concurrent Mark-and-Sweep</h3>

<p><a data-primary="Concurrent Mark-and-Sweep (CMS)" data-type="indexterm" id="7_idm45941118381432"></a><a data-primary="HotSpot heap" data-secondary="Concurrent Mark-and-Sweep" data-type="indexterm" id="7_idm45941118380664"></a>The most widely used alternate collector in HotSpot is Concurrent
Mark-and-Sweep (CMS). This collector is only used to collect the old
generation鈥攊t is used in conjunction with a parallel collector that is
responsible for cleaning up the young generation.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>CMS is designed for use <em>only</em> in low-pause applications, those that
cannot deal with a stop-the-world pause of more than a few milliseconds.
This is a surprisingly small class鈥攙ery few applications outside of
financial trading have a genuine need for this requirement.</p>
</div>

<p>CMS is a complex collector, and often difficult to tune effectively. It
can be a very useful tool in the developer鈥檚 armory, but should not be
deployed lightly or blindly. It has the following basic properties that you
should be aware of, but a full discussion of CMS is beyond the scope of
this book. Interested readers should consult specialist blogs and
mailing lists (e.g., the 鈥淔riends of jClarity鈥?mailing list quite often
deals with GC-performance-related questions).</p>

<ul>
<li>
<p>CMS only collects the old generation.</p>
</li>
<li>
<p>CMS runs alongside application threads for most of the GC cycle,
reducing pauses.</p>
</li>
<li>
<p>Application threads don鈥檛 have to stop for as long.</p>
</li>
<li>
<p>It has six phases, all designed to minimize STW pause times.</p>
</li>
<li>
<p>It replaces main STW pause with two (usually very short) STW pauses.</p>
</li>
<li>
<p>It uses considerably more bookkeeping and lots more CPU time.</p>
</li>
<li>
<p>GC cycles overall take much longer.</p>
</li>
<li>
<p>By default, half of CPUs are used for GC when running concurrently.</p>
</li>
<li>
<p>It should not be used except for low-pause applications.</p>
</li>
<li>
<p>It definitely should not be used for applications with high-throughput
requirements.</p>
</li>
<li>
<p>It does not compact, and in cases of high fragmentation will fall back to
the default (parallel) collector.</p>
</li>
</ul>

<p>Finally, HotSpot also has a Serial collector (and SerialOld collector) and a
collector known as 鈥淚ncremental CMS.鈥?These collectors are all
considered deprecated and should not be used.<a data-startref="ix_ch06-asciidoc7" data-type="indexterm" id="7_idm45941118365208"></a><a data-startref="ix_ch06-asciidoc6" data-type="indexterm" id="7_idm45941118364504"></a></p>
</div></section>



</div></section>





</div></section>













<section data-pdf-bookmark="Finalization" data-type="sect1"><div class="sect1" id="javanut7-CHP-6-SECT-4">
<h1>Finalization</h1>

<p><a data-primary="finalization (resource management technique)" data-type="indexterm" id="7_ix_ch06-asciidoc8"></a><a data-primary="memory management" data-secondary="finalization" data-type="indexterm" id="7_ix_ch06-asciidoc9"></a>There is one old technique for resource management known as
<em>finalization</em> that the developer should be aware of. However, this
technique is extremely heavily deprecated and the vast majority of Java
developers should <em>not</em> directly use it under any circumstances.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Finalization has only a very small number of legitimate use cases, and
only a tiny minority of Java developers will ever encounter them. If in any
doubt, do not use finalization鈥?code&gt;try</code>-with-resources is usually the
correct alternative.</p>
</div>

<p>The finalization mechanism was intended to automatically release
resources once they are no longer needed. Garbage collection
automatically frees up the memory resources used by objects, but objects
can hold other kinds of resources, such as open files and network
connections. The garbage collector cannot free these additional
resources for you, so the finalization mechanism was intended to allow
the developer to perform cleanup tasks as closing files, terminating
network connections, deleting temporary files, and so on.</p>

<p><a data-primary="finalize()" data-type="indexterm" id="7_ix_ch06-asciidoc10"></a>The finalization mechanism works as follows: if an object has a
<code>finalize()</code> method (usually called a <em>finalizer</em>), this is invoked
some time after the object becomes unused (or unreachable) but before the
garbage collector reclaims the space allocated to the object. The
finalizer is used to perform resource cleanup for an object.</p>

<p>In Oracle/OpenJDK the technique used is as follows:</p>
<ol>
<li>
<p>When a finalizable object is no longer reachable, a reference to it
is placed on an internal <em>finalization queue</em> and the object is marked,
and considered live for the purposes of the GC run.</p>
</li>
<li>
<p>One by one, objects on the finalization queue are removed and their
<code>finalize()</code> methods are invoked.</p>
</li>
<li>
<p>After a finalizer is invoked, the object is not freed right away.
This is because a finalizer method could resurrect the object by storing
the <code>this</code> reference somewhere (for example, in a public static field on
some class) so that the object once again has references.</p>
</li>
<li>
<p>Therefore, after <code>finalize()</code> has been called, the garbage
collection subsytem must redetermine that the object is unreachable
before it can be garbage <span class="keep-together">collected</span>.</p>
</li>
<li>
<p>However, even if an object is resurrected, the finalizer method is
never invoked more than once.</p>
</li>
<li>
<p>All of this means that objects with a <code>finalize()</code> will usually
survive for (at least) one extra GC cycle (and if they鈥檙e long-lived,
that means one extra full GC).</p>
</li>

</ol>

<p>The central problem with finalization is that Java makes no guarantees
about when garbage collection will occur or in what order objects will
be collected. Therefore, the platform can make no guarantees about when
(or even whether) a finalizer will be invoked or in what order
finalizers will be invoked.</p>








<section data-pdf-bookmark="Finalization Details" data-type="sect2"><div class="sect2" id="idm45941118342760">
<h2>Finalization Details</h2>

<p>For the few use cases where finalization is appropriate, we include some
additional details and caveats:</p>

<ul>
<li>
<p>The JVM can exit without garbage collecting all outstanding objects,
so some finalizers may never be invoked. In this case, resources such as
network connections are closed and reclaimed by the operating system.
Note, however, that if a finalizer that deletes a file does not run,
that file will not be deleted by the operating system.</p>
</li>
<li>
<p><a data-primary="Runtime::addShutdownHook" data-type="indexterm" id="7_idm45941118338568"></a>To ensure that certain actions are taken before the VM exits, Java
provides <code>Runtime::addShutdownHook</code>鈥攊t can safely execute arbitrary code
before the JVM exits.</p>
</li>
<li>
<p>The <code>finalize()</code> method is an instance method, and finalizers act on
instances. There is no equivalent mechanism for finalizing a class.</p>
</li>
<li>
<p>A finalizer is an instance method that takes no arguments and returns
no value. There can be only one finalizer per class, and it must be
named <code>finalize()</code>.</p>
</li>
<li>
<p>A finalizer can throw any kind of exception or error, but when a
finalizer is automatically invoked by the garbage collection subsystem,
any exception or error it throws is ignored and serves only to cause the
finalizer method to return.</p>
</li>
</ul>

<p>The finalization mechanism is an attempt to implement a similar concept present in other languages and environments.
In particular, C++ has a pattern known as RAII (Resource Acquisition Is Initialization) that provides automatic resource management in a similar way.
In that pattern, a destructor method (which would be called <code>finalize()</code> in Java) is provided by the programmer, to perform cleanup and release of resources when the object is destroyed.</p>

<p>The basic use case for this is fairly simple: when an object is created, it takes ownership of some resource, and the object鈥檚 ownership of that resource is tied to the lifetime of the object.
When the object dies, the ownership of the resource is automatically relinquished, as the platform calls the destructor without any programmer intervention.</p>

<p>While finalization superficially sounds similar to this mechanism, in reality it is fundamentally different.
In fact, the finalization language feature is fatally flawed, due to differences in the memory management schemes of Java versus C++.</p>

<p>In the C++ case, memory is handled manually, with explicit lifetime management of objects under the control of the programmer.
This means that the destructor can be called immediately after the object is deleted (the platform guarantees this), and so the acquisition and release of resources is directly tied to the lifetime of the object.</p>

<p>On the other hand, Java鈥檚 memory management subsystem is a garbage collector that runs as needed, in response to running out of available memory to allocate.
It therefore runs at variable (and nondeterministic) intervals and so  <code>finalize()</code> is run only when the object is collected, and this will be at an unknown time.</p>

<p>If the <code>finalize()</code> mechanism was used to automatically release resources (e.g., filehandles), then there is no guarantee as to when (if ever) those resources will actually become available.
This has the result of making the finalization mechanism fundamentally unsuitable for its stated purpose鈥攁utomatic resource management.
We cannot guarantee that finalization will happen fast enough to prevent us from running out of resources.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>An automatic cleanup mechanism for protecting scarce resources (such as filehandles), finalization is broken by design.</p>
</div>

<p>The only real use case for a finalizer is the case of a class with native methods, holding open some non-Java resource.
Even here, the block-structured approach of <code>try</code>-with-resources is preferable, but it can make sense to also declare a <code>public native finalize()</code> (which would be called by the <code>close()</code> method); this would release native resources, including off-heap memory that is not under the control of the Java garbage collector.
This would enable the finalization mechanism to act as a 鈥淗ail Mary鈥?protection in case a programmer fails to call <code>close()</code>.
However, even here, TWR provides a better mechanism and automatic support for block-structured code<a data-startref="ix_ch06-asciidoc10" data-type="indexterm" id="7_idm45941118323000"></a>.<a data-startref="ix_ch06-asciidoc9" data-type="indexterm" id="7_idm45941118322168"></a><a data-startref="ix_ch06-asciidoc8" data-type="indexterm" id="7_idm45941118321464"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Java鈥檚 Support for Concurrency" data-type="sect1"><div class="sect1" id="javanut7-CHP-6-SECT-5">
<h1>Java鈥檚 Support for Concurrency</h1>

<p><a data-primary="concurrency" data-secondary="Java&apos;s support for" data-type="indexterm" id="7_ix_ch06-asciidoc11"></a>The idea of <a data-primary="threads" data-seealso="concurrency" data-type="indexterm" id="7_idm45941118317752"></a>a <em>thread</em> is that of a lightweight unit of
execution鈥攕maller than a process, but still capable of executing
arbitrary Java code. The usual way that this is implemented is for each
thread to be a fully fledged unit of execution to the operating system
but to belong to a process, with the address space of the process being
shared between all threads comprising that process. This means that each
thread can be scheduled independently and has its own stack and program
counter but shares memory and objects with other threads in the same
process.</p>

<p>The Java platform has had support for multithreaded programming from the
very first version. The platform exposes the ability to create new
threads of execution to the developer.</p>

<p>To understand this, first we must consider what happens in detail when a Java program starts up and the <a data-primary="main thread" data-type="indexterm" id="7_idm45941118314488"></a>original application thread (usually referred to as <em>main</em> thread) appears:</p>
<ol>
<li>
<p>The programmer executes <code>java Main</code>.</p>
</li>
<li>
<p>This causes the Java Virtual Machine, the context within which all Java programs run, to start up.</p>
</li>
<li>
<p>The JVM examines its arguments, and sees that the programmer has requested execution starting at the entry point (the <code>main()</code> method) of <code>Main.class</code>.</p>
</li>
<li>
<p>Assuming that <code>Main</code> passes classloading checks, a dedicated thread for the execution of the program is started (main thread).</p>
</li>
<li>
<p>The JVM bytecode interpreter is started on main thread.</p>
</li>
<li>
<p>Main thread鈥檚 interpreter reads the bytecode of <code>Main::main()</code> and execution begins, one bytecode at a time.</p>
</li>

</ol>

<p>Every Java program starts this way, but this also means that:</p>

<ul>
<li>
<p>Every Java program starts as part of a managed model with one interpreter per thread.</p>
</li>
<li>
<p>The JVM has a certain ability to control a Java application thread.</p>
</li>
</ul>

<p>Following on from this, when we create new threads of execution in Java code, this is usually as simple as:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Thread</code> <code class="n">t</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Thread</code><code class="o">(()</code> <code class="o">-&gt;</code> <code class="o">{</code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Hello Thread</code><code class="o">);});</code>
<code class="n">t</code><code class="o">.</code><code class="na">start</code><code class="o">();</code></pre>

<p>This small piece of code creates and starts a new thread, which executes
the body of the lambda expression and then executes.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>For programmers coming from older versions of Java, the lambda is effectively being converted to an instance of the <code>Runnable</code> interface before being passed to the <code>Thread</code> <span class="keep-together">constructor</span>.</p>
</div>

<p>The threading mechanism allows new threads to execute concurrently with
the original application thread and the threads that the JVM itself
starts up for various purposes.</p>

<p>For mainstream implementations of the Java platform, every time we call <code>Thread::start()</code> this call is delegated to the operating system, and a new OS thread is created.
This new OS thread <code>exec()</code>鈥檚 a new copy of the JVM bytecode interpreter.
The interpreter starts executing at the <code>run()</code> method (or, equivalently, at the body of the lambda).</p>

<p>This means that application threads have their access to the CPU controlled by the operating system <em>scheduler</em>鈥攁 built-in part of the OS that is responsible for managing timeslices of processor time (and that will not allow an application thread to exceed its allocated time).</p>

<p><a data-primary="runtime-managed concurrency" data-type="indexterm" id="7_idm45941118272072"></a>In more recent versions of Java, an increasing trend toward
<em>runtime-managed concurrency</em> has appeared. This is the idea that for
many purposes it鈥檚 not desirable for developers to explicitly manage threads. Instead, the runtime should provide 鈥渇ire and forget鈥?
capabilities, whereby the program specifies what needs to be done, but
the low-level details of how this is to be accomplished are left to the
runtime.</p>

<p><a data-primary="java.util.concurrent" data-type="indexterm" id="7_idm45941118270280"></a>This viewpoint can be seen in the concurrency toolkit contained in
<code>java.util.concurrent</code>, a full discussion of which is outside the scope
of this book. The interested reader should refer to <em>Java Concurrency in
Practice</em> by Brian Goetz et al. (Addison-Wesley).</p>

<p>For the remainder of this chapter, we will introduce the low-level
concurrency mechanisms that the Java platform provides, and that every
Java developer should be aware of.</p>








<section data-pdf-bookmark="Thread Lifecycle" data-type="sect2"><div class="sect2" id="javanut7-CHP-6-SECT-5.1">
<h2>Thread Lifecycle</h2>

<p><a data-primary="concurrency" data-secondary="thread lifecycle" data-type="indexterm" id="7_ix_ch06-asciidoc12"></a><a data-primary="threads" data-secondary="lifecycle of" data-type="indexterm" id="7_ix_ch06-asciidoc13"></a>Let鈥檚 start by looking at the lifecycle of an application thread.
Every operating system has a view of threads that can differ in the
details (but in most cases is broadly similar at a high level). Java
tries hard to abstract these details away, and has an enum called
<a data-primary="Thread.State" data-type="indexterm" id="7_idm45941118263016"></a><code>Thread.State</code>, which wrappers over the operating system鈥檚 view of the
thread鈥檚 state. The values of <code>Thread.State</code> provide an overview of the
lifecycle of a thread:</p>
<dl>
<dt><code>NEW</code></dt>
<dd>
<p>The thread has been created, but its <code>start()</code> method has not yet been
called. All threads start in this state.</p>
</dd>
<dt><code>RUNNABLE</code></dt>
<dd>
<p>The thread is running or is available to run when the operating system
schedules it.</p>
</dd>
<dt><code>BLOCKED</code></dt>
<dd>
<p>The thread is not running because it is waiting to acquire a lock so
that it can enter a <code>synchronized</code> method or block. We鈥檒l see more
about <code>synchronized</code> methods and blocks later in this section.</p>
</dd>
<dt><code>WAITING</code></dt>
<dd>
<p>The thread is not running because it has called <code>Object.wait()</code> or
<code>Thread.join()</code>.</p>
</dd>
<dt><code>TIMED_WAITING</code></dt>
<dd>
<p>The thread is not running because it has called <code>Thread.sleep()</code> or
has called <code>Object.wait()</code> or <code>Thread.join()</code> with a timeout value.</p>
</dd>
<dt><code>TERMINATED</code></dt>
<dd>
<p>The thread has completed execution. Its <code>run()</code> method has exited
normally or by throwing an exception.</p>
</dd>
</dl>

<p>These states represent the view of a thread that is common (at least
across mainstream operating systems), leading to a view like that in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch06.html#javanut7-CHP-6-FIG-4">Figure 6-4</a>.</p>

<figure><div class="figure" id="javanut7-CHP-6-FIG-4">
<img alt="JN7 0604" data-mfp-src="/library/view/java-in-a/9781492037248/assets/jns7_0604.png" height="832" src="https://learning.oreilly.com/library/view/java-in-a/9781492037248/assets/jns7_0604.png" width="1430"/>
<h6><span class="label">Figure 6-4. </span>Thread lifecycle</h6>
</div></figure>

<p><a data-primary="Thread.sleep()" data-type="indexterm" id="7_idm45941118221464"></a>Threads can also be made to sleep, by using the <code>Thread.sleep()</code>
method. This takes an argument in milliseconds, which indicates how
long the thread would like to sleep for, like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">try</code> <code class="o">{</code>
    <code class="n">Thread</code><code class="o">.</code><code class="na">sleep</code><code class="o">(</code><code class="mi">2000</code><code class="o">);</code>
<code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">InterruptedException</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>
    <code class="n">e</code><code class="o">.</code><code class="na">printStackTrace</code><code class="o">();</code>
<code class="o">}</code></pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The argument to sleep is a request to the operating system, not a
demand. For example, your program may sleep for longer than requested,
depending on load and other factors specific to the runtime environment.</p>
</div>

<p>We will discuss the other methods of <code>Thread</code> later in this chapter, but
first we need to cover some important theory that deals with how threads
access memory, and that is fundamental to understanding why
multithreaded programming is hard and can cause developers a lot of
problems.<a data-startref="ix_ch06-asciidoc13" data-type="indexterm" id="7_idm45941118191672"></a><a data-startref="ix_ch06-asciidoc12" data-type="indexterm" id="7_idm45941118191080"></a></p>
</div></section>













<section data-pdf-bookmark="Visibility and Mutability" data-type="sect2"><div class="sect2" id="idm45941118267304">
<h2>Visibility and Mutability</h2>

<p><a data-primary="concurrency" data-secondary="visibility and mutability" data-type="indexterm" id="7_idm45941118189032"></a><a data-primary="mutability" data-secondary="concurrency and" data-type="indexterm" id="7_idm45941118188088"></a><a data-primary="visibility" data-secondary="concurrency and" data-type="indexterm" id="7_idm45941118187144"></a>In mainstream Java implementations, all Java application threads in a
process have their own call stacks (and local variables) but share a
single heap. This makes it very easy to share objects between threads,
as all that is required is to pass a reference from one thread to
another. This is illustrated in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch06.html#javanut7-CHP-6-FIG-5">Figure 6-5</a>.</p>

<p><a data-primary="visibility" data-secondary="defined" data-type="indexterm" id="7_idm45941118184664"></a>This leads to a general design principle of Java鈥攖hat objects are
<em>visible by default</em>. If I have a reference to an object, I can copy it
and hand it off to another thread with no restrictions. A Java reference
is essentially a typed pointer to a location in memory鈥攁nd threads share
the same address space, so visible by default is a natural model.</p>

<p><a data-primary="mutability" data-secondary="defined" data-type="indexterm" id="7_idm45941118182600"></a>In addition to visible by default, Java has another property that is
important to fully understand concurrency, which is that objects are
<em>mutable</em>鈥攖he contents of an object instance鈥檚 fields can usually be
changed. We can make individual variables or references constant by
using the <code>final</code> keyword, but this does not apply to the contents of
the object.</p>

<p>As we will see throughout the rest of this chapter, the combination of
these two properties鈥攙isibility across threads and object
mutability鈥攇ives rise to a great many complexities when trying to reason
about concurrent Java programs.</p>

<figure><div class="figure" id="javanut7-CHP-6-FIG-5">
<img alt="JN7 0605" data-mfp-src="/library/view/java-in-a/9781492037248/assets/jns7_0605.png" height="1208" src="https://learning.oreilly.com/library/view/java-in-a/9781492037248/assets/jns7_0605.png" width="1041"/>
<h6><span class="label">Figure 6-5. </span>Shared memory between threads</h6>
</div></figure>










<section data-pdf-bookmark="Concurrent safety" data-type="sect3"><div class="sect3" id="idm45941118177608">
<h3>Concurrent safety</h3>

<p><a data-primary="concurrency" data-secondary="safety" data-type="indexterm" id="7_idm45941118176168"></a><a data-primary="concurrent safety" data-type="indexterm" id="7_idm45941118175192"></a><a data-primary="safety" data-secondary="concurrent" data-type="indexterm" id="7_idm45941118174520"></a>If we鈥檙e to write correct multithreaded code, then we want our programs
to satisfy a certain important property.</p>

<p>In <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch05.html#javanut7-CHP-5">Chapter 5</a>, we defined a safe object-oriented
program to be one where we move objects from legal state to legal
state by calling their accessible methods. This definition works well
for single-threaded code. However, there is a particular difficulty that
comes about when we try to extend it to concurrent programs.</p>
<div data-type="tip"><h6>Tip</h6>
<p><a data-primary="safe multithreaded program" data-type="indexterm" id="7_idm45941118170904"></a>A <em>safe multithreaded program</em> is one in which it is impossible for
any object to be seen in an illegal or inconsistent state by any
another object, no matter what methods are called, and no matter in what order the application threads are scheduled by the operating system.</p>
</div>

<p>For most mainstream cases, the operating system will schedule threads to
run on particular processor cores at seemingly random times, depending on load
and what else is running in the system. If load is high, then there may
be other processes that also need to run.</p>

<p>The operating system will forcibly remove a Java thread from a CPU core
if it needs to. The thread is suspended immediately, no matter what it鈥檚
doing鈥攊ncluding being partway through a method. However, as we discussed
in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch05.html#javanut7-CHP-5">Chapter 5</a>, a method can temporarily put an
object into an illegal state while it is working on it, providing it
corrects it before the method exits.</p>

<p>This means that if a thread is swapped off before it has completed a
long-running method, it may leave an object in an inconsistent state,
<em>even if the program follows the safety rules</em>. Another way of saying
this is that even data types that have been correctly modeled for the
single-threaded case still need to protect against the effects of
concurrency. Code that adds on this extra layer of protection is
called <em>concurrently safe</em>, or (more informally) threadsafe.</p>

<p>In the next section, we鈥檒l discuss the primary means of achieving this
safety, and at the end of the chapter, we鈥檒l meet some other mechanisms
that can also be useful under some circumstances.</p>
</div></section>



</div></section>













<section data-pdf-bookmark="Exclusion and Protecting State" data-type="sect2"><div class="sect2" id="idm45941118145544">
<h2>Exclusion and Protecting State</h2>

<p><a data-primary="concurrency" data-secondary="exclusion and protecting state" data-type="indexterm" id="7_ix_ch06-asciidoc14"></a><a data-primary="exclusion, protecting state with" data-type="indexterm" id="7_ix_ch06-asciidoc15"></a><a data-primary="state, exclusion and" data-type="indexterm" id="7_ix_ch06-asciidoc16"></a>Any code that modifies <em>or reads</em> state that can become inconsistent
must be protected. To achieve this, the Java platform provides only one
mechanism: <em>exclusion</em>.</p>

<p>Consider a method that contains a sequence of operations that, if
interrupted partway through, could leave an object in an inconsistent or
illegal state. If this illegal state was visible to another object,
incorrect code behavior could occur.</p>

<p>For example, consider an ATM or other cash-dispensing machine:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">Account</code> <code class="o">{</code>
    <code class="kd">private</code> <code class="kt">double</code> <code class="n">balance</code> <code class="o">=</code> <code class="mf">0.0</code><code class="o">;</code> <code class="c1">// Must be &gt;= 0</code>
    <code class="c1">// Assume the existence of other field (e.g., name) and methods</code>
    <code class="c1">// such as deposit(), checkBalance(), and dispenseNotes()</code>

    <code class="kd">public</code> <code class="nf">Account</code><code class="o">(</code><code class="kt">double</code> <code class="n">openingBal</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">balance</code> <code class="o">=</code> <code class="n">openingBal</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">boolean</code> <code class="nf">withdraw</code><code class="o">(</code><code class="kt">double</code> <code class="n">amount</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">if</code> <code class="o">(</code><code class="n">balance</code> <code class="o">&gt;=</code> <code class="n">amount</code><code class="o">)</code> <code class="o">{</code>
            <code class="k">try</code> <code class="o">{</code>
                <code class="n">Thread</code><code class="o">.</code><code class="na">sleep</code><code class="o">(</code><code class="mi">2000</code><code class="o">);</code> <code class="c1">// Simulate risk checks</code>
            <code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">InterruptedException</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>
                <code class="k">return</code> <code class="kc">false</code><code class="o">;</code>
            <code class="o">}</code>
            <code class="n">balance</code> <code class="o">=</code> <code class="n">balance</code> <code class="o">-</code> <code class="n">amount</code><code class="o">;</code>
            <code class="n">dispenseNotes</code><code class="o">(</code><code class="n">amount</code><code class="o">);</code>
            <code class="k">return</code> <code class="kc">true</code><code class="o">;</code>
        <code class="o">}</code>
        <code class="k">return</code> <code class="kc">false</code><code class="o">;</code>
    <code class="o">}</code>
<code class="o">}</code></pre>

<p>The sequence of operations that happens inside <code>withdraw()</code> can leave
the object in an inconsistent state. In particular, after we鈥檝e checked
the balance, a second thread could come in while the first was sleeping
in simulated risk checks, and the account could be overdrawn, in
violation of the constraint that <code>balance &gt;= 0</code>.</p>

<p>This is an example of a system where the operations on the objects are
single-threaded safe--(because the objects cannot reach an illegal state
(<code>balance &lt; 0</code>) if called from a single thread)--but not concurrently
safe.</p>

<p><a data-primary="synchronized keyword" data-type="indexterm" id="7_ix_ch06-asciidoc17"></a>To allow the developer to make code like this concurrently safe, Java
provides the <code>synchronized</code> keyword. This keyword can be applied to a
block or to a method, and when it is used, the platform uses it to
restrict access to the code inside the block or method.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Because <code>synchronized</code> surrounds code, many developers are led to the
conclusion that concurrency in Java is about code. Some texts even refer
to the code that is inside the synchronized block or method as a
<em>critical section</em> and consider that to be the crucial aspect of
concurrency. This is not the case; instead, it is the inconsistency of
data that we must guard against, as we will see.</p>
</div>

<p><a data-primary="monitor token" data-type="indexterm" id="7_idm45941118051208"></a>The Java platform keeps track of a special token, called a <em>monitor</em>,
for every object that it ever creates. These monitors (also called
<em>locks</em>) are used by <code>synchronized</code> to indicate that the following code
could temporarily render the object inconsistent. The sequence of
events for a synchronized block or method is:</p>
<ol>
<li>
<p>Thread needs to modify an object and may make it briefly
inconsistent as an intermediate step</p>
</li>
<li>
<p>Thread acquires the monitor, indicating it requires temporary
exclusive access to the object</p>
</li>
<li>
<p>Thread modifies the object, leaving it in a consistent, legal state
when done</p>
</li>
<li>
<p>Thread releases the monitor</p>
</li>

</ol>

<p>If another thread attempts to acquire the lock while the object is being
modified, then the attempt to acquire the lock blocks, until the holding
thread releases the lock.</p>

<p>Note that you do not have to use the <code>synchronized</code> statement unless
your program creates multiple threads that share data. If only one
thread ever accesses a data structure, there is no need to protect it
with <code>synchronized</code>.</p>

<p>One point is of critical importance鈥攁cquiring the monitor does
<em>not</em> prevent access to the object. It only prevents any other thread
from claiming the lock. Correct concurrently safe code requires
developers to ensure that all accesses that might modify <em>or read</em>
potentially inconsistent state acquire the object monitor before
operating on or reading that state.</p>

<p>Put another way, if a <code>synchronized</code> method is working on an object and
has placed it into an illegal state, and another method (which is not
synchronized) reads from the object, it can still see the inconsistent
state.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Synchronization is a cooperative mechanism for protecting state and it
is very fragile as a result. A single bug (such as missing a single
<code>synchronized</code> keyword from a method it鈥檚 required on) can have
catastrophic results for the safety of the system as a whole.</p>
</div>

<p>The reason we use the word <code>synchronized</code> as the keyword for 鈥渞equires
temporary exclusive access鈥?is that in addition to acquiring the
monitor, the JVM also rereads the current state of the object from main
memory when the block is entered. Similarly, when the <code>synchronized</code>
block or method is exited, the JVM flushes any modified state of the
object back to main memory.</p>

<p>Without synchronization, different CPU cores in the system may not see
the same view of memory, and memory inconsistencies can damage the state
of a running program, as we saw in our ATM example.</p>

<p>The simplest example of this is known as <em>lost update</em>, as demonstrated in the following code:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">Counter</code> <code class="o">{</code>
    <code class="kd">private</code> <code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code>

    <code class="kd">public</code> <code class="kt">int</code> <code class="nf">increment</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">i</code> <code class="o">=</code> <code class="n">i</code> <code class="o">+</code> <code class="mi">1</code><code class="o">;</code>
    <code class="o">}</code>

<code class="o">}</code></pre>

<p>This can be driven via a simple control program:</p>

<pre data-code-language="java" data-type="programlisting">    <code class="n">Counter</code> <code class="n">c</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Counter</code><code class="o">();</code>
    <code class="kt">int</code> <code class="n">REPEAT</code> <code class="o">=</code> <code class="mi">10_000_000</code><code class="o">;</code>
    <code class="n">Runnable</code> <code class="n">r</code> <code class="o">=</code> <code class="o">()</code> <code class="o">-&gt;</code> <code class="o">{</code>
        <code class="k">for</code> <code class="o">(</code><code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code> <code class="n">i</code> <code class="o">&lt;</code> <code class="n">REPEAT</code><code class="o">;</code> <code class="n">i</code><code class="o">++)</code> <code class="o">{</code>
            <code class="n">c</code><code class="o">.</code><code class="na">increment</code><code class="o">();</code>
        <code class="o">}</code>
    <code class="o">};</code>
    <code class="n">Thread</code> <code class="n">t1</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Thread</code><code class="o">(</code><code class="n">r</code><code class="o">);</code>
    <code class="n">Thread</code> <code class="n">t2</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Thread</code><code class="o">(</code><code class="n">r</code><code class="o">);</code>

    <code class="n">t1</code><code class="o">.</code><code class="na">start</code><code class="o">();</code>
    <code class="n">t2</code><code class="o">.</code><code class="na">start</code><code class="o">();</code>
    <code class="n">t1</code><code class="o">.</code><code class="na">join</code><code class="o">();</code>
    <code class="n">t2</code><code class="o">.</code><code class="na">join</code><code class="o">();</code>

    <code class="kt">int</code> <code class="n">anomaly</code> <code class="o">=</code> <code class="o">(</code><code class="mi">2</code> <code class="o">*</code> <code class="n">REPEAT</code> <code class="o">+</code> <code class="mi">1</code><code class="o">)</code> <code class="o">-</code> <code class="n">c</code><code class="o">.</code><code class="na">increment</code><code class="o">();</code>
    <code class="kt">double</code> <code class="n">perc</code> <code class="o">=</code> <code class="o">((</code><code class="n">anomaly</code> <code class="o">+</code> <code class="mf">0.0</code><code class="o">)</code> <code class="o">*</code> <code class="mi">100</code><code class="o">)</code> <code class="o">/</code> <code class="o">(</code><code class="mi">2</code> <code class="o">*</code> <code class="n">REPEAT</code><code class="o">);</code>
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Lost updates: </code><code class="o">+</code> <code class="n">anomaly</code> <code class="o">+</code><code class="s"> ; % = </code> <code class="o">+</code> <code class="n">perc</code><code class="o">);</code></pre>

<p>If this concurrent program was correct, then the value for lost update should be exactly zero.
It is not, and so we may conclude that unsynchronized access is fundamentally unsafe.</p>

<p>By contrast, we also see that the addition of the keyword <code>synchronized</code> to the increment method is sufficient to reduce the lost update anomaly to zero鈥攖hat is, to make the method correct, even in the presence of multiple threads<a data-startref="ix_ch06-asciidoc17" data-type="indexterm" id="7_idm45941118009448"></a>.<a data-startref="ix_ch06-asciidoc16" data-type="indexterm" id="7_idm45941118008824"></a><a data-startref="ix_ch06-asciidoc15" data-type="indexterm" id="7_idm45941117784168"></a><a data-startref="ix_ch06-asciidoc14" data-type="indexterm" id="7_idm45941117783496"></a></p>
</div></section>













<section data-pdf-bookmark="volatile" data-type="sect2"><div class="sect2" id="idm45941118144632">
<h2>volatile</h2>

<p><a data-primary="concurrency" data-secondary="volatile keyword" data-type="indexterm" id="7_idm45941117781768"></a><a data-primary="volatile keyword" data-type="indexterm" id="7_idm45941117780792"></a>Java provides another keyword for dealing with concurrent access to
data. This is the <code>volatile</code> keyword, and it indicates that before
being used by application code, the value of the field or variable must
be reread from main memory. Equally, after a volatile value has been
modified, as soon as the write to the variable has completed, it
must be written back to main memory.</p>

<p><a data-primary="run-until-shutdown pattern" data-type="indexterm" id="7_idm45941117779016"></a>One common usage of the <code>volatile</code> keyword is in the
鈥渞un-until-shutdown鈥?pattern. This is used in multithreaded programming
where an external user or system needs to signal to a processing thread
that it should finish the current job being worked on and then shut down
gracefully. <a data-primary="Graceful Completion pattern" data-type="indexterm" id="7_idm45941117777560"></a>This is sometimes called the 鈥済raceful completion鈥?pattern.
Let鈥檚 look at a typical example, supposing that this code for our
processing thread is in a class that implements <code>Runnable</code>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">private</code> <code class="kd">volatile</code> <code class="kt">boolean</code> <code class="n">shutdown</code> <code class="o">=</code> <code class="kc">false</code><code class="o">;</code>

<code class="kd">public</code> <code class="kt">void</code> <code class="nf">shutdown</code><code class="o">()</code> <code class="o">{</code>
    <code class="n">shutdown</code> <code class="o">=</code> <code class="kc">true</code><code class="o">;</code>
<code class="o">}</code>

<code class="kd">public</code> <code class="kt">void</code> <code class="nf">run</code><code class="o">()</code> <code class="o">{</code>
    <code class="k">while</code> <code class="o">(!</code><code class="n">shutdown</code><code class="o">)</code> <code class="o">{</code>
        <code class="c1">// ... process another task</code>
    <code class="o">}</code>
<code class="o">}</code></pre>

<p><a data-primary="shutdown()" data-type="indexterm" id="7_idm45941117773416"></a>All the time that the <code>shutdown()</code> method is not called by another
thread, the processing thread continues to sequentially process tasks
(this is often combined very usefully with a <code>BlockingQueue</code> to deliver
work). Once <code>shutdown()</code> is called by another thread, the
processing thread immediately sees the <code>shutdown</code> flag change to <code>true</code>.
This does not affect the running job, but once the task finishes, the
processing thread will not accept another task and instead will shut
down gracefully.</p>

<p>However, useful as the <code>volatile</code> keyword is, it does not provide a complete protection of state鈥攁s we can see by using it to mark the field in <code>Counter</code> as <code>volatile</code>.
We might naively assume that this would protect the code in <code>Counter</code>.
Unfortunately, the observed value of the anomaly (and therefore, the presence of the lost update problem) indicates that this is not the case.</p>
</div></section>













<section data-pdf-bookmark="Useful Methods of Thread" data-type="sect2"><div class="sect2" id="idm45941117745784">
<h2>Useful Methods of Thread</h2>

<p><a data-primary="concurrency" data-secondary="useful methods of threads" data-type="indexterm" id="7_ix_ch06-asciidoc18"></a><a data-primary="threads" data-secondary="useful methods of" data-type="indexterm" id="7_ix_ch06-asciidoc19"></a>The <code>Thread</code> class has a
number of methods on it to make your life easier when you鈥檙e creating new application threads. This is
not an exhaustive list鈥攖here are many other methods on <code>Thread</code>, but
this is a description of some of the more common methods.</p>










<section data-pdf-bookmark="getId()" data-type="sect3"><div class="sect3" id="idm45941117740632">
<h3>getId()</h3>

<p><a data-primary="getId()" data-type="indexterm" id="7_idm45941117739432"></a>This method returns the ID number of the thread, as a <code>long</code>. This ID
will stay the same for the lifetime of the thread.</p>
</div></section>













<section data-pdf-bookmark="getPriority() and setPriority()" data-type="sect3"><div class="sect3" id="idm45941117737960">
<h3>getPriority() and setPriority()</h3>

<p><a data-primary="getPriority()" data-type="indexterm" id="7_idm45941117736792"></a><a data-primary="setPriority()" data-type="indexterm" id="7_idm45941117736088"></a>These methods are used to control the priority of threads. The
scheduler decides how to handle thread priorities鈥攆or example, one
strategy could be to not have any low-priority threads run while there
are high-priority threads waiting. In most cases, there is no way to
influence how the scheduler will interpret priorities. Thread priorities
are represented as an integer between 1 and 10, with 10 being the highest.</p>
</div></section>













<section data-pdf-bookmark="setName() and getName()" data-type="sect3"><div class="sect3" id="idm45941117734600">
<h3>setName() and getName()</h3>

<p><a data-primary="getName()" data-type="indexterm" id="7_idm45941117733432"></a><a data-primary="setName()" data-type="indexterm" id="7_idm45941117732728"></a>These methods allow the developer to set or retrieve a name for an individual
thread. Naming threads is good practice, as it can make debugging much
easier, especially when using a tool such as <code>jvisualvm</code>, which we will
discuss in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch13.html#javanut7-CHP-13-SECT-2">鈥淚ntroduction to JShell鈥?/a&gt;.</p>
</div></section>













<section data-pdf-bookmark="getState()" data-type="sect3"><div class="sect3" id="idm45941117730248">
<h3>getState()</h3>

<p><a data-primary="getState()" data-type="indexterm" id="7_idm45941117729048"></a>This returns a <code>Thread.State</code> object that indicates which state this thread
is in, as per the values defined in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch06.html#javanut7-CHP-6-SECT-5.1">鈥淭hread Lifecycle鈥?/a&gt;.</p>
</div></section>













<section data-pdf-bookmark="isAlive()" data-type="sect3"><div class="sect3" id="idm45941117726696">
<h3>isAlive()</h3>

<p><a data-primary="isAlive()" data-type="indexterm" id="7_idm45941117725496"></a>This method is used to test whether a thread is still alive.</p>
</div></section>













<section data-pdf-bookmark="start()" data-type="sect3"><div class="sect3" id="idm45941117724408">
<h3>start()</h3>

<p><a data-primary="start()" data-type="indexterm" id="7_idm45941117723240"></a>This method is used to create a new application thread, and to schedule
it, with the <code>run()</code> method being the entry point for execution. A
thread terminates normally when it reaches the end of its <code>run()</code> method
or when it executes a <code>return</code> statement in that method.</p>
</div></section>













<section data-pdf-bookmark="interrupt()" data-type="sect3"><div class="sect3" id="idm45941117659944">
<h3>interrupt()</h3>

<p><a data-primary="interrupt()" data-type="indexterm" id="7_idm45941117658856"></a>If a thread is blocked in a <code>sleep()</code>, <code>wait()</code>, or <code>join()</code> call, then
calling <code>interrupt()</code> on the <code>Thread</code> object that represents the thread
will cause the thread to be sent an <code>InterruptedException</code> (and to wake
up).</p>

<p>If the thread was involved in interruptible I/O, then the I/O will
be terminated and the thread will receive a
<code>ClosedByInterruptException</code>. The interrupt status of the thread will be
set to <code>true</code>, even if the thread was not engaged in any activity that
could be interrupted.</p>
</div></section>













<section data-pdf-bookmark="join()" data-type="sect3"><div class="sect3" id="idm45941117653624">
<h3>join()</h3>

<p><a data-primary="join()" data-type="indexterm" id="7_idm45941117652392"></a>The current thread waits until the thread corresponding to the <code>Thread</code>
object has died. It can be thought of as an instruction not to proceed
until the other thread has completed.</p>
</div></section>













<section data-pdf-bookmark="setDaemon()" data-type="sect3"><div class="sect3" id="idm45941117650696">
<h3>setDaemon()</h3>

<p><a data-primary="setDaemon()" data-type="indexterm" id="7_idm45941117649496"></a><a data-primary="user thread" data-type="indexterm" id="7_idm45941117648568"></a>A <em>user thread</em> is a thread that will prevent the process from exiting
if it is still alive鈥攖his is the default for threads. <a data-primary="daemon thread" data-type="indexterm" id="7_idm45941117647224"></a>Sometimes,
programmers want threads that will not prevent an exit from
occurring鈥攖hese are called <em>daemon threads</em>. The status of a thread as
a daemon or user thread can be controlled by the <code>setDaemon()</code> method and checked using <code>isDaemon()</code>.</p>
</div></section>













<section data-pdf-bookmark="setUncaughtExceptionHandler()" data-type="sect3"><div class="sect3" id="idm45941117644936">
<h3>setUncaughtExceptionHandler()</h3>

<p><a data-primary="setUncaughtExceptionHandler()" data-type="indexterm" id="7_idm45941117643592"></a>When a thread exits by throwing an exception (i.e., one that the program did not catch), the default behavior is to print the name of the thread, the type of the exception, the
exception message, and a stack trace. If this isn鈥檛 sufficient, you can
install a custom handler for uncaught exceptions in a thread. For
example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// This thread just throws an exception</code>
<code class="n">Thread</code> <code class="n">handledThread</code> <code class="o">=</code>
  <code class="k">new</code> <code class="nf">Thread</code><code class="o">(()</code> <code class="o">-&gt;</code> <code class="o">{</code> <code class="k">throw</code> <code class="k">new</code> <code class="n">UnsupportedOperationException</code><code class="o">();</code> <code class="o">});</code>

<code class="c1">// Giving threads a name helps with debugging</code>
<code class="n">handledThread</code><code class="o">.</code><code class="na">setName</code><code class="o">(</code><code class="s">My Broken Thread</code><code class="o">);</code>

<code class="c1">// Here&apos;s a handler for the error.</code>
<code class="n">handledThread</code><code class="o">.</code><code class="na">setUncaughtExceptionHandler</code><code class="o">((</code><code class="n">t</code><code class="o">,</code> <code class="n">e</code><code class="o">)</code> <code class="o">-&gt;</code> <code class="o">{</code>
    <code class="n">System</code><code class="o">.</code><code class="na">err</code><code class="o">.</code><code class="na">printf</code><code class="o">(</code><code class="s">Exception in thread %d &apos;%s&apos;:</code> <code class="o">+</code>
        <code class="s">%s at line %d of %s%n</code><code class="o">,</code>
        <code class="n">t</code><code class="o">.</code><code class="na">getId</code><code class="o">(),</code>    <code class="c1">// Thread id</code>
        <code class="n">t</code><code class="o">.</code><code class="na">getName</code><code class="o">(),</code>  <code class="c1">// Thread name</code>
        <code class="n">e</code><code class="o">.</code><code class="na">toString</code><code class="o">(),</code> <code class="c1">// Exception name and message</code>
        <code class="n">e</code><code class="o">.</code><code class="na">getStackTrace</code><code class="o">()[</code><code class="mi">0</code><code class="o">].</code><code class="na">getLineNumber</code><code class="o">(),</code>
        <code class="n">e</code><code class="o">.</code><code class="na">getStackTrace</code><code class="o">()[</code><code class="mi">0</code><code class="o">].</code><code class="na">getFileName</code><code class="o">());</code> <code class="o">});</code>
<code class="n">handledThread</code><code class="o">.</code><code class="na">start</code><code class="o">();</code></pre>

<p>This can be useful in some situations鈥攆or example, if one thread is
supervising a group of other worker threads, then this pattern can be
used to restart any threads that die.</p>

<p>There is also <code>setDefaultUncaughtExceptionHandler()</code>, a <code>static</code> method that sets a backup handler for catching any thread鈥檚 uncaught exceptions.<a data-startref="ix_ch06-asciidoc19" data-type="indexterm" id="7_idm45941117558552"></a><a data-startref="ix_ch06-asciidoc18" data-type="indexterm" id="7_idm45941117557912"></a></p>
</div></section>



</div></section>













<section data-pdf-bookmark="Deprecated Methods of Thread" data-type="sect2"><div class="sect2" id="idm45941117745160">
<h2>Deprecated Methods of Thread</h2>

<p><a data-primary="concurrency" data-secondary="deprecated methods of threads" data-type="indexterm" id="7_idm45941117555864"></a><a data-primary="threads" data-secondary="deprecated methods of" data-type="indexterm" id="7_idm45941117554920"></a>In addition to the useful methods of <code>Thread</code>, there are a number of
unsafe methods that you should not use. These methods form
part of the original Java thread API, but were quickly found to be not
suitable for developer use. Unfortunately, due to Java鈥檚 backward
compatibility requirements, it has not been possible to remove them from
the API. Developers simply need to be aware of them, and to avoid
using them under <em>all</em> circumstances.</p>










<section data-pdf-bookmark="stop()" data-type="sect3"><div class="sect3" id="idm45941117552520">
<h3>stop()</h3>

<p><a data-primary="stop()" data-type="indexterm" id="7_idm45941117551288"></a><code>Thread.stop()</code> is almost impossible to use correctly without violating
concurrent safety, as <code>stop()</code> kills the thread immediately, without
giving it any opportunity to recover objects to legal states. This is in
direct opposition to principles such as concurrent safety, and so should
never be used.</p>
</div></section>













<section data-pdf-bookmark="suspend(), resume(), and countStackFrames()" data-type="sect3"><div class="sect3" id="idm45941117549320">
<h3>suspend(), resume(), and countStackFrames()</h3>

<p><a data-primary="countStackFrames()" data-type="indexterm" id="7_idm45941117548152"></a><a data-primary="resume()" data-type="indexterm" id="7_idm45941117547448"></a><a data-primary="suspend()" data-type="indexterm" id="7_idm45941117546776"></a>The <code>suspend()</code> mechanism does not release any monitors it holds when
it suspends, so any other thread that attempts to access those
monitors will deadlock. In practice, this mechanism produces race
conditions between these deadlocks and <code>resume()</code> that render this
group of methods unusable.</p>
</div></section>













<section data-pdf-bookmark="destroy()" data-type="sect3"><div class="sect3" id="idm45941117544584">
<h3>destroy()</h3>

<p><a data-primary="destroy()" data-type="indexterm" id="7_idm45941117543384"></a>This method was never implemented鈥攊t would have suffered from the same
race condition issues as <code>suspend()</code> if it had been.</p>

<p>All of these deprecated methods should always be avoided. A set
of safe alternative patterns that achieve the same intended aims as the
preceding methods have been developed. A good example of one of these
patterns is the run-until-shutdown pattern that we have already met.<a data-startref="ix_ch06-asciidoc11" data-type="indexterm" id="7_idm45941117541320"></a></p>
</div></section>



</div></section>





</div></section>













<section data-pdf-bookmark="Working with Threads" data-type="sect1"><div class="sect1" id="idm45941118320008">
<h1>Working with Threads</h1>

<p><a data-primary="concurrency" data-secondary="working with threads" data-type="indexterm" id="7_idm45941117539256"></a><a data-primary="threads" data-secondary="working with" data-type="indexterm" id="7_idm45941117538280"></a>In order to work effectively with multithreaded code, it鈥檚 important to
have the basic facts about monitors and locks at your command. This
checklist contains the main facts that you should know:</p>

<ul>
<li>
<p>Synchronization is about protecting object state and memory, not code.</p>
</li>
<li>
<p>Synchronization is a cooperative mechanism between threads. One bug
can break the cooperative model and have far-reaching consequences.</p>
</li>
<li>
<p>Acquiring a monitor only prevents other threads from acquiring the
monitor鈥攊t does not protect the object.</p>
</li>
<li>
<p>Unsynchronized methods can see (and modify) inconsistent state, even
while the object鈥檚 monitor is locked.</p>
</li>
<li>
<p>Locking an <code>Object[]</code> doesn鈥檛 lock the individual objects.</p>
</li>
<li>
<p>Primitives are not mutable, so they can鈥檛 (and don鈥檛 need to) be
locked.</p>
</li>
<li>
<p><code>synchronized</code> can鈥檛 appear on a method declaration in an interface.</p>
</li>
<li>
<p>Inner classes are just syntactic sugar, so locks on inner classes have
no effect on the enclosing class (and vice versa).</p>
</li>
<li>
<p>Java鈥檚 locks are <em>reentrant</em>. This means that if a thread holding a
monitor encounters a synchronized block for the same monitor, it can
enter the block.<sup><a class="totri-footnote" data-type="noteref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch06.html#idm45941117526968" id="idm45941117526968-marker">2</a></sup></p>
</li>
</ul>

<p>We鈥檝e also seen that threads can be asked to sleep for a period of time.
It is also useful to go to sleep for an unspecified amount of time, and
wait until a condition is met. <a data-primary="notify()" data-type="indexterm" id="7_idm45941117525704"></a><a data-primary="wait()" data-type="indexterm" id="7_idm45941117525000"></a>In Java, this is handled by the
<code>wait()</code> and <code>notify()</code> methods that are present on <code>Object</code>.</p>

<p>Just as every Java object has a lock associated with it, every object
maintains a list of waiting threads. When a thread calls the <code>wait()</code>
method of an object, any locks the thread holds are temporarily
released, and the thread is added to the list of waiting threads for
that object and stops running. When another thread calls the
<span class="keep-together"><code>notifyAll()</code></span> method of the same object, the object wakes up the
waiting threads and allows them to continue running.</p>

<p>For example, let鈥檚 look at a simplified version of a queue that is safe
for multithreaded use:</p>

<pre data-code-language="java" data-type="programlisting"><code class="cm">/*</code>
<code class="cm"> * One thread calls push() to put an object on the queue.</code>
<code class="cm"> * Another calls pop() to get an object off the queue. If there is no</code>
<code class="cm"> * data, pop() waits until there is some, using wait()/notify().</code>
<code class="cm"> */</code>
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">WaitingQueue</code><code class="o">&lt;</code><code class="n">E</code><code class="o">&gt;</code> <code class="o">{</code>
    <code class="n">LinkedList</code><code class="o">&lt;</code><code class="n">E</code><code class="o">&gt;</code> <code class="n">q</code> <code class="o">=</code> <code class="k">new</code> <code class="n">LinkedList</code><code class="o">&lt;</code><code class="n">E</code><code class="o">&gt;();</code> <code class="c1">// storage</code>
    <code class="kd">public</code> <code class="kd">synchronized</code> <code class="kt">void</code> <code class="nf">push</code><code class="o">(</code><code class="n">E</code> <code class="n">o</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">q</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="n">o</code><code class="o">);</code>         <code class="c1">// Append the object to the end of the list</code>
        <code class="k">this</code><code class="o">.</code><code class="na">notifyAll</code><code class="o">();</code> <code class="c1">// Tell waiting threads that data is ready</code>
    <code class="o">}</code>
    <code class="kd">public</code> <code class="kd">synchronized</code> <code class="n">E</code> <code class="nf">pop</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">while</code><code class="o">(</code><code class="n">q</code><code class="o">.</code><code class="na">size</code><code class="o">()</code> <code class="o">==</code> <code class="mi">0</code><code class="o">)</code> <code class="o">{</code>
            <code class="k">try</code> <code class="o">{</code> <code class="k">this</code><code class="o">.</code><code class="na">wait</code><code class="o">();</code> <code class="o">}</code>
            <code class="k">catch</code> <code class="o">(</code><code class="n">InterruptedException</code> <code class="n">ignore</code><code class="o">)</code> <code class="o">{}</code>
        <code class="o">}</code>
        <code class="k">return</code> <code class="n">q</code><code class="o">.</code><code class="na">remove</code><code class="o">();</code>
    <code class="o">}</code>
<code class="o">}</code></pre>

<p>This class uses a <code>wait()</code> on the instance of <code>WaitingQueue</code> if the
queue is empty (which would make the <code>pop()</code> fail). The waiting thread
temporarily releases its monitor, allowing another thread to claim it鈥攁
thread that might <code>push()</code> something new onto the queue. When the
original thread is woken up again, it is restarted where it originally
began to wait鈥攁nd it will have reacquired its monitor.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><a data-primary="synchronized methods" data-type="indexterm" id="7_idm45941117394088"></a><code>wait()</code> and <code>notify()</code> must be used inside a <code>synchronized</code> method or
block, because of the temporary relinquishing of locks that is required
for them to work properly.</p>
</div>

<p>In general, most developers shouldn鈥檛 roll their own classes like the
one in this example鈥攊nstead, make use of the libraries and components
that the Java platform provides for you.</p>
</div></section>













<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="idm45941117540232">
<h1>Summary</h1>

<p>In this chapter, we鈥檝e discussed Java鈥檚 view of memory and concurrency,
and seen how these topics are intrinsically linked. As processors
develop more and more cores, we will need to use concurrent programming
techniques to make effective use of those cores. Concurrency is key to
the future of well-performing applications.</p>

<p>Java鈥檚 threading model is based on three fundamental concepts:</p>
<dl>
<dt>Shared, visible-by-default mutable state</dt>
<dd>
<p>This means that objects are easily shared between different threads in
a process, and that they can be changed (鈥渕utated鈥? by any thread
holding a reference to them.</p>
</dd>
<dt>Preemptive thread scheduling</dt>
<dd>
<p>The OS thread scheduler can swap threads on and off cores at more or
less any time.</p>
</dd>
<dt>Object state can only be protected by locks</dt>
<dd>
<p>Locks can be hard to use correctly, and state is quite vulnerable鈥攅ven
in unexpected places such as read operations.</p>
</dd>
</dl>

<p>Taken together, these three aspects of Java鈥檚 approach to concurrency
explain why multithreaded programming can cause so many headaches for
developers.</p>
</div></section>







<div data-type="footnotes"><p data-type="footnote" id="idm45941118529992"><sup><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch06.html#idm45941118529992-marker">1</a></sup> <a data-primary="transitive closure" data-type="indexterm" id="7_idm45941118529528"></a>The process whereby we exhaustively explore from the GC roots produces what is known as the <em>transitive closure</em> of live objects鈥攁 term that is borrowed from the abstract mathematics of graph theory.</p><p data-type="footnote" id="idm45941117526968"><sup><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch06.html#idm45941117526968-marker">2</a></sup> Outside of Java, not all implementations of locks have this property.</p></div></div></section><div class="annotator-outer annotator-viewer viewer annotator-hide"> </div></div></div>
    </section>
  </div>
</div>

<hr/>

<!--if IE]><![endif]--><!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/java-in-a/9781492037248/part02.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="3866890"
  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"
  data-username="levinxccai"
  data-account-type="B2B"
  
  data-activated-trial-date="11/06/2017"


  data-archive="9781492037248"
  data-publishers="O&#39;Reilly Media, Inc."



  data-htmlfile-name="part02.html"
  data-epub-title="Java in a Nutshell, 7th Edition" data-debug=0 data-testing=0><![endif]--><!--if gt IE 8]><!--><!--![endif]-->



<a name="8_"></a>
<div id="MathJax_Message" style="display: none;"></div>
<div class="application" id="container" style="height: auto;">
  <div class="js-toc">
    <section role="document">
      <div id="sbo-rt-content" style="max-width:72.5em; transform: none;"><div class="annotator-wrapper"><div data-pdf-bookmark="Part II. Working with the Java Platform" data-type="part" epub:type="part" id="javanut-PART-2">
<h1><span class="label">Part II. </span>Working with the Java Platform</h1>


<p>Part II is an introduction to some of the core libraries that ship with
Java and some programming techniques that are common to intermediate and
advanced Java <span class="keep-together">programs</span>.</p>
<ul class="simplelist">
  <li><a data-type="xref" data-xrefstyle="chap-num-title" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch07.html#javanut7-CHP-7">Chapter 7, <em>Programming and Documentation Conventions</em></a></li>
  <li><a data-type="xref" data-xrefstyle="chap-num-title" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch08.html#javanut7-CHP-8">Chapter 8, <em>Working with Java Collections</em></a></li>
  <li><a data-type="xref" data-xrefstyle="chap-num-title" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch09.html#javanut7-CHP-9">Chapter 9, <em>Handling Common Data Formats</em></a></li>
  <li><a data-type="xref" data-xrefstyle="chap-num-title" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch10.html#javanut7-CHP-10">Chapter 10, <em>File Handling and I/O</em></a></li>
  <li><a data-type="xref" data-xrefstyle="chap-num-title" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch11.html#javanut7-CHP-11">Chapter 11, <em>Classloading, Reflection, and Method Handles</em></a></li>
  <li><a data-type="xref" data-xrefstyle="chap-num-title" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch12.html#javanut7-CHP-12">Chapter 12, <em>Java Platform Modules</em></a></li>
  <li><a data-type="xref" data-xrefstyle="chap-num-title" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch13.html#javanut7-CHP-13">Chapter 13, <em>Platform Tools</em></a></li>
</ul>
</div><div class="annotator-outer annotator-viewer viewer annotator-hide"> </div></div></div>
    </section>
  </div>
</div>

<hr/>

<!--if IE]><![endif]--><!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/java-in-a/9781492037248/ch07.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="3866890"
  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"
  data-username="levinxccai"
  data-account-type="B2B"
  
  data-activated-trial-date="11/06/2017"


  data-archive="9781492037248"
  data-publishers="O&#39;Reilly Media, Inc."



  data-htmlfile-name="ch07.html"
  data-epub-title="Java in a Nutshell, 7th Edition" data-debug=0 data-testing=0><![endif]--><!--if gt IE 8]><!--><!--![endif]-->



<a name="9_"></a>
<div id="MathJax_Message" style="display: none;"></div>
<div class="application" id="container" style="height: auto;">
  <div class="js-toc">
    <section role="document">
      <div id="sbo-rt-content" style="max-width:72.5em; transform: none;"><div class="annotator-wrapper"><section data-nutshell-tab="Conventions" data-pdf-bookmark="Chapter 7. Programming and Documentation Conventions" data-type="chapter" epub:type="chapter"><div class="chapter" id="javanut7-CHP-7">
<h1><span class="label">Chapter 7. </span>Programming and Documentation Conventions</h1>


<p><a data-primary="conventions, programming/documentation" data-type="indexterm" id="9_ix_ch07-asciidoc0"></a>This chapter explains a number of important and useful Java programming
and documentation conventions. It covers:</p>

<ul>
<li>
<p>General naming and capitalization conventions</p>
</li>
<li>
<p>Portability tips and conventions</p>
</li>
<li>
<p><code>javadoc</code> documentation comment syntax and conventions</p>
</li>
</ul>






<section data-pdf-bookmark="Naming and Capitalization Conventions" data-type="sect1"><div class="sect1" id="idm45941117363688">
<h1>Naming and Capitalization Conventions</h1>

<p><a data-primary="capitalization conventions" data-type="indexterm" id="9_ix_ch07-asciidoc1"></a><a data-primary="conventions, programming/documentation" data-secondary="naming and capitalization conventions" data-type="indexterm" id="9_ix_ch07-asciidoc2"></a>The following widely adopted naming conventions apply to modules, packages,
reference types, methods, fields, and constants in Java. Because these
conventions are almost universally followed and because they affect the
public API of the classes you define, you should adopt them as well:</p>
<dl>
<dt>Modules</dt>
<dd>
<p><a data-primary="conventions, programming/documentation" data-secondary="modules" data-type="indexterm" id="9_idm45941117358168"></a><a data-primary="modules" data-secondary="naming conventions" data-type="indexterm" id="9_idm45941117357224"></a>As modules are the preferred unit of distribution for Java applications from Java 9 onward, you should take special care when naming them.</p>

<p>Module names must be globally unique鈥攖he modules system is essentially predicated on this assumption.
As modules are effectively super-packages (or aggregates of packages) the module name should be closely related to the package names that are grouped into the module.
One recommended way to do this is to group together the packages within a module, and use the <em>root name</em> of the packages as the module name.</p>
</dd>
<dt>Packages</dt>
<dd>
<p><a data-primary="conventions, programming/documentation" data-secondary="packages" data-type="indexterm" id="9_idm45941117353624"></a><a data-primary="packages" data-secondary="naming conventions" data-type="indexterm" id="9_idm45941117352584"></a>It is customary to ensure that your publicly visible package names are unique.
One common way of doing this is by prefixing them with the inverted name of an internet domain that you own (e.g., <code>com.oreilly.javanutshell</code>).</p>

<p>This convention is now followed less strictly than it used to be, with some projects merely adopting a simple, recognizable, and unique prefix instead.
All package names should be lowercase.</p>
</dd>
<dt>Classes</dt>
<dd>
<p><a data-primary="class(es)" data-secondary="naming conventions" data-type="indexterm" id="9_idm45941117349112"></a><a data-primary="conventions, programming/documentation" data-secondary="classes" data-type="indexterm" id="9_idm45941117347944"></a><a data-primary="conventions, programming/documentation" data-secondary="types" data-type="indexterm" id="9_idm45941117347032"></a><a data-primary="types" data-secondary="naming conventions" data-type="indexterm" id="9_idm45941117346072"></a>A type name should begin with a capital letter and be written in
mixed case (e.g., <code>String</code>).
If a class name consists of more than one word, each word should begin with a capital letter (e.g., <code>StringBuffer</code>).
If a type name, or one of the words of a type name, is an acronym, the acronym can be written in all capital letters (e.g., <code>URL</code>, <code>HTMLParser</code>).</p>

<p>Because classes and enumerated types are designed to represent
objects, you should choose class names that are nouns (e.g., <code>Thread</code>,
<code>Teapot</code>, <code>FormatConverter</code>).</p>

<p><a data-primary="conventions, programming/documentation" data-secondary="enums" data-type="indexterm" id="9_idm45941117340984"></a><a data-primary="enums (enumerated types)" data-type="indexterm" id="9_idm45941117340040"></a>Enum types are a special case of a class where there are only finitely many instances.
They should be named as nouns in all but highly exceptional circumstances.
The constants defined by <code>enum</code> types are also typically written in all capital letters, as per the rules for constants below.</p>
</dd>
<dt>Interfaces</dt>
<dd>
<p><a data-primary="conventions, programming/documentation" data-secondary="interfaces" data-type="indexterm" id="9_idm45941117337336"></a><a data-primary="interfaces" data-secondary="naming conventions" data-type="indexterm" id="9_idm45941117336344"></a>Java programmers typically use interfaces in one of two ways: either to convey that a class has additional, supplementary aspects or behaviors; or to indicate that the class is one possible implementation of an interface for which there are multiple valid implementation choices.</p>

<p>When an interface is used to provide additional information about the classes that implement it, it is common to choose an interface name that is an adjective (e.g., <code>Runnable</code>, <code>Cloneable</code>, <code>Serializable</code>).</p>

<p>When an interface is intended to work more like an abstract superclass, use a name that is a noun (e.g., <code>Document</code>, <code>FileNameMap</code>, <code>Collection</code>).</p>
</dd>
<dt>Methods</dt>
<dd>
<p><a data-primary="conventions, programming/documentation" data-secondary="methods" data-type="indexterm" id="9_idm45941117330008"></a><a data-primary="methods" data-secondary="naming conventions" data-type="indexterm" id="9_idm45941117328872"></a>A method name always begins with a lowercase letter. <a data-primary="camel case" data-type="indexterm" id="9_idm45941117327800"></a>If the name
contains more than one word, every word after the first begins with a
capital letter (e.g., <code>insert()</code>, <code>insertObject()</code>,
<code>insertObjectAt()</code>). This is usually referred to as <em>camel case</em>.</p>

<p>Method names are typically chosen so that the first word is a verb.
Method names can be as long as is necessary to make their purpose
clear, but choose succinct names where possible. Avoid overly general
method names, such as <code>performAction()</code>, <code>go()</code>, or the dreadful
<code>doIt()</code>.</p>
</dd>
<dt>Fields and constants</dt>
<dd>
<p><a data-primary="conventions, programming/documentation" data-secondary="fields" data-type="indexterm" id="9_idm45941117322088"></a><a data-primary="fields" data-secondary="naming conventions" data-type="indexterm" id="9_idm45941117321096"></a>Nonconstant field names follow the same capitalization conventions as method names. A field name should be chosen to best describe the purpose of the field or the value it holds.</p>

<p><a data-primary="constants" data-secondary="naming conventions" data-type="indexterm" id="9_idm45941117319576"></a><a data-primary="conventions, programming/documentation" data-secondary="constants" data-type="indexterm" id="9_idm45941117318600"></a><a data-primary="conventions, programming/documentation" data-secondary="static final constant" data-type="indexterm" id="9_idm45941117317640"></a><a data-primary="static final constant, naming conventions for" data-type="indexterm" id="9_idm45941117271672"></a>If a field is a <code>static final</code> constant, it should be written in all uppercase.
If the name of a constant includes more than one word, the words should be separated with underscores (e.g., <code>MAX_VALUE</code>).</p>
</dd>
<dt>Parameters</dt>
<dd>
<p><a data-primary="conventions, programming/documentation" data-secondary="parameters" data-type="indexterm" id="9_idm45941117268552"></a><a data-primary="parameters, naming conventions for" data-type="indexterm" id="9_idm45941117267560"></a>Method parameters follow the same capitalization conventions as
nonconstant fields. The names of method parameters appear in the
documentation for a method, so you should choose names that make the
purpose of the parameters as clear as possible. Try to keep parameter
names to a single word and use them consistently. For example, if a
<code>WidgetProcessor</code> class defines many methods that accept a <code>Widget</code>
object as the first parameter, name this parameter <code>widget</code>.</p>
</dd>
<dt>Local variables</dt>
<dd>
<p><a data-primary="conventions, programming/documentation" data-secondary="local variables" data-type="indexterm" id="9_idm45941117263896"></a><a data-primary="conventions, programming/documentation" data-secondary="variables" data-type="indexterm" id="9_idm45941117262904"></a><a data-primary="local variables" data-secondary="naming conventions" data-type="indexterm" id="9_idm45941117261944"></a><a data-primary="variables" data-secondary="naming conventions" data-type="indexterm" id="9_idm45941117261000"></a>Local variable names are an implementation detail and never visible
outside your class. Nevertheless, choosing good names makes your code
easier to read, understand, and maintain. Variables are typically
named following the same conventions as methods and fields.</p>

<p>In addition to the conventions for specific types of names, there are
conventions regarding the characters you should use in your names.
<a data-primary="$ character" data-type="indexterm" id="9_idm45941117259112"></a>Java allows the <code>$</code> character in any identifier, but, by convention,
its use is reserved for synthetic names generated by source-code
processors. For example, it is used by the Java compiler to make inner
classes work. You should not use the <code>$</code> character in any name that
you create.</p>

<p>Java allows names to use any alphanumeric characters from the entire
Unicode character set. While this can be convenient for
non-English-speaking programmers, this has never really taken off and
this usage is extremely rare.<a data-startref="ix_ch07-asciidoc2" data-type="indexterm" id="9_idm45941117256552"></a><a data-startref="ix_ch07-asciidoc1" data-type="indexterm" id="9_idm45941117255848"></a></p>
</dd>
</dl>
</div></section>













<section data-pdf-bookmark="Practical Naming" data-type="sect1"><div class="sect1" id="idm45941117254920">
<h1>Practical Naming</h1>

<p><a data-primary="conventions, programming/documentation" data-secondary="practical naming" data-type="indexterm" id="9_idm45941117253480"></a>The names we give to our constructs matter鈥攁 lot. Naming is a key part
of the process that conveys our abstract designs to our peers. The
process of transferring a software design from one human mind to another
is hard鈥攈arder, in many cases, than the process of transferring our
design from our mind to the machines that will execute it.</p>

<p>We must, therefore, do everything we can to ensure that this process is
eased. Names are a keystone of this. When reviewing code (and all code
should be reviewed), pay particular attention to the
names that have been chosen:</p>

<ul>
<li>
<p>Do the names of the types reflect the purpose of those types?</p>
</li>
<li>
<p>Does each method do exactly what its name suggests? Ideally, no more,
and no less?</p>
</li>
<li>
<p>Are the names descriptive enough? Could a more specific name be used
instead?</p>
</li>
<li>
<p>Are the names well suited for the domain they describe?</p>
</li>
<li>
<p>Are the names consistent across the domain?</p>
</li>
<li>
<p>Do the names mix metaphors?</p>
</li>
<li>
<p>Does the name reuse a common term of software engineering?</p>
</li>
</ul>

<p>Mixed metaphors are common in software, especially after several
releases of an application. A system that starts off perfectly
reasonably with components called <code>Receptionist</code> (for handling incoming
connections), <code>Scribe</code> (for persisting orders), and <code>Auditor</code> (for
checking and reconciling orders) can quite easily end up in a later
release with a class called <code>Watchdog</code> for restarting processes. This
isn鈥檛 terrible, but it breaks the established pattern of people鈥檚 job
titles that previously existed.</p>

<p>It is also incredibly important to realize that software changes a lot
over time. A perfectly apposite name on release 1 can become highly
misleading by release 4. Care should be taken that as the system focus
and intent shifts, the names are refactored along with the code. Modern
IDEs have no problem with global search and replace of symbols, so there
is no need to cling to outdated metaphors once they are no longer
useful.</p>

<p>One final note of caution: an overly strict interpretation of these
guidelines can lead the developer to some very odd naming constructs.
There are a number of excellent descriptions of some of the absurdities
that can result by taking these conventions to their extremes.</p>

<p>In other words, none of the conventions described here is mandatory.
Following them will, in the vast majority of cases, make your code
easier to read and maintain.
However, you should not be afraid to deviate from these guidelines
if it makes your code easier to read and understand.</p>
<blockquote>
<p>Break any of these rules rather than say anything outright barbarous.</p>
<p data-type="attribution">George Orwell</p>
</blockquote>

<p>Above all, you should have a sense of the expected lifetime of the code
you are writing. A risk calculation system in a bank may have a lifetime
of a decade or more, whereas a prototype for a startup may only be
relevant for a few weeks. Document accordingly鈥攖he longer the code is
likely to be live, the better its documentation needs to be.</p>
</div></section>













<section data-pdf-bookmark="Java Documentation Comments" data-type="sect1"><div class="sect1" id="idm45941117254328">
<h1>Java Documentation Comments</h1>

<p><a data-primary="conventions, programming/documentation" data-secondary="Java documentation comments" data-seealso="doc comments" data-type="indexterm" id="9_ix_ch07-asciidoc3"></a><a data-primary="Java (generally)" data-secondary="documentation comments" data-seealso="doc comments" data-type="indexterm" id="9_ix_ch07-asciidoc4"></a>Most <a data-primary="doc comments" data-type="indexterm" id="9_ix_ch07-asciidoc5"></a>ordinary comments within Java code explain the implementation
details of that code. By contrast, the Java language specification
defines a special type of comment known as a <em>doc comment</em> that serves
to document the API of your code.</p>

<p><a data-primary="/ (slash)" data-secondary="/** */ in doc comments" data-type="indexterm" id="9_idm45941117230728"></a>A doc comment is an ordinary multiline comment that begins with <code>/**</code>
(instead of the usual <code>/*</code>) and ends with <code>*/</code>. A doc comment appears
immediately before a type or member definition and contains
documentation for that type or member. The documentation can include
simple HTML formatting tags and other special keywords that provide
additional information.</p>

<p><a data-primary="javadoc" data-secondary="doc comments" data-type="indexterm" id="9_idm45941117227720"></a>Doc comments are ignored by the compiler, but
they can be extracted and automatically turned into online HTML
documentation by the <code>javadoc</code> program. (See
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch13.html#javanut7-CHP-13">Chapter 13</a> for more information about <code>javadoc</code>.)</p>

<p>Here is an example class that contains appropriate doc comments:</p>

<pre data-code-language="java" data-type="programlisting"><code class="cm">/**</code>
<code class="cm"> * This immutable class represents &lt;i&gt;complex numbers&lt;/i&gt;.</code>
<code class="cm"> *</code>
<code class="cm"> * @author David Flanagan</code>
<code class="cm"> * @version 1.0</code>
<code class="cm"> */</code>
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">Complex</code> <code class="o">{</code>
    <code class="cm">/**</code>
<code class="cm">     * Holds the real part of this complex number.</code>
<code class="cm">     * @see #y</code>
<code class="cm">     */</code>
    <code class="kd">protected</code> <code class="kt">double</code> <code class="n">x</code><code class="o">;</code>

    <code class="cm">/**</code>
<code class="cm">     * Holds the imaginary part of this complex number.</code>
<code class="cm">     * @see #x</code>
<code class="cm">     */</code>
    <code class="kd">protected</code> <code class="kt">double</code> <code class="n">y</code><code class="o">;</code>

    <code class="cm">/**</code>
<code class="cm">     * Creates a new Complex object that represents the complex number</code>
<code class="cm">     * x+yi. @param x The real part of the complex number.</code>
<code class="cm">     * @param y The imaginary part of the complex number.</code>
<code class="cm">     */</code>
    <code class="kd">public</code> <code class="nf">Complex</code><code class="o">(</code><code class="kt">double</code> <code class="n">x</code><code class="o">,</code> <code class="kt">double</code> <code class="n">y</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">this</code><code class="o">.</code><code class="na">x</code> <code class="o">=</code> <code class="n">x</code><code class="o">;</code>
        <code class="k">this</code><code class="o">.</code><code class="na">y</code> <code class="o">=</code> <code class="n">y</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="cm">/**</code>
<code class="cm">     * Adds two Complex objects and produces a third object that</code>
<code class="cm">     * represents their sum.</code>
<code class="cm">     * @param c1 A Complex object</code>
<code class="cm">     * @param c2 Another Complex object</code>
<code class="cm">     * @return  A new Complex object that represents the sum of</code>
<code class="cm">     *          &lt;code&gt;c1&lt;/code&gt; and &lt;code&gt;c2&lt;/code&gt;.</code>
<code class="cm">     * @exception java.lang.NullPointerException</code>
<code class="cm">     *            If either argument is &lt;code&gt;null&lt;/code&gt;.</code>
<code class="cm">     */</code>
    <code class="kd">public</code> <code class="kd">static</code> <code class="n">Complex</code> <code class="nf">add</code><code class="o">(</code><code class="n">Complex</code> <code class="n">c1</code><code class="o">,</code> <code class="n">Complex</code> <code class="n">c2</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">return</code> <code class="k">new</code> <code class="nf">Complex</code><code class="o">(</code><code class="n">c1</code><code class="o">.</code><code class="na">x</code> <code class="o">+</code> <code class="n">c2</code><code class="o">.</code><code class="na">x</code><code class="o">,</code> <code class="n">c1</code><code class="o">.</code><code class="na">y</code> <code class="o">+</code> <code class="n">c2</code><code class="o">.</code><code class="na">y</code><code class="o">);</code>
    <code class="o">}</code>
<code class="o">}</code></pre>








<section data-pdf-bookmark="Structure of a Doc Comment" data-type="sect2"><div class="sect2" id="idm45941117221304">
<h2>Structure of a Doc Comment</h2>

<p><a data-primary="doc comments" data-secondary="structure of" data-type="indexterm" id="9_idm45941117220184"></a>The body of a doc comment should begin with a one-sentence summary of
the type or member being documented. This sentence may be displayed by
itself as summary documentation, so it should be written to stand on its
own. The initial sentence may be followed by any number of other
sentences and paragraphs that describe the class, interface, method, or
field in full detail.</p>

<p>After the descriptive paragraphs, a doc comment can contain any number
of other paragraphs, each of which begins with a special doc-comment
tag, such as <code>@author</code>, <code>@param</code>, or <code>@returns</code>. These tagged paragraphs
provide specific information about the class, interface, method, or
field that the <code>javadoc</code> program displays in a standard way. The full
set of doc-comment tags is listed in the next section.</p>

<p>The descriptive material in a doc comment can contain simple HTML markup
tags, such as <code>&lt;i&gt;</code> for emphasis; <code>&lt;code&gt;</code> for class, method, and field
names; and <code>&lt;pre&gt;</code> for multiline code examples. It can also contain
<code>&lt;p&gt;</code> tags to break the description into separate paragraphs and <code>&lt;ul&gt;</code>,
<code>&lt;li&gt;</code>, and related tags to display bulleted lists and similar
structures. Remember, however, that the material you write is embedded
within a larger, more complex HTML document. For this reason, doc
comments should not contain major structural HTML tags, such as <code>&lt;h2&gt;</code>
or <code>&lt;hr&gt;</code>, that might interfere with the structure of the larger
document.</p>

<p>Avoid the use of the <code>&lt;a&gt;</code> tag to include hyperlinks or cross-references
in your doc comments. <a data-primary="@link doc-comment tag" data-primary-sortas="link doc-comment tag" data-type="indexterm" id="9_idm45941117114920"></a>Instead, use the special <code>{@link}</code> doc-comment
tag, which, unlike the other doc-comment tags, can appear anywhere
within a doc comment. As described in the next section, the <code>{@link}</code>
tag allows you to specify hyperlinks to other classes, interfaces,
methods, and fields without knowing the HTML-structuring conventions and
filenames used by <code>javadoc</code>.</p>

<p>If you want to include an image in a doc comment, place the image file
in a <em>doc-files</em> subdirectory of the source code directory. Give the
image the same name as the class, with an integer suffix. For example,
the second image that appears in the doc comment for a class named
<code>Circle</code> can be included with this HTML tag:</p>

<pre data-code-language="java" data-type="programlisting"><code class="o">&lt;</code><code class="n">img</code> <code class="n">src</code><code class="o">=</code><code class="s">doc-files/Circle-2.gif</code><code class="o">&gt;</code></pre>

<p><a data-primary="* (asterisk)" data-secondary="in doc comments" data-type="indexterm" id="9_idm45941117107048"></a>Because the lines of a doc comment are embedded within a Java comment,
any leading spaces and asterisks (<code>*</code>) are stripped from each line of
the comment before processing. Thus, you don鈥檛 need to worry about the
asterisks appearing in the generated documentation or about the
indentation of the comment affecting the indentation of code examples
included within the comment with a <code>&lt;pre&gt;</code> tag.</p>
</div></section>













<section data-pdf-bookmark="Doc-Comment Tags" data-type="sect2"><div class="sect2" id="idm45941117092520">
<h2>Doc-Comment Tags</h2>

<p><a data-primary="doc comments" data-secondary="tags" data-type="indexterm" id="9_ix_ch07-asciidoc6"></a><a data-primary="doc-comment tags" data-type="indexterm" id="9_ix_ch07-asciidoc7"></a><a data-primary="tags" data-secondary="doc-comment" data-type="indexterm" id="9_ix_ch07-asciidoc8"></a>The <a data-primary="@ (at sign)" data-secondary="in doc-comment tags" data-type="indexterm" id="9_idm45941117102136"></a><code>javadoc</code> program recognizes a number of special tags, each of
which begins with an <code>@</code> character. These doc-comment tags allow you to
encode specific information into your comments in a standardized way,
and they allow <code>javadoc</code> to choose the appropriate output format for
that information. For example, the <code>@param</code> tag lets you specify the
name and meaning of a single parameter for a method. <code>javadoc</code> can
extract this information and display it using an HTML <code>&lt;dl&gt;</code> list, an
HTML <code>&lt;table&gt;</code>, or whatever it sees fit.</p>

<p>The following doc-comment tags are recognized by <code>javadoc</code>; a doc
comment should typically use these tags in the order listed here:</p>
<dl>
<dt><code>@author</code> <em><code>name</code></em></dt>
<dd>
<p><a data-primary="@author doc-comment tag" data-primary-sortas="author doc-comment tag" data-type="indexterm" id="9_idm45941117085992"></a>Adds an 鈥淎uthor:鈥?entry that contains the specified name. This tag
should be used for every class or interface definition but must not be
used for individual methods and fields. If a class has multiple
authors, use multiple <code>@author</code> tags on adjacent lines. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="nd">@author</code> <code class="n">Ben</code> <code class="n">Evans</code>
<code class="nd">@author</code> <code class="n">David</code> <code class="n">Flanagan</code></pre>

<p>List the authors in chronological order, with the original author
first. If the author is unknown, you can use 鈥渦nascribed.鈥?<code>javadoc</code>
does not output authorship information unless the <code>-author</code>
command-line argument is specified.</p>
</dd>
<dt><code>@version</code> <em><code>text</code></em></dt>
<dd>
<p><a data-primary="@version doc-comment tag" data-primary-sortas="version doc-comment tag" data-type="indexterm" id="9_idm45941117037176"></a>Inserts a 鈥淰ersion:鈥?entry that contains the specified text. For
example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="nd">@version</code> <code class="mf">1.32</code><code class="o">,</code> <code class="mi">08</code><code class="o">/</code><code class="mi">26</code><code class="o">/</code><code class="mi">04</code></pre>

<p>This tag should be included in every class and interface doc comment
but cannot be used for individual methods and fields. This tag is
often used in conjunction with the automated version-numbering
capabilities of a version control system, such as git, Perforce, or
SVN. <code>javadoc</code> does not output version information in its generated
documentation unless the <code>-version</code> command-line argument is
specified.</p>
</dd>
<dt><code>@param</code> <em><code>parameter-name</code></em> <em><code>description</code></em></dt>
<dd>
<p><a data-primary="@param doc-comment tag" data-primary-sortas="param doc-comment tag" data-type="indexterm" id="9_idm45941116947112"></a>Adds the specified parameter and its description to the 鈥淧arameters:鈥?
section of the current method. The doc comment for a method or
constructor must contain one <code>@param</code> tag for each parameter the
method expects. These tags should appear in the same order as the
parameters specified by the method. The tag can be used only in doc
comments for methods and constructors.</p>

<p>You are encouraged to use phrases and sentence fragments where
possible to keep the descriptions brief. However, if a parameter
requires detailed <span class="keep-together">documentation</span>, the description can wrap onto
multiple lines and include as much text as necessary. For readability
in source-code form, consider using spaces to align the descriptions
with each other. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="nd">@param</code> <code class="n">o</code>      <code class="n">the</code> <code class="n">object</code> <code class="n">to</code> <code class="n">insert</code>
<code class="nd">@param</code> <code class="n">index</code>  <code class="n">the</code> <code class="n">position</code> <code class="n">to</code> <code class="n">insert</code> <code class="n">it</code> <code class="n">at</code></pre>
</dd>
<dt><code>@return</code> <em><code>description</code></em></dt>
<dd>
<p><a data-primary="@return doc-comment tag" data-primary-sortas="return doc-comment tag" data-type="indexterm" id="9_idm45941116953720"></a>Inserts a 鈥淩eturns:鈥?section that contains the specified description.
This tag should appear in every doc comment for a method, unless the
method returns <code>void</code> or is a constructor. The description can be as
long as necessary, but consider using a sentence fragment to keep it
short. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="nd">@return</code> <code class="o">&lt;</code><code class="n">code</code><code class="o">&gt;</code><code class="kc">true</code><code class="o">&lt;/</code><code class="n">code</code><code class="o">&gt;</code> <code class="k">if</code> <code class="n">the</code> <code class="n">insertion</code> <code class="n">is</code> <code class="n">successful</code><code class="o">,</code> <code class="n">or</code>
        <code class="o">&lt;</code><code class="n">code</code><code class="o">&gt;</code><code class="kc">false</code><code class="o">&lt;/</code><code class="n">code</code><code class="o">&gt;</code> <code class="k">if</code> <code class="n">the</code> <code class="n">list</code> <code class="n">already</code> <code class="n">contains</code> <code class="n">the</code> <code class="n">object</code><code class="o">.</code></pre>
</dd>
<dt><code>@exception</code> <em><code>full-classname description</code></em></dt>
<dd>
<p><a data-primary="@exception doc-comment tag" data-primary-sortas="exception doc-comment tag" data-type="indexterm" id="9_idm45941116855704"></a>Adds a 鈥淭hrows:鈥?entry that contains the specified exception name and
description. A doc comment for a method or constructor should contain
an <code>@exception</code> tag for every checked exception that appears in its
<code>throws</code> clause. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="nd">@exception</code> <code class="n">java</code><code class="o">.</code><code class="na">io</code><code class="o">.</code><code class="na">FileNotFoundException</code>
           <code class="n">If</code> <code class="n">the</code> <code class="n">specified</code> <code class="n">file</code> <code class="n">could</code> <code class="n">not</code> <code class="n">be</code> <code class="n">found</code></pre>

<p>The <code>@exception</code> tag can optionally be used to document unchecked
exceptions (i.e., subclasses of <code>RuntimeException</code>) the method may
throw, when these are exceptions that a user of the method may
reasonably want to catch. If a method can throw more than one
exception, use multiple <code>@exception</code> tags on adjacent lines and list
the exceptions in alphabetical order. The description can be as short
or as long as necessary to describe the significance of the exception.
This tag can be used only for method and constructor comments. <a data-primary="@throws doc-comment tag" data-primary-sortas="throws doc-comment tag" data-type="indexterm" id="9_idm45941116843272"></a>The
<code>@throws</code> tag is a synonym for <code>@exception</code>.</p>
</dd>
<dt><code>@throws</code> <em><code>full-classname description</code></em></dt>
<dd>
<p>This tag is a synonym for <code>@exception</code>.</p>
</dd>
<dt><code>@see</code> <em><code>reference</code></em></dt>
<dd>
<p><a data-primary="@see doc-comment tag" data-primary-sortas="see doc-comment tag" data-type="indexterm" id="9_idm45941116809256"></a>Adds a 鈥淪ee Also:鈥?entry that contains the specified reference. This
tag can appear in any kind of doc comment. The syntax for the
<em><code>reference</code></em> is explained in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch07.html#javanut7-CHP-7-SECT-3.4">鈥淐ross-References in Doc Comments鈥?/a&gt;.</p>
</dd>
<dt><code>@deprecated</code> <em><code>explanation</code></em></dt>
<dd>
<p><a data-primary="@deprecated doc-comment tag" data-primary-sortas="deprecated doc-comment tag" data-type="indexterm" id="9_idm45941116804776"></a>This tag specifies that the following type or member has been
deprecated and that its use should be avoided. <code>javadoc</code> adds a
prominent 鈥淒eprecated鈥?entry to the documentation and includes the
specified <em><code>explanation</code></em> text. This text should specify when the
class or member was deprecated and, if possible, suggest a replacement
class or member and include a link to it. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="nd">@deprecated</code> <code class="n">As</code> <code class="n">of</code> <code class="n">Version</code> <code class="mf">3.0</code><code class="o">,</code> <code class="k">this</code> <code class="n">method</code> <code class="n">is</code> <code class="n">replaced</code>
            <code class="n">by</code> <code class="o">{</code><code class="nd">@link</code> <code class="err">#</code><code class="n">setColor</code><code class="o">}.</code></pre>

<p>The <code>@deprecated</code> tag is an exception to the general rule that <code>javac</code>
ignores all comments. When this tag appears, the compiler notes the
deprecation in the class file it produces. This allows it to issue
warnings for other classes that rely on the deprecated feature.</p>
</dd>
<dt><code>@since</code> <em><code>version</code></em></dt>
<dd>
<p><a data-primary="@since doc-comment tag" data-primary-sortas="since doc-comment tag" data-type="indexterm" id="9_idm45941116764104"></a>Specifies when the type or member was added to the API. This tag
should be followed by a version number or other version specification.
For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="nd">@since</code> <code class="n">JNUT</code> <code class="mf">3.0</code></pre>

<p>Every doc comment for a type should include an <code>@since</code> tag, and any
members added after the initial release of the type should have
<code>@since</code> tags in their doc comments.</p>
</dd>
<dt><code>@serial</code> <em><code>description</code></em></dt>
<dd>
<p><a data-primary="@serial doc-comment tag" data-primary-sortas="serial doc-comment tag" data-type="indexterm" id="9_idm45941116747576"></a>Technically, the way a class is serialized is part of its public
API. If you write a class that you expect to be serialized, you should
document its serialization format using <code>@serial</code> and the related tags
listed next. <code>@serial</code> should appear in the doc comment for any field
that is part of the serialized state of a <code>Serializable</code> class.</p>

<p>For classes that use the default serialization mechanism, this means
all fields that are not declared <code>transient</code>, including fields
declared <code>private</code>. The <em><code>description</code></em> should be a brief description
of the field and of its purpose within a serialized object.</p>

<p>You can also use the <code>@serial</code> tag at the class and package level to
specify whether a 鈥渟erialized form page鈥?should be generated for the
class or package. The syntax is:</p>

<pre data-code-language="java" data-type="programlisting"><code class="nd">@serial</code> <code class="n">include</code>
<code class="nd">@serial</code> <code class="n">exclude</code></pre>
</dd>
<dt><code>@serialField</code> <em><code>name type description</code></em></dt>
<dd>
<p><a data-primary="@serialField doc-comment tag" data-primary-sortas="serialField doc-comment tag" data-type="indexterm" id="9_idm45941116751736"></a>A <code>Serializable</code> class can define its serialized format by declaring
an array of <code>ObjectStreamField</code> objects in a field named
<code>serialPersistentFields</code>. For such a class, the doc comment for
<code>serialPersistentFields</code> should include an <code>@serialField</code> tag for each
element of the array. Each tag specifies the name, type, and
description for a particular field in the serialized state of the
class.</p>
</dd>
<dt><code>@serialData</code> <em><code>description</code></em></dt>
<dd>
<p><a data-primary="@serialData doc-comment tag" data-primary-sortas="serialData doc-comment tag" data-type="indexterm" id="9_idm45941116716760"></a>A <code>Serializable</code> class can define a <code>writeObject()</code> method to write
data other than that written by the default serialization mechanism.
An <code>Externalizable</code> class defines a <code>writeExternal()</code> method
responsible for writing the complete state of an object to the
serialization stream. The <code>@serialData</code> tag should be used in the doc
comments for these <code>writeObject()</code> and <code>writeExternal()</code> methods, and
the <em><code>description</code></em> should document the serialization format used by
the method.<a data-startref="ix_ch07-asciidoc8" data-type="indexterm" id="9_idm45941149664216"></a><a data-startref="ix_ch07-asciidoc7" data-type="indexterm" id="9_idm45941149663544"></a><a data-startref="ix_ch07-asciidoc6" data-type="indexterm" id="9_idm45941149662872"></a></p>
</dd>
</dl>
</div></section>













<section data-pdf-bookmark="Inline Doc-Comment Tags" data-type="sect2"><div class="sect2" id="idm45941117087576">
<h2>Inline Doc-Comment Tags</h2>

<p><a data-primary="doc comments" data-secondary="inline tags" data-type="indexterm" id="9_idm45941149661432"></a><a data-primary="inline doc-comment tags" data-type="indexterm" id="9_idm45941149660456"></a><a data-primary="tags" data-secondary="inline doc-comment" data-type="indexterm" id="9_idm45941149659784"></a>In addition to the preceding tags, <code>javadoc</code> also supports several
<em>inline tags</em> that may appear anywhere that HTML text appears in a doc
comment. Because these tags appear directly within the flow of HTML
text, they require the use of curly braces as delimiters to separate the
tagged text from the HTML text. Supported inline tags include the
following:</p>
<dl>
<dt><code>{@link</code> <em><code>reference</code></em> <code>}</code></dt>
<dd>
<p><a data-primary="@link doc-comment tag" data-primary-sortas="link doc-comment tag" data-type="indexterm" id="9_idm45941116690024"></a>The <code>{@link}</code> tag is like the <code>@see</code> tag except that instead of
placing a link to the specified <em><code>reference</code></em> in a special 鈥淪ee Also:鈥?
section, it inserts the link inline. An <code>{@link}</code> tag can appear
anywhere that HTML text appears in a doc comment. In other words, it
can appear in the initial description of the class, interface, method,
or field and in the descriptions associated with the <code>@param</code>,
<code>@returns</code>, <code>@exception</code>, and <code>@deprecated</code> tags. The <em><code>reference</code></em>
for the <code>{@link}</code> tag uses the syntax described next in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch07.html#javanut7-CHP-7-SECT-3.4">鈥淐ross-References in Doc Comments鈥?/a&gt;. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="nd">@param</code> <code class="n">regexp</code> <code class="n">The</code> <code class="n">regular</code> <code class="n">expression</code> <code class="n">to</code> <code class="n">search</code> <code class="k">for</code><code class="o">.</code> <code class="n">This</code> <code class="n">string</code>
              <code class="n">argument</code> <code class="n">must</code> <code class="n">follow</code> <code class="n">the</code> <code class="n">syntax</code> <code class="n">rules</code> <code class="n">described</code> <code class="k">for</code>
              <code class="o">{</code><code class="nd">@link</code> <code class="n">java</code><code class="o">.</code><code class="na">util</code><code class="o">.</code><code class="na">regex</code><code class="o">.</code><code class="na">Pattern</code><code class="o">}.</code></pre>
</dd>
<dt><code>{@linkplain</code> <em><code>reference</code></em> <code>}</code></dt>
<dd>
<p><a data-primary="@linkplain doc-comment tag" data-primary-sortas="linkplain doc-comment tag" data-type="indexterm" id="9_idm45941116608632"></a>The <code>{@linkplain}</code> tag is just like the <code>{@link}</code> tag, except that
the text of the link is formatted using the normal font rather than
the code font used by the <code>{@link}</code> tag. This is most useful when
<em><code>reference</code></em> contains both a <em><code>feature</code></em> to link to and a <em><code>label</code></em>
that specifies alternate text to be displayed in the link. See
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch07.html#javanut7-CHP-7-SECT-3.4">鈥淐ross-References in Doc Comments鈥?/a&gt; for more on the
<span class="keep-together"><em><code>feature</code></em></span> and <em><code>label</code></em> portions of the <em><code>reference</code></em> argument.</p>
</dd>
<dt><code>{@inheritDoc}</code></dt>
<dd>
<p><a data-primary="@inheritDoc doc-comment tag" data-primary-sortas="inheritDoc doc-comment tag" data-type="indexterm" id="9_idm45941116600248"></a>When a method overrides a method in a superclass or implements a
method in an interface, you can omit a doc comment, and <code>javadoc</code>
automatically inherits the documentation from the overridden or
implemented method. You can use the <code>{@inheritDoc}</code> tag to inherit the
text of individual tags. This tag also allows you to inherit and
augment the descriptive text of the comment. To inherit individual
tags, use it like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="nd">@param</code> <code class="n">index</code> <code class="o">{</code><code class="nd">@inheritDoc</code><code class="o">}</code>
<code class="nd">@return</code> <code class="o">{</code><code class="nd">@inheritDoc</code><code class="o">}</code></pre>
</dd>
<dt><code>{@docRoot}</code></dt>
<dd>
<p><a data-primary="@docRoot doc-comment tag" data-primary-sortas="docRoot doc-comment tag" data-type="indexterm" id="9_idm45941116589576"></a>This inline tag takes no parameters and is replaced with a reference
to the root directory of the generated documentation. It is useful in
hyperlinks that refer to an external file, such as an image or a
copyright statement:</p>

<pre data-code-language="java" data-type="programlisting"><code class="o">&lt;</code><code class="n">img</code> <code class="n">src</code><code class="o">=</code><code class="s">{@docroot}/images/logo.gif</code><code class="o">&gt;</code>
<code class="n">This</code> <code class="n">is</code> <code class="o">&lt;</code><code class="n">a</code> <code class="n">href</code><code class="o">=</code><code class="s">{@docRoot}/legal.html</code><code class="o">&gt;</code><code class="n">Copyrighted</code><code class="o">&lt;/</code><code class="n">a</code><code class="o">&gt;</code> <code class="n">material</code><code class="o">.</code></pre>
</dd>
<dt><code>{@literal</code> <em><code>text</code></em> <code>}</code></dt>
<dd>
<p><a data-primary="@literal doc-comment tag" data-primary-sortas="literal doc-comment tag" data-type="indexterm" id="9_idm45941116504520"></a>This inline tag displays <em><code>text</code></em> literally, escaping any HTML in it
and ignoring any <code>javadoc</code> tags it may contain. It does not retain
whitespace formatting but is useful when used within a <code>&lt;pre&gt;</code> tag.</p>
</dd>
<dt><code>{@code</code> <em><code>text</code></em> <code>}</code></dt>
<dd>
<p><a data-primary="@code doc-comment tag" data-primary-sortas="code doc-comment tag" data-type="indexterm" id="9_idm45941116499624"></a>This tag is like the <code>{@literal}</code> tag, but displays the literal
<em><code>text</code></em> in code font. Equivalent to:</p>

<pre data-code-language="java" data-type="programlisting"><code class="o">&amp;</code><code class="n">lt</code><code class="o">;</code><code class="n">code</code><code class="o">&amp;</code><code class="n">gt</code><code class="o">;{</code><code class="nd">@literal</code> <code class="o">&lt;</code><code class="n">replaceable</code><code class="o">&gt;</code><code class="n">text</code><code class="o">&lt;/</code><code class="n">replaceable</code><code class="o">&gt;}&amp;</code><code class="n">lt</code><code class="o">;/</code><code class="n">code</code><code class="o">&amp;</code><code class="n">gt</code><code class="o">;</code></pre>
</dd>
<dt><code>{@value}</code></dt>
<dd>
<p><a data-primary="@value doc-comment tag" data-primary-sortas="value doc-comment tag" data-type="indexterm" id="9_idm45941116450312"></a>The <code>{@value}</code> tag, with no arguments, is used inline in doc comments
for <code>static final</code> fields and is replaced with the constant value of
that field.</p>
</dd>
<dt><code>{@value</code> <em><code>reference</code></em> <code>}</code></dt>
<dd>
<p>This variant of the <code>{@value}</code> tag includes a <em><code>reference</code></em> to a
<code>static final</code> field and is replaced with the constant value of that
field.</p>
</dd>
</dl>
</div></section>













<section data-pdf-bookmark="Cross-References in Doc Comments" data-type="sect2"><div class="sect2" id="javanut7-CHP-7-SECT-3.4">
<h2>Cross-References in Doc Comments</h2>

<p><a data-primary="cross-references, in doc comments" data-type="indexterm" id="9_ix_ch07-asciidoc9"></a><a data-primary="doc comments" data-secondary="cross-references in" data-type="indexterm" id="9_ix_ch07-asciidoc10"></a>The <a data-primary="@link doc-comment tag" data-primary-sortas="link doc-comment tag" data-type="indexterm" id="9_idm45941116440088"></a><a data-primary="@linkplain doc-comment tag" data-primary-sortas="linkplain doc-comment tag" data-type="indexterm" id="9_idm45941116439112"></a><a data-primary="@see doc-comment tag" data-primary-sortas="see doc-comment tag" data-type="indexterm" id="9_idm45941116438232"></a><code>@see</code> tag and the inline tags <code>{@link}</code>, <code>{@linkplain}</code>, and
<code>{@value}</code> all encode a cross-reference to some other source of
documentation, typically to the documentation comment for some other
type or member.</p>

<p><em><code>reference</code></em> can take three different forms. If it begins with a quote
character, it is taken to be the name of a book or some other printed
resource and is displayed as is. If <em><code>reference</code></em> begins with a &lt;
character, it is taken to be an arbitrary HTML hyperlink that uses the
<code>&lt;a&gt;</code> tag and the hyperlink is inserted into the output documentation
as is. This form of the <code>@see</code> tag can insert links to other online
documents, such as a programmer鈥檚 guide or user鈥檚 manual.</p>

<p>If <em><code>reference</code></em> is not a quoted string or a hyperlink, it is expected
to have the following form:</p>
<pre data-code-language="java" data-type="programlisting"><em><code class="n">feature</code></em><code> </code><code class="o">[</code><em><code class="n">label</code></em><code class="o">]</code><code>
</code></pre>

<p>In this case, <code>javadoc</code> outputs the text specified by <em><code>label</code></em> and
encodes it as a hyperlink to the specified <em><code>feature</code></em>. If <em><code>label</code></em> is
omitted (as it usually is), <code>javadoc</code> uses the name of the specified
<em><code>feature</code></em> instead.</p>

<p><em><code>feature</code></em> can refer to a package, type, or type member, using one of
the following forms:</p>
<dl>
<dt><em><code>pkgname</code></em></dt>
<dd>
<p>A reference to the named package. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="nd">@see</code> <code class="n">java</code><code class="o">.</code><code class="na">lang</code><code class="o">.</code><code class="na">reflect</code></pre>
</dd>
<dt><em><code>pkgname</code></em>.<em><code>typename</code></em></dt>
<dd>
<p>A reference to a class, interface, enumerated type, or annotation type
specified with its full package name. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="nd">@see</code> <code class="n">java</code><code class="o">.</code><code class="na">util</code><code class="o">.</code><code class="na">List</code></pre>
</dd>
<dt><em><code>typename</code></em></dt>
<dd>
<p>A reference to a type specified without its package name. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="nd">@see</code> <code class="n">List</code></pre>

<p><code>javadoc</code> resolves this reference by searching the current package and
the list of imported classes for a class with this name.</p>
</dd>
<dt><em><code>typename</code></em> <code>#</code> <em><code>methodname</code></em></dt>
<dd>
<p>A reference to a named method or constructor within the specified
type. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="nd">@see</code> <code class="n">java</code><code class="o">.</code><code class="na">io</code><code class="o">.</code><code class="na">InputStream</code><code class="err">#</code><code class="n">reset</code>
<code class="nd">@see</code> <code class="n">InputStream</code><code class="err">#</code><code class="n">close</code></pre>

<p>If the type is specified without its package name, it is resolved as
described for <em><code>typename</code></em>. This syntax is ambiguous if the method is
overloaded or the class defines a field by the same name.</p>
</dd>
<dt><em><code>typename</code></em> <code>#</code> <em><code>methodname</code></em> <code>(</code> <em><code>paramtypes</code></em> <code>)</code></dt>
<dd>
<p>A reference to a method or constructor with the type of its parameters
explicitly specified. This is useful when cross-referencing an
overloaded method. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="nd">@see</code> <code class="n">InputStream</code><code class="err">#</code><code class="n">read</code><code class="o">(</code><code class="kt">byte</code><code class="o">[],</code> <code class="kt">int</code><code class="o">,</code> <code class="kt">int</code><code class="o">)</code></pre>
</dd>
<dt><code>#</code> <em><code>methodname</code></em></dt>
<dd>
<p>A reference to a nonoverloaded method or constructor in the current
class or interface or one of the containing classes, superclasses, or
superinterfaces of the current class or interface. Use this concise
form to refer to other methods in the same class. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="nd">@see</code> <code class="err">#</code><code class="n">setBackgroundColor</code></pre>
</dd>
<dt><code>#</code> <em><code>methodname</code></em> <code>(</code> <em><code>paramtypes</code></em> <code>)</code></dt>
<dd>
<p>A reference to a method or constructor in the current class or
interface or one of its superclasses or containing classes. This form
works with overloaded methods because it lists the types of the method
parameters explicitly. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="nd">@see</code> <code class="err">#</code><code class="n">setPosition</code><code class="o">(</code><code class="kt">int</code><code class="o">,</code> <code class="kt">int</code><code class="o">)</code></pre>
</dd>
<dt><em><code>typename</code></em> <code>#</code> <em><code>fieldname</code></em></dt>
<dd>
<p>A reference to a named field within the specified class. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="nd">@see</code> <code class="n">java</code><code class="o">.</code><code class="na">io</code><code class="o">.</code><code class="na">BufferedInputStream</code><code class="err">#</code><code class="n">buf</code></pre>

<p>If the type is specified without its package name, it is resolved as
described for <em><code>typename</code></em>.</p>
</dd>
<dt><code>#</code> <em><code>fieldname</code></em></dt>
<dd>
<p>A reference to a field in the current type or one of the containing
classes, superclasses, or superinterfaces of the current type. For
example:<a data-startref="ix_ch07-asciidoc10" data-type="indexterm" id="9_idm45941116243112"></a><a data-startref="ix_ch07-asciidoc9" data-type="indexterm" id="9_idm45941116242520"></a></p>

<pre data-code-language="java" data-type="programlisting"><code class="nd">@see</code> <code class="err">#</code><code class="n">x</code></pre>
</dd>
</dl>
</div></section>













<section data-pdf-bookmark="Doc Comments for Packages" data-type="sect2"><div class="sect2" id="idm45941116401272">
<h2>Doc Comments for Packages</h2>

<p><a data-primary="doc comments" data-secondary="for packages" data-type="indexterm" id="9_idm45941116172392"></a><a data-primary="packages" data-secondary="doc comments for" data-type="indexterm" id="9_idm45941116120856"></a>Documentation comments for classes, interfaces, methods, constructors,
and fields appear in Java source code immediately before the definitions
of the features they document. <code>javadoc</code> can also read and display
summary documentation for packages. <a data-primary="javadoc" data-secondary="package documentation" data-type="indexterm" id="9_idm45941116119208"></a>Because a package is defined in a
directory, not in a single file of source code, <code>javadoc</code> looks for the
package documentation in a file named <em>package.html</em> in the directory
that contains the source code for the classes of the package.</p>

<p>The <em>package.html</em> file should contain simple HTML documentation for the
package. It can also contain <code>@see</code>, <code>@link</code>, <code>@deprecated</code>, and
<code>@since</code> tags. Because <em>package.html</em> is not a file of Java source code,
the documentation it contains should be HTML and should <em>not</em> be a Java
comment (i.e., it should not be enclosed within <code>/**</code> and <code>*/</code>
characters). Finally, any <code>@see</code> and <code>@link</code> tags that appear in
<em>package.html</em> must use fully qualified class names.</p>

<p>In addition to defining a <em>package.html</em> file for each package, you can
also provide high-level documentation for a group of packages by
defining an <em>overview.html</em> file in the source tree for those packages.
When <code>javadoc</code> is run over that source tree, it uses <em>overview.html</em> as
the highest-level overview it displays.<a data-startref="ix_ch07-asciidoc5" data-type="indexterm" id="9_idm45941116146360"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Doclets" data-type="sect1"><div class="sect1" id="idm45941117236856">
<h1>Doclets</h1>

<p><a data-primary="conventions, programming/documentation" data-secondary="doclets" data-type="indexterm" id="9_idm45941116144120"></a><a data-primary="doclets" data-type="indexterm" id="9_idm45941116143016"></a><a data-primary="javadoc" data-secondary="doclets" data-type="indexterm" id="9_idm45941116142344"></a>The <code>javadoc</code> tool that is used to generate HTML documentation is based upon a standard API.
Since Java 9, this standard interface has been delivered in the module <code>jdk.javadoc</code> and tools leveraging this API are typically called <em>doclets</em> (with <code>javadoc</code> being referred to as the standard doclet).</p>

<p><a data-primary="Java 9" data-secondary="doclet upgrade" data-type="indexterm" id="9_idm45941116139128"></a>The Java 9 release also included a major upgrade of the standard doclet.
In particular, it now (as of Java 10) generates modern HTML5 by default.
This allows for other impovements鈥攕uch as implementing the <a href="http://www.w3.org/WAI/intro/aria">WAI-ARIA standard</a> for accessibility.
This standard makes it easier for people with visual or other impairments to access <code>javadoc</code> output using tools such as screen readers.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><code>javadoc</code> has also been enhanced to understand the new platform modules, and so the semantic meaning of what constitutes an API (and so what should be documented) is now aligned with the modular Java definition.</p>
</div>

<p>The standard doclet now also automatically indexes the code as documentation is generated, and creates a client-side index in JavaScript.
The resulting web pages have a search capability to allow developers to easily find some common program components, such as the names of:</p>

<ul>
<li>
<p>Modules</p>
</li>
<li>
<p>Packages</p>
</li>
<li>
<p>Types and members</p>
</li>
<li>
<p>Method parameter types</p>
</li>
</ul>

<p>The developer can also add search terms or phrases using an <code>@index</code> inline <code>javadoc</code> tag.<a data-startref="ix_ch07-asciidoc4" data-type="indexterm" id="9_idm45941116088200"></a><a data-startref="ix_ch07-asciidoc3" data-type="indexterm" id="9_idm45941116087464"></a></p>
</div></section>













<section data-pdf-bookmark="Conventions for Portable Programs" data-type="sect1"><div class="sect1" id="idm45941116086664">
<h1>Conventions for Portable Programs</h1>

<p><a data-primary="conventions, programming/documentation" data-secondary="portable code conventions" data-type="indexterm" id="9_ix_ch07-asciidoc11"></a><a data-primary="portable code, conventions for" data-type="indexterm" id="9_ix_ch07-asciidoc12"></a>One of the earliest slogans for Java was 鈥渨rite once, run anywhere.鈥?
This emphasizes that Java makes it easy to write portable programs, but
it is still possible to write Java programs that do not automatically
run successfully on any Java platform. The following tips help to avoid
portability problems:</p>
<dl>
<dt>Native methods</dt>
<dd>
<p><a data-primary="methods" data-secondary="native" data-type="indexterm" id="9_idm45941116080968"></a><a data-primary="native methods" data-secondary="portable programs and" data-type="indexterm" id="9_idm45941116079992"></a>Portable Java code can use any methods in the core Java APIs,
including methods implemented as <code>native</code> methods. However, portable
code must not define its own native methods. By their very nature,
native methods must be ported to each new platform, so they directly
subvert the 鈥渨rite once, run anywhere鈥?promise of Java.</p>
</dd>
<dt>The <code>Runtime.exec()</code> method</dt>
<dd>
<p><a data-primary="Runtime.exec()" data-type="indexterm" id="9_idm45941116076552"></a>Calling the <code>Runtime.exec()</code> method to spawn a process and execute an
external command on the native system is rarely allowed in portable
code. This is because the native OS command to be executed is never
guaranteed to exist or behave the same way on all platforms.</p>

<p>The only time it is legal to use <code>Runtime.exec()</code> in portable code is when the user is allowed to specify the command to run, either by typing the command at runtime or by specifying the command in a configuration file or preferences dialog box.</p>

<p>If the programmer wishes to control external processes, then this should be done through the enhanced <code>ProcessHandle</code> capability introduced in Java 9, rather than by using <code>Runtime.exec()</code> and parsing the output.
This is not fully portable, but at least reduces the amount of platform-specific logic necessary to control external processes.</p>
</dd>
<dt>The <code>System.getenv()</code> method</dt>
<dd>
<p><a data-primary="System.getenv()" data-type="indexterm" id="9_idm45941116070776"></a>Using <code>System.getenv()</code> is inherently nonportable.</p>
</dd>
<dt>Undocumented classes</dt>
<dd>
<p>Portable Java code must use only classes and interfaces that are a
documented part of the Java platform. Most Java implementations ship
with additional undocumented public classes that are part of the
implementation but not part of the Java platform specification.</p>

<p>The modules system prevents a program from using and relying on these
implementation classes, but as of Java 11 it is still possible to circumvent this protection by using reflection or runtime switches.</p>

<p>However, doing so is not portable because the implementation classes are not guaranteed to exist in all Java implementations or on all platforms, and they may change or disappear in future versions of the implementation that they target.</p>

<p>Of particular note is the <code>sun.misc.Unsafe</code> class, which provides
access to a number of 鈥渦nsafe鈥?methods, which can allow developers to
circumvent a number of key restrictions of the Java platform.
Developers should not make direct use of the <code>Unsafe</code> class under any
circumstances.</p>
</dd>
<dt>Implementation-specific features</dt>
<dd>
<p><a data-primary="implementation-specific code" data-type="indexterm" id="9_idm45941116063848"></a>Portable code must not rely on features specific to a single
implementation.
For example, in the early years of Java, Microsoft distributed a version of the Java runtime system that included a number of additional methods that were not part of the Java platform as defined by the specifications.
Any program that depends on such extensions is obviously not portable to other platforms.</p>
</dd>
<dt>Implementation-specific bugs</dt>
<dd>
<p>Just as portable code must not depend on implementation-specific features, it must not depend on implementation-specific bugs.
If a class or method behaves differently than the specification says it should, a portable program cannot rely on this behavior, which may be different on different platforms, and ultimately may be fixed.</p>
</dd>
<dt>Implementation-specific behavior</dt>
<dd>
<p>Sometimes different platforms and different implementations present different behaviors, all of which are legal according to the Java specification.
Portable code must not depend on any one specific behavior.
For example, the Java specification does not indicate whether threads of equal priority share the CPU or if one long-running thread can starve another thread at the same priority.
If an application assumes one behavior or the other, it may not run properly on all platforms.</p>
</dd>
<dt>Defining system classes</dt>
<dd>
<p><a data-primary="system classes" data-type="indexterm" id="9_idm45941116057944"></a>Portable Java code never attempts to define classes in any of the system or standard extension packages. Doing so violates the protection boundaries of those packages and exposes package-visible implementation details, even in those cases where it is not forbidden by the modules system.</p>
</dd>
<dt>Hardcoded filenames</dt>
<dd>
<p><a data-primary="filenames, hardcoded" data-type="indexterm" id="9_idm45941116055656"></a>A portable program contains no hardcoded file or directory names.
This is because different platforms have significantly different
filesystem organizations and use different directory separator
characters. If you need to work with a file or directory, have the
user specify the filename, or at least the base directory beneath
which the file can be found. This specification can be done at
runtime, in a configuration file, or as a command-line argument to the
program. When concatenating a file or directory name to a directory
name, use the <code>File()</code> constructor or the <code>File.separator</code> constant.</p>
</dd>
<dt>Line separators</dt>
<dd>
<p><a data-primary="line separators" data-type="indexterm" id="9_idm45941116052216"></a>Different systems use different characters or sequences of characters
as line separators. Do not hardcode <code>\n</code>, <code>\r</code>, or <code>\r\n</code> as the line
separator in your program. Instead, use the <code>println()</code> method of
<code>PrintStream</code> or <code>PrintWriter</code>, which automatically terminates a line
with the line separator appropriate for the platform, or use the value
of the <code>line.separator</code> system property. <a data-primary="format()" data-secondary="line separators" data-type="indexterm" id="9_idm45941116047784"></a><a data-primary="Formatter class" data-type="indexterm" id="9_idm45941116046776"></a><a data-primary="java.util.Formatter" data-type="indexterm" id="9_idm45941116046104"></a><a data-primary="printf()" data-type="indexterm" id="9_idm45941116045432"></a><a data-primary="println()" data-secondary="line separators and" data-type="indexterm" id="9_idm45941116044760"></a>You can also use the 鈥?n鈥?
format string to <code>printf()</code> and <code>format()</code> methods of
<code>java.util.Formatter</code> and related classes<a data-startref="ix_ch07-asciidoc12" data-type="indexterm" id="9_idm45941116042344"></a><a data-startref="ix_ch07-asciidoc11" data-type="indexterm" id="9_idm45941116041608"></a>.<a data-startref="ix_ch07-asciidoc0" data-type="indexterm" id="9_idm45941116040808"></a></p>
</dd>
</dl>
</div>
</section>
      </div>
      </section></div></div>
    </section>
  </div>
</div>

<hr/>

<!--if IE]><![endif]--><!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/java-in-a/9781492037248/ch08.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="3866890"
  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"
  data-username="levinxccai"
  data-account-type="B2B"
  
  data-activated-trial-date="11/06/2017"


  data-archive="9781492037248"
  data-publishers="O&#39;Reilly Media, Inc."



  data-htmlfile-name="ch08.html"
  data-epub-title="Java in a Nutshell, 7th Edition" data-debug=0 data-testing=0><![endif]--><!--if gt IE 8]><!--><!--![endif]-->



<a name="10_"></a>
<div id="MathJax_Message" style="display: none;"></div>
<div class="application" id="container" style="height: auto;">
  <div class="js-toc">
    <section role="document">
      <div id="sbo-rt-content" style="max-width:72.5em; transform: none;"><div class="annotator-wrapper"><section data-nutshell-tab="Java Collections" data-pdf-bookmark="Chapter 8. Working with Java Collections" data-type="chapter" epub:type="chapter"><div class="chapter" id="javanut7-CHP-8">
<h1><span class="label">Chapter 8. </span>Working with Java Collections</h1>


<p><a data-primary="collections" data-type="indexterm" id="10_ix_ch08-asciidoc0"></a>This chapter introduces Java鈥檚 interpretation of fundamental data
structures, known as the Java Collections. These abstractions are core
to many (if not most) programming types, and form an essential part of
any programmer鈥檚 basic toolkit. Accordingly, this is one of the most
important chapters of the entire book, and provides a toolkit that is
essential to virtually all Java programmers.</p>

<p>In this chapter, we will introduce the fundamental interfaces and the
type hierarchy, show how to use them, and discuss aspects of their
overall design. Both the 鈥渃lassic鈥?approach to handling the Collections
and the newer approach (using the Streams API and the lambda expressions
functionality introduced in Java 8) will be covered.</p>






<section data-pdf-bookmark="Introduction to Collections API" data-type="sect1"><div class="sect1" id="idm45941116036280">
<h1>Introduction to Collections API</h1>

<p><a data-primary="collections" data-secondary="basics" data-type="indexterm" id="10_ix_ch08-asciidoc1"></a>The Java Collections are a set of generic interfaces that describe the
most common forms of data structure. Java ships with several
implementations of each of the classic data structures, and because the
types are represented as interfaces, it is very possible for development
teams to develop their own, specialized implementations of the
interfaces for use in their own projects.</p>

<p>The Java Collections define two fundamental types of data structures. A
<code>Collection</code> is a grouping of objects, while a <code>Map</code> is a set of
mappings, or associations, between objects. The basic layout of the Java
Collections is shown in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch08.html#javanut7-CHP-8-FIG-1">Figure 8-1</a>.</p>

<p>Within this basic description, a <code>Set</code> is a type of <code>Collection</code> with no
duplicates, and a <code>List</code> is a <code>Collection</code> in which the elements are
ordered (but may contain <span class="keep-together">duplicates</span>).</p>

<figure><div class="figure" id="javanut7-CHP-8-FIG-1">
<img alt="JN7 0801" data-mfp-src="/library/view/java-in-a/9781492037248/assets/jns7_0801.png" height="743" src="https://learning.oreilly.com/library/view/java-in-a/9781492037248/assets/jns7_0801.png" width="1436"/>
<h6><span class="label">Figure 8-1. </span>Collections classes and inheritance</h6>
</div></figure>

<p><code>SortedSet</code> and <code>SortedMap</code> are specialized sets and maps that maintain
their elements in a sorted order.</p>

<p><code>Collection</code>, <code>Set</code>, <code>List</code>, <code>Map</code>, <code>SortedSet</code>, and <code>SortedMap</code> are all
interfaces, but the <a data-primary="java.util package" data-secondary="Set implementations" data-type="indexterm" id="10_idm45941116021368"></a><code>java.util</code> package also defines various concrete
implementations, such as lists based on arrays and linked lists, and
maps and sets based on hash tables or binary trees. Other important
interfaces are <code>Iterator</code> and <code>Iterable</code>, which allow you to loop
through the objects in a collection, as we will see later on.</p>








<section data-pdf-bookmark="The Collection Interface" data-type="sect2"><div class="sect2" id="idm45941116018936">
<h2>The Collection Interface</h2>

<p><a data-primary="Collection interface" data-type="indexterm" id="10_ix_ch08-asciidoc2"></a><a data-primary="collections" data-secondary="Collection interface" data-type="indexterm" id="10_ix_ch08-asciidoc3"></a><code>Collection&lt;E&gt;</code> is a parameterized interface that represents a generalized grouping of objects of type <code>E</code>. We can create a collection of any kind of reference type.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>To work properly with the expectations of collections, you must take care when defining <code>hashCode()</code> and <code>equals()</code> methods, as discussed in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch05.html#javanut7-CHP-5">Chapter 5</a>.</p>
</div>

<p>Methods are defined for adding and removing objects from the group, testing an object for membership in the group, and iterating through all elements in the group.
Additional methods return the elements of the group as an array and return the size of the collection.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The grouping within a <code>Collection</code> may or may not allow duplicate
elements and may or may not impose an ordering on the elements.</p>
</div>

<p>The Java Collections Framework provides <code>Collection</code> because it defines
the features shared by all common forms of data structure. The JDK
ships <code>Set</code>, <code>List</code>, and <code>Queue</code> as subinterfaces of <code>Collection</code>.
The following code illustrates the operations you can perform on
<code>Collection</code> objects:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Create some collections to work with.</code>
<code class="n">Collection</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">c</code> <code class="o">=</code> <code class="k">new</code> <code class="n">HashSet</code><code class="o">&lt;&gt;();</code>  <code class="c1">// An empty set</code>

<code class="c1">// We&apos;ll see these utility methods later. Be aware that there are</code>
<code class="c1">// some subtleties to watch out for when using them</code>
<code class="n">Collection</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">d</code> <code class="o">=</code> <code class="n">Arrays</code><code class="o">.</code><code class="na">asList</code><code class="o">(</code><code class="s">one</code><code class="o">,</code> <code class="s">two</code><code class="o">);</code>
<code class="n">Collection</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">e</code> <code class="o">=</code> <code class="n">Collections</code><code class="o">.</code><code class="na">singleton</code><code class="o">(</code><code class="s">three</code><code class="o">);</code>

<code class="c1">// Add elements to a collection. These methods return true</code>
<code class="c1">// if the collection changes, which is useful with Sets that</code>
<code class="c1">// don&apos;t allow duplicates.</code>
<code class="n">c</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="s">zero</code><code class="o">);</code>           <code class="c1">// Add a single element</code>
<code class="n">c</code><code class="o">.</code><code class="na">addAll</code><code class="o">(</code><code class="n">d</code><code class="o">);</code>             <code class="c1">// Add all of the elements in d</code>

<code class="c1">// Copy a collection: most implementations have a copy constructor</code>
<code class="n">Collection</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">copy</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;(</code><code class="n">c</code><code class="o">);</code>

<code class="c1">// Remove elements from a collection.</code>
<code class="c1">// All but clear return true if the collection changes.</code>
<code class="n">c</code><code class="o">.</code><code class="na">remove</code><code class="o">(</code><code class="s">zero</code><code class="o">);</code>        <code class="c1">// Remove a single element</code>
<code class="n">c</code><code class="o">.</code><code class="na">removeAll</code><code class="o">(</code><code class="n">e</code><code class="o">);</code>          <code class="c1">// Remove a collection of elements</code>
<code class="n">c</code><code class="o">.</code><code class="na">retainAll</code><code class="o">(</code><code class="n">d</code><code class="o">);</code>          <code class="c1">// Remove all elements that are not in d</code>
<code class="n">c</code><code class="o">.</code><code class="na">clear</code><code class="o">();</code>               <code class="c1">// Remove all elements from the collection</code>

<code class="c1">// Querying collection size</code>
<code class="kt">boolean</code> <code class="n">b</code> <code class="o">=</code> <code class="n">c</code><code class="o">.</code><code class="na">isEmpty</code><code class="o">();</code> <code class="c1">// c is now empty, so true</code>
<code class="kt">int</code> <code class="n">s</code> <code class="o">=</code> <code class="n">c</code><code class="o">.</code><code class="na">size</code><code class="o">();</code>        <code class="c1">// Size of c is now 0.</code>

<code class="c1">// Restore collection from the copy we made</code>
<code class="n">c</code><code class="o">.</code><code class="na">addAll</code><code class="o">(</code><code class="n">copy</code><code class="o">);</code>

<code class="c1">// Test membership in the collection. Membership is based on the equals</code>
<code class="c1">// method, not the == operator.</code>
<code class="n">b</code> <code class="o">=</code> <code class="n">c</code><code class="o">.</code><code class="na">contains</code><code class="o">(</code><code class="s">zero</code><code class="o">);</code>  <code class="c1">// true</code>
<code class="n">b</code> <code class="o">=</code> <code class="n">c</code><code class="o">.</code><code class="na">containsAll</code><code class="o">(</code><code class="n">d</code><code class="o">);</code>    <code class="c1">// true</code>

<code class="c1">// Most Collection implementations have a useful toString()  method</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">c</code><code class="o">);</code>

<code class="c1">// Obtain an array of collection elements.  If the iterator guarantees</code>
<code class="c1">// an order, this array has the same order. The array is a copy, not a</code>
<code class="c1">// reference to an internal data structure.</code>
<code class="n">Object</code><code class="o">[]</code> <code class="n">elements</code> <code class="o">=</code> <code class="n">c</code><code class="o">.</code><code class="na">toArray</code><code class="o">();</code>

<code class="c1">// If we want the elements in a String[], we must pass one in</code>
<code class="n">String</code><code class="o">[]</code> <code class="n">strings</code> <code class="o">=</code> <code class="n">c</code><code class="o">.</code><code class="na">toArray</code><code class="o">(</code><code class="k">new</code> <code class="n">String</code><code class="o">[</code><code class="n">c</code><code class="o">.</code><code class="na">size</code><code class="o">()]);</code>

<code class="c1">// Or we can pass an empty String[] just to specify the type and</code>
<code class="c1">// the toArray method will allocate an array for us</code>
<code class="n">strings</code> <code class="o">=</code> <code class="n">c</code><code class="o">.</code><code class="na">toArray</code><code class="o">(</code><code class="k">new</code> <code class="n">String</code><code class="o">[</code><code class="mi">0</code><code class="o">]);</code></pre>

<p>Remember that you can use any of the methods shown here with any <code>Set</code>,
<code>List</code>, or <code>Queue</code>. These subinterfaces may impose membership
restrictions or ordering constraints on the elements of the collection
but still provide the same basic methods.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Methods such as <code>addAll()</code>, <code>retainAll()</code>, <code>clear()</code>, and <code>remove()</code> that
alter the collection were conceived of as optional parts of the API.
Unfortunately, they were specified a long time ago, when the received
wisdom was to indicate the absence of an optional method by throwing
<code>UnsupportedOperationException</code>. Accordingly, some implementations
(notably read-only forms) may throw this unchecked exception.</p>
</div>

<p><code>Collection</code>, <code>Map</code>, and their subinterfaces do <em>not</em> extend the interfaces
<code>Cloneable</code> or <code>Serializable</code>. All of the collection and
map implementation classes provided in the Java Collections Framework,
however, do implement these interfaces.</p>

<p>Some collection implementations place restrictions on the elements that
they can contain. An implementation might prohibit <code>null</code> as an element,
for example. And <code>EnumSet</code> restricts membership to the values of a
specified enumerated type.</p>

<p>Attempting to add a prohibited element to a collection always throws an
unchecked exception such as <code>NullPointerException</code> or
<code>ClassCastException</code>. Checking whether a collection contains a
prohibited element may also throw such an exception, or it may simply
return <code>false</code>.<a data-startref="ix_ch08-asciidoc3" data-type="indexterm" id="10_idm45941115809304"></a><a data-startref="ix_ch08-asciidoc2" data-type="indexterm" id="10_idm45941115808568"></a></p>
</div></section>













<section data-pdf-bookmark="The Set Interface" data-type="sect2"><div class="sect2" id="idm45941116018344">
<h2>The Set Interface</h2>

<p><a data-primary="collections" data-secondary="Set interface" data-type="indexterm" id="10_ix_ch08-asciidoc4"></a><a data-primary="Set interface" data-type="indexterm" id="10_ix_ch08-asciidoc5"></a>A <em>set</em> is a collection of objects that does not allow duplicates: it
may not contain two references to the same object, two references to
<code>null</code>, or references to two objects <code>a</code> and <code>b</code> such that
<code>a.equals(b)</code>. Most general-purpose <code>Set</code> implementations impose no
ordering on the elements of the set, but ordered sets are not prohibited
(see <code>SortedSet</code> and <code>LinkedHashSet</code>). Sets are further distinguished
from ordered collections like lists by the general expectation that they
have an efficient <code>contains</code> method that runs in constant or
logarithmic time.</p>

<p><code>Set</code> defines no additional methods beyond those defined by
<code>Collection</code> but places additional restrictions on those methods. The
<code>add()</code> and <code>addAll()</code> methods of a <code>Set</code> are required to enforce the
no-duplicates rules: they may not add an element to the <code>Set</code> if the set
already contains that element. Recall that the <code>add()</code> and <code>addAll()</code>
methods defined by the <code>Collection</code> interface return <code>true</code> if the call
resulted in a change to the collection and <code>false</code> if it did not. This
return value is relevant for <code>Set</code> objects because the no-duplicates
restriction means that adding an element does not always result in a
change to the set.</p>

<p><a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch08.html#javanut7-CHP-8-TABLE-2">Table 8-1</a> lists the implementations of the
<code>Set</code> interface and summarizes their internal representation, ordering
characteristics, member restrictions, and the performance of the basic
<code>add()</code>, <code>remove()</code>, and <code>contains</code> operations as well as iteration
performance. You can read more about each class in the reference
section. <a data-primary="CopyOnWriteArraySet class" data-type="indexterm" id="10_idm45941115790504"></a><a data-primary="java.util.concurrent" data-type="indexterm" id="10_idm45941115789736"></a>Note that <code>CopyOnWriteArraySet</code> is in the
<code>java.util.concurrent</code> package; all the other implementations are part
of <code>java.util</code>. Also note that <code>java.util.BitSet</code> is not a <code>Set</code>
implementation. This legacy class is useful as a compact and efficient
list of <code>boolean</code> values but is not part of the Java Collections
Framework.</p>
<div class="landscape">
<table id="javanut7-CHP-8-TABLE-2">
<caption><span class="label">Table 8-1. </span>Set implementations</caption>
<thead>
<tr>
<th>Class</th>
<th>Internal representation</th>
<th>Since</th>
<th>Element order</th>
<th>Member
restric-tions</th>
<th>Basic opera-tions</th>
<th>Iteration perfor-mance</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><code>HashSet</code></p></td>
<td><p>Hashtable</p></td>
<td><p>1.2</p></td>
<td><p>None</p></td>
<td><p>None</p></td>
<td><p>O(1)</p></td>
<td><p>O(capacity)</p></td>
<td><p>Best
general-purpose implementation.</p></td>
</tr>
<tr>
<td><p><code>LinkedHashSet</code></p></td>
<td><p>Linked hashtable</p></td>
<td><p>1.2</p></td>
<td><p>Insertion order</p></td>
<td><p>None</p></td>
<td><p>O(1)</p></td>
<td><p>O(n)</p></td>
<td><p>Preserves insertion order.</p></td>
</tr>
<tr>
<td><p><code>EnumSet</code></p></td>
<td><p>Bit fields</p></td>
<td><p>5.0</p></td>
<td><p>Enum declaration</p></td>
<td><p>Enum values</p></td>
<td><p>O(1)</p></td>
<td><p>O(n)</p></td>
<td><p>Holds non-<code>null</code> enum values only.</p></td>
</tr>
<tr>
<td><p><code>TreeSet</code></p></td>
<td><p>Red-black tree</p></td>
<td><p>1.2</p></td>
<td><p>Sorted ascending</p></td>
<td><p>Comparable</p></td>
<td><p>O(log(n))</p></td>
<td><p>O(n)</p></td>
<td><p><code>Comparable</code> elements or <code>Comparator</code>.</p></td>
</tr>
<tr>
<td><p><code>CopyOnWriteArraySet</code></p></td>
<td><p>Array</p></td>
<td><p>5.0</p></td>
<td><p>Insertion order</p></td>
<td><p>None</p></td>
<td><p>O(n)</p></td>
<td><p>O(n)</p></td>
<td><p>Threadsafe without synchronized methods.</p></td>
</tr>
</tbody>
</table>
</div>

<p><a data-primary="TreeSet class" data-type="indexterm" id="10_idm45941115751640"></a>The <code>TreeSet</code> implementation uses a red-black tree data structure to
maintain a set that is iterated in ascending order according to the
natural ordering of <code>Comparable</code> objects or according to an ordering
specified by a <code>Comparator</code> object. <a data-primary="SortedSet interface" data-type="indexterm" id="10_idm45941115749208"></a><code>TreeSet</code> actually implements the
<code>SortedSet</code> interface, which is a subinterface of <code>Set</code>.</p>

<p>The <code>SortedSet</code> interface offers several interesting methods that take
advantage of its sorted nature. The following code illustrates:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">testSortedSet</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="o">{</code>
    <code class="c1">// Create a SortedSet</code>
    <code class="n">SortedSet</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">s</code> <code class="o">=</code> <code class="k">new</code> <code class="n">TreeSet</code><code class="o">&lt;&gt;(</code><code class="n">Arrays</code><code class="o">.</code><code class="na">asList</code><code class="o">(</code><code class="n">args</code><code class="o">));</code>

    <code class="c1">// Iterate set: elements are automatically sorted</code>
    <code class="k">for</code> <code class="o">(</code><code class="n">String</code> <code class="n">word</code> <code class="o">:</code> <code class="n">s</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">word</code><code class="o">);</code>
    <code class="o">}</code>

    <code class="c1">// Special elements</code>
    <code class="n">String</code> <code class="n">first</code> <code class="o">=</code> <code class="n">s</code><code class="o">.</code><code class="na">first</code><code class="o">();</code>  <code class="c1">// First element</code>
    <code class="n">String</code> <code class="n">last</code> <code class="o">=</code> <code class="n">s</code><code class="o">.</code><code class="na">last</code><code class="o">();</code>    <code class="c1">// Last element</code>

    <code class="c1">// all elements but first</code>
    <code class="n">SortedSet</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">tail</code> <code class="o">=</code> <code class="n">s</code><code class="o">.</code><code class="na">tailSet</code><code class="o">(</code><code class="n">first</code> <code class="o">+</code> <code class="sc">\0</code><code class="o">);</code>
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">tail</code><code class="o">);</code>

    <code class="c1">// all elements but last</code>
    <code class="n">SortedSet</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">head</code> <code class="o">=</code> <code class="n">s</code><code class="o">.</code><code class="na">headSet</code><code class="o">(</code><code class="n">last</code><code class="o">);</code>
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">head</code><code class="o">);</code>

    <code class="n">SortedSet</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">middle</code> <code class="o">=</code> <code class="n">s</code><code class="o">.</code><code class="na">subSet</code><code class="o">(</code><code class="n">first</code><code class="o">+</code><code class="sc">\0</code><code class="o">,</code> <code class="n">last</code><code class="o">);</code>
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">middle</code><code class="o">);</code>
<code class="o">}</code></pre>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>The addition of <code>\0</code> characters is needed because the <code>tailSet()</code> and
related methods use the <em>successor</em> of an element, which for strings is
the string value with a <code>NULL</code> character (ASCII code 0) appended.</p>
</div>

<p>From Java 9 onward, the API has also been upgraded with a helper static method on the <code>Set</code> interface, like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Set</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">set</code> <code class="o">=</code> <code class="n">Set</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="s">Hello</code><code class="o">,</code> <code class="s">World</code><code class="o">);</code></pre>

<p>This API has several overloads that each take a fixed number of arguments, and also a varargs overload.
The latter is used for the case where arbitarily many elements are wanted in the set, and falls back to the standard varargs mechanism (marshaling the elements into an array before the call).<a data-startref="ix_ch08-asciidoc5" data-type="indexterm" id="10_idm45941115510152"></a><a data-startref="ix_ch08-asciidoc4" data-type="indexterm" id="10_idm45941115509544"></a></p>
</div></section>













<section data-pdf-bookmark="The List Interface" data-type="sect2"><div class="sect2" id="idm45941115807304">
<h2>The List Interface</h2>

<p><a data-primary="collections" data-secondary="List interface" data-type="indexterm" id="10_ix_ch08-asciidoc6"></a><a data-primary="List interface" data-type="indexterm" id="10_ix_ch08-asciidoc7"></a>A <code>List</code> is an ordered collection of objects. Each element of a list
has a position in the list, and the <a data-primary="indexes" data-secondary="list" data-type="indexterm" id="10_idm45941115500712"></a><code>List</code> interface defines methods to
query or set the element at a particular position, or <em>index</em>. In this
respect, a <code>List</code> is like an array whose size changes as needed to
accommodate the number of elements it contains. Unlike sets, lists allow
duplicate elements.</p>

<p>In addition to its index-based <code>get()</code> and <code>set()</code> methods, the <code>List</code>
interface defines methods to add or remove an element at a particular
index and also defines methods to return the index of the first or last
occurrence of a particular value in the list. The <code>add()</code> and <code>remove()</code>
methods inherited from <code>Collection</code> are defined to append to the list
and to remove the first occurrence of the specified value from the list.
The inherited <code>addAll()</code> appends all elements in the specified
collection to the end of the list, and another version inserts the
elements at a specified index. The <code>retainAll()</code> and <code>removeAll()</code>
methods behave as they do for any <code>Collection</code>, retaining or removing
multiple occurrences of the same value, if needed.</p>

<p>The <code>List</code> interface does not define methods that operate on a range of
list indexes. <a data-primary="subList()" data-type="indexterm" id="10_idm45941115492056"></a>Instead, it defines a single <code>subList()</code> method that
returns a <code>List</code> object that represents just the specified range of the
original list. The sublist is backed by the parent list, and any changes
made to the sublist are immediately visible in the parent list. Examples
of <code>subList()</code> and the other basic <code>List</code> manipulation methods are shown
here:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Create lists to work with</code>
<code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">l</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;(</code><code class="n">Arrays</code><code class="o">.</code><code class="na">asList</code><code class="o">(</code><code class="n">args</code><code class="o">));</code>
<code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">words</code> <code class="o">=</code> <code class="n">Arrays</code><code class="o">.</code><code class="na">asList</code><code class="o">(</code><code class="s">hello</code><code class="o">,</code> <code class="s">world</code><code class="o">);</code>
<code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">words2</code> <code class="o">=</code> <code class="n">List</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="s">hello</code><code class="o">,</code> <code class="s">world</code><code class="o">);</code>

<code class="c1">// Querying and setting elements by index</code>
<code class="n">String</code> <code class="n">first</code> <code class="o">=</code> <code class="n">l</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="mi">0</code><code class="o">);</code>             <code class="c1">// First element of list</code>
<code class="n">String</code> <code class="n">last</code> <code class="o">=</code> <code class="n">l</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="n">l</code><code class="o">.</code><code class="na">size</code> <code class="o">-</code><code class="mi">1</code><code class="o">);</code>     <code class="c1">// Last element of list</code>
<code class="n">l</code><code class="o">.</code><code class="na">set</code><code class="o">(</code><code class="mi">0</code><code class="o">,</code> <code class="n">last</code><code class="o">);</code>                      <code class="c1">// The last shall be first</code>

<code class="c1">// Adding and inserting elements.  add  can append or insert</code>
<code class="n">l</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="n">first</code><code class="o">);</code>       <code class="c1">// Append the first word at end of list</code>
<code class="n">l</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="mi">0</code><code class="o">,</code> <code class="n">first</code><code class="o">);</code>    <code class="c1">// Insert first at the start of the list again</code>
<code class="n">l</code><code class="o">.</code><code class="na">addAll</code><code class="o">(</code><code class="n">words</code><code class="o">);</code>    <code class="c1">// Append a collection at the end of the list</code>
<code class="n">l</code><code class="o">.</code><code class="na">addAll</code><code class="o">(</code><code class="mi">1</code><code class="o">,</code> <code class="n">words</code><code class="o">);</code> <code class="c1">// Insert collection after first word</code>

<code class="c1">// Sublists: backed by the original list</code>
<code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">sub</code> <code class="o">=</code> <code class="n">l</code><code class="o">.</code><code class="na">subList</code><code class="o">(</code><code class="mi">1</code><code class="o">,</code><code class="mi">3</code><code class="o">);</code>  <code class="c1">// second and third elements</code>
<code class="n">sub</code><code class="o">.</code><code class="na">set</code><code class="o">(</code><code class="mi">0</code><code class="o">,</code> <code class="s">hi</code><code class="o">);</code>                   <code class="c1">// modifies 2nd element of l</code>
<code class="c1">// Sublists can restrict operations to a subrange of backing list</code>
<code class="n">String</code> <code class="n">s</code> <code class="o">=</code> <code class="n">Collections</code><code class="o">.</code><code class="na">min</code><code class="o">(</code><code class="n">l</code><code class="o">.</code><code class="na">subList</code><code class="o">(</code><code class="mi">0</code><code class="o">,</code><code class="mi">4</code><code class="o">));</code>
<code class="n">Collections</code><code class="o">.</code><code class="na">sort</code><code class="o">(</code><code class="n">l</code><code class="o">.</code><code class="na">subList</code><code class="o">(</code><code class="mi">0</code><code class="o">,</code><code class="mi">4</code><code class="o">));</code>
<code class="c1">// Independent copies of a sublist don&apos;t affect the parent list.</code>
<code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">subcopy</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;(</code><code class="n">l</code><code class="o">.</code><code class="na">subList</code><code class="o">(</code><code class="mi">1</code><code class="o">,</code><code class="mi">3</code><code class="o">));</code>

<code class="c1">// Searching lists</code>
<code class="kt">int</code> <code class="n">p</code> <code class="o">=</code> <code class="n">l</code><code class="o">.</code><code class="na">indexOf</code><code class="o">(</code><code class="n">last</code><code class="o">);</code>  <code class="c1">// Where does the last word appear?</code>
<code class="n">p</code> <code class="o">=</code> <code class="n">l</code><code class="o">.</code><code class="na">lastIndexOf</code><code class="o">(</code><code class="n">last</code><code class="o">);</code>  <code class="c1">// Search backward</code>

<code class="c1">// Print the index of all occurrences of last in l.  Note subList</code>
<code class="kt">int</code> <code class="n">n</code> <code class="o">=</code> <code class="n">l</code><code class="o">.</code><code class="na">size</code><code class="o">();</code>
<code class="n">p</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code>
<code class="k">do</code> <code class="o">{</code>
    <code class="c1">// Get a view of the list that includes only the elements we</code>
    <code class="c1">// haven&apos;t searched yet.</code>
    <code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">list</code> <code class="o">=</code> <code class="n">l</code><code class="o">.</code><code class="na">subList</code><code class="o">(</code><code class="n">p</code><code class="o">,</code> <code class="n">n</code><code class="o">);</code>
    <code class="kt">int</code> <code class="n">q</code> <code class="o">=</code> <code class="n">list</code><code class="o">.</code><code class="na">indexOf</code><code class="o">(</code><code class="n">last</code><code class="o">);</code>
    <code class="k">if</code> <code class="o">(</code><code class="n">q</code> <code class="o">==</code> <code class="o">-</code><code class="mi">1</code><code class="o">)</code> <code class="k">break</code><code class="o">;</code>
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">printf</code><code class="o">(</code><code class="s">Found &apos;%s&apos; at index %d%n</code><code class="o">,</code> <code class="n">last</code><code class="o">,</code> <code class="n">p</code><code class="o">+</code><code class="n">q</code><code class="o">);</code>
    <code class="n">p</code> <code class="o">+=</code> <code class="n">q</code><code class="o">+</code><code class="mi">1</code><code class="o">;</code>
<code class="o">}</code> <code class="k">while</code><code class="o">(</code><code class="n">p</code> <code class="o">&lt;</code> <code class="n">n</code><code class="o">);</code>

<code class="c1">// Removing elements from a list</code>
<code class="n">l</code><code class="o">.</code><code class="na">remove</code><code class="o">(</code><code class="n">last</code><code class="o">);</code>         <code class="c1">// Remove first occurrence of the element</code>
<code class="n">l</code><code class="o">.</code><code class="na">remove</code><code class="o">(</code><code class="mi">0</code><code class="o">);</code>            <code class="c1">// Remove element at specified index</code>
<code class="n">l</code><code class="o">.</code><code class="na">subList</code><code class="o">(</code><code class="mi">0</code><code class="o">,</code><code class="mi">2</code><code class="o">).</code><code class="na">clear</code><code class="o">();</code> <code class="c1">// Remove a range of elements using subList</code>
<code class="n">l</code><code class="o">.</code><code class="na">retainAll</code><code class="o">(</code><code class="n">words</code><code class="o">);</code>     <code class="c1">// Remove all but elements in words</code>
<code class="n">l</code><code class="o">.</code><code class="na">removeAll</code><code class="o">(</code><code class="n">words</code><code class="o">);</code>     <code class="c1">// Remove all occurrences of elements in words</code>
<code class="n">l</code><code class="o">.</code><code class="na">clear</code><code class="o">();</code>              <code class="c1">// Remove everything</code></pre>










<section data-pdf-bookmark="Foreach loops and iteration" data-type="sect3"><div class="sect3" id="idm45941115459720">
<h3>Foreach loops and iteration</h3>

<p><a data-primary="foreach loops" data-type="indexterm" id="10_ix_ch08-asciidoc8"></a><a data-primary="iteration" data-secondary="lists" data-type="indexterm" id="10_ix_ch08-asciidoc9"></a><a data-primary="List interface" data-secondary="foreach loops and iteration" data-type="indexterm" id="10_ix_ch08-asciidoc10"></a>One very important way of working with collections is to process each
element in turn, an approach known as <em>iteration</em>. This is an older way
of looking at data structures, but is still very useful (especially for
small collections of data) and is easy to understand. This approach
fits naturally with the <code>for</code> loop, as shown in this bit of code, and is
easiest to illustrate using a <code>List</code>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">ListCollection</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">c</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;();</code>
<code class="c1">// ... add some Strings to c</code>

<code class="k">for</code><code class="o">(</code><code class="n">String</code> <code class="n">word</code> <code class="o">:</code> <code class="n">c</code><code class="o">)</code> <code class="o">{</code>
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">word</code><code class="o">);</code>
<code class="o">}</code></pre>

<p>The sense of the code should be clear鈥攊t takes the elements of <code>c</code> one
at a time and uses them as a variable in the loop body. More formally,
it iterates through the elements of an array or collection (or any
object that implements <code>java.lang.Iterable</code>). On each iteration it
assigns an element of the array or <code>Iterable</code> object to the loop
variable you declare and then executes the loop body, which typically
uses the loop variable to operate on the element. No loop counter or
<code>Iterator</code> object is involved; the loop performs the iteration
automatically, and you need not concern yourself with correct
initialization or termination of the loop.</p>

<p>This type of <code>for</code> loop is often referred to as a <em>foreach loop</em>.
Let鈥檚 see how it works. The following bit of code shows a rewritten (and
equivalent) <code>for</code> loop, with the method calls explicitly shown:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Iteration with a for loop</code>
<code class="k">for</code><code class="o">(</code><code class="n">Iterator</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">i</code> <code class="o">=</code> <code class="n">c</code><code class="o">.</code><code class="na">iterator</code><code class="o">();</code> <code class="n">i</code><code class="o">.</code><code class="na">hasNext</code><code class="o">();)</code> <code class="o">{</code>
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">i</code><code class="o">.</code><code class="na">next</code><code class="o">());</code>
<code class="o">}</code></pre>

<p>The <code>Iterator</code> object, <code>i</code>, is produced from the collection, and used
to step through the collection one item at a time. It can also be used
with <code>while</code> loops:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">//Iterate through collection elements with a while loop.</code>
<code class="c1">//Some implementations (such as lists) guarantee an order of iteration</code>
<code class="c1">//Others make no guarantees.</code>
<code class="n">Iterator</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="nf">iterator</code><code class="o">()</code> <code class="o">=</code> <code class="n">c</code><code class="o">.</code><code class="na">iterator</code><code class="o">();</code>
<code class="k">while</code> <code class="o">(</code><code class="n">iterator</code><code class="o">.</code><code class="na">hasNext</code><code class="o">())</code> <code class="o">{</code>
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">iterator</code><code class="o">.</code><code class="na">next</code><code class="o">());</code>
<code class="o">}</code></pre>

<p>Here are some more things you should know about the syntax of the
foreach loop:</p>

<ul>
<li>
<p><a data-primary="java.lang.Iterable" data-type="indexterm" id="10_idm45941114863624"></a>As noted earlier, <em><code>expression</code></em> must be either an array or an object
that implements the <code>java.lang.Iterable</code> interface. This type must be
known at compile time so that the compiler can generate appropriate
looping code.</p>
</li>
<li>
<p><a data-primary="Iterable interface" data-type="indexterm" id="10_idm45941114860968"></a>The type of the array or <code>Iterable</code> elements must be
assignment-compatible with the type of the variable declared in the
<em><code>declaration</code></em>. If you use an <code>Iterable</code> object that is not
parameterized with an element type, the variable must be declared as an
<code>Object</code>.</p>
</li>
<li>
<p>The <em><code>declaration</code></em> usually consists of just a type and a variable
name, but it may include a <code>final</code> modifier and any appropriate
annotations (see <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4">Chapter 4</a>). Using <code>final</code>
prevents the loop variable from taking on any value other than the array
or collection element the loop assigns it and serves to emphasize that
the array or collection cannot be altered through the loop variable.</p>
</li>
<li>
<p>The loop variable of the foreach loop must be declared as part of the
loop, with both a type and a variable name. You cannot use a variable
declared outside the loop as you can with the <code>for</code> loop.</p>
</li>
</ul>

<p><a data-primary="java.util.Iterable" data-type="indexterm" id="10_idm45941114852744"></a><a data-primary="java.util.Iterator" data-type="indexterm" id="10_idm45941114852040"></a>To understand in detail how the foreach loop works with collections, we
need to consider two interfaces, <code>java.util.Iterator</code> and
<code>java.lang.Iterable</code>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">interface</code> <code class="nc">Iterator</code><code class="o">&lt;</code><code class="n">E</code><code class="o">&gt;</code> <code class="o">{</code>
     <code class="kt">boolean</code> <code class="nf">hasNext</code><code class="o">();</code>
     <code class="n">E</code> <code class="nf">next</code><code class="o">();</code>
     <code class="kt">void</code> <code class="nf">remove</code><code class="o">();</code>
<code class="o">}</code></pre>

<p><code>Iterator</code> defines a way to iterate through the elements of a collection
or other data structure. It works like this: while there are more
elements in the collection (<code>hasNext()</code> returns <code>true</code>), call <code>next</code> to
obtain the next element of the collection. Ordered collections, such as
lists, typically have iterators that guarantee that they鈥檒l return
elements in order. Unordered collections like <code>Set</code> simply guarantee
that repeated calls to <code>next()</code> return all elements of the set without
omissions or duplications but do not specify an ordering.</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p><a data-primary="Iterator interface" data-type="indexterm" id="10_idm45941114799016"></a><a data-primary="next()" data-type="indexterm" id="10_idm45941114798312"></a>The <code>next()</code> method of <code>Iterator</code> performs two functions鈥攊t advances
through the collection and also returns the element of the
collection that we have just moved past. This combination of operations can cause problems when you are programming in a functional
or immutable style, as it mutates the underlying collection.</p>
</div>

<p>The <code>Iterable</code> interface was introduced to make the foreach loop work.
A class implements this interface in order to advertise that it is able
to provide an <code>Iterator</code> to anyone interested:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">interface</code> <code class="nc">Iterable</code><code class="o">&lt;</code><code class="n">E</code><code class="o">&gt;</code> <code class="o">{</code>
     <code class="n">java</code><code class="o">.</code><code class="na">util</code><code class="o">.</code><code class="na">Iterator</code><code class="o">&lt;</code><code class="n">E</code><code class="o">&gt;</code> <code class="nf">iterator</code><code class="o">();</code>
<code class="o">}</code></pre>

<p>If an object is <code>Iterable&lt;E&gt;</code>, that means that it has an
<code>iterator()</code> method that returns an <code>Iterator&lt;E&gt;</code>, which has a <code>next()</code>
method that returns an object of type <code>E</code>.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>If you use the foreach loop with an <code>Iterable&lt;E&gt;</code>, the loop
variable must be of type <code>E</code> or a superclass or interface.</p>
</div>

<p>For example, to iterate through the elements of a <code>List&lt;String&gt;</code>, the
variable must be declared <code>String</code> or its superclass <code>Object</code>, or one of
the interfaces it implements: <code>CharSequence</code>, <code>Comparable</code>, or
<code>Serializable</code>.<a data-startref="ix_ch08-asciidoc10" data-type="indexterm" id="10_idm45941114687048"></a><a data-startref="ix_ch08-asciidoc9" data-type="indexterm" id="10_idm45941114686424"></a><a data-startref="ix_ch08-asciidoc8" data-type="indexterm" id="10_idm45941114685752"></a></p>
</div></section>













<section data-pdf-bookmark="Random access to Lists" data-type="sect3"><div class="sect3" id="idm45941115459128">
<h3>Random access to Lists</h3>

<p><a data-primary="List interface" data-secondary="random access to lists" data-type="indexterm" id="10_idm45941114683800"></a>A general expectation of <code>List</code> implementations is that they can be
efficiently iterated, typically in time proportional to the size of the
list. Lists do not all provide efficient random access to the elements
at any index, however. <a data-primary="LinkedList class" data-type="indexterm" id="10_idm45941114748936"></a>Sequential-access lists, such as the <code>LinkedList</code>
class, provide efficient insertion and deletion operations at the
expense of random-access performance. <a data-primary="RandomAccess interface" data-type="indexterm" id="10_idm45941114747592"></a>Implementations that provide
efficient random access implement the <code>RandomAccess</code> marker interface,
and you can test for this interface with <code>instanceof</code> if you need to
ensure efficient list manipulations:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Arbitrary list we&apos;re passed to manipulate</code>
<code class="n">List</code><code class="o">&lt;?&gt;</code> <code class="n">l</code> <code class="o">=</code> <code class="o">...;</code>

<code class="c1">// Ensure we can do efficient random access.  If not, use a copy</code>
<code class="c1">// constructor to make a random-access copy of the list before</code>
<code class="c1">// manipulating it.</code>
<code class="k">if</code> <code class="o">(!(</code><code class="n">l</code> <code class="k">instanceof</code> <code class="n">RandomAccess</code><code class="o">))</code> <code class="n">l</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;?&gt;(</code><code class="n">l</code><code class="o">);</code></pre>

<p><a data-primary="Iterable interface" data-type="indexterm" id="10_idm45941114655592"></a><a data-primary="iterator()" data-type="indexterm" id="10_idm45941114649896"></a>The <code>Iterator</code> returned by the <code>iterator()</code> method of a <code>List</code> iterates
the list elements in the order that they occur in the list. <code>List</code>
implements <code>Iterable</code>, and lists can be iterated with a foreach loop
just as any other collection can.</p>

<p>To iterate just a portion of a list, you can use the <code>subList()</code> method
to create a sublist view:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">words</code> <code class="o">=</code> <code class="o">...;</code>  <code class="c1">// Get a list to iterate</code>

<code class="c1">// Iterate just all elements of the list but the first</code>
<code class="k">for</code><code class="o">(</code><code class="n">String</code> <code class="n">word</code> <code class="o">:</code> <code class="n">words</code><code class="o">.</code><code class="na">subList</code><code class="o">(</code><code class="mi">1</code><code class="o">,</code> <code class="n">words</code><code class="o">.</code><code class="na">size</code> <code class="o">))</code>
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">word</code><code class="o">);</code></pre>

<p><a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch08.html#javanut7-CHP-8-TABLE-3">Table 8-2</a> summarizes the five
general-purpose <code>List</code> implementations in the Java platform. <code>Vector</code>
and <code>Stack</code> are legacy implementations and should not be used.
<a data-primary="ArrayList class" data-type="indexterm" id="10_idm45941114588328"></a><a data-primary="CopyOnWriteArrayList class" data-type="indexterm" id="10_idm45941114587624"></a><code>CopyOnWriteArrayList</code> is part of the <code>java.util.concurrent</code> package
and is only really suitable for multithreaded use cases.<a data-startref="ix_ch08-asciidoc7" data-type="indexterm" id="10_idm45941114586152"></a><a data-startref="ix_ch08-asciidoc6" data-type="indexterm" id="10_idm45941114585448"></a></p>
<table id="javanut7-CHP-8-TABLE-3">
<caption><span class="label">Table 8-2. </span>List implementations</caption>
<thead>
<tr>
<th>Class</th>
<th>Representation</th>
<th>Since</th>
<th>Random access</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><code>ArrayList</code></p></td>
<td><p>Array</p></td>
<td><p>1.2</p></td>
<td><p>Yes</p></td>
<td><p>Best all-around implementation.</p></td>
</tr>
<tr>
<td><p><code>LinkedList</code></p></td>
<td><p>Double-linked list</p></td>
<td><p>1.2</p></td>
<td><p>No</p></td>
<td><p>Efficient insertion and
deletion.</p></td>
</tr>
<tr>
<td><p><span class="keep-together"><code>CopyOnWriteArrayList</code></span></p></td>
<td><p>Array</p></td>
<td><p>5.0</p></td>
<td><p>Yes</p></td>
<td><p>Threadsafe; fast traversal,
slow modification.</p></td>
</tr>
<tr>
<td><p><code>Vector</code></p></td>
<td><p>Array</p></td>
<td><p>1.0</p></td>
<td><p>Yes</p></td>
<td><p>Legacy class; synchronized methods. Do not
use.</p></td>
</tr>
<tr>
<td><p><code>Stack</code></p></td>
<td><p>Array</p></td>
<td><p>1.0</p></td>
<td><p>Yes</p></td>
<td><p>Extends <code>Vector</code>; adds <code>push()</code>, <code>pop()</code>,
<code>peek()</code>. Legacy; use <code>Deque</code> instead.</p></td>
</tr>
</tbody>
</table>
</div></section>



</div></section>













<section data-pdf-bookmark="The Map Interface" data-type="sect2"><div class="sect2" id="idm45941114559368">
<h2>The Map Interface</h2>

<p><a data-primary="collections" data-secondary="Map interface" data-type="indexterm" id="10_ix_ch08-asciidoc11"></a><a data-primary="Map interface" data-type="indexterm" id="10_ix_ch08-asciidoc12"></a>A <em>map</em> is a set of <em>key</em> objects and a mapping from each member of
that set to a <em>value</em> object. The <code>Map</code> interface defines an API for
defining and querying mappings. <code>Map</code> is part of the Java Collections
Framework, but it does not extend the <code>Collection</code> interface, so a <code>Map</code>
is a little-c collection, not a big-C <code>Collection</code>. <code>Map</code> is a
parameterized type with two type variables. Type variable <code>K</code> represents
the type of keys held by the map, and type variable <code>V</code> represents the
type of the values that the keys are mapped to. A mapping from <code>String</code>
keys to <code>Integer</code> values, for example, can be represented with a
<code>Map&lt;String,Integer&gt;</code>.</p>

<p>The most important <code>Map</code> methods are <code>put()</code>, which defines a key/value
pair in the map; <code>get()</code>, which queries the value associated with a
specified key; and <code>remove()</code>, which removes the specified key and its
associated value from the map. The general performance expectation for
<code>Map</code> implementations is that these three basic methods are quite
efficient: they should usually run in constant time and certainly no
worse than in logarithmic time.</p>

<p><a data-primary="collection views" data-type="indexterm" id="10_idm45941114520136"></a>An important feature of <code>Map</code> is its support for 鈥渃ollection views.鈥?
These can be summarized simply:</p>

<ul>
<li>
<p>A <code>Map</code> is not a <span class="keep-together"><code>Collection</code></span></p>
</li>
<li>
<p>The keys of a <code>Map</code> can be viewed as a <code>Set</code></p>
</li>
<li>
<p>The values can be viewed as a <code>Collection</code></p>
</li>
<li>
<p>The mappings can be viewed as a <code>Set</code> of <code>Map.Entry</code> objects.</p>
</li>
</ul>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><a data-primary="Map.Entry interface" data-type="indexterm" id="10_idm45941114511064"></a><code>Map.Entry</code> is a nested interface defined within <code>Map</code>: it simply
represents a single key/value pair.</p>
</div>

<p>The following sample code shows the <code>get()</code>, <code>put()</code>, <code>remove()</code>, and
other methods of a <code>Map</code> and also demonstrates some common uses of the
collection views of a <code>Map</code>:</p>

<pre class="pre " data-code-language="java" data-type="programlisting"><code class="c1">// New, empty map</code>
<code class="n">Map</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code><code class="n">Integer</code><code class="o">&gt;</code> <code class="n">m</code> <code class="o">=</code> <code class="k">new</code> <code class="n">HashMap</code><code class="o">&lt;&gt;();</code>

<code class="c1">// Immutable Map containing a single key/value pair</code>
<code class="n">Map</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code><code class="n">Integer</code><code class="o">&gt;</code> <code class="n">singleton</code> <code class="o">=</code> <code class="n">Collections</code><code class="o">.</code><code class="na">singletonMap</code><code class="o">(</code><code class="s">test</code><code class="o">,</code> <code class="o">-</code><code class="mi">1</code><code class="o">);</code>

<code class="c1">// Note this rarely used syntax to explicitly specify the parameter</code>
<code class="c1">// types of the generic emptyMap method. The returned map is immutable</code>
<code class="n">Map</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code><code class="n">Integer</code><code class="o">&gt;</code> <code class="n">empty</code> <code class="o">=</code> <code class="n">Collections</code><code class="o">.&lt;</code><code class="n">String</code><code class="o">,</code><code class="n">Integer</code><code class="o">&gt;</code><code class="n">emptyMap</code><code class="o">();</code>

<code class="c1">// Populate the map using the put method to define mappings</code>
<code class="c1">// from array elements to the index at which each element appears</code>
<code class="n">String</code><code class="o">[]</code> <code class="n">words</code> <code class="o">=</code> <code class="o">{</code> <code class="s">this</code><code class="o">,</code> <code class="s">is</code><code class="o">,</code> <code class="s">a</code><code class="o">,</code> <code class="s">test</code> <code class="o">};</code>
<code class="k">for</code><code class="o">(</code><code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code> <code class="n">i</code> <code class="o">&lt;</code> <code class="n">words</code><code class="o">.</code><code class="na">length</code><code class="o">;</code> <code class="n">i</code><code class="o">++)</code> <code class="o">{</code>
    <code class="n">m</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="n">words</code><code class="o">[</code><code class="n">i</code><code class="o">],</code> <code class="n">i</code><code class="o">);</code>  <code class="c1">// Note autoboxing of int to Integer</code>
<code class="o">}</code>

<code class="c1">// Each key must map to a single value. But keys may map to the</code>
<code class="c1">// same value</code>
<code class="k">for</code><code class="o">(</code><code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code> <code class="n">i</code> <code class="o">&lt;</code> <code class="n">words</code><code class="o">.</code><code class="na">length</code><code class="o">;</code> <code class="n">i</code><code class="o">++)</code> <code class="o">{</code>
    <code class="n">m</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="n">words</code><code class="o">[</code><code class="n">i</code><code class="o">].</code><code class="na">toUpperCase</code><code class="o">(),</code> <code class="n">i</code><code class="o">);</code>
<code class="o">}</code>

<code class="c1">// The putAll() method copies mappings from another Map</code>
<code class="n">m</code><code class="o">.</code><code class="na">putAll</code><code class="o">(</code><code class="n">singleton</code><code class="o">);</code>

<code class="c1">// Query the mappings with the get()  method</code>
<code class="k">for</code><code class="o">(</code><code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code> <code class="n">i</code> <code class="o">&lt;</code> <code class="n">words</code><code class="o">.</code><code class="na">length</code><code class="o">;</code> <code class="n">i</code><code class="o">++)</code> <code class="o">{</code>
    <code class="k">if</code> <code class="o">(</code><code class="n">m</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="n">words</code><code class="o">[</code><code class="n">i</code><code class="o">])</code> <code class="o">!=</code> <code class="n">i</code><code class="o">)</code> <code class="k">throw</code> <code class="k">new</code> <code class="n">AssertionError</code><code class="o">();</code>
<code class="o">}</code>

<code class="c1">// Key and value membership testing</code>
<code class="n">m</code><code class="o">.</code><code class="na">containsKey</code><code class="o">(</code><code class="n">words</code><code class="o">[</code><code class="mi">0</code><code class="o">]);</code>        <code class="c1">// true</code>
<code class="n">m</code><code class="o">.</code><code class="na">containsValue</code><code class="o">(</code><code class="n">words</code><code class="o">.</code><code class="na">length</code><code class="o">);</code>  <code class="c1">// false</code>

<code class="c1">// Map keys, values, and entries can be viewed as collections</code>
<code class="n">Set</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">keys</code> <code class="o">=</code> <code class="n">m</code><code class="o">.</code><code class="na">keySet</code><code class="o">();</code>
<code class="n">Collection</code><code class="o">&lt;</code><code class="n">Integer</code><code class="o">&gt;</code> <code class="n">values</code> <code class="o">=</code> <code class="n">m</code><code class="o">.</code><code class="na">values</code><code class="o">();</code>
<code class="n">Set</code><code class="o">&lt;</code><code class="n">Map</code><code class="o">.</code><code class="na">Entry</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code><code class="n">Integer</code><code class="o">&gt;&gt;</code> <code class="n">entries</code> <code class="o">=</code> <code class="n">m</code><code class="o">.</code><code class="na">entrySet</code><code class="o">();</code>

<code class="c1">// The Map and its collection views typically have useful</code>
<code class="c1">// toString  methods</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">printf</code><code class="o">(</code><code class="s">Map: %s%nKeys: %s%nValues: %s%nEntries: %s%n</code><code class="o">,</code>
                  <code class="n">m</code><code class="o">,</code> <code class="n">keys</code><code class="o">,</code> <code class="n">values</code><code class="o">,</code> <code class="n">entries</code><code class="o">);</code>

<code class="c1">// These collections can be iterated.</code>
<code class="c1">// Most maps have an undefined iteration order (but see SortedMap)</code>
<code class="k">for</code><code class="o">(</code><code class="n">String</code> <code class="n">key</code> <code class="o">:</code> <code class="n">m</code><code class="o">.</code><code class="na">keySet</code><code class="o">())</code> <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">key</code><code class="o">);</code>
<code class="k">for</code><code class="o">(</code><code class="n">Integer</code> <code class="nl">value:</code> <code class="n">m</code><code class="o">.</code><code class="na">values</code><code class="o">())</code> <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">value</code><code class="o">);</code>

<code class="c1">// The Map.Entry&lt;K,V&gt; type represents a single key/value pair in a map</code>
<code class="k">for</code><code class="o">(</code><code class="n">Map</code><code class="o">.</code><code class="na">Entry</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code><code class="n">Integer</code><code class="o">&gt;</code> <code class="n">pair</code> <code class="o">:</code> <code class="n">m</code><code class="o">.</code><code class="na">entrySet</code><code class="o">())</code> <code class="o">{</code>
    <code class="c1">// Print out mappings</code>
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">printf</code><code class="o">(</code><code class="s">&apos;%s&apos; ==&gt; %d%n</code><code class="o">,</code> <code class="n">pair</code><code class="o">.</code><code class="na">getKey</code><code class="o">(),</code> <code class="n">pair</code><code class="o">.</code><code class="na">getValue</code><code class="o">());</code>
    <code class="c1">// And increment the value of each Entry</code>
    <code class="n">pair</code><code class="o">.</code><code class="na">setValue</code><code class="o">(</code><code class="n">pair</code><code class="o">.</code><code class="na">getValue</code><code class="o">()</code> <code class="o">+</code> <code class="mi">1</code><code class="o">);</code>
<code class="o">}</code>

<code class="c1">// Removing mappings</code>
<code class="n">m</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="s">testing</code><code class="o">,</code> <code class="kc">null</code><code class="o">);</code>   <code class="c1">// Mapping to null can &quot;erase&quot; a mapping:</code>
<code class="n">m</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">testing</code><code class="o">);</code>         <code class="c1">// Returns null</code>
<code class="n">m</code><code class="o">.</code><code class="na">containsKey</code><code class="o">(</code><code class="s">testing</code><code class="o">);</code> <code class="c1">// Returns true: mapping still exists</code>
<code class="n">m</code><code class="o">.</code><code class="na">remove</code><code class="o">(</code><code class="s">testing</code><code class="o">);</code>      <code class="c1">// Deletes the mapping altogether</code>
<code class="n">m</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">testing</code><code class="o">);</code>         <code class="c1">// Still returns null</code>
<code class="n">m</code><code class="o">.</code><code class="na">containsKey</code><code class="o">(</code><code class="s">testing</code><code class="o">);</code> <code class="c1">// Now returns false.</code>

<code class="c1">// Deletions may also be made via the collection views of a map.</code>
<code class="c1">// Additions to the map may not be made this way, however.</code>
<code class="n">m</code><code class="o">.</code><code class="na">keySet</code><code class="o">().</code><code class="na">remove</code><code class="o">(</code><code class="n">words</code><code class="o">[</code><code class="mi">0</code><code class="o">]);</code>  <code class="c1">// Same as m.remove(words[0]);</code>

<code class="c1">// Removes one mapping to the value 2 - usually inefficient and of</code>
<code class="c1">// limited use</code>
<code class="n">m</code><code class="o">.</code><code class="na">values</code><code class="o">().</code><code class="na">remove</code><code class="o">(</code><code class="mi">2</code><code class="o">);</code>
<code class="c1">// Remove all mappings to 4</code>
<code class="n">m</code><code class="o">.</code><code class="na">values</code><code class="o">().</code><code class="na">removeAll</code><code class="o">(</code><code class="n">Collections</code><code class="o">.</code><code class="na">singleton</code><code class="o">(</code><code class="mi">4</code><code class="o">));</code>
<code class="c1">// Keep only mappings to 2 &amp; 3</code>
<code class="n">m</code><code class="o">.</code><code class="na">values</code><code class="o">().</code><code class="na">retainAll</code><code class="o">(</code><code class="n">Arrays</code><code class="o">.</code><code class="na">asList</code><code class="o">(</code><code class="mi">2</code><code class="o">,</code> <code class="mi">3</code><code class="o">));</code>

<code class="c1">// Deletions can also be done via iterators</code>
<code class="n">Iterator</code><code class="o">&lt;</code><code class="n">Map</code><code class="o">.</code><code class="na">Entry</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code><code class="n">Integer</code><code class="o">&gt;&gt;</code> <code class="n">iter</code> <code class="o">=</code> <code class="n">m</code><code class="o">.</code><code class="na">entrySet</code><code class="o">().</code><code class="na">iterator</code><code class="o">();</code>
<code class="k">while</code><code class="o">(</code><code class="n">iter</code><code class="o">.</code><code class="na">hasNext</code><code class="o">())</code> <code class="o">{</code>
    <code class="n">Map</code><code class="o">.</code><code class="na">Entry</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code><code class="n">Integer</code><code class="o">&gt;</code> <code class="n">e</code> <code class="o">=</code> <code class="n">iter</code><code class="o">.</code><code class="na">next</code><code class="o">();</code>
    <code class="k">if</code> <code class="o">(</code><code class="n">e</code><code class="o">.</code><code class="na">getValue</code><code class="o">()</code> <code class="o">==</code> <code class="mi">2</code><code class="o">)</code> <code class="n">iter</code><code class="o">.</code><code class="na">remove</code><code class="o">();</code>
<code class="o">}</code>

<code class="c1">// Find values that appear in both of two maps.  In general, addAll()</code>
<code class="c1">// and retainAll() with keySet() and values() allow union and</code>
<code class="c1">// intersection</code>
<code class="n">Set</code><code class="o">&lt;</code><code class="n">Integer</code><code class="o">&gt;</code> <code class="n">v</code> <code class="o">=</code> <code class="k">new</code> <code class="n">HashSet</code><code class="o">&lt;&gt;(</code><code class="n">m</code><code class="o">.</code><code class="na">values</code><code class="o">());</code>
<code class="n">v</code><code class="o">.</code><code class="na">retainAll</code><code class="o">(</code><code class="n">singleton</code><code class="o">.</code><code class="na">values</code><code class="o">());</code>

<code class="c1">// Miscellaneous methods</code>
<code class="n">m</code><code class="o">.</code><code class="na">clear</code><code class="o">();</code>                <code class="c1">// Deletes all mappings</code>
<code class="n">m</code><code class="o">.</code><code class="na">size</code><code class="o">();</code>                 <code class="c1">// Returns number of mappings: currently 0</code>
<code class="n">m</code><code class="o">.</code><code class="na">isEmpty</code><code class="o">();</code>              <code class="c1">// Returns true</code>
<code class="n">m</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">empty</code><code class="o">);</code>          <code class="c1">// true: Maps implementations override equals</code></pre>

<p>With the arrival of Java 9, the <code>Map</code> interface has also been enhanced with factory methods for spinning up collections easily:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Map</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code> <code class="n">Double</code><code class="o">&gt;</code> <code class="n">capitals</code> <code class="o">=</code>
        <code class="n">Map</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="s">Barcelona</code><code class="o">,</code> <code class="mf">22.5</code><code class="o">,</code> <code class="s">New York</code><code class="o">,</code> <code class="mf">28.3</code><code class="o">);</code></pre>

<p>The situation is a little more complicated as compared to <code>Set</code> and <code>List</code>, as the <code>Map</code> type has both keys and values, and Java does not allow more than one varargs parameter in a method declaration.
The solution is to have fixed argument size overloads, up to 10 entries and also to provide a new static method, <code>entry()</code>, that will construct an object to represent the key/value pair.</p>

<p>The code can then be written to use the varargs form like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Map</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code> <code class="n">Double</code><code class="o">&gt;</code> <code class="n">capitals</code> <code class="o">=</code> <code class="n">Map</code><code class="o">.</code><code class="na">ofEntries</code><code class="o">(</code><code class="n">entry</code><code class="o">(</code><code class="s">Barcelona</code><code class="o">,</code> <code class="mf">22.5</code><code class="o">),</code>
        <code class="n">entry</code><code class="o">(</code><code class="s">New York</code><code class="o">,</code> <code class="mf">28.3</code><code class="o">));</code></pre>

<p>Note that the method name has to be different from <code>of()</code> due to the difference in type of the arguments鈥攖his is now a varargs method in <code>Map.Entry</code>.</p>

<p>The <code>Map</code> interface includes a variety of general-purpose and
special-purpose implementations, which are summarized in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch08.html#javanut7-CHP-8-TABLE-3">Table 8-2</a>. As always, complete details are
in the JDK鈥檚 documentation and javadoc. <a data-primary="java.util package" data-secondary="Map interface implementations" data-type="indexterm" id="10_idm45941113991736"></a><a data-primary="java.util.concurrent" data-secondary="Map implementations" data-type="indexterm" id="10_idm45941113949864"></a>All classes in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch08.html#javanut7-CHP-8-TABLE-3">Table 8-2</a> are in the <code>java.util</code> package
except <code>ConcurrentHashMap</code> and <code>ConcurrentSkipListMap</code>, which are
part of <code>java.util.concurrent</code>.</p>
<table id="javanut7-CHP-8-TABLE-4">
<caption><span class="label">Table 8-3. </span>Map implementations</caption>
<thead>
<tr>
<th>Class</th>
<th>Representation</th>
<th>Since</th>
<th>null keys</th>
<th>null values</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><code>HashMap</code></p></td>
<td><p>Hashtable</p></td>
<td><p>1.2</p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
<td><p>General-purpose implementation.</p></td>
</tr>
<tr>
<td><p><code>ConcurrentHashMap</code></p></td>
<td><p>Hashtable</p></td>
<td><p>5.0</p></td>
<td><p>No</p></td>
<td><p>No</p></td>
<td><p>General-purpose threadsafe
implementation; see <code>ConcurrentMap</code> interface.</p></td>
</tr>
<tr>
<td><p><code>ConcurrentSkipListMap</code></p></td>
<td><p>Hashtable</p></td>
<td><p>6.0</p></td>
<td><p>No</p></td>
<td><p>No</p></td>
<td><p>Specialized threadsafe
implementation; see <code>ConcurrentNavigableMap</code> interface.</p></td>
</tr>
<tr>
<td><p><code>EnumMap</code></p></td>
<td><p>Array</p></td>
<td><p>5.0</p></td>
<td><p>No</p></td>
<td><p>Yes</p></td>
<td><p>Keys are instances of an enum.</p></td>
</tr>
<tr>
<td><p><code>LinkedHashMap</code></p></td>
<td><p>Hashtable plus list</p></td>
<td><p>1.4</p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
<td><p>Preserves
insertion or access order.</p></td>
</tr>
<tr>
<td><p><code>TreeMap</code></p></td>
<td><p>Red-black tree</p></td>
<td><p>1.2</p></td>
<td><p>No</p></td>
<td><p>Yes</p></td>
<td><p>Sorts by key value. Operations
are O(log(n)). See <code>SortedMap</code> interface.</p></td>
</tr>
<tr>
<td><p><code>IdentityHashMap</code></p></td>
<td><p>Hashtable</p></td>
<td><p>1.4</p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
<td><p>Compares with <code>==</code> instead
of <code>equals()</code>.</p></td>
</tr>
<tr>
<td><p><code>WeakHashMap</code></p></td>
<td><p>Hashtable</p></td>
<td><p>1.2</p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
<td><p>Doesn鈥檛 prevent garbage
collection of keys.</p></td>
</tr>
<tr>
<td><p><code>Hashtable</code></p></td>
<td><p>Hashtable</p></td>
<td><p>1.0</p></td>
<td><p>No</p></td>
<td><p>No</p></td>
<td><p>Legacy class; synchronized
methods. Do not use.</p></td>
</tr>
<tr>
<td><p><code>Properties</code></p></td>
<td><p>Hashtable</p></td>
<td><p>1.0</p></td>
<td><p>No</p></td>
<td><p>No</p></td>
<td><p>Extends <code>Hashtable</code> with <code>String</code>
methods.</p></td>
</tr>
</tbody>
</table>

<p><a data-primary="ConcurrentHashMap class" data-type="indexterm" id="10_idm45941113873112"></a><a data-primary="ConcurrentMap interface" data-type="indexterm" id="10_idm45941113872008"></a><a data-primary="ConcurrentSkipListMap class" data-type="indexterm" id="10_idm45941113871336"></a>The <code>ConcurrentHashMap</code> and <code>ConcurrentSkipListMap</code> classes of the
<code>java.util.concurrent</code> package implement the <code>ConcurrentMap</code>
interface of the same package. <code>ConcurrentMap</code> extends <code>Map</code> and
defines some additional atomic operations that are important in
multithreaded programming. <a data-primary="putIfAbsent()" data-type="indexterm" id="10_idm45941113867784"></a>For example, the <code>putIfAbsent()</code> method is
like <code>put()</code> but adds the key/value pair to the map only if the key is
not already mapped.</p>

<p><a data-primary="SortedMap interface" data-type="indexterm" id="10_idm45941113866088"></a><a data-primary="TreeMap class" data-type="indexterm" id="10_idm45941113865144"></a><code>TreeMap</code> implements the <code>SortedMap</code> interface, which extends <code>Map</code> to
add methods that take advantage of the sorted nature of the map.
<code>SortedMap</code> is quite similar to the <code>SortedSet</code> interface. The
<code>firstKey()</code> and <code>lastKey()</code> methods return the first and last keys in
the <code>keySet()</code>. And <code>headMap()</code>, <code>tailMap()</code>, and <code>subMap()</code> return a
restricted range of the original map.<a data-startref="ix_ch08-asciidoc12" data-type="indexterm" id="10_idm45941113859512"></a><a data-startref="ix_ch08-asciidoc11" data-type="indexterm" id="10_idm45941113858808"></a></p>
</div></section>













<section data-pdf-bookmark="The Queue and BlockingQueue Interfaces" data-type="sect2"><div class="sect2" id="idm45941114558872">
<h2>The Queue and BlockingQueue Interfaces</h2>

<p><a data-primary="BlockingQueue interface" data-type="indexterm" id="10_ix_ch08-asciidoc13"></a><a data-primary="collections" data-secondary="BlockingQueue interface" data-type="indexterm" id="10_ix_ch08-asciidoc14"></a><a data-primary="collections" data-secondary="Queue interface" data-type="indexterm" id="10_ix_ch08-asciidoc15"></a><a data-primary="Queue interface" data-type="indexterm" id="10_ix_ch08-asciidoc16"></a>A <em>queue</em> is an ordered collection of elements with methods for
extracting elements, in order, from the <em>head</em> of the queue. <a data-primary="first-in, first-out (FIFO) queues" data-type="indexterm" id="10_idm45941113851400"></a><a data-primary="last in, first-out (LIFO) queues" data-type="indexterm" id="10_idm45941113850696"></a>Queue
implementations are commonly based on insertion order as in first-in,
first-out (FIFO) queues or last-in, first-out (LIFO) queues.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>LIFO queues are also known as stacks, and Java provides a <code>Stack</code>
class, but its use is strongly discouraged鈥攊nstead, use implementations of
the <code>Deque</code> interface.</p>
</div>

<p><a data-primary="priority queues" data-type="indexterm" id="10_idm45941113847592"></a>Other orderings are also possible: a <em>priority queue</em> orders its
elements according to an external <code>Comparator</code> object, or according to
the natural ordering of <code>Comparable</code> elements. Unlike a <code>Set</code>, <code>Queue</code>
implementations typically allow duplicate elements. Unlike <code>List</code>, the
<code>Queue</code> interface does not define methods for manipulating queue
elements at arbitrary positions. Only the element at the head of the
queue is available for examination. It is common for <code>Queue</code>
implementations to have a fixed capacity: when a queue is full, it is
not possible to add more elements. Similarly, when a queue is empty, it
is not possible to remove any more elements. Because full and empty
conditions are a normal part of many queue-based algorithms, the <code>Queue</code>
interface defines methods that signal these conditions with return
values rather than by throwing exceptions. Specifically, the <code>peek()</code>
and <code>poll()</code> methods return <code>null</code> to indicate that the queue is empty.
For this reason, most <code>Queue</code> implementations do not allow <code>null</code>
elements.</p>

<p><a data-primary="blocking queue, defined" data-type="indexterm" id="10_idm45941113839720"></a>A <em>blocking queue</em> is a type of queue that defines blocking <code>put()</code>
and <code>take()</code> methods. The <code>put()</code> method adds an element to the queue,
waiting, if necessary, until there is space in the queue for the
element. And the <code>take()</code> method removes an element from the head of the
queue, waiting, if necessary, until there is an element to remove.
Blocking queues are an important part of many multithreaded algorithms,
and the <a data-primary="java.util.concurrent" data-secondary="BlockingQueue interface" data-type="indexterm" id="10_idm45941113836104"></a><code>BlockingQueue</code> interface (which extends <code>Queue</code>) is defined as
part of the <code>java.util.concurrent</code> package.</p>

<p>Queues are not nearly as commonly used as sets, lists, and maps, except
perhaps in certain multithreaded programming styles. In lieu of example
code here, we鈥檒l try to clarify the different possible queue insertion
and removal operations.</p>
</div></section>













<section data-pdf-bookmark="Adding Elements to Queues" data-type="sect2"><div class="sect2" id="idm45941113833208">
<h2>Adding Elements to Queues</h2>
<dl>
<dt><code>add()</code></dt>
<dd>
<p><a data-primary="BlockingQueue interface" data-secondary="adding elements to queues" data-type="indexterm" id="10_idm45941113830600"></a><a data-primary="Queue interface" data-secondary="adding elements to queues" data-type="indexterm" id="10_idm45941113829656"></a>This <code>Collection</code> method simply adds an element in the normal way. In
bounded queues, this method may throw an exception if the queue is
full.</p>
</dd>
<dt><code>offer()</code></dt>
<dd>
<p>This <code>Queue</code> method is like <code>add()</code> but returns <code>false</code> instead of
throwing an exception if the element cannot be added because a bounded
queue is full.</p>

<p><code>BlockingQueue</code> defines a timeout version of <code>offer()</code> that waits up
to a specified amount of time for space to become available in a full
queue. Like the basic version of the method, it returns <code>true</code> if the
element was inserted and <code>false</code> otherwise.</p>
</dd>
<dt><code>put()</code></dt>
<dd>
<p>This <code>BlockingQueue</code> method blocks: if the element cannot be inserted
because the queue is full, <code>put()</code> waits until some other thread
removes an element from the queue, and space becomes available for the
new element.</p>
</dd>
</dl>
</div></section>













<section data-pdf-bookmark="Removing Elements from Queues" data-type="sect2"><div class="sect2" id="idm45941113820152">
<h2>Removing Elements from Queues</h2>
<dl>
<dt><code>remove()</code></dt>
<dd>
<p><a data-primary="BlockingQueue interface" data-secondary="removing elements from queues" data-type="indexterm" id="10_idm45941113817544"></a><a data-primary="Queue interface" data-secondary="removing elements from queues" data-type="indexterm" id="10_idm45941113816376"></a>In addition to the <code>Collection.remove()</code> method, which removes a
specified element from the queue, the <code>Queue</code> interface defines a
no-argument version of <code>remove()</code> that removes and returns the element
at the head of the queue. If the queue is empty, this method throws a
<code>NoSuchElementException</code>.</p>
</dd>
<dt><code>poll()</code></dt>
<dd>
<p>This <code>Queue</code> method removes and returns the element at the head of the
queue, like <code>remove()</code> does, but returns <code>null</code> if the queue is empty
instead of throwing an exception.</p>

<p><code>BlockingQueue</code> defines a timeout version of <code>poll()</code> that waits up to
a specified amount of time for an element to be added to an empty
queue.</p>
</dd>
<dt><code>take()</code></dt>
<dd>
<p>This <code>BlockingQueue</code> method removes and returns the element at the
head of the queue. If the queue is empty, it blocks until some other
thread adds an element to the queue.</p>
</dd>
<dt><code>drainTo()</code></dt>
<dd>
<p>This <code>BlockingQueue</code> method removes all available elements from the
queue and adds them to a specified <code>Collection</code>. It does not block to
wait for elements to be added to the queue. A variant of the method
accepts a maximum number of elements to drain.</p>
</dd>
</dl>










<section data-pdf-bookmark="Querying" data-type="sect3"><div class="sect3" id="idm45941113804600">
<h3>Querying</h3>

<p><a data-primary="BlockingQueue interface" data-secondary="querying of elements in queues" data-type="indexterm" id="10_idm45941113803160"></a><a data-primary="queries" data-secondary="elements in queues" data-type="indexterm" id="10_idm45941113802216"></a><a data-primary="Queue interface" data-secondary="querying" data-type="indexterm" id="10_idm45941113801272"></a><a data-primary="Queue interface" data-secondary="querying of elements in queues" data-type="indexterm" id="10_idm45941113800328"></a>In this context, querying refers to examining the element at the head
without removing it from the queue.</p>
<dl>
<dt><code>element()</code></dt>
<dd>
<p>This <code>Queue</code> method returns the element at the head of the queue but
does not remove that element from the queue. It throws <code>NoSuchElementException</code> if the queue is empty.</p>
</dd>
<dt><code>peek()</code></dt>
<dd>
<p>This <code>Queue</code> method is like <code>element</code> but returns <code>null</code> if the queue
is empty.</p>
</dd>
</dl>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>When using queues, it is usually a good idea to pick one particular
style of how to deal with a failure. For example, if you want
operations to block until they succeed, then choose <code>put()</code> and
<code>take()</code>. If you want to examine the return code of a method to see if
the queue operation suceeded, then <code>offer()</code> and <code>poll()</code> are an
appropriate choice.</p>
</div>

<p><a data-primary="LinkedList class" data-type="indexterm" id="10_idm45941113789960"></a>The <code>LinkedList</code> class also implements <code>Queue</code>. It provides unbounded
FIFO ordering, and insertion and removal operations require constant
time. <code>LinkedList</code> allows <code>null</code> elements, although their use is
discouraged when the list is being used as a queue.</p>

<p>There are two other <code>Queue</code> implementations in the <code>java.util</code> package.
<code>PriorityQueue</code> orders its elements according to a <code>Comparator</code> or
orders <code>Comparable</code> elements according to the order defined by their
<code>compareTo()</code> methods. The head of a <code>PriorityQueue</code> is always the
smallest element according to the defined ordering. Finally,
<a data-primary="ArrayDeque class" data-type="indexterm" id="10_idm45941113783544"></a><code>ArrayDeque</code> is a double-ended queue implementation. It is often used
when a stack implementation is needed.</p>

<p>The <code>java.util.concurrent</code> package also contains a number of
<code>BlockingQueue</code> implementations, which are designed for use in
multithreaded programing style; advanced versions that can remove the
need for synchronized methods are <span class="keep-together">available</span>.<a data-startref="ix_ch08-asciidoc16" data-type="indexterm" id="10_idm45941113780104"></a><a data-startref="ix_ch08-asciidoc15" data-type="indexterm" id="10_idm45941113779368"></a><a data-startref="ix_ch08-asciidoc14" data-type="indexterm" id="10_idm45941113778696"></a><a data-startref="ix_ch08-asciidoc13" data-type="indexterm" id="10_idm45941113778024"></a></p>
</div></section>



</div></section>













<section data-pdf-bookmark="Utility Methods" data-type="sect2"><div class="sect2" id="idm45941113777224">
<h2>Utility Methods</h2>

<p><a data-primary="collections" data-secondary="utility methods" data-type="indexterm" id="10_ix_ch08-asciidoc17"></a>The <a data-primary="java.util.Collections" data-secondary="wrapper methods" data-type="indexterm" id="10_idm45941113774056"></a><code>java.util.Collections</code> class is home to quite a few static utility
methods designed for use with collections. <a data-primary="wrapper collections" data-type="indexterm" id="10_idm45941113772584"></a>One important group of these
methods are the collection <em>wrapper</em> methods: they return a
special-purpose collection wrapped around a collection you specify. The
purpose of the wrapper collection is to wrap additional functionality
around a collection that does not provide it itself. Wrappers exist to
provide thread-safety, write protection, and runtime type checking.
Wrapper collections are always <em>backed by</em> the original collection,
which means that the methods of the wrapper simply dispatch to the
equivalent methods of the wrapped collection. This means that changes
made to the collection through the wrapper are visible through the
wrapped collection and vice versa.</p>

<p>The first set of wrapper methods provides threadsafe wrappers around
collections. Except for the legacy classes <code>Vector</code> and <code>Hashtable</code>, the
collection implementations in <code>java.util</code> do not have <code>synchronized</code>
methods and are not protected against concurrent access by multiple
threads. If you need threadsafe collections and don鈥檛 mind the
additional overhead of synchronization, create them with code like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">list</code> <code class="o">=</code>
    <code class="n">Collections</code><code class="o">.</code><code class="na">synchronizedList</code><code class="o">(</code><code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;&gt;());</code>
<code class="n">Set</code><code class="o">&lt;</code><code class="n">Integer</code><code class="o">&gt;</code> <code class="n">set</code> <code class="o">=</code>
    <code class="n">Collections</code><code class="o">.</code><code class="na">synchronizedSet</code><code class="o">(</code><code class="k">new</code> <code class="n">HashSet</code><code class="o">&lt;&gt;());</code>
<code class="n">Map</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code><code class="n">Integer</code><code class="o">&gt;</code> <code class="n">map</code> <code class="o">=</code>
    <code class="n">Collections</code><code class="o">.</code><code class="na">synchronizedMap</code><code class="o">(</code><code class="k">new</code> <code class="n">HashMap</code><code class="o">&lt;&gt;());</code></pre>

<p>A second set of wrapper methods provides collection objects through
which the underlying collection cannot be modified. They return a
read-only view of a collection: an <code>UnsupportedOperationException</code> will result from changing the collection鈥檚 content. These wrappers
are useful when you must pass a collection to a method that must not be
allowed to modify or mutate the content of the collection in any way:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">List</code><code class="o">&lt;</code><code class="n">Integer</code><code class="o">&gt;</code> <code class="n">primes</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;&gt;();</code>
<code class="n">List</code><code class="o">&lt;</code><code class="n">Integer</code><code class="o">&gt;</code> <code class="n">readonly</code> <code class="o">=</code> <code class="n">Collections</code><code class="o">.</code><code class="na">unmodifiableList</code><code class="o">(</code><code class="n">primes</code><code class="o">);</code>
<code class="c1">// We can modify the list through primes</code>
<code class="n">primes</code><code class="o">.</code><code class="na">addAll</code><code class="o">(</code><code class="n">Arrays</code><code class="o">.</code><code class="na">asList</code><code class="o">(</code><code class="mi">2</code><code class="o">,</code> <code class="mi">3</code><code class="o">,</code> <code class="mi">5</code><code class="o">,</code> <code class="mi">7</code><code class="o">,</code> <code class="mi">11</code><code class="o">,</code> <code class="mi">13</code><code class="o">,</code> <code class="mi">17</code><code class="o">,</code> <code class="mi">19</code><code class="o">));</code>
<code class="c1">// But we can&apos;t modify through the read-only wrapper</code>
<code class="n">readonly</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="mi">23</code><code class="o">);</code>  <code class="c1">// UnsupportedOperationException</code></pre>

<p>The <code>java.util.Collections</code> class also defines methods to operate on
collections. Some of the most notable are methods to sort and search the
elements of <span class="keep-together">collections</span>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Collections</code><code class="o">.</code><code class="na">sort</code><code class="o">(</code><code class="n">list</code><code class="o">);</code>
<code class="c1">// list must be sorted first</code>
<code class="kt">int</code> <code class="n">pos</code> <code class="o">=</code> <code class="n">Collections</code><code class="o">.</code><code class="na">binarySearch</code><code class="o">(</code><code class="n">list</code><code class="o">,</code> <code class="s">key</code><code class="o">);</code></pre>

<p>Here are some other interesting <code>Collections</code> methods:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Copy list2 into list1, overwriting list1</code>
<code class="n">Collections</code><code class="o">.</code><code class="na">copy</code><code class="o">(</code><code class="n">list1</code><code class="o">,</code> <code class="n">list2</code><code class="o">);</code>
<code class="c1">// Fill list with Object o</code>
<code class="n">Collections</code><code class="o">.</code><code class="na">fill</code><code class="o">(</code><code class="n">list</code><code class="o">,</code> <code class="n">o</code><code class="o">);</code>
<code class="c1">// Find the largest element in Collection c</code>
<code class="n">Collections</code><code class="o">.</code><code class="na">max</code><code class="o">(</code><code class="n">c</code><code class="o">);</code>
<code class="c1">// Find the smallest element in Collection c</code>
<code class="n">Collections</code><code class="o">.</code><code class="na">min</code><code class="o">(</code><code class="n">c</code><code class="o">);</code>

<code class="n">Collections</code><code class="o">.</code><code class="na">reverse</code><code class="o">(</code><code class="n">list</code><code class="o">);</code>      <code class="c1">// Reverse list</code>
<code class="n">Collections</code><code class="o">.</code><code class="na">shuffle</code><code class="o">(</code><code class="n">list</code><code class="o">);</code>      <code class="c1">// Mix up list</code></pre>

<p>It is a good idea to familiarize yourself fully with the utility methods
in <code>Collections</code> and <code>Arrays</code>, as they can save you from writing your own
implementation of a common task.</p>










<section data-pdf-bookmark="Special-case collections" data-type="sect3"><div class="sect3" id="idm45941113301832">
<h3>Special-case collections</h3>

<p><a data-primary="collections" data-secondary="special-case collections" data-type="indexterm" id="10_idm45941113300488"></a><a data-primary="java.util.Collections" data-secondary="special-case collections" data-type="indexterm" id="10_idm45941113299384"></a>In addition to its wrapper methods, the <code>java.util.Collections</code> class
also defines utility methods for creating immutable collection
instances that contain a single element and other methods for creating
empty collections. <a data-primary="singletons, Collections class methods for" data-type="indexterm" id="10_idm45941113297720"></a><code>singleton()</code>, <code>singletonList()</code>, and
<code>singletonMap()</code> return immutable <code>Set</code>, <code>List</code>, and <code>Map</code> objects that
contain a single specified object or a single key/value pair. These
methods are useful when you need to pass a single object to a method
that expects a collection.</p>

<p><a data-primary="empty collections, Collections class methods for" data-type="indexterm" id="10_idm45941113293944"></a>The <code>Collections</code> class also includes methods that return empty
collections. If you are writing a method that returns a collection, it
is usually best to handle the no-values-to-return case by returning an
empty collection instead of a special-case value like <code>null</code>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Set</code><code class="o">&lt;</code><code class="n">Integer</code><code class="o">&gt;</code> <code class="n">si</code> <code class="o">=</code> <code class="n">Collections</code><code class="o">.</code><code class="na">emptySet</code><code class="o">();</code>
<code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">ss</code> <code class="o">=</code> <code class="n">Collections</code><code class="o">.</code><code class="na">emptyList</code><code class="o">();</code>
<code class="n">Map</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code><code class="n">Integer</code><code class="o">&gt;</code> <code class="n">m</code> <code class="o">=</code> <code class="n">Collections</code><code class="o">.</code><code class="na">emptyMap</code><code class="o">();</code></pre>

<p>Finally, <code>nCopies()</code> returns an immutable <code>List</code> that contains a
specified number of copies of a single specified object:<a data-startref="ix_ch08-asciidoc17" data-type="indexterm" id="10_idm45941113234760"></a></p>

<pre data-code-language="java" data-type="programlisting"><code class="n">List</code><code class="o">&lt;</code><code class="n">Integer</code><code class="o">&gt;</code> <code class="n">tenzeros</code> <code class="o">=</code> <code class="n">Collections</code><code class="o">.</code><code class="na">nCopies</code><code class="o">(</code><code class="mi">10</code><code class="o">,</code> <code class="mi">0</code><code class="o">);</code></pre>
</div></section>



</div></section>













<section data-pdf-bookmark="Arrays and Helper Methods" data-type="sect2"><div class="sect2" id="idm45941113776760">
<h2>Arrays and Helper Methods</h2>

<p><a data-primary="arrays" data-secondary="converting to/from objects" data-type="indexterm" id="10_idm45941113170488"></a><a data-primary="arrays" data-secondary="Java Collections and" data-type="indexterm" id="10_idm45941113227912"></a><a data-primary="collections" data-secondary="arrays and helper methods" data-type="indexterm" id="10_idm45941113226968"></a><a data-primary="objects" data-secondary="converting to/from arrays" data-type="indexterm" id="10_idm45941113226056"></a>Arrays of objects and collections serve similar purposes. It is
possible to convert from one to the other:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">String</code><code class="o">[]</code> <code class="n">a</code> <code class="o">={</code> <code class="s">this</code><code class="o">,</code> <code class="s">is</code><code class="o">,</code> <code class="s">a</code><code class="o">,</code> <code class="s">test</code> <code class="o">};</code>  <code class="c1">// An array</code>
<code class="c1">// View array as an ungrowable list</code>
<code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">l</code> <code class="o">=</code> <code class="n">Arrays</code><code class="o">.</code><code class="na">asList</code><code class="o">(</code><code class="n">a</code><code class="o">);</code>
<code class="c1">// Make a growable copy of the view</code>
<code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">m</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;&gt;(</code><code class="n">l</code><code class="o">);</code>

<code class="c1">// asList() is a varargs method so we can do this, too:</code>
<code class="n">Set</code><code class="o">&lt;</code><code class="n">Character</code><code class="o">&gt;</code> <code class="n">abc</code> <code class="o">=</code>
    <code class="k">new</code> <code class="n">HashSet</code><code class="o">&lt;</code><code class="n">Character</code><code class="o">&gt;(</code><code class="n">Arrays</code><code class="o">.</code><code class="na">asList</code><code class="o">(</code><code class="sc">a</code><code class="o">,</code> <code class="sc">b</code><code class="o">,</code> <code class="sc">c</code><code class="o">));</code>

<code class="c1">// Collection defines the toArray  method.  The no-args version creates</code>
<code class="c1">// an Object[] array, copies collection elements to it and returns it</code>
<code class="c1">// Get set elements as an array</code>
<code class="n">Object</code><code class="o">[]</code> <code class="n">members</code> <code class="o">=</code> <code class="n">set</code><code class="o">.</code><code class="na">toArray</code><code class="o">();</code>
<code class="c1">// Get list elements as an array</code>
<code class="n">Object</code><code class="o">[]</code> <code class="n">items</code> <code class="o">=</code> <code class="n">list</code><code class="o">.</code><code class="na">toArray</code><code class="o">();</code>
<code class="c1">// Get map key objects as an array</code>
<code class="n">Object</code><code class="o">[]</code> <code class="n">keys</code> <code class="o">=</code> <code class="n">map</code><code class="o">.</code><code class="na">keySet</code><code class="o">().</code><code class="na">toArray</code><code class="o">();</code>
<code class="c1">// Get map value objects as an array</code>
<code class="n">Object</code><code class="o">[]</code> <code class="n">values</code> <code class="o">=</code> <code class="n">map</code><code class="o">.</code><code class="na">values</code><code class="o">().</code><code class="na">toArray</code><code class="o">();</code>

<code class="c1">// If you want the return value to be something other than Object[],</code>
<code class="c1">// pass in an array of the appropriate type. If the array is not</code>
<code class="c1">// big enough, another one of the same type will be allocated.</code>
<code class="c1">// If the array is too big, the collection elements copied to it</code>
<code class="c1">// will be null-filled</code>
<code class="n">String</code><code class="o">[]</code> <code class="n">c</code> <code class="o">=</code> <code class="n">l</code><code class="o">.</code><code class="na">toArray</code><code class="o">(</code><code class="k">new</code> <code class="n">String</code><code class="o">[</code><code class="mi">0</code><code class="o">]);</code></pre>

<p>In addition, there are a number of useful helper methods for working
with Java鈥檚 arrays, which are included here for completeness.</p>

<p><a data-primary="arrayCopy()" data-type="indexterm" id="10_idm45941113222184"></a><a data-primary="java.lang.System" data-type="indexterm" id="10_idm45941113221544"></a>The <code>java.lang.System</code> class defines an <code>arraycopy()</code> method that is
useful for copying specified elements in one array to a specified
position in a second array. The second array must be the same type as
the first, and it can even be the same array:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">char</code><code class="o">[]</code> <code class="n">text</code> <code class="o">=</code> <code class="s">Now is the time</code><code class="o">.</code><code class="na">toCharArray</code><code class="o">();</code>
<code class="kt">char</code><code class="o">[]</code> <code class="n">copy</code> <code class="o">=</code> <code class="k">new</code> <code class="kt">char</code><code class="o">[</code><code class="mi">100</code><code class="o">];</code>
<code class="c1">// Copy 10 characters from element 4 of text into copy,</code>
<code class="c1">// starting at copy[0]</code>
<code class="n">System</code><code class="o">.</code><code class="na">arraycopy</code><code class="o">(</code><code class="n">text</code><code class="o">,</code> <code class="mi">4</code><code class="o">,</code> <code class="n">copy</code><code class="o">,</code> <code class="mi">0</code><code class="o">,</code> <code class="mi">10</code><code class="o">);</code>

<code class="c1">// Move some of the text to later elements, making room for insertions</code>
<code class="c1">// If target and source are the same,</code>
<code class="c1">// this will involve copying to a temporary</code>
<code class="n">System</code><code class="o">.</code><code class="na">arraycopy</code><code class="o">(</code><code class="n">copy</code><code class="o">,</code> <code class="mi">3</code><code class="o">,</code> <code class="n">copy</code><code class="o">,</code> <code class="mi">6</code><code class="o">,</code> <code class="mi">7</code><code class="o">);</code></pre>

<p>There are also a number of useful static methods defined on the
<code>Arrays</code> class:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">int</code><code class="o">[]</code> <code class="n">intarray</code> <code class="o">=</code> <code class="k">new</code> <code class="kt">int</code><code class="o">[]</code> <code class="o">{</code> <code class="mi">10</code><code class="o">,</code> <code class="mi">5</code><code class="o">,</code> <code class="mi">7</code><code class="o">,</code> <code class="o">-</code><code class="mi">3</code> <code class="o">};</code> <code class="c1">// An array of integers</code>
<code class="n">Arrays</code><code class="o">.</code><code class="na">sort</code><code class="o">(</code><code class="n">intarray</code><code class="o">);</code>                       <code class="c1">// Sort it in place</code>
<code class="c1">// Value 7 is found at index 2</code>
<code class="kt">int</code> <code class="n">pos</code> <code class="o">=</code> <code class="n">Arrays</code><code class="o">.</code><code class="na">binarySearch</code><code class="o">(</code><code class="n">intarray</code><code class="o">,</code> <code class="mi">7</code><code class="o">);</code>
<code class="c1">// Not found: negative return value</code>
<code class="n">pos</code> <code class="o">=</code> <code class="n">Arrays</code><code class="o">.</code><code class="na">binarySearch</code><code class="o">(</code><code class="n">intarray</code><code class="o">,</code> <code class="mi">12</code><code class="o">);</code>

<code class="c1">// Arrays of objects can be sorted and searched too</code>
<code class="n">String</code><code class="o">[]</code> <code class="n">strarray</code> <code class="o">=</code> <code class="k">new</code> <code class="n">String</code><code class="o">[]</code> <code class="o">{</code> <code class="s">now</code><code class="o">,</code> <code class="s">is</code><code class="o">,</code> <code class="s">the</code><code class="o">,</code> <code class="s">time</code> <code class="o">};</code>
<code class="n">Arrays</code><code class="o">.</code><code class="na">sort</code><code class="o">(</code><code class="n">strarray</code><code class="o">);</code>   <code class="c1">// sorted to: { &quot;is&quot;, &quot;now&quot;, &quot;the&quot;, &quot;time&quot; }</code>

<code class="c1">// Arrays.equals  compares all elements of two arrays</code>
<code class="n">String</code><code class="o">[]</code> <code class="n">clone</code> <code class="o">=</code> <code class="o">(</code><code class="n">String</code><code class="o">[])</code> <code class="n">strarray</code><code class="o">.</code><code class="na">clone</code><code class="o">();</code>
<code class="kt">boolean</code> <code class="n">b1</code> <code class="o">=</code> <code class="n">Arrays</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">strarray</code><code class="o">,</code> <code class="n">clone</code><code class="o">);</code>  <code class="c1">// Yes, they&apos;re equal</code>

<code class="c1">// Arrays.fill  initializes array elements</code>
<code class="c1">// An empty array; elements set to 0</code>
<code class="kt">byte</code><code class="o">[]</code> <code class="n">data</code> <code class="o">=</code> <code class="k">new</code> <code class="kt">byte</code><code class="o">[</code><code class="mi">100</code><code class="o">];</code>
<code class="c1">// Set them all to -1</code>
<code class="n">Arrays</code><code class="o">.</code><code class="na">fill</code><code class="o">(</code><code class="n">data</code><code class="o">,</code> <code class="o">(</code><code class="kt">byte</code><code class="o">)</code> <code class="o">-</code><code class="mi">1</code><code class="o">);</code>
<code class="c1">// Set elements 5, 6, 7, 8, 9 to -2</code>
<code class="n">Arrays</code><code class="o">.</code><code class="na">fill</code><code class="o">(</code><code class="n">data</code><code class="o">,</code> <code class="mi">5</code><code class="o">,</code> <code class="mi">10</code><code class="o">,</code> <code class="o">(</code><code class="kt">byte</code><code class="o">)</code> <code class="o">-</code><code class="mi">2</code><code class="o">);</code></pre>

<p>Arrays can be treated and manipulated as objects in Java. Given an
arbitrary object <code>o</code>, you can use code such as the following to find out
if the object is an array and, if so, what type of array it is:<a data-startref="ix_ch08-asciidoc1" data-type="indexterm" id="10_idm45941112994376"></a></p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Class</code> <code class="n">type</code> <code class="o">=</code> <code class="n">o</code><code class="o">.</code><code class="na">getClass</code><code class="o">();</code>
<code class="k">if</code> <code class="o">(</code><code class="n">type</code><code class="o">.</code><code class="na">isArray</code><code class="o">())</code> <code class="o">{</code>
  <code class="n">Class</code> <code class="n">elementType</code> <code class="o">=</code> <code class="n">type</code><code class="o">.</code><code class="na">getComponentType</code><code class="o">();</code>
<code class="o">}</code></pre>
</div></section>





</div></section>













<section data-pdf-bookmark="Java Streams and Lambda Expressions" data-type="sect1"><div class="sect1" id="idm45941113171336">
<h1>Java Streams and Lambda Expressions</h1>

<p><a data-primary="Java Streams" data-type="indexterm" id="10_ix_ch08-asciidoc18"></a><a data-primary="Java Streams" data-secondary="lambda expressions and" data-type="indexterm" id="10_ix_ch08-asciidoc19"></a><a data-primary="lambda expressions" data-secondary="Java Streams and" data-type="indexterm" id="10_ix_ch08-asciidoc20"></a>One of the major reasons for introducing lambda expressions in Java 8
was to facilitate the overhaul of the Collections API to allow more
modern programming styles to be used by Java developers. Until the
release of Java 8, the handling of data structures in Java looked a
little bit dated.
Many languages now support a programming style that allows collections to be treated as a whole, rather than requiring them to be broken apart and iterated over.</p>

<p>In fact, many Java developers had taken to using alternative data
structures libraries to achieve some of the expressivity and
productivity that they felt was lacking in the Collections API.
The key to upgrading the APIs was to introduce new classes and methods that would accept lambda expressions as parameters鈥攖o define <em>what</em> needed to be done, rather than precisely <em>how</em>.
This is a conception of programming that comes from the functional style.</p>

<p><a data-primary="functional collections" data-seealso="Java Streams" data-type="indexterm" id="10_idm45941112705752"></a>The introduction of the functional collections鈥攚hich are called <em>Java Streams</em> to make clear their divergence from the older collections approach鈥攊s an important step forward.
A stream can be created from a collection simply by calling the <code>stream()</code> method on an existing collection.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><a data-primary="default methods" data-secondary="collections and" data-type="indexterm" id="10_idm45941112702792"></a>The desire to add new methods to existing interfaces was directly
responsible for the new language feature referred to as <em>default
methods</em> (see <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4-SECT-1.5">鈥淒efault Methods鈥?/a&gt; for more
details). Without this new mechanism, older implementations of the
Collections interfaces would fail to compile under Java 8, and would
fail to link if loaded into a Java 8 runtime.</p>
</div>

<p><a data-primary="Java 8" data-secondary="Streams" data-type="indexterm" id="10_idm45941112699736"></a>However, the arrival of the Streams API does not erase history.
The Collections API is deeply embedded in the Java world, and it is not functional.
Java鈥檚 commitment to backward compatibility and to a rigid language grammar means that the Collections will never go away.
Java code, even when written in a functional style, will never be full of boilerplate, and will never have the concise syntax that we see in languages such as Haskell or Scala.</p>

<p>This is part of the inevitable trade-off in language design鈥擩ava has retrofitted functional capabilities on top of an imperative design and base.
This is not the same as designing for functional programming from the ground up.
A more important question is: are the functional capabilities supplied from Java 8 onward what working programmers need to build their applications?</p>

<p>The rapid adoption of Java 8 over previous versions and the community reaction seem to indicate that the new features have been a success, and that they have provided what the ecosystem was looking for.</p>

<p>In this section, we will give a basic introduction to the use of Java streams and lambda expressions in the Java Collections.
For a fuller treatment, see <a class="orm:hideurl" href="http://shop.oreilly.com/product/0636920030713.do"><em>Java 8 Lambdas</em></a> by Richard Warburton (O鈥橰eilly).</p>








<section data-pdf-bookmark="Functional Approaches" data-type="sect2"><div class="sect2" id="idm45941112694872">
<h2>Functional Approaches</h2>

<p><a data-primary="functional programming" data-secondary="key patterns" data-type="indexterm" id="10_ix_ch08-asciidoc21"></a><a data-primary="Java Streams" data-secondary="functional approaches" data-type="indexterm" id="10_ix_ch08-asciidoc22"></a>The approach that Java 8 Streams wished to enable was derived from functional
programming languages and styles. We met some of these key patterns in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch04.html#javanut7-CHP-4-SECT-5.2">鈥淣onstatic Member Classes鈥?/a&gt;鈥攍et鈥檚 reintroduce them and
look at some examples of each.</p>










<section data-pdf-bookmark="Filter" data-type="sect3"><div class="sect3" id="idm45941112689768">
<h3>Filter</h3>

<p><a data-primary="filter()" data-secondary="in Java 8" data-type="indexterm" id="10_idm45941112688200"></a>The idiom applies a piece of code (that returns either true or false)
to each element in a collection, and builds up a new collection
consisting of those elements that 鈥減assed the test鈥?(i.e., the bit of
code returned <code>true</code> when applied to the element).</p>

<p>For example, let鈥檚 look at some code to work with a collection of cats
and pick out the tigers:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">String</code><code class="o">[]</code> <code class="n">input</code> <code class="o">=</code> <code class="o">{</code><code class="s">tiger</code><code class="o">,</code> <code class="s">cat</code><code class="o">,</code> <code class="s">TIGER</code><code class="o">,</code> <code class="s">Tiger</code><code class="o">,</code> <code class="s">leopard</code><code class="o">};</code>
<code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">cats</code> <code class="o">=</code> <code class="n">Arrays</code><code class="o">.</code><code class="na">asList</code><code class="o">(</code><code class="n">input</code><code class="o">);</code>
<code class="n">String</code> <code class="n">search</code> <code class="o">=</code> <code class="s">tiger</code><code class="o">;</code>
<code class="n">String</code> <code class="n">tigers</code> <code class="o">=</code> <code class="n">cats</code><code class="o">.</code><code class="na">stream</code><code class="o">()</code>
                    <code class="o">.</code><code class="na">filter</code><code class="o">(</code><code class="n">s</code> <code class="o">-&gt;</code> <code class="n">s</code><code class="o">.</code><code class="na">equalsIgnoreCase</code><code class="o">(</code><code class="n">search</code><code class="o">))</code>
                    <code class="o">.</code><code class="na">collect</code><code class="o">(</code><code class="n">Collectors</code><code class="o">.</code><code class="na">joining</code><code class="o">(</code><code class="s">, </code><code class="o">));</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">tigers</code><code class="o">);</code></pre>

<p><a data-primary="filter()" data-secondary="Predicate interface" data-type="indexterm" id="10_idm45941112654456"></a>The key piece is the call to <code>filter()</code>, which takes a lambda
expression. The lambda takes in a string and returns a Boolean value.
This is applied over the whole collection <code>cats</code>, and a new collection
is created, which only contains tigers (however they were capitalized).</p>

<p><a data-primary="Predicate interface" data-type="indexterm" id="10_idm45941112556040"></a>The <code>filter()</code> method takes in an instance of the <code>Predicate</code>
interface, from the package <code>java.util.function</code>. This is a
functional interface, with only a single nondefault method, and so is a
perfect fit for a lambda expression.</p>

<p><a data-primary="collect()" data-type="indexterm" id="10_idm45941112553528"></a>Note the final call to <code>collect()</code>; this is an essential part of the
API and is used to 鈥済ather up鈥?the results at the end of the lambda
operations. We鈥檒l discuss it in more detail in the next section.</p>

<p><code>Predicate</code> has some other very useful default methods, such as for
constructing combined predicates by using logic operations. For example,
if the tigers want to admit leopards into their group, this can be
<a data-primary="or()" data-type="indexterm" id="10_idm45941112551176"></a>represented by using the <code>or()</code> method:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Predicate</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">p</code> <code class="o">=</code> <code class="n">s</code> <code class="o">-&gt;</code> <code class="n">s</code><code class="o">.</code><code class="na">equalsIgnoreCase</code><code class="o">(</code><code class="n">search</code><code class="o">);</code>
<code class="n">Predicate</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">combined</code> <code class="o">=</code> <code class="n">p</code><code class="o">.</code><code class="na">or</code><code class="o">(</code><code class="n">s</code> <code class="o">-&gt;</code> <code class="n">s</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="s">leopard</code><code class="o">));</code>
<code class="n">String</code> <code class="n">pride</code> <code class="o">=</code> <code class="n">cats</code><code class="o">.</code><code class="na">stream</code><code class="o">()</code>
                   <code class="o">.</code><code class="na">filter</code><code class="o">(</code><code class="n">combined</code><code class="o">)</code>
                   <code class="o">.</code><code class="na">collect</code><code class="o">(</code><code class="n">Collectors</code><code class="o">.</code><code class="na">joining</code><code class="o">(</code><code class="s">, </code><code class="o">));</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">pride</code><code class="o">);</code></pre>

<p>Note that it鈥檚 much clearer if the <code>Predicate&lt;String&gt;</code> object <code>p</code> is explicitly created, so that the defaulted <code>or()</code> method can be called on it and the second lambda expression (which will also be automatically converted to a <code>Predicate&lt;String&gt;</code>) passed to it.</p>
</div></section>













<section data-pdf-bookmark="Map" data-type="sect3"><div class="sect3" id="idm45941112689176">
<h3>Map</h3>

<p><a data-primary="java.util.function" data-type="indexterm" id="10_idm45941112526824"></a>The map idiom in Java 8 makes use of a new interface <code>Function&lt;T, R&gt;</code>
in the package <code>java.util.function</code>.
<a data-primary="apply()" data-type="indexterm" id="10_idm45941112456744"></a>Like <code>Predicate&lt;T&gt;</code>, this is a functional interface, and so only has one nondefaulted method, <code>apply()</code>.
The map idiom is about transforming a stream of one type into a stream of a potentially different type. This shows up in the API as the fact that <code>Function&lt;T, R&gt;</code> has two separate type parameters.
The name of the type parameter <code>R</code> indicates that this represents the return type of the function.</p>

<p><a data-primary="map()" data-type="indexterm" id="10_idm45941112453896"></a>Let鈥檚 look at a code example that uses <code>map()</code>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">List</code><code class="o">&lt;</code><code class="n">Integer</code><code class="o">&gt;</code> <code class="n">namesLength</code> <code class="o">=</code> <code class="n">cats</code><code class="o">.</code><code class="na">stream</code><code class="o">()</code>
                <code class="o">.</code><code class="na">map</code><code class="o">(</code><code class="nl">String:</code><code class="o">:</code><code class="n">length</code><code class="o">)</code>
                <code class="o">.</code><code class="na">collect</code><code class="o">(</code><code class="n">Collectors</code><code class="o">.</code><code class="na">toList</code><code class="o">());</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">namesLength</code><code class="o">);</code></pre>

<p>This is called upon the previous <code>cats</code> variable (which is a <code>Stream&lt;String&gt;</code>) and applies the function <code>String::length</code> (a method reference) to each string in turn.
The result is a new stream鈥攂ut of <code>Integer</code> this time.
Note that unlike the collections API, the <code>map()</code> method does not mutate the stream in place, but returns a new value.
This is key to the functional style as used here.</p>
</div></section>













<section data-pdf-bookmark="forEach" data-type="sect3"><div class="sect3" id="idm45941112369016">
<h3>forEach</h3>

<p><a data-primary="forEach()" data-type="indexterm" id="10_idm45941112367736"></a>The map and filter idioms are used to create one collection from
another. In languages that are strongly functional, this would be
combined with requiring that the original collection was not affected by
the body of the lambda as it touched each element. In computer science
terms, this means that the lambda body should be 鈥渟ide-effect free.鈥?/p&gt;

<p>In Java, of course, we often need to deal with mutable data, so the Streams API provides a way to mutate elements as the collection is traversed鈥攖he <code>forEach()</code> method. This takes an argument of type <code>Consumer&lt;T&gt;</code>, which is a functional interface that is expected to operate by side effects (although whether it actually mutates the data or not is of lesser importance).
This means that the signature of lambdas that can be converted to <code>Consumer&lt;T&gt;</code> is <code>(T t) 鈫?void</code>.
Let鈥檚 look at a quick example of <code>forEach()</code>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">pets</code> <code class="o">=</code>
  <code class="n">Arrays</code><code class="o">.</code><code class="na">asList</code><code class="o">(</code><code class="s">dog</code><code class="o">,</code> <code class="s">cat</code><code class="o">,</code> <code class="s">fish</code><code class="o">,</code> <code class="s">iguana</code><code class="o">,</code> <code class="s">ferret</code><code class="o">);</code>
<code class="n">pets</code><code class="o">.</code><code class="na">stream</code><code class="o">().</code><code class="na">forEach</code><code class="o">(</code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">::</code><code class="n">println</code><code class="o">);</code></pre>

<p>In this example, we are simply printing out each member of the
collection. However, we鈥檙e doing so by using a special kind of method
reference as a lambda expression. <a data-primary="bound method reference" data-type="indexterm" id="10_idm45941112341160"></a>This type of method reference is
called a <em>bound method reference</em>, as it involves a specific object (in
this case, the object <code>System.out</code>, which is a static public field of
<code>System</code>). This is equivalent to the lambda expression:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">s</code> <code class="o">-&gt;</code> <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">s</code><code class="o">);</code></pre>

<p>This is of course eligible for conversion to an instance of a type that
implements <code>Consumer&lt;? super String&gt;</code> as required by the method
signature.</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>Nothing prevents a <code>map()</code> or <code>filter()</code> call from mutating elements. It
is only a convention that they must not, but it鈥檚 one that every Java
programmer should adhere to.</p>
</div>

<p>There鈥檚 one final functional technique that we should look at before we
move on. This is the practice of aggregating a collection down to a
single value, and it鈥檚 the subject of our next section.</p>
</div></section>













<section data-pdf-bookmark="Reduce" data-type="sect3"><div class="sect3" id="idm45941112312840">
<h3>Reduce</h3>

<p><a data-primary="reduce()" data-type="indexterm" id="10_idm45941112311240"></a>Let鈥檚 look at the <code>reduce()</code> method. This implements the reduce idiom,
which is really a family of similar and related operations, some
referred to as fold, or aggregation, operations.</p>

<p>In Java 8, <code>reduce()</code> takes two arguments. These are the initial value,
which is often called the identity (or zero), and a function to apply
step by step. This function is of type <code>BinaryOperator&lt;T&gt;</code>, which is
another functional interface that takes in two arguments of the same
type, and returns another value of that type. This second argument to
<code>reduce()</code> is a two-argument lambda. <code>reduce()</code> is defined in the
<code>javadoc</code> like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">T</code> <code class="nf">reduce</code><code class="o">(</code><code class="n">T</code> <code class="n">identity</code><code class="o">,</code> <code class="n">BinaryOperator</code><code class="o">&lt;</code><code class="n">T</code><code class="o">&gt;</code> <code class="n">aggregator</code><code class="o">);</code></pre>

<p>The easy way to think about the second argument to <code>reduce()</code> is that it
creates a 鈥渞unning total鈥?as it runs over the stream. It starts by
combining the identity with the first element of the stream to produce
the first result, then combines that result with the second element of
the stream, and so on.</p>

<p>It can help to imagine that the implementation of <code>reduce()</code> works a bit
like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="n">T</code> <code class="nf">reduce</code><code class="o">(</code><code class="n">T</code> <code class="n">identity</code><code class="o">,</code> <code class="n">BinaryOperator</code><code class="o">&lt;</code><code class="n">T</code><code class="o">&gt;</code> <code class="n">aggregator</code><code class="o">)</code> <code class="o">{</code>
    <code class="n">T</code> <code class="n">runningTotal</code> <code class="o">=</code> <code class="n">identity</code><code class="o">;</code>
    <code class="k">for</code> <code class="o">(</code><code class="n">T</code> <code class="n">element</code> <code class="o">:</code> <code class="n">myStream</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">runningTotal</code> <code class="o">=</code> <code class="n">aggregator</code><code class="o">.</code><code class="na">apply</code><code class="o">(</code><code class="n">runningTotal</code><code class="o">,</code> <code class="n">element</code><code class="o">);</code>
    <code class="o">}</code>

    <code class="k">return</code> <code class="n">result</code><code class="o">;</code>
<code class="o">}</code></pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>In practice, implementations of <code>reduce()</code> can be more sophisticated
than these, and can even execute in parallel if the data structure and
operations are amenable to this.</p>
</div>

<p>Let鈥檚 look at a quick example of a <code>reduce()</code> and calculate the sum of
some primes:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">double</code> <code class="n">sumPrimes</code> <code class="o">=</code> <code class="o">((</code><code class="kt">double</code><code class="o">)</code><code class="n">Stream</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="mi">2</code><code class="o">,</code> <code class="mi">3</code><code class="o">,</code> <code class="mi">5</code><code class="o">,</code> <code class="mi">7</code><code class="o">,</code> <code class="mi">11</code><code class="o">,</code> <code class="mi">13</code><code class="o">,</code> <code class="mi">17</code><code class="o">,</code> <code class="mi">19</code><code class="o">,</code> <code class="mi">23</code><code class="o">)</code>
       <code class="o">.</code><code class="na">reduce</code><code class="o">(</code><code class="mi">0</code><code class="o">,</code> <code class="o">(</code><code class="n">x</code><code class="o">,</code> <code class="n">y</code><code class="o">)</code> <code class="o">-&gt;</code> <code class="o">{</code><code class="k">return</code> <code class="n">x</code> <code class="o">+</code> <code class="n">y</code><code class="o">;}));</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Sum of some primes: </code> <code class="o">+</code> <code class="n">sumPrimes</code><code class="o">);</code></pre>

<p>In all of the examples we鈥檝e met in this section, you may have noticed
the presence of a <code>stream()</code> method call on the <code>List</code> instance. This
is part of the evolution of the Collections鈥攊t was originally chosen
partly out of necessity, but has proved to be an excellent abstraction.
Let鈥檚 move on to discuss the Streams API in more detail.<a data-startref="ix_ch08-asciidoc22" data-type="indexterm" id="10_idm45941112085800"></a><a data-startref="ix_ch08-asciidoc21" data-type="indexterm" id="10_idm45941112085160"></a></p>
</div></section>



</div></section>













<section data-pdf-bookmark="The Streams API" data-type="sect2"><div class="sect2" id="idm45941112312216">
<h2>The Streams API</h2>

<p><a data-primary="Java Streams" data-secondary="introduction of Streams API" data-type="indexterm" id="10_ix_ch08-asciidoc23"></a>The fundamental issue that caused the Java library designers to introduce the Streams API was the large number of implementations of the core collections interfaces present in the wild.
As these implementations predate Java 8 and lambdas, they would not have any of the methods corresponding to the new functional operations.
Worse still, as method names such as <code>map()</code> and <code>filter()</code> have never been part of the interface of the Collections, implementations may already have methods with those names.</p>

<p><a data-primary="stream()" data-type="indexterm" id="10_idm45941112079944"></a>To work around this problem, a new abstraction called a <code>Stream</code> was introduced.
The idea is that a <code>Stream</code> object can be generated from a collection object via the <code>stream()</code> method.
This <code>Stream</code> type, being new and under the control of the library designers, is then guaranteed to be free of collisions.
This then mitigates the risk of clash, as only Collections implementations that contained a <code>stream()</code> method would be affected.</p>

<p>A <code>Stream</code> object plays a similar role to an <code>Iterator</code> in the new approach to collections code.
The overall idea is for the developer to build up a sequence (or 鈥減ipeline鈥? of operations (such as <code>map</code>, <code>filter</code>, or <code>reduce</code>) that need to be applied to the collection as a whole.
The actual content of the operations will usually be expressed by using a
lambda expression for each operation.</p>

<p>At the end of the pipeline, the results usually need to be gathered up, or 鈥渕aterialized鈥?back into an actual collection again.
This is done either by using a <code>Collector</code> or by finishing the pipeline with a 鈥渢erminal method鈥?such as <code>reduce()</code> that returns an actual value, rather than another stream.
Overall, the new approach to collections looks like
this:</p>

<pre data-code-language="java" data-type="programlisting">        <code class="n">stream</code><code class="o">()</code>   <code class="n">filter</code><code class="o">()</code>   <code class="n">map</code><code class="o">()</code>   <code class="n">collect</code><code class="o">()</code>
<code class="n">Collection</code> <code class="o">-&gt;</code> <code class="n">Stream</code> <code class="o">-&gt;</code> <code class="n">Stream</code> <code class="o">-&gt;</code> <code class="n">Stream</code> <code class="o">-&gt;</code> <code class="n">Collection</code></pre>

<p>The <code>Stream</code> class behaves as a sequence of elements that are accessed
one at a time (although there are some types of streams that support
parallel access and can be used to process larger collections in a
naturally multithreaded way). In a similar way to an <code>Iterator</code>, the
<code>Stream</code> is used to take each item in turn.</p>

<p>As is usual for generic classes in Java, <code>Stream</code> is parameterized by a
reference type. However, in many cases, we actually want streams of
primitive types, especially ints and doubles. We cannot have
<code>Stream&lt;int&gt;</code>, so instead in <code>java.util.stream</code> there are special
(nongeneric) classes such as <code>IntStream</code> and <code>DoubleStream</code>. These are
known as <em>primitive specializations</em> of the <code>Stream</code> class and have
APIs that are very similar to the general <code>Stream</code> methods, except that
they use primitives where <span class="keep-together">appropriate</span>.</p>

<p>For example, in the <code>reduce()</code> example, we鈥檙e actually using primitive
specialization over most of the pipeline.</p>










<section data-pdf-bookmark="Lazy evaluation" data-type="sect3"><div class="sect3" id="idm45941111999304">
<h3>Lazy evaluation</h3>

<p><a data-primary="Java Streams" data-secondary="lazy evaluation" data-type="indexterm" id="10_idm45941111997704"></a><a data-primary="lazy evaluation" data-type="indexterm" id="10_idm45941111996728"></a>In fact, streams are more general than iterators (or even collections),
as streams do not manage storage for data. In earlier versions of Java,
there was always a presumption that all of the elements of a collection
existed (usually in memory). It was possible to work around this in a
limited way by insisting on the use of iterators everywhere, and by
having the iterators construct elements on the fly. However, this was
neither very convenient nor that common.</p>

<p>By contrast, streams are an abstraction for managing data, rather than
being concerned with the details of storage. This makes it possible to
handle more subtle data structures than just finite collections. For
example, infinite streams can easily be represented by the <code>Stream</code>
interface, and can be used as a way to, for example, handle the set of
all square numbers. Let鈥檚 see how we could accomplish this using a
<code>Stream</code>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">SquareGenerator</code> <code class="kd">implements</code> <code class="n">IntSupplier</code> <code class="o">{</code>
    <code class="kd">private</code> <code class="kt">int</code> <code class="n">current</code> <code class="o">=</code> <code class="mi">1</code><code class="o">;</code>

    <code class="nd">@Override</code>
    <code class="kd">public</code> <code class="kd">synchronized</code> <code class="kt">int</code> <code class="nf">getAsInt</code><code class="o">()</code> <code class="o">{</code>
        <code class="kt">int</code> <code class="n">thisResult</code> <code class="o">=</code> <code class="n">current</code> <code class="o">*</code> <code class="n">current</code><code class="o">;</code>
        <code class="n">current</code><code class="o">++;</code>
        <code class="k">return</code> <code class="n">thisResult</code><code class="o">;</code>
    <code class="o">}</code>
<code class="o">}</code>

<code class="n">IntStream</code> <code class="n">squares</code> <code class="o">=</code> <code class="n">IntStream</code><code class="o">.</code><code class="na">generate</code><code class="o">(</code><code class="k">new</code> <code class="n">SquareGenerator</code><code class="o">());</code>
<code class="n">PrimitiveIterator</code><code class="o">.</code><code class="na">OfInt</code> <code class="n">stepThrough</code> <code class="o">=</code> <code class="n">squares</code><code class="o">.</code><code class="na">iterator</code><code class="o">();</code>
<code class="k">for</code> <code class="o">(</code><code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code> <code class="n">i</code> <code class="o">&lt;</code> <code class="mi">10</code><code class="o">;</code> <code class="n">i</code><code class="o">++)</code> <code class="o">{</code>
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">stepThrough</code><code class="o">.</code><code class="na">nextInt</code><code class="o">());</code>
<code class="o">}</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">First iterator done...</code><code class="o">);</code>

<code class="c1">// We can go on as long as we like...</code>
<code class="k">for</code> <code class="o">(</code><code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code> <code class="n">i</code> <code class="o">&lt;</code> <code class="mi">10</code><code class="o">;</code> <code class="n">i</code><code class="o">++)</code> <code class="o">{</code>
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">stepThrough</code><code class="o">.</code><code class="na">nextInt</code><code class="o">());</code>
<code class="o">}</code></pre>

<p>One significant consequence of modeling the infinite stream is that
methods like <code>collect()</code> won鈥檛 work. This is because we can鈥檛
materialize the whole stream to a collection (we would run out of memory
before we created the infinite amount of objects we would need).
Instead, we must adopt a model in which we pull the elements out of the stream as we need them.
Essentially, we need a bit of code that returns the next element as we demand it.
The key technique that is used to accomplish this is <em>lazy evaluation</em>. This essentially means that values are not necessarily computed until they are needed.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Lazy evaluation is a big change for Java, as until JDK 8 the value of an
expression was always computed as soon as it was assigned to a variable
(or passed into a method). This familiar model, where values are
computed immediately, is called <a data-primary="eager evaluation" data-type="indexterm" id="10_idm45941111861112"></a>鈥渆ager evaluation鈥?and it is the
default behavior for evaluation of expressions in most mainstream
programming languages.</p>
</div>

<p>Fortunately, lazy evaluation is largely a burden that falls on the
library writer, not the developer, and for the most part when using the
Streams API, Java developers don鈥檛 need to think closely about lazy
evaluation. Let鈥檚 finish off our discussion of streams by looking at an
extended code example using <code>reduce()</code>, and calculate the average word
length in some Shakespeare quotes:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">String</code><code class="o">[]</code> <code class="n">billyQuotes</code> <code class="o">=</code> <code class="o">{</code><code class="s">For Brutus is an honourable man</code><code class="o">,</code>
  <code class="s">Give me your hands if we be friends and Robin shall restore amends</code><code class="o">,</code>
  <code class="s">Misery acquaints a man with strange bedfellows</code><code class="o">};</code>
<code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">quotes</code> <code class="o">=</code> <code class="n">Arrays</code><code class="o">.</code><code class="na">asList</code><code class="o">(</code><code class="n">billyQuotes</code><code class="o">);</code>


<code class="c1">// Create a temporary collection for our words</code>
<code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">words</code> <code class="o">=</code> <code class="n">quotes</code><code class="o">.</code><code class="na">stream</code><code class="o">()</code>
        <code class="o">.</code><code class="na">flatMap</code><code class="o">(</code><code class="n">line</code> <code class="o">-&gt;</code> <code class="n">Stream</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="n">line</code><code class="o">.</code><code class="na">split</code><code class="o">(</code><code class="s"> +</code><code class="o">)))</code>
        <code class="o">.</code><code class="na">collect</code><code class="o">(</code><code class="n">Collectors</code><code class="o">.</code><code class="na">toList</code><code class="o">());</code>
<code class="kt">long</code> <code class="n">wordCount</code> <code class="o">=</code> <code class="n">words</code><code class="o">.</code><code class="na">size</code><code class="o">();</code>

<code class="c1">// The cast to double is only needed to prevent Java from using</code>
<code class="c1">// integer division</code>
<code class="kt">double</code> <code class="n">aveLength</code> <code class="o">=</code> <code class="o">((</code><code class="kt">double</code><code class="o">)</code> <code class="n">words</code><code class="o">.</code><code class="na">stream</code><code class="o">()</code>
        <code class="o">.</code><code class="na">map</code><code class="o">(</code><code class="nl">String:</code><code class="o">:</code><code class="n">length</code><code class="o">)</code>
        <code class="o">.</code><code class="na">reduce</code><code class="o">(</code><code class="mi">0</code><code class="o">,</code> <code class="o">(</code><code class="n">x</code><code class="o">,</code> <code class="n">y</code><code class="o">)</code> <code class="o">-&gt;</code> <code class="o">{</code><code class="k">return</code> <code class="n">x</code> <code class="o">+</code> <code class="n">y</code><code class="o">;}))</code> <code class="o">/</code> <code class="n">wordCount</code><code class="o">;</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Average word length: </code> <code class="o">+</code> <code class="n">aveLength</code><code class="o">);</code></pre>

<p><a data-primary="flatMap()" data-type="indexterm" id="10_idm45941111856136"></a>In this example, we鈥檝e introduced the <code>flatMap()</code> method. In our
example, it takes in a single string, <code>line</code>, and returns a stream of
strings, which is obtained by splitting up the line into its component
words. These are then 鈥渇lattened鈥?so that all the sub-streams from each
string are just combined into a single stream.</p>

<p>This has the effect of splitting up each quote into its component words,
and making one superstream out of them. We count the words by creating
the object <code>words</code>, essentially 鈥減ausing鈥?halfway through the stream
pipeline, and rematerializing into a collection to get the number of
words before resuming our stream operations.</p>

<p>Once we鈥檝e done that, we can proceed with the reduce, and add up the
length of all the words, before dividing by the number of words that we
have, across the quotes. Remember that streams are a lazy abstraction,
so to perform an eager operation (like getting the size of a collection
that backs a stream) we have to rematerialize the collection.</p>
</div></section>













<section data-pdf-bookmark="Streams utility default methods" data-type="sect3"><div class="sect3" id="idm45941111998680">
<h3>Streams utility default methods</h3>

<p><a data-primary="Java Streams" data-secondary="default methods" data-type="indexterm" id="10_idm45941111690280"></a>Java 8 takes the opportunity to introduce a number of new methods to
the Java Collections libraries. Now that the language supports default
methods, it is possible to add new methods to the Collections without
breaking backward compatibility.</p>

<p><a data-primary="scaffold methods" data-type="indexterm" id="10_idm45941111688664"></a>Some of these methods are <em>scaffold methods</em> for the Streams
abstraction. These include methods such as <code>Collection::stream</code>,
<code>Collection::parallelStream</code>, and <code>Collection::spliterator</code> (which has
specialized forms <code>List::spliterator</code> and <code>Set::spliterator</code>).</p>

<p>Others are 鈥渕issing methods,鈥?such as <code>Map::remove</code> and <code>Map::replace</code>.
Some of these have been backported from the <code>java.util.concurrent</code> package where they were originally defined.
As an example, this includes the <code>List::sort</code> method, which is defined in <code>List</code> like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Essentially just forwards to the helper method in Collections</code>
<code class="kd">public</code> <code class="k">default</code> <code class="kt">void</code> <code class="nf">sort</code><code class="o">(</code><code class="n">Comparator</code><code class="o">&lt;?</code> <code class="kd">super</code> <code class="n">E</code><code class="o">&gt;</code> <code class="n">c</code><code class="o">)</code> <code class="o">{</code>
    <code class="n">Collections</code><code class="o">.&lt;</code><code class="n">E</code><code class="o">&gt;</code><code class="n">sort</code><code class="o">(</code><code class="k">this</code><code class="o">,</code> <code class="n">c</code><code class="o">);</code>
<code class="o">}</code></pre>

<p>Another example is the missing method <code>Map::putIfAbsent</code>, which has been
adopted from the <code>ConcurrentMap</code> interface in <code>java.util.concurrent</code>.</p>

<p>We also have the method <code>Map::getOrDefault</code>, which allows the programmer to avoid a lot of tedious <code>null</code> checks, by providing a value that should be returned if the key is not found.</p>

<p>The remaining methods provide additional functional techniques using the
interfaces of <code>java.util.function</code>:</p>
<dl>
<dt><code>Collection::removeIf</code></dt>
<dd>
<p>This method takes a <code>Predicate</code> and iterates internally over the
collection, removing any elements that satisfy the predicate object.</p>
</dd>
<dt><code>Map::forEach</code></dt>
<dd>
<p>The single argument to this method is a lambda expression that takes
two arguments (one of the key鈥檚 type and one of the value鈥檚 type) and
returns <code>void</code>. This is converted to an instance of <code>BiConsumer</code> and
is applied to each key/value pair in the map.</p>
</dd>
<dt><code>Map::computeIfAbsent</code></dt>
<dd>
<p>This takes a key and a lambda expression that maps the key type to the
value type. If the specified key (first parameter) is not present in
the map, then it computes a default value by using the lambda expression
and puts it in the map.</p>
</dd>
</dl>

<p>(See also <code>Map::computeIfPresent</code>, <code>Map::compute</code>, and <code>Map::merge</code>.)</p>
</div></section>



</div></section>





</div></section>













<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="idm45941112083896">
<h1>Summary</h1>

<p>In this chapter, we鈥檝e met the Java Collections libraries, and seen
how to start working with Java鈥檚 implementations of fundamental and
classic data structures. We鈥檝e met the general <code>Collection</code> interface,
as well as <code>List</code>, <code>Set</code>, and <code>Map</code>. We鈥檝e seen the original, iterative
way of handling collections, and also introduced the new Java 8 style,
based on ideas from fundamental programming.
Finally, we鈥檝e met the Streams API and seen how the new approach is more general, and is able to express more subtle programming concepts than the classic approach.</p>

<p>We鈥檝e only scratched the surface鈥攖he Streams API is a fundamental shift in how Java code is written and architected.
There are inherent design limitations in how far the ideals of functional programming can be implemented in Java.
Having said that, the possibility that Streams represent 鈥渏ust enough functional programming鈥?is compelling<a data-startref="ix_ch08-asciidoc23" data-type="indexterm" id="10_idm45941111634536"></a>.<a data-startref="ix_ch08-asciidoc20" data-type="indexterm" id="10_idm45941111633704"></a><a data-startref="ix_ch08-asciidoc19" data-type="indexterm" id="10_idm45941111633000"></a><a data-startref="ix_ch08-asciidoc18" data-type="indexterm" id="10_idm45941111632328"></a></p>

<p>Let鈥檚 move on. In the next chapter, we鈥檒l continue looking at data, and
common tasks like text processing, handling numeric data, and Java 8鈥檚
new date and time libraries.<a data-startref="ix_ch08-asciidoc0" data-type="indexterm" id="10_idm45941111631080"></a></p>
</div></section>







</div></section><div class="annotator-outer annotator-viewer viewer annotator-hide"> </div></div></div>
    </section>
  </div>
</div>

<hr/>

<!--if IE]><![endif]--><!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/java-in-a/9781492037248/ch09.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="3866890"
  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"
  data-username="levinxccai"
  data-account-type="B2B"
  
  data-activated-trial-date="11/06/2017"


  data-archive="9781492037248"
  data-publishers="O&#39;Reilly Media, Inc."



  data-htmlfile-name="ch09.html"
  data-epub-title="Java in a Nutshell, 7th Edition" data-debug=0 data-testing=0><![endif]--><!--if gt IE 8]><!--><!--![endif]-->



<a name="11_"></a>

<div class="application" id="container" style="height: auto;">
  <div class="js-toc">
    <section role="document">
      <div id="sbo-rt-content" style="max-width:72.5em; transform: none;"><div class="annotator-wrapper"><section data-nutshell-tab="Common Data Formats" data-pdf-bookmark="Chapter 9. Handling Common Data Formats" data-type="chapter" epub:type="chapter"><div class="chapter" id="javanut7-CHP-9">
<h1><span class="label">Chapter 9. </span>Handling Common Data Formats</h1>


<p><a data-primary="data formats, handling of common" data-type="indexterm" id="11_ix_ch09-asciidoc0"></a>Most of programming is handling data in various formats. In this
chapter, we will introduce Java鈥檚 support for handling two big classes
of data鈥攖ext and numbers. The second half of the chapter will focus on
handling date and time information. This is of particular interest, as
Java 8 ships a completely new API for handling date and time. We cover
this new interface in some depth, before finishing the chapter by
briefly discussing Java鈥檚 original date and time API.</p>

<p>Many applications are still using the legacy APIs, so developers need to
be aware of the old way of doing things, but the new APIs are so much
better that we recommend converting as soon as possible. Before we get
to those more complex formats, let鈥檚 get under way by talking about
textual data and strings.</p>






<section data-pdf-bookmark="Text" data-type="sect1"><div class="sect1" id="idm45941111625800">
<h1>Text</h1>

<p><a data-primary="data formats, handling of common" data-secondary="text" data-type="indexterm" id="11_ix_ch09-asciidoc1"></a><a data-primary="text" data-type="indexterm" id="11_ix_ch09-asciidoc2"></a>We have already met Java鈥檚 strings on many occasions. They consist of
sequences of Unicode characters, and are represented as instances of
the <code>String</code> class. Strings are one of the most common types of data
that Java programs process (a claim you can investigate for yourself by
using the <code>jmap</code> tool that we鈥檒l meet in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch13.html#javanut7-CHP-13">Chapter 13</a>).</p>

<p>In this section, we鈥檒l meet the <code>String</code> class in some more depth, and
understand why it is in a rather unique position within the Java
language. Later in the section, we鈥檒l introduce regular expressions, a
very common abstraction for searching text for patterns (and a classic
tool in the programmer鈥檚 arsenal).</p>








<section data-pdf-bookmark="Special Syntax for Strings" data-type="sect2"><div class="sect2" id="idm45941111546360">
<h2>Special Syntax for Strings</h2>

<p><a data-primary="String class" data-secondary="special syntax for" data-type="indexterm" id="11_ix_ch09-asciidoc3"></a><a data-primary="strings" data-type="indexterm" id="11_ix_ch09-asciidoc4"></a><a data-primary="text" data-secondary="strings" data-type="indexterm" id="11_ix_ch09-asciidoc5"></a>The <code>String</code> class is handled in a somewhat special way by the Java
language. This is because, despite not being a primitive type, strings
are so common that it makes sense for Java to have a number of special
syntax features designed to make <span class="keep-together">handling</span> strings easy. Let鈥檚 look at
some examples of special syntax features for strings that Java provides.</p>










<section data-pdf-bookmark="String literals" data-type="sect3"><div class="sect3" id="idm45941111540056">
<h3>String literals</h3>

<p><a data-primary="string literals" data-type="indexterm" id="11_idm45941111538680"></a><a data-primary="strings" data-secondary="literals" data-type="indexterm" id="11_idm45941111537976"></a>As we saw in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2">Chapter 2</a>, Java allows a sequence
of characters to be placed in double quotes to create a literal string
object. Like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">String</code> <code class="n">pet</code> <code class="o">=</code> <code class="s">Cat</code><code class="o">;</code></pre>

<p>Without this special syntax, we would have to write acres of horrible
code like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">char</code><code class="o">[]</code> <code class="n">pullingTeeth</code> <code class="o">=</code> <code class="o">{</code><code class="sc">C</code><code class="o">,</code> <code class="sc">a</code><code class="o">,</code> <code class="sc">t</code><code class="o">};</code>
<code class="n">String</code> <code class="n">pet</code> <code class="o">=</code> <code class="k">new</code> <code class="n">String</code><code class="o">(</code><code class="n">pullingTeeth</code><code class="o">);</code></pre>

<p>This would get tedious extremely quickly, so it鈥檚 no surprise that Java,
like all modern programming languages, provides a simple string literal
syntax. The string literals are perfectly sound objects, so code like
this is completely legal:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Dog</code><code class="o">.</code><code class="na">length</code><code class="o">());</code></pre>
</div></section>













<section data-pdf-bookmark="toString()" data-type="sect3"><div class="sect3" id="idm45941111484856">
<h3>toString()</h3>

<p><a data-primary="strings" data-secondary="toString() method" data-type="indexterm" id="11_idm45941111482040"></a><a data-primary="toString()" data-type="indexterm" id="11_idm45941111480952"></a>This method is defined on <code>Object</code>, and is designed to allow easy
conversion of any object to a string. <a data-primary="println()" data-type="indexterm" id="11_idm45941111479768"></a><a data-primary="System.out.println()" data-type="indexterm" id="11_idm45941111479064"></a>This makes it easy to print out
any object, by using the method <code>System.out.println()</code>. This method is
actually <code>PrintStream::println</code> because <code>System.out</code> is a static field
of type <code>PrintStream</code>. Let鈥檚 see how this method is defined:</p>

<pre data-code-language="java" data-type="programlisting">    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">println</code><code class="o">(</code><code class="n">Object</code> <code class="n">x</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">String</code> <code class="n">s</code> <code class="o">=</code> <code class="n">String</code><code class="o">.</code><code class="na">valueOf</code><code class="o">(</code><code class="n">x</code><code class="o">);</code>
        <code class="kd">synchronized</code> <code class="o">(</code><code class="k">this</code><code class="o">)</code> <code class="o">{</code>
            <code class="n">print</code><code class="o">(</code><code class="n">s</code><code class="o">);</code>
            <code class="n">newLine</code><code class="o">();</code>
        <code class="o">}</code>
    <code class="o">}</code></pre>

<p>This creates a new string by using the static method
<code>String::valueOf()</code>:</p>

<pre data-code-language="java" data-type="programlisting">    <code class="kd">public</code> <code class="kd">static</code> <code class="n">String</code> <code class="nf">valueOf</code><code class="o">(</code><code class="n">Object</code> <code class="n">obj</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">return</code> <code class="o">(</code><code class="n">obj</code> <code class="o">==</code> <code class="kc">null</code><code class="o">)</code> <code class="o">?</code> <code class="s">null</code> <code class="o">:</code> <code class="n">obj</code><code class="o">.</code><code class="na">toString</code><code class="o">();</code>
    <code class="o">}</code></pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The static <code>valueOf()</code> method is used instead of <code>toString()</code> directly,
to avoid a <code>NullPointerException</code> in the case where <code>obj</code> is <code>null</code>.</p>
</div>

<p>This construction means that <code>toString()</code> is always available for any
object, and this turns out to come in very handy for another major
syntax feature that Java provides: string concatenation.</p>
</div></section>













<section data-pdf-bookmark="String concatenation" data-type="sect3"><div class="sect3" id="idm45941111376904">
<h3>String concatenation</h3>

<p><a data-primary="concatenation, of strings" data-type="indexterm" id="11_idm45941111375464"></a><a data-primary="string concatenation operator (+)" data-type="indexterm" id="11_idm45941111374600"></a><a data-primary="strings" data-secondary="concatenation" data-type="indexterm" id="11_idm45941111373928"></a>Java allows us to create new strings by 鈥渁dding鈥?the characters from one string onto the end of another. <a data-primary="+ (plus sign)" data-secondary="string concatenation operator" data-type="indexterm" id="11_idm45941111340536"></a><a data-primary="string concatenation operator (+)" data-type="indexterm" id="11_idm45941111339624"></a>This is called <em>string concatenation</em> and uses the operator <code>+</code>.
In versions of Java up to and including Java 8, it works by first creating a 鈥渨orking area鈥?in the form of a <a data-primary="StringBuilder class" data-type="indexterm" id="11_idm45941111337816"></a><code>StringBuilder</code> object that contains the same sequence of characters as the original string.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Java 9 introduced a new mechanism that uses the <code>invokedynamic</code> instruction instead of <code>StringBuilder</code> directly. This is an advanced piece of functionality and out of scope for this discussion, but it doesn鈥檛 change the behavior visible to the Java developer.</p>
</div>

<p>The builder object is then updated and the characters from the
additional string are added onto the end. Finally, <code>toString()</code> is
called on the <code>StringBuilder</code> object (which now contains the characters
from both strings). This gives us a new string with all the characters
in it. All of this code is created automatically by <code>javac</code> whenever we
use the <code>+</code> operator to concatenate strings.</p>

<p>The concatenation process returns a completely new <code>String</code> object, as
we can see in this example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">String</code> <code class="n">s1</code> <code class="o">=</code> <code class="s">AB</code><code class="o">;</code>
<code class="n">String</code> <code class="n">s2</code> <code class="o">=</code> <code class="s">CD</code><code class="o">;</code>

<code class="n">String</code> <code class="n">s3</code> <code class="o">=</code> <code class="n">s1</code><code class="o">;</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">s1</code> <code class="o">==</code> <code class="n">s3</code><code class="o">);</code> <code class="c1">// Same object?</code>

<code class="n">s3</code> <code class="o">=</code> <code class="n">s1</code> <code class="o">+</code> <code class="n">s2</code><code class="o">;</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">s1</code> <code class="o">==</code> <code class="n">s3</code><code class="o">);</code> <code class="c1">// Still same?</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">s1</code><code class="o">);</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">s3</code><code class="o">);</code></pre>

<p>The concatenation example directly shows that the <code>+</code> operator is not
altering (or <em>mutating</em>) <code>s1</code> in place. This is an example of a more
general principle: Java鈥檚 strings are immutable. This means that once
the characters that make up the string have been chosen and the <code>String</code>
object has been created, the <code>String</code> cannot be changed. This is an
important language principle in Java, so let鈥檚 look at it in a little
more depth.</p>
</div></section>



</div></section>













<section data-pdf-bookmark="String Immutability" data-type="sect2"><div class="sect2" id="idm45941111238952">
<h2>String Immutability</h2>

<p><a data-primary="immutability" data-secondary="string" data-type="indexterm" id="11_ix_ch09-asciidoc6"></a><a data-primary="strings" data-secondary="immutability" data-type="indexterm" id="11_ix_ch09-asciidoc7"></a>In order to 鈥渃hange鈥?a string, as we saw when we discussed string
concatenation, we actually need to create an intermediate
<code>StringBuilder</code> object to act as a temporary scratch area, and then
call <code>toString()</code> on it, to bake it into a new instance of <code>String</code>.
Let鈥檚 see how this works in code:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">String</code> <code class="n">pet</code> <code class="o">=</code> <code class="s">Cat</code><code class="o">;</code>
<code class="n">StringBuilder</code> <code class="n">sb</code> <code class="o">=</code> <code class="k">new</code> <code class="n">StringBuilder</code><code class="o">(</code><code class="n">pet</code><code class="o">);</code>
<code class="n">sb</code><code class="o">.</code><code class="na">append</code><code class="o">(</code><code class="s">amaran</code><code class="o">);</code>
<code class="n">String</code> <code class="n">boat</code> <code class="o">=</code> <code class="n">sb</code><code class="o">.</code><code class="na">toString</code><code class="o">();</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">boat</code><code class="o">);</code></pre>

<p>Code like this behaves equivalently to the following, although in Java 9 and above the actual bytecode sequences will differ:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">String</code> <code class="n">pet</code> <code class="o">=</code> <code class="s">Cat</code><code class="o">;</code>
<code class="n">String</code> <code class="n">boat</code> <code class="o">=</code> <code class="n">pet</code> <code class="o">+</code> <code class="s">amaran</code><code class="o">;</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">boat</code><code class="o">);</code></pre>

<p>Of course, as well as being used under the hood by <code>javac</code>, the
<code>StringBuilder</code> class can also be used directly in application code, as
we鈥檝e seen.</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p><a data-primary="StringBuffer class" data-type="indexterm" id="11_idm45941111091304"></a>Along with <code>StringBuilder</code>, Java also has a <code>StringBuffer</code> class. This
comes from the oldest versions of Java, and should not be used for new
development鈥攗se <code>StringBuilder</code> instead, unless you really need to share
the construction of a new string between multiple threads.</p>
</div>

<p>String immutability is an extremely useful language feature. For
example, suppose the <code>+</code> changed a string instead of creating a new one;
then, whenever any thread concatenated two strings together, all other
threads would also see the change. This is unlikely to be a useful
behavior for most programs, and so immutability makes good sense.</p>










<section data-pdf-bookmark="Hash codes and effective immutability" data-type="sect3"><div class="sect3" id="idm45941111087608">
<h3>Hash codes and effective immutability</h3>

<p><a data-primary="hash codes" data-type="indexterm" id="11_idm45941111136840"></a><a data-primary="hashCode()" data-secondary="and effective immutability" data-type="indexterm" id="11_idm45941111135912"></a><a data-primary="hashCode()" data-secondary="String class" data-type="indexterm" id="11_idm45941111135000"></a><a data-primary="immutability" data-secondary="hash codes and" data-type="indexterm" id="11_idm45941111134056"></a><a data-primary="strings" data-secondary="hash codes and effective immutability" data-type="indexterm" id="11_idm45941111133112"></a>We have already met the <code>hashCode()</code> method in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch05.html#javanut7-CHP-5">Chapter 5</a>, where we described the contract that
the method must satisfy. Let鈥檚 take a look at the JDK source code and
see how the method <code>String::hashCode()</code> is defined:</p>

<pre data-code-language="java" data-type="programlisting">    <code class="kd">public</code> <code class="kt">int</code> <code class="nf">hashCode</code><code class="o">()</code> <code class="o">{</code>
        <code class="kt">int</code> <code class="n">h</code> <code class="o">=</code> <code class="n">hash</code><code class="o">;</code>
        <code class="k">if</code> <code class="o">(</code><code class="n">h</code> <code class="o">==</code> <code class="mi">0</code> <code class="o">&amp;&amp;</code> <code class="n">value</code><code class="o">.</code><code class="na">length</code> <code class="o">&gt;</code> <code class="mi">0</code><code class="o">)</code> <code class="o">{</code>
            <code class="kt">char</code> <code class="n">val</code><code class="o">[]</code> <code class="o">=</code> <code class="n">value</code><code class="o">;</code>

            <code class="k">for</code> <code class="o">(</code><code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code> <code class="n">i</code> <code class="o">&lt;</code> <code class="n">value</code><code class="o">.</code><code class="na">length</code><code class="o">;</code> <code class="n">i</code><code class="o">++)</code> <code class="o">{</code>
                <code class="n">h</code> <code class="o">=</code> <code class="mi">31</code> <code class="o">*</code> <code class="n">h</code> <code class="o">+</code> <code class="n">val</code><code class="o">[</code><code class="n">i</code><code class="o">];</code>
            <code class="o">}</code>
            <code class="n">hash</code> <code class="o">=</code> <code class="n">h</code><code class="o">;</code>
        <code class="o">}</code>
        <code class="k">return</code> <code class="n">h</code><code class="o">;</code>
    <code class="o">}</code></pre>

<p>The field <code>hash</code> holds the hash code of the string, and the field
<code>value</code> is a <code>char[]</code> that holds the characters that actually make up
the string. As we can see from the code, Java computes the hash by looping
over all the characters of the string. It therefore takes a number of
machine instructions proportional to the number of characters in the
string. For very large strings, this could take a bit of time. Rather
than pre-compute the hash value, Java only calculates it when it is
needed.</p>

<p>When the method runs, the hash is computed by stepping through the array
of characters. At the end of the array, we exit the <code>for</code> loop and write
the computed hash back into the field <code>hash</code>. Now, when this method is
called again, the value has already been computed, so we can just
use the cached value and subsequent calls to <code>hashCode()</code> return
immediately.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><a data-primary="benign data race" data-type="indexterm" id="11_idm45941111009224"></a>The computation of a string鈥檚 hash code is an example of a <em>benign data
race</em>. In a program with multiple threads, they could race to compute
the hash code. However, they would all eventually arrive at exactly the
same answer鈥攈ence the term <em>benign</em>.</p>
</div>

<p>All of the fields of the <code>String</code> class are final, except for <code>hash</code>. So
Java鈥檚 strings are not, strictly speaking, immutable. However, because
the <code>hash</code> field is just a cache of a value that is deterministically
computed from the other fields, which are all immutable, then provided
<code>String</code> has been coded correctly, it will behave as if it were
immutable. <a data-primary="effectively immutable classes" data-type="indexterm" id="11_idm45941111004808"></a>Classes that have this property are called <em>effectively
immutable</em>鈥攖hey are quite rare in practice, and working programmers
can usually ignore the distinction between truly immutable and
effectively immutable data<a data-startref="ix_ch09-asciidoc7" data-type="indexterm" id="11_idm45941111003400"></a><a data-startref="ix_ch09-asciidoc6" data-type="indexterm" id="11_idm45941111002696"></a>.<a data-startref="ix_ch09-asciidoc5" data-type="indexterm" id="11_idm45941111001896"></a><a data-startref="ix_ch09-asciidoc4" data-type="indexterm" id="11_idm45941111001192"></a><a data-startref="ix_ch09-asciidoc3" data-type="indexterm" id="11_idm45941111000520"></a></p>
</div></section>



</div></section>













<section data-pdf-bookmark="Regular Expressions" data-type="sect2"><div class="sect2" id="idm45941110999848">
<h2>Regular Expressions</h2>

<p><a data-primary="regular expressions (regex)" data-type="indexterm" id="11_ix_ch09-asciidoc8"></a><a data-primary="search" data-secondary="regular expressions and" data-type="indexterm" id="11_ix_ch09-asciidoc9"></a><a data-primary="text" data-secondary="regular expressions and" data-type="indexterm" id="11_ix_ch09-asciidoc10"></a>Java has support for <em>regular</em> <em>expressions</em> (often shortened to
<em>regex</em> or <em>regexp</em>). These are a representation of a search pattern
used to scan and match text. A regex is a sequence of characters that we
want to search for. They can be very simple鈥攆or example, <code>abc</code> means
that we鈥檙e looking for <em>a</em>, followed immediately by <em>b</em>, followed
immediately by <em>c</em>, anywhere within the text we鈥檙e searching through.
Note that a search pattern may match an input text in zero, one, or more
places.</p>

<p>The simplest regexes are just sequences of literal characters, like
<code>abc</code>. However, the language of regexes can express more complex and
subtle ideas than just literal sequences. For example, a regex can
represent patterns to match like:</p>

<ul>
<li>
<p>A numeric digit</p>
</li>
<li>
<p>Any letter</p>
</li>
<li>
<p>Any number of letters, which must all be in the range <em>a</em> to <em>j</em> but
can be upper- or lowercase</p>
</li>
<li>
<p><em>a</em> followed by any four characters, followed by <em>b</em></p>
</li>
</ul>

<p>The syntax we use to write regular expressions is simple, but because we
can build up complex patterns, it is often possible to write an
expression that does not implement precisely what we wanted. When using
regexes, it is very important to always test them fully. This should
include both test cases that should pass and cases that should fail.</p>

<p><a data-primary="metacharacters in regular expressions" data-type="indexterm" id="11_idm45941110983048"></a>To express these more complex patterns, regexes use <em>metacharacters</em>.
These are special characters that indicate that special processing is
required. This can be thought of as similar to the use of the <code>*</code>
character in operating system shells. In those circumstances, it is
understood that the <code>*</code> is not to be interpreted literally but instead
means 鈥渁nything.鈥?If we wanted to list all the Java source files in the
current directory on Unix, we would issue the command:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">ls</code> <code class="o">*.</code><code class="na">java</code></pre>

<p>The metacharacters of regexes are similar, but there are far more of
them, and they are far more flexible than the set available in shells.
They also have different meanings than they do in shell scripts, so
don鈥檛 get confused.</p>

<p>Let鈥檚 meet a couple of examples. Suppose we want to have a
spell-checking program that is relaxed about the difference in spelling
between British and American English. This means that <em>honor</em> and
<em>honour</em> should both be accepted as valid spelling choices. This is easy
to do with regular expressions.</p>

<p><a data-primary="java.util.regex package" data-type="indexterm" id="11_idm45941110974936"></a>Java uses a class called <code>Pattern</code> (from the package
<code>java.util.regex</code>) to represent a regex. This class can鈥檛 be directly
instantiated, however. Instead, new instances are created by using a
static factory method, <code>compile()</code>. From a pattern, we then derive a
<a data-primary="Matcher class" data-type="indexterm" id="11_idm45941110972312"></a><code>Matcher</code> for a particular input string that we can use to explore the
input string. For example, let鈥檚 examine a bit of Shakespeare from the
play <em>Julius Caesar</em>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Pattern</code> <code class="n">p</code> <code class="o">=</code> <code class="n">Pattern</code><code class="o">.</code><code class="na">compile</code><code class="o">(</code><code class="s">honou?r</code><code class="o">);</code>

<code class="n">String</code> <code class="n">caesarUK</code> <code class="o">=</code> <code class="s">For Brutus is an honourable man</code><code class="o">;</code>
<code class="n">Matcher</code> <code class="n">mUK</code> <code class="o">=</code> <code class="n">p</code><code class="o">.</code><code class="na">matcher</code><code class="o">(</code><code class="n">caesarUK</code><code class="o">);</code>

<code class="n">String</code> <code class="n">caesarUS</code> <code class="o">=</code> <code class="s">For Brutus is an honorable man</code><code class="o">;</code>
<code class="n">Matcher</code> <code class="n">mUS</code> <code class="o">=</code> <code class="n">p</code><code class="o">.</code><code class="na">matcher</code><code class="o">(</code><code class="n">caesarUS</code><code class="o">);</code>

<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Matches UK spelling? </code> <code class="o">+</code> <code class="n">mUK</code><code class="o">.</code><code class="na">find</code><code class="o">());</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Matches US spelling? </code> <code class="o">+</code> <code class="n">mUS</code><code class="o">.</code><code class="na">find</code><code class="o">());</code></pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Be careful when using <code>Matcher</code>, as it has a method called <code>matches()</code>.
However, this method indicates whether the pattern can cover the entire
input string. It will return <code>false</code> if the pattern only starts matching
in the middle of the string.</p>
</div>

<p><a data-primary="? (question mark)" data-secondary="regular expression metacharacter" data-type="indexterm" id="11_idm45941110828408"></a>The last example introduces our first regex metacharacter <code>?</code>, in the
pattern <code>honou?r</code>. This means 鈥渢he preceding character is optional鈥濃€攕o
both <code>honour</code> and <code>honor</code> will match. Let鈥檚 look at another example.
Suppose we want to match both <em>minimize</em> and <em>minimise</em> (the latter
spelling is more common in British English). <a data-primary="[ ] (brackets)" data-secondary="in regular expressions" data-type="indexterm" id="11_idm45941110824552"></a>We can use square brackets
to indicate that any character from a set (but only one alternative)
<code>[]</code> can be used鈥攍ike this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Pattern</code> <code class="n">p</code> <code class="o">=</code> <code class="n">Pattern</code><code class="o">.</code><code class="na">compile</code><code class="o">(</code><code class="s">minimi[sz]e</code><code class="o">);</code></pre>

<p><a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch09.html#javanut7-CHP-9-TABLE-1">Table 9-1</a> provides an
expanded list of metacharacters available for Java regexes.</p>
<table id="javanut7-CHP-9-TABLE-1">
<caption><span class="label">Table 9-1. </span>Regex metacharacters</caption>
<thead>
<tr>
<th>Metacharacter</th>
<th>Meaning</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><code>?</code></p></td>
<td><p>Optional character鈥攝ero or one instance</p></td>
<td></td>
</tr>
<tr>
<td><p><code>*</code></p></td>
<td><p>Zero or more of preceding character</p></td>
<td></td>
</tr>
<tr>
<td><p><code>+</code></p></td>
<td><p>One or more of preceding character</p></td>
<td></td>
</tr>
<tr>
<td><p><code>{M,N}</code></p></td>
<td><p>Between <code>M</code> and <code>N</code> instances of preceding character</p></td>
<td></td>
</tr>
<tr>
<td><p><code>\d</code></p></td>
<td><p>A digit</p></td>
<td></td>
</tr>
<tr>
<td><p><code>\D</code></p></td>
<td><p>A nondigit character</p></td>
<td></td>
</tr>
<tr>
<td><p><code>\w</code></p></td>
<td><p>A word character</p></td>
<td><p>Digits, letters, and <code>_</code></p></td>
</tr>
<tr>
<td><p><code>\W</code></p></td>
<td><p>A nonword character</p></td>
<td></td>
</tr>
<tr>
<td><p><code>\s</code></p></td>
<td><p>A whitespace character</p></td>
<td></td>
</tr>
<tr>
<td><p><code>\S</code></p></td>
<td><p>A nonwhitespace character</p></td>
<td></td>
</tr>
<tr>
<td><p><code>\n</code></p></td>
<td><p>Newline character</p></td>
<td></td>
</tr>
<tr>
<td><p><code>\t</code></p></td>
<td><p>Tab character</p></td>
<td></td>
</tr>
<tr>
<td><p><code>.</code></p></td>
<td><p>Any single character</p></td>
<td><p>Does not include newline in Java</p></td>
</tr>
<tr>
<td><p><code>[ ]</code></p></td>
<td><p>Any character contained with the brackets</p></td>
<td><p>Called a character
class</p></td>
</tr>
<tr>
<td><p><code>[^ ]</code></p></td>
<td><p>Any character not contained with the brackets</p></td>
<td><p>Called a negated
character class</p></td>
</tr>
<tr>
<td><p><code>( )</code></p></td>
<td><p>Build up a group of pattern elements</p></td>
<td><p>Called a group (or
capturing group)</p></td>
</tr>
<tr>
<td><p><code>|</code></p></td>
<td><p>Define alternative possbilities</p></td>
<td><p>Implements logical <code>OR</code></p></td>
</tr>
<tr>
<td><p><code>^</code></p></td>
<td><p>Start of string</p></td>
<td></td>
</tr>
<tr>
<td><p><code>$</code></p></td>
<td><p>End of string</p></td>
<td></td>
</tr>
<tr>
<td><p><code>\\</code></p></td>
<td><p>Literal escape (<code>\</code>) char</p></td>
<td></td>
</tr>
</tbody>
</table>

<p>There are a few more, but this is the basic list, and from this, we can
construct more complex expressions for matching such as the examples
given earlier in this section:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Note that we have to use \\ because we need a literal \</code>
<code class="c1">// and Java uses a single \ as an escape character, as per the table</code>
<code class="n">String</code> <code class="n">pStr</code> <code class="o">=</code> <code class="s">\\d</code><code class="o">;</code> <code class="c1">// A numeric digit</code>
<code class="n">String</code> <code class="n">text</code> <code class="o">=</code> <code class="s">Apollo 13</code><code class="o">;</code>
<code class="n">Pattern</code> <code class="n">p</code> <code class="o">=</code> <code class="n">Pattern</code><code class="o">.</code><code class="na">compile</code><code class="o">(</code><code class="n">pStr</code><code class="o">);</code>
<code class="n">Matcher</code> <code class="n">m</code> <code class="o">=</code> <code class="n">p</code><code class="o">.</code><code class="na">matcher</code><code class="o">(</code><code class="n">text</code><code class="o">);</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">print</code><code class="o">(</code><code class="n">pStr</code> <code class="o">+</code> <code class="s"> matches </code> <code class="o">+</code> <code class="n">text</code> <code class="o">+</code> <code class="s">? </code> <code class="o">+</code> <code class="n">m</code><code class="o">.</code><code class="na">find</code><code class="o">());</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s"> ; match: </code> <code class="o">+</code> <code class="n">m</code><code class="o">.</code><code class="na">group</code><code class="o">());</code>


<code class="n">pStr</code> <code class="o">=</code> <code class="s">[a..zA..Z]</code><code class="o">;</code> <code class="c1">//Any letter</code>
<code class="n">p</code> <code class="o">=</code> <code class="n">Pattern</code><code class="o">.</code><code class="na">compile</code><code class="o">(</code><code class="n">pStr</code><code class="o">);</code>
<code class="n">m</code> <code class="o">=</code> <code class="n">p</code><code class="o">.</code><code class="na">matcher</code><code class="o">(</code><code class="n">text</code><code class="o">);</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">print</code><code class="o">(</code><code class="n">pStr</code> <code class="o">+</code> <code class="s"> matches </code> <code class="o">+</code> <code class="n">text</code> <code class="o">+</code> <code class="s">? </code> <code class="o">+</code> <code class="n">m</code><code class="o">.</code><code class="na">find</code><code class="o">());</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s"> ; match: </code> <code class="o">+</code> <code class="n">m</code><code class="o">.</code><code class="na">group</code><code class="o">());</code>

<code class="c1">// Any number of letters, which must all be in the range &apos;a&apos; to &apos;j&apos;</code>
<code class="c1">// but can be upper- or lowercase</code>
<code class="n">pStr</code> <code class="o">=</code> <code class="s">([a..jA..J]*)</code><code class="o">;</code>
<code class="n">p</code> <code class="o">=</code> <code class="n">Pattern</code><code class="o">.</code><code class="na">compile</code><code class="o">(</code><code class="n">pStr</code><code class="o">);</code>
<code class="n">m</code> <code class="o">=</code> <code class="n">p</code><code class="o">.</code><code class="na">matcher</code><code class="o">(</code><code class="n">text</code><code class="o">);</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">print</code><code class="o">(</code><code class="n">pStr</code> <code class="o">+</code> <code class="s"> matches </code> <code class="o">+</code> <code class="n">text</code> <code class="o">+</code> <code class="s">? </code> <code class="o">+</code> <code class="n">m</code><code class="o">.</code><code class="na">find</code><code class="o">());</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s"> ; match: </code> <code class="o">+</code> <code class="n">m</code><code class="o">.</code><code class="na">group</code><code class="o">());</code>

<code class="n">text</code> <code class="o">=</code> <code class="s">abacab</code><code class="o">;</code>
<code class="c1">// &apos;a&apos; followed by any four characters, followed by &apos;b&apos;</code>
<code class="n">pStr</code> <code class="o">=</code> <code class="s">a....b</code><code class="o">;</code>
<code class="n">p</code> <code class="o">=</code> <code class="n">Pattern</code><code class="o">.</code><code class="na">compile</code><code class="o">(</code><code class="n">pStr</code><code class="o">);</code>
<code class="n">m</code> <code class="o">=</code> <code class="n">p</code><code class="o">.</code><code class="na">matcher</code><code class="o">(</code><code class="n">text</code><code class="o">);</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">print</code><code class="o">(</code><code class="n">pStr</code> <code class="o">+</code> <code class="s"> matches </code> <code class="o">+</code> <code class="n">text</code> <code class="o">+</code> <code class="s">? </code> <code class="o">+</code> <code class="n">m</code><code class="o">.</code><code class="na">find</code><code class="o">());</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s"> ; match: </code> <code class="o">+</code> <code class="n">m</code><code class="o">.</code><code class="na">group</code><code class="o">());</code></pre>

<p><a data-primary="asPredicate()" data-type="indexterm" id="11_idm45941110720776"></a><a data-primary="Predicate interface" data-secondary="converting regex to a Predicate" data-type="indexterm" id="11_idm45941110720168"></a>Let鈥檚 conclude our quick tour of regular expressions by meeting a new
method that was added to <code>Pattern</code> as part of Java 8: <code>asPredicate()</code>.
This method is present to allow us to easily bridge from regular
expressions to the Java Collections and their new support for lambda
expressions.</p>

<p>For example, suppose we have a regex and a collection of strings. It鈥檚
very natural to ask the question: 鈥淲hich strings match against the
regex?鈥?We do this by using the filter idiom, and by converting the
regex to a <code>Predicate</code> using the helper method, like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">String</code> <code class="n">pStr</code> <code class="o">=</code> <code class="s">\\d</code><code class="o">;</code> <code class="c1">// A numeric digit</code>
<code class="n">Pattern</code> <code class="n">p</code> <code class="o">=</code> <code class="n">Pattern</code><code class="o">.</code><code class="na">compile</code><code class="o">(</code><code class="n">pStr</code><code class="o">);</code>

<code class="n">String</code><code class="o">[]</code> <code class="n">inputs</code> <code class="o">=</code> <code class="o">{</code><code class="s">Cat</code><code class="o">,</code> <code class="s">Dog</code><code class="o">,</code> <code class="s">Ice-9</code><code class="o">,</code> <code class="s">99 Luftballoons</code><code class="o">};</code>
<code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">ls</code> <code class="o">=</code> <code class="n">Arrays</code><code class="o">.</code><code class="na">asList</code><code class="o">(</code><code class="n">inputs</code><code class="o">);</code>
<code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">containDigits</code> <code class="o">=</code> <code class="n">ls</code><code class="o">.</code><code class="na">stream</code><code class="o">()</code>
                               <code class="o">.</code><code class="na">filter</code><code class="o">(</code><code class="n">p</code><code class="o">.</code><code class="na">asPredicate</code><code class="o">())</code>
                               <code class="o">.</code><code class="na">collect</code><code class="o">(</code><code class="n">Collectors</code><code class="o">.</code><code class="na">toList</code><code class="o">());</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">containDigits</code><code class="o">);</code></pre>

<p>Java鈥檚 built-in support for text processing is more than adequate for
the majority of text processing tasks that business applications
normally require.<a data-startref="ix_ch09-asciidoc10" data-type="indexterm" id="11_idm45941116184536"></a><a data-startref="ix_ch09-asciidoc9" data-type="indexterm" id="11_idm45941116183928"></a><a data-startref="ix_ch09-asciidoc8" data-type="indexterm" id="11_idm45941110433016"></a> More advanced tasks, such as the search and processing
of very large data sets, or complex parsing (including formal grammars)
are outside the scope of this book, but Java has a large ecosystem of
helpful libraries and bindings to specialized technologies for text
processing and analysis.<a data-startref="ix_ch09-asciidoc2" data-type="indexterm" id="11_idm45941110431912"></a><a data-startref="ix_ch09-asciidoc1" data-type="indexterm" id="11_idm45941110431240"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Numbers and Math" data-type="sect1"><div class="sect1" id="idm45941110998936">
<h1>Numbers and Math</h1>

<p><a data-primary="data formats, handling of common" data-secondary="numbers and math" data-type="indexterm" id="11_ix_ch09-asciidoc11"></a><a data-primary="numbers" data-type="indexterm" id="11_ix_ch09-asciidoc12"></a>In this section, we will discuss Java鈥檚 support for numeric types in
some more detail. In particular, we鈥檒l discuss the two鈥檚 complement
representation of integral types that Java uses. We鈥檒l introduce
floating-point representations, and touch on some of the problems they
can cause. We鈥檒l work through examples that use some of Java鈥檚 library
functions for standard mathematical operations.</p>








<section data-pdf-bookmark="How Java Represents Integer Types" data-type="sect2"><div class="sect2" id="idm45941110426680">
<h2>How Java Represents Integer Types</h2>

<p><a data-primary="integer types" data-type="indexterm" id="11_idm45941110425144"></a><a data-primary="numbers" data-secondary="integer types" data-type="indexterm" id="11_idm45941110424440"></a>Java鈥檚 integer types are all signed, as we first mentioned in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2-SECT-3">鈥淧rimitive Data Types鈥?/a&gt;. This means that all integer
types can represent both positive and negative numbers. As computers
work with binary, this means that the only really logical way to
represent this is to split the possible bit patterns up and use half of
them to represent negative numbers.</p>

<p>Let鈥檚 work with Java鈥檚 <code>byte</code> type to investigate how Java represents
integers. This has 8 bits, so can represent 256 different numbers (i.e.,
128 negative and 128 non-negative numbers). <a data-primary="0 (zero)" data-secondary="represented by integral types" data-type="indexterm" id="11_idm45941110421304"></a>It鈥檚 logical to use the
pattern <code>0b0000_0000</code> to represent zero (recall that Java has the syntax
<code>0b&lt;binary digits&gt;</code> to represent numbers as binary), and then it鈥檚 easy
to figure out the bit patterns for the positive numbers:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">byte</code> <code class="n">b</code> <code class="o">=</code> <code class="mi">0</code><code class="n">b0000_0001</code><code class="o">;</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">b</code><code class="o">);</code> <code class="c1">// 1</code>

<code class="n">b</code> <code class="o">=</code> <code class="mi">0</code><code class="n">b0000_0010</code><code class="o">;</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">b</code><code class="o">);</code> <code class="c1">// 2</code>

<code class="n">b</code> <code class="o">=</code> <code class="mi">0</code><code class="n">b0000_0011</code><code class="o">;</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">b</code><code class="o">);</code> <code class="c1">// 3</code>

<code class="c1">// ...</code>

<code class="n">b</code> <code class="o">=</code> <code class="mi">0</code><code class="n">b0111_1111</code><code class="o">;</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">b</code><code class="o">);</code> <code class="c1">// 127</code></pre>

<p>When we set the first bit of the byte, the sign should change (as we
have now used up all of the bit patterns that we鈥檝e set aside for
non-negative numbers). So the pattern <code>0b1000_0000</code> should represent
some negative number鈥攂ut which one?</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>As a consequence of how we鈥檝e defined things, in this representation we
have a very simple way to identify whether a bit pattern corresponds to
a negative number: if the high-end bit of a bit pattern is a <code>1</code>, then
the number being represented is negative.</p>
</div>

<p>Consider the bit pattern consisting of all set bits: <code>0b1111_1111</code>. If
we add <code>1</code> to this number, then the result will overflow the 8 bits of
storage that a <code>byte</code> has, resulting in <code>0b1_0000_0000</code>. If we want to
constrain this to fit within the <code>byte</code> data type, then we should ignore
the overflow, so this becomes <code>0b0000_0000</code>, otherwise known as zero. It is therefore
natural to adopt the representation that 鈥渁ll set bits is <code>-1</code>.鈥?This
allows for natural arithmetic behavior, like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">b</code> <code class="o">=</code> <code class="o">(</code><code class="kt">byte</code><code class="o">)</code> <code class="mi">0</code><code class="n">b1111_1111</code><code class="o">;</code> <code class="c1">// -1</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">b</code><code class="o">);</code>
<code class="n">b</code><code class="o">++;</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">b</code><code class="o">);</code>

<code class="n">b</code> <code class="o">=</code> <code class="o">(</code><code class="kt">byte</code><code class="o">)</code> <code class="mi">0</code><code class="n">b1111_1110</code><code class="o">;</code> <code class="c1">// -2</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">b</code><code class="o">);</code>
<code class="n">b</code><code class="o">++;</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">b</code><code class="o">);</code></pre>

<p>Finally, let鈥檚 look at the number that <code>0b1000_0000</code> represents. It鈥檚
the most negative number that the type can represent, so for <code>byte</code>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">b</code> <code class="o">=</code> <code class="o">(</code><code class="kt">byte</code><code class="o">)</code> <code class="mi">0</code><code class="n">b1000_0000</code><code class="o">;</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">b</code><code class="o">);</code> <code class="c1">// -128</code></pre>

<p><a data-primary="two&apos;s complement" data-type="indexterm" id="11_idm45941110119960"></a>This representation is called <em>two鈥檚 complement</em>, and is the most
common representation for signed integers. To use it effectively, there
are only two points that you need to remember:</p>

<ul>
<li>
<p>A bit pattern of all 1鈥檚 is the representation for 鈭?.</p>
</li>
<li>
<p>If the high bit is set, the number is negative.</p>
</li>
</ul>

<p>Java鈥檚 other integer types (<code>short</code>, <code>int</code>, and <code>long</code>) behave in very
similar ways but with more bits in their representation. The <code>char</code>
data type is different because it represents a Unicode character, but in
some ways behaves as an unsigned 16-bit numeric type. It is not normally
regarded as an integer type by Java programmers.</p>
</div></section>













<section data-pdf-bookmark="Java and Floating-Point Numbers" data-type="sect2"><div class="sect2" id="idm45941110426088">
<h2>Java and Floating-Point Numbers</h2>

<p><a data-primary="floating-point numbers" data-type="indexterm" id="11_ix_ch09-asciidoc13"></a><a data-primary="numbers" data-secondary="floating-point" data-type="indexterm" id="11_ix_ch09-asciidoc14"></a>Computers represent numbers using binary. We鈥檝e seen how Java uses the
two鈥檚 complement representation for integers. But what about fractions
or decimals? Java, like almost all modern programming languages,
represents them using <em>floating-point arithmetic</em>. Let鈥檚 take a look
at how this works, first in base-10 (regular decimal) and then in
binary. <a data-primary="java.lang.Math" data-type="indexterm" id="11_idm45941110112440"></a>Java defines the two most important mathematical constants, <code>e</code>
and <code>蟺</code> (pi), as constants in <code>java.lang.Math</code> like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">static</code> <code class="kd">final</code> <code class="kt">double</code> <code class="n">E</code> <code class="o">=</code> <code class="mf">2.7182818284590452354</code><code class="o">;</code>
<code class="kd">public</code> <code class="kd">static</code> <code class="kd">final</code> <code class="kt">double</code> <code class="n">PI</code> <code class="o">=</code> <code class="mf">3.14159265358979323846</code><code class="o">;</code></pre>

<p><a data-primary="irrational numbers" data-type="indexterm" id="11_idm45941110004440"></a>Of course, these constants are actually <em>irrational numbers</em> and cannot
be precisely expressed as a fraction, or by any finite decimal number.<sup><a class="totri-footnote" data-type="noteref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch09.html#idm45941110101656" id="idm45941110101656-marker">1</a></sup> This means that whenever we try to represent them in a
computer, there is always rounding error. Let鈥檚 suppose we only want to
deal with eight digits of 蟺, and we want to represent the digits as a
whole number. We can use a representation like this:</p>
<div data-type="equation">
<span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1"><span class="MJXp-mrow" id="MJXp-Span-2"><span class="MJXp-mn" id="MJXp-Span-3">314159265</span><span class="MJXp-mo" id="MJXp-Span-4" style="margin-left: 0.267em; margin-right: 0.267em;">鈥?/span&gt;<span class="MJXp-msup" id="MJXp-Span-5"><span class="MJXp-mn" id="MJXp-Span-6" style="margin-right: 0.05em;">10</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-7" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-8">-</span><span class="MJXp-mn" id="MJXp-Span-9">8</span></span></span></span></span></span>
</div>

<p>This starts to suggest the basis of how floating-point numbers work. We
use some of the bits to represent the significant digits (<code>314159265</code>,
in our example) of the number and some bits to represent the <em>exponent</em>
of the base (<code>-8</code>, in our example). The collection of significant digits
is called the <em>significand</em> and the exponent describes whether we need
to shift the significand up or down to get to the desired number.</p>

<p>Of course, in the examples we鈥檝e met until now, we鈥檝e been working in
base-10. Computers use binary, so we need to use this as the base in our
floating-point examples. This introduces some additional complications.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The number <code>0.1</code> cannot be expressed as a finite sequence of binary
digits. This means that virtually all calculations that humans care
about will lose precision when performed in floating point, and rounding
error is essentially inevitable.</p>
</div>

<p>Let鈥檚 look at an example that shows the rounding problem:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">double</code> <code class="n">d</code> <code class="o">=</code> <code class="mf">0.3</code><code class="o">;</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">d</code><code class="o">);</code> <code class="c1">// Special-cased to avoid ugly representation</code>

<code class="kt">double</code> <code class="n">d2</code> <code class="o">=</code> <code class="mf">0.2</code><code class="o">;</code>
<code class="c1">// Should be -0.1 but prints -0.09999999999999998</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">d2</code> <code class="o">-</code> <code class="n">d</code><code class="o">);</code></pre>

<p>The official standard that describes floating-point arithmetic is IEEE-754, and Java鈥檚 support for floating point is based on that standard.
The standard uses 24 binary digits for standard precision and 53 binary digits for double precision.</p>

<p>As we mentioned briefly in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2">Chapter 2</a>, Java can be
more accurate than the standard requires, by using hardware features if
they are available. In extremely rare cases, usually where very strict
compatability with other (possibly older) platforms is required, <a data-primary="IEEE-754 floating-point arithmetic standard" data-type="indexterm" id="11_idm45941109969304"></a><a data-primary="strictfp modifier" data-type="indexterm" id="11_idm45941109968600"></a>we can switch off this
behavior by using <code>strictfp</code> to mandate perfect
compliance with the IEEE-754 standard. This is almost never necessary
and the vast majority of programmers will never need to use (or even
see) this keyword.</p>










<section data-pdf-bookmark="BigDecimal" data-type="sect3"><div class="sect3" id="idm45941109967096">
<h3>BigDecimal</h3>

<p><a data-primary="BigDecimal" data-type="indexterm" id="11_idm45941109965656"></a>Rounding error is a constant source of headaches for programmers who
work with floating-point numbers. In response, Java has a class
<code>java.math.BigDecimal</code> that provides arbitrary precision arithmetic, in
a decimal representation. This works around the problem of <code>0.1</code> not
having a finite representation in binary, but there are still some edge
conditions when converting to or from Java鈥檚 primitive types, as you can
see:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">double</code> <code class="n">d</code> <code class="o">=</code> <code class="mf">0.3</code><code class="o">;</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">d</code><code class="o">);</code>

<code class="n">BigDecimal</code> <code class="n">bd</code> <code class="o">=</code> <code class="k">new</code> <code class="n">BigDecimal</code><code class="o">(</code><code class="n">d</code><code class="o">);</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">bd</code><code class="o">);</code>

<code class="n">bd</code> <code class="o">=</code> <code class="k">new</code> <code class="n">BigDecimal</code><code class="o">(</code><code class="s">0.3</code><code class="o">);</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">bd</code><code class="o">);</code></pre>

<p>However, even with all arithmetic performed in base-10, there are still
numbers, such as <code>1/3</code>, that do not have a terminating decimal
representation. Let鈥檚 see what happens when we try to represent such
numbers using <code>BigDecimal</code>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">bd</code> <code class="o">=</code> <code class="k">new</code> <code class="n">BigDecimal</code><code class="o">(</code><code class="n">BigInteger</code><code class="o">.</code><code class="na">ONE</code><code class="o">);</code>
<code class="n">bd</code><code class="o">.</code><code class="na">divide</code><code class="o">(</code><code class="k">new</code> <code class="n">BigDecimal</code><code class="o">(</code><code class="mf">3.0</code><code class="o">));</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">bd</code><code class="o">);</code> <code class="c1">// Should be 1/3</code></pre>

<p>As <code>BigDecimal</code> can鈥檛 represent <code>1/3</code> precisely, the call to <code>divide()</code>
blows up with <code>ArithmeticException</code>. When you are working with <code>BigDecimal</code>, it
is therefore necessary to be acutely aware of exactly which operations
could result in a nonterminating decimal result. To make matters worse,
<code>ArithmeticException</code> is an unchecked, runtime exception and so the Java
compiler does not even warn about possible exceptions of this type.</p>

<p>As as a final note on floating-point numbers, the paper 鈥淲hat Every
Computer Scientist Should Know About Floating-Point Arithmetic鈥?by David
Goldberg should be considered essential further reading for all
professional programmers. It is easily and freely obtainable on the
internet.<a data-startref="ix_ch09-asciidoc14" data-type="indexterm" id="11_idm45941109810200"></a><a data-startref="ix_ch09-asciidoc13" data-type="indexterm" id="11_idm45941109809496"></a></p>
</div></section>



</div></section>













<section data-pdf-bookmark="Java鈥檚 Standard Library of Mathematical Functions" data-type="sect2"><div class="sect2" id="idm45941110120680">
<h2>Java鈥檚 Standard Library of Mathematical Functions</h2>

<p><a data-primary="mathematical functions, standard library of" data-type="indexterm" id="11_ix_ch09-asciidoc15"></a><a data-primary="numbers" data-secondary="library of mathematical functions" data-type="indexterm" id="11_ix_ch09-asciidoc16"></a>To conclude this look at Java鈥檚 support for numeric data and math,
let鈥檚 take a quick tour of the standard library of functions that Java
ships with. These are mostly static helper methods that are located on
the class <code>java.lang.Math</code> and include functions like:</p>
<dl>
<dt><code>abs()</code></dt>
<dd>
<p><a data-primary="abs()" data-type="indexterm" id="11_idm45941109802392"></a>Returns the absolute value of a number. Has overloaded forms for
various primitive types.</p>
</dd>
<dt>Trigonometric functions</dt>
<dd>
<p>Basic functions for computing the sine, cosine, tangent, and so on. Java
also includes hyperbolic versions and the inverse functions (such as
arc sine).</p>
</dd>
<dt><code>max()</code>, <code>min()</code></dt>
<dd>
<p><a data-primary="max()" data-type="indexterm" id="11_idm45941109853576"></a><a data-primary="min()" data-type="indexterm" id="11_idm45941109852984"></a>Overloaded functions to return the greater and smaller of two
arguments (both of the same numeric type).</p>
</dd>
<dt><code>floor()</code></dt>
<dd>
<p><a data-primary="floor()" data-type="indexterm" id="11_idm45941109850776"></a>Used to return the largest integer smaller than the argument (which
is a double). <a data-primary="ceil()" data-type="indexterm" id="11_idm45941109849944"></a><code>ceil()</code> returns the smallest integer larger than the
argument.</p>
</dd>
<dt><code>pow()</code>, <code>exp()</code>, <code>log()</code></dt>
<dd>
<p><a data-primary="exp()" data-type="indexterm" id="11_idm45941109846680"></a><a data-primary="log()" data-type="indexterm" id="11_idm45941109845976"></a><a data-primary="pow()" data-type="indexterm" id="11_idm45941109845304"></a>Functions for raising one number to the power of another, and for
computing exponentials and natural logarithms. <a data-primary="log10()" data-type="indexterm" id="11_idm45941109844376"></a><code>log10()</code> provides
logarithms to base-10, rather than the natural base.</p>
</dd>
</dl>

<p>Let鈥檚 look at some simple examples of how to use these functions:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">Math</code><code class="o">.</code><code class="na">abs</code><code class="o">(</code><code class="mi">2</code><code class="o">));</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">Math</code><code class="o">.</code><code class="na">abs</code><code class="o">(-</code><code class="mi">2</code><code class="o">));</code>

<code class="kt">double</code> <code class="n">cosp3</code> <code class="o">=</code> <code class="n">Math</code><code class="o">.</code><code class="na">cos</code><code class="o">(</code><code class="mf">0.3</code><code class="o">);</code>
<code class="kt">double</code> <code class="n">sinp3</code> <code class="o">=</code> <code class="n">Math</code><code class="o">.</code><code class="na">sin</code><code class="o">(</code><code class="mf">0.3</code><code class="o">);</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">((</code><code class="n">cosp3</code> <code class="o">*</code> <code class="n">cosp3</code> <code class="o">+</code> <code class="n">sinp3</code> <code class="o">*</code> <code class="n">sinp3</code><code class="o">));</code> <code class="c1">// Always 1.0</code>

<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">Math</code><code class="o">.</code><code class="na">max</code><code class="o">(</code><code class="mf">0.3</code><code class="o">,</code> <code class="mf">0.7</code><code class="o">));</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">Math</code><code class="o">.</code><code class="na">max</code><code class="o">(</code><code class="mf">0.3</code><code class="o">,</code> <code class="o">-</code><code class="mf">0.3</code><code class="o">));</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">Math</code><code class="o">.</code><code class="na">max</code><code class="o">(-</code><code class="mf">0.3</code><code class="o">,</code> <code class="o">-</code><code class="mf">0.7</code><code class="o">));</code>

<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">Math</code><code class="o">.</code><code class="na">min</code><code class="o">(</code><code class="mf">0.3</code><code class="o">,</code> <code class="mf">0.7</code><code class="o">));</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">Math</code><code class="o">.</code><code class="na">min</code><code class="o">(</code><code class="mf">0.3</code><code class="o">,</code> <code class="o">-</code><code class="mf">0.3</code><code class="o">));</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">Math</code><code class="o">.</code><code class="na">min</code><code class="o">(-</code><code class="mf">0.3</code><code class="o">,</code> <code class="o">-</code><code class="mf">0.7</code><code class="o">));</code>

<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">Math</code><code class="o">.</code><code class="na">floor</code><code class="o">(</code><code class="mf">1.3</code><code class="o">));</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">Math</code><code class="o">.</code><code class="na">ceil</code><code class="o">(</code><code class="mf">1.3</code><code class="o">));</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">Math</code><code class="o">.</code><code class="na">floor</code><code class="o">(</code><code class="mf">7.5</code><code class="o">));</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">Math</code><code class="o">.</code><code class="na">ceil</code><code class="o">(</code><code class="mf">7.5</code><code class="o">));</code>

<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">Math</code><code class="o">.</code><code class="na">round</code><code class="o">(</code><code class="mf">1.3</code><code class="o">));</code> <code class="c1">// Returns long</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">Math</code><code class="o">.</code><code class="na">round</code><code class="o">(</code><code class="mf">7.5</code><code class="o">));</code> <code class="c1">// Returns long</code>

<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">Math</code><code class="o">.</code><code class="na">pow</code><code class="o">(</code><code class="mf">2.0</code><code class="o">,</code> <code class="mf">10.0</code><code class="o">));</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">Math</code><code class="o">.</code><code class="na">exp</code><code class="o">(</code><code class="mi">1</code><code class="o">));</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">Math</code><code class="o">.</code><code class="na">exp</code><code class="o">(</code><code class="mi">2</code><code class="o">));</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">Math</code><code class="o">.</code><code class="na">log</code><code class="o">(</code><code class="mf">2.718281828459045</code><code class="o">));</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">Math</code><code class="o">.</code><code class="na">log10</code><code class="o">(</code><code class="mi">100_000</code><code class="o">));</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">Math</code><code class="o">.</code><code class="na">log10</code><code class="o">(</code><code class="n">Integer</code><code class="o">.</code><code class="na">MAX_VALUE</code><code class="o">));</code>

<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">Math</code><code class="o">.</code><code class="na">random</code><code class="o">());</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Let&apos;s toss a coin: </code><code class="o">);</code>
<code class="k">if</code> <code class="o">(</code><code class="n">Math</code><code class="o">.</code><code class="na">random</code><code class="o">()</code> <code class="o">&gt;</code> <code class="mf">0.5</code><code class="o">)</code> <code class="o">{</code>
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">It&apos;s heads</code><code class="o">);</code>
<code class="o">}</code> <code class="k">else</code> <code class="o">{</code>
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">It&apos;s tails</code><code class="o">);</code>
<code class="o">}</code></pre>

<p><a data-primary="Random class" data-type="indexterm" id="11_idm45941109770040"></a><a data-primary="random()" data-type="indexterm" id="11_idm45941109769208"></a>To conclude this section, let鈥檚 briefly discuss Java鈥檚 <code>random()</code>
function. When this is first called, it sets up a new instance of
<code>java.util.Random</code>. <a data-primary="pseudorandom number generator (PRNG)" data-type="indexterm" id="11_idm45941109767608"></a>This is a <em>pseudorandom number generator</em> (PRNG)鈥攁
deterministic piece of code that produces numbers that <em>look</em> random
but are actually produced by a mathematical formula.<sup><a class="totri-footnote" data-type="noteref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch09.html#idm45941109765976" id="idm45941109765976-marker">2</a></sup> In Java鈥檚
case, the formula used for the PRNG is pretty simple, for example:</p>

<pre data-code-language="java" data-type="programlisting">    <code class="c1">// From java.util.Random</code>
    <code class="kd">public</code> <code class="kt">double</code> <code class="nf">nextDouble</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="o">(((</code><code class="kt">long</code><code class="o">)(</code><code class="n">next</code><code class="o">(</code><code class="mi">26</code><code class="o">))</code> <code class="o">&lt;&lt;</code> <code class="mi">27</code><code class="o">)</code> <code class="o">+</code> <code class="n">next</code><code class="o">(</code><code class="mi">27</code><code class="o">))</code> <code class="o">*</code> <code class="n">DOUBLE_UNIT</code><code class="o">;</code>
    <code class="o">}</code></pre>

<p>If the sequence of pseudorandom numbers always starts at the same place,
then exactly the same stream of numbers will be produced. To get around
this problem, the PRNG is seeded by a value that should contain as much
true randomness as possible. For this source of randomness for the seed
value, Java uses a CPU counter value that is normally used for
high-precision timing.</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>While Java鈥檚 built-in pseudorandom numbers are fine for most general
applications, some specialist applications (notably cryptography and
some types of simulations) have much more stringent requirements. If you
are working on an application of that sort, seek expert advice from
programmers who are already working in the area.<a data-startref="ix_ch09-asciidoc16" data-type="indexterm" id="11_idm45941109433384"></a><a data-startref="ix_ch09-asciidoc15" data-type="indexterm" id="11_idm45941109432712"></a></p>
</div>

<p>Now that we鈥檝e looked at text and numeric data, let鈥檚 move on to look at
another of the most frequently encountered kinds of data: date and
time information.<a data-startref="ix_ch09-asciidoc12" data-type="indexterm" id="11_idm45941109431352"></a><a data-startref="ix_ch09-asciidoc11" data-type="indexterm" id="11_idm45941109430648"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Java 8 Date and Time" data-type="sect1"><div class="sect1" id="idm45941109808232">
<h1>Java 8 Date and Time</h1>

<p><a data-primary="data formats, handling of common" data-secondary="date and time" data-type="indexterm" id="11_ix_ch09-asciidoc17"></a><a data-primary="date and time API" data-type="indexterm" id="11_ix_ch09-asciidoc18"></a><a data-primary="Java 8" data-secondary="Date and Time API" data-type="indexterm" id="11_ix_ch09-asciidoc19"></a>Almost all business software applications have some notion of date
and time. When modeling real-world events or interactions, collecting a
point at which the event occurred is critical for future reporting or
comparison of domain objects. Java 8 brings a complete overhaul to the
way that developers work with date and time. This section introduces
those concepts for Java 8. In earlier versions, the only support is via
classes such as <code>java.util.Date</code> that do not model the concepts. Code
that uses the older APIs should move as soon as possible.</p>








<section data-pdf-bookmark="Introducing the Java 8 Date and Time API" data-type="sect2"><div class="sect2" id="idm45941109423992">
<h2>Introducing the Java 8 Date and Time API</h2>

<p><a data-primary="java.time package" data-type="indexterm" id="11_idm45941109422584"></a>Java 8 introduces the new package <code>java.time</code>, which contains the core
classes that most developers work with. It also contains four
subpackages:</p>
<dl>
<dt><code>java.time.chrono</code></dt>
<dd>
<p><a data-primary="java.time.chrono package" data-type="indexterm" id="11_idm45941109419528"></a>Alternative chronologies that developers using calendaring systems
that do not follow the ISO standard will interact with. An example
would be a Japanese calendaring system.</p>
</dd>
<dt><code>java.time.format</code></dt>
<dd>
<p><a data-primary="java.time.format package" data-type="indexterm" id="11_idm45941109417256"></a>Contains the <code>DateTimeFormatter</code> used for converting date and time
objects into a <code>String</code> and also for parsing strings into the data and
time objects.</p>
</dd>
<dt><code>java.time.temporal</code></dt>
<dd>
<p><a data-primary="java.time.temporal package" data-type="indexterm" id="11_idm45941109414264"></a>Contains the interfaces required by the core date and time classes
and also abstractions (such as queries and adjusters) for advanced
operations with dates.</p>
</dd>
<dt><code>java.time.zone</code></dt>
<dd>
<p><a data-primary="java.time.zone package" data-type="indexterm" id="11_idm45941109411960"></a>Classes used for the underlying time zone rules; most developers
won鈥檛 require this package.</p>
</dd>
</dl>

<p>One of the most important concepts when representing time is the idea of
an instantaneous point on the timeline of some entity. While this
concept is well defined within, for example, Special Relativity,
representing it within a computer requires us to make some
assumptions. <a data-primary="Instant class" data-type="indexterm" id="11_idm45941109410216"></a>In Java 8, we represent a single point in time as an
<code>Instant</code>, which has these key assumptions:</p>

<ul>
<li>
<p>We cannot represent more seconds than can fit into a <code>long</code>.</p>
</li>
<li>
<p>We cannot represent time more precisely than nanosecond precision.</p>
</li>
</ul>

<p>This means that we are restricting ourselves to modeling time in a
manner that is consistent with the capabilities of current computer
systems. However, there is another fundamental concept that should also
be introduced.</p>

<p>An <code>Instant</code> is about a single event in space-time. However, it is far
from uncommon for programmers to have to deal with intervals between two
events, and so <a data-primary="java.time.Duration package" data-type="indexterm" id="11_idm45941109384808"></a>Java 8 also introduces the <code>java.time.Duration</code> class.
This class ignores calendar effects that might arise (e.g., from
daylight saving time). With this basic conception of instants and
durations between events, let鈥檚 move on to unpack the possible ways of
thinking about an instant.</p>










<section data-pdf-bookmark="The parts of a timestamp" data-type="sect3"><div class="sect3" id="idm45941109383192">
<h3>The parts of a timestamp</h3>

<p><a data-primary="date and time API" data-secondary="timestamp" data-type="indexterm" id="11_idm45941109381976"></a><a data-primary="timestamp" data-type="indexterm" id="11_idm45941109381000"></a>In <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch09.html#javanut7-CHP-9-FIG-1">Figure 9-1</a>, we show the breakdown of the
different parts of a timestamp in a number of possible ways.</p>

<figure><div class="figure" id="javanut7-CHP-9-FIG-1">
<img alt="JN7 0901" data-mfp-src="/library/view/java-in-a/9781492037248/assets/jns7_0901.png" height="383" src="https://learning.oreilly.com/library/view/java-in-a/9781492037248/assets/jns7_0901.png" width="526"/>
<h6><span class="label">Figure 9-1. </span>Breaking apart a timestamp</h6>
</div></figure>

<p>The key concept here is that there are a number of different
abstractions that might be appropriate at different times. <a data-primary="LocalDate class" data-type="indexterm" id="11_idm45941109376712"></a>For example,
there are applications where a <code>LocalDate</code> is key to business
processing, where the needed granularity is a business day.
Alternatively, some applications require subsecond, or even millisecond,
precision. Developers should be aware of their domain and use a suitable
representation within their application.</p>
</div></section>













<section data-pdf-bookmark="Example" data-type="sect3"><div class="sect3" id="idm45941109374888">
<h3>Example</h3>

<p><a data-primary="date and time API" data-secondary="diary class example" data-type="indexterm" id="11_idm45941109373688"></a>The date and time API can be a lot to take in at first glance, so
let鈥檚 start by looking at an example, and discuss a diary class that
keeps track of birthdays. If you happen to be very forgetful about
birthdays, then a class like this (and especially methods like
<code>getBirthdaysInNextMonth()</code>) might be very helpful:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">BirthdayDiary</code> <code class="o">{</code>
    <code class="kd">private</code> <code class="n">Map</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code> <code class="n">LocalDate</code><code class="o">&gt;</code> <code class="n">birthdays</code><code class="o">;</code>

    <code class="kd">public</code> <code class="nf">BirthdayDiary</code><code class="o">()</code> <code class="o">{</code>
        <code class="n">birthdays</code> <code class="o">=</code> <code class="k">new</code> <code class="n">HashMap</code><code class="o">&lt;&gt;();</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="n">LocalDate</code> <code class="nf">addBirthday</code><code class="o">(</code><code class="n">String</code> <code class="n">name</code><code class="o">,</code> <code class="kt">int</code> <code class="n">day</code><code class="o">,</code> <code class="kt">int</code> <code class="n">month</code><code class="o">,</code>
                                 <code class="kt">int</code> <code class="n">year</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">LocalDate</code> <code class="n">birthday</code> <code class="o">=</code> <code class="n">LocalDate</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="n">year</code><code class="o">,</code> <code class="n">month</code><code class="o">,</code> <code class="n">day</code><code class="o">);</code>
        <code class="n">birthdays</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="n">name</code><code class="o">,</code> <code class="n">birthday</code><code class="o">);</code>
        <code class="k">return</code> <code class="n">birthday</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="n">LocalDate</code> <code class="nf">getBirthdayFor</code><code class="o">(</code><code class="n">String</code> <code class="n">name</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">birthdays</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="n">name</code><code class="o">);</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">int</code> <code class="nf">getAgeInYear</code><code class="o">(</code><code class="n">String</code> <code class="n">name</code><code class="o">,</code> <code class="kt">int</code> <code class="n">year</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">Period</code> <code class="n">period</code> <code class="o">=</code> <code class="n">Period</code><code class="o">.</code><code class="na">between</code><code class="o">(</code><code class="n">birthdays</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="n">name</code><code class="o">),</code>
            <code class="n">birthdays</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="n">name</code><code class="o">).</code><code class="na">withYear</code><code class="o">(</code><code class="n">year</code><code class="o">));</code>

        <code class="k">return</code> <code class="n">period</code><code class="o">.</code><code class="na">getYears</code><code class="o">();</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="n">Set</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="nf">getFriendsOfAgeIn</code><code class="o">(</code><code class="kt">int</code> <code class="n">age</code><code class="o">,</code> <code class="kt">int</code> <code class="n">year</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">birthdays</code><code class="o">.</code><code class="na">keySet</code><code class="o">().</code><code class="na">stream</code><code class="o">()</code>
                <code class="o">.</code><code class="na">filter</code><code class="o">(</code><code class="n">p</code> <code class="o">-&gt;</code> <code class="n">getAgeInYear</code><code class="o">(</code><code class="n">p</code><code class="o">,</code> <code class="n">year</code><code class="o">)</code> <code class="o">==</code> <code class="n">age</code><code class="o">)</code>
                <code class="o">.</code><code class="na">collect</code><code class="o">(</code><code class="n">Collectors</code><code class="o">.</code><code class="na">toSet</code><code class="o">());</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">int</code> <code class="nf">getDaysUntilBirthday</code><code class="o">(</code><code class="n">String</code> <code class="n">name</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">Period</code> <code class="n">period</code> <code class="o">=</code> <code class="n">Period</code><code class="o">.</code><code class="na">between</code><code class="o">(</code><code class="n">LocalDate</code><code class="o">.</code><code class="na">now</code><code class="o">(),</code>
            <code class="n">birthdays</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="n">name</code><code class="o">));</code>
        <code class="k">return</code> <code class="n">period</code><code class="o">.</code><code class="na">getDays</code><code class="o">();</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="n">Set</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="nf">getBirthdaysIn</code><code class="o">(</code><code class="n">Month</code> <code class="n">month</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">birthdays</code><code class="o">.</code><code class="na">entrySet</code><code class="o">().</code><code class="na">stream</code><code class="o">()</code>
                <code class="o">.</code><code class="na">filter</code><code class="o">(</code><code class="n">p</code> <code class="o">-&gt;</code> <code class="n">p</code><code class="o">.</code><code class="na">getValue</code><code class="o">().</code><code class="na">getMonth</code><code class="o">()</code> <code class="o">==</code> <code class="n">month</code><code class="o">)</code>
                <code class="o">.</code><code class="na">map</code><code class="o">(</code><code class="n">p</code> <code class="o">-&gt;</code> <code class="n">p</code><code class="o">.</code><code class="na">getKey</code><code class="o">())</code>
                <code class="o">.</code><code class="na">collect</code><code class="o">(</code><code class="n">Collectors</code><code class="o">.</code><code class="na">toSet</code><code class="o">());</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="n">Set</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="nf">getBirthdaysInCurrentMonth</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="nf">getBirthdaysIn</code><code class="o">(</code><code class="n">LocalDate</code><code class="o">.</code><code class="na">now</code><code class="o">().</code><code class="na">getMonth</code><code class="o">());</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">int</code> <code class="nf">getTotalAgeInYears</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">birthdays</code><code class="o">.</code><code class="na">keySet</code><code class="o">().</code><code class="na">stream</code><code class="o">()</code>
                <code class="o">.</code><code class="na">mapToInt</code><code class="o">(</code><code class="n">p</code> <code class="o">-&gt;</code> <code class="n">getAgeInYear</code><code class="o">(</code><code class="n">p</code><code class="o">,</code>
                      <code class="n">LocalDate</code><code class="o">.</code><code class="na">now</code><code class="o">().</code><code class="na">getYear</code><code class="o">()))</code>
                <code class="o">.</code><code class="na">sum</code><code class="o">();</code>
    <code class="o">}</code>
<code class="o">}</code></pre>

<p>This class shows how to use the low-level API to build up useful
functionality. It also uses innovations such as the Java Streams API,
and demonstrates how to use <code>LocalDate</code> as an immutable class and how
dates should be treated as values.</p>
</div></section>



</div></section>













<section data-pdf-bookmark="Queries" data-type="sect2"><div class="sect2" id="idm45941109363192">
<h2>Queries</h2>

<p><a data-primary="date and time API" data-secondary="queries" data-type="indexterm" id="11_ix_ch09-asciidoc20"></a><a data-primary="queries" data-secondary="date and time" data-type="indexterm" id="11_ix_ch09-asciidoc21"></a>Under a wide variety of circumstances we may find ourselves wanting
to answer a question about a particular temporal object. Some example
questions we may want answers to are:</p>

<ul>
<li>
<p>Is the date before March 1st?</p>
</li>
<li>
<p>Is the date in a leap year?</p>
</li>
<li>
<p>How many days is it from today until my next birthday?</p>
</li>
</ul>

<p><a data-primary="queries" data-secondary="temporal" data-type="indexterm" id="11_idm45941108998872"></a><a data-primary="TemporalQuery interface" data-type="indexterm" id="11_idm45941108997896"></a>This is achieved by the use of the <code>TemporalQuery</code> interface, which is
defined like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">interface</code> <code class="nc">TemporalQuery</code><code class="o">&lt;</code><code class="n">R</code><code class="o">&gt;</code> <code class="o">{</code>
    <code class="n">R</code> <code class="nf">queryFrom</code><code class="o">(</code><code class="n">TemporalAccessor</code> <code class="n">temporal</code><code class="o">);</code>
<code class="o">}</code></pre>

<p>The parameter to <code>queryFrom()</code> should not be <code>null</code>, but if the result
indicates that a value was not found, <code>null</code> could be used as a return
value.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><a data-primary="Predicate interface" data-secondary="temporal queries vs." data-type="indexterm" id="11_idm45941108977464"></a>The <code>Predicate</code> interface can be thought of as a query that can only
represent answers to yes-or-no questions. Temporal queries are more
general and can return a value of 鈥淗ow many?鈥?or 鈥淲hich?鈥?instead of
just 鈥測es鈥?or 鈥渘o.鈥?/p&gt;
</div>

<p>Let鈥檚 look at an example of a query in action, by considering a query
that answers the following question: 鈥淲hich quarter of the year is this
date in?鈥?Java 8 does not support the concept of a quarter directly.
Instead, code like this is used:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">LocalDate</code> <code class="n">today</code> <code class="o">=</code> <code class="n">LocalDate</code><code class="o">.</code><code class="na">now</code><code class="o">();</code>
<code class="n">Month</code> <code class="n">currentMonth</code> <code class="o">=</code> <code class="n">today</code><code class="o">.</code><code class="na">getMonth</code><code class="o">();</code>
<code class="n">Month</code> <code class="n">firstMonthofQuarter</code> <code class="o">=</code> <code class="n">currentMonth</code><code class="o">.</code><code class="na">firstMonthOfQuarter</code><code class="o">();</code></pre>

<p>This still doesn鈥檛 give quarter as a separate abstraction and instead
special case code is still needed. So let鈥檚 slightly extend the JDK
support by defining this enum type:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">enum</code> <code class="n">Quarter</code> <code class="o">{</code>
    <code class="n">FIRST</code><code class="o">,</code> <code class="n">SECOND</code><code class="o">,</code> <code class="n">THIRD</code><code class="o">,</code> <code class="n">FOURTH</code><code class="o">;</code>
<code class="o">}</code></pre>

<p>Now, the query can be written as:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">QuarterOfYearQuery</code> <code class="kd">implements</code> <code class="n">TemporalQuery</code><code class="o">&lt;</code><code class="n">Quarter</code><code class="o">&gt;</code> <code class="o">{</code>
    <code class="nd">@Override</code>
    <code class="kd">public</code> <code class="n">Quarter</code> <code class="nf">queryFrom</code><code class="o">(</code><code class="n">TemporalAccessor</code> <code class="n">temporal</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">LocalDate</code> <code class="n">now</code> <code class="o">=</code> <code class="n">LocalDate</code><code class="o">.</code><code class="na">from</code><code class="o">(</code><code class="n">temporal</code><code class="o">);</code>

        <code class="k">if</code><code class="o">(</code><code class="n">now</code><code class="o">.</code><code class="na">isBefore</code><code class="o">(</code><code class="n">now</code><code class="o">.</code><code class="na">with</code><code class="o">(</code><code class="n">Month</code><code class="o">.</code><code class="na">APRIL</code><code class="o">).</code><code class="na">withDayOfMonth</code><code class="o">(</code><code class="mi">1</code><code class="o">)))</code> <code class="o">{</code>
            <code class="k">return</code> <code class="n">Quarter</code><code class="o">.</code><code class="na">FIRST</code><code class="o">;</code>
        <code class="o">}</code> <code class="k">else</code> <code class="k">if</code><code class="o">(</code><code class="n">now</code><code class="o">.</code><code class="na">isBefore</code><code class="o">(</code><code class="n">now</code><code class="o">.</code><code class="na">with</code><code class="o">(</code><code class="n">Month</code><code class="o">.</code><code class="na">JULY</code><code class="o">)</code>
                               <code class="o">.</code><code class="na">withDayOfMonth</code><code class="o">(</code><code class="mi">1</code><code class="o">)))</code> <code class="o">{</code>
            <code class="k">return</code> <code class="n">Quarter</code><code class="o">.</code><code class="na">SECOND</code><code class="o">;</code>
        <code class="o">}</code> <code class="k">else</code> <code class="k">if</code><code class="o">(</code><code class="n">now</code><code class="o">.</code><code class="na">isBefore</code><code class="o">(</code><code class="n">now</code><code class="o">.</code><code class="na">with</code><code class="o">(</code><code class="n">Month</code><code class="o">.</code><code class="na">NOVEMBER</code><code class="o">)</code>
                               <code class="o">.</code><code class="na">withDayOfMonth</code><code class="o">(</code><code class="mi">1</code><code class="o">)))</code> <code class="o">{</code>
            <code class="k">return</code> <code class="n">Quarter</code><code class="o">.</code><code class="na">THIRD</code><code class="o">;</code>
        <code class="o">}</code> <code class="k">else</code> <code class="o">{</code>
           <code class="k">return</code> <code class="n">Quarter</code><code class="o">.</code><code class="na">FOURTH</code><code class="o">;</code>
        <code class="o">}</code>
    <code class="o">}</code>
<code class="o">}</code></pre>

<p><code>TemporalQuery</code> objects can be used directly or indirectly. Let鈥檚 look
at an example of each:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">QuarterOfYearQuery</code> <code class="n">q</code> <code class="o">=</code> <code class="k">new</code> <code class="n">QuarterOfYearQuery</code><code class="o">();</code>

<code class="c1">// Direct</code>
<code class="n">Quarter</code> <code class="n">quarter</code> <code class="o">=</code> <code class="n">q</code><code class="o">.</code><code class="na">queryFrom</code><code class="o">(</code><code class="n">LocalDate</code><code class="o">.</code><code class="na">now</code><code class="o">());</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">quarter</code><code class="o">);</code>

<code class="c1">// Indirect</code>
<code class="n">quarter</code> <code class="o">=</code> <code class="n">LocalDate</code><code class="o">.</code><code class="na">now</code><code class="o">().</code><code class="na">query</code><code class="o">(</code><code class="n">q</code><code class="o">);</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">quarter</code><code class="o">);</code></pre>

<p>Under most circumstances, it is better to use the indirect approach,
where the query object is passed as a parameter to <code>query()</code>. This is
because it is normally a lot clearer to read in code.<a data-startref="ix_ch09-asciidoc21" data-type="indexterm" id="11_idm45941108427016"></a><a data-startref="ix_ch09-asciidoc20" data-type="indexterm" id="11_idm45941108426408"></a></p>
</div></section>













<section data-pdf-bookmark="Adjusters" data-type="sect2"><div class="sect2" id="idm45941109362600">
<h2>Adjusters</h2>

<p><a data-primary="adjusters" data-secondary="date and time" data-type="indexterm" id="11_idm45941108424360"></a><a data-primary="date and time API" data-secondary="adjusters" data-type="indexterm" id="11_idm45941108423384"></a>Adjusters modify date and time objects. Suppose, for example, that
we want to return the first day of a quarter that contains a particular
timestamp:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">FirstDayOfQuarter</code> <code class="kd">implements</code> <code class="n">TemporalAdjuster</code> <code class="o">{</code>
    <code class="nd">@Override</code>
    <code class="kd">public</code> <code class="n">Temporal</code> <code class="nf">adjustInto</code><code class="o">(</code><code class="n">Temporal</code> <code class="n">temporal</code><code class="o">)</code> <code class="o">{</code>

        <code class="kd">final</code> <code class="kt">int</code> <code class="n">currentQuarter</code> <code class="o">=</code> <code class="n">YearMonth</code><code class="o">.</code><code class="na">from</code><code class="o">(</code><code class="n">temporal</code><code class="o">)</code>
                <code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="n">IsoFields</code><code class="o">.</code><code class="na">QUARTER_OF_YEAR</code><code class="o">);</code>

        <code class="k">switch</code> <code class="o">(</code><code class="n">currentQuarter</code><code class="o">)</code> <code class="o">{</code>
            <code class="k">case</code> <code class="mi">1</code><code class="o">:</code>
                <code class="k">return</code> <code class="n">LocalDate</code><code class="o">.</code><code class="na">from</code><code class="o">(</code><code class="n">temporal</code><code class="o">)</code>
                        <code class="o">.</code><code class="na">with</code><code class="o">(</code><code class="n">TemporalAdjusters</code><code class="o">.</code><code class="na">firstDayOfYear</code><code class="o">());</code>
            <code class="k">case</code> <code class="mi">2</code><code class="o">:</code>
                <code class="k">return</code> <code class="n">LocalDate</code><code class="o">.</code><code class="na">from</code><code class="o">(</code><code class="n">temporal</code><code class="o">)</code>
                        <code class="o">.</code><code class="na">withMonth</code><code class="o">(</code><code class="n">Month</code><code class="o">.</code><code class="na">APRIL</code><code class="o">.</code><code class="na">getValue</code><code class="o">())</code>
                        <code class="o">.</code><code class="na">with</code><code class="o">(</code><code class="n">TemporalAdjusters</code><code class="o">.</code><code class="na">firstDayOfMonth</code><code class="o">());</code>
            <code class="k">case</code> <code class="mi">3</code><code class="o">:</code>
                <code class="k">return</code> <code class="n">LocalDate</code><code class="o">.</code><code class="na">from</code><code class="o">(</code><code class="n">temporal</code><code class="o">)</code>
                        <code class="o">.</code><code class="na">withMonth</code><code class="o">(</code><code class="n">Month</code><code class="o">.</code><code class="na">JULY</code><code class="o">.</code><code class="na">getValue</code><code class="o">())</code>
                        <code class="o">.</code><code class="na">with</code><code class="o">(</code><code class="n">TemporalAdjusters</code><code class="o">.</code><code class="na">firstDayOfMonth</code><code class="o">());</code>
            <code class="k">case</code> <code class="mi">4</code><code class="o">:</code>
                <code class="k">return</code> <code class="n">LocalDate</code><code class="o">.</code><code class="na">from</code><code class="o">(</code><code class="n">temporal</code><code class="o">)</code>
                        <code class="o">.</code><code class="na">withMonth</code><code class="o">(</code><code class="n">Month</code><code class="o">.</code><code class="na">OCTOBER</code><code class="o">.</code><code class="na">getValue</code><code class="o">())</code>
                        <code class="o">.</code><code class="na">with</code><code class="o">(</code><code class="n">TemporalAdjusters</code><code class="o">.</code><code class="na">firstDayOfMonth</code><code class="o">());</code>
            <code class="k">default</code><code class="o">:</code>
                <code class="k">return</code> <code class="kc">null</code><code class="o">;</code> <code class="c1">// Will never happen</code>
        <code class="o">}</code>
    <code class="o">}</code>
<code class="o">}</code></pre>

<p>Let鈥檚 look at an example of how to use an adjuster:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">LocalDate</code> <code class="n">now</code> <code class="o">=</code> <code class="n">LocalDate</code><code class="o">.</code><code class="na">now</code><code class="o">();</code>
<code class="n">Temporal</code> <code class="n">fdoq</code> <code class="o">=</code> <code class="n">now</code><code class="o">.</code><code class="na">with</code><code class="o">(</code><code class="k">new</code> <code class="n">FirstDayOfQuarter</code><code class="o">());</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">fdoq</code><code class="o">);</code></pre>

<p>The key here is the <code>with()</code> method, and the code should be read as
taking in one <code>Temporal</code> object and returning another object that has
been modified. This is completely usual for APIs that work with
immutable objects.</p>
</div></section>













<section data-pdf-bookmark="Legacy Date and Time" data-type="sect2"><div class="sect2" id="idm45941108267400">
<h2>Legacy Date and Time</h2>

<p><a data-primary="date and time API" data-secondary="legacy issues" data-type="indexterm" id="11_idm45941108257608"></a>Unfortunately, many applications are not yet converted to use the
superior date and time libraries that ship with Java 8. So, for
completeness, we briefly mention the legacy date and time support (which
is based on <code>java.util.Date</code>).</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>The legacy date and time classes, especially <code>java.util.Date</code>, should <em>not</em> be used in modern Java environments.
Consider refactoring or rewriting any code that still uses the legacy classes.</p>
</div>

<p>In older versions of Java, <code>java.time</code> is not available. Instead,
programmers rely upon the legacy and rudimentary support provided by
<code>java.util.Date</code>. Historically, this was the only way to represent
timestamps, and although named <code>Date</code> this class actually consisted of
both a date and a time component鈥攁nd this led to a lot of confusion for
many programmers.</p>

<p>There are many problems with the legacy support provided by <code>Date</code>, for
example:</p>

<ul>
<li>
<p>The <code>Date</code> class is incorrectly factored. It doesn鈥檛 actually refer to
a date, and instead is more like a timestamp. It turns out that we need
different representations for a date, versus a date and time, versus an
instantaneous timestamp.</p>
</li>
<li>
<p><code>Date</code> is mutable. We can obtain a reference to a date, and then
change when it refers to.</p>
</li>
<li>
<p>The <code>Date</code> class doesn鈥檛 actually accept ISO-8601, the universal ISO
date standard, as being as valid date.</p>
</li>
<li>
<p><code>Date</code> has a very large number of deprecated methods.</p>
</li>
</ul>

<p>The current JDK uses two constructors for <code>Date</code>鈥攖he <code>void</code> constructor
that is intended to be the 鈥渘ow constructor,鈥?and a constructor that
takes a number of milliseconds since epoch.<a data-startref="ix_ch09-asciidoc19" data-type="indexterm" id="11_idm45941108243672"></a><a data-startref="ix_ch09-asciidoc18" data-type="indexterm" id="11_idm45941108242968"></a><a data-startref="ix_ch09-asciidoc17" data-type="indexterm" id="11_idm45941108242296"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="idm45941108241496">
<h1>Summary</h1>

<p>In this chapter, we鈥檝e met several different classes of data. Textual
and numeric data are the most obvious examples, but as working
programmers we will meet a large number of different sorts of data.
Let鈥檚 move on to look at whole files of data, and new ways to work with
I/O and networking. Fortunately, Java provides good support for dealing
with many of these abstractions.<a data-startref="ix_ch09-asciidoc0" data-type="indexterm" id="11_idm45941108239800"></a></p>
</div></section>







<div data-type="footnotes"><p data-type="footnote" id="idm45941110101656"><sup><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch09.html#idm45941110101656-marker">1</a></sup> In fact, they are actually two of the known examples of <em>transcendental numbers</em>.</p><p data-type="footnote" id="idm45941109765976"><sup><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch09.html#idm45941109765976-marker">2</a></sup> It is very difficult to get computers to produce true random numbers, and in the rare cases where this is done, specialized hardware is usually necessary.</p></div></div></section><div class="annotator-outer annotator-viewer viewer annotator-hide"> </div></div></div>
    </section>
  </div>
</div>

<hr/>

<!--if IE]><![endif]--><!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/java-in-a/9781492037248/ch10.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="3866890"
  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"
  data-username="levinxccai"
  data-account-type="B2B"
  
  data-activated-trial-date="11/06/2017"


  data-archive="9781492037248"
  data-publishers="O&#39;Reilly Media, Inc."



  data-htmlfile-name="ch10.html"
  data-epub-title="Java in a Nutshell, 7th Edition" data-debug=0 data-testing=0><![endif]--><!--if gt IE 8]><!--><!--![endif]-->



<a name="12_"></a>
<div id="MathJax_Message" style="display: none;"></div>
<div class="application" id="container" style="height: auto;">
  <div class="js-toc">
    <section role="document">
      <div id="sbo-rt-content" style="max-width:72.5em; transform: none;"><div class="annotator-wrapper"><section data-nutshell-tab="File Handling and I/O" data-pdf-bookmark="Chapter 10. File Handling and I/O" data-type="chapter" epub:type="chapter"><div class="chapter" id="javanut7-CHP-10">
<h1><span class="label">Chapter 10. </span>File Handling and I/O</h1>


<p><a data-primary="I/O (input/output)" data-type="indexterm" id="12_ix_ch10-asciidoc0"></a>Java has had input/output (I/O) support since the very first version.
However, due to Java鈥檚 strong desire for platform independence, the
earlier versions of I/O functionality emphasized portability over
functionality. As a result, they were not always easy to work with.</p>

<p>We鈥檒l see later in the chapter how the original APIs have been supplemented鈥攖hey are now rich, fully featured, and very easy to develop with.
Let鈥檚 kick off the chapter by looking at the original, 鈥渃lassic鈥?approach to Java I/O, which the more modern approaches layer on top of.</p>






<section data-pdf-bookmark="Classic Java I/O" data-type="sect1"><div class="sect1" id="javanut7-CHP-10-SECT-1">
<h1>Classic Java I/O</h1>

<p><a data-primary="classic Java I/O" data-type="indexterm" id="12_ix_ch10-asciidoc1"></a><a data-primary="I/O (input/output)" data-secondary="classic Java I/O" data-type="indexterm" id="12_ix_ch10-asciidoc2"></a>The <code>File</code> class is the cornerstone of Java鈥檚 original way to do
file I/O. This abstraction can represent both files and directories, but
in doing so is sometimes a bit cumbersome to deal with, and leads to
code like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Get a file object to represent the user&apos;s home directory</code>
<code class="n">File</code> <code class="n">homedir</code> <code class="o">=</code> <code class="k">new</code> <code class="n">File</code><code class="o">(</code><code class="n">System</code><code class="o">.</code><code class="na">getProperty</code><code class="o">(</code><code class="s">user.home</code><code class="o">));</code>

<code class="c1">// Create an object to represent a config file (should</code>
<code class="c1">// already be present in the home directory)</code>
<code class="n">File</code> <code class="n">f</code> <code class="o">=</code> <code class="k">new</code> <code class="n">File</code><code class="o">(</code><code class="n">homedir</code><code class="o">,</code> <code class="s">app.conf</code><code class="o">);</code>

<code class="c1">// Check the file exists, really is a file, and is readable</code>
<code class="k">if</code> <code class="o">(</code><code class="n">f</code><code class="o">.</code><code class="na">exists</code><code class="o">()</code> <code class="o">&amp;&amp;</code> <code class="n">f</code><code class="o">.</code><code class="na">isFile</code><code class="o">()</code> <code class="o">&amp;&amp;</code> <code class="n">f</code><code class="o">.</code><code class="na">canRead</code><code class="o">())</code> <code class="o">{</code>

  <code class="c1">// Create a file object for a new configuration directory</code>
  <code class="n">File</code> <code class="n">configdir</code> <code class="o">=</code> <code class="k">new</code> <code class="n">File</code><code class="o">(</code><code class="n">f</code><code class="o">,</code> <code class="s">.configdir</code><code class="o">);</code>
  <code class="c1">// And create it</code>
  <code class="n">configdir</code><code class="o">.</code><code class="na">mkdir</code><code class="o">();</code>

  <code class="c1">// Finally, move the config file to its new home</code>
  <code class="n">f</code><code class="o">.</code><code class="na">renameTo</code><code class="o">(</code><code class="k">new</code> <code class="n">File</code><code class="o">(</code><code class="n">configdir</code><code class="o">,</code> <code class="s">.config</code><code class="o">));</code>
<code class="o">}</code></pre>

<p>This shows some of the flexibility possible with the <code>File</code> class, but
also demonstrates some of the problems with the abstraction. It is very
general, and so requires a lot of methods to interrogate a <code>File</code>
object in order to determine what it actually represents and its
capabilities.</p>








<section data-pdf-bookmark="Files" data-type="sect2"><div class="sect2" id="idm45941108099144">
<h2>Files</h2>

<p><a data-primary="classic Java I/O" data-secondary="File class" data-type="indexterm" id="12_idm45941108097928"></a><a data-primary="File class" data-secondary="classic Java I/O" data-type="indexterm" id="12_idm45941108096952"></a>The <code>File</code> class has a very large number of methods on it, but some
basic functionality (notably a way to read the actual contents of a file) is
not, and never has been, provided directly.</p>

<p>Here鈥檚 a quick summary of <code>File</code> methods:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Permissions management</code>
<code class="kt">boolean</code> <code class="n">canX</code> <code class="o">=</code> <code class="n">f</code><code class="o">.</code><code class="na">canExecute</code><code class="o">();</code>
<code class="kt">boolean</code> <code class="n">canR</code> <code class="o">=</code> <code class="n">f</code><code class="o">.</code><code class="na">canRead</code><code class="o">();</code>
<code class="kt">boolean</code> <code class="n">canW</code> <code class="o">=</code> <code class="n">f</code><code class="o">.</code><code class="na">canWrite</code><code class="o">();</code>

<code class="kt">boolean</code> <code class="n">ok</code><code class="o">;</code>
<code class="n">ok</code> <code class="o">=</code> <code class="n">f</code><code class="o">.</code><code class="na">setReadOnly</code><code class="o">();</code>
<code class="n">ok</code> <code class="o">=</code> <code class="n">f</code><code class="o">.</code><code class="na">setExecutable</code><code class="o">(</code><code class="kc">true</code><code class="o">);</code>
<code class="n">ok</code> <code class="o">=</code> <code class="n">f</code><code class="o">.</code><code class="na">setReadable</code><code class="o">(</code><code class="kc">true</code><code class="o">);</code>
<code class="n">ok</code> <code class="o">=</code> <code class="n">f</code><code class="o">.</code><code class="na">setWritable</code><code class="o">(</code><code class="kc">false</code><code class="o">);</code>

<code class="c1">// Different views of the file&apos;s name</code>
<code class="n">File</code> <code class="n">absF</code> <code class="o">=</code> <code class="n">f</code><code class="o">.</code><code class="na">getAbsoluteFile</code><code class="o">();</code>
<code class="n">File</code> <code class="n">canF</code> <code class="o">=</code> <code class="n">f</code><code class="o">.</code><code class="na">getCanonicalFile</code><code class="o">();</code>
<code class="n">String</code> <code class="n">absName</code> <code class="o">=</code> <code class="n">f</code><code class="o">.</code><code class="na">getAbsolutePath</code><code class="o">();</code>
<code class="n">String</code> <code class="n">canName</code> <code class="o">=</code> <code class="n">f</code><code class="o">.</code><code class="na">getCanonicalPath</code><code class="o">();</code>
<code class="n">String</code> <code class="n">name</code> <code class="o">=</code> <code class="n">f</code><code class="o">.</code><code class="na">getName</code><code class="o">();</code>
<code class="n">String</code> <code class="n">pName</code> <code class="o">=</code> <code class="n">getParent</code><code class="o">();</code>
<code class="n">URI</code> <code class="n">fileURI</code> <code class="o">=</code> <code class="n">f</code><code class="o">.</code><code class="na">toURI</code><code class="o">();</code> <code class="c1">// Create URI for File path</code>

<code class="c1">// File metadata</code>
<code class="kt">boolean</code> <code class="n">exists</code> <code class="o">=</code> <code class="n">f</code><code class="o">.</code><code class="na">exists</code><code class="o">();</code>
<code class="kt">boolean</code> <code class="n">isAbs</code> <code class="o">=</code> <code class="n">f</code><code class="o">.</code><code class="na">isAbsolute</code><code class="o">();</code>
<code class="kt">boolean</code> <code class="n">isDir</code> <code class="o">=</code> <code class="n">f</code><code class="o">.</code><code class="na">isDirectory</code><code class="o">();</code>
<code class="kt">boolean</code> <code class="n">isFile</code> <code class="o">=</code> <code class="n">f</code><code class="o">.</code><code class="na">isFile</code><code class="o">();</code>
<code class="kt">boolean</code> <code class="n">isHidden</code> <code class="o">=</code> <code class="n">f</code><code class="o">.</code><code class="na">isHidden</code><code class="o">();</code>
<code class="kt">long</code> <code class="n">modTime</code> <code class="o">=</code> <code class="n">f</code><code class="o">.</code><code class="na">lastModified</code><code class="o">();</code> <code class="c1">// milliseconds since epoch</code>
<code class="kt">boolean</code> <code class="n">updateOK</code> <code class="o">=</code> <code class="n">f</code><code class="o">.</code><code class="na">setLastModified</code><code class="o">(</code><code class="n">updateTime</code><code class="o">);</code> <code class="c1">// milliseconds</code>
<code class="kt">long</code> <code class="n">fileLen</code> <code class="o">=</code> <code class="n">f</code><code class="o">.</code><code class="na">length</code><code class="o">();</code>

<code class="c1">// File management operations</code>
<code class="kt">boolean</code> <code class="n">renamed</code> <code class="o">=</code> <code class="n">f</code><code class="o">.</code><code class="na">renameTo</code><code class="o">(</code><code class="n">destFile</code><code class="o">);</code>
<code class="kt">boolean</code> <code class="n">deleted</code> <code class="o">=</code> <code class="n">f</code><code class="o">.</code><code class="na">delete</code><code class="o">();</code>

<code class="c1">// Create won&apos;t overwrite existing file</code>
<code class="kt">boolean</code> <code class="n">createdOK</code> <code class="o">=</code> <code class="n">f</code><code class="o">.</code><code class="na">createNewFile</code><code class="o">();</code>

<code class="c1">// Temporary file handling</code>
<code class="n">File</code> <code class="n">tmp</code> <code class="o">=</code> <code class="n">File</code><code class="o">.</code><code class="na">createTempFile</code><code class="o">(</code><code class="s">my-tmp</code><code class="o">,</code> <code class="s">.tmp</code><code class="o">);</code>
<code class="n">tmp</code><code class="o">.</code><code class="na">deleteOnExit</code><code class="o">();</code>

<code class="c1">// Directory handling</code>
<code class="kt">boolean</code> <code class="n">createdDir</code> <code class="o">=</code> <code class="n">dir</code><code class="o">.</code><code class="na">mkdir</code><code class="o">();</code>
<code class="n">String</code><code class="o">[]</code> <code class="n">fileNames</code> <code class="o">=</code> <code class="n">dir</code><code class="o">.</code><code class="na">list</code><code class="o">();</code>
<code class="n">File</code><code class="o">[]</code> <code class="n">files</code> <code class="o">=</code> <code class="n">dir</code><code class="o">.</code><code class="na">listFiles</code><code class="o">();</code></pre>

<p>The <code>File</code> class also has a few methods on it that aren鈥檛 a perfect fit
for the abstraction. They largely involve interrogating the filesystem
(e.g., inquiring about available free space) that the file resides on:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">long</code> <code class="n">free</code><code class="o">,</code> <code class="n">total</code><code class="o">,</code> <code class="n">usable</code><code class="o">;</code>

<code class="n">free</code> <code class="o">=</code> <code class="n">f</code><code class="o">.</code><code class="na">getFreeSpace</code><code class="o">();</code>
<code class="n">total</code> <code class="o">=</code> <code class="n">f</code><code class="o">.</code><code class="na">getTotalSpace</code><code class="o">();</code>
<code class="n">usable</code> <code class="o">=</code> <code class="n">f</code><code class="o">.</code><code class="na">getUsableSpace</code><code class="o">();</code>

<code class="n">File</code><code class="o">[]</code> <code class="n">roots</code> <code class="o">=</code> <code class="n">File</code><code class="o">.</code><code class="na">listRoots</code><code class="o">();</code> <code class="c1">// all available Filesystem roots</code></pre>
</div></section>













<section data-pdf-bookmark="Streams" data-type="sect2"><div class="sect2" id="idm45941107743896">
<h2>Streams</h2>

<p><a data-primary="classic Java I/O" data-secondary="stream abstraction" data-type="indexterm" id="12_idm45941107730488"></a><a data-primary="stream abstraction" data-type="indexterm" id="12_idm45941107729512"></a>The I/O stream abstraction (not to be confused with the streams that
are used when dealing with the Java 8 Collection APIs) was present in
Java 1.0, as a way of dealing with sequential streams of bytes from
disks or other sources.</p>

<p><a data-primary="InputStream class" data-type="indexterm" id="12_idm45941107728216"></a><a data-primary="OutputStream class" data-type="indexterm" id="12_idm45941107727288"></a>The core of this API is a pair of abstract classes, <code>InputStream</code> and
<code>OutputStream</code>. <a data-primary="System.in" data-type="indexterm" id="12_idm45941107725656"></a><a data-primary="System.out" data-type="indexterm" id="12_idm45941107724920"></a>These are very widely used, and in fact the 鈥渟tandard鈥?
input and output streams, which are called <code>System.in</code> and
<code>System.out</code>, are streams of this type. They are public, static fields
of the <code>System</code> class, and are often used in even the simplest <span class="keep-together">programs</span>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Hello World!</code><code class="o">);</code></pre>

<p><a data-primary="FileInputStream class" data-type="indexterm" id="12_idm45941107718600"></a><a data-primary="FileOutputStream class" data-type="indexterm" id="12_idm45941107716296"></a>Specific subclasses of streams, including <code>FileInputStream</code> and
<code>FileOutputStream</code>, can be used to operate on individual bytes in a
file鈥攆or example, by counting all the times ASCII 97 (small letter <em>a</em>)
occurs in a file:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">try</code> <code class="o">(</code><code class="n">InputStream</code> <code class="n">is</code> <code class="o">=</code> <code class="k">new</code> <code class="n">FileInputStream</code><code class="o">(</code><code class="s">/Users/ben/cluster.txt</code><code class="o">))</code> <code class="o">{</code>
  <code class="kt">byte</code><code class="o">[]</code> <code class="n">buf</code> <code class="o">=</code> <code class="k">new</code> <code class="kt">byte</code><code class="o">[</code><code class="mi">4096</code><code class="o">];</code>
  <code class="kt">int</code> <code class="n">len</code><code class="o">,</code> <code class="n">count</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code>
  <code class="k">while</code> <code class="o">((</code><code class="n">len</code> <code class="o">=</code> <code class="n">is</code><code class="o">.</code><code class="na">read</code><code class="o">(</code><code class="n">buf</code><code class="o">))</code> <code class="o">&gt;</code> <code class="mi">0</code><code class="o">)</code> <code class="o">{</code>
    <code class="k">for</code> <code class="o">(</code><code class="kt">int</code> <code class="n">i</code><code class="o">=</code><code class="mi">0</code><code class="o">;</code> <code class="n">i</code><code class="o">&lt;</code><code class="n">len</code><code class="o">;</code> <code class="n">i</code><code class="o">++)</code>
      <code class="k">if</code> <code class="o">(</code><code class="n">buf</code><code class="o">[</code><code class="n">i</code><code class="o">]</code> <code class="o">==</code> <code class="mi">97</code><code class="o">)</code> <code class="n">count</code><code class="o">++;</code>
  <code class="o">}</code>
  <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">&apos;a&apos;s seen: </code><code class="o">+</code> <code class="n">count</code><code class="o">);</code>
<code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">IOException</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>
  <code class="n">e</code><code class="o">.</code><code class="na">printStackTrace</code><code class="o">();</code>
<code class="o">}</code></pre>

<p>This approach to dealing with on-disk data can lack some
flexibility鈥攎ost developers think in terms of characters, not bytes. To
<a data-primary="Reader and Writer classes" data-type="indexterm" id="12_idm45941107705112"></a>allow for this, the streams are usually combined with the higher-level
<code>Reader</code> and <code>Writer</code> classes, which provide a character-stream level of
interaction, rather than the low-level byte stream provided by
<code>InputStream</code> and <code>OutputStream</code> and their subclasses.</p>
</div></section>













<section data-pdf-bookmark="Readers and Writers" data-type="sect2"><div class="sect2" id="idm45941107537704">
<h2>Readers and Writers</h2>

<p><a data-primary="classic Java I/O" data-secondary="readers and writers" data-type="indexterm" id="12_idm45941107536200"></a><a data-primary="reader class" data-type="indexterm" id="12_idm45941107535224"></a><a data-primary="writer class" data-type="indexterm" id="12_idm45941107534552"></a>By moving to an abstraction that deals in characters, rather than
bytes, developers are presented with an API that is much more familiar,
and that hides many of the issues with character encoding, Unicode, and
so on.</p>

<p>The <code>Reader</code> and <code>Writer</code> classes are intended to overlay the byte
stream classes, and to remove the need for low-level handling of I/O
streams. They have several subclasses that are often used to layer on
top of each other, such as:</p>

<ul>
<li>
<p><code>FileReader</code></p>
</li>
<li>
<p><code>BufferedReader</code></p>
</li>
<li>
<p><code>InputStreamReader</code></p>
</li>
<li>
<p><code>FileWriter</code></p>
</li>
<li>
<p><code>PrintWriter</code></p>
</li>
<li>
<p><code>BufferedWriter</code></p>
</li>
</ul>

<p><a data-primary="BufferedReader class" data-type="indexterm" id="12_idm45941107525032"></a><a data-primary="FileReader class" data-type="indexterm" id="12_idm45941107524328"></a>To read all lines in from a file and print them out, we use a
<code>BufferedReader</code> layered on top of a <code>FileReader</code>, like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">try</code> <code class="o">(</code><code class="n">BufferedReader</code> <code class="n">in</code> <code class="o">=</code>
      <code class="k">new</code> <code class="nf">BufferedReader</code><code class="o">(</code><code class="k">new</code> <code class="n">FileReader</code><code class="o">(</code><code class="n">filename</code><code class="o">)))</code> <code class="o">{</code>
  <code class="n">String</code> <code class="n">line</code><code class="o">;</code>

  <code class="k">while</code><code class="o">((</code><code class="n">line</code> <code class="o">=</code> <code class="n">in</code><code class="o">.</code><code class="na">readLine</code><code class="o">())</code> <code class="o">!=</code> <code class="kc">null</code><code class="o">)</code> <code class="o">{</code>
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">line</code><code class="o">);</code>
  <code class="o">}</code>
<code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">IOException</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>
  <code class="c1">// Handle FileNotFoundException, etc. here</code>
<code class="o">}</code></pre>

<p><a data-primary="InputStreamReader class" data-type="indexterm" id="12_idm45941107418488"></a>If we need to read in lines from the console, rather than a file, we
will usually use an <code>InputStreamReader</code> applied to <code>System.in</code>. Let鈥檚 look at an example where we want to read in lines of input from the
console, but treat input lines that start with a special character as
special鈥攃ommands (鈥渕etas鈥? to be processed, rather than regular text.
This is a common feature of many chat programs, including IRC. We鈥檒l
use regular expressions from <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch09.html#javanut7-CHP-9">Chapter 9</a> to help
us:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Pattern</code> <code class="n">SHELL_META_START</code> <code class="o">=</code> <code class="n">Pattern</code><code class="o">.</code><code class="na">compile</code><code class="o">(</code><code class="s">^#(\\w+)\\s*(\\w+)?</code><code class="o">);</code>

<code class="k">try</code> <code class="o">(</code><code class="n">BufferedReader</code> <code class="n">console</code> <code class="o">=</code>
      <code class="k">new</code> <code class="nf">BufferedReader</code><code class="o">(</code><code class="k">new</code> <code class="n">InputStreamReader</code><code class="o">(</code><code class="n">System</code><code class="o">.</code><code class="na">in</code><code class="o">)))</code> <code class="o">{</code>
  <code class="n">String</code> <code class="n">line</code><code class="o">;</code>

  <code class="nl">READ:</code> <code class="k">while</code><code class="o">((</code><code class="n">line</code> <code class="o">=</code> <code class="n">console</code><code class="o">.</code><code class="na">readLine</code><code class="o">())</code> <code class="o">!=</code> <code class="kc">null</code><code class="o">)</code> <code class="o">{</code>
    <code class="c1">// Check for special commands (&quot;metas&quot;)</code>
    <code class="n">Matcher</code> <code class="n">m</code> <code class="o">=</code> <code class="n">SHELL_META_START</code><code class="o">.</code><code class="na">matcher</code><code class="o">(</code><code class="n">line</code><code class="o">);</code>
    <code class="k">if</code> <code class="o">(</code><code class="n">m</code><code class="o">.</code><code class="na">find</code><code class="o">())</code> <code class="o">{</code>
      <code class="n">String</code> <code class="n">metaName</code> <code class="o">=</code> <code class="n">m</code><code class="o">.</code><code class="na">group</code><code class="o">(</code><code class="mi">1</code><code class="o">);</code>
      <code class="n">String</code> <code class="n">arg</code> <code class="o">=</code> <code class="n">m</code><code class="o">.</code><code class="na">group</code><code class="o">(</code><code class="mi">2</code><code class="o">);</code>
      <code class="n">doMeta</code><code class="o">(</code><code class="n">metaName</code><code class="o">,</code> <code class="n">arg</code><code class="o">);</code>
      <code class="k">continue</code> <code class="n">READ</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">line</code><code class="o">);</code>
  <code class="o">}</code>
<code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">IOException</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>
  <code class="c1">// Handle FileNotFoundException, etc. here</code>
<code class="o">}</code></pre>

<p>To output text to a file, we can use code like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">File</code> <code class="n">f</code> <code class="o">=</code> <code class="k">new</code> <code class="n">File</code><code class="o">(</code><code class="n">System</code><code class="o">.</code><code class="na">getProperty</code><code class="o">(</code><code class="s">user.home</code><code class="o">)</code>
 <code class="o">+</code> <code class="n">File</code><code class="o">.</code><code class="na">separator</code> <code class="o">+</code> <code class="s">.bashrc</code><code class="o">);</code>
<code class="k">try</code> <code class="o">(</code><code class="n">PrintWriter</code> <code class="n">out</code> <code class="o">=</code>
      <code class="k">new</code> <code class="nf">PrintWriter</code><code class="o">(</code><code class="k">new</code> <code class="n">BufferedWriter</code><code class="o">(</code><code class="k">new</code> <code class="n">FileWriter</code><code class="o">(</code><code class="n">f</code><code class="o">))))</code> <code class="o">{</code>
  <code class="n">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">## Automatically generated config file. DO NOT EDIT</code><code class="o">);</code>
  <code class="c1">// ...</code>
<code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">IOException</code> <code class="n">iox</code><code class="o">)</code> <code class="o">{</code>
  <code class="c1">// Handle exceptions</code>
<code class="o">}</code></pre>

<p>This older style of Java I/O has a lot of other functionality that is
occasionally useful. <a data-primary="FilterInputStream class" data-type="indexterm" id="12_idm45941107127672"></a>For example, to deal with text files, the
<code>FilterInputStream</code> class is quite often useful. Or for threads that
want to communicate in a way similar to the classic 鈥減iped鈥?I/O
approach, <code>PipedInputStream</code>, <code>PipedReader</code>, and their write
counterparts are provided.</p>

<p>Throughout this chapter so far, we have used the language feature known
as 鈥渢ry-with-resources鈥?(TWR). This syntax was briefly introduced in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2-SECT-5.18">鈥淭he try-with-resources Statement鈥?/a&gt;, but it is in conjunction
with operations like I/O that it comes into its fullest potential, and
it has granted a new lease on life to the older I/O style.</p>
</div></section>













<section data-pdf-bookmark="try-with-resources Revisited" data-type="sect2"><div class="sect2" id="idm45941107537048">
<h2>try-with-resources Revisited</h2>

<p><a data-primary="classic Java I/O" data-secondary="try-with-resources statement" data-type="indexterm" id="12_idm45941107259560"></a><a data-primary="try-with-resources (TWR) statements" data-type="indexterm" id="12_idm45941107258616"></a>To make the most of Java鈥檚 I/O capabilities, it is important to
understand how and when to use TWR. It is very easy to understand when
code should use TWR鈥攚henever it is possible to do so.</p>

<p>Before TWR, resources had to be closed manually, and complex
interactions between resources that could fail to close led to buggy
code that could leak <span class="keep-together">resources</span>.</p>

<p>In fact, Oracle鈥檚 engineers estimate that 60% of the resource handling
code in the initial JDK 6 release was incorrect. So, if even the
platform authors can鈥檛 reliably get manual resource handling right, then
all new code should definitely be using TWR.</p>

<p><a data-primary="AutoCloseable interface" data-type="indexterm" id="12_idm45941107255400"></a>The key to TWR is a new interface鈥?code&gt;AutoCloseable</code>. This interface is a direct superinterface of <code>Closeable</code>.
It marks a resource that must be automatically closed, and for which the compiler will insert special exception-handling code.</p>

<p>Inside a TWR resource clause, only declarations of objects that
implement <code>AutoCloseable</code> objects may appear鈥攂ut the developer may
declare as many as required:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">try</code> <code class="o">(</code><code class="n">BufferedReader</code> <code class="n">in</code> <code class="o">=</code> <code class="k">new</code> <code class="n">BufferedReader</code><code class="o">(</code>
                           <code class="k">new</code> <code class="nf">FileReader</code><code class="o">(</code><code class="s">profile</code><code class="o">));</code>
     <code class="n">PrintWriter</code> <code class="n">out</code> <code class="o">=</code> <code class="k">new</code> <code class="n">PrintWriter</code><code class="o">(</code>
                         <code class="k">new</code> <code class="nf">BufferedWriter</code><code class="o">(</code>
                           <code class="k">new</code> <code class="nf">FileWriter</code><code class="o">(</code><code class="s">profile.bak</code><code class="o">))))</code> <code class="o">{</code>
  <code class="n">String</code> <code class="n">line</code><code class="o">;</code>
  <code class="k">while</code><code class="o">((</code><code class="n">line</code> <code class="o">=</code> <code class="n">in</code><code class="o">.</code><code class="na">readLine</code><code class="o">())</code> <code class="o">!=</code> <code class="kc">null</code><code class="o">)</code> <code class="o">{</code>
    <code class="n">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">line</code><code class="o">);</code>
  <code class="o">}</code>
<code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">IOException</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>
  <code class="c1">// Handle FileNotFoundException, etc. here</code>
<code class="o">}</code></pre>

<p>The consequences of this are that resources are automatically scoped to
the <code>try</code> block. The resources (whether readable or writable) are
automatically closed in the correct order, and the compiler inserts
exception handling that takes dependencies between resources into
account.</p>

<p>TWR is related to similar concepts in other languages and environments鈥攆or example, RAII in C++.
However, as discussed in the finalization section, TWR is limited to block scope.
This minor limitation is due to the fact that the feature is implemented by the Java source code compiler鈥攊t automatically inserts bytecode that calls the resource鈥檚 <code>close()</code> method when the scope is exited (by whatever means).</p>

<p><a data-primary="C#, using keyword" data-type="indexterm" id="12_idm45941107073816"></a>As a result, the overall effect of TWR is more similar to C#鈥檚 <code>using</code> keyword, rather than the C++ version of RAII.
For Java developers, the best way to regard TWR is as 鈥渇inalization done right.鈥?
As noted in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch06.html#javanut7-CHP-6-SECT-4">鈥淔inalization鈥?/a&gt;, new code should never directly use the finalization mechanism, and should always use TWR instead.
Older code should be refactored to use TWR as soon as is practicable, as it provides real tangible benefits to resource handling code.</p>
</div></section>













<section data-pdf-bookmark="Problems with Classic I/O" data-type="sect2"><div class="sect2" id="idm45941107260504">
<h2>Problems with Classic I/O</h2>

<p><a data-primary="classic Java I/O" data-secondary="problems with" data-type="indexterm" id="12_idm45941107070328"></a>Even with the welcome addition of <code>try</code>-with-resources, the <code>File</code>
class and friends have a number of problems that make them less than
ideal for extensive use when performing even standard I/O operations.
For instance:</p>

<ul>
<li>
<p>鈥淢issing methods鈥?for common operations</p>
</li>
<li>
<p>Does not deal with filenames consistently across platforms</p>
</li>
<li>
<p>Fails to have a unified model for file attributes (e.g., modeling
read/write access)</p>
</li>
<li>
<p>Difficult to traverse unknown directory structures</p>
</li>
<li>
<p>No platform- or OS-specific features</p>
</li>
<li>
<p>Nonblocking operations for filesystems not supported</p>
</li>
</ul>

<p>To deal with these shortcomings, Java鈥檚 I/O has evolved over several
major releases. It was really with the release of Java 7 that this
support became truly easy and effective to use.<a data-startref="ix_ch10-asciidoc2" data-type="indexterm" id="12_idm45941107061672"></a><a data-startref="ix_ch10-asciidoc1" data-type="indexterm" id="12_idm45941107060968"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Modern Java I/O" data-type="sect1"><div class="sect1" id="idm45941108234216">
<h1>Modern Java I/O</h1>

<p><a data-primary="I/O (input/output)" data-secondary="modern Java I/O" data-type="indexterm" id="12_ix_ch10-asciidoc3"></a><a data-primary="modern Java I/O" data-type="indexterm" id="12_ix_ch10-asciidoc4"></a>Java 7 brought in a brand new I/O API鈥攗sually called NIO.2鈥攁nd it
should be considered almost a complete replacement for the original
<code>File</code> approach to I/O. <a data-primary="java.nio.file package" data-type="indexterm" id="12_idm45941107055896"></a>The new classes are contained in the
<code>java.nio.file</code> package.</p>

<p>The new API that was brought in with Java 7 is considerably easier to
use for many use cases. It has two major parts. The first is a new
abstraction called <code>Path</code> (which can be thought of as representing a
file location, which may or may not have anything actually at that
location). The second piece is lots of new convenience and utility
methods to deal with files and filesystems. These are contained as
static methods in the <code>Files</code> class.</p>








<section data-pdf-bookmark="Files" data-type="sect2"><div class="sect2" id="idm45941107052776">
<h2>Files</h2>

<p><a data-primary="File class" data-secondary="modern Java I/O" data-type="indexterm" id="12_idm45941107051304"></a><a data-primary="modern Java I/O" data-secondary="File class" data-type="indexterm" id="12_idm45941107050328"></a>For example, when you are using the new <code>Files</code> functionality, a basic copy
operation is now as simple as:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">File</code> <code class="n">inputFile</code> <code class="o">=</code> <code class="k">new</code> <code class="n">File</code><code class="o">(</code><code class="s">input.txt</code><code class="o">);</code>
<code class="k">try</code> <code class="o">(</code><code class="n">InputStream</code> <code class="n">in</code> <code class="o">=</code> <code class="k">new</code> <code class="n">FileInputStream</code><code class="o">(</code><code class="n">inputFile</code><code class="o">))</code> <code class="o">{</code>
  <code class="n">Files</code><code class="o">.</code><code class="na">copy</code><code class="o">(</code><code class="n">in</code><code class="o">,</code> <code class="n">Paths</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">output.txt</code><code class="o">));</code>
<code class="o">}</code> <code class="k">catch</code><code class="o">(</code><code class="n">IOException</code> <code class="n">ex</code><code class="o">)</code> <code class="o">{</code>
  <code class="n">ex</code><code class="o">.</code><code class="na">printStackTrace</code><code class="o">();</code>
<code class="o">}</code></pre>

<p>Let鈥檚 take a quick survey of some of the major methods in <code>Files</code>鈥攖he
operation of most of them is pretty self-explanatory. In many cases, the
methods have return types. We have omitted handling these, as they are
rarely useful except for contrived examples, and for duplicating the
behavior of the equivalent C code:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Path</code> <code class="n">source</code><code class="o">,</code> <code class="n">target</code><code class="o">;</code>
<code class="n">Attributes</code> <code class="n">attr</code><code class="o">;</code>
<code class="n">Charset</code> <code class="n">cs</code> <code class="o">=</code> <code class="n">StandardCharsets</code><code class="o">.</code><code class="na">UTF_8</code><code class="o">;</code>

<code class="c1">// Creating files</code>
<code class="c1">//</code>
<code class="c1">// Example of path --&gt; /home/ben/.profile</code>
<code class="c1">// Example of attributes --&gt; rw-rw-rw-</code>
<code class="n">Files</code><code class="o">.</code><code class="na">createFile</code><code class="o">(</code><code class="n">target</code><code class="o">,</code> <code class="n">attr</code><code class="o">);</code>

<code class="c1">// Deleting files</code>
<code class="n">Files</code><code class="o">.</code><code class="na">delete</code><code class="o">(</code><code class="n">target</code><code class="o">);</code>
<code class="kt">boolean</code> <code class="n">deleted</code> <code class="o">=</code> <code class="n">Files</code><code class="o">.</code><code class="na">deleteIfExists</code><code class="o">(</code><code class="n">target</code><code class="o">);</code>

<code class="c1">// Copying/moving files</code>
<code class="n">Files</code><code class="o">.</code><code class="na">copy</code><code class="o">(</code><code class="n">source</code><code class="o">,</code> <code class="n">target</code><code class="o">);</code>
<code class="n">Files</code><code class="o">.</code><code class="na">move</code><code class="o">(</code><code class="n">source</code><code class="o">,</code> <code class="n">target</code><code class="o">);</code>

<code class="c1">// Utility methods to retrieve information</code>
<code class="kt">long</code> <code class="n">size</code> <code class="o">=</code> <code class="n">Files</code><code class="o">.</code><code class="na">size</code><code class="o">(</code><code class="n">target</code><code class="o">);</code>

<code class="n">FileTime</code> <code class="n">fTime</code> <code class="o">=</code> <code class="n">Files</code><code class="o">.</code><code class="na">getLastModifiedTime</code><code class="o">(</code><code class="n">target</code><code class="o">);</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">fTime</code><code class="o">.</code><code class="na">to</code><code class="o">(</code><code class="n">TimeUnit</code><code class="o">.</code><code class="na">SECONDS</code><code class="o">));</code>

<code class="n">Map</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code> <code class="o">?&gt;</code> <code class="n">attrs</code> <code class="o">=</code> <code class="n">Files</code><code class="o">.</code><code class="na">readAttributes</code><code class="o">(</code><code class="n">target</code><code class="o">,</code> <code class="s">*</code><code class="o">);</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">attrs</code><code class="o">);</code>

<code class="c1">// Methods to deal with file types</code>
<code class="kt">boolean</code> <code class="n">isDir</code> <code class="o">=</code> <code class="n">Files</code><code class="o">.</code><code class="na">isDirectory</code><code class="o">(</code><code class="n">target</code><code class="o">);</code>
<code class="kt">boolean</code> <code class="n">isSym</code> <code class="o">=</code> <code class="n">Files</code><code class="o">.</code><code class="na">isSymbolicLink</code><code class="o">(</code><code class="n">target</code><code class="o">);</code>

<code class="c1">// Methods to deal with reading and writing</code>
<code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">lines</code> <code class="o">=</code> <code class="n">Files</code><code class="o">.</code><code class="na">readAllLines</code><code class="o">(</code><code class="n">target</code><code class="o">,</code> <code class="n">cs</code><code class="o">);</code>
<code class="kt">byte</code><code class="o">[]</code> <code class="n">b</code> <code class="o">=</code> <code class="n">Files</code><code class="o">.</code><code class="na">readAllBytes</code><code class="o">(</code><code class="n">target</code><code class="o">);</code>

<code class="n">BufferedReader</code> <code class="n">br</code> <code class="o">=</code> <code class="n">Files</code><code class="o">.</code><code class="na">newBufferedReader</code><code class="o">(</code><code class="n">target</code><code class="o">,</code> <code class="n">cs</code><code class="o">);</code>
<code class="n">BufferedWriter</code> <code class="n">bwr</code> <code class="o">=</code> <code class="n">Files</code><code class="o">.</code><code class="na">newBufferedWriter</code><code class="o">(</code><code class="n">target</code><code class="o">,</code> <code class="n">cs</code><code class="o">);</code>

<code class="n">InputStream</code> <code class="n">is</code> <code class="o">=</code> <code class="n">Files</code><code class="o">.</code><code class="na">newInputStream</code><code class="o">(</code><code class="n">target</code><code class="o">);</code>
<code class="n">OutputStream</code> <code class="n">os</code> <code class="o">=</code> <code class="n">Files</code><code class="o">.</code><code class="na">newOutputStream</code><code class="o">(</code><code class="n">target</code><code class="o">);</code></pre>

<p>Some of the methods on <code>Files</code> provide the opportunity to pass optional
arguments, to provide additional (possibly implementation-specific)
behavior for the operation.</p>

<p>Some of the API choices here produce occasionally annoying behavior. For
example, by default, a copy operation will not overwrite an existing
file, so we need to specify this behavior as a copy option:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Files</code><code class="o">.</code><code class="na">copy</code><code class="o">(</code><code class="n">Paths</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">input.txt</code><code class="o">),</code> <code class="n">Paths</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">output.txt</code><code class="o">),</code>
           <code class="n">StandardCopyOption</code><code class="o">.</code><code class="na">REPLACE_EXISTING</code><code class="o">);</code></pre>

<p><a data-primary="CopyOption interface" data-type="indexterm" id="12_idm45941106695240"></a><a data-primary="StandardCopyOption enum" data-type="indexterm" id="12_idm45941106690024"></a><code>StandardCopyOption</code> is an enum that implements an interface called
<code>CopyOption</code>. <a data-primary="LinkOption class" data-type="indexterm" id="12_idm45941106688552"></a>This is also implemented by <code>LinkOption</code>. So
<code>Files.copy()</code> can take any number of either <code>LinkOption</code> or
<code>StandardCopyOption</code> arguments. <code>LinkOption</code> is used to specify how
symbolic links should be handled (provided the underlying OS supports
symlinks, of course).</p>
</div></section>













<section data-pdf-bookmark="Path" data-type="sect2"><div class="sect2" id="idm45941106685416">
<h2>Path</h2>

<p><a data-primary="modern Java I/O" data-secondary="Path type" data-type="indexterm" id="12_ix_ch10-asciidoc5"></a><a data-primary="Path type" data-type="indexterm" id="12_ix_ch10-asciidoc6"></a><code>Path</code> is a type that may be used to locate a file in a filesystem.
It represents a path that is:</p>

<ul>
<li>
<p>System dependent</p>
</li>
<li>
<p>Hierarchical</p>
</li>
<li>
<p>Composed of a sequence of path elements</p>
</li>
<li>
<p>Hypothetical (may not exist yet, or may have been deleted)</p>
</li>
</ul>

<p>It is therefore fundamentally different to a <code>File</code>. In particular, the
system dependency is manifested by <code>Path</code> being an interface, not a
class, which enables different filesystem providers to each implement the
<code>Path</code> interface, and provide for system-specific features while
retaining the overall abstraction.</p>

<p>The elements of a <code>Path</code> consist of an optional root component, which
identifies the filesystem hierarchy that this instance belongs to. Note
that, for example, relative <code>Path</code> instances may not have a root
component. In addition to the root, all <code>Path</code> instances have zero or
more directory names and a name element.</p>

<p>The name element is the element farthest from the root of the directory
hierarchy and represents the name of the file or directory. The <code>Path</code>
can be thought of as consisting of the path elements joined together by a
special separator or delimiter.</p>

<p><code>Path</code> is an abstract concept; it isn鈥檛 necessarily bound to any physical file path.
This allows us to talk easily about the locations of files that don鈥檛 exist yet.
Java ships with a <code>Paths</code> class that provides factory methods for creating <code>Path</code> instances.</p>

<p><a data-primary="get()" data-type="indexterm" id="12_idm45941106657336"></a><code>Paths</code> provides two <code>get()</code> methods for creating <code>Path</code> objects.
The usual version takes a <code>String</code>, and uses the default filesystem provider. The <code>URI</code> version takes advantage of the ability of NIO.2 to plug in additional providers of bespoke filesystems.
This is an advanced usage, and interested developers should consult the primary documentation.
Let鈥檚 look at some simple examples of how to use <code>Path</code>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Path</code> <code class="n">p</code> <code class="o">=</code> <code class="n">Paths</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">/Users/ben/cluster.txt</code><code class="o">);</code>
<code class="n">Path</code> <code class="n">p</code> <code class="o">=</code> <code class="n">Paths</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="k">new</code> <code class="n">URI</code><code class="o">(</code><code class="s">file:///Users/ben/cluster.txt</code><code class="o">));</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">p2</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">p</code><code class="o">));</code>

<code class="n">File</code> <code class="n">f</code> <code class="o">=</code> <code class="n">p</code><code class="o">.</code><code class="na">toFile</code><code class="o">();</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">f</code><code class="o">.</code><code class="na">isDirectory</code><code class="o">());</code>
<code class="n">Path</code> <code class="n">p3</code> <code class="o">=</code> <code class="n">f</code><code class="o">.</code><code class="na">toPath</code><code class="o">();</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">p3</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">p</code><code class="o">));</code></pre>

<p>This example also shows the easy interoperation between <code>Path</code> and <code>File</code> objects.
The addition of a <code>toFile()</code> method to <code>Path</code> and a <code>toPath()</code> method to <code>File</code> allows the developer to move effortlessly between the two APIs and allows for a straightforward approach to refactoring the internals of code based on <code>File</code> to use <code>Path</code> instead.</p>

<p>We can also make use of some useful 鈥渂ridge鈥?methods that the <code>Files</code>
class also provides. These provide convenient access to the older I/O
APIs鈥攆or example, by providing convenience methods to open <code>Writer</code>
objects to specified <code>Path</code> locations:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Path</code> <code class="n">logFile</code> <code class="o">=</code> <code class="n">Paths</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">/tmp/app.log</code><code class="o">);</code>
<code class="k">try</code> <code class="o">(</code><code class="n">BufferedWriter</code> <code class="n">writer</code> <code class="o">=</code>
       <code class="n">Files</code><code class="o">.</code><code class="na">newBufferedWriter</code><code class="o">(</code><code class="n">logFile</code><code class="o">,</code> <code class="n">StandardCharsets</code><code class="o">.</code><code class="na">UTF_8</code><code class="o">,</code>
                               <code class="n">StandardOpenOption</code><code class="o">.</code><code class="na">WRITE</code><code class="o">))</code> <code class="o">{</code>
  <code class="n">writer</code><code class="o">.</code><code class="na">write</code><code class="o">(</code><code class="s">Hello World!</code><code class="o">);</code>
  <code class="c1">// ...</code>
<code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">IOException</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>
  <code class="c1">// ...</code>
<code class="o">}</code></pre>

<p>We鈥檙e making use of the <code>StandardOpenOption</code> enum, which provides
similar capabilities to the copy options, but for the case of opening a
new file instead.</p>

<p>In this example use case, we have used the <code>Path</code> API to:</p>

<ul>
<li>
<p>Create a <code>Path</code> corresponding to a new file</p>
</li>
<li>
<p>Use the <code>Files</code> class to create that new file</p>
</li>
<li>
<p>Open a <code>Writer</code> to that file</p>
</li>
<li>
<p>Write to that file</p>
</li>
<li>
<p>Automatically close it when done</p>
</li>
</ul>

<p><a data-primary="FileSystem class" data-type="indexterm" id="12_idm45941106447480"></a><a data-primary="JAR (Java archive) files" data-secondary="manipulating as a FileSystem" data-type="indexterm" id="12_idm45941106415480"></a>In our next example, we鈥檒l build on this to manipulate a JAR file as
a <code>FileSystem</code> in its own right, modifying it to add an additional file
directly into the JAR.
Recall that JAR files are actually just ZIP files, so this technique will also work for <em>.zip</em> archives:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Path</code> <code class="n">tempJar</code> <code class="o">=</code> <code class="n">Paths</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">sample.jar</code><code class="o">);</code>
<code class="k">try</code> <code class="o">(</code><code class="n">FileSystem</code> <code class="n">workingFS</code> <code class="o">=</code>
  <code class="n">FileSystems</code><code class="o">.</code><code class="na">newFileSystem</code><code class="o">(</code><code class="n">tempJar</code><code class="o">,</code> <code class="kc">null</code><code class="o">))</code> <code class="o">{</code>
  <code class="n">Path</code> <code class="n">pathForFile</code> <code class="o">=</code> <code class="n">workingFS</code><code class="o">.</code><code class="na">getPath</code><code class="o">(</code><code class="s">/hello.txt</code><code class="o">);</code>
  <code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">ls</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;&gt;();</code>
  <code class="n">ls</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="s">Hello World!</code><code class="o">);</code>

  <code class="n">Files</code><code class="o">.</code><code class="na">write</code><code class="o">(</code><code class="n">pathForFile</code><code class="o">,</code> <code class="n">ls</code><code class="o">,</code> <code class="n">Charset</code><code class="o">.</code><code class="na">defaultCharset</code><code class="o">(),</code>
              <code class="n">StandardOpenOption</code><code class="o">.</code><code class="na">WRITE</code><code class="o">,</code> <code class="n">StandardOpenOption</code><code class="o">.</code><code class="na">CREATE</code><code class="o">);</code>
<code class="o">}</code></pre>

<p>This shows how we use a <code>FileSystem</code> to make the <code>Path</code> objects inside
it, via the <code>getPath()</code> method. This enables the developer to
effectively treat <code>FileSystem</code> objects as black boxes.</p>

<p>Files also provides methods for handling temporary files and directories, which is a surprisingly common use case (and can be a source of security bugs).
For example, let鈥檚 see how to load a resources file from within the classpath, copy it to a newly created temporary directory, and then clean up the temporary files safely (using the <code>Reaper</code> class we introduced in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch05.html#javanut7-CHP-5">Chapter 5</a>):</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Path</code> <code class="n">tmpdir</code> <code class="o">=</code> <code class="n">Files</code><code class="o">.</code><code class="na">createTempDirectory</code><code class="o">(</code><code class="n">Paths</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">/tmp</code><code class="o">),</code> <code class="s">tmp-test</code><code class="o">);</code>
<code class="k">try</code> <code class="o">(</code><code class="n">InputStream</code> <code class="n">in</code> <code class="o">=</code>
      <code class="n">FilesExample</code><code class="o">.</code><code class="na">class</code><code class="o">.</code><code class="na">getResourceAsStream</code><code class="o">(</code><code class="s">/res.txt</code><code class="o">))</code> <code class="o">{</code>
    <code class="n">Path</code> <code class="n">copied</code> <code class="o">=</code> <code class="n">tmpdir</code><code class="o">.</code><code class="na">resolve</code><code class="o">(</code><code class="s">copied-resource.txt</code><code class="o">);</code>
    <code class="n">Files</code><code class="o">.</code><code class="na">copy</code><code class="o">(</code><code class="n">in</code><code class="o">,</code> <code class="n">copied</code><code class="o">,</code> <code class="n">StandardCopyOption</code><code class="o">.</code><code class="na">REPLACE_EXISTING</code><code class="o">);</code>
    <code class="c1">// ... work with the copy</code>
<code class="o">}</code>
<code class="c1">// Clean up when done...</code>
<code class="n">Files</code><code class="o">.</code><code class="na">walkFileTree</code><code class="o">(</code><code class="n">tmpdir</code><code class="o">,</code> <code class="k">new</code> <code class="n">Reaper</code><code class="o">());</code></pre>

<p>One of the criticisms of Java鈥檚 original I/O APIs was the lack of support for native and high-performance I/O.
A solution was initially added in Java 1.4, the Java New I/O (NIO) API, and it has been refined in later Java versions<a data-startref="ix_ch10-asciidoc6" data-type="indexterm" id="12_idm45941106319880"></a><a data-startref="ix_ch10-asciidoc5" data-type="indexterm" id="12_idm45941106319272"></a>.<a data-startref="ix_ch10-asciidoc4" data-type="indexterm" id="12_idm45941106205096"></a><a data-startref="ix_ch10-asciidoc3" data-type="indexterm" id="12_idm45941106204392"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="NIO Channels and Buffers" data-type="sect1"><div class="sect1" id="idm45941106671752">
<h1>NIO Channels and Buffers</h1>

<p><a data-primary="buffers, NIO" data-type="indexterm" id="12_ix_ch10-asciidoc7"></a><a data-primary="channels" data-type="indexterm" id="12_ix_ch10-asciidoc8"></a><a data-primary="I/O (input/output)" data-secondary="NIO channels and buffers" data-type="indexterm" id="12_ix_ch10-asciidoc9"></a><a data-primary="NIO channels and buffers" data-type="indexterm" id="12_ix_ch10-asciidoc10"></a>NIO buffers are a low-level abstraction for high-performance I/O.
They provide a container for a linear sequence of elements of a
specific primitive type. We鈥檒l work with the <code>ByteBuffer</code> (the most
common case) in our examples.</p>








<section data-pdf-bookmark="ByteBuffer" data-type="sect2"><div class="sect2" id="idm45941106198088">
<h2>ByteBuffer</h2>

<p><a data-primary="buffers, NIO" data-secondary="ByteBuffer" data-type="indexterm" id="12_ix_ch10-asciidoc11"></a><a data-primary="ByteBuffer class" data-type="indexterm" id="12_ix_ch10-asciidoc12"></a><a data-primary="channels" data-secondary="ByteBuffer" data-type="indexterm" id="12_ix_ch10-asciidoc13"></a><a data-primary="I/O (input/output)" data-secondary="ByteBuffer" data-type="indexterm" id="12_ix_ch10-asciidoc14"></a><a data-primary="NIO channels and buffers" data-secondary="ByteBuffer" data-type="indexterm" id="12_ix_ch10-asciidoc15"></a>This is a sequence of bytes, and can conceptually be thought of as a
performance-critical alternative to working with a <code>byte[]</code>. To get
the best possible performance, <code>ByteBuffer</code> provides support for dealing
directly with the native capabilities of the platform the JVM is running
on.</p>

<p><a data-primary="direct buffers" data-type="indexterm" id="12_idm45941106189144"></a>This approach is called the <em>direct buffers</em> case, and it bypasses the
Java heap wherever possible. Direct buffers are allocated in native
memory, not on the standard Java heap, and they are not subject to
garbage collection in the same way as regular on-heap Java objects.</p>

<p><a data-primary="allocateDirect()" data-type="indexterm" id="12_idm45941106187400"></a>To obtain a direct <code>ByteBuffer</code>, call the <code>allocateDirect()</code> factory
method. An on-heap version, <code>allocate()</code>, is also provided, but in
practice this is not often used.</p>

<p><a data-primary="byte[]" data-type="indexterm" id="12_idm45941106184952"></a>A third way to obtain a byte buffer is to wrap an existing <code>byte[]</code>鈥攖his
will give an on-heap buffer that serves to provide a more
object-oriented view of the underlying bytes:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">ByteBuffer</code> <code class="n">b</code> <code class="o">=</code> <code class="n">ByteBuffer</code><code class="o">.</code><code class="na">allocateDirect</code><code class="o">(</code><code class="mi">65536</code><code class="o">);</code>
<code class="n">ByteBuffer</code> <code class="n">b2</code> <code class="o">=</code> <code class="n">ByteBuffer</code><code class="o">.</code><code class="na">allocate</code><code class="o">(</code><code class="mi">4096</code><code class="o">);</code>

<code class="kt">byte</code><code class="o">[]</code> <code class="n">data</code> <code class="o">=</code> <code class="o">{</code><code class="mi">1</code><code class="o">,</code> <code class="mi">2</code><code class="o">,</code> <code class="mi">3</code><code class="o">};</code>
<code class="n">ByteBuffer</code> <code class="n">b3</code> <code class="o">=</code> <code class="n">ByteBuffer</code><code class="o">.</code><code class="na">wrap</code><code class="o">(</code><code class="n">data</code><code class="o">);</code></pre>

<p>Byte buffers are all about low-level access to the bytes. This means
that developers have to deal with the details manually鈥攊ncluding the
need to handle the endianness of the bytes and the signed nature of
Java鈥檚 integral primitives:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">b</code><code class="o">.</code><code class="na">order</code><code class="o">(</code><code class="n">ByteOrder</code><code class="o">.</code><code class="na">BIG_ENDIAN</code><code class="o">);</code>

<code class="kt">int</code> <code class="n">capacity</code> <code class="o">=</code> <code class="n">b</code><code class="o">.</code><code class="na">capacity</code><code class="o">();</code>
<code class="kt">int</code> <code class="n">position</code> <code class="o">=</code> <code class="n">b</code><code class="o">.</code><code class="na">position</code><code class="o">();</code>
<code class="kt">int</code> <code class="n">limit</code> <code class="o">=</code> <code class="n">b</code><code class="o">.</code><code class="na">limit</code><code class="o">();</code>
<code class="kt">int</code> <code class="n">remaining</code> <code class="o">=</code> <code class="n">b</code><code class="o">.</code><code class="na">remaining</code><code class="o">();</code>
<code class="kt">boolean</code> <code class="n">more</code> <code class="o">=</code> <code class="n">b</code><code class="o">.</code><code class="na">hasRemaining</code><code class="o">();</code></pre>

<p>To get data in or out of a buffer, we have two types of
operation鈥攕ingle value, which reads or writes a single value, and bulk,
which takes a <code>byte[]</code> or <code>ByteBuffer</code> and operates on a (potentially
large) number of values as a single operation. It is from the bulk
operations that we鈥檇 expect to realize performance gains:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">b</code><code class="o">.</code><code class="na">put</code><code class="o">((</code><code class="kt">byte</code><code class="o">)</code><code class="mi">42</code><code class="o">);</code>
<code class="n">b</code><code class="o">.</code><code class="na">putChar</code><code class="o">(</code><code class="sc">x</code><code class="o">);</code>
<code class="n">b</code><code class="o">.</code><code class="na">putInt</code><code class="o">(</code><code class="mh">0xcafebabe</code><code class="o">);</code>

<code class="n">b</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="n">data</code><code class="o">);</code>
<code class="n">b</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="n">b2</code><code class="o">);</code>

<code class="kt">double</code> <code class="n">d</code> <code class="o">=</code> <code class="n">b</code><code class="o">.</code><code class="na">getDouble</code><code class="o">();</code>
<code class="n">b</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="n">data</code><code class="o">,</code> <code class="mi">0</code><code class="o">,</code> <code class="n">data</code><code class="o">.</code><code class="na">length</code><code class="o">);</code></pre>

<p>The single value form also supports a form used for absolute positioning
within the buffer:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">b</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="mi">0</code><code class="o">,</code> <code class="o">(</code><code class="kt">byte</code><code class="o">)</code><code class="mi">9</code><code class="o">);</code></pre>

<p>Buffers are an in-memory abstraction. To affect the outside world (e.g.,
the file or network), we need to use a <code>Channel</code>, from the package
<code>java.nio.channels</code>. Channels represent connections to entities that
can support read or write operations. Files and sockets are the usual
examples of channels, but we could consider custom implementations used
for low-latency data processing.</p>

<p>Channels are open when they鈥檙e created, and can subsequently be closed.
Once closed, they cannot be reopened. Channels are usually either
readable or writable, but not both. The key to understanding channels is
that:</p>

<ul>
<li>
<p>Reading from a channel puts bytes into a buffer</p>
</li>
<li>
<p>Writing to a channel takes bytes from a buffer</p>
</li>
</ul>

<p>For example, suppose we have a large file that we want to checksum in
16M chunks:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">FileInputStream</code> <code class="n">fis</code> <code class="o">=</code> <code class="n">getSomeStream</code><code class="o">();</code>
<code class="kt">boolean</code> <code class="n">fileOK</code> <code class="o">=</code> <code class="kc">true</code><code class="o">;</code>

<code class="k">try</code> <code class="o">(</code><code class="n">FileChannel</code> <code class="n">fchan</code> <code class="o">=</code> <code class="n">fis</code><code class="o">.</code><code class="na">getChannel</code><code class="o">())</code> <code class="o">{</code>
  <code class="n">ByteBuffer</code> <code class="n">buffy</code> <code class="o">=</code> <code class="n">ByteBuffer</code><code class="o">.</code><code class="na">allocateDirect</code><code class="o">(</code><code class="mi">16</code> <code class="o">*</code> <code class="mi">1024</code> <code class="o">*</code> <code class="mi">1024</code><code class="o">);</code>
  <code class="k">while</code><code class="o">(</code><code class="n">fchan</code><code class="o">.</code><code class="na">read</code><code class="o">(</code><code class="n">buffy</code><code class="o">)</code> <code class="o">!=</code> <code class="o">-</code><code class="mi">1</code> <code class="o">||</code> <code class="n">buffy</code><code class="o">.</code><code class="na">position</code><code class="o">()</code> <code class="o">&gt;</code> <code class="mi">0</code> <code class="o">||</code> <code class="n">fileOK</code><code class="o">)</code> <code class="o">{</code>
    <code class="n">fileOK</code> <code class="o">=</code> <code class="n">computeChecksum</code><code class="o">(</code><code class="n">buffy</code><code class="o">);</code>
    <code class="n">buffy</code><code class="o">.</code><code class="na">compact</code><code class="o">();</code>
  <code class="o">}</code>
<code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">IOException</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>
  <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Exception in I/O</code><code class="o">);</code>
<code class="o">}</code></pre>

<p>This will use native I/O as far as possible, and will avoid a lot of
copying of bytes on and off the Java heap. If the <code>computeChecksum()</code>
method has been well implemented, then this could be a very performant
implementation.<a data-startref="ix_ch10-asciidoc15" data-type="indexterm" id="12_idm45941105966072"></a><a data-startref="ix_ch10-asciidoc14" data-type="indexterm" id="12_idm45941105797336"></a><a data-startref="ix_ch10-asciidoc13" data-type="indexterm" id="12_idm45941105796696"></a><a data-startref="ix_ch10-asciidoc12" data-type="indexterm" id="12_idm45941105796024"></a><a data-startref="ix_ch10-asciidoc11" data-type="indexterm" id="12_idm45941105795352"></a></p>
</div></section>













<section data-pdf-bookmark="Mapped Byte Buffers" data-type="sect2"><div class="sect2" id="idm45941106197464">
<h2>Mapped Byte Buffers</h2>

<p><a data-primary="buffers, NIO" data-secondary="MappedByteBuffer" data-type="indexterm" id="12_idm45941105793512"></a><a data-primary="channels" data-secondary="MappedByteBuffer" data-type="indexterm" id="12_idm45941105792344"></a><a data-primary="I/O (input/output)" data-secondary="MappedByteBuffer" data-type="indexterm" id="12_idm45941105791400"></a><a data-primary="MappedByteBuffer" data-type="indexterm" id="12_idm45941105790456"></a><a data-primary="NIO channels and buffers" data-secondary="MappedByteBuffer" data-type="indexterm" id="12_idm45941105789784"></a>These are a type of direct byte buffer that contain a memory-mapped
file (or a region of one). <a data-primary="FileChannel class" data-type="indexterm" id="12_idm45941105788632"></a>They are created from a <code>FileChannel</code>
object, but note that the <code>File</code> object corresponding to the
<code>MappedByteBuffer</code> must not be used after the memory-mapped operations,
or an exception will be thrown. To mitigate this, we again use
<code>try</code>-with-resources, to scope the objects tightly:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">try</code> <code class="o">(</code><code class="n">RandomAccessFile</code> <code class="n">raf</code> <code class="o">=</code>
  <code class="k">new</code> <code class="nf">RandomAccessFile</code><code class="o">(</code><code class="k">new</code> <code class="n">File</code><code class="o">(</code><code class="s">input.txt</code><code class="o">),</code> <code class="s">rw</code><code class="o">);</code>
     <code class="n">FileChannel</code> <code class="n">fc</code> <code class="o">=</code> <code class="n">raf</code><code class="o">.</code><code class="na">getChannel</code><code class="o">();)</code> <code class="o">{</code>

  <code class="n">MappedByteBuffer</code> <code class="n">mbf</code> <code class="o">=</code>
    <code class="n">fc</code><code class="o">.</code><code class="na">map</code><code class="o">(</code><code class="n">FileChannel</code><code class="o">.</code><code class="na">MapMode</code><code class="o">.</code><code class="na">READ_WRITE</code><code class="o">,</code> <code class="mi">0</code><code class="o">,</code> <code class="n">fc</code><code class="o">.</code><code class="na">size</code><code class="o">());</code>
  <code class="kt">byte</code><code class="o">[]</code> <code class="n">b</code> <code class="o">=</code> <code class="k">new</code> <code class="kt">byte</code><code class="o">[(</code><code class="kt">int</code><code class="o">)</code><code class="n">fc</code><code class="o">.</code><code class="na">size</code><code class="o">()];</code>
  <code class="n">mbf</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="n">b</code><code class="o">,</code> <code class="mi">0</code><code class="o">,</code> <code class="n">b</code><code class="o">.</code><code class="na">length</code><code class="o">);</code>
  <code class="k">for</code> <code class="o">(</code><code class="kt">int</code> <code class="n">i</code><code class="o">=</code><code class="mi">0</code><code class="o">;</code> <code class="n">i</code><code class="o">&lt;</code><code class="n">fc</code><code class="o">.</code><code class="na">size</code><code class="o">();</code> <code class="n">i</code><code class="o">++)</code> <code class="o">{</code>
    <code class="n">b</code><code class="o">[</code><code class="n">i</code><code class="o">]</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code> <code class="c1">// Won&apos;t be written back to the file, we&apos;re a copy</code>
  <code class="o">}</code>
  <code class="n">mbf</code><code class="o">.</code><code class="na">position</code><code class="o">(</code><code class="mi">0</code><code class="o">);</code>
  <code class="n">mbf</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="n">b</code><code class="o">);</code> <code class="c1">// Zeros the file</code>
<code class="o">}</code></pre>

<p>Even with buffers, there are limitations of what can be done in Java for
large I/O operations (e.g., transferring 10G between filesystems) that
perform synchronously on a single thread. Before Java 7, these types of
operations would typically be done by writing custom multithreaded code,
and managing a separate thread for performing a background copy. Let鈥檚
move on to look at the new asynchronous I/O features that were added
with JDK 7.<a data-startref="ix_ch10-asciidoc10" data-type="indexterm" id="12_idm45941105783304"></a><a data-startref="ix_ch10-asciidoc9" data-type="indexterm" id="12_idm45941105676712"></a><a data-startref="ix_ch10-asciidoc8" data-type="indexterm" id="12_idm45941105676104"></a><a data-startref="ix_ch10-asciidoc7" data-type="indexterm" id="12_idm45941105675432"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Async I/O" data-type="sect1"><div class="sect1" id="idm45941105674376">
<h1>Async I/O</h1>

<p><a data-primary="Async I/O" data-type="indexterm" id="12_ix_ch10-asciidoc16"></a><a data-primary="I/O (input/output)" data-secondary="Async I/O" data-type="indexterm" id="12_ix_ch10-asciidoc17"></a>The key to the new asynchronous functionality are some new subclasses
of <span class="keep-together"><code>Channel</code></span> that can deal with I/O operations that need to be handed
off to a background thread. The same functionality can be applied to
large, long-running operations, and to several other use cases.</p>

<p>In this section, we鈥檒l deal exclusively with <code>AsynchronousFileChannel</code>
for file I/O, but there are a couple of other asynchronous channels to
be aware of. We鈥檒l deal with asynchronous sockets at the end of the
chapter. We鈥檒l look at:</p>

<ul>
<li>
<p><code>AsynchronousFileChannel</code> for file I/O</p>
</li>
<li>
<p><code>AsynchronousSocketChannel</code> for client socket I/O</p>
</li>
<li>
<p><code>AsynchronousServerSocketChannel</code> for asynchronous sockets that
accept incoming connections</p>
</li>
</ul>

<p>There are two different ways to interact with an asynchronous
channel鈥?code&gt;Future</code> style and callback style.</p>








<section data-pdf-bookmark="Future-Based Style" data-type="sect2"><div class="sect2" id="idm45941105663784">
<h2>Future-Based Style</h2>

<p><a data-primary="Async I/O" data-secondary="future-based style" data-type="indexterm" id="12_idm45941105662344"></a><a data-primary="future-based style, for async I/O" data-type="indexterm" id="12_idm45941105661368"></a>A full discussion of the <code>Future</code> interface would take us too far into the details of Java concurrency.
However, for the purpose of this chapter, it can be thought of as an ongoing task that may or may not have completed yet. It has two key methods:</p>
<dl>
<dt><code>isDone()</code></dt>
<dd>
<p><a data-primary="isDone()" data-type="indexterm" id="12_idm45941105658472"></a>Returns a Boolean indicating whether the task has finished.</p>
</dd>
<dt><code>get()</code></dt>
<dd>
<p><a data-primary="get()" data-type="indexterm" id="12_idm45941105656360"></a>Returns the result. If finished, returns immediately. If not
finished, blocks until done.</p>
</dd>
</dl>

<p>Let鈥檚 look at an example of a program that reads a large file (possibly
as large as 100 Mb) asynchronously:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">try</code> <code class="o">(</code><code class="n">AsynchronousFileChannel</code> <code class="n">channel</code> <code class="o">=</code>
         <code class="n">AsynchronousFileChannel</code><code class="o">.</code><code class="na">open</code><code class="o">(</code><code class="n">Paths</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">input.txt</code><code class="o">)))</code> <code class="o">{</code>
  <code class="n">ByteBuffer</code> <code class="n">buffer</code> <code class="o">=</code> <code class="n">ByteBuffer</code><code class="o">.</code><code class="na">allocateDirect</code><code class="o">(</code><code class="mi">1024</code> <code class="o">*</code> <code class="mi">1024</code> <code class="o">*</code> <code class="mi">100</code><code class="o">);</code>
  <code class="n">Future</code><code class="o">&lt;</code><code class="n">Integer</code><code class="o">&gt;</code> <code class="n">result</code> <code class="o">=</code> <code class="n">channel</code><code class="o">.</code><code class="na">read</code><code class="o">(</code><code class="n">buffer</code><code class="o">,</code> <code class="mi">0</code><code class="o">);</code>

  <code class="k">while</code><code class="o">(!</code><code class="n">result</code><code class="o">.</code><code class="na">isDone</code><code class="o">())</code> <code class="o">{</code>
    <code class="c1">// Do some other useful work....</code>
  <code class="o">}</code>

  <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Bytes read: </code> <code class="o">+</code> <code class="n">result</code><code class="o">.</code><code class="na">get</code><code class="o">());</code>
<code class="o">}</code></pre>
</div></section>













<section data-pdf-bookmark="Callback-Based Style" data-type="sect2"><div class="sect2" id="idm45941105653352">
<h2>Callback-Based Style</h2>

<p><a data-primary="Async I/O" data-secondary="callback-based style" data-type="indexterm" id="12_idm45941105508408"></a><a data-primary="callback-based style, for async I/O" data-type="indexterm" id="12_idm45941105507432"></a><a data-primary="CompletionHandler interface" data-type="indexterm" id="12_idm45941105506792"></a>The callback style for asynchronous I/O is based on a
<code>CompletionHandler</code>, which defines two methods, <code>completed()</code> and
<code>failed()</code>, that will be called back when the operation either succeeds
or fails.</p>

<p>This style is useful if you want immediate notification of events in
asynchronous I/O鈥攆or example, if there are a large number of I/O
operations in flight, but failure of any single operation is not
necessarily fatal:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kt">byte</code><code class="o">[]</code> <code class="n">data</code> <code class="o">=</code> <code class="o">{</code><code class="mi">2</code><code class="o">,</code> <code class="mi">3</code><code class="o">,</code> <code class="mi">5</code><code class="o">,</code> <code class="mi">7</code><code class="o">,</code> <code class="mi">11</code><code class="o">,</code> <code class="mi">13</code><code class="o">,</code> <code class="mi">17</code><code class="o">,</code> <code class="mi">19</code><code class="o">,</code> <code class="mi">23</code><code class="o">};</code>
<code class="n">ByteBuffer</code> <code class="n">buffy</code> <code class="o">=</code> <code class="n">ByteBuffer</code><code class="o">.</code><code class="na">wrap</code><code class="o">(</code><code class="n">data</code><code class="o">);</code>

<code class="n">CompletionHandler</code><code class="o">&lt;</code><code class="n">Integer</code><code class="o">,</code><code class="n">Object</code><code class="o">&gt;</code> <code class="n">h</code> <code class="o">=</code>
  <code class="k">new</code> <code class="nf">CompletionHandler</code><code class="o">()</code> <code class="o">{</code>
  <code class="kd">public</code> <code class="kt">void</code> <code class="nf">completed</code><code class="o">(</code><code class="n">Integer</code> <code class="n">written</code><code class="o">,</code> <code class="n">Object</code> <code class="n">o</code><code class="o">)</code> <code class="o">{</code>
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Bytes written: </code> <code class="o">+</code> <code class="n">written</code><code class="o">);</code>
  <code class="o">}</code>

  <code class="kd">public</code> <code class="kt">void</code> <code class="nf">failed</code><code class="o">(</code><code class="n">Throwable</code> <code class="n">x</code><code class="o">,</code> <code class="n">Object</code> <code class="n">o</code><code class="o">)</code> <code class="o">{</code>
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Asynch write failed: </code><code class="o">+</code> <code class="n">x</code><code class="o">.</code><code class="na">getMessage</code><code class="o">());</code>
  <code class="o">}</code>
<code class="o">};</code>

<code class="k">try</code> <code class="o">(</code><code class="n">AsynchronousFileChannel</code> <code class="n">channel</code> <code class="o">=</code>
       <code class="n">AsynchronousFileChannel</code><code class="o">.</code><code class="na">open</code><code class="o">(</code><code class="n">Paths</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">primes.txt</code><code class="o">),</code>
          <code class="n">StandardOpenOption</code><code class="o">.</code><code class="na">CREATE</code><code class="o">,</code> <code class="n">StandardOpenOption</code><code class="o">.</code><code class="na">WRITE</code><code class="o">))</code> <code class="o">{</code>

  <code class="n">channel</code><code class="o">.</code><code class="na">write</code><code class="o">(</code><code class="n">buffy</code><code class="o">,</code> <code class="mi">0</code><code class="o">,</code> <code class="kc">null</code><code class="o">,</code> <code class="n">h</code><code class="o">);</code>
  <code class="n">Thread</code><code class="o">.</code><code class="na">sleep</code><code class="o">(</code><code class="mi">1000</code><code class="o">);</code> <code class="c1">// Needed so we don&apos;t exit too quickly</code>
<code class="o">}</code></pre>

<p>The <code>AsynchronousFileChannel</code> object is associated with a background
thread pool, so that the I/O operation proceeds, while the original
thread can get on with other tasks.</p>

<p>By default, this uses a managed thread pool that is provided by the
runtime. If required, it can be created to use a thread pool that is
managed by the application (via an overloaded form of
<code>AsynchronousFileChannel.open()</code>), but this is not often necessary.</p>

<p>Finally, for completeness, let鈥檚 touch upon NIO鈥檚 support for
multiplexed I/O. This enables a single thread to manage multiple
channels and to examine those channels to see which are ready for
reading or writing. <a data-primary="java.nio.channels package" data-type="indexterm" id="12_idm45941105499752"></a>The classes to support this are in the
<code>java.nio.channels</code> package and include <code>SelectableChannel</code> and
<code>Selector</code>.</p>

<p>These nonblocking multiplexed techniques can be extremely useful when you鈥檙e writing advanced applications that require high scalability, but a full discussion is outside the scope of this book.
In general, the nonblocking API should only be used for advanced use cases when high performance or other NFRs are genuinely required.</p>
</div></section>













<section data-pdf-bookmark="Watch Services and Directory Searching" data-type="sect2"><div class="sect2" id="idm45941105333048">
<h2>Watch Services and Directory Searching</h2>

<p><a data-primary="Async I/O" data-secondary="watch services and directory searching" data-type="indexterm" id="12_idm45941105331640"></a><a data-primary="watch services" data-type="indexterm" id="12_idm45941105330648"></a>The last class of asynchronous services we will consider are those
that watch a directory or visit a directory (or a tree). The watch
services operate by observing everything that happens within a
directory鈥攆or example, the creation or modification of files:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">try</code> <code class="o">{</code>
  <code class="n">WatchService</code> <code class="n">watcher</code> <code class="o">=</code> <code class="n">FileSystems</code><code class="o">.</code><code class="na">getDefault</code><code class="o">().</code><code class="na">newWatchService</code><code class="o">();</code>

  <code class="n">Path</code> <code class="n">dir</code> <code class="o">=</code> <code class="n">FileSystems</code><code class="o">.</code><code class="na">getDefault</code><code class="o">().</code><code class="na">getPath</code><code class="o">(</code><code class="s">/home/ben</code><code class="o">);</code>
  <code class="n">WatchKey</code> <code class="n">key</code> <code class="o">=</code> <code class="n">dir</code><code class="o">.</code><code class="na">register</code><code class="o">(</code><code class="n">watcher</code><code class="o">,</code>
                        <code class="n">StandardWatchEventKinds</code><code class="o">.</code><code class="na">ENTRY_CREATE</code><code class="o">,</code>
                        <code class="n">StandardWatchEventKinds</code><code class="o">.</code><code class="na">ENTRY_MODIFY</code><code class="o">,</code>
                        <code class="n">StandardWatchEventKinds</code><code class="o">.</code><code class="na">ENTRY_DELETE</code><code class="o">);</code>

  <code class="k">while</code><code class="o">(!</code><code class="n">shutdown</code><code class="o">)</code> <code class="o">{</code>
    <code class="n">key</code> <code class="o">=</code> <code class="n">watcher</code><code class="o">.</code><code class="na">take</code><code class="o">();</code>
    <code class="k">for</code> <code class="o">(</code><code class="n">WatchEvent</code><code class="o">&lt;?&gt;</code> <code class="nl">event:</code> <code class="n">key</code><code class="o">.</code><code class="na">pollEvents</code><code class="o">())</code> <code class="o">{</code>
      <code class="n">Object</code> <code class="n">o</code> <code class="o">=</code> <code class="n">event</code><code class="o">.</code><code class="na">context</code><code class="o">();</code>
      <code class="k">if</code> <code class="o">(</code><code class="n">o</code> <code class="k">instanceof</code> <code class="n">Path</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Path altered: </code><code class="o">+</code> <code class="n">o</code><code class="o">);</code>
      <code class="o">}</code>
    <code class="o">}</code>
    <code class="n">key</code><code class="o">.</code><code class="na">reset</code><code class="o">();</code>
  <code class="o">}</code>
<code class="o">}</code></pre>

<p><a data-primary="directory streams, Async I/O" data-type="indexterm" id="12_idm45941105326936"></a><a data-primary="search" data-secondary="Async I/O directory streams" data-type="indexterm" id="12_idm45941105326280"></a>By contrast, the directory streams provide a view into all files
currently in a single directory. For example, to list all the Java
source files and their size in bytes, we can use code like:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">try</code><code class="o">(</code><code class="n">DirectoryStream</code><code class="o">&lt;</code><code class="n">Path</code><code class="o">&gt;</code> <code class="n">stream</code> <code class="o">=</code>
    <code class="n">Files</code><code class="o">.</code><code class="na">newDirectoryStream</code><code class="o">(</code><code class="n">Paths</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">/opt/projects</code><code class="o">),</code> <code class="s">*.java</code><code class="o">))</code> <code class="o">{</code>
  <code class="k">for</code> <code class="o">(</code><code class="n">Path</code> <code class="n">p</code> <code class="o">:</code> <code class="n">stream</code><code class="o">)</code> <code class="o">{</code>
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">p</code> <code class="o">+</code><code class="s">: </code><code class="o">+</code> <code class="n">Files</code><code class="o">.</code><code class="na">size</code><code class="o">(</code><code class="n">p</code><code class="o">));</code>
  <code class="o">}</code>
<code class="o">}</code></pre>

<p>One drawback of this API is that this will only return elements that
match according to glob syntax, which is sometimes insufficiently
flexible. We can go further by using the new <code>Files.find()</code> and
<code>Files.walk()</code> methods to address each element obtained by a recursive
walk through the directory:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">final</code> <code class="n">Pattern</code> <code class="n">isJava</code> <code class="o">=</code> <code class="n">Pattern</code><code class="o">.</code><code class="na">compile</code><code class="o">(</code><code class="s">.*\\.java$</code><code class="o">);</code>
<code class="kd">final</code> <code class="n">Path</code> <code class="n">homeDir</code> <code class="o">=</code> <code class="n">Paths</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">/Users/ben/projects/</code><code class="o">);</code>
<code class="n">Files</code><code class="o">.</code><code class="na">find</code><code class="o">(</code><code class="n">homeDir</code><code class="o">,</code> <code class="mi">255</code><code class="o">,</code>
  <code class="o">(</code><code class="n">p</code><code class="o">,</code> <code class="n">attrs</code><code class="o">)</code> <code class="o">-&gt;</code> <code class="n">isJava</code><code class="o">.</code><code class="na">matcher</code><code class="o">(</code><code class="n">p</code><code class="o">.</code><code class="na">toString</code><code class="o">()).</code><code class="na">find</code><code class="o">())</code>
     <code class="o">.</code><code class="na">forEach</code><code class="o">(</code><code class="n">q</code> <code class="o">-&gt;</code> <code class="o">{</code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">q</code><code class="o">.</code><code class="na">normalize</code><code class="o">());});</code></pre>

<p><a data-primary="FileVisitor interface" data-type="indexterm" id="12_idm45941105103976"></a><a data-primary="java.nio.file package" data-type="indexterm" id="12_idm45941104995032"></a>It is possible to go even further, and construct advanced solutions
based on the <code>FileVisitor</code> interface in <code>java.nio.file</code>, but that
requires the developer to implement all four methods on the interface,
rather than just using a single lambda expression as done here.</p>

<p>In the last section of this chapter, we will discuss Java鈥檚 networking
support and the core JDK classes that enable it.<a data-startref="ix_ch10-asciidoc17" data-type="indexterm" id="12_idm45941104992744"></a><a data-startref="ix_ch10-asciidoc16" data-type="indexterm" id="12_idm45941104992040"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Networking" data-type="sect1"><div class="sect1" id="idm45941104991240">
<h1>Networking</h1>

<p><a data-primary="I/O (input/output)" data-secondary="networking" data-type="indexterm" id="12_ix_ch10-asciidoc18"></a>The Java platform provides access to a large number of standard networking protocols, and these make writing simple networked applications quite easy.
<a data-primary="java.net package" data-type="indexterm" id="12_idm45941104988072"></a><a data-primary="javax.net package" data-type="indexterm" id="12_idm45941104987400"></a>The core of Java鈥檚 network support lives in the package <code>java.net</code>, with additional extensibility provided by <code>javax.net</code> (and in particular, <code>javax.net.ssl</code>).</p>

<p>One of the easiest protocols to use for building applications is
HyperText Transmission Protocol (HTTP), the protocol that is used as the
basic communication protocol of the Web.</p>








<section data-pdf-bookmark="HTTP" data-type="sect2"><div class="sect2" id="idm45941104984712">
<h2>HTTP</h2>

<p><a data-primary="HTTP" data-type="indexterm" id="12_ix_ch10-asciidoc19"></a><a data-primary="I/O (input/output)" data-secondary="HTTP" data-type="indexterm" id="12_ix_ch10-asciidoc20"></a><a data-primary="networking" data-secondary="HTTP" data-type="indexterm" id="12_ix_ch10-asciidoc21"></a>HTTP is the highest-level network protocol that Java supports out of
the box. It is a very simple, text-based protocol, implemented on top of
the standard TCP/IP stack. It can run on any network port, but is
usually found on port 80.</p>

<p>Java has two separate APIs for handling HTTP鈥攐ne of which dates back to the earliest days of the platform, and the other of which is a more modern API that arrived in incubator form in Java 9.</p>

<p>Let鈥檚 take a quick look at the older API, for the sake of completeness.
In this API <code>URL</code> is the key class鈥攊t supports URLs of the form <code>http://</code>,
<code>ftp://</code>, <code>file://</code>, and <code>https://</code> out of the box. It is very easy to
use, and the simplest example of Java HTTP support is to download a
particular URL. With Java 8, this is just:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">URL</code> <code class="n">url</code> <code class="o">=</code> <code class="k">new</code> <code class="n">URL</code><code class="o">(</code><code class="s">http://www.google.com/</code><code class="o">);</code>
<code class="k">try</code> <code class="o">(</code><code class="n">InputStream</code> <code class="n">in</code> <code class="o">=</code> <code class="n">url</code><code class="o">.</code><code class="na">openStream</code><code class="o">())</code> <code class="o">{</code>
  <code class="n">Files</code><code class="o">.</code><code class="na">copy</code><code class="o">(</code><code class="n">in</code><code class="o">,</code> <code class="n">Paths</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">output.txt</code><code class="o">));</code>
<code class="o">}</code> <code class="k">catch</code><code class="o">(</code><code class="n">IOException</code> <code class="n">ex</code><code class="o">)</code> <code class="o">{</code>
  <code class="n">ex</code><code class="o">.</code><code class="na">printStackTrace</code><code class="o">();</code>
<code class="o">}</code></pre>

<p>For more low-level control, including metadata about the request and
response, we can use <code>URLConnection</code> to give us more control, and
achieve something like:</p>

<pre data-code-language="java" data-type="programlisting"><code class="k">try</code> <code class="o">{</code>
  <code class="n">URLConnection</code> <code class="n">conn</code> <code class="o">=</code> <code class="n">url</code><code class="o">.</code><code class="na">openConnection</code><code class="o">();</code>

  <code class="n">String</code> <code class="n">type</code> <code class="o">=</code> <code class="n">conn</code><code class="o">.</code><code class="na">getContentType</code><code class="o">();</code>
  <code class="n">String</code> <code class="n">encoding</code> <code class="o">=</code> <code class="n">conn</code><code class="o">.</code><code class="na">getContentEncoding</code><code class="o">();</code>
  <code class="n">Date</code> <code class="n">lastModified</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Date</code><code class="o">(</code><code class="n">conn</code><code class="o">.</code><code class="na">getLastModified</code><code class="o">());</code>
  <code class="kt">int</code> <code class="n">len</code> <code class="o">=</code> <code class="n">conn</code><code class="o">.</code><code class="na">getContentLength</code><code class="o">();</code>
  <code class="n">InputStream</code> <code class="n">in</code> <code class="o">=</code> <code class="n">conn</code><code class="o">.</code><code class="na">getInputStream</code><code class="o">();</code>
<code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">IOException</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>
  <code class="c1">// Handle exception</code>
<code class="o">}</code></pre>

<p><a data-primary="DELETE method (HTTP)" data-type="indexterm" id="12_idm45941104890136"></a><a data-primary="GET method (HTTP)" data-type="indexterm" id="12_idm45941104889528"></a><a data-primary="HEAD method (HTTP)" data-type="indexterm" id="12_idm45941104809064"></a><a data-primary="OPTIONS method (HTTP)" data-type="indexterm" id="12_idm45941104808392"></a><a data-primary="POST method (HTTP)" data-type="indexterm" id="12_idm45941104807720"></a><a data-primary="PUT method (HTTP)" data-type="indexterm" id="12_idm45941104807048"></a><a data-primary="request methods (HTTP)" data-type="indexterm" id="12_idm45941104806376"></a><a data-primary="TRACE method (HTTP)" data-type="indexterm" id="12_idm45941104805704"></a>HTTP defines 鈥渞equest methods,鈥?which are the operations that a client
can make on a remote resource. These methods are called GET, POST, HEAD, PUT, DELETE, OPTIONS, and TRACE.</p>

<p>Each has slightly different usages, for example:</p>

<ul>
<li>
<p>GET should only be used to retrieve a document and <em>never</em> should
perform any side effects.</p>
</li>
<li>
<p>HEAD is equivalent to GET except the body is not returned鈥攗seful if a
program wants to quickly check whether a URL has changed.</p>
</li>
<li>
<p>POST is used when we want to send data to a server for processing.</p>
</li>
</ul>

<p>By default, Java always uses GET, but it does provide a way to use other
methods for building more complex applications; however, doing so is a
bit involved. In this next example, we鈥檙e using the search function
provided by the BBC website to search for news articles about Java:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">var</code> <code class="n">url</code> <code class="o">=</code> <code class="k">new</code> <code class="n">URL</code><code class="o">(</code><code class="s">http://www.bbc.co.uk/search</code><code class="o">);</code>
<code class="n">var</code> <code class="n">encodedData</code> <code class="o">=</code> <code class="n">URLEncoder</code><code class="o">.</code><code class="na">encode</code><code class="o">(</code><code class="s">q=java</code><code class="o">,</code> <code class="s">ASCII</code><code class="o">);</code>
<code class="n">var</code> <code class="n">contentType</code> <code class="o">=</code> <code class="s">application/x-www-form-urlencoded</code><code class="o">;</code>

<code class="n">HttpURLConnection</code> <code class="n">conn</code> <code class="o">=</code> <code class="o">(</code><code class="n">HttpURLConnection</code><code class="o">)</code> <code class="n">url</code><code class="o">.</code><code class="na">openConnection</code><code class="o">();</code>
<code class="n">conn</code><code class="o">.</code><code class="na">setInstanceFollowRedirects</code><code class="o">(</code><code class="kc">false</code><code class="o">);</code>
<code class="n">conn</code><code class="o">.</code><code class="na">setRequestMethod</code><code class="o">(</code><code class="s">POST</code><code class="o">);</code>
<code class="n">conn</code><code class="o">.</code><code class="na">setRequestProperty</code><code class="o">(</code><code class="s">Content-Type</code><code class="o">,</code> <code class="n">contentType</code> <code class="o">);</code>
<code class="n">conn</code><code class="o">.</code><code class="na">setRequestProperty</code><code class="o">(</code><code class="s">Content-Length</code><code class="o">,</code>
  <code class="n">String</code><code class="o">.</code><code class="na">valueOf</code><code class="o">(</code><code class="n">encodedData</code><code class="o">.</code><code class="na">length</code><code class="o">()));</code>

<code class="n">conn</code><code class="o">.</code><code class="na">setDoOutput</code><code class="o">(</code><code class="kc">true</code><code class="o">);</code>
<code class="n">OutputStream</code> <code class="n">os</code> <code class="o">=</code> <code class="n">conn</code><code class="o">.</code><code class="na">getOutputStream</code><code class="o">();</code>
<code class="n">os</code><code class="o">.</code><code class="na">write</code><code class="o">(</code> <code class="n">encodedData</code><code class="o">.</code><code class="na">getBytes</code><code class="o">()</code> <code class="o">);</code>

<code class="kt">int</code> <code class="n">response</code> <code class="o">=</code> <code class="n">conn</code><code class="o">.</code><code class="na">getResponseCode</code><code class="o">();</code>
<code class="k">if</code> <code class="o">(</code><code class="n">response</code> <code class="o">==</code> <code class="n">HttpURLConnection</code><code class="o">.</code><code class="na">HTTP_MOVED_PERM</code>
    <code class="o">||</code> <code class="n">response</code> <code class="o">==</code> <code class="n">HttpURLConnection</code><code class="o">.</code><code class="na">HTTP_MOVED_TEMP</code><code class="o">)</code> <code class="o">{</code>
  <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Moved to: </code><code class="o">+</code> <code class="n">conn</code><code class="o">.</code><code class="na">getHeaderField</code><code class="o">(</code><code class="s">Location</code><code class="o">));</code>
<code class="o">}</code> <code class="k">else</code> <code class="o">{</code>
  <code class="k">try</code> <code class="o">(</code><code class="n">InputStream</code> <code class="n">in</code> <code class="o">=</code> <code class="n">conn</code><code class="o">.</code><code class="na">getInputStream</code><code class="o">())</code> <code class="o">{</code>
    <code class="n">Files</code><code class="o">.</code><code class="na">copy</code><code class="o">(</code><code class="n">in</code><code class="o">,</code> <code class="n">Paths</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">bbc.txt</code><code class="o">),</code>
                <code class="n">StandardCopyOption</code><code class="o">.</code><code class="na">REPLACE_EXISTING</code><code class="o">);</code>
  <code class="o">}</code>
<code class="o">}</code></pre>

<p>Notice that we needed to send our query parameters in the body of a
request, and to encode them before sending. We also had to disable
following of HTTP redirects, and to treat any redirection from the
server manually. This is due to a limitation of the <code>HttpURLConnection</code>
class, which does not deal well with redirection of POST requests.</p>

<p>The older API definitely shows its age, and in fact only implements version 1.0 of the HTTP standard, which is very inefficient and considered archaic.
As an alternative, modern Java programs can use the new API, which was added as a result of Java needing to support the new HTTP/2 protocol.</p>

<p>It was added as an incubator module in Java 9, but has been made into a fully supported module, <code>java.net.http</code>, in Java 11.
Let鈥檚 see a simple example of using the new API:</p>

<pre data-code-language="java" data-type="programlisting">        <code class="kn">import</code> <code class="nn">static</code> <code class="n">java</code><code class="o">.</code><code class="na">net</code><code class="o">.</code><code class="na">http</code><code class="o">.</code><code class="na">HttpResponse</code><code class="o">.</code><code class="na">BodyHandlers</code><code class="o">.</code><code class="na">ofString</code><code class="o">;</code>

        <code class="n">var</code> <code class="n">client</code> <code class="o">=</code> <code class="n">HttpClient</code><code class="o">.</code><code class="na">newBuilder</code><code class="o">().</code><code class="na">build</code><code class="o">();</code>
        <code class="n">var</code> <code class="n">uri</code> <code class="o">=</code> <code class="k">new</code> <code class="n">URI</code><code class="o">(</code><code class="s">https://www.oreilly.com</code><code class="o">);</code>
        <code class="n">var</code> <code class="n">request</code> <code class="o">=</code> <code class="n">HttpRequest</code><code class="o">.</code><code class="na">newBuilder</code><code class="o">(</code><code class="n">uri</code><code class="o">).</code><code class="na">build</code><code class="o">();</code>

        <code class="n">var</code> <code class="n">response</code> <code class="o">=</code> <code class="n">client</code><code class="o">.</code><code class="na">send</code><code class="o">(</code><code class="n">request</code><code class="o">,</code>
                <code class="n">ofString</code><code class="o">(</code><code class="n">Charset</code><code class="o">.</code><code class="na">defaultCharset</code><code class="o">()));</code>
        <code class="n">var</code> <code class="n">body</code> <code class="o">=</code> <code class="n">response</code><code class="o">.</code><code class="na">body</code><code class="o">();</code>
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">body</code><code class="o">);</code></pre>

<p>Note that this API is designed to be extensible, with interfaces such as <code>HttpResponse.BodySubscriber</code> being available to be implemented for custom handling.
The interface also seamlessly hides the differences between HTTP/2 and the older HTTP/1.1 protocol, meaning that Java applications will be able to migrate gracefully as web servers adopt the new version.<a data-startref="ix_ch10-asciidoc21" data-type="indexterm" id="12_idm45941104561112"></a><a data-startref="ix_ch10-asciidoc20" data-type="indexterm" id="12_idm45941104357256"></a><a data-startref="ix_ch10-asciidoc19" data-type="indexterm" id="12_idm45941104356648"></a></p>

<p>Let鈥檚 move on to look at the next layer down the networking stack, the
Transmission Control Protocol (TCP).</p>
</div></section>













<section data-pdf-bookmark="TCP" data-type="sect2"><div class="sect2" id="idm45941104984088">
<h2>TCP</h2>

<p><a data-primary="I/O (input/output)" data-secondary="TCP" data-type="indexterm" id="12_ix_ch10-asciidoc22"></a><a data-primary="networking" data-secondary="TCP" data-type="indexterm" id="12_ix_ch10-asciidoc23"></a><a data-primary="TCP" data-type="indexterm" id="12_ix_ch10-asciidoc24"></a>TCP is the basis of reliable network transport over the internet. It
ensures that web pages and other internet traffic are delivered in a
complete and comprehensible state. From a networking theory standpoint,
the protocol properties that allow TCP to function as this 鈥渞eliability
layer鈥?for internet traffic are:</p>
<dl>
<dt>Connection based</dt>
<dd>
<p>Data belongs to a single logical stream (a connection).</p>
</dd>
<dt>Guaranteed delivery</dt>
<dd>
<p>Data packets will be resent until they arrive.</p>
</dd>
<dt>Error checked</dt>
<dd>
<p>Damage caused by network transit will be detected and fixed
automatically.</p>
</dd>
</dl>

<p>TCP is a two-way (or bidirectional) communication channel, and uses a
special numbering scheme (TCP sequence numbers) for data chunks to
ensure that both sides of a communication stream stay in sync. In order
to support many different services on the same network host, TCP uses
port numbers to identify services, and ensures that traffic intended for
one port does not go to a different one.</p>

<p>In Java, TCP is represented by the classes <code>Socket</code> and
<code>ServerSocket</code>. They are used to provide the capability to be the client
and server side of the connection, respectively鈥攎eaning that Java can be
used both to connect to network services and as a language for
implementing new services.</p>

<p>As an example, let鈥檚 consider reimplementing HTTP. This is a relatively
simple, text-based protocol. We鈥檒l need to implement both sides of the
connection, so let鈥檚 start with an HTTP client on top of a TCP socket.
To accomplish this, we will actually need to implement the details of
the HTTP protocol, but we do have the advantage that we have complete
control over the TCP socket.</p>

<p>We will need to both read and write from the client socket, and we鈥檒l
construct the actual request line in accordance with the HTTP standard
(which is known as RFC 2616, and uses explicit line-ending syntax). The resulting code will look something like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">String</code> <code class="n">hostname</code> <code class="o">=</code> <code class="s">www.example.com</code><code class="o">;</code>
<code class="kt">int</code> <code class="n">port</code> <code class="o">=</code> <code class="mi">80</code><code class="o">;</code>
<code class="n">String</code> <code class="n">filename</code> <code class="o">=</code> <code class="s">/index.html</code><code class="o">;</code>

<code class="k">try</code> <code class="o">(</code><code class="n">Socket</code> <code class="n">sock</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Socket</code><code class="o">(</code><code class="n">hostname</code><code class="o">,</code> <code class="n">port</code><code class="o">);</code>
  <code class="n">BufferedReader</code> <code class="n">from</code> <code class="o">=</code> <code class="k">new</code> <code class="n">BufferedReader</code><code class="o">(</code>
      <code class="k">new</code> <code class="nf">InputStreamReader</code><code class="o">(</code><code class="n">sock</code><code class="o">.</code><code class="na">getInputStream</code><code class="o">()));</code>
  <code class="n">PrintWriter</code> <code class="n">to</code> <code class="o">=</code> <code class="k">new</code> <code class="n">PrintWriter</code><code class="o">(</code>
      <code class="k">new</code> <code class="nf">OutputStreamWriter</code><code class="o">(</code><code class="n">sock</code><code class="o">.</code><code class="na">getOutputStream</code><code class="o">()));</code> <code class="o">)</code> <code class="o">{</code>

  <code class="c1">// The HTTP protocol</code>
  <code class="n">to</code><code class="o">.</code><code class="na">print</code><code class="o">(</code><code class="s">GET </code> <code class="o">+</code> <code class="n">filename</code> <code class="o">+</code>
    <code class="s"> HTTP/1.1\r\nHost: </code><code class="o">+</code> <code class="n">hostname</code> <code class="o">+</code><code class="s">\r\n\r\n</code><code class="o">);</code>
  <code class="n">to</code><code class="o">.</code><code class="na">flush</code><code class="o">();</code>

  <code class="k">for</code><code class="o">(</code><code class="n">String</code> <code class="n">l</code> <code class="o">=</code> <code class="kc">null</code><code class="o">;</code> <code class="o">(</code><code class="n">l</code> <code class="o">=</code> <code class="n">from</code><code class="o">.</code><code class="na">readLine</code><code class="o">())</code> <code class="o">!=</code> <code class="kc">null</code><code class="o">;</code> <code class="o">)</code>
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">l</code><code class="o">);</code>

<code class="o">}</code></pre>

<p>On the server side, we鈥檒l need to receive possibly multiple incoming
connections. To handle this, we鈥檒l need to kick off a main server loop,
then use <code>accept()</code> to take a new connection from the operating system.
The new connection then will need to be quickly passed to a separate
handler class, so that the main server loop can get back to listening
for new connections. The code for this is a bit more involved than the
client case:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Handler class</code>
<code class="kd">private</code> <code class="kd">static</code> <code class="kd">class</code> <code class="nc">HttpHandler</code> <code class="kd">implements</code> <code class="n">Runnable</code> <code class="o">{</code>
  <code class="kd">private</code> <code class="kd">final</code> <code class="n">Socket</code> <code class="n">sock</code><code class="o">;</code>
  <code class="n">HttpHandler</code><code class="o">(</code><code class="n">Socket</code> <code class="n">client</code><code class="o">)</code> <code class="o">{</code> <code class="k">this</code><code class="o">.</code><code class="na">sock</code> <code class="o">=</code> <code class="n">client</code><code class="o">;</code> <code class="o">}</code>

  <code class="kd">public</code> <code class="kt">void</code> <code class="nf">run</code><code class="o">()</code> <code class="o">{</code>
    <code class="k">try</code> <code class="o">(</code><code class="n">BufferedReader</code> <code class="n">in</code> <code class="o">=</code>
           <code class="k">new</code> <code class="nf">BufferedReader</code><code class="o">(</code>
             <code class="k">new</code> <code class="nf">InputStreamReader</code><code class="o">(</code><code class="n">sock</code><code class="o">.</code><code class="na">getInputStream</code><code class="o">()));</code>
         <code class="n">PrintWriter</code> <code class="n">out</code> <code class="o">=</code>
           <code class="k">new</code> <code class="nf">PrintWriter</code><code class="o">(</code>
             <code class="k">new</code> <code class="nf">OutputStreamWriter</code><code class="o">(</code><code class="n">sock</code><code class="o">.</code><code class="na">getOutputStream</code><code class="o">()));</code> <code class="o">)</code> <code class="o">{</code>
      <code class="n">out</code><code class="o">.</code><code class="na">print</code><code class="o">(</code><code class="s">HTTP/1.0 200\r\nContent-Type: text/plain\r\n\r\n</code><code class="o">);</code>
      <code class="n">String</code> <code class="n">line</code><code class="o">;</code>
      <code class="k">while</code><code class="o">((</code><code class="n">line</code> <code class="o">=</code> <code class="n">in</code><code class="o">.</code><code class="na">readLine</code><code class="o">())</code> <code class="o">!=</code> <code class="kc">null</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">if</code> <code class="o">(</code><code class="n">line</code><code class="o">.</code><code class="na">length</code><code class="o">()</code> <code class="o">==</code> <code class="mi">0</code><code class="o">)</code> <code class="k">break</code><code class="o">;</code>
        <code class="n">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">line</code><code class="o">);</code>
      <code class="o">}</code>
    <code class="o">}</code> <code class="k">catch</code><code class="o">(</code><code class="n">Exception</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>
      <code class="c1">// Handle exception</code>
    <code class="o">}</code>
  <code class="o">}</code>
<code class="o">}</code>

<code class="c1">// Main server loop</code>
<code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="o">{</code>
  <code class="k">try</code> <code class="o">{</code>
    <code class="kt">int</code> <code class="n">port</code> <code class="o">=</code> <code class="n">Integer</code><code class="o">.</code><code class="na">parseInt</code><code class="o">(</code><code class="n">args</code><code class="o">[</code><code class="mi">0</code><code class="o">]);</code>

    <code class="n">ServerSocket</code> <code class="n">ss</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ServerSocket</code><code class="o">(</code><code class="n">port</code><code class="o">);</code>
    <code class="k">for</code><code class="o">(;;)</code> <code class="o">{</code>
      <code class="n">Socket</code> <code class="n">client</code> <code class="o">=</code> <code class="n">ss</code><code class="o">.</code><code class="na">accept</code><code class="o">();</code>
      <code class="n">HTTPHandler</code> <code class="n">hndlr</code> <code class="o">=</code> <code class="k">new</code> <code class="n">HTTPHandler</code><code class="o">(</code><code class="n">client</code><code class="o">);</code>
      <code class="k">new</code> <code class="nf">Thread</code><code class="o">(</code><code class="n">hndlr</code><code class="o">).</code><code class="na">start</code><code class="o">();</code>
    <code class="o">}</code>
  <code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">Exception</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>
    <code class="c1">// Handle exception</code>
  <code class="o">}</code>
<code class="o">}</code></pre>

<p><a data-primary="Postel&apos;s Law" data-type="indexterm" id="12_idm45941104326504"></a>When designing a protocol for applications to communicate over TCP,
there鈥檚 a simple and profound network architecture principle, known as
Postel鈥檚 Law (after Jon Postel, one of the fathers of the internet) that
you should always keep in mind. It is sometimes stated as follows: 鈥淏e
strict about what you send, and liberal about what you will accept.鈥?
This simple principle means that communication can remain broadly
possible in a network system, even in the event of quite imperfect
<span class="keep-together">implementations</span>.</p>

<p>Postel鈥檚 Law, when combined with the general principle that the
protocol should be as simple as possible (sometimes called the KISS
principle), will make the developer鈥檚 job of implementing TCP-based
communication much easier than it otherwise would be.</p>

<p>Below TCP is the internet鈥檚 general-purpose haulage protocol鈥攖he
Internet Protocol (IP) itself.<a data-startref="ix_ch10-asciidoc24" data-type="indexterm" id="12_idm45941104063192"></a><a data-startref="ix_ch10-asciidoc23" data-type="indexterm" id="12_idm45941104062488"></a><a data-startref="ix_ch10-asciidoc22" data-type="indexterm" id="12_idm45941104061816"></a></p>
</div></section>













<section data-pdf-bookmark="IP" data-type="sect2"><div class="sect2" id="idm45941104526552">
<h2>IP</h2>

<p><a data-primary="I/O (input/output)" data-secondary="IP" data-type="indexterm" id="12_idm45941104059736"></a><a data-primary="IP" data-type="indexterm" id="12_idm45941104058760"></a><a data-primary="networking" data-secondary="IP" data-type="indexterm" id="12_idm45941104058088"></a>IP is the 鈥渓owest common denominator鈥?transport, and provides a useful
abstraction over the physical network technologies that are used to
actually move bytes from A to B.</p>

<p>Unlike TCP, delivery of an IP packet is not guaranteed, and a packet can
be dropped by any overloaded system along the path. IP packets do have a
destination, but usually no routing data鈥攊t鈥檚 the responsibility of the
(possibly many different) physical transports along the route to
actually deliver the data.</p>

<p>It is possible to create 鈥渄atagram鈥?services in Java that are based
around single IP packets (or those with a UDP header, instead of TCP),
but this is not often required except for extremely low-latency
applications. Java uses the class <code>DatagramSocket</code> to implement this
functionality, although few developers should ever need to venture this
far down the network stack.</p>

<p>Finally, it鈥檚 worth noting some changes that are currently in-flight in the addressing schemes that are used across the internet.
The current dominant version of IP in use is IPv4, which has a 32-bit space of
possible network addresses.
This space is now very badly squeezed, and various mitigation techniques have been deployed to handle the depletion.</p>

<p>The next version of IP (IPv6) is being rolled out, but it is not fully accepted and has yet to displace IPv4, although steady progress toward it becoming the standard continues.
In the next 10 years, IPv6 is likely to overtake IPv4 in terms of traffic volume, and low-level networking will need to adapt to this radically new version.
However, for Java programmers, the good news is that the language and platform  have been working for many years on good support for IPv6 and the changes that it introduces.
The transition between IPv4 and IPv6 is likely to be much smoother and less problematic for Java applications than in many other languages<a data-startref="ix_ch10-asciidoc18" data-type="indexterm" id="12_idm45941104053032"></a>.<a data-startref="ix_ch10-asciidoc0" data-type="indexterm" id="12_idm45941104052200"></a></p>
</div></section>





</div></section>







</div></section><div class="annotator-outer annotator-viewer viewer annotator-hide"> </div></div></div>
    </section>
  </div>
</div>

<hr/>

<!--if IE]><![endif]--><!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/java-in-a/9781492037248/ch11.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="3866890"
  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"
  data-username="levinxccai"
  data-account-type="B2B"
  
  data-activated-trial-date="11/06/2017"


  data-archive="9781492037248"
  data-publishers="O&#39;Reilly Media, Inc."



  data-htmlfile-name="ch11.html"
  data-epub-title="Java in a Nutshell, 7th Edition" data-debug=0 data-testing=0><![endif]--><!--if gt IE 8]><!--><!--![endif]-->



<a name="13_"></a>
<div id="MathJax_Message" style="display: none;"></div>
<div class="application" id="container" style="height: auto;">
  <div class="js-toc">
    <section role="document">
      <div id="sbo-rt-content" style="max-width:72.5em; transform: none;"><div class="annotator-wrapper"><section data-nutshell-tab="Classloading and Reflection" data-pdf-bookmark="Chapter 11. Classloading, Reflection, and Method Handles" data-type="chapter" epub:type="chapter"><div class="chapter" id="javanut7-CHP-11">
<h1><span class="label">Chapter 11. </span>Classloading, Reflection, and Method Handles</h1>


<p>In <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch03.html#javanut7-CHP-3">Chapter 3</a>, we met Java鈥檚 <code>Class</code> objects, as a
way of representing a live type in a running Java process. In this
chapter, we will build on this foundation to discuss how the Java
environment loads and makes new types available. In the second half of
the chapter, we will introduce Java鈥檚 introspection capabilities鈥攂oth
the original Reflection API and the newer Method Handles capabilities.</p>






<section data-pdf-bookmark="Class Files, Class Objects, and Metadata" data-type="sect1"><div class="sect1" id="idm45941104047656">
<h1>Class Files, Class Objects, and Metadata</h1>

<p>Class files, as we saw in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch01.html#javanut7-CHP-1">Chapter 1</a>, are the
result of compiling Java source files (or, potentially, other languages)
into the intermediate form used by the JVM. These are binary files that
are not designed to be human readable.</p>

<p>The runtime representation of these class files are the class objects
that contain metadata, which represents the Java type that the class
file was created from.</p>








<section data-pdf-bookmark="Examples of Class Objects" data-type="sect2"><div class="sect2" id="idm45941104044392">
<h2>Examples of Class Objects</h2>

<p><a data-primary="class objects" data-seealso="classloading" data-type="indexterm" id="13_ix_ch11-asciidoc0"></a>You <a data-primary="class objects" data-secondary="examples of" data-type="indexterm" id="13_idm45941104041448"></a>can obtain a class object in Java in several ways. The simplest
is:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Class</code><code class="o">&lt;?&gt;</code> <code class="n">myCl</code> <code class="o">=</code> <code class="n">getClass</code><code class="o">();</code></pre>

<p>This returns the class object of the instance that it is called from.
<a data-primary="getClass()" data-type="indexterm" id="13_idm45941104036760"></a>However, as we know from our survey of the public methods of <code>Object</code>,
the <code>getClass()</code> method on <code>Object</code> is public, so we can also obtain the
class of an arbitrary object <code>o</code>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Class</code><code class="o">&lt;?&gt;</code> <code class="n">c</code> <code class="o">=</code> <code class="n">o</code><code class="o">.</code><code class="na">getClass</code><code class="o">();</code></pre>

<p>Class objects for known types can also be written as 鈥渃lass literals鈥?</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Express a class literal as a type name followed by &quot;.class&quot;</code>
<code class="n">c</code> <code class="o">=</code> <code class="kt">int</code><code class="o">.</code><code class="na">class</code><code class="o">;</code> <code class="c1">// Same as Integer.TYPE</code>
<code class="n">c</code> <code class="o">=</code> <code class="n">String</code><code class="o">.</code><code class="na">class</code><code class="o">;</code> <code class="c1">// Same as &quot;a string&quot;.getClass()</code>
<code class="n">c</code> <code class="o">=</code> <code class="kt">byte</code><code class="o">[].</code><code class="na">class</code><code class="o">;</code> <code class="c1">// Type of byte arrays</code></pre>

<p>For primitive types and <code>void</code>, we also have class objects that are
represented as literals:</p>

<pre data-code-language="java" data-type="programlisting"><code class="c1">// Obtain a Class object for primitive types with various</code>
<code class="c1">// predefined constants</code>
<code class="n">c</code> <code class="o">=</code> <code class="n">Void</code><code class="o">.</code><code class="na">TYPE</code><code class="o">;</code> <code class="c1">// The special &quot;no-return-value&quot; type</code>
<code class="n">c</code> <code class="o">=</code> <code class="n">Byte</code><code class="o">.</code><code class="na">TYPE</code><code class="o">;</code> <code class="c1">// Class object that represents a byte</code>
<code class="n">c</code> <code class="o">=</code> <code class="n">Integer</code><code class="o">.</code><code class="na">TYPE</code><code class="o">;</code> <code class="c1">// Class object that represents an int</code>
<code class="n">c</code> <code class="o">=</code> <code class="n">Double</code><code class="o">.</code><code class="na">TYPE</code><code class="o">;</code> <code class="c1">// etc.; see also Short, Character, Long, Float</code></pre>

<p>For unknown types, we will have to use more sophisticated methods.</p>
</div></section>













<section data-pdf-bookmark="Class Objects and Metadata" data-type="sect2"><div class="sect2" id="idm45941103787368">
<h2>Class Objects and Metadata</h2>

<p><a data-primary="class objects" data-secondary="metadata with" data-type="indexterm" id="13_idm45941103827816"></a><a data-primary="metadata, class objects and" data-type="indexterm" id="13_idm45941103826840"></a>The class objects contain metadata about the given type. This includes
the methods, fields, constructors, and the like that are defined on the class in
question. This metadata can be accessed by the programmer to investigate
the class, even if nothing is known about the class when it is loaded.</p>

<p>For example, we can find all the deprecated methods in the class file
(they will be marked with the <code>@Deprecated</code> annotation):</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Class</code><code class="o">&lt;?&gt;</code> <code class="n">clz</code> <code class="o">=</code> <code class="n">getClassFromDisk</code><code class="o">();</code>
<code class="k">for</code> <code class="o">(</code><code class="n">Method</code> <code class="n">m</code> <code class="o">:</code> <code class="n">clz</code><code class="o">.</code><code class="na">getMethods</code><code class="o">())</code> <code class="o">{</code>
  <code class="k">for</code> <code class="o">(</code><code class="n">Annotation</code> <code class="n">a</code> <code class="o">:</code> <code class="n">m</code><code class="o">.</code><code class="na">getAnnotations</code><code class="o">())</code> <code class="o">{</code>
    <code class="k">if</code> <code class="o">(</code><code class="n">a</code><code class="o">.</code><code class="na">annotationType</code><code class="o">()</code> <code class="o">==</code> <code class="n">Deprecated</code><code class="o">.</code><code class="na">class</code><code class="o">)</code> <code class="o">{</code>
      <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">m</code><code class="o">.</code><code class="na">getName</code><code class="o">());</code>
    <code class="o">}</code>
  <code class="o">}</code>
<code class="o">}</code></pre>

<p>We could also find the common ancestor class of a pair of class files.
This simple form will work when both classes have been loaded by the
same classloader:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">static</code> <code class="n">Class</code><code class="o">&lt;?&gt;</code> <code class="n">commonAncestor</code><code class="o">(</code><code class="n">Class</code><code class="o">&lt;?&gt;</code> <code class="n">cl1</code><code class="o">,</code> <code class="n">Class</code><code class="o">&lt;?&gt;</code> <code class="n">cl2</code><code class="o">)</code> <code class="o">{</code>
  <code class="k">if</code> <code class="o">(</code><code class="n">cl1</code> <code class="o">==</code> <code class="kc">null</code> <code class="o">||</code> <code class="n">cl2</code> <code class="o">==</code> <code class="kc">null</code><code class="o">)</code> <code class="k">return</code> <code class="kc">null</code><code class="o">;</code>
  <code class="k">if</code> <code class="o">(</code><code class="n">cl1</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">cl2</code><code class="o">))</code> <code class="k">return</code> <code class="n">cl1</code><code class="o">;</code>
  <code class="k">if</code> <code class="o">(</code><code class="n">cl1</code><code class="o">.</code><code class="na">isPrimitive</code><code class="o">()</code> <code class="o">||</code> <code class="n">cl2</code><code class="o">.</code><code class="na">isPrimitive</code><code class="o">())</code> <code class="k">return</code> <code class="kc">null</code><code class="o">;</code>

  <code class="n">List</code><code class="o">&lt;</code><code class="n">Class</code><code class="o">&lt;?&gt;&gt;</code> <code class="n">ancestors</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;&gt;();</code>
  <code class="n">Class</code><code class="o">&lt;?&gt;</code> <code class="n">c</code> <code class="o">=</code> <code class="n">cl1</code><code class="o">;</code>
  <code class="k">while</code> <code class="o">(!</code><code class="n">c</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">Object</code><code class="o">.</code><code class="na">class</code><code class="o">))</code> <code class="o">{</code>
    <code class="k">if</code> <code class="o">(</code><code class="n">c</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">cl2</code><code class="o">))</code> <code class="k">return</code> <code class="n">c</code><code class="o">;</code>
    <code class="n">ancestors</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="n">c</code><code class="o">);</code>
    <code class="n">c</code> <code class="o">=</code> <code class="n">c</code><code class="o">.</code><code class="na">getSuperclass</code><code class="o">();</code>
  <code class="o">}</code>
  <code class="n">c</code> <code class="o">=</code> <code class="n">cl2</code><code class="o">;</code>
  <code class="k">while</code> <code class="o">(!</code><code class="n">c</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">Object</code><code class="o">.</code><code class="na">class</code><code class="o">))</code> <code class="o">{</code>
    <code class="k">for</code> <code class="o">(</code><code class="n">Class</code><code class="o">&lt;?&gt;</code> <code class="n">k</code> <code class="o">:</code> <code class="n">ancestors</code><code class="o">)</code> <code class="o">{</code>
      <code class="k">if</code> <code class="o">(</code><code class="n">c</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">k</code><code class="o">))</code> <code class="k">return</code> <code class="n">c</code><code class="o">;</code>
    <code class="o">}</code>
    <code class="n">c</code> <code class="o">=</code> <code class="n">c</code><code class="o">.</code><code class="na">getSuperclass</code><code class="o">();</code>
  <code class="o">}</code>

  <code class="k">return</code> <code class="n">Object</code><code class="o">.</code><code class="na">class</code><code class="o">;</code>
<code class="o">}</code></pre>

<p>Class files have a very specific layout that they must conform to if
they are to be legal and loadable by the JVM. The sections of the class
file are (in order):</p>

<ul>
<li>
<p>Magic number (all class files start with the four bytes <code>CA FE BA BE</code>
in <span class="keep-together">hexadecimal</span>)</p>
</li>
<li>
<p>Version of class file standard in use</p>
</li>
<li>
<p>Constant pool for this class</p>
</li>
<li>
<p>Access flags (<code>abstract</code>, <code>public</code>, etc.)</p>
</li>
<li>
<p>Name of this class</p>
</li>
<li>
<p>Inheritance info (e.g., name of superclass)</p>
</li>
<li>
<p>Implemented interfaces</p>
</li>
<li>
<p>Fields</p>
</li>
<li>
<p>Methods</p>
</li>
<li>
<p>Attributes</p>
</li>
</ul>

<p>The class file is a simple binary format, but it is not human readable.
Instead, tools like <code>javap</code> (see <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch13.html#javanut7-CHP-13">Chapter 13</a>)
should be used to comprehend the contents.</p>

<p><a data-primary="Constant Pool" data-type="indexterm" id="13_idm45941103512856"></a>One of the most often used sections in the class file is the Constant
Pool, which contains representations of all the methods, classes, fields,
and constants that the class needs to refer to (whether they are in this
class or another). It is designed so that bytecodes can simply refer to
a constant pool entry by its index number鈥攚hich saves space in the
bytecode representation.</p>

<p>There are a number of different class file versions created by various
Java versions. However, one of Java鈥檚 backward compatibility rules is
that JVMs (and tools) from newer versions can always use older class
files.</p>

<p>Let鈥檚 look at how the classloading process takes a collection of bytes
on disk and turns it into a new class object.<a data-startref="ix_ch11-asciidoc0" data-type="indexterm" id="13_idm45941103510456"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Phases of Classloading" data-type="sect1"><div class="sect1" id="idm45941103828664">
<h1>Phases of Classloading</h1>

<p><a data-primary="classloading" data-type="indexterm" id="13_ix_ch11-asciidoc1"></a>Classloading is the process by which a new type is added to a running
JVM process. This is the only way that new code can enter the system,
and the only way to turn data into code in the Java platform. <a data-primary="classloading" data-secondary="phases of" data-type="indexterm" id="13_ix_ch11-asciidoc2"></a>There are
several phases to the process of classloading, so let鈥檚 examine them in
turn.</p>








<section data-pdf-bookmark="Loading" data-type="sect2"><div class="sect2" id="idm45941103505432">
<h2>Loading</h2>

<p><a data-primary="classloading" data-secondary="loading phase" data-type="indexterm" id="13_idm45941103504024"></a><a data-primary="loading (classloading phase)" data-type="indexterm" id="13_idm45941103503048"></a>The classloading process starts with loading a byte array. This is
usually read in from a filesystem, but can be read from a URL or other
location (often represented as a <code>Path</code> object).</p>

<p><a data-primary="defineClass()" data-type="indexterm" id="13_idm45941103501384"></a>The <code>Classloader::defineClass()</code> method is responsible for turning a
class file (represented as a byte array) into a class object. It is a
protected method and so is not accessible without subclassing.</p>

<p>The first job of <code>defineClass()</code> is loading. This produces the skeleton
of a class object, corresponding to the class you鈥檙e attempting to load.
By this stage, some basic checks have been performed on the class (e.g.,
the constants in the constant pool have been checked to ensure that
they鈥檙e self-consistent).</p>

<p>However, loading doesn鈥檛 produce a complete class object by itself, and
the class isn鈥檛 yet usable. Instead, after loading, the class must be
linked. This step breaks down into separate subphases:</p>

<ul>
<li>
<p>Verification</p>
</li>
<li>
<p>Preparation and resolution</p>
</li>
<li>
<p>Initialization</p>
</li>
</ul>
</div></section>













<section data-pdf-bookmark="Verification" data-type="sect2"><div class="sect2" id="idm45941103494968">
<h2>Verification</h2>

<p><a data-primary="classloading" data-secondary="verification phase" data-type="indexterm" id="13_idm45941103493656"></a><a data-primary="Java Virtual Machine (JVM)" data-secondary="verification of class file" data-type="indexterm" id="13_idm45941103492680"></a><a data-primary="verification (classloading phase)" data-type="indexterm" id="13_idm45941103491704"></a>Verification confirms that the class file conforms to expectations,
and that it doesn鈥檛 try to violate the JVM鈥檚 security model (see
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch11.html#javanut7-CHP-11-SECT-3">鈥淪ecure Programming and Classloading鈥?/a&gt; for details).</p>

<p>JVM bytecode is designed so that it can be (mostly) checked statically.
This has the effect of slowing down the classloading process but
speeding up runtime (as checks can be omitted).</p>

<p>The verification step is designed to prevent the JVM from executing
bytecodes that might crash it or put it into an undefined and untested
state where it might be vulnerable to other attacks by malicious code.
Bytecode verification is a defense against malicious hand-crafted Java
bytecodes and untrusted Java compilers that might output invalid
bytecodes.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The default methods mechanism works via classloading. When an
implementation of an interface is being loaded, the class file is
examined to see if implementations for default methods are present. If
they are, classloading continues normally. If some are missing, the
implementation is patched to add in the default implementation of the
missing methods.</p>
</div>
</div></section>













<section data-pdf-bookmark="Preparation and Resolution" data-type="sect2"><div class="sect2" id="idm45941103486888">
<h2>Preparation and Resolution</h2>

<p><a data-primary="classloading" data-secondary="preparation and resolution" data-type="indexterm" id="13_idm45941103485480"></a><a data-primary="transitive closure" data-type="indexterm" id="13_idm45941103484488"></a>After successful verification, the class is prepared for use. Memory is
allocated and static variables in the class are readied for
initialization.</p>

<p>At this stage, variables aren鈥檛 initialized, and no bytecode from the
new class has been executed. Before we run any code, the JVM checks
that every type referred to by the new class file is known to the
runtime. If the types aren鈥檛 known, they may also need to be
loaded鈥攚hich can kick off the classloading process again, as the JVM
loads the new types.</p>

<p>This process of loading and discovery can execute iteratively until a
stable set of types is reached. This is called the 鈥渢ransitive closure鈥?
of the original type that was loaded.<sup><a class="totri-footnote" data-type="noteref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch11.html#idm45941103482152" id="idm45941103482152-marker">1</a></sup></p>

<p>Let鈥檚 look at a quick example, by examining the dependencies of
<code>java.lang.Object</code>. <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch11.html#javanut7-CHP-11-FIG-1">Figure 11-1</a> shows a
simplified dependency graph for <code>Object</code>. It only shows the direct
dependencies of <code>Object</code> that are visible in the public API of <code>Object</code>,
and the direct, API-visible dependencies of those dependencies. In
addition, the dependencies of <code>Class</code> on the reflection subsystem, and
of <code>PrintStream</code> and <code>PrintWriter</code> on the I/O subsystems, are shown in
very simplified form.</p>

<p>In <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch11.html#javanut7-CHP-11-FIG-1">Figure 11-1</a>, we can see part of the
transitive closure of <code>Object</code>.</p>

<figure><div class="figure" id="javanut7-CHP-11-FIG-1">
<img alt="JN7 1101" data-mfp-src="/library/view/java-in-a/9781492037248/assets/jns7_1101.png" height="1219" src="https://learning.oreilly.com/library/view/java-in-a/9781492037248/assets/jns7_1101.png" width="1403"/>
<h6><span class="label">Figure 11-1. </span>Transitive closure of types</h6>
</div></figure>
</div></section>













<section data-pdf-bookmark="Initialization" data-type="sect2"><div class="sect2" id="idm45941103472008">
<h2>Initialization</h2>

<p><a data-primary="classloading" data-secondary="initialization phase" data-type="indexterm" id="13_idm45941103470808"></a><a data-primary="initialization, classloading and" data-type="indexterm" id="13_idm45941103469832"></a>Once resolved, the JVM can finally initialize the class. Static
variables can be initialized and static initialization blocks are run.</p>

<p>This is the first time that the JVM is executing bytecode from the newly
loaded class. When the static blocks complete, the class is fully loaded
and ready to go.<a data-startref="ix_ch11-asciidoc2" data-type="indexterm" id="13_idm45941103468312"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Secure Programming and Classloading" data-type="sect1"><div class="sect1" id="javanut7-CHP-11-SECT-3">
<h1>Secure Programming and Classloading</h1>

<p><a data-primary="classloading" data-secondary="secure programming" data-type="indexterm" id="13_ix_ch11-asciidoc3"></a><a data-primary="safety" data-secondary="classloading and secure programming" data-type="indexterm" id="13_ix_ch11-asciidoc4"></a><a data-primary="secure programming, classloading and" data-type="indexterm" id="13_ix_ch11-asciidoc5"></a>Java programs can dynamically load Java classes from a variety of
sources, including untrusted sources, such as websites reached across an
insecure network. The ability to create and work with such dynamic
sources of code is one of the great strengths and features of Java. To
make it work successfully, however, Java puts great emphasis on a
security architecture that allows untrusted code to run safely, without
fear of damage to the host system.</p>

<p>Java鈥檚 classloading subsystem is where a lot of safety features are
implemented. The central idea of the security aspects of the
classloading architecture is that there is only one way to get new
executable code into the process: a class.</p>

<p>This provides a 鈥減inch point鈥濃€攖he only way to create a new class is to
use the functionality provided by <code>Classloader</code> to load a class from a
stream of bytes. By concentrating on making classloading secure, we can
constrain the attack surface that needs to be protected.</p>

<p>One extremely helpful aspect of the JVM鈥檚 design is that the
JVM is a stack machine, so all operations are evaluated on a stack,
rather than in registers. The stack state can be deduced at every point
in a method, and this can be used to ensure that the bytecode doesn鈥檛
attempt to violate the security model.</p>

<p><a data-primary="Java Virtual Machine (JVM)" data-secondary="security checks implemented by" data-type="indexterm" id="13_idm45941103458696"></a>Some of the security checks that are implemented by the JVM are:</p>

<ul>
<li>
<p>All the bytecode of the class has valid parameters.</p>
</li>
<li>
<p>All methods are called with the right number of parameters of the
correct static types.</p>
</li>
<li>
<p>Bytecode never tries to underflow or overflow the JVM stack.</p>
</li>
<li>
<p>Local variables are not used before they are initialized.</p>
</li>
<li>
<p>Variables are only assigned suitably typed values.</p>
</li>
<li>
<p>Field, method, and class access control modifiers must be respected.</p>
</li>
<li>
<p>No unsafe casts (e.g., attempts to convert an <code>int</code> to a pointer).</p>
</li>
<li>
<p>All branch instructions are to legal points within the same method.</p>
</li>
</ul>

<p><a data-primary="C/C++" data-secondary="interchangeability of integers/pointers" data-type="indexterm" id="13_idm45941103449192"></a>Of fundamental importance is the approach to memory, and pointers. In
assembly and C/C++, integers and pointers are interchangeable, so an
integer can be used as a memory address. We can write it in assembly
like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">mov</code> <code class="n">eax</code><code class="o">,</code> <code class="o">[</code><code class="n">STAT</code><code class="o">]</code> <code class="o">;</code> <code class="n">Move</code> <code class="mi">4</code> <code class="n">bytes</code> <code class="n">from</code> <code class="n">addr</code> <code class="n">STAT</code> <code class="n">into</code> <code class="n">eax</code></pre>

<p>The lowest level of the Java security architecture involves the design
of the Java Virtual Machine and the bytecodes it executes. The JVM does
not allow any kind of direct access to individual memory addresses of
the underlying system, which prevents Java code from interfering with
the native hardware and operating system. These intentional restrictions
on the JVM are reflected in the Java language itself, which does not
support pointers or pointer arithmetic.</p>

<p>Neither the language nor the JVM allow an integer to be cast to an
object reference or vice versa, and there is no way whatsoever to obtain
an object鈥檚 address in memory. Without capabilities like these,
malicious code simply cannot gain a foothold.</p>

<p>Recall from <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch02.html#javanut7-CHP-2">Chapter 2</a> that Java has two types of
values鈥攑rimitives and object references. These are the only things
that can be put into variables. Note that 鈥渙bject contents鈥?cannot be
put into variables. Java has no equivalent of C鈥檚 <code>struct</code> and always
has pass-by-value semantics. For reference types, what is passed is a
copy of the reference鈥攚hich is a value.</p>

<p>References are represented in the JVM as pointers, but they are not
directly manipulated by the bytecode. In fact, bytecode does not have
opcodes for 鈥渁ccess memory at location X.鈥?/p&gt;

<p>Instead, all we can do is access fields and methods; bytecode cannot call
an arbitrary memory location. This means that the JVM always knows the
difference between code and data. In turn, this prevents a whole class
of stack overflow and other attacks.<a data-startref="ix_ch11-asciidoc5" data-type="indexterm" id="13_idm45941103438104"></a><a data-startref="ix_ch11-asciidoc4" data-type="indexterm" id="13_idm45941103437400"></a><a data-startref="ix_ch11-asciidoc3" data-type="indexterm" id="13_idm45941103436728"></a></p>
</div></section>













<section data-pdf-bookmark="Applied Classloading" data-type="sect1"><div class="sect1" id="idm45941103466760">
<h1>Applied Classloading</h1>

<p><a data-primary="classloading" data-secondary="applied" data-type="indexterm" id="13_ix_ch11-asciidoc6"></a><a data-primary="java.lang.ClassLoader" data-type="indexterm" id="13_ix_ch11-asciidoc7"></a>To apply knowledge of classloading, it鈥檚 important to fully understand
<code>java.lang.ClassLoader</code>.</p>

<p>This is an abstract class that is fully functional and has no abstract
methods. The <code>abstract</code> modifier exists only to ensure that users must
subclass <code>ClassLoader</code> if they want to make use of it.</p>

<p><a data-primary="loadClass()" data-type="indexterm" id="13_idm45941103423272"></a>In addition to the aforementioned <code>defineClass()</code> method, we can load
classes via a public <code>loadClass()</code> method. <a data-primary="URLClassLoader, loadClass()" data-type="indexterm" id="13_idm45941103421640"></a>This is commonly used by
the <code>URLClassLoader</code> subclass, which can load classes from a URL or file
path.</p>

<p>We can use <code>URLClassLoader</code> to load classes from the local disk like
this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">String</code> <code class="n">current</code> <code class="o">=</code> <code class="k">new</code> <code class="n">File</code><code class="o">(</code> <code class="s">.</code> <code class="o">).</code><code class="na">getCanonicalPath</code><code class="o">();</code>
<code class="k">try</code> <code class="o">(</code><code class="n">URLClassLoader</code> <code class="n">ulr</code> <code class="o">=</code>
  <code class="k">new</code> <code class="nf">URLClassLoader</code><code class="o">(</code><code class="k">new</code> <code class="n">URL</code><code class="o">[]</code> <code class="o">{</code><code class="k">new</code> <code class="n">URL</code><code class="o">(</code><code class="s">file://</code><code class="o">+</code> <code class="n">current</code> <code class="o">+</code> <code class="s">/</code><code class="o">)}))</code> <code class="o">{</code>
  <code class="n">Class</code><code class="o">&lt;?&gt;</code> <code class="n">clz</code> <code class="o">=</code> <code class="n">ulr</code><code class="o">.</code><code class="na">loadClass</code><code class="o">(</code><code class="s">com.example.DFACaller</code><code class="o">);</code>
  <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">clz</code><code class="o">.</code><code class="na">getName</code><code class="o">());</code>
<code class="o">}</code></pre>

<p>The argument to <code>loadClass()</code> is the binary name of the class file. Note
that in order for the <code>URLClassLoader</code> to find the classes correctly,
they need to be in the expected place on the filesystem. In this
example, the class <code>com.example.DFACaller</code> would need to be found in the
file <em>com/example/DFACaller.class</em> relative to the working directory.</p>

<p><a data-primary="Class.forName()" data-type="indexterm" id="13_idm45941103304472"></a>Alternatively, <code>Class</code> provides <code>Class.forName()</code>, a static method that
can load classes that are present on the classpath but that haven鈥檛 been
referred to yet.</p>

<p>This method takes a fully qualified class name. For example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Class</code><code class="o">&lt;?&gt;</code> <code class="n">jdbcClz</code> <code class="o">=</code> <code class="n">Class</code><code class="o">.</code><code class="na">forName</code><code class="o">(</code><code class="s">oracle.jdbc.driver.OracleDriver</code><code class="o">);</code></pre>

<p><a data-primary="ClassNotFoundException" data-type="indexterm" id="13_idm45941103299000"></a>It throws a <code>ClassNotFoundException</code> if class can鈥檛 be found. As the
example indicates, this was commonly used in older versions of JDBC to
ensure that the correct driver was loaded, while avoiding a direct
<code>import</code> dependency on the driver classes.</p>

<p>With the advent of JDBC 4.0, this initialization step is no longer
required.</p>

<p><code>Class.forName()</code> has an alternative, three-argument form, which is
sometimes used in conjunction with alternative class loaders:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Class</code><code class="o">.</code><code class="na">forName</code><code class="o">(</code><code class="n">String</code> <code class="n">name</code><code class="o">,</code> <code class="kt">boolean</code> <code class="n">inited</code><code class="o">,</code> <code class="n">Classloader</code> <code class="n">classloader</code><code class="o">);</code></pre>

<p>There are a host of subclasses of <code>ClassLoader</code> that deal with
individual special cases of classloading鈥攚hich fit into the classloader
hierarchy.</p>








<section data-pdf-bookmark="Classloader Hierarchy" data-type="sect2"><div class="sect2" id="idm45941103275528">
<h2>Classloader Hierarchy</h2>

<p><a data-primary="classloading" data-secondary="hierarchy of classloaders" data-type="indexterm" id="13_ix_ch11-asciidoc8"></a>The <a data-primary="Java Virtual Machine (JVM)" data-secondary="classloader hierarchy" data-type="indexterm" id="13_idm45941103272856"></a>JVM has a hierarchy of classloaders; each classloader in the system
(apart from the initial, 鈥渂ootstrap鈥?classloader) has a parent that it can delegate to.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The arrival of modules in Java 9 has affected the details of the way that classloading operates.
In particular, the classloaders that load the JRE classes are now <em>modular classloaders</em>.</p>
</div>

<p>The convention is that a classloader will ask its parent to resolve and
load a class, and will only perform the job itself if the parent
classloader is unable to comply. Some common classloaders are shown in
<a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch11.html#javanut7-CHP-11-FIG-2">Figure 11-2</a>.</p>

<figure><div class="figure" id="javanut7-CHP-11-FIG-2">
<img alt="JN7 1102" data-mfp-src="/library/view/java-in-a/9781492037248/assets/jns7_1102.png" height="699" src="https://learning.oreilly.com/library/view/java-in-a/9781492037248/assets/jns7_1102.png" width="938"/>
<h6><span class="label">Figure 11-2. </span>Classloader hierarchy</h6>
</div></figure>










<section data-pdf-bookmark="Bootstrap classloader" data-type="sect3"><div class="sect3" id="idm45941103214696">
<h3>Bootstrap classloader</h3>

<p><a data-primary="bootstrap classloader" data-type="indexterm" id="13_idm45941103213464"></a><a data-primary="classloading" data-secondary="bootstrap classloader" data-type="indexterm" id="13_idm45941103212760"></a>This is the first classloader to appear in any JVM process, and is only used to load the core system classes.
In older texts, it is sometimes referred to as the <em>primordial classloader</em>, but modern usage favors the bootstrap name.</p>

<p>For performance reasons, the bootstrap classloader does no verification, and relies on the boot classpath being secure.
Types loaded by the bootstrap classloader are implicitly granted all security permissions and so this group of modules is kept as restricted as possible.</p>
</div></section>













<section data-pdf-bookmark="Platform classloader" data-type="sect3"><div class="sect3" id="idm45941103210168">
<h3>Platform classloader</h3>

<p><a data-primary="classloading" data-secondary="extension classloader" data-type="indexterm" id="13_idm45941103208968"></a><a data-primary="extension classloader" data-type="indexterm" id="13_idm45941103207992"></a><a data-primary="classloading" data-secondary="platform classloader" data-type="indexterm" id="13_idm45941103207320"></a><a data-primary="platform classloader" data-type="indexterm" id="13_idm45941103206376"></a>This level of the classloader hierarchy was originally used as the <em>extension classloader</em>, but this mechanism has now been removed.</p>

<p>In its new role this classloader (which has the bootstrap classloader as its parent) is now known as the <em>platform classloader</em>. It is available via the method <code>ClassLoader::getPlatformClassLoader</code> and appears in (and is required by) the Java specification from version 9 onward.
It loads the remaining modules from the base system (the equivalent of the old <code>rt.jar</code> used in version 8 and earlier).</p>

<p>In the new modular implementations of Java, far less code is required to bootstrap a Java process and accordingly, as much JDK code (now represented as modules) as possible has been moved out of the scope of the bootstrap loader and into the platform loader instead.</p>
</div></section>













<section data-pdf-bookmark="Application classloader" data-type="sect3"><div class="sect3" id="idm45941103202184">
<h3>Application classloader</h3>

<p><a data-primary="application classloader" data-type="indexterm" id="13_idm45941103177704"></a><a data-primary="classloading" data-secondary="application classloader" data-type="indexterm" id="13_idm45941103177064"></a><a data-primary="classloading" data-secondary="system classloader" data-type="indexterm" id="13_idm45941103176120"></a><a data-primary="system (application) classloader" data-type="indexterm" id="13_idm45941103175176"></a>This was historically sometimes called the system classloader, but
this is a bad name, as it doesn鈥檛 load the system (the bootstrap and platform classloaders do).
Instead, it is the classloader that loads application code from either the module path or the classpath.
It is the most commonly encountered classloader, and it has the platform classloader as its parent.</p>

<p>To perform classloading, the application classloader first searches the named modules on the module path (the modules known to any of the three built-in classloaders).
If the requested class is found in a module known to one of these classloaders then that classloader will load the class.
If the class is not found in any known named module, the application classloader delegates to its parent (the platform classloader).
If the parent fails to find the class, the application classloader
searches the classpath.
If the class is found on the classpath, it is loaded as a member of the application classloader鈥檚 unnamed module.</p>

<p>The application classloader is very widely used, but many advanced Java
frameworks require functionality that the main classloaders do not
supply. Instead, extensions to the standard classloaders are required.
This forms the basis of 鈥渃ustom classloading鈥濃€攚hich relies on
implementing a new subclass of <code>ClassLoader</code>.</p>
</div></section>













<section data-pdf-bookmark="Custom classloader" data-type="sect3"><div class="sect3" id="idm45941103171496">
<h3>Custom classloader</h3>

<p><a data-primary="classloading" data-secondary="custom classloader" data-type="indexterm" id="13_idm45941103170088"></a><a data-primary="custom classloader" data-type="indexterm" id="13_idm45941103169112"></a>When performing classloading, sooner or later we have to turn data
into code. As noted earlier, the <code>defineClass()</code> (actually a group of
related methods) is responsible for converting a <code>byte[]</code> into a class
object.</p>

<p>This method is usually called from a subclass鈥攆or example, this simple
custom classloader that creates a class object from a file on disk:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">static</code> <code class="kd">class</code> <code class="nc">DiskLoader</code> <code class="kd">extends</code> <code class="n">ClassLoader</code> <code class="o">{</code>
  <code class="kd">public</code> <code class="nf">DiskLoader</code><code class="o">()</code> <code class="o">{</code>
    <code class="kd">super</code><code class="o">(</code><code class="n">DiskLoader</code><code class="o">.</code><code class="na">class</code><code class="o">.</code><code class="na">getClassLoader</code><code class="o">());</code>
  <code class="o">}</code>

  <code class="kd">public</code> <code class="n">Class</code><code class="o">&lt;?&gt;</code> <code class="n">loadFromDisk</code><code class="o">(</code><code class="n">String</code> <code class="n">clzName</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>
    <code class="kt">byte</code><code class="o">[]</code> <code class="n">b</code> <code class="o">=</code> <code class="n">Files</code><code class="o">.</code><code class="na">readAllBytes</code><code class="o">(</code><code class="n">Paths</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="n">clzName</code><code class="o">));</code>

    <code class="k">return</code> <code class="nf">defineClass</code><code class="o">(</code><code class="kc">null</code><code class="o">,</code> <code class="n">b</code><code class="o">,</code> <code class="mi">0</code><code class="o">,</code> <code class="n">b</code><code class="o">.</code><code class="na">length</code><code class="o">);</code>
  <code class="o">}</code>
<code class="o">}</code></pre>

<p>Notice that in the preceding example we didn鈥檛 need to have the class
file in the 鈥渃orrect鈥?location on disk, as we did for the
<code>URLClassLoader</code> example.</p>

<p>We need to provide a classloader to act as parent for any custom
classloader. In this example, we provided the classloader that loaded
the <code>DiskLoader</code> class (which would usually be the application
classloader).</p>

<p>Custom classloading is a very common technique in Java EE and advanced
SE environments, and it provides very sophisticated capabilities to the
Java platform. We鈥檒l see an example of custom classloading later on in
this chapter<a data-startref="ix_ch11-asciidoc8" data-type="indexterm" id="13_idm45941103113560"></a>.<a data-startref="ix_ch11-asciidoc7" data-type="indexterm" id="13_idm45941103112728"></a><a data-startref="ix_ch11-asciidoc6" data-type="indexterm" id="13_idm45941103112024"></a></p>

<p>One drawback of dynamic classloading is that when working with a class
object that we loaded dynamically, we typically have little or no
information about the class. To work effectively with this class, we
will therefore usually have to use a set of dynamic programming
techniques known as reflection.<a data-startref="ix_ch11-asciidoc1" data-type="indexterm" id="13_idm45941103110648"></a></p>
</div></section>



</div></section>





</div></section>













<section data-pdf-bookmark="Reflection" data-type="sect1"><div class="sect1" id="idm45941103435464">
<h1>Reflection</h1>

<p><a data-primary="reflection" data-type="indexterm" id="13_ix_ch11-asciidoc9"></a>Reflection is the capability of examining, operating on, and modifying
objects at runtime. This includes modifying their structure and
behavior鈥攅ven self-modification.</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>The Java modules system introduces major changes to how reflection works on the platform. It is important to reread this section after you have gained an understanding of how modules work, and how the two capabilities interact.</p>
</div>

<p>Reflection is capable of working even when type and method names are not
known at compile time. It uses the essential metadata provided by class
objects, and can discover method or field names from the class
object鈥攁nd then acquire an object representing the method or field.</p>

<p>Instances can also be constructed reflexively (by using
<code>Class::newInstance()</code> or another constructor). With a reflexively
constructed object and a <code>Method</code> object, we can call any method
on an object of a previously unknown type.</p>

<p>This makes reflection a very powerful technique鈥攕o it鈥檚 important to
understand when we should use it, and when it鈥檚 overkill.</p>








<section data-pdf-bookmark="When to Use Reflection" data-type="sect2"><div class="sect2" id="idm45941103103256">
<h2>When to Use Reflection</h2>

<p><a data-primary="reflection" data-secondary="when to use" data-type="indexterm" id="13_idm45941103101816"></a>Many, if not most, Java frameworks use reflection in some capacity.
Writing architectures that are flexible enough to cope with code that is
unknown until runtime usually requires reflection. For example, plug-in
architectures, debuggers, code browsers, and REPL-like environments are
usually implemented on top of reflection.</p>

<p>Reflection is also widely used in testing (e.g., by the JUnit and TestNG libraries) and for mock object creation. If you鈥檝e used any kind
of Java framework you have almost certainly been using reflective
code, even if you didn鈥檛 realize it.</p>

<p>To start using the Reflection API in your own code, the most important
thing to realize is that it is about accessing objects where virtually
no information is known, and that the interactions can be cumbersome
because of this.</p>

<p>If some static information is known about dynamically
loaded classes (e.g., that the classes loaded all implement a known
interface), this can greatly simplify the interaction with the
classes and reduce the burden of operating reflectively.</p>

<p>It is a common mistake to try to create a reflective framework that
attempts to account for all possible circumstances, instead of dealing only
with the cases that are immediately applicable to the problem domain.</p>
</div></section>













<section data-pdf-bookmark="How to Use Reflection" data-type="sect2"><div class="sect2" id="idm45941103097640">
<h2>How to Use Reflection</h2>

<p><a data-primary="reflection" data-secondary="how to use" data-type="indexterm" id="13_ix_ch11-asciidoc10"></a>The first step in any reflective operation is to get a <a data-primary="Class object" data-secondary="reflection" data-type="indexterm" id="13_idm45941103094984"></a><code>Class</code> object
representing the type to be operated on. From this, other objects,
representing fields, methods, or constructors, can be accessed and
applied to instances of the unknown type.</p>

<p>To get an instance of an unknown type, it is simplest to use the
no-arg constructor, which is made available directly via the <code>Class</code>
object:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Class</code><code class="o">&lt;?&gt;</code> <code class="n">clz</code> <code class="o">=</code> <code class="n">getSomeClassObject</code><code class="o">();</code>
<code class="n">Object</code> <code class="n">rcvr</code> <code class="o">=</code> <code class="n">clz</code><code class="o">.</code><code class="na">newInstance</code><code class="o">();</code></pre>

<p>For constructors that take arguments, you will have to look up the
precise constructor needed, represented as a <code>Constructor</code> object.</p>

<p>The <code>Method</code> objects are one of the most commonly used objects provided
by the Reflection API. We鈥檒l discuss them in detail鈥攖he <code>Constructor</code> and
<code>Field</code> objects are similar in many respects.</p>










<section data-pdf-bookmark="Method objects" data-type="sect3"><div class="sect3" id="idm45941103016584">
<h3>Method objects</h3>

<p><a data-primary="Method objects, Reflection and" data-type="indexterm" id="13_ix_ch11-asciidoc11"></a><a data-primary="reflection" data-secondary="Method objects" data-type="indexterm" id="13_ix_ch11-asciidoc12"></a>A class object contains a <code>Method</code> object for each method on the class.
These are lazily created after classloading, and so they aren鈥檛 immediately
visible in an IDE鈥檚 <span class="keep-together">debugger</span>.</p>

<p>Let鈥檚 look at the source code from <code>Method</code> to see what information and
metadata is held for each method:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">private</code> <code class="n">Class</code><code class="o">&lt;?&gt;</code>                   <code class="n">clazz</code><code class="o">;</code>
<code class="kd">private</code> <code class="kt">int</code>                        <code class="n">slot</code><code class="o">;</code>
<code class="c1">// This is guaranteed to be interned by the VM in the 1.4</code>
<code class="c1">// reflection implementation</code>
<code class="kd">private</code> <code class="n">String</code>                     <code class="n">name</code><code class="o">;</code>
<code class="kd">private</code> <code class="n">Class</code><code class="o">&lt;?&gt;</code>                   <code class="n">returnType</code><code class="o">;</code>
<code class="kd">private</code> <code class="n">Class</code><code class="o">&lt;?&gt;[]</code>                 <code class="n">parameterTypes</code><code class="o">;</code>
<code class="kd">private</code> <code class="n">Class</code><code class="o">&lt;?&gt;[]</code>                 <code class="n">exceptionTypes</code><code class="o">;</code>
<code class="kd">private</code> <code class="kt">int</code>                        <code class="n">modifiers</code><code class="o">;</code>
<code class="c1">// Generics and annotations support</code>
<code class="kd">private</code> <code class="kd">transient</code> <code class="n">String</code>           <code class="n">signature</code><code class="o">;</code>
<code class="c1">// Generic info repository; lazily initialized</code>
<code class="kd">private</code> <code class="kd">transient</code> <code class="n">MethodRepository</code> <code class="n">genericInfo</code><code class="o">;</code>
<code class="kd">private</code> <code class="kt">byte</code><code class="o">[]</code>                     <code class="n">annotations</code><code class="o">;</code>
<code class="kd">private</code> <code class="kt">byte</code><code class="o">[]</code>                     <code class="n">parameterAnnotations</code><code class="o">;</code>
<code class="kd">private</code> <code class="kt">byte</code><code class="o">[]</code>                     <code class="n">annotationDefault</code><code class="o">;</code>
<code class="kd">private</code> <code class="kd">volatile</code> <code class="n">MethodAccessor</code>    <code class="n">methodAccessor</code><code class="o">;</code></pre>

<p>This provides all available information, including the exceptions the
method can throw, annotations (with a retention policy of <code>RUNTIME</code>),
and even the generics information that was otherwise removed by <code>javac</code>.</p>

<p>We can explore the metadata contained on the <code>Method</code> object by calling
accessor methods, but by far the single biggest use case for <code>Method</code> is
reflexive invocation.</p>

<p><a data-primary="invoke()" data-type="indexterm" id="13_idm45941102926216"></a>The methods represented by these objects can be executed by reflection
using the <code>invoke()</code> method on <code>Method</code>. An example of invoking
<code>hashCode()</code> on a <code>String</code> object follows:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Object</code> <code class="n">rcvr</code> <code class="o">=</code> <code class="s">a</code><code class="o">;</code>
<code class="k">try</code> <code class="o">{</code>
  <code class="n">Class</code><code class="o">&lt;?&gt;[]</code> <code class="n">argTypes</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Class</code><code class="o">[]</code> <code class="o">{</code> <code class="o">};</code>
  <code class="n">Object</code><code class="o">[]</code> <code class="n">args</code> <code class="o">=</code> <code class="kc">null</code><code class="o">;</code>

  <code class="n">Method</code> <code class="n">meth</code> <code class="o">=</code> <code class="n">rcvr</code><code class="o">.</code><code class="na">getClass</code><code class="o">().</code><code class="na">getMethod</code><code class="o">(</code><code class="s">hashCode</code><code class="o">,</code> <code class="n">argTypes</code><code class="o">);</code>
  <code class="n">Object</code> <code class="n">ret</code> <code class="o">=</code> <code class="n">meth</code><code class="o">.</code><code class="na">invoke</code><code class="o">(</code><code class="n">rcvr</code><code class="o">,</code> <code class="n">args</code><code class="o">);</code>
  <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">ret</code><code class="o">);</code>

<code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">IllegalArgumentException</code> <code class="o">|</code> <code class="n">NoSuchMethodException</code> <code class="o">|</code>
         <code class="n">SecurityException</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>
  <code class="n">e</code><code class="o">.</code><code class="na">printStackTrace</code><code class="o">();</code>
<code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">IllegalAccessException</code> <code class="o">|</code> <code class="n">InvocationTargetException</code> <code class="n">x</code><code class="o">)</code> <code class="o">{</code>
  <code class="n">x</code><code class="o">.</code><code class="na">printStackTrace</code><code class="o">();</code>
<code class="o">}</code></pre>

<p>To get the <code>Method</code> object we want to use, we call <code>getMethod()</code> on the
class object. This will return a reference to a <code>Method</code> corresponding
to a public method on the class.</p>

<p>Note that the static type of <code>rcvr</code> was declared to be <code>Object</code>. No
static type information was used during the reflective invocation. The
<code>invoke()</code> method also returns <code>Object</code>, so the actual return type of
<code>hashCode()</code> has been autoboxed to <code>Integer</code>.</p>

<p>This autoboxing is one of the aspects of Reflection where you can see some of the
slight awkwardness of the API鈥攚hich is the subject of the
next section.<a data-startref="ix_ch11-asciidoc12" data-type="indexterm" id="13_idm45941102788328"></a><a data-startref="ix_ch11-asciidoc11" data-type="indexterm" id="13_idm45941102787736"></a></p>
</div></section>













<section data-pdf-bookmark="Problems with Reflection" data-type="sect3"><div class="sect3" id="idm45941103015960">
<h3>Problems with Reflection</h3>

<p><a data-primary="reflection" data-secondary="problems with" data-type="indexterm" id="13_idm45941102785816"></a><a data-primary="Reflection API" data-type="indexterm" id="13_idm45941102784840"></a>Java鈥檚 Reflection API is often the only way to deal with dynamically
loaded code, but there are a number of annoyances in the API that can
make it slightly awkward to deal with:</p>

<ul>
<li>
<p>Heavy use of <code>Object[]</code> to represent call arguments and other
instances.</p>
</li>
<li>
<p>Also <code>Class[]</code> when talking about types.</p>
</li>
<li>
<p>Methods can be overloaded on name, so we need an array of types to
distinguish between methods.</p>
</li>
<li>
<p>Representing primitive types can be problematic鈥攚e have to manually
box and unbox.</p>
</li>
</ul>

<p><a data-primary="void keyword" data-type="indexterm" id="13_idm45941102778424"></a><code>void</code> is a particular problem鈥攖here is a <code>void.class</code>, but it鈥檚 not
used consistently. Java doesn鈥檛 really know whether <code>void</code> is a type or
not, and some methods in the Reflection API use <code>null</code> instead.</p>

<p>This is cumbersome, and can be error prone鈥攊n particular, the slight
verbosity of Java鈥檚 array syntax can lead to errors.</p>

<p>One further problem is the treatment of non-<code>public</code> methods. Instead
of using <code>getMethod()</code>, we must use <code>getDeclaredMethod()</code> to get a
reference to a non-<code>public</code> method, and then override the Java access
control subsystem with <code>setAccessible()</code> to allow it to be executed:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">MyCache</code> <code class="o">{</code>
  <code class="kd">private</code> <code class="kt">void</code> <code class="nf">flush</code><code class="o">()</code> <code class="o">{</code>
    <code class="c1">// Flush the cache...</code>
  <code class="o">}</code>
<code class="o">}</code>

<code class="n">Class</code><code class="o">&lt;?&gt;</code> <code class="n">clz</code> <code class="o">=</code> <code class="n">MyCache</code><code class="o">.</code><code class="na">class</code><code class="o">;</code>
<code class="k">try</code> <code class="o">{</code>
  <code class="n">Object</code> <code class="n">rcvr</code> <code class="o">=</code> <code class="n">clz</code><code class="o">.</code><code class="na">newInstance</code><code class="o">();</code>
  <code class="n">Class</code><code class="o">&lt;?&gt;[]</code> <code class="n">argTypes</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Class</code><code class="o">[]</code> <code class="o">{</code> <code class="o">};</code>
  <code class="n">Object</code><code class="o">[]</code> <code class="n">args</code> <code class="o">=</code> <code class="kc">null</code><code class="o">;</code>

  <code class="n">Method</code> <code class="n">meth</code> <code class="o">=</code> <code class="n">clz</code><code class="o">.</code><code class="na">getDeclaredMethod</code><code class="o">(</code><code class="s">flush</code><code class="o">,</code> <code class="n">argTypes</code><code class="o">);</code>
  <code class="n">meth</code><code class="o">.</code><code class="na">setAccessible</code><code class="o">(</code><code class="kc">true</code><code class="o">);</code>
  <code class="n">meth</code><code class="o">.</code><code class="na">invoke</code><code class="o">(</code><code class="n">rcvr</code><code class="o">,</code> <code class="n">args</code><code class="o">);</code>
<code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">IllegalArgumentException</code> <code class="o">|</code> <code class="n">NoSuchMethodException</code> <code class="o">|</code>
         <code class="n">InstantiationException</code> <code class="o">|</code> <code class="n">SecurityException</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>
  <code class="n">e</code><code class="o">.</code><code class="na">printStackTrace</code><code class="o">();</code>
<code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">IllegalAccessException</code> <code class="o">|</code> <code class="n">InvocationTargetException</code> <code class="n">x</code><code class="o">)</code> <code class="o">{</code>
  <code class="n">x</code><code class="o">.</code><code class="na">printStackTrace</code><code class="o">();</code>
<code class="o">}</code></pre>

<p>However, it should be pointed out that reflection always involves
unknown information. To some degree, we just have to live with some of
this verbosity as the price of dealing with reflective invocation, and
the dynamic, runtime power that it gives to the developer.</p>

<p>As a final example in this section, let鈥檚 show how to combine
reflection with custom classloading to inspect a class file on disk
and see if it contains any deprecated methods (these should be marked
with <code>@Deprecated</code>):<a data-startref="ix_ch11-asciidoc10" data-type="indexterm" id="13_idm45941102656952"></a></p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">CustomClassloadingExamples</code> <code class="o">{</code>
    <code class="kd">public</code> <code class="kd">static</code> <code class="kd">class</code> <code class="nc">DiskLoader</code> <code class="kd">extends</code> <code class="n">ClassLoader</code> <code class="o">{</code>

        <code class="kd">public</code> <code class="nf">DiskLoader</code><code class="o">()</code> <code class="o">{</code>
            <code class="kd">super</code><code class="o">(</code><code class="n">DiskLoader</code><code class="o">.</code><code class="na">class</code><code class="o">.</code><code class="na">getClassLoader</code><code class="o">());</code>
        <code class="o">}</code>

        <code class="kd">public</code> <code class="n">Class</code><code class="o">&lt;?&gt;</code> <code class="n">loadFromDisk</code><code class="o">(</code><code class="n">String</code> <code class="n">clzName</code><code class="o">)</code>
          <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>
            <code class="kt">byte</code><code class="o">[]</code> <code class="n">b</code> <code class="o">=</code> <code class="n">Files</code><code class="o">.</code><code class="na">readAllBytes</code><code class="o">(</code><code class="n">Paths</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="n">clzName</code><code class="o">));</code>

            <code class="k">return</code> <code class="nf">defineClass</code><code class="o">(</code><code class="kc">null</code><code class="o">,</code> <code class="n">b</code><code class="o">,</code> <code class="mi">0</code><code class="o">,</code> <code class="n">b</code><code class="o">.</code><code class="na">length</code><code class="o">);</code>
        <code class="o">}</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">findDeprecatedMethods</code><code class="o">(</code><code class="n">Class</code><code class="o">&lt;?&gt;</code> <code class="n">clz</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">for</code> <code class="o">(</code><code class="n">Method</code> <code class="n">m</code> <code class="o">:</code> <code class="n">clz</code><code class="o">.</code><code class="na">getMethods</code><code class="o">())</code> <code class="o">{</code>
            <code class="k">for</code> <code class="o">(</code><code class="n">Annotation</code> <code class="n">a</code> <code class="o">:</code> <code class="n">m</code><code class="o">.</code><code class="na">getAnnotations</code><code class="o">())</code> <code class="o">{</code>
                <code class="k">if</code> <code class="o">(</code><code class="n">a</code><code class="o">.</code><code class="na">annotationType</code><code class="o">()</code> <code class="o">==</code> <code class="n">Deprecated</code><code class="o">.</code><code class="na">class</code><code class="o">)</code> <code class="o">{</code>
                    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">m</code><code class="o">.</code><code class="na">getName</code><code class="o">());</code>
                <code class="o">}</code>
            <code class="o">}</code>
        <code class="o">}</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code>
      <code class="kd">throws</code> <code class="n">IOException</code><code class="o">,</code> <code class="n">ClassNotFoundException</code> <code class="o">{</code>
        <code class="n">CustomClassloadingExamples</code> <code class="n">rfx</code> <code class="o">=</code>
          <code class="k">new</code> <code class="nf">CustomClassloadingExamples</code><code class="o">();</code>

        <code class="k">if</code> <code class="o">(</code><code class="n">args</code><code class="o">.</code><code class="na">length</code> <code class="o">&gt;</code> <code class="mi">0</code><code class="o">)</code> <code class="o">{</code>
            <code class="n">DiskLoader</code> <code class="n">dlr</code> <code class="o">=</code> <code class="k">new</code> <code class="n">DiskLoader</code><code class="o">();</code>
            <code class="n">Class</code><code class="o">&lt;?&gt;</code> <code class="n">clzToTest</code> <code class="o">=</code> <code class="n">dlr</code><code class="o">.</code><code class="na">loadFromDisk</code><code class="o">(</code><code class="n">args</code><code class="o">[</code><code class="mi">0</code><code class="o">]);</code>
            <code class="n">rfx</code><code class="o">.</code><code class="na">findDeprecatedMethods</code><code class="o">(</code><code class="n">clzToTest</code><code class="o">);</code>
        <code class="o">}</code>
    <code class="o">}</code>
<code class="o">}</code></pre>
</div></section>



</div></section>













<section data-pdf-bookmark="Dynamic Proxies" data-type="sect2"><div class="sect2" id="idm45941102786472">
<h2>Dynamic Proxies</h2>

<p><a data-primary="dynamic proxies" data-type="indexterm" id="13_ix_ch11-asciidoc13"></a><a data-primary="reflection" data-secondary="dynamic proxies" data-type="indexterm" id="13_ix_ch11-asciidoc14"></a>One last piece of the Java Reflection story is the creation of
dynamic proxies. These are classes (which extend
<code>java.lang.reflect.Proxy</code>) that implement a number of interfaces. The
implementing class is constructed dynamically at runtime, and forwards
all calls to an invocation handler object:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">InvocationHandler</code> <code class="n">h</code> <code class="o">=</code> <code class="k">new</code> <code class="n">InvocationHandler</code><code class="o">()</code> <code class="o">{</code>
  <code class="nd">@Override</code>
  <code class="kd">public</code> <code class="n">Object</code> <code class="nf">invoke</code><code class="o">(</code><code class="n">Object</code> <code class="n">proxy</code><code class="o">,</code> <code class="n">Method</code> <code class="n">method</code><code class="o">,</code> <code class="n">Object</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code>
                    <code class="kd">throws</code> <code class="n">Throwable</code> <code class="o">{</code>
    <code class="n">String</code> <code class="n">name</code> <code class="o">=</code> <code class="n">method</code><code class="o">.</code><code class="na">getName</code><code class="o">();</code>
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Called as: </code><code class="o">+</code> <code class="n">name</code><code class="o">);</code>
    <code class="k">switch</code> <code class="o">(</code><code class="n">name</code><code class="o">)</code> <code class="o">{</code>
      <code class="k">case</code> <code class="s">isOpen</code><code class="o">:</code>
        <code class="k">return</code> <code class="kc">false</code><code class="o">;</code>
      <code class="k">case</code> <code class="s">close</code><code class="o">:</code>
        <code class="k">return</code> <code class="kc">null</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="k">return</code> <code class="kc">null</code><code class="o">;</code>
  <code class="o">}</code>
<code class="o">};</code>

<code class="n">Channel</code> <code class="n">c</code> <code class="o">=</code>
  <code class="o">(</code><code class="n">Channel</code><code class="o">)</code> <code class="n">Proxy</code><code class="o">.</code><code class="na">newProxyInstance</code><code class="o">(</code><code class="n">Channel</code><code class="o">.</code><code class="na">class</code><code class="o">.</code><code class="na">getClassLoader</code><code class="o">(),</code>
                            <code class="k">new</code> <code class="n">Class</code><code class="o">[]</code> <code class="o">{</code> <code class="n">Channel</code><code class="o">.</code><code class="na">class</code> <code class="o">},</code> <code class="n">h</code><code class="o">);</code>
<code class="n">c</code><code class="o">.</code><code class="na">isOpen</code><code class="o">();</code>
<code class="n">c</code><code class="o">.</code><code class="na">close</code><code class="o">();</code></pre>

<p>Proxies can be used as stand-in objects for testing (especially in test
mocking approaches).</p>

<p>Another use case is to provide partial implementations of interfaces,
or to decorate or otherwise control some aspect of delegation:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">RememberingList</code> <code class="kd">implements</code> <code class="n">InvocationHandler</code> <code class="o">{</code>
  <code class="kd">private</code> <code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">proxied</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;&gt;();</code>

  <code class="nd">@Override</code>
  <code class="kd">public</code> <code class="n">Object</code> <code class="nf">invoke</code><code class="o">(</code><code class="n">Object</code> <code class="n">proxy</code><code class="o">,</code> <code class="n">Method</code> <code class="n">method</code><code class="o">,</code> <code class="n">Object</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code>
                         <code class="kd">throws</code> <code class="n">Throwable</code> <code class="o">{</code>
    <code class="n">String</code> <code class="n">name</code> <code class="o">=</code> <code class="n">method</code><code class="o">.</code><code class="na">getName</code><code class="o">();</code>
    <code class="k">switch</code> <code class="o">(</code><code class="n">name</code><code class="o">)</code> <code class="o">{</code>
      <code class="k">case</code> <code class="s">clear</code><code class="o">:</code>
        <code class="k">return</code> <code class="kc">null</code><code class="o">;</code>
      <code class="k">case</code> <code class="s">remove</code><code class="o">:</code>
      <code class="k">case</code> <code class="s">removeAll</code><code class="o">:</code>
        <code class="k">return</code> <code class="kc">false</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="k">return</code> <code class="n">method</code><code class="o">.</code><code class="na">invoke</code><code class="o">(</code><code class="n">proxied</code><code class="o">,</code> <code class="n">args</code><code class="o">);</code>
  <code class="o">}</code>
<code class="o">}</code>

<code class="n">RememberingList</code> <code class="n">hList</code> <code class="o">=</code> <code class="k">new</code> <code class="n">RememberingList</code><code class="o">();</code>

<code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">l</code> <code class="o">=</code>
  <code class="o">(</code><code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;)</code> <code class="n">Proxy</code><code class="o">.</code><code class="na">newProxyInstance</code><code class="o">(</code><code class="n">List</code><code class="o">.</code><code class="na">class</code><code class="o">.</code><code class="na">getClassLoader</code><code class="o">(),</code>
                                        <code class="k">new</code> <code class="n">Class</code><code class="o">[]</code> <code class="o">{</code> <code class="n">List</code><code class="o">.</code><code class="na">class</code> <code class="o">},</code>
                                        <code class="n">hList</code><code class="o">);</code>
<code class="n">l</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="s">cat</code><code class="o">);</code>
<code class="n">l</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="s">bunny</code><code class="o">);</code>
<code class="n">l</code><code class="o">.</code><code class="na">clear</code><code class="o">();</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">l</code><code class="o">);</code></pre>

<p>Proxies are an extremely powerful and flexible capability that are used
within many Java frameworks<a data-startref="ix_ch11-asciidoc14" data-type="indexterm" id="13_idm45941102343640"></a><a data-startref="ix_ch11-asciidoc13" data-type="indexterm" id="13_idm45941102343032"></a>.<a data-startref="ix_ch11-asciidoc9" data-type="indexterm" id="13_idm45941102342296"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Method Handles" data-type="sect1"><div class="sect1" id="idm45941102014776">
<h1>Method Handles</h1>

<p><a data-primary="Method Handles" data-type="indexterm" id="13_ix_ch11-asciidoc15"></a>In Java 7, a brand new mechanism for introspection and method access
was introduced. This was originally designed for use with dynamic
languages, which may need to participate in method dispatch decisions at
runtime. <a data-primary="invokedynamic bytecode" data-type="indexterm" id="13_idm45941102012056"></a>To support this at the JVM level, the new <code>invokedynamic</code>
bytecode was introduced. This bytecode was not used by Java 7 itself,
but with the advent of Java 8, it was extensively used in both lambda
expressions and the Nashorn JavaScript implementation.</p>

<p>Even without <code>invokedynamic</code>, the new Method Handles API is comparable
in power to many aspects of the Reflection API鈥攁nd can be cleaner and
conceptually simpler to use, even standalone. It can be thought of as
Reflection done in a safer, more modern way.</p>








<section data-pdf-bookmark="MethodType" data-type="sect2"><div class="sect2" id="idm45941102009432">
<h2>MethodType</h2>

<p><a data-primary="Method Handles" data-secondary="MethodType objects" data-type="indexterm" id="13_idm45941102007992"></a><a data-primary="MethodType objects" data-type="indexterm" id="13_idm45941102007016"></a>In Reflection, method signatures are represented as <code>Class[]</code>. This is
quite cumbersome. By contrast, method handles rely on <code>MethodType</code>
objects. These are a typesafe and object-oriented way to represent
the type signature of a method.</p>

<p>They include the return type and argument types, but not the receiver
type or name of the method. The name is not present, as this allows any
method of the correct signature to be bound to any name (as per the
functional interface behavior of lambda expressions).</p>

<p>A type signature for a method is represented as an immutable instance of
<code>MethodType</code>, as acquired from the factory method
<code>MethodType.methodType()</code>. For <span class="keep-together">example</span>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">MethodType</code> <code class="n">m2Str</code> <code class="o">=</code> <code class="n">MethodType</code><code class="o">.</code><code class="na">methodType</code><code class="o">(</code><code class="n">String</code><code class="o">.</code><code class="na">class</code><code class="o">);</code> <code class="c1">// toString()</code>

<code class="c1">// Integer.parseInt()</code>
<code class="n">MethodType</code> <code class="n">mtParseInt</code> <code class="o">=</code>
  <code class="n">MethodType</code><code class="o">.</code><code class="na">methodType</code><code class="o">(</code><code class="n">Integer</code><code class="o">.</code><code class="na">class</code><code class="o">,</code> <code class="n">String</code><code class="o">.</code><code class="na">class</code><code class="o">);</code>

<code class="c1">// defineClass() from ClassLoader</code>
<code class="n">MethodType</code> <code class="n">mtdefClz</code> <code class="o">=</code> <code class="n">MethodType</code><code class="o">.</code><code class="na">methodType</code><code class="o">(</code><code class="n">Class</code><code class="o">.</code><code class="na">class</code><code class="o">,</code> <code class="n">String</code><code class="o">.</code><code class="na">class</code><code class="o">,</code>
                                            <code class="kt">byte</code><code class="o">[].</code><code class="na">class</code><code class="o">,</code> <code class="kt">int</code><code class="o">.</code><code class="na">class</code><code class="o">,</code>
                                            <code class="kt">int</code><code class="o">.</code><code class="na">class</code><code class="o">);</code></pre>

<p>This single piece of the puzzle provides significant gains over
Reflection, as it makes method signatures significantly easier to
represent and discuss. The next step is to acquire a handle on a method.
This is achieved by a lookup process.</p>
</div></section>













<section data-pdf-bookmark="Method Lookup" data-type="sect2"><div class="sect2" id="idm45941101940568">
<h2>Method Lookup</h2>

<p><a data-primary="lookup queries" data-type="indexterm" id="13_idm45941101939096"></a><a data-primary="Method Handles" data-secondary="lookup queries" data-type="indexterm" id="13_idm45941101938392"></a>Method lookup queries are performed on the class where a method is
defined, and are dependent on the context that they are executed from.
In this example, we can see that when we attempt to look up the protected
<code>Class::defineClass()</code> method from a general lookup context, we fail to
resolve it with an <code>IllegalAccessException</code>, as the protected method is
not accessible:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">lookupDefineClass</code><code class="o">(</code><code class="n">Lookup</code> <code class="n">l</code><code class="o">)</code> <code class="o">{</code>
  <code class="n">MethodType</code> <code class="n">mt</code> <code class="o">=</code> <code class="n">MethodType</code><code class="o">.</code><code class="na">methodType</code><code class="o">(</code><code class="n">Class</code><code class="o">.</code><code class="na">class</code><code class="o">,</code> <code class="n">String</code><code class="o">.</code><code class="na">class</code><code class="o">,</code>
                                        <code class="kt">byte</code><code class="o">[].</code><code class="na">class</code><code class="o">,</code> <code class="kt">int</code><code class="o">.</code><code class="na">class</code><code class="o">,</code>
                                        <code class="kt">int</code><code class="o">.</code><code class="na">class</code><code class="o">);</code>

  <code class="k">try</code> <code class="o">{</code>
    <code class="n">MethodHandle</code> <code class="n">mh</code> <code class="o">=</code>
      <code class="n">l</code><code class="o">.</code><code class="na">findVirtual</code><code class="o">(</code><code class="n">ClassLoader</code><code class="o">.</code><code class="na">class</code><code class="o">,</code> <code class="s">defineClass</code><code class="o">,</code> <code class="n">mt</code><code class="o">);</code>
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">mh</code><code class="o">);</code>
  <code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">NoSuchMethodException</code> <code class="o">|</code> <code class="n">IllegalAccessException</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>
    <code class="n">e</code><code class="o">.</code><code class="na">printStackTrace</code><code class="o">();</code>
  <code class="o">}</code>
<code class="o">}</code>

<code class="n">Lookup</code> <code class="n">l</code> <code class="o">=</code> <code class="n">MethodHandles</code><code class="o">.</code><code class="na">lookup</code><code class="o">();</code>
<code class="n">lookupDefineClass</code><code class="o">(</code><code class="n">l</code><code class="o">);</code></pre>

<p><a data-primary="MethodHandles.lookup()" data-type="indexterm" id="13_idm45941101934360"></a>We always need to call <code>MethodHandles.lookup()</code>鈥攖his gives us a lookup
context object based on the currently executing method.</p>

<p><a data-primary="Lookup object" data-type="indexterm" id="13_idm45941101777720"></a>Lookup objects have several methods (which all start with <code>find</code>)
declared on them for method resolution. These include <code>findVirtual()</code>,
<code>findConstructor()</code>, and <code>findStatic()</code>.</p>

<p>One big difference between the Reflection and Method Handles APIs is
access control. A <code>Lookup</code> object will only return methods that are
accessible to the context where the lookup was created鈥攁nd there is no
way to subvert this (no equivalent of Reflection鈥檚 <code>setAccessible()</code>
hack).</p>

<p>Method handles therefore always comply with the security manager, even
when the equivalent reflective code does not. They are access-checked at
the point where the lookup context is constructed鈥攖he lookup object will
not return handles to any methods to which it does not have proper
access.</p>

<p>The lookup object, or method handles derived from it, can be returned to
other contexts, including ones where access to the method would no
longer be possible. Under those circumstances, the handle is still
executable鈥攁ccess control is checked at lookup time, as we can see in
this example:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">SneakyLoader</code> <code class="kd">extends</code> <code class="n">ClassLoader</code> <code class="o">{</code>
  <code class="kd">public</code> <code class="nf">SneakyLoader</code><code class="o">()</code> <code class="o">{</code>
    <code class="kd">super</code><code class="o">(</code><code class="n">SneakyLoader</code><code class="o">.</code><code class="na">class</code><code class="o">.</code><code class="na">getClassLoader</code><code class="o">());</code>
  <code class="o">}</code>

  <code class="kd">public</code> <code class="n">Lookup</code> <code class="nf">getLookup</code><code class="o">()</code> <code class="o">{</code>
    <code class="k">return</code> <code class="n">MethodHandles</code><code class="o">.</code><code class="na">lookup</code><code class="o">();</code>
  <code class="o">}</code>
<code class="o">}</code>

<code class="n">SneakyLoader</code> <code class="n">snLdr</code> <code class="o">=</code> <code class="k">new</code> <code class="n">SneakyLoader</code><code class="o">();</code>
<code class="n">l</code> <code class="o">=</code> <code class="n">snLdr</code><code class="o">.</code><code class="na">getLookup</code><code class="o">();</code>
<code class="n">lookupDefineClass</code><code class="o">(</code><code class="n">l</code><code class="o">);</code></pre>

<p>With a <code>Lookup</code> object, we鈥檙e able to produce method handles to any
method we have access to. We can also produce a way of accessing fields
that may not have a method that gives access. The <code>findGetter()</code> and
<code>findSetter()</code> methods on <code>Lookup</code> produce method handles that can read
or update fields as needed.</p>
</div></section>













<section data-pdf-bookmark="Invoking Method Handles" data-type="sect2"><div class="sect2" id="idm45941101939976">
<h2>Invoking Method Handles</h2>

<p><a data-primary="Method Handles" data-secondary="invoking" data-type="indexterm" id="13_idm45941101635272"></a>A method handle represents the ability to call a method. They are
strongly typed and as typesafe as possible. Instances are all of some
subclass of <code>java.lang.invoke.MethodHandle</code>, which is a class that needs
special treatment from the JVM.</p>

<p>There are two ways to invoke a method handle鈥?code&gt;invoke()</code> and
<code>invokeExact()</code>. Both of these take the receiver and call arguments as
parameters. <code>invokeExact()</code> tries to call the method handle directly as
is, whereas <code>invoke()</code> will massage call arguments if needed.</p>

<p><a data-primary="invoke()" data-type="indexterm" id="13_idm45941101741720"></a>In general, <code>invoke()</code> performs an <code>asType()</code> conversion if
necessary鈥攖his converts arguments according to these rules:</p>

<ul>
<li>
<p>A primitive argument will be boxed if required.</p>
</li>
<li>
<p>A boxed primitive will be unboxed if required.</p>
</li>
<li>
<p>Primitives will be widened is necessary.</p>
</li>
<li>
<p>A <code>void</code> return type will be massaged to 0 or <code>null</code>, depending on
whether the expected return was primitive or of reference type.</p>
</li>
<li>
<p><code>null</code> values are passed through, regardless of static type.</p>
</li>
</ul>

<p>With these potential conversions in place, invocation looks like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Object</code> <code class="n">rcvr</code> <code class="o">=</code> <code class="s">a</code><code class="o">;</code>
<code class="k">try</code> <code class="o">{</code>
  <code class="n">MethodType</code> <code class="n">mt</code> <code class="o">=</code> <code class="n">MethodType</code><code class="o">.</code><code class="na">methodType</code><code class="o">(</code><code class="kt">int</code><code class="o">.</code><code class="na">class</code><code class="o">);</code>
  <code class="n">MethodHandles</code><code class="o">.</code><code class="na">Lookup</code> <code class="n">l</code> <code class="o">=</code> <code class="n">MethodHandles</code><code class="o">.</code><code class="na">lookup</code><code class="o">();</code>
  <code class="n">MethodHandle</code> <code class="n">mh</code> <code class="o">=</code> <code class="n">l</code><code class="o">.</code><code class="na">findVirtual</code><code class="o">(</code><code class="n">rcvr</code><code class="o">.</code><code class="na">getClass</code><code class="o">(),</code> <code class="s">hashCode</code><code class="o">,</code> <code class="n">mt</code><code class="o">);</code>

  <code class="kt">int</code> <code class="n">ret</code><code class="o">;</code>
  <code class="k">try</code> <code class="o">{</code>
    <code class="n">ret</code> <code class="o">=</code> <code class="o">(</code><code class="kt">int</code><code class="o">)</code><code class="n">mh</code><code class="o">.</code><code class="na">invoke</code><code class="o">(</code><code class="n">rcvr</code><code class="o">);</code>
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">ret</code><code class="o">);</code>
  <code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">Throwable</code> <code class="n">t</code><code class="o">)</code> <code class="o">{</code>
    <code class="n">t</code><code class="o">.</code><code class="na">printStackTrace</code><code class="o">();</code>
  <code class="o">}</code>
<code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">IllegalArgumentException</code> <code class="o">|</code>
  <code class="n">NoSuchMethodException</code> <code class="o">|</code> <code class="n">SecurityException</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>
  <code class="n">e</code><code class="o">.</code><code class="na">printStackTrace</code><code class="o">();</code>
<code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">IllegalAccessException</code> <code class="n">x</code><code class="o">)</code> <code class="o">{</code>
  <code class="n">x</code><code class="o">.</code><code class="na">printStackTrace</code><code class="o">();</code>
<code class="o">}</code></pre>

<p>Method handles provide a clearer and more coherent way to access the
same dynamic programming capabilities as Reflection. In addition, they
are designed to work well with the low-level execution model of the JVM
and thus hold out the promise of much better performance than Reflection
can provide.<a data-startref="ix_ch11-asciidoc15" data-type="indexterm" id="13_idm45941101730168"></a></p>
</div></section>





</div></section>







<div data-type="footnotes"><p data-type="footnote" id="idm45941103482152"><sup><a class="totri-footnote" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch11.html#idm45941103482152-marker">1</a></sup> As in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch06.html#javanut7-CHP-6">Chapter 6</a>, we鈥檙e borrowing the expression <em>transitive closure</em> from the branch of mathematics called graph theory.</p></div></div></section><div class="annotator-outer annotator-viewer viewer annotator-hide"> </div></div></div>
    </section>
  </div>
</div>

<hr/>

<!--if IE]><![endif]--><!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/java-in-a/9781492037248/ch12.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="3866890"
  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"
  data-username="levinxccai"
  data-account-type="B2B"
  
  data-activated-trial-date="11/06/2017"


  data-archive="9781492037248"
  data-publishers="O&#39;Reilly Media, Inc."



  data-htmlfile-name="ch12.html"
  data-epub-title="Java in a Nutshell, 7th Edition" data-debug=0 data-testing=0><![endif]--><!--if gt IE 8]><!--><!--![endif]-->



<a name="14_"></a>
<div id="MathJax_Message" style="display: none;"></div>
<div class="application" id="container" style="height: auto;">
  <div class="js-toc">
    <section role="document">
      <div id="sbo-rt-content" style="max-width:72.5em; transform: none;"><div class="annotator-wrapper"><section data-nutshell-tab="Modules" data-pdf-bookmark="Chapter 12. Java Platform Modules" data-type="chapter" epub:type="chapter"><div class="chapter" id="javanut7-CHP-12">
<h1><span class="label">Chapter 12. </span>Java Platform Modules</h1>


<p><a data-primary="Java Platform Modules System (JPMS)" data-type="indexterm" id="14_ix_ch12-asciidoc0"></a><a data-primary="modules" data-seealso="Java Platform Modules System (JPMS)" data-type="indexterm" id="14_idm45941101502200"></a>With the release of <a data-primary="Java 9" data-secondary="platform modules" data-type="indexterm" id="14_idm45941101501160"></a>Java 9, the platform finally gained the long-awaited modules system.
<a data-primary="Oracle Corporation" data-secondary="Java 7 release" data-type="indexterm" id="14_idm45941101500056"></a>This feature had originally been intended to ship as part of Sun鈥檚 Java 7 release, before the acquisition by Oracle.
However, the task proved to be far more complex and subtle than anticipated.</p>

<p>When Oracle acquired Java (as part of the technology they received from Sun Microsystems) Mark Reinhold, Java鈥檚 Chief Architect, <a href="https://mreinhold.org/blog/rethinking-jdk7">proposed 鈥淧lan B鈥?/a&gt;, which reduced the scope of Java 7 to allow for a quicker release.</p>

<p>Java platform modules (鈥淧roject Jigsaw鈥? was pushed back, along with lambdas, to Java 8.
However, during the development of Java 8, the size and complexity of the feature <a href="https://mreinhold.org/blog/late-for-the-train">led to a decision</a> that, rather than delay Java 8 (and availability of lambdas and other highly desired features), it would be better to defer modules to Java 9.</p>

<p>The end result was that the modules capability was delayed first to Java 8 and then to Java 9.
Even then, the scope of the work led to substantial delays in the release of Java 9, and so modules did not actually ship until September 2017.</p>

<p>In this chapter we will provide a basic introduction to the <em>Java Platform Modules System</em> (JPMS).
However, this is a large and complex subject鈥攊nterested readers may well require a more in-depth reference, such as <a class="orm:hideurl" href="http://shop.oreilly.com/product/0636920049494.do"><em>Java 9 Modularity</em></a> by Sander Mak and Paul Bakker (O鈥橰eilly).</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>Modules are a relatively advanced feature that are primarily about packaging and deploying entire applications and their dependencies. It is not necessary for a new Java programmer to fully understand this topic while still learning how to write simple Java programs.</p>
</div>

<p>Due to the advanced nature of modules, this chapter assumes you are familiar with a modern Java build tool, such as Gradle or Maven.
If you are new to Java, you can safely ignore references to those tools and just read the chapter to get a first, high-level overview of JPMS.</p>






<section data-pdf-bookmark="Why Modules?" data-type="sect1"><div class="sect1" id="idm45941101491112">
<h1>Why Modules?</h1>

<p><a data-primary="Java Platform Modules System (JPMS)" data-secondary="reasons for creation of" data-type="indexterm" id="14_ix_ch12-asciidoc1"></a>There were several major motivating reasons for wanting to add modules to the Java platform.
These included a desire for:</p>

<ul>
<li>
<p>Strong encapsulation</p>
</li>
<li>
<p>Well-defined interfaces</p>
</li>
<li>
<p>Explicit dependencies</p>
</li>
</ul>

<p>These are all language (and application design) level, and they were combined with the promise of new platform-level capabilities as well:</p>

<ul>
<li>
<p>Scalable development</p>
</li>
<li>
<p>Improved performance (especially startup time) and reduced footprint</p>
</li>
<li>
<p>Reduced attack surface and better security</p>
</li>
<li>
<p>Evolvable internals</p>
</li>
</ul>

<p>On the encapsulation point, this was driven by the fact that the original language specification only supports private, public, protected, and package-private visibility levels.
There is no way to control access in a more fine-grained way to express concepts such as:</p>

<ul>
<li>
<p>Only specified packages are available as an API鈥攐thers are internal and may not be accessed</p>
</li>
<li>
<p>Certain packages can be accessed by this list of packages but no others</p>
</li>
<li>
<p>Defining a strict exporting mechanism</p>
</li>
</ul>

<p>The lack of these and related capabilities has been a significant shortcoming when architecting larger Java systems.
Not only that, but without a suitable protection mechanism, it would be very difficult to evolve the internals of the JDK鈥攁s nothing prevents user applications from directly accessing implementation classes.</p>

<p>The modules system attempts to address all of these concerns at once and to provide a solution that works both for the JDK and for user applications.</p>








<section data-pdf-bookmark="Modularizing the JDK" data-type="sect2"><div class="sect2" id="idm45941101474984">
<h2>Modularizing the JDK</h2>

<p><a data-primary="Java Platform Modules System (JPMS)" data-secondary="modularizing the JDK" data-type="indexterm" id="14_ix_ch12-asciidoc2"></a><a data-primary="JDK (Java Development Kit), modularizing of" data-type="indexterm" id="14_ix_ch12-asciidoc3"></a>The monolithic JDK that shipped with Java 8 was the first target for the modules system, and the familiar <code>rt.jar</code> was broken up into modules.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Java 8 had begun the work of modularisation, by shipping a feature called <em>Compact Profiles</em> that tidied up the code and made it possible to ship a reduced runtime footprint.</p>
</div>

<p><a data-primary="java.base" data-type="indexterm" id="14_idm45941101468344"></a><code>java.base</code> is the module that represents the minimum that鈥檚 actually needed for a Java application to start up.
It contains core packages, such as:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">java</code><code class="o">.</code><code class="na">io</code>
<code class="n">java</code><code class="o">.</code><code class="na">lang</code>
<code class="n">java</code><code class="o">.</code><code class="na">math</code>
<code class="n">java</code><code class="o">.</code><code class="na">net</code>
<code class="n">java</code><code class="o">.</code><code class="na">nio</code>
<code class="n">java</code><code class="o">.</code><code class="na">security</code>
<code class="n">java</code><code class="o">.</code><code class="na">text</code>
<code class="n">java</code><code class="o">.</code><code class="na">time</code>
<code class="n">java</code><code class="o">.</code><code class="na">util</code>
<code class="n">javax</code><code class="o">.</code><code class="na">crypto</code>
<code class="n">javax</code><code class="o">.</code><code class="na">net</code>
<code class="n">javax</code><code class="o">.</code><code class="na">security</code></pre>

<p>along with some subpackages and non-exported implementation packages such as <code>sun.text.resources</code>.
Some of the differences in compilation behavior between Java 8 and modular Java can be seen in this simple program, which extends an internal public class contained in <code>java.base</code>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kn">import</code> <code class="nn">java.util.Arrays</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">sun.text.resources.FormatData</code><code class="o">;</code>

<code class="kd">public</code> <code class="kd">final</code> <code class="kd">class</code> <code class="nc">FormatStealer</code> <code class="kd">extends</code> <code class="n">FormatData</code> <code class="o">{</code>
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">FormatStealer</code> <code class="n">fs</code> <code class="o">=</code> <code class="k">new</code> <code class="n">FormatStealer</code><code class="o">();</code>
        <code class="n">fs</code><code class="o">.</code><code class="na">run</code><code class="o">();</code>
    <code class="o">}</code>

    <code class="kd">private</code> <code class="kt">void</code> <code class="nf">run</code><code class="o">()</code> <code class="o">{</code>
        <code class="n">String</code><code class="o">[]</code> <code class="n">s</code> <code class="o">=</code> <code class="o">(</code><code class="n">String</code><code class="o">[])</code> <code class="n">handleGetObject</code><code class="o">(</code><code class="s">japanese.Eras</code><code class="o">);</code>
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">Arrays</code><code class="o">.</code><code class="na">toString</code><code class="o">(</code><code class="n">s</code><code class="o">));</code>

        <code class="n">Object</code><code class="o">[][]</code> <code class="n">contents</code> <code class="o">=</code> <code class="n">getContents</code><code class="o">();</code>
        <code class="n">Object</code><code class="o">[]</code> <code class="n">eraData</code> <code class="o">=</code> <code class="n">contents</code><code class="o">[</code><code class="mi">14</code><code class="o">];</code>
        <code class="n">Object</code><code class="o">[]</code> <code class="n">eras</code> <code class="o">=</code> <code class="o">(</code><code class="n">Object</code><code class="o">[])</code><code class="n">eraData</code><code class="o">[</code><code class="mi">1</code><code class="o">];</code>
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">Arrays</code><code class="o">.</code><code class="na">toString</code><code class="o">(</code><code class="n">eras</code><code class="o">));</code>
    <code class="o">}</code>
<code class="o">}</code></pre>

<p>When compiled and run under Java 8, this produces a list of Japanese eras:</p>

<pre data-type="programlisting">[, Meiji, Taisho, Showa, Heisei]
[, Meiji, Taisho, Showa, Heisei]</pre>

<p>However, attempting to compile the code on Java 11 produces this error message:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">$</code> <code class="n">javac</code> <code class="n">javanut7</code><code class="o">/</code><code class="n">ch12</code><code class="o">/</code><code class="n">FormatStealer</code><code class="o">.</code><code class="na">java</code>
<code class="n">javanut7</code><code class="o">/</code><code class="n">ch12</code><code class="o">/</code><code class="n">FormatStealer</code><code class="o">.</code><code class="na">java</code><code class="o">:</code><code class="mi">4</code><code class="o">:</code>
        <code class="nl">error:</code> <code class="kn">package</code> <code class="n">sun</code><code class="o">.</code><code class="na">text</code><code class="o">.</code><code class="na">resources</code> <code class="n">is</code> <code class="n">not</code> <code class="n">visible</code>
<code class="kn">import</code> <code class="nn">sun.text.resources.FormatData</code><code class="o">;</code>
               <code class="o">^</code>
  <code class="o">(</code><code class="kn">package</code> <code class="n">sun</code><code class="o">.</code><code class="na">text</code><code class="o">.</code><code class="na">resources</code> <code class="n">is</code> <code class="n">declared</code> <code class="n">in</code> <code class="n">module</code>
        <code class="n">java</code><code class="o">.</code><code class="na">base</code><code class="o">,</code> <code class="n">which</code> <code class="n">does</code> <code class="n">not</code> <code class="n">export</code> <code class="n">it</code> <code class="n">to</code> <code class="n">the</code> <code class="n">unnamed</code> <code class="n">module</code><code class="o">)</code>
<code class="n">javanut7</code><code class="o">/</code><code class="n">ch12</code><code class="o">/</code><code class="n">FormatStealer</code><code class="o">.</code><code class="na">java</code><code class="o">:</code><code class="mi">14</code><code class="o">:</code> <code class="nl">error:</code> <code class="n">cannot</code> <code class="n">find</code> <code class="n">symbol</code>
        <code class="n">String</code><code class="o">[]</code> <code class="n">s</code> <code class="o">=</code> <code class="o">(</code><code class="n">String</code><code class="o">[])</code> <code class="n">handleGetObject</code><code class="o">(</code><code class="s">japanese.Eras</code><code class="o">);</code>
                                <code class="o">^</code>
  <code class="nl">symbol:</code>   <code class="n">method</code> <code class="n">handleGetObject</code><code class="o">(</code><code class="n">String</code><code class="o">)</code>
  <code class="nl">location:</code> <code class="kd">class</code> <code class="nc">FormatStealer</code>
<code class="n">javanut7</code><code class="o">/</code><code class="n">ch12</code><code class="o">/</code><code class="n">FormatStealer</code><code class="o">.</code><code class="na">java</code><code class="o">:</code><code class="mi">17</code><code class="o">:</code> <code class="nl">error:</code> <code class="n">cannot</code> <code class="n">find</code> <code class="n">symbol</code>
        <code class="n">Object</code><code class="o">[][]</code> <code class="n">contents</code> <code class="o">=</code> <code class="n">getContents</code><code class="o">();</code>
                              <code class="o">^</code>
  <code class="nl">symbol:</code>   <code class="n">method</code> <code class="n">getContents</code><code class="o">()</code>
  <code class="nl">location:</code> <code class="kd">class</code> <code class="nc">FormatStealer</code>
<code class="mi">3</code> <code class="n">errors</code></pre>

<p>With a modular Java, even classes that are public cannot be accessed unless they are explicitly exported by the module they are defined in.
We can temporarily force the compiler to use the internal package (basically reasserting the old access rules) with the <code>--add-exports</code> switch, like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">$</code> <code class="n">javac</code> <code class="o">--</code><code class="n">add</code><code class="o">-</code><code class="n">exports</code> <code class="n">java</code><code class="o">.</code><code class="na">base</code><code class="o">/</code><code class="n">sun</code><code class="o">.</code><code class="na">text</code><code class="o">.</code><code class="na">resources</code><code class="o">=</code><code class="n">ALL</code><code class="o">-</code><code class="n">UNNAMED</code> <code class="err">\</code>
        <code class="n">javanut7</code><code class="o">/</code><code class="n">ch12</code><code class="o">/</code><code class="n">FormatStealer</code><code class="o">.</code><code class="na">java</code>
<code class="n">javanut7</code><code class="o">/</code><code class="n">ch12</code><code class="o">/</code><code class="n">FormatStealer</code><code class="o">.</code><code class="na">java</code><code class="o">:</code><code class="mi">5</code><code class="o">:</code>
        <code class="nl">warning:</code> <code class="n">FormatData</code> <code class="n">is</code> <code class="n">internal</code> <code class="n">proprietary</code> <code class="n">API</code> <code class="n">and</code> <code class="n">may</code> <code class="n">be</code>
        <code class="n">removed</code> <code class="n">in</code> <code class="n">a</code> <code class="n">future</code> <code class="n">release</code>
<code class="kn">import</code> <code class="nn">sun.text.resources.FormatData</code><code class="o">;</code>
                         <code class="o">^</code>
<code class="n">javanut7</code><code class="o">/</code><code class="n">ch12</code><code class="o">/</code><code class="n">FormatStealer</code><code class="o">.</code><code class="na">java</code><code class="o">:</code><code class="mi">7</code><code class="o">:</code>
        <code class="nl">warning:</code> <code class="n">FormatData</code> <code class="n">is</code> <code class="n">internal</code> <code class="n">proprietary</code> <code class="n">API</code> <code class="n">and</code> <code class="n">may</code> <code class="n">be</code>
        <code class="n">removed</code> <code class="n">in</code> <code class="n">a</code> <code class="n">future</code> <code class="n">release</code>
<code class="kd">public</code> <code class="kd">final</code> <code class="kd">class</code> <code class="nc">FormatStealer</code> <code class="kd">extends</code> <code class="n">FormatData</code> <code class="o">{</code>
                                         <code class="o">^</code>
<code class="mi">2</code> <code class="n">warnings</code></pre>

<p>We need to specify that the export is being granted to the <em>unnamed module</em>, as we are compiling our class standalone and not as part of a module.
The compiler warns us that we鈥檙e using an internal API and that this might break with a future release of Java.</p>

<p>Interestingly, if our code is run on Java 11, then the output produced is slightly <span class="keep-together">different</span>:</p>

<pre data-type="programlisting">[, Meiji, Taisho, Showa, Heisei, NewEra]
[, Meiji, Taisho, Showa, Heisei, NewEra]</pre>

<p>This is because the Japanese era will change from Heisei (the current era) to a new one on May 1, 2019.
By tradition, the name of the new era is not known ahead of time, so 鈥淣ewEra鈥?is a placeholder for the name that will be replaced by the official name in a future release.
Unicode code point <code>U+32FF</code> has been reserved for the character that will represent the new era name.</p>

<p>Although <code>java.base</code> is the absolute minimum that an application needs to start up, at compile time we want the visible platform to be as close to the expected (Java 8) experience as possible.</p>

<p><a data-primary="umbrella module" data-type="indexterm" id="14_idm45941101087880"></a>This means that we use a much larger set of modules, contained under an <em>umbrella</em> module, <code>java.se</code>.
This module has a dependency graph, shown in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch12.html#javanut7-CHP-12-FIG-1">Figure 12-1</a>.</p>

<figure><div class="figure" id="javanut7-CHP-12-FIG-1">
<img alt="JN7 1201" data-mfp-src="/library/view/java-in-a/9781492037248/assets/jns7_1201.png" height="729" src="https://learning.oreilly.com/library/view/java-in-a/9781492037248/assets/jns7_1201.png" width="1481"/>
<h6><span class="label">Figure 12-1. </span>Module dependency graph of java.se</h6>
</div></figure>

<p>This brings in almost all of the classes and packages that most Java developers expect and use.
<a data-primary="java.se.ee module" data-type="indexterm" id="14_idm45941101082792"></a>However, the modules defining the CORBA and Java EE APIs are not required by <code>java.se</code>, but they are required by the <code>java.se.ee</code> module.</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>This means that any project that depends on the Java EE APIs (or CORBA) will not compile by default on Java 9 onward and a special build config must be used.</p>
</div>

<p>This includes APIs like JAXB鈥攖o make such projects compile, <code>java.se.ee</code> must be explicitly included in the build.</p>

<p>As well as these changes to compilation visibility, due to the modularization of the JDK, the modules system is also intended to allow developers to modularize their own code<a data-startref="ix_ch12-asciidoc3" data-type="indexterm" id="14_idm45941101078280"></a><a data-startref="ix_ch12-asciidoc2" data-type="indexterm" id="14_idm45941101077576"></a>.<a data-startref="ix_ch12-asciidoc1" data-type="indexterm" id="14_idm45941101076776"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Writing Your Own Modules" data-type="sect1"><div class="sect1" id="idm45941101490488">
<h1>Writing Your Own Modules</h1>

<p><a data-primary="Java Platform Modules System (JPMS)" data-secondary="writing your own modules" data-type="indexterm" id="14_ix_ch12-asciidoc4"></a>In this section, we will discuss the basic concepts needed to start writing modular Java applications.</p>








<section data-pdf-bookmark="Basic Modules Syntax" data-type="sect2"><div class="sect2" id="idm45941101073464">
<h2>Basic Modules Syntax</h2>

<p><a data-primary="Java Platform Modules System (JPMS)" data-secondary="basic modules syntax" data-type="indexterm" id="14_idm45941101071896"></a><a data-primary="module descriptor" data-type="indexterm" id="14_idm45941101070904"></a><a data-primary="module-info.java file" data-type="indexterm" id="14_idm45941101070232"></a>The key to modularizing is the new file <em>module-info.java</em>, which contains a description of a module. This is referred to as a <em>module descriptor</em>.</p>

<p>A module is laid out for compilation correctly on the filesystem in the following way:</p>

<ul>
<li>
<p>Below the source root of the project (<em>src</em>), there needs to be a directory named the same as the module (the <em>moduledir</em>).</p>
</li>
<li>
<p>Inside the <em>moduledir</em> is the <em>module-info.java</em>, at the same level as where the packages start from.</p>
</li>
</ul>

<p>The module info is compiled to a binary format, <em>module-info.class</em>, which contains the metadata that will be used when a modular runtime attempts to link and run our application.
Let鈥檚 look at a simple example of a <em>module-info.java</em>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">module</code> <code class="n">kathik</code> <code class="o">{</code>
    <code class="n">requires</code> <code class="n">java</code><code class="o">.</code><code class="na">net</code><code class="o">.</code><code class="na">http</code><code class="o">;</code>

    <code class="n">exports</code> <code class="n">kathik</code><code class="o">.</code><code class="na">main</code><code class="o">;</code>
<code class="o">}</code></pre>

<p>This introduces some new syntax: <code>module</code>, <code>exports</code>, and <code>requires</code>鈥攂ut these are not really full keywords in the accepted sense. As stated in the Java Language Specification SE 9:</p>
<blockquote>
<p><a data-primary="restricted keywords" data-type="indexterm" id="14_idm45941101039352"></a>A further ten character sequences are restricted keywords: <code>open</code>, <code>module</code>, <code>requires</code>, <code>transitive</code>, <code>exports</code>, <code>opens</code>, <code>to</code>, <code>uses</code>, <code>provides</code>, and  <code>with</code>. These character sequences are tokenized as keywords solely where they appear as terminals in the <code>ModuleDeclaration</code> and <code>ModuleDirective</code> <span class="keep-together">productions</span>.</p></blockquote>

<p>This means that these keywords can only appear in the module metadata and are compiled into the binary format by <code>javac</code>.
The meaning of the major restricted keywords is:</p>
<dl>
<dt><code>module</code></dt>
<dd>
<p><a data-primary="module keyword" data-type="indexterm" id="14_idm45941101029608"></a>Starts the module鈥檚 metadata declaration</p>
</dd>
<dt><code>requires</code></dt>
<dd>
<p><a data-primary="requires keyword" data-type="indexterm" id="14_idm45941101027608"></a>Lists a module on which this module depends</p>
</dd>
<dt><code>exports</code></dt>
<dd>
<p><a data-primary="exports keyword" data-type="indexterm" id="14_idm45941101025432"></a>Declares which packages are exported as an API</p>
</dd>
</dl>

<p>The remaining keywords will be introduced throughout the rest of the chapter.</p>

<p>In our example, this means that we鈥檙e declaring a module <code>kathik</code> that depends upon the module <code>java.net.http</code> that was standardized in Java 11 (as well as an implicit dependency on <code>java.base</code>).
The module exports a single package, <code>kathik.main</code>, which is the only package in this module that will be accessible from other modules at compile time.</p>
</div></section>













<section data-pdf-bookmark="Building a Simple Modular Application" data-type="sect2"><div class="sect2" id="idm45941101072872">
<h2>Building a Simple Modular Application</h2>

<p><a data-primary="Java Platform Modules System (JPMS)" data-secondary="building a simple modular application" data-type="indexterm" id="14_idm45941101020232"></a>As an example, let鈥檚 build a simple tool that checks whether websites are using HTTP/2 yet, using the API that we met in <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch10.html#javanut7-CHP-10">Chapter 10</a>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kn">import</code> <code class="nn">static</code> <code class="n">java</code><code class="o">.</code><code class="na">net</code><code class="o">.</code><code class="na">http</code><code class="o">.</code><code class="na">HttpResponse</code><code class="o">.</code><code class="na">BodyHandlers</code><code class="o">.</code><code class="na">ofString</code><code class="o">;</code>

<code class="kd">public</code> <code class="kd">final</code> <code class="kd">class</code> <code class="nc">HTTP2Checker</code> <code class="o">{</code>
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">Exception</code> <code class="o">{</code>
        <code class="k">if</code> <code class="o">(</code><code class="n">args</code><code class="o">.</code><code class="na">length</code> <code class="o">==</code> <code class="mi">0</code><code class="o">)</code> <code class="o">{</code>
            <code class="n">System</code><code class="o">.</code><code class="na">err</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">Provide URLS to check</code><code class="o">);</code>
        <code class="o">}</code>
        <code class="k">for</code> <code class="o">(</code><code class="kd">final</code> <code class="n">var</code> <code class="n">location</code> <code class="o">:</code> <code class="n">args</code><code class="o">)</code> <code class="o">{</code>
            <code class="n">var</code> <code class="n">client</code> <code class="o">=</code> <code class="n">HttpClient</code><code class="o">.</code><code class="na">newBuilder</code><code class="o">().</code><code class="na">build</code><code class="o">();</code>
            <code class="n">var</code> <code class="n">uri</code> <code class="o">=</code> <code class="k">new</code> <code class="n">URI</code><code class="o">(</code><code class="n">location</code><code class="o">);</code>
            <code class="n">var</code> <code class="n">req</code> <code class="o">=</code> <code class="n">HttpRequest</code><code class="o">.</code><code class="na">newBuilder</code><code class="o">(</code><code class="n">uri</code><code class="o">).</code><code class="na">build</code><code class="o">();</code>

            <code class="n">var</code> <code class="n">response</code> <code class="o">=</code> <code class="n">client</code><code class="o">.</code><code class="na">send</code><code class="o">(</code><code class="n">req</code><code class="o">,</code>
                    <code class="n">ofString</code><code class="o">(</code><code class="n">Charset</code><code class="o">.</code><code class="na">defaultCharset</code><code class="o">()));</code>
            <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">location</code> <code class="o">+</code><code class="s">: </code><code class="o">+</code> <code class="n">response</code><code class="o">.</code><code class="na">version</code><code class="o">());</code>
        <code class="o">}</code>
    <code class="o">}</code>
<code class="o">}</code></pre>

<p>This relies on two modules鈥?code&gt;java.net.http</code> and the ubiquitous <code>java.base</code>.
The module file for the app is very simple:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">module</code> <code class="n">http2checker</code> <code class="o">{</code>
    <code class="n">requires</code> <code class="n">java</code><code class="o">.</code><code class="na">net</code><code class="o">.</code><code class="na">http</code><code class="o">;</code>
<code class="o">}</code></pre>

<p>Assuming a simple, standard module layout, this can be compiled like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">$</code> <code class="n">javac</code> <code class="o">-</code><code class="n">d</code> <code class="n">out</code><code class="o">/</code><code class="n">http2checker</code><code class="err">\</code>
    <code class="n">src</code><code class="o">/</code><code class="n">http2checker</code><code class="o">/</code><code class="n">javanut7</code><code class="o">/</code><code class="n">ch12</code><code class="o">/</code><code class="n">HTTP2Checker</code><code class="o">.</code><code class="na">java</code><code class="err">\</code>
    <code class="n">src</code><code class="o">/</code><code class="n">http2checker</code><code class="o">/</code><code class="n">module</code><code class="o">-</code><code class="n">info</code><code class="o">.</code><code class="na">java</code></pre>

<p>This creates a compiled module in the <em>out/</em> directory.
For use, it needs to be packaged as a JAR file:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">$</code> <code class="n">jar</code> <code class="o">-</code><code class="n">cfe</code> <code class="n">httpchecker</code><code class="o">.</code><code class="na">jar</code> <code class="n">javanut7</code><code class="o">.</code><code class="na">ch12</code><code class="o">.</code><code class="na">HTTP2Checker</code><code class="err">\</code>
    <code class="o">-</code><code class="n">C</code> <code class="n">out</code><code class="o">/</code><code class="n">http2checker</code><code class="o">/</code> <code class="o">.</code></pre>

<p>We used the <code>-e</code> switch to set an <em>entry point</em> for the module鈥攖hat is, a class to be executed when we use the module as an application.
Let鈥檚 see it in action:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">$</code> <code class="n">java</code> <code class="o">-</code><code class="n">jar</code> <code class="n">httpchecker</code><code class="o">.</code><code class="na">jar</code> <code class="nl">http:</code><code class="c1">//www.google.com</code>
<code class="nl">http:</code><code class="c1">//www.google.com: HTTP_1_1</code>
<code class="n">$</code> <code class="n">java</code> <code class="o">-</code><code class="n">jar</code> <code class="n">httpchecker</code><code class="o">.</code><code class="na">jar</code> <code class="nl">https:</code><code class="c1">//www.google.com</code>
<code class="nl">https:</code><code class="c1">//www.google.com: HTTP_2</code></pre>

<p>This shows that, at the time of writing, Google鈥檚 website was serving its main page over HTTPS using HTTP/2, but still over HTTP/1.1 for legacy HTTP service.</p>

<p>Now that we have seen how to compile and run a simple modular application, let鈥檚 meet some more of the core features of modularity that are needed to build and run full-size applications.</p>
</div></section>













<section data-pdf-bookmark="The Module Path" data-type="sect2"><div class="sect2" id="idm45941101021176">
<h2>The Module Path</h2>

<p><a data-primary="Java Platform Modules System (JPMS)" data-secondary="module path" data-type="indexterm" id="14_idm45941100513608"></a><a data-primary="module path" data-type="indexterm" id="14_idm45941100512664"></a>Many Java developers are familiar with the concept of the classpath.
When working with modular Java applications, we instead need to work with the <em>module path</em>.
This is a new concept for modules that replaces the classpath wherever possible.</p>

<p>Modules carry metadata about their exports and dependencies鈥攖hey are not just a long list of types.
This means that a graph of module dependencies can be built easily and that module resolution can proceed efficiently.</p>

<p>Code that is not yet modularized continues to be placed on the classpath.
This code is loaded into the <em>unnamed module</em>, which is special and can read all other modules that can be reached from <code>java.se</code>.
Using the unnamed module happens automatically when classes are placed
on the classpath.</p>

<p>This provides a migration path to adopting a modular Java runtime without having to migrate to a fully modular application path.
However, it does have two major drawbacks: none of the benefits of modules will be available until the app is fully migrated, and the self-consistency of the classpath must be maintained by hand until modularization is complete.</p>
</div></section>













<section data-pdf-bookmark="Automatic Modules" data-type="sect2"><div class="sect2" id="idm45941100476056">
<h2>Automatic Modules</h2>

<p><a data-primary="automatic modules" data-type="indexterm" id="14_idm45941100474856"></a><a data-primary="Java Platform Modules System (JPMS)" data-secondary="automatic modules" data-type="indexterm" id="14_idm45941100474152"></a>One of the constraints of the modules system is that we can鈥檛 reference JARs on the classpath from named modules.
This is a safety feature鈥攖he designers of the module system wanted the module dependency graph to utilize full metadata.
However, there may be times when modular code needs to reference packages that have not yet been modularized.
The solution for this is to place the unmodified JAR onto the module path directly (and remove it from the classpath).
This has the following features:</p>

<ul>
<li>
<p>A JAR on the module path becomes an <em>automatic module</em></p>
</li>
<li>
<p>Module name derived from JAR name (or read from <code>MANIFEST.MF</code>)</p>
</li>
<li>
<p>Exports every package</p>
</li>
<li>
<p>Requires all other modules (including the unnamed module)</p>
</li>
</ul>

<p>This is another feature designed to mitigate and help with migration, but some safety is still being given up by using automatic modules.</p>
</div></section>













<section data-pdf-bookmark="Open Modules" data-type="sect2"><div class="sect2" id="idm45941100466872">
<h2>Open Modules</h2>

<p><a data-primary="Java Platform Modules System (JPMS)" data-secondary="open modules" data-type="indexterm" id="14_ix_ch12-asciidoc5"></a><a data-primary="open modules" data-type="indexterm" id="14_ix_ch12-asciidoc6"></a>As noted, simply marking a method <code>public</code> no longer guarantees that the element will be accessible everywhere.
Instead, accessibility now depends also upon whether the package containing that element is exported by its defining module.
Another major issue in the design of modules is the use of reflection to access classes.</p>

<p>Reflection is such a wide-ranging, general-purpose mechanism that it is difficult to see, at first glance, how it can be reconciled with the strong encapsulation goals of JPMS.
Worse yet, so many of the Java ecosystem鈥檚 most important libraries and frameworks rely on reflection (e.g., unit testing, dependency injection, and many more) that not having a solution for reflection would make modules impossible to adopt for any real application.</p>

<p>The solution provided is twofold.
First, a module can declare itself an <code>open</code> module, like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">open</code> <code class="n">module</code> <code class="n">kathik</code> <code class="o">{</code>
    <code class="n">exports</code> <code class="n">kathik</code><code class="o">.</code><code class="na">api</code><code class="o">;</code>
<code class="o">}</code></pre>

<p>This declaration has the effect that:</p>

<ul>
<li>
<p>All packages in the module can be accessed via reflection</p>
</li>
<li>
<p>Compile-time access is <em>not</em> provided for non-exported packages</p>
</li>
</ul>

<p>This means that the configuration behaves like a standard module at compile time.
The overall intent is to provide simple compatibility with existing code and frameworks and ease migration pain.
With an open module, the previous expectation of being able to reflectively access code is restored.
In addition, the <code>setAccessible()</code> hack that allows access to <code>private</code> and other methods that would not normally permit access is preserved for open modules.</p>

<p>Finer-grained control over reflective access is also provided via the <code>opens</code> restricted keyword.
This selectively opens specific packages for reflective access by explicitly declaring packages to be accessible via reflection:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">module</code> <code class="n">kathik</code> <code class="o">{</code>
    <code class="n">exports</code> <code class="n">kathik</code><code class="o">.</code><code class="na">api</code><code class="o">;</code>
    <code class="n">opens</code> <code class="n">kathik</code><code class="o">.</code><code class="na">domain</code><code class="o">;</code>
<code class="o">}</code></pre>

<p><a data-primary="object-relational mapping (ORM)" data-type="indexterm" id="14_idm45941100378680"></a>This type of usage is likely to be useful when, for example, you are providing a domain model to be used by a module-aware <em>object-relational mapping</em> (ORM) system that needs full reflective access to the core domain types of a module.</p>

<p>It is possible to go further and restrict reflective access to specific client packages, using the <code>to</code> restricted keyword.
Where possible, this can be a good design principle, but of course such a technique will not work well with a general-purpose framework such as an ORM.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>In a similar way, it is possible to restrict the export of a package to only specific external packages. However, this feature was largely added to help with the modularization of the JDK itself, and it has limited applicability to user modules.</p>
</div>

<p>Not only that, but it is also possible to both export and open a package, but this is not recommended鈥攄uring migration, access to a package should ideally be either compile-time or reflective but not both.</p>

<p>In the case where reflective access is required to a package now contained in a module, the platform provides some switches to act as band-aids for the transitional period.
In particular, the <code>java</code> option <code>--add-opens module/package=ALL-UNNAMED</code> can be used to open a specific package of module for reflective access to all code from the classpath, overriding the behavior of the modules system.</p>
<div data-type="tip"><h6>Tip</h6>
<p>For code that is already modular, it can also be used to allow reflective access to a specific module.</p>
</div>

<p>When you are migrating to modular Java, any code that reflectively accesses internal code of another module should be run with that switch at first, until the situation can be remediated.</p>

<p>Related to this issue of reflective access (and a special case of it) is the issue of widespread use of internal platform APIs by frameworks.
This is usually characterized as the 鈥淯nsafe problem鈥?and we will encounter it toward the end of the chapter.<a data-startref="ix_ch12-asciidoc6" data-type="indexterm" id="14_idm45941100370472"></a><a data-startref="ix_ch12-asciidoc5" data-type="indexterm" id="14_idm45941100369768"></a></p>
</div></section>













<section data-pdf-bookmark="Services" data-type="sect2"><div class="sect2" id="idm45941100466248">
<h2>Services</h2>

<p><a data-primary="Java Platform Modules System (JPMS)" data-secondary="services mechanism" data-type="indexterm" id="14_idm45941100367688"></a><a data-primary="services mechanism (JPMS)" data-type="indexterm" id="14_idm45941100366744"></a>The modules system includes the <em>services</em> mechanism, to mitigate another problem with the advanced form of encapsulation.
This problem is simply explained by considering a familiar piece of code:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kn">import</code> <code class="nn">services.Service</code><code class="o">;</code>
<code class="n">Service</code> <code class="n">s</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ServiceImpl</code><code class="o">();</code></pre>

<p>Even if <code>Service</code> lives in an exported API package, this line of code still will not compile unless the package containing <code>ServiceImpl</code> is also exported.
What we need is a mechanism to allow fine-grained access to classes implementing service classes without needing the entire package to be imported.
For example, we could write something like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">module</code> <code class="n">kathik</code> <code class="o">{</code>
    <code class="n">exports</code> <code class="n">kathik</code><code class="o">.</code><code class="na">api</code><code class="o">;</code>
    <code class="n">requires</code> <code class="n">othermodule</code><code class="o">.</code><code class="na">services</code><code class="o">;</code>

    <code class="n">provides</code> <code class="n">services</code><code class="o">.</code><code class="na">Service</code><code class="o">;</code>
    <code class="n">with</code> <code class="n">kathik</code><code class="o">.</code><code class="na">services</code><code class="o">.</code><code class="na">ServiceImpl</code><code class="o">;</code>
<code class="o">}</code></pre>

<p>Now the <code>ServiceImpl</code> class is accessible at compile time as an implementation of the <code>Service</code> interface.
Note that the <code>services</code> package must be contained in another module, which is required by the current module for this provision to work.</p>
</div></section>













<section data-pdf-bookmark="Multi-Release JARs" data-type="sect2"><div class="sect2" id="idm45941100291896">
<h2>Multi-Release JARs</h2>

<p><a data-primary="JAR (Java archive) files" data-secondary="multi-release" data-type="indexterm" id="14_ix_ch12-asciidoc7"></a><a data-primary="Java Platform Modules System (JPMS)" data-secondary="multi-release JARs" data-type="indexterm" id="14_ix_ch12-asciidoc8"></a>To explain the problem that is solved by multi-release JARs, let鈥檚 consider a simple example: finding the process ID (PID) of the currently executing process (i.e., the JVM that鈥檚 executing our code).</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>We didn鈥檛 use the HTTP/2 example from earlier on, as Java 8 doesn鈥檛 have an HTTP/2 API鈥攕o we would have had to do a huge amount of work (essentially a full backport!) to provide the equivalent functionality for 8.</p>
</div>

<p>This may seem like a simple task, but on Java 8 this requires a surprising amount of boilerplate code:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">GetPID</code> <code class="o">{</code>
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">long</code> <code class="nf">getPid</code><code class="o">()</code> <code class="o">{</code>
        <code class="c1">// This rather clunky call uses JMX to return the name that</code>
        <code class="c1">// represents the currently running JVM. This name is in the</code>
        <code class="c1">// format &lt;pid&gt;@&lt;hostname&gt;鈥攐n OpenJDK and Oracle VMs only鈥攖here</code>
        <code class="c1">// is no guaranteed portable solution for this on Java 8</code>
        <code class="kd">final</code> <code class="n">String</code> <code class="n">jvmName</code> <code class="o">=</code>
            <code class="n">ManagementFactory</code><code class="o">.</code><code class="na">getRuntimeMXBean</code><code class="o">().</code><code class="na">getName</code><code class="o">();</code>
        <code class="kd">final</code> <code class="kt">int</code> <code class="n">index</code> <code class="o">=</code> <code class="n">jvmName</code><code class="o">.</code><code class="na">indexOf</code><code class="o">(</code><code class="sc">@</code><code class="o">);</code>
        <code class="k">if</code> <code class="o">(</code><code class="n">index</code> <code class="o">&lt;</code> <code class="mi">1</code><code class="o">)</code>
            <code class="k">return</code> <code class="o">-</code><code class="mi">1</code><code class="o">;</code>

        <code class="k">try</code> <code class="o">{</code>
            <code class="k">return</code> <code class="n">Long</code><code class="o">.</code><code class="na">parseLong</code><code class="o">(</code><code class="n">jvmName</code><code class="o">.</code><code class="na">substring</code><code class="o">(</code><code class="mi">0</code><code class="o">,</code> <code class="n">index</code><code class="o">));</code>
        <code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">NumberFormatException</code> <code class="n">nfe</code><code class="o">)</code> <code class="o">{</code>
            <code class="k">return</code> <code class="o">-</code><code class="mi">1</code><code class="o">;</code>
        <code class="o">}</code>
    <code class="o">}</code>
<code class="o">}</code></pre>

<p>As we can see, this is nowhere near as straightforward as we might like.
Worse still, it is not supported in a standard way across all Java 8 implementations.
<a data-primary="ProcessHandle API" data-type="indexterm" id="14_idm45941100283848"></a>Fortunately, from Java 9 onward we can use the new <code>ProcessHandle</code> API, like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">GetPID</code> <code class="o">{</code>
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">long</code> <code class="nf">getPid</code><code class="o">()</code> <code class="o">{</code>
        <code class="c1">// Use new Java 9 Process API...</code>
        <code class="n">ProcessHandle</code> <code class="n">processHandle</code> <code class="o">=</code> <code class="n">ProcessHandle</code><code class="o">.</code><code class="na">current</code><code class="o">();</code>
        <code class="k">return</code> <code class="n">processHandle</code><code class="o">.</code><code class="na">getPid</code><code class="o">();</code>
    <code class="o">}</code>
<code class="o">}</code></pre>

<p>This now utilizes a standard API, but it leads to an essential problem: how can the developer write code that is guaranteed to run on all current Java versions?</p>

<p>What we want is to build and run a project correctly in multiple Java versions.
We want to depend on library classes that are only available in later versions, but still run on an earlier version by using some code 鈥渟hims.鈥?
The end result must be a single JAR and we do not require the project to switch to a multi-module format鈥攊n fact, the JAR must work as an automatic module.</p>

<p><a data-primary="Java 11" data-secondary="multi-release JARs" data-type="indexterm" id="14_idm45941100132888"></a>Let鈥檚 look at an example project that has to run correctly in both Java 8 and Java 11.
The main codebase is built with Java 8 and the Java 11 portion must be built with Java 11.
This part of the build must be isolated from the main codebase to prevent compilation failures, although it can depend on the build artifacts of the Java 8 build.</p>

<p>To keep the build configuration simple, this feature is controlled using an entry in <code>MANIFEST.MF</code> within the JAR file:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">Multi</code><code class="o">-</code><code class="nl">Release:</code> <code class="n">True</code></pre>

<p>The variant code (i.e., that for a later version) is then stored in a special directory in <em>META-INF</em>.
In our case, this is <em>META-INF/versions/11</em>.</p>

<p>For a Java runtime that implements this feature, any classes in the version-specific directory override the versions in the content root.
On the other hand, for Java 8 and earlier versions, both the manifest entry and the <em>versions/</em> directory are ignored and only the classes in the content root are found.</p>
</div></section>













<section data-pdf-bookmark="Converting to a Multi-Release JAR" data-type="sect2"><div class="sect2" id="idm45941100291304">
<h2>Converting to a Multi-Release JAR</h2>

<p><a data-primary="Java Platform Modules System (JPMS)" data-secondary="deploying software as multi-release JAR" data-type="indexterm" id="14_idm45941100129048"></a>To start deploying your software as a multi-release JAR, follow this outline:</p>
<ol>
<li>
<p>Isolate code that is JDK-version-specific</p>
</li>
<li>
<p>If possible, place that code into a package or group of packages</p>
</li>
<li>
<p>Get the version 8 project building cleanly</p>
</li>
<li>
<p>Create a new, separate project for the supplementary classes</p>
</li>
<li>
<p>Set up a single dependency for the new project (the version 8 artifact)</p>
</li>

</ol>

<p><a data-primary="Gradle" data-type="indexterm" id="14_idm45941100121432"></a>For Gradle, you can also use the concept of a <em>source set</em> and compile the v11 code using a different (later) compiler.
This can then be built into a JAR using a stanza like this:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">jar</code> <code class="o">{</code>
  <code class="n">into</code><code class="o">(</code><code class="err">&apos;</code><code class="n">META</code><code class="o">-</code><code class="n">INF</code><code class="o">/</code><code class="n">versions</code><code class="o">/</code><code class="mi">11</code><code class="err">&apos;</code><code class="o">)</code> <code class="o">{</code>
     <code class="n">from</code> <code class="n">sourceSets</code><code class="o">.</code><code class="na">java11</code><code class="o">.</code><code class="na">output</code>
  <code class="o">}</code>

  <code class="n">manifest</code><code class="o">.</code><code class="na">attributes</code><code class="o">(</code>
     <code class="err">&apos;</code><code class="n">Multi</code><code class="o">-</code><code class="n">Release</code><code class="err">&apos;</code><code class="o">:</code> <code class="err">&apos;</code><code class="kc">true</code><code class="err">&apos;</code>
  <code class="o">)</code>
<code class="o">}</code></pre>

<p><a data-primary="Maven" data-type="indexterm" id="14_idm45941100032600"></a>For Maven, the current easiest route is to use the Maven Dependency Plug-in, and add the modular classes to the overall JAR as part of the separate <code>generate-resources</code> phase.<a data-startref="ix_ch12-asciidoc8" data-type="indexterm" id="14_idm45941100006584"></a><a data-startref="ix_ch12-asciidoc7" data-type="indexterm" id="14_idm45941100005912"></a></p>
</div></section>













<section data-pdf-bookmark="Migrating to Modules" data-type="sect2"><div class="sect2" id="idm45941100005112">
<h2>Migrating to Modules</h2>

<p><a data-primary="Java Platform Modules System (JPMS)" data-secondary="decision to migrate applications to use modules" data-type="indexterm" id="14_ix_ch12-asciidoc9"></a>Many Java developers are facing the question of when they should migrate their applications to use modules.</p>
<div data-type="tip"><h6>Tip</h6>
<p>Modules should be the default for all greenfield apps, especially those that are architected in a microservices style.</p>
</div>

<p>When considering a migration of an existing app (especially a monolithic design), you can use the following roadmap:</p>
<ol>
<li>
<p><a data-primary="Java 11" data-secondary="migrating to modules" data-type="indexterm" id="14_idm45941099999400"></a>First upgrade the application runtime to Java 11 (running from the classpath initially)</p>
</li>
<li>
<p>Identify any application dependencies that have been modularized and migrate those dependencies to modules</p>
</li>
<li>
<p>Retain any non-modularized dependencies as automatic modules</p>
</li>
<li>
<p>Introduce a single <em>monolithic module</em> of all application code</p>
</li>

</ol>

<p>At this point, a minimally modularized application should now be ready for production deployment.
This module will usually be an <code>open</code> module at this stage of the process.
The next step is architectural refactoring, and it is at this point that applications can be broken out into individual modules as needed.</p>

<p>Once the application code runs in modules, it can make sense to limit reflective access to your code via <code>opens</code>.
This access can be restricted to specific modules (such as ORM or dependency injection modules) as a first step toward removing any unnecessary access.</p>

<p>For Maven users, it鈥檚 worth remembering that Maven is not a modules system, but it does have dependencies鈥攁nd (unlike JPMS dependencies) they are versioned.
The Maven tooling is still evolving to fully integrate with JPMS (and many plug-ins have not caught up yet at the time of this writing).
However, some general guidelines for modular Maven projects are emerging, specifically:</p>

<ul>
<li>
<p>Aim to produce one module per Maven POM</p>
</li>
<li>
<p>Don鈥檛 modularize a Maven project until you are ready (or have an immediate need to)</p>
</li>
<li>
<p>Remember that running on a Java 11 runtime does not require building on a Java 11 toolchain</p>
</li>
</ul>

<p>The last point indicates that one path for migration of Maven projects is to start by building as a Java 8 project and ensuring that those Maven artifacts can deploy cleanly (as automatic modules) on a Java 11 runtime.
Only once that first step is working properly should a full modularization be undertaken.</p>

<p>There is some good tooling support available to help with the modularization process.
Java 8 and up ships with <code>jdeps</code> (see <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch13.html#javanut7-CHP-13">Chapter 13</a>), a tool for determining what packages and modules your code depends upon.
This is very helpful for migrations from Java 8 to 11, and the use of <code>jdeps</code> when rearchitecting is recommended.<a data-startref="ix_ch12-asciidoc9" data-type="indexterm" id="14_idm45941099985528"></a></p>
</div></section>













<section data-pdf-bookmark="Custom Runtime Images" data-type="sect2"><div class="sect2" id="idm45941100004520">
<h2>Custom Runtime Images</h2>

<p><a data-primary="custom runtime images, JMPS and" data-type="indexterm" id="14_idm45941099983416"></a><a data-primary="Java Platform Modules System (JPMS)" data-secondary="custom runtime images" data-type="indexterm" id="14_idm45941099982744"></a>One of the key goals of JPMS is the possibility that applications may need not every class present in the traditional monolithic runtime of Java 8, and instead can manage with a smaller subset of modules.
Such applications can have a much smaller footprint in terms of startup time and memory overhead.
This can be taken further: if not all classes are needed, then why not ship an application together with a reduced, custom runtime image that only includes what鈥檚 necessary?</p>

<p>To demonstrate the idea, let鈥檚 package the HTTP/2 checker into a standalone tool with a custom runtime.
We can use the <code>jlink</code> tool (which has been part of the platform since Java 9) to achieve this as follows:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">$</code> <code class="n">jlink</code> <code class="o">--</code><code class="n">module</code><code class="o">-</code><code class="n">path</code> <code class="n">httpchecker</code><code class="o">.</code><code class="na">jar</code><code class="o">:</code><code class="n">$JAVA_HOME</code><code class="o">/</code><code class="n">jmods</code> <code class="err">\</code>
<code class="o">--</code><code class="n">add</code><code class="o">-</code><code class="n">modules</code> <code class="n">http2checker</code> <code class="err">\</code>
<code class="o">--</code><code class="n">launcher</code> <code class="n">http2chk</code><code class="o">=</code><code class="n">http2checker</code> <code class="err">\</code>
<code class="o">--</code><code class="n">output</code> <code class="n">http2chk</code><code class="o">-</code><code class="n">image</code></pre>

<p>Note that this assumes that the JAR file <em>httpchecker.jar</em> was created with a main class (aka entry point).
The result is an output directory, <em>http2chk-image</em>, which is about 39M in size, much less than the full image, especially taking into account that because the tool uses the new HTTP module it requires the libraries for security, crypto, and so on.</p>

<p>From within the custom image directory we can run the <code>http2chk</code> tool directly, and see that it works even when the machine does not have the required version of <code>java</code>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">$</code> <code class="n">java</code> <code class="o">-</code><code class="n">version</code>
<code class="n">java</code> <code class="n">version</code> <code class="s">1.8.0_144</code>
<code class="n">Java</code><code class="o">(</code><code class="n">TM</code><code class="o">)</code> <code class="n">SE</code> <code class="n">Runtime</code> <code class="n">Environment</code> <code class="o">(</code><code class="n">build</code> <code class="mf">1.8</code><code class="o">.</code><code class="mi">0_144</code><code class="o">-</code><code class="n">b01</code><code class="o">)</code>
<code class="n">Java</code> <code class="nf">HotSpot</code><code class="o">(</code><code class="n">TM</code><code class="o">)</code> <code class="mi">64</code><code class="o">-</code><code class="n">Bit</code> <code class="n">Server</code> <code class="n">VM</code> <code class="o">(</code><code class="n">build</code> <code class="mf">25.144</code><code class="o">-</code><code class="n">b01</code><code class="o">,</code> <code class="n">mixed</code> <code class="n">mode</code><code class="o">)</code>
<code class="n">$</code> <code class="o">./</code><code class="n">bin</code><code class="o">/</code><code class="n">http2chk</code> <code class="nl">https:</code><code class="c1">//www.google.com</code>
<code class="nl">https:</code><code class="c1">//www.google.com: HTTP_2</code></pre>

<p>The deployment of custom runtime images is still a very new tool, but it has great potential to reduce your code footprint and help Java remain competitive in the age of microservices.
In the future, <code>jlink</code> could even be combined with new approaches to compilation, including the Graal compiler, which can be used as an ahead-of-time (AOT) compiler as well as a JIT compiler (see the <code>jaotc</code> ).
As of Java 11, however, combining <code>jlink</code> and <code>jaotc</code> does not seem to offer any conclusive performance gains.<a data-startref="ix_ch12-asciidoc4" data-type="indexterm" id="14_idm45941099833160"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Issues with Modules" data-type="sect1"><div class="sect1" id="idm45941101075816">
<h1>Issues with Modules</h1>

<p><a data-primary="Java Platform Modules System (JPMS)" data-secondary="issues with modules" data-type="indexterm" id="14_ix_ch12-asciidoc10"></a>The modules system, despite being the flagship feature of Java 9 and having had a large amount of engineering time devoted to it, is not without its problems.
This was, perhaps, inevitable鈥攖he feature fundamentally changes the nature of how Java applications are architected and delivered.
It would have been almost impossible for modules to avoid running up against some problems when trying to retrofit over the large, mature ecosystem that is Java.</p>








<section data-pdf-bookmark="Unsafe and Related Problems" data-type="sect2"><div class="sect2" id="idm45941099829112">
<h2>Unsafe and Related Problems</h2>

<p><a data-primary="Java Platform Modules System (JPMS)" data-secondary="Unsafe class and related problems" data-type="indexterm" id="14_idm45941099827736"></a><a data-primary="sun.misc.Unsafe class" data-type="indexterm" id="14_idm45941099826824"></a>The class <code>sun.misc.Unsafe</code> is a class that is both widely used and popular with framework writers and other implementors within the Java world.
However, it is an internal implementation class and is not part of the standard API of the Java platform (as the package name clearly indicates).
The class name also provides a fairly strong clue that this is not really intended for use by Java applications.</p>

<p>Unsafe is an unsupported, internal API and so could be withdrawn or modified by any new Java version, without regard to the effect on user applications.
Any code which does use it is technically directly coupled to the HotSpot VM, and is also potentially nonstandard and may not run on other implementations.</p>

<p>Although not an official part of Java SE in any way, <code>Unsafe</code> has become a de facto standard and key part of the implementation of basically every major framework in one way or another.
Over subsequent versions it has evolved into a kind of dumping ground for nonstandard but necessary features.
This admixture of features is a real mixed bag, with varying degrees of safety provided by each capability.
Example uses of <code>Unsafe</code> include:</p>

<ul>
<li>
<p>Fast de-/serialization</p>
</li>
<li>
<p>Threadsafe 64-bit sized native memory access (e.g., offheap)</p>
</li>
<li>
<p>Atomic memory operations (e.g., Compare-and-Swap)</p>
</li>
<li>
<p>Fast field/memory access</p>
</li>
<li>
<p>Multi-operating system replacement for JNI</p>
</li>
<li>
<p>Access to array items with volatile semantics (see <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch06.html#javanut7-CHP-6">Chapter 6</a>)</p>
</li>
</ul>

<p>The essential problem is that many frameworks/libraries were unable to move to Java 9 without replacement for some <code>Unsafe</code> features.
This impacts everyone using any libraries from a wide range of frameworks鈥攂asically every application in the Java ecosystem.</p>

<p>To fix this problem, Oracle created new supported APIs for some of the needed functionality, and segregated APIs that could not be encapsulated in time into a module, <code>jdk.unsupported</code>, which makes it clear that this is not a supported API and that developers use it at their own risk.</p>

<p>This gives <code>Unsafe</code> a temporary pass (which is strictly limited time) while encouraging library and framework developers to move to the new APIs.
An example of a replacement API is VarHandles.
These extend the <em>Method Handles</em> concept (from <a data-type="xref" href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch11.html#javanut7-CHP-11">Chapter 11</a>), and add new functionality, such as concurrency barrier modes for Java 9.
These, along with some modest updates to JMM, are intended to produce a standard API for accessing new low-level processor features without allowing developers full access to dangerous capabilities, as were found in <code>Unsafe</code>.</p>

<p>More details about <code>Unsafe</code> and related low-level platform techniques can be found in <a class="orm:hideurl" href="http://shop.oreilly.com/product/0636920121718.do"><em>Optimizing Java</em></a> (O鈥橰eilly).</p>
</div></section>













<section data-pdf-bookmark="Lack of Versioning" data-type="sect2"><div class="sect2" id="idm45941099808584">
<h2>Lack of Versioning</h2>

<p><a data-primary="Java Platform Modules System (JPMS)" data-secondary="lack of versioning" data-type="indexterm" id="14_idm45941099807144"></a><a data-primary="versioning, as JPMS deficiency" data-type="indexterm" id="14_idm45941099806152"></a>The JPMS standard as of Java 11 does not include the versioning of dependencies.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>This was a deliberate design decision in order to reduce the complexity of the delivered system, and does not preclude the possibility that modules could include versioned dependencies in the future.</p>
</div>

<p>The current situation requires external tools to handle the versioning of module dependencies.
In the case of Maven, this will be within the project POM.
An advantage to this approach is that the download and management of versions is also handled within the local repository of the build tool.</p>

<p>However it is done, though, the simple fact is that the dependency version information must be stored out of the module and does not form part of the JAR artifact.</p>

<p>There鈥檚 no getting away from it鈥攖his is pretty ugly, but the counterpoint is that the situation is no worse than it was with dependencies being deduced from the <span class="keep-together">classpath</span>.</p>
</div></section>













<section data-pdf-bookmark="Slow Adoption Rates" data-type="sect2"><div class="sect2" id="idm45941099801304">
<h2>Slow Adoption Rates</h2>

<p><a data-primary="Java 9" data-secondary="keystone release model" data-type="indexterm" id="14_idm45941099799992"></a><a data-primary="Java Platform Modules System (JPMS)" data-secondary="adoption rates" data-type="indexterm" id="14_idm45941099799016"></a><a data-primary="keystone release model" data-type="indexterm" id="14_idm45941099798056"></a>With the release of Java 9, the Java release model fundamentally changed.
Java 8 and 9 used the 鈥渒eystone release鈥?model鈥攚here one star feature (such as lambdas or modules) essentially defines the release and so the ship date is determined by when the feature is done.
The problem with this model is that it can cause inefficiencies due to uncertainty about when versions will ship.
In particular, a small feature that just misses a release will have to wait a long time for the next major release.</p>

<p>As a result, from Java 10 onward, a new release model was adopted, which introduces <em>strict time-based versioning</em>.
This involves:</p>

<ul>
<li>
<p>Java releases are now classified as 鈥渇eature鈥?releases, which occur at a regular cadence of once every six months.</p>
</li>
<li>
<p>Features are not merged into the platform until they are essentially complete.</p>
</li>
<li>
<p>The mainline repo is in a releasable state at all times.</p>
</li>
</ul>

<p>These releases are only good for six months, after which time they are no longer supported.
<a data-primary="long-term support (LTS) release" data-type="indexterm" id="14_idm45941099792232"></a>Every three years, a special release is designated as a <em>long-term support</em> (LTS) release, which has extended support available.</p>

<p>Although the Java community is generally positive on the new faster release cycle, adoption rates of Java 9 and above have been much smaller than for previous releases.
This may be due to the desire of larger enterprises to have longer support cycles, rather than upgrading to each feature release after only six months.</p>

<p>It is also the case that the upgrade from Java 8 to 9 is not a drop-in replacement (unlike 7 to 8, and to a lesser extent 6 to 7).
The modules subsystem fundamentally changes many aspects of the Java platform, even if end-user applications do not take advantage of modules.
This makes teams reluctant to upgrade from 8 unless they can see clear benefits in doing so.</p>

<p>This leads to 鈥渃hicken-and-egg鈥?problems, where teams don鈥檛 move, because they perceive that the libraries and other components that they depend upon don鈥檛 yet support modular Java.
On the other side of the equation, the companies and open source communities who maintain libraries and other tools may well feel that because the user population for modular Java is still so small, it鈥檚 a low priority to support versions beyond 8.</p>

<p>The arrival of Java 11, the first post-8 LTS release, may help this situation, as it provides a supported environment that enterprise teams may find more comfortable as a migration target.<a data-startref="ix_ch12-asciidoc10" data-type="indexterm" id="14_idm45941099758728"></a></p>
</div></section>





</div></section>













<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="idm45941099757960">
<h1>Summary</h1>

<p>The modules feature, first introduced in Java 9, aims to solve several problems at once.
The aims of shorter startup time, lower footprint, and reduced complexity by denying access to internals have all been met.
The longer-term goals of enabling better architecture of applications and starting to think about new approaches for compilation and deployment are still in progress.</p>

<p>However, the plain fact is that as of the release of Java 11, not many teams and projects have moved wholeheartedly to the modular world.
This is to be expected, as modularity is a long-term project that has a slow payoff and relies on network effects within the ecosystem to achieve the full benefit.</p>

<p>New applications should definitely consider building in a modular way from the get go, but the overall story of platform modularity within the Java ecosystem is still only beginning itself.<a data-startref="ix_ch12-asciidoc0" data-type="indexterm" id="14_idm45941099754936"></a></p>
</div></section>







</div></section><div class="annotator-outer annotator-viewer viewer annotator-hide"> </div></div></div>
    </section>
  </div>
</div>
<div class="font-flyout" style="top: 200.981px; left: 2474px;"> </div>
<hr/>

<!--if IE]><![endif]--><!--if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/java-in-a/9781492037248/ch13.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="3866890"
  data-user-uuid="72b95c3c-5b13-4319-82fa-5c73754754ca"
  data-username="levinxccai"
  data-account-type="B2B"
  
  data-activated-trial-date="11/06/2017"


  data-archive="9781492037248"
  data-publishers="O&#39;Reilly Media, Inc."



  data-htmlfile-name="ch13.html"
  data-epub-title="Java in a Nutshell, 7th Edition" data-debug=0 data-testing=0><![endif]--><!--if gt IE 8]><!--><!--![endif]-->



<a name="15_"></a>
<div id="MathJax_Message" style="display: none;"></div>
<div class="application" id="container" style="height: auto;">
  <div class="js-toc">
    <section role="document">
      <div id="sbo-rt-content" style="max-width:72.5em; transform: none;"><div class="annotator-wrapper"><section data-nutshell-tab="Platform Tools" data-pdf-bookmark="Chapter 13. Platform Tools" data-type="chapter" epub:type="chapter"><div class="chapter" id="javanut7-CHP-13">
<h1><span class="label">Chapter 13. </span>Platform Tools</h1>


<p>This chapter discusses the tools that ship with the OpenJDK version of the Java platform. The tools covered are all command-line tools.
If you are using a different version of Java, you may find similar but different tools as part of your distribution instead.</p>

<p>Later in the chapter, we devote a dedicated section to the <code>jshell</code> tool, which has introduced interactive development to the Java platform as of version 9.</p>






<section data-pdf-bookmark="Command-Line Tools" data-type="sect1"><div class="sect1" id="javanut7-CHP-13-SECT-1">
<h1>Command-Line Tools</h1>

<p><a data-primary="command-line tools" data-type="indexterm" id="15_idm45941099748632"></a><a data-primary="tools, command-line" data-type="indexterm" id="15_idm45941099747928"></a>The command-line tools we cover are the most commonly used tools, and those of greatest utility鈥攖hey are not a complete description of every tool that is available.
In particular, tools concerned with CORBA and the server portion of RMI are not covered, as these modules have been removed from the platform with the release of Java 11.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>In some cases, we need to discuss switches that take filesystem paths.
As elsewhere in the book, we use Unix conventions for such cases.</p>
</div>

<p>The tools we are discussing are:</p>

<ul>
<li>
<p><code>javac</code></p>
</li>
<li>
<p><code>java</code></p>
</li>
<li>
<p><code>jar</code></p>
</li>
<li>
<p><code>javadoc</code></p>
</li>
<li>
<p><code>jdeps</code></p>
</li>
<li>
<p><code>jps</code></p>
</li>
<li>
<p><code>jstat</code></p>
</li>
<li>
<p><code>jstatd</code></p>
</li>
<li>
<p><code>jinfo</code></p>
</li>
<li>
<p><code>jstack</code></p>
</li>
<li>
<p><code>jmap</code></p>
</li>
<li>
<p><code>javap</code></p>
</li>
<li>
<p><code>jaotc</code></p>
</li>
<li>
<p><code>jlink</code></p>
</li>
<li>
<p><code>jmod</code></p>
</li>
</ul>
<div class="refentry" id="javanut7-CHP-13-SECT-1.1">
<header>
<p class="refname bottom-left">javac</p>
</header>

<div class="refsect1" id="_basic_usage">
<h6>Basic usage</h6>

<p><code>javac <em>some</em>/<em>package</em>/MyClass.java</code></p>
</div>

<div class="refsect1" id="_description">
<h6>Description</h6>

<p><code>javac</code> is the Java source code  compiler鈥攊t produces bytecode (in the form of <em>.class</em> files) from <em>.java</em> source files.</p>

<p>For modern Java projects, <code>javac</code> is not often used directly, as it is rather low-level and unwieldy, especially for larger codebases. Instead, modern integrated development environments (IDEs) either drive <code>javac</code> automatically for the developer or have built-in compilers for use while code is being written. For deployment, most projects will make use of a separate build tool, such as Maven, Ant, or Gradle. Discussion of these tools is outside the scope of this book.</p>

<p>Nevertheless, it is useful for developers to understand how to use <code>javac</code>, as there are cases when compiling small codebases by hand is preferable to having to install and manage a production-grade build tool such as Maven.</p>
</div>

<div class="refsect1" id="_common_switches">
<h6>Common switches</h6>

<dl>
	<dt><code>-classpath</code></dt>
	<dd>
	<p>Supplies classes we need for compilation.</p>
	</dd>
	<dt><code>-d <em>some</em>/<em>dir</em></code></dt>
	<dd>
	<p>Tells <code>javac</code> where to output class files.</p>
	</dd>
	<dt><code>@project.list</code></dt>
	<dd>
	<p>Load options and source files from the file <em>project.list</em>.</p>
	</dd>
	<dt><code>-help</code></dt>
	<dd>
	<p>Help on options.</p>
	</dd>
	<dt><code>-X</code></dt>
	<dd>
	<p>Help on nonstandard options.</p>
	</dd>
	<dt><code>-source <em>&lt;version&gt;</em></code></dt>
	<dd>
	<p>Control the Java version that <code>javac</code> will accept.</p>
	</dd>
	<dt><code>-target <em>&lt;version&gt;</em></code></dt>
	<dd>
	<p>Control the version of class files that <code>javac</code> will output.</p>
	</dd>
	<dt><code>-profile <em>&lt;profile&gt;</em></code></dt>
	<dd>
	<p>Control the profile that <code>javac</code> will use when compiling the application. See later in this chapter for more detail on Compact Profiles.</p>
	</dd>
	<dt><code>-Xlint</code></dt>
	<dd>
	<p>Enable detail about warnings.</p>
	</dd>
	<dt><code>-Xstdout</code></dt>
	<dd>
	<p>Redirect output of compilation run to a file.</p>
	</dd>
	<dt><code>-g</code></dt>
	<dd>
	<p>Add debug information to class files.</p>
	</dd>
</dl>
</div>

<div class="refsect1" id="_notes">
<h6>Notes</h6>

<p><code>javac</code> has traditionally accepted switches (<code>-source</code> and <code>-target</code>) that control the version of the source language that the compiler would accept, and the version of the class file format that was used for the outputted class files.</p>

<p>This facility introduces additional compiler complexity (as multiple language syntaxes must be supported internally) for some small developer benefit. In Java 8, this capability has begun to be slightly tidied up and placed on a more formal basis.</p>

<p>From JDK 8 onward, <code>javac</code> will only accept source and target options from three versions back. That is, only the formats from JDK 5, 6, 7, and 8 will be accepted by <code>javac</code>. This does not affect the <code>java</code> interpreter鈥攁ny class file from any Java version will still work on the JVM shipped with Java 8.</p>

<p>C and C++ developers may find that the <code>-g</code> switch is less helpful to them than it is in those other languages. This is largely due to the widespread use of IDEs in the Java ecosystem鈥攊ntegrated debugging is simply a lot more useful, and easier to use, than additional debug symbols in class files.</p>

<p>The use of the lint capability remains somewhat controversial among developers. Many Java developers produce code that triggers a large number of compilation warnings, which they then simply ignore. However, experience on larger codebases (especially on the JDK codebase itself) suggests that in a substantial percentage of cases, code that triggers warnings is code in which subtle bugs may lurk. Use of the lint feature, or static analysis tools (such as FindBugs), is strongly recommended.</p>
</div>
</div>

<div class="refentry" id="javanut7-CHP-13-SECT-1.2">
<header>
<p class="refname bottom-left">java</p>
</header>

<div class="refsect1" id="_basic_usage_2">
<h6>Basic usage</h6>

<p><code>java some.package.MyClass</code> <code>java -jar my-packaged.jar</code></p>
</div>

<div class="refsect1" id="_description_2">
<h6>Description</h6>

<p><code>java</code> is the executable that starts up a Java Virtual Machine. The initial entry point into the program is the <code>main()</code> method that exists on the named class, and that has the signature:</p>

<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">);</code></pre>

<p>This method is run on the single application thread that is created by the JVM startup. The JVM process will exit once this method returns (and any additional nondaemon application threads that were started have terminated).</p>

<p>If the form takes a JAR file rather than a class (the executable JAR form), the JAR file must contain a piece of metadata that tells the JVM which class to start from.</p>

<p>This bit of metadata is the <code>Main-Class</code>: attribute, and it is contained in the <em>MANIFEST.MF</em> file in the <em>META-INF/</em> directory. See the description of the <code>jar</code> tool for more details.</p>
</div>

<div class="refsect1" id="_common_switches_2">
<h6>Common switches</h6>

<dl>
	<dt><code>-cp <em>&lt;classpath&gt;</em></code></dt>
	<dd>
	<p>Define the classpath to read from.</p>
	</dd>
	<dt><code>-X</code>, <code>-?</code>, <code>-help</code></dt>
	<dd>
	<p>Provide help about the <code>java</code> executable and its switches.</p>
	</dd>
	<dt><code>-D<em>&lt;property=value&gt;</em></code></dt>
	<dd>
	<p>Sets a Java system property that can be retrieved by the Java program. Any number of such properties can be specified this way.</p>
	</dd>
	<dt><code>-jar</code></dt>
	<dd>
	<p>Run an executable JAR (see <a href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch13.html#refname_jar">the entry for jar</a>).</p>
	</dd>
	<dt><code>-Xbootclasspath(/a or /p)</code></dt>
	<dd>
	<p>Run with an alternative system classpath (very rarely used).</p>
	</dd>
	<dt><code>-client</code>, <code>-server</code></dt>
	<dd>
	<p>Select a HotSpot JIT compiler (see <a href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch13.html#_notes_2">鈥淣otes鈥?for this entry</a>).</p>
	</dd>
	<dt><code>-Xint</code>, <code>-Xcomp</code>, <code>-Xmixed</code></dt>
	<dd>
	<p>Control JIT compilation (very rarely used).</p>
	</dd>
	<dt><code>-Xms<em>&lt;size&gt;</em></code></dt>
	<dd>
	<p>Set the minimum committed heap size for the JVM.</p>
	</dd>
	<dt><code>-Xmx<em>&lt;size&gt;</em></code></dt>
	<dd>
	<p>Set the maximum committed heap size for the JVM.</p>
	</dd>
	<dt><code>-agentlib:<em>&lt;agent&gt;</em></code>, <code>-agentpath:<em>&lt;path to agent&gt;</em></code></dt>
	<dd>
	<p>Specify a JVM Tooling Interface (JVMTI) agent to attach to the process being started. Agents are typically used for instrumentation or monitoring.</p>
	</dd>
	<dt><code>-verbose</code></dt>
	<dd>
	<p>Generate additional output, sometimes useful for debugging.</p>
	</dd>
</dl>
</div>

<div class="refsect1" id="_notes_2">
<h6>Notes</h6>

<p>The HotSpot VM contains two separate JIT compilers鈥攌nown as the client (or C1) compiler and the server (or C2) compiler. These were designed for different purposes, with the client compiler offering more predictable performance and quicker startup, at the expense of not performing aggressive code optimization.</p>

<p>Traditionally, the JIT compiler that a Java process used was chosen at process startup via the <code>-client</code> or <code>-server</code> switch. However, as hardware advances have made compilation ever cheaper, a new possibility has become available鈥攖o use the client compiler early on, while the Java process is warming up, and then to switch to the high-performance optimizations available in the server compiler when they are available. This scheme is called Tiered Compilation, and it is the default in Java 8. Most processes will no longer need explicit <code>-client</code> or <code>-server</code> switches.</p>

<p>On the Windows platform, a slightly different version of the <code>java</code> executable is often used鈥?code&gt;javaw</code>. This version starts up a Java Virtual Machine, without forcing a Windows console window to appear.</p>

<p>In older Java versions, a number of different legacy interpreters and virtual machine modes were supported. These have now mostly been removed, and any remaining should be regarded as vestigial.</p>

<p>Switches that start with <code>-X</code> were intended to be nonstandard switches. However, the trend has been to standardize a number of these switches (particularly <code>-Xms</code> and <code><span class="keep-together">-Xmx</span></code>). In parallel, Java versions have introduced an increasing number of <code>-XX</code>: switches. These were intended to be experimental and not for production use. <span class="keep-together">However</span>, as the implementations have stabilized, some of these switches are now suitable for some advanced users (even in production deployments).</p>

<p>In general, a full discussion of switches is outside the scope of this book. Configuration of the JVM for production use is a specialist subject, and developers are urged to take care, especially when modifying any switches related to the garbage collection subsystem.</p>
</div>
</div>

<div class="refentry" id="javanut7-CHP-13-SECT-1.3">
<header>
<p class="refname bottom-left" id="refname_jar">jar</p>
</header>

<div class="refsect1" id="_basic_usage_3">
<h6>Basic usage</h6>

<p><code>jar cvf my.jar <em>someDir/</em> </code></p>
</div>

<div class="refsect1" id="_description_3">
<h6>Description</h6>

<p>The <code>JAR</code> utility is used to create and manipulate Java Archive (<em>.jar</em>) files. These are ZIP format files that contain Java classes, additional resources, and (usually) metadata. The tool has five major modes of operation鈥擟reate, Update, Index, List, and Extract鈥攐n a JAR file.</p>

<p>These are controlled by passing a command option character (not a switch) to <code>jar</code>. Only one command character can be specified, but optional modifier characters can also be used.</p>
</div>

<div class="refsect1" id="_command_options">
<h6>Command options</h6>

<ul>
	<li>
	<p><code>c</code>: Create a new archive</p>
	</li>
	<li>
	<p><code>u</code>: Update archive</p>
	</li>
	<li>
	<p><code>i</code>: Index an archive</p>
	</li>
	<li>
	<p><code>t</code>: List an archive</p>
	</li>
	<li>
	<p><code>x</code>: Extract an archive</p>
	</li>
</ul>
</div>

<div class="refsect1" id="_modifiers">
<h6>Modifiers</h6>

<ul>
	<li>
	<p><code>v</code>: Verbose mode</p>
	</li>
	<li>
	<p><code>f</code>: Operate on a named file, rather than standard input</p>
	</li>
	<li>
	<p><code>0</code>: Store, but do not compress, files added to the archive</p>
	</li>
	<li>
	<p><code>m</code>: Add the contents of the specified file to the <code>jar</code> metadata manifest</p>
	</li>
	<li>
	<p><code>e</code>: Make this <code>jar</code> executable, with the specified class as the entry point</p>
	</li>
</ul>
</div>

<div class="refsect1" id="_notes_3">
<h6>Notes</h6>

<p>The syntax of the <code>jar</code> command is intentionally very similar to that of the Unix <code>tar</code> command. This similarity is the reason why <code>jar</code> uses command options, rather than switches (as the other Java platform commands do).</p>

<p>When you create a JAR file, the <code>jar</code> tool will automatically add a directory called <em>META-INF</em> that contains a file called <em>MANIFEST.MF</em>鈥攖his is metadata in the form of headers paired with values. By default, <em>MANIFEST.MF</em> contains just two headers:</p>

<pre data-type="programlisting">Manifest-Version: 1.0
Created-By: 1.8.0 (Oracle Corporation)</pre>

<p>Using the <code>m</code> option allows additional metadata to be added into <em>MANIFEST.MF</em> at JAR creation time. One frequently added piece is the <code>Main-Class:</code> attribute, which indicates the entry point into the application contained in the JAR. A JAR with a specified <code>Main-Class:</code> can be directly executed by the JVM, via <code>java -jar</code>, or double-clicking the JAR in a graphical file browser.</p>

<p>The addition of the <code>Main-Class:</code> attribute is so common that <code>jar</code> has the <code>e</code> option to create it directly in <em>MANIFEST.MF</em>, rather than having to create a separate text file for this purpose.</p>
</div>
</div>

<div class="refentry" id="javanut7-CHP-13-SECT-1.4">
<header>
<p class="refname bottom-left">javadoc</p>
</header>

<div class="refsect1" id="_basic_usage_4">
<h6>Basic usage</h6>

<p><code>javadoc <em>some.package</em></code></p>
</div>

<div class="refsect1" id="_description_4">
<h6>Description</h6>

<p><code>javadoc</code> produces documentation from Java source files. It does so by reading a special comment format (known as Javadoc comments) and parsing it into a standard documentation format, which can then be output into a variety of document formats (although HTML is by far the most common).</p>

<p>For a full description of Javadoc syntax, refer to <a href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch07.html#javanut7-CHP-7">Chapter 7</a>.</p>
</div>

<div class="refsect1" id="_common_switches_3">
<h6>Common switches</h6>

<dl>
	<dt><code>-cp <em>&lt;classpath&gt;</em></code></dt>
	<dd>
	<p>Define the classpath to use</p>
	</dd>
	<dt><code>-D <em>&lt;directory&gt;</em></code></dt>
	<dd>
	<p>Tell <code>javadoc</code> where to output the generated docs</p>
	</dd>
	<dt><code>-quiet</code></dt>
	<dd>
	<p>Suppress output except for errors and warnings</p>
	</dd>
</dl>
</div>

<div class="refsect1" id="_notes_4">
<h6>Notes</h6>

<p>The platform API docs are all written in Javadoc.</p>

<p><code>javadoc</code> is built on top of the same classes as <code>javac</code>, and uses some of the source compiler infrastructure to implement Javadoc features.</p>

<p>The typical way to use <code>javadoc</code> is to run it against a whole package, rather than just a class.</p>

<p><code>javadoc</code> has a very large number of switches and options that can control many aspects of its behavior. Detailed discussion of all the options is outside the scope of this book.</p>
</div>
</div>

<div class="refentry" id="javanut7-CHP-13-SECT-1.5">
<header>
<p class="refname bottom-left">jdeps</p>
</header>

<p>The <code>jdeps</code> tool is a static analysis tool for analyzing the dependencies of packages or classes. The tool has a number of usages, from identifying developer code that makes calls into the internal, undocumented JDK APIs (such as the <code>sun.misc</code> classes) to helping trace transitive dependencies.</p>

<p><code>jdeps</code> can also be used to confirm whether a JAR file can run under a Compact Profile (see later in the chapter for more details on Compact Profiles).</p>

<div class="refsect1" id="_basic_usage_5">
<h6>Basic usage</h6>

<p><code>jdeps com.me<em>.MyClass</em></code></p>
</div>

<div class="refsect1" id="_description_5">
<h6>Description</h6>

<p><code>jdeps</code> reports dependency information for the classes it is asked to analyze. The classes can be specified as any class on the classpath, a file path, a directory, or a JAR file.</p>
</div>

<div class="refsect1" id="_common_switches_4">
<h6>Common switches</h6>

<dl>
	<dt><code>-s</code>, <code>-summary</code></dt>
	<dd>
	<p>Prints dependency summary only.</p>
	</dd>
	<dt><code>-v</code>, <code>-verbose</code></dt>
	<dd>
	<p>Prints all class-level dependencies.</p>
	</dd>
	<dt><code>-verbose:package</code></dt>
	<dd>
	<p>Prints package-level dependencies, excluding dependencies within the same archive.</p>
	</dd>
	<dt><code>-verbose:class</code></dt>
	<dd>
	<p>Prints class-level dependencies, excluding dependencies within the same archive.</p>
	</dd>
	<dt><code>-p <em>&lt;pkg name&gt;</em>, -package <em>&lt;pkg name&gt;</em></code></dt>
	<dd>
	<p>Finds dependencies in the specified package. You can specify this option multiple times for different packages. The <code>-p</code> and <code>-e</code> options are mutually exclusive.</p>
	</dd>
	<dt><code>-e <em>&lt;regex&gt;</em>, -regex <em>&lt;regex&gt;</em></code></dt>
	<dd>
	<p>Finds dependencies in packages matching the specified regular expression pattern. The <code>-p</code> and <code>-e</code> options are mutually exclusive.</p>
	</dd>
	<dt><code>-include <em>&lt;regex&gt;</em></code></dt>
	<dd>
	<p>Restricts analysis to classes matching pattern. This option filters the list of classes to be analyzed. It can be used together with <code>-p</code> and <code>-e</code>.</p>
	</dd>
	<dt><code>-jdkinternals</code></dt>
	<dd>
	<p>Finds class-level dependencies in JDK internal APIs (which may change or disappear in even minor platform releases).</p>
	</dd>
	<dt><code>-apionly</code></dt>
	<dd>
	<p>Restricts analysis to APIs鈥攆or example, dependencies from the signature of public and protected members of public classes including field type, method parameter types, returned type, and checked exception types.</p>
	</dd>
	<dt><code>-R</code>, <code>-recursive</code></dt>
	<dd>
	<p>Recursively traverses all dependencies.</p>
	</dd>
	<dt><code>-h</code>, <code>-?</code>, <code>-help</code></dt>
	<dd>
	<p>Prints help message for <code>jdeps</code>.</p>
	</dd>
</dl>
</div>

<div class="refsect1" id="_notes_5">
<h6>Notes</h6>

<p><code>jdeps</code> is a useful tool for making developers aware of their dependencies on the JRE not as a monolithic environment, but as something more modular.</p>
</div>
</div>

<div class="refentry" id="javanut7-CHP-13-SECT-1.6">
<header>
<p class="refname bottom-left">jps</p>
</header>

<div class="refsect1" id="_basic_usage_6">
<h6>Basic usage</h6>

<p><code>jps</code> <code>jps <em>&lt;remote URL&gt;</em></code></p>
</div>

<div class="refsect1" id="_description_6">
<h6>Description</h6>

<p><code>jps</code> provides a list of all active JVM processes on the local machine (or a remote machine, if a suitable instance of <code>jstatd</code> is running on the remote side).</p>
</div>

<div class="refsect1" id="_common_switches_5">
<h6>Common switches</h6>

<dl>
	<dt><code>-m</code></dt>
	<dd>
	<p>Output the arguments passed to the main method</p>
	</dd>
	<dt><code>-l</code></dt>
	<dd>
	<p>Output the full package name for the application鈥檚 main class (or the full path name to the application鈥檚 JAR file)</p>
	</dd>
	<dt><code>-v</code></dt>
	<dd>
	<p>Output the arguments passed to the JVM</p>
	</dd>
</dl>
</div>

<div class="refsect1" id="_notes_6">
<h6>Notes</h6>

<p>This command is not strictly necessary, as the standard Unix <code>ps</code> command could suffice. However, it does not use the standard Unix mechanism for interrogating the process, so there are circumstances where a Java process stops responding (and looks dead to <code>jps</code>) but is still listed as alive by the operating system.</p>
</div>
</div>

<div class="refentry" id="javanut7-CHP-13-SECT-1.7">
<header>
<p class="refname bottom-left">jstat</p>
</header>

<div class="refsect1" id="_basic_usage_65">
<h6>Basic usage</h6>

<p><code>jstat <em>&lt;pid&gt;</em></code></p>
</div>

<div class="refsect1" id="_description_7">
<h6>Description</h6>

<p>This command displays some basic statistics about a given Java process. This is usually a local process, but can be located on a remote machine, provided the remote side is running a suitable <code>jstatd</code> process.</p>
</div>

<div class="refsect1" id="_common_switches_6">
<h6>Common switches</h6>

<dl>
	<dt><code>-options</code></dt>
	<dd>
	<p>Reports a list of report types that <code>jstat</code> can produce</p>
	</dd>
	<dt><code>-class</code></dt>
	<dd>
	<p>Report on classloading activity to date</p>
	</dd>
	<dt><code>-compiler</code></dt>
	<dd>
	<p>JIT compilation of the process so far</p>
	</dd>
	<dt><code>-gcutil</code></dt>
	<dd>
	<p>Detailed GC report</p>
	</dd>
	<dt><code>-printcompilation</code></dt>
	<dd>
	<p>More detail on compilation</p>
	</dd>
</dl>
</div>

<div class="refsect1" id="_notes_7">
<h6>Notes</h6>

<p>The general syntax <code>jstat</code> uses to identify a process (which may be remote) is:</p>

<pre data-code-language="java" data-type="programlisting"><code class="o">[</code><em><code class="o">&lt;</code><code class="n">protocol</code><code class="o">&gt;</code></em><code class="o">:</code><code class="c1">//]&lt;vmid&gt;[@hostname][:port][/servername]</code></pre>

<p>The general syntax is used to specify a remote process (which is usually connected to via JMX over RMI), but in practice, the local syntax is far more common, which simply uses the VM ID, which is the operating system process ID (PID) on mainstream platforms (Linux, Windows, Unix, macOS, etc.).</p>
</div>
</div>

<div class="refentry" id="javanut7-CHP-13-SECT-1.8">
<header>
<p class="refname bottom-left">jstatd</p>
</header>

<div class="refsect1" id="_basic_usage_7">
<h6>Basic usage</h6>

<p><code>jstatd <em>&lt;options&gt;</em></code></p>
</div>

<div class="refsect1" id="_description_8">
<h6>Description</h6>

<p><code>jstatd</code> provides a way of making information about local JVMs available over the network. It achieves this using RMI, and can make these otherwise-local capabilities accessible to JMX clients. This requires special security settings, which differ from the JVM defaults. To start <code>jstatd</code>, first we need to create the following file and name it <em>jstatd.policy</em>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">grant</code> <code class="n">codebase</code> <code class="err">&quot;</code><code class="nl">file:</code><code class="n">$</code><code class="o">{</code><code class="n">java</code><code class="o">.</code><code class="na">home</code><code class="o">}../</code><code class="n">lib</code><code class="o">/</code><code class="n">tools</code><code class="o">.</code><code class="na">jar</code> <code class="o">{</code>
  <code class="n">permission</code> <code class="n">java</code><code class="o">.</code><code class="na">security</code><code class="o">.</code><code class="na">AllPermission</code>
<code class="o">}</code></pre>

<p>This policy file grants all security permissions to any class loaded from the JDK鈥檚 <em>tools.jar</em> file.</p>

<p>To launch <code>jstatd</code> with this policy, use this command line:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">jstatd</code><code> </code><code class="o">-</code><code class="n">J</code><code class="o">-</code><code class="n">Djava</code><code class="o">.</code><code class="na">security</code><code class="o">.</code><code class="na">policy</code><code class="o">=</code><em><code class="o">&lt;</code><code class="n">path</code><code> </code><code class="n">to</code><code> </code><code class="n">jstat</code><code class="o">.</code><code class="na">policy</code><code class="o">&gt;</code></em></pre>
</div>

<div class="refsect1" id="_common_switches_7">
<h6>Common switches</h6>

<dl>
	<dt><code>-p <em>&lt;port&gt;</em></code></dt>
	<dd>
	<p>Look for an existing RMI registry on that port, and create one if not found</p>
	</dd>
</dl>
</div>

<div class="refsect1" id="_notes_8">
<h6>Notes</h6>

<p>It is recommended that <code>jstatd</code> is always switched on in production environments, but not over the public internet. For most corporate and enterprise environments, this is nontrivial to achieve and will require the cooperation of Operations and Network Engineering staff. However, the benefits of having telemetry data from production JVMs, especially during outages, are difficult to overstate.</p>

<p>A full discussion of JMX and monitoring techniques is outside the scope of this book.</p>
</div>
</div>

<div class="refentry" id="javanut7-CHP-13-SECT-1.9">
<header>
<p class="refname bottom-left">jinfo</p>
</header>

<div class="refsect1" id="_basic_usage_8">
<h6>Basic usage</h6>

<p><code>jinfo <em>&lt;PID&gt;</em></code> <code>jinfo <em>&lt;core file&gt;</em></code></p>
</div>

<div class="refsect1" id="_description_9">
<h6>Description</h6>

<p>This tool displays the system properties and JVM options for a running Java process (or a core file).</p>
</div>

<div class="refsect1" id="_common_switches_8">
<h6>Common switches</h6>

<dl>
	<dt><code>-flags</code></dt>
	<dd>
	<p>Display JVM flags only</p>
	</dd>
	<dt><code>-sysprops</code></dt>
	<dd>
	<p>Display system properties only</p>
	</dd>
</dl>
</div>

<div class="refsect1" id="_notes_9">
<h6>Notes</h6>

<p>In practice, this is very rarely used鈥攁lthough it can occasionally be useful as a sanity check that the expected program is actually what is executing.</p>
</div>
</div>

<div class="refentry" id="javanut7-CHP-13-SECT-1.10">
<header>
<p class="refname bottom-left">jstack</p>
</header>

<div class="refsect1" id="_basic_usage_85">
<h6>Basic usage</h6>

<p><code>jstack <em>&lt;PID&gt;</em></code></p>
</div>

<div class="refsect1" id="_description_10">
<h6>Description</h6>

<p>The <code>jstack</code> utility produces a stack trace for each Java thread in the process.</p>
</div>

<div class="refsect1" id="_common_switches_9">
<h6>Common switches</h6>

<dl>
	<dt><code>-F</code></dt>
	<dd>
	<p>Force a thread dump</p>
	</dd>
	<dt><code>-l</code></dt>
	<dd>
	<p>Long mode (contains additional information about locks)</p>
	</dd>
</dl>
</div>

<div class="refsect1" id="_notes_11">
<h6>Notes</h6>

<p>Producing the stack trace does not stop or terminate the Java process. The files that <code>jstack</code> produces can be very large, and some post-processing of the file is usually necessary.</p>
</div>
</div>

<div class="refentry" id="javanut7-CHP-13-SECT-1.11">
<header>
<p class="refname bottom-left">jmap</p>
</header>

<div class="refsect1" id="_basic_usage_86">
<h6>Basic usage</h6>

<p><code>jmap <em>&lt;process&gt;</em></code></p>
</div>

<div class="refsect1" id="_description_11">
<h6>Description</h6>

<p><code>jmap</code> provides a view of memory allocation for a running Java process.</p>
</div>

<div class="refsect1" id="_common_switches_10">
<h6>Common switches</h6>

<dl>
	<dt><em>-histo</em></dt>
	<dd>
	<p>Produces a histogram of the current state of allocated memory.</p>
	</dd>
	<dt><em>-histo:live</em></dt>
	<dd>
	<p>This version of the histogram only displays information for live objects.</p>
	</dd>
	<dt><em>-heap</em></dt>
	<dd>
	<p>Produces a heap dump from the running process.</p>
	</dd>
</dl>
</div>

<div class="refsect1" id="_notes_12">
<h6>Notes</h6>

<p>The histogram forms walk the JVMs allocation list. This includes both live and dead (but not yet collected) objects. The histogram is organized by the type of objects using memory, and is ordered from greatest to least number of bytes used by a particular type. The standard form does not pause the JVM.</p>

<p>The live form ensures that it is accurate, by performing a full, stop-the-world (STW) garbage collection before executing. As a result, it should not be used on a production system at a time when a full GC would appreciably impact users.</p>

<p>For the <code>-heap</code> form, note that the production of a heap dump can be a time-consuming process, and is STW. Note that for many processes, the resulting file may be extremely large.</p>
</div>
</div>

<div class="refsect1" id="javanut7-CHP-13-SECT-1.12">
<header>
<p class="refname bottom-left">javap</p>
</header>

<div class="refsect1" id="_basic_usage_87">
<h6>Basic usage</h6>

<p><code>javap <em>&lt;classname&gt;</em></code></p>
</div>

<div class="refsect1" id="_description_12">
<h6>Description</h6>

<p><code>javap</code> is the Java class disassembler鈥攅ffectively a tool for peeking inside class files. It can show the bytecode that Java methods have been compiled into, as well as the 鈥渃onstant pool鈥?information (which contains information similar to that of the symbol table of Unix processes).</p>

<p>By default, <code>javap</code> shows signatures of <code>public</code>, <code>protected</code>, and default methods. The <code>-p</code> switch will also show <code>private</code> methods.</p>
</div>

<div class="refsect1" id="_common_switches_11">
<h6>Common switches</h6>

<dl>
	<dt><code>-c</code></dt>
	<dd>
	<p>Decompile bytecode</p>
	</dd>
	<dt><code>-v</code></dt>
	<dd>
	<p>Verbose mode (include constant pool information)</p>
	</dd>
	<dt><code>-p</code></dt>
	<dd>
	<p>Include <code>private</code> methods</p>
	</dd>
</dl>
</div>

<div class="refsect1" id="_notes_13">
<h6>Notes</h6>

<p>The <code>javap</code> tool will work with any class file, provided <code>javap</code> is from a JDK version the same as (or later than) the one that produced the file.</p>

<div data-type="note" epub:type="note"><h6>Note</h6>Some Java language features may have surprising implementations in bytecode. For example, as we saw in <a href="https://learning.oreilly.com/library/view/java-in-a/9781492037248/ch09.html#javanut7-CHP-9">Chapter 9</a>, Java鈥檚 <code>String</code> class has effectively immutable instances and the JVM implements the string concatenation operator <code>+</code> in a different way in Java versions after 8 than previously. This difference is clearly visible in the disassembled bytecode shown by <code>javap</code>.</div>
</div>
</div>

<div class="refsect1" id="javanut7-CHP-13-SECT-1.13">
<header>
<p class="refname bottom-left">jaotc</p>
</header>

<div class="refsect1" id="_basic_usage_88">
<h6>Basic usage</h6>

<p><code>jaotc --output libStringHash.so StringHash.class</code></p>
</div>

<div class="refsect1" id="_description_13">
<h6>Description</h6>

<p><code>jaotc</code> is the ahead-of-time compiler for the Java platform鈥攁 tool for compiling Java class files or modules to native code. This can be used to create shared objects that can greatly reduce process startup time and provide lower memory footprint due to reduced dynamic class operations.</p>
</div>

<div class="refsect1" id="_common_switches_13">
<h6>Common switches</h6>

<dl>
	<dt><code>--info</code></dt>
	<dd>
	<p>Basic information about what鈥檚 being compiled</p>
	</dd>
	<dt><code>--verbose</code></dt>
	<dd>
	<p>Verbose mode (full details)</p>
	</dd>
	<dt><code>--help</code></dt>
	<dd>
	<p>Full list of options (very useful)</p>
	</dd>
</dl>
</div>

<div class="refsect1" id="_notes_14">
<h6>Notes</h6>

<p>The <code>jaotc</code> tool will work with class files, JARs, or modules and can support multiple linker backends. On macOS, the shared objects produced will be Mach <em>.dylib</em> files rather than Linux shared objects.</p>

<div data-type="note" epub:type="note"><h6>Note</h6>Some Java language features (e.g., reflection, method handles) may have some restrictions when compiling to static code.</div>
</div>
</div>

<div class="refsect1" id="javanut7-CHP-13-SECT-1.14">
<header>
<p class="refname bottom-left">jlink</p>
</header>

<div class="refsect1" id="_basic_usage_89">
<h6>Basic usage</h6>

<p><code>jlink <em>[options]</em> --module-path modulepath --add-modules module</code></p>
</div>

<div class="refsect1" id="_description_14">
<h6>Description</h6>

<p><code>jlink</code> is the custom runtime image linker for the Java platform鈥攁 tool for linking and packaging Java classes, modules, and their dependencies into a custom runtime image. The image created by the <code>jlink</code> tool will comprise a linked set of modules, along with their transitive dependences.</p>
</div>

<div class="refsect1" id="_common_switches_14">
<h6>Common switches</h6>

<dl>
	<dt><code>--add-modules module [, <em>module1</em>]</code></dt>
	<dd>
	<p>Adds modules to the root set of modules to be linked</p>
	</dd>
	<dt><code>--endian {little|big}</code></dt>
	<dd>
	<p>Specifies the endianness of the target architecture</p>
	</dd>
	<dt><code>--module-path path</code></dt>
	<dd>
	<p>Specify the path where the modules for linking can be found</p>
	</dd>
	<dt><code>--save-opts file</code></dt>
	<dd>
	<p>Saves the options to the linker in the specified file</p>
	</dd>
	<dt><code>--help</code></dt>
	<dd>
	<p>Print help information</p>
	</dd>
	<dt><code>@filename</code></dt>
	<dd>
	<p>Read options from filename instead of the command line</p>
	</dd>
</dl>
</div>

<div class="refsect1" id="_notes_15">
<h6>Notes</h6>

<p>The <code>jlink</code> tool will work with any class file or module and linking will require the transitive dependencies of the code to be linked.</p>

<div data-type="note" epub:type="note"><h6>Note</h6>Custom runtime images don鈥檛 have any support for automatic updates by default. This means that developers are responsible for rebuilding and updating their own applications in the field when necessary. Some Java language features may have some restrictions, as the runtime image may not include the full JDK; therefore reflection and other dynamic techniques may not be fully supported.</div>
</div>
</div>

<div class="refsect1" id="javanut7-CHP-13-SECT-1.15">
<header>
<p class="refname bottom-left">jmod</p>
</header>

<div class="refsect1" id="_basic_usage_90">
<h6>Basic usage</h6>

<p><code>jmod create <em>[options]</em> my-new.jmod</code></p>
</div>

<div class="refsect1" id="_description_15">
<h6>Description</h6>

<p><code>jmod</code> prepares Java software components for use by the custom linker (<code>jlink</code>). The result is a <em>.jmod</em> file. This should be considered an intermediate file, not a primary artifact for distribution.</p>
</div>

<div class="refsect1" id="_common_switches_15">
<h6>Basic modes</h6>

<dl>
	<dt><code>create</code></dt>
	<dd>
	<p>Create a new JMOD file</p>
	</dd>
	<dt><code>extract</code></dt>
	<dd>
	<p>Extract all files from a JMOD file (explode it)</p>
	</dd>
	<dt><code>list</code></dt>
	<dd>
	<p>List all files from a JMOD file</p>
	</dd>
	<dt><code>describe</code></dt>
	<dd>
	<p>Print details about a JMOD file</p>
	</dd>
</dl>

<h6>Common switches</h6>

<dl>
	<dt><code>--module-path path</code></dt>
	<dd>
	<p>Specify the module path where the core contents of the module can be found</p>
	</dd>
	<dt><code>--libs path</code></dt>
	<dd>
	<p>Specify the path where native libraries for inclusion can be found</p>
	</dd>
	<dt><code>--help</code></dt>
	<dd>
	<p>Print help information</p>
	</dd>
	<dt><code>@filename</code></dt>
	<dd>
	<p>Read options from filename instead of the command line</p>
	</dd>
</dl>
</div>

<div class="refsect1" id="_notes_16">
<h6>Notes</h6>

<p><code>jmod</code> reads and writes the JMOD format, but please note that this is different from the modular JAR format and is not intended as an immediate replacement for it.</p>

<div data-type="note" epub:type="note"><h6>Note</h6>The <code>jmod</code> tool is only currently intended for modules that are intended to be linked into a runtime image (using the <code>jlink</code> tool). One other possible use case is for packaging modules that have native libraries or other configuration files that must be distributed along with the module.</div>
</div>
</div>
</div></section>













<section data-pdf-bookmark="Introduction to JShell" data-type="sect1"><div class="sect1" id="javanut7-CHP-13-SECT-2">
<h1>Introduction to JShell</h1>

<p><a data-primary="JShell" data-type="indexterm" id="15_ix_ch13-asciidoc0"></a>Java is traditionally understood as a language that is class-oriented and has a distinct compile-interpret-evaluate execution model.
However, in this section, we will discuss a new technology that extends this programming paradigm, by providing a form of interactive/scripting capability.</p>

<p>With the advent of Java 9, the Java runtime and JDK bundles a new tool, JShell. This is an interactive shell for Java, similar to the REPL seen in languages like Python, Scala, or Lisp.
The shell is intended for teaching and exploratory use and, due to the nature of the Java language, is not expected to be as much use to the working programmer as similar shells are in other languages.</p>

<p>In particular, it is not expected that Java will become a REPL-driven language.
Instead, this opens up an opportunity to use JShell for a different style of programming, one that complements the traditional use case but also provides new perspectives, especially for working with a new API.</p>

<p>It is very easy to use JShell to explore simple language features, for instance:</p>

<ul>
<li>
<p>Primitive data types</p>
</li>
<li>
<p>Simple numeric operations</p>
</li>
<li>
<p>String manipulation basics</p>
</li>
<li>
<p>Object types</p>
</li>
<li>
<p>Defining new classes</p>
</li>
<li>
<p>Creating new objects</p>
</li>
<li>
<p>Calling methods</p>
</li>
</ul>

<p>To start up JShell, we just invoke it from the command line:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">$</code> <code class="n">jshell</code>
<code class="o">|</code>  <code class="n">Welcome</code> <code class="n">to</code> <code class="n">JShell</code> <code class="o">--</code> <code class="n">Version</code> <code class="mi">10</code>
<code class="o">|</code>  <code class="n">For</code> <code class="n">an</code> <code class="n">introduction</code> <code class="nl">type:</code> <code class="o">/</code><code class="n">help</code> <code class="n">intro</code>

<code class="n">jshell</code><code class="o">&gt;</code></pre>

<p><a data-primary="snippets" data-type="indexterm" id="15_idm45941099157416"></a>From here, we can enter small pieces of Java code, which are known as <em>snippets</em>:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">jshell</code><code class="o">&gt;</code> <code class="mi">2</code> <code class="o">*</code> <code class="mi">3</code>
<code class="n">$1</code> <code class="o">==&gt;</code> <code class="mi">6</code>

<code class="n">jshell</code><code class="o">&gt;</code> <code class="n">var</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">2</code> <code class="o">*</code> <code class="mi">3</code>
<code class="n">i</code> <code class="o">==&gt;</code> <code class="mi">6</code></pre>

<p>The shell is designed to be a simple working environment, and so it relaxes some of the rules that working Java programmers may expect.
Some of the differences between JShell snippets and regular Java include:</p>

<ul>
<li>
<p>Semicolons are optional in JShell</p>
</li>
<li>
<p>JShell supports a verbose mode</p>
</li>
<li>
<p>JShell has a wider set of default imports than a regular Java program</p>
</li>
<li>
<p>Methods can be declared at top level (outside of a class)</p>
</li>
<li>
<p>Methods can be redefined within snippets</p>
</li>
<li>
<p>A snippet may not declare a package or a module鈥攅verything is placed in an unnamed package controlled by the shell</p>
</li>
<li>
<p>Only public classes may be accessed from JShell</p>
</li>
<li>
<p>Due to package restrictions, it鈥檚 advisable to ignore access control when defining classes and working within JShell</p>
</li>
</ul>

<p>It鈥檚 simple to create simple class hierarchies (e.g., for exploring Java鈥檚 inheritance and generics):</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">jshell</code><code class="o">&gt;</code> <code class="kd">class</code> <code class="nc">Pet</code> <code class="o">{}</code>
<code class="o">|</code>  <code class="n">created</code> <code class="kd">class</code> <code class="nc">Pet</code>

<code class="n">jshell</code><code class="o">&gt;</code> <code class="kd">class</code> <code class="nc">Cat</code> <code class="kd">extends</code> <code class="n">Pet</code> <code class="o">{}</code>
<code class="o">|</code>  <code class="n">created</code> <code class="kd">class</code> <code class="nc">Cat</code>

<code class="n">jshell</code><code class="o">&gt;</code> <code class="n">var</code> <code class="n">c</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Cat</code><code class="o">()</code>
<code class="n">c</code> <code class="o">==&gt;</code> <code class="n">Cat</code><code class="err">@</code><code class="mi">2</code><code class="n">ac273d3</code></pre>

<p>Tab completion within the shell is also possible, such as for autocompletion of possible methods:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">jshell</code><code class="o">&gt;</code> <code class="n">c</code><code class="o">.&lt;</code><code class="n">TAB</code> <code class="n">TAB</code><code class="o">&gt;</code>
<code class="nf">equals</code><code class="o">(</code>       <code class="n">getClass</code><code class="o">()</code>    <code class="n">hashCode</code><code class="o">()</code>    <code class="n">notify</code><code class="o">()</code>      <code class="n">notifyAll</code><code class="o">()</code>
<code class="n">toString</code><code class="o">()</code>    <code class="n">wait</code><code class="o">(</code></pre>

<p>We can also create top-level methods, such as:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">jshell</code><code class="o">&gt;</code> <code class="kt">int</code> <code class="nf">div</code><code class="o">(</code><code class="kt">int</code> <code class="n">x</code><code class="o">,</code> <code class="kt">int</code> <code class="n">y</code><code class="o">)</code> <code class="o">{</code>
   <code class="o">...&gt;</code> <code class="k">return</code> <code class="n">x</code> <code class="o">/</code> <code class="n">y</code><code class="o">;</code>
   <code class="o">...&gt;</code> <code class="o">}</code>
<code class="o">|</code>  <code class="n">created</code> <code class="n">method</code> <code class="n">div</code><code class="o">(</code><code class="kt">int</code><code class="o">,</code><code class="kt">int</code><code class="o">)</code></pre>

<p>Simple exception backtraces are also supported:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">jshell</code><code class="o">&gt;</code> <code class="nf">div</code><code class="o">(</code><code class="mi">3</code><code class="o">,</code><code class="mi">0</code><code class="o">)</code>
<code class="o">|</code>  <code class="n">Exception</code> <code class="n">java</code><code class="o">.</code><code class="na">lang</code><code class="o">.</code><code class="na">ArithmeticException</code><code class="o">:</code> <code class="o">/</code> <code class="n">by</code> <code class="n">zero</code>
<code class="o">|</code>        <code class="n">at</code> <code class="n">div</code> <code class="o">(</code><code class="err">#</code><code class="mi">2</code><code class="o">:</code><code class="mi">2</code><code class="o">)</code>
<code class="o">|</code>        <code class="n">at</code> <code class="o">(</code><code class="err">#</code><code class="mi">3</code><code class="o">:</code><code class="mi">1</code><code class="o">)</code></pre>

<p>We can access classes from the JDK:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">jshell</code><code class="o">&gt;</code> <code class="n">var</code> <code class="n">ls</code> <code class="o">=</code> <code class="n">List</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="s">Alpha</code><code class="o">,</code> <code class="s">Beta</code><code class="o">,</code> <code class="s">Gamma</code><code class="o">,</code> <code class="s">Delta</code><code class="o">,</code> <code class="s">Epsilon</code><code class="o">)</code>
<code class="n">ls</code> <code class="o">==&gt;</code> <code class="o">[</code><code class="n">Alpha</code><code class="o">,</code> <code class="n">Beta</code><code class="o">,</code> <code class="n">Gamma</code><code class="o">,</code> <code class="n">Delta</code><code class="o">,</code> <code class="n">Epsilon</code><code class="o">]</code>

<code class="n">jshell</code><code class="o">&gt;</code> <code class="n">ls</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="mi">3</code><code class="o">)</code>
<code class="n">$11</code> <code class="o">==&gt;</code> <code class="s">Delta</code>

<code class="n">jshell</code><code class="o">&gt;</code> <code class="n">ls</code><code class="o">.</code><code class="na">forEach</code><code class="o">(</code><code class="n">s</code> <code class="o">-&gt;</code> <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">s</code><code class="o">.</code><code class="na">charAt</code><code class="o">(</code><code class="mi">1</code><code class="o">)))</code>
<code class="n">l</code>
<code class="n">e</code>
<code class="n">a</code>
<code class="n">e</code>
<code class="n">p</code></pre>

<p>Or explicitly import classes if necessary:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">jshell</code><code class="o">&gt;</code> <code class="kn">import</code> <code class="nn">java.time.LocalDateTime</code>

<code class="n">jshell</code><code class="o">&gt;</code> <code class="n">var</code> <code class="n">now</code> <code class="o">=</code> <code class="n">LocalDateTime</code><code class="o">.</code><code class="na">now</code><code class="o">()</code>
<code class="n">now</code> <code class="o">==&gt;</code> <code class="mi">2018</code><code class="o">-</code><code class="mi">10</code><code class="o">-</code><code class="mi">02</code><code class="nl">T14:</code><code class="mi">48</code><code class="o">:</code><code class="mf">28.139422</code>

<code class="n">jshell</code><code class="o">&gt;</code> <code class="n">now</code><code class="o">.</code><code class="na">plusWeeks</code><code class="o">(</code><code class="mi">3</code><code class="o">)</code>
<code class="n">$9</code> <code class="o">==&gt;</code> <code class="mi">2018</code><code class="o">-</code><code class="mi">10</code><code class="o">-</code><code class="mi">23</code><code class="nl">T14:</code><code class="mi">48</code><code class="o">:</code><code class="mf">28.139422</code></pre>

<p>The environment also allows JShell commands, which start with a <code>/</code>.
It is useful to be aware of some of the most common basic commands:</p>

<ul>
<li>
<p><code>/help intro</code> is the introductory help text</p>
</li>
<li>
<p><code>/help</code> is a more comprehensive entry point into the help system</p>
</li>
<li>
<p><code>/vars</code> shows which variables are in scope</p>
</li>
<li>
<p><code>/list</code> will show the shell history</p>
</li>
<li>
<p><code>/save</code> outputs accepted snippet source to a file</p>
</li>
<li>
<p><code>/open</code> reads a saved file and brings it into the environment</p>
</li>
</ul>

<p>For example, the imports available within JShell include a lot more than just <code>java.lang</code>.
The whole list is loaded by JShell during startup, and can be seen as the <em>special imports</em> visible through the <code>/list -all</code> command:</p>

<pre data-code-language="java" data-type="programlisting"><code class="n">jshell</code><code class="o">&gt;</code> <code class="o">/</code><code class="n">list</code> <code class="o">-</code><code class="n">all</code>

  <code class="n">s1</code> <code class="o">:</code> <code class="kn">import</code> <code class="nn">java.io.*</code><code class="o">;</code>
  <code class="n">s2</code> <code class="o">:</code> <code class="kn">import</code> <code class="nn">java.math.*</code><code class="o">;</code>
  <code class="n">s3</code> <code class="o">:</code> <code class="kn">import</code> <code class="nn">java.net.*</code><code class="o">;</code>
  <code class="n">s4</code> <code class="o">:</code> <code class="kn">import</code> <code class="nn">java.nio.file.*</code><code class="o">;</code>
  <code class="n">s5</code> <code class="o">:</code> <code class="kn">import</code> <code class="nn">java.util.*</code><code class="o">;</code>
  <code class="n">s6</code> <code class="o">:</code> <code class="kn">import</code> <code class="nn">java.util.concurrent.*</code><code class="o">;</code>
  <code class="n">s7</code> <code class="o">:</code> <code class="kn">import</code> <code class="nn">java.util.function.*</code><code class="o">;</code>
  <code class="n">s8</code> <code class="o">:</code> <code class="kn">import</code> <code class="nn">java.util.prefs.*</code><code class="o">;</code>
  <code class="n">s9</code> <code class="o">:</code> <code class="kn">import</code> <code class="nn">java.util.regex.*</code><code class="o">;</code>
 <code class="n">s10</code> <code class="o">:</code> <code class="kn">import</code> <code class="nn">java.util.stream.*</code><code class="o">;</code></pre>

<p>The JShell environment is tab-completed, which greatly adds to the usability of the tool.
The verbose mode is particularly useful when you are getting to know JShell鈥攊t can be activated by passing the <code>-v</code> switch at startup as well as via a shell command.<a data-startref="ix_ch13-asciidoc0" data-type="indexterm" id="15_idm45941098757512"></a></p>
</div></section>













<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="idm45941099214840">
<h1>Summary</h1>

<p>Java has changed a huge amount over the last 15+ years, and yet the
platform and community remain vibrant. To have achieved this, while
retaining a recognizable language and platform, is no small
accomplishment.</p>

<p>Ultimately, the continued existence and viability of Java depends upon
the individual developer. On that basis, the future looks bright, and we
look forward to the next wave, Java鈥檚 25th birthday, and beyond.</p>
</div></section>







</div></section><div class="annotator-outer annotator-viewer viewer annotator-hide"> </div></div></div>
    </section>
  </div>
</div>
<div class="font-flyout" style="top: 200.978px; left: 2474px;"> </div><div id="batBeacon0.2540438231629141" style="width:0px; height:0px; display:none; visibility:hidden;"><img alt="" height="0" id="batBeacon0.009433733998494676" src="https://bat.bing.com/action/0?ti=5794699&amp;Ver=2&amp;mid=0e050905-af61-6c3a-2a83-61bbebf4a6e3&amp;pi=1200101525&amp;lg=zh-CN&amp;sw=2560&amp;sh=1440&amp;sc=24&amp;tl=13.%20Platform%20Tools%20-%20Java%20in%20a%20Nutshell,%207th%20Edition&amp;p=https%3A%2F%2Flearning.oreilly.com%2Flibrary%2Fview%2Fjava-in-a%2F9781492037248%2Fch13.html&amp;r=&amp;lt=3073&amp;evt=pageLoad&amp;msclkid=N&amp;rn=176978" style="width:0px; height:0px; display:none; visibility:hidden;" width="0"/></div><span><div id="KampyleAnimationContainer" style="z-index: 2147483000; border: 0px; position: fixed; display: block; width: 0px; height: 0px;"></div></span></body></html>
